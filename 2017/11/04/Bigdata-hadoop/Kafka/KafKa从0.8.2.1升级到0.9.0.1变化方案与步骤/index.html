<!DOCTYPE html>
<html lang="zh-CN">









<head>
    <meta charset="utf-8" />
    <link rel="apple-touch-icon" sizes="76x76" href="../img/favicon.png">
    <link rel="icon" type="image/png" href="../img/favicon.png">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no" name="viewport" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="description" content="Personal blog, thinking and sharing of technology and life">
    <meta name="author" content="Yancy">
    <meta name="keywords" content="undefined">
    <title>KafKaä»0.8.2.1å‡çº§åˆ°0.9.0.1å˜åŒ–æ–¹æ¡ˆä¸æ­¥éª¤ ~ Yancy&#39;s blog</title>
    <link rel="stylesheet" href="/css/Material_Icons.css">
    <!-- <link rel="stylesheet" href="/css/font-awesome.css"> -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css">
    <link rel="stylesheet" href="/css/style.css">
    
        <link rel="stylesheet" href="/css/post.css">
        
            <link rel="stylesheet" href="/css/Prettify/tomorrow-night-eighties.min.css">
        
    
</head>

<body class=" sidebar-collapse">
<nav class="navbar navbar-transparent navbar-color-on-scroll fixed-top navbar-expand-lg" color-on-scroll="100" id="sectionsNav">
    <div class="container">
        <div class="navbar-translate">
            <a class="navbar-brand" href="/">
                Yancy&#39;s blog</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" aria-expanded="false" aria-label="Toggle navigation">
                <span class="sr-only">Toggle navigation</span>
                <span class="navbar-toggler-icon"></span>
                <span class="navbar-toggler-icon"></span>
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
            <div class="collapse navbar-collapse">
                <ul class="navbar-nav ml-auto">
                    
                        
                            <li class="nav-item">
                                <a class="nav-link" href="/archives/">
                                    archives
                                </a>
                            </li>
                        
                            <li class="nav-item">
                                <a class="nav-link" href="/about/">
                                    about
                                </a>
                            </li>
                        
                    
                    
                        
                            <li class="nav-item">
                                <a class="nav-link" rel="tooltip" title="" data-placement="bottom" href="" target="_blank" data-original-title="See me here">
                                    <i class="fa fa-github"></i>
                                </a>
                            </li>
                        
                            <li class="nav-item">
                                <a class="nav-link" rel="tooltip" title="" data-placement="bottom" href="" target="_blank" data-original-title="See me here">
                                    <i class="fa fa-twitter"></i>
                                </a>
                            </li>
                        
                    
                </ul>
            </div>
    </div>
</nav>
    
  <div class="page-header header-filter" data-parallax="true" style="background-image: url('../img/post-head.jpg')">
    
      <div class="container">
        <h1 class="title text-center">KafKaä»0.8.2.1å‡çº§åˆ°0.9.0.1å˜åŒ–æ–¹æ¡ˆä¸æ­¥éª¤</h1>
        <p class="text-center"><b>Saturday, November 4th 2017, 11:22 am</b></p>
      </div>
    
  </div>


  <div class="main main-raised">
    <div class="container">
      <div class="section">
        


<div class="row">
    <div class="col-md-7 offset-md-2">
        <div class="post_content tocbot-content">
            <p>ğŸŠæˆ‘è¿™é‡Œæ˜¯é‡‡ç”¨,ç¾¤é›†å‡çº§,å…¨éƒ¨æ›´æ–°åœæ­¢è€ç‰ˆæœ¬zkå’Œkafkaæ›´æ–°æœåŠ¡ã€‚</p>
<p>9.0.0æœ‰æ½œåœ¨çš„ä¸­æ–­æ›´æ”¹é£é™©ï¼ˆåœ¨å‡çº§ä¹‹å‰éœ€è¦çŸ¥é“ï¼‰ï¼Œå¹¶ä¸”ä¸ä¹‹å‰ç‰ˆæœ¬çš„brokerä¹‹é—´çš„åè®®æ”¹å˜ã€‚è¿™æ„å‘³ç€æ­¤æ¬¡å‡çº§å¯èƒ½å’Œå®¢æˆ·ç«¯æ—§ç‰ˆæœ¬ä¸å…¼å®¹ã€‚å› æ­¤åœ¨å‡çº§å®¢æˆ·ç«¯ä¹‹å‰ï¼Œå…ˆå‡çº§kafkaé›†ç¾¤ã€‚å¦‚æœä½ ä½¿ç”¨MirrorMakerä¸‹æ¸¸é›†ç¾¤ï¼Œåˆ™åŒæ ·åº”é¦–å…ˆå‡çº§ã€‚</p>
<p><img src="https://blogs.apache.org/hbase/mediaresource/0b77f435-da5c-4696-a1b5-f35bc4139b7b" alt=""></p>
<a id="more"></a>
<h3 id="æ»šåŠ¨å‡çº§"><a href="#æ»šåŠ¨å‡çº§" class="headerlink" title="æ»šåŠ¨å‡çº§"></a>æ»šåŠ¨å‡çº§</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">å‡çº§æ‰€æœ‰brokerçš„server<span class="selector-class">.properties</span>,å¹¶åœ¨å…¶ä¸­æ·»åŠ </div><div class="line">inter<span class="selector-class">.broker</span><span class="selector-class">.protocol</span><span class="selector-class">.version</span> = <span class="number">0.8</span>.<span class="number">2</span><span class="selector-class">.X</span></div><div class="line">æ¯æ¬¡å‡çº§ä¸€ä¸ªbrokerï¼šå…³é—­brokerï¼Œæ›¿æ¢æ–°ç‰ˆæœ¬ï¼Œç„¶åé‡æ–°å¯åŠ¨ã€‚</div></pre></td></tr></table></figure>
<h3 id="ç¾¤é›†å‡çº§"><a href="#ç¾¤é›†å‡çº§" class="headerlink" title="ç¾¤é›†å‡çº§"></a>ç¾¤é›†å‡çº§</h3><p>ä¸€æ—¦æ•´ä¸ªç¾¤é›†å‡çº§ï¼Œé€šè¿‡ç¼–è¾‘inter.broker.protocol.versionå¹¶å°†å…¶è®¾ç½®ä¸º0.9.0.0æ¥è½¬æ¢æ‰€æœ‰åè®®ã€‚<br>é€ä¸ªé‡æ–°å¯åŠ¨brokerï¼Œä½¿æ–°åè®®ç‰ˆæœ¬ç”Ÿæ•ˆã€‚<br>æ³¨æ„ ï¼šå¦‚æœä½ å¯æ¥å—åœæœºï¼Œä½ å¯ä»¥ç®€å•åœ°å°†æ‰€æœ‰brokerå…³é—­ï¼Œæ›´æ–°ç‰ˆæœ¬å¹¶é‡å¯å¯åŠ¨ï¼Œåè®®å°†é»˜è®¤ä»æ–°ç‰ˆæœ¬å¼€å§‹ã€‚<br>æ³¨æ„ ï¼šå˜æ¢åè®®ç‰ˆæœ¬å’Œé‡å¯å¯åŠ¨å¯ä»¥åœ¨brokerå‡çº§å®Œæˆåçš„ä»»ä½•æ—¶é—´å»åšï¼Œä¸å¿…é©¬ä¸Šåšã€‚</p>
<h4 id="0-9-0-0æ½œåœ¨çš„ä¸­æ–­å˜åŒ–"><a href="#0-9-0-0æ½œåœ¨çš„ä¸­æ–­å˜åŒ–" class="headerlink" title="0.9.0.0æ½œåœ¨çš„ä¸­æ–­å˜åŒ–"></a>0.9.0.0æ½œåœ¨çš„ä¸­æ–­å˜åŒ–</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">Java 1.6ä¸å†æ”¯æŒï¼Œéœ€è¦Jdk1.7ç‰ˆæœ¬ä»¥ä¸Šã€‚</div><div class="line">Scala 2.9ä¸å†æ”¯æŒã€‚</div><div class="line"></div><div class="line">é»˜è®¤æƒ…å†µä¸‹ï¼Œ1000ä»¥ä¸Šçš„Broker IDä¸ºè‡ªåŠ¨åˆ†é…ã€‚å¦‚æœä½ çš„é›†ç¾¤é«˜äºè¯¥é˜ˆå€¼ï¼Œéœ€ç›¸åº”åœ°å¢åŠ </div><div class="line">reserved.broker.max.idé…ç½®ã€‚</div><div class="line"></div><div class="line">replica.lag.max.messagesé…ç½®å·²ç»ç§»é™¤ã€‚åˆ†åŒºleaderåœ¨å†³å®šå“ªäº›å‰¯æœ¬å¤„äºåŒæ­¥æ—¶å°†ä¸å†è€ƒè™‘è½åçš„æ¶ˆæ¯çš„æ•°ã€‚</div><div class="line"></div><div class="line">é…ç½®å‚æ•°replica.lag.time.max.msç°åœ¨ä¸ä»…æŒ‡è‡ªä¸Šæ¬¡ä»å‰¯æœ¬è·å–è¯·æ±‚åç»è¿‡çš„æ—¶é—´ï¼Œè¿˜æŒ‡è‡ªå‰¯æœ¬ä¸Šæ¬¡è¢«æ•è·ä»¥æ¥çš„æ—¶é—´ã€‚ å‰¯æœ¬ä»ç„¶ä»leaderè·å–æ¶ˆæ¯ï¼Œä½†è¶…è¿‡replica.lag.time.max.msé…ç½®çš„æœ€æ–°æ¶ˆæ¯å°†è¢«è®¤ä¸ºä¸åŒæ­¥çš„ã€‚</div><div class="line"></div><div class="line">å‹ç¼©çš„topicä¸å†æ¥å—æ²¡æœ‰keyçš„æ¶ˆæ¯ï¼Œå¦‚æœå‡ºç°ï¼Œç”Ÿäº§è€…å°†æŠ›å‡ºå¼‚å¸¸ã€‚ åœ¨0.8.xä¸­ï¼Œæ²¡æœ‰keyçš„æ¶ˆæ¯å°†å¯¼è‡´æ—¥å¿—å‹ç¼©çº¿ç¨‹é€€å‡ºï¼ˆå¹¶åœæ­¢æ‰€æœ‰å‹ç¼©çš„topicï¼‰ã€‚</div><div class="line"></div><div class="line">MirrorMakerä¸å†æ”¯æŒå¤šä¸ªç›®æ ‡é›†ç¾¤ã€‚ å®ƒåªæ¥å—ä¸€ä¸ª--consumer.configã€‚ è¦é•œåƒå¤šä¸ªæºé›†ç¾¤ï¼Œæ¯ä¸ªæºé›†ç¾¤è‡³å°‘éœ€è¦ä¸€ä¸ªMirrorMakerå®ä¾‹ï¼Œæ¯ä¸ªæºé›†ç¾¤éƒ½æœ‰è‡ªå·±çš„æ¶ˆè´¹è€…é…ç½®ã€‚</div><div class="line"></div><div class="line">åœ¨org.apache.kafka.clients.toolsã€‚åŒ…ä¸‹çš„Toolså·²ç§»è‡³org.apache.kafka.toolsã€‚ã€‚ æ‰€æœ‰åŒ…å«çš„è„šæœ¬ä»å°†ç…§å¸¸å·¥ä½œï¼Œåªæœ‰ç›´æ¥å¯¼å…¥è¿™äº›ç±»çš„è‡ªå®šä¹‰ä»£ç å°†å—åˆ°å½±å“ã€‚</div><div class="line"></div><div class="line">åœ¨kafka-run-class.shä¸­æ›´æ”¹äº†é»˜è®¤çš„Kafka JVMæ€§èƒ½é€‰é¡¹ï¼ˆKAFKA_JVM_PERFORMANCE_OPTSï¼‰ã€‚</div><div class="line"></div><div class="line">kafka-topics.shè„šæœ¬ï¼ˆkafka.admin.TopicCommandï¼‰ç°åœ¨é€€å‡ºï¼Œå¤±è´¥æ—¶å‡ºç°éé›¶é€€å‡ºä»£ç ã€‚</div><div class="line"></div><div class="line">kafka-topics.shè„šæœ¬ï¼ˆkafka.admin.TopicCommandï¼‰ç°åœ¨å°†åœ¨topicåç§°ç”±äºä½¿ç”¨â€œ.â€æˆ–â€œ_â€è€Œå¯¼è‡´é£é™©åº¦é‡æ ‡å‡†å†²çªæ—¶æ‰“å°è­¦å‘Šã€‚ä»¥åŠå†²çªçš„æƒ…å†µä¸‹çš„é”™è¯¯ã€‚</div><div class="line"></div><div class="line">kafka-console-producer.shè„šæœ¬ï¼ˆkafka.tools.ConsoleProducerï¼‰å°†é»˜è®¤ä½¿ç”¨æ–°çš„Java Producerï¼Œç”¨æˆ·å¿…é¡»æŒ‡å®šâ€œold-producerâ€æ‰èƒ½ä½¿ç”¨æ—§ç”Ÿäº§è€…ã€‚</div><div class="line">é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰å‘½ä»¤è¡Œå·¥å…·éƒ½ä¼šå°†æ‰€æœ‰æ—¥å¿—æ¶ˆæ¯æ‰“å°åˆ°stderrè€Œä¸æ˜¯stdoutã€‚</div></pre></td></tr></table></figure>
<h4 id="0-9-0-1ä¸­çš„æ˜¾è‘—å˜åŒ–"><a href="#0-9-0-1ä¸­çš„æ˜¾è‘—å˜åŒ–" class="headerlink" title="0.9.0.1ä¸­çš„æ˜¾è‘—å˜åŒ–"></a>0.9.0.1ä¸­çš„æ˜¾è‘—å˜åŒ–</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">å¯ä»¥é€šè¿‡å°†broker.id.generation.enableè®¾ç½®ä¸º<span class="literal">false</span>æ¥ç¦ç”¨æ–°çš„broker IDç”ŸæˆåŠŸèƒ½ã€‚</div><div class="line"></div><div class="line">é»˜è®¤æƒ…å†µä¸‹ï¼Œé…ç½®å‚æ•°log.cleaner.enableä¸º<span class="literal">true</span>ã€‚ è¿™æ„å‘³ç€topicä¼šæ¸…ç†ã€‚</div><div class="line">policy = compactç°åœ¨å°†è¢«é»˜è®¤å‹ç¼©ï¼Œå¹¶ä¸”128MBçš„å †ï¼ˆé€šè¿‡log.cleaner.dedupe.buffer.sizeï¼‰åˆ†é…ç»™æ¸…æ´—è¿›ç¨‹ã€‚ä½ å¯èƒ½éœ€è¦æ ¹æ®ä½ å¯¹å‹ç¼©topicçš„ä½¿ç”¨æƒ…å†µï¼ŒæŸ¥çœ‹log.cleaner.dedupe.buffer.sizeå’Œå…¶ä»–log.cleaneré…ç½®å€¼ã€‚</div><div class="line"></div><div class="line">é»˜è®¤æƒ…å†µä¸‹ï¼Œæ–°æ¶ˆè´¹è€…çš„é…ç½®å‚æ•°fetch.min.bytesçš„é»˜è®¤å€¼ä¸º1ã€‚</div></pre></td></tr></table></figure>
<h4 id="0-9-0-0å¼ƒç”¨çš„"><a href="#0-9-0-0å¼ƒç”¨çš„" class="headerlink" title="0.9.0.0å¼ƒç”¨çš„"></a>0.9.0.0å¼ƒç”¨çš„</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">kafka-topics.shè„šæœ¬çš„å˜æ›´topicé…ç½®å·²å¼ƒç”¨ï¼ˆkafka.admin.ConfigCommandï¼‰ï¼Œä»¥åå°†ä½¿ç”¨kafka-configs.sh(kafka.admin.ConfigCommand) ã€‚</div><div class="line"></div><div class="line">kafka-consumer-offset-checker.sh(kafka.tools.ConsumerOffsetChecker)å·²å¼ƒç”¨ï¼Œä»¥åå°†ä½¿ç”¨kafka-consumer-groups.sh (kafka.admin.ConsumerGroupCommand)</div><div class="line"></div><div class="line">kafka.tools.ProducerPerformanceå·²å¼ƒç”¨ã€‚ä»¥åå°†ä½¿ç”¨org.apache.kafka.tools.ProducerPerformanceï¼ˆkafka-producer-perf-test.shä¹Ÿå°†ä½¿ç”¨æ–°ç±»ï¼‰</div><div class="line"></div><div class="line">ç”Ÿäº§è€…çš„block.on.buffer.fullå·²å¼ƒç”¨ï¼Œå¹¶å°†åœ¨ä»¥åçš„ç‰ˆæœ¬ä¸­ç§»é™¤ã€‚ç›®å‰å…¶é»˜è®¤å·²ç»æ›´ä¸º<span class="literal">false</span>ã€‚KafkaProducerå°†ä¸å†æŠ›å‡ºBufferExhaustedExceptionï¼Œè€Œæ˜¯ä½¿ç”¨max.block.msæ¥ä¸­æ­¢ï¼Œä¹‹åå°†æŠ›å‡ºTimeoutExceptionã€‚å¦‚æœblock.on.buffer.fullå±æ€§æ˜ç¡®åœ°è®¾ç½®ä¸º<span class="literal">true</span>ï¼Œå®ƒå°†è®¾ç½®max.block.msä¸ºLong.MAX_VALUEå’Œmetadata.fetch.timeout.mså°†ä¸æ‰§è¡Œã€‚</div></pre></td></tr></table></figure>
<h4 id="å‡çº§å‡†å¤‡æ­¥éª¤ï¼š"><a href="#å‡çº§å‡†å¤‡æ­¥éª¤ï¼š" class="headerlink" title="å‡çº§å‡†å¤‡æ­¥éª¤ï¼š"></a>å‡çº§å‡†å¤‡æ­¥éª¤ï¼š</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div></pre></td><td class="code"><pre><div class="line">ï¼ˆ0ï¼‰</div><div class="line">wget http://mirror.bit.edu.cn/apache/kafka/0.9.0.1/kafka_2.10-0.9.0.1.tgz</div><div class="line">tar -xvf kafka_2.10-0.9.0.1.tgz</div><div class="line"></div><div class="line">[jollybi@kafka1 tools]$ ll</div><div class="line">total 88100</div><div class="line">drwxr-xr-x  7 jollybi jollybi     4096 Jul 14 13:07 kafka_2.10-0.8.2.1</div><div class="line">-rw-rw-r--  1 jollybi jollybi 16162559 Jul 14 11:40 kafka_2.10-0.8.2.1.tgz</div><div class="line">drwxr-xr-x  6 jollybi jollybi     4096 Feb 12  2016 kafka_2.10-0.9.0.1</div><div class="line">-rw-rw-r--  1 jollybi jollybi 35725063 Jun 20 20:11 kafka_2.10-0.9.0.1.tgz</div><div class="line">drwxr-xr-x 12 jollybi jollybi     4096 Sep 25 16:41 zookeeper-3.4.5</div><div class="line">-rw-rw-r--  1 jollybi jollybi 38307840 Jul 14 11:40 zookeeper-3.4.5.tar</div><div class="line"></div><div class="line">[jollybi@kafka1 tools]$ mkdir -p /data/tools/kafka_2.10-0.9.0.1/kafka-logs</div><div class="line">[jollybi@kafka1 tools]$ mkdir -p /data/tools/kafka_2.10-0.9.0.1/logs</div><div class="line"></div><div class="line"><span class="comment">###ä¿®æ”¹é…ç½®ï¼š</span></div><div class="line"></div><div class="line">(1)</div><div class="line">[jollybi@kafka1 tools]$ vim kafka_2.10-0.9.0.1/config/zookeeper.properties</div><div class="line">ç¬¬ä¸€æ­¥ä¿®æ”¹:</div><div class="line"><span class="comment"># the directory where the snapshot is stored.</span></div><div class="line">dataDir=dataDir=/data/jollybi/tools/zookeeper-3.4.5/tmp</div><div class="line"><span class="comment"># the port at which the clients will connect</span></div><div class="line">clientPort=2281</div><div class="line"><span class="comment"># disable the per-ip limit on the number of connections since this is a non-production config</span></div><div class="line">maxClientCnxns=0</div><div class="line">dataDir,clientPortçš„æ„ä¹‰ä¸éœ€è¦è¯´æ˜äº†ï¼Œå¯¹äºmaxClientCnxnsé€‰é¡¹ï¼Œå¦‚æœä¸è®¾ç½®æˆ–è€…è®¾ç½®ä¸º0ï¼Œåˆ™æ¯ä¸ªipè¿æ¥zookeeperæ—¶çš„è¿æ¥æ•°æ²¡æœ‰é™åˆ¶ã€‚</div><div class="line">éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè®¾ç½®maxClientCnxnsçš„å€¼æ—¶éœ€è¦æŠŠkafka serverçš„è¿æ¥æ•°è€ƒè™‘è¿›å»ï¼Œå› ä¸ºå¯åŠ¨kafka serveræ—¶ï¼Œkafka serverä¹Ÿä¼šè¿æ¥zookeeperçš„ã€‚</div><div class="line"></div><div class="line">(2)</div><div class="line">[jollybi@kafka1 tools]$ vim kafka_2.10-0.9.0.1/config/consumer.properties</div><div class="line">zookeeper.connect=10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281</div><div class="line">å…¶ä»–å‚æ•°æ ¹æ®ä¸åŒé›†ç¾¤ç¯å¢ƒè°ƒæ•´</div><div class="line"></div><div class="line">(3)</div><div class="line">[jollybi@kafka1 tools]$ vim kafka_2.10-0.9.0.1/config/producer.properties (ä¿®æ”¹å†…ç½‘IP)</div><div class="line">metadata.broker.list=10.155.90.153:9292,10.155.90.155:9292,10.155.90.138:9292</div><div class="line">producer.type=sync</div><div class="line">compression.codec=none</div><div class="line">serializer.class=kafka.serializer.DefaultEncoder</div><div class="line">å…¶ä»–å‚æ•°æ ¹æ®ä¸åŒé›†ç¾¤ç¯å¢ƒè°ƒæ•´</div><div class="line"></div><div class="line">(4) </div><div class="line">[jollybi@kafka1 config]$ cat server.properties | grep -Pv <span class="string">"^#|^$"</span></div><div class="line">broker.id=1</div><div class="line">auto.leader.rebalance.enable = <span class="literal">true</span></div><div class="line">listeners=PLAINTEXT://10.155.90.153:9292</div><div class="line">port=9292</div><div class="line">host.name=10.155.90.153</div><div class="line">zookeeper.connect=10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281</div><div class="line">zookeeper.connection.timeout.ms=6000</div><div class="line">num.network.threads=3</div><div class="line">num.io.threads=8</div><div class="line">socket.send.buffer.bytes=102400</div><div class="line">socket.receive.buffer.bytes=102400</div><div class="line">socket.request.max.bytes=104857600</div><div class="line">log.dirs=/data/tools/kafka_2.10-0.9.0.1/kafka-logs</div><div class="line">log.cleaner.enable=<span class="literal">true</span></div><div class="line">delete.topic.enable=<span class="literal">true</span></div><div class="line">num.partitions=1</div><div class="line">num.recovery.threads.per.data.dir=1</div><div class="line">log.retention.hours=96</div><div class="line">log.segment.bytes=1073741824</div><div class="line">log.retention.check.interval.ms=300000</div><div class="line"></div><div class="line">å¤‡æ³¨ï¼šlistenersä¸€å®šè¦é…ç½®æˆä¸ºIPåœ°å€ï¼›å¦‚æœé…ç½®ä¸ºlocalhostæˆ–æœåŠ¡å™¨çš„hostname,åœ¨ä½¿ç”¨javaå‘é€æ•°æ®æ—¶å°±ä¼šæŠ›å‡ºå¼‚ å¸¸ï¼šorg.apache.kafka.common.errors.TimeoutException: Batch Expired ã€‚å› ä¸ºåœ¨æ²¡æœ‰é…ç½®advertised.host.name çš„æƒ…å†µä¸‹ï¼ŒKafkaå¹¶æ²¡æœ‰åƒå®˜æ–¹æ–‡æ¡£å®£ç§°çš„é‚£æ ·æ”¹ä¸ºå¹¿æ’­æˆ‘ä»¬é…ç½®çš„hostnameï¼Œè€Œæ˜¯å¹¿æ’­äº†ä¸»æœºé…ç½®çš„hostnameã€‚è¿œç«¯çš„å®¢æˆ·ç«¯å¹¶æ²¡æœ‰é…ç½® hostsï¼Œæ‰€ä»¥è‡ªç„¶æ˜¯è¿æ¥ä¸ä¸Šè¿™ä¸ªhostnameçš„</div></pre></td></tr></table></figure>
<h4 id="kafkaä¸zkå†…å­˜æ—¥å¿—ä¼˜åŒ–"><a href="#kafkaä¸zkå†…å­˜æ—¥å¿—ä¼˜åŒ–" class="headerlink" title="kafkaä¸zkå†…å­˜æ—¥å¿—ä¼˜åŒ–"></a>kafkaä¸zkå†…å­˜æ—¥å¿—ä¼˜åŒ–</h4><p>æˆ‘ä¸ªäººåšå®¢æœ‰å†™ä¼˜åŒ–æ–‡æ¡£<br><a href="http://blog.yancy.cc/2017/08/27/Bigdata-hadoop/zookeeper/Bigdata-Zookeeper%E9%9B%86%E7%BE%A4%E6%97%A5%E5%BF%97%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3%E5%92%8C%E6%B8%85%E7%90%86%E8%87%AA%E5%AE%9A%E4%B9%89%E5%90%AF%E5%8A%A8%E5%86%85%E5%AD%98%20/">Bigdata-Zookeeperé›†ç¾¤æ—¥å¿—é…ç½®è¯¦è§£å’Œæ¸…ç†è‡ªå®šä¹‰å¯åŠ¨å†…å­˜</a><br><a href="http://blog.yancy.cc/2017/07/04/Bigdata-hadoop/Kafka/kafka%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E2%80%93JVM%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE%E4%BC%98%E5%8C%96/">Kafkaæ€§èƒ½ä¼˜åŒ–â€“JVMå‚æ•°é…ç½®ä¼˜åŒ–</a><br><a href="http://blog.yancy.cc/2017/03/30/Bigdata-hadoop/Kafka/Kafka%E6%97%A5%E5%BF%97%E5%AD%98%E5%82%A8%E8%A7%A3%E6%9E%90%E4%B8%8E%E5%AE%9E%E8%B7%B5%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E4%BC%98%E5%8C%96/">Kafkaæ—¥å¿—å­˜å‚¨è§£æä¸å®è·µæ•°æ®å­˜å‚¨ä¼˜åŒ–</a></p>
<h4 id="å‡çº§æ­¥éª¤æ–¹æ¡ˆï¼š"><a href="#å‡çº§æ­¥éª¤æ–¹æ¡ˆï¼š" class="headerlink" title="å‡çº§æ­¥éª¤æ–¹æ¡ˆï¼š"></a>å‡çº§æ­¥éª¤æ–¹æ¡ˆï¼š</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">(0) mongodb èƒ½å­˜å‚¨æ—¶é—´æˆ³4ä¸ªå°æ—¶çš„æ•°æ®ï¼Œåœ¨4ä¸ªå°æ—¶ä¹‹å†…å‡çº§ä¸ä¼šæœ‰é£é™©ã€‚</div><div class="line">(1) mongotail å…ˆåœæ­¢ç”Ÿäº§å†™å…¥æ•°æ®åˆ°kafka</div><div class="line">(2) kafka æ¶ˆè´¹ç»„ç»§ç»­æ¶ˆè´¹ topicåˆ†åŒºæŸ¥çœ‹æ¶ˆè´¹ä¸ºé›¶ã€‚</div><div class="line">(3) zkéœ€è¦å‡çº§3.4.6ç‰ˆæœ¬å¯¹åº”kafka0.9.1ç‰ˆæœ¬ï¼Œå¦‚æœzkä¸éœ€è¦å‡çº§ï¼Œå‡çº§ä¹‹å‰è¦å…ˆå°†ZooKeeperä¸­åŸç‰ˆæœ¬çš„kafkaç”Ÿæˆçš„znodeåˆ é™¤ï¼ŒåŒ…æ‹¬ï¼šconsumers, controller, brokers, controller_epochç­‰ã€‚å¦åˆ™å¯åŠ¨kafkaä¼šæŠ¥é”™ã€‚</div><div class="line">(4) é‡å¯æ–°ç‰ˆæœ¬zké›†ç¾¤ï¼ŒæŸ¥çœ‹é›†ç¾¤æœåŠ¡é€‰ä¸¾æ˜¯å¦æ­£å¸¸ã€‚</div><div class="line">(5) é‡å¯æ–°ç‰ˆæœ¬kafkaé›†ç¾¤ï¼Œé‡å¯æ²¡æœ‰æŠ¥é”™ï¼ŒæŸ¥çœ‹ç‰ˆæœ¬æ²¡é—®é¢˜å°±è¡Œã€‚</div><div class="line">(6) zkä¸Šé¢æŸ¥çœ‹å‘½ä»¤</div><div class="line"> ./zkCli.sh -server 10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281</div><div class="line">[zk: 10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281(CONNECTED) 0] ls /</div><div class="line"></div><div class="line">controller_epoch          controller                brokers                   zookeeper                 kafka-manager             admin                     isr_change_notification   consumers                 config</div><div class="line">[zk: 10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281(CONNECTED) 0] ls /brokers/ids</div><div class="line">[1, 2, 3]  </div><div class="line">é›†ç¾¤ä¸‰ä¸ªbrokers idæ­£å¸¸</div><div class="line">(7)ä¿®æ”¹ç›‘æ§æŒ‡æ ‡ã€‚ å®Œæˆå‡çº§</div><div class="line"></div><div class="line">(8) å¦å¤–ï¼Œæ–°ç‰ˆæœ¬çš„ä¸€äº›å‘½ä»¤ä¸åŸç‰ˆæœ¬çš„æœ‰äº›ç›¸åŒ,å¢åˆ æ”¹æŸ¥å‘½ä»¤ã€‚</div></pre></td></tr></table></figure>
<h4 id="å¼€å§‹å‡çº§æ­¥éª¤æ“ä½œï¼š"><a href="#å¼€å§‹å‡çº§æ­¥éª¤æ“ä½œï¼š" class="headerlink" title="å¼€å§‹å‡çº§æ­¥éª¤æ“ä½œï¼š"></a>å¼€å§‹å‡çº§æ­¥éª¤æ“ä½œï¼š</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">ï¼ˆ1)å¯åŠ¨zkä¸kafka</div><div class="line"><span class="comment"># /data/tools/zookeeper-3.4.6/bin/zkServer.sh start</span></div><div class="line"><span class="comment"># /data/tools/kafka_2.10-0.9.0.1/bin/kafka-server-start.sh /data/tools/ kafka_2.10-0.9.0.1/config/server.properties &amp;</span></div><div class="line"></div><div class="line">ï¼ˆ2ï¼‰æ–°å»ºtopic</div><div class="line"><span class="comment">#./bin/kafka-topics.sh --create --zookeeper 10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281 --replication-factor 3 --partitions 12  --topic mongotail_lz4_imp </span></div><div class="line"><span class="comment">#./bin/kafka-topics.sh --create --zookeeper 10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281 --replication-factor 3 --partitions 12  --topic mongotail_lz4</span></div><div class="line"></div><div class="line">(3) æŸ¥çœ‹é›†ç¾¤topicåˆ†åŒºæƒ…å†µ</div><div class="line"><span class="comment">#./bin/kafka-topics.sh  --describe --zookeeper 10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281 --topic mongotail_lz4</span></div><div class="line"></div><div class="line">(4) æ›´æ–°æ‰€æœ‰å¼€æºç›‘æ§ï¼ˆKafkaOffsetMonitorï¼‰</div><div class="line">vim /home/jollybi/./monitor/monitor.sh</div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line">java -Xms512M -Xmx512M -Xss1024K -XX:PermSize=256m -XX:MaxPermSize=512m -cp KafkaOffsetMonitor-assembly-0.2.0_modify.jar com.quantifind.kafka.offsetapp.OffsetGetterWeb --zk 10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281 --port 8086  --refresh 10.seconds  --retain 7.days &gt;/tmp/stdout.log 2&gt;&amp;1 &amp;</div><div class="line"></div><div class="line">zkåœ°å€ä¿®æ”¹æˆå†…ç½‘åœ°å€ è¿™é‡Œçš„æ•°æ®å­˜å‚¨7å¤©ã€‚</div><div class="line">é‡å¯æœåŠ¡ï¼š</div><div class="line">./monitor/monitor.sh &amp;</div><div class="line"></div><div class="line">ï¼ˆ5ï¼‰æ›´æ–°å¼€æºç›‘æ§ï¼ˆkafka-managerï¼‰</div><div class="line">vim kafka-manager-1.3.3.8/conf/application.conf</div><div class="line">kafka-manager.zkhosts=<span class="string">"10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281"</span></div><div class="line">zkåœ°å€ä¿®æ”¹æˆå†…ç½‘åœ°å€.</div><div class="line"></div><div class="line">é‡å¯æœåŠ¡ï¼š</div><div class="line">./kafka-manager-1.3.3.8/bin/kafka-manager -Dconfig.file=kafka-manager-1.3.3.8/conf/application.conf -Dhttp.port=8080 &amp;</div><div class="line"></div><div class="line">ï¼ˆ6ï¼‰æ›´æ–°å¼€æºç›‘æ§ï¼ˆzabbixï¼‰è‡ªå·±å†™çš„ç›‘æ§è„šæœ¬</div><div class="line"></div><div class="line">[jollybi@kafka1 ~]$ /data/tools/kafka_2.10-0.9.0.1/bin/kafka-run-class.sh kafka.tools.ConsumerOffsetChecker --zookeepe 10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281 --group group_ml --topic mongotail_lz4</div><div class="line">[2017-10-31 14:05:24,390] WARN WARNING: ConsumerOffsetChecker is deprecated and will be dropped <span class="keyword">in</span> releases following 0.9.0. Use ConsumerGroupCommand instead. (kafka.tools.ConsumerOffsetChecker$)</div><div class="line">Group           Topic                          Pid Offset          <span class="built_in">log</span>Size         Lag             Owner</div><div class="line">group_ml        mongotail_lz4                  0   1205186         1205257         71              group_ml_Graphsql-test.jollychic.com-1509421110787-1daec53a-0</div><div class="line">group_ml        mongotail_lz4                  1   1206860         1206915         55              group_ml_Graphsql-test.jollychic.com-1509421110787-1daec53a-0</div><div class="line">....</div><div class="line">è¿è¡Œä¼šå‡ºç°WARNè­¦å‘Šï¼Œ0.9ç‰ˆæœ¬æ›´æ–°è¿‡äº†ï¼Œ</div><div class="line"></div><div class="line">æ³¨æ„ï¼šåœ¨0.9.0.0ï¼Œkafka.tools.ConsumerOffsetCheckerå·²ç»ä¸æ”¯æŒäº†ã€‚ä½ åº”è¯¥ä½¿ç”¨kafka.admin.ConsumerGroupCommand(æˆ–bin/kafka-consumer-groups.shè„šæœ¬)æ¥ç®¡ç†æ¶ˆè´¹è€…ç»„ï¼ŒåŒ…æ‹¬ç”¨æ–°æ¶ˆè´¹è€…APIåˆ›å»ºçš„æ¶ˆè´¹è€…ã€‚</div><div class="line"></div><div class="line">è¿™é‡Œä½¿ç”¨kafka.admin.ConsumerGroupCommand æç¤ºå‘½ä»¤ä¸å¯¹ï¼Œç°åœ¨åœ¨ç ”ç©¶ä½¿ç”¨ã€‚ </div><div class="line">ç›‘æ§è„šæœ¬ è¾“å‡ºä¼šæœ‰æç¤ºç›´æ¥è¿‡æ»¤æ‰å³å¯ã€‚</div><div class="line"><span class="keyword">function</span> wlj_event_lag &#123;</div><div class="line"><span class="built_in">echo</span> <span class="string">"`sh /etc/zabbix/kafka_topic_monitor.sh 2&gt;/dev/null |  sed -n  '3p'`"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ğŸ‰ kafkaå‡çº§ï¼Œè°ƒé…å†…ç½‘è®¿é—®åœ°å€ï¼Œå†…å­˜ï¼Œæ—¥å¿—è¾“å‡ºç±»å‹è°ƒä¼˜ï¼Œç›‘æ§æ›´æ–°é…ç½®ã€‚<br>ğŸ‰ å‚è€ƒå®˜ç½‘æ–‡æ¡£ <a href="https://kafka.apache.org/0101/documentation.html#upgrade_9" target="_blank" rel="external">Apache Kafka ä» 0.8.0, 0.8.1.X æˆ– 0.8.2.X å‡çº§åˆ° 0.9.0.0</a></p>
<h3 id="Communicative-learning"><a href="#Communicative-learning" class="headerlink" title="Communicative learning:"></a>Communicative learning:</h3><p>ğŸ§  Linux shell_ senior operation and maintenance faction: QQ group <code>459096184</code> circle (system operation and maintenance - application operation and maintenance - automation operation and maintenance - virtualization technology research, welcome to join)<br>ğŸ§  BigData-Exchange School:QQ group <code>521621407</code> circles (big data Yun Wei) (Hadoop developer) (big data research enthusiasts) welcome to join</p>
<p>Bidata have internal WeChat exchange group, learn from each other, join QQ group has links.</p>

        </div>
        <br><br>
        <div>
            <p>
                     
                    <span class="badge badge-default">#&nbsp;Kafka</span>
                    &nbsp;
                    
            </p>
        </div>
    </div>
    <!-- TOC -->
    
        <div class="col-md-3">
            <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#æ»šåŠ¨å‡çº§"><span class="toc-text">æ»šåŠ¨å‡çº§</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ç¾¤é›†å‡çº§"><span class="toc-text">ç¾¤é›†å‡çº§</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#0-9-0-0æ½œåœ¨çš„ä¸­æ–­å˜åŒ–"><span class="toc-text">0.9.0.0æ½œåœ¨çš„ä¸­æ–­å˜åŒ–</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0-9-0-1ä¸­çš„æ˜¾è‘—å˜åŒ–"><span class="toc-text">0.9.0.1ä¸­çš„æ˜¾è‘—å˜åŒ–</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0-9-0-0å¼ƒç”¨çš„"><span class="toc-text">0.9.0.0å¼ƒç”¨çš„</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#å‡çº§å‡†å¤‡æ­¥éª¤ï¼š"><span class="toc-text">å‡çº§å‡†å¤‡æ­¥éª¤ï¼š</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#kafkaä¸zkå†…å­˜æ—¥å¿—ä¼˜åŒ–"><span class="toc-text">kafkaä¸zkå†…å­˜æ—¥å¿—ä¼˜åŒ–</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#å‡çº§æ­¥éª¤æ–¹æ¡ˆï¼š"><span class="toc-text">å‡çº§æ­¥éª¤æ–¹æ¡ˆï¼š</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#å¼€å§‹å‡çº§æ­¥éª¤æ“ä½œï¼š"><span class="toc-text">å¼€å§‹å‡çº§æ­¥éª¤æ“ä½œï¼š</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Communicative-learning"><span class="toc-text">Communicative learning:</span></a></li></ol>
        </div>
    
</div>

<!-- Comments -->
<div class="row">
    <div class="col-md-8 offset-md-2">
    
        
            <div class="disqus" style="width:100%">
    <div id="disqus_thread"></div>
    <script>               
        var disqus_shortname = 'null';
        var disqus_config = function () {
            this.page.url = 'http://blog.yancy.cc/2017/11/04/Bigdata-hadoop/Kafka/KafKaä»0.8.2.1å‡çº§åˆ°0.9.0.1å˜åŒ–æ–¹æ¡ˆä¸æ­¥éª¤/'; 
            this.page.identifier = '/2017/11/04/Bigdata-hadoop/Kafka/KafKaä»0.8.2.1å‡çº§åˆ°0.9.0.1å˜åŒ–æ–¹æ¡ˆä¸æ­¥éª¤/';
        };
        (function() { 
            var d = document, s = d.createElement('script');
            s.type = 'text/javascript';
            s.src = '//'+disqus_shortname+'.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>                                
</div>
        
    
    </div>
</div>
      </div>
    </div>
  </div>


<footer class="footer footer-default">
        <div class="container">
          <nav class="float-left">
              <b>å¤šå–çƒ­æ°´</b>
          </nav>
          <div class="copyright float-right">
            &copy;
            <script>
              document.write(new Date().getFullYear())
            </script>&nbsp;<a href="https://hexo.io/zh-cn/" target="_blank">HEXO</a>&nbsp;<i class="material-icons">favorite_border</i>
            <a href="https://github.com/invom/Material-T" target="_blank">Material-T</a>
          </div>
        </div>
</footer>
      <!--   Core JS Files   -->
      <script src="/js/core/jquery.min.js"></script>
      
        <script src="/js/main.js"></script>
       
      <script src="/js/core/popper.min.js"></script>
      <script src="/js/core/bootstrap-material-design.min.js"></script>
      <script src="/js/plugins/moment.min.js"></script>
      <!--	Plugin for the Datepicker, full documentation here: https://github.com/Eonasdan/bootstrap-datetimepicker -->
      <!-- <script src="/js/plugins/bootstrap-datetimepicker.js"></script> -->
      <!--  Plugin for the Sliders, full documentation here: http://refreshless.com/nouislider/ -->
      <script src="/js/plugins/nouislider.min.js"></script>
      <!-- Control Center for Material Kit: parallax effects, scripts for the example pages etc -->
      <script src="/js/material-kit.min.js?v=2.0.5"></script>
      
      
        <script src="/js/plugins/prettify.js"></script>
        <script>
            $(window).on('load',function(){
                $('pre').addClass('prettyprint linenums');
                prettyPrint();
            })
        </script>
        
          
        
      
</body>
</html>