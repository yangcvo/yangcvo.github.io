<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="theme-color" content="#33474d">
	<title>Bigdata-Zookeeperé›†ç¾¤æ—¥å¿—é…ç½®è¯¦è§£å’Œæ¸…ç†è‡ªå®šä¹‰å¯åŠ¨å†…å­˜ | Yancy&#39;s blog</title>
	<link rel="stylesheet" href="/css/style.css" />
	
      <link rel="alternate" href="/atom.xml" title="Yancy&#39;s blog" type="application/atom+xml">
    
</head>

<body>

	<header class="header">
		<nav class="header__nav">
			
				<a href="/" class="header__link">Home</a>
			
				<a href="/tags" class="header__link">Tags</a>
			
				<a href="/archives" class="header__link">ARCHIVES</a>
			
				<a href="/about/About" class="header__link">ABOUT</a>
			
				<a href="/atom.xml" class="header__link">RSS</a>
			
		</nav>
		<h1 class="header__title"><a href="/">Yancy&#39;s blog</a></h1>
		<h2 class="header__subtitle">SIMPLICITY IS PREREQUISITE FOR  RELIABILITY</h2>
	</header>

	<main>
		<article>
	
		<h1>Bigdata-Zookeeperé›†ç¾¤æ—¥å¿—é…ç½®è¯¦è§£å’Œæ¸…ç†è‡ªå®šä¹‰å¯åŠ¨å†…å­˜</h1>
	
	<div class="article__infos">
		<span class="article__date">2017-04-27</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/Bigdata/">Bigdata</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/ZooKeeper/">ZooKeeper</a>
			</span>
		
	</div>

	

	
		<h4 id="Zookeeperé›†ç¾¤æ—¥å¿—é…ç½®è¯¦è§£å’Œæ¸…ç†è‡ªå®šä¹‰å¯åŠ¨å†…å­˜"><a href="#Zookeeperé›†ç¾¤æ—¥å¿—é…ç½®è¯¦è§£å’Œæ¸…ç†è‡ªå®šä¹‰å¯åŠ¨å†…å­˜" class="headerlink" title="Zookeeperé›†ç¾¤æ—¥å¿—é…ç½®è¯¦è§£å’Œæ¸…ç†è‡ªå®šä¹‰å¯åŠ¨å†…å­˜"></a>Zookeeperé›†ç¾¤æ—¥å¿—é…ç½®è¯¦è§£å’Œæ¸…ç†è‡ªå®šä¹‰å¯åŠ¨å†…å­˜</h4><h3 id="é—®é¢˜ï¼š"><a href="#é—®é¢˜ï¼š" class="headerlink" title="é—®é¢˜ï¼š"></a>é—®é¢˜ï¼š</h3><p>æ­å»ºzookeeperå’Œkafkaé›†ç¾¤è¿è¡Œå¤§æ•°æ®å¤„ç†æ•°æ®æ¶ˆè´¹ï¼Œå…¬å¸dubboä½¿ç”¨zookeeperåšæœåŠ¡ç«¯çš„æœåŠ¡å‘ç°ç®¡ç†åŠé…ç½®ä¸­å¿ƒï¼Œåœ¨ä½¿ç”¨æ—¶éƒ½å‡ºç°è¿‡ç”±äºzkçš„æ—¥å¿—å¤§å°è¿‡å¤§å¡æ»¡ç£ç›˜çš„æƒ…å†µ ï¼Œé‡åˆ°äº†Zookeeperæ—¥å¿—é—®é¢˜è¾“å‡ºè·¯å¾„çš„é—®é¢˜, å‘ç°zookeeperè®¾ç½®log4j.propertiesä¸èƒ½è§£å†³æ—¥å¿—è·¯å¾„é—®é¢˜, å‘ç°è§£å†³æ–¹æ¡ˆå¦‚ä¸‹ã€‚</p>
<h3 id="zookeeperæ—¥å¿—è¯´æ˜"><a href="#zookeeperæ—¥å¿—è¯´æ˜" class="headerlink" title="zookeeperæ—¥å¿—è¯´æ˜"></a>zookeeperæ—¥å¿—è¯´æ˜</h3><p>ZooKeeperä½¿ç”¨<code>SLF4J(the Simple Logging Facade for Java)</code>ä½œä¸ºæ—¥å¿—çš„æŠ½è±¡å±‚ï¼Œé»˜è®¤ä½¿ç”¨<code>Log4J</code>æ¥åšå®é™…çš„æ—¥å¿—å·¥ä½œã€‚ä½¿ç”¨2å±‚æ—¥å¿—æŠ½è±¡çœ‹èµ·æ¥çœŸæ˜¯å¤Ÿå‘›ï¼Œè¿™é‡Œç®€è¦çš„è¯´æ˜å¦‚ä½•æ¥é…ç½®<code>Log4J</code>ã€‚å°½ç®¡Log4Jéå¸¸çµæ´»ä¸”å¼ºå¤§ï¼Œä½†å®ƒä¹Ÿæœ‰ä¸€äº›å¤æ‚ï¼Œå¯ä»¥ç”¨ä¸€æ•´æœ¬ä¹¦æ¥æè¿°å®ƒï¼Œè¿™é‡Œåªæ˜¯ç®€è¦çš„ä»‹ç»ä¸€ä¸‹åŸºæœ¬çš„ç”¨æ³•ã€‚</p>
<p>Log4Jçš„é…ç½®æ–‡ä»¶åä¸º<code>log4j.properties</code>ï¼Œä»classpathä¸­æŸ¥æ‰¾ã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°log4j.propertiesæ–‡ä»¶ï¼Œä¼šè¾“å‡ºå¦‚ä¸‹è­¦å‘Šä¿¡æ¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">log</span>4j:WARN No appenders could be found <span class="keyword">for</span> logger (org.apache.zookeeper.serv ...  </div><div class="line"><span class="built_in">log</span>4j:WARN Please initialize the <span class="built_in">log</span>4j system properly.</div></pre></td></tr></table></figure>
<p>å®ƒè¯´çš„æ˜¯æ‰€æœ‰åç»­çš„æ—¥å¿—æ¶ˆæ¯ä¼šè¢«ä¸¢å¼ƒï¼Œé€šå¸¸<code>log4j.properties</code>æ–‡ä»¶ä¼šæ”¾åœ¨<code>conf</code>æ–‡ä»¶å¤¹ï¼Œå¹¶æ”¾åœ¨<code>classpath</code>ä¸‹ã€‚<br>æ¥çœ‹çœ‹<code>ZooKeeper</code>ä½¿ç”¨çš„<code>log4j.properties</code>çš„ä¸»è¦éƒ¨åˆ†ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">[jollybi@kafka2 conf]$ cat <span class="built_in">log</span>4j.properties | grep -Pv <span class="string">"^$|^#"</span></div><div class="line">zookeeper.root.logger=INFO, CONSOLE  <span class="comment">#ï¼ˆ1ï¼‰</span></div><div class="line">zookeeper.console.threshold=INFO</div><div class="line">zookeeper.log.dir=.</div><div class="line">zookeeper.log.file=zookeeper.log</div><div class="line">zookeeper.log.threshold=DEBUG</div><div class="line">zookeeper.tracelog.dir=.                                                                     </div><div class="line">zookeeper.tracelog.file=zookeeper_trace.log</div><div class="line"><span class="built_in">log</span>4j.rootLogger=<span class="variable">$&#123;zookeeper.root.logger&#125;</span> <span class="comment">#ï¼ˆ2ï¼‰</span></div><div class="line"><span class="built_in">log</span>4j.appender.CONSOLE=org.apache.log4j.ConsoleAppender  <span class="comment">#ï¼ˆ3ï¼‰</span></div><div class="line"><span class="built_in">log</span>4j.appender.CONSOLE.Threshold=<span class="variable">$&#123;zookeeper.console.threshold&#125;</span> <span class="comment">#ï¼ˆ4ï¼‰</span></div><div class="line"><span class="built_in">log</span>4j.appender.CONSOLE.layout=org.apache.log4j.PatternLayout <span class="comment">#ï¼ˆ5ï¼‰</span></div><div class="line"><span class="built_in">log</span>4j.appender.CONSOLE.layout.ConversionPattern=%d&#123;ISO8601&#125; [myid:%X&#123;myid&#125;] - %-5p [%t:%C&#123;1&#125;@%L] - %m%n</div><div class="line"><span class="built_in">log</span>4j.appender.ROLLINGFILE=org.apache.log4j.RollingFileAppender <span class="comment">#ï¼ˆ6ï¼‰</span></div><div class="line"><span class="built_in">log</span>4j.appender.ROLLINGFILE.Threshold=<span class="variable">$&#123;zookeeper.log.threshold&#125;</span> <span class="comment">#ï¼ˆ7ï¼‰</span></div><div class="line"><span class="built_in">log</span>4j.appender.ROLLINGFILE.File=<span class="variable">$&#123;zookeeper.log.dir&#125;</span>/<span class="variable">$&#123;zookeeper.log.file&#125;</span></div><div class="line"><span class="built_in">log</span>4j.appender.ROLLINGFILE.MaxFileSize=10MB</div><div class="line"><span class="built_in">log</span>4j.appender.ROLLINGFILE.layout=org.apache.log4j.PatternLayout</div><div class="line"><span class="built_in">log</span>4j.appender.ROLLINGFILE.layout.ConversionPattern=%d&#123;ISO8601&#125; [myid:%X&#123;myid&#125;] - %-5p [%t:%C&#123;1&#125;@%L] - %m%n</div><div class="line"><span class="built_in">log</span>4j.appender.TRACEFILE=org.apache.log4j.FileAppender</div><div class="line"><span class="built_in">log</span>4j.appender.TRACEFILE.Threshold=TRACE</div><div class="line"><span class="built_in">log</span>4j.appender.TRACEFILE.File=<span class="variable">$&#123;zookeeper.tracelog.dir&#125;</span>/<span class="variable">$&#123;zookeeper.tracelog.file&#125;</span></div><div class="line"><span class="built_in">log</span>4j.appender.TRACEFILE.layout=org.apache.log4j.PatternLayout</div><div class="line"><span class="built_in">log</span>4j.appender.TRACEFILE.layout.ConversionPattern=%d&#123;ISO8601&#125; [myid:%X&#123;myid&#125;] - %-5p [%t:%C&#123;1&#125;@%L][%x] - %m%n</div></pre></td></tr></table></figure>
<ul>
<li><p>(1) <code>zookeeper.root.logger=INFO, CONSOLE</code><br>ç¬¬ä¸€ç»„è®¾ç½®ä»¥<code>zookeeper</code>å¼€å¤´ï¼Œå®ƒä»¬å®é™…ä¸Šæ˜¯<code>Java system property</code>ï¼Œå¯ä»¥è¢«<code>-D</code>å½¢å¼çš„å‘½ä»¤è¡Œå‚æ•°è¦†ç›–ã€‚<br>ç¬¬ä¸€è¡Œé…ç½®äº†æ—¥å¿—çº§åˆ«ï¼Œé»˜è®¤çš„è®¾ç½®æ˜¯è¯´åœ¨INFOçº§åˆ«ä»¥ä¸‹çš„æ—¥å¿—ä¼šè¢«ä¸¢å¼ƒï¼Œå¹¶ä¸”æ—¥å¿—ä¼šä½¿ç”¨<code>CONSOLE appender</code>è¾“å‡ºã€‚ä½ å¯ä»¥æŒ‡å®šå¤šä¸ª<code>appender</code>ï¼Œä¾‹å¦‚å¦‚æœä½ æƒ³ä½¿ç”¨<code>CONSOLE appender</code>å’Œ<code>ROLLINGFILE appender</code>è¾“å‡ºæ—¥å¿—ï¼Œé‚£ä¹ˆå¯ä»¥é…ç½®<code>zookeeper.logger</code>ä¸º<code>INFO,CONSOLE,ROLLINGFILE</code>ã€‚</p>
</li>
<li><p>(2) <code>rootLogger</code>å¤„ç†æ‰€æœ‰æ—¥å¿—çš„<code>logger</code>ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰å®šä¹‰å…¶ä»–<code>logger</code>ã€‚</p>
</li>
<li><p>(3) <code>log4j.appender.CONSOLE=org.apache.log4j.ConsoleAppender</code>è¿™ä¸€è¡ŒæŠŠCONSOLE appenderå’Œå®é™…ä¸Šå¤„ç†æ—¥å¿—è¾“å‡ºçš„ç±»ç»‘å®šåœ¨ä¸€èµ·ï¼Œè¿™é‡Œæ˜¯ConsoleAppenderç±»ã€‚</p>
</li>
<li><p>(4) <code>appender</code>ä¹Ÿå¯ä»¥è¿‡æ»¤æ—¥å¿—ã€‚è¿™ä¸€è¡Œå°†è¿‡æ»¤ä»»ä½•åœ¨INFOçº§åˆ«ä¹‹ä¸‹çš„æ—¥å¿—ï¼Œå› ä¸ºè¿™æ˜¯åœ¨<code>zookeeper.root.loggerè®¾ç½®çš„threshold</code>ã€‚</p>
</li>
<li><p>(5) <code>appender</code>ä½¿ç”¨ä¸€ä¸ªå¸ƒå±€(layout)ç±»åœ¨è¾“å‡ºå‰å¯¹æ—¥å¿—è¿›è¡Œæ ¼å¼åŒ–ã€‚æˆ‘ä»¬ä½¿ç”¨pattern layoutæ¥è®°å½•æ—¥å¿—çš„çº§åˆ«ï¼Œæ—¥æœŸï¼Œçº¿ç¨‹ä¿¡æ¯å’Œè°ƒç”¨ä½ç½®ä¿¡æ¯ä»¥åŠæ¶ˆæ¯æœ¬èº«ã€‚</p>
</li>
<li><p>(6) RollingFileAppenderå®ç°äº†rollingæ—¥å¿—æ–‡ä»¶çš„åŠŸèƒ½ï¼Œè€Œä¸æ˜¯æŒç»­çš„å†™åˆ°ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶æˆ–è€…æ§åˆ¶å°ã€‚å¦‚æœrootLoggeræ²¡æœ‰å…³è”ROLLINGFILEï¼Œåˆ™æ­¤appenderä¼šè¢«å¿½ç•¥ã€‚</p>
</li>
<li><p>(7) <code>ROLLINGFILE</code>çš„thresholdè®¾ç½®æˆ<code>DEBUG</code>ã€‚å› ä¸º<code>rootLogger</code>è¿‡æ»¤äº†æ‰€æœ‰åœ¨<code>INFO</code>çº§åˆ«ä¹‹ä¸‹çš„æ—¥å¿—ï¼Œæ²¡æœ‰DEBUGæ—¥å¿—ä¼šè¾“å‡ºåˆ°<code>ROLLINGFILE</code>ã€‚å¦‚æœä½ æƒ³è¦çœ‹åˆ°<code>DEBUG</code>æ—¥å¿—ï¼Œä½ å¿…é¡»æŠŠ<code>zookeeper.root.logger</code>ä»<code>INFOæ”¹æˆDEBUG</code>ã€‚</p>
</li>
</ul>
<p>æ‰“æ—¥å¿—ä¼šå½±å“åˆ°è¿›ç¨‹çš„æ€§èƒ½ï¼Œå°¤å…¶æ˜¯åœ¨DEBUGçº§åˆ«ä¸‹ã€‚åŒæ—¶æ—¥å¿—ä¼šæä¾›æœ‰ä»·å€¼çš„ä¿¡æ¯ä¸ºè¯Šæ–­é”™è¯¯æä¾›çº¿ç´¢ã€‚ä¸€ä¸ªå¹³è¡¡æ€§èƒ½å¼€é”€çš„æœ‰æ•ˆæ–¹å¼æ˜¯æŠŠappenderçš„thresholdè®¾æˆDEBUGï¼Œå¹¶æŠŠrootLoggerè®¾æˆWARNçº§åˆ«ï¼Œè¿™åœ¨ä¸€èˆ¬çš„æƒ…å†µéƒ½é€‚ç”¨ï¼Œä¸€èˆ¬åªéœ€è¦å…³æ³¨WARNINGå’Œå®ƒä¹‹ä¸Šçš„æ—¥å¿—ã€‚å½“ä½ éœ€è¦è¯Šæ–­é—®é¢˜æ—¶å¯ä»¥ä½¿ç”¨JMXåŠ¨æ€è®¾ç½®ä¸ºINFOæˆ–DEBUGçº§åˆ«ï¼Œè¿™æ ·å¯ä»¥æ›´æ–¹ä¾¿å®šä½é—®é¢˜ã€‚</p>
<h3 id="ä¿®æ”¹æ—¥å¿—è¾“å‡ºç›®å½•"><a href="#ä¿®æ”¹æ—¥å¿—è¾“å‡ºç›®å½•" class="headerlink" title="ä¿®æ”¹æ—¥å¿—è¾“å‡ºç›®å½•"></a>ä¿®æ”¹æ—¥å¿—è¾“å‡ºç›®å½•</h3><p>ä¹‹å‰å‡ºç°<code>zookeeper</code>åœ¨binç›®å½•ä¸‹å‡ºç°äº†<code>zookeeper.out</code>çš„æ—¥å¿—æ–‡ä»¶ï¼Œç»åˆ†æå‘ç°æ­¤æ–‡ä»¶æ˜¯ç”±äº<code>nohup</code>å‘½ä»¤æ‰“å°çš„æ§åˆ¶å°æ—¥å¿—ã€‚</p>
<p>ä½†æ˜¯ï¼Œæˆ‘ä»¬åœ¨<code>zoo.cfg</code>é…ç½®æ–‡ä»¶ä¸­ï¼Œå¯¹æ—¥å¿—æ–‡ä»¶è¿›è¡Œäº†é…ç½®ï¼ˆæˆªå–éƒ¨åˆ†ï¼‰</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">dataDir=/data/tools/zookeeper-3.4.5/tmp</div><div class="line">dataLogDir=/data/tools/zookeeper-3.4.5/tmp/logs</div></pre></td></tr></table></figure>
<p>å…¶ä¸­ï¼Œ<code>dataDirå’ŒdataLogDir</code>æ˜¯é’ˆå¯¹æ•°æ®ä¿¡æ¯åŠæ•°æ®ä¿¡æ¯æ—¥å¿—çš„ä½ç½®é…ç½®ã€‚ä½†æ˜¯åœ¨zookeeperå†…éƒ¨é›†æˆäº†<code>log4j.properties</code>ï¼ˆå¯¹åº”é…ç½®æ–‡ä»¶åœ¨confè·¯å¾„ä¸‹ï¼‰ã€‚</p>
<h3 id="å‚è€ƒlog4jé…ç½®è¯´æ˜"><a href="#å‚è€ƒlog4jé…ç½®è¯´æ˜" class="headerlink" title="å‚è€ƒlog4jé…ç½®è¯´æ˜"></a>å‚è€ƒlog4jé…ç½®è¯´æ˜</h3><p>æ‰“å¼€<code>log4j.properties</code>æ–‡ä»¶ï¼Œæˆ‘ä»¬ä¼šå‘ç°æœ‰è¿™æ ·çš„é…ç½®ï¼Œå®ƒåœ¨è¯´æ˜å…³äº<code>zookeeper</code>æœ¬èº«çš„ä¸€äº›é»˜è®¤è®¾ç½®ï¼Œä½†æ˜¯å¯ä»¥è¢«ç³»ç»Ÿé…ç½®æ–‡ä»¶æ‰€è¦†ç›–ã€‚é‚£ä¹ˆï¼Œåœ¨<code>log4j</code>ä¸­ï¼Œ<code>rootæ˜¯log4j</code>è®°å½•çš„åŸå§‹èµ·ç‚¹ï¼Œè€Œè¿™éƒ¨åˆ†å‚æ•°åˆå¯ä»¥è¢«ç³»ç»Ÿä¿®æ”¹ï¼Œé‚£ä¹ˆç³»ç»Ÿé…ç½®åœ¨ä»€ä¹ˆåœ°æ–¹å‘¢ï¼Ÿ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Define some default values that can be overridden by system properties</span></div><div class="line">zookeeper.root.logger=INFO, CONSOLE</div><div class="line">zookeeper.console.threshold=INFO</div><div class="line">zookeeper.log.dir=.</div><div class="line">zookeeper.log.file=zookeeper.log</div><div class="line">zookeeper.log.threshold=DEBUG</div><div class="line">zookeeper.tracelog.dir=.</div><div class="line">zookeeper.tracelog.file=zookeeper_trace.log</div></pre></td></tr></table></figure>
<p>zkæ—¥å¿—.outåŠlog4jæ—¥å¿—è·¯å¾„é…ç½® ï¼šé¦–å…ˆä¿®æ”¹<code>bin/zkEnv.sh</code>ï¼Œé…ç½®<code>ZOO_LOG_DIR</code>çš„ç¯å¢ƒå˜é‡ï¼Œ<code>ZOO_LOG_DIR</code>æ˜¯zookeeperæ—¥å¿—è¾“å‡ºç›®å½•ï¼Œ<code>ZOO_LOG4J_PROP</code>æ˜¯log4jæ—¥å¿—è¾“å‡ºçš„é…ç½®ï¼š</p>
<ul>
<li>é»˜è®¤é…ç½®ï¼š</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> [ <span class="string">"x<span class="variable">$&#123;ZOO_LOG_DIR&#125;</span>"</span> = <span class="string">"x"</span> ]</div><div class="line"><span class="keyword">then</span></div><div class="line">    ZOO_LOG_DIR=<span class="string">"."</span></div><div class="line"><span class="keyword">fi</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> [ <span class="string">"x<span class="variable">$&#123;ZOO_LOG4J_PROP&#125;</span>"</span> = <span class="string">"x"</span> ]</div><div class="line"><span class="keyword">then</span></div><div class="line">    ZOO_LOG4J_PROP=<span class="string">"INFO,CONSOLE"</span></div><div class="line"><span class="keyword">fi</span></div></pre></td></tr></table></figure>
<ul>
<li>ç”Ÿäº§ç¯å¢ƒä¿®æ”¹ï¼š</li>
</ul>
<p>åœ¨zkç›®å½•ä¸‹é¢åˆ›å»ºlogsç›®å½• ç»™äºˆbiç»„æ“ä½œæƒé™ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo mkdir /data/tools/zookeeper-3.4.5/logs/</div><div class="line">sudo chown -R jollybi:jollybi /data/tools/zookeeper-3.4.5/logs/</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> [ <span class="string">"x<span class="variable">$&#123;ZOO_LOG_DIR&#125;</span>"</span> = <span class="string">"x"</span> ]</div><div class="line"><span class="keyword">then</span></div><div class="line">    ZOO_LOG_DIR=<span class="string">"<span class="variable">$ZOOBINDIR</span>/../logs"</span></div><div class="line"><span class="keyword">fi</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> [ <span class="string">"x<span class="variable">$&#123;ZOO_LOG4J_PROP&#125;</span>"</span> = <span class="string">"x"</span> ]</div><div class="line"><span class="keyword">then</span></div><div class="line">    ZOO_LOG4J_PROP=<span class="string">"INFO,ROLLINGFILE"</span>  //ROLLINGFILE â€”â€” æ—¥å¿—è½®è½¬ï¼Œé¿å…å•ä¸€æ–‡ä»¶è¿‡å¤§</div><div class="line"><span class="keyword">fi</span></div></pre></td></tr></table></figure>
<h3 id="Zookeeperç‰ˆæœ¬3-4-0ä»¥ä¸Šçš„zkå¯ä»¥è®¾ç½®å®šæœŸè‡ªåŠ¨æ¸…ç†-å‚è€ƒé“¾æ¥"><a href="#Zookeeperç‰ˆæœ¬3-4-0ä»¥ä¸Šçš„zkå¯ä»¥è®¾ç½®å®šæœŸè‡ªåŠ¨æ¸…ç†-å‚è€ƒé“¾æ¥" class="headerlink" title="Zookeeperç‰ˆæœ¬3.4.0ä»¥ä¸Šçš„zkå¯ä»¥è®¾ç½®å®šæœŸè‡ªåŠ¨æ¸…ç†.å‚è€ƒé“¾æ¥"></a>Zookeeperç‰ˆæœ¬3.4.0ä»¥ä¸Šçš„zkå¯ä»¥è®¾ç½®å®šæœŸè‡ªåŠ¨æ¸…ç†.<a href="http://nileader.blog.51cto.com/1381108/932156" target="_blank" rel="external">å‚è€ƒé“¾æ¥</a></h3><ul>
<li>åœ¨zoo.cfgä¸­é…ç½®ï¼š</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">autopurge.purgeInterval: 24*2     <span class="comment">##è¿™ä¸ªå‚æ•°æŒ‡å®šäº†æ¸…ç†é¢‘ç‡ï¼Œå•ä½æ˜¯å°æ—¶ã€‚é»˜è®¤æ˜¯0ï¼Œè¡¨ç¤ºä¸å¼€å¯è‡ªå·±æ¸…ç†åŠŸèƒ½ã€‚</span></div><div class="line">autopurge.snapRetainCount:  2	    <span class="comment">##è¿™ä¸ªå‚æ•°å’Œä¸Šé¢çš„å‚æ•°æ­é…ä½¿ç”¨ï¼Œè¿™ä¸ªå‚æ•°æŒ‡å®šäº†éœ€è¦ä¿ç•™çš„æ–‡ä»¶æ•°ç›®ã€‚é»˜è®¤æ˜¯ä¿ç•™3ä¸ªã€‚</span></div></pre></td></tr></table></figure>
<h3 id="é…ç½®zookeeper-outçš„ä½ç½®åŠlog4jæ—¥å¿—è¾“å‡º"><a href="#é…ç½®zookeeper-outçš„ä½ç½®åŠlog4jæ—¥å¿—è¾“å‡º" class="headerlink" title="é…ç½®zookeeper.outçš„ä½ç½®åŠlog4jæ—¥å¿—è¾“å‡º"></a>é…ç½®zookeeper.outçš„ä½ç½®åŠlog4jæ—¥å¿—è¾“å‡º</h3><p>(1)<code>zookeeper.out</code>ç”±nohupçš„è¾“å‡ºï¼Œä¹Ÿå°±æ˜¯<code>zookeeper</code>çš„<code>stdoutå’Œstdeer</code>è¾“å‡ºã€‚</p>
<p>åœ¨zkServer.shä¸­ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> [ ! -w <span class="string">"<span class="variable">$ZOO_LOG_DIR</span>"</span> ] ; <span class="keyword">then</span>  </div><div class="line">mkdir -p <span class="string">"<span class="variable">$ZOO_LOG_DIR</span>"</span>  </div><div class="line"><span class="keyword">fi</span>  </div><div class="line">  </div><div class="line">_ZOO_DAEMON_OUT=<span class="string">"<span class="variable">$ZOO_LOG_DIR</span>/zookeeper.out"</span>  <span class="comment">#æ—¥å¿—è¾“å‡ºæ–‡ä»¶è·¯å¾„</span></div><div class="line"></div><div class="line"><span class="comment">#nohupæ—¥å¿—è¾“å‡º</span></div><div class="line">nohup <span class="variable">$JAVA</span> <span class="string">"-Dzookeeper.log.dir=<span class="variable">$&#123;ZOO_LOG_DIR&#125;</span>"</span> <span class="string">"-Dzookeeper.root.logger=<span class="variable">$&#123;ZOO_LOG4J_PROP&#125;</span>"</span> \  </div><div class="line">-cp <span class="string">"<span class="variable">$CLASSPATH</span>"</span> <span class="variable">$JVMFLAGS</span> <span class="variable">$ZOOMAIN</span> <span class="string">"<span class="variable">$ZOOCFG</span>"</span> &gt; <span class="string">"<span class="variable">$_ZOO_DAEMON_OUT</span>"</span> 2&gt;&amp;1 &lt; /dev/null &amp;</div></pre></td></tr></table></figure>
<p>(2)log4jæ—¥å¿—è¾“å‡ºé…ç½® conf/log4j.propertiesä¸­ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Add ROLLINGFILE to rootLogger to get log file output  </span></div><div class="line"><span class="comment">#    Log DEBUG level and above messages to a log file  </span></div><div class="line"></div><div class="line"><span class="built_in">log</span>4j.appender.ROLLINGFILE=org.apache.log4j.RollingFileAppender  //æ—¥å¿—è½®è½¬ï¼ŒDaliyRollingFileAppender â€”â€” æŒ‰å¤©è½®è½¬</div><div class="line"><span class="built_in">log</span>4j.appender.ROLLINGFILE.Threshold=<span class="variable">$&#123;zookeeper.log.threshold&#125;</span>  </div><div class="line"><span class="built_in">log</span>4j.appender.ROLLINGFILE.File=<span class="variable">$&#123;zookeeper.log.dir&#125;</span>/<span class="variable">$&#123;zookeeper.log.file&#125;</span></div></pre></td></tr></table></figure>
<p>è½®è½¬å‰æéœ€è¦å°†(1)é‡Œbin/zkEnv.shä¸­çš„è½®è½¬é…ç½®å¥½</p>
<p>4.zkäº‹åŠ¡æ—¥å¿—æŸ¥çœ‹</p>
<p>zookeeperçš„äº‹åŠ¡æ—¥å¿—é€šè¿‡zoo.cfgæ–‡ä»¶ä¸­çš„dataLogDiré…ç½®é¡¹é…ç½®ï¼š</p>
<pre><code># the directory where the snapshot is stored.
# do not use /tmp for storage, /tmp here is just
# example sakes.
dataDir=/tmp/zookeeper    
</code></pre><p>æŸ¥çœ‹äº‹åŠ¡æ—¥å¿—æ–¹æ³•ï¼š<br>(éœ€è¦ä¸‹è½½slf4j-api-1.6.1.jaråŒ…) </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">java -classpath .:slf4j-api-1.6.1.jar:zookeeper-3.4.5.jar org.apache.zookeeper.server.LogFormatter /tmp/zookeeper/version-2/xxx.xxx</div></pre></td></tr></table></figure>
<h3 id="æ€ä¹ˆè‡ªå®šä¹‰zookeeperçš„å¯åŠ¨å†…å­˜"><a href="#æ€ä¹ˆè‡ªå®šä¹‰zookeeperçš„å¯åŠ¨å†…å­˜" class="headerlink" title="æ€ä¹ˆè‡ªå®šä¹‰zookeeperçš„å¯åŠ¨å†…å­˜"></a>æ€ä¹ˆè‡ªå®šä¹‰zookeeperçš„å¯åŠ¨å†…å­˜</h3><p>è¿è¡Œzookeeperæ—¶ï¼Œä½¿ç”¨jmap -heap <pid> å‘½ä»¤æŸ¥çœ‹å†…å­˜æƒ…å†µå¦‚ä¸‹:</pid></p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zookeeper_01.png" alt=""></figure></p>
<p>è§£å†³ï¼šåˆ†é…å†…å­˜æ–‡ä»¶è·¯å¾„ï¼š<code>zookeeper/bin/zkEnv.sh</code></p>
<p>è¯¥æ–‡ä»¶å·²ç»æ˜ç¡®è¯´æ˜æœ‰ç‹¬ç«‹JVMå†…å­˜çš„è®¾ç½®æ–‡ä»¶ï¼Œè·¯å¾„æ˜¯<code>zookeeper/conf/java.env</code><br>å®‰è£…çš„æ—¶å€™è¿™ä¸ªè·¯å¾„ä¸‹æ²¡æœ‰æœ‰<code>java.env</code>æ–‡ä»¶ï¼Œéœ€è¦è‡ªå·±æ–°å»ºä¸€ä¸ªï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># vim java.env</span></div><div class="line"></div><div class="line"><span class="meta">#!/bin/sh</span></div><div class="line"><span class="built_in">export</span> JAVA_HOME=/usr/java/jdk</div><div class="line"><span class="comment"># heap size MUST be modified according to cluster environment</span></div><div class="line"><span class="built_in">export</span> JVMFLAGS=<span class="string">"-Xms4g -Xmx4g <span class="variable">$JVMFLAGS</span>"</span></div><div class="line"></div><div class="line">å¯¹äºå†…å­˜çš„åˆ†é…ï¼Œè¿˜æ˜¯æ ¹æ®é¡¹ç›®å’Œæœºå™¨æƒ…å†µè€Œå®šã€‚å¦‚æœå†…å­˜å¤Ÿç”¨ï¼Œé€‚å½“çš„å¤§ç‚¹å¯ä»¥æå‡zkæ€§èƒ½ã€‚</div></pre></td></tr></table></figure>

	

	
		<span class="different-posts"><a href="/2017/04/27/Bigdata-hadoop/zookeeper/Bigdata-Zookeeperé›†ç¾¤æ—¥å¿—é…ç½®è¯¦è§£å’Œæ¸…ç†è‡ªå®šä¹‰å¯åŠ¨å†…å­˜ /" onclick="window.history.go(-1); return false;">â¬…ï¸ Go back </a></span>

	

</article>

	</main>

	<footer class="footer">
	<div class="footer-content">
		
	      <div class="footer__element">
	<h5>Hi there,</h5>
	<p style="text-align:justify;">my name is Yancy, they know me as RadiantğŸ‘ğŸ‘. This blog is about Bi-data and my live.<br> I like ğŸŒ³ğŸŒ³ğŸŒ³</p>
</div>


	    
	      <div class="footer__element">
	<h5>Check out</h5>
	<ul class="footer-links">
		<li class="footer-links__link"><a href="/archives">Archive</a></li>
		
		  <li class="footer-links__link"><a href="/atom.xml">RSS</a></li>
	    
		<li class="footer-links__link"><a href="/about">about page</a></li>
		<li class="footer-links__link"><a href="/tags">Tags</a></li>
		<li class="footer-links__link"><a href="/categories">Categories</a></li>
	</ul>
</div>

	    

		<div class="footer-credit">
			<span>Â© 2017 Yancy | Powered by <a href="http://blog.yancy.cc/">Yancy</a> | Theme <a href="https://github.com/yangcvo">Yancy_GitHub</a></span>
		</div>

	</div>


</footer>



</body>

</html>
