<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="theme-color" content="#33474d">
	<title>ZABBIX3.0监控MySQL5.6 master-slave主从 | Yancy&#39;s blog</title>
	<link rel="stylesheet" href="/css/style.css" />
	
      <link rel="alternate" href="/atom.xml" title="Yancy&#39;s blog" type="application/atom+xml">
    
</head>

<body>

	<header class="header">
		<nav class="header__nav">
			
				<a href="/" class="header__link">Home</a>
			
				<a href="/tags" class="header__link">Tags</a>
			
				<a href="/archives" class="header__link">ARCHIVES</a>
			
				<a href="/about/About" class="header__link">ABOUT</a>
			
				<a href="http://weibo.com/yangcvo" class="header__link">Weibo</a>
			
				<a href="/atom.xml" class="header__link">RSS</a>
			
		</nav>
		<h1 class="header__title"><a href="/">Yancy&#39;s blog</a></h1>
		<h2 class="header__subtitle">SIMPLICITY IS PREREQUISITE FOR  RELIABILITY</h2>
	</header>

	<main>
		<article>
	
		<h1>ZABBIX3.0监控MySQL5.6 master-slave主从</h1>
	
	<div class="article__infos">
		<span class="article__date">2017-04-21</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/monitoring/">monitoring</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Zabbix-monitoring/">Zabbix monitoring</a>
			</span>
		
	</div>

	

	
		<h1 id="快速配置zabbix监控MySQL5-6-master-slave主从"><a href="#快速配置zabbix监控MySQL5-6-master-slave主从" class="headerlink" title="快速配置zabbix监控MySQL5.6 master-slave主从"></a>快速配置zabbix监控MySQL5.6 master-slave主从</h1><p>zabbix安装完成: 写监控项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">vim /etc/zabbix/zabbix_agentd.conf</div><div class="line"></div><div class="line">UserParameter=mysql.version,mysql -V</div><div class="line">UserParameter=mysql.ping,mysqladmin -uzabbix -pl8ka65 -S /var/lib/mysql/mysql.sock ping | grep -c alive</div><div class="line">UserParameter=mysql.status[*],/etc/zabbix/mysql.sh <span class="variable">$1</span> <span class="variable">$2</span></div><div class="line">UserParameter=mysql.[*],/etc/zabbix/slave.sh <span class="variable">$1</span> <span class="variable">$2</span></div></pre></td></tr></table></figure>
<p>主从监控脚本：</p>
<p>mysql.sh</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/bin/sh</span></div><div class="line"><span class="comment">#Create by gaosy 2014.09.13</span></div><div class="line">MYSQL_SOCK=<span class="string">"/var/lib/mysql/mysql.sock"</span></div><div class="line">MYSQL_PWD=<span class="string">"l8ka65"</span></div><div class="line">ARGS=1</div><div class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> <span class="_">-ne</span> <span class="string">"<span class="variable">$ARGS</span>"</span> ];<span class="keyword">then</span></div><div class="line">    <span class="built_in">echo</span> <span class="string">"Please input one arguement:"</span></div><div class="line"><span class="keyword">fi</span></div><div class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></div><div class="line">    Uptime)</div><div class="line">        result=`mysqladmin -uzabbix -p<span class="variable">$&#123;MYSQL_PWD&#125;</span> -S <span class="variable">$MYSQL_SOCK</span> -h127.0.0.1 status|cut <span class="_">-f</span>2 <span class="_">-d</span><span class="string">":"</span>|cut <span class="_">-f</span>1 <span class="_">-d</span><span class="string">"T"</span>`</div><div class="line">            <span class="built_in">echo</span> <span class="variable">$result</span></div><div class="line">            ;;</div><div class="line">        Com_update)</div><div class="line">            result=`mysqladmin -uzabbix -p<span class="variable">$&#123;MYSQL_PWD&#125;</span> -S <span class="variable">$MYSQL_SOCK</span> -h127.0.0.1 extended-status |grep -w <span class="string">"Com_update"</span>|cut <span class="_">-d</span><span class="string">"|"</span> <span class="_">-f</span>3`</div><div class="line">            <span class="built_in">echo</span> <span class="variable">$result</span></div><div class="line">            ;;</div><div class="line">       Max)</div><div class="line">            result=`mysqladmin -uzabbix -p<span class="variable">$&#123;MYSQL_PWD&#125;</span> -S <span class="variable">$MYSQL_SOCK</span> -h127.0.0.1 extended-status |grep -w <span class="string">"Threads_connected"</span>|cut <span class="_">-d</span><span class="string">"|"</span> <span class="_">-f</span>3`</div><div class="line">            <span class="built_in">echo</span> <span class="variable">$result</span></div><div class="line">            ;;</div><div class="line">        Slow_queries)</div><div class="line">        result=`mysqladmin -uzabbix -p<span class="variable">$&#123;MYSQL_PWD&#125;</span> -S <span class="variable">$MYSQL_SOCK</span> -h127.0.0.1 status |cut <span class="_">-f</span>5 <span class="_">-d</span><span class="string">":"</span>|cut <span class="_">-f</span>1 <span class="_">-d</span><span class="string">"O"</span>`</div><div class="line">                <span class="built_in">echo</span> <span class="variable">$result</span></div><div class="line">                ;;</div><div class="line">    Com_select)</div><div class="line">        result=`mysqladmin -uzabbix -p<span class="variable">$&#123;MYSQL_PWD&#125;</span> -S <span class="variable">$MYSQL_SOCK</span> -h127.0.0.1 extended-status |grep -w <span class="string">"Com_select"</span>|cut <span class="_">-d</span><span class="string">"|"</span> <span class="_">-f</span>3`</div><div class="line">                <span class="built_in">echo</span> <span class="variable">$result</span></div><div class="line">                ;;</div><div class="line">    Com_rollback)</div><div class="line">        result=`mysqladmin -uzabbix -p<span class="variable">$&#123;MYSQL_PWD&#125;</span> -S <span class="variable">$MYSQL_SOCK</span> -h127.0.0.1 extended-status |grep -w <span class="string">"Com_rollback"</span>|cut <span class="_">-d</span><span class="string">"|"</span> <span class="_">-f</span>3`</div><div class="line">                <span class="built_in">echo</span> <span class="variable">$result</span></div><div class="line">                ;;</div><div class="line">    Questions)</div><div class="line">        result=`mysqladmin -uzabbix -p<span class="variable">$&#123;MYSQL_PWD&#125;</span> -S <span class="variable">$MYSQL_SOCK</span> -h127.0.0.1 status|cut <span class="_">-f</span>4 <span class="_">-d</span><span class="string">":"</span>|cut <span class="_">-f</span>1 <span class="_">-d</span><span class="string">"S"</span>`</div><div class="line">                <span class="built_in">echo</span> <span class="variable">$result</span></div><div class="line">                ;;</div><div class="line">    Com_insert)</div><div class="line">        result=`mysqladmin -uzabbix -p<span class="variable">$&#123;MYSQL_PWD&#125;</span> -S <span class="variable">$MYSQL_SOCK</span> -h127.0.0.1 extended-status |grep -w <span class="string">"Com_insert"</span>|cut <span class="_">-d</span><span class="string">"|"</span> <span class="_">-f</span>3`</div><div class="line">                <span class="built_in">echo</span> <span class="variable">$result</span></div><div class="line">                ;;</div><div class="line">    Com_delete)</div><div class="line">        result=`mysqladmin -uzabbix -p<span class="variable">$&#123;MYSQL_PWD&#125;</span> -S <span class="variable">$MYSQL_SOCK</span> -h127.0.0.1 extended-status |grep -w <span class="string">"Com_delete"</span>|cut <span class="_">-d</span><span class="string">"|"</span> <span class="_">-f</span>3`</div><div class="line">                <span class="built_in">echo</span> <span class="variable">$result</span></div><div class="line">                ;;</div><div class="line">    Com_commit)</div><div class="line">        result=`mysqladmin -uzabbix -p<span class="variable">$&#123;MYSQL_PWD&#125;</span> -S <span class="variable">$MYSQL_SOCK</span> -h127.0.0.1 extended-status |grep -w <span class="string">"Com_commit"</span>|cut <span class="_">-d</span><span class="string">"|"</span> <span class="_">-f</span>3`</div><div class="line">                <span class="built_in">echo</span> <span class="variable">$result</span></div><div class="line">                ;;</div><div class="line">    Bytes_sent)</div><div class="line">        result=`mysqladmin -uzabbix -p<span class="variable">$&#123;MYSQL_PWD&#125;</span> -S <span class="variable">$MYSQL_SOCK</span> -h127.0.0.1 extended-status |grep -w <span class="string">"Bytes_sent"</span> |cut <span class="_">-d</span><span class="string">"|"</span> <span class="_">-f</span>3`</div><div class="line">                <span class="built_in">echo</span> <span class="variable">$result</span></div><div class="line">                ;;</div><div class="line">Bytes_received)</div><div class="line">        result=`mysqladmin -uzabbix -p<span class="variable">$&#123;MYSQL_PWD&#125;</span> -S <span class="variable">$MYSQL_SOCK</span> -h127.0.0.1 extended-status |grep -w <span class="string">"Bytes_received"</span> |cut <span class="_">-d</span><span class="string">"|"</span> <span class="_">-f</span>3`</div><div class="line">                <span class="built_in">echo</span> <span class="variable">$result</span></div><div class="line">                ;;</div><div class="line">    Com_begin)</div><div class="line">        result=`mysqladmin -uzabbix -p<span class="variable">$&#123;MYSQL_PWD&#125;</span> -S <span class="variable">$MYSQL_SOCK</span> -h127.0.0.1 extended-status |grep -w <span class="string">"Com_begin"</span>|cut <span class="_">-d</span><span class="string">"|"</span> <span class="_">-f</span>3`</div><div class="line">                <span class="built_in">echo</span> <span class="variable">$result</span></div><div class="line">                ;;</div><div class="line">    Binlog_cache_disk_use)</div><div class="line">        result=`mysql -uzabbix -p<span class="variable">$&#123;MYSQL_PWD&#125;</span> -S <span class="variable">$MYSQL_SOCK</span> -h127.0.0.1 <span class="_">-e</span> <span class="string">"show status\G"</span> 2&gt;/dev/null | grep -A 1 -w Binlog_cache_disk_use| grep Value|awk <span class="string">'&#123;print $NF&#125;'</span>`</div><div class="line">             <span class="built_in">echo</span> <span class="variable">$result</span></div><div class="line">             ;;</div><div class="line">    Binlog_cache_use)</div><div class="line">        result=`mysql -uzabbix -p<span class="variable">$&#123;MYSQL_PWD&#125;</span> -S <span class="variable">$MYSQL_SOCK</span> -h127.0.0.1 <span class="_">-e</span> <span class="string">"show status\G"</span> 2&gt;/dev/null | grep -A 1 -w Binlog_cache_use| grep Value|awk <span class="string">'&#123;print $NF&#125;'</span>`</div><div class="line">             <span class="built_in">echo</span> <span class="variable">$result</span></div><div class="line">             ;;</div><div class="line">    Delayed_insert_threads)</div><div class="line">        result=`mysql -uzabbix -p<span class="variable">$&#123;MYSQL_PWD&#125;</span> -S <span class="variable">$MYSQL_SOCK</span> -h127.0.0.1 <span class="_">-e</span> <span class="string">"show status\G"</span> 2&gt;/dev/null | grep -A 1 -w Delayed_insert_threads| grep Value|awk <span class="string">'&#123;print $NF&#125;'</span>`</div><div class="line">             <span class="built_in">echo</span> <span class="variable">$result</span></div><div class="line">             ;;</div><div class="line">    Handler_savepoint)</div><div class="line">        result=`mysql -uzabbix -p<span class="variable">$&#123;MYSQL_PWD&#125;</span> -S <span class="variable">$MYSQL_SOCK</span> -h127.0.0.1 <span class="_">-e</span> <span class="string">"show status\G"</span> 2&gt;/dev/null | grep -A 1 -w Handler_savepoint| grep Value|awk <span class="string">'&#123;print $NF&#125;'</span>`</div><div class="line">             <span class="built_in">echo</span> <span class="variable">$result</span></div><div class="line">             ;;</div><div class="line">    Handler_savepoint_rollback)</div><div class="line">        result=`mysql -uzabbix -p<span class="variable">$&#123;MYSQL_PWD&#125;</span> -S <span class="variable">$MYSQL_SOCK</span> -h127.0.0.1 <span class="_">-e</span> <span class="string">"show status\G"</span> 2&gt;/dev/null | grep -A 1 -w Handler_savepoint_rollback| grep Value|awk <span class="string">'&#123;print $NF&#125;'</span>`</div><div class="line">             <span class="built_in">echo</span> <span class="variable">$result</span></div><div class="line">             ;;</div><div class="line">    Innodb_data_pending_fsyncs)</div><div class="line">        result=`mysql -uzabbix -p<span class="variable">$&#123;MYSQL_PWD&#125;</span> -S <span class="variable">$MYSQL_SOCK</span> -h127.0.0.1 <span class="_">-e</span> <span class="string">"show status\G"</span> 2&gt;/dev/null | grep -A 1 -w Innodb_data_pending_fsyncs| grep Value|awk <span class="string">'&#123;print $NF&#125;'</span>`</div><div class="line">             <span class="built_in">echo</span> <span class="variable">$result</span></div><div class="line">             ;;</div><div class="line">    Innodb_data_pending_reads)</div><div class="line">        result=`mysql -uzabbix -p<span class="variable">$&#123;MYSQL_PWD&#125;</span> -S <span class="variable">$MYSQL_SOCK</span> -h127.0.0.1 <span class="_">-e</span> <span class="string">"show status\G"</span> 2&gt;/dev/null | grep -A 1 -w Innodb_data_pending_reads| grep Value|awk <span class="string">'&#123;print $NF&#125;'</span>`</div><div class="line">             <span class="built_in">echo</span> <span class="variable">$result</span></div><div class="line">             ;;</div><div class="line">    Innodb_data_pending_writes)</div><div class="line">        result=`mysql -uzabbix -p<span class="variable">$&#123;MYSQL_PWD&#125;</span> -S <span class="variable">$MYSQL_SOCK</span> -h127.0.0.1 <span class="_">-e</span> <span class="string">"show status\G"</span> 2&gt;/dev/null | grep -A 1 -w Innodb_data_pending_writes| grep Value|awk <span class="string">'&#123;print $NF&#125;'</span>`</div><div class="line">             <span class="built_in">echo</span> <span class="variable">$result</span></div><div class="line">             ;;</div><div class="line">    Innodb_os_log_pending_fsyncs)</div><div class="line">        result=`mysql -uzabbix -p<span class="variable">$&#123;MYSQL_PWD&#125;</span> -S <span class="variable">$MYSQL_SOCK</span> -h127.0.0.1 <span class="_">-e</span> <span class="string">"show status\G"</span> 2&gt;/dev/null | grep -A 1 -w Innodb_os_log_pending_fsyncs| grep Value|awk <span class="string">'&#123;print $NF&#125;'</span>`</div><div class="line">             <span class="built_in">echo</span> <span class="variable">$result</span></div><div class="line">             ;;</div><div class="line"></div><div class="line">Innodb_os_log_pending_writes)</div><div class="line">        result=`mysql -uzabbix -p<span class="variable">$&#123;MYSQL_PWD&#125;</span> -S <span class="variable">$MYSQL_SOCK</span> -h127.0.0.1 <span class="_">-e</span> <span class="string">"show status\G"</span> 2&gt;/dev/null | grep -A 1 -w Innodb_os_log_pending_writes| grep Value|awk <span class="string">'&#123;print $NF&#125;'</span>`</div><div class="line">             <span class="built_in">echo</span> <span class="variable">$result</span></div><div class="line">             ;;</div><div class="line">    Innodb_rows_inserted)</div><div class="line">        result=`mysql -uzabbix -p<span class="variable">$&#123;MYSQL_PWD&#125;</span> -S <span class="variable">$MYSQL_SOCK</span> -h127.0.0.1 <span class="_">-e</span> <span class="string">"show status\G"</span> 2&gt;/dev/null | grep -A 1 -w Innodb_rows_inserted| grep Value|awk <span class="string">'&#123;print $NF&#125;'</span>`</div><div class="line">             <span class="built_in">echo</span> <span class="variable">$result</span></div><div class="line">             ;;</div><div class="line">    Innodb_scan_data_in_pages)</div><div class="line">        result=`mysql -uzabbix -p<span class="variable">$&#123;MYSQL_PWD&#125;</span> -S <span class="variable">$MYSQL_SOCK</span> -h127.0.0.1 <span class="_">-e</span> <span class="string">"show status\G"</span> 2&gt;/dev/null | grep -A 1 -w Innodb_scan_data_in_pages| grep Value|awk <span class="string">'&#123;print $NF&#125;'</span>`</div><div class="line">             <span class="built_in">echo</span> <span class="variable">$result</span></div><div class="line">             ;;</div><div class="line">    Innodb_scan_garbages_in_pages)</div><div class="line">        result=`mysql -uzabbix -p<span class="variable">$&#123;MYSQL_PWD&#125;</span> -S <span class="variable">$MYSQL_SOCK</span> -h127.0.0.1 <span class="_">-e</span> <span class="string">"show status\G"</span> 2&gt;/dev/null | grep -A 1 -w Innodb_scan_garbages_in_pages| grep Value|awk <span class="string">'&#123;print $NF&#125;'</span>`</div><div class="line">             <span class="built_in">echo</span> <span class="variable">$result</span></div><div class="line">             ;;</div><div class="line">    Qcache_inserts)</div><div class="line">        result=`mysql -uzabbix -p<span class="variable">$&#123;MYSQL_PWD&#125;</span> -S <span class="variable">$MYSQL_SOCK</span> -h127.0.0.1 <span class="_">-e</span> <span class="string">"show status\G"</span> 2&gt;/dev/null | grep -A 1 -w Qcache_inserts| grep Value|awk <span class="string">'&#123;print $NF&#125;'</span>`</div><div class="line">             <span class="built_in">echo</span> <span class="variable">$result</span></div><div class="line">             ;;</div><div class="line">    Qcache_queries_in_cache)</div><div class="line">        result=`mysql -uzabbix -p<span class="variable">$&#123;MYSQL_PWD&#125;</span> -S <span class="variable">$MYSQL_SOCK</span> -h127.0.0.1 <span class="_">-e</span> <span class="string">"show status\G"</span> 2&gt;/dev/null | grep -A 1 -w Qcache_queries_in_cache| grep Value|awk <span class="string">'&#123;print $NF&#125;'</span>`</div><div class="line">             <span class="built_in">echo</span> <span class="variable">$result</span></div><div class="line">             ;;</div><div class="line">    Select_full_join)</div><div class="line">        result=`mysql -uzabbix -p<span class="variable">$&#123;MYSQL_PWD&#125;</span> -S <span class="variable">$MYSQL_SOCK</span> -h127.0.0.1 <span class="_">-e</span> <span class="string">"show status\G"</span> 2&gt;/dev/null | grep -A 1 -w Select_full_join| grep Value|awk <span class="string">'&#123;print $NF&#125;'</span>`</div><div class="line">             <span class="built_in">echo</span> <span class="variable">$result</span></div><div class="line">             ;;</div><div class="line">    Select_full_range_join)</div><div class="line">        result=`mysql -uzabbix -p<span class="variable">$&#123;MYSQL_PWD&#125;</span> -S <span class="variable">$MYSQL_SOCK</span> -h127.0.0.1 <span class="_">-e</span> <span class="string">"show status\G"</span> 2&gt;/dev/null | grep -A 1 -w Select_full_range_join| grep Value|awk <span class="string">'&#123;print $NF&#125;'</span>`</div><div class="line">             <span class="built_in">echo</span> <span class="variable">$result</span></div><div class="line">             ;;</div><div class="line">    Slave_running)</div><div class="line">        result=`mysql -uzabbix -p<span class="variable">$&#123;MYSQL_PWD&#125;</span> -S <span class="variable">$MYSQL_SOCK</span> -h127.0.0.1 <span class="_">-e</span> <span class="string">"show status\G"</span> 2&gt;/dev/null | grep -A 1 -w Slave_running| grep -c ON`</div><div class="line">             <span class="built_in">echo</span> <span class="variable">$result</span></div><div class="line">             ;;</div><div class="line">    Ssl_finished_accepts)</div><div class="line">        result=`mysql -uzabbix -p<span class="variable">$&#123;MYSQL_PWD&#125;</span> -S <span class="variable">$MYSQL_SOCK</span> -h127.0.0.1 <span class="_">-e</span> <span class="string">"show status\G"</span> 2&gt;/dev/null | grep -A 1 -w Ssl_finished_accepts| grep Value|awk <span class="string">'&#123;print $NF&#125;'</span>`</div><div class="line">             <span class="built_in">echo</span> <span class="variable">$result</span></div><div class="line">             ;;</div><div class="line">    Ssl_finished_connects)</div><div class="line">        result=`mysql -uzabbix -p<span class="variable">$&#123;MYSQL_PWD&#125;</span> -S <span class="variable">$MYSQL_SOCK</span> -h127.0.0.1 <span class="_">-e</span> <span class="string">"show status\G"</span> 2&gt;/dev/null | grep -A 1 -w Ssl_finished_connects| grep Value|awk <span class="string">'&#123;print $NF&#125;'</span>`</div><div class="line">             <span class="built_in">echo</span> <span class="variable">$result</span></div><div class="line">             ;;</div><div class="line">    Threads_running)</div><div class="line">        result=`mysql -uzabbix -p<span class="variable">$&#123;MYSQL_PWD&#125;</span> -S <span class="variable">$MYSQL_SOCK</span> -h127.0.0.1 <span class="_">-e</span> <span class="string">"show status\G"</span> 2&gt;/dev/null | grep -A 1 -w Threads_running| grep Value|awk <span class="string">'&#123;print $NF&#125;'</span>`</div><div class="line">             <span class="built_in">echo</span> <span class="variable">$result</span></div><div class="line">             ;;</div><div class="line"></div><div class="line">        *)</div><div class="line"><span class="built_in">echo</span> <span class="string">"Usage:<span class="variable">$0</span>(Uptime|Com_update|Slow_queries|Com_select|Com_rollback|Questions)"</span></div><div class="line">        ;;</div><div class="line"><span class="keyword">esac</span></div></pre></td></tr></table></figure>
<p>vim /etc/zabbix/slave.sh</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment">#Create by gaosy 2014.09.13</span></div><div class="line">MYSQL_SOCK=<span class="string">"/var/lib/mysql/mysql.sock"</span></div><div class="line">MYSQL_PWD=<span class="string">"l8ka65"</span></div><div class="line">ARGS=1</div><div class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> <span class="_">-ne</span> <span class="string">"<span class="variable">$ARGS</span>"</span> ];<span class="keyword">then</span></div><div class="line">    <span class="built_in">echo</span> <span class="string">"Please input one arguement:"</span></div><div class="line"><span class="keyword">fi</span></div><div class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></div><div class="line">     Slave_SQL_Running)</div><div class="line">         result=`mysql -uzabbix -p<span class="variable">$&#123;MYSQL_PWD&#125;</span> -S <span class="variable">$MYSQL_SOCK</span> -h127.0.0.1 <span class="_">-e</span> <span class="string">"show slave status\G"</span> 2&gt;/dev/null | grep -w Slave_SQL_Running |awk <span class="string">'&#123;print $NF&#125;'</span>|grep -wic YES`</div><div class="line">         <span class="built_in">echo</span> <span class="variable">$result</span></div><div class="line">         ;;</div><div class="line">     Slave_IO_Running)</div><div class="line">          result=`mysql -uzabbix -p<span class="variable">$&#123;MYSQL_PWD&#125;</span> -S <span class="variable">$MYSQL_SOCK</span> -h127.0.0.1 <span class="_">-e</span> <span class="string">"show slave status\G"</span> 2&gt;/dev/null | grep -w Slave_IO_Running |awk <span class="string">'&#123;print $NF&#125;'</span>| grep -wic YES`</div><div class="line">          <span class="built_in">echo</span> <span class="variable">$result</span></div><div class="line">          ;;</div><div class="line">     Master_User)</div><div class="line">          result=`mysql -uzabbix -p<span class="variable">$&#123;MYSQL_PWD&#125;</span> -S <span class="variable">$MYSQL_SOCK</span> -h127.0.0.1 <span class="_">-e</span> <span class="string">"show slave status\G"</span> 2&gt;/dev/null | grep -w Master_User |awk <span class="string">'&#123;print $NF&#125;'</span>`</div><div class="line">          <span class="built_in">echo</span> <span class="variable">$result</span></div><div class="line">          ;;</div><div class="line">     Relay_Log_Space)</div><div class="line">          result=`mysql -uzabbix -p<span class="variable">$&#123;MYSQL_PWD&#125;</span> -S <span class="variable">$MYSQL_SOCK</span> -h127.0.0.1 <span class="_">-e</span> <span class="string">"show slave status\G"</span> 2&gt;/dev/null | grep -w Relay_Log_Space |awk <span class="string">'&#123;print $NF&#125;'</span>`</div><div class="line">          <span class="built_in">echo</span> <span class="variable">$result</span></div><div class="line">          ;;</div><div class="line">     Master_Port)</div><div class="line">          result=`mysql -uzabbix -p<span class="variable">$&#123;MYSQL_PWD&#125;</span> -S <span class="variable">$MYSQL_SOCK</span> -h127.0.0.1 <span class="_">-e</span> <span class="string">"show slave status\G"</span> 2&gt;/dev/null | grep -w Master_Port  |awk <span class="string">'&#123;print $NF&#125;'</span>`</div><div class="line">          <span class="built_in">echo</span> <span class="variable">$result</span></div><div class="line">          ;;</div><div class="line">     Slave_IO_State)</div><div class="line">          result=`mysql -uzabbix -p<span class="variable">$&#123;MYSQL_PWD&#125;</span> -S <span class="variable">$MYSQL_SOCK</span> -h127.0.0.1 <span class="_">-e</span> <span class="string">"show slave status\G"</span> 2&gt;/dev/null | grep -w Slave_IO_State |awk <span class="string">'&#123;print $NF&#125;'</span>`</div><div class="line">          <span class="built_in">echo</span> <span class="variable">$result</span></div><div class="line">          ;;</div><div class="line">     Relay_Log_Pos)</div><div class="line">          result=`mysql -uzabbix -p<span class="variable">$&#123;MYSQL_PWD&#125;</span> -S <span class="variable">$MYSQL_SOCK</span> -h127.0.0.1 <span class="_">-e</span> <span class="string">"show slave status\G"</span> 2&gt;/dev/null | grep -w Relay_Log_Pos  |awk <span class="string">'&#123;print $NF&#125;'</span>`</div><div class="line">          <span class="built_in">echo</span> <span class="variable">$result</span></div><div class="line">          ;;</div><div class="line">     Exec_Master_Log_Pos)</div><div class="line">          result=`mysql -uzabbix -p<span class="variable">$&#123;MYSQL_PWD&#125;</span> -S <span class="variable">$MYSQL_SOCK</span> -h127.0.0.1 <span class="_">-e</span> <span class="string">"show slave status\G"</span> 2&gt;/dev/null | grep -w Exec_Master_Log_Pos |awk <span class="string">'&#123;print $NF&#125;'</span>`</div><div class="line">          <span class="built_in">echo</span> <span class="variable">$result</span></div><div class="line">          ;;</div><div class="line">     Seconds_Behind_Master)</div><div class="line">          result=`mysql -uzabbix -p<span class="variable">$&#123;MYSQL_PWD&#125;</span> -S <span class="variable">$MYSQL_SOCK</span> -h127.0.0.1 <span class="_">-e</span> <span class="string">"show slave status\G"</span> 2&gt;/dev/null | grep -w Seconds_Behind_Master |awk <span class="string">'&#123;print $NF&#125;'</span>`</div><div class="line">          <span class="built_in">echo</span> <span class="variable">$result</span></div><div class="line">          ;;</div><div class="line">     Relay_Log_File)</div><div class="line">          result=`mysql -uzabbix -p<span class="variable">$&#123;MYSQL_PWD&#125;</span> -S <span class="variable">$MYSQL_SOCK</span> -h127.0.0.1 <span class="_">-e</span> <span class="string">"show slave status\G"</span> 2&gt;/dev/null | grep -w Relay_Log_File |awk <span class="string">'&#123;print $NF&#125;'</span>`</div><div class="line">          <span class="built_in">echo</span> <span class="variable">$result</span></div><div class="line">          ;;</div><div class="line">     Relay_Master_Log_File)</div><div class="line">          result=`mysql -uzabbix -p<span class="variable">$&#123;MYSQL_PWD&#125;</span> -S <span class="variable">$MYSQL_SOCK</span> -h127.0.0.1 <span class="_">-e</span> <span class="string">"show slave status\G"</span> 2&gt;/dev/null | grep -w Relay_Master_Log_File |awk <span class="string">'&#123;print $NF&#125;'</span>`</div><div class="line">          <span class="built_in">echo</span> <span class="variable">$result</span></div><div class="line">          ;;</div><div class="line">     Master_Log_File)</div><div class="line">          result=`mysql -uzabbix -p<span class="variable">$&#123;MYSQL_PWD&#125;</span> -S <span class="variable">$MYSQL_SOCK</span> -h127.0.0.1 <span class="_">-e</span> <span class="string">"show slave status\G"</span> 2&gt;/dev/null | grep -w Master_Log_File |awk <span class="string">'&#123;print $NF&#125;'</span>`</div><div class="line">          <span class="built_in">echo</span> <span class="variable">$result</span></div><div class="line">          ;;</div><div class="line">     Read_Master_Log_Pos)</div><div class="line">          result=`mysql -uzabbix -p<span class="variable">$&#123;MYSQL_PWD&#125;</span> -S <span class="variable">$MYSQL_SOCK</span> -h127.0.0.1 <span class="_">-e</span> <span class="string">"show slave status\G"</span> 2&gt;/dev/null | grep -w Read_Master_Log_Pos |awk <span class="string">'&#123;print $NF&#125;'</span>`</div><div class="line">          <span class="built_in">echo</span> <span class="variable">$result</span></div><div class="line">          ;;</div><div class="line">     Master_Host)</div><div class="line">          result=`mysql -uzabbix -p<span class="variable">$&#123;MYSQL_PWD&#125;</span> -S <span class="variable">$MYSQL_SOCK</span> -h127.0.0.1 <span class="_">-e</span> <span class="string">"show slave status\G"</span> 2&gt;/dev/null | grep -w Master_Host |awk <span class="string">'&#123;print $NF&#125;'</span>`</div><div class="line">          <span class="built_in">echo</span> <span class="variable">$result</span></div><div class="line">          ;;</div><div class="line">     *)</div><div class="line">          <span class="built_in">echo</span> <span class="string">"Usage:<span class="variable">$0</span>(Master_Host|Read_Master_Log_Pos|Master_Log_File|Relay_Master_Log_File|....)"</span></div><div class="line">          ;;</div><div class="line"><span class="keyword">esac</span></div></pre></td></tr></table></figure>
<p>配置好查看获取数据是否正常：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@Frankfurt-DB-slave zabbix]<span class="comment"># sh mysql.sh Uptime</span></div><div class="line">Warning: Using a password on the <span class="built_in">command</span> line interface can be insecure.</div><div class="line">23511</div><div class="line">[root@Frankfurt-DB-slave zabbix]<span class="comment"># sh mysql.sh Bytes_sent</span></div><div class="line">Warning: Using a password on the <span class="built_in">command</span> line interface can be insecure.</div><div class="line">126539807</div></pre></td></tr></table></figure>
<p>重启服务配置zabbix</p>
<p>添加zabbix自带模板：Template App MySQL<br>导入主从模板<a href="http://oak0aohum.bkt.clouddn.com/jollychic-mysql-slave.xml" target="_blank" rel="external">    jollychic-mysql-slave.xml</a></p>
<p><figure class="figure"><img src="media/15067354997472.jpg" alt=""></figure></p>
<h5 id="常见错误解决思路"><a href="#常见错误解决思路" class="headerlink" title="常见错误解决思路"></a>常见错误解决思路</h5><p>如果发现监控没有数据，请排查如下问题</p>
<ol>
<li>zabbix客户端是否重启</li>
<li>脚本是否有执行权限</li>
<li>数据库是否有权限</li>
<li>环境变量是否有问题</li>
<li>请看zabbix item列，鼠标移至红色叉上，有错误提示。</li>
<li>如果数据库密码保存在脚本中，会导致监控没有数据会不断的报错为Warning: Using a password on the command line interface can be insecure.需要将帐号密码等配置添加到my.cnf中。</li>
</ol>
<h3 id="交流学习："><a href="#交流学习：" class="headerlink" title="交流学习："></a>交流学习：</h3><p>🐧  Linux shell_高级运维派: <code>459096184</code>    圈子 (系统运维-应用运维-自动化运维-虚拟化技术研究欢迎加入)<br>🐧  BigData-Exchange School : <code>521621407</code>  圈子（大数据运维)（Hadoop开发人员)（大数据研究爱好者) 欢迎加入</p>
<p>相应Bidata有内部微信交流群互相学习，加入QQ群有链接。</p>

	

	
		<span class="different-posts"><a href="/2017/04/21/性能监控/Zabbix/zabbix监控MySQL5.6 master-slave主从/" onclick="window.history.go(-1); return false;">⬅️ Go back </a></span>

	

</article>

	</main>

	<footer class="footer">
	<div class="footer-content">
		
	      <div class="footer__element">
	<h5>Hi there,</h5>
	<p style="text-align:justify;">my name is Yancy, they know me as Radiant🐑🐑. This blog is about Bi-data and my live.<br> I like 🌳🌳🌳</p>
</div>


	    
	      <div class="footer__element">
	<h5>Check out</h5>
	<ul class="footer-links">
		<li class="footer-links__link"><a href="/archives">Archive</a></li>
		
		  <li class="footer-links__link"><a href="/atom.xml">RSS</a></li>
	    
		<li class="footer-links__link"><a href="/about">about page</a></li>
		<li class="footer-links__link"><a href="/tags">Tags</a></li>
		<li class="footer-links__link"><a href="/categories">Categories</a></li>
	</ul>
</div>

	    

		<div class="footer-credit">
			<span>© 2017 Yancy | Powered by <a href="http://blog.yancy.cc/">Yancy</a> | Theme <a href="https://github.com/yangcvo">Yancy_GitHub</a></span>
		</div>

	</div>


</footer>



</body>

</html>
