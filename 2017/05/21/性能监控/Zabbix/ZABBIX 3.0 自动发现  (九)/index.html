<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>ZABBIX 3.0 自动发现  (九) | Yancy&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="####自动化分类 所有的自动化都可以分为2种   1.自动注册    zabbix-agnet自动添加    2.主动发现    自动发现 Discover zabbix api">
<meta name="keywords" content="Zabbix monitoring">
<meta property="og:type" content="article">
<meta property="og:title" content="ZABBIX 3.0 自动发现  (九)">
<meta property="og:url" content="http://blog.yancy.cc/2017/05/21/性能监控/Zabbix/ZABBIX 3.0 自动发现  (九)/index.html">
<meta property="og:site_name" content="Yancy&#39;s blog">
<meta property="og:description" content="####自动化分类 所有的自动化都可以分为2种   1.自动注册    zabbix-agnet自动添加    2.主动发现    自动发现 Discover zabbix api">
<meta property="og:image" content="http://7xrthw.com1.z0.glb.clouddn.com/zabbix3.0-zidong.png">
<meta property="og:image" content="http://7xrthw.com1.z0.glb.clouddn.com/zabbix3.0-zidong1.png">
<meta property="og:image" content="http://7xrthw.com1.z0.glb.clouddn.com/zabbix3.0-zidong2.png">
<meta property="og:image" content="http://7xrthw.com1.z0.glb.clouddn.com/zabbix3.0-zidong3.png">
<meta property="og:image" content="http://7xrthw.com1.z0.glb.clouddn.com/zabbix3.0-zidong4.png">
<meta property="og:image" content="http://7xrthw.com1.z0.glb.clouddn.com/zabbix3.0-zidong6.png">
<meta property="og:image" content="http://7xrthw.com1.z0.glb.clouddn.com/zabbix3.0-zidong7.png">
<meta property="og:image" content="http://7xrthw.com1.z0.glb.clouddn.com/zabbix3.0-zidong8.png">
<meta property="og:image" content="http://7xrthw.com1.z0.glb.clouddn.com/zabbix3.0-zidong9.png">
<meta property="og:updated_time" content="2017-11-22T07:06:47.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ZABBIX 3.0 自动发现  (九)">
<meta name="twitter:description" content="####自动化分类 所有的自动化都可以分为2种   1.自动注册    zabbix-agnet自动添加    2.主动发现    自动发现 Discover zabbix api">
<meta name="twitter:image" content="http://7xrthw.com1.z0.glb.clouddn.com/zabbix3.0-zidong.png">
  
  <link rel="stylesheet" href="/css/index.css">
</head>

<body style="


  background-color: #eff0f6

">
  <div id="container">
    <nav id="nav">
  <header class="header">
    <a href="/" class="title">Clover Tuan</a>
  </header>
  <div class="ctnWrap">
    <div class="icons">
      
        
          
            <a href="https://dribbble.com/clovertuan" target="_blank" class="nav-icn iconfont icon-dribbble"></a>
          
        
          
            <a href="https://www.behance.net/clovertuan" target="_blank" class="nav-icn iconfont icon-behance"></a>
          
        
          
            <a href="http://clovertuan.lofter.com/" target="_blank" class="nav-icn iconfont icon-lofter"></a>
          
        
          
            <a href="https://www.instagram.com/clovertuan/" target="_blank" class="nav-icn iconfont icon-instagram"></a>
          
        
          
            <a href="https://github.com/cloverTuan" target="_blank" class="nav-icn iconfont icon-github"></a>
          
        
      
    </div>
    <div class="menu">
      
        
            <a href="/" class="nav-menu ">HOME</a>
          
        
            <a href="/archives" class="nav-menu ">ARCHIVE</a>
          
        
            <a href="/about" class="nav-menu ">ABOUT</a>
          
        
      
    </div>
  </div>
</nav>
    <div id="main"><section class="article">
  <h2 class="title">ZABBIX 3.0 自动发现  (九)</h2>
  <p class="sub">May 21, 2017</p>
  <article class="content">
    <h4 id="Zabbix自动发现-Discovery-功能使用"><a href="#Zabbix自动发现-Discovery-功能使用" class="headerlink" title="Zabbix自动发现(Discovery)功能使用"></a>Zabbix自动发现(Discovery)功能使用</h4><p>随着监控主机不断增多，有的时候需要添加一批机器，特别是刚用zabbix的运维人员需要将公司的所有服务器添加到zabbix，如果使用传统办法去单个添加设备、分组、项目、图像…..结果应该是让人吐的结果。<br>鉴于这个问题我们可以好好利用下Zabbix的一个发现(Discovery)模块，进而来实现<code>自动刚发现主机、自动将主机添加到主机组、自动加载模板、自动创建项目（item）、自动创建图像</code>，下面我们来看看这个模块如何使用。</p>
<p>#####Hadoop集群自动发现：</p>
<p><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix3.0-zidong.png" alt=""></p>
<h5 id="一、自动注册设置-zabbix-agent配置"><a href="#一、自动注册设置-zabbix-agent配置" class="headerlink" title="一、自动注册设置 zabbix-agent配置"></a>一、自动注册设置 zabbix-agent配置</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">[root@wlj-datanode10 zabbix]<span class="comment"># cat zabbix_agentd.conf</span></div><div class="line">PidFile=/var/run/zabbix/zabbix_agentd.pid</div><div class="line">LogFile=/var/<span class="built_in">log</span>/zabbix/zabbix_agentd.log</div><div class="line">LogFileSize=0</div><div class="line">Server=10.155.74.153</div><div class="line"><span class="comment"># 主动模式下的zabbix服务端</span></div><div class="line">ServerActive=10.155.74.153</div><div class="line"><span class="comment"># 主机名(这个会自动加入到zabbix-server断的主机显示中)</span></div><div class="line">Hostname=wlj-datanode10.jollychic.com-169.44.23.133</div><div class="line">Timeout=10</div><div class="line">UnsafeUserParameters=1</div><div class="line">HostMetadata=bi  <span class="comment"># 作为server端的判断条件入口</span></div></pre></td></tr></table></figure>
<p>我们先不重启，因为重启就生效了。我们需要设置一个规则，如果已经设置好规则可以重启。</p>
<p>✨✨提示： zabbix-agent起来的时候回去找Server，这时候就会产生一个事件，然后我们可以基于这个事件来完成一个动作。 </p>
<ul>
<li>Configuration - Actions - Create action</li>
</ul>
<p><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix3.0-zidong1.png" alt=""></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">name:bi-data</div><div class="line">Default subject : Auto registration: &#123;HOST.HOST&#125;</div><div class="line">Default message :</div><div class="line"></div><div class="line">Host name: &#123;HOST.HOST&#125;</div><div class="line">Host IP: &#123;HOST.IP&#125;</div><div class="line">Agent port: &#123;HOST.PORT&#125;</div></pre></td></tr></table></figure>
<p><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix3.0-zidong2.png" alt=""></p>
<p>选择新的触发条件选择下拉框中的服务类型</p>
<p><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix3.0-zidong3.png" alt=""></p>
<ul>
<li>选择发送告警对应的用户组-发送方式微信告警</li>
</ul>
<p><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix3.0-zidong4.png" alt=""></p>
<ul>
<li>选择自动发现服务器添加相应的分组</li>
</ul>
<p><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix3.0-zidong6.png" alt=""></p>
<ul>
<li>选择自动发现服务器添加相应监控模板</li>
</ul>
<p><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix3.0-zidong7.png" alt=""></p>
<p>修改完之后我们在重启一下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@wlj-datanode3 ~]<span class="comment"># systemctl restart zabbix-agent.service</span></div></pre></td></tr></table></figure>
<p>自动发现可以去扫描IP地址范围（需要手动设置）进行发现的动作 </p>
<p><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix3.0-zidong8.png" alt=""></p>
<h4 id="监控告警接收："><a href="#监控告警接收：" class="headerlink" title="监控告警接收："></a>监控告警接收：</h4><p><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix3.0-zidong9.png" alt=""></p>
<h3 id="交流学习："><a href="#交流学习：" class="headerlink" title="交流学习："></a>交流学习：</h3><p>🐧  Linux shell_高级运维派: <code>459096184</code>    圈子 (系统运维-应用运维-自动化运维-虚拟化技术研究欢迎加入)<br>🐧  BigData-Exchange School : <code>521621407</code>  圈子（大数据运维)（Hadoop开发人员)（大数据研究爱好者) 欢迎加入</p>
<p>相应Bidata有内部微信交流群互相学习，加入QQ群有链接。</p>
  </article>
  <footer class="f-cf">
    
      <a href="/2017/05/25/Bigdata-hadoop/Kafka/Bigdata-开源的Kafka集群管理器(kafka-web-console)/" class="link f-fl">⟵Bigdata-开源的Kafka集群管理器(kafka-web-console)</a>
    
    
      <a href="/2017/05/11/日志分析平台/Elasticsearch/ElasticStack 5.x集群+Kibana-5.5.x+Logstash5.5+kafka2.10版本部署概述/" class="link f-fr">ElasticStack 5.x集群+Kibana-5.5.x+Logstash5.5+kafka2.10版本部署概述⟶</a>
    
  </footer>
</section></div>
    <footer id="footer" class="f-cf">
  d.guangying@foxmail.com
  
    
      
        · <a href="https://dribbble.com/clovertuan" target="_blank" class="nav-icn">Dribbble</a>
      
    
      
        · <a href="https://www.behance.net/clovertuan" target="_blank" class="nav-icn">Behance</a>
      
    
      
        · <a href="http://clovertuan.lofter.com/" target="_blank" class="nav-icn">Lofter</a>
      
    
      
        · <a href="https://www.instagram.com/clovertuan/" target="_blank" class="nav-icn">Instagram</a>
      
    
      
        · <a href="https://github.com/cloverTuan" target="_blank" class="nav-icn">GitHub</a>
      
    
  
  <span class="copyright">All rights reserved @Clover Tuan</span>
</footer>
  </div>
</body>
</html>