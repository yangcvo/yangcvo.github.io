<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>KafKaä¸æ‡‚å°±å­¦å°±é—®å°±è§£ç­”ç¬”è®° | Yancy&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="1. éƒ¨ç½²ç”Ÿäº§ç¯å¢ƒï¼Œæ‰“ç®—éƒ¨ç½²ä¸‰ä¸ªbrokerå®ä¾‹ï¼Œä½†zookeeperéƒ¨ç½²ä¸€ä¸ªå¯ä»¥å—?1ç­”æ¡ˆï¼šå¯ä»¥æ˜¯å¯ä»¥ï¼Œä½†ä¸ºäº†å®¹é”™è¿˜æ˜¯éƒ¨ç½²zookeeperé›†ç¾¤æ¯”è¾ƒå¥½ã€‚brokerå’Œzookeeperçš„å¯¹åº”æ¯”ä¾‹å€’æ˜¯æ²¡ä»€ä¹ˆï¼Œéƒ½æ˜¯ç‹¬ç«‹é›†ç¾¤ã€‚">
<meta name="keywords" content="Kafka">
<meta property="og:type" content="article">
<meta property="og:title" content="KafKaä¸æ‡‚å°±å­¦å°±é—®å°±è§£ç­”ç¬”è®°">
<meta property="og:url" content="http://blog.yancy.cc/2017/09/11/Bigdata-hadoop/Kafka/KafKaä¸æ‡‚å°±å­¦å°±é—®å°±è§£ç­”ç¬”è®°/index.html">
<meta property="og:site_name" content="Yancy&#39;s blog">
<meta property="og:description" content="1. éƒ¨ç½²ç”Ÿäº§ç¯å¢ƒï¼Œæ‰“ç®—éƒ¨ç½²ä¸‰ä¸ªbrokerå®ä¾‹ï¼Œä½†zookeeperéƒ¨ç½²ä¸€ä¸ªå¯ä»¥å—?1ç­”æ¡ˆï¼šå¯ä»¥æ˜¯å¯ä»¥ï¼Œä½†ä¸ºäº†å®¹é”™è¿˜æ˜¯éƒ¨ç½²zookeeperé›†ç¾¤æ¯”è¾ƒå¥½ã€‚brokerå’Œzookeeperçš„å¯¹åº”æ¯”ä¾‹å€’æ˜¯æ²¡ä»€ä¹ˆï¼Œéƒ½æ˜¯ç‹¬ç«‹é›†ç¾¤ã€‚">
<meta property="og:image" content="https://www.confluent.io/wp-content/uploads/2016/09/Event-sourced-based-architecture.jpeg">
<meta property="og:updated_time" content="2017-12-03T06:44:53.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="KafKaä¸æ‡‚å°±å­¦å°±é—®å°±è§£ç­”ç¬”è®°">
<meta name="twitter:description" content="1. éƒ¨ç½²ç”Ÿäº§ç¯å¢ƒï¼Œæ‰“ç®—éƒ¨ç½²ä¸‰ä¸ªbrokerå®ä¾‹ï¼Œä½†zookeeperéƒ¨ç½²ä¸€ä¸ªå¯ä»¥å—?1ç­”æ¡ˆï¼šå¯ä»¥æ˜¯å¯ä»¥ï¼Œä½†ä¸ºäº†å®¹é”™è¿˜æ˜¯éƒ¨ç½²zookeeperé›†ç¾¤æ¯”è¾ƒå¥½ã€‚brokerå’Œzookeeperçš„å¯¹åº”æ¯”ä¾‹å€’æ˜¯æ²¡ä»€ä¹ˆï¼Œéƒ½æ˜¯ç‹¬ç«‹é›†ç¾¤ã€‚">
<meta name="twitter:image" content="https://www.confluent.io/wp-content/uploads/2016/09/Event-sourced-based-architecture.jpeg">
  
  <link rel="stylesheet" href="/css/index.css">
</head>

<body style="


  background-color: #eff0f6

">
  <div id="container">
    <nav id="nav">
  <header class="header">
    <a href="/" class="title">Clover Tuan</a>
  </header>
  <div class="ctnWrap">
    <div class="icons">
      
        
          
            <a href="https://dribbble.com/clovertuan" target="_blank" class="nav-icn iconfont icon-dribbble"></a>
          
        
          
            <a href="https://www.behance.net/clovertuan" target="_blank" class="nav-icn iconfont icon-behance"></a>
          
        
          
            <a href="http://clovertuan.lofter.com/" target="_blank" class="nav-icn iconfont icon-lofter"></a>
          
        
          
            <a href="https://www.instagram.com/clovertuan/" target="_blank" class="nav-icn iconfont icon-instagram"></a>
          
        
          
            <a href="https://github.com/cloverTuan" target="_blank" class="nav-icn iconfont icon-github"></a>
          
        
      
    </div>
    <div class="menu">
      
        
            <a href="/" class="nav-menu ">HOME</a>
          
        
            <a href="/archives" class="nav-menu ">ARCHIVE</a>
          
        
            <a href="/about" class="nav-menu ">ABOUT</a>
          
        
      
    </div>
  </div>
</nav>
    <div id="main"><section class="article">
  <h2 class="title">KafKaä¸æ‡‚å°±å­¦å°±é—®å°±è§£ç­”ç¬”è®°</h2>
  <p class="sub">Sep 11, 2017</p>
  <article class="content">
    <h5 id="2-kafkaé›†ç¾¤ä¸ºä»€ä¹ˆéœ€è¦zookeeperæ¥é…åˆï¼Ÿ"><a href="#2-kafkaé›†ç¾¤ä¸ºä»€ä¹ˆéœ€è¦zookeeperæ¥é…åˆï¼Ÿ" class="headerlink" title="2. kafkaé›†ç¾¤ä¸ºä»€ä¹ˆéœ€è¦zookeeperæ¥é…åˆï¼Ÿ"></a>2. kafkaé›†ç¾¤ä¸ºä»€ä¹ˆéœ€è¦zookeeperæ¥é…åˆï¼Ÿ</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ç­”æ¡ˆï¼šzookeeper æ˜¯ä½œä¸ºæ€§èƒ½åè°ƒå·¥å…·çš„è§’è‰²å­˜åœ¨ã€‚å­˜å‚¨ç€ä½ KafkaæœåŠ¡çš„ä¸€äº›äº›å…ƒæ•°æ®ï¼ˆpartitionsã€offsetç­‰ç­‰ï¼‰ã€‚zookeeperé›†ç¾¤çš„ä½œç”¨åœ¨äºä¿è¯ZookeeperæœåŠ¡çš„é«˜å¯ç”¨ã€‚å› æ­¤ä½ å¯ä»¥æ ¹æ®ä½ çš„éœ€è¦æ¥é€‰æ‹©æ˜¯å¦æ„å»ºzookeeperé›†ç¾¤ã€‚</div></pre></td></tr></table></figure>
<h5 id="3-æŸ¥çœ‹kafka-topic-æ¶ˆè´¹è®°å½•æŠ¥é”™WARN-Session-0x0-for-server-null-unexpected-error-closing-socket-connection-and-attempting-reconnect-org-apache-zookeeper-ClientCnxn"><a href="#3-æŸ¥çœ‹kafka-topic-æ¶ˆè´¹è®°å½•æŠ¥é”™WARN-Session-0x0-for-server-null-unexpected-error-closing-socket-connection-and-attempting-reconnect-org-apache-zookeeper-ClientCnxn" class="headerlink" title="3. æŸ¥çœ‹kafka topic æ¶ˆè´¹è®°å½•æŠ¥é”™WARN Session 0x0 for server null, unexpected error, closing socket connection and attempting reconnect (org.apache.zookeeper.ClientCnxn)"></a>3. æŸ¥çœ‹kafka topic æ¶ˆè´¹è®°å½•æŠ¥é”™WARN Session 0x0 for server null, unexpected error, closing socket connection and attempting reconnect (org.apache.zookeeper.ClientCnxn)</h5><p>java.net.ConnectException: Connection timed out</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">é—®é¢˜ï¼š</div><div class="line">1.æ˜¯kafkaè¿ä¸ä¸Šzookeeperäº†ã€‚è¯·æ£€æŸ¥ zk é›†ç¾¤æ˜¯å¦æ­£å¸¸èƒ½Telnetï¼Œkafkaé›†ç¾¤æ˜¯å¦æ­£å¸¸ã€‚</div><div class="line">2.æ£€æŸ¥server.properties ä¸­zookeeper.connectæ˜¯å¦é…ç½®æ­£ç¡®ï¼Œå¦‚æœéƒ½æ²¡æœ‰é—®é¢˜ï¼Œé‡æ–°å¯åŠ¨æœåŠ¡ã€‚</div></pre></td></tr></table></figure>
<h5 id="4-kafka-æ”¯æŒå‹ç¼©ä¼ è¾“å—ï¼Ÿ"><a href="#4-kafka-æ”¯æŒå‹ç¼©ä¼ è¾“å—ï¼Ÿ" class="headerlink" title="4. kafka æ”¯æŒå‹ç¼©ä¼ è¾“å—ï¼Ÿ"></a>4. kafka æ”¯æŒå‹ç¼©ä¼ è¾“å—ï¼Ÿ</h5><h5 id="5-Kafka-å¦‚ä½•åœ¨å¼€å¯æ•°æ®å‹ç¼©çš„æƒ…å†µä¸‹-consumerç»´æŠ¤è‡ªå·±çš„offset"><a href="#5-Kafka-å¦‚ä½•åœ¨å¼€å¯æ•°æ®å‹ç¼©çš„æƒ…å†µä¸‹-consumerç»´æŠ¤è‡ªå·±çš„offset" class="headerlink" title="5. Kafka å¦‚ä½•åœ¨å¼€å¯æ•°æ®å‹ç¼©çš„æƒ…å†µä¸‹, consumerç»´æŠ¤è‡ªå·±çš„offset?"></a>5. Kafka å¦‚ä½•åœ¨å¼€å¯æ•°æ®å‹ç¼©çš„æƒ…å†µä¸‹, consumerç»´æŠ¤è‡ªå·±çš„offset?</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">é—®é¢˜ï¼š</div><div class="line">kafkaè¿™è¾¹æ•°æ®ä¼ è¾“æ¶ˆè´¹è·¨awsæœºæˆ¿è¾ƒæ…¢ã€‚ä¼šæœ‰ç½‘ç»œç“¶é¢ˆ,æˆ‘ä»¬kafkaåœ¨å›½å¤–çš„ä¸€dalasiæœºæˆ¿ï¼Œæ¶ˆè´¹ç«¯åœ¨dalasiã€‚</div><div class="line"></div><div class="line">å®˜ç½‘è§£ç­”ï¼š</div><div class="line">Offset management on the consumer</div><div class="line"></div><div class="line">The data received by a consumer <span class="keyword">for</span> a topic might contain both compressed as well as uncompressed messages. The consumer iterator transparently decompresses compressed data and only returns an uncompressed message. The offset maintenance <span class="keyword">in</span> the consumer gets a little tricky. In the zookeeper consumer, the consumed offset is updated each time a message is returned. This consumed offset should be a valid fetch offset <span class="keyword">for</span> correct failure recovery. Since data is stored <span class="keyword">in</span> compressed format on the broker, valid fetch offsets are the compressed message boundaries. Hence, <span class="keyword">for</span> compressed data, the consumed offset will be advanced one compressed message at a time. This has the side effect of possible duplicates <span class="keyword">in</span> the event of a consumer failure. For uncompressed data, consumed offset will be advanced one message at a time.</div><div class="line"></div><div class="line">è¿™æ®µè¯ä¸æ˜¯å¾ˆç†è§£: producerå°†100æ¡messageå‹ç¼©æˆ1æ¡å‘ç»™brokerå, brokeræ˜¯å¦‚ä½•å­˜å‚¨çš„ï¼Œå¹¶ä¸”consumeræ˜¯å¦‚ä½•å–å‡ºè¿™å‹ç¼©åçš„æ•°æ®, å¹¶ç»´æŠ¤offsetçš„?</div><div class="line"></div><div class="line"><span class="comment">### æ¶ˆæ¯å‹ç¼©ï¼ˆmessage compressionï¼‰</span></div><div class="line"></div><div class="line">è€ƒè™‘åˆ°ç½‘ç»œå¸¦å®½çš„ç“¶é¢ˆï¼ŒKafkaæä¾›äº†æ¶ˆæ¯ç»„å‹ç¼©ç‰¹æ€§ã€‚Kafkaé€šè¿‡é€’å½’æ¶ˆæ¯é›†æ¥æ”¯æŒé«˜æ•ˆå‹ç¼©ã€‚é«˜æ•ˆå‹ç¼©éœ€è¦å¤šä¸ªæ¶ˆæ¯åŒæ—¶å‹ç¼©ï¼Œè€Œä¸æ˜¯å¯¹æ¯ä¸ªæ¶ˆæ¯å•ç‹¬å‹ç¼©ã€‚ä¸€æ‰¹æ¶ˆæ¯å‹ç¼©åœ¨ä¸€èµ·å‘é€ç»™brokerã€‚å‹ç¼©æ¶ˆæ¯é›†é™ä½äº†ç½‘ç»œçš„è´Ÿè½½ï¼Œä½†æ˜¯è§£å‹ç¼©ä¹Ÿå¸¦æ¥äº†ä¸€äº›é¢å¤–çš„å¼€é”€ã€‚æ¶ˆæ¯é›†çš„è§£å‹ç¼©æ˜¯ç”±brokerå¤„ç†æ¶ˆæ¯offsetæ—¶å®Œæˆçš„ã€‚</div><div class="line"></div><div class="line">æ¯ä¸ªæ¶ˆæ¯å¯é€šè¿‡ä¸€ä¸ªä¸å¯æ¯”è¾ƒçš„ã€é€’å¢çš„é€»è¾‘offsetè®¿é—®ï¼Œè¿™ä¸ªé€»è¾‘offsetåœ¨æ¯ä¸ªåˆ†åŒºå†…æ˜¯å”¯ä¸€çš„ã€‚æ¥æ”¶åˆ°å‹ç¼©æ•°æ®åï¼Œlead brokerå°†æ¶ˆæ¯é›†è§£å‹ç¼©ï¼Œä¸ºæ¯ä¸ªæ¶ˆæ¯åˆ†é…offsetã€‚offsetåˆ†é…å®Œæˆåï¼Œleaderå†æ¬¡å°†æ¶ˆæ¯é›†å‹ç¼©å¹¶å†™å…¥ç£ç›˜ã€‚</div><div class="line"></div><div class="line">åœ¨Kafkaä¸­ï¼Œæ•°æ®çš„å‹ç¼©ç”±producerå®Œæˆï¼Œå¯ä½¿ç”¨GZIPæˆ–Snappyå‹ç¼©åè®®ã€‚åŒæ—¶éœ€è¦åœ¨producerç«¯é…ç½®ç›¸å…³çš„å‚æ•°ï¼š</div><div class="line"></div><div class="line">compression.codecï¼šæŒ‡å®šå‹ç¼©æ ¼å¼ï¼Œé»˜è®¤ä¸ºnoneï¼Œå¯é€‰çš„å€¼è¿˜æœ‰gzipå’Œsnappyã€‚</div><div class="line">compressed.topicsï¼šè®¾ç½®å¯¹æŒ‡å®šçš„topicå¼€å¯å‹ç¼©ï¼Œé»˜è®¤ä¸ºnullã€‚å½“compression.codecä¸ä¸ºnoneæ—¶ï¼Œå¯¹æŒ‡å®šçš„topicå¼€å¯å‹ç¼©ï¼›å¦‚æœcompressed.topicsä¸ºnullåˆ™å¯¹æ‰€æœ‰topicå¼€å¯å‹ç¼©ã€‚</div><div class="line">æ¶ˆæ¯é›†ByteBufferMessageSetå¯èƒ½æ—¢åŒ…å«å‹ç¼©æ•°æ®ä¹ŸåŒ…å«éå‹ç¼©æ•°æ®ï¼Œä¸ºäº†åŒºåˆ†å¼€æ¥ï¼Œæ¶ˆæ¯å¤´ä¸­æ·»åŠ äº†å‹ç¼©å±æ€§å­—èŠ‚ã€‚åœ¨è¯¥å­—èŠ‚ä¸­ï¼Œæœ€ä½ä½çš„ä¸¤ä½è¡¨ç¤ºå‹ç¼©æ ¼å¼ï¼Œå¦‚æœéƒ½æ˜¯0è¡¨ç¤ºéå‹ç¼©æ•°æ®ã€‚</div></pre></td></tr></table></figure>
<h3 id="Communicative-learning"><a href="#Communicative-learning" class="headerlink" title="Communicative learning:"></a>Communicative learning:</h3><p>ğŸ§  Linux shell_ senior operation and maintenance faction: QQ group <code>459096184</code> circle (system operation and maintenance - application operation and maintenance - automation operation and maintenance - virtualization technology research, welcome to join)<br>ğŸ§  BigData-Exchange School:QQ group <code>521621407</code> circles (big data Yun Wei) (Hadoop developer) (big data research enthusiasts) welcome to join</p>
<p>Bidata have internal WeChat exchange group, learn from each other, join QQ group has links.</p>
  </article>
  <footer class="f-cf">
    
      <a href="/2017/09/14/æ—¥å¿—åˆ†æå¹³å°/Elasticsearch/ELKæ¶æ„æ¢³ç†-ä¹‹ES 2.4åŒå®ä¾‹å¹³æ»‘å‡çº§è‡³5.2.1è¸©å‘å¹¶supervisorç®¡ç†ç¬”è®°/" class="link f-fl">âŸµELKæ¶æ„æ¢³ç†-ä¹‹ES2.4åŒå®ä¾‹å¹³æ»‘å‡çº§è‡³5.2.1è¸©å‘å¹¶supervisorç®¡ç†ç¬”è®°</a>
    
    
      <a href="/2017/08/27/Bigdata-hadoop/zookeeper/Bigdata-Zookeeperé›†ç¾¤æ—¥å¿—é…ç½®è¯¦è§£å’Œæ¸…ç†è‡ªå®šä¹‰å¯åŠ¨å†…å­˜ /" class="link f-fr">Bigdata-Zookeeperé›†ç¾¤æ—¥å¿—é…ç½®è¯¦è§£å’Œæ¸…ç†è‡ªå®šä¹‰å¯åŠ¨å†…å­˜âŸ¶</a>
    
  </footer>
</section></div>
    <footer id="footer" class="f-cf">
  d.guangying@foxmail.com
  
    
      
        Â· <a href="https://dribbble.com/clovertuan" target="_blank" class="nav-icn">Dribbble</a>
      
    
      
        Â· <a href="https://www.behance.net/clovertuan" target="_blank" class="nav-icn">Behance</a>
      
    
      
        Â· <a href="http://clovertuan.lofter.com/" target="_blank" class="nav-icn">Lofter</a>
      
    
      
        Â· <a href="https://www.instagram.com/clovertuan/" target="_blank" class="nav-icn">Instagram</a>
      
    
      
        Â· <a href="https://github.com/cloverTuan" target="_blank" class="nav-icn">GitHub</a>
      
    
  
  <span class="copyright">All rights reserved @Clover Tuan</span>
</footer>
  </div>
</body>
</html>