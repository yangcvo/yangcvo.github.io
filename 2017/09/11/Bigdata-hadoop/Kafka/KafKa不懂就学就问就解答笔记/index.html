<!DOCTYPE html>
<html lang="zh-CN">









<head>
    <meta charset="utf-8" />
    <link rel="apple-touch-icon" sizes="76x76" href="../img/favicon.png">
    <link rel="icon" type="image/png" href="../img/favicon.png">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no" name="viewport" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="description" content="Personal blog, thinking and sharing of technology and life">
    <meta name="author" content="Yancy">
    <meta name="keywords" content="undefined">
    <title>KafKaä¸æ‡‚å°±å­¦å°±é—®å°±è§£ç­”ç¬”è®° ~ Yancy&#39;s blog</title>
    <link rel="stylesheet" href="/css/Material_Icons.css">
    <!-- <link rel="stylesheet" href="/css/font-awesome.css"> -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css">
    <link rel="stylesheet" href="/css/style.css">
    
        <link rel="stylesheet" href="/css/post.css">
        
            <link rel="stylesheet" href="/css/Prettify/tomorrow-night-eighties.min.css">
        
    
</head>

<body class=" sidebar-collapse">
<nav class="navbar navbar-transparent navbar-color-on-scroll fixed-top navbar-expand-lg" color-on-scroll="100" id="sectionsNav">
    <div class="container">
        <div class="navbar-translate">
            <a class="navbar-brand" href="/">
                Yancy&#39;s blog</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" aria-expanded="false" aria-label="Toggle navigation">
                <span class="sr-only">Toggle navigation</span>
                <span class="navbar-toggler-icon"></span>
                <span class="navbar-toggler-icon"></span>
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
            <div class="collapse navbar-collapse">
                <ul class="navbar-nav ml-auto">
                    
                        
                            <li class="nav-item">
                                <a class="nav-link" href="/archives/">
                                    archives
                                </a>
                            </li>
                        
                            <li class="nav-item">
                                <a class="nav-link" href="/about/">
                                    about
                                </a>
                            </li>
                        
                    
                    
                        
                            <li class="nav-item">
                                <a class="nav-link" rel="tooltip" title="" data-placement="bottom" href="" target="_blank" data-original-title="See me here">
                                    <i class="fa fa-github"></i>
                                </a>
                            </li>
                        
                            <li class="nav-item">
                                <a class="nav-link" rel="tooltip" title="" data-placement="bottom" href="" target="_blank" data-original-title="See me here">
                                    <i class="fa fa-twitter"></i>
                                </a>
                            </li>
                        
                    
                </ul>
            </div>
    </div>
</nav>
    
  <div class="page-header header-filter" data-parallax="true" style="background-image: url('../img/post-head.jpg')">
    
      <div class="container">
        <h1 class="title text-center">KafKaä¸æ‡‚å°±å­¦å°±é—®å°±è§£ç­”ç¬”è®°</h1>
        <p class="text-center"><b>Monday, September 11th 2017, 11:22 am</b></p>
      </div>
    
  </div>


  <div class="main main-raised">
    <div class="container">
      <div class="section">
        


<div class="row">
    <div class="col-md-7 offset-md-2">
        <div class="post_content tocbot-content">
            <h4 id="1-éƒ¨ç½²ç”Ÿäº§ç¯å¢ƒï¼Œæ‰“ç®—éƒ¨ç½²ä¸‰ä¸ªbrokerå®ä¾‹ï¼Œä½†zookeeperéƒ¨ç½²ä¸€ä¸ªå¯ä»¥å—"><a href="#1-éƒ¨ç½²ç”Ÿäº§ç¯å¢ƒï¼Œæ‰“ç®—éƒ¨ç½²ä¸‰ä¸ªbrokerå®ä¾‹ï¼Œä½†zookeeperéƒ¨ç½²ä¸€ä¸ªå¯ä»¥å—" class="headerlink" title="1. éƒ¨ç½²ç”Ÿäº§ç¯å¢ƒï¼Œæ‰“ç®—éƒ¨ç½²ä¸‰ä¸ªbrokerå®ä¾‹ï¼Œä½†zookeeperéƒ¨ç½²ä¸€ä¸ªå¯ä»¥å—?"></a>1. éƒ¨ç½²ç”Ÿäº§ç¯å¢ƒï¼Œæ‰“ç®—éƒ¨ç½²ä¸‰ä¸ªbrokerå®ä¾‹ï¼Œä½†zookeeperéƒ¨ç½²ä¸€ä¸ªå¯ä»¥å—?</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ç­”æ¡ˆï¼šå¯ä»¥æ˜¯å¯ä»¥ï¼Œä½†ä¸ºäº†å®¹é”™è¿˜æ˜¯éƒ¨ç½²zookeeperé›†ç¾¤æ¯”è¾ƒå¥½ã€‚brokerå’Œzookeeperçš„å¯¹åº”æ¯”ä¾‹å€’æ˜¯æ²¡ä»€ä¹ˆï¼Œéƒ½æ˜¯ç‹¬ç«‹é›†ç¾¤ã€‚</div></pre></td></tr></table></figure>
<p><img src="https://www.confluent.io/wp-content/uploads/2016/09/Event-sourced-based-architecture.jpeg" alt=""></p>
<a id="more"></a>
<h5 id="2-kafkaé›†ç¾¤ä¸ºä»€ä¹ˆéœ€è¦zookeeperæ¥é…åˆï¼Ÿ"><a href="#2-kafkaé›†ç¾¤ä¸ºä»€ä¹ˆéœ€è¦zookeeperæ¥é…åˆï¼Ÿ" class="headerlink" title="2. kafkaé›†ç¾¤ä¸ºä»€ä¹ˆéœ€è¦zookeeperæ¥é…åˆï¼Ÿ"></a>2. kafkaé›†ç¾¤ä¸ºä»€ä¹ˆéœ€è¦zookeeperæ¥é…åˆï¼Ÿ</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ç­”æ¡ˆï¼šzookeeper æ˜¯ä½œä¸ºæ€§èƒ½åè°ƒå·¥å…·çš„è§’è‰²å­˜åœ¨ã€‚å­˜å‚¨ç€ä½ KafkaæœåŠ¡çš„ä¸€äº›äº›å…ƒæ•°æ®ï¼ˆpartitionsã€offsetç­‰ç­‰ï¼‰ã€‚zookeeperé›†ç¾¤çš„ä½œç”¨åœ¨äºä¿è¯ZookeeperæœåŠ¡çš„é«˜å¯ç”¨ã€‚å› æ­¤ä½ å¯ä»¥æ ¹æ®ä½ çš„éœ€è¦æ¥é€‰æ‹©æ˜¯å¦æ„å»ºzookeeperé›†ç¾¤ã€‚</div></pre></td></tr></table></figure>
<h5 id="3-æŸ¥çœ‹kafka-topic-æ¶ˆè´¹è®°å½•æŠ¥é”™WARN-Session-0x0-for-server-null-unexpected-error-closing-socket-connection-and-attempting-reconnect-org-apache-zookeeper-ClientCnxn"><a href="#3-æŸ¥çœ‹kafka-topic-æ¶ˆè´¹è®°å½•æŠ¥é”™WARN-Session-0x0-for-server-null-unexpected-error-closing-socket-connection-and-attempting-reconnect-org-apache-zookeeper-ClientCnxn" class="headerlink" title="3. æŸ¥çœ‹kafka topic æ¶ˆè´¹è®°å½•æŠ¥é”™WARN Session 0x0 for server null, unexpected error, closing socket connection and attempting reconnect (org.apache.zookeeper.ClientCnxn)"></a>3. æŸ¥çœ‹kafka topic æ¶ˆè´¹è®°å½•æŠ¥é”™WARN Session 0x0 for server null, unexpected error, closing socket connection and attempting reconnect (org.apache.zookeeper.ClientCnxn)</h5><p>java.net.ConnectException: Connection timed out</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">é—®é¢˜ï¼š</div><div class="line">1.æ˜¯kafkaè¿ä¸ä¸Šzookeeperäº†ã€‚è¯·æ£€æŸ¥ zk é›†ç¾¤æ˜¯å¦æ­£å¸¸èƒ½Telnetï¼Œkafkaé›†ç¾¤æ˜¯å¦æ­£å¸¸ã€‚</div><div class="line">2.æ£€æŸ¥server.properties ä¸­zookeeper.connectæ˜¯å¦é…ç½®æ­£ç¡®ï¼Œå¦‚æœéƒ½æ²¡æœ‰é—®é¢˜ï¼Œé‡æ–°å¯åŠ¨æœåŠ¡ã€‚</div></pre></td></tr></table></figure>
<h5 id="4-kafka-æ”¯æŒå‹ç¼©ä¼ è¾“å—ï¼Ÿ"><a href="#4-kafka-æ”¯æŒå‹ç¼©ä¼ è¾“å—ï¼Ÿ" class="headerlink" title="4. kafka æ”¯æŒå‹ç¼©ä¼ è¾“å—ï¼Ÿ"></a>4. kafka æ”¯æŒå‹ç¼©ä¼ è¾“å—ï¼Ÿ</h5><h5 id="5-Kafka-å¦‚ä½•åœ¨å¼€å¯æ•°æ®å‹ç¼©çš„æƒ…å†µä¸‹-consumerç»´æŠ¤è‡ªå·±çš„offset"><a href="#5-Kafka-å¦‚ä½•åœ¨å¼€å¯æ•°æ®å‹ç¼©çš„æƒ…å†µä¸‹-consumerç»´æŠ¤è‡ªå·±çš„offset" class="headerlink" title="5. Kafka å¦‚ä½•åœ¨å¼€å¯æ•°æ®å‹ç¼©çš„æƒ…å†µä¸‹, consumerç»´æŠ¤è‡ªå·±çš„offset?"></a>5. Kafka å¦‚ä½•åœ¨å¼€å¯æ•°æ®å‹ç¼©çš„æƒ…å†µä¸‹, consumerç»´æŠ¤è‡ªå·±çš„offset?</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">é—®é¢˜ï¼š</div><div class="line">kafkaè¿™è¾¹æ•°æ®ä¼ è¾“æ¶ˆè´¹è·¨awsæœºæˆ¿è¾ƒæ…¢ã€‚ä¼šæœ‰ç½‘ç»œç“¶é¢ˆ,æˆ‘ä»¬kafkaåœ¨å›½å¤–çš„ä¸€dalasiæœºæˆ¿ï¼Œæ¶ˆè´¹ç«¯åœ¨dalasiã€‚</div><div class="line"></div><div class="line">å®˜ç½‘è§£ç­”ï¼š</div><div class="line">Offset management on the consumer</div><div class="line"></div><div class="line">The data received by a consumer <span class="keyword">for</span> a topic might contain both compressed as well as uncompressed messages. The consumer iterator transparently decompresses compressed data and only returns an uncompressed message. The offset maintenance <span class="keyword">in</span> the consumer gets a little tricky. In the zookeeper consumer, the consumed offset is updated each time a message is returned. This consumed offset should be a valid fetch offset <span class="keyword">for</span> correct failure recovery. Since data is stored <span class="keyword">in</span> compressed format on the broker, valid fetch offsets are the compressed message boundaries. Hence, <span class="keyword">for</span> compressed data, the consumed offset will be advanced one compressed message at a time. This has the side effect of possible duplicates <span class="keyword">in</span> the event of a consumer failure. For uncompressed data, consumed offset will be advanced one message at a time.</div><div class="line"></div><div class="line">è¿™æ®µè¯ä¸æ˜¯å¾ˆç†è§£: producerå°†100æ¡messageå‹ç¼©æˆ1æ¡å‘ç»™brokerå, brokeræ˜¯å¦‚ä½•å­˜å‚¨çš„ï¼Œå¹¶ä¸”consumeræ˜¯å¦‚ä½•å–å‡ºè¿™å‹ç¼©åçš„æ•°æ®, å¹¶ç»´æŠ¤offsetçš„?</div><div class="line"></div><div class="line"><span class="comment">### æ¶ˆæ¯å‹ç¼©ï¼ˆmessage compressionï¼‰</span></div><div class="line"></div><div class="line">è€ƒè™‘åˆ°ç½‘ç»œå¸¦å®½çš„ç“¶é¢ˆï¼ŒKafkaæä¾›äº†æ¶ˆæ¯ç»„å‹ç¼©ç‰¹æ€§ã€‚Kafkaé€šè¿‡é€’å½’æ¶ˆæ¯é›†æ¥æ”¯æŒé«˜æ•ˆå‹ç¼©ã€‚é«˜æ•ˆå‹ç¼©éœ€è¦å¤šä¸ªæ¶ˆæ¯åŒæ—¶å‹ç¼©ï¼Œè€Œä¸æ˜¯å¯¹æ¯ä¸ªæ¶ˆæ¯å•ç‹¬å‹ç¼©ã€‚ä¸€æ‰¹æ¶ˆæ¯å‹ç¼©åœ¨ä¸€èµ·å‘é€ç»™brokerã€‚å‹ç¼©æ¶ˆæ¯é›†é™ä½äº†ç½‘ç»œçš„è´Ÿè½½ï¼Œä½†æ˜¯è§£å‹ç¼©ä¹Ÿå¸¦æ¥äº†ä¸€äº›é¢å¤–çš„å¼€é”€ã€‚æ¶ˆæ¯é›†çš„è§£å‹ç¼©æ˜¯ç”±brokerå¤„ç†æ¶ˆæ¯offsetæ—¶å®Œæˆçš„ã€‚</div><div class="line"></div><div class="line">æ¯ä¸ªæ¶ˆæ¯å¯é€šè¿‡ä¸€ä¸ªä¸å¯æ¯”è¾ƒçš„ã€é€’å¢çš„é€»è¾‘offsetè®¿é—®ï¼Œè¿™ä¸ªé€»è¾‘offsetåœ¨æ¯ä¸ªåˆ†åŒºå†…æ˜¯å”¯ä¸€çš„ã€‚æ¥æ”¶åˆ°å‹ç¼©æ•°æ®åï¼Œlead brokerå°†æ¶ˆæ¯é›†è§£å‹ç¼©ï¼Œä¸ºæ¯ä¸ªæ¶ˆæ¯åˆ†é…offsetã€‚offsetåˆ†é…å®Œæˆåï¼Œleaderå†æ¬¡å°†æ¶ˆæ¯é›†å‹ç¼©å¹¶å†™å…¥ç£ç›˜ã€‚</div><div class="line"></div><div class="line">åœ¨Kafkaä¸­ï¼Œæ•°æ®çš„å‹ç¼©ç”±producerå®Œæˆï¼Œå¯ä½¿ç”¨GZIPæˆ–Snappyå‹ç¼©åè®®ã€‚åŒæ—¶éœ€è¦åœ¨producerç«¯é…ç½®ç›¸å…³çš„å‚æ•°ï¼š</div><div class="line"></div><div class="line">compression.codecï¼šæŒ‡å®šå‹ç¼©æ ¼å¼ï¼Œé»˜è®¤ä¸ºnoneï¼Œå¯é€‰çš„å€¼è¿˜æœ‰gzipå’Œsnappyã€‚</div><div class="line">compressed.topicsï¼šè®¾ç½®å¯¹æŒ‡å®šçš„topicå¼€å¯å‹ç¼©ï¼Œé»˜è®¤ä¸ºnullã€‚å½“compression.codecä¸ä¸ºnoneæ—¶ï¼Œå¯¹æŒ‡å®šçš„topicå¼€å¯å‹ç¼©ï¼›å¦‚æœcompressed.topicsä¸ºnullåˆ™å¯¹æ‰€æœ‰topicå¼€å¯å‹ç¼©ã€‚</div><div class="line">æ¶ˆæ¯é›†ByteBufferMessageSetå¯èƒ½æ—¢åŒ…å«å‹ç¼©æ•°æ®ä¹ŸåŒ…å«éå‹ç¼©æ•°æ®ï¼Œä¸ºäº†åŒºåˆ†å¼€æ¥ï¼Œæ¶ˆæ¯å¤´ä¸­æ·»åŠ äº†å‹ç¼©å±æ€§å­—èŠ‚ã€‚åœ¨è¯¥å­—èŠ‚ä¸­ï¼Œæœ€ä½ä½çš„ä¸¤ä½è¡¨ç¤ºå‹ç¼©æ ¼å¼ï¼Œå¦‚æœéƒ½æ˜¯0è¡¨ç¤ºéå‹ç¼©æ•°æ®ã€‚</div></pre></td></tr></table></figure>
<h3 id="Communicative-learning"><a href="#Communicative-learning" class="headerlink" title="Communicative learning:"></a>Communicative learning:</h3><p>ğŸ§  Linux shell_ senior operation and maintenance faction: QQ group <code>459096184</code> circle (system operation and maintenance - application operation and maintenance - automation operation and maintenance - virtualization technology research, welcome to join)<br>ğŸ§  BigData-Exchange School:QQ group <code>521621407</code> circles (big data Yun Wei) (Hadoop developer) (big data research enthusiasts) welcome to join</p>
<p>Bidata have internal WeChat exchange group, learn from each other, join QQ group has links.</p>

        </div>
        <br><br>
        <div>
            <p>
                     
                    <span class="badge badge-default">#&nbsp;Kafka</span>
                    &nbsp;
                    
            </p>
        </div>
    </div>
    <!-- TOC -->
    
        <div class="col-md-3">
            <ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-éƒ¨ç½²ç”Ÿäº§ç¯å¢ƒï¼Œæ‰“ç®—éƒ¨ç½²ä¸‰ä¸ªbrokerå®ä¾‹ï¼Œä½†zookeeperéƒ¨ç½²ä¸€ä¸ªå¯ä»¥å—"><span class="toc-text">1. éƒ¨ç½²ç”Ÿäº§ç¯å¢ƒï¼Œæ‰“ç®—éƒ¨ç½²ä¸‰ä¸ªbrokerå®ä¾‹ï¼Œä½†zookeeperéƒ¨ç½²ä¸€ä¸ªå¯ä»¥å—?</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-kafkaé›†ç¾¤ä¸ºä»€ä¹ˆéœ€è¦zookeeperæ¥é…åˆï¼Ÿ"><span class="toc-text">2. kafkaé›†ç¾¤ä¸ºä»€ä¹ˆéœ€è¦zookeeperæ¥é…åˆï¼Ÿ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-æŸ¥çœ‹kafka-topic-æ¶ˆè´¹è®°å½•æŠ¥é”™WARN-Session-0x0-for-server-null-unexpected-error-closing-socket-connection-and-attempting-reconnect-org-apache-zookeeper-ClientCnxn"><span class="toc-text">3. æŸ¥çœ‹kafka topic æ¶ˆè´¹è®°å½•æŠ¥é”™WARN Session 0x0 for server null, unexpected error, closing socket connection and attempting reconnect (org.apache.zookeeper.ClientCnxn)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-kafka-æ”¯æŒå‹ç¼©ä¼ è¾“å—ï¼Ÿ"><span class="toc-text">4. kafka æ”¯æŒå‹ç¼©ä¼ è¾“å—ï¼Ÿ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-Kafka-å¦‚ä½•åœ¨å¼€å¯æ•°æ®å‹ç¼©çš„æƒ…å†µä¸‹-consumerç»´æŠ¤è‡ªå·±çš„offset"><span class="toc-text">5. Kafka å¦‚ä½•åœ¨å¼€å¯æ•°æ®å‹ç¼©çš„æƒ…å†µä¸‹, consumerç»´æŠ¤è‡ªå·±çš„offset?</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Communicative-learning"><span class="toc-text">Communicative learning:</span></a>
        </div>
    
</div>

<!-- Comments -->
<div class="row">
    <div class="col-md-8 offset-md-2">
    
        
            <div class="disqus" style="width:100%">
    <div id="disqus_thread"></div>
    <script>               
        var disqus_shortname = 'null';
        var disqus_config = function () {
            this.page.url = 'http://blog.yancy.cc/2017/09/11/Bigdata-hadoop/Kafka/KafKaä¸æ‡‚å°±å­¦å°±é—®å°±è§£ç­”ç¬”è®°/'; 
            this.page.identifier = '/2017/09/11/Bigdata-hadoop/Kafka/KafKaä¸æ‡‚å°±å­¦å°±é—®å°±è§£ç­”ç¬”è®°/';
        };
        (function() { 
            var d = document, s = d.createElement('script');
            s.type = 'text/javascript';
            s.src = '//'+disqus_shortname+'.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>                                
</div>
        
    
    </div>
</div>
      </div>
    </div>
  </div>


<footer class="footer footer-default">
        <div class="container">
          <nav class="float-left">
              <b>å¤šå–çƒ­æ°´</b>
          </nav>
          <div class="copyright float-right">
            &copy;
            <script>
              document.write(new Date().getFullYear())
            </script>&nbsp;<a href="https://hexo.io/zh-cn/" target="_blank">HEXO</a>&nbsp;<i class="material-icons">favorite_border</i>
            <a href="https://github.com/invom/Material-T" target="_blank">Material-T</a>
          </div>
        </div>
</footer>
      <!--   Core JS Files   -->
      <script src="/js/core/jquery.min.js"></script>
      
        <script src="/js/main.js"></script>
       
      <script src="/js/core/popper.min.js"></script>
      <script src="/js/core/bootstrap-material-design.min.js"></script>
      <script src="/js/plugins/moment.min.js"></script>
      <!--	Plugin for the Datepicker, full documentation here: https://github.com/Eonasdan/bootstrap-datetimepicker -->
      <!-- <script src="/js/plugins/bootstrap-datetimepicker.js"></script> -->
      <!--  Plugin for the Sliders, full documentation here: http://refreshless.com/nouislider/ -->
      <script src="/js/plugins/nouislider.min.js"></script>
      <!-- Control Center for Material Kit: parallax effects, scripts for the example pages etc -->
      <script src="/js/material-kit.min.js?v=2.0.5"></script>
      
      
        <script src="/js/plugins/prettify.js"></script>
        <script>
            $(window).on('load',function(){
                $('pre').addClass('prettyprint linenums');
                prettyPrint();
            })
        </script>
        
          
        
      
</body>
</html>