<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Monitor Kafka with Prometheus +Grafana | Yancy&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Monitoring Kafka with PrometheusWe’ve previously looked at how to monitor Cassandra with Prometheus. Let’s see the process for getting metrics from another popular Java application, Kafka.">
<meta name="keywords" content="Kafka,Prometheus,Grafana">
<meta property="og:type" content="article">
<meta property="og:title" content="Monitor Kafka with Prometheus +Grafana">
<meta property="og:url" content="http://blog.yancy.cc/2017/08/04/Bigdata-hadoop/Kafka/Monitor Kafka with Prometheus +Grafana/index.html">
<meta property="og:site_name" content="Yancy&#39;s blog">
<meta property="og:description" content="Monitoring Kafka with PrometheusWe’ve previously looked at how to monitor Cassandra with Prometheus. Let’s see the process for getting metrics from another popular Java application, Kafka.">
<meta property="og:image" content="http://image.chengyangyang.com/kafka-overview.png">
<meta property="og:image" content="http://image.chengyangyang.com/kafka-monitor02.png">
<meta property="og:image" content="http://image.chengyangyang.com/kafka-monitor03.png">
<meta property="og:image" content="https://prometheus.io/assets/grafana_configuring_datasource-cb0e78b7cfa.png">
<meta property="og:updated_time" content="2019-01-17T08:18:06.435Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Monitor Kafka with Prometheus +Grafana">
<meta name="twitter:description" content="Monitoring Kafka with PrometheusWe’ve previously looked at how to monitor Cassandra with Prometheus. Let’s see the process for getting metrics from another popular Java application, Kafka.">
<meta name="twitter:image" content="http://image.chengyangyang.com/kafka-overview.png">
  
  <link rel="stylesheet" href="/css/index.css">
</head>

<body style="


  background-color: #eff0f6

">
  <div id="container">
    <nav id="nav">
  <header class="header">
    <a href="/" class="title">Clover Tuan</a>
  </header>
  <div class="ctnWrap">
    <div class="icons">
      
        
          
            <a href="https://dribbble.com/clovertuan" target="_blank" class="nav-icn iconfont icon-dribbble"></a>
          
        
          
            <a href="https://www.behance.net/clovertuan" target="_blank" class="nav-icn iconfont icon-behance"></a>
          
        
          
            <a href="http://clovertuan.lofter.com/" target="_blank" class="nav-icn iconfont icon-lofter"></a>
          
        
          
            <a href="https://www.instagram.com/clovertuan/" target="_blank" class="nav-icn iconfont icon-instagram"></a>
          
        
          
            <a href="https://github.com/cloverTuan" target="_blank" class="nav-icn iconfont icon-github"></a>
          
        
      
    </div>
    <div class="menu">
      
        
            <a href="/" class="nav-menu ">HOME</a>
          
        
            <a href="/archives" class="nav-menu ">ARCHIVE</a>
          
        
            <a href="/about" class="nav-menu ">ABOUT</a>
          
        
      
    </div>
  </div>
</nav>
    <div id="main"><section class="article">
  <h2 class="title">Monitor Kafka with Prometheus +Grafana</h2>
  <p class="sub">Aug 4, 2017</p>
  <article class="content">
    <p>we download Kafka, the JMX exporter and the config file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">wget http://ftp.heanet.ie/mirrors/www.apache.org/dist/kafka/0.10.1.0/kafka_2.11-0.10.1.0.tgz</div><div class="line">tar -xzf kafka _ *。tgz</div><div class="line"><span class="built_in">cd</span> kafka_ *</div><div class="line"></div><div class="line">wget https://repo1.maven.org/maven2/io/prometheus/jmx/jmx_prometheus_javaagent/0.6/jmx_prometheus_javaagent-0.6.jar</div><div class="line">wget https://raw.githubusercontent.com/prometheus/jmx_exporter/master/example_configs/kafka-0-8-2.yml</div><div class="line"></div><div class="line">Download the good files and put them under the Kafka directory:</div><div class="line">[hadoop@hadoop6 kafka_2.10-0.9.0.1]$ ll</div><div class="line">drwxr-xr-x 3 hadoop hadoop    4096 9月  27 13:34 bin</div><div class="line">drwxr-xr-x 2 hadoop hadoop    4096 9月  27 21:18 config</div><div class="line">-rw-rw-r-- 1 hadoop hadoop 1225418 2月   5 2016 jmx_prometheus_javaagent-0.6.jar</div><div class="line">-rw-rw-r-- 1 hadoop hadoop    2824 9月  26 17:48 kafka-0-8-2.yml</div><div class="line">drwxr-xr-x 2 hadoop hadoop    4096 9月  27 13:31 libs</div><div class="line">-rw-r--r-- 1 hadoop hadoop   11358 2月  12 2016 LICENSE</div><div class="line">drwxrwxr-x 2 hadoop hadoop  266240 9月  27 21:19 logs</div><div class="line">-rw-r--r-- 1 hadoop hadoop     162 2月  12 2016 NOTICE</div><div class="line">drwxrwxr-x 5 hadoop hadoop    4096 9月  27 15:56 prometheus-1.2.1.linux-amd64</div><div class="line">drwxr-xr-x 2 hadoop hadoop    4096 2月  12 2016 site-docs</div></pre></td></tr></table></figure>
<p>We start a Zookeeper (a Kafka dependency) and Kafka with the JMX exporter running as a Java agent:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">First step:</div><div class="line">Configure the zookeeper zoo.zoo.cfg port: 2181</div><div class="line">Start zookeeper:</div><div class="line">./zookeeper-3.4.6/bin/zkServer.sh start</div><div class="line"></div><div class="line">Second steps:</div><div class="line">Configuration modification: kafka_2.10-0.9.0.1/config/zookeeper.properties</div><div class="line">Port modification: 2182 <span class="keyword">do</span> not conflict with the zookeeper service port</div><div class="line"></div><div class="line"></div><div class="line">dataDir=/data2/zookeeper-3.4.6/zookeeper-data</div><div class="line"><span class="comment"># the port at which the clients will connect</span></div><div class="line">clientPort=2181</div><div class="line"><span class="comment"># disable the per-ip limit on the number of connections since this is a non-production config</span></div><div class="line">maxClientCnxns=0</div><div class="line"></div><div class="line">./bin/zookeeper-server-start.sh config/zookeeper.properties &amp;</div><div class="line"></div><div class="line">KAFKA_OPTS=<span class="string">"<span class="variable">$KAFKA_OPTS</span> -javaagent:<span class="variable">$PWD</span>/jmx_prometheus_javaagent-0.6.jar=7071:<span class="variable">$PWD</span>/kafka-0-8-2.yml"</span> \</div><div class="line">./bin/kafka-server-start.sh config/server.properties &amp;</div></pre></td></tr></table></figure>
<h4 id="If-you-visit-http-localhost-7071-metrics-you’ll-see-the-metrics"><a href="#If-you-visit-http-localhost-7071-metrics-you’ll-see-the-metrics" class="headerlink" title="If you visit http://localhost:7071/metrics you’ll see the metrics."></a>If you visit <a href="http://localhost:7071/metrics" target="_blank" rel="external">http://localhost:7071/metrics</a> you’ll see the metrics.</h4><p>Let’s setup a quick Prometheus server:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">wget https://github.com/prometheus/prometheus/releases/download/v1.2.1/prometheus-1.2.1.linux-amd64.tar.gz</div><div class="line">tar -xzf prometheus-*.tar.gz</div><div class="line"><span class="built_in">cd</span> prometheus-*</div><div class="line">cat &lt;&lt;<span class="string">'EOF'</span> &gt; prometheus.yml</div><div class="line">global:</div><div class="line"> scrape_interval: 10s</div><div class="line"> evaluation_interval: 10s</div><div class="line">scrape_configs:</div><div class="line"> - job_name: <span class="string">'kafka'</span></div><div class="line">   static_configs:</div><div class="line">    - targets:</div><div class="line">      - localhost:7071</div><div class="line">EOF</div><div class="line">./prometheus</div></pre></td></tr></table></figure>
<p>Following run access: <a href="http://localhost:9090/graph" target="_blank" rel="external">http://localhost:9090/graph</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[hadoop@hadoop8 prometheus-1.2.1.linux-amd64]$ ./prometheus</div><div class="line">INFO[0000] Starting prometheus (version=1.2.1, branch=master, revision=dd66f2e94b2b662804b9aa1b6a50587b990ba8b7)  <span class="built_in">source</span>=main.go:75</div><div class="line">INFO[0000] Build context (go=go1.7.1, user=root@fd9b0daff6bd, date=20161010-15:58:23)  <span class="built_in">source</span>=main.go:76</div><div class="line">INFO[0000] Loading configuration file prometheus.yml     <span class="built_in">source</span>=main.go:247</div><div class="line">INFO[0000] Loading series map and head chunks...         <span class="built_in">source</span>=storage.go:354</div><div class="line">INFO[0000] 49 series loaded.                             <span class="built_in">source</span>=storage.go:359</div><div class="line">WARN[0000] No AlertManagers configured, not dispatching any alerts  <span class="built_in">source</span>=notifier.go:176</div><div class="line">INFO[0000] Listening on :9090                            <span class="built_in">source</span>=web.go:240</div><div class="line">INFO[0000] Starting target manager...                    <span class="built_in">source</span>=targetmanager.go:76</div></pre></td></tr></table></figure>
<p>The Prometheus platform monitors all data from the Kafka index:<br>This function is very powerful, late will explain what each representative means:</p>
<p><img src="http://image.chengyangyang.com/kafka-monitor02.png" alt=""></p>
<p><img src="http://image.chengyangyang.com/kafka-monitor03.png" alt=""></p>
<p>Install <a href="http://docs.grafana.org/installation/rpm/#install-stable" target="_blank" rel="external">open source Grafana monitoring</a>, combine <a href="https://prometheus.io/docs/visualization/grafana/" target="_blank" rel="external">prometheus.io</a> to obtain Prometheus platform data.</p>
<h3 id="Installing-Grafana"><a href="#Installing-Grafana" class="headerlink" title="Installing Grafana"></a>Installing Grafana</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Download and unpack Grafana from binary tar (adjust version as appropriate).</span></div><div class="line">curl -L -O https://grafanarel.s3.amazonaws.com/builds/grafana-2.5.0.linux-x64.tar.gz</div><div class="line">tar zxf grafana-2.5.0.linux-x64.tar.gz</div><div class="line"></div><div class="line"><span class="comment"># Start Grafana.</span></div><div class="line"><span class="built_in">cd</span> grafana-2.5.0/</div><div class="line">./bin/grafana-server web</div></pre></td></tr></table></figure>
<h3 id="Using"><a href="#Using" class="headerlink" title="Using"></a>Using</h3><p>By default, Grafana will be listening on <a href="http://localhost:3000" target="_blank" rel="external">http://localhost:3000</a>. The default login is “admin” / “admin”.</p>
<h4 id="Creating-a-Prometheus-data-source"><a href="#Creating-a-Prometheus-data-source" class="headerlink" title="Creating a Prometheus data source"></a>Creating a Prometheus data source</h4><p>To create a Prometheus data source:</p>
<ol>
<li>Click on the Grafana logo to open the sidebar menu.</li>
<li>Click on “Data Sources” in the sidebar.</li>
<li>Click on “Add New”.</li>
<li>Select “Prometheus” as the type.</li>
<li>Set the appropriate Prometheus server URL (for example, <a href="http://localhost:9090/" target="_blank" rel="external">http://localhost:9090/</a>)</li>
<li>Adjust other data source settings as desired (for example, turning the proxy access off).</li>
<li>Click “Add” to save the new data source.</li>
<li>The following shows an example data source configuration:</li>
</ol>
<p>Reference address: <a href="https://prometheus.io/docs/visualization/grafana/" target="_blank" rel="external">GRAFANA SUPPORT FOR PROMETHEUS</a></p>
<p><img src="https://prometheus.io/assets/grafana_configuring_datasource-cb0e78b7cfa.png" alt=""></p>
<p>Finally load the <a href="https://grafana.com/dashboards/721" target="_blank" rel="external">Kafka Overview</a> dashboard from grafana.net into your Grafana to get the above console!</p>
<p>If you want to run Kafka inside docker, there’s <a href="https://www.robustperception.io/monitoring-kafka-in-a-docker-container-using-prometheus/" target="_blank" rel="external">another blog post</a> covering that.</p>
<p>Reference address: <a href="https://www.robustperception.io/monitoring-kafka-with-prometheus/" target="_blank" rel="external">monitoring-kafka-with-prometheus</a></p>
<h3 id="Communicative-learning"><a href="#Communicative-learning" class="headerlink" title="Communicative learning:"></a>Communicative learning:</h3><p>🐧  Linux shell_ senior operation and maintenance faction: QQ group <code>459096184</code> circle (system operation and maintenance - application operation and maintenance - automation operation and maintenance - virtualization technology research, welcome to join)<br>🐧  BigData-Exchange School:QQ group <code>521621407</code> circles (big data Yun Wei) (Hadoop developer) (big data research enthusiasts) welcome to join</p>
<p>Bidata have internal WeChat exchange group, learn from each other, join QQ group has links.</p>
  </article>
  <footer class="f-cf">
    
      <a href="/2017/08/18/Web服务技术/tomcat/tomcat Java heap space 内存溢出/" class="link f-fl">⟵tomcat Java heap space 内存溢出</a>
    
    
      <a href="/2017/08/01/Bigdata-hadoop/Kafka/Kafka-node模块实现调用js发送数据/" class="link f-fr">Bigdata-Kafka-node模块实现调用js发送数据⟶</a>
    
  </footer>
</section></div>
    <footer id="footer" class="f-cf">
  d.guangying@foxmail.com
  
    
      
        · <a href="https://dribbble.com/clovertuan" target="_blank" class="nav-icn">Dribbble</a>
      
    
      
        · <a href="https://www.behance.net/clovertuan" target="_blank" class="nav-icn">Behance</a>
      
    
      
        · <a href="http://clovertuan.lofter.com/" target="_blank" class="nav-icn">Lofter</a>
      
    
      
        · <a href="https://www.instagram.com/clovertuan/" target="_blank" class="nav-icn">Instagram</a>
      
    
      
        · <a href="https://github.com/cloverTuan" target="_blank" class="nav-icn">GitHub</a>
      
    
  
  <span class="copyright">All rights reserved @Clover Tuan</span>
</footer>
  </div>
</body>
</html>