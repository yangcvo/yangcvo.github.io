<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="theme-color" content="#33474d">
	<title>Yancy&#39;s blog</title>
	<link rel="stylesheet" href="/css/style.css" />
	
      <link rel="alternate" href="/atom.xml" title="Yancy&#39;s blog" type="application/atom+xml">
    
</head>

<body>

	<header class="header">
		<nav class="header__nav">
			
				<a href="/" class="header__link">Home</a>
			
				<a href="/tags" class="header__link">Tags</a>
			
				<a href="/archives" class="header__link">ARCHIVES</a>
			
				<a href="/about/About" class="header__link">ABOUT</a>
			
				<a href="http://weibo.com/yangcvo" class="header__link">Weibo</a>
			
				<a href="/atom.xml" class="header__link">RSS</a>
			
		</nav>
		<h1 class="header__title"><a href="/">Yancy&#39;s blog</a></h1>
		<h2 class="header__subtitle">SIMPLICITY IS PREREQUISITE FOR  RELIABILITY</h2>
	</header>

	<main>
		
	<span class="different-posts different-posts_earlier">📖 <a href="/page/5">earlier posts</a> 📖</span>




	<article>
	
		<h1><a href="/2016/09/21/运维笔记/运维工程师的职责和前景/">运维工程师的职责和前景</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-09-21</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/运维笔记/">运维笔记</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Operation-and-maintenance-Road/">Operation and maintenance Road</a>
			</span>
		
	</div>

	

	
		<h1 id="运维工程师的职责和前景"><a href="#运维工程师的职责和前景" class="headerlink" title="运维工程师的职责和前景"></a>运维工程师的职责和前景</h1><p>运维中关键技术点解剖：</p>
<figure class="highlight basic"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">1 </span>大量高并发网站的设计方案 ；</div><div class="line"><span class="symbol">2 </span>高可靠、高可伸缩性网络架构设计；</div><div class="line"><span class="symbol">3 </span>网站安全问题，如何避免被黑？</div><div class="line"><span class="symbol">4 </span>南北互联问题,动态CDN解决方案；</div><div class="line"><span class="symbol">5 </span>海量数据存储架构</div></pre></td></tr></table></figure>
<h4 id="一、什么是大型网站运维？"><a href="#一、什么是大型网站运维？" class="headerlink" title="一、什么是大型网站运维？"></a>一、什么是大型网站运维？</h4><p>首先明确一下，全文所讲的<code>”运维“</code>是指：大型网站运维，与其它运维的区别还是蛮大的；然后我们再对大型网站与小型网站进行范围定义，此定义主要从运维复杂性角度考虑，如网站规范、知名度、服务器量级、pv量等考虑，其它因素不是重点；</p>
<p>因此，我们先定义服务器规模大于1000台，pv每天至少上亿（至少国内排名前10），如sina、baidu、QQ，51.com等等；</p>
<p>其它小型网站可能没有真正意义上的运维工程师，这与网站规范不够和成本因素有关，更多的是集合网络、系统、开发工作于一身的<code>“复合性人才”</code>，就如有些公司把一些合同采购都纳入了运维职责范围，还有如IDC网络规划也纳入运维职责。所以，非常重要一定需要明白：</p>
<figure class="highlight excel"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">运维对其它关联工种必须非常了解熟悉：网络、系统、系统开发、存储，安全,<span class="built_in">DB</span>等；</div></pre></td></tr></table></figure>
<p>我在这里所讲的运维工程师就是指专职运维工程师。<br>我们再来说说一般产品的“出生”流程：</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="number">1</span>、首先公司管理层给出指导思想，PM定位市场需求（或copy成熟应用）进行调研、分析、最终给出详细设计。</div><div class="line"></div><div class="line"><span class="number">2</span>、架构师根据产品设计的需求，如pv大小预估、服务器规模、应用架构等因素完成网络规划,架构设计等（基本上对网络变动不大，除非大项目）</div><div class="line"></div><div class="line"><span class="number">3</span>、开发工程师将设计code实现出来、测试工程师对应用进行测试。</div><div class="line"></div><div class="line"><span class="number">4</span>、好，到运维工程师出马了，首先明确一点不是说前三步就与运维工作无关了，恰恰相反，前三步与运维关系很大：</div></pre></td></tr></table></figure>
<p>应用的前期架构设计、软/硬件资源评估申请采购、应用设计性能隐患及评估、IDC、服务性能安全调优、服务器系统级优化（与特定应用有关）等都需运维全程参与，并主导整个应用上线项目；运维工程师负责产品服务器上架准备工作，服务器系统安装、网络、IP、通用工具集安装。运维工程师还需要对上线的应用系统架构是否合理、是否具备可扩展性、及安全隐患等因素负责，并负责最后将产品（程序）、网络、系统三者进行拼接并最优化的组合在一起，最终完成产品上线提供用户使用，并周而复使：需求-&gt;开发（升级）-&gt;测试-&gt;上线（性能、安全问题等之前预估外的问题随之慢慢就全出来了）在这里提一点：网站开发模式与传统软件开发完全不一样，网站一天开发上线1~5个升级版本是家常便饭，用户体验为王嘛，如果某个线上问题像M$需要1年解决，用户早跑光了；应用上线后，运维工作才刚开始，具体工作可能包括：</p>
<p>升级版本上线工作、服务监控、应用状态统计、日常服务状态巡检、突发故障处理、服务日常变更调整、集群管理、服务性能评估优化、数据库管理优化、随着应用PV增减进行应用架构的伸缩、安全、运维开发工作：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">a 、尽量将日常机械性手工工作通过工具实现（如服务监控、应用状态统计、服务上线等等），提高效率。</div><div class="line">b、解决现实中服务存在的问题，如高可靠性、可扩展性问题等。</div><div class="line">c、大规模集群管理工具的开发，如1万台机器如何在1分钟内完成密码修改、或运行指定任务？2000台服务器如何快速安装操作系统？各分布式IDC、存储集群中数PT级的数据如何快速的存储、共享、分析？等一系列挑战都需运维工程师的努力。</div><div class="line">在此说明一下其它配合工种情况，在整个项目中，前端应用对于网络/系统工程师来说是黑匣子，同时开发工程师职责只是负责完成应用的功能性开发，并对应用本身性能、安全性等应用本身负责，它不负责或关心网络/系统架构方面事宜，当然软/硬件采购人员等事业部其它同事也不会关心这些问题，各司其职，但项目的核心是运维工程师~！所有其它部门的桥梁。</div></pre></td></tr></table></figure>
<h4 id="举例："><a href="#举例：" class="headerlink" title="举例："></a>举例：</h4><p>上面说了很多，我想大家应该对运维有一些概念了，在此打个比方吧，如果我们是一辆高速行驶在高速公路上的汽车，那运维工程师就是司机兼维修工，这个司机不简单，有时需要在高速行驶过程中换轮胎、并根据道路情况换档位、当汽车速度越来越快，汽车本身不能满足高速度时对汽车性能调优或零件升级、高速行进中解决汽车故障及性能问题、时刻关注前方安全问题，并先知先觉的采取规避手段。这就是运维工作~！</p>
<h4 id="最后说一下运维工程师的职责："><a href="#最后说一下运维工程师的职责：" class="headerlink" title="最后说一下运维工程师的职责："></a>最后说一下运维工程师的职责：</h4><p>”确保线上稳定“，看似简单，但实属不容易，运维工程师必须在诸多不利因素中进行权衡：新产品模式对现有架构及技术的冲击、产品高频度的升级带来的线上BUG隐患、运维自动化管理承度不高导致的人为失误、IT行业追求的高效率导致流程执行上的缺失、用户增涨带来的性能及架构上的压力、IT行业宽松的技术管理文化、创新风险、互联网安全性问题等因素，都会是网站稳定的大敌，运维工程师必须把控好这最后一关，需具体高度的责任感、原则性及协调能力，如果能做到各因素的最佳平衡，那就是一名优秀的运维工程师了。</p>
<blockquote>
<p>另外在此聊点题外话，我在这里看到有很多人要sina、QQ、baidu,51.com等聊自已的运维方面的经验，其实这对于它们有点免为其难：</p>
</blockquote>
<ul>
<li><p>a、各公司自已网络架构、规模、或多或少还算是公司的核心秘密，要保密，另外，对于大家所熟知的通用软件、架构，由于很多公司会根据自已实际业务需要，同时因为原版性能、安全性、已知bug、功能等原因，进行过二次开发（如apache,php,mysql），操作系统内核也会根据不同业务类型进行定制的，如某些应用属于运算型、某些是高IO型、或大存储大内存型。根据这些特点进行内核优化定制，如sina就在memcache上进行过二次开发，搞出了一个MemcacheDB，具体做得如何我们不谈，但开源了，是值得称赞的，国内公司对于开源基本上是索取，没有贡献；另外，服务器也不是大家所熟知的型号，根据业务特点，大部份都是找DELL/HP/ibm进行过定制；另外，在分布式储存方面都有自已解决方案，要不就是使用现成开源hadoop等解决方案，或自已开发。但90%都是借鉴google GFS的思想:分布式存储、计算、大表。</p>
</li>
<li><p>b、各公司业务方向不一样，会导致运维模式或方法都不一样，如51.com和baidu运维肯定区别很大，因为他们业务模式决定了其架构、服务器量级、IDC分布、网络结构、通用技术都会不一样，主打新闻门户的sina与主打sns的51.com运维模式差异就非常大,甚至职责都不大一样；但有一点，通用技术及大致架构上都大同小异，大家不要太神化，更多的公司只是玩垒积木的游戏罢了，没什么技术含量。</p>
</li>
<li><p>c、如上面所讲，目前大型网站运维还处于幼年时期理念和经验都比较零散，没有成熟的知识体系，可能具体什么是运维，大家都要先思索一番，或压根没想过，真正讨论也只是运维工作的冰山一角，局限于具体技术细节，或某某著名网站大的框架，真正运维体化东西没有，这也许是目前网上运维相关资料比较少的原故吧。或者也是国内运维人员比较难招，比较牛的运维工程师比较少见的原因之一吧。</p>
</li>
</ul>
<h4 id="二、运维工作师需要什么样的技能及素质"><a href="#二、运维工作师需要什么样的技能及素质" class="headerlink" title="二、运维工作师需要什么样的技能及素质"></a>二、运维工作师需要什么样的技能及素质</h4><p>做为一名运维工程师需要什么样的技能及素质呢，首先说说技能吧，如大家上面所看到，运维是一个集多IT工种技能与一身的岗位，对系统-&gt;网络-&gt;存储-&gt;协议-&gt;需求-&gt;开发-&gt;测试-&gt;安全等各环节都需要了解一些，但对于某些环节需熟悉甚至精通，如系统(基本操作系统的熟悉使用,*nix,windows..)、协议、系统开发(日常很重要的工作是自动运维化相关开发、大规模集群工具开发、管理）、通用应用（如lvs、ha、web server、db、中间件、存储等）、网络,IDC拓朴架构；</p>
<h4 id="技能方面总结以下几点："><a href="#技能方面总结以下几点：" class="headerlink" title="技能方面总结以下几点："></a>技能方面总结以下几点：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">1、开发能力，这点非常重要，因为运维工具都需要自已开发，开发语言：perl、python、php（其中之一）、shell（awk,sed,expect….等），需要有过实际项目开发经验，否则工作会非常痛苦。</div><div class="line"></div><div class="line">2、通用应用方面需要了解：操作系统（目前国内主要是linux、bsd）、webserver相关</div><div class="line">(nginx,apahe,php,lighttpd,java。。。)、数据库(mysql,oralce)、其它杂七八拉的东东；系统优化，高可靠性；这些只是加分项，不需必备，可以边工作边慢慢学，这些东西都不难。当然在运维中，有些是有分工偏重点不一样。</div><div class="line"></div><div class="line">3、系统、网络、安全，存储，CDN，DB等需要相当了解，知道其相关原理。</div></pre></td></tr></table></figure>
<h4 id="个人素质方面："><a href="#个人素质方面：" class="headerlink" title="个人素质方面："></a>个人素质方面：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div></pre></td><td class="code"><pre><div class="line">1、沟通能力、团队协作：运维工作跨部门、跨工种工作很多，需善于沟通、并且团队协作能力要强；这应该是现代企业的基本素质要求了，不多说。</div><div class="line">2、工作中需胆大心细：胆大才能创新、不走寻常路，特别对于运维这种新的工种，更需创新才能促进发展；心细，运维工程师是网站admin,最高线上权限者，一不小心就会遗憾终生或打入十八层地狱。</div><div class="line">3、主动性、执行力、精力旺盛、抗压能力强：由于IT行业的特性，变化快；往往计划赶不上变化，运维工作就更突出了，比如国内各大公司服务器往往是</div><div class="line">全国各地，哪里便宜性价比高，就那往搬，进行大规模服务迁移（牵扯的服务器成百上千台），这是一个非常头痛的问题；往往时间</div><div class="line">非常紧迫，如限1周内完成，这种情况下，运维工程师的主动性及执行力就有很高的要求了：计划、方案、服务无缝迁移、机器搬迁上架、环境准备、安全评估、性</div><div class="line">能评估、基建、各关联部门扯皮,7X24小紧急事故响应等。</div><div class="line">4、其它就是一些基本素质了：头脑要灵光、逻辑思维能力强、为人谦虚稳重、亲和力、乐于助人、有大局观。</div><div class="line">5、最后一点，做网站运维需要有探索创新精神，通过创新型思维解决现实中的问题，因为这是一个处于幼年的职业（国外也一样，但比国内起步早点），没有成熟体系或方法论可以借鉴，只能靠大家自已摸索努力。</div><div class="line">三、怎样才算是一个合格的运维工程师</div><div class="line">1、保证服务达到要求的线上标准，如99.9%；保证线上稳定，这是运维工程师的基本责职所在。</div><div class="line">2、不断的提升应用的可靠性与健壮性、性能优化、安全提升；这方面非常考验主动性和创新思维。</div><div class="line">3、网站各层面监控、统计的覆盖度，软件、硬件、运行状态，能监控的都需要监控统计，避免监控死角、并能实时了解应用的运转情况。</div><div class="line">4、通过创新思维解决运维效率问题；目前各公司大部份运维主要工作还是依赖人工操作干预，需要尽可能的解放双手。</div><div class="line">5、运维知识的积累与沉淀、文档的完备性，运维是一个经验性非常强的岗位，好的经验与陷阱都需积累下来，避免重复性范错。</div><div class="line">6、计划性和执行力；工作有计划，计划后想法设法达到目标，不找借口。</div><div class="line">7、自动化运维；能对日常机械化工作进行提炼、设计并开发成工具、系统，能让系统自动完成的尽量依靠系统；让大家更多的时间用于思考、创新思维、做自已喜欢的事情。</div><div class="line">以上只是技术上的一些层面，当然个人意识也是很重要的。</div><div class="line">四、运维职业的迷惘、现状与发展前景</div><div class="line">运维岗位不像其它岗位，如研发工程师、测试工程师等，有非常明确的职责定位及职业规划，比较有职业认同感与成就感；而运维工作可能给人的感觉是哪方面都了</div><div class="line">解</div><div class="line">一些，但又都比上专职工程师更精通、感觉平时被关注度比较低（除非线上出现故障），慢慢的大家就会迷惘，对职业发展产生困惑,为什么会有这种现象呢？除了</div><div class="line">职业本身特点外，主要还是因为对运维了解不深入、做得不深入导致；其实这个问题其它岗位也会出现，但我发现运维更典型，更容易出现这个问题；</div><div class="line">针对这个问题我谈一下网站运维的现状及发展前景（也在思考中，可能不太深入全面，也请大家斧正补充）</div><div class="line">运维现状：</div><div class="line">1、处于刚起步的初级阶段，各大公司有此专职，但重视或重要程度不高，可替代性强；小公司更多是由其它岗位来兼顾做这一块工作，没有专职，也不可能做得深入。</div><div class="line">2、技术层次比较低；主要处于技术探索、积累阶段，没有型成体系化的理念、技术。</div><div class="line">3、体力劳动偏大；这个问题主要与第二点有关系，很多事情还是依靠人力进行，没有完成好的提练，对于大规模集群没有成熟的自动化管理方法，在此说明一下，大规模集群与运维工作是息息相关的如果只是百十来台机器，那就没有运维太大的生存空间了。</div><div class="line">4、优秀运维人才的极度缺乏；目前各大公司基本上都靠自已培养，这个现状导致行业内运维人才的流动性非常低，非常多好的技术都局限在各大公司内部，</div><div class="line">如 google 50万台机器科学的管理,或者国内互联公司top 10</div><div class="line">的一些运维经验，这些经验是非常有价值的东西并决定了一个公司的核心竞争力；这些问题进而导致业内先进运维技术的流通、贯通、与借签，并最终将限制了运维</div><div class="line">发展。</div><div class="line">5、很多优秀的运维经验都掌握在大公司手中；这不在于公司的技术实力，而在于大公司的技术规模、海量PV、硬件规模足够大，如baidu可怕的流</div><div class="line">量、 51.com海量数据~~~~这些因素决定了他们遇到的问题都是其它中/小公司还没有遇到的，或即将遇到。但大公司可能已有很好的解决方案或系统。</div><div class="line">发展前景：</div><div class="line">1、从行业角度来看，随着中国互联网的高速发展（目前中国网民已跃升为全球第一）、网站规模越来越来大、架构越来越复杂；对专职网站运维工程师、网站架构</div><div class="line">师的要求会越来越急迫,特别是对有经验的优秀运维人才需求量大，而且是越老越值钱；目前国内基本上都是选择毕业生培养（限于大公司），培养成本高，而且没</div><div class="line">有经验人才加入会导致公司技术更新缓慢、影响公司的技术发展；当然，毕业生也有好处：白纸一张，可塑性强，比较认同并容易融入企业文化。</div><div class="line">2、从个人角度，运维工程师技术含量及要求会越来越高，同时也是对公司应用、架构最了解最熟悉的人、越来越得到重视。</div><div class="line">3、网站运维将成为一个融合多学科（网络、系统、开发、安全、应用架构、存储等）的综合性技术岗位，给大家提供一个很好的个人能力与技术广度的发展空间。</div><div class="line">4、运维工作的相关经验将会变得非常重要，而且也将成为个人的核心竞争力，具备很好的各层面问题的解决能力及方案提供、全局思考能力等。</div><div class="line">5、特长发挥和兴趣的培养；由于运维岗位所接触的知识面非常广阔，更容易培养或发挥出个人某些方面的特长或爱好，如内核、网络、开发、数据库等方面，可以做得非常深入精通、成为这方面的专家。</div><div class="line">6、如果真要以后不想做运维了，转到其它岗位也比较容易，不会有太大的局限性。当然了，你得真正用心去做。</div><div class="line">7、技术发展方向：网站/系统架构师。</div><div class="line">五、运维关键技术点解剖</div><div class="line">1、 大规模集群管理问题</div><div class="line">首先我们先要明确集群的概念，集群不是泛指各功能服务器的总合，而是指为了达到某一目的或功能的服务器、硬盘资源的整合（机器数大于两台），对于应用来说</div><div class="line">它就是一个整体，目前常规集群可分为：高可用性集群（HA），负载均衡集群（如lvs），分布式储、计算存储集群（DFS，如google gfs</div><div class="line">,yahoo</div><div class="line">hadoop），特定应用集群（某一特定功能服务器组合、如db、cache层等），目前互联网行业主要基于这四种类型；对于前两种类似，如果业务简单、</div><div class="line">应用上post操作比较少，可以简单的采用四层交换机</div><div class="line">解决（如f5），达到服务高可用/负责均衡的作用，对于资源紧张的公司也有一些开源解决办法如lvs+ha,非常灵活；对于后两种，那就考验公司技术实力</div><div class="line">及应用特点了，第三种DFS主要应用于海量数据应用上，如邮件、搜索等应用，特别是搜索要求就更高了，除了简单海量存储，还包括数据挖掘、用户行为分析；</div><div class="line">如</div><div class="line">google、yahoo就能保存分析近一年的用户记录数据，而baidu应该少于30天、soguo就更少了。。。这些对于搜索准备性、及用户体验是至</div><div class="line">关重要的。</div><div class="line">接下来，我们再谈谈如何科学的管理集群，有以下关键几点：</div><div class="line">I、监控</div><div class="line">主要包括故障监控和性能、流量、负载等状态监控，这些监控关系到集群的健康运行，及潜在问题的及时发现与干预；</div><div class="line">a、服务故障、状态监控：主要是对服务器自身、上层应用、关联服务数据交互监控；例如针对前端web</div><div class="line">server，我们就可以有很多种类型的监控，包括应用端口</div><div class="line">状态监控，便于及时发现服务器或应用本身是否crash、通过icmp包探测服务器健康状态，更上层可能还包括应用各频道业务的监控，常用方法是采用面业</div><div class="line">特征码进行判断，或对重点页面进行签名，以网站被黑篡改（报警、并自动恢复被篡改数据）等等，这些只是一部份，还有N多监控方式，依应用特点而定，还有一</div><div class="line">些问题需解决，如集群过大，如何高性能的进行监控也是一个现实问题。</div><div class="line">b、其它就是集群状态类的监控或统计，为我们合理管理调优集群提供数据参考、包括服务瓶颈、性能问题、异常流量、攻击等问题。</div><div class="line">II、故障管理</div><div class="line">a、硬件故障问题；对于成百上千或上万机器的N多</div><div class="line">集群，服务器死机、硬件故障概率是非常大的，几乎每时每刻都有服务硬件问题，死机、硬盘损坏、电源、内存、交换机。针对这种情况，我们在设计网站架构时需</div><div class="line">要充分考虑到这些问题，并将其视为常态；更多的依靠应用的冗余机制来规避这种风险，但给系统工程师足够宽裕的处理时间。（如google不是号称同时死</div><div class="line">800台机器，服务不会受到任何影响吗）；这就是考验运维工程师及网站架构师功能的地方了，好的设计能达到google所描述自恢复能力，如gfs，糟糕</div><div class="line">的设计那就是一台服务器的死机可能会造成大面积服务的连锁故障反映，直接对用户拒绝响应。</div><div class="line">b、应用故障问题；可能是某一bug被触发、或某一性能阀值被超越、攻击等情况不一而定，但重要的一点，是要有对这些问题的预防性措施，不能想当然，它不</div><div class="line">会出问题，如真出问题了，如何应对？这需要运维工程师平时做足功夫，包括应急响应速度、故障处理的科学性、备用方案的有效等。</div><div class="line">III、自动化</div><div class="line">自动化：简而言之，就是将我们日常手动进行的一些工作通过工具，系统自动来完成，解放我们的双手及枯燥的重复性劳动，例如：没有工具前，我们安装系统需要</div><div class="line">一台一台裸机安装，如2000台，可能需要10人/10天，搞烂N张光盘，人力成本更大。。。而现在通过自动化工具，只需几个简单命令</div><div class="line">就能搞定、还有如机器人类程序，自动完成以往每天人工干预的工作，使其自动完成、汇报结果，并具备一定的专家系统能力，能做一些简单的是/非判断、优化选</div><div class="line">择等。。。这些好处非常明显不再多说。。。应该说，自动化运维是运维工程师职业化的一个追求，利已利公，虽然这是一个异常艰巨的任务：不断变更的业务、不</div><div class="line">规范化的应用设计、开发模式、网络架构变更、IDC变更、规范变动等因素，都可能会对现有自动化系统产生影响，所以需要模块化、接口化、变因参数化等因</div><div class="line">此，自动化相关工作，是运维工程师的核心重点工作之一，也是价值的体现。</div></pre></td></tr></table></figure>
<h3 id="交流学习："><a href="#交流学习：" class="headerlink" title="交流学习："></a>交流学习：</h3><p>🐧  Linux shell_高级运维派: <code>459096184</code>    圈子 (系统运维-应用运维-自动化运维-虚拟化技术研究欢迎加入)<br>🐧  BigData-Exchange School : <code>521621407</code>  圈子（大数据运维)（Hadoop开发人员)（大数据研究爱好者) 欢迎加入</p>
<p>相应Bidata有内部微信交流群互相学习，加入QQ群有链接。</p>

	

	

</article>




	<article>
	
		<h1><a href="/2016/09/12/自动化+Jenkins/Jenkins/用Ansible + Jenkins+maven＋nginx搞定自动发布，构建程序的持续集成平台/">Ansible + Jenkins+Maven＋Nginx搞定自动发布，构建程序的持续集成平台</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-09-12</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/automation/">automation</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Jenkins/">Jenkins</a> <a class="article__tag-link" href="/tags/Manven/">Manven</a>
			</span>
		
	</div>

	

	
		<h1 id="Ansible-Jenkins搞定自动发布，构建程序的持续集成平台"><a href="#Ansible-Jenkins搞定自动发布，构建程序的持续集成平台" class="headerlink" title="Ansible+Jenkins搞定自动发布，构建程序的持续集成平台"></a>Ansible+Jenkins搞定自动发布，构建程序的持续集成平台</h1><p>Ansible是相对简单的批量管理工具，支持模板管理等高级功能。搞定了自动发布，开发的服务器需求已经明显下降，只要把代码提交到 Git主干，就会自动触发发布。</p>
<p>今天有空就简单记录下用Ansible + Jenkins搞定自动发布 。这篇是主要环境安装。</p>
<h3 id="一、什么是持续集成"><a href="#一、什么是持续集成" class="headerlink" title="一、什么是持续集成"></a>一、什么是持续集成</h3><p><strong>1、什么是集成</strong></p>
<p>指的是代码由编译、发布和测试、直到上线的一个过程</p>
<p><strong>2、什么持续集成</strong></p>
<p>高效的、持续性质的不断迭代代码的集成工作</p>
<p><strong>3、如何高效准确的实现持续集成</strong></p>
<p>必不可少的需要一套能自动化、并且可视化的平台来帮助我们。</p>
<p>那么总结来看，Jenkins就是一个可以帮助我们实现持续集成的平台。</p>
<h3 id="二、为什么Jenkins能帮助我们进行持续集成"><a href="#二、为什么Jenkins能帮助我们进行持续集成" class="headerlink" title="二、为什么Jenkins能帮助我们进行持续集成"></a>二、为什么Jenkins能帮助我们进行持续集成</h3><p> 理由有如下几点：</p>
<p><strong>1、Jenkins是一个开源的、且基于JAVA代码开发的持续集成系统。</strong></p>
<p>因为含有非常丰富的插件支持所以我们可以方便的打通版本库、测试构建环境、线上环境的所有环节。并且丰富友好的通知使用者和开发、管理人员。</p>
<p><strong>2、安装维护简单</strong></p>
<p>安装Jenkins，不太复杂。且支持通用的平台。</p>
<p><strong>3、Java 应用 常用</strong></p>
<p>在企业的软件构建过程中，JAVA的应用工程稍显复杂，由于复杂构建、和代码上线、并且服务的重启。整个过程下来，消耗的时间较多，Jenkins却能很好的集成maven的编译方式，且利用自动化的插件、和自定义开发脚本的支持。所以目前广泛的应用于JAVA工程的持续集成平台。</p>
<p>好了，那么接下来我就来介绍，如何搭建一套快速有效的Jenkins自动化发布持续集成平台。</p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>为了提高工作效率，避免重复的手动发包部署工作，特搭建Jenkins+Ansible的自动部署平台。<br>主要实现原理是：</p>
<ul>
<li>由Jenkins拉取git代码  </li>
<li>使用Maven命令编译打包  </li>
<li>通过Ansible 发送war包到对应的服务器  </li>
<li>通过Ansible执行远程服务器的重启命令 </li>
<li>发布完成。</li>
</ul>
<h3 id="一-环境介绍"><a href="#一-环境介绍" class="headerlink" title="一. 环境介绍"></a>一. 环境介绍</h3><p>本平台搭建在CentOS6环境中，其他linux环境情况类似。<br>在自动部署服务器中需要安装以下软件：</p>
<ol>
<li>JDK</li>
<li>Git</li>
<li>Maven</li>
<li>Tomcat</li>
<li>Jenkins</li>
<li>Ansible</li>
</ol>
<h3 id="二-步骤："><a href="#二-步骤：" class="headerlink" title="二. 步骤："></a>二. 步骤：</h3><ol>
<li>ansible安装与配置；</li>
<li>Jenkins的安装；</li>
<li>Jenkins的配置；</li>
<li>安装配置tomcat</li>
<li>安装配置Java；</li>
<li>安装配置maven；</li>
<li>nginx反向代理配置访问域名；</li>
<li>相关插件安装；</li>
<li>系统设置明细；</li>
<li>slave节点配置；</li>
<li>一些依赖项的安装。</li>
</ol>
<h4 id="1-1-Ansible简单介绍"><a href="#1-1-Ansible简单介绍" class="headerlink" title="1.1    Ansible简单介绍"></a>1.1    Ansible简单介绍</h4><p>Ansible是一个部署一群远程主机的工具。远程的主机可以是本地或者远程的虚拟 机，也可以是远程的物理机。<br>Ansible通过SSH协议进行管理节点和远程节点之间的通信。理论上说管理员通过 ssh到一台远程主机上能做的操作Ansible都可以做。包括：拷贝文件、安装包、启动服务…</p>
<p>总结：<strong>Ansible把一些shell命令封装成一个个模块，并通过SSH连接，在远程机器上执行这些模块包含的脚本。</strong></p>
<h4 id="1-2-Ansible安装与配置"><a href="#1-2-Ansible安装与配置" class="headerlink" title="1.2    Ansible安装与配置"></a>1.2    Ansible安装与配置</h4><p>系统环境：centos7.1<br>直接使用yum安装ansible</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># yum install http://mirrors.sohu.com/fedora-epel/6/x86_64/epel-release-6-8.noarch.rpm</span></div><div class="line"><span class="comment"># yum install ansible</span></div></pre></td></tr></table></figure>
<p>安装完成之后，需要<code>ansible</code>中的<code>hosts</code>文件分组，编辑<code>/etc/ansible/hosts</code>文件，将目标机器加入分组，并配置好面秘钥登录。<br>Ansible更多详细内容可以参考我之前写的<a href="http://blog.yangcvo.me/2016/03/07/%E8%87%AA%E5%8A%A8%E5%8C%96/Ansible/Ansible%20%E5%B0%8F%E7%BB%93%EF%BC%88%E4%B8%80%EF%BC%89ansible%E7%9A%84%E5%AE%89%E8%A3%85%20/" target="_blank" rel="external">ansibles学习篇</a></p>
<h4 id="二-安装Jenkins环境"><a href="#二-安装Jenkins环境" class="headerlink" title="二. 安装Jenkins环境"></a>二. 安装Jenkins环境</h4><p>1)    安装并配置好JAVA、JDK、Tomcat，并去官网下载最新版本的war包。</p>
<p>去官网下载包资源：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">apache-tomcat-8.0.28.tar.gz</div><div class="line">jenkins.war</div><div class="line">jdk1.8.0_66.tar.gz</div><div class="line">maven.tar.gz</div></pre></td></tr></table></figure>
<p>没有下载成功的我这里已下载好了。最新版本<br><a href="http://oak0aohum.bkt.clouddn.com/jenkins.war" target="_blank" rel="external">jenkins.war</a><br><a href="http://oak0aohum.bkt.clouddn.com/apache-tomcat-8.0.28.tar.gz" target="_blank" rel="external">tomcat.tar.gz</a><br><a href="http://oak0aohum.bkt.clouddn.com/maven.tar.gz" target="_blank" rel="external">maven.tar.gz</a></p>
<h5 id="2-1-jdk安装："><a href="#2-1-jdk安装：" class="headerlink" title="2.1 jdk安装："></a>2.1 jdk安装：</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">tar -zxvf jdk1.8.0_66.tar.gz -C /srv/.</div><div class="line">         </div><div class="line">这里在配置环境变量。</div><div class="line"></div><div class="line">vim /etc/profile.d/java.sh</div><div class="line"><span class="built_in">export</span> JAVA_HOME=/srv/jdk1.8.0_66</div><div class="line"><span class="built_in">export</span> CLASS_PATH=<span class="string">"<span class="variable">$JAVA_HOME</span>/lib:<span class="variable">$JAVA_HOME</span>/jre/lib"</span></div><div class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin</div><div class="line"></div><div class="line">[root@Jenkins ~]<span class="comment"># java -version</span></div><div class="line">java version <span class="string">"1.8.0_66"</span></div><div class="line">Java(TM) SE Runtime Environment (build 1.8.0_66-b17)</div><div class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.66-b17, mixed mode)</div></pre></td></tr></table></figure>
<h5 id="2-2-Tomcat安装配置："><a href="#2-2-Tomcat安装配置：" class="headerlink" title="2.2 Tomcat安装配置："></a>2.2 Tomcat安装配置：</h5><p>Jenkins官网：<a href="https://jenkins.io/index.html" target="_blank" rel="external">https://jenkins.io/index.html</a><br>可参考我之前写的文档：<a href="http://blog.yangcvo.me/2015/11/21/tomcat/%E6%90%AD%E5%BB%BA%E9%85%8D%E7%BD%AEtomcat%E7%8E%AF%E5%A2%83/" target="_blank" rel="external">搭建配置tomcat环境</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">tar -zxvf apache-tomcat-8.0.28.tar.gz -C /srv/.</div><div class="line">mv apache-tomcat-8.0.28 tomcat</div><div class="line">useradd <span class="_">-s</span> /sbin/nologin tomcat </div><div class="line">chown -R tomcat:tomcat tomcat</div></pre></td></tr></table></figure>
<p>2)    放在配置好Tomcat，启动Jenkins，根据提示，输入安装秘钥。</p>
<h5 id="2-3-jenkins安装配置："><a href="#2-3-jenkins安装配置：" class="headerlink" title="2.3 jenkins安装配置："></a>2.3 jenkins安装配置：</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">mv jenkins.war /srv/tomcat/webapps/. </div><div class="line"><span class="built_in">cd</span> /tomcat</div><div class="line">./bin/startup.sh</div><div class="line">然后打开地址：http://192.168.1.183:8080/jenkins</div><div class="line">新版本会提示下载安装插件。下载以后会让你设置账号和密码还有邮箱。</div></pre></td></tr></table></figure>
<p>进入安装界面:<br>第一次，登录，需要进行一个解锁 ，页面也会有提示.</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins1.png" alt=""></figure></p>
<p>秘钥的具体位置在：<code>/root/.jenkins/secrets/initialAdminPassword</code>中，我们可以通过这个文件中查看密码，并输入。</p>
<p>3)    设置好登录账号密码，根据推荐选项安装插件，等待下载安装完成。在插件安装过程中可能有些安装不成功，暂时先不用管。</p>
<p>它会给我们安装一些基础的插件<br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins_01.png" alt=""></figure><br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins_02.png" alt=""></figure><br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins_03.png" alt=""></figure><br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins_04.png" alt=""></figure><br>早期jenkins默认是不需要登陆的。</p>
<h4 id="1-3-Maven-安装和配置"><a href="#1-3-Maven-安装和配置" class="headerlink" title="1.3 Maven 安装和配置"></a>1.3 Maven 安装和配置</h4><p>官网：<a href="http://maven.apache.org/" target="_blank" rel="external">http://maven.apache.org/</a><br>官网下载：<a href="http://maven.apache.org/download.cgi" target="_blank" rel="external">http://maven.apache.org/download.cgi</a><br>历史版本下载：<a href="https://archive.apache.org/dist/maven/binaries/" target="_blank" rel="external">https://archive.apache.org/dist/maven/binaries/</a><br>此时（20160208） Maven 最新版本为：<strong>3.3.9</strong></p>
<p>Maven 3.3 的 JDK 最低要求是 JDK 1.7 - 我个人习惯 <code>/opt</code> 目录下创建一个目录 <code>setups</code> 用来存放各种软件安装包；在 <code>/srv</code> 目录下创建一个 <code>program</code> 用来存放各种解压后的软件包，下面的讲解也都是基于此习惯.</p>
<p>下载压缩包：<code>wget http://mirrors.cnnic.cn/apache/maven/maven-3/3.3.9/binaries/apache-maven-3.3.9-bin.tar.gz</code><br>解压指定到我个人习惯的安装目录下：<code>tar zxvf apache-maven-3.3.9-bin.tar.gz -C /srv/program/.</code><br>移到我个人习惯的安装目录下：<code>mv maven3.3.9/ /srv/program/maven3</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">环境变量设置：vim /etc/profile.d/maven.sh</div><div class="line">    <span class="comment"># Maven</span></div><div class="line">    MAVEN_HOME=/srv/program/maven3</div><div class="line">    PATH=<span class="variable">$PATH</span>:<span class="variable">$MAVEN_HOME</span>/bin</div><div class="line">    MAVEN_OPTS=<span class="string">"-Xms256m -Xmx356m"</span></div><div class="line">    <span class="built_in">export</span> MAVEN_HOME</div><div class="line">    <span class="built_in">export</span> PATH</div><div class="line">    <span class="built_in">export</span> MAVEN_OPTS</div></pre></td></tr></table></figure>
<p>刷新配置文件：<code>source /etc/profile</code><br>测试是否安装成功：<code>mvn -version</code></p>
<h4 id="1-3-1-Maven-配置"><a href="#1-3-1-Maven-配置" class="headerlink" title="1.3.1 Maven 配置"></a>1.3.1 Maven 配置</h4><ul>
<li>配置项目连接上私服</li>
<li>全局方式配置：</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span><span class="meta">?&gt;</span></span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">settings</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/SETTINGS/1.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/SETTINGS/1.0.0 http://maven.apache.org/xsd/settings-1.0.0.xsd"</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="comment">&lt;!--本地仓库位置--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">localRepository</span>&gt;</span>/srv/mv2<span class="tag">&lt;/<span class="name">localRepository</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">pluginGroups</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">pluginGroups</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">proxies</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">proxies</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="comment">&lt;!--设置 Nexus 认证信息--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">servers</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">server</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-releases<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">username</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">username</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">password</span>&gt;</span>admin123<span class="tag">&lt;/<span class="name">password</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">server</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">server</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-snapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">username</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">username</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">password</span>&gt;</span>admin123<span class="tag">&lt;/<span class="name">password</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">server</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">servers</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="comment">&lt;!--设置 Nexus 镜像，后面只要本地没对应的以来，则到 Nexus 去找--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">mirrors</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-releases<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>*<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://localhost:8081/nexus/content/groups/public<span class="tag">&lt;/<span class="name">url</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-snapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>*<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://localhost:8081/nexus/content/groups/public-snapshots<span class="tag">&lt;/<span class="name">url</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">mirrors</span>&gt;</span></div><div class="line"></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">profiles</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">profile</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">repositories</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">repository</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-releases<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://nexus-releases<span class="tag">&lt;/<span class="name">url</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">releases</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">repository</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-snapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://nexus-snapshots<span class="tag">&lt;/<span class="name">url</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">releases</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">pluginRepositories</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">pluginRepository</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-releases<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://nexus-releases<span class="tag">&lt;/<span class="name">url</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">releases</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">pluginRepository</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">pluginRepository</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-snapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://nexus-snapshots<span class="tag">&lt;/<span class="name">url</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">releases</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">pluginRepository</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">pluginRepositories</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">activeProfiles</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">activeProfile</span>&gt;</span>nexus<span class="tag">&lt;/<span class="name">activeProfile</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">activeProfiles</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></div></pre></td></tr></table></figure>
<ul>
<li>jenkins发布修改过以后：</li>
</ul>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div></pre></td><td class="code"><pre><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">settings</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span></div><div class="line">          <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></div><div class="line">          <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0</span></div><div class="line">                               http://maven.apache.org/xsd/settings-1.0.0.xsd"&gt;</div><div class="line">                               </div><div class="line">                               </div><div class="line">         <span class="comment">&lt;!--表示本地库的保存位置，也就是maven2主要的jar保存位置，默认在$</span><span class="template-variable">&#123;user.dir&#125;</span><span class="xml"><span class="comment">/.m2/repository，如果需要另外设置，就换成其他的路径。 --&gt;</span></span></div><div class="line">         </div><div class="line">  <span class="tag">&lt;<span class="name">localRepository</span>&gt;</span>/srv/m2<span class="tag">&lt;/<span class="name">localRepository</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">interactiveMode</span>/&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">usePluginRegistry</span>/&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">offline</span>&gt;</span>false<span class="tag">&lt;/<span class="name">offline</span>&gt;</span></div><div class="line">  </div><div class="line">  </div><div class="line">  <span class="comment">&lt;!--当插件的组织Id（groupId）没有显式提供时，供搜寻插件组织Id（groupId）的列表。该元素包含一个pluginGroup元素列表，每个子元素包含了一个组织Id（groupId）。</span></div><div class="line">当我们使用某个插件，并且没有在命令行为其提供组织Id（groupId）的时候，Maven就会使用该列表。默认情况下该列表包含了org.apache.maven.plugins。 --&gt;</div><div class="line"></div><div class="line"> <span class="tag">&lt;<span class="name">pluginGroups</span>&gt;</span></div><div class="line">  <span class="comment">&lt;!--plugin的组织Id（groupId） --&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">pluginGroup</span>&gt;</span>org.codehaus.mojo<span class="tag">&lt;/<span class="name">pluginGroup</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">pluginGroup</span>&gt;</span>org.apache.tomcat.maven<span class="tag">&lt;/<span class="name">pluginGroup</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">pluginGroup</span>&gt;</span>org.mortbay.jetty<span class="tag">&lt;/<span class="name">pluginGroup</span>&gt;</span></div><div class="line"> <span class="tag">&lt;/<span class="name">pluginGroups</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">servers</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">server</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>tomcat<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">username</span>&gt;</span>tomcat<span class="tag">&lt;/<span class="name">username</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">password</span>&gt;</span>keyfree123<span class="tag">&lt;/<span class="name">password</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">server</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">server</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">id</span>&gt;</span>haozhuo<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">username</span>&gt;</span>haozhuo<span class="tag">&lt;/<span class="name">username</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">password</span>&gt;</span>haozhuo123<span class="tag">&lt;/<span class="name">password</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">server</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!--d:server 的id,用于匹配distributionManagement库id，比较重要。 --&gt;</span></div><div class="line">         <span class="tag">&lt;<span class="name">server</span>&gt;</span></div><div class="line">     <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-releases<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!--username, password:用于登陆此服务器的用户名和密码 --&gt;</span></div><div class="line">     <span class="tag">&lt;<span class="name">username</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">username</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">password</span>&gt;</span>123456<span class="tag">&lt;/<span class="name">password</span>&gt;</span></div><div class="line">   <span class="tag">&lt;/<span class="name">server</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">server</span>&gt;</span></div><div class="line">     <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-snapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">     <span class="tag">&lt;<span class="name">username</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">username</span>&gt;</span></div><div class="line">     <span class="tag">&lt;<span class="name">password</span>&gt;</span>123456<span class="tag">&lt;/<span class="name">password</span>&gt;</span></div><div class="line">   <span class="tag">&lt;/<span class="name">server</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">servers</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">mirrors</span>&gt;</span></div><div class="line">  <span class="comment">&lt;!--表示镜像库，指定库的镜像，用于增加其他库 --&gt;</span></div><div class="line"></div><div class="line">   </div><div class="line">    <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-aliyun<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>*<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>Nexus aliyun<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public<span class="tag">&lt;/<span class="name">url</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>hz<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>hz Central<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://nexus.haozhuo.com:8083/nexus/content/groups/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>CN<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>OSChina Central<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.oschina.net/content/groups/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">          <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></div><div class="line">           <span class="tag">&lt;<span class="name">id</span>&gt;</span>ibiblio.org<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">           <span class="tag">&lt;<span class="name">name</span>&gt;</span>ibiblio Mirror of http://repo1.maven.org/maven2/<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">           <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://mirrors.ibiblio.org/pub/mirrors/maven2<span class="tag">&lt;/<span class="name">url</span>&gt;</span></div><div class="line">           <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></div><div class="line"></div><div class="line">     <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></div><div class="line">        </div><div class="line">           <span class="comment">&lt;!--</span></div><div class="line">     &lt;mirror&gt;</div><div class="line">         &lt;id&gt;jboss-public-repository-group&lt;/id&gt;</div><div class="line">         &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;</div><div class="line">         &lt;name&gt;JBoss Public Repository Group&lt;/name&gt;</div><div class="line">         &lt;url&gt;http://repository.jboss.org/nexus/content/groups/public&lt;/url&gt;</div><div class="line">     &lt;/mirror&gt;</div><div class="line">            --&gt;</div><div class="line">            </div><div class="line"> <span class="tag">&lt;/<span class="name">mirrors</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">activeProfiles</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!--make the profile active all the time --&gt;</span></div><div class="line">     <span class="comment">&lt;!--&lt;activeProfile&gt;nexus&lt;/activeProfile&gt;   --&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">activeProfiles</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="三-配置nginx反向代理"><a href="#三-配置nginx反向代理" class="headerlink" title="三. 配置nginx反向代理."></a>三. 配置nginx反向代理.</h3><p>在nginx配置目录/usr/local/nginx/conf/nginx.conf，配置文件内容如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">upstream tomcat-jenkins &#123;</div><div class="line">     server  192.168.1.220:8080 weight=1;</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> server &#123;</div><div class="line">     listen       80;</div><div class="line">     server_name  jenkins.yjk.cn;</div><div class="line">     location / &#123;</div><div class="line">        index        index.html index.php index.jsp index.htm;</div><div class="line">        proxy_pass           http://tomcat-jenkins;</div><div class="line">        proxy_ignore_client_abort on;</div><div class="line">        proxy_redirect               off;</div><div class="line">        proxy_set_header     Host    <span class="variable">$host</span>;</div><div class="line">        proxy_set_header     X-Real-IP       <span class="variable">$remote_addr</span>;</div><div class="line">        proxy_set_header     X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</div><div class="line">     &#125;</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<p>修改/etc/hosts，在末尾新增一行 :</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">127.0.0.1     jenkins.yjk.cn</div></pre></td></tr></table></figure>
<p>重启nginx，<code>/usr/sbin/nginx -s reload</code>，即可以地址 <code>jenkins.yjk.cn</code> 访问Jenkins主页.</p>
<h3 id="四-安装部分Jenkins插件"><a href="#四-安装部分Jenkins插件" class="headerlink" title="四. 安装部分Jenkins插件"></a>四. 安装部分Jenkins插件</h3><p>访问Jenkins主页：<a href="http://jenkins.yjk.cn" target="_blank" rel="external">http://jenkins.yjk.cn</a><br>系统管理 –&gt; 管理插件 –&gt; 可选插件;<br>安装所需要的插件(根据需要自行选择)，如 <code>GitBucket Plugin、 FindBugs Plug-in 、Cobertura Plugin 、 Violations Plugin 、Email Extension Plugin</code>等</p>
<p>⚠️插件安装不成功处理办法：</p>
<p>进入左侧菜单栏的系统管理，发现很多插件无法安装成功，如下图：<br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins.cah.png" alt=""></figure></p>
<p>复制安装失败的名称，点击右侧按钮，选择可选插件，输入名称重新安装。</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins.ansible.1.png" alt=""></figure></p>
<p>如果还是失败，请注意提示信息，可直接下载该插件手动上传安装，手动下载该插件，在插件管理的高级标签中，选择上传安装。</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins.ansible.2.png" alt=""></figure><br>如果上传失败，还有个方法：直接把下载下来的插件上传到Jenkins服务器上面。默认安装的话目录在：/root/.jenkins/plugins/  重启服务即可.</p>
<h3 id="五-系统设置以及介绍（可跳过）"><a href="#五-系统设置以及介绍（可跳过）" class="headerlink" title="五. 系统设置以及介绍（可跳过）"></a>五. 系统设置以及介绍（可跳过）</h3><h4 id="1-1-系统配置"><a href="#1-1-系统配置" class="headerlink" title="1.1 系统配置"></a>1.1 系统配置</h4><p>进入首页系统管理—&gt;系统设置。</p>
<ol>
<li>配置maven</li>
<li>配置邮件服务<br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins.ansible.3.png" alt=""></figure> </li>
</ol>
<p>主目录默认在 /root/.jenkins  下面，此目录保存jenkins 的所有配置和插件等，具体可以于服务器中查看该目录。<br>下面可以继续配置maven，jdk，git等等，也可以使用默认的配置。</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins.ansible.4.png" alt=""></figure><br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins.ansible.5.png" alt=""></figure></p>
<h4 id="1-2-项目配置"><a href="#1-2-项目配置" class="headerlink" title="1.2 项目配置"></a>1.2 项目配置</h4><p>新建一个自由风格的项目，输入项目名称。</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins.ansible.6.png" alt=""></figure><br>1.参数配置</p>
<p>简单的从Git中拉取代码无法满足我们的需求，最理想的状态是可以对发布的分支进行动态选择。所以我们需要安装一个配置动态参数的插件：<a href="https://wiki.jenkins-ci.org/display/JENKINS/Dynamic+Parameter+Plug-in" target="_blank" rel="external">Dynamic Parameter Plug-in</a> </p>
<p>安装好插件之后，在项目配置，参数化构建过程中添加动态参数：</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins.ansible.7.png" alt=""></figure><br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins.ansible.8.png" alt=""></figure></p>
<p>输入变量名称和脚本，在接下来的配置中就可以使用<code>$Name</code>的方式，使用变量了。如：<code>$branch</code>。</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins.ansible.9.png" alt=""></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">def gettags = (<span class="string">"git ls-remote -h git@gitlab.ihaozhuo.com:Java_Service/YJK-Java.git"</span>).execute() </div><div class="line">gettags.text.readLines().collect &#123; it.split()[1].replaceAll(<span class="string">'refs/heads/'</span>, <span class="string">''</span>)  &#125;.unique()</div></pre></td></tr></table></figure>
<p> 这是一段<code>Groovy</code>脚本，用来获取Git地址的分支，将Git地址改成自己的就行。</p>
<h4 id="1-3接下来选择扩展功能。"><a href="#1-3接下来选择扩展功能。" class="headerlink" title="1.3接下来选择扩展功能。"></a>1.3接下来选择扩展功能。</h4><p>由于我们的项目模块较多，所有的服务全部重启会非常浪费时间，我们希望能对单独的模块进行部署，这时候需要添加一个可选择的参数<code>Extensible Choice Parameter</code></p>
<p>扩展选择参数插件<code>Extensible Choice Parameter</code>灵活使用实现部署多应用模块服务同时发布.单模块服务单独打包快速发布.</p>
<p>实现效果：</p>
<p>发布选择应用模块，之前只能单个选择发布，效率太低，安装choice扩展性的插件，可以选择多个模块应用一起部署。非常方便<br>下载插件：<br><a href="https://plugins.jenkins.io/extended-choice-parameter" target="_blank" rel="external">Extended Choice Parameter Plug-In</a><br><a href="https://plugins.jenkins.io/extensible-choice-parameter" target="_blank" rel="external">Extensible Choice Parameter plugin</a></p>
<p>这里jenkins 第一步安装扩展插件：</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins.peizhi.1.png" alt=""></figure><br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins.peizhi.2.png" alt=""></figure><br>安装好插件以后 进入创建项目配置参数：</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins.peizhi.3.png" alt=""></figure></p>
<p><code>Value</code> ：这里选择模块名字最好是git拉取下来的名称一样。这样下面打包可以选择对应模块名称一样。<br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins.peizhi.4.png" alt=""></figure></p>
<p>这里构建使用shell 做一层<code>if</code> 判断  选择<code>all</code> 全部发布。和单独模块发布。</p>
<h4 id="1-4Git配置"><a href="#1-4Git配置" class="headerlink" title="1.4Git配置"></a>1.4Git配置</h4><p>初次使用Jenkins需要添加一个有访问Git权限的用户。<br>我直接使用系统自带的ssh-key，也可以自己去生成。<br>在gitlab上添加ssh-key公钥 这个是你发布机器的公钥。</p>
<p>1.源码管理选择Git，输入URL，并选择用户。</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins.ansible.10.png" alt=""></figure></p>
<p>从Jenkins发布服务器上面查看公钥上传到gitlab.</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins.ansbile.11.png" alt=""></figure></p>
<p>2.在jenkins上点击添加私钥<br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins.ansible.12.png" alt=""></figure><br>3.选择SSH…key，输入用户名，输入私钥，输入密码，添加完成。<br>在Jenkins发布服务器上面查看私钥：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">[root@ansible_02 yaml]<span class="comment"># cat /root/.ssh/id_rsa</span></div><div class="line">-----BEGIN RSA PRIVATE KEY-----</div><div class="line">MIIEpAIBAAKCAQEAv5BSNmykQcvklQdb+3jV8d1I2tjq4tIiyVbQDhDBs6UFR4hj</div><div class="line">20EHg/3Tjvw+4mHtzWFYv1/rYeTg7xJ/bIf3XRIeRcrc/b2rvqo3wQBupRjHM6wb</div><div class="line">nd+Jgyv2v8Lk2c8yNzMoUIuYzcG5Dpv5mWyg1akbWcIH3tsGyTVXxxmAQ78L+J1N</div><div class="line">zj3a9fImQcx5ocKlV/Y1v9B+Uv4gTBmSBR7akvNg7E+3JKTphbbUv3rFrG6zqvTW</div><div class="line">CtEA/h9X//zPWTiwTjJv87NJkHQLqoo1TPYZcNjDEfki+jfc9gJzJvZ/5D0A3fA/</div><div class="line">mO8ApW9VMsaLiiwQvGP2RoiTVwU2G1iNASBcWwIDAQABAoIBABh64fawhYEfBDQD</div><div class="line">P77wHy8MXz4QUFvyDJ38KRRTEd3aLcWJaXFgawx0CHASThrx9sizMvspz9Ovwwrq</div><div class="line">Kzx8V6EeKp4yoXEPpv3zlLJmUr1oYDR7PwA6y8Dmgl7ZEhO/haRGNlWssTdCFVsH</div><div class="line">lasElb0YIjWjNQxGoyRdW71GxfxiGdZXgWDT7yYGvdavO5tGzDPhh6/vf5lpU2F2</div><div class="line">nJbMyXzWgrrqXqIG3W+jqg2kVA<span class="keyword">fi</span>MdNgeUOn6+SA/7uK8rNhxG/5dr7WKJE31uRS</div><div class="line">FJiVCATcHQBIRScDDd/nI8rGiVQOjHFt2oNV82DOIhNXhbzdWGROUcMiT04OoJgQ</div><div class="line">JeNL7IkCgYEA8wrgamw1w5dBoynzV6tUPgSdHhAMoMhPrzJTaG8qMamnHzZgz1fl</div><div class="line">3jqI7qCNsj1n6Y1UbzhKILHcTIoUj7lj41mY4XVBHqDLXh9Socf9IPrSabZIfe2n</div><div class="line">wMLMhdhoaMPUWtHj9SUn/Y+ESLuFLtF6LjR1Eghu8xKRwULo1GscSyUCgYEAycbY</div><div class="line">j1/KaFAcwSl7teRiYEY+LRHB/AUa7lc+r+p2YMjGQ3CiaN9wKqu1E4jEvL0eZXDK</div><div class="line">aXJ6qcDJiHa2M+Bf8qcVoyXtKFtlTfSVPJDviZjl3EPmhXbuKzW3et2w5zWv8lAU</div><div class="line">2fWU+3ta3fVrFXz2zlY1j47Dv9zUlDeCF+lRMX8CgYEA1hkKwDU612XzSEy4NM6U</div><div class="line">k111GvqAZVKP/4GRwDnNLZqJwhEhDwYbVLyzy6JbsFwvoaoCa0dm5Y5IxpQMsN9b</div><div class="line">Z9GGH7CWLEJ7a4gJmrYQYpECgYAIqe8WiOhp/jad3KghMUNAGwQEb2TC630yirB4</div><div class="line">YTrgAP7yWl2+3wkz69eElTTNXdl2RZeLW40EyPBeWaqNI686/g2hybkbKIF7DWtz</div><div class="line">BE4kvFnyUUAOrwKe/Fl6fxZfdyCs6N9cVH0nJy7JpQYKECmQxobaOSkSjerayl9d</div><div class="line">x1mI3d6fwqmAbbyiolLXbn3JySkxTaVBS8gjnQh6LO6JbpTspKlz3R2/CzUhDhEY</div><div class="line">n3vhU2trAGh6hY/bizI1oKNxwp/b9uAaLVmmHGNV/+V5glnDH+luQA==</div><div class="line">-----END RSA PRIVATE KEY-----</div></pre></td></tr></table></figure>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins.ansible.13.png" alt=""></figure></p>
<p>此处要注意，将默认的master分支改为我们之前定义好的分支变量.<br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins.peizhi.5.png" alt=""></figure></p>
<h4 id="1-5项目打包"><a href="#1-5项目打包" class="headerlink" title="1.5项目打包"></a>1.5项目打包</h4><p>由于我们使用手动出发构建，触发器我们此处不需要配置。<br>构建环境暂时也不需要配置，这里调用ansible去执行yml代码发布。项目打包优化了。</p>
<p>关键在于构建的步骤。<br>我们可以使用Shell命令，进入项目目录，使用Maven命令进行打包。</p>
<p>这里主要是<code>if</code> 判断是 执行对应模块打包。这样节省了打包时间，如果不做对应发布模块发布，第一条如何<code>model</code>等于<code>all</code> 文件：全部执行 : <code>mvn clean install -U -T 1C -Dmaven.test.skip=true</code></p>
<p>如果不等于这里指定对应模块打包： <code>mvn clean install -pl $model -amd -U -T 1C -Dmaven.test.skip=true</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">echo</span> <span class="variable">$model</span></div><div class="line"><span class="keyword">if</span> [[ <span class="variable">$model</span> == all* ]]; <span class="keyword">then</span></div><div class="line"><span class="built_in">cd</span> /srv/ &amp;&amp; rm dev-properties/ -rf &amp;&amp; git <span class="built_in">clone</span> git@gitlab.ihaozhuo.com:dev-properties/dev-properties.git &amp;&amp; <span class="built_in">cd</span> /root/.jenkins/workspace/yjk-dev_master/haozhuo/ &amp;&amp; mvn clean install -U -T 1C -Dmaven.test.skip=<span class="literal">true</span>  -Dmaven.compile.fork=<span class="literal">true</span> -Pdev -Dautoconfig.userProperties=/srv/dev-properties/dev1.properties -Dautoconfig.charset=utf-8</div><div class="line"><span class="keyword">else</span></div><div class="line"><span class="built_in">cd</span> /srv/ &amp;&amp; rm dev-properties/ -rf &amp;&amp; git <span class="built_in">clone</span> git@gitlab.ihaozhuo.com:dev-properties/dev-properties.git &amp;&amp; <span class="built_in">cd</span> /root/.jenkins/workspace/yjk-dev_master/haozhuo/ &amp;&amp; mvn clean install -pl <span class="variable">$model</span> -amd -U -T 1C -Dmaven.test.skip=<span class="literal">true</span>  -Dmaven.compile.fork=<span class="literal">true</span> -Pdev -Dautoconfig.userProperties=/srv/dev-properties/dev1.properties -Dautoconfig.charset=utf-8</div><div class="line"><span class="keyword">fi</span></div></pre></td></tr></table></figure>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins.peizhi.6.png" alt=""></figure></p>
<p>所有的脚本和变量的参数列表统一。</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins.peizhi8.png" alt=""></figure></p>
<p>这里说下发布模块 结合<code>ansible-Playbook</code>基本语法写控制发布服务器，然后在<code>jenkins</code>上面写ansible 发布脚本&amp;命令。<br>model.sh 脚本： </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/bin/sh</span></div><div class="line">  IFS=<span class="string">','</span></div><div class="line">  arr=<span class="variable">$1</span></div><div class="line">  <span class="keyword">for</span> split <span class="keyword">in</span> <span class="variable">$arr</span></div><div class="line">  <span class="keyword">do</span></div><div class="line">          <span class="built_in">echo</span> <span class="variable">$split</span></div><div class="line">       /usr/bin/ansible-playbook /srv/yaml/<span class="variable">$split</span>.yml</div><div class="line">          <span class="keyword">if</span> [ <span class="variable">$split</span> = <span class="string">'all'</span> ]</div><div class="line">          <span class="keyword">then</span></div><div class="line">                  <span class="built_in">echo</span> <span class="string">"model:all"</span></div><div class="line">                  <span class="built_in">break</span></div><div class="line">          <span class="keyword">fi</span></div><div class="line">  <span class="keyword">done</span></div></pre></td></tr></table></figure>
<p>这里举个例子我上面发布yml模块代码。</p>
<p>这个脚本做了五件事：<br>1)               首先指定编码为UTF-8（否则启动项目后会乱码！这是个坑!）<br>2)               拷贝文件到指定机器的目录下，拷贝命令的dest不能使用变量！否则拷贝不会成功！（第二个坑）<br>3)               重启远程服务，我们试过直接重启tomcat服务，虽然服务重启会成功，但是最后会报一个错误，导致项目编码无法指定为UTF-8，所以我们还是选择使用Shell脚本去重启服务（第三个坑）。<br>4）          进行创建目录备份。<br>5）          查看进程后台启动。</p>
<p>Ansible脚本编写完之后，可以现在自己本机上执行一下。<br>目标机器上必须安装libselinux-python，不然无法执行成功（小坑）。</p>
<p>在jenkins中我们做如下配置：<br>在构建打包命令后面我们增加一个Shell命令，用来执行Ansible的脚本。<br>我们脚本名称使用变量名称，这样我们选择模块就能执行对应的脚本。</p>
<h4 id="1-6发送邮件"><a href="#1-6发送邮件" class="headerlink" title="1.6发送邮件"></a>1.6发送邮件</h4><p>配置好构建失败后发送邮件到指定的邮箱，多个邮箱用逗号隔开。</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins.peizhi.7.png" alt=""></figure></p>
<p>至此项目配置结束。</p>
<h4 id="六-运行效果，打包效果。"><a href="#六-运行效果，打包效果。" class="headerlink" title="六.运行效果，打包效果。"></a>六.运行效果，打包效果。</h4><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins.peizhi.9.png" alt=""></figure><br>指定模块去打包，终端上查看发布日志 这里变量生效效果：<br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins.peizhi.10.png" alt=""></figure></p>
<h3 id="七-Jenkins延伸学习"><a href="#七-Jenkins延伸学习" class="headerlink" title="七. Jenkins延伸学习"></a>七. Jenkins延伸学习</h3><p>效果图：</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins_05.png" alt=""></figure></p>
<p><code>Blue Ocean</code> 是<code>Jenkins</code> 非常不错一个提升。</p>
<p>这里可以查看下我在我github上面扩展<a href="https://github.com/yangcvo/Jenkins-automation" target="_blank" rel="external">更新jenkins新功能Blue Ocean实现先进的可视化精确定位问题</a></p>
<p>现在我们Git使用的是 GitLab，同时为了安全我们做了一层LDAP代理，效果相当于“将军令”，操作机、Git和Jenkins用 OpenLDAP 做统一认证，后续用到的Redmine、Grafana、Zabbix 等都接入了OpenLDAP认证，每个人都有个动态口令，每次验证都需要用到。</p>

	

	

</article>




	<article>
	
		<h1><a href="/2016/09/11/个人生活记录/考驾照的艰辛历程/">考驾照的艰辛历程</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-09-11</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/生活/">生活</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Personal-life-record/">Personal life record</a>
			</span>
		
	</div>

	

	
		<p>🍓</p>
<p>   今天是2016年9月11号，在过几天就是中秋节了，刚刚大学毕业出来一年了，在加上实习工作一年多了，算起来工作两年多了，在读大学和参加一些技术培训班就没有时间去考一本属于自己的驾照，一直拖到现在的确是挺忙的。</p>
		<p><a class="article__read-more-link" href="/2016/09/11/个人生活记录/考驾照的艰辛历程/">...read more</a></p>
	

	

</article>




	<article>
	
		<h1><a href="/2016/09/02/个人生活记录/厨艺依然好👍/">厨艺依然好👍</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-09-02</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/生活/">生活</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Personal-life-record/">Personal life record</a>
			</span>
		
	</div>

	

	
		<p>一个男的能做的出一手好的美食是多么棒👍的一件事。这还要感谢我有一个特别的棒的父亲。<br>记得小时候12岁我就开始学会做饭，学会第一道菜南瓜饭🎃</p>
		<p><a class="article__read-more-link" href="/2016/09/02/个人生活记录/厨艺依然好👍/">...read more</a></p>
	

	

</article>




	<article>
	
		<h1><a href="/2016/08/21/性能监控/Zabbix/直播分享的主题是云监控----zabbix&amp;collectd 互相讨论/">直播分享的主题是云监控----zabbix&amp;collectd 互相讨论</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-08-21</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/monitoring/">monitoring</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Zabbix-monitoring/">Zabbix monitoring</a>
			</span>
		
	</div>

	

	
		<h1 id="直播分享的主题是云监控—-zabbix-amp-collectd-互相讨论"><a href="#直播分享的主题是云监控—-zabbix-amp-collectd-互相讨论" class="headerlink" title="直播分享的主题是云监控—-zabbix&amp;collectd 互相讨论"></a>直播分享的主题是云监控—-zabbix&amp;collectd 互相讨论</h1><p>前几天参加KVM开展的直播秀，肖总请来了各位运维大咖给我们展示他们云监控。这里我整理下崔广章大师的聊天记录各位可以一起聆听下。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"> 崔广章 19:58</div><div class="line">我之前一直在做私有云，我们整个云平台的监控系统系统用的就是zabbix</div><div class="line"> 崔广章 19:59</div><div class="line">基本没什么变化，做的比较多的就是国际化，大家都懂的</div><div class="line"> 崔广章 20:00</div><div class="line">我先借度娘给搭建扫个盲</div><div class="line"> 崔广章 20:00</div><div class="line">zabbix（音同 zæbix）是一个基于WEB界面的提供分布式系统监视以及网络监视功能的企业级的开源解决方案。</div><div class="line"> 崔广章 20:01</div><div class="line">zabbix能监视各种网络参数，保证服务器系统的安全运营；并提供灵活的通知机制以让系统管理员快速定位/解决存在的各种问题。</div><div class="line"> 崔广章 20:02</div><div class="line">zabbix由2部分构成，zabbix server与可选组件zabbix agent。</div><div class="line"> 崔广章 20:02</div><div class="line">zabbix server可以通过SNMP，zabbix agent，ping，端口监视等方法提供对远程服务器/网络状态的监视，数据收集等功能，它可以运行在Linux，Solaris，HP-UX，AIX，Free BSD，Open BSD，OS X等平台上。</div><div class="line"> 崔广章 20:02</div><div class="line">扫盲就到此为止吧</div><div class="line"> 崔广章 20:03</div><div class="line">按度娘的，接下来就是安装啦，我就在这耽误大家的人间啦</div><div class="line"> 崔广章 20:04</div><div class="line">zabbix监控主要分四块，zabbix-agent,SNMP,IPMI,和JMX</div><div class="line"> 崔广章 20:05</div><div class="line">因为我们主要是是做Iaas和Pass的，所以我们只用了前三种功能</div><div class="line"> 崔广章 20:06</div><div class="line">前三种功能又分为两种方案，就是负载大时的一种方案和负载小时的方案</div><div class="line"> 崔广章 20:07</div></pre></td></tr></table></figure>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix_yun.png" alt=""></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"> 崔广章 20:07</div><div class="line">这是小负载时的方案</div><div class="line"> 崔广章 20:08</div><div class="line">接下来是大负载时的方案</div><div class="line"> 崔广章 20:08</div></pre></td></tr></table></figure>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix_yun1.png" alt=""></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">崔广章 20:11</div><div class="line">这里还有一个zabbix的整体架构广章 20:11</div></pre></td></tr></table></figure>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix_yun2.png" alt=""></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div></pre></td><td class="code"><pre><div class="line"> 崔广章 20:12</div><div class="line">我从14年才开始将zabbix进行分布式部署</div><div class="line"> 崔广章 20:14</div><div class="line">在云环境下，zabbix有个缺点就是，对虚拟机的监控达我们感觉不理想</div><div class="line"> 崔广章 20:15</div><div class="line">因为zabbix对与虚拟与物理机进行监控采取的是同样的方法，就是向系统中注入代理zabbix-agent</div><div class="line"> 崔广章 20:15</div><div class="line">对诸如代理我有两点担心</div><div class="line"> 崔广章 20:17</div><div class="line">一、因为zabbix-agent它本身也占用了资源，对于自己占用的资源它能不能准确监控，这我还不能确定，如果它不能对自己占用的资源进行准确监控，那就等于污染了虚拟机</div><div class="line"> 崔广章 20:19</div><div class="line">二，zabbix-agent是打包在云主机的镜像中的一个cron任务，说白他就是云主机的一个普通进程，如果用户把它给<span class="built_in">kill</span>了，是不是就监控不到啦？</div><div class="line"> 崔广章 20:21</div><div class="line">所以我就找能运行在底层又能对虚拟机进行准确检测的工具</div><div class="line"> 崔广章 20:21</div><div class="line">那就是接下来要说的collectd喽</div><div class="line"> 崔广章 20:21</div><div class="line">老规矩，咱们还接着扫盲</div><div class="line"> 崔广章 20:21</div><div class="line">collectd是一个守护(daemon)进程，用来收集系统性能和提供各种存储方式来存储不同值的机制。比如以RRD 文件形式。</div><div class="line"> 崔广章 20:29</div><div class="line">collectd确实能够运行在底层，并能采集KVM虚拟机的各项数据，但他的展示使用CGP跟zabbix比太差</div><div class="line"> 崔广章 20:31</div><div class="line">我所以我就试着将两者进行优势互补</div><div class="line"> 崔广章 20:32</div><div class="line">我是将collectd存储在*.rrd中的相关数据取出来，然后存储到zabbix的数据库当中，让zabbix进行展示</div><div class="line"> 崔广章 20:33</div><div class="line">其实只是将collectd采集的虚拟机的内存的数据进行转存和展示</div><div class="line"> 崔广章 20:36</div><div class="line">整个过程包括，分析zabbix的数据库表之间的关系，研究怎么从collectd的*.rrd文件中取数据怎么将取出的数据向数据库里保存，这是一项很大的工程</div><div class="line"> 崔广章 20:36</div><div class="line">今天就分享到这吧好吧？</div><div class="line"> 侯燚@贵州高新翼云 20:37</div><div class="line">谢谢</div><div class="line"> 崔广章 20:37</div><div class="line"> 袁进坤|南京|云应用+大数据+云计算 20:37</div><div class="line"> 薛群 20:37</div><div class="line">其实你说的第一个问题，不是问题</div><div class="line"> 北极熊 20:37</div><div class="line">大家开始提问吧</div><div class="line"> 薛群 20:38</div><div class="line">只要是监控，都需要消耗少量资源</div><div class="line"> 崔广章 20:38</div><div class="line">这个问题我也请教过肖哥@薛群</div><div class="line"> 刘海宾 20:38</div><div class="line">通过libvirt也能获取虚拟机的内存</div><div class="line"> 崔广章 20:38</div><div class="line">嗯嗯</div><div class="line"> 薛群 20:38</div><div class="line">不属于污染虚拟机哦</div><div class="line"> 崔广章 20:38</div><div class="line">嗯嗯</div><div class="line"> 薛群 20:39</div><div class="line">腾讯云上的虚拟机十几个agent</div><div class="line"> 崔广章 20:39</div><div class="line">collectd就是调用了libvirt</div><div class="line"> 崔广章 20:39</div><div class="line">@薛</div><div class="line"> 崔广章 20:40</div><div class="line">错啦</div><div class="line"> 袁进坤|南京|云应用+大数据+云计算 20:40</div><div class="line">在选择监控工具的时候，是否考虑过其他类似的工具，例如nagios，做出选择的主要考虑是什么？</div><div class="line"> 薛群 20:40</div><div class="line">第二种方式，消耗资源多不？</div><div class="line"> 刘海宾 20:40</div><div class="line">那collected就干这一件事吗</div><div class="line"> 崔广章 20:40</div><div class="line"> 刘海宾 20:40</div><div class="line">其实虚拟机监控可以用qga</div><div class="line"> 刘海宾 20:41</div><div class="line">走channel</div><div class="line"> 薛群 20:41</div><div class="line">nagios功能没有ZBX强，性能也不及</div><div class="line"> 崔广章 20:41</div><div class="line">collectd目前我只让它干了怎么一件事</div><div class="line"> 刘海宾 20:42</div><div class="line">那自己写个脚本更简单吧 呵呵 只是个人观点</div><div class="line"> 崔广章 20:42</div><div class="line">我也试着写了一套脚本</div><div class="line"> 刘海宾 20:43</div><div class="line">@薛群 私有云跑agent还好 公有云 用户很反感</div><div class="line"> 薛群 20:43</div><div class="line">@袁进坤@南京，云计算 其实监控主要考虑：方便，扩展性好(规模和二次开发)，功能全，</div><div class="line"> 崔广章 20:43</div><div class="line">但数据误差太大</div><div class="line"> 崔广章 20:44</div><div class="line">就是考虑到这一点@刘海宾@新网</div><div class="line"> 刘海宾 20:45</div><div class="line">虚拟机加上ballon</div><div class="line"> 薛群 20:46</div><div class="line">嗯，是的。腾讯云上这么多agent，是不爽</div><div class="line"> 崔广章 20:46</div><div class="line">ballon跟内存监控关系不大@刘海宾@新网</div><div class="line"> 于江磊@奇点时代 20:47</div><div class="line">zabbix再多个配置不同的vm时，请问模板是分别定制的么</div><div class="line"> 崔广章 20:48</div><div class="line">对的</div><div class="line"> 于江磊@奇点时代 20:48</div><div class="line">监控多个</div><div class="line"> 刘海宾 20:49</div><div class="line">libguestfs也能干这事</div><div class="line"> 袁进坤|南京|云应用+大数据+云计算 20:50</div><div class="line">@薛群 @崔广章 谢谢</div><div class="line"> 刘海宾 20:50</div><div class="line">青云的监控走的channel在 init里边起了个进程 不容易杀死 还不错</div><div class="line"> 刘海宾 20:51</div><div class="line">@崔广章 谢谢分享</div><div class="line"> 崔广章 20:51</div><div class="line">@袁进坤@南京，云计算</div><div class="line"> 崔广章 20:51</div><div class="line"> 袁进坤|南京|云应用+大数据+云计算 20:52</div><div class="line">@崔广章 主要监控了哪些指标？如果在openstack架构，ceilometer和zabbix的的关系怎么看？</div><div class="line"> 刘浩 20:52</div><div class="line">我求问个问题：把zabbix agent用supervise起。是不是就不用担心被杀死的问题了。</div><div class="line"> 于江磊@奇点时代 20:53</div><div class="line">我在用zabbix时,遇到一个问题,监控主机网卡的时候,zabbix默认采用了auto_discovery的策略,但是我宿主机上跑了很多个容器,容器的网络运行模式为桥接,此时zabbix就会自动去检测那些veth的设备,请问我该如何配置呢? 达到让zabbix只监控em0 或者eth0的网卡设备呢</div><div class="line"> 崔广章 20:54</div><div class="line">ceilometer其实是openstack自带的功能，但是功能很菜@袁进坤@南京，云计算</div><div class="line"> 崔广章 20:54</div><div class="line">@刘浩@360 其实我就是怎想的</div><div class="line"> 年福瑞@小牛资本 20:57</div><div class="line">@于江磊@奇点时代 自己写脚本，取物理别名</div><div class="line"> 崔广章 20:58</div><div class="line">我也遇到这样的问题@于江磊@奇点时代</div><div class="line"> 刘浩 20:59</div><div class="line">@崔广章 那是不是可以不用collected了</div><div class="line"> 崔广章 21:00</div><div class="line">理论上是可以，但数据转存的时候，工作量很大@刘浩@360</div><div class="line"> 崔广章 21:01</div><div class="line">难点主要在zabbix端，关系错综复杂</div><div class="line"> 薛群 21:01</div><div class="line">@于江磊@奇点时代 用正则表达式过滤</div><div class="line"> 薛群 21:03</div><div class="line">公有云起agent确实是个问题</div><div class="line"> 崔广章 21:03</div><div class="line">这是公有云的痛点</div></pre></td></tr></table></figure>
<p>就整理这些，想说现在监控也越来越完善了，可以做到邮件告警，微信告警，钉钉告警短信电话告警。 万能的监控zabbix只要有key值都可以做到任何监控。</p>
<p>也还有些公司对监控更加要求性高可以针对性技术开发一套监控大屏，记得在之前公司运维CDN就是整个技术团队研发一套监控大盘的，主要监控流量的状态每个节点的流量带宽。</p>
<p>有兴趣一起研究监控的可以加我QQ:1165958741 或者加入群一起讨论：459096184</p>

	

	

</article>




	<article>
	
		<h1><a href="/2016/08/21/Node.js-npm/npm翻墙加速国内镜像/">npm翻墙加速国内镜像</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-08-21</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Node-js/">Node.js</a>
			</span>
		
	</div>

	

	
		<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>Node.js 的依赖包管理生态系统 npm, 是世界上最大的生态系统开源库。 但国内使用 npm 来安装软件，速度很慢，有时候甚至直接就失败了！比如我安装stf就需要翻墙或者VPN去安装，可是就一直卡着。</p>
		<p><a class="article__read-more-link" href="/2016/08/21/Node.js-npm/npm翻墙加速国内镜像/">...read more</a></p>
	

	

</article>




	<article>
	
		<h1><a href="/2016/08/16/Node.js-npm/Centos7.1+Mac环境安装Node.Js以及彻底删除卸载node.js教程/">Centos7.1+Mac环境安装Node.Js以及彻底删除卸载node.js教程</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-08-16</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Node-js/">Node.js</a>
			</span>
		
	</div>

	

	
		<h3 id="linux-Centos7系统快速安装node-js-npm"><a href="#linux-Centos7系统快速安装node-js-npm" class="headerlink" title="linux Centos7系统快速安装node.js npm"></a>linux Centos7系统快速安装node.js npm</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">第一、选择合适的版本安装</div><div class="line"><span class="comment"># 4.x版本</span></div><div class="line">curl --silent --location https://rpm.nodesource.com/setup_4.x | bash -</div><div class="line"><span class="comment"># 5.x版本</span></div><div class="line">curl --silent --location https://rpm.nodesource.com/setup_5.x | bash -</div></pre></td></tr></table></figure>
<p>如果是Centos7的话会提示报错<code>Requires: libhttp_parser.so.2()(64bit)</code></p>
		<p><a class="article__read-more-link" href="/2016/08/16/Node.js-npm/Centos7.1+Mac环境安装Node.Js以及彻底删除卸载node.js教程/">...read more</a></p>
	

	

</article>




	<article>
	
		<h1><a href="/2016/07/31/个人生活记录/推荐一个保护眼睛👀的软件－f-lux/">推荐一个保护眼睛👀的软件－f-lux</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-07-31</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/生活/">生活</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Personal-life-record/">Personal life record</a>
			</span>
		
	</div>

	

	
		<p>最近天天加班然后晚上盯着电脑，眼睛一直很干涩，非常难受。正巧昨天在GitHub上闲逛，无意间发现了别人推荐的这个软件f.lux，Mac上下载试用了一下。觉得很不错，推荐一下！也许是我孤陋寡闻了，可能大家都已经在用了……</p>
		<p><a class="article__read-more-link" href="/2016/07/31/个人生活记录/推荐一个保护眼睛👀的软件－f-lux/">...read more</a></p>
	

	

</article>





	<span class="different-posts">📖 <a href="/page/7">more posts</a> 📖</span>



	</main>

	<footer class="footer">
	<div class="footer-content">
		
	      <div class="footer__element">
	<h5>Hi there,</h5>
	<p style="text-align:justify;">my name is Yancy, they know me as Radiant🐑🐑. This blog is about Bi-data and my live.<br> I like 🌳🌳🌳</p>
</div>


	    
	      <div class="footer__element">
	<h5>Check out</h5>
	<ul class="footer-links">
		<li class="footer-links__link"><a href="/archives">Archive</a></li>
		
		  <li class="footer-links__link"><a href="/atom.xml">RSS</a></li>
	    
		<li class="footer-links__link"><a href="/about">about page</a></li>
		<li class="footer-links__link"><a href="/tags">Tags</a></li>
		<li class="footer-links__link"><a href="/categories">Categories</a></li>
	</ul>
</div>

	    

		<div class="footer-credit">
			<span>© 2017 Yancy | Powered by <a href="http://blog.yancy.cc/">Yancy</a> | Theme <a href="https://github.com/yangcvo">Yancy_GitHub</a></span>
		</div>

	</div>


</footer>



</body>

</html>
