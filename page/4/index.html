<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="theme-color" content="#33474d">
	<title>Yancy&#39;s blog</title>
	<link rel="stylesheet" href="/css/style.css" />
	
      <link rel="alternate" href="/atom.xml" title="Yancy&#39;s blog" type="application/atom+xml">
    
</head>

<body>

	<header class="header">
		<nav class="header__nav">
			
				<a href="/" class="header__link">Home</a>
			
				<a href="/tags" class="header__link">Tags</a>
			
				<a href="/archives" class="header__link">ARCHIVES</a>
			
				<a href="/about/About" class="header__link">ABOUT</a>
			
				<a href="/atom.xml" class="header__link">RSS</a>
			
		</nav>
		<h1 class="header__title"><a href="/">Yancy&#39;s blog</a></h1>
		<h2 class="header__subtitle">SIMPLICITY IS PREREQUISITE FOR  RELIABILITY</h2>
	</header>

	<main>
		
	<span class="different-posts different-posts_earlier">ğŸ“– <a href="/page/3">earlier posts</a> ğŸ“–</span>




	<article>
	
		<h1><a href="/2017/05/28/Bigdata-hadoop/Kafka/Bigdata-Kafkaé›†ç¾¤å¿«é€Ÿæ­å»ºä¸å¢åˆ æ”¹æŸ¥å‘½ä»¤è®²è§£/">Bigdata-Kafkaé›†ç¾¤å¿«é€Ÿæ­å»ºä¸å‘½ä»¤è®²è§£</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2017-05-28</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/å¤§æ•°æ®/">å¤§æ•°æ®</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Big-data-Hadoop/">Big data Hadoop</a> <a class="article__tag-link" href="/tags/Kafka/">Kafka</a>
			</span>
		
	</div>

	

	
		<h1 id="Bigdata-Kafkaé›†ç¾¤å¿«é€Ÿæ­å»ºä¸å‘½ä»¤è®²è§£"><a href="#Bigdata-Kafkaé›†ç¾¤å¿«é€Ÿæ­å»ºä¸å‘½ä»¤è®²è§£" class="headerlink" title="Bigdata-Kafkaé›†ç¾¤å¿«é€Ÿæ­å»ºä¸å‘½ä»¤è®²è§£"></a>Bigdata-Kafkaé›†ç¾¤å¿«é€Ÿæ­å»ºä¸å‘½ä»¤è®²è§£</h1><h3 id="kafkaé›†ç¾¤å’Œzookeeperé›†ç¾¤è§„èŒƒ"><a href="#kafkaé›†ç¾¤å’Œzookeeperé›†ç¾¤è§„èŒƒ" class="headerlink" title="kafkaé›†ç¾¤å’Œzookeeperé›†ç¾¤è§„èŒƒ"></a>kafkaé›†ç¾¤å’Œzookeeperé›†ç¾¤è§„èŒƒ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">kafkaé›†ç¾¤å’Œzookeeperé›†ç¾¤è§„èŒƒ</div><div class="line">kafkaç‰ˆæœ¬ï¼škafka_2.10-0.8.2.1</div><div class="line">zookeeperç‰ˆæœ¬ï¼šzookeeper-3.4.5</div><div class="line"></div><div class="line">å¯åŠ¨ç”¨æˆ·ï¼šjollybi</div><div class="line">kafkaå®‰è£…ç›®å½•ï¼š/data/tools/</div><div class="line">kafkaæ–°å»ºæ¶ˆæ¯ç›®å½•ï¼š/data/tools/kafka_2.10-0.8.2.1/kafka-logs</div><div class="line"></div><div class="line">å¯åŠ¨ç”¨æˆ·ï¼šjollybi</div><div class="line">zookeeperå®‰è£…ç›®å½•ï¼š/data/tools/</div><div class="line">zookeeperæ–°å»ºæ—¥å¿—ç›®å½•ï¼š/data/tools/zookeeper-3.4.5/tmp/logs</div><div class="line"></div><div class="line">ç»Ÿä¸€é…ç½®hosts</div><div class="line"></div><div class="line"></div><div class="line">10.155.90.153 kafka1.jollychic.com kafka1</div><div class="line">10.155.90.155 kafka2.jollychic.com kafka2</div><div class="line">10.155.90.138 kafka3.jollychic.com kafka3</div></pre></td></tr></table></figure>
<p>æœ¬æ–‡ä½¿ç”¨äº†3å°æœºå™¨éƒ¨ç½²Kafkaé›†ç¾¤ï¼ŒIPå’Œä¸»æœºåå¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">10.155.90.153 kafka1.jollychic.com kafka1</div><div class="line">10.155.90.155 kafka2.jollychic.com kafka2</div><div class="line">10.155.90.138 kafka3.jollychic.com kafka3</div></pre></td></tr></table></figure>
<h3 id="Step1-é…ç½®-etc-hosts-ï¼ˆ3å°ä¸€è‡´ï¼‰"><a href="#Step1-é…ç½®-etc-hosts-ï¼ˆ3å°ä¸€è‡´ï¼‰" class="headerlink" title="Step1: é…ç½®/etc/hosts ï¼ˆ3å°ä¸€è‡´ï¼‰"></a>Step1: é…ç½®/etc/hosts ï¼ˆ3å°ä¸€è‡´ï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">127.0.0.1 localhost.localdomain localhost</div><div class="line">10.155.90.153 kafka1.jollychic.com kafka1</div><div class="line">10.155.90.155 kafka2.jollychic.com kafka2</div><div class="line">10.155.90.138 kafka3.jollychic.com kafka3</div></pre></td></tr></table></figure>
<h3 id="Step2-KafKaé›†ç¾¤æ­å»º"><a href="#Step2-KafKaé›†ç¾¤æ­å»º" class="headerlink" title="Step2: KafKaé›†ç¾¤æ­å»º"></a>Step2: KafKaé›†ç¾¤æ­å»º</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ä¸‹è½½åœ°å€ï¼šhttp://mirrors.hust.edu.cn/apache/kafka/0.9.0.0/kafka_2.10-0.8.2.1.tgz</div><div class="line">[jollybi@kafka1 ]<span class="comment"># tar -xvf kafka_2.10-0.8.2.1.tgz -C /data/tools/</span></div><div class="line"><span class="built_in">cd</span> /data/tools/kafka_2.10-0.8.2.1/config</div></pre></td></tr></table></figure>
<h3 id="è®¾ç½®dataç›®å½•ï¼Œæœ€å¥½ä¸è¦ç”¨é»˜è®¤çš„-tmp-kafka-logs"><a href="#è®¾ç½®dataç›®å½•ï¼Œæœ€å¥½ä¸è¦ç”¨é»˜è®¤çš„-tmp-kafka-logs" class="headerlink" title="è®¾ç½®dataç›®å½•ï¼Œæœ€å¥½ä¸è¦ç”¨é»˜è®¤çš„/tmp/kafka-logs"></a>è®¾ç½®dataç›®å½•ï¼Œæœ€å¥½ä¸è¦ç”¨é»˜è®¤çš„/tmp/kafka-logs</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mkdir -p /data/tools/kafka_2.10-0.8.2.1/kafka-logs/</div></pre></td></tr></table></figure>
<p><em>ä¿®æ”¹kafkaé…ç½®æ–‡ä»¶</em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">[root@kafka_01 config]<span class="comment"># vim server.properties</span></div><div class="line"></div><div class="line"></div><div class="line"> è®¾ç½®brokeridï¼ˆä»0å¼€å§‹ï¼Œ3ä¸ªèŠ‚ç‚¹åˆ†åˆ«è®¾ä¸º1,2,3ï¼Œä¸èƒ½é‡å¤ï¼‰åœ¨è¿™é‡Œid=0è·Ÿzookeeper idè®¾ç½®ä¸€æ ·å°±è¡Œã€‚ é›†ç¾¤æœºå™¨ï¼šæŒ‰é¡ºåºå†™1</div><div class="line">broker.id=1  </div><div class="line"></div><div class="line">auto.leader.rebalance.enable=<span class="literal">true</span> </div><div class="line"></div><div class="line"><span class="comment">#ä¿®æ”¹æœ¬åœ°IPåœ°å€ï¼š</span></div><div class="line">listeners=PLAINTEXT://10.46.72.172:9092</div><div class="line">port=9292 //è®¾ç½®è®¿é—®ç«¯å£</div><div class="line">host.name=10.155.90.153   kafkaæœ¬æœºIP</div><div class="line">log.dirs=/data/tools/kafka_2.10-0.8.2.1/kafka-logs</div><div class="line"></div><div class="line"><span class="comment">#è®¾ç½®æ³¨å†Œåœ°å€ï¼ˆé‡è¦ï¼Œé»˜è®¤ä¼šæŠŠæœ¬æœºçš„hostanmeæ³¨å†Œåˆ°zkä¸­ï¼Œå®¢æˆ·ç«¯è¿æ¥æ—¶éœ€è¦è§£æè¯¥hostanmeï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥æ³¨å†Œæœ¬æœºçš„IPåœ°å€ï¼Œé¿å…hostnameè§£æå¤±è´¥ï¼ŒæŠ¥é”™java.nio.channels.UnresolvedAddressExceptionæˆ–java.io.IOException: Can not resolve addressï¼‰</span></div><div class="line"><span class="comment">#è®¾ç½®zookeeperåœ°å€</span></div><div class="line"><span class="comment">#zookeeper.connect=10.46.72.172:2181,10.47.88.103:2181,10.47.102.137:2181</span></div><div class="line">zookeeper.connect=kafka1.jollychic.com:2281,kafka2.jollychic.com:2281,kafka3.jollychic.com:2281</div><div class="line"></div><div class="line">//è¿™é‡Œæˆ‘è®¾ç½®hostsä»£æ›¿IP</div></pre></td></tr></table></figure>
<p><em>é…ç½®zookeeperåœ°å€</em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">vim zookeeper.properties </div><div class="line">dataDir=/data/tools/zookeeper-3.4.5/tmp</div><div class="line"><span class="comment"># the port at which the clients will connect</span></div><div class="line">clientPort=2281</div><div class="line"><span class="comment"># disable the per-ip limit on the number of connections since this is a non-production config</span></div><div class="line">maxClientCnxns=0</div><div class="line">~</div></pre></td></tr></table></figure>
<p><em>é…ç½®kafkaè®¿é—®åœ°å€</em></p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">vim</span> producer.properties </div><div class="line">metadata.broker.list=<span class="number">169.44.62.139:9292</span>,<span class="number">169.44.59.138:9292</span>,<span class="number">169.44.62.137:9292</span>   </div><div class="line"><span class="comment"># name of the partitioner class for partitioning events; default partition spreads data randomly</span></div><div class="line"><span class="comment">#partitioner.class=</span></div><div class="line"></div><div class="line"><span class="comment"># specifies whether the messages are sent asynchronously (async) or synchronously (sync)</span></div><div class="line">producer.type=sync</div><div class="line"></div><div class="line"><span class="comment"># specify the compression codec for all data generated: none, gzip, snappy, lz4.</span></div><div class="line"><span class="comment"># the old config values work as well: 0, 1, 2, 3 for none, gzip, snappy, lz4, respectively</span></div><div class="line">compression.codec=<span class="literal">none</span></div><div class="line"></div><div class="line"><span class="comment"># message encoder</span></div><div class="line">serializer.class=kafka.serializer.DefaultEncoder</div></pre></td></tr></table></figure>
<h3 id="Step3-é›†ç¾¤æœºå™¨å¿«é€Ÿæ‹·è´é…ç½®"><a href="#Step3-é›†ç¾¤æœºå™¨å¿«é€Ÿæ‹·è´é…ç½®" class="headerlink" title="Step3: é›†ç¾¤æœºå™¨å¿«é€Ÿæ‹·è´é…ç½®:"></a>Step3: é›†ç¾¤æœºå™¨å¿«é€Ÿæ‹·è´é…ç½®:</h3><p>è¿œç¨‹å¤åˆ¶åˆ†å‘å®‰è£…æ–‡ä»¶<br>æœ€å¥½æ˜¯æŠŠæ–‡ä»¶æ‰“åŒ…scpè¿‡å»<br>æ¥ä¸‹æ¥å°†ä¸Šé¢çš„å®‰è£…æ–‡ä»¶æ‹·è´åˆ°é›†ç¾¤ä¸­çš„å…¶ä»–æœºå™¨ä¸Šå¯¹åº”çš„ç›®å½•</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">scp -P58958 -r kafka_2.10-0.8.2.1 jollybi@169.44.62.137:/home/jollybi/tools/. </div><div class="line">scp -P58958 -r kafka_2.10-0.8.2.1 jollybi@169.44.62.138:/home/jollybi/tools/.</div></pre></td></tr></table></figure>
<p>ç»Ÿä¸€ä¿®æ”¹åˆ†åˆ«å…¶ä»–ä¸¤å°kafka <code>server.properties</code></p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">broker.id=<span class="number">2</span>  </div><div class="line">host.name=<span class="number">169.44</span><span class="number">.62</span><span class="number">.137</span>   kafka2æœ¬æœºIP</div><div class="line"></div><div class="line">broker.id=<span class="number">3</span> </div><div class="line">host.name=<span class="number">169.44</span><span class="number">.62</span><span class="number">.138</span>   kafka3æœ¬æœºIP</div></pre></td></tr></table></figure>
<h3 id="Step4-å¯åŠ¨-kafkaé›†ç¾¤"><a href="#Step4-å¯åŠ¨-kafkaé›†ç¾¤" class="headerlink" title="Step4:å¯åŠ¨ kafkaé›†ç¾¤"></a>Step4:å¯åŠ¨ kafkaé›†ç¾¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">./kafka-server-start.sh -daemon ../config/server.properties</div><div class="line"></div><div class="line">[jollybi@kafka1 config]$ jps</div><div class="line">3443 QuorumPeerMain</div><div class="line">16280 Jps</div><div class="line">3628 Kafka</div><div class="line">Step5: Kafkaå¸¸ç”¨å‘½ä»¤(æ™®åŠ)</div></pre></td></tr></table></figure>
<h4 id="Step5-æµ‹è¯•é›†ç¾¤"><a href="#Step5-æµ‹è¯•é›†ç¾¤" class="headerlink" title="Step5:æµ‹è¯•é›†ç¾¤"></a>Step5:æµ‹è¯•é›†ç¾¤</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div></pre></td><td class="code"><pre><div class="line"><span class="comment">### é»˜è®¤åˆ›å»ºkafka Topic:  1ä¸ªå‰¯æœ¬å¤‡ä»½ 1ä¸ªåˆ†åŒºæ¶ˆè´¹</span></div><div class="line"></div><div class="line">./kafka_2.10-0.8.2.1/bin/kafka-topics.sh --create --zookeeper  kafka1.jollychic.com:2281,kafka2.jollychic.com:2281,kafka3.jollychic.com:2281 --replication-factor 1 --partitions 1 --topic mongotail_lz4</div><div class="line">./kafka_2.10-0.8.2.1/bin/kafka-topics.sh --create --zookeeper  kafka1.jollychic.com:2281,kafka2.jollychic.com:2281,kafka3.jollychic.com:2281 --replication-factor 1 --partitions 1 --topic mongotail_lz4_imp</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">### å¤§æ•°æ®è¿™è¾¹éœ€è¦12ä¸ªåˆ†åŒºè¿™é‡Œæˆ‘åˆ é™¤Topicé‡æ–°åˆ›å»ºTopicï¼š</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">### åˆ é™¤kafka Topic:</span></div><div class="line"></div><div class="line"></div><div class="line">ç¬¬ä¸€æ­¥ï¼šåˆ é™¤kafka topic</div><div class="line">./kafka_2.10-0.8.2.1/bin/kafka-topics.sh --zookeeper  kafka1.jollychic.com:2281,kafka2.jollychic.com:2281,kafka3.jollychic.com:2281 --delete --topic  mongotail_lz4 </div><div class="line"></div><div class="line">./kafka_2.10-0.8.2.1/bin/kafka-topics.sh --zookeeper  kafka1.jollychic.com:2281,kafka2.jollychic.com:2281,kafka3.jollychic.com:2281 --delete --topic  mongotail_lz4_imp</div><div class="line"></div><div class="line"><span class="comment">### è¿™æ˜¯ç”±äºåˆ é™¤topicæ²¡åˆ å¹²å‡€ä¼šæŠ¥é”™ï¼š</span></div><div class="line"></div><div class="line">org.apache.kafka.common.errors.UnknownTopicOrPartitionException: This server does not host this topic-partition.</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">### åˆ é™¤çº¿ç¨‹æ‰§è¡Œåˆ é™¤æ“ä½œçš„çœŸæ­£é€»è¾‘æ˜¯ï¼š</span></div><div class="line">1. å®ƒé¦–å…ˆä¼šç»™å½“å‰æ‰€æœ‰brokerå‘é€æ›´æ–°å…ƒæ•°æ®ä¿¡æ¯çš„è¯·æ±‚ï¼Œå‘Šè¯‰è¿™äº›brokerè¯´è¿™ä¸ªtopicè¦åˆ é™¤äº†ï¼Œä½ ä»¬å¯ä»¥æŠŠå®ƒçš„ä¿¡æ¯ä»ç¼“å­˜ä¸­åˆ æ‰äº†</div><div class="line">2. å¼€å§‹åˆ é™¤è¿™ä¸ªtopicçš„æ‰€æœ‰åˆ†åŒº</div><div class="line">2.1 ç»™æ‰€æœ‰brokerå‘è¯·æ±‚ï¼Œå‘Šè¯‰å®ƒä»¬è¿™äº›åˆ†åŒºè¦è¢«åˆ é™¤ã€‚brokeræ”¶åˆ°åå°±ä¸å†æ¥å—ä»»ä½•åœ¨è¿™äº›åˆ†åŒºä¸Šçš„å®¢æˆ·ç«¯è¯·æ±‚äº†</div><div class="line">2.2 æŠŠæ¯ä¸ªåˆ†åŒºä¸‹çš„æ‰€æœ‰å‰¯æœ¬éƒ½ç½®äºOfflineReplicaçŠ¶æ€ï¼Œè¿™æ ·ISRå°±ä¸æ–­ç¼©å°ï¼Œå½“leaderå‰¯æœ¬æœ€åä¹Ÿè¢«ç½®äºOfflineReplicaçŠ¶æ€æ—¶leaderä¿¡æ¯å°†è¢«æ›´æ–°ä¸º-1</div><div class="line">2.3 å°†æ‰€æœ‰å‰¯æœ¬ç½®äºReplicaDeletionStartedçŠ¶æ€</div><div class="line">2.4 å‰¯æœ¬çŠ¶æ€æœºæ•è·çŠ¶æ€å˜æ›´ï¼Œç„¶åå‘èµ·StopReplicaRequestç»™brokerï¼Œbrokeræ¥åˆ°è¯·æ±‚ååœæ­¢æ‰€æœ‰fetcherçº¿ç¨‹ã€ç§»é™¤ç¼“å­˜ï¼Œç„¶ååˆ é™¤åº•å±‚<span class="built_in">log</span>æ–‡ä»¶</div><div class="line">2.5 å…³é—­æ‰€æœ‰ç©ºé—²çš„Fetcherçº¿ç¨‹</div><div class="line">    </div><div class="line"><span class="comment">### ç¬¬äºŒæ­¥ï¼šåˆ é™¤zookeeperç›¸å…³çš„è·¯å¾„ï¼š</span></div><div class="line">[jollybi@kafka1 zookeeper-3.4.5]$ ./bin/zkCli.sh -server 127.0.0.1:2281 </div><div class="line">[zk: 127.0.0.1:2281(CONNECTED) 1] rmr /brokers/topics/mongotail_lz4</div><div class="line">[zk: 127.0.0.1:2281(CONNECTED) 0] rmr /consumers/group_ml_general/offsets/mongotail_lz4</div><div class="line">[zk: 127.0.0.1:2281(CONNECTED) 1] rmr /consumers/group_ml_general/owners/mongotail_lz4</div><div class="line">[zk: 127.0.0.1:2281(CONNECTED) 3] rmr  /config/topics/mongotail_lz4</div><div class="line">[zk: 127.0.0.1:2281(CONNECTED) 4] rmr /admin/delete_topics/mongotail_lz4</div><div class="line"></div><div class="line"><span class="comment">### åˆ é™¤topicä¸Šé¢æ¶ˆè´¹ç»„ </span></div><div class="line"></div><div class="line">åˆ é™¤ ZooKeeper ä¸‹é¢çš„ /consumers/[group_id] è·¯å¾„å°±å¯ä»¥äº†ã€‚ZooKeeper åŸç”ŸAPIåªæ”¯æŒåˆ é™¤ç©ºçš„è·¯å¾„ï¼Œæ‰€ä»¥å»ºè®®ä½ ä½¿ç”¨ curator framework è¿›è¡Œè¿™ä¸ªåˆ é™¤æ“ä½œï¼ŒZkPaths.deleteChildren ä¼šé€’å½’å¼åœ°åˆ é™¤æ•´ä¸ªè·¯å¾„ï¼ˆåŒ…æ‹¬å­è·¯å¾„ï¼‰ã€‚</div><div class="line"></div><div class="line">[zk: 127.0.0.1:2281(CONNECTED) 0] rmr /consumers/kafka-node1-imp-group</div><div class="line">[zk: 127.0.0.1:2281(CONNECTED) 1] rmr /consumers/kafka-node1-group</div><div class="line">[zk: 127.0.0.1:2281(CONNECTED) 2] rmr /consumers/console-consumer-59053</div><div class="line">[zk: 127.0.0.1:2281(CONNECTED) 3] rmr /consumers/</div><div class="line"></div><div class="line"></div><div class="line">1ã€è®¾ç½®é…ç½®æ–‡ä»¶å…è®¸åˆ é™¤</div><div class="line">delete.topic.enable=<span class="literal">true</span> é…ç½®æ·»åŠ åˆ° config/server.properties</div><div class="line">2ã€æ‰§è¡Œåˆ é™¤å‘½ä»¤</div><div class="line">./bin/kafka-topics.sh --zookeeper localhost:2181 --delete --topic <span class="built_in">test</span>-topic</div><div class="line"></div><div class="line">åœ¨zookeeperä¸­ç¡®è®¤ï¼š</div><div class="line"></div><div class="line"> åˆ é™¤zookeeperä¸‹/brokers/topics/<span class="built_in">test</span>-topicèŠ‚ç‚¹</div><div class="line"> åˆ é™¤zookeeperä¸‹/config/topics/<span class="built_in">test</span>-topicèŠ‚ç‚¹</div><div class="line"> åˆ é™¤zookeeperä¸‹/admin/delete_topics/<span class="built_in">test</span>-topicèŠ‚ç‚¹</div><div class="line"> </div><div class="line">consumer çš„è¯ åˆ é™¤groupid</div><div class="line"> </div><div class="line"></div><div class="line"><span class="comment">### é‡å¯kafkaé›†ç¾¤</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">### å¤§æ•°æ®kafkaå»ºtopicï¼Œä¸èƒ½å»ºä¸€ä¸ªåˆ†åŒºï¼Œé‚£æ ·ååé‡ä¸Šä¸å»ï¼Œä¸å¤Ÿç”¨ï¼Œæˆ‘ä»¬ä»¥å‰å»ºäº†12ä¸ªåˆ†åŒºçš„</span></div><div class="line"><span class="comment">### åˆ›å»ºæ–° kafka Topic: 3ä¸ªå‰¯æœ¬ï¼Œ12ä¸ªåˆ†åŒº</span></div><div class="line"></div><div class="line"> ./kafka_2.10-0.8.2.1/bin/kafka-topics.sh --create --zookeeper  kafka1.jollychic.com:2281,kafka2.jollychic.com:2281,kafka3.jollychic.com:2281 --replication-factor 3 --partitions 12  --topic mongotail_lz4</div><div class="line">./kafka_2.10-0.8.2.1/bin/kafka-topics.sh --create --zookeeper  kafka1.jollychic.com:2281,kafka2.jollychic.com:2281,kafka3.jollychic.com:2281 --replication-factor 3 --partitions 12  --topic mongotail_lz4_imp</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">### æŸ¥çœ‹åˆ›å»ºçš„Topic:</span></div><div class="line">./kafka_2.10-0.8.2.1/bin/kafka-topics.sh  --describe --zookeeper kafka1.jollychic.com:2281,kafka2.jollychic.com:2281,kafka3.jollychic.com:2281  --topic mongotail_lz4</div><div class="line">./kafka_2.10-0.8.2.1/bin/kafka-topics.sh  --describe --zookeeper kafka1.jollychic.com:2281,kafka2.jollychic.com:2281,kafka3.jollychic.com:2281  --topic mongotail_lz4_imp</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">### æŸ¥çœ‹é›†ç¾¤æƒ…å†µï¼š</span></div><div class="line">./kafka_2.10-0.8.2.1/bin/kafka-topics.sh  --describe --zookeeper kafka1.jollychic.com:2281,kafka2.jollychic.com:2281,kafka3.jollychic.com:2281  --topic mongotail_lz4</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">### kafkaç”Ÿäº§å®¢æˆ·ç«¯ç”Ÿäº§æ•°æ®å‘½ä»¤ï¼š</span></div><div class="line"></div><div class="line">./bin/kafka-console-producer.sh --broker-list 75.126.39.124:9292,75.126.5.162:9292,75.126.5.178:9292 --topic mongotail_lz4_imp                      </div><div class="line">......</div><div class="line">my <span class="built_in">test</span> message 1</div><div class="line">my <span class="built_in">test</span> message 2</div><div class="line">^C</div><div class="line"><span class="comment">### kafkaæ¶ˆè´¹å®¢æˆ·ç«¯æ•°æ®å‘½ä»¤ ç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹æ¶ˆæ¯ï¼š</span></div><div class="line"></div><div class="line"> ./bin/kafka-console-consumer.sh --zookeeper  75.126.39.124:2281,75.126.5.162:2281,75.126.5.178:2281  --fm-beginning --topic mongotail_lz4_imp</div><div class="line">......</div><div class="line">my <span class="built_in">test</span> message 1</div><div class="line">my <span class="built_in">test</span> message 2</div><div class="line"></div><div class="line">^C</div></pre></td></tr></table></figure>
<h3 id="Kafkaå¸¸ç”¨å‘½ä»¤"><a href="#Kafkaå¸¸ç”¨å‘½ä»¤" class="headerlink" title="Kafkaå¸¸ç”¨å‘½ä»¤"></a>Kafkaå¸¸ç”¨å‘½ä»¤</h3><p>ä»¥ä¸‹æ˜¯kafkaå¸¸ç”¨å‘½ä»¤è¡Œæ€»ç»“ï¼š  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">1ã€ list topic æ˜¾ç¤ºæ‰€æœ‰topic</div><div class="line">./bin/kafka-topics.sh --list --zookeeper kafka1.jollychic.com:2281,kafka2.jollychic.com:2281,kafka3.jollychic.com:2281</div><div class="line"></div><div class="line">2ã€ æŸ¥çœ‹topicçš„è¯¦ç»†ä¿¡æ¯  </div><div class="line"> ./bin/kafka-topics.sh --zookeeper  75.126.39.124:2281,75.126.5.162:2281,75.126.5.178:2281  -describe -topic mongotail_lz4_imp</div><div class="line"></div><div class="line">3ã€ä¸ºtopicå¢åŠ partitionåˆ†åŒº å‚æ•°ï¼š--alter --partitions</div><div class="line">./bin/kafka-topics.sh  --alter --zookeeper  75.126.39.124:2281,75.126.5.162:2281,75.126.5.178:2281  --partitions 20 --topic mongotail_lz4_imp</div><div class="line"></div><div class="line">4ã€kafkaç”Ÿäº§è€…å®¢æˆ·ç«¯å‘½ä»¤  </div><div class="line">./bin/kafka-console-producer.sh --broker-list 75.126.39.124:9292,75.126.5.162:9292,75.126.5.178:9292 --topic mongotail_lz4_imp                        </div><div class="line"></div><div class="line">5ã€kafkaæ¶ˆè´¹è€…å®¢æˆ·ç«¯å‘½ä»¤  </div><div class="line">./bin/kafka-console-consumer.sh --zookeeper  75.126.39.124:2281,75.126.5.162:2281,75.126.5.178:2281  --fm-beginning --topic </div><div class="line"></div><div class="line">6ã€kafkaæœåŠ¡å¯åŠ¨  </div><div class="line">./kafka-server-start.sh -daemon ../config/server.properties   </div><div class="line"></div><div class="line">7ã€ä¸‹çº¿broker  </div><div class="line">./kafka-run-class.sh kafka.admin.ShutdownBroker --zookeeper 127.0.0.1:2181 --broker <span class="comment">#brokerId# --num.retries 3 --retry.interval.ms 60  </span></div><div class="line">shutdown broker  </div><div class="line"></div><div class="line">8ã€åˆ é™¤topic  </div><div class="line">./kafka-run-class.sh kafka.admin.DeleteTopicCommand --topic <span class="built_in">test</span>KJ1 --zookeeper 127.0.0.1:2181  </div><div class="line">./kafka-topics.sh --zookeeper localhost:2181 --delete --topic <span class="built_in">test</span>KJ1  </div><div class="line"></div><div class="line">9ã€æŸ¥çœ‹consumerç»„å†…æ¶ˆè´¹çš„offset  </div><div class="line">./kafka-run-class.sh kafka.tools.ConsumerOffsetChecker --zookeeper localhost:2181 --group <span class="built_in">test</span> --topic <span class="built_in">test</span>KJ1</div></pre></td></tr></table></figure>

	

	

</article>




	<article>
	
		<h1><a href="/2017/05/27/Bigdata-hadoop/zookeeper/Bigdata-ZooKeeperçš„é…ç½®è¯¦è§£ä¼˜åŒ–/">Bigdata-ZooKeeperçš„é…ç½®è¯¦è§£ä¼˜åŒ–</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2017-05-27</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/å¤§æ•°æ®/">å¤§æ•°æ®</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/ZooKeeper/">ZooKeeper</a>
			</span>
		
	</div>

	

	
		<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p><code>ZooKeeper</code>çš„åŠŸèƒ½ç‰¹æ€§é€šè¿‡ <code>ZooKeeper</code> é…ç½®æ–‡ä»¶æ¥è¿›è¡Œæ§åˆ¶ç®¡ç†ï¼ˆ <code>zoo.cfg</code> é…ç½®æ–‡ä»¶ï¼‰ã€‚ ZooKeeper è¿™æ ·çš„è®¾è®¡å…¶å®æ˜¯æœ‰å®ƒè‡ªèº«çš„åŸå› çš„ã€‚é€šè¿‡å‰é¢å¯¹ <code>ZooKeeper</code> çš„é…ç½®å¯ä»¥çœ‹å‡ºï¼Œå¯¹ <code>ZooKeeper</code>é›†ç¾¤è¿›è¡Œé…ç½®çš„æ—¶å€™ï¼Œå®ƒçš„é…ç½®æ–‡æ¡£æ˜¯å®Œå…¨ç›¸åŒçš„ï¼ˆå¯¹äºé›†ç¾¤ä¼ªåˆ†å¸ƒæ¨¡å¼æ¥è¯´ï¼Œåªæœ‰å¾ˆå°‘çš„éƒ¨åˆ†æ˜¯ä¸åŒçš„ï¼‰ã€‚è¿™æ ·çš„é…ç½®æ–¹ä½¿å¾—åœ¨éƒ¨ç½² <code>ZooKeeper</code> æœåŠ¡çš„æ—¶å€™éå¸¸åœ°æ–¹ä¾¿ã€‚å¦å¤–ï¼Œå¦‚æœæœåŠ¡å™¨ä½¿ç”¨ä¸åŒçš„é…ç½®æ–‡ä»¶ï¼Œå¿…é¡»è¦ç¡®ä¿ä¸åŒé…ç½®æ–‡ä»¶ä¸­çš„æœåŠ¡å™¨åˆ—è¡¨ç›¸åŒ¹é…ã€‚</p>
<p>åœ¨è®¾ç½® <code>ZooKeeper</code> é…ç½®æ–‡æ¡£çš„æ—¶å€™ï¼ŒæŸäº›å‚æ•°æ˜¯å¯é€‰çš„ï¼Œä½†æ˜¯æŸäº›å‚æ•°æ˜¯å¿…é¡»çš„ã€‚è¿™äº›å¿…é¡»çš„å‚æ•°å°±æ„æˆäº†<code>ZooKeeper</code> é…ç½®æ–‡æ¡£çš„æœ€ä½é…ç½®è¦æ±‚ã€‚</p>
<h5 id="æœ€è¿‘å‘ç°åœ¨ç”¨zookeeperå‡ºç°ç»å¸¸å‡ºç°è¿æ¥è¶…æ—¶ï¼Œå‡ºç°è¿æ¥ä¸­æ–­ï¼Œæ•°æ®ä¸¢å¤±ç­‰åŸå› ã€‚åé¢çœ‹äº†å®˜ç½‘é…ç½®è‡ªå·±æ•´ç†ä¼˜åŒ–å‡ ç‚¹ï¼š"><a href="#æœ€è¿‘å‘ç°åœ¨ç”¨zookeeperå‡ºç°ç»å¸¸å‡ºç°è¿æ¥è¶…æ—¶ï¼Œå‡ºç°è¿æ¥ä¸­æ–­ï¼Œæ•°æ®ä¸¢å¤±ç­‰åŸå› ã€‚åé¢çœ‹äº†å®˜ç½‘é…ç½®è‡ªå·±æ•´ç†ä¼˜åŒ–å‡ ç‚¹ï¼š" class="headerlink" title="æœ€è¿‘å‘ç°åœ¨ç”¨zookeeperå‡ºç°ç»å¸¸å‡ºç°è¿æ¥è¶…æ—¶ï¼Œå‡ºç°è¿æ¥ä¸­æ–­ï¼Œæ•°æ®ä¸¢å¤±ç­‰åŸå› ã€‚åé¢çœ‹äº†å®˜ç½‘é…ç½®è‡ªå·±æ•´ç†ä¼˜åŒ–å‡ ç‚¹ï¼š"></a>æœ€è¿‘å‘ç°åœ¨ç”¨zookeeperå‡ºç°ç»å¸¸å‡ºç°è¿æ¥è¶…æ—¶ï¼Œå‡ºç°è¿æ¥ä¸­æ–­ï¼Œæ•°æ®ä¸¢å¤±ç­‰åŸå› ã€‚åé¢çœ‹äº†å®˜ç½‘é…ç½®è‡ªå·±æ•´ç†ä¼˜åŒ–å‡ ç‚¹ï¼š</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">2.1é”™è¯¯æ—¥å¿—ï¼š</div><div class="line"></div><div class="line">2016-04-11 15:00:58,981 [myid:] - WARN  [SyncThread:0:FileTxnLog@334] - fsync-ing the write ahead <span class="built_in">log</span> <span class="keyword">in</span> SyncThread:0 took 13973ms <span class="built_in">which</span> will adversely effect operation latency. See the ZooKeeper troubleshooting guide</div><div class="line"></div><div class="line"></div><div class="line">&gt;2.2ï¼Œé”™è¯¯åŸå› åˆ†æ</div><div class="line"></div><div class="line">â€œFOLLOWERâ€åœ¨è·Ÿâ€œLEADERâ€åŒæ­¥æ—¶ï¼Œfsyncæ“ä½œæ—¶é—´è¿‡é•¿ï¼Œå¯¼è‡´è¶…æ—¶ã€‚</div><div class="line"></div><div class="line"></div><div class="line">ç¬¬ä¸€æ­¥ï¼šåˆ†ææœåŠ¡å™¨é—®é¢˜ï¼š</div><div class="line"></div><div class="line">æˆ‘æŸ¥çœ‹äº†æœåŠ¡å™¨ioå’Œè´Ÿè½½éƒ½ä¸é«˜ã€‚å†…å­˜ç©ºé—´å®é™…ä½¿ç”¨ç‡ä¸é«˜ã€‚å¯æ˜¯ç¼–è¾‘æ–‡ä»¶å‡ºç°äº†å¡é¡¿.</div><div class="line"></div><div class="line">å¯ä»¥å‘ç°ï¼š</div><div class="line"></div><div class="line">æœåŠ¡å™¨å¹¶æ²¡æœ‰å ç”¨å¾ˆå¤šå†…å­˜çš„è¿›ç¨‹ï¼›</div><div class="line">æœåŠ¡å™¨ä¹Ÿæ²¡æœ‰å­˜åœ¨å¾ˆå¤šçš„è¿›ç¨‹ï¼›</div><div class="line">cat /var/<span class="built_in">log</span>/messageæŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—å¹¶æ²¡æœ‰å‘ç°ä»€ä¹ˆå¼‚å¸¸ï¼›</div><div class="line">å¦å¤–pingæœåŠ¡å™¨åªæœ‰0.1mså¤šçš„å»¶è¿Ÿï¼Œå› æ­¤ä¸æ˜¯ç½‘ç»œé—®é¢˜ã€‚</div><div class="line"></div><div class="line">åé¢å‘ç°ç¡¬ç›˜æœ‰æ•…éšœé‡æ–°æ›´æ¢äº†ä¸€å—ç¡¬ç›˜ã€‚æˆ–è€…æ›´æ¢æœåŠ¡å™¨ã€‚</div><div class="line"></div><div class="line"></div><div class="line">&gt;2.3ï¼Œé”™è¯¯è§£å†³</div><div class="line"></div><div class="line">å¢åŠ â€œtickTimeâ€æˆ–è€…â€œinitLimitå’ŒsyncLimitâ€çš„å€¼ï¼Œæˆ–è€…ä¸¤è€…éƒ½å¢å¤§ã€‚</div><div class="line"></div><div class="line"></div><div class="line">&gt;2.4ï¼Œå…¶ä»–</div><div class="line"></div><div class="line">è¿™ä¸ªé”™è¯¯åœ¨ä¸Šçº¿â€œä½¿ç”¨ZooKeeperè·å–åœ°å€æ–¹æ¡ˆâ€ä¹‹å‰ä¹Ÿå­˜åœ¨ï¼Œåªä¸è¿‡è¿‡æ²¡æœ‰è¿™ä¹ˆé«˜é¢‘ç‡ï¼Œè€Œä¸Šçº¿äº†â€œZooKeeperè·å–åœ°å€æ–¹æ¡ˆâ€ä¹‹åï¼ŒZooKeeper Serverä¹‹é—´çš„åŒæ­¥æ•°æ®é‡å¢å¤§ï¼ŒZooKeeper Serverçš„è´Ÿè½½åŠ é‡ï¼Œå› è€Œæœ€ç»ˆå¯¼è‡´é«˜é¢‘ç‡å‡ºç°ä¸Šè¿°é”™è¯¯ã€‚</div></pre></td></tr></table></figure>
<h2 id="ä¸‹é¢æ˜¯åœ¨æœ€ä½é…ç½®è¦æ±‚ä¸­å¿…é¡»é…ç½®çš„å‚æ•°ï¼š"><a href="#ä¸‹é¢æ˜¯åœ¨æœ€ä½é…ç½®è¦æ±‚ä¸­å¿…é¡»é…ç½®çš„å‚æ•°ï¼š" class="headerlink" title="ä¸‹é¢æ˜¯åœ¨æœ€ä½é…ç½®è¦æ±‚ä¸­å¿…é¡»é…ç½®çš„å‚æ•°ï¼š"></a>ä¸‹é¢æ˜¯åœ¨æœ€ä½é…ç½®è¦æ±‚ä¸­å¿…é¡»é…ç½®çš„å‚æ•°ï¼š</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">### æœ€å°é…ç½®</span></div><div class="line"></div><div class="line">æœ€å°é…ç½®æ„å‘³ç€æ‰€æœ‰çš„é…ç½®æ–‡ä»¶ä¸­å¿…é¡»è¦åŒ…å«è¿™äº›é…ç½®é€‰é¡¹ã€‚</div><div class="line"></div><div class="line"><span class="comment">#### clientPort</span></div><div class="line"></div><div class="line">æœåŠ¡å™¨ç›‘å¬å®¢æˆ·ç«¯è¿æ¥çš„ç«¯å£, äº¦å³å®¢æˆ·ç«¯å°è¯•è¿æ¥åˆ°æœåŠ¡å™¨ä¸Šçš„æŒ‡å®šç«¯å£ã€‚</div><div class="line"></div><div class="line"><span class="comment">##### dataDir</span></div><div class="line"></div><div class="line">ZooKeeper å­˜å‚¨å†…å­˜æ•°æ®åº“å¿«ç…§æ–‡ä»¶çš„è·¯å¾„, å¹¶ä¸”å¦‚æœæ²¡æœ‰æŒ‡å®šå…¶å®ƒè·¯å¾„çš„è¯, æ•°æ®åº“æ›´æ–°çš„äº‹åŠ¡æ—¥å¿—ä¹Ÿå°†å­˜å‚¨åˆ°è¯¥è·¯å¾„ä¸‹ã€‚</div><div class="line"></div><div class="line">æ³¨æ„: äº‹åŠ¡æ—¥å¿—ä¼šå½±å“ ZooKeeper æœåŠ¡å™¨çš„æ•´ä½“æ€§èƒ½, æ‰€ä»¥å»ºè®®å°†äº‹åŠ¡æ—¥å¿—æ”¾ç½®åˆ°ç”± dataLogDir å‚æ•°æŒ‡å®šçš„è·¯å¾„ä¸‹ã€‚</div><div class="line"></div><div class="line"><span class="comment">##### tickTime</span></div><div class="line"></div><div class="line">å•ä¸ª tick çš„æ—¶é—´é•¿åº¦, å®ƒæ˜¯ ZooKeeper ä¸­ä½¿ç”¨çš„åŸºæœ¬æ—¶é—´å•å…ƒ, ä»¥æ¯«ç§’ä¸ºå•ä½ã€‚å®ƒç”¨æ¥è°ƒèŠ‚å¿ƒè·³å’Œè¶…æ—¶æ—¶é—´ã€‚ä¾‹å¦‚, æœ€å°ä¼šè¯è¶…æ—¶æ—¶é—´æ˜¯ 2 ä¸ª tickã€‚</div></pre></td></tr></table></figure>
<p>ç”Ÿäº§ç¯å¢ƒä¾‹å­ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line">1.tickTimeï¼šCSé€šä¿¡å¿ƒè·³æ•°</div><div class="line"></div><div class="line">Zookeeper æœåŠ¡å™¨ä¹‹é—´æˆ–å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´ç»´æŒå¿ƒè·³çš„æ—¶é—´é—´éš”ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ª tickTime æ—¶é—´å°±ä¼šå‘é€ä¸€ä¸ªå¿ƒè·³ã€‚tickTimeä»¥æ¯«ç§’ä¸ºå•ä½ã€‚</div><div class="line"></div><div class="line">tickTime=2000  </div><div class="line"></div><div class="line">2.initLimitï¼šLFåˆå§‹é€šä¿¡æ—¶é™</div><div class="line">é›†ç¾¤ä¸­çš„followeræœåŠ¡å™¨(F)ä¸leaderæœåŠ¡å™¨(L)ä¹‹é—´åˆå§‹è¿æ¥æ—¶èƒ½å®¹å¿çš„æœ€å¤šå¿ƒè·³æ•°ï¼ˆtickTimeçš„æ•°é‡ï¼‰ã€‚</div><div class="line"></div><div class="line">initLimit=5  </div><div class="line"></div><div class="line">3.syncLimitï¼šLFåŒæ­¥é€šä¿¡æ—¶é™</div><div class="line">é›†ç¾¤ä¸­çš„followeræœåŠ¡å™¨ä¸leaderæœåŠ¡å™¨ä¹‹é—´è¯·æ±‚å’Œåº”ç­”ä¹‹é—´èƒ½å®¹å¿çš„æœ€å¤šå¿ƒè·³æ•°ï¼ˆtickTimeçš„æ•°é‡ï¼‰ã€‚</div><div class="line"></div><div class="line">syncLimit=2  </div><div class="line"> </div><div class="line">4.dataDirï¼šæ•°æ®æ–‡ä»¶ç›®å½•</div><div class="line">Zookeeperä¿å­˜æ•°æ®çš„ç›®å½•ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒZookeeperå°†å†™æ•°æ®çš„æ—¥å¿—æ–‡ä»¶ä¹Ÿä¿å­˜åœ¨è¿™ä¸ªç›®å½•é‡Œã€‚</div><div class="line"></div><div class="line">dataDir=/home/michael/opt/zookeeper/data  </div><div class="line"></div><div class="line">5.dataLogDirï¼šæ—¥å¿—æ–‡ä»¶ç›®å½•</div><div class="line">Zookeeperä¿å­˜æ—¥å¿—æ–‡ä»¶çš„ç›®å½•ã€‚</div><div class="line"></div><div class="line">dataLogDir=/home/michael/opt/zookeeper/<span class="built_in">log</span>  </div><div class="line"></div><div class="line">6.clientPortï¼šå®¢æˆ·ç«¯è¿æ¥ç«¯å£</div><div class="line">å®¢æˆ·ç«¯è¿æ¥ Zookeeper æœåŠ¡å™¨çš„ç«¯å£ï¼ŒZookeeper ä¼šç›‘å¬è¿™ä¸ªç«¯å£ï¼Œæ¥å—å®¢æˆ·ç«¯çš„è®¿é—®è¯·æ±‚ã€‚</div><div class="line"></div><div class="line">clientPort=2333  </div><div class="line"></div><div class="line">7.æœåŠ¡å™¨åç§°ä¸åœ°å€ï¼šé›†ç¾¤ä¿¡æ¯ï¼ˆæœåŠ¡å™¨ç¼–å·ï¼ŒæœåŠ¡å™¨åœ°å€ï¼ŒLFé€šä¿¡ç«¯å£ï¼Œé€‰ä¸¾ç«¯å£ï¼‰</div><div class="line">è¿™ä¸ªé…ç½®é¡¹çš„ä¹¦å†™æ ¼å¼æ¯”è¾ƒç‰¹æ®Šï¼Œè§„åˆ™å¦‚ä¸‹ï¼š</div><div class="line"></div><div class="line">server.N=YYY:A:B  </div><div class="line"></div><div class="line">å…¶ä¸­Nè¡¨ç¤ºæœåŠ¡å™¨ç¼–å·ï¼ŒYYYè¡¨ç¤ºæœåŠ¡å™¨çš„IPåœ°å€ï¼ŒAä¸ºLFé€šä¿¡ç«¯å£ï¼Œè¡¨ç¤ºè¯¥æœåŠ¡å™¨ä¸é›†ç¾¤ä¸­çš„leaderäº¤æ¢çš„ä¿¡æ¯çš„ç«¯å£ã€‚Bä¸ºé€‰ä¸¾ç«¯å£ï¼Œè¡¨ç¤ºé€‰ä¸¾æ–°leaderæ—¶æœåŠ¡å™¨é—´ç›¸äº’é€šä¿¡çš„ç«¯å£ï¼ˆå½“leaderæŒ‚æ‰æ—¶ï¼Œå…¶ä½™æœåŠ¡å™¨ä¼šç›¸äº’é€šä¿¡ï¼Œé€‰æ‹©å‡ºæ–°çš„leaderï¼‰ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œé›†ç¾¤ä¸­æ¯ä¸ªæœåŠ¡å™¨çš„Aç«¯å£éƒ½æ˜¯ä¸€æ ·ï¼Œæ¯ä¸ªæœåŠ¡å™¨çš„Bç«¯å£ä¹Ÿæ˜¯ä¸€æ ·ã€‚ä½†æ˜¯å½“æ‰€é‡‡ç”¨çš„ä¸ºä¼ªé›†ç¾¤æ—¶ï¼ŒIPåœ°å€éƒ½ä¸€æ ·ï¼Œåªèƒ½æ—¶Aç«¯å£å’ŒBç«¯å£ä¸ä¸€æ ·ã€‚</div><div class="line">ä¸‹é¢æ˜¯ä¸€ä¸ªéä¼ªé›†ç¾¤çš„ä¾‹å­ï¼š</div><div class="line"></div><div class="line">server.0=233.34.9.144:2008:6008  </div><div class="line">server.1=233.34.9.145:2008:6008  </div><div class="line">server.2=233.34.9.146:2008:6008  </div><div class="line">server.3=233.34.9.147:2008:6008  </div><div class="line"></div><div class="line">ä¸‹é¢æ˜¯ä¸€ä¸ªä¼ªé›†ç¾¤çš„ä¾‹å­ï¼š</div><div class="line"></div><div class="line">server.0=127.0.0.1:2008:6008  </div><div class="line">server.1=127.0.0.1:2007:6007  </div><div class="line">server.2=127.0.0.1:2006:6006  </div><div class="line">server.3=127.0.0.1:2005:6005</div></pre></td></tr></table></figure>
<h2 id="é«˜çº§é…ç½®"><a href="#é«˜çº§é…ç½®" class="headerlink" title="é«˜çº§é…ç½®"></a>é«˜çº§é…ç½®</h2><p>æœ¬èŠ‚çš„é…ç½®é€‰é¡¹æ˜¯å¯é€‰çš„ã€‚ä½ å¯ä»¥ä½¿ç”¨å®ƒä»¬è¿›ä¸€æ­¥çš„ä¼˜åŒ– ZooKeeper æœåŠ¡å™¨çš„è¡Œä¸ºã€‚æœ‰äº›å¯ä»¥ä½¿ç”¨ Java ç³»ç»Ÿå±æ€§æ¥è®¾ç½®, ä¸€èˆ¬çš„æ ¼å¼æ˜¯ â€œzookeeper.keywordâ€ã€‚å¦‚æœæœ‰å…·ä½“çš„ç³»ç»Ÿå±æ€§, ä¼šåœ¨é…ç½®é€‰é¡¹ä¸‹é¢æ ‡æ³¨å‡ºæ¥ã€‚</p>
<h5 id="dataLogDir"><a href="#dataLogDir" class="headerlink" title="dataLogDir"></a>dataLogDir</h5><p>æ²¡æœ‰å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§ã€‚</p>
<p>è¯¥å‚æ•°ç”¨äºé…ç½® ZooKeeper æœåŠ¡å™¨å­˜å‚¨äº‹åŠ¡æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„, ZooKeeper é»˜è®¤å°†äº‹åŠ¡æ—¥å¿—æ–‡ä»¶å’Œæ•°æ®å¿«ç…§å­˜å‚¨åœ¨åŒä¸€ä¸ªç›®å½•ä¸‹, åº”å°½é‡å°†å®ƒä»¬åˆ†å¼€å­˜å‚¨ã€‚</p>
<p>æ³¨æ„: å°†äº‹åŠ¡æ—¥å¿—æ–‡ä»¶å­˜å‚¨åˆ°ä¸€ä¸ªä¸“é—¨çš„æ—¥å¿—è®¾å¤‡ä¸Šå¯¹äºæœåŠ¡å™¨çš„ååé‡å’Œç¨³å®šçš„å»¶è¿Ÿæœ‰å¾ˆå¤§çš„å½±å“ã€‚äº‹åŠ¡æ—¥å¿—å¯¹ç£ç›˜æ€§èƒ½è¦æ±‚æ¯”è¾ƒé«˜, ä¸ºäº†ä¿è¯æ•°æ®ä¸€è‡´æ€§, ZooKeeper åœ¨å“åº”å®¢æˆ·ç«¯äº‹åŠ¡è¯·æ±‚ä¹‹å‰, éœ€è¦å°†è¯·æ±‚çš„äº‹åŠ¡æ—¥å¿—å†™åˆ°ç£ç›˜ä¸Š, æ‰€ä»¥äº‹åŠ¡æ—¥å¿—çš„å†™å…¥æ€§èƒ½ç›´æ¥å½±å“ ZooKeeper æœåŠ¡å™¨å¤„ç†è¯·æ±‚çš„ååã€‚æ‰€ä»¥å»ºè®®ç»™äº‹åŠ¡æ—¥å¿—çš„è¾“å‡ºé…ç½®ä¸€ä¸ªå•ç‹¬çš„ç£ç›˜æˆ–è€…æŒ‚è½½ç‚¹ã€‚</p>
<h5 id="globalOutstandingLimit"><a href="#globalOutstandingLimit" class="headerlink" title="globalOutstandingLimit"></a>globalOutstandingLimit</h5><p>å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: zookeeper.globalOutstandingLimitã€‚</p>
<p>å®¢æˆ·ç«¯æäº¤è¯·æ±‚çš„é€Ÿåº¦å¯èƒ½æ¯” ZooKeeper å¤„ç†çš„é€Ÿåº¦å¿«å¾—å¤š, ç‰¹åˆ«æ˜¯å½“å®¢æˆ·ç«¯çš„æ•°é‡éå¸¸å¤šçš„æ—¶å€™ã€‚ä¸ºäº†é˜²æ­¢ ZooKeeper å› ä¸ºæ’é˜Ÿçš„è¯·æ±‚è€Œè€—å°½å†…å­˜, ZooKeeper å°†ä¼šå¯¹å®¢æˆ·ç«¯è¿›è¡Œé™æµ, å³é™åˆ¶ç³»ç»Ÿä¸­æœªå¤„ç†çš„è¯·æ±‚æ•°é‡ä¸è¶…è¿‡ globalOutstandingLimit è®¾ç½®çš„å€¼ã€‚é»˜è®¤çš„é™åˆ¶æ˜¯ 1,000ã€‚</p>
<h5 id="preAllocSize"><a href="#preAllocSize" class="headerlink" title="preAllocSize"></a>preAllocSize</h5><p>å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: zookeeper.preAllocSizeã€‚</p>
<p>ç”¨äºé…ç½® ZooKeeper äº‹åŠ¡æ—¥å¿—æ–‡ä»¶é¢„åˆ†é…çš„ç£ç›˜ç©ºé—´å¤§å°ã€‚é»˜è®¤çš„å—å¤§å°æ˜¯ 64Mã€‚æ”¹å˜å—å¤§å°çš„å…¶ä¸­ä¸€ä¸ªåŸå› æ˜¯å½“æ•°æ®å¿«ç…§æ–‡ä»¶ç”Ÿæˆæ¯”è¾ƒé¢‘ç¹æ—¶å¯ä»¥é€‚å½“å‡å°‘å—å¤§å°ã€‚æ¯”å¦‚ 1000 æ¬¡äº‹åŠ¡ä¼šæ–°äº§ç”Ÿä¸€ä¸ªå¿«ç…§(å‚æ•°ä¸ºsnapCount), æ–°äº§ç”Ÿå¿«ç…§åä¼šç”¨æ–°çš„äº‹åŠ¡æ—¥å¿—æ–‡ä»¶, å‡è®¾ä¸€ä¸ªäº‹åŠ¡ä¿¡æ¯å¤§å°100b, é‚£ä¹ˆäº‹åŠ¡æ—¥å¿—é¢„åˆ†é…çš„ç£ç›˜ç©ºé—´å¤§å°ä¸º100kbä¼šæ¯”è¾ƒå¥½ã€‚</p>
<h5 id="snapCount"><a href="#snapCount" class="headerlink" title="snapCount"></a>snapCount</h5><p>å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: zookeeper.snapCountã€‚</p>
<p>ZooKeeper å°†äº‹åŠ¡è®°å½•åˆ°äº‹åŠ¡æ—¥å¿—ä¸­ã€‚å½“ snapCount ä¸ªäº‹åŠ¡è¢«å†™åˆ°ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶å, å¯åŠ¨ä¸€ä¸ªå¿«ç…§å¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡æ—¥å¿—æ–‡ä»¶ã€‚snapCount çš„é»˜è®¤å€¼æ˜¯ 100,000ã€‚</p>
<h5 id="traceFile"><a href="#traceFile" class="headerlink" title="traceFile"></a>traceFile</h5><p>å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: requestTraceFileã€‚</p>
<p>å¦‚æœå®šä¹‰äº†è¯¥é€‰é¡¹, é‚£ä¹ˆè¯·æ±‚å°†ä¼šè®°å½•åˆ°ä¸€ä¸ªåä¸º traceFile.year.month.day çš„è·Ÿè¸ªæ–‡ä»¶ä¸­ã€‚ä½¿ç”¨è¯¥é€‰é¡¹å¯ä»¥æä¾›å¾ˆæœ‰ç”¨çš„è°ƒè¯•ä¿¡æ¯, ä½†æ˜¯ä¼šå½±å“æ€§èƒ½ã€‚</p>
<p>æ³¨æ„: requestTraceFile è¿™ä¸ªç³»ç»Ÿå±æ€§æ²¡æœ‰ zookeeper å‰ç¼€, å¹¶ä¸”é…ç½®çš„å˜é‡åç§°å’Œç³»ç»Ÿå±æ€§ä¸ä¸€æ ·ã€‚</p>
<h5 id="maxClientCnxns"><a href="#maxClientCnxns" class="headerlink" title="maxClientCnxns"></a>maxClientCnxns</h5><p>æ²¡æœ‰å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§</p>
<p>åœ¨ socket çº§åˆ«é™åˆ¶å•ä¸ªå®¢æˆ·ç«¯åˆ° ZooKeeper é›†ç¾¤ä¸­å•å°æœåŠ¡å™¨çš„å¹¶å‘è¿æ¥æ•°é‡, å¯ä»¥é€šè¿‡ IP åœ°å€æ¥åŒºåˆ†ä¸åŒçš„å®¢æˆ·ç«¯ã€‚å®ƒç”¨æ¥é˜»æ­¢æŸç§ç±»å‹çš„ DoS æ”»å‡», åŒ…æ‹¬æ–‡ä»¶æè¿°ç¬¦èµ„æºè€—å°½ã€‚é»˜è®¤å€¼æ˜¯ 60ã€‚å°†å€¼è®¾ç½®ä¸º 0 å°†å®Œå…¨ç§»é™¤å¹¶å‘è¿æ¥çš„é™åˆ¶ã€‚</p>
<h5 id="clientPortAddress"><a href="#clientPortAddress" class="headerlink" title="clientPortAddress"></a>clientPortAddress</h5><p>æœåŠ¡å™¨ç›‘å¬å®¢æˆ·ç«¯è¿æ¥çš„åœ°å€ (ipv4, ipv6 æˆ– ä¸»æœºå) , äº¦å³å®¢æˆ·ç«¯å°è¯•è¿æ¥åˆ°æœåŠ¡å™¨ä¸Šçš„åœ°å€ã€‚è¯¥å‚æ•°æ˜¯å¯é€‰çš„, é»˜è®¤æˆ‘ä»¬ä»¥è¿™æ ·ä¸€ç§æ–¹å¼ç»‘å®š, å³å¯¹äºæœåŠ¡å™¨ä¸Šä»»æ„ address/interface/nic, ä»»ä½•è¿æ¥åˆ° clientPort çš„è¯·æ±‚å°†ä¼šè¢«æ¥å—ã€‚</p>
<h5 id="minSessionTimeout"><a href="#minSessionTimeout" class="headerlink" title="minSessionTimeout"></a>minSessionTimeout</h5><p>æ²¡æœ‰å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§</p>
<p>æœåŠ¡å™¨å…è®¸å®¢æˆ·ç«¯ä¼šè¯çš„æœ€å°è¶…æ—¶æ—¶é—´, ä»¥æ¯«ç§’ä¸ºå•ä½ã€‚é»˜è®¤å€¼æ˜¯ 2 å€çš„ tickTimeã€‚</p>
<h5 id="maxSessionTimeout"><a href="#maxSessionTimeout" class="headerlink" title="maxSessionTimeout"></a>maxSessionTimeout</h5><p>æ²¡æœ‰å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§</p>
<p>æœåŠ¡å™¨å…è®¸å®¢æˆ·ç«¯ä¼šè¯çš„æœ€å¤§è¶…æ—¶æ—¶é—´, ä»¥æ¯«ç§’ä¸ºå•ä½ã€‚é»˜è®¤å€¼æ˜¯ 20 å€çš„ tickTimeã€‚</p>
<h5 id="fsync-warningthresholdms"><a href="#fsync-warningthresholdms" class="headerlink" title="fsync.warningthresholdms"></a>fsync.warningthresholdms</h5><p>å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: fsync.warningthresholdmsã€‚</p>
<p>ç”¨äºé…ç½® ZooKeeper è¿›è¡Œäº‹åŠ¡æ—¥å¿— (WAL) fsync æ“ä½œæ¶ˆè€—æ—¶é—´çš„æŠ¥è­¦é˜ˆå€¼, ä¸€æ—¦è¶…è¿‡è¿™ä¸ªé˜ˆå€¼å°†ä¼šæ‰“å°è¾“å‡ºæŠ¥è­¦æ—¥å¿—ã€‚è¯¥å‚æ•°çš„é»˜è®¤å€¼æ˜¯ 1000, ä»¥æ¯«ç§’ä¸ºå•ä½ã€‚å‚æ•°å€¼åªèƒ½ä½œä¸ºç³»ç»Ÿå±æ€§æ¥è®¾ç½®ã€‚</p>
<h5 id="autopurge-snapRetainCount"><a href="#autopurge-snapRetainCount" class="headerlink" title="autopurge.snapRetainCount"></a>autopurge.snapRetainCount</h5><p>æ²¡æœ‰å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§ã€‚</p>
<p>å½“å¯ç”¨è‡ªåŠ¨æ¸…ç†åŠŸèƒ½å, ZooKeeper å°†åªä¿ç•™ autopurge.snapRetainCount ä¸ªæœ€è¿‘çš„æ•°æ®å¿«ç…§(dataDir)å’Œå¯¹åº”çš„äº‹åŠ¡æ—¥å¿—æ–‡ä»¶(dataLogDir), å…¶ä½™çš„å°†ä¼šåˆ é™¤æ‰ã€‚é»˜è®¤å€¼æ˜¯ 3ã€‚æœ€å°å€¼ä¹Ÿæ˜¯ 3ã€‚</p>
<h5 id="autopurge-purgeInterval"><a href="#autopurge-purgeInterval" class="headerlink" title="autopurge.purgeInterval"></a>autopurge.purgeInterval</h5><p>æ²¡æœ‰å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§ã€‚</p>
<p>ç”¨äºé…ç½®è§¦å‘æ¸…ç†ä»»åŠ¡çš„æ—¶é—´é—´éš”, ä»¥å°æ—¶ä¸ºå•ä½ã€‚è¦å¯ç”¨è‡ªåŠ¨æ¸…ç†, å¯ä»¥å°†å…¶å€¼è®¾ç½®ä¸ºä¸€ä¸ªæ­£æ•´æ•° (å¤§äº 1) ã€‚é»˜è®¤å€¼æ˜¯ 0ã€‚</p>
<h5 id="syncEnabled"><a href="#syncEnabled" class="headerlink" title="syncEnabled"></a>syncEnabled</h5><p>å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: zookeeper.observer.syncEnabledã€‚</p>
<p>å’Œå‚ä¸è€…ä¸€æ ·, è§‚å¯Ÿè€…ç°åœ¨é»˜è®¤å°†äº‹åŠ¡æ—¥å¿—ä»¥åŠæ•°æ®å¿«ç…§å†™åˆ°ç£ç›˜ä¸Š, è¿™å°†å‡å°‘è§‚å¯Ÿè€…åœ¨æœåŠ¡å™¨é‡å¯æ—¶çš„æ¢å¤æ—¶é—´ã€‚å°†å…¶å€¼è®¾ç½®ä¸º â€œfalseâ€ å¯ä»¥ç¦ç”¨è¯¥ç‰¹æ€§ã€‚é»˜è®¤å€¼æ˜¯ â€œtrueâ€ã€‚</p>
<p>é›†ç¾¤é…ç½®é€‰é¡¹</p>
<p>æœ¬èŠ‚ä¸­çš„é€‰é¡¹ä¸»è¦ç”¨äºZooKeeperé›†ç¾¤ã€‚</p>
<h5 id="electionAlg"><a href="#electionAlg" class="headerlink" title="electionAlg"></a>electionAlg</h5><p>æ²¡æœ‰å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§ã€‚</p>
<p>ç”¨äºé€‰æ‹©ä½¿ç”¨çš„ leader é€‰ä¸¾ç®—æ³•ã€‚â€0â€ å¯¹åº”äºåŸå§‹çš„åŸºäº UDP çš„ç‰ˆæœ¬, â€œ1â€ å¯¹åº”äºå¿«é€Ÿ leader é€‰ä¸¾åŸºäºUDPçš„æ— èº«ä»½éªŒè¯çš„ç‰ˆæœ¬, â€œ2â€ å¯¹åº”äºå¿«é€Ÿ leader é€‰ä¸¾æœ‰åŸºäºUDPçš„èº«ä»½éªŒè¯çš„ç‰ˆæœ¬, è€Œ â€œ3â€ å¯¹åº”äºå¿«é€Ÿ leader é€‰ä¸¾åŸºäºTCPçš„ç‰ˆæœ¬ã€‚ç›®å‰é»˜è®¤å€¼æ˜¯ç®—æ³• 3ã€‚</p>
<p>æ³¨æ„: leader é€‰ä¸¾ 0, 1, 2 è¿™ä¸‰ç§å®ç°å·²ç»åºŸå¼ƒ, åœ¨æ¥ä¸‹æ¥çš„ç‰ˆæœ¬ä¸­å°†ä¼šç§»é™¤å®ƒä»¬, è¿™æ ·å°±åªå‰©ä¸‹ FastLeaderElection ç®—æ³•ã€‚</p>
<h5 id="initLimit"><a href="#initLimit" class="headerlink" title="initLimit"></a>initLimit</h5><p>æ²¡æœ‰å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§ã€‚</p>
<p>é»˜è®¤å€¼æ˜¯ 10, å³ tickTime å±æ€§å€¼çš„ 10 å€ã€‚å®ƒç”¨äºé…ç½®å…è®¸ followers è¿æ¥å¹¶åŒæ­¥åˆ° leader çš„æœ€å¤§æ—¶é—´ã€‚å¦‚æœ ZooKeeper ç®¡ç†çš„æ•°æ®é‡å¾ˆå¤§çš„è¯å¯ä»¥å¢åŠ è¿™ä¸ªå€¼ã€‚</p>
<h5 id="leaderServes"><a href="#leaderServes" class="headerlink" title="leaderServes"></a>leaderServes</h5><p>å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: zookeeper.leaderServesã€‚</p>
<p>ç”¨äºé…ç½® Leader æ˜¯å¦æ¥å—å®¢æˆ·ç«¯è¿æ¥, é»˜è®¤å€¼æ˜¯ â€œyesâ€, å³ leader å°†ä¼šæ¥å—å®¢æˆ·ç«¯è¿æ¥ã€‚åœ¨ ZooKeeper ä¸­, leader æœåŠ¡å™¨ä¸»è¦åè°ƒäº‹åŠ¡æ›´æ–°è¯·æ±‚ã€‚å¯¹äºäº‹åŠ¡æ›´æ–°è¯·æ±‚ååå¾ˆé«˜è€Œè¯»å–è¯·æ±‚ååå¾ˆä½çš„æƒ…å†µå¯ä»¥é…ç½® leader ä¸æ¥å—å®¢æˆ·ç«¯è¿æ¥, è¿™æ ·å°±å¯ä»¥ä¸“æ³¨äºåè°ƒå·¥ä½œã€‚</p>
<p>æ³¨æ„: å½“ ZooKeeper é›†ç¾¤ä¸­æœåŠ¡å™¨çš„æ•°é‡è¶…è¿‡ 3 ä¸ªæ—¶, å»ºè®®å¼€å¯ leader é€‰ä¸¾ã€‚</p>
<h5 id="server-x-hostname-nnnnn-nnnnn"><a href="#server-x-hostname-nnnnn-nnnnn" class="headerlink" title="server.x=[hostname]:nnnnn:nnnnn"></a>server.x=[hostname]:nnnnn:nnnnn</h5><p>æ²¡æœ‰å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§ã€‚</p>
<p>ç»„æˆ ZooKeeper é›†ç¾¤çš„æœåŠ¡å™¨ã€‚å½“æœåŠ¡å™¨å¯åŠ¨æ—¶, å¯ä»¥é€šè¿‡æŸ¥æ‰¾æ•°æ®ç›®å½•ä¸­çš„ myid æ–‡ä»¶æ¥å†³å®šå®ƒæ˜¯å“ªä¸€å°æœåŠ¡å™¨ã€‚myid æ–‡ä»¶åŒ…å«æœåŠ¡å™¨ç¼–å·, å¹¶ä¸”å®ƒè¦åŒ¹é… â€œserver.xâ€ ä¸­çš„ xã€‚</p>
<p>å®¢æˆ·ç«¯ç”¨æ¥ç»„æˆ ZooKeeper é›†ç¾¤çš„æœåŠ¡å™¨åˆ—è¡¨å¿…é¡»å’Œæ¯ä¸ª ZooKeeper æœåŠ¡å™¨ä¸­é…ç½®çš„ ZooKeeper æœåŠ¡å™¨åˆ—è¡¨ç›¸åŒ¹é…ã€‚</p>
<p>æœ‰ä¸¤ä¸ªç«¯å£å· nnnnn, ç¬¬ä¸€ä¸ªæ˜¯ followers ç”¨æ¥è¿æ¥åˆ° leader, ç¬¬äºŒä¸ªæ˜¯ç”¨äº leader é€‰ä¸¾ã€‚å¦‚æœæƒ³åœ¨å•å°æœºå™¨ä¸Šæµ‹è¯•å¤šä¸ªæœåŠ¡, åˆ™å¯ä»¥ä¸ºæ¯ä¸ªæœåŠ¡é…ç½®ä¸åŒçš„ç«¯å£ã€‚</p>
<h5 id="syncLimit"><a href="#syncLimit" class="headerlink" title="syncLimit"></a>syncLimit</h5><p>æ²¡æœ‰å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§ã€‚</p>
<p>é»˜è®¤å€¼æ˜¯ 5, å³ tickTime å±æ€§å€¼çš„ 5 å€ã€‚å®ƒç”¨äºé…ç½®leader å’Œ followers é—´è¿›è¡Œå¿ƒè·³æ£€æµ‹çš„æœ€å¤§å»¶è¿Ÿæ—¶é—´ã€‚å¦‚æœåœ¨è®¾ç½®çš„æ—¶é—´å†… followers æ— æ³•ä¸ leader è¿›è¡Œé€šä¿¡, é‚£ä¹ˆ followers å°†ä¼šè¢«ä¸¢å¼ƒã€‚</p>
<h5 id="group-x-nnnnn-nnnnn"><a href="#group-x-nnnnn-nnnnn" class="headerlink" title="group.x=nnnnn[:nnnnn]"></a>group.x=nnnnn[:nnnnn]</h5><p>æ²¡æœ‰å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§ã€‚</p>
<p>Enables a hierarchical quorum construction.â€xâ€ æ˜¯ä¸€ä¸ªç»„çš„æ ‡è¯†, ç­‰å·å³è¾¹çš„æ•°å­—å¯¹åº”äºæœåŠ¡å™¨çš„æ ‡è¯†. èµ‹å€¼æ“ä½œå³è¾¹æ˜¯å†’å·åˆ†éš”çš„æœåŠ¡å™¨æ ‡è¯†ã€‚æ³¨æ„: ç»„å¿…é¡»æ˜¯ä¸ç›¸äº¤çš„, å¹¶ä¸”æ‰€æœ‰ç»„è”åˆåå¿…é¡»æ˜¯ ZooKeeper é›†ç¾¤ã€‚</p>
<h5 id="weight-x-nnnnn"><a href="#weight-x-nnnnn" class="headerlink" title="weight.x=nnnnn"></a>weight.x=nnnnn</h5><p>æ²¡æœ‰å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§ã€‚</p>
<p>å’Œ â€œgroupâ€ ä¸€èµ·ä½¿ç”¨, å½“å½¢æˆé›†ç¾¤æ—¶å®ƒç»™æ¯ä¸ªæœåŠ¡å™¨èµ‹æƒé‡å€¼ã€‚è¿™ä¸ªå€¼å¯¹åº”äºæŠ•ç¥¨æ—¶æœåŠ¡å™¨çš„æƒé‡ã€‚ZooKeeper ä¸­åªæœ‰å°‘æ•°éƒ¨åˆ†éœ€è¦æŠ•ç¥¨, æ¯”å¦‚ leader é€‰ä¸¾ä»¥åŠåŸå­çš„å¹¿æ’­åè®®ã€‚æœåŠ¡å™¨æƒé‡çš„é»˜è®¤å€¼æ˜¯ 1ã€‚å¦‚æœé…ç½®æ–‡ä»¶ä¸­å®šä¹‰äº†ç»„, ä½†æ˜¯æ²¡æœ‰æƒé‡, é‚£ä¹ˆæ‰€æœ‰æœåŠ¡å™¨çš„æƒé‡å°†ä¼šèµ‹å€¼ä¸º 1ã€‚</p>
<h5 id="cnxTimeout"><a href="#cnxTimeout" class="headerlink" title="cnxTimeout"></a>cnxTimeout</h5><p>å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: zookeeper.cnxTimeoutã€‚</p>
<p>ç”¨äºé…ç½® leaderé€‰ä¸¾è¿‡ç¨‹ä¸­ï¼Œæ‰“å¼€ä¸€æ¬¡è¿æ¥ï¼ˆé€‰ä¸¾çš„ server äº’ç›¸é€šä¿¡å»ºç«‹è¿æ¥ï¼‰çš„è¶…æ—¶æ—¶é—´ã€‚é»˜è®¤å€¼æ˜¯ 5sã€‚</p>
<h2 id="èº«ä»½è®¤è¯å’Œæˆæƒé€‰é¡¹"><a href="#èº«ä»½è®¤è¯å’Œæˆæƒé€‰é¡¹" class="headerlink" title="èº«ä»½è®¤è¯å’Œæˆæƒé€‰é¡¹"></a>èº«ä»½è®¤è¯å’Œæˆæƒé€‰é¡¹</h2><p>æœ¬èŠ‚çš„é€‰é¡¹å…è®¸é€šè¿‡èº«ä»½è®¤è¯å’Œæˆæƒæ¥æ§åˆ¶æœåŠ¡æ‰§è¡Œã€‚</p>
<p>zookeeper.DigestAuthenticationProvider.superDigest</p>
<p>å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: zookeeper.DigestAuthenticationProvider.superDigestã€‚</p>
<p>è¯¥åŠŸèƒ½é»˜è®¤æ˜¯ç¦ç”¨çš„ã€‚</p>
<p>èƒ½å¤Ÿä½¿ ZooKeeper é›†ç¾¤ç®¡ç†å‘˜å¯ä»¥ä½œä¸ºä¸€ä¸ª â€œsuperâ€ ç”¨æˆ·æ¥è®¿é—® znode å±‚çº§ç»“æ„ã€‚ç‰¹åˆ«æ˜¯å¯¹äºä¸€ä¸ªå·²ç»è®¤è¯ä¸ºè¶…çº§ç®¡ç†å‘˜çš„ç”¨æˆ·ä¸éœ€è¦ ACL æ£€æŸ¥ã€‚</p>
<p>org.apache.zookeeper.server.auth.DigestAuthenticationProvider å¯ä»¥ç”¨æ¥ç”Ÿæˆ superDigest, è°ƒç”¨å®ƒå¸¦æœ‰ â€œsuper:<password>â€œ å‚æ•°çš„æ–¹æ³•ã€‚å½“å¯åŠ¨é›†ç¾¤ä¸­çš„æ¯å°æœåŠ¡å™¨æ—¶, å°†ç”Ÿæˆçš„ â€œsuper:<data>â€œ ä½œä¸ºç³»ç»Ÿå±æ€§æä¾›ã€‚</data></password></p>
<p>å½“ ZooKeeper å®¢æˆ·ç«¯å‘ ZooKeeper æœåŠ¡å™¨è¿›è¡Œèº«ä»½è®¤è¯æ—¶, ä¼šä¼ é€’ä¸€ä¸ª â€œdigestâ€ å’Œ â€œsuper:<password>â€œ çš„è®¤è¯æ•°æ®. æ³¨æ„æ‘˜è¦å¼èº«ä»½éªŒè¯å°†è®¤è¯æ•°æ®ä»¥æ™®é€šæ–‡æœ¬çš„å½¢å¼ä¼ é€’ç»™æœåŠ¡å™¨, åœ¨ç½‘ç»œä¸­éœ€è¦è°¨æ…ä½¿ç”¨è¯¥è®¤è¯æ–¹æ³•, è¦ä¹ˆåªåœ¨æœ¬æœºä¸Šæˆ–é€šè¿‡ä¸€ä¸ªåŠ å¯†çš„è¿æ¥ã€‚</password></p>
<h5 id="å®éªŒæ€§é€‰é¡¹-ç‰¹æ€§"><a href="#å®éªŒæ€§é€‰é¡¹-ç‰¹æ€§" class="headerlink" title="å®éªŒæ€§é€‰é¡¹/ç‰¹æ€§"></a>å®éªŒæ€§é€‰é¡¹/ç‰¹æ€§</h5><p>æœ¬èŠ‚åˆ—ä¸¾äº†ä¸€äº›ç›®å‰è¿˜å¤„äºå®éªŒé˜¶æ®µçš„æ–°ç‰¹æ€§ã€‚</p>
<h5 id="æœåŠ¡å™¨åªè¯»æ¨¡å¼"><a href="#æœåŠ¡å™¨åªè¯»æ¨¡å¼" class="headerlink" title="æœåŠ¡å™¨åªè¯»æ¨¡å¼"></a>æœåŠ¡å™¨åªè¯»æ¨¡å¼</h5><p>å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: readonlymode.enabledã€‚</p>
<p>å°†å…¶è®¾ç½®ä¸º true å°†ä¼šå¯ç”¨æœåŠ¡å™¨åªè¯»æ¨¡å¼æ”¯æŒ, é»˜è®¤æ˜¯ç¦ç”¨çš„ã€‚ROM å…è®¸è¯·æ±‚äº† ROM æ”¯æŒçš„å®¢æˆ·ç«¯ä¼šè¯è¿æ¥åˆ°æœåŠ¡å™¨, å³ä½¿å½“æœåŠ¡å™¨å¯èƒ½å·²ç»ä»é›†ç¾¤ä¸­åˆ†éš”å‡ºå»ã€‚åœ¨è¯¥æ¨¡å¼ä¸­, ROM å®¢æˆ·ç«¯ä»ç„¶å¯ä»¥ä» ZK æœåŠ¡ä¸­è¯»å–å€¼, ä½†æ˜¯ä¸èƒ½è¿›è¡Œå†™æ“ä½œä»¥åŠçœ‹è§å…¶å®ƒå®¢æˆ·ç«¯æ‰€åšçš„ä¸€äº›å˜æ›´ã€‚æ›´å¤šè¯¦ç»†ä¿¡æ¯å¯ä»¥å‚è§ ZOOKEEPER-784 è·å–æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚</p>
<h5 id="ä¸å®‰å…¨çš„é€‰é¡¹"><a href="#ä¸å®‰å…¨çš„é€‰é¡¹" class="headerlink" title="ä¸å®‰å…¨çš„é€‰é¡¹"></a>ä¸å®‰å…¨çš„é€‰é¡¹</h5><p>ä¸‹é¢çš„é€‰é¡¹ä¼šå¾ˆæœ‰ç”¨, ä½†æ˜¯ä½¿ç”¨çš„æ—¶å€™éœ€è¦ç‰¹åˆ«å°å¿ƒã€‚</p>
<h5 id="forceSync"><a href="#forceSync" class="headerlink" title="forceSync"></a>forceSync</h5><p>å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: zookeeper.forceSyncã€‚</p>
<p>ç”¨äºé…ç½®æ˜¯å¦éœ€è¦åœ¨äº‹åŠ¡æ—¥å¿—æäº¤çš„æ—¶å€™è°ƒç”¨ FileChannel.force æ¥ä¿è¯æ•°æ®å®Œå…¨åŒæ­¥åˆ°ç£ç›˜ã€‚é»˜è®¤å€¼æ˜¯ â€œyesâ€ã€‚å¦‚æœè¯¥é€‰é¡¹è®¾ç½®ä¸º â€œnoâ€, ZooKeeper å°†ä¸ä¼šå¼ºåˆ¶åŒæ­¥äº‹åŠ¡æ›´æ–°æ—¥å¿—åˆ°ç£ç›˜ã€‚</p>
<h5 id="jute-maxbuffer"><a href="#jute-maxbuffer" class="headerlink" title="jute.maxbuffer:"></a>jute.maxbuffer:</h5><p>å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: jute.maxbufferã€‚æ²¡æœ‰ zookeeper å‰ç¼€ã€‚</p>
<p>ç”¨äºæŒ‡å®šä¸€ä¸ª znode ä¸­å¯ä»¥å­˜å‚¨æ•°æ®é‡çš„æœ€å¤§å€¼, é»˜è®¤å€¼æ˜¯ 0xfffff, æˆ– 1M å†…ã€‚å¦‚æœè¿™ä¸ªé€‰é¡¹æ”¹å˜äº†, é‚£ä¹ˆè¯¥ç³»ç»Ÿå±æ€§å¿…é¡»åœ¨æ‰€æœ‰çš„æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯è¿›è¡Œè®¾ç½®, å¦åˆ™ä¼šå‡ºç°é—®é¢˜ã€‚ZooKeeperæ—¨åœ¨å­˜å‚¨å¤§å°ä¸ºåƒå­—èŠ‚æ•°é‡çš„æ•°æ®ã€‚</p>
<h5 id="skipACL"><a href="#skipACL" class="headerlink" title="skipACL"></a>skipACL</h5><p>å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: zookeeper.skipACLã€‚</p>
<p>ç”¨äºé…ç½® ZooKeeper æœåŠ¡å™¨è·³è¿‡ ACL æƒé™æ£€æŸ¥ã€‚è¿™å°†ä¸€å®šç¨‹åº¦çš„æé«˜æœåŠ¡å™¨ååé‡, ä½†æ˜¯ä¹Ÿå‘æ‰€æœ‰å®¢æˆ·ç«¯å®Œå…¨å¼€æ”¾æ•°æ®è®¿é—®ã€‚</p>
<h5 id="quorumListenOnAllIPs"><a href="#quorumListenOnAllIPs" class="headerlink" title="quorumListenOnAllIPs"></a>quorumListenOnAllIPs</h5><p>å½“è®¾ç½®ä¸º true æ—¶, ZooKeeper æœåŠ¡å™¨å°†ä¼šåœ¨æ‰€æœ‰å¯ç”¨çš„ IP åœ°å€ä¸Šç›‘å¬æ¥è‡ªå…¶å¯¹ç­‰ç‚¹çš„è¿æ¥è¯·æ±‚, è€Œä¸ä»…æ˜¯é…ç½®æ–‡ä»¶çš„æœåŠ¡å™¨åˆ—è¡¨ä¸­é…ç½®çš„åœ°å€ã€‚å®ƒä¼šå½±å“å¤„ç† ZAB åè®®å’Œ Fast Leader Election åè®®çš„è¿æ¥ã€‚é»˜è®¤å€¼æ˜¯ falseã€‚</p>

	

	

</article>




	<article>
	
		<h1><a href="/2017/05/26/Bigdata-hadoop/zookeeper/Bigdata-ZooKeeperé›†ç¾¤å¿«é€Ÿæ­å»ºä¸ä¼˜åŒ–/">Bigdata-ZooKeeperé›†ç¾¤å¿«é€Ÿæ­å»ºä¸ä¼˜åŒ–</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2017-05-26</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/å¤§æ•°æ®/">å¤§æ•°æ®</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Big-data-Hadoop/">Big data Hadoop</a>
			</span>
		
	</div>

	

	
		<h3 id="ZooKeeperé›†ç¾¤å¿«é€Ÿæ­å»ºä¸ä¼˜åŒ–"><a href="#ZooKeeperé›†ç¾¤å¿«é€Ÿæ­å»ºä¸ä¼˜åŒ–" class="headerlink" title="ZooKeeperé›†ç¾¤å¿«é€Ÿæ­å»ºä¸ä¼˜åŒ–"></a>ZooKeeperé›†ç¾¤å¿«é€Ÿæ­å»ºä¸ä¼˜åŒ–</h3><p>ä¹‹å‰æè¿‡äº†hadoopå’Œsparkï¼Œhueï¼Œç°åœ¨åœ¨å¼„ä¸‹zookeeperé›†ç¾¤ï¼Œæ–‡æ¡£å°±æ•´ç†ä¸‹ã€‚<br>æœ¬æ–‡æ˜¯<code>ZooKeeper</code>çš„å¿«é€Ÿæ­å»º,æ—¨åœ¨å¸®åŠ©å¤§å®¶ä»¥æœ€å¿«çš„é€Ÿåº¦å®Œæˆä¸€ä¸ª<code>ZK</code>é›†ç¾¤çš„æ­å»º,ä»¥ä¾¿å¼€å±•å…¶å®ƒå·¥ä½œã€‚</p>
<h2 id="é›†ç¾¤ï¼š"><a href="#é›†ç¾¤ï¼š" class="headerlink" title="é›†ç¾¤ï¼š"></a>é›†ç¾¤ï¼š</h2><p>æœ¬æ–‡ä½¿ç”¨äº†3å°æœºå™¨éƒ¨ç½²ZooKeeperé›†ç¾¤ï¼ŒIPå’Œä¸»æœºåå¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">IP            ä¸»æœºå</div><div class="line">10.46.72.172  namenode</div><div class="line">10.47.88.103  datenode1</div><div class="line">10.47.88.206  datenode2</div></pre></td></tr></table></figure>
<h3 id="å®‰è£…è¯´æ˜"><a href="#å®‰è£…è¯´æ˜" class="headerlink" title="å®‰è£…è¯´æ˜"></a>å®‰è£…è¯´æ˜</h3><p><code>Zookeeper</code>æœºå™¨é—´ä¸éœ€è¦è®¾ç½®å…å¯†ç ç™»å½•ï¼Œå…¶å®ƒhadoopä¹Ÿå¯ä»¥ä¸è®¾ç½®ï¼Œåªè¦ä¸ä½¿ç”¨hadoop-daemons.shæ¥å¯åŠ¨ã€åœæ­¢è¿›ç¨‹ï¼Œæ³¨æ„ä¸æ˜¯hadoop-daemon.shï¼Œè€Œæ˜¯å¸¦â€œsâ€çš„é‚£ä¸ªï¼Œå¸¦â€œsâ€çš„ä¼šè¯»å–hadoopçš„salvesæ–‡ä»¶ï¼Œè¿œç¨‹sshå¯åŠ¨DataNodeå’Œå¤‡NameNodeç­‰ã€‚</p>
<h3 id="é…ç½®-etc-hosts"><a href="#é…ç½®-etc-hosts" class="headerlink" title="é…ç½®/etc/hosts"></a>é…ç½®/etc/hosts</h3><p>å°†3å°æœºå™¨çš„IPå’Œä¸»æœºåæ˜ å°„å…³ç³»ï¼Œåœ¨3å°æœºå™¨ä¸Šéƒ½é…ç½®ä¸€ä¸‹ï¼Œäº¦å³åœ¨3å°æœºå™¨çš„/etc/hostsæ–‡ä»¶ä¸­ï¼Œå‡å¢åŠ ä»¥ä¸‹å†…å®¹ï¼ˆå¯ä»¥å…ˆé…ç½®å¥½ä¸€å°ï¼Œç„¶åé€šè¿‡scpç­‰å‘½ä»¤å¤åˆ¶åˆ°å…¶å®ƒæœºå™¨ä¸Šï¼Œæ³¨æ„ä¸»æœºåä¸èƒ½åŒ…å«ä»»ä½•ä¸‹åˆ’çº¿ï¼‰ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">127.0.0.1 localhost  namenode</div><div class="line">::1        localhost localhost.localdomain localhost6 localhost6.localdomain6</div><div class="line">10.47.100.90 salt</div><div class="line">10.46.72.172  namenode</div><div class="line">10.47.88.103 datenode1</div><div class="line">10.47.88.206 datenode2</div><div class="line">10.47.102.137 datenode3</div></pre></td></tr></table></figure>
<h3 id="Step1"><a href="#Step1" class="headerlink" title="Step1:"></a>Step1:</h3><p>é…ç½® JAVA ç¯å¢ƒã€‚æ£€éªŒæ–¹æ³•:æ‰§è¡Œ <code>java â€“version</code> å’Œ <code>javac â€“version</code> å‘½ä»¤ã€‚</p>
<p>ä¸‹è½½å¹¶è§£å‹ <code>zookeeper</code>ã€‚<a href="http://mirror.bjtu.edu.cn/apache/zookeeper/zookeeper-3.4.3/" target="_blank" rel="external">é“¾æ¥ä¸€</a> ï¼Œ<a href="http://www-eu.apache.org/dist/zookeeper/" target="_blank" rel="external">é“¾æ¥äºŒ</a> (æ›´å¤šç‰ˆæœ¬:<a href="http://dwz.cn/37HGI" target="_blank" rel="external">http://dwz.cn/37HGI</a>)</p>
<h3 id="Step2"><a href="#Step2" class="headerlink" title="Step2:"></a>Step2:</h3><p>2.zookeeperçš„ç¯å¢ƒå˜é‡çš„é…ç½®ï¼š<br>ä¸ºäº†ä»Šåæ“ä½œæ–¹ä¾¿ï¼Œæˆ‘ä»¬éœ€è¦å¯¹Zookeeperçš„ç¯å¢ƒå˜é‡è¿›è¡Œé…ç½®ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š<br>åœ¨/etc/profileæ–‡ä»¶ä¸­åŠ å…¥å¦‚ä¸‹çš„å†…å®¹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#set zookeeper environment</span></div><div class="line"></div><div class="line"><span class="built_in">export</span> ZOOKEEPER_HOME=/srv/hadoop/zookeeper-3.3.6</div><div class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$ZOOKEEPER_HOME</span>/bin:<span class="variable">$ZOOKEEPER_HOME</span>/conf</div></pre></td></tr></table></figure>
<h3 id="Step3"><a href="#Step3" class="headerlink" title="Step3:"></a>Step3:</h3><p>ä¸‹è½½ä»¥åè§£å‹åˆ°æˆ‘è‡ªå·±æ–°å»ºçš„ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[hadoop@namenode ~]$ tar -zxvf zookeeper-3.3.6.tar.gz -C /srv/hadoop/</div><div class="line">[hadoop@namenode ]$ <span class="built_in">cd</span> /srv/hadoop/zookeeper-3.3.6/conf/</div></pre></td></tr></table></figure>
<p>å°†<code>zoo_sample.cfg</code>æ‹·è´ä¸€ä»½å‘½åä¸º<code>zoo.cfg</code>,è¿™é‡Œæˆ‘æ‹·è´ä¸€ä»½å‘½åä¸ºï¼š<code>zoo.cfg</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[hadoop@namenode conf]$ cp -r zoo_sample.cfg zoo.cfg</div></pre></td></tr></table></figure>
<p>è¿™é‡Œå…ˆåˆ›å»º/dataå’Œ/logs è¿™ä¸¤ä¸ªç›®å½•ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mkdir -p /srv/hadoop/zookeeper-3.3.6/zookeeper/data</div><div class="line">mkdir -p /srv/hadoop/zookeeper-3.3.6/zookeeper/logs</div></pre></td></tr></table></figure>
<p>æ³¨æ„ä¸Šå›¾çš„é…ç½®ä¸­masterï¼Œslave1åˆ†åˆ«ä¸ºä¸»æœºåã€‚</p>
<p>åœ¨ä¸Šé¢çš„é…ç½®æ–‡ä»¶ä¸­<code>&quot;server.id=host:port:port&quot;</code>ä¸­çš„ç¬¬ä¸€ä¸ªportæ˜¯ä»æœºå™¨<code>ï¼ˆfollowerï¼‰</code>è¿æ¥åˆ°ä¸»æœºå™¨<code>ï¼ˆleaderï¼‰</code>çš„ç«¯å£å·ï¼Œç¬¬äºŒä¸ªportæ˜¯è¿›è¡Œleadershipé€‰ä¸¾çš„ç«¯å£å·ã€‚</p>
<p>ä¿®æ”¹é…ç½®ï¼š</p>
<p><code>vi zoo.cfg</code>ï¼Œä¿®æ”¹æœ‰çš„é»˜è®¤å­˜åœ¨ï¼Œæ·»åŠ çº¢è‰²çš„å†…å®¹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">tickTime=2000</div><div class="line"></div><div class="line">clientPort=2181</div><div class="line"></div><div class="line">initLimit=10</div><div class="line"></div><div class="line">syncLimit=5</div><div class="line">maxClientCnxns=0 è¿™ä¸ªæ˜¯è®¾ç½®è¿æ¥æ•°0æ²¡æœ‰åšé™åˆ¶</div><div class="line">dataDir=/haozhuo/hadoop/zookeeper-3.3.6/zookeeper/data</div><div class="line">dataLogDir=/haozhuo/hadoop/zookeeper-3.3.6/zookeeper/logs</div><div class="line"></div><div class="line">server.0=namenode:2888:3888</div><div class="line">server.1=datanode1:2888:3888</div><div class="line">server.2=datanode2:2888:3888</div></pre></td></tr></table></figure>
<h3 id="åˆ›å»ºmaid"><a href="#åˆ›å»ºmaid" class="headerlink" title="åˆ›å»ºmaid:"></a>åˆ›å»ºmaid:</h3><p>è¿™é‡Œæ‰€æœ‰èŠ‚ç‚¹éƒ½éœ€è¦åˆ›å»ºã€‚<br>æ¥ä¸‹æ¥åœ¨<code>dataDir</code>æ‰€æŒ‡å®šçš„ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–‡ä»¶åä¸º<code>myid</code>çš„æ–‡ä»¶ï¼Œæ–‡ä»¶ä¸­çš„å†…å®¹åªæœ‰ä¸€è¡Œï¼Œä¸ºæœ¬ä¸»æœºå¯¹åº”çš„idå€¼ï¼Œä¹Ÿå°±æ˜¯ä¸Šå›¾ä¸­server.idä¸­çš„idã€‚ä¾‹å¦‚ï¼šåœ¨æœåŠ¡å™¨1ä¸­çš„myidçš„å†…å®¹åº”è¯¥å†™å…¥1ã€‚<br>åˆ›å»ºmyidï¼šåœ¨<code>zoo.cfg</code>é…ç½®æ–‡ä»¶ä¸­çš„dataDirçš„ç›®å½•ä¸‹é¢åˆ›å»º<code>myid</code>ï¼Œæ¯ä¸ªèŠ‚ç‚¹myidè¦æ±‚ä¸ä¸€æ ·ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /srv/hadoop/zookeeper-3.3.6/zookeeper/data</div><div class="line">touch myid</div></pre></td></tr></table></figure>
<h3 id="Step4"><a href="#Step4" class="headerlink" title="Step4:"></a>Step4:</h3><p>è¿œç¨‹å¤åˆ¶åˆ†å‘å®‰è£…æ–‡ä»¶<br>æœ€å¥½æ˜¯æŠŠæ–‡ä»¶æ‰“åŒ…scpè¿‡å»<br>æ¥ä¸‹æ¥å°†ä¸Šé¢çš„å®‰è£…æ–‡ä»¶æ‹·è´åˆ°é›†ç¾¤ä¸­çš„å…¶ä»–æœºå™¨ä¸Šå¯¹åº”çš„ç›®å½•ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">haduser@master:~/zookeeper$ scp -r zookeeper-3.4.5/ slave1:/srv/hadoop/</div><div class="line"></div><div class="line">haduser@master:~/zookeeper$ scp -r zookeeper-3.4.5/ slave2:/srv/hadoop/</div></pre></td></tr></table></figure>
<p>æ‹·è´å®Œæˆåä¿®æ”¹å¯¹åº”çš„æœºå™¨ä¸Šçš„myidã€‚ä¾‹å¦‚ä¿®æ”¹slave1ä¸­çš„myidå¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">haduser@slave1:~/zookeeper/zookeeper-3.4.5$ <span class="built_in">echo</span> <span class="string">"2"</span> &gt; data/myid</div><div class="line">haduser@slave1:~/zookeeper/zookeeper-3.4.5$ cat data/myid</div><div class="line">[hadoop@namenode hadoop]$ <span class="built_in">echo</span> 0 &gt; /haozhuo/hadoop/zookeeper-3.3.6/zookeeper/data/myid</div><div class="line">[hadoop@datanode1 hadoop]$ <span class="built_in">echo</span> 1 &gt; /haozhuo/hadoop/zookeeper-3.3.6/zookeeper/data/myid</div><div class="line">[hadoop@datanode2 hadoop]$ <span class="built_in">echo</span> 2 &gt; /haozhuo/hadoop/zookeeper-3.3.6/zookeeper/data/myid</div></pre></td></tr></table></figure>
<h3 id="Step5"><a href="#Step5" class="headerlink" title="Step5:"></a>Step5:</h3><p>å¯åŠ¨ ZooKeeperé›†ç¾¤<br>åœ¨ZooKeeperé›†ç¾¤çš„æ¯ä¸ªç»“ç‚¹ä¸Šï¼Œæ‰§è¡Œå¯åŠ¨ZooKeeperæœåŠ¡çš„è„šæœ¬ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">hadoop@namenode:~ /srv/hadoop/zookeeper-3.3.6/bin/zkServer.sh start</div><div class="line">hadoop@datanode1:~ /srv/hadoop/zookeeper-3.3.6/bin/zkServer.sh start</div><div class="line">haduser@datanode2:~ /srv/hadoop/zookeeper-3.3.6/bin/zkServer.sh start</div></pre></td></tr></table></figure>
<p>æ‰§è¡Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/haozhuo/hadoop/zookeeper-3.3.6/bin/zkServer.sh start</div></pre></td></tr></table></figure>
<h3 id="Step6"><a href="#Step6" class="headerlink" title="Step6:"></a>Step6:</h3><p>æ£€æµ‹æ˜¯å¦æˆåŠŸå¯åŠ¨:æ‰§è¡Œ <code>jps</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">24933 QuorumPeerMain</div></pre></td></tr></table></figure>
<p>å…¶ä¸­ï¼ŒQuorumPeerMainæ˜¯zookeeperè¿›ç¨‹ï¼Œå¯åŠ¨æ­£å¸¸ã€‚</p>
<p><code>./zkServer.sh status</code> æŸ¥çœ‹å½“å‰è¿è¡ŒçŠ¶æ€ã€‚</p>
<p>namenode1</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[hadoop@namenode zookeeper-3.3.6]<span class="comment"># ./zkServer.sh status</span></div><div class="line">JMX enabled by default</div><div class="line">Using config: /srv/zookeeper-3.3.6/bin/../conf/zoo.cfg</div><div class="line">Mode: follower</div><div class="line"></div><div class="line">[hadoop@datanode1 zookeeper-3.3.6]<span class="comment"># ./bin/zkServer.sh status</span></div><div class="line">JMX enabled by default</div><div class="line">Using config: /srv/zookeeper-3.3.6/bin/../conf/zoo.cfg</div><div class="line">Mode: leader</div><div class="line"></div><div class="line">[hadoop@datanode2 zookeeper-3.3.6]<span class="comment"># ./bin/zkServer.sh status</span></div><div class="line">JMX enabled by default</div><div class="line">Using config: /srv/zookeeper-3.3.6/bin/../conf/zoo.cfg</div><div class="line">Mode: leader</div></pre></td></tr></table></figure>
<h3 id="é“¾æ¥æµ‹è¯•"><a href="#é“¾æ¥æµ‹è¯•" class="headerlink" title="é“¾æ¥æµ‹è¯•"></a>é“¾æ¥æµ‹è¯•</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">bin/zkCli.sh -server 127.0.0.1:2181</div><div class="line">bin/zkCli.sh -server 127.0.0.1:2181</div><div class="line">bin/zkCli.sh -server 127.0.0.1:2181</div></pre></td></tr></table></figure>
<h3 id="Step7"><a href="#Step7" class="headerlink" title="Step7:"></a>Step7:</h3><p>å¦‚æœå•å°å¯ä»¥å…¶ä»–å‡ å°ä¸è¡Œï¼Œçœ‹é…ç½®ï¼Œå¦‚æœæ²¡æœ‰é—®é¢˜ã€‚å¯åŠ¨æŸ¥çœ‹çŠ¶æ€å‡ºç°å¼‚å¸¸ã€‚</p>
<p>å¼‚å¸¸è§£å†³:<code>Error contacting service. It is probably not running.</code></p>
<p>è€Œå…¶ä»–ä¸€ä¸ªèŠ‚ç‚¹å´æ˜¯ç°å®æ­£å¸¸;</p>
<p>å…ˆ<code>stop</code> æ‰åŸ<code>zk</code></p>
<p><code>./bin/zkServer.sh stop</code></p>
<p>ç„¶åä»¥start-foregroundæ–¹å¼å¯åŠ¨ï¼Œä¼šçœ‹åˆ°å¯åŠ¨æ—¥å¿—</p>
<p><code>./bin/zkServer.sh start</code></p>
<p>å½“å‡ºç°é—®é¢˜çš„æ—¶å€™ï¼Œè®°å¾—æŸ¥çœ‹æ—¥å¿—zookeeper.outï¼Œåœ¨ä½ é…ç½®çš„dataDirï¼ˆåœ¨conf/zoo.cfgä¸­æŸ¥çœ‹ï¼‰ç›®å½•ä¸‹ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">2015-12-29 11:09:38,034 [myid:1] - WARN  [WorkerSender[myid=1]:QuorumCnxManager@400] - Cannot open channel to 3 at election address Node2/10.0.0.102:38888</div><div class="line">java.net.ConnectException: æ‹’ç»è¿æ¥</div><div class="line">        at java.net.PlainSocketImpl.socketConnect(Native Method)</div><div class="line">        at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:339)</div><div class="line">        at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:200)</div><div class="line">        at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:182)</div><div class="line">        at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392)</div><div class="line">        at java.net.Socket.connect(Socket.java:579)</div><div class="line">        at org.apache.zookeeper.server.quorum.QuorumCnxManager.connectOne(QuorumCnxManager.java:381)</div><div class="line">        at org.apache.zookeeper.server.quorum.QuorumCnxManager.toSend(QuorumCnxManager.java:354)</div><div class="line">        at org.apache.zookeeper.server.quorum.FastLeaderElection<span class="variable">$Messenger</span><span class="variable">$WorkerSender</span>.process(FastLeaderElection.java:452)</div><div class="line">        at org.apache.zookeeper.server.quorum.FastLeaderElection<span class="variable">$Messenger</span><span class="variable">$WorkerSender</span>.run(FastLeaderElection.java:433)</div><div class="line">        at java.lang.Thread.run(Thread.java:745)</div></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°æ˜¯è¿æ¥åˆ°Node2çš„3888ç«¯å£ä¸é€šï¼ˆæˆ‘é…ç½®æ–‡ä»¶è®¾ç½®çš„èŠ‚ç‚¹ç«¯å£ï¼Œserver.3=Node2:2888:3888ï¼‰ï¼Œè¿™æ ·å°±æ‰¾åˆ°é—®é¢˜äº†ï¼Œæ‰€ä»¥å½“é‡åˆ°é—®é¢˜çš„æ—¶å€™è®°å¾—æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ï¼Œè¿™æ‰æ˜¯æœ€æœ‰å¸®åŠ©çš„ï¼Œè€Œä¸æ˜¯ä¿®æ”¹ä»€ä¹ˆncå‚æ•°ã€‚</p>
<p>è¿™é‡Œä¸»è¦çœ‹ä¸‹æ˜¯å¦åŠ å…¥hosts</p>
<p>æŸ¥çœ‹Node2èŠ‚ç‚¹å‘ç°ï¼Œ38888ç«¯å£ç»‘å¸¦åˆ°127.0.0.1ä¸Šäº†ï¼Œè¿™è®©MasterèŠ‚ç‚¹æ€ä¹ˆè¿æ¥å‘€ï¼Œåªéœ€ä¿®æ”¹/etc/hostsæ–‡ä»¶å³å¯ï¼ŒåŒç†ï¼Œä¿®æ”¹Node1ï¼Œç„¶åé‡å¯zookeeperï¼Œå‘ç°é—®é¢˜è§£å†³ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">127.0.0.1 localhost  namenode</div><div class="line">::1        localhost localhost.localdomain localhost6 localhost6.localdomain6</div><div class="line">10.47.100.90 salt</div><div class="line">10.46.72.172  namenode</div><div class="line">10.47.88.103 datenode1</div><div class="line">10.47.88.206 datenode2</div><div class="line">10.47.102.137 datenode3</div></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘<code>127.0.0.1 localhost namenode</code> å°±å¯ä»¥äº†ã€‚</p>
<h3 id="Step8-å¦‚ä½•æ‰©å®¹zookeeperï¼Ÿ"><a href="#Step8-å¦‚ä½•æ‰©å®¹zookeeperï¼Ÿ" class="headerlink" title="Step8: å¦‚ä½•æ‰©å®¹zookeeperï¼Ÿ"></a>Step8: å¦‚ä½•æ‰©å®¹zookeeperï¼Ÿ</h3><p>åªéœ€è¦å°†å·²æœ‰çš„zookeeperæ‰“åŒ…å¤åˆ¶åˆ°æ–°çš„æœºå™¨ä¸Šï¼Œç„¶åä¿®æ”¹myidæ–‡ä»¶å¹¶è®¾ç½®å¥½ï¼Œç„¶åå¯åŠ¨zookeeperå³å¯ã€‚</p>
<hr>
<h3 id="è®¾ç½®å¼€æœºè‡ªåŠ¨å¯åŠ¨"><a href="#è®¾ç½®å¼€æœºè‡ªåŠ¨å¯åŠ¨" class="headerlink" title="è®¾ç½®å¼€æœºè‡ªåŠ¨å¯åŠ¨"></a>è®¾ç½®å¼€æœºè‡ªåŠ¨å¯åŠ¨</h3><p>1.å†™ä¸ªå¯åŠ¨è„šæœ¬æ”¾åˆ°/etc/rc.d/init.d/zookeeper</p>
<p>è¿™é‡Œtouch zookeeper &amp;&amp; chmod +x zookeeper &amp;&amp; vim zookeeper</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">!/bin/bash</div><div class="line"><span class="comment">#chkconfig:2345 20 90</span></div><div class="line"><span class="comment">#description:zookeeper</span></div><div class="line"><span class="comment">#processname:zookeeper</span></div><div class="line"><span class="built_in">export</span> JAVA_HOME=/srv/jdk1.8.0_66</div><div class="line"><span class="built_in">export</span> PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$PATH</span></div><div class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></div><div class="line">    start) su root /srv/zookeeper-3.3.6/bin/zkServer.sh start;;</div><div class="line">    stop) su root /srv/zookeeper-3.3.6/bin/zkServer.sh stop;;</div><div class="line">    status) su root /srv/zookeeper-3.3.6/bin/zkServer.sh status;;</div><div class="line">    restart) su root /srv/zookeeper-3.3.6/bin/zkServer.shrestart;;</div><div class="line">    *)  <span class="built_in">echo</span> <span class="string">"requirestart|stop|status|restart"</span>;;</div><div class="line"><span class="keyword">esac</span></div></pre></td></tr></table></figure>
<p>2.è®¾ç½®å¼€æœºå¯åŠ¨</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">chkconfig zookeeper on</div></pre></td></tr></table></figure>
<p>3.éªŒè¯</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">chkconfig --add zookeeper</div><div class="line">chkconfig --list zookeeper</div></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥ç”¨service zookeeper start/stopæ¥å¯åŠ¨åœæ­¢zookeeperæœåŠ¡äº†.<br>ä½¿ç”¨<code>chkconfig--add zookeeper</code>å‘½ä»¤æŠŠ<code>zookeeper</code>æ·»åŠ åˆ°å¼€æœºå¯åŠ¨é‡Œé¢<br>æ·»åŠ å®Œæˆä¹‹åæ¥è¿™ä¸ªä½¿ç”¨<code>chkconfig--list</code>æ¥çœ‹çœ‹æˆ‘ä»¬æ·»åŠ çš„<code>zookeeper</code>æ˜¯å¦åœ¨é‡Œé¢<br>å¦‚æœä¸Šé¢çš„æ“ä½œéƒ½æ­£å¸¸çš„è¯ï¼›é‡å¯æœåŠ¡å™¨æµ‹è¯•å°±è¡Œã€‚</p>
<div class="tip"><br><br>æ³¨æ„ï¼šzookeeperé‡å¯å‡ºç°å‡ ç§æŠ¥é”™ï¼š<br><br>1. å¯åŠ¨æœåŠ¡æŠ¥é”™æ‰¾ä¸åˆ°æŒ‡å®šå¥½çš„pidæ–‡ä»¶ã€‚<br>2. å…³é—­æœåŠ¡æŠ¥é”™æ²¡æœ‰åœ¨/tmp/è·¯å¾„ä¸‹é¢æ²¡æœ‰/srv/zookeeper-3.3.6/zookeeper/data/zookeeper_server.pid<br></div>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">[root@zookeeper zookeeper-3.3.6]<span class="comment"># ./bin/zkServer.sh start</span></div><div class="line">JMX enabled by default</div><div class="line">Using config: /srv/zookeeper-3.3.6/bin/../conf/zoo.cfg</div><div class="line">Starting zookeeper ... ./bin/zkServer.sh: line 93: [: /tmp/zookeeper: binary operator expected</div><div class="line">./bin/zkServer.sh: line 103: /tmp/zookeeper</div><div class="line">/srv/zookeeper-3.3.6/zookeeper/data/zookeeper_server.pid: æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•</div><div class="line">FAILED TO WRITE PID</div><div class="line">[root@zookeeper zookeeper-3.3.6]<span class="comment"># ./bin/zkServer.sh stop</span></div><div class="line">JMX enabled by default</div><div class="line">Using config: /srv/zookeeper-3.3.6/bin/../conf/zoo.cfg</div><div class="line">Stopping zookeeper ... no zookeeper to stop (could not find file /tmp/zookeeper</div><div class="line">/srv/zookeeper-3.3.6/zookeeper/data/zookeeper_server.pid)</div></pre></td></tr></table></figure>
<p>è§£å†³æ–¹æ³•ï¼šç½‘ä¸Šå¾ˆå°‘æœ‰äººè®²è¿™ä¹ˆè¯¦ç»†ï¼Œè¿™é‡Œæˆ‘å°±è¯´ä¸‹ï¼Œå°±æ˜¯ä½ åœ¨ä¿®æ”¹zoo.cfgé…ç½®æ–‡ä»¶é‡Œé¢ï¼š</p>
<p>dataDiræŒ‡å®šçš„è·¯å¾„æ˜¯è‡ªå®šä¹‰çš„è¯ç­‰äºçš„æ—¶å€™ä¸è¦ç©ºæ ¼å†™ã€‚</p>
<p>å¦‚æœé‡æ–°å¦å¤–å†™dataDir ,ä¸è¦æ³¨é‡Šæ‰ä¹‹å‰çš„ï¼Œæœ€å¥½ç›´æ¥åˆ é™¤ï¼Œé‡æ–°æŒ‡å®šè¿™æ ·å°±ä¸ä¼šæŠ¥é”™äº†ï¼Œå¦‚æœæ³¨é‡Šæ‰é»˜è®¤çš„<code>#dataDir = /tmp</code>è¿™é‡Œéœ€è¦ç©ºæ ¼ã€‚</p>
<h3 id="æŠ¥é”™-å ç”¨ç«¯å£ï¼š"><a href="#æŠ¥é”™-å ç”¨ç«¯å£ï¼š" class="headerlink" title="æŠ¥é”™ å ç”¨ç«¯å£ï¼š"></a>æŠ¥é”™ å ç”¨ç«¯å£ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">JMX enabled by default</div><div class="line">Using config: /opt/app/zookeeper/bin/../conf/zoo3.cfg</div><div class="line">Starting zookeeper ... STARTED</div></pre></td></tr></table></figure>
<p>æŸ¥çœ‹çŠ¶æ€ï¼š<br>ç”¨jpså‘½ä»¤æŸ¥çœ‹è¿›ç¨‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># jps</span></div><div class="line">24617 QuorumPeerMain ï¼ˆè¿™ä¸ªå°±æ˜¯zookeeperè¿›ç¨‹ï¼‰</div><div class="line"></div><div class="line">/opt/app/zookeeper/bin/zkServer.sh status zoo1.cfg</div><div class="line">JMX enabled by default</div><div class="line">Using config: /opt/app/zookeeper/bin/../conf/zoo1.cfg</div><div class="line">Error contacting service. It is probably not running.</div></pre></td></tr></table></figure>
<p>Ihaozhuo_b3314<br>è¯´æ˜æœ‰é”™è¯¯ï¼ŒæŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># cd &lt;zookeeper_home&gt;</span></div><div class="line"><span class="comment"># less zookeeper.out</span></div><div class="line">java.net.BindException: åœ°å€å·²åœ¨ä½¿ç”¨</div><div class="line">æ€æ‰å½“å‰è¿›ç¨‹ï¼š</div><div class="line"><span class="comment"># kill -9 24617</span></div></pre></td></tr></table></figure>
<h3 id="æŠ¥é”™-å¯åŠ¨æœåŠ¡æ­£å¸¸ã€‚"><a href="#æŠ¥é”™-å¯åŠ¨æœåŠ¡æ­£å¸¸ã€‚" class="headerlink" title="æŠ¥é”™: å¯åŠ¨æœåŠ¡æ­£å¸¸ã€‚"></a>æŠ¥é”™: å¯åŠ¨æœåŠ¡æ­£å¸¸ã€‚</h3><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@api1 zookeeper<span class="number">-3.3</span><span class="number">.6</span>]<span class="comment"># ./bin/zkServer.sh start</span></div><div class="line">JMX enabled <span class="keyword">by</span> <span class="keyword">default</span></div><div class="line">Using config: <span class="regexp">/srv/zookeeper-3.3.6/bin/</span>../conf/zoo.cfg</div><div class="line">Starting zookeeper ... STARTED</div></pre></td></tr></table></figure>
<p>å¯æ˜¯æŸ¥è¯¢è¿›ç¨‹ä¸å­˜åœ¨ï¼Œå¯æ˜¯çœ‹pidæ˜¯æœ‰çš„ï¼Œç„¶åå…³é—­æœåŠ¡å°±è¯´æ²¡æœ‰è¿™ä¸ªè¿›ç¨‹ã€‚</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">JMX enabled by <span class="keyword">default</span></div><div class="line">Using <span class="string">config:</span> <span class="regexp">/srv/</span>zookeeper<span class="number">-3.3</span><span class="number">.6</span><span class="regexp">/bin/</span>..<span class="regexp">/conf/</span>zoo.cfg</div><div class="line">Stopping zookeeper ... ./zkServer.<span class="string">sh:</span> line <span class="number">133</span>: <span class="string">kill:</span> (<span class="number">31415</span>) - æ²¡æœ‰é‚£ä¸ªè¿›ç¨‹</div></pre></td></tr></table></figure>
<h3 id="èµ°kafkaæŸ¥çœ‹æ˜¯å¦æ‰€æœ‰èŠ‚ç‚¹éƒ½å¯åŠ¨ï¼š"><a href="#èµ°kafkaæŸ¥çœ‹æ˜¯å¦æ‰€æœ‰èŠ‚ç‚¹éƒ½å¯åŠ¨ï¼š" class="headerlink" title="èµ°kafkaæŸ¥çœ‹æ˜¯å¦æ‰€æœ‰èŠ‚ç‚¹éƒ½å¯åŠ¨ï¼š"></a>èµ°kafkaæŸ¥çœ‹æ˜¯å¦æ‰€æœ‰èŠ‚ç‚¹éƒ½å¯åŠ¨ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">[root@kafka_03 bin]<span class="comment"># sh zkCli.sh</span></div><div class="line">Connecting to localhost:2181</div><div class="line">2017-01-04 19:20:24,849 [myid:] - INFO  [main:Environment@100] - Client environment:zookeeper.version=3.4.6-1569965, built on 02/20/2014 09:09 GMT</div><div class="line">2017-01-04 19:20:24,853 [myid:] - INFO  [main:Environment@100] - Client environment:host.name=kafka_03</div><div class="line">2017-01-04 19:20:24,853 [myid:] - INFO  [main:Environment@100] - Client environment:java.version=1.8.0_66</div><div class="line">2017-01-04 19:20:24,856 [myid:] - INFO  [main:Environment@100] - Client environment:java.vendor=Oracle Corporation</div><div class="line">2017-01-04 19:20:24,856 [myid:] - INFO  [main:Environment@100] - Client environment:java.home=/srv/jdk1.8.0_66/jre</div><div class="line">2017-01-04 19:20:24,856 [myid:] - INFO  [main:Environment@100] - Client environment:java.class.path=/srv/zookeeper-3.4.6/bin/../build/classes:/srv/zookeeper-3.4.6/bin/../build/lib/*.jar:/srv/zookeeper-3.4.6/bin/../lib/slf4j-log4j12-1.6.1.jar:/srv/zookeeper-3.4.6/bin/../lib/slf4j-api-1.6.1.jar:/srv/zookeeper-3.4.6/bin/../lib/netty-3.7.0.Final.jar:/srv/zookeeper-3.4.6/bin/../lib/<span class="built_in">log</span>4j-1.2.16.jar:/srv/zookeeper-3.4.6/bin/../lib/jline-0.9.94.jar:/srv/zookeeper-3.4.6/bin/../zookeeper-3.4.6.jar:/srv/zookeeper-3.4.6/bin/../src/java/lib/*.jar:/srv/zookeeper-3.4.6/bin/../conf:</div><div class="line">2017-01-04 19:20:24,856 [myid:] - INFO  [main:Environment@100] - Client environment:java.library.path=/usr/java/packages/lib/amd64:/usr/lib64:/lib64:/lib:/usr/lib</div><div class="line"></div><div class="line">[zk: localhost:2181(CONNECTED) 0] ls /</div><div class="line">[controller_epoch, brokers, zookeeper, kafka, dubbo, admin, isr_change_notification, consumers, config, sthp]</div><div class="line">[zk: localhost:2181(CONNECTED) 5] ls /kafka/brokers/ids</div><div class="line">[0, 1, 2]</div><div class="line"></div><div class="line">æ˜¾ç¤º0 1 2 ä¸‰å°é›†ç¾¤æœºå™¨ã€‚</div></pre></td></tr></table></figure>
<p>kafka ä¸‰å°é›†ç¾¤è¿™é‡Œå¯ä»¥çœ‹åˆ°è·å–åˆ°idsã€‚</p>
<h3 id="Step9-ç›¸å…³æ–‡æ¡£"><a href="#Step9-ç›¸å…³æ–‡æ¡£" class="headerlink" title="Step9: ç›¸å…³æ–‡æ¡£"></a>Step9: ç›¸å…³æ–‡æ¡£</h3><p>ã€ŠHBase-0.98.0åˆ†å¸ƒå¼å®‰è£…æŒ‡å—ã€‹</p>
<p>ã€ŠHive 0.12.0å®‰è£…æŒ‡å—ã€‹</p>
<p>ã€ŠZooKeeper-3.4.6åˆ†å¸ƒå¼å®‰è£…æŒ‡å—ã€‹</p>
<p>ã€ŠHadoop 2.3.0æºç åå‘å·¥ç¨‹ã€‹</p>
<p>ã€Šåœ¨Linuxä¸Šç¼–è¯‘Hadoop-2.4.0ã€‹</p>
<p>ã€ŠAccumulo-1.5.1å®‰è£…æŒ‡å—ã€‹</p>
<p>ã€ŠDrill 1.0.0å®‰è£…æŒ‡å—ã€‹</p>
<p>ã€ŠShark 0.9.1å®‰è£…æŒ‡å—ã€‹</p>
<p>æ›´å¤šï¼Œæ•¬è¯·å…³æ³¨æŠ€æœ¯åšå®¢ï¼š<a href="http://blog.yancy.cc">http://blog.yancy.cc</a></p>
<h3 id="Step10-ç»“æŸè¯­"><a href="#Step10-ç»“æŸè¯­" class="headerlink" title="Step10:  ç»“æŸè¯­"></a>Step10:  ç»“æŸè¯­</h3><p>è‡³æ­¤ï¼ŒZooKeeperåˆ†å¸ƒå¼å®‰è£…å¤§å‘ŠæˆåŠŸï¼æ›´å¤šç»†èŠ‚ï¼Œè¯·æµè§ˆ<a href="http://zookeeper.apache.org/doc/trunk/zookeeperStarted.html" target="_blank" rel="external">å®˜æ–¹æ–‡æ¡£</a></p>

	

	

</article>




	<article>
	
		<h1><a href="/2017/05/08/Bigdata-hadoop/HORTONW0RKSæ•°æ®å¹³å°å®ç°æ­å»ºAmbarié…ç½®å’Œéƒ¨ç½²HDPé›†ç¾¤ç›‘æ§Hadoopé›†ç¾¤ /">HORTONW0RKSæ•°æ®å¹³å°å®ç°æ­å»ºAmbarié…ç½®å’Œéƒ¨ç½²HDPé›†ç¾¤ç›‘æ§Hadoopé›†ç¾¤</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2017-05-08</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/å¤§æ•°æ®/">å¤§æ•°æ®</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Ambari/">Ambari</a> <a class="article__tag-link" href="/tags/Big-data-Hadoop/">Big data Hadoop</a>
			</span>
		
	</div>

	

	
		<h2 id="HORTONW0RKSæ•°æ®å¹³å°æ­å»ºAmbariç®¡ç†ç›‘æ§Hadoopé›†ç¾¤"><a href="#HORTONW0RKSæ•°æ®å¹³å°æ­å»ºAmbariç®¡ç†ç›‘æ§Hadoopé›†ç¾¤" class="headerlink" title="HORTONW0RKSæ•°æ®å¹³å°æ­å»ºAmbariç®¡ç†ç›‘æ§Hadoopé›†ç¾¤"></a>HORTONW0RKSæ•°æ®å¹³å°æ­å»ºAmbariç®¡ç†ç›‘æ§Hadoopé›†ç¾¤</h2><p><strong> é¢˜å¤–è¯ </strong></p>
<p>æˆ‘ç°åœ¨åœ¨ä¸€å®¶ä¸Šå¸‚å…¬å¸æ——ä¸‹æ§è‚¡å­å…¬å¸è´Ÿè´£è¿ç»´éƒ¨é—¨ï¼Œè´Ÿè´£ITç½‘ç»œå®‰å…¨åŠå…¬ï¼šä¸»è¦åšçš„åº”ç”¨è¿ç»´å’Œç½‘ç»œè¿ç»´ï¼Œå…¼å¤§æ•°æ®è¿ç»´ã€‚<br>æœ€è¿‘è·Ÿæ–°æ¥çš„æ¶æ„å¸ˆèŠäº†ä¸‹Hadoopç›‘æ§æ–¹é¢ï¼šHORTONW0RKSæ•°æ®å¹³å°æ­å»ºAmbariç›‘æ§Hadoopé›†ç¾¤.</p>
<p><strong>HORTONW0RKSæ•°æ®å¹³å°ï¼ˆHDP Â®ï¼‰</strong><br>HDPæ˜¯ä¸šå†…å”¯ä¸€çœŸæ­£å®‰å…¨çš„ä¼ä¸šçº§å¼€æºçš„<code>Apacheçš„Hadoopâ„¢ Â®</code>åˆ†é…åŸºäºé›†ä¸­å¼æ¶æ„ã€‚HDPè§£å†³äº†é™æ€æ•°æ®çš„å®Œæ•´éœ€æ±‚ï¼Œä¸ºå®æ—¶å®¢æˆ·åº”ç”¨æä¾›æ”¯æŒï¼Œå¹¶æä¾›å¯åŠ é€Ÿå†³ç­–å’Œåˆ›æ–°çš„å¯é åˆ†æã€‚</p>
<p>ä½¿ç”¨Hortonworks Sandboxè¯•ç”¨æœ€æ–°çš„HDPåŠŸèƒ½ï¼Œæˆ–è€…ä¸ºç”Ÿäº§ç¯å¢ƒè®¾ç½®HDPï¼Œå®‰è£…å’Œé…ç½®ç¾¤é›†ã€‚<br>æŸ¥çœ‹å®˜ç½‘æ–‡æ¡£ï¼š<a href="https://hortonworks.com/downloads/#data-platform" target="_blank" rel="external">HORTONWORKS CONNECTED DATA PLATFORMS DOWNLOADS</a></p>
<h3 id="1-å°†AmbariæœåŠ¡å­˜å‚¨åº“æ–‡ä»¶ä¸‹è½½åˆ°å®‰è£…ä¸»æœºä¸Šçš„ç›®å½•ã€‚"><a href="#1-å°†AmbariæœåŠ¡å­˜å‚¨åº“æ–‡ä»¶ä¸‹è½½åˆ°å®‰è£…ä¸»æœºä¸Šçš„ç›®å½•ã€‚" class="headerlink" title="1. å°†AmbariæœåŠ¡å­˜å‚¨åº“æ–‡ä»¶ä¸‹è½½åˆ°å®‰è£…ä¸»æœºä¸Šçš„ç›®å½•ã€‚"></a>1. å°†AmbariæœåŠ¡å­˜å‚¨åº“æ–‡ä»¶ä¸‹è½½åˆ°å®‰è£…ä¸»æœºä¸Šçš„ç›®å½•ã€‚</h3><ul>
<li>Centos6.5 </li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wget -nv http://public-repo-1.hortonworks.com/ambari/centos6/2.x/updates/2.4.2.0/ambari.repo -O /etc/yum.repos.d/ambari.repo</div></pre></td></tr></table></figure>
<p>âš ï¸è­¦å‘Šï¼šä¸è¦ä¿®æ”¹<code>ambari.repo</code>æ–‡ä»¶åã€‚åœ¨ä»£ç†æ³¨å†ŒæœŸé—´ï¼Œæ­¤æ–‡ä»¶åº”åœ¨AmbariæœåŠ¡å™¨ä¸»æœºä¸Šå¯ç”¨ã€‚</p>
<ol>
<li>é€šè¿‡æ£€æŸ¥repoåˆ—è¡¨ç¡®è®¤å­˜å‚¨åº“å·²é…ç½®ã€‚</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum repolist</div></pre></td></tr></table></figure>
<p>æ‚¨åº”è¯¥åœ¨åˆ—è¡¨ä¸­çœ‹åˆ°ç±»ä¼¼äºä»¥ä¸‹Ambariå­˜å‚¨åº“çš„å€¼ã€‚</p>
<p>ç‰ˆæœ¬å€¼å› å®‰è£…è€Œå¼‚ã€‚</p>
<ol>
<li>å®‰è£…AmbariæœåŠ¡ã€‚è¿™ä¹Ÿå®‰è£…äº†é»˜è®¤çš„PostgreSQL Ambariæ•°æ®åº“ã€‚</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install ambari-server</div></pre></td></tr></table></figure>
<p>è¾“å…¥<code>y</code>æç¤ºï¼Œä»¥ç¡®è®¤äº¤æ˜“å’Œä¾èµ–æ€§æ£€æŸ¥æ—¶ã€‚</p>
<p>æˆåŠŸå®‰è£…å°†æ˜¾ç¤ºç±»ä¼¼äºä»¥ä¸‹å†…å®¹çš„è¾“å‡ºï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">å®‰è£…ï¼špostgresql-libs-8.4.20-3.el6_6.x86_64 1/4</div><div class="line">å®‰è£…ï¼špostgresql-8.4.20-3.el6_6.x86_64 2/4</div><div class="line">å®‰è£…ï¼špostgresql-server-8.4.20-3.el6_6.x86_64 3/4</div><div class="line">å®‰è£…ï¼šambari-server-2.4.2.0-1470.x86_64 4/4</div><div class="line">éªŒè¯ï¼šambari-server-2.4.2.0-1470.x86_64 1/4</div><div class="line">éªŒè¯ï¼špostgresql-8.4.20-3.el6_6.x86_64 2/4</div><div class="line">éªŒè¯ï¼špostgresql-server-8.4.20-3.el6_6.x86_64 3/4</div><div class="line">éªŒè¯ï¼špostgresql-libs-8.4.20-3.el6_6.x86_64 4/4</div><div class="line"></div><div class="line">å®‰è£…ï¼š</div><div class="line">  ambari-server.x86_64 0ï¼š2.4.2.0-1470  å®‰è£…è¿™é‡Œçš„æ—¶å€™ä¼šæœ‰ç‚¹æ…¢ï¼Œå› ä¸ºæ˜¯è®¿é—®å›½å¤–ç½‘ç«™ä¸‹è½½èµ„æºã€‚</div><div class="line"></div><div class="line">å·²å®‰è£…ä¾èµ–å…³ç³»ï¼š</div><div class="line"> postgresql.x86_64 0ï¼š8.4.20-3.el6_6           </div><div class="line"> postgresql-libs.x86_64 0ï¼š8.4.20-3.el6_6        </div><div class="line"> postgresql-server.x86_64 0ï¼š8.4.20-3.el6_6</div></pre></td></tr></table></figure>
<p>â—ï¸â—ï¸ã€æ³¨æ„ã€‘</p>
<p>æ¥å—æœ‰å…³ä¿¡ä»»<code>Hortonworks GPG</code>å¯†é’¥çš„è­¦å‘Šã€‚è¯¥é”®å°†è‡ªåŠ¨ä¸‹è½½å¹¶ç”¨äºéªŒè¯Hortonworksçš„è½¯â€‹â€‹ä»¶åŒ…ã€‚æ‚¨å°†çœ‹åˆ°ä»¥ä¸‹æ¶ˆæ¯ï¼š</p>
<p>Importing GPG key 0x07513CAD: Userid: â€œJenkins (HDP Builds) <a href="&#x6d;&#97;&#105;&#x6c;&#116;&#111;&#58;&#106;&#101;&#110;&#107;&#x69;&#x6e;&#x40;&#104;&#111;&#114;&#116;&#x6f;&#110;&#119;&#111;&#114;&#x6b;&#115;&#46;&#99;&#111;&#109;">&#106;&#101;&#110;&#107;&#x69;&#x6e;&#x40;&#104;&#111;&#114;&#116;&#x6f;&#110;&#119;&#111;&#114;&#x6b;&#115;&#46;&#99;&#111;&#109;</a>â€œ From :<code>http://s3.amazonaws.com/dev.hortonworks.com/ambari/centos6/RPM-GPG-KEY/RPM-GPG-KEY-Jenkins</code></p>
<p>â—ï¸â—ï¸ã€æ³¨æ„ã€‘</p>
<p>åœ¨å…·æœ‰æœ‰é™Internetè®¿é—®æˆ–æ²¡æœ‰Internetè®¿é—®çš„ç¾¤é›†ä¸Šéƒ¨ç½²HDPæ—¶ï¼Œåº”ä½¿ç”¨å…¶ä»–æ–¹æ³•æä¾›å¯¹ä½çš„è®¿é—®ã€‚<br>æœ‰å…³è®¾ç½®æœ¬åœ°å­˜å‚¨åº“çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…ä½¿ç”¨æœ¬åœ°å­˜å‚¨åº“ã€‚</p>
<p><code>Ambari</code>æœåŠ¡å™¨é»˜è®¤ä½¿ç”¨åµŒå…¥å¼<code>PostgreSQL</code>æ•°æ®åº“ã€‚å½“æ‚¨å®‰è£…<code>Ambari</code>æœåŠ¡å™¨æ—¶ï¼ŒPostgreSQLè½¯ä»¶åŒ…å’Œä¾èµ–å…³ç³»å¿…é¡»å¯ç”¨äºå®‰è£…ã€‚è¿™äº›åŒ…é€šå¸¸ä½œä¸ºæ“ä½œç³»ç»Ÿå­˜å‚¨åº“çš„ä¸€éƒ¨åˆ†æä¾›ã€‚è¯·ç¡®è®¤æ‚¨å…·æœ‰é€‚ç”¨äº<code>postgresql-server</code>è½¯ä»¶åŒ…çš„ç›¸åº”å­˜å‚¨åº“ã€‚</p>
<h3 id="2-è®¾ç½®AmbariæœåŠ¡å™¨"><a href="#2-è®¾ç½®AmbariæœåŠ¡å™¨" class="headerlink" title="2.è®¾ç½®AmbariæœåŠ¡å™¨"></a>2.è®¾ç½®AmbariæœåŠ¡å™¨</h3><p>åœ¨å¯åŠ¨<code>Ambari</code>æœåŠ¡å™¨ä¹‹å‰ï¼Œå¿…é¡»è®¾ç½®AmbariæœåŠ¡å™¨ã€‚å®‰è£…ç¨‹åºå°†Ambarié…ç½®ä¸ºä¸Ambariæ•°æ®åº“é€šä¿¡ï¼Œå®‰è£…JDKå¹¶å…è®¸æ‚¨è‡ªå®šä¹‰Ambari Serverå®ˆæŠ¤ç¨‹åºå°†ä½œä¸ºè¿è¡Œçš„ç”¨æˆ·å¸æˆ·ã€‚è¯¥ <code>ambari-server setup</code>å‘½ä»¤ç®¡ç†è®¾ç½®è¿‡ç¨‹ã€‚åœ¨AmbariæœåŠ¡å™¨ä¸»æœºä¸Šè¿è¡Œä»¥ä¸‹å‘½ä»¤ä»¥å¼€å§‹è®¾ç½®è¿‡ç¨‹ã€‚æ‚¨è¿˜å¯ä»¥å°†â€œ è®¾ç½®é€‰é¡¹â€é™„åŠ åˆ°å‘½ä»¤ã€‚</p>
<ul>
<li>å¯åŠ¨æœåŠ¡</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line">ambari-server setup</div><div class="line"></div><div class="line"><span class="comment">###è¿™é‡Œç”±äºä¸‹è½½jdk1.8å¤ªæ…¢é€Ÿåº¦è¿‡æ…¢ã€‚æˆ‘æå‰æŠŠjdkä¸‹è½½ä¸‹æ¥æ”¾åˆ°äº†/srv/jdk1.8.0_66 ç›®å½•</span></div><div class="line"></div><div class="line">[root@ambari-server_01 ~]<span class="comment"># ambari-server setup</span></div><div class="line">Using python  /usr/bin/python</div><div class="line">Setup ambari-server</div><div class="line">Checking SELinux...</div><div class="line">SELinux status is <span class="string">'enabled'</span></div><div class="line">SELinux mode is <span class="string">'permissive'</span></div><div class="line">WARNING: SELinux is <span class="built_in">set</span> to <span class="string">'permissive'</span> mode and temporarily disabled.</div><div class="line">OK to <span class="built_in">continue</span> [y/n] (y)? y</div><div class="line">Customize user account <span class="keyword">for</span> ambari-server daemon [y/n] (n)? y</div><div class="line">Enter user account <span class="keyword">for</span> ambari-server daemon (root):</div><div class="line">Adjusting ambari-server permissions and ownership...</div><div class="line">Checking firewall status...</div><div class="line">Checking JDK...</div><div class="line">[1] Oracle JDK 1.8 + Java Cryptography Extension (JCE) Policy Files 8</div><div class="line">[2] Oracle JDK 1.7 + Java Cryptography Extension (JCE) Policy Files 7</div><div class="line">[3] Custom JDK</div><div class="line">==============================================================================</div><div class="line">Enter choice (1): 3</div><div class="line">WARNING: JDK must be installed on all hosts and JAVA_HOME must be valid on all hosts.</div><div class="line">WARNING: JCE Policy files are required <span class="keyword">for</span> configuring Kerberos security. If you plan to use Kerberos,please make sure JCE Unlimited Strength Jurisdiction Policy Files are valid on all hosts.</div><div class="line">Path to JAVA_HOME: /srv/jdk1.8.0_66</div><div class="line">Validating JDK on Ambari Server...done.</div><div class="line">Completing setup...</div><div class="line">Configuring database...</div><div class="line">Enter advanced database configuration [y/n] (n)? y</div><div class="line">Configuring database...</div><div class="line">==============================================================================</div><div class="line">Choose one of the following options:</div><div class="line">[1] - PostgreSQL (Embedded)</div><div class="line">[2] - Oracle</div><div class="line">[3] - MySQL / MariaDB</div><div class="line">[4] - PostgreSQL</div><div class="line">[5] - Microsoft SQL Server (Tech Preview)</div><div class="line">[6] - SQL Anywhere</div><div class="line">[7] - BDB</div><div class="line">==============================================================================</div><div class="line">Enter choice (1):3</div><div class="line">Database name (ambari):</div><div class="line">Postgres schema (ambari):</div><div class="line">Username (ambari):</div><div class="line">Enter Database Password (bigdata):</div><div class="line">Default properties detected. Using built-in database.</div><div class="line">Configuring ambari database...</div><div class="line">Checking PostgreSQL...</div><div class="line">Running initdb: This may take up to a minute.</div><div class="line">æ­£åœ¨åˆå§‹åŒ–æ•°æ®åº“ï¼š[ç¡®å®š]</div><div class="line"></div><div class="line">About to start PostgreSQL</div><div class="line">Configuring <span class="built_in">local</span> database...</div><div class="line">Connecting to <span class="built_in">local</span> database...done.</div><div class="line">Configuring PostgreSQL...</div><div class="line">Restarting PostgreSQL</div><div class="line">Extracting system views...</div><div class="line">ambari-admin-2.4.2.0.136.jar</div><div class="line">............</div><div class="line">Adjusting ambari-server permissions and ownership...</div><div class="line">Ambari Server <span class="string">'setup'</span> completed successfully.</div><div class="line">You have mail <span class="keyword">in</span> /var/spool/mail/root</div></pre></td></tr></table></figure>
<h5 id="2-1-å“åº”å®‰è£…æç¤ºï¼š"><a href="#2-1-å“åº”å®‰è£…æç¤ºï¼š" class="headerlink" title="2.1 å“åº”å®‰è£…æç¤ºï¼š"></a>2.1 å“åº”å®‰è£…æç¤ºï¼š</h5><p>å¦‚æœæ‚¨æ²¡æœ‰æš‚æ—¶ç¦ç”¨<code>SELinux</code>ï¼Œæ‚¨å¯èƒ½ä¼šæ”¶åˆ°è­¦å‘Šã€‚æ¥å—é»˜è®¤å€¼<code>ï¼ˆyï¼‰</code>ï¼Œç„¶åç»§ç»­ã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒAmbariæœåŠ¡å™¨è¿è¡Œåœ¨<code>root</code>ã€‚åœ¨<code>Customize user account for ambari-server daemon</code>æç¤ºç¬¦å¤„æ¥å—é»˜è®¤<code>ï¼ˆnï¼‰</code>ï¼Œä»¥ç»§ç»­rootã€‚</p>
<p>å¦‚æœè¦åˆ›å»ºå…¶ä»–ç”¨æˆ·ä»¥è¿è¡Œ<code>Ambari</code>æœåŠ¡å™¨æˆ–åˆ†é…ä»¥å‰åˆ›å»ºçš„ç”¨æˆ·ï¼Œè¯·<code>y</code>åœ¨ <code>Customize user account for ambari-server daemon</code>æç¤ºç¬¦å¤„é€‰æ‹©ï¼Œç„¶åæä¾›ç”¨æˆ·åã€‚<br>æœ‰å…³ä»¥érootç”¨æˆ·èº«ä»½è¿è¡ŒAmbariæœåŠ¡å™¨çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…Hortonworksæ•°æ®å¹³å°Apache Ambariå‚è€ƒ&gt; <a href="http://docs.hortonworks.com/HDPDocuments/Ambari-2.4.2.0/bk_ambari-security/content/configuring_ambari_for_non-root.html" target="_blank" rel="external">ä¸ºéæ ¹ç”¨æˆ·é…ç½®Ambari</a></p>
<p>å¦‚æœæ‚¨æ²¡æœ‰æš‚æ—¶åœç”¨<code>iptables</code>ï¼Œå¯èƒ½ä¼šæ”¶åˆ°è­¦å‘Šã€‚è¾“å…¥<code>y</code>ä»¥ç»§ç»­ã€‚</p>
<p>JDK<br>é€‰æ‹©è¦ä¸‹è½½çš„<code>JDK</code>ç‰ˆæœ¬ã€‚è¾“å…¥<code>1</code>ä»¥ä¸‹è½½<code>Oracle JDK 1.8</code>ã€‚æˆ–è€…ï¼Œæ‚¨å¯ä»¥é€‰æ‹©è¾“å…¥<code>è‡ªå®šä¹‰JDK</code>ã€‚å¦‚æœé€‰æ‹©â€œ<code>è‡ªå®šä¹‰JDK</code>â€ï¼Œåˆ™å¿…é¡»åœ¨æ‰€æœ‰ä¸»æœºä¸Šæ‰‹åŠ¨å®‰è£…JDKå¹¶æŒ‡å®š<code>Java Home</code>è·¯å¾„ã€‚</p>
<p>â—ï¸â—ï¸ã€æ³¨æ„ã€‘</p>
<p>JDKæ”¯æŒå®Œå…¨å–å†³äºæ‚¨é€‰æ‹©çš„<code>HDP Stack</code>ç‰ˆæœ¬ã€‚è¯·å‚é˜…<a href="http://docs.hortonworks.com/HDPDocuments/Ambari-2.4.2.0/bk_ambari-reference/content/ch_changing_the_jdk_version_on_an_existing_cluster.html" target="_blank" rel="external">Hortonworksæ•°æ®å¹³å°Apache Ambari</a>å‚è€ƒä»¥æŸ¥çœ‹è¦å®‰è£…çš„HDP Stackç‰ˆæœ¬æ”¯æŒçš„JDKç‰ˆæœ¬ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒAmbariæœåŠ¡å™¨è®¾ç½®ä¸‹è½½å¹¶å®‰è£…Oracle JDK 1.8å’Œéšé™„çš„Javaå¯†ç æœ¯æ‰©å±•ï¼ˆJCEï¼‰ç­–ç•¥æ–‡ä»¶ã€‚å¦‚æœè®¡åˆ’ä½¿ç”¨å…¶ä»–ç‰ˆæœ¬çš„JDKï¼Œè¯·å‚é˜… è®¾ç½®é€‰é¡¹ä»¥è·å–æ›´å¤šä¿¡æ¯ã€‚</p>
<p>å‡ºç°æç¤ºæ—¶æ¥å—<code>Oracle JDK</code>è®¸å¯è¯ã€‚æ‚¨å¿…é¡»æ¥å—æ­¤è®¸å¯è¯æ‰èƒ½ä»Oracleä¸‹è½½å¿…éœ€çš„JDKã€‚JDKåœ¨éƒ¨ç½²é˜¶æ®µå®‰è£…ã€‚</p>
<blockquote>
<p>æ•°æ®åº“é€‰æ‹©ï¼š</p>
</blockquote>
<p>é€‰æ‹©<code>n</code>ä¸ºï¼Œ<code>Enter advanced database configuration</code>ä»¥ä¾¿ä¸º<code>Ambari</code>ä½¿ç”¨é»˜è®¤çš„åµŒå…¥å¼<code>PostgreSQL</code>æ•°æ®åº“ã€‚é»˜è®¤çš„PostgreSQLæ•°æ®åº“åæ˜¯ambariã€‚é»˜è®¤ç”¨æˆ·åå’Œå¯†ç ä¸ºambari/bigdataã€‚å¦åˆ™ï¼Œè¦ä½¿ç”¨ç°æœ‰çš„PostgreSQLï¼ŒMySQL / MariaDBæˆ–Oracleæ•°æ®åº“ä¸Ambariï¼Œè¯·é€‰æ‹©yã€‚</p>
<p>å¦‚æœä½¿ç”¨ç°æœ‰çš„PostgreSQLï¼ŒMySQL / MariaDBæˆ–Oracleæ•°æ®åº“å®ä¾‹ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹æç¤ºä¹‹ä¸€ï¼š</p>
<p>â—ï¸â—ï¸[é‡è¦]<br>åœ¨è¿è¡Œå®‰è£…ç¨‹åºå’Œè¾“å…¥é«˜çº§æ•°æ®åº“é…ç½®ä¹‹å‰ï¼Œå¿…é¡»ä½¿ç”¨<code>â€œä½¿ç”¨éé»˜è®¤æ•°æ®åº“</code>- Ambariâ€ä¸­è¯¦è¿°çš„æ­¥éª¤å‡†å¤‡éé»˜è®¤æ•°æ®åº“å®ä¾‹ã€‚</p>
<p>â—ï¸â—ï¸[é‡è¦]</p>
<p>ä¸æ”¯æŒä½¿ç”¨Microsoft SQL Serveræˆ–SQL Anywhereæ•°æ®åº“é€‰é¡¹ã€‚</p>
<p>è¦ä½¿ç”¨ç°æœ‰çš„Oracleå®ä¾‹ï¼Œå¹¶ä¸ºè¯¥æ•°æ®åº“é€‰æ‹©è‡ªå·±çš„æ•°æ®åº“åç§°ï¼Œç”¨æˆ·åå’Œå¯†ç ï¼Œè¯·è¾“å…¥<code>2</code>ã€‚<br>é€‰æ‹©è¦ä½¿ç”¨çš„æ•°æ®åº“ï¼Œå¹¶æä¾›åœ¨æç¤ºä¸­è¯·æ±‚çš„ä»»ä½•ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä¸»æœºåï¼Œç«¯å£ï¼ŒæœåŠ¡åæˆ–SIDï¼Œç”¨æˆ·åå’Œå¯†ç ã€‚<br>è¦ä½¿ç”¨ç°æœ‰çš„MySQL / MariaDBæ•°æ®åº“ï¼Œå¹¶ä¸ºè¯¥æ•°æ®åº“é€‰æ‹©è‡ªå·±çš„æ•°æ®åº“åç§°ï¼Œç”¨æˆ·åå’Œå¯†ç ï¼Œè¯·è¾“å…¥3ã€‚<br>é€‰æ‹©è¦ä½¿ç”¨çš„æ•°æ®åº“ï¼Œå¹¶æä¾›åœ¨æç¤ºä¸­è¯·æ±‚çš„ä»»ä½•ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä¸»æœºåï¼Œç«¯å£ï¼Œæ•°æ®åº“åç§°ï¼Œç”¨æˆ·åå’Œå¯†ç ã€‚<br>è¦ä½¿ç”¨ç°æœ‰çš„PostgreSQLæ•°æ®åº“ï¼Œå¹¶ä¸ºè¯¥æ•°æ®åº“é€‰æ‹©è‡ªå·±çš„æ•°æ®åº“åç§°ï¼Œç”¨æˆ·åå’Œå¯†ç ï¼Œè¯·è¾“å…¥4ã€‚<br>é€‰æ‹©è¦ä½¿ç”¨çš„æ•°æ®åº“ï¼Œå¹¶æä¾›åœ¨æç¤ºä¸­è¯·æ±‚çš„ä»»ä½•ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä¸»æœºåï¼Œç«¯å£ï¼Œæ•°æ®åº“åç§°ï¼Œç”¨æˆ·åå’Œå¯†ç ã€‚<br>ç»§ç»­é…ç½®è¿œç¨‹æ•°æ®åº“è¿æ¥å±æ€§[y / n]é€‰æ‹©<code>y</code>ã€‚</p>
<blockquote>
<p>è¿™é‡Œæ•°æ®åº“ç”¨æˆ·åå’Œå¯†ç éƒ½æ˜¯é»˜è®¤å®‰è£…ï¼š</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Database name (ambari)</div><div class="line">Postgres schema (ambari)</div><div class="line">Username (ambari)</div><div class="line">Enter Database Password (bigdata)</div></pre></td></tr></table></figure>
<blockquote>
<p>è¿™é‡Œæˆ‘åšäº†ä¸€å±‚Nginxä»£ç†ï¼šå°†AmbariæœåŠ¡å™¨é…ç½®ä¸ºä½¿ç”¨æ­¤ä»£ç†æœåŠ¡å™¨</p>
</blockquote>
<h3 id="3-å¯åŠ¨AmbariæœåŠ¡å™¨"><a href="#3-å¯åŠ¨AmbariæœåŠ¡å™¨" class="headerlink" title="3.å¯åŠ¨AmbariæœåŠ¡å™¨"></a>3.å¯åŠ¨AmbariæœåŠ¡å™¨</h3><p>åœ¨AmbariæœåŠ¡å™¨ä¸»æœºä¸Šè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<pre><code>ambari-server start
</code></pre><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[root@ambari-server ~]<span class="comment"># ambari-server start</span></div><div class="line">Using python  /usr/bin/python</div><div class="line">Starting ambari-server</div><div class="line">Ambari Server running with administrator privileges.</div><div class="line">Organizing resource files at /var/lib/ambari-server/resources...</div><div class="line">Ambari database consistency check started...</div><div class="line">No errors were found.</div><div class="line">Ambari database consistency check finished</div><div class="line">Server PID at: /var/run/ambari-server/ambari-server.pid</div><div class="line">Server out at: /var/<span class="built_in">log</span>/ambari-server/ambari-server.out</div><div class="line">Server <span class="built_in">log</span> at: /var/<span class="built_in">log</span>/ambari-server/ambari-server.log</div><div class="line">Waiting <span class="keyword">for</span> server start....................</div><div class="line">Ambari Server <span class="string">'start'</span> completed successfully.</div><div class="line">You have mail <span class="keyword">in</span> /var/spool/mail/root</div></pre></td></tr></table></figure>
<p>è¦æ£€æŸ¥AmbariæœåŠ¡å™¨è¿›ç¨‹ï¼š</p>
<pre><code>ambari-server status
</code></pre><p>åœæ­¢AmbariæœåŠ¡å™¨ï¼š</p>
<pre><code>ambari-server stop
</code></pre><p>åœ¨AmbariæœåŠ¡å™¨å¯åŠ¨æ—¶ï¼Œ<code>Ambari</code>è¿è¡Œæ•°æ®åº“ä¸€è‡´æ€§æ£€æŸ¥ï¼ŒæŸ¥æ‰¾é—®é¢˜ã€‚å¦‚æœå‘ç°ä»»ä½•é—®é¢˜ï¼ŒAmbariæœåŠ¡å™¨å¯åŠ¨å°†ä¸­æ­¢ï¼Œå¹¶ä¸”ä¸€æ¡æ¶ˆæ¯å°†æ‰“å°åˆ°æ§åˆ¶å°â€œæ•°æ®åº“é…ç½®ä¸€è‡´æ€§æ£€æŸ¥å¤±è´¥â€ã€‚æ›´å¤šè¯¦ç»†ä¿¡æ¯å°†å†™å…¥ä»¥ä¸‹æ—¥å¿—æ–‡â€‹â€‹ä»¶ï¼š</p>
<pre><code>/var/log/ambari-server/ambari-server-check-database.log
</code></pre><p>æ‚¨å¯ä»¥é€šè¿‡ä½¿ç”¨ä»¥ä¸‹é€‰é¡¹è·³è¿‡æ­¤æ£€æŸ¥æ¥å¼ºåˆ¶AmbariæœåŠ¡å™¨å¯åŠ¨ï¼š</p>
<pre><code>ambari-server start --skip-database-check
</code></pre><p>å¦‚æœå­˜åœ¨æ•°æ®åº“é—®é¢˜ï¼Œè¯·é€‰æ‹©è·³è¿‡æ­¤æ£€æŸ¥ï¼Œåœ¨æ›´æ­£æ•°æ®åº“ä¸€è‡´æ€§é—®é¢˜ä¹‹å‰ï¼Œä¸è¦å¯¹é›†ç¾¤æ‹“æ‰‘è¿›è¡Œä»»ä½•æ›´æ”¹æˆ–æ‰§è¡Œé›†ç¾¤å‡çº§ã€‚æœ€å¥½æŸ¥çœ‹å®˜ç½‘æ“ä½œã€‚</p>
<h2 id="ç¬¬3ç« å®‰è£…ï¼Œé…ç½®å’Œéƒ¨ç½²HDPé›†ç¾¤"><a href="#ç¬¬3ç« å®‰è£…ï¼Œé…ç½®å’Œéƒ¨ç½²HDPé›†ç¾¤" class="headerlink" title="ç¬¬3ç« å®‰è£…ï¼Œé…ç½®å’Œéƒ¨ç½²HDPé›†ç¾¤"></a>ç¬¬3ç« å®‰è£…ï¼Œé…ç½®å’Œéƒ¨ç½²HDPé›†ç¾¤</h2><h3 id="1-ç™»å½•åˆ°Apache-Ambari"><a href="#1-ç™»å½•åˆ°Apache-Ambari" class="headerlink" title="1.ç™»å½•åˆ°Apache Ambari"></a>1.ç™»å½•åˆ°Apache Ambari</h3><ul>
<li><p>å°†æµè§ˆå™¨æŒ‡å‘ <code>http://&lt;your.ambari.server&gt; :8080</code>ï¼Œå…¶ä¸­<code>&lt;your.ambari.server&gt;</code>æ˜¯æ‚¨çš„ambariæœåŠ¡å™¨ä¸»æœºçš„åç§°ã€‚ä¾‹å¦‚ï¼Œé»˜è®¤AmbariæœåŠ¡å™¨ä¸»æœºä½äº<code>http://c6401.ambari.apache.org:8080</code>ã€‚</p>
</li>
<li><p>ä½¿ç”¨é»˜è®¤ç”¨æˆ·å/å¯†ç ç™»å½•AmbariæœåŠ¡å™¨ï¼š<code>admin / admin</code>ã€‚æ‚¨å¯ä»¥ç¨åæ›´æ”¹è¿™äº›å‡­æ®ã€‚</p>
</li>
</ul>
<h3 id="2-å¯åŠ¨Ambariå®‰è£…å‘å¯¼"><a href="#2-å¯åŠ¨Ambariå®‰è£…å‘å¯¼" class="headerlink" title="2.å¯åŠ¨Ambariå®‰è£…å‘å¯¼"></a>2.å¯åŠ¨Ambariå®‰è£…å‘å¯¼</h3><p>ä»<code>Ambari Welcome</code>é¡µé¢ï¼Œé€‰æ‹©å¯åŠ¨å®‰è£…å‘å¯¼ã€‚</p>
<p>æä¾›é›†ç¾¤ï¼Œç®¡ç†è°å¯ä»¥è®¿é—®ç¾¤é›†ï¼Œä»¥åŠè‡ªå®šä¹‰è§†å›¾ä¸ºAmbariç”¨æˆ·ã€‚</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/Ambariwelcome.png" alt=""></figure></p>
<p><figure class="figure"><img src="http://docs.hortonworks.com/HDPDocuments/Ambari-2.4.2.0/bk_ambari-installation/content/figures/2/figures/170AmbariWelcome.png" alt=""></figure></p>
<h3 id="3-å‘½åæ‚¨çš„ç¾¤é›†"><a href="#3-å‘½åæ‚¨çš„ç¾¤é›†" class="headerlink" title="3.å‘½åæ‚¨çš„ç¾¤é›†"></a>3.å‘½åæ‚¨çš„ç¾¤é›†</h3><p>åœ¨Name your clusterï¼Œé”®å…¥è¦åˆ›å»ºçš„é›†ç¾¤çš„åç§°ã€‚åç§°ä¸­ä¸è¦ä½¿ç”¨ç©ºæ ¼æˆ–ç‰¹æ®Šå­—ç¬¦ã€‚</p>
<p>é€‰æ‹©Nextã€‚</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/ambari_02.png" alt=""></figure></p>
<h3 id="4-é€‰æ‹©ç‰ˆæœ¬"><a href="#4-é€‰æ‹©ç‰ˆæœ¬" class="headerlink" title="4.é€‰æ‹©ç‰ˆæœ¬"></a>4.é€‰æ‹©ç‰ˆæœ¬</h3><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/ambari_03.png" alt=""></figure></p>
<p>è¿™é‡Œæˆ‘é€‰æ‹©<code>redhat6</code> å…¶ä»–çš„éƒ½<code>remove</code>æ‰ã€‚</p>
<p>åœ¨æ­¤æ­¥éª¤ä¸­ï¼Œæ‚¨å°†é€‰æ‹©ç¾¤é›†çš„è½¯ä»¶ç‰ˆæœ¬å’Œäº¤ä»˜æ–¹å¼ã€‚ä½¿ç”¨å…¬å…±å­˜å‚¨åº“éœ€è¦Internetè¿æ¥ã€‚ä½¿ç”¨æœ¬åœ°å­˜å‚¨åº“éœ€è¦æ‚¨åœ¨ç½‘ç»œä¸­å¯ç”¨çš„å­˜å‚¨åº“ä¸­é…ç½®è½¯ä»¶ã€‚</p>
<ul>
<li>é€‰æ‹©å †æ ˆ</li>
</ul>
<p>å¯ç”¨çš„HDPç‰ˆæœ¬æ˜¾ç¤ºåœ¨TABä¸­ã€‚å½“æ‚¨é€‰æ‹©TABæ—¶ï¼ŒAmbariä¼šå°è¯•å‘ç°è¯¥HDPå †æ ˆçš„ç‰¹å®šç‰ˆæœ¬å¯ç”¨ã€‚è¯¥åˆ—è¡¨æ˜¾ç¤ºåœ¨DROPDOWNä¸­ã€‚å¯¹äºè¯¥ç‰¹å®šç‰ˆæœ¬ï¼Œå°†æ˜¾ç¤ºå¯ç”¨çš„æœåŠ¡ï¼Œå…¶ä¸­çš„ç‰ˆæœ¬æ˜¾ç¤ºåœ¨TABLEä¸­ã€‚</p>
<ul>
<li>é€‰æ‹©ç‰ˆæœ¬</li>
</ul>
<p>å¦‚æœAmbariå¯ä»¥è®¿é—®Internetï¼Œåˆ™ç‰¹å®šç‰ˆæœ¬å°†ä½œä¸ºé€‰é¡¹åˆ—åœ¨DROPDOWNä¸­ã€‚å¦‚æœæ‚¨æœ‰æœªåˆ—å‡ºçš„ç‰ˆæœ¬çš„ç‰ˆæœ¬å®šä¹‰æ–‡ä»¶ï¼Œæ‚¨å¯ä»¥å•å‡»æ·»åŠ ç‰ˆæœ¬â€¦å¹¶ä¸Šè½½VDFæ–‡ä»¶ã€‚æ­¤å¤–ï¼Œå¦‚æœæ‚¨æ— æ³•è®¿é—®Internetæˆ–ä¸ç¡®å®šè¦å®‰è£…å“ªä¸ªç‰¹å®šç‰ˆæœ¬ï¼Œåˆ™ é»˜è®¤ç‰ˆæœ¬å®šä¹‰ä¹ŸåŒ…å«åœ¨åˆ—è¡¨ä¸­ã€‚</p>
<ul>
<li>é€‰æ‹©å­˜å‚¨åº“</li>
</ul>
<p>Ambariå…è®¸æ‚¨é€‰æ‹©ä»å…¬å…±å­˜å‚¨åº“ï¼ˆå¦‚æœæ‚¨æœ‰Internetè®¿é—®æƒé™ï¼‰æˆ–æœ¬åœ°å­˜å‚¨åº“å®‰è£…è½¯ä»¶ã€‚æ— è®ºæ‚¨çš„é€‰æ‹©å¦‚ä½•ï¼Œæ‚¨éƒ½å¯ä»¥ç¼–è¾‘å­˜å‚¨åº“çš„åŸºæœ¬URLã€‚å°†æ˜¾ç¤ºå¯ç”¨çš„æ“ä½œç³»ç»Ÿï¼Œæ‚¨å¯ä»¥ä»åˆ—è¡¨ä¸­æ·»åŠ /åˆ é™¤æ“ä½œç³»ç»Ÿä»¥é€‚åˆæ‚¨çš„ç¯å¢ƒ</p>
<p>â—ï¸â—ï¸æ³¨æ„<br>UIæ˜¾ç¤ºåŸºäºæ“ä½œç³»ç»Ÿç³»åˆ—ï¼ˆOSç³»åˆ—ï¼‰çš„å­˜å‚¨åº“åŸºæœ¬URLã€‚è¯·ç¡®ä¿åŸºäºæ­£åœ¨è¿è¡Œçš„æ“ä½œç³»ç»Ÿè®¾ç½®æ­£ç¡®çš„æ“ä½œç³»ç»Ÿç³»åˆ—ã€‚ä¸‹è¡¨å°†OSç³»åˆ—æ˜ å°„åˆ°æ“ä½œç³»ç»Ÿã€‚</p>
<ul>
<li><p><strong>é«˜çº§é€‰é¡¹</strong></p>
</li>
<li><p><strong>æœ‰é«˜çº§å­˜å‚¨åº“é€‰é¡¹å¯ç”¨ã€‚</strong></p>
</li>
</ul>
<p>è·³è¿‡å­˜å‚¨åº“åŸºæœ¬URLéªŒè¯ï¼ˆé«˜çº§ï¼‰ï¼š å½“æ‚¨å•å‡»ä¸‹ä¸€æ­¥æ—¶ï¼ŒAmbariå°†å°è¯•è¿æ¥åˆ°å­˜å‚¨åº“åŸºæœ¬URLï¼Œå¹¶éªŒè¯æ‚¨å·²è¾“å…¥éªŒè¯å­˜å‚¨åº“ã€‚å¦‚æœæ²¡æœ‰ï¼Œå°†æ˜¾ç¤ºä¸€ä¸ªé”™è¯¯ï¼Œæ‚¨å¿…é¡»åœ¨ç»§ç»­ä¹‹å‰çº æ­£ã€‚</p>
<p>ä½¿ç”¨<code>RedHat Satellite/Spacewalkï¼š</code>ä»…å½“è®¡åˆ’ä½¿ç”¨æœ¬åœ°å­˜å‚¨åº“æ—¶ï¼Œæ‰ä¼šå¯ç”¨æ­¤é€‰é¡¹ã€‚å½“æ‚¨ä¸ºè½¯ä»¶å­˜å‚¨åº“é€‰æ‹©æ­¤é€‰é¡¹æ—¶ï¼Œæ‚¨è´Ÿè´£é…ç½®<code>Satellite/Spacewalk</code>ä¸­çš„å­˜å‚¨åº“é€šé“ï¼Œå¹¶ç¡®è®¤æ‰€é€‰ç¾¤é›†ç‰ˆæœ¬çš„å­˜å‚¨åº“åœ¨ç¾¤é›†ä¸­çš„ä¸»æœºä¸Šå¯ç”¨ã€‚</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/ambari_04.png" alt=""></figure></p>
<h3 id="5-å®‰è£…é€‰é¡¹"><a href="#5-å®‰è£…é€‰é¡¹" class="headerlink" title="5.å®‰è£…é€‰é¡¹"></a>5.å®‰è£…é€‰é¡¹</h3><p>ä¸ºäº†æ„å»ºé›†ç¾¤ï¼Œå®‰è£…å‘å¯¼å°†æç¤ºæ‚¨æœ‰å…³å¦‚ä½•è®¾ç½®å®ƒçš„ä¸€èˆ¬ä¿¡æ¯ã€‚æ‚¨éœ€è¦æä¾›æ¯ä¸ªä¸»æœºçš„FQDNã€‚è¯¥å‘å¯¼è¿˜éœ€è¦è®¿é—®åœ¨è®¾ç½®æ— å¯†ç SSHä¸­åˆ›å»ºçš„ç§é’¥æ–‡ä»¶  ã€‚ä½¿ç”¨ä¸»æœºåå’Œå¯†é’¥æ–‡ä»¶ä¿¡æ¯ï¼Œå‘å¯¼å¯ä»¥å®šä½ï¼Œè®¿é—®å’Œä¸ç¾¤é›†ä¸­çš„æ‰€æœ‰ä¸»æœºå®‰å…¨äº¤äº’ã€‚</p>
<p>ä½¿ç”¨Target Hostsæ–‡æœ¬æ¡†è¾“å…¥ä¸»æœºååˆ—è¡¨ï¼Œæ¯è¡Œä¸€ä¸ªã€‚æ‚¨å¯ä»¥ä½¿ç”¨æ‹¬å·å†…çš„èŒƒå›´æ¥è¡¨ç¤ºè¾ƒå¤§çš„ä¸»æœºé›†ã€‚ä¾‹å¦‚ï¼Œå¯¹äºhost01.domainé€šè¿‡host10.domainä½¿ç”¨ host[01-10].domain</p>
<p>âš ï¸ <strong>å®‰è£…æœåŠ¡å™¨é›†ç¾¤æœºå™¨ä¸€å®šè¦ç³»ç»Ÿç‰ˆæœ¬è¦ä¸€è‡´ä¸ç„¶å®‰è£…ä¼šæç¤ºç‰ˆæœ¬ä¸å…¼å®¹ã€‚</strong></p>
<p>â—ï¸â—ï¸    æ³¨æ„<br>å¦‚æœè¦åœ¨EC2ä¸Šéƒ¨ç½²ï¼Œè¯·ä½¿ç”¨å†…éƒ¨ä¸“ç”¨<code>DNSä¸»æœºå</code>ã€‚</p>
<p>åœ¨ambariæœåŠ¡å™¨é…ç½®hosts</p>
<pre><code>vim /etc/hosts
</code></pre><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">192<span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.151</span>    <span class="selector-tag">datanode151</span></div><div class="line">192<span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.173</span>    <span class="selector-tag">datanode_173</span> <span class="selector-tag">datanode-173</span><span class="selector-class">.hadoop</span></div></pre></td></tr></table></figure>
<p>å¦‚æœè¦è®©<code>Ambari</code>ä½¿ç”¨SSHåœ¨æ‰€æœ‰ä¸»æœºä¸Šè‡ªåŠ¨å®‰è£…Ambariä»£ç†ï¼Œè¯·é€‰æ‹©<code>Provide your SSH Private Key</code>å¹¶ä½¿ç”¨éƒ¨åˆ†ä¸­çš„ <code>Choose File</code>æŒ‰é’®<code>Host Registration Information</code>æŸ¥æ‰¾ä¸å…ˆå‰åœ¨æ‰€æœ‰ä¸»æœºä¸Šå®‰è£…çš„å…¬é’¥ç›¸åŒ¹é…çš„ç§é’¥æ–‡ä»¶ï¼Œæˆ–è€…å‰ªåˆ‡å¹¶ç²˜è´´é”®æ‰‹åŠ¨æ’å…¥æ–‡æœ¬æ¡†ã€‚</p>
<p>å¡«å†™æ‚¨é€‰æ‹©çš„SSHå¯†é’¥çš„ç”¨æˆ·åã€‚å¦‚æœä¸æƒ³ä½¿ç”¨rootç”¨æˆ·ï¼Œåˆ™å¿…é¡»ä¸ºå¯ä»¥åœ¨ä¸è¾“å…¥å¯†ç çš„æƒ…å†µä¸‹æ‰§è¡Œsudoçš„å¸æˆ·æä¾›ç”¨æˆ·åã€‚å¦‚æœæ‚¨çš„ç¯å¢ƒä¸­çš„ä¸»æœºä¸Šçš„SSHé…ç½®ä¸º22ä»¥å¤–çš„ç«¯å£ï¼Œæ‚¨ä¹Ÿå¯ä»¥æ›´æ”¹å®ƒã€‚</p>
<p>å¦‚æœæ‚¨ä¸å¸Œæœ›Ambariè‡ªåŠ¨å®‰è£…Ambariä»£ç†ï¼Œè¯·é€‰æ‹©<code>Perform manual registration</code>ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…æ‰‹åŠ¨å®‰è£…Ambariä»£ç†ã€‚</p>
<p>é€‰æ‹©<code>Register and Confirm</code>ç»§ç»­ã€‚</p>
<p>è¿™é‡Œæç¤ºï¼šThe following hostnames are not valid FQDNs: datanode_173.hadoop</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/ambari_06.png" alt=""></figure></p>
<p>è¿™é‡Œè·³è½¬åˆ°å®‰è£…é¡µé¢ï¼šå‘ç°æŠ¥é”™æç¤ºdatanode-173.hadoopä¸»æœºè®¿é—®Ambariæœºå™¨ä¸èƒ½è®¿é—®ã€‚<br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/ambari_07.png" alt=""></figure></p>
<h3 id="6-ç¡®è®¤ä¸»æœº"><a href="#6-ç¡®è®¤ä¸»æœº" class="headerlink" title="6.ç¡®è®¤ä¸»æœº"></a>6.ç¡®è®¤ä¸»æœº</h3><p><code>Confirm Hosts</code> æç¤ºæ‚¨ç¡®è®¤<code>Ambari</code>å·²ä¸ºæ‚¨çš„é›†ç¾¤æ‰¾åˆ°æ­£ç¡®çš„ä¸»æœºï¼Œå¹¶æ£€æŸ¥è¿™äº›ä¸»æœºä»¥ç¡®ä¿å®ƒä»¬å…·æœ‰ç»§ç»­å®‰è£…æ‰€éœ€çš„æ­£ç¡®ç›®å½•ï¼Œè½¯ä»¶åŒ…å’Œè¿›ç¨‹ã€‚</p>
<p>å¦‚æœé€‰æ‹©äº†é”™è¯¯çš„ä¸»æœºï¼Œæ‚¨å¯ä»¥é€šè¿‡é€‰æ‹©ç›¸åº”çš„å¤é€‰æ¡†å¹¶å•å‡»ç°è‰²<code>Remove Selected</code>æŒ‰é’®æ¥åˆ é™¤å®ƒä»¬ã€‚è¦åˆ é™¤å•ä¸ªä¸»æœºï¼Œè¯·å•å‡»Removeâ€œæ“ä½œâ€åˆ—ä¸­çš„å°ç™½è‰²æŒ‰é’®ã€‚</p>
<p>åœ¨å±å¹•åº•éƒ¨ï¼Œæ‚¨å¯èƒ½ä¼šæ³¨æ„åˆ°ä¸€ä¸ªé»„è‰²æ¡†ï¼Œè¡¨ç¤ºåœ¨æ£€æŸ¥è¿‡ç¨‹ä¸­é‡åˆ°äº†ä¸€äº›è­¦å‘Šã€‚ä¾‹å¦‚ï¼Œæ‚¨çš„ä¸»æœºå¯èƒ½å·²æœ‰<code>wget</code>æˆ–çš„å‰¯æœ¬ <code>curl</code>ã€‚é€‰æ‹©<code>Click here to see the warnings</code> æŸ¥çœ‹æ£€æŸ¥å†…å®¹å’Œå¯¼è‡´è­¦å‘Šçš„åŸå› çš„åˆ—è¡¨ã€‚è­¦å‘Šé¡µé¢è¿˜æä¾›å¯¹pythonè„šæœ¬çš„è®¿é—®ï¼Œå¯ä»¥å¸®åŠ©æ‚¨æ¸…é™¤å¯èƒ½é‡åˆ°çš„ä»»ä½•é—®é¢˜ï¼Œè®©æ‚¨è¿è¡Œ<code>Rerun Checks</code>ã€‚</p>
<p>åœ¨datanode_173æœåŠ¡å™¨é…ç½®hosts</p>
<pre><code>vim /etc/hosts
</code></pre><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">192<span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.151</span>    <span class="selector-tag">datanode151</span></div><div class="line">192<span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.173</span>    <span class="selector-tag">datanode_173</span> <span class="selector-tag">datanode-173</span><span class="selector-class">.hadoop</span></div></pre></td></tr></table></figure>
<p>æ¯å°èŠ‚ç‚¹é‡Œé…ç½®FQDNï¼Œå¦‚ä¸‹ä»¥ä¸»èŠ‚ç‚¹ä¸ºä¾‹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">vi /etc/sysconfig/network</div><div class="line">NETWORKING=yes</div><div class="line">HOSTNAME=SY-001.hadoop</div></pre></td></tr></table></figure>
<p>é…ç½®ä¸Šå°±å¯ä»¥äº†ã€‚ æŠŠdatanode151ä¹Ÿæ˜¯ambariæœºå™¨é…ç½®åœ¨hostså°±å¯ä»¥äº†ã€‚</p>
<p><strong>æœ€å¥½è®¾ç½®rootçš„æ— å¯†ç ç™»å½•ï¼Œå› ä¸ºæˆ‘ä»¬é…ç½®çš„é›†ç¾¤éƒ½æ˜¯å†…ç½‘çš„ï¼Œæ²¡ä»€ä¹ˆå®‰å…¨æ€§é—®é¢˜ï¼Œä½¿ç”¨rootæ“ä½œå¯ä»¥çœå»ä¸€äº›éº»çƒ¦ï¼Œérootç”¨æˆ·å¯èƒ½åœ¨å®‰è£…Hadoopç»„ä»¶æ—¶ä¸èƒ½æˆåŠŸ</strong></p>
<p>ä¸‹é¢æ˜¯æˆ‘å®‰è£…è¿™é‡Œæç¤ºæ²¡æœ‰æ‰¾åˆ°æ–‡ä»¶ç›®å½•æŸ¥çœ‹å®‰è£…æŠ¥é”™æ“ä½œï¼š</p>
<pre><code>mkdir /var/lib/ambari-agent/data
</code></pre><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/Ambari_08.png" alt=""></figure><br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/ambari_09.png" alt=""></figure><br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/ambari_10.png" alt=""></figure></p>
<h3 id="7-é€‰æ‹©æœåŠ¡"><a href="#7-é€‰æ‹©æœåŠ¡" class="headerlink" title="7.é€‰æ‹©æœåŠ¡"></a>7.é€‰æ‹©æœåŠ¡</h3><p>å°†çœ‹åˆ°é€‰æ‹©è¦å®‰è£…åˆ°ç¾¤é›†ä¸­çš„æœåŠ¡ã€‚HDPå †æ ˆåŒ…æ‹¬è®¸å¤šæœåŠ¡ã€‚æ‚¨å¯ä»¥é€‰æ‹©ç«‹å³å®‰è£…ä»»ä½•å…¶ä»–å¯ç”¨æœåŠ¡ï¼Œæˆ–ç¨åæ·»åŠ æœåŠ¡ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®‰è£…å‘å¯¼å°†é€‰æ‹©æ‰€æœ‰å¯ç”¨çš„æœåŠ¡è¿›è¡Œå®‰è£…ã€‚</p>
<p>é€‰æ‹©<code>none</code>æ¸…é™¤æ‰€æœ‰é€‰æ‹©ï¼Œæˆ–é€‰æ‹© <code>all</code>é€‰æ‹©æ‰€æœ‰åˆ—å‡ºçš„æœåŠ¡ã€‚</p>
<p>é€‰æ‹©æˆ–æ¸…é™¤å•ä¸ªå¤é€‰æ¡†ä»¥å®šä¹‰ä¸€ç»„è¦ç«‹å³å®‰è£…çš„æœåŠ¡ã€‚</p>
<p>é€‰æ‹©è¦ç«‹å³å®‰è£…çš„æœåŠ¡åï¼Œé€‰æ‹©Nextã€‚</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/ambari_11.png" alt=""></figure></p>
<h3 id="8-åˆ†é…ä¸»ç«™"><a href="#8-åˆ†é…ä¸»ç«™" class="headerlink" title="8.åˆ†é…ä¸»ç«™"></a>8.åˆ†é…ä¸»ç«™</h3><p>Ambariå®‰è£…å‘å¯¼ä¼šå°†æ‰€é€‰æœåŠ¡çš„ä¸»ç»„ä»¶åˆ†é…ç»™é›†ç¾¤ä¸­çš„ç›¸åº”ä¸»æœºï¼Œå¹¶åœ¨Assign Mastersä¸­æ˜¾ç¤ºåˆ†é…ã€‚å·¦åˆ—æ˜¾ç¤ºæœåŠ¡å’Œå½“å‰ä¸»æœºã€‚å³åˆ—æ˜¾ç¤ºä¸»æœºçš„å½“å‰ä¸»ç»„ä»¶åˆ†é…ï¼ŒæŒ‡ç¤ºæ¯ä¸ªä¸»æœºä¸Šå®‰è£…çš„CPUå†…æ ¸æ•°é‡å’ŒRAMæ•°é‡ã€‚</p>
<p>è¦æ›´æ”¹æœåŠ¡çš„ä¸»æœºåˆ†é…ï¼Œè¯·ä»è¯¥æœåŠ¡çš„ä¸‹æ‹‰èœå•ä¸­é€‰æ‹©ä¸»æœºåã€‚</p>
<p>è¦åˆ é™¤ZooKeeperå®ä¾‹ï¼Œè¯·å•å‡»è¦åˆ é™¤çš„ä¸»æœºåœ°å€æ—è¾¹çš„ç»¿è‰²å‡å·å›¾æ ‡ã€‚</p>
<p>å½“æ‚¨å¯¹ä½œä¸šæ„Ÿåˆ°æ»¡æ„æ—¶ï¼Œé€‰æ‹©Nextã€‚</p>
<p><figure class="figure"><img src="" alt=""></figure></p>
<h3 id="9-åˆ†é…ä»å±å’Œå®¢æˆ·ç«¯"><a href="#9-åˆ†é…ä»å±å’Œå®¢æˆ·ç«¯" class="headerlink" title="9.åˆ†é…ä»å±å’Œå®¢æˆ·ç«¯"></a>9.åˆ†é…ä»å±å’Œå®¢æˆ·ç«¯</h3><p>Ambariå®‰è£…å‘å¯¼å°†ä»å±ç»„ä»¶ï¼ˆDataNodesï¼ŒNodeManagerå’ŒRegionServersï¼‰åˆ†é…ç»™é›†ç¾¤ä¸­çš„ç›¸åº”ä¸»æœºã€‚å®ƒè¿˜ä¼šå°è¯•é€‰æ‹©ä¸»æœºä»¥å®‰è£…é€‚å½“çš„å®¢æˆ·ç«¯é›†ã€‚</p>
<p>ä½¿ç”¨<code>all</code>æˆ–<code>none</code>å¯åˆ†åˆ«é€‰æ‹©åˆ—ä¸­çš„æ‰€æœ‰ä¸»æœºæˆ–ä¸é€‰æ‹©ä»»ä½•ä¸»æœºã€‚</p>
<p>å¦‚æœä¸»æœºæ—è¾¹æœ‰æ˜Ÿå·ï¼Œåˆ™è¯¥ä¸»æœºä¹Ÿè¿è¡Œä¸€ä¸ªæˆ–å¤šä¸ªä¸»ç»„ä»¶ã€‚å°†é¼ æ ‡æ‚¬åœåœ¨æ˜Ÿå·ä¸Šï¼Œä»¥æŸ¥çœ‹è¯¥ä¸»æœºä¸Šçš„å“ªäº›ä¸»ç»„ä»¶ã€‚</p>
<p>é€šè¿‡ä½¿ç”¨ç‰¹å®šä¸»æœºæ—è¾¹çš„å¤é€‰æ¡†æ¥å¾®è°ƒæ‚¨çš„é€‰æ‹©ã€‚</p>
<p>å½“ä½ å¯¹ä½ çš„ä½œä¸šæ„Ÿåˆ°æ»¡æ„æ—¶ï¼Œé€‰æ‹©<code>Next</code>ã€‚</p>
<h3 id="10-è‡ªå®šä¹‰æœåŠ¡"><a href="#10-è‡ªå®šä¹‰æœåŠ¡" class="headerlink" title="10.è‡ªå®šä¹‰æœåŠ¡"></a>10.è‡ªå®šä¹‰æœåŠ¡</h3><p>è‡ªå®šä¹‰æœåŠ¡æ­¥éª¤ä¸ºæ‚¨æä¾›ä¸€ç»„é€‰é¡¹å¡ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹å’Œä¿®æ”¹HDPé›†ç¾¤è®¾ç½®ã€‚å‘å¯¼ä¼šå°è¯•ä¸ºæ¯ä¸ªé€‰é¡¹è®¾ç½®åˆç†çš„é»˜è®¤å€¼ã€‚ä½ æ˜¯å¼ºçƒˆå»ºè®®ï¼Œä»¥æ£€æŸ¥è¿™äº›è®¾ç½®ä¸ºæ‚¨çš„è¦æ±‚å¯èƒ½ç•¥æœ‰ä¸åŒã€‚</p>
<p>æµè§ˆæ¯ä¸ªæœåŠ¡æ ‡ç­¾ï¼Œç„¶åå°†å…‰æ ‡æ‚¬åœåœ¨æ¯ä¸ªå±æ€§ä¸Šï¼Œæ‚¨å¯ä»¥çœ‹åˆ°å±æ€§åšä»€ä¹ˆçš„ç®€è¦è¯´æ˜ã€‚æ˜¾ç¤ºçš„æœåŠ¡é€‰é¡¹å¡æ•°å–å†³äºæ‚¨å†³å®šåœ¨ç¾¤é›†ä¸­å®‰è£…çš„æœåŠ¡ã€‚ä»»ä½•éœ€è¦è¾“å…¥çš„é€‰é¡¹å¡éƒ½ä¼šæ˜¾ç¤ºä¸€ä¸ªçº¢è‰²å¾½ç« ï¼Œå…¶ä¸­åŒ…å«éœ€è¦æ³¨æ„çš„å±æ€§æ•°ã€‚é€‰æ‹©æ˜¾ç¤ºçº¢è‰²å¾½ç« ç¼–å·çš„æ¯ä¸ªæœåŠ¡é€‰é¡¹å¡ï¼Œç„¶åè¾“å…¥ç›¸åº”çš„ä¿¡æ¯ã€‚</p>
<ul>
<li>ç›®å½•</li>
</ul>
<p>HDPå°†å­˜å‚¨ä¿¡æ¯çš„ç›®å½•çš„é€‰æ‹©æ˜¯è‡³å…³é‡è¦çš„ã€‚Ambariå°†å°è¯•æ ¹æ®æ‚¨ç¯å¢ƒä¸­å¯ç”¨çš„å®‰è£…ç‚¹é€‰æ‹©åˆç†çš„é»˜è®¤å€¼ï¼Œä½†å¼ºçƒˆå»ºè®®æ‚¨æŸ¥çœ‹Ambariæ¨èçš„é»˜è®¤ç›®å½•è®¾ç½®ã€‚ç‰¹åˆ«æ˜¯ï¼Œç¡®è®¤ç›®å½•ï¼Œä¾‹å¦‚<code>/tmpå’Œ /var</code>è¢«ä¸è¢«ç”¨äºä¸‹<code>HDFSçš„NameNode</code>ç›®å½•å’Œæ•°æ®ç®¡ç†éƒ¨ç›®å½•HDFSæ ‡ç­¾ã€‚</p>
<ul>
<li>å¯†ç </li>
</ul>
<p>æ‚¨å¿…é¡»ä¸ºHiveå’ŒOozieæœåŠ¡ä»¥åŠKnoxçš„ä¸»å¯†é’¥æä¾›æ•°æ®åº“å¯†ç ã€‚ä½¿ç”¨Hiveä½œä¸ºç¤ºä¾‹ï¼Œé€‰æ‹©Hiveé€‰é¡¹å¡å¹¶å±•å¼€é«˜çº§éƒ¨åˆ†ã€‚åœ¨ä»¥çº¢è‰²æ ‡è®°çš„æ•°æ®åº“å¯†ç å­—æ®µä¸­ï¼Œæä¾›å¯†ç ï¼Œç„¶åé‡æ–°é”®å…¥ä»¥ç¡®è®¤ã€‚</p>
<p>å®‰è£…å„ä¸ªæœåŠ¡ï¼Œå¹¶ä¸”å®Œæˆå®‰è£…åä¼šå¯åŠ¨ç›¸å…³æœåŠ¡ï¼Œå®‰è£…è¿‡ç¨‹æ¯”è¾ƒé•¿ï¼Œå¦‚ä¸­ä¸­å‡ºç°é”™è¯¯ï¼Œæ ¹æ®å…·ä½“æä¾›æˆ–æ—¥å¿—è¿›è¡Œæ“ä½œã€‚ </p>
<p>è¿™é‡Œæˆ‘å°±ä¸è´´å‡ºæ¥äº†ï¼Œå› ä¸ºæµ‹è¯•ç¯å¢ƒæœºå™¨æˆ‘åšæµ‹è¯•ç”¨æœºå™¨é…ç½®ä¸å¤Ÿæ‰€æœ‰åé¢ç»“æœç»éªŒå†™å‡ºæ¥äº†ã€‚</p>
<p>å®‰è£…çš„è¿˜æ˜¯æç¤ºå¤±è´¥ï¼š<code>ImportError: No module named rpm</code></p>
<p>å‚è€ƒè¿™ç¯‡æ–‡ç« é‡æ–°å®‰è£…è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼š<a href="http://stackoverflow.com/questions/17490921/no-module-named-rpm-when-i-call-yum-on-shell" target="_blank" rel="external">ImportError: No module named rpm</a></p>
<h3 id="11-å®‰è£…ï¼Œå¯åŠ¨å’Œæµ‹è¯•"><a href="#11-å®‰è£…ï¼Œå¯åŠ¨å’Œæµ‹è¯•" class="headerlink" title="11.å®‰è£…ï¼Œå¯åŠ¨å’Œæµ‹è¯•"></a>11.å®‰è£…ï¼Œå¯åŠ¨å’Œæµ‹è¯•</h3><p>å®‰è£…çš„è¿›åº¦å°†æ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚Ambariå®‰è£…ï¼Œå¯åŠ¨ï¼Œå¹¶å¯¹æ¯ä¸ªç»„ä»¶è¿è¡Œä¸€ä¸ªç®€å•çš„æµ‹è¯•ã€‚è¿‡ç¨‹çš„æ€»ä½“çŠ¶æ€æ˜¾ç¤ºåœ¨å±å¹•é¡¶éƒ¨çš„è¿›åº¦æ ä¸­ï¼Œä¸»æœºçš„ä¸»æœºçŠ¶æ€æ˜¾ç¤ºåœ¨ä¸»è¦éƒ¨åˆ†ã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­ä¸è¦åˆ·æ–°æµè§ˆå™¨ã€‚åˆ·æ–°æµè§ˆå™¨å¯èƒ½ä¼šä¸­æ–­è¿›åº¦æŒ‡ç¤ºå™¨ã€‚</p>
<p>è¦æŸ¥çœ‹æ¯ä¸ªä¸»æœºå·²å®Œæˆçš„ä»»åŠ¡çš„å…·ä½“ä¿¡æ¯ï¼Œè¯·å•å‡»Messageç›¸åº”ä¸»æœºåˆ—ä¸­çš„é“¾æ¥ã€‚åœ¨ Taskså¼¹å‡ºçª—å£ä¸­ï¼Œå•å‡»å•ä¸ªä»»åŠ¡ä»¥æŸ¥çœ‹ç›¸å…³çš„æ—¥å¿—æ–‡ä»¶ã€‚æ‚¨å¯ä»¥ä½¿ç”¨Showä¸‹æ‹‰åˆ—è¡¨é€‰æ‹©è¿‡æ»¤æ¡ä»¶ã€‚è¦æŸ¥çœ‹æ›´å¤§ç‰ˆæœ¬çš„æ—¥å¿—å†…å®¹ï¼Œè¯·å•å‡»Openå›¾æ ‡æˆ–å°†å†…å®¹å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œä½¿ç”¨Copyå›¾æ ‡ã€‚</p>
<p><strong>å®‰è£…å®Œæˆæ•ˆæœå›¾:</strong></p>
<p><figure class="figure"><img src="http://hortonassets.s3.amazonaws.com/ambari1_7/ambari002.png" alt=""></figure></p>
<blockquote>
<p>è®©æˆ‘ä»¬ä»å·¦ä¾§æ æˆ–ä¸‹æ‹‰èœå•ä¸­é€‰æ‹©Yarnè¿›å…¥YARNä¿¡æ¯ä¸­å¿ƒã€‚</p>
</blockquote>
<p><figure class="figure"><img src="http://hortonassets.s3.amazonaws.com/ambari1_7/ambari004.png" alt=""></figure></p>
<blockquote>
<p>æˆ‘ä»¬å°†å¼€å§‹æ›´æ–°çº¿ç¨‹å®¹é‡è°ƒåº¦ç­–ç•¥çš„é…ç½®ã€‚</p>
</blockquote>
<p><figure class="figure"><img src="http://hortonassets.s3.amazonaws.com/ambari1_7/ambari005.png" alt=""></figure></p>
<p>å‘ä¸‹æ»šåŠ¨åˆ°<code>Scheduler</code>é¡µé¢çš„éƒ¨åˆ†ã€‚é»˜è®¤å®¹é‡è°ƒåº¦ç­–ç•¥åªæœ‰ä¸€ä¸ªé˜Ÿåˆ—ã€‚</p>
<p><figure class="figure"><img src="http://hortonassets.s3.amazonaws.com/ambari1_7/ambari006.png" alt=""></figure></p>
<p>è®©æˆ‘ä»¬çœ‹çœ‹è°ƒåº¦ç­–ç•¥ã€‚å‘ä¸Šæ»šåŠ¨åˆ°é¡µé¢é¡¶éƒ¨ï¼Œç„¶åç‚¹å‡»å¿«é€Ÿé“¾æ¥ã€‚ç„¶åä»ä¸‹æ‹‰åˆ—è¡¨ä¸­é€‰æ‹©<code>ResourceManager UI</code>ã€‚</p>
<p><figure class="figure"><img src="http://hortonassets.s3.amazonaws.com/ambari1_7/ambari007.png" alt=""></figure></p>
<blockquote>
<p>æ­£å¦‚ä½ å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬åªæœ‰é»˜è®¤ç­–ç•¥ã€‚</p>
</blockquote>
<p><figure class="figure"><img src="http://hortonassets.s3.amazonaws.com/ambari1_7/ambari008.png" alt=""></figure></p>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p>å®‰è£…Ambariå®˜ç½‘åœ°å€<a href="https://docs.hortonworks.com/HDPDocuments/Ambari-2.4.2.0/bk_ambari-installation/content/download_the_ambari_repo_lnx6.html" target="_blank" rel="external">install Ambari</a><br><a href="https://cwiki.apache.org/confluence/display/AMBARI/Installation+Guide+for+Ambari+2.4.2" target="_blank" rel="external">ç¼–è¯‘å®‰è£…Ambari 2.4.2å®‰è£…æŒ‡å—</a></p>

	

	

</article>





	<span class="different-posts">ğŸ“– <a href="/page/5">more posts</a> ğŸ“–</span>



	</main>

	<footer class="footer">
	<div class="footer-content">
		
	      <div class="footer__element">
	<p>Hi there, <br />welcome to my Blog glad you found it. Have a look around, will you?</p>
</div>

	    
	      <div class="footer__element">
	<h5>Check out</h5>
	<ul class="footer-links">
		<li class="footer-links__link"><a href="/archives">Archive</a></li>
		
		  <li class="footer-links__link"><a href="/atom.xml">RSS</a></li>
	    
		<li class="footer-links__link"><a href="/about">about page</a></li>
		<li class="footer-links__link"><a href="/tags">Tags</a></li>
		<li class="footer-links__link"><a href="/categories">Categories</a></li>
	</ul>
</div>

	    

		<div class="footer-credit">
			<span>Â© 2017 Yancy | Powered by <a href="http://blog.yancy.cc/">Yancy</a> | Theme <a href="https://github.com/yangcvo">Yancy_GitHub</a></span>
		</div>

	</div>


</footer>



</body>

</html>
