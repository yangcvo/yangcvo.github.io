<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="theme-color" content="#33474d">
	<title>Yancy&#39;s blog</title>
	<link rel="stylesheet" href="/css/style.css" />
	
      <link rel="alternate" href="/atom.xml" title="Yancy&#39;s blog" type="application/atom+xml">
    
</head>

<body>

	<header class="header">
		<nav class="header__nav">
			
				<a href="/" class="header__link">Home</a>
			
				<a href="/tags" class="header__link">Tags</a>
			
				<a href="/archives" class="header__link">ARCHIVES</a>
			
				<a href="/about/About" class="header__link">ABOUT</a>
			
				<a href="http://weibo.com/yangcvo" class="header__link">Weibo</a>
			
				<a href="/atom.xml" class="header__link">RSS</a>
			
		</nav>
		<h1 class="header__title"><a href="/">Yancy&#39;s blog</a></h1>
		<h2 class="header__subtitle">SIMPLICITY IS PREREQUISITE FOR  RELIABILITY</h2>
	</header>

	<main>
		
	<span class="different-posts different-posts_earlier">ğŸ“– <a href="/page/10">earlier posts</a> ğŸ“–</span>




	<article>
	
		<h1><a href="/2015/07/23/è¿ç»´ç¬”è®°/CDNåŠ é€ŸåŠ©åŠ›é«˜å¹¶å‘ç½‘ç«™æ¶æ„/">CDNåŠ é€ŸåŠ©åŠ›é«˜å¹¶å‘ç½‘ç«™æ¶æ„</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2015-07-23</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/Framework/">Framework</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/CDN/">CDN</a>
			</span>
		
	</div>

	

	
		<h2 id="CDNåŠ é€ŸåŠ©åŠ›é«˜å¹¶å‘ç½‘ç«™æ¶æ„"><a href="#CDNåŠ é€ŸåŠ©åŠ›é«˜å¹¶å‘ç½‘ç«™æ¶æ„" class="headerlink" title="CDNåŠ é€ŸåŠ©åŠ›é«˜å¹¶å‘ç½‘ç«™æ¶æ„"></a>CDNåŠ é€ŸåŠ©åŠ›é«˜å¹¶å‘ç½‘ç«™æ¶æ„</h2><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/CDN1.png" alt=""></figure></p>
<h2 id="æ¶æ„è¯´æ˜ï¼š"><a href="#æ¶æ„è¯´æ˜ï¼š" class="headerlink" title="æ¶æ„è¯´æ˜ï¼š"></a>æ¶æ„è¯´æ˜ï¼š</h2><p>ç”¨æˆ·é€šè¿‡äº’è”ç½‘è®¿é—®ç½‘ç«™éœ€è¦ç»è¿‡çš„èŠ‚ç‚¹å¦‚ä¸‹ï¼š</p>
<h4 id="ä¸€ã€è¦é€šè¿‡åŸŸåè§£æ"><a href="#ä¸€ã€è¦é€šè¿‡åŸŸåè§£æ" class="headerlink" title="ä¸€ã€è¦é€šè¿‡åŸŸåè§£æ"></a>ä¸€ã€è¦é€šè¿‡åŸŸåè§£æ</h4><p>åœ¨åŸŸåè§£æå¤„æœ‰ä¸¤ç§æ–¹å¼<br>1ã€è‡ªå»ºï¼Œè‡ªå»ºéœ€è¦åœ¨åŸŸåè§£æå‰æ¶è®¾é˜²ç«å¢™ã€‚</p>
<p>2ã€ä½¿ç”¨ç°æœ‰çš„åŸŸåè§£ææä¾›å•†ï¼Œéœ€è¦è®¾ç½®æˆCNAME,å…¶å®å°±æ˜¯å¦ä¸€ä¸ªåŸŸåè§£æï¼Œè¿›è¡Œè·³è½¬ã€‚åœ¨åˆšå¼€å§‹çš„æ—¶å€™å»ºè®®å…ˆç”¨CNAMEæ–¹å¼ï¼Œéƒ¨ç½²ä¸å½±å“ç”¨æˆ·ç°æœ‰æ–¹å¼ï¼Œå®¹æ˜“è¢«ç”¨æˆ·æ¥å—ï¼Œè€Œä¸”ä¸ç”¨æš‚æ—¶ä¸ç”¨æ‹…å¿ƒç¬¬ä¸€çº§dnsçš„é—®é¢˜ã€‚</p>
<p>æ€»ä¹‹ï¼Œå¦‚æœè¦å»ºè®¾idcåŠ é€Ÿï¼Œé˜²æ­¢ddosæ”»å‡»ä¹‹ç±»çš„æœåŠ¡ï¼ŒåŸŸåè§£ææœåŠ¡ä¸€å®šè¦æä¾›ï¼Œä¸ç®¡æ˜¯ç›´æ¥æä¾›dnsæœåŠ¡è¿˜æ˜¯é—´æ¥é€šè¿‡cnameè½¬å‘ã€‚<br>é‡Œé¢çš„ä¸»è¦æŠ€æœ¯ï¼Œæ˜¯é€šè¿‡ç”¨æˆ·è¯·æ±‚çš„ipæ¥å¾—åˆ°ç¦»ç”¨æˆ·æœ€è¿‘çš„æœåŠ¡å™¨çš„åœ°å€ï¼Œå¹¶é€šè¿‡å®ƒæ¥æä¾›æœåŠ¡ã€‚å¦‚æœè¦è¿›è¡Œå®‰å…¨é˜²æŠ¤ï¼Œæ¯”å¦‚sqlæ³¨å…¥æ£€æŸ¥ï¼Œjsè·¨ç«™è„šæœ¬ç­‰å¯ä»¥åœ¨è¿™ä¸€å±‚è¿›è¡Œå¤„ç†ã€‚</p>
<h4 id="äºŒã€æä¾›è™šæ‹Ÿæœº"><a href="#äºŒã€æä¾›è™šæ‹Ÿæœº" class="headerlink" title="äºŒã€æä¾›è™šæ‹Ÿæœº"></a>äºŒã€æä¾›è™šæ‹Ÿæœº</h4><p>è™šæ‹Ÿæœºç°åœ¨ä¸»æµæœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€æ˜¯è™šæ‹Ÿä¸»æœºï¼Œä¸»è¦çš„è½¯ä»¶æœ‰å¼€æºçš„openvzï¼Œå•†ç”¨çš„Virtuozzoç­‰,å¦ä¸€ç±»æ˜¯è™šæ‹Ÿæœºå¦‚vmwareã€xenã€kvmç­‰ï¼Œè¿™ç±»æä¾›è™šæ‹Ÿæ“ä½œç³»ç»Ÿï¼Œå¯ä»¥æ˜¯å¼‚æ„çš„ã€‚ä»–ä»¬ä¸¤ä¸ªçš„å¯¹æ¯”ä¸»è¦æ˜¯è™šæ‹Ÿä¸»æœºçš„åˆ©ç”¨ç‡æ¯”è¾ƒé«˜ï¼Œå¯ä»¥ä¸€å°ä¸»æµpcserverå¯ä»¥è™šæ‹Ÿå‡ åä¸ªåˆ°ä¸Šç™¾ä¸ªè™šæ‹Ÿä¸»æœºï¼Œä½†åªèƒ½æ˜¯åŒä¸€ç±»æ“ä½œç³»ç»Ÿã€‚è™šæ‹Ÿæœºçš„è¿è¡Œæ•ˆç‡ç›¸å¯¹ä½å¾ˆå¤šï¼Œä¸€èˆ¬ä¸»æµpcserverä¹Ÿå°±åå‡ ä¸ªå·¦å³ã€‚ä»–çš„æœ‰ç‚¹æ˜¯å¼‚æ„æ“ä½œç³»ç»Ÿï¼Œå¤‡ä»½ç®¡ç†æ¯”è¾ƒæ–¹ä¾¿ã€‚å½“ç„¶åœ¨å»ºè®¾çš„æ—¶å€™å¯ä»¥å…ˆç”¨è™šæ‹Ÿæœºï¼Œç„¶ååœ¨è™šæ‹Ÿæœºä¸Šå»ºè®¾è™šæ‹Ÿä¸»æœºã€‚</p>
<p>å¦‚æœè¦æä¾›å¯¹å¤–æœåŠ¡ï¼Œipåœ°å€æ˜¯æ¯”ä¸å¯å°‘çš„ï¼Œå¯¹äºä¸€ä¸ªç”¨æˆ·æ¥è¯´ï¼Œä¸€ä¸ªåŸŸåéœ€è¦å‡ ä¸ªç‚¹ï¼Œå°±éœ€è¦å‡ ä¸ªipã€‚</p>
<h4 id="ä¸‰ã€LVSé›†ç¾¤"><a href="#ä¸‰ã€LVSé›†ç¾¤" class="headerlink" title="ä¸‰ã€LVSé›†ç¾¤"></a>ä¸‰ã€LVSé›†ç¾¤</h4><p>ç”±äºè¦æä¾›åŠ é€Ÿç­‰æœåŠ¡ï¼Œç”¨æˆ·ç›´æ¥ä½¿ç”¨çš„openvzè™šæ‹Ÿä¸»æœºçš„æ€§èƒ½å’Œæ•ˆç‡ä¸€èˆ¬ä¸å¤§ï¼Œåˆè¦æä¾›é«˜å¯ç”¨æ€§ï¼Œæ‰€ä»¥éœ€è¦é€šè¿‡è™šæ‹Ÿä¸»æœºè®¿é—®lvsé›†ç¾¤çš„æ•°æ®ï¼Œé€šè¿‡lvsé›†ç¾¤æ¥æä¾›æœåŠ¡ã€‚</p>
<h4 id="å››ã€Squid"><a href="#å››ã€Squid" class="headerlink" title="å››ã€Squid"></a>å››ã€Squid</h4><p>Squidæ˜¯ç¼“å­˜ï¼Œå°¤å…¶æ˜¯å¯¹é™æ€é¡µé¢å’Œæ–‡ä»¶æœ‰å¾ˆå¥½åŠ é€Ÿæ•ˆæœã€‚sinaã€sohuç­‰éƒ½ç”¨å®ƒæ¥åšç¼“å­˜åŠ é€Ÿã€‚</p>
<h4 id="äº”ã€Nginxâ€‹"><a href="#äº”ã€Nginxâ€‹" class="headerlink" title="äº”ã€Nginxâ€‹"></a>äº”ã€Nginxâ€‹</h4><p>Nginxä¸»è¦æä¾›åå‘ä»£ç†åŠŸèƒ½ï¼Œå½“é€šè¿‡ä¿®æ”¹æˆ–è€…æ›´æ–°äº†é¡µé¢ï¼Œç”±nginxæ¥è´Ÿè´£æ›´æ–°ç¼“å­˜ã€‚è¿˜æœ‰å°±æ˜¯åŠ¨æ€ç½‘ç«™ï¼Œä¹Ÿæ˜¯ç”±nginxæ¥æä¾›æœåŠ¡ã€‚</p>
<p>Nginxå’Œsqidéƒ½å¯ä»¥æä¾›é™æ€ç¼“å­˜åŠŸèƒ½ï¼Œä¸¤è€…è¿˜è¦ç»“åˆèµ·æ¥å‘æŒ¥æœ€å¤§æ•ˆæœã€‚å¦‚æœè¦è¿›è¡Œå®‰å…¨é˜²æŠ¤ï¼Œæ¯”å¦‚sqlæ³¨å…¥æ£€æŸ¥ï¼Œjsè·¨ç«™è„šæœ¬ç­‰å¯ä»¥åœ¨è¿™ä¸€å±‚è¿›è¡Œå¤„ç†ã€‚<br>é˜²DDOS</p>
<h4 id="å…­ã€è‡ªåŠ¨åŒ–å·¥å…·-Dockerè¿è¡Œ"><a href="#å…­ã€è‡ªåŠ¨åŒ–å·¥å…·-Dockerè¿è¡Œ" class="headerlink" title="å…­ã€è‡ªåŠ¨åŒ–å·¥å…·+Dockerè¿è¡Œ"></a>å…­ã€è‡ªåŠ¨åŒ–å·¥å…·+Dockerè¿è¡Œ</h4><p>Saltstask è‡ªåŠ¨åŒ–å·¥å…·æ‰¹é‡åˆå§‹åŒ–è„šæœ¬æ›´æ–°ç›‘æ§è„šæœ¬ï¼Œå¢åˆ æ”¹æŸ¥æ·»åŠ ç¼“å­˜æœºåˆ¶ã€‚ä¸Šç™¾å°æœåŠ¡å™¨èŠ‚çœæˆ‘ä»¬æ“ä½œæ—¶é—´ï¼Œç‰©ç†æœºè¿è¡ŒDockerç¨‹åºã€‚</p>
<h2 id="é˜²ddosçš„ä¸»è¦å†…å®¹ç”±ä¸¤ä¸ªæ–¹é¢ï¼š"><a href="#é˜²ddosçš„ä¸»è¦å†…å®¹ç”±ä¸¤ä¸ªæ–¹é¢ï¼š" class="headerlink" title="é˜²ddosçš„ä¸»è¦å†…å®¹ç”±ä¸¤ä¸ªæ–¹é¢ï¼š"></a>é˜²ddosçš„ä¸»è¦å†…å®¹ç”±ä¸¤ä¸ªæ–¹é¢ï¼š</h2><h4 id="ä¸€ã€å¸¦å®½"><a href="#ä¸€ã€å¸¦å®½" class="headerlink" title="ä¸€ã€å¸¦å®½"></a>ä¸€ã€å¸¦å®½</h4><p>è¿™ä¸ªæ˜¯å¾ˆé‡è¦çš„åœ°æ–¹ï¼Œæ®æˆ‘ç°åœ¨ä»ç½‘ä¸Šå¾—åˆ°çš„èµ„æ–™ï¼Œç°åœ¨ä¸»æµçš„idcæœºæˆ¿ä¸€èˆ¬æœ€å¤§æä¾›ç‹¬ç«‹ç™¾å…†ç«¯å£ï¼Œè€Œä¸”ä»·æ ¼ä¸è²ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹å¯ä»¥æœºæŸœç§Ÿç”¨ã€‚è¿™ä¸ªè¿˜éœ€è¦è°ƒç ”æ˜¯å¦å¯ä»¥æä¾›æ›´å¤§çš„å¸¦å®½ã€‚</p>
<h4 id="äºŒã€é˜²ç«å¢™è®¾å¤‡"><a href="#äºŒã€é˜²ç«å¢™è®¾å¤‡" class="headerlink" title="äºŒã€é˜²ç«å¢™è®¾å¤‡"></a>äºŒã€é˜²ç«å¢™è®¾å¤‡</h4><p>éœ€è¦åœ¨æ¥å…¥å£éƒ¨ç½²é˜²ç«å¢™ï¼Œéœ€è¦æ ¹æ®idcæ¥å£ç«¯å£æ¥ç¡®å®šå®¹é‡ï¼Œæœ‰çš„idcæœºæˆ¿ä¹Ÿæä¾›æ­¤æœåŠ¡ã€‚</p>
<h4 id="ä¸‰ã€æµé‡ç‰µå¼•è®¾å¤‡"><a href="#ä¸‰ã€æµé‡ç‰µå¼•è®¾å¤‡" class="headerlink" title="ä¸‰ã€æµé‡ç‰µå¼•è®¾å¤‡"></a>ä¸‰ã€æµé‡ç‰µå¼•è®¾å¤‡</h4><p>è¿™ä¸ªä¸€èˆ¬idcæœºæˆ¿ä¼šæä¾›æ­¤æœåŠ¡ï¼Œè¿™ä¸ªæ ¹æ®éœ€è¦æ˜¯å¦éœ€è¦è´­ä¹°ã€‚</p>
<h4 id="äº¤æµå­¦ä¹ ï¼š"><a href="#äº¤æµå­¦ä¹ ï¼š" class="headerlink" title="äº¤æµå­¦ä¹ ï¼š"></a>äº¤æµå­¦ä¹ ï¼š</h4><p>ğŸ§  Linux shell_é«˜çº§è¿ç»´æ´¾: <code>459096184</code>    åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)<br>ğŸ§  BigData-Exchange School : <code>521621407</code>  åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥</p>
<p>ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚</p>

	

	

</article>




	<article>
	
		<h1><a href="/2015/04/01/è¿ç»´å®‰å…¨/ä½¿ç”¨AIDEåšLinuxé«˜çº§å…¥ä¾µæ£€æµ‹æ–‡ä»¶ç›‘æ§/">ä½¿ç”¨AIDEåšLinuxé«˜çº§å…¥ä¾µæ£€æµ‹æ–‡ä»¶ç›‘æ§</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2015-04-01</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/è¿ç»´å®‰å…¨/">è¿ç»´å®‰å…¨</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Operation-safety/">Operation safety</a>
			</span>
		
	</div>

	

	
		<h2 id="1ã€aideä»‹ç»"><a href="#1ã€aideä»‹ç»" class="headerlink" title="1ã€aideä»‹ç»"></a>1ã€aideä»‹ç»</h2><blockquote>
<p>AIDE(Adevanced Intrusion Detection Environment,é«˜çº§å…¥ä¾µæ£€æµ‹ç¯å¢ƒ)æ˜¯ä¸ªå…¥ä¾µæ£€æµ‹å·¥å…·ï¼Œä¸»è¦ç”¨é€”æ˜¯æ£€æŸ¥æ–‡æœ¬çš„å®Œæ•´æ€§ã€‚</p>
<p>AIDEèƒ½å¤Ÿæ„é€ ä¸€ä¸ªæŒ‡å®šæ–‡æ¡£çš„æ•°æ®åº“ï¼Œä»–ä½¿ç”¨aide.confä½œä¸ºå…¶é…ç½®æ–‡æ¡£ã€‚AIDEæ•°æ®åº“èƒ½å¤Ÿä¿å­˜æ–‡æ¡£çš„å„ç§å±æ€§ï¼ŒåŒ…æ‹¬ï¼šæƒé™(permission)ã€ç´¢å¼•èŠ‚ç‚¹åºå·(inode number)ã€æ‰€å±ç”¨æˆ·(user)ã€æ‰€å±ç”¨æˆ·ç»„(group)ã€æ–‡æ¡£å¤§å°ã€æœ€åä¿®æ”¹æ—¶é—´(mtime)ã€åˆ›å»ºæ—¶é—´(ctime)ã€æœ€åè®¿é—®æ—¶é—´(atime)ã€å¢åŠ çš„å¤§å°è¿åŒè¿æ¥æ•°ã€‚AIDEè¿˜èƒ½å¤Ÿä½¿ç”¨ä¸‹åˆ—ç®—æ³•ï¼šsha1ã€md5ã€rmd160ã€tigerï¼Œä»¥å¯†æ–‡å½¢å¼å»ºç«‹æ¯ä¸ªæ–‡æ¡£çš„æ ¡éªŒç æˆ–æ•£åˆ—å·ã€‚</p>
<p>å¸¸è§çš„å…¥ä¾µæ£€æµ‹è½¯ä»¶ï¼š tripwireâ€“æ“ä½œæ¯”è¾ƒå¤æ‚,aideâ€“ç”¨ä»¥ä»£æ›¿tripwire,æ¯”è¾ƒç®€å•.</p>
</blockquote>
<h3 id="ç³»ç»Ÿç¯å¢ƒï¼š"><a href="#ç³»ç»Ÿç¯å¢ƒï¼š" class="headerlink" title="ç³»ç»Ÿç¯å¢ƒï¼š"></a>ç³»ç»Ÿç¯å¢ƒï¼š</h3><p>ã€€ã€€RHEL 6.2 [2.6.32-220.el6.i686]</p>
<p>ã€€ã€€è½¯ä»¶ç¯å¢ƒï¼š</p>
<h3 id="2ã€aideå®‰è£…-é…ç½®ä½¿ç”¨"><a href="#2ã€aideå®‰è£…-é…ç½®ä½¿ç”¨" class="headerlink" title="2ã€aideå®‰è£… é…ç½®ä½¿ç”¨"></a>2ã€aideå®‰è£… é…ç½®ä½¿ç”¨</h3><p>yum rpmäºŒè¿›åˆ¶å®‰è£…</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install aide</div></pre></td></tr></table></figure>
<blockquote>
<p>æˆ‘çš„é…ç½®æ–‡ä»¶</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div></pre></td><td class="code"><pre><div class="line">mv /etc/aide.conf /etc/aide.conf.bak</div><div class="line">vim /etc/aide.conf</div><div class="line"> </div><div class="line"></div><div class="line"><span class="comment"># Example configuration file for AIDE.</span></div><div class="line">@@define DBDIR /var/lib/aide <span class="comment">#åŸºå‡†æ•°æ®åº“ç›®å½•</span></div><div class="line">@@define LOGDIR /var/<span class="built_in">log</span>/aide <span class="comment">#æ—¥å¿—ç›®å½•</span></div><div class="line"> </div><div class="line"></div><div class="line"><span class="comment"># The location of the database to be read.</span></div><div class="line">database=file:@@&#123;DBDIR&#125;/aide.db.gz <span class="comment">#åŸºç¡€æ•°æ®åº“æ–‡ä»¶</span></div><div class="line"> </div><div class="line"><span class="comment"># The location of the database to be written.    #database_out=sql:host:port:database:login_name:passwd:table</span></div><div class="line"><span class="comment">#database_out=file:aide.db.new</span></div><div class="line">database_out=file:@@&#123;DBDIR&#125;/aide.db.new.gz <span class="comment">#æ›´æ–°æ•°æ®åº“æ–‡ä»¶</span></div><div class="line"> </div><div class="line"><span class="comment"># Whether to gzip the output to database</span></div><div class="line">gzip_dbout=yes</div><div class="line"> </div><div class="line"><span class="comment"># Default.</span></div><div class="line">verbose=5</div><div class="line"> </div><div class="line">report_url=file:@@&#123;LOGDIR&#125;/aide.log</div><div class="line">report_url=stdout</div><div class="line"><span class="comment">#report_url=stderr</span></div><div class="line"><span class="comment">#NOT IMPLEMENTED report_url=mailto:root@foo.com</span></div><div class="line"><span class="comment">#NOT IMPLEMENTED report_url=syslog:LOG_AUTH</span></div><div class="line"> </div><div class="line"><span class="comment"># These are the default rules.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#p:      permissions</span></div><div class="line"><span class="comment">#i:      inode:</span></div><div class="line"><span class="comment">#n:      number of links</span></div><div class="line"><span class="comment">#u:      user</span></div><div class="line"><span class="comment">#g:      group</span></div><div class="line"><span class="comment">#s:      size</span></div><div class="line"><span class="comment">#b:      block count</span></div><div class="line"><span class="comment">#m:      mtime</span></div><div class="line"><span class="comment">#a:      atime</span></div><div class="line"><span class="comment">#c:      ctime</span></div><div class="line"><span class="comment">#S:      check for growing size</span></div><div class="line"><span class="comment">#acl:           Access Control Lists</span></div><div class="line"><span class="comment">#selinux        SELinux security context</span></div><div class="line"><span class="comment">#xattrs:        Extended file attributes</span></div><div class="line"><span class="comment">#md5:    md5 checksum</span></div><div class="line"><span class="comment">#sha1:   sha1 checksum</span></div><div class="line"><span class="comment">#sha256:        sha256 checksum</span></div><div class="line"><span class="comment">#sha512:        sha512 checksum</span></div><div class="line"><span class="comment">#rmd160: rmd160 checksum</span></div><div class="line"><span class="comment">#tiger:  tiger checksum</span></div><div class="line"> </div><div class="line"><span class="comment">#haval:  haval checksum (MHASH only)</span></div><div class="line"><span class="comment">#gost:   gost checksum (MHASH only)</span></div><div class="line"><span class="comment">#crc32:  crc32 checksum (MHASH only)</span></div><div class="line"><span class="comment">#whirlpool:     whirlpool checksum (MHASH only)</span></div><div class="line"> </div><div class="line"> <span class="comment">#R:              p+i+n+u+g+s+m+c+acl+selinux+xattrs+md5</span></div><div class="line"><span class="comment">#L:             p+i+n+u+g+acl+selinux+xattrs</span></div><div class="line"><span class="comment">#E:             Empty group</span></div><div class="line"><span class="comment">#&gt;:             Growing logfile       p+u+g+i+n+S+acl+selinux+xattrs</span></div><div class="line">R = p+i+n+u+g+s+m+c+acl+selinux+xattrs+md5</div><div class="line">L = p+i+n+u+g+acl+selinux+xattrs</div><div class="line">&gt; = p+u+g+i+n+S+acl+selinux+xattrs</div><div class="line"> </div><div class="line"> </div><div class="line"><span class="comment"># You can create custom rules like this.</span></div><div class="line"><span class="comment"># With MHASH...</span></div><div class="line"><span class="comment"># ALLXTRAHASHES =      sha1+rmd160+sha256+sha512+whirlpool+tiger+haval+gost+crc32</span></div><div class="line">ALLXTRAHASHES = sha1+rmd160+sha256+sha512+tiger</div><div class="line"><span class="comment"># Everything but access time (Ie. all changes)</span></div><div class="line">EVERYTHING = R+ALLXTRAHASHES</div><div class="line"> </div><div class="line"><span class="comment"># Sane, with multiple hashes</span></div><div class="line"><span class="comment"># NORMAL = R+rmd160+sha256+whirlpool</span></div><div class="line">NORMAL = R+rmd160+sha256</div><div class="line"> </div><div class="line"><span class="comment"># For directories, don't bother doing hashes</span></div><div class="line">DIR = p+i+n+u+g+acl+selinux+xattrs</div><div class="line"> </div><div class="line"> <span class="comment"># Access control only</span></div><div class="line"> PERMS = p+i+u+g+acl+selinux</div><div class="line"> </div><div class="line"> <span class="comment"># Logfile are special, in that they often change</span></div><div class="line"> LOG = &gt;</div><div class="line"> </div><div class="line"> <span class="comment"># Just do md5 and sha256 hashes</span></div><div class="line"> LSPP = R+sha256</div><div class="line"> </div><div class="line"> <span class="comment"># Some files get updated automatically, so the     inode/ctime/mtime change</span></div><div class="line"> <span class="comment"># but we want to know when the data inside them   changes</span></div><div class="line"> DATAONLY =     p+n+u+g+s+acl+selinux+xattrs+md5+sha256+rmd160+tiger</div><div class="line"> </div><div class="line"> <span class="comment"># Next decide what directories/files you want in the database.</span></div><div class="line"> </div><div class="line">/boot   NORMAL</div><div class="line">/bin    NORMAL</div><div class="line">/sbin   NORMAL</div><div class="line">/lib    NORMAL</div><div class="line">/lib64  NORMAL</div><div class="line">/opt    NORMAL</div><div class="line">/usr    NORMAL</div><div class="line">/root   NORMAL</div><div class="line"><span class="comment"># These are too volatile</span></div><div class="line">!/usr/src</div><div class="line">!/usr/tmp</div><div class="line">!/usr/share <span class="comment">#é€šè¿‡æ–‡ä»¶è·¯å¾„å‰é¢åŠ æ„Ÿå¹å· ! æ’é™¤è¿™ä¸ªè·¯å¾„çš„ç›‘æ§,è¯·è‡ªå®šä¹‰</span></div><div class="line"> <span class="comment"># Check only permissions, inode, user and group for /etc, but</span></div><div class="line"><span class="comment"># cover some important files closely.</span></div><div class="line">/etc    PERMS</div><div class="line">!/etc/mtab</div><div class="line"> <span class="comment"># Ignore backup files</span></div><div class="line">!/etc/.*~</div><div class="line">/etc/exports  NORMAL</div><div class="line">/etc/fstab    NORMAL</div><div class="line">/etc/passwd   NORMAL</div><div class="line">/etc/group    NORMAL</div><div class="line">/etc/gshadow  NORMAL</div><div class="line">/etc/shadow   NORMAL</div><div class="line">/etc/security/opasswd   NORMAL</div><div class="line"> </div><div class="line">/etc/hosts.allow   NORMAL</div><div class="line">/etc/hosts.deny    NORMAL</div><div class="line"> </div><div class="line">/etc/sudoers NORMAL</div><div class="line">/etc/skel NORMAL</div><div class="line"> </div><div class="line">/etc/logrotate.d NORMAL</div><div class="line"> </div><div class="line">/etc/resolv.conf DATAONLY</div><div class="line"> </div><div class="line">/etc/nscd.conf NORMAL</div><div class="line">/etc/securetty NORMAL</div><div class="line"> </div><div class="line"><span class="comment"># Shell/X starting files</span></div><div class="line">/etc/profile NORMAL</div><div class="line">/etc/bashrc NORMAL</div><div class="line">/etc/bash_completion.d/ NORMAL</div><div class="line">/etc/login.defs NORMAL</div><div class="line">/etc/zprofile NORMAL</div><div class="line">/etc/zshrc NORMAL</div><div class="line">/etc/zlogin NORMAL</div><div class="line">/etc/zlogout NORMAL</div><div class="line">/etc/profile.d/ NORMAL</div><div class="line">/etc/X11/ NORMAL</div><div class="line">  </div><div class="line"><span class="comment"># Pkg manager</span></div><div class="line">/etc/yum.conf NORMAL</div><div class="line">/etc/yumex.conf NORMAL</div><div class="line">/etc/yumex.profiles.conf NORMAL</div><div class="line">/etc/yum/ NORMAL</div><div class="line"> /etc/yum.repos.d/ NORMAL</div><div class="line"> </div><div class="line"> /var/<span class="built_in">log</span>   LOG</div><div class="line"> /var/run/utmp LOG</div><div class="line"> </div><div class="line"> <span class="comment"># This gets new/removes-old filenames daily</span></div><div class="line">!/var/<span class="built_in">log</span>/sa</div><div class="line"> <span class="comment"># As we are checking it, we've truncated     yesterdays size to zero.</span></div><div class="line"> !/var/<span class="built_in">log</span>/aide.log</div><div class="line"> </div><div class="line"><span class="comment"># LSPP rules...</span></div><div class="line"><span class="comment"># AIDE produces an audit record, so this becomes       # /var/log/audit/ LSPP</span></div><div class="line">/etc/audit/ LSPP</div><div class="line">/etc/libaudit.conf LSPP</div><div class="line">/usr/sbin/stunnel LSPP</div><div class="line">/var/spool/at LSPP</div><div class="line">/etc/at.allow LSPP</div><div class="line">/etc/at.deny LSPP</div><div class="line">/etc/cron.allow LSPP</div><div class="line">/etc/cron.deny LSPP</div><div class="line">/etc/cron.d/ LSPP</div><div class="line">/etc/cron.daily/ LSPP</div><div class="line">/etc/cron.hourly/ LSPP</div><div class="line">/etc/cron.monthly/ LSPP</div><div class="line">/etc/cron.weekly/ LSPP</div><div class="line">/etc/crontab LSPP</div><div class="line">/var/spool/cron/root LSPP</div><div class="line"> </div><div class="line">/etc/login.defs LSPP</div><div class="line">/etc/securetty LSPP</div><div class="line">/var/<span class="built_in">log</span>/faillog LSPP</div><div class="line">/var/<span class="built_in">log</span>/lastlog LSPP</div><div class="line"> </div><div class="line">/etc/hosts LSPP</div><div class="line">/etc/sysconfig LSPP</div><div class="line"> </div><div class="line">/etc/inittab LSPP</div><div class="line">/etc/grub/ LSPP</div><div class="line">/etc/rc.d LSPP</div><div class="line"> </div><div class="line">/etc/ld.so.conf LSPP</div><div class="line"> </div><div class="line"> /etc/localtime LSPP</div><div class="line"> </div><div class="line">/etc/sysctl.conf LSPP</div><div class="line"> </div><div class="line">/etc/modprobe.conf LSPP</div><div class="line"> </div><div class="line">/etc/pam.d LSPP</div><div class="line">/etc/security LSPP</div><div class="line">/etc/aliases LSPP</div><div class="line">/etc/postfix LSPP</div><div class="line"> </div><div class="line">/etc/ssh/sshd_config LSPP</div><div class="line"> /etc/ssh/ssh_config LSPP</div><div class="line"> </div><div class="line">/etc/stunnel LSPP</div><div class="line"> </div><div class="line">/etc/vsftpd.ftpusers LSPP</div><div class="line"> /etc/vsftpd LSPP</div><div class="line"> </div><div class="line">/etc/issue LSPP</div><div class="line">/etc/issue.net LSPP</div><div class="line">  </div><div class="line">/etc/cups LSPP</div><div class="line"> </div><div class="line"><span class="comment"># With AIDE's default verbosity level of 5, these would give lots of</span></div><div class="line"><span class="comment"># warnings upon tree traversal. It might change with  future version.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#=/lost\+found    DIR</span></div><div class="line"><span class="comment">#=/home           DIR</span></div><div class="line"> </div><div class="line"><span class="comment"># Ditto /var/log/sa reason...</span></div><div class="line">!/var/<span class="built_in">log</span>/and-httpd</div><div class="line"> </div><div class="line"><span class="comment"># Admins dot files constantly change, just check perms</span></div><div class="line">/root/\..* PERMS</div></pre></td></tr></table></figure>
<h4 id="ä¸‹ä¸€æ­¥ï¼š"><a href="#ä¸‹ä¸€æ­¥ï¼š" class="headerlink" title="ä¸‹ä¸€æ­¥ï¼š"></a>ä¸‹ä¸€æ­¥ï¼š</h4><p> åˆå§‹åŒ–ç›‘æ§æ•°æ®åº“(è¿™éœ€è¦ä¸€äº›æ—¶é—´)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">  /usr/sbin/aide -c /etc/aide.conf --init</div><div class="line">``` </div><div class="line">æŠŠå½“å‰åˆå§‹åŒ–çš„æ•°æ®åº“ä½œä¸ºå¼€å§‹çš„åŸºç¡€æ•°æ®åº“</div><div class="line"></div><div class="line">``` bash</div><div class="line">     cp /var/lib/aide/aide.db.new.gz       /var/lib/aide/aide.db.gz</div></pre></td></tr></table></figure>
<p>å¦‚æœæ˜¯æ­£å¸¸çš„æ”¹åŠ¨ æ›´æ–°æ”¹åŠ¨åˆ°åŸºç¡€æ•°æ®åº“</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">aide --update</div><div class="line"><span class="built_in">cd</span> /var/lib/aide/</div></pre></td></tr></table></figure>
<p>è¦†ç›–æ›¿æ¢æ—§çš„æ•°æ®åº“</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mv aide.db.new.gz aide.db.gz</div></pre></td></tr></table></figure>
<p>åœ¨ç»ˆç«¯ä¸­æŸ¥çœ‹æ£€æµ‹ç»“æœ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">aide --check</div></pre></td></tr></table></figure>
<p>æ£€æŸ¥æ–‡ä»¶æ”¹åŠ¨ ä¿å­˜åˆ°æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">    aide --check --report=file:/tmp/aide-report-`date +%Y%m%d`.txt</div><div class="line">``` </div><div class="line">å®šæ—¶ä»»åŠ¡æ‰§è¡Œaideæ£€æµ‹æŠ¥å‘Šå’Œè‡ªåŠ¨é‚®ä»¶å‘é€aideæ£€æµ‹æŠ¥å‘Š(å¦‚æœæ²¡æœ‰mail, yum install mail,è¿˜éœ€è¦æœ‰æœ¬åœ°é‚®ä»¶æœåŠ¡æ”¯æŒ, yum install sendmail;/etc/init.d/sendmail start)</div><div class="line">  </div><div class="line">``` bash</div><div class="line">    crontab <span class="_">-e</span></div><div class="line">    00 02 * * * /usr/sbin/aide -C -V4 | /bin/mail <span class="_">-s</span> <span class="string">"AIDE REPORT <span class="variable">$(date +%Y%m%d)</span>"</span>  root@localhost</div></pre></td></tr></table></figure>
<h3 id="5ã€å‚è€ƒ"><a href="#5ã€å‚è€ƒ" class="headerlink" title="5ã€å‚è€ƒ"></a>5ã€å‚è€ƒ</h3><ul>
<li><p>å®˜ç½‘ :<a href="http://aide.sourceforge.net/" target="_blank" rel="external">http://aide.sourceforge.net/</a></p>
</li>
<li><p>AIDE â€“Linuxé«˜çº§å…¥ä¾µæ£€æµ‹ <a href="http://gupt12.blog.51cto.com/7651206/1263183" target="_blank" rel="external">http://gupt12.blog.51cto.com/7651206/1263183</a></p>
</li>
<li><p>å‚è€ƒï¼š<a href="http://www.iamle.com/archives/1664.html" target="_blank" rel="external">http://www.iamle.com/archives/1664.html</a></p>
</li>
</ul>

	

	

</article>




	<article>
	
		<h1><a href="/2014/10/21/æ€§èƒ½ç›‘æ§/cacti/äº†è§£Cactiç›‘æ§å®‰è£…ä¸é…ç½®/">äº†è§£Cactiç›‘æ§å®‰è£…ä¸é…ç½®.md</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2014-10-21</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/monitoring/">monitoring</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Cacti-monitoring/">Cacti monitoring</a>
			</span>
		
	</div>

	

	
		<h3 id="ä»€ä¹ˆæ˜¯Cacti"><a href="#ä»€ä¹ˆæ˜¯Cacti" class="headerlink" title="ä»€ä¹ˆæ˜¯Cacti?"></a>ä»€ä¹ˆæ˜¯Cacti?</h3><p>Cactiï¼Œ åœ¨è‹±æ–‡ä¸­çš„æ„æ€æ˜¯ä»™äººæŒçš„æ„æ€ï¼ŒCactiæ˜¯ä¸€å¥—åŸºäºPHP,MySQL,SNMPåŠRRDToolå¼€å‘çš„ç½‘ç»œæµé‡ç›‘æµ‹å›¾å½¢åˆ†æå·¥å…·ã€‚å®ƒé€šè¿‡snmpgetæ¥è·å–æ•°æ®ï¼Œä½¿ç”¨ RRDtoolç»˜ç”»å›¾å½¢ï¼Œè€Œä¸”ä½ å®Œå…¨å¯ä»¥ä¸éœ€è¦äº†è§£RRDtoolå¤æ‚çš„å‚æ•°ã€‚å®ƒæä¾›äº†éå¸¸å¼ºå¤§çš„æ•°æ®å’Œç”¨æˆ·ç®¡ç†åŠŸèƒ½ï¼Œå¯ä»¥æŒ‡å®šæ¯ä¸€ä¸ªç”¨æˆ·èƒ½æŸ¥çœ‹æ ‘çŠ¶ç»“æ„ã€hostä»¥åŠä»»ä½•ä¸€å¼ å›¾ï¼Œè¿˜å¯ä»¥ä¸LDAPç»“åˆè¿›è¡Œç”¨æˆ·éªŒè¯ï¼ŒåŒæ—¶ä¹Ÿèƒ½è‡ªå·±å¢åŠ æ¨¡æ¿ï¼ŒåŠŸèƒ½éå¸¸å¼ºå¤§å®Œå–„ã€‚Cacti çš„å‘å±•æ˜¯åŸºäºè®© RRDTool ä½¿ç”¨è€…æ›´æ–¹ä¾¿ä½¿ç”¨è¯¥è½¯ä»¶ï¼Œé™¤äº†åŸºæœ¬çš„ Snmp æµé‡è·Ÿç³»ç»Ÿèµ„è®¯ç›‘æ§å¤–ï¼ŒCacti ä¹Ÿå¯å¤–æŒ‚ Scripts åŠåŠ ä¸Š Templates æ¥ä½œå‡ºå„å¼å„æ ·çš„ç›‘æ§å›¾ã€‚</p>
<p>Cactiæ˜¯ç”¨phpè¯­è¨€å®ç°çš„ä¸€ä¸ªè½¯ä»¶ï¼Œå®ƒçš„ä¸»è¦åŠŸèƒ½æ˜¯ç”¨snmpæœåŠ¡è·å–æ•°æ®ï¼Œç„¶åç”¨rrdtoolå‚¨å­˜å’Œæ›´æ–°æ•°æ®ï¼Œå½“ç”¨æˆ·éœ€è¦æŸ¥çœ‹æ•°æ®çš„æ—¶å€™ç”¨rrdtoolç”Ÿæˆå›¾è¡¨å‘ˆç°ç»™ç”¨æˆ·ã€‚å› æ­¤ï¼Œsnmpå’Œrrdtoolæ˜¯cactiçš„å…³é”®ã€‚Snmpå…³ç³»ç€æ•°æ®çš„æ”¶é›†ï¼Œrrdtoolå…³ç³»ç€æ•°æ®å­˜å‚¨å’Œå›¾è¡¨çš„ç”Ÿæˆã€‚</p>
<p>Mysqlé…åˆPHPç¨‹åºå­˜å‚¨ä¸€äº›å˜é‡æ•°æ®å¹¶å¯¹å˜é‡æ•°æ®è¿›è¡Œè°ƒç”¨ï¼Œå¦‚ï¼šä¸»æœºåã€ä¸»æœºipã€snmpå›¢ä½“åã€ç«¯å£å·ã€æ¨¡æ¿ä¿¡æ¯ç­‰å˜é‡ã€‚</p>
<p>snmpæŠ“åˆ°æ•°æ®ä¸æ˜¯å­˜å‚¨åœ¨mysqlä¸­ï¼Œè€Œæ˜¯å­˜åœ¨rrdtoolç”Ÿæˆçš„rrdæ–‡ä»¶ä¸­ï¼ˆåœ¨cactiæ ¹ç›®å½•çš„rraæ–‡ä»¶å¤¹ä¸‹ï¼‰ã€‚rrdtoolå¯¹æ•°æ®çš„æ›´æ–°å’Œå­˜å‚¨å°±æ˜¯å¯¹rrdæ–‡ä»¶çš„å¤„ç†ï¼Œrrdæ–‡ä»¶æ˜¯å¤§å°å›ºå®šçš„æ¡£æ¡ˆæ–‡ä»¶ï¼ˆRound Robin Archiveï¼‰ï¼Œå®ƒèƒ½å¤Ÿå­˜å‚¨çš„æ•°æ®ç¬”æ•°åœ¨åˆ›å»ºæ—¶å°±å·²ç»å®šä¹‰ã€‚å…³äºRRDToolçš„çŸ¥è¯†è¯·å‚é˜…RRDToolæ•™å­¦ã€‚</p>
<h3 id="ä»€ä¹ˆæ˜¯SNMPï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯SNMPï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯SNMPï¼Ÿ"></a>ä»€ä¹ˆæ˜¯SNMPï¼Ÿ</h3><p>snmp(Simple Network Management Protocal, ç®€å•ç½‘ç»œç®¡ç†åè®®)åœ¨æ¶æ„ä½“ç³»çš„ç›‘æ§å­ç³»ç»Ÿä¸­å°†æ‰®æ¼”é‡è¦è§’è‰²ã€‚å¤§ä½“ä¸Šï¼Œå…¶åŸºæœ¬åŸç†æ˜¯ï¼Œåœ¨æ¯ä¸€ä¸ªè¢«ç›‘æ§çš„ä¸»æœºæˆ–èŠ‚ç‚¹ä¸Š (å¦‚äº¤æ¢æœº)éƒ½è¿è¡Œäº†ä¸€ä¸ª agentï¼Œç”¨æ¥æ”¶é›†è¿™ä¸ªèŠ‚ç‚¹çš„æ‰€æœ‰ç›¸å…³çš„ä¿¡æ¯ï¼ŒåŒæ—¶ç›‘å¬ snmp çš„ portï¼Œä¹Ÿå°±æ˜¯ UDP 161ï¼Œå¹¶ä»è¿™ä¸ªç«¯å£æ¥æ”¶æ¥è‡ªç›‘æ§ä¸»æœºçš„æŒ‡ä»¤(æŸ¥è¯¢å’Œè®¾ç½®)ã€‚</p>
<p>å¦‚æœå®‰è£… net-snmpï¼Œè¢«ç›‘æ§ä¸»æœºéœ€è¦å®‰è£… <code>net-snmp(åŒ…å«äº† snmpd è¿™ä¸ª agent)</code>ï¼Œè€Œç›‘æ§ç«¯éœ€è¦å®‰è£… net-snmp-utilsï¼Œè‹¥æ¥å—è¢«ç›‘æ§ç«¯é€šè¿‡trap-communicateå‘æ¥çš„ä¿¡æ¯çš„è¯ï¼Œåˆ™éœ€è¦å®‰è£…net-snmpï¼Œå¹¶å¯ç”¨trapæœåŠ¡ã€‚å¦‚æœè‡ªè¡Œç¼–è¯‘ï¼Œéœ€è¦ beecrypt(libbeecrypt)å’Œ elf(libraryelf)çš„åº“ã€‚</p>
<h3 id="ä»€ä¹ˆæ˜¯RRDtoolsï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯RRDtoolsï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯RRDtoolsï¼Ÿ"></a>ä»€ä¹ˆæ˜¯RRDtoolsï¼Ÿ</h3><p>RRDtoolæ˜¯æŒ‡Round Robin Database å·¥å…·ï¼ˆç¯çŠ¶æ•°æ®åº“ï¼‰ã€‚Round robinæ˜¯ä¸€ç§å¤„ç†å®šé‡æ•°æ®ã€ä»¥åŠå½“å‰å…ƒç´ æŒ‡é’ˆçš„æŠ€æœ¯ã€‚æƒ³è±¡ä¸€ä¸ªå‘¨è¾¹æ ‡æœ‰ç‚¹çš„åœ†ç¯ï¼ï¼è¿™äº›ç‚¹å°±æ˜¯æ—¶é—´å­˜å‚¨çš„ä½ç½®ã€‚ä»åœ†å¿ƒç”»ä¸€æ¡åˆ°åœ†å‘¨çš„æŸä¸ªç‚¹çš„ç®­å¤´ï¼ï¼è¿™å°±æ˜¯æŒ‡é’ˆã€‚å°±åƒæˆ‘ä»¬åœ¨ä¸€ä¸ªåœ†ç¯ä¸Šä¸€æ ·ï¼Œæ²¡æœ‰èµ·ç‚¹å’Œç»ˆç‚¹ï¼Œä½ å¯ä»¥ä¸€ç›´å¾€ä¸‹èµ°ä¸‹å»ã€‚è¿‡æ¥ä¸€æ®µæ—¶é—´ï¼Œæ‰€æœ‰å¯ç”¨çš„ä½ç½®éƒ½ä¼šè¢«ç”¨è¿‡ï¼Œè¯¥å¾ªç¯è¿‡ç¨‹ä¼šè‡ªåŠ¨é‡ç”¨åŸæ¥çš„ä½ç½®ã€‚è¿™æ ·ï¼Œæ•°æ®é›†ä¸ä¼šå¢å¤§ï¼Œå¹¶ä¸”ä¸éœ€è¦ç»´æŠ¤ã€‚RRDtoolå¤„ç†RRDæ•°æ®åº“ã€‚å®ƒç”¨å‘RRDæ•°æ®åº“å­˜å‚¨æ•°æ®ã€ä»RRDæ•°æ®åº“ä¸­æå–æ•°æ®ã€‚</p>
<p>Cactiæ˜¯åŸºäºnginxï¼Œrrdtoolï¼Œmysqlï¼Œphpï¼Œsnmpæ¥è¿è¡Œçš„.</p>
<blockquote>
<p>1.å®‰è£…æ“ä½œç³»ç»Ÿcentos6.0ä»¥ä¸Šç‰ˆæœ¬</p>
<p>2.é…ç½®å¥½ç½‘ç»œIPå’ŒDNS</p>
<p>3.ä¿®æ”¹ç³»ç»Ÿæ—¶åŒºå’Œæ—¶é—´ï¼Œä½¿ç”¨ä¸Šæµ·æ—¶åŒº</p>
</blockquote>
<p>å¤‡ä»½åŸæœ‰çš„æ—¶åŒºæ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cp /etc/localtime /etc/localtime.bak</div></pre></td></tr></table></figure>
<p>ç”¨ä¸Šæµ·æ—¶åŒºæ–‡ä»¶æ›¿æ¢ç³»ç»Ÿæ—¶åŒºæ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</div></pre></td></tr></table></figure>
<p>ä¿®æ”¹/etc/sysconfig/clockæ–‡ä»¶ï¼Œä¿®æ”¹ä¸ºï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ZONE=<span class="string">"Asia/Shanghai"</span></div><div class="line">UTC=<span class="literal">false</span></div><div class="line">ARC=<span class="literal">false</span></div></pre></td></tr></table></figure>
<p>åŒæ­¥æ—¶é—´</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ntpdate <span class="selector-tag">time</span><span class="selector-class">.nist</span><span class="selector-class">.gov</span></div></pre></td></tr></table></figure>
<p>4.å®‰è£…epelæº</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rpm -Uvh http://mirrors.sohu.com/fedora-epel/6/x86_64/epel-release-6-8.noarch.rpm</div></pre></td></tr></table></figure>
<p>5.å®‰è£…åŸºç¡€æ”¯æŒè½¯ä»¶</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install -y openssh-clients telnet wget nginx php-cgi php-cli spawn-fcgi mysql-servermysql rrdtoolnet-snmp net-snmp-utils net-snmp-devel php-mysql php-snmp</div></pre></td></tr></table></figure>
<p>6.é…ç½®PHPç®¡ç†å™¨</p>
<p>ï¼ˆ1ï¼‰cd /etc/sysconfig è¿›å…¥sysconfigæ–‡ä»¶å¤¹</p>
<p>ï¼ˆ2ï¼‰vi spawn-fcgi åœ¨æ–‡ä»¶æ”¹ä½ç½®æ·»åŠ å¦‚ä¸‹å‘½ä»¤</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#SOCKET=/var/run/php-fcgi.sock</span></div><div class="line"><span class="comment">#OPTIONS="-u apache -g apache -s $SOCKET -S -M 0600 -C 32 -F 1 -P /var/run/spawn-fcgi.pid -- /usr/bin/php-cgi"</span></div><div class="line"> SOCKET=/var/run/php-fcgi.sock</div><div class="line"> OPTIONS=<span class="string">"-u nginx -g nginx -s <span class="variable">$SOCKET</span> -S -M 0600 -C 32 -F 1 -P /var/run/spawn-fcgi.pid -- /usr/bin/php-cgi"</span></div></pre></td></tr></table></figure>
<p>ï¼ˆ3ï¼‰/etc/init.d/spawn-fcgi restart é‡å¯phpç®¡ç†å™¨</p>
<p>ï¼ˆ4ï¼‰chkconfig spawn-fcgi on è®¾ç½®å¼€æœºå¯åŠ¨æœåŠ¡</p>
<p>7.è¡¥å……åˆ›å»º/var/lib/phpä¸‹ session ç›®å½•</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mkdir -p /var/lib/php/session</div><div class="line">chown -R nginx.nginx /var/lib/php/session</div><div class="line">chmod 777 /var/lib/php/session</div></pre></td></tr></table></figure>
<p>8.ä¿®æ”¹PHPæ–‡ä»¶é…ç½®</p>
<p>vi /etc/php.ini</p>
<p>ï¼ˆ1ï¼‰ä¿®æ”¹PHPæ—¶åŒºä¸ºAsia/ShangHaiï¼Œåœ¨æ–‡ä»¶å¦‚ä¸‹ä½ç½®æ·»åŠ è¯¥å¥å‘½ä»¤</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">;;;;;;;;;;;;;;;;;;;</div><div class="line">; Module Settings ;</div><div class="line">;;;;;;;;;;;;;;;;;;;</div><div class="line">[Date]</div><div class="line">; Defines the default timezone used by the date <span class="built_in">functions</span></div><div class="line">; http://www.php.net/manual/en/datetime.configuration.php<span class="comment">#ini.date.timezone</span></div><div class="line">;date.timezone =</div><div class="line">date.timezone = Asia/Shanghai</div></pre></td></tr></table></figure>
<p>ï¼ˆ2ï¼‰ä¿®æ”¹PHPè°ƒç”¨å†…å­˜é™åˆ¶ï¼Œåœ¨æ–‡ä»¶å¦‚ä¸‹ä½ç½®ä¿®æ”¹å¦‚ä¸‹æ·»åŠ ï¼š</p>
<p><code>date.timezone = Asia/Shanghai   memory_limit = 512M</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">;;;;;;;;;;;;;;;;;;;</div><div class="line">; Resource Limits ;</div><div class="line">;;;;;;;;;;;;;;;;;;;</div><div class="line">; Maximum execution time of each script, <span class="keyword">in</span> seconds</div><div class="line">; http://www.php.net/manual/en/info.configuration.php<span class="comment">#ini.max-execution-time</span></div><div class="line">max_execution_time = 30</div><div class="line">; Maximum amount of time each script may spend parsing request data. It<span class="string">'s a good</span></div><div class="line">; idea to limit this time on productions servers in order to eliminate unexpectedly</div><div class="line">; long running scripts.</div><div class="line">; Default Value: -1 (Unlimited)</div><div class="line">; Development Value: 60 (60 seconds)</div><div class="line">; Production Value: 60 (60 seconds)</div><div class="line">; http://www.php.net/manual/en/info.configuration.php#ini.max-input-time</div><div class="line">max_input_time = 60</div><div class="line">; Maximum input variable nesting level</div><div class="line">; http://www.php.net/manual/en/info.configuration.php#ini.max-input-nesting-level</div><div class="line">;max_input_nesting_level = 64</div><div class="line">; Maximum amount of memory a script may consume (128MB)</div><div class="line">; http://www.php.net/manual/en/ini.core.php#ini.memory-limit</div><div class="line">#memory_limit = 128M</div><div class="line">memory_limit = 512M</div></pre></td></tr></table></figure>
<p>10.ä¿®æ”¹nginxé…ç½®æ–‡ä»¶å¢åŠ å¯¹cactiçš„æ”¯æŒï¼ˆå¯¹åº”è‡ªå·±çš„nginxå®‰è£…ç›®å½•ï¼‰<br>vi /usr/local/nginx/conf.d/nginx.confåœ¨æ–‡ä»¶æœ«å°¾å¤§æ‹¬å·å†…æ·»åŠ å¦‚ä¸‹é…ç½®<br>          server {<br>          listen 8080;<br>          server_name 127.0.0.1;<br>          root html;<br>          index index.html index.php;</p>
<pre><code>   location ~ \.php$ {
   root html;
   fastcgi_buffer_size 128k;
   fastcgi_buffers 8 128k;
   fastcgi_pass unix:/var/run/php-fcgi.sock;
   fastcgi_index index.php;
   fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
  #fastcgi_param SCRIPT_FILENAME /usr/local/nginx/html/$fastcgi_script_name;
  include fastcgi_params;
  }
       }
chkconfig nginx on è®¾ç½®nginxå¼€æœºå¯åŠ¨
service nginx restarté‡å¯nginxæœåŠ¡
</code></pre><p>11.å®‰è£…catic</p>
<p>caticæ˜¯æ— éœ€ç¼–è¯‘å®‰è£…çš„ï¼Œç›´æ¥ä¸‹è½½å…¶æºåŒ…è§£å‹å³å¯ä½¿ç”¨<br>ï¼ˆ1ï¼‰ä¸‹è½½cacti</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /tmp</div><div class="line">wget http://www.cacti.net/downloads/cacti-0.8.8b.tar.gz</div></pre></td></tr></table></figure>
<p>ï¼ˆ2ï¼‰è§£å‹cacti</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">tar zxvf cacti-0.8.8b.tar.gz</div><div class="line">mv cacti-0.8.8b /usr/<span class="built_in">local</span>/nginx/html <span class="comment">#å°†è§£å‹å‡ºçš„cactiæ–‡ä»¶å¤¹ç§»åŠ¨åˆ°nginxçš„</span></div></pre></td></tr></table></figure>
<p>webç›®å½•ä¸‹ï¼ˆå¯¹åº”è‡ªå·±å®‰è£…çš„nginxï¼‰</p>
<p>ï¼ˆ3ï¼‰ä¿®æ”¹cactiçš„ä½¿ç”¨è€…å’Œç»„æƒé™ä¸ºnginxç”¨æˆ·å’Œnginxç»„</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/nginx/html</div><div class="line">chown -R nginx:nginx cacti/</div></pre></td></tr></table></figure>
<p>12.åˆ›å»ºæ•°æ®åº“ï¼Œå­˜å‚¨cactiæ•°æ®</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">å¯åŠ¨mysql</div><div class="line">/etc/init.d/mysqld start</div><div class="line">chkconfig mysqld on</div></pre></td></tr></table></figure>
<p>ï¼ˆ1ï¼‰ä½¿ç”¨rootè´¦æˆ·ç™»å½•mysql</p>
<pre><code>mysql -uroot
</code></pre><p>ï¼ˆ2ï¼‰åˆ›å»ºcactiæ•°æ®åº“è¡¨</p>
<pre><code>create database cacti;
</code></pre><p>ï¼ˆ3ï¼‰å»ºç«‹ç”¨æˆ·cactiï¼Œå¯†ç cacti123(å¯è‡ªè¡Œå®šä¹‰)</p>
<pre><code>mysql&gt; insert into mysql.user(host,user,password) values (&apos;localhost&apos;,&apos;cacti&apos;,password(&apos;cacti123&apos;));
</code></pre><p>ï¼ˆ4ï¼‰é‡è½½mysqlæˆæƒè¡¨</p>
<pre><code>mysql&gt; flush privileges;
</code></pre><p>ï¼ˆ5ï¼‰ æŠŠæ•°æ®åº“cactiæˆæƒäºç”¨æˆ·cacti</p>
<pre><code>mysql&gt; grant all on cacti.* to cacti@&apos;localhost&apos; identified by &apos;cacti123&apos;;
mysql&gt; quit
</code></pre><p>ï¼ˆ6ï¼‰å°†cactiæ•°æ®åº“ä¸mysqlä¸­çš„æ•°æ®å¯¹åº”èµ·æ¥</p>
<pre><code>cd /usr/local/nginx/html/cacti
mysql -ucacti -pcacti123 cacti&lt;cacti.sql
</code></pre><h3 id="13-ä¿®æ”¹CACTIé…ç½®æ–‡ä»¶"><a href="#13-ä¿®æ”¹CACTIé…ç½®æ–‡ä»¶" class="headerlink" title="13.ä¿®æ”¹CACTIé…ç½®æ–‡ä»¶"></a>13.ä¿®æ”¹CACTIé…ç½®æ–‡ä»¶</h3><p> (1) åˆ‡æ¢è‡³cactiä¸‹çš„includeç›®å½•ï¼ˆå¯¹åº”è‡ªå·±å®‰è£…çš„nginxï¼‰</p>
<pre><code>cd /usr/local/nginx/html/cacti/include/
</code></pre><p> (2)ç¼–è¾‘config.phpæ–‡ä»¶ï¼Œä¿®æ”¹å¦‚ä¸‹ä½ç½®çš„é…ç½®</p>
<pre><code>vi config.php
</code></pre><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">/* make sure these values refect your actual database/host/user/password */</div><div class="line"><span class="variable">$database_type</span> = <span class="string">"mysql"</span>;</div><div class="line"><span class="variable">$database_default</span> = <span class="string">"cacti"</span>;<span class="comment">#mysqlæ•°æ®åº“é‡Œæ‰€åˆ›å»ºçš„è¡¨å</span></div><div class="line"><span class="variable">$database_hostname</span> = <span class="string">"127.0.0.1"</span>;</div><div class="line"><span class="variable">$database_username</span> = <span class="string">"cacti"</span>;<span class="comment">#mysqlæ•°æ®åº“é‡Œä¸ºcactiæ•°æ®è¡¨æ‰€åˆ›å»ºçš„ç”¨æˆ·å</span></div><div class="line"><span class="variable">$database_password</span> = <span class="string">"cacti123"</span>;<span class="comment">#mysqlæ•°æ®åº“é‡Œä¸ºcactiæ•°æ®è¡¨æ‰€åˆ›å»ºçš„å¯†ç </span></div><div class="line"><span class="variable">$database_port</span> = <span class="string">"3306"</span>;</div><div class="line"><span class="variable">$database_ssl</span> = <span class="literal">false</span>;</div></pre></td></tr></table></figure>
<p>14.é…ç½®cactiçš„å¾ªç¯ä»»åŠ¡</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">crontab <span class="_">-e</span></div><div class="line">*/5 * * * * php /usr/<span class="built_in">local</span>/nginx/html/cacti/poller.php &gt; /dev/null 2&gt;&amp;1<span class="comment">#è¯·å¯¹åº”è‡ªå·±çš„nginxå®‰è£…ç›®å½•</span></div></pre></td></tr></table></figure>
<p>:wq ä¿å­˜é€€å‡º</p>
<p>å¯ç›´æ¥å…ˆè¿è¡Œä¸€éphp /usr/local/nginx/html/cacti/poller.php å¥½è®©cactiäº§ç”Ÿå›¾ç‰‡</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">php /usr/share/nginx/html/cacti/poller.php</div></pre></td></tr></table></figure>
<p>15.å®‰è£…å®Œæˆ</p>
<pre><code>ä½¿ç”¨æµè§ˆå™¨æ‰“å¼€å¦‚ä¸‹åœ°å€http://æœ¬æœºIP/cacti/install
</code></pre><p>ä¼šæ˜¾ç¤ºå®‰è£…å‘å¯¼ï¼Œç‚¹å‡»NEXTå³å¯ï¼Œåˆ°ä¸‹é¢å¦‚ä¸‹ç•Œé¢æ˜¯ï¼Œæ³¨æ„æŸ¥çœ‹æ‰€æœ‰çš„æ–‡ä»¶è·¯å¾„æ˜¯å¦éƒ½ä¸ºç»¿è‰²ï¼Œä¸æ˜¯ç»¿è‰²è¯·æ‰¾åˆ°è‡ªå·±å®‰è£…çš„ç›®å½•ï¼Œä¸€ä¸€å¯¹åº”ç‚¹å‡»Finshå³å¯åˆ°è¾¾cactiçš„ç™»é™†ç•Œé¢</p>
<p>è¾“å…¥ç”¨æˆ·åå¯†ç ,<code>cacti</code>é»˜è®¤çš„ç”¨æˆ·åå’Œå¯†ç éƒ½ä¸º<code>admin</code>ï¼Œè¾“å…¥ä¸€æ¬¡åä¼šæç¤ºåœ¨ä¸€æ¬¡è¾“å…¥ï¼Œè¿™ä¸ªæ—¶å€™æ˜¯è®©ä½ è®¾ç½®æ–°çš„adminå¯†ç .ç„¶åå°±èƒ½è¿›å…¥cactiçš„å›¾å½¢ç•Œé¢äº†.</p>
<p>ç‚¹å‡»å·¦ä¸Šè§’graphsï¼Œå°±èƒ½æŸ¥çœ‹æœ¬æœºæ‰€ç›‘æ§çš„æ‰€æœ‰è®¾å¤‡é»˜è®¤å­˜åœ¨ä¸€ä¸ªlocalhostï¼Œç›‘æ§æœ¬æœºçš„å†…å­˜ä½¿ç”¨ï¼Œæ´»åŠ¨ç”¨æˆ·ç­‰ä¿¡æ¯.</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/cacti.png" alt=""></figure></p>

	

	

</article>




	<article>
	
		<h1><a href="/2014/10/06/æ€§èƒ½ç›‘æ§/Zabbix/zabbixç›‘æ§80ç«¯å£çŠ¶æ€/">zabbixç›‘æ§80ç«¯å£çŠ¶æ€</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2014-10-06</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/monitoring/">monitoring</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Zabbix-monitoring/">Zabbix monitoring</a>
			</span>
		
	</div>

	

	
		<h3 id="ç›®çš„ï¼šç›‘æ§webä¸»æœº80ç«¯å£æ˜¯å¦åœ¨ä¾›ææœåŠ¡ã€‚å¦‚æœä¸åœ¨å‘å‡ºæŠ¥è­¦ã€‚"><a href="#ç›®çš„ï¼šç›‘æ§webä¸»æœº80ç«¯å£æ˜¯å¦åœ¨ä¾›ææœåŠ¡ã€‚å¦‚æœä¸åœ¨å‘å‡ºæŠ¥è­¦ã€‚" class="headerlink" title="ç›®çš„ï¼šç›‘æ§webä¸»æœº80ç«¯å£æ˜¯å¦åœ¨ä¾›ææœåŠ¡ã€‚å¦‚æœä¸åœ¨å‘å‡ºæŠ¥è­¦ã€‚"></a>ç›®çš„ï¼šç›‘æ§webä¸»æœº80ç«¯å£æ˜¯å¦åœ¨ä¾›ææœåŠ¡ã€‚å¦‚æœä¸åœ¨å‘å‡ºæŠ¥è­¦ã€‚</h3><p>zabbixç›‘æ§webç«¯ä¸Šé¢çš„80ç«¯å£ï¼Œæˆ–è€…å…¶ä»–çš„ç«¯å£éƒ½æ˜¯å¯ä»¥å®ç°çš„ã€‚</p>
<p>åœ¨è¿™é‡Œå¯ä»¥æ·»åŠ è‡ªå¸¦çš„æ¨¡æ¿-ç»„æ€-æ¨¡æ¿-Template App HTTP Service </p>
<p>æœ‰è‡ªå¸¦çš„HTTP service is running æœåŠ¡æ˜¯å¦æ­£å¸¸å¯åŠ¨ã€‚</p>
<p>è¿™ä¸ªæ˜¯ç›‘æµ‹httpçš„80ç«¯å£ï¼ŒåæœŸæ¯”å¦‚nginxï¼Œgitlab,æˆ–è€…å…¶ä»–æœåŠ¡çš„80ç«¯å£ã€‚å¯ä»¥å¯¹å•å°è®¾ç½®ã€‚</p>
<p>ä¹Ÿå¯ä»¥åˆ›å»ºæ¨¡æ¿æ­£å¯¹æ€§çš„ç›‘æ§é›†ç¾¤çš„åŒä¸€ä¸ªç«¯å£ã€‚</p>
<h3 id="é…ç½®ï¼š"><a href="#é…ç½®ï¼š" class="headerlink" title="é…ç½®ï¼š"></a>é…ç½®ï¼š</h3><p> 1ã€æ·»åŠ ç›‘æ§é¡¹(Items)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"> æ‰“å¼€zabbix webç®¡ç†ç•Œé¢ï¼š</div><div class="line">é€‰æ‹©<span class="string">"Configuration"</span>-&gt;<span class="string">"Hosts"</span>-è¿™é‡Œé€‰æ‹©éœ€è¦ç›‘æ§çš„æœºå™¨-<span class="string">"Items"</span></div></pre></td></tr></table></figure>
<p>é€‰æ‹©Create-item</p>
<p>åˆ›å»ºé¡¹ç›®ï¼Œè¿™ä¸ªå¯¹è¿™å°ç›‘æ§çš„æœåŠ¡å™¨åˆ›å»ºå¯¹åº”çš„ç›‘æ§é¡¹ç›®ã€‚</p>
<p>åœ¨è¿™é‡Œâ€nameâ€ä¸ºâ€web01.haozhuo 80â€ï¼Œè®¾ç½®â€keyâ€ç‚¹å‡»â€Selectâ€æŒ‰é’®å¼¹å‡ºä¸‹å›¾<br>é€‰æ‹©â€net.tcp.port[<ip>,port]â€,ç„¶åä¿®æ”¹ä¸ºweb01çš„ipåœ°å€ç«¯å£ä¸º80ã€‚â€net.tcp.port[192.168.0.2,80]â€</ip></p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-web1.png" alt=""></figure></p>
<p>ä¿å­˜<br>   2ã€æ·»åŠ è§¦å‘å™¨ï¼ˆTriggersï¼‰<br>é€‰æ‹©Configurationâ€-&gt;â€Hostsâ€-è¿™é‡Œé€‰æ‹©éœ€è¦ç›‘æ§çš„æœºå™¨-â€œTriggersâ€</p>
<p>é€‰æ‹©Create-Trigger</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-web2.png" alt=""></figure><br>ä¿å­˜</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-web3.png" alt=""></figure><br>ç„¶åé€‰æ‹©æ·»åŠ å›¾å½¢ã€‚</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-web4.png" alt=""></figure></p>
<p>zabbix-server2.4æœåŠ¡ç«¯ç¼–è¯‘å®‰è£… <a href="http://blog.yangcvo.me/2015/01/18/zabbix-serveræœåŠ¡ç«¯ç¼–è¯‘å®‰è£…/" target="_blank" rel="external">zabbix-serveræœåŠ¡ç«¯ç¼–è¯‘å®‰è£…</a></p>
<p>zabbix2.4ç›‘æ§80ç«¯å£çŠ¶æ€ : <a href="http://blog.yangcvo.me/2016/07/20/zabbixç›‘æ§80ç«¯å£çŠ¶æ€/" target="_blank" rel="external">zabbixç›‘æ§80ç«¯å£çŠ¶æ€</a></p>
<p>zabbix+Grafanaå®‰è£…ä½¿ç”¨ç›‘æ§ç»“åˆ ï¼š<a href="http://blog.yangcvo.me/2016/07/13/zabbix-Grafanaå®‰è£…ä½¿ç”¨ç»“åˆ/" target="_blank" rel="external">zabbix+Grafanaå®‰è£…ä½¿ç”¨ç›‘æ§ç»“åˆ</a></p>
<p>zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹ : <a href="http://blog.yangcvo.me/2015/09/29/zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹/" target="_blank" rel="external">zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹</a></p>
<p>zabbixçš„ICMP_Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§ : <a href="http://blog.yangcvo.me/2015/11/18/zabbixçš„ICMP-Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§/" target="_blank" rel="external">zabbixçš„ICMP_Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§</a></p>
<p>zabbixæ€§èƒ½ç›‘æ§æ•…éšœæ€»ç»“ <a href="http://blog.yangcvo.me/2016/02/07/zabbix-æ•…éšœæ€»ç»“/" target="_blank" rel="external">zabbixæ€§èƒ½ç›‘æ§æ•…éšœæ€»ç»“</a></p>

	

	

</article>




	<article>
	
		<h1><a href="/2014/10/05/æ€§èƒ½ç›‘æ§/Zabbix/zabbixé‚®ä»¶å‘Šè­¦/">zabbixé‚®ä»¶å‘Šè­¦</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2014-10-05</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/monitoring/">monitoring</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Zabbix-monitoring/">Zabbix monitoring</a>
			</span>
		
	</div>

	

	
		<h2 id="æ“ä½œç³»ç»Ÿç¯å¢ƒï¼š"><a href="#æ“ä½œç³»ç»Ÿç¯å¢ƒï¼š" class="headerlink" title="æ“ä½œç³»ç»Ÿç¯å¢ƒï¼š"></a>æ“ä½œç³»ç»Ÿç¯å¢ƒï¼š</h2><p>CentOS release 6.7 (Final)</p>
<p>zabbixç‰ˆæœ¬2.4.7</p>
<p>å…³äºæ“ä½œç³»ç»ŸCentOS6.0 ä»¥ä¸‹ç‰ˆæœ¬éƒ½æ˜¯é€šè¿‡mailå‘½ä»¤è°ƒç”¨sendmailçš„sm-clientå‘é€é‚®ä»¶ï¼Œæ‰€ä»¥å¦‚æœå…³é—­sendmailæŒ‰ç…§å¾ˆå¤šç½‘ä¸Šçš„æ–‡æ¡£æ˜¯å‘ä¸å‡ºé‚®ä»¶çš„ã€‚</p>
<p>centos 6.0ä»¥ä¸Šç‰ˆæœ¬</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">é»˜è®¤å·²ç»å®‰è£…å¥½sendmail</div><div class="line">é»˜è®¤å·²ç»å®‰è£…å¥½postfix</div></pre></td></tr></table></figure>
<p>sendmailå’Œpostfixåªéœ€è¦å®‰è£…ä¸€ä¸ªå³å¯å¹¶å¼€å¯æœåŠ¡å³å¯ã€‚</p>
<h3 id="å®ç°ç›®çš„ï¼š"><a href="#å®ç°ç›®çš„ï¼š" class="headerlink" title="å®ç°ç›®çš„ï¼š"></a>å®ç°ç›®çš„ï¼š</h3><p>åœ¨ZabbixæœåŠ¡ç«¯è®¾ç½®é‚®ä»¶æŠ¥è­¦ï¼Œå½“è¢«ç›‘æ§ä¸»æœºå®•æœºæˆ–è€…è¾¾åˆ°è§¦å‘å™¨é¢„è®¾å€¼æ—¶ï¼Œä¼šè‡ªåŠ¨å‘é€æŠ¥è­¦é‚®ä»¶åˆ°æŒ‡å®šé‚®ç®±ï¼Œå®šä½å“ªé‡Œå‡ºç°é—®é¢˜ï¼Œå¯ä»¥åŠæ—¶çš„è§£å†³ã€‚</p>
<h3 id="1-å®‰è£…é‚®ä»¶å‘é€å·¥å…·mailx"><a href="#1-å®‰è£…é‚®ä»¶å‘é€å·¥å…·mailx" class="headerlink" title="1.å®‰è£…é‚®ä»¶å‘é€å·¥å…·mailx"></a>1.å®‰è£…é‚®ä»¶å‘é€å·¥å…·mailx</h3><p>CentOS 6.x ç¼–è¯‘å®‰è£…mailxï¼Œç›´æ¥yumå®‰è£…çš„mailxç‰ˆæœ¬å¤ªæ—§ï¼Œä½¿ç”¨å¤–éƒ¨é‚®ä»¶å‘é€ä¼šæœ‰é—®é¢˜ã€‚</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">yum <span class="keyword">install</span> mailx <span class="comment">#å®‰è£…</span></div><div class="line"></div><div class="line">yum <span class="keyword">remove</span> mailx <span class="comment">#å¸è½½ç³»ç»Ÿè‡ªå¸¦çš„æ—§ç‰ˆmailx</span></div></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘ç”¨ç¼–è¯‘å®‰è£…çš„å¾ˆç®€å•å‡ æ­¥å°±å¯ä»¥äº†ã€‚</p>
<p>mailä¸‹è½½åœ°å€:<a href="http://www.linuxfromscratch.org/blfs/view/stable/basicnet/mailx.html" target="_blank" rel="external">Downloads</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[root@salt ~]<span class="comment"># curl -O http://ftp.debian.org/debian/pool/main/h/heirloom-mailx/heirloom-mailx_12.5.orig.tar.gz</span></div><div class="line">[root@salt ~]<span class="comment"># tar -zxvf heirloom-mailx_12.5.orig.tar.gz </span></div><div class="line">[root@salt ~]<span class="comment"># cd heirloom-mailx-12.5</span></div><div class="line">[root@salt heirloom-mailx-12.5]<span class="comment"># make</span></div><div class="line">[root@salt heirloom-mailx-12.5]<span class="comment"># make install UCBINSTALL=/usr/bin/install</span></div><div class="line">[root@salt heirloom-mailx-12.5]<span class="comment"># ln -s /usr/local/bin/mailx /bin/mail #åˆ›å»ºmailxåˆ°mailçš„è½¯è¿æ¥</span></div><div class="line">[root@salt heirloom-mailx-12.5]<span class="comment"># ln -s /etc/nail.rc /etc/mail.rc #åˆ›å»ºmailxé…ç½®æ–‡ä»¶è½¯è¿æ¥</span></div><div class="line">[root@salt heirloom-mailx-12.5]<span class="comment"># whereis mailx   #æŸ¥çœ‹å®‰è£…è·¯å¾„</span></div><div class="line">mailx: /bin/mailx /usr/<span class="built_in">local</span>/bin/mailx /usr/share/man/man1p/mailx.1p.gz /usr/share/man/man1/mailx.1.gz   </div><div class="line">[root@salt heirloom-mailx-12.5]<span class="comment"># mailx -V     #æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯</span></div><div class="line">12.5 6/20/10</div></pre></td></tr></table></figure>
<p>å®‰è£…å®Œä»¥åæˆ‘ä»¬æ¥æµ‹è¯•ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@salt]<span class="comment"># echo "zabbix test mail" |mail -s zabbix" it@hz-health.cn</span></div><div class="line">[root@salt]<span class="comment"># send-mail: warning: inet_protocols: IPv6 support is disabled: Address family not supported by protocol</span></div><div class="line">send-mail: warning: inet_protocols: configuring <span class="keyword">for</span> IPv4 support only</div><div class="line">postdrop: warning: inet_protocols: IPv6 support is disabled: Address family not supported by protocol</div><div class="line">postdrop: warning: inet_protocols: configuring <span class="keyword">for</span> IPv4 support only</div><div class="line">postdrop: warning: unable to look up public/pickup: No such file or directory</div></pre></td></tr></table></figure>
<p>å¦‚æœæœ‰å‡ºç°è¿™ä¸ªæŠ¥é”™ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸‹é…ç½®æ–‡ä»¶ã€‚<br>æŸ¥çœ‹å½“å‰inet_protocols</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># /usr/sbin/postconf | grep inet_protocols</span></div><div class="line">inet_protocols = all</div><div class="line">ä¿®æ”¹ipv4</div><div class="line"><span class="comment"># vi /etc/postfix/main.cf</span></div><div class="line">inet_protocols = all</div><div class="line">æ”¹ä¸º</div><div class="line">inet_protocols = ipv4</div><div class="line">é‡å¯postfix</div><div class="line">service postfix restart</div></pre></td></tr></table></figure>
<p>ç„¶ååœ¨æµ‹è¯•ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">[root@salt]#</span><span class="bash"> <span class="built_in">echo</span> <span class="string">"zabbix test mail"</span> |mail <span class="_">-s</span> <span class="string">"zabbix"</span> it@xxxx.cn</span></div></pre></td></tr></table></figure>
<p>æµ‹è¯•å‘é€é‚®ä»¶ï¼Œæ ‡é¢˜zabbixï¼Œé‚®ä»¶å†…å®¹ï¼šzabbix test mailï¼Œå‘é€åˆ°çš„é‚®ç®±ï¼šxxx.qq.com</p>
<p>è¿™æ—¶å€™ï¼Œé‚®ç®±yyy@qq.comä¼šæ”¶åˆ°æ¥è‡ªxxx@qq.comçš„æµ‹è¯•é‚®ä»¶ã€‚</p>
<h3 id="2ã€åˆ›å»ºé‚®ä»¶å‘Šè­¦çš„pythonè„šæœ¬"><a href="#2ã€åˆ›å»ºé‚®ä»¶å‘Šè­¦çš„pythonè„šæœ¬" class="headerlink" title="2ã€åˆ›å»ºé‚®ä»¶å‘Šè­¦çš„pythonè„šæœ¬"></a>2ã€åˆ›å»ºé‚®ä»¶å‘Šè­¦çš„pythonè„šæœ¬</h3><p>zabbix_serveræ·»åŠ è„šæœ¬é…ç½®:</p>
<ol>
<li>zabbixå®‰è£…è·¯å¾„ï¼šcd /usr/local/zabbix/share/zabbix/alertscripts</li>
</ol>
<p>ç¼–å†™è„šæœ¬ï¼š<br><code>vim /usr/local/zabbix/share/zabbix/alertscripts/zabbix_sendmail.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment">#coding:utf-8</span></div><div class="line"><span class="keyword">import</span> smtplib</div><div class="line"><span class="keyword">from</span> email.mime.text <span class="keyword">import</span> MIMEText</div><div class="line"><span class="keyword">import</span> sys</div><div class="line">LOG_FILENAME=<span class="string">"/var/log/email_python.log"</span></div><div class="line">mail_host = <span class="string">'smtp.exmail.qq.com'</span>                  <span class="comment">#å®šä¹‰smtpæœåŠ¡å™¨</span></div><div class="line">mail_user = <span class="string">'it@xxxx.cn'</span>               <span class="comment">#å‘ä»¶äººé‚®ç®±</span></div><div class="line">mail_pass = <span class="string">'xxxxxxx'</span>                        <span class="comment">#å‘ä»¶äººé‚®ç®±å¯†ç </span></div><div class="line">mail_port = <span class="number">465</span>                            <span class="comment">#smtpæœåŠ¡å™¨çš„ç«¯å£å·ï¼Œä¸åŒçš„é‚®ç®±æœåŠ¡å™¨ç«¯å£å·ä¸åŒ</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_mail</span><span class="params">(to_list,subject,content)</span>:</span></div><div class="line">    me=<span class="string">"Zabbix Monitor"</span>+<span class="string">"&lt;"</span>+mail_user+<span class="string">"&gt;"</span>  <span class="comment">#å®šä¹‰å‘ä»¶äººæ˜¾ç¤ºåç§°ä¸ºZabbix Monitor</span></div><div class="line">    msg=MIMEText(content,_subtype=<span class="string">'plain'</span>,_charset=<span class="string">'gb2312'</span>)</div><div class="line">    msg[<span class="string">'Subject'</span>]=subject                 <span class="comment">#å®šä¹‰é‚®ä»¶ä¸»é¢˜</span></div><div class="line">    msg[<span class="string">'From'</span>]=me                         <span class="comment">#å‘é€æ–¹</span></div><div class="line">    msg[<span class="string">'to'</span>]=to_list                      <span class="comment">#æ¥æ”¶æ–¹</span></div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        s=smtplib.SMTP_SSL()               <span class="comment">#åˆ›å»ºä¸€ä¸ªsmtpå¯¹è±¡</span></div><div class="line">        s.connect(mail_host,mail_port)     <span class="comment">#é€šè¿‡connectæ–¹æ³•è¿æ¥smtpä¸»æœº</span></div><div class="line">        s.login(mail_user,mail_pass)       <span class="comment">#é‚®ç®±è´¦æˆ·ç™»å½•è®¤è¯</span></div><div class="line">        s.sendmail(me,to_list,msg.as_string()) <span class="comment">#å‘é€é‚®ä»¶</span></div><div class="line">        s.close()                             <span class="comment">#æ–­å¼€smtpè¿æ¥</span></div><div class="line">        <span class="keyword">return</span> <span class="keyword">True</span></div><div class="line">    <span class="keyword">except</span> Exception,e:</div><div class="line">        <span class="keyword">print</span> str(e)</div><div class="line">        <span class="keyword">return</span> <span class="keyword">False</span></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</div><div class="line">    send_mail(sys.argv[<span class="number">1</span>],sys.argv[<span class="number">2</span>],sys.argv[<span class="number">3</span>])</div></pre></td></tr></table></figure>
<p>2ã€è„šæœ¬æ–‡ä»¶è·¯å¾„</p>
<p>å…ˆç¡®è®¤ä¸‹<code>zabbix_server.conf</code>æ–‡ä»¶ä¸­å®šä¹‰çš„å‘Šè­¦è„šæœ¬è·¯å¾„é…ç½®ï¼š</p>
<p>å¦‚æœæ³¨é‡Šäº†ï¼Œæ·»åŠ ä¸€æ¡ç»å¯¹è·¯å¾„ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># AlertScriptsPath=$&#123;datadir&#125;/zabbix/alertscripts</span></div><div class="line"> AlertScriptsPath=/usr/<span class="built_in">local</span>/zabbix/share/zabbix/alertscripts</div></pre></td></tr></table></figure>
<p>ç„¶åå°†å‡†å¤‡å¥½çš„pythonè„šæœ¬å­˜æ”¾åˆ°è¯¥è·¯å¾„ä¸‹ï¼Œå¹¶æ›´æ”¹è„šæœ¬æ–‡ä»¶çš„æƒé™å’Œå±ä¸»å±ç»„</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">chown zabbix.zabbix   /usr/<span class="built_in">local</span>/zabbix/share/zabbix/alertscripts/zabbix_sendmail.py</div><div class="line">chmod +x   /usr/<span class="built_in">local</span>/zabbix/share/zabbix/alertscripts/zabbix_sendmail.py</div></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼šå¦‚æœåœ¨zabbix_server.confæ–‡ä»¶ä¸­æ²¡æœ‰è®¾ç½®Allow root=1ï¼Œåˆ™è¡¨ç¤ºzabbixæ˜¯ä»¥zabbixç”¨æˆ·å¯åŠ¨è€Œä¸æ˜¯rootï¼Œæ‰€ä»¥è„šæœ¬çš„å±ä¸»å±ç»„éƒ½åº”è¯¥è®¾ç½®ä¸ºzabbixç”¨æˆ·ã€‚è®¾ç½®ä¸ºrootç”¨æˆ·å¯åŠ¨çš„é…ç½®å¦‚ä¸‹ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"><span class="comment">## Option: AllowRoot</span></span></div><div class="line"><span class="meta">#</span><span class="bash">   Allow the server to run as <span class="string">'root'</span>. If disabled and the server is started by <span class="string">'root'</span>, the server</span></div><div class="line"><span class="meta">#</span><span class="bash">   will try to switch to user <span class="string">'zabbix'</span> instead. Has no effect <span class="keyword">if</span> started under a regular user.</span></div><div class="line"><span class="meta">#</span><span class="bash">   0 - <span class="keyword">do</span> not allow</span></div><div class="line"><span class="meta">#</span><span class="bash">   1 - allow</span></div><div class="line"><span class="meta">#</span><span class="bash"></span></div><div class="line"><span class="meta">#</span><span class="bash"> Mandatory: no</span></div><div class="line"><span class="meta">#</span><span class="bash"> Default:</span></div><div class="line">AllowRoot=1</div></pre></td></tr></table></figure>
<p>é‡å¯æœåŠ¡ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@salt alertscripts]<span class="comment"># /etc/init.d/zabbix_server restart</span></div><div class="line">Shutting down zabbix_server:                               [ç¡®å®š]</div><div class="line">Starting zabbix_server:                                    [ç¡®å®š]</div></pre></td></tr></table></figure>
<p>3ã€æµ‹è¯•è„šæœ¬æ–‡ä»¶å‘é€é‚®ä»¶æ˜¯å¦æˆåŠŸï¼Œè¿™ä¸€æ­¥å¾ˆé‡è¦</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./zabbix_sendmail.py cheng@health.cn <span class="string">"subject"</span> <span class="string">"zabbix"</span></div></pre></td></tr></table></figure>
<p>å·²ç»æµ‹è¯•okï¼Œå¯ä»¥æ”¶åˆ°é‚®ä»¶ï¼Œè¯´æ˜å†™çš„pythonè„šæœ¬æ²¡æœ‰é—®é¢˜ã€‚</p>
<h3 id="zabbix-webç«¯è®¾ç½®"><a href="#zabbix-webç«¯è®¾ç½®" class="headerlink" title="zabbix-webç«¯è®¾ç½®"></a>zabbix-webç«¯è®¾ç½®</h3><ul>
<li>é¦–å…ˆwebç«¯çš„é…ç½®é¡ºåºå¦‚ä¸‹ï¼š<br>åˆ›å»ºç”¨æˆ·åª’ä»‹â€“&gt;åˆ›å»ºç”¨æˆ·ç»„å’Œç”¨æˆ·â€“&gt;é’ˆå¯¹triggerï¼ˆè§¦å‘å™¨ï¼‰æ·»åŠ æŠ¥è­¦åŠ¨ä½œï¼Œè®¾ç½®é‚®ä»¶å‘é€ç”¨æˆ·åŠåª’ä»‹</li>
</ul>
<p>1.åˆ›å»ºç”¨æˆ·åª’ä»‹</p>
<ul>
<li><p>åˆ›å»ºç”¨æˆ·åª’ä»‹â€“&gt;åˆ›å»ºç”¨æˆ·ç»„å’Œç”¨æˆ·â€“&gt;Media typesâ€“&gt;Createmediatype     </p>
<ul>
<li>Mediatypeè®¾ç½®å¦‚ä¸‹ï¼Œ Nameé¡¹è‡ªå®šä¹‰ï¼ˆåˆ›å»ºç”¨æˆ·æ—¶ä¼šç”¨åˆ°è¿™ä¸ªåå­—),æˆ‘ä»¬ä½¿ç”¨è„šæœ¬æ¥å‘é‚®ä»¶ï¼Œæ‰€ä»¥Typeé¡¹è¯·é€‰æ‹©Scriptï¼ŒScripté¡¹åˆ™æ˜¯ä½ zabbix serverä¸Šçš„å‘é€é‚®ä»¶çš„è„šæœ¬åå­—</li>
<li><p>ï¼ˆæ³¨ï¼šå¦‚è„šæœ¬åå­—æ˜¯snedmail.py,é‚£æ­¤é¡¹å°±å¡«sendmailï¼Œåç¼€ä¸è¦)</p>
</li>
<li><p>zabbixä¼šä¼ ç»™è„šæœ¬ä¸‰ä¸ªå‚æ•°ï¼šæ¥æ”¶ç”¨æˆ·ï¼Œé‚®ä»¶ä¸»é¢˜ï¼Œé‚®ä»¶å†…å®¹</p>
</li>
</ul>
</li>
</ul>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-mail1.png" alt=""></figure></p>
<p>2.è®¾ç½®Zabbixç”¨æˆ·æŠ¥è­¦é‚®ç®±åœ°å€</p>
<ul>
<li>ç»„æ€-ç”¨æˆ·-Admin (Zabbix Administrator)<ul>
<li>å†åˆ°Mediaæ ‡ç­¾ä¸‹ï¼Œç‚¹å‡»Addæ·»åŠ ç”¨æˆ·åŠè¯¥ç”¨æˆ·çš„æŠ¥è­¦æ–¹å¼ï¼Œç„¶åTypeé¡¹é€‰æ‹©ä½ æ‰€åˆ›å»ºçš„é‚®ä»¶æŠ¥è­¦åå­—ï¼ˆMedia Typeï¼‰ï¼Œåœ¨Send toåå¡«å…¥ç”¨æˆ·çš„æŠ¥è­¦é‚®ç®±ï¼Œå…¶ä»–é»˜è®¤å³å¯ã€‚</li>
</ul>
</li>
</ul>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-mail2.png" alt=""></figure></p>
<p>3.è®¾ç½®Zabbixè§¦å‘æŠ¥è­¦çš„åŠ¨ä½œ</p>
<ul>
<li>ç»„æ€-åŠ¨ä½œ-åˆ›å»ºåŠ¨ä½œ</li>
</ul>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-mion3.png" alt=""></figure></p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="xml">åç§°ï¼šAction-Email</span></div><div class="line"></div><div class="line">é»˜è®¤æ¥æ”¶äººï¼šæ•…éšœ<span class="template-variable">&#123;TRIGGER.STATUS&#125;</span><span class="xml">,æœåŠ¡å™¨:</span><span class="template-variable">&#123;HOSTNAME1&#125;</span><span class="xml">å‘ç”Ÿ: </span><span class="template-variable">&#123;TRIGGER.NAME&#125;</span><span class="xml">æ•…éšœ!</span></div><div class="line"></div><div class="line">é»˜è®¤ä¿¡æ¯ï¼š</div><div class="line"></div><div class="line">å‘Šè­¦ä¸»æœº:<span class="template-variable">&#123;HOSTNAME1&#125;</span><span class="xml"></span></div><div class="line"></div><div class="line">å‘Šè­¦æ—¶é—´:<span class="template-variable">&#123;EVENT.DATE&#125;</span><span class="xml"> </span><span class="template-variable">&#123;EVENT.TIME&#125;</span><span class="xml"></span></div><div class="line"></div><div class="line">å‘Šè­¦ç­‰çº§:<span class="template-variable">&#123;TRIGGER.SEVERITY&#125;</span><span class="xml"></span></div><div class="line"></div><div class="line">å‘Šè­¦ä¿¡æ¯: <span class="template-variable">&#123;TRIGGER.NAME&#125;</span><span class="xml"></span></div><div class="line"></div><div class="line">å‘Šè­¦é¡¹ç›®:<span class="template-variable">&#123;TRIGGER.KEY1&#125;</span><span class="xml"></span></div><div class="line"></div><div class="line">é—®é¢˜è¯¦æƒ…:<span class="template-variable">&#123;ITEM.NAME&#125;</span><span class="xml">:</span><span class="template-variable">&#123;ITEM.VALUE&#125;</span><span class="xml"></span></div><div class="line"></div><div class="line">å½“å‰çŠ¶æ€:<span class="template-variable">&#123;TRIGGER.STATUS&#125;</span><span class="xml">:</span><span class="template-variable">&#123;ITEM.VALUE1&#125;</span><span class="xml"></span></div><div class="line"></div><div class="line">äº‹ä»¶ID:<span class="template-variable">&#123;EVENT.ID&#125;</span><span class="xml"></span></div><div class="line"></div><div class="line">æ¢å¤ä¿¡æ¯ï¼šæ‰“é’©</div><div class="line"></div><div class="line">æ¢å¤ä¸»æ—¨ï¼šæ¢å¤<span class="template-variable">&#123;TRIGGER.STATUS&#125;</span><span class="xml">, æœåŠ¡å™¨:</span><span class="template-variable">&#123;HOSTNAME1&#125;</span><span class="xml">: </span><span class="template-variable">&#123;TRIGGER.NAME&#125;</span><span class="xml">å·²æ¢å¤!</span></div><div class="line"></div><div class="line">æ¢å¤ä¿¡æ¯ï¼š</div><div class="line"></div><div class="line">å‘Šè­¦ä¸»æœº:<span class="template-variable">&#123;HOSTNAME1&#125;</span><span class="xml"></span></div><div class="line"></div><div class="line">å‘Šè­¦æ—¶é—´:<span class="template-variable">&#123;EVENT.DATE&#125;</span><span class="xml"> </span><span class="template-variable">&#123;EVENT.TIME&#125;</span><span class="xml"></span></div><div class="line"></div><div class="line">å‘Šè­¦ç­‰çº§:<span class="template-variable">&#123;TRIGGER.SEVERITY&#125;</span><span class="xml"></span></div><div class="line"></div><div class="line">å‘Šè­¦ä¿¡æ¯: <span class="template-variable">&#123;TRIGGER.NAME&#125;</span><span class="xml"></span></div><div class="line"></div><div class="line">å‘Šè­¦é¡¹ç›®:<span class="template-variable">&#123;TRIGGER.KEY1&#125;</span><span class="xml"></span></div><div class="line"></div><div class="line">é—®é¢˜è¯¦æƒ…:<span class="template-variable">&#123;ITEM.NAME&#125;</span><span class="xml">:</span><span class="template-variable">&#123;ITEM.VALUE&#125;</span><span class="xml"></span></div><div class="line"></div><div class="line">å½“å‰çŠ¶æ€:<span class="template-variable">&#123;TRIGGER.STATUS&#125;</span><span class="xml">:</span><span class="template-variable">&#123;ITEM.VALUE1&#125;</span><span class="xml"></span></div><div class="line"></div><div class="line">äº‹ä»¶ID:<span class="template-variable">&#123;EVENT.ID&#125;</span><span class="xml"></span></div><div class="line"></div><div class="line">å·²å¯ç”¨ï¼šæ‰“é’©</div></pre></td></tr></table></figure>
<p>åˆ›å»ºOperations</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-mail4.png" alt=""></figure></p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-mail5.png" alt=""></figure></p>
<p>åˆ°è¿™é‡Œå°±åŸºæœ¬é…ç½®å®Œæ¯•äº†ã€‚</p>
<p>æµ‹è¯•ä¸‹å…³é—­agent 1åˆ†é’Ÿå·¦å³å¯ä»¥æ”¶åˆ°é‚®ä»¶ã€‚ å…³é—­é˜²ç«å¢™å’Œselinux å³å¯ï¼Œä¸å…³é—­é˜²ç«å¢™å¼€å¯10051ç«¯å£å’Œ10050ç«¯å£</p>
<h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p>æŸ¥çœ‹zabbixå®¡è®¡åŠ¨æ€æ—¥å¿—ï¼š<br>å‘é€æˆåŠŸ</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-mail7.png" alt=""></figure></p>
<p>é‚®ä»¶å·²æ¥æ”¶æˆåŠŸã€‚</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-mail8.png" alt=""></figure></p>
<p>å¾®ä¿¡å‘Šè­¦ä¹Ÿå·²å†™è¯¦ç»†æ–‡æ¡£ã€‚æ–‡æ¡£fileå·²ä¸Šä¼ githubä¸Šé¢äº†ã€‚</p>
<p>zabbix-server2.4æœåŠ¡ç«¯ç¼–è¯‘å®‰è£… <a href="http://blog.yangcvo.me/2015/01/18/zabbix-serveræœåŠ¡ç«¯ç¼–è¯‘å®‰è£…/" target="_blank" rel="external">zabbix-serveræœåŠ¡ç«¯ç¼–è¯‘å®‰è£…</a></p>
<p>zabbix2.4ç›‘æ§80ç«¯å£çŠ¶æ€ : <a href="http://blog.yangcvo.me/2016/07/20/zabbixç›‘æ§80ç«¯å£çŠ¶æ€/" target="_blank" rel="external">zabbixç›‘æ§80ç«¯å£çŠ¶æ€</a></p>
<p>zabbix+Grafanaå®‰è£…ä½¿ç”¨ç›‘æ§ç»“åˆ ï¼š<a href="http://blog.yangcvo.me/2016/07/13/zabbix-Grafanaå®‰è£…ä½¿ç”¨ç»“åˆ/" target="_blank" rel="external">zabbix+Grafanaå®‰è£…ä½¿ç”¨ç›‘æ§ç»“åˆ</a></p>
<p>zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹ : <a href="http://blog.yangcvo.me/2015/09/29/zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹/" target="_blank" rel="external">zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹</a></p>
<p>zabbixçš„ICMP_Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§ : <a href="http://blog.yangcvo.me/2015/11/18/zabbixçš„ICMP-Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§/" target="_blank" rel="external">zabbixçš„ICMP_Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§</a></p>
<p>zabbixæ€§èƒ½ç›‘æ§æ•…éšœæ€»ç»“ <a href="http://blog.yangcvo.me/2016/02/07/zabbix-æ•…éšœæ€»ç»“/" target="_blank" rel="external">zabbixæ€§èƒ½ç›‘æ§æ•…éšœæ€»ç»“</a></p>

	

	

</article>




	<article>
	
		<h1><a href="/2014/10/04/æ€§èƒ½ç›‘æ§/Zabbix/zabbix-æ•…éšœæ€»ç»“/">zabbixæ€§èƒ½ç›‘æ§æ•…éšœæ€»ç»“</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2014-10-04</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/monitoring/">monitoring</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Zabbix-monitoring/">Zabbix monitoring</a>
			</span>
		
	</div>

	

	
		<h2 id="TOC"><a href="#TOC" class="headerlink" title="TOC"></a>TOC</h2><p>æ•ˆæœå¦‚ä¸‹ï¼š<br>[TOC]</p>
<h3 id="1-Zabbixçº¢è‰²å¼¹å‡ºæŠ¥é”™-zabbix-server-is-not-running-the-information-displayed-may-not-be-current"><a href="#1-Zabbixçº¢è‰²å¼¹å‡ºæŠ¥é”™-zabbix-server-is-not-running-the-information-displayed-may-not-be-current" class="headerlink" title="1.Zabbixçº¢è‰²å¼¹å‡ºæŠ¥é”™ zabbix server is not running: the information displayed may not be current"></a>1.Zabbixçº¢è‰²å¼¹å‡ºæŠ¥é”™ <code>zabbix server is not running: the information displayed may not be current</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">* æ’é”™:</div><div class="line">* </div><div class="line">1. æ£€æŸ¥   /var/www/html/zabbix/conf/zabbix.conf.php </div><div class="line">ç¡®å®š </div><div class="line"><span class="variable">$DB</span>[<span class="string">'DATABASE'</span>]  æ•°æ®åº“</div><div class="line"><span class="variable">$DB</span>[<span class="string">'USER'</span>]    ç”¨æˆ·</div><div class="line"><span class="variable">$DB</span>[<span class="string">'PASSWORD'</span>]   å¯†ç </div><div class="line">è¿™ä¸‰ä¸ªå‚æ•°éƒ½æ˜¯æ­£ç¡®çš„ã€‚ </div><div class="line">æ³¨æ„ï¼šæ¯æ¬¡æ”¹äº†å‚æ•°æ–‡ä»¶ä¸€å®šè¦è®°å¾—é‡å¯zabbix_server</div><div class="line">è¿™é‡Œéƒ½æ²¡é—®é¢˜ã€‚</div><div class="line"></div><div class="line">2. å…³é—­SELinuxçš„æ–¹æ³•:</div><div class="line">ä¿®æ”¹/etc/selinux/configæ–‡ä»¶ä¸­çš„SELINUX=<span class="string">""</span> ä¸º disabled ï¼Œç„¶åé‡å¯ã€‚</div><div class="line">å¦‚æœä¸æƒ³é‡å¯ç³»ç»Ÿï¼Œä½¿ç”¨å‘½ä»¤setenforce 0</div><div class="line">æ³¨:</div><div class="line">setenforce 1 è®¾ç½®SELinux æˆä¸ºenforcingæ¨¡å¼</div><div class="line">setenforce 0 è®¾ç½®SELinux æˆä¸ºpermissiveæ¨¡å¼ </div><div class="line">åœ¨liloæˆ–è€…grubçš„å¯åŠ¨å‚æ•°ä¸­å¢åŠ ï¼šselinux=0,ä¹Ÿå¯ä»¥å…³é—­selinux</div><div class="line">selinuxæ˜¯å¦å…³é—­ã€‚ä¸€å®šè¦å…³é—­è¿™ä¸ªï¼Œå¼€å¯selinuxä¼šå¼•èµ·ä¸€è¿ä¸²é—®é¢˜ï¼Œç”šè‡³zabbixçš„discoveryåŠŸèƒ½ä¹Ÿä¸èƒ½æ­£å¸¸ä½¿ç”¨</div><div class="line"></div><div class="line">3. ä¸Šé¢éƒ½æ²¡æœ‰é—®é¢˜ç„¶ååœ¨æŸ¥çœ‹æœåŠ¡æ˜¯å¦æ­£å¸¸å¯åŠ¨ã€‚</div><div class="line">æŸ¥çœ‹/tmp/zabbix_server.logå’Œ/tmp/zabbix_agent.logæ— ä»»ä½•å¼‚å¸¸ã€‚</div><div class="line">å¦‚æœæ—¥å¿—æç¤ºæŸ¥æ‰¾ä¸åˆ°ä¸»æœºåï¼Œæˆ‘ä»¬çœ‹ä¸‹æœåŠ¡æ˜¯å¦å¯åŠ¨ã€‚</div><div class="line"></div><div class="line">4. çœ‹zabbix_serverå’Œzabbix_agentè¿›ç¨‹ã€ç«¯å£éƒ½æ­£å¸¸ </div><div class="line">   netstat -ntulp</div><div class="line">å¦‚æœæ²¡æœ‰å¯åŠ¨ éœ€è¦æ‰‹åŠ¨å¯åŠ¨ä¸‹ï¼Œè¿™é‡Œå¯èƒ½æœåŠ¡æ²¡æœ‰å¯åŠ¨ï¼Œå¯åŠ¨æœåŠ¡å³å¯ã€‚</div></pre></td></tr></table></figure>
<h3 id="2-Zabbix-agentdæ—¥å¿—æŠ¥é”™Get-value-from-agent-failed-cannot-connect-to-192-168-1-218-10050-113-No-route-to-host"><a href="#2-Zabbix-agentdæ—¥å¿—æŠ¥é”™Get-value-from-agent-failed-cannot-connect-to-192-168-1-218-10050-113-No-route-to-host" class="headerlink" title="2.Zabbix-agentdæ—¥å¿—æŠ¥é”™Get value from agent failed: cannot connect to [[192.168.1.218]:10050]: [113] No route to host"></a>2.Zabbix-agentdæ—¥å¿—æŠ¥é”™<code>Get value from agent failed: cannot connect to [[192.168.1.218]:10050]: [113] No route to host</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">* æ’é”™:</div><div class="line"></div><div class="line">çœ‹æç¤ºâ€œNo route to hostâ€ï¼Œä¸ç½‘ç»œè¿æ¥æœ‰å…³ã€‚æ’é™¤çš„æ–¹æ³•å¦‚ä¸‹:</div><div class="line"></div><div class="line">aï¼‰æŸ¥çœ‹192.168.30.3è¿™å°æœºå™¨æ˜¯å¦å·²å¼€æœº</div><div class="line">b)åœ¨zabbix serverç«¯å‘è¿™å°æœºå™¨pingï¼Œçœ‹ç½‘ç»œæ˜¯å¦é€š</div><div class="line">cï¼‰ç”¨telnet ç™»å½•10050å’Œ10051ç«¯å£ï¼Œçœ‹è¯¥ä¸»æœºæ˜¯å¦å…è®¸è¿™ä¸¤ä¸ªç«¯å£é€šè®¯</div><div class="line">d)æŸ¥çœ‹iptablesé˜²ç«å¢™è§„åˆ™æ˜¯å¦æ‹¦æˆª10050ã€10051ç«¯å£</div></pre></td></tr></table></figure>
<h3 id="3-æ—¶é—´ä¸åŒæ­¥Check-if-client-local-time-is-in-sync-with-Zabbix-server-time"><a href="#3-æ—¶é—´ä¸åŒæ­¥Check-if-client-local-time-is-in-sync-with-Zabbix-server-time" class="headerlink" title="3.æ—¶é—´ä¸åŒæ­¥Check if client local time is in sync with Zabbix server time"></a>3.æ—¶é—´ä¸åŒæ­¥<code>Check if client local time is in sync with Zabbix server time</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">å› ä¸ºæˆ‘åœ¨æˆ‘çš„ç½‘ç»œä¸­çš„ä¸€äº›NTPæœåŠ¡å™¨ï¼Œè¿™å°†æ˜¯å¾ˆå¥½èƒ½å¤Ÿæµ‹é‡ä¸»æœºå’Œè¿™äº›æœåŠ¡å™¨ä¹‹ä¸€ä¹‹é—´çš„æ—¶é—´å·®ã€‚å¯æ‚²çš„æ˜¯ï¼Œè¿™å‡ ä¹æ˜¯ä¸å¯èƒ½çš„ã€‚</div><div class="line">ä½†æœ‰ä¸€ä¸ªè§£å†³æ–¹æ¡ˆ:</div><div class="line"></div><div class="line">`system.localtime.fuzzytime`ï¼Œç…§é¡¾è¿™åªæ˜¯ä¸€ä¸ª!!!è§¦å‘çš„â€œfuzzytimeâ€åŠŸèƒ½å‘å‡ºè­¦æŠ¥ï¼Œå¦‚æœè¢«ç›‘æ§æœåŠ¡å™¨çš„æ—¶é—´æ¼‚ç§»ã€‚å®ƒæ¯”è¾ƒæŠ¥å‘Šä¸»æœºçš„æ—¶é—´çš„zabbixæœåŠ¡å™¨åœ¨è§¦å‘å™¨è¢«å¤„ç†çš„æ—¶é—´ä¸Šçš„æ—¶é—´ã€‚fuzzytimeï¼ˆç§’ï¼‰ï¼Œå¯èƒ½æ˜¯ï¼ˆæµ®ç‚¹ï¼Œæ•´æ•°ï¼‰:</div><div class="line"></div><div class="line">è¿”å›1ï¼Œå¦‚æœæ—¶é—´æˆ³ï¼ˆé¡¹ç›®å€¼ï¼‰ä¸ä»çš„zabbixæœåŠ¡å™¨æ—¶é—´æœ‰æ‰€ä¸åŒè¶…è¿‡Nç§’ï¼Œ0 -å¦åˆ™é€šå¸¸ç”¨äºsystem.localtimeæ£€æŸ¥æœ¬åœ°æ—¶é—´åœ¨æœåŠ¡å™¨çš„zabbixæœ¬åœ°æ—¶é—´åŒæ­¥ã€‚</div><div class="line">æ³¨:æ·»åŠ å…¬å¼æ—¶ï¼Œä½¿ç”¨â€œæ·»åŠ â€æŒ‰é’®ï¼Œåœ¨å³ä¾§ï¼Œè¿™æ˜¯å¾ˆç®€å•çš„è¿™ç§æ–¹å¼ï¼</div><div class="line"></div><div class="line">ç³»ç»Ÿæ—¶é—´è·Ÿæˆ‘ç°åœ¨åŒ—äº¬æ—¶é—´ä¸åŒæ­¥ã€‚</div><div class="line">date -R </div><div class="line">æŸ¥çœ‹ä¸‹</div><div class="line"></div><div class="line">éœ€è¦æ‰‹åŠ¨æ·»åŠ è®¡åˆ’ä»»åŠ¡åŒæ­¥ä¸‹ï¼Œè®¾ç½®å¼€æœºå¯åŠ¨ã€‚è¿™é‡ŒIPæ˜¯zabbix-server IP</div><div class="line"></div><div class="line">00 * * * * /usr/sbin/ntpdate 192.168.47.20 &gt;/dev/null 2&gt;&amp;1</div></pre></td></tr></table></figure>
<p>è¿˜æœ‰ä¸æ‡‚å¾—å¯ä»¥çœ‹:<a href="http://en.linuxkitchen.com/2014/11/03/zabbix-and-time-difference-from-host-to-zabbix-server/" target="_blank" rel="external">å‚è€ƒ</a></p>
<h3 id="4-MySQLå†…å­˜ä¸å¤Ÿ-Lack-of-available-memory-on-server-MySQL"><a href="#4-MySQLå†…å­˜ä¸å¤Ÿ-Lack-of-available-memory-on-server-MySQL" class="headerlink" title="4.MySQLå†…å­˜ä¸å¤Ÿ Lack of available memory on server MySQL"></a>4.MySQLå†…å­˜ä¸å¤Ÿ <code>Lack of available memory on server MySQL</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">æ•…éšœåŸå› :Lack of available memory on server argus047072</div><div class="line"></div><div class="line">éœ€è¦æ·»åŠ å†…å­˜</div><div class="line">æ•…éšœåŸå› :Redisé“¾æ¥æ•°è¶…è¿‡æœ€å¤§å®¢æˆ·ç«¯æ•°é‡é™åˆ¶ã€‚</div><div class="line">æ˜¯å¦æœ‰å¤§é‡çš„è¿›ç¨‹åœ¨åå°è¿è¡Œ</div></pre></td></tr></table></figure>
<h3 id="5-Zabbix-agentä¸é€šReceived-empty-response-from-Zabbix-Agent"><a href="#5-Zabbix-agentä¸é€šReceived-empty-response-from-Zabbix-Agent" class="headerlink" title="5.Zabbix-agentä¸é€šReceived empty response from Zabbix Agent"></a>5.Zabbix-agentä¸é€š<code>Received empty response from Zabbix Agent</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">å‡ºç°å¦‚ä¸‹é”™è¯¯:</div><div class="line"></div><div class="line">Received empty response from Zabbix Agent at [192.168.1.2]. Assuming that agent dropped connection because of access permission</div><div class="line">å¤§æ¦‚æ„æ€æ˜¯è¯´æ²¡æœ‰æƒé™è®¿é—®agentç«¯å£10050ï¼Œè§£å†³æ–¹æ³•å¦‚ä¸‹:</div><div class="line"></div><div class="line"><span class="comment"># cat zabbix_agentd.conf| grep Server=</span></div><div class="line">Server=192.168.1.2  <span class="comment"># zabbix server ipåœ°å€</span></div><div class="line"></div><div class="line">å¦‚æœä½ çš„serveræœ‰å¤šä¸ªIPåœ°å€ï¼Œä½¿ç”¨é€—å·åˆ†éš”å¤šä¸ªIPåœ°å€ã€‚</div></pre></td></tr></table></figure>
<h3 id="6-ZabbixæŠ¥é”™ç£ç›˜ä¸è¶³Free-disk-space-is-less-than-20-on-volume-home"><a href="#6-ZabbixæŠ¥é”™ç£ç›˜ä¸è¶³Free-disk-space-is-less-than-20-on-volume-home" class="headerlink" title="6.ZabbixæŠ¥é”™ç£ç›˜ä¸è¶³Free disk space is less than 20% on volume /home"></a>6.ZabbixæŠ¥é”™ç£ç›˜ä¸è¶³<code>Free disk space is less than 20% on volume /home</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">ç£ç›˜æ€»å…±å¤§å°</div><div class="line">du -Th</div><div class="line"></div><div class="line">å®šä½æŸ¥çœ‹æ˜¯ä»€ä¹ˆæ¶ˆè€—é‚£ä¹ˆå¤šç£ç›˜ç©ºé—´ï¼ŒæŸ¥çœ‹homeç›®å½•ã€‚</div><div class="line">du <span class="_">-s</span> -h /srv/tomcat/tomcat_account/logs/* | sort</div><div class="line">1G localhost.2015-12-21.log</div><div class="line">2G localhost.2015-12-22.log</div><div class="line">2G localhost.2015-12-23.log</div><div class="line">.....</div><div class="line"></div><div class="line">find /srv/tomcat/tomcat_account/logs/ -mtime +1 -name <span class="string">"*.log"</span> -exec rm -rf &#123;&#125; \;</div><div class="line">è¿™ä¸ªä¿ç•™å‰ä¸€å¤©çš„æ—¥å¿—å…¶ä½™éƒ½åˆ é™¤ã€‚</div><div class="line"></div><div class="line">1. è®¡åˆ’ä»»åŠ¡è„šæœ¬æ¸…é™¤å‰ä¸€å¤©</div><div class="line"></div><div class="line">00 00 * * * find  /home/admin/output/ -mtime +1 -exec rm &#123;&#125; \;</div><div class="line"></div><div class="line">2. æˆ–è€…ä½¿ç”¨è„šæœ¬æ”¾åˆ°è®¡åˆ’ä»»åŠ¡é‡Œé¢è·‘</div><div class="line"></div><div class="line">1 0 * * * /opt/soft/<span class="built_in">log</span>/qingli-log.sh &gt;/dev/null 2&gt;&amp;1</div><div class="line"></div><div class="line">è¿™é‡Œçš„è®¾ç½®æ˜¯æ¯å¤©å‡Œæ™¨0ç‚¹1åˆ†æ‰§è¡Œqingli-log.sh .shæ–‡ä»¶è¿›è¡Œæ•°æ®æ¸…ç†ä»»åŠ¡äº†ã€‚</div><div class="line">åœ¨æŸ¥çœ‹ç£ç›˜æ€»å…±å¤§å°</div></pre></td></tr></table></figure>
<h3 id="7-Zabbixç›‘æ§æŠ¥é”™zabbix-server-is-not-running-the-information-displayed-may-not-be-current"><a href="#7-Zabbixç›‘æ§æŠ¥é”™zabbix-server-is-not-running-the-information-displayed-may-not-be-current" class="headerlink" title="7.Zabbixç›‘æ§æŠ¥é”™zabbix server is not running: the information displayed may not be current"></a>7.Zabbixç›‘æ§æŠ¥é”™<code>zabbix server is not running: the information displayed may not be current</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">æ•…éšœåŸå› :Zabbix agent on labs047093 is unreachable <span class="keyword">for</span> 5 minutesZabbixä½¿ç”¨ä¸€æ®µæ—¶é—´åæ€»æ˜¯æŠ¥Zabbix Agentä¸å¯åˆ°è¾¾</div><div class="line"></div><div class="line">è§£å†³ç»“æœ:è¿™ä¸‰å°æœºå™¨ç½‘ç»œä¸é€šï¼Œsshè¿æ¥ä¸ä¸Šï¼Œæ’é”™æ–¹æ³•æŸ¥çœ‹æ—¥å¿—æ˜¯å¦æœ‰æŠ¥é”™ï¼Œæ˜¯å¦æœåŠ¡æ²¡æœ‰èµ·æ¥ã€‚</div><div class="line">å¦‚æœæ•°æ®åº“æœåŠ¡å™¨æ˜¯ä¸€ç›´æ­£å¸¸çš„ï¼ŒSELinuxæ˜¯äº‹å…ˆå…³é—­æ²¡æœ‰ï¼Œä¿®æ”¹å®Œä¸Šè¿°æ‰€æåˆ°çš„åå‘ç°é—®é¢˜ä¾ç„¶ã€‚</div><div class="line"></div><div class="line">Zabbixä¾ç„¶æŠ¥é”™ï¼ˆZabbix Server Messages: PROBLEM: Zabbix agent on Zabbix server is unreachable <span class="keyword">for</span> 5 minutesã€‚</div><div class="line">æŸ¥çœ‹æ—¥å¿—æŠ¥ä»€ä¹ˆé”™ï¼Œå®šä½è§£å†³é—®é¢˜ï¼Œä¸€èˆ¬å‡ºç°è¿™ä¸ªå¤§éƒ¨åˆ†æ•°æ®å»¶è¿Ÿå¯¼è‡´ï¼Œåœ¨å›¾å½¢ä¸Šé¢æ˜æ˜¾çœ‹åˆ°æœ‰4åˆ°5åˆ†é’Ÿæ•°æ®æ˜¯ç©ºç™½çš„ã€‚</div></pre></td></tr></table></figure>
<h3 id="8-Zabbixå›¾å½¢å‡ºç°ä¹±ç æˆ–è€…æ²¡æœ‰æ–‡å­—"><a href="#8-Zabbixå›¾å½¢å‡ºç°ä¹±ç æˆ–è€…æ²¡æœ‰æ–‡å­—" class="headerlink" title="8.Zabbixå›¾å½¢å‡ºç°ä¹±ç æˆ–è€…æ²¡æœ‰æ–‡å­—"></a>8.Zabbixå›¾å½¢å‡ºç°ä¹±ç æˆ–è€…æ²¡æœ‰æ–‡å­—</h3><p>å‚è€ƒæ–‡æ¡£:<a href="https://github.com/yangcvo/zabbix.2.4" target="_blank" rel="external">zabbix2.4å›¾å½¢ä¹±ç </a></p>
<h3 id="9-Zabbixç›‘æ§ä¹‹é‚®ä»¶å‘Šè­¦å‘é€å¤±è´¥smtp-server-é”™è¯¯ä»£ç 550ä¸535"><a href="#9-Zabbixç›‘æ§ä¹‹é‚®ä»¶å‘Šè­¦å‘é€å¤±è´¥smtp-server-é”™è¯¯ä»£ç 550ä¸535" class="headerlink" title="9.Zabbixç›‘æ§ä¹‹é‚®ä»¶å‘Šè­¦å‘é€å¤±è´¥smtp-server: é”™è¯¯ä»£ç 550ä¸535"></a>9.Zabbixç›‘æ§ä¹‹é‚®ä»¶å‘Šè­¦å‘é€å¤±è´¥smtp-server: é”™è¯¯ä»£ç 550ä¸535</h3><p>å‚è€ƒæ–‡æ¡£:<a href="http://clovemfong.blog.51cto.com/3297559/1702105/" target="_blank" rel="external">zabbix163é‚®ä»¶å‘Šè­¦é”™è¯¯ä»£ç </a></p>
<h3 id="10-Zabbixä¸­æç¤ºï¼šLack-of-free-swap-space-on-hostname"><a href="#10-Zabbixä¸­æç¤ºï¼šLack-of-free-swap-space-on-hostname" class="headerlink" title="10.Zabbixä¸­æç¤ºï¼šLack of free swap space on hostname"></a>10.Zabbixä¸­æç¤ºï¼š<code>Lack of free swap space on hostname</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">æç¤ºï¼šç¼ºäº¤æ¢ç©ºé—´å¯ä»¥åˆ›å»ºä¹Ÿå¯ä»¥ä¸ç”¨åˆ›å»ºã€‚</div><div class="line"></div><div class="line">[root@xx ~]<span class="comment"># free -m</span></div><div class="line">             total       used       free     shared    buffers     cached</div><div class="line">Mem:          3832       3488        343          0        267       2389</div><div class="line">-/+ buffers/cache:        831       3000</div><div class="line">swap:            0          0          0</div><div class="line"></div><div class="line">ä¸ªèˆ¬ç‰©ç†æœºä¸å¯èƒ½ä¸è®¾äº¤æ¢åˆ†åŒºï¼Œæ˜¾ç„¶è¿™æ ·çš„è®¾è®¡æ²¡æœ‰è€ƒè™‘åˆ°äº‘ä¸»æœºç”¨æˆ·ã€‚åªéœ€è¦è°ƒèŠ‚ç›‘æ§æ–‡ä»¶ï¼Œå³å¯è§£å†³é—®é¢˜ï¼š</div><div class="line">è§£å†³æ­¤é—®é¢˜çš„æ­¥éª¤å¦‚ä¸‹:é€‰æ‹© Configuration-&gt;Templates(æ¨¡æ¿),åœ¨æ¨¡æ¿ç•Œé¢ä¸­é€‰æ‹©Template OS Linuxå³ä¾§çš„Triggersï¼ˆè§¦å‘å™¨ï¼‰,</div><div class="line">åœ¨è§¦å‘å™¨é¡µé¢ä¸­æ‰“å¼€Lack of free swap space on &#123;HOST.NAME&#125;é¡¹ç›®,åœ¨æ–°æ‰“å¼€çš„è§¦å‘å™¨ç¼–è¾‘é¡µé¢ä¸­ä¿®æ”¹Expressionï¼ˆè¡¨è¾¾å¼ï¼‰çš„å†…å®¹,</div><div class="line">ç”±åŸå…ˆçš„&#123;Template OS Linux:system.swap.size[,pfree].last(0)&#125;&lt;50</div><div class="line"></div><div class="line">ä¿®æ”¹ä¸º&#123;Template OS Linux:system.swap.size[,pfree].last(0)&#125;&lt;50 and &#123;Template OS Linux:system.swap.size[,free].last(0)&#125;&lt;&gt;0</div><div class="line"></div><div class="line"> æ­¤å¤„ä¿®æ”¹å¢åŠ äº†â€œand&#123;Template OS Linux:system.swap.size[,free].last(0)&#125;&lt;&gt;0â€åˆ¤æ–­ç³»ç»Ÿæœ‰äº¤æ¢ç©ºé—´ï¼Œå½“ç³»ç»Ÿæ— äº¤æ¢ç©ºé—´&#123;Template OS</div><div class="line">Linux:system.swap.size[,free].last(0)&#125;çš„å€¼ä¸º0æ—¶å°†ä¸ä¼šä½¿è¡¨è¾¾å¼æˆç«‹ï¼Œ</div><div class="line">ä¹Ÿå°±ä¸ä¼šè§¦å‘é”™è¯¯æç¤ºã€‚ä¿å­˜ååœ¨ä¸‹ä¸€ä¸ªæ›´æ–°å‘¨æœŸå†…zabbixä¹‹å‰æŠ¥å‘Šâ€œLack of free swap spaceâ€é—®é¢˜å°±ä¼šè¢«è‡ªåŠ¨æ ‡è®°ä¸ºResolved.</div><div class="line"></div><div class="line">æˆ–è€…åˆ›å»ºï¼š</div><div class="line"></div><div class="line">1ã€é¦–å…ˆçœ‹ä¸€ä¸‹å†…å­˜</div><div class="line">free -m</div><div class="line">2ã€ç„¶ååˆ›å»ºä¸€ä¸ªåˆ†åŒºæ·»åŠ äº¤æ¢æ–‡ä»¶</div><div class="line">mkdir /etc/swap/</div><div class="line">dd <span class="keyword">if</span>=/dev/zero of=/etc/swap/swap bs=1024 count=1024000  1ä¸ªG</div><div class="line">3ã€åˆ›å»ºäº¤æ¢ç©ºé—´</div><div class="line">mkswap /etc/swap/swap</div><div class="line">4ã€å¯åŠ¨äº¤æ¢ç©ºé—´</div><div class="line">swapon /etc/swap/swap</div><div class="line">5ã€æŸ¥çœ‹æ–°å¢ç©ºé—´</div><div class="line">free -tom</div><div class="line">6ã€ä¿®æ”¹/etc/fstabæ–‡ä»¶ä½¿ç³»ç»Ÿåœ¨é‡æ–°å¯åŠ¨çš„æ—¶å€™ç”Ÿæ•ˆ</div><div class="line">/etc/swap/swap         swap                    swap    defaults        0 0</div></pre></td></tr></table></figure>
<h3 id="11-Zabbix-agentæ—¥å¿—ç«¯hostnameä¸ä¸€è‡´ï¼šcannot-send-list-of-active-checks-to-192-168-0-1-host-Zabbix-server-not-found"><a href="#11-Zabbix-agentæ—¥å¿—ç«¯hostnameä¸ä¸€è‡´ï¼šcannot-send-list-of-active-checks-to-192-168-0-1-host-Zabbix-server-not-found" class="headerlink" title="11.Zabbix-agentæ—¥å¿—ç«¯hostnameä¸ä¸€è‡´ï¼šcannot send list of active checks to [192.168.0.1]: host [Zabbix server] not found"></a>11.Zabbix-agentæ—¥å¿—ç«¯hostnameä¸ä¸€è‡´ï¼š<code>cannot send list of active checks to [192.168.0.1]: host [Zabbix server] not found</code></h3><figure class="highlight vbscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">æŸ¥çœ‹è¢«ç›‘æ§æœºä¸Šçš„/tmp/zabbix_agentd.<span class="built_in">log</span>ï¼Œæ˜¾ç¤ºæ—¥å¿—ï¼š</div><div class="line">No active checks <span class="keyword">on</span> <span class="built_in">server</span>: host [Zabbix <span class="built_in">server</span>] <span class="keyword">not</span> found</div><div class="line"></div><div class="line">è¿™æ˜¯å› ä¸ºï¼Œé€šè¿‡zabbix dashboardé¡µé¢é…ç½®çš„è¢«ç›‘æ§ä¸»æœºåè·Ÿè¢«ç›‘æ§ä¸»æœºä¸Šzabbix_agentd.confä¸­é…ç½®çš„Hostnameä¸ä¸€è‡´ã€‚</div><div class="line"></div><div class="line">ä¿®æ”¹ä¸ºä¸€è‡´çš„åå­—åï¼Œé‡å¯zabbix_agentdå³å¯ã€‚</div></pre></td></tr></table></figure>
<h3 id="12-è§£å†³CentOS-7å®‰è£…zabbix-3-0-æ— æ³•å¯åŠ¨zabbix-serverçš„é—®é¢˜"><a href="#12-è§£å†³CentOS-7å®‰è£…zabbix-3-0-æ— æ³•å¯åŠ¨zabbix-serverçš„é—®é¢˜" class="headerlink" title="12.è§£å†³CentOS 7å®‰è£…zabbix 3.0 æ— æ³•å¯åŠ¨zabbix-serverçš„é—®é¢˜"></a>12.è§£å†³CentOS 7å®‰è£…zabbix 3.0 æ— æ³•å¯åŠ¨zabbix-serverçš„é—®é¢˜</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[root@kvm zabbix_agentd.d]<span class="comment"># service zabbix-agent restart</span></div><div class="line">Redirecting to /bin/systemctl restart  zabbix-agent.service</div><div class="line">Job <span class="keyword">for</span> zabbix-agent.service failed because a configured resource <span class="built_in">limit</span> was exceeded. See <span class="string">"systemctl status zabbix-agent.service"</span> and <span class="string">"journalctl -xe"</span> <span class="keyword">for</span> details.</div><div class="line"></div><div class="line">è§£å†³æ–¹æ¡ˆ:</div><div class="line">å…³é—­SELinuxæœåŠ¡ ã€‚ æ‰§è¡Œå‘½ä»¤</div><div class="line">setenforce 0 </div><div class="line"></div><div class="line">3. é‡å¯zabbix</div><div class="line">systemctl  restart  zabbix-server.service</div></pre></td></tr></table></figure>
<h3 id="13-zabbix-è¿”å›å€¼ä¸ºç©º-é”®å€¼æ¨¡æ¿æŠ¥é”™ï¼šReceived-value-is-not-suitable-for-value-type-Numeric-unsigned-and-data-type-Decimal"><a href="#13-zabbix-è¿”å›å€¼ä¸ºç©º-é”®å€¼æ¨¡æ¿æŠ¥é”™ï¼šReceived-value-is-not-suitable-for-value-type-Numeric-unsigned-and-data-type-Decimal" class="headerlink" title="13.zabbix è¿”å›å€¼ä¸ºç©º é”®å€¼æ¨¡æ¿æŠ¥é”™ï¼šReceived value [] is not suitable for value type [Numeric (unsigned)] and data type [Decimal]"></a>13.zabbix è¿”å›å€¼ä¸ºç©º é”®å€¼æ¨¡æ¿æŠ¥é”™ï¼š<code>Received value [] is not suitable for value type [Numeric (unsigned)] and data type [Decimal]</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">è§£å†³ï¼š</div><div class="line">æœ¬åœ°è„šæœ¬è·å–å€¼æœ‰è¿”å›ï¼Œè„šæœ¬æ²¡æœ‰zabbixèµ‹æƒ~</div><div class="line">ç›‘æ§ç«¯æ‰§è¡Œè„šæœ¬ï¼š</div><div class="line">[root@jollychic-db-slave4 zabbix]<span class="comment"># sh mysql3307.sh Qcache_queries_in_cache</span></div><div class="line">87</div><div class="line"></div><div class="line">zabbix æœåŠ¡ç«¯ï¼š</div><div class="line">[root@yum-zabbix ~]<span class="comment">#  zabbix_get -s 10.155.74.247 -k mysql.status3307[Threads_running]</span></div><div class="line"></div><div class="line">è¿”å›ç©ºè¿™é‡Œå°±æ˜¯è„šæœ¬æ²¡æœ‰zabbixèµ‹æƒ~</div><div class="line">è¿™é‡Œè„šæœ¬éœ€è¦æ·»åŠ ä¸‹-h127.0.0.1 å³å¯</div></pre></td></tr></table></figure>
<h3 id="14-è§£å†³Zabbixâ€œZBX-NOTSUPPORTED-Timeout-while-executing-a-shell-scriptâ€"><a href="#14-è§£å†³Zabbixâ€œZBX-NOTSUPPORTED-Timeout-while-executing-a-shell-scriptâ€" class="headerlink" title="14.è§£å†³Zabbixâ€œZBX_NOTSUPPORTED: Timeout while executing a shell scriptâ€"></a>14.è§£å†³<code>Zabbixâ€œZBX_NOTSUPPORTED: Timeout while executing a shell scriptâ€</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">è§£å†³æ–¹æ¡ˆ</div><div class="line"></div><div class="line">ï¼ˆ1ï¼‰ä¿®æ”¹zabbix_serverçš„zabbix_server.confï¼š</div><div class="line">[root@nmp01 scripts]<span class="comment"># vim /usr/local/zabbix/etc/zabbix_server.conf</span></div><div class="line">ä¿®æ”¹ä»¥ä¸‹å‚æ•°ï¼š</div><div class="line">Timeout=30</div><div class="line">æ³¨ï¼šè¶…æ—¶æ—¶é—´ä¸º30ç§’</div><div class="line"></div><div class="line">ï¼ˆ2ï¼‰ä¿®æ”¹è„šæœ¬æ‰€åœ¨zabbix_agentdçš„zabbix_agentd.confï¼š</div><div class="line"></div><div class="line">vim /usr/<span class="built_in">local</span>/zabbix/etc/zabbix_agentd.conf</div><div class="line">ä¿®æ”¹ä»¥ä¸‹å‚æ•°ï¼š</div><div class="line">Timeout=30</div><div class="line">ï¼ˆ3ï¼‰é‡å¯zabbixæœåŠ¡ç«¯å’Œè„šæœ¬æ‰€åœ¨å®¢æˆ·ç«¯ï¼š</div><div class="line">service zabbix_server restart</div><div class="line">service zabbix_agentd restart</div></pre></td></tr></table></figure>
<h3 id="15-Zabbix3-0-poller-processes-more-than-75-busyè­¦æŠ¥å¤„ç†"><a href="#15-Zabbix3-0-poller-processes-more-than-75-busyè­¦æŠ¥å¤„ç†" class="headerlink" title="15.Zabbix3.0 poller processes more than 75% busyè­¦æŠ¥å¤„ç†"></a>15.<code>Zabbix3.0 poller processes more than 75% busy</code>è­¦æŠ¥å¤„ç†</h3><p>è™½ç„¶Zabbixçš„ç›‘æ§è­¦æŠ¥å„ç§æœ‰ï¼Œä½†<code>yancy</code>ä½¿ç”¨ç¢°åˆ°æœ€å¤šçš„å‡ ä¸ªè«è¿‡äºå†…å­˜è€—å°½ï¼Œç½‘ç»œä¸é€šï¼ŒIOå¤ªæ…¢è¿˜æœ‰è¿™ä¸ªâ€œZabbix poller processes more than 75% busyâ€äº†ã€‚ä¸€å¼€å§‹çš„æ—¶å€™å› ä¸ºè¿™ä¸ªå³ä¸å½±å“ä½¿ç”¨ä¹ŸæŒç»­ä¸€ä¼šå„¿å°±è‡ªè¡Œè§£å†³å°±æ²¡æœ‰å¤šåœ¨æ„ã€‚ç„¶åéšç€æ•°æ®åº“çš„å¢å¤§ï¼ŒZabbixæ¶ˆè€—çš„å†…å­˜å¯æ˜¯è¶Šæ¥è¶Šå¤šï¼ŒPoller processesï¼ˆè½®è¯¢ï¼‰å¼€å§‹å¤©å¤©Busyäº†ï¼Œæœ€ç»ˆ<code>yancy</code>ä¸å¾—ä¸æŠŠZabbixæŒªåˆ°äº†å¦å¤–ä¸€å°æœåŠ¡å™¨ä¸Šã€‚</p>
<p>ä½†è¿™å¹¶æ²¡æœ‰å½»åº•è§£å†³é—®é¢˜ï¼Œè­¦æŠ¥ä»ç„¶ä¸‰å¤©ä¸¤å¤´æ¥å‡ ä¸ªã€‚ä¹‹åKaijiaå¼€å¯äº†Zabbixè­¦æŠ¥çš„é‚®ä»¶åŠŸèƒ½ï¼Œäºæ˜¯å¼€å§‹é¢‘ç¹æ”¶åˆ°è¿™ç±»é‚®ä»¶ï¼Œäºæ˜¯Kaijiaå†³å®šè§£å†³è¿™ä¸ªé—®é¢˜ã€‚Googleäº†ä¸€ä¸‹èµ„æ–™ï¼Œæ²¡æœ‰æ‰¾åˆ°å¾ˆæƒå¨çš„ç­”æ¡ˆï¼Œé€ æˆè½®è¯¢å¿™çš„é—®é¢˜æœ‰å¾ˆå¤šä¸­ï¼Œæ”¯æ’‘Zabbixçš„MySQLå¡ä½äº†ï¼ŒZabbixæœåŠ¡å™¨çš„IOå¡ä½äº†éƒ½æœ‰å¯èƒ½ï¼ŒZabbixè¿›ç¨‹åˆ†é…åˆ°å†…å­˜ä¸è¶³éƒ½æœ‰å¯èƒ½ã€‚ä¸€ä¸ªç®€å•çš„æ–¹æ³•æ˜¯å¢åŠ Zabbix Serverå¯åŠ¨æ—¶åˆå§‹åŒ–çš„è¿›ç¨‹æ•°é‡ï¼Œè¿™æ ·ç›´æ¥å¢åŠ äº†è½®è¯¢çš„è´Ÿè½½é‡ï¼Œä»æ¯”ä¾‹ä¸Šæ¥è®²å¿™çš„æƒ…å†µå°±å°‘äº†ã€‚</p>
<p>å¢åŠ åˆå§‹åŒ–è¿›ç¨‹çš„æ–¹æ³•éå¸¸ç®€å•ï¼Œç¼–è¾‘Zabbix Serverçš„é…ç½®æ–‡ä»¶<code>/etc/zabbix/zabbix_server.conf</code>ï¼Œæ‰¾åˆ°é…ç½®StartPollersçš„æ®µè½ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">1. <span class="comment">### Option: StartPollers</span></div><div class="line">2. <span class="comment">#       Number of pre-forked instances of pollers.</span></div><div class="line">3. <span class="comment">#</span></div><div class="line">4. <span class="comment"># Mandatory: no</span></div><div class="line">5. <span class="comment"># Range: 0-1000</span></div><div class="line">6. <span class="comment"># Default:</span></div><div class="line">7. <span class="comment"># StartPollers=5</span></div></pre></td></tr></table></figure>
<p>å–æ¶ˆStartPollers=ä¸€è¡Œçš„æ³¨é‡Šæˆ–è€…ç›´æ¥åœ¨åé¢å¢åŠ ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">StartPollers=10</div></pre></td></tr></table></figure>
<p>å› ä¸ºä¹‹å‰zabbixé™¤äº†å•ç‹¬è·‘ä¸€ä¸ªserveræœåŠ¡è¿˜æœ‰<code>agent</code>è¿˜æœ‰<code>grafana-server</code>è¿˜æœ‰ä»£ç†ï¼Œåé¢æˆ‘å…ˆæ‰©å¤§å†…å­˜å’ŒæœåŠ¡å™¨CPU.<br>å°†StartPollersæ”¹æˆå¤šå°‘å–å†³äºæœåŠ¡å™¨çš„æ€§èƒ½å’Œç›‘æ§çš„æ•°é‡ï¼ŒKaijiaå°†StartPollersè®¾ç½®æˆ12ä¹‹åå°±å†æ²¡æœ‰é‡åˆ°è¿‡è­¦æŠ¥ã€‚å¦‚æœå†…å­˜è¶³å¤Ÿçš„è¯å¯ä»¥è®¾ç½®æ›´é«˜ã€‚è®¾ç½®å®Œæˆä¹‹åè¿è¡Œï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">service zabbix-server restart</div></pre></td></tr></table></figure>
<p>é‡å¯Zabbixã€‚å½“ç„¶å¦å¤–ä¸€ç§ä»æ•´ä½“ä¸Šé™ä½ZabbixæœåŠ¡å™¨è´Ÿè½½çš„æ–¹æ³•å°±æ˜¯å®šæœŸé‡å¯Zabbixï¼Œè¿™ç§æ–¹æ³•å¯ä»¥ç”¨Cronå®ç°ï¼Œè¿è¡Œï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">crontab <span class="_">-e</span></div></pre></td></tr></table></figure>
<p>åœ¨è°ƒå‡ºçš„Cronç¼–è¾‘å™¨ä¸­å¢åŠ ä¸€ä¸ªè®¡åˆ’ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">00 * * * * service zabbix-server restart &gt; /dev/null 2&gt;&amp;1</div></pre></td></tr></table></figure>
<p>è¿™ä¸ªè®¡åˆ’ä¼šæ¯å¤©è‡ªåŠ¨é‡å¯ZabbixæœåŠ¡ä»¥ç»“æŸåƒµå°¸è¿›ç¨‹å¹¶æ¸…ç†å†…å­˜ç­‰ã€‚ç›®å‰Kaijiaè¿™æ ·é…ç½®Zabbixåè¿˜æ²¡æœ‰å†æ¬¡é‡åˆ°è¿‡â€œZabbix poller processes more than 75% busyâ€çš„é—®é¢˜ã€‚</p>
<h3 id="16ã€Zabbix3-0-monitoringå‡ºç°ä¹±ç "><a href="#16ã€Zabbix3-0-monitoringå‡ºç°ä¹±ç " class="headerlink" title="16ã€Zabbix3.0-monitoringå‡ºç°ä¹±ç "></a>16ã€Zabbix3.0-monitoringå‡ºç°ä¹±ç </h3><p>å‡ºç°ä¹±ç ï¼š</p>
<ul>
<li>ä¹±ç å®‰è£…åŒ…ä¸‹è½½åœ°å€ï¼š<a href="http://oak0aohum.bkt.clouddn.com/simkai.ttf" target="_blank" rel="external">ä¸­æ–‡æ±‰åŒ–ä¹±ç åŒ…</a></li>
</ul>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">* å‚è€ƒæ–‡æ¡£ï¼š</div><div class="line">zabbixç‰ˆæœ¬éƒ½å·²æœ‰æ±‰åŒ–åŠŸèƒ½äº†ï¼Œç›´æ¥é€‰æ‹©ä¸­æ–‡å°±è¡Œã€‚</div><div class="line">å¯æ˜¯ä½ç‰ˆæœ¬çš„å°±éœ€è¦å®‰è£…æ±‰åŒ–ï¼Œå¯æ˜¯å‘ç°æ‰“å¼€å›¾å½¢ç•Œé¢æ˜¯ç©ºç™½å›¾å½¢ï¼š</div><div class="line">é‡åˆ°ä¸­æ–‡ä¹±ç é—®é¢˜ã€‚zabbixä¹±ç æ˜¯æ€ä¹ˆç…§æˆçš„å‘¢ï¼Ÿzabbixä½¿ç”¨DejaVuSan.ttfå­—ä½“ï¼Œä¸æ”¯æŒä¸­æ–‡ï¼Œå¯¼è‡´ä¸­æ–‡å‡ºç°ä¹±ç ã€‚è§£å†³æ–¹æ³•å¾ˆç®€å•ï¼ŒæŠŠæˆ‘ä»¬ç”µè„‘é‡Œé¢å­—ä½“æ–‡ä»¶ä¼ åˆ°zabbixæœåŠ¡å™¨ä¸Šã€‚</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">* åœ¨zabbix<span class="params">-server</span>ç«¯ä¸Šé¢è¿›å…¥å®‰è£…ç›®å½•ï¼š</div><div class="line"></div><div class="line"><span class="built_in">var</span>/www/html/zabbix/fontsç›®å½•ä¸‹é¢æŸ¥çœ‹ï¼Œå‘ç°ä¹‹å‰ä¸Šä¼ å­—ä½“çš„æ–‡ä»¶ååç¼€æ˜¯.ttcï¼ŒçŒœç€ä¸€èˆ¬è§åˆ°çš„éƒ½åç¼€éƒ½æ˜¯ttfçš„ï¼Œä¼šä¸ä¼šæ˜¯è¿™ä¸ªé—®é¢˜å¯¼è‡´çš„å‘¢ã€‚äºæ˜¯åœ¨windowsç³»ç»Ÿä¸Šæ‰¾åˆ°simkai.ttf,ä¸Šä¼ åˆ°fontsä¸‹ï¼Œç¼–è¾‘/<span class="built_in">var</span>/www/html/zabbix/include/defines.inc.phpï¼Œæ›´æ”¹ä¸¤å¤„åœ°æ–¹ï¼š</div><div class="line"></div><div class="line"></div><div class="line">    <span class="class"><span class="keyword">define</span></span>(â€˜ZBX_FONT_NAMEâ€˜, â€˜simkaiâ€˜);</div><div class="line">    <span class="class"><span class="keyword">define</span></span>(â€˜ZBX_GRAPH_FONT_NAMEâ€˜,  â€˜simkaiâ€˜);</div><div class="line">fzytk</div></pre></td></tr></table></figure>
<p>è®¾ç½®å¥½äº†ï¼ŒæœåŠ¡é‡å¯ä¸‹ï¼Œåˆ·æ–°ï¼Œå›¾ä¸‹é¢å°±æœ‰å­—ä½“äº†ï¼š</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-luanma.png" alt=""></figure><br>graphfont</p>
<p>å¸¸è§é—®é¢˜ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">ä¾æ—§ä¹±ç ï¼šé€šè¿‡ä»¥ä¸Šçš„æ“ä½œï¼Œå¤§éƒ¨åˆ†åŒå­¦çš„ä¹±ç é—®é¢˜è§£å†³äº†ï¼Œä½†æ˜¯ä¾æ—§æœ‰ä¸€äº›åŒå­¦è¿˜æ˜¯ä¹±ç ï¼Ÿç»†å¿ƒçš„ç¾¤å‹æä¾›å¦å¤–ä¸€ç§æƒ…å†µï¼šåˆå§‹åŒ–æ•°æ®åº“çš„æ—¶å€™æœªä½¿ç”¨utf8ç¼–ç æ‰€è‡´.åˆå§‹åŒ–æ•°æ®åº“ä½¿ç”¨å‘½ä»¤</div><div class="line"></div><div class="line">create database zabbix default charset utf8;</div><div class="line">æˆ–è€…my.cnfå¢åŠ å¦‚ä¸‹é…ç½®</div><div class="line"></div><div class="line">default-character-set = utf8</div><div class="line"></div><div class="line">æ€»ç»“ </div><div class="line">ä¹±ç å¤„ç†æ–¹æ³•å¾ˆç®€å•ï¼Œå®é™…ä¸Šå°±æ˜¯æ›¿æ¢å­—ä½“ã€‚</div></pre></td></tr></table></figure>
<h3 id="äº¤æµå­¦ä¹ ï¼š"><a href="#äº¤æµå­¦ä¹ ï¼š" class="headerlink" title="äº¤æµå­¦ä¹ ï¼š"></a>äº¤æµå­¦ä¹ ï¼š</h3><p>ğŸ§  Linux shell_é«˜çº§è¿ç»´æ´¾: <code>459096184</code>    åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)<br>ğŸ§  BigData-Exchange School : <code>521621407</code>  åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥</p>
<p>ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚</p>

	

	

</article>




	<article>
	
		<h1><a href="/2014/10/03/æ€§èƒ½ç›‘æ§/Zabbix/zabbix2.4æœåŠ¡ç«¯yum-rpmå¿«é€Ÿå®‰è£…éƒ¨ç½²/">zabbix2.4æœåŠ¡ç«¯rpmå¿«é€Ÿå®‰è£…éƒ¨ç½²</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2014-10-03</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/monitoring/">monitoring</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Zabbix-monitoring/">Zabbix monitoring</a>
			</span>
		
	</div>

	

	
		<p>ç³»ç»Ÿç¯å¢ƒï¼š</p>
<ul>
<li>192.168.1.170 MySQLä¸» </li>
<li>192.168.1.183 zabbix-server</li>
</ul>
<h2 id="Zabbix-å¿«é€Ÿéƒ¨ç½²ï¼ˆRPMï¼‰"><a href="#Zabbix-å¿«é€Ÿéƒ¨ç½²ï¼ˆRPMï¼‰" class="headerlink" title="Zabbix å¿«é€Ÿéƒ¨ç½²ï¼ˆRPMï¼‰"></a>Zabbix å¿«é€Ÿéƒ¨ç½²ï¼ˆRPMï¼‰</h2><p>æ³¨é‡Šï¼šå®‰è£…ç¯å¢ƒä¸ºç³»ç»Ÿæœ€å°å®‰è£…ï¼Œæ³¨æ„æ—¶é—´åŒæ­¥</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># cat /etc/redhat-release</span></div><div class="line">CentOS Linux release 7.2.1511 (Core)</div></pre></td></tr></table></figure>
<h3 id="å…³é—­SELinuxï¼š"><a href="#å…³é—­SELinuxï¼š" class="headerlink" title="å…³é—­SELinuxï¼š"></a>å…³é—­SELinuxï¼š</h3><p>1ã€ä¸´æ—¶å…³é—­ï¼ˆä¸ç”¨é‡å¯æœºå™¨ï¼‰ï¼š</p>
<pre><code>#setenforce 0                  ##è®¾ç½®SELinux æˆä¸ºpermissiveæ¨¡å¼
#setenforce 1             ##è®¾ç½®SELinux æˆä¸ºenforcingæ¨¡å¼     
</code></pre><h3 id="1-é…ç½®å®˜æ–¹yumï¼š"><a href="#1-é…ç½®å®˜æ–¹yumï¼š" class="headerlink" title="1.é…ç½®å®˜æ–¹yumï¼š"></a>1.é…ç½®å®˜æ–¹yumï¼š</h3><ul>
<li><p>cnetos 32ä½ï¼š<code>#rpm -ivh http://repo.zabbix.com/zabbix/2.4/rhel/6/i386/zabbix-release-2.4-1.el6.noarch.rpm</code></p>
</li>
<li><p>cnetos 64ä½ï¼š<code>#rpm -ivh  http://repo.zabbix.com/zabbix/2.4/rhel/6/x86_64/zabbix-release-2.4-1.el6.noarch.rpm</code></p>
</li>
<li><p>centos7 64ä½ï¼š# <code>rpm -ivh http://repo.zabbix.com/zabbix/2.4/rhel/7/x86_64/zabbix-release-2.4-1.el7.noarch.rpm</code></p>
</li>
</ul>
<p>å¦‚æœé€‰æ‹©è¿™ä¸ªæ–¹å¼æ˜¯å®‰è£…æœ€é«˜çš„2.4.8ç‰ˆæœ¬</p>
<h3 id="2-å®‰è£…Zabbixï¼š"><a href="#2-å®‰è£…Zabbixï¼š" class="headerlink" title="2.å®‰è£…Zabbixï¼š"></a>2.å®‰è£…Zabbixï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#yum -y install zabbix-server-mysql zabbix-web-mysql zabbix-agent mysql-server mysql   #å®‰è£…ç›¸å…³è½¯ä»¶åŒ…</span></div><div class="line"><span class="comment">#yum -y install zabbix-get zabbix-sender      #æ–¹ä¾¿ä»¥åå¯¹zabbixè°ƒè¯•ç”¨</span></div></pre></td></tr></table></figure>
<h3 id="3-é…ç½®æ•°æ®åº“"><a href="#3-é…ç½®æ•°æ®åº“" class="headerlink" title="3.é…ç½®æ•°æ®åº“"></a>3.é…ç½®æ•°æ®åº“</h3><p> ç™»é™†åˆ°192.168.1.170æœåŠ¡å™¨ä¸Šé¢ï¼š</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># mysql -e "create database zabbix character set utf8 collate  utf8_bin;"   #ä¿®æ”¹æ—¶åŒº</span></div><div class="line"><span class="comment"># mysql -e "grant all privileges on zabbix.* to zabbix@localhost identified by 'zabbix';"  #åˆ›å»ºæ•°æ®åº“å</span></div></pre></td></tr></table></figure>
<p> è¿™é‡Œæˆ‘è®¾ç½®äº†åªèƒ½192.168.1.0ç½‘æ®µå¯ä»¥è®¿é—®æ•°æ®åº“ã€‚<br> æ‰€ä»¥è¿™é‡Œåˆ›å»ºæ•°æ®åº“ç›´æ¥è¿™ä¹ˆæ“ä½œäº†ã€‚</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"> [root@mysql ~]<span class="comment"># mysql -uroot -pIhaozhuo_b313 -h 192.168.1.170</span></div><div class="line">Warning: Using a password on the <span class="built_in">command</span> line interface can be insecure.</div><div class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</div><div class="line">Your MySQL connection id is 10</div><div class="line">Server version: 5.6.20-log MySQL Community Server (GPL)</div><div class="line"></div><div class="line">Copyright (c) 2000, 2014, Oracle and/or its affiliates. All rights reserved.</div><div class="line"></div><div class="line">Oracle is a registered trademark of Oracle Corporation and/or its</div><div class="line">affiliates. Other names may be trademarks of their respective</div><div class="line">owners.</div><div class="line"></div><div class="line">Type <span class="string">'help;'</span> or <span class="string">'\h'</span> <span class="keyword">for</span> help. Type <span class="string">'\c'</span> to clear the current input statement.</div><div class="line"></div><div class="line">mysql&gt; create database zabbix character <span class="built_in">set</span> utf8 collate  utf8_bin;</div><div class="line">Query OK, 1 row affected (0.06 sec)</div><div class="line">mysql&gt; GRANT ALL ON zabbix.* TO <span class="string">'zabbix'</span>@<span class="string">'192.168.1.%'</span> IDENTIFIED BY <span class="string">'zabbix123.com'</span>;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line">mysql&gt; flush privileges;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div></pre></td></tr></table></figure>
<p> 4.å¯¼å…¥æ•°æ®åº“æ–‡ä»¶ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /usr/share/doc/zabbix-server-mysql-2.4.8/create</div></pre></td></tr></table></figure>
<p>æ“ä½œä¸‰æ¡å‘½ä»¤æŠŠæ•°æ®å¯¼å…¥åˆ°åœ¨æŒ‡å®šçš„MySQLï¼šzabbix</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mysql -uzabbix -pzabbix123.com -h 192.168.1.170  zabbix &lt; schema.sql</div><div class="line">mysql -uzabbix -pzabbix123.com -h 192.168.1.170  zabbix &lt; images.sql</div><div class="line">mysql -uzabbix -pzabbix123.com -h 192.168.1.170  zabbix &lt; data.sql</div></pre></td></tr></table></figure>
<h3 id="4-ä¿®æ”¹zabbix-server-conf-æ–‡ä»¶"><a href="#4-ä¿®æ”¹zabbix-server-conf-æ–‡ä»¶" class="headerlink" title="4. ä¿®æ”¹zabbix_server.conf æ–‡ä»¶"></a>4. ä¿®æ”¹zabbix_server.conf æ–‡ä»¶</h3><p>vim /etc/zabbix/zabbix_server.conf</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># ListenPort=10051  //ç›‘å¬çš„ç«¯å£</span></div><div class="line"><span class="comment"># LogFile=/var/log/zabbix/zabbix_server.log  //æ—¥å¿—æ–‡ä»¶è·¯å¾„</span></div><div class="line"><span class="comment"># LogFileSize=0  //æ—¥å¿—æ–‡ä»¶æ»šåŠ¨ï¼Œåˆ†å‰²ã€‚ï¼ˆå‚æ•°ä¸ºâ€œ0â€ï¼Œä¸åšæ»šåŠ¨ï¼‰ï¼Œä¾‹å¦‚å½“æ—¥å¿—æ–‡ä»¶åˆ°è¾¾1Gï¼Œä¼šè‡ªåŠ¨åˆ›å»ºä¸ªæ–°çš„æ—¥å¿—æ–‡ä»¶ï¼Œå®Œæˆæ—¥å¿—æ»šåŠ¨ã€‚</span></div><div class="line">DBName=zabbix            </div><div class="line">DBUser=zabbix          <span class="comment">#æ•°æ®åº“ç”¨æˆ·å</span></div><div class="line">DBPassword=zabbix123.com    <span class="comment">#æ•°æ®åº“å¯†ç </span></div><div class="line">AlertScriptsPath=/usr/<span class="built_in">local</span>/zabbix/share/zabbix/alertscripts<span class="comment">#zabbixè¿è¡Œè„šæœ¬å­˜æ”¾ç›®å½•</span></div></pre></td></tr></table></figure>
<p>:wq! #ä¿å­˜é€€å‡º</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#cp /etc/zabbix/zabbix_server.conf &#123;,.bak&#125;   #å¤‡ä»½</span></div><div class="line">ln <span class="_">-s</span> /etc/alternatives/zabbix-server /usr/bin/zabbix-server</div><div class="line">cp /usr/sbin/zabbix_agentd /etc/init.d/zabbix_agentd</div><div class="line">[root@docker alternatives]<span class="comment"># cp /etc/alternatives/zabbix_server /etc/init.d/zabbix-server</span></div><div class="line"></div><div class="line">chmod +x /etc/rc.d/init.d/zabbix_server <span class="comment">#æ·»åŠ è„šæœ¬æ‰§è¡Œæƒé™</span></div><div class="line">chmod +x /etc/rc.d/init.d/zabbix_agentd <span class="comment">#æ·»åŠ è„šæœ¬æ‰§è¡Œæƒé™</span></div><div class="line"></div><div class="line">vim /etc/php.ini</div><div class="line">date.timezone = Asia/Shanghai</div><div class="line">post_max_size = 32M</div><div class="line">max_execution_time = 300</div><div class="line">max_input_time = 300</div></pre></td></tr></table></figure>
<h3 id="5-ä¿®æ”¹zabbixå¼€æœºå¯åŠ¨è„šæœ¬ä¸­çš„zabbixå®‰è£…ç›®å½•"><a href="#5-ä¿®æ”¹zabbixå¼€æœºå¯åŠ¨è„šæœ¬ä¸­çš„zabbixå®‰è£…ç›®å½•" class="headerlink" title="5. ä¿®æ”¹zabbixå¼€æœºå¯åŠ¨è„šæœ¬ä¸­çš„zabbixå®‰è£…ç›®å½•"></a>5. ä¿®æ”¹zabbixå¼€æœºå¯åŠ¨è„šæœ¬ä¸­çš„zabbixå®‰è£…ç›®å½•</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">vi <span class="regexp">/etc/</span>rc.d<span class="regexp">/init.d/</span>zabbix_server <span class="comment">#ç¼–è¾‘æœåŠ¡ç«¯é…ç½®æ–‡ä»¶</span></div><div class="line">BASEDIR=<span class="regexp">/usr/</span>local<span class="regexp">/zabbix/</span> <span class="comment">#zabbixå®‰è£…ç›®å½•</span></div><div class="line"></div><div class="line"><span class="comment"># /etc/init.d/zabbix-server start</span></div><div class="line"><span class="comment"># /etc/init.d/zabbix_agentd start</span></div><div class="line"><span class="comment">#/etc/init.d/httpd start</span></div></pre></td></tr></table></figure>
<h3 id="6-1-æ·»åŠ å¼€æœºå¯åŠ¨æœåŠ¡"><a href="#6-1-æ·»åŠ å¼€æœºå¯åŠ¨æœåŠ¡" class="headerlink" title="6.1 æ·»åŠ å¼€æœºå¯åŠ¨æœåŠ¡"></a>6.1 æ·»åŠ å¼€æœºå¯åŠ¨æœåŠ¡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">chkconfig --add zabbix-server    </div><div class="line">chkconfig --add zabbix-agent      </div><div class="line">chkconfig --add httpd </div><div class="line">chkconfig --add mysqld</div></pre></td></tr></table></figure>
<h3 id="6-2-æ·»åŠ å¼€æœºå¯åŠ¨"><a href="#6-2-æ·»åŠ å¼€æœºå¯åŠ¨" class="headerlink" title="6.2 æ·»åŠ å¼€æœºå¯åŠ¨"></a>6.2 æ·»åŠ å¼€æœºå¯åŠ¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">chkconfig zabbix-server on  </div><div class="line">chkconfig zabbix-agent on    </div><div class="line">chkconfig httpd on  </div><div class="line">chkconfig mysqld on</div></pre></td></tr></table></figure>
<h3 id="6-3-æ·»åŠ é˜²ç«å¢™"><a href="#6-3-æ·»åŠ é˜²ç«å¢™" class="headerlink" title="6.3 æ·»åŠ é˜²ç«å¢™"></a>6.3 æ·»åŠ é˜²ç«å¢™</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">-A INPUT -m state --state NEW -m tcp -p tcp --dport 80 -j ACCEPT</div><div class="line">-A INPUT -m state --state NEW -m tcp -p tcp --dport 10051 -j ACCEPT</div><div class="line">-A INPUT -m state --state NEW -m tcp -p tcp --dport 10050 -j ACCEPT</div></pre></td></tr></table></figure>
<h3 id="7-åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼š"><a href="#7-åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼š" class="headerlink" title="7.åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼š"></a>7.åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼š</h3><p><a href="http://192.168.1.183/zabbix/è¿›å…¥è®¾ç½®ç•Œé¢" target="_blank" rel="external">http://192.168.1.183/zabbix/è¿›å…¥è®¾ç½®ç•Œé¢</a>  </p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-server0.png" alt=""></figure></p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-server1.png" alt=""></figure></p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-server2.png" alt=""></figure></p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-server3.png" alt=""></figure></p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-server4.png" alt=""></figure></p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-server5.png" alt=""></figure><br>è¿›å…¥ï¼š â€œ/var/www/html/zabbix/conf/zabbix.conf.phpâ€</p>
<p>å¤‡ä»½ï¼š</p>
<p>cp zabbix.conf.php.example zabbix.conf.php<br>ä¸‹è½½ä¸‹æ¥çš„æ”¾åˆ°è¿™ä¸ªç›®å½•ä¸‹é¢ã€‚</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-server6.png" alt=""></figure></p>
<p>ç”¨æˆ·å:Admin å¯†ç ï¼šzabbix</p>
<p>è®¾ç½®ä¸­æ–‡ç‰ˆæœ¬ï¼Œ2.4ç‰ˆæœ¬ä»¥åéƒ½æ”¯æ’‘ä¸­æ–‡ç‰ˆæœ¬ï¼Œ2.2.0ç‰ˆæœ¬éƒ½æ˜¯ä¸æ”¯æŒçš„ï¼Œéœ€è¦ä¸‹è½½ä¸­æ–‡ç‰ˆæœ¬åŒ…ï¼Œæ”¾åˆ°zabbixç›®å½•ä¸‹é¢ã€‚</p>
<p>è®¾ç½®èƒŒæ™¯ä¸ºç»å…¸çš„æ˜¯ä¸æ˜¯çœ‹ç€ä¼šèˆ’æœç‚¹ï¼š3.0 å¯¹å¤–è§‚æ”¹çš„æ”¹åŠ¨å¾ˆå¤§ï¼Œæ”¯æ’‘ç¡¬ä»¶ç›‘æ§åŠŸèƒ½åŠ å¼ºã€‚</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-server7.png" alt=""></figure></p>
<p>ç®€å•çš„å®‰è£…å°±å·²ç»æå®šäº†ã€‚</p>
<h3 id="å®‰è£…å‡ºç°å‡ ç§é”™è¯¯æƒ…å†µï¼š"><a href="#å®‰è£…å‡ºç°å‡ ç§é”™è¯¯æƒ…å†µï¼š" class="headerlink" title="å®‰è£…å‡ºç°å‡ ç§é”™è¯¯æƒ…å†µï¼š"></a>å®‰è£…å‡ºç°å‡ ç§é”™è¯¯æƒ…å†µï¼š</h3><p>ç™»é™†zabbixæç¤º<code>zabbix server is not running:the information displayedmay not be current</code></p>
<p>è§£å†³æ–¹æ³•ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">å…³é—­selinuxä¸iptables</div><div class="line">vim /var/www/html/zabbix/conf/zabbix.conf.phpå°†zabbix.conf.phpé‡Œçš„serverå†™æˆipåœ°å€ï¼Œå°±è§£å†³äº†</div></pre></td></tr></table></figure>
<p>æŸ¥çœ‹æ—¥å¿—ï¼š</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="number">6576</span>:<span class="number">20160719</span>:<span class="number">045354.989</span> [Z3001] connection to database <span class="string">'zabbix'</span> </div><div class="line"><span class="symbol">failed:</span> [<span class="number">2002</span>] Can<span class="string">'t connect to local MySQL server through socket '</span>/var/<span class="class"><span class="keyword">lib</span>/<span class="title">mysql</span>/<span class="title">mysql</span>.<span class="title">sock</span>' (2)</span></div></pre></td></tr></table></figure>
<p>è¿™ä¸ªæŠ¥é”™çš„è¯ï¼Œå°±è¯´æ˜é…ç½®æ–‡ä»¶æœ‰é—®é¢˜ï¼š</p>
<p>è®¾ç½®æ•°æ®åº“è®¿é—®åœ°å€ï¼šDBHost=192.168.1.170</p>
<p>ç„¶åvi zabbix.conf.phpè®°å¾—ä¿®æ”¹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="variable">$ZBX_SERVER</span>      = <span class="string">'ZABBIX_SERVER_IP'</span>;  IPåœ°å€</div><div class="line"><span class="variable">$ZBX_SERVER_PORT</span> = <span class="string">'10051'</span>;</div></pre></td></tr></table></figure>
<p>ç„¶åé‡å¯ä¸‹æœåŠ¡ï¼Œå°±ä¸ä¼šå‡ºç°MySQLæœ¬åœ°æ— æ³•è¿æ¥ã€‚</p>
<p>å¦‚æœæŠ¥é”™ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">6664:20160719:050257.665 cannot send list of active checks to [127.0.0.1]: host [Zabbix server] not monitored</div></pre></td></tr></table></figure>
<p>ç¡®ä¿zabbixå‰å°ä¸Šçš„Host nameä¸ä¸»æœºçš„hostnameä¸€è‡´å³å¯ã€‚</p>
<p>è¿™æ˜¯å¿«é€Ÿç®€å•å®‰è£…2.4.8ç‰ˆæœ¬çš„ï¼Œåé¢è¿˜æœ‰ç¼–è¯‘å®‰è£…çš„ï¼Œç¼–è¯‘å®‰è£…çš„å¥½å¤„ï¼Œå¯ä»¥äº†è§£å®‰è£…çš„è·¯å¾„å’Œé…ç½®æ–‡ä»¶éƒ½æ˜¯è‡ªå·±ç†Ÿæ‚‰çš„ã€‚</p>
<ul>
<li>2.4.8æœåŠ¡ç«¯ç¼–è¯‘å®‰è£…ä¸éƒ¨ç½²ï¼š</li>
<li>2.4.8å‡çº§3.0å®‰è£…ä¸éƒ¨ç½²ï¼š</li>
<li>3.0å®‰è£…ä¸éƒ¨ç½²ï¼š</li>
<li>å®‰è£…å®Œæˆä»¥åå‡ºç°å›¾åƒä¹±ç ï¼š <a href="https://github.com/yangcvo/zabbix.2.4" target="_blank" rel="external">https://github.com/yangcvo/zabbix.2.4</a></li>
<li>2.4.8ç‰ˆæœ¬zabbix-serveræœåŠ¡ç«¯ç¼–è¯‘å®‰è£…ï¼š<a href="http://blog.yangcvo.me/2015/01/18/zabbix-serveræœåŠ¡ç«¯ç¼–è¯‘å®‰è£…/" target="_blank" rel="external">æºç ç¼–è¯‘å®‰è£…éƒ¨ç½²2.4.8ç‰ˆæœ¬zabbix-serveræœåŠ¡ç«¯</a></li>
</ul>

	

	

</article>




	<article>
	
		<h1><a href="/2014/10/02/æ€§èƒ½ç›‘æ§/Zabbix/Zabbix2.4serveræœåŠ¡ç«¯ç¼–è¯‘å®‰è£…/">Zabbix2.4serveræœåŠ¡ç«¯ç¼–è¯‘å®‰è£…</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2014-10-02</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/monitoring/">monitoring</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Zabbix-monitoring/">Zabbix monitoring</a>
			</span>
		
	</div>

	

	
		<h2 id="ç³»ç»Ÿç¯å¢ƒï¼š"><a href="#ç³»ç»Ÿç¯å¢ƒï¼š" class="headerlink" title="ç³»ç»Ÿç¯å¢ƒï¼š"></a>ç³»ç»Ÿç¯å¢ƒï¼š</h2><ul>
<li>192.168.1.170 MySQLä¸» </li>
<li>192.168.1.183 zabbix-server</li>
</ul>
<p>CentOS Linux release 7.2.1511 (Core)</p>
<ul>
<li>zabbixæºç ä¸‹è½½ : <a href="http://www.zabbix.com/download.php" target="_blank" rel="external">http://www.zabbix.com/download.php</a></li>
<li>ä¾èµ–ä¸‹è½½ï¼šhttps : //github.com/zabbixcn/curl-rpm/tree/master/RPMS</li>
</ul>
<h3 id="ç¬¬ä¸€æ­¥zabbixï¼š"><a href="#ç¬¬ä¸€æ­¥zabbixï¼š" class="headerlink" title="ç¬¬ä¸€æ­¥zabbixï¼š"></a>ç¬¬ä¸€æ­¥zabbixï¼š</h3><p>å…³é—­æœ¬æœºä¸Šçš„selinuxä¸iptablesæœåŠ¡</p>
<p>1ã€å…³é—­SELinux</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#ä¸‹é¢çš„å‘½ä»¤å®ç°æ°¸ä¹…å…³é—­SELinux</span></div><div class="line"> sed -i <span class="string">'s/^SELINUX=.*/#&amp;/;s/^SELINUXTYPE=.*/#&amp;/;/SELINUX=.*/a SELINUX=disabled'</span> /etc/sysconfig/selinux</div><div class="line"><span class="comment">#ä¸‹é¢çš„å‘½ä»¤å®ç°ä¸´æ—¶å…³é—­SELinux</span></div><div class="line"></div><div class="line">/usr/sbin/setenforce 0</div><div class="line">/usr/sbin/setenforce: SELinux is disabled</div></pre></td></tr></table></figure>
<p>ä¹Ÿå¯ä»¥è®¾ç½®å¼€æ”¾ç«¯å£å‡ºå»ã€‚</p>
<p>CentOS 7.0é»˜è®¤ä½¿ç”¨çš„æ˜¯firewallä½œä¸ºé˜²ç«å¢™ï¼Œè¿™é‡Œæ”¹ä¸ºiptablesé˜²ç«å¢™ã€‚</p>
<p>firewallï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">systemctl start firewalld.service<span class="comment">#å¯åŠ¨firewall</span></div><div class="line">systemctl stop firewalld.service<span class="comment">#åœæ­¢firewall</span></div><div class="line">systemctl <span class="built_in">disable</span> firewalld.service<span class="comment">#ç¦æ­¢firewallå¼€æœºå¯åŠ¨</span></div></pre></td></tr></table></figure>
<p>CentOS7é»˜è®¤çš„é˜²ç«å¢™ä¸æ˜¯iptables,è€Œæ˜¯firewalle.<br>centos 7 çš„é»˜è®¤æ²¡æœ‰å®‰è£…iptables éœ€è¦å®‰è£…ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">yum install iptables-services</div><div class="line"><span class="comment">#ä¿å­˜ä¸Šè¿°è§„åˆ™ </span></div><div class="line">service iptables save</div></pre></td></tr></table></figure>
<p>ç­‰ä¼šå†æ·»åŠ ç«¯å£ï¼š10050 ï¼Œ10051 </p>
<p>æ­å»ºLAMPç¯å¢ƒï¼Œæˆ–LNMPç¯å¢ƒ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install mysql-server httpd php â€“y</div></pre></td></tr></table></figure>
<p>å®‰è£…å…¶å®ƒä¾èµ–åŒ…</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install mysql-devel gcc net-snmp-devel curl-devel perl-DBI php-gd php-mysql php-bcmath  php-mbstring php-<span class="keyword">xml</span> <span class="title">â€“y</span>  gcc OpenIPMI-devel net-snmp-devel.x86_64 libxml2-devel mysql-devel</div></pre></td></tr></table></figure>
<p>å¢åŠ zabbixç”¨æˆ·å’Œç»„</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">groupadd zabbix</div><div class="line">useradd â€“g zabbix â€“m zabbix</div></pre></td></tr></table></figure>
<h3 id="äºŒã€zabbixè½¯ä»¶åŒ…ä¸‹è½½"><a href="#äºŒã€zabbixè½¯ä»¶åŒ…ä¸‹è½½" class="headerlink" title="äºŒã€zabbixè½¯ä»¶åŒ…ä¸‹è½½"></a>äºŒã€zabbixè½¯ä»¶åŒ…ä¸‹è½½</h3><p>ä¸‹è½½ï¼š <a href="http://jaist.dl.sourceforge.net/project/zabbix/ZABBIX%20Latest%20Stable/2.4.8/" target="_blank" rel="external">http://jaist.dl.sourceforge.net/project/zabbix/ZABBIX%20Latest%20Stable/2.4.8/</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">curl -O http://jaist.dl.sourceforge.net/project/zabbix/ZABBIX%20Latest%20Stable/2.4.8/zabbix-2.4.8.tar.gz</div><div class="line">è§£å‹å®‰è£…åŒ…</div><div class="line">tar -zxvf zabbix-2.4.8.tar.gz</div><div class="line">./configure --prefix=/usr/<span class="built_in">local</span>/zabbix --with-mysql --with-net-snmp --with-libcurl --enable-server --enable-agent --enable-proxy</div><div class="line"><span class="comment">#make &amp;&amp; make install</span></div></pre></td></tr></table></figure>
<h3 id="3-é…ç½®æ•°æ®åº“"><a href="#3-é…ç½®æ•°æ®åº“" class="headerlink" title="3.é…ç½®æ•°æ®åº“"></a>3.é…ç½®æ•°æ®åº“</h3><p> ç™»é™†åˆ°192.168.1.170æœåŠ¡å™¨ä¸Šé¢ï¼š</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># mysql -e "create database zabbix character set utf8 collate  utf8_bin;"   #ä¿®æ”¹æ—¶åŒº</span></div><div class="line"><span class="comment"># mysql -e "grant all privileges on zabbix.* to zabbix@localhost identified by 'zabbix';"  #åˆ›å»ºæ•°æ®åº“å</span></div></pre></td></tr></table></figure>
<p> è¿™é‡Œæˆ‘è®¾ç½®äº†åªèƒ½192.168.1.0ç½‘æ®µå¯ä»¥è®¿é—®æ•°æ®åº“ã€‚<br> æ‰€ä»¥è¿™é‡Œåˆ›å»ºæ•°æ®åº“ç›´æ¥è¿™ä¹ˆæ“ä½œäº†ã€‚</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">[root@mysql ~]<span class="comment"># mysql -uroot -pIhaozhuo_b313 -h 192.168.1.170</span></div><div class="line">Warning: Using a password on the <span class="built_in">command</span> line interface can be insecure.</div><div class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</div><div class="line">Your MySQL connection id is 10</div><div class="line">Server version: 5.6.20-log MySQL Community Server (GPL)</div><div class="line"></div><div class="line">Copyright (c) 2000, 2014, Oracle and/or its affiliates. All rights reserved.</div><div class="line"></div><div class="line">Oracle is a registered trademark of Oracle Corporation and/or its</div><div class="line">affiliates. Other names may be trademarks of their respective</div><div class="line">owners.</div><div class="line"></div><div class="line">Type <span class="string">'help;'</span> or <span class="string">'\h'</span> <span class="keyword">for</span> help. Type <span class="string">'\c'</span> to clear the current input statement.</div><div class="line"></div><div class="line">mysql&gt; create database zabbix character <span class="built_in">set</span> utf8 collate  utf8_bin;</div><div class="line">Query OK, 1 row affected (0.06 sec)</div><div class="line">mysql&gt; GRANT ALL ON zabbix.* TO <span class="string">'zabbix'</span>@<span class="string">'192.168.1.%'</span> IDENTIFIED BY <span class="string">'zabbix123.com'</span>;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line">mysql&gt; flush privileges;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div></pre></td></tr></table></figure>
<h3 id="å››-å¯¼å…¥æ•°æ®åº“æ–‡ä»¶ï¼š"><a href="#å››-å¯¼å…¥æ•°æ®åº“æ–‡ä»¶ï¼š" class="headerlink" title="å››.å¯¼å…¥æ•°æ®åº“æ–‡ä»¶ï¼š"></a>å››.å¯¼å…¥æ•°æ®åº“æ–‡ä»¶ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /usr/share/doc/zabbix-server-mysql-2.4.8/create</div></pre></td></tr></table></figure>
<p>æ“ä½œä¸‰æ¡å‘½ä»¤æŠŠæ•°æ®å¯¼å…¥åˆ°åœ¨æŒ‡å®šçš„MySQLï¼šzabbix</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mysql -uzabbix -pzabbix123.com -h 192.168.1.170  zabbix &lt; schema.sql</div><div class="line">mysql -uzabbix -pzabbix123.com -h 192.168.1.170  zabbix &lt; images.sql</div><div class="line">mysql -uzabbix -pzabbix123.com -h 192.168.1.170  zabbix &lt; data.sql</div></pre></td></tr></table></figure>
<h3 id="äº”ã€é…ç½®æ–‡ä»¶åŠwebå‰ç«¯æ–‡ä»¶ä¿®æ”¹"><a href="#äº”ã€é…ç½®æ–‡ä»¶åŠwebå‰ç«¯æ–‡ä»¶ä¿®æ”¹" class="headerlink" title="äº”ã€é…ç½®æ–‡ä»¶åŠwebå‰ç«¯æ–‡ä»¶ä¿®æ”¹"></a>äº”ã€é…ç½®æ–‡ä»¶åŠwebå‰ç«¯æ–‡ä»¶ä¿®æ”¹</h3><p>æ·»åŠ æœåŠ¡ç«¯å£</p>
<p>vi /etc/services #ç¼–è¾‘ï¼Œåœ¨æœ€åæ·»åŠ ä»¥ä¸‹ä»£ç </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Zabbix</span></div><div class="line">zabbix-agent 10050/tcp   <span class="comment"># Zabbix Agent</span></div><div class="line">zabbix-agent 10050/udp   <span class="comment"># Zabbix Agent</span></div><div class="line">zabbix-trapper 10051/tcp <span class="comment"># Zabbix Trapper</span></div><div class="line">zabbix-trapper 10051/udp <span class="comment"># Zabbix Trapper</span></div><div class="line">:wq! <span class="comment">#ä¿å­˜é€€å‡º</span></div></pre></td></tr></table></figure>
<p>æ·»åŠ åå¦‚ä¸‹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># grep zabbix /etc/services</span></div><div class="line">zabbix-agent     10050/tcp  <span class="comment">#ZabbixAgent</span></div><div class="line">zabbix-agent     10050/udp  <span class="comment">#ZabbixAgent</span></div><div class="line">zabbix-trapper   10051/tcp  <span class="comment">#ZabbixTrapperz</span></div><div class="line">abbix-trapper    10051/udp  <span class="comment">#ZabbixTrapper</span></div></pre></td></tr></table></figure>
<p>ä¿®æ”¹zabbixé…ç½®æ–‡ä»¶</p>
<p>vim /usr/local/zabbix/etc/zabbix_server.conf</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">DBName=zabbix <span class="comment">#æ•°æ®åº“åç§°</span></div><div class="line">DBUser=zabbix <span class="comment">#æ•°æ®åº“ç”¨æˆ·å</span></div><div class="line">DBPassword=zabbix123.com <span class="comment">#æ•°æ®åº“å¯†ç </span></div><div class="line">ListenIP=192.168.1.170 <span class="comment">#æ•°æ®åº“ipåœ°å€</span></div><div class="line">AlertScriptsPath=/usr/<span class="built_in">local</span>/zabbix/share/zabbix/alertscripts   <span class="comment">#zabbixè¿è¡Œè„šæœ¬å­˜æ”¾ç›®å½•</span></div></pre></td></tr></table></figure>
<p>:wq! #ä¿å­˜é€€å‡º</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">vi /usr/<span class="built_in">local</span>/zabbix/etc/zabbix_agentd.conf</div><div class="line">Include=/usr/<span class="built_in">local</span>/zabbix/etc/zabbix_agentd.conf.d/</div><div class="line">UnsafeUserParameters=1 <span class="comment">#å¯ç”¨è‡ªå®šä¹‰key</span></div><div class="line">:wq! <span class="comment">#ä¿å­˜é€€å‡º</span></div></pre></td></tr></table></figure>
<h3 id="å…­ã€æ·»åŠ å¼€æœºå¯åŠ¨è„šæœ¬"><a href="#å…­ã€æ·»åŠ å¼€æœºå¯åŠ¨è„šæœ¬" class="headerlink" title="å…­ã€æ·»åŠ å¼€æœºå¯åŠ¨è„šæœ¬"></a>å…­ã€æ·»åŠ å¼€æœºå¯åŠ¨è„šæœ¬</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">cp /tmp/zabbix-2.4.8/misc/init.d/fedora/core/zabbix_server  /etc/rc.d/init.d/zabbix_server  <span class="comment">#æœåŠ¡ç«¯</span></div><div class="line">cp /tmp/zabbix-2.4.8/misc/init.d/fedora/core/zabbix_agentd /etc/rc.d/init.d/zabbix_agentd  <span class="comment">#å®¢æˆ·ç«¯</span></div><div class="line">chmod +x /etc/rc.d/init.d/zabbix_server <span class="comment">#æ·»åŠ è„šæœ¬æ‰§è¡Œæƒé™</span></div><div class="line">chmod +x /etc/rc.d/init.d/zabbix_agentd <span class="comment">#æ·»åŠ è„šæœ¬æ‰§è¡Œæƒé™</span></div><div class="line">chkconfig zabbix_server on <span class="comment">#æ·»åŠ å¼€æœºå¯åŠ¨</span></div><div class="line">chkconfig zabbix_agentd on <span class="comment">#æ·»åŠ å¼€æœºå¯åŠ¨</span></div></pre></td></tr></table></figure>
<h3 id="ä¸ƒã€ä¿®æ”¹zabbixå¼€æœºå¯åŠ¨è„šæœ¬ä¸­çš„zabbixå®‰è£…ç›®å½•"><a href="#ä¸ƒã€ä¿®æ”¹zabbixå¼€æœºå¯åŠ¨è„šæœ¬ä¸­çš„zabbixå®‰è£…ç›®å½•" class="headerlink" title="ä¸ƒã€ä¿®æ”¹zabbixå¼€æœºå¯åŠ¨è„šæœ¬ä¸­çš„zabbixå®‰è£…ç›®å½•"></a>ä¸ƒã€ä¿®æ”¹zabbixå¼€æœºå¯åŠ¨è„šæœ¬ä¸­çš„zabbixå®‰è£…ç›®å½•</h3><p>vi /etc/rc.d/init.d/zabbix_server #ç¼–è¾‘æœåŠ¡ç«¯é…ç½®æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">BASEDIR=/usr/<span class="built_in">local</span>/zabbix/ <span class="comment">#zabbixå®‰è£…ç›®å½•</span></div><div class="line">:wq! <span class="comment">#ä¿å­˜é€€å‡º</span></div></pre></td></tr></table></figure>
<p>vi /etc/rc.d/init.d/zabbix_agentd #ç¼–è¾‘å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">BASEDIR=/usr/<span class="built_in">local</span>/zabbix/ <span class="comment">#zabbixå®‰è£…ç›®å½•</span></div><div class="line">:wq! <span class="comment">#ä¿å­˜é€€å‡º</span></div></pre></td></tr></table></figure>
<h3 id="å…«ã€é…ç½®webç«™ç‚¹"><a href="#å…«ã€é…ç½®webç«™ç‚¹" class="headerlink" title="å…«ã€é…ç½®webç«™ç‚¹"></a>å…«ã€é…ç½®webç«™ç‚¹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> zabbix-2.4.8</div><div class="line">cp -r /zabbix-2.4.8/frontends/php /var/www/html/zabbix</div><div class="line"><span class="built_in">cd</span> /var/www/html/</div><div class="line">chown -R zabbix:zabbix zabbix</div></pre></td></tr></table></figure>
<p>service zabbix_server start #å¯åŠ¨zabbixæœåŠ¡ç«¯</p>
<p>service zabbix_agentd start #å¯åŠ¨zabbixå®¢æˆ·ç«¯</p>
<h3 id="ä¹ã€ä¿®æ”¹phpé…ç½®æ–‡ä»¶å‚æ•°"><a href="#ä¹ã€ä¿®æ”¹phpé…ç½®æ–‡ä»¶å‚æ•°" class="headerlink" title="ä¹ã€ä¿®æ”¹phpé…ç½®æ–‡ä»¶å‚æ•°"></a>ä¹ã€ä¿®æ”¹phpé…ç½®æ–‡ä»¶å‚æ•°</h3><p>1ã€vi /etc/php.ini #ç¼–è¾‘ä¿®æ”¹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">max_execution_time=300</div><div class="line">max_input_time=300</div><div class="line">date.timezone=Asia/Shanghai</div></pre></td></tr></table></figure>
<p>:wq! #ä¿å­˜é€€å‡º</p>
<p>ä¸Šé¢æåˆ°äº†é˜²ç«å¢™å¼€æ”¾å¯¹åº”çš„ç«¯å£ï¼š<br>é˜²ç«å¢™ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">-A INPUT -m state --state NEW -m tcp -p tcp --dport 80 -j ACCEPT</div><div class="line">-A INPUT -m state --state NEW -m tcp -p tcp --dport 10051 -j ACCEPT</div><div class="line">-A INPUT -m state --state NEW -m tcp -p tcp --dport 10050 -j ACCEPT</div></pre></td></tr></table></figure>
<p>é‡å¯apache</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#service httpd restart</span></div></pre></td></tr></table></figure>
<h3 id="åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼š"><a href="#åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼š" class="headerlink" title="åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼š"></a>åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼š</h3><p><a href="http://192.168.1.183/zabbix/" target="_blank" rel="external">http://192.168.1.183/zabbix/</a></p>
<p>è¿›å…¥è®¾ç½®ç•Œé¢     </p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-server0.png" alt=""></figure></p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-server1.png" alt=""></figure></p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-server2.png" alt=""></figure></p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-server3.png" alt=""></figure></p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-server4.png" alt=""></figure></p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-server5.png" alt=""></figure><br>è¿›å…¥ï¼š â€œ/var/www/html/zabbix/conf/zabbix.conf.phpâ€</p>
<p>å¤‡ä»½ï¼š</p>
<p>cp zabbix.conf.php.example zabbix.conf.php<br>ä¸‹è½½ä¸‹æ¥çš„æ”¾åˆ°è¿™ä¸ªç›®å½•ä¸‹é¢ã€‚</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-server6.png" alt=""></figure></p>
<p>ç”¨æˆ·å:Admin å¯†ç ï¼šzabbix</p>
<p>è®¾ç½®ä¸­æ–‡ç‰ˆæœ¬ï¼Œ2.4ç‰ˆæœ¬ä»¥åéƒ½æ”¯æ’‘ä¸­æ–‡ç‰ˆæœ¬ï¼Œ2.2.0ç‰ˆæœ¬éƒ½æ˜¯ä¸æ”¯æŒçš„ï¼Œéœ€è¦ä¸‹è½½ä¸­æ–‡ç‰ˆæœ¬åŒ…ï¼Œæ”¾åˆ°zabbixç›®å½•ä¸‹é¢ã€‚</p>
<p>è®¾ç½®èƒŒæ™¯ä¸ºç»å…¸çš„æ˜¯ä¸æ˜¯çœ‹ç€ä¼šèˆ’æœç‚¹ï¼š3.0 å¯¹å¤–è§‚æ”¹çš„æ”¹åŠ¨å¾ˆå¤§ï¼Œæ”¯æ’‘ç¡¬ä»¶ç›‘æ§åŠŸèƒ½åŠ å¼ºã€‚</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-server7.png" alt=""></figure></p>
<p>ç®€å•çš„å®‰è£…å°±å·²ç»æå®šäº†ã€‚</p>
<h3 id="å®‰è£…å‡ºç°å‡ ç§é”™è¯¯æƒ…å†µï¼š"><a href="#å®‰è£…å‡ºç°å‡ ç§é”™è¯¯æƒ…å†µï¼š" class="headerlink" title="å®‰è£…å‡ºç°å‡ ç§é”™è¯¯æƒ…å†µï¼š"></a>å®‰è£…å‡ºç°å‡ ç§é”™è¯¯æƒ…å†µï¼š</h3><p>ç™»é™†zabbixæç¤º<code>zabbix server is not running:the information displayedmay not be current</code></p>
<p>è§£å†³æ–¹æ³•ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">å…³é—­selinuxä¸iptables</div><div class="line">vim /var/www/html/zabbix/conf/zabbix.conf.phpå°†zabbix.conf.phpé‡Œçš„serverå†™æˆipåœ°å€ï¼Œå°±è§£å†³äº†</div></pre></td></tr></table></figure>
<p>æŸ¥çœ‹æ—¥å¿—ï¼š</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="number">6576</span>:<span class="number">20160719</span>:<span class="number">045354.989</span> [Z3001] connection to database <span class="string">'zabbix'</span> </div><div class="line"><span class="symbol">failed:</span> [<span class="number">2002</span>] Can<span class="string">'t connect to local MySQL server through socket '</span>/var/<span class="class"><span class="keyword">lib</span>/<span class="title">mysql</span>/<span class="title">mysql</span>.<span class="title">sock</span>' (2)</span></div></pre></td></tr></table></figure>
<p>è¿™ä¸ªæŠ¥é”™çš„è¯ï¼Œå°±è¯´æ˜é…ç½®æ–‡ä»¶æœ‰é—®é¢˜ï¼š</p>
<p>è®¾ç½®æ•°æ®åº“è®¿é—®åœ°å€ï¼šDBHost=192.168.1.170</p>
<p>ç„¶åvi zabbix.conf.phpè®°å¾—ä¿®æ”¹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="variable">$ZBX_SERVER</span>      = <span class="string">'ZABBIX_SERVER_IP'</span>;  IPåœ°å€</div><div class="line"><span class="variable">$ZBX_SERVER_PORT</span> = <span class="string">'10051'</span>;</div></pre></td></tr></table></figure>
<p>ç„¶åé‡å¯ä¸‹æœåŠ¡ï¼Œå°±ä¸ä¼šå‡ºç°MySQLæœ¬åœ°æ— æ³•è¿æ¥ã€‚</p>
<p>å¦‚æœæŠ¥é”™ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">6664:20160719:050257.665 cannot send list of active checks to [127.0.0.1]: host [Zabbix server] not monitored</div></pre></td></tr></table></figure>
<p>ç¡®ä¿zabbixå‰å°ä¸Šçš„Host nameä¸ä¸»æœºçš„hostnameä¸€è‡´å³å¯ã€‚</p>
<p>è¿™æ˜¯å¿«é€Ÿç®€å•å®‰è£…2.4.8ç‰ˆæœ¬çš„ï¼Œåé¢è¿˜æœ‰ç¼–è¯‘å®‰è£…çš„ï¼Œç¼–è¯‘å®‰è£…çš„å¥½å¤„ï¼Œå¯ä»¥äº†è§£å®‰è£…çš„è·¯å¾„å’Œé…ç½®æ–‡ä»¶éƒ½æ˜¯è‡ªå·±ç†Ÿæ‚‰çš„ã€‚</p>
<p>zabbix-server2.4æœåŠ¡ç«¯ç¼–è¯‘å®‰è£… <a href="http://blog.yangcvo.me/2015/01/18/zabbix-serveræœåŠ¡ç«¯ç¼–è¯‘å®‰è£…/" target="_blank" rel="external">zabbix-serveræœåŠ¡ç«¯ç¼–è¯‘å®‰è£…</a></p>
<p>zabbix2.4ç›‘æ§80ç«¯å£çŠ¶æ€ : <a href="http://blog.yangcvo.me/2016/07/20/zabbixç›‘æ§80ç«¯å£çŠ¶æ€/" target="_blank" rel="external">zabbixç›‘æ§80ç«¯å£çŠ¶æ€</a></p>
<p>zabbix+Grafanaå®‰è£…ä½¿ç”¨ç›‘æ§ç»“åˆ ï¼š<a href="http://blog.yangcvo.me/2016/07/13/zabbix-Grafanaå®‰è£…ä½¿ç”¨ç»“åˆ/" target="_blank" rel="external">zabbix+Grafanaå®‰è£…ä½¿ç”¨ç›‘æ§ç»“åˆ</a></p>
<p>zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹ : <a href="http://blog.yangcvo.me/2015/09/29/zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹/" target="_blank" rel="external">zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹</a></p>
<p>zabbixçš„ICMP_Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§ : <a href="http://blog.yangcvo.me/2015/11/18/zabbixçš„ICMP-Pingæ¨¡ç‰ˆ&gt;å®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§/" target="_blank" rel="external">zabbixçš„ICMP_Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§</a></p>
<p>zabbixæ€§èƒ½ç›‘æ§æ•…éšœæ€»ç»“ <a href="http://blog.yangcvo.me/2016/02/07/zabbix-æ•…éšœæ€»ç»“/" target="_blank" rel="external">zabbixæ€§èƒ½ç›‘æ§æ•…éšœæ€»ç»“</a></p>

	

	

</article>





	<span class="different-posts">ğŸ“– <a href="/page/12">more posts</a> ğŸ“–</span>



	</main>

	<footer class="footer">
	<div class="footer-content">
		
	      <div class="footer__element">
	<h5>Hi there,</h5>
	<p style="text-align:justify;">my name is Yancy, they know me as RadiantğŸ‘ğŸ‘. This blog is about Bi-data and my live.<br> I like ğŸŒ³ğŸŒ³ğŸŒ³</p>
</div>


	    
	      <div class="footer__element">
	<h5>Check out</h5>
	<ul class="footer-links">
		<li class="footer-links__link"><a href="/archives">Archive</a></li>
		
		  <li class="footer-links__link"><a href="/atom.xml">RSS</a></li>
	    
		<li class="footer-links__link"><a href="/about">about page</a></li>
		<li class="footer-links__link"><a href="/tags">Tags</a></li>
		<li class="footer-links__link"><a href="/categories">Categories</a></li>
	</ul>
</div>

	    

		<div class="footer-credit">
			<span>Â© 2017 Yancy | Powered by <a href="http://blog.yancy.cc/">Yancy</a> | Theme <a href="https://github.com/yangcvo">Yancy_GitHub</a></span>
		</div>

	</div>


</footer>



</body>

</html>
