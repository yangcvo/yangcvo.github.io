<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="theme-color" content="#33474d">
	<title>Yancy&#39;s blog</title>
	<link rel="stylesheet" href="/css/style.css" />
	
      <link rel="alternate" href="/atom.xml" title="Yancy&#39;s blog" type="application/atom+xml">
    
</head>

<body>

	<header class="header">
		<nav class="header__nav">
			
				<a href="/" class="header__link">Home</a>
			
				<a href="/tags" class="header__link">Tags</a>
			
				<a href="/archives" class="header__link">ARCHIVES</a>
			
				<a href="/about/About" class="header__link">ABOUT</a>
			
				<a href="http://weibo.com/yangcvo" class="header__link">Weibo</a>
			
				<a href="/atom.xml" class="header__link">RSS</a>
			
		</nav>
		<h1 class="header__title"><a href="/">Yancy&#39;s blog</a></h1>
		<h2 class="header__subtitle">SIMPLICITY IS PREREQUISITE FOR  RELIABILITY</h2>
	</header>

	<main>
		
	<span class="different-posts different-posts_earlier">📖 <a href="/page/7">earlier posts</a> 📖</span>




	<article>
	
		<h1><a href="/2016/06/17/性能监控/Zabbix/zabbix-Grafana安装使用结合/">zabbix+Grafana安装使用监控结合</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-06-17</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/monitoring/">monitoring</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Zabbix-monitoring/">Zabbix monitoring</a>
			</span>
		
	</div>

	

	
		<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>做运维的很重要的基础工作就是监控去准确定位问题，之前用的是Nagios做过监控，也用过cacti，这个之前在IDC做CDN网络方面用的比较多，监控流量好帮手。</p>
<p>为什么选择zabbix其实现在是算开源监控比较火的。更重要是几款监控做了对比。</p>
<p>cacti、zabbix同nagios一样，都是非常优势的开源监控软件。 </p>
<blockquote>
<p>Nagios: 轻量级/方便/快捷是nagios最大的优势，特别是它的插件机制，你可以用自己熟悉的语言实现几乎任何自己想要实现的监控。但nagios的图标图形显示的很丑，这方面的确不敢恭维。<br>Cacti: cacti的优势表现在系统方面的监控，特别针对流量的监控功能， 以及cacti图形显示美观等，cacti在这两方面表现的都不错。<br>Zabbix: zabbix是一个基于WEB界面的提供分布式系统监视以及网络监视功能的企业级的开源解决方案。功能全面，很多公司都是基于zabbix自建的监控平台。但维护相对困难，相比没有nagios轻量及灵活。</p>
</blockquote>
<p>现在sass监控，也成为企业监控的选择之一了，加上<code>zabbix、Ganglia</code>等，再加上APM的兴起，监控体系也越来越完善了。从基础网络监控、硬件、服务器、应用、性能，然后端到端等方面，都可以插入，但是没有一个比较完整的监控体系是可以完全胜任的，所以还需要根据自身的应用和目标去综合做选择。</p>
<p>前几天接触到了<code>ELK(logstash, elasticsearch, kibana)</code>这套日志收集展示工具集,的确很方便，这样对以后开发指定权限查看日志，可以很好管理。</p>
<p>这里简单说了下为什么使用zabbix, Ganglia的功能是哪些？下面有讲到。</p>
<h3 id="Grafana是什么？"><a href="#Grafana是什么？" class="headerlink" title="Grafana是什么？"></a>Grafana是什么？</h3><p>个人认为： Grafana是一款对后端数据进行实时展示，跟elk那种差不多，非常清晰而且灵活丰富的图形化选项，可以混合多种风格，支持白天和夜间的模式，多个数据源，而跟zabbix比起来没有那么专业监控，没有那么丰富的监控功能，就是一个图像展示。</p>
<p>功能亮点</p>
<ul>
<li>丰富的图形与Grafana</li>
<li>模板变量可以创建可重用的仪表板</li>
</ul>
<p>官方是怎么解释Grafana的：</p>
<p>grafana是用于可视化大型测量数据的开源程序，他提供了强大和优雅的方式去创建、共享、浏览数据。dashboard中显示了你不同metric数据源中的数据。<br>grafana最常用于因特网基础设施和应用分析，但在其他领域也有机会用到，比如：工业传感器、家庭自动化、过程控制等等。<br>grafana有热插拔控制面板和可扩展的数据源，目前已经支持Graphite、InfluxDB、OpenTSDB、Elasticsearch。</p>
<h3 id="Grafana功能亮点"><a href="#Grafana功能亮点" class="headerlink" title="Grafana功能亮点"></a>Grafana功能亮点</h3><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">丰富的图形</div><div class="line">完全交互的，可编辑的图表。多个Y轴，对数刻度和选项。</div><div class="line"></div><div class="line">混合造型</div><div class="line">画出你的图形，你想怎么。混线，点和酒吧。混合堆叠瓦特/隔离系列。</div><div class="line"></div><div class="line">主题</div><div class="line">附带两个主题。如果你不喜欢默认的黑暗的主题，切换到光的主题。</div><div class="line"></div><div class="line">模板变量</div><div class="line">创建变量会自动填入值从您的数据库。</div><div class="line"></div><div class="line">一般可重复使用</div><div class="line">您可以在度量查询和面板标题中使用变量。</div><div class="line"></div><div class="line">重复面板</div><div class="line">自动重复每个选定的变量值的行或面板。</div><div class="line"></div><div class="line">数据源</div><div class="line">支持Graphite，Elasticsearch，Prometheus，InfluxDB，OpenTSDB和KairosDB开箱。或使用插件功能来添加自己的。</div><div class="line"></div><div class="line">认证</div><div class="line">管理用户，角色和组织。通过LDAP，基本验证与认证代理</div><div class="line"></div><div class="line">注释</div><div class="line">注释与datasouces包括Elasticsearch，石墨和InfluxDB丰富的活动图</div><div class="line"></div><div class="line">快照共享</div><div class="line">创建和共享在<span class="number">1</span>点击一个完全交互式图表和只有你的团队或全世界分享。</div></pre></td></tr></table></figure>
<h3 id="Grafana官网"><a href="#Grafana官网" class="headerlink" title="Grafana官网"></a>Grafana官网</h3><p>Granfana官网：<a href="http://grafana.org" target="_blank" rel="external">http://grafana.org</a></p>
<h3 id="Granfana官网安装参考文档"><a href="#Granfana官网安装参考文档" class="headerlink" title="Granfana官网安装参考文档"></a>Granfana官网安装参考文档</h3><p>安装文档：<a href="http://docs.grafana.org/installation/" target="_blank" rel="external">http://docs.grafana.org/installation/</a></p>
<h3 id="grafana和LDAP集成："><a href="#grafana和LDAP集成：" class="headerlink" title="grafana和LDAP集成："></a>grafana和LDAP集成：</h3><p>LDAP集成：<a href="http://docs.grafana.org/installation/ldap/" target="_blank" rel="external">http://docs.grafana.org/installation/ldap/</a></p>
<h3 id="grafana演示站点"><a href="#grafana演示站点" class="headerlink" title="grafana演示站点"></a>grafana演示站点</h3><p>grafana演示站点: <a href="http://play.grafana.org/" target="_blank" rel="external">http://play.grafana.org/</a></p>
<h3 id="3-0版本关于Grafana-zabbix插件官方文档："><a href="#3-0版本关于Grafana-zabbix插件官方文档：" class="headerlink" title="3.0版本关于Grafana-zabbix插件官方文档："></a>3.0版本关于Grafana-zabbix插件官方文档：</h3><p><a href="http://docs.grafana-zabbix.org/" target="_blank" rel="external">Grafana-zabbix插件安装官方使用文档</a></p>
<h3 id="官网下载地址"><a href="#官网下载地址" class="headerlink" title="官网下载地址"></a>官网下载地址</h3><p>Download Grafana:<a href="https://grafana.com/grafana/download" target="_blank" rel="external">Download Grafana</a></p>
<h3 id="安装Grafana"><a href="#安装Grafana" class="headerlink" title="安装Grafana"></a>安装Grafana</h3><ul>
<li>温馨提示：</li>
</ul>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">grafana的版本和grafana-zabbix的版本必须匹配，否则会出现异常。</div><div class="line">本文以grafana2<span class="number">.5</span>版本为例讲解，如果后面grafana和grafana-zabbix更新，需要将<span class="number">2</span>个版本匹配即可。</div></pre></td></tr></table></figure>
<p>现在最新版本是3.0版本，我们可以试试安装在基于RPM的Linux版本（CentOS，Fedora的，OpenSuse当中，红帽）</p>
<p>安装最新稳定版：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo yum install https://grafanarel.s3.amazonaws.com/builds/grafana-3.1.0-1468321182.x86_64.rpm</div></pre></td></tr></table></figure>
<p>如果被墙，可以到我github上面下载：<a href="https://github.com/yangcvo/Grafana" target="_blank" rel="external">Grafana</a></p>
<p>这里需要安装下依赖包：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ sudo yum install initscripts fontconfig</div><div class="line">$ sudo rpm -Uvh grafana-3.1.0-1468321182.x86_64.rpm</div></pre></td></tr></table></figure>
<p>或者选择YUM方式安装：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">vim etc/yum.repos.d/grafana.repo</div><div class="line"></div><div class="line">[grafana]</div><div class="line">name=grafana</div><div class="line">baseurl=https://packagecloud.io/grafana/stable/el/6/<span class="variable">$basearch</span></div><div class="line">repo_gpgcheck=1</div><div class="line">enabled=1</div><div class="line">gpgcheck=1</div><div class="line">gpgkey=https://packagecloud.io/gpg.key https://grafanarel.s3.amazonaws.com/RPM-GPG-KEY-grafana</div><div class="line">sslverify=1</div><div class="line">sslcacert=/etc/pki/tls/certs/ca-bundle.crt</div></pre></td></tr></table></figure>
<p>还有，如果你想测试版或发布候选测试存储库。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">baseurl=https://packagecloud.io/grafana/testing/el/6/<span class="variable">$basearch</span></div></pre></td></tr></table></figure>
<p>然后通过安装Grafana <code>yum</code>的命令。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span><span class="bash"> sudo yum install grafana</span></div></pre></td></tr></table></figure>
<p>RPM GPG密钥<br>RPM包进行签名，可以验证这个签名公共GPG密钥。</p>
<h3 id="包装细节"><a href="#包装细节" class="headerlink" title="包装细节"></a>包装细节</h3><ul>
<li>安装二进制文件到 <code>/usr/sbin/grafana-server</code></li>
<li>副本的init.d脚本<code>/etc/init.d/grafana-server</code></li>
<li>默认的安装文件环境，以在<code>/etc/sysconfig/grafana-server</code></li>
<li>拷贝配置文件<code>/etc/grafana/grafana.ini</code></li>
<li>安装systemd服务（如果systemd可用）名称<code>grafana-server.service</code></li>
<li>默认配置使用的日志文件在<code>/var/log/grafana/grafana.log</code></li>
<li>默认配置指定以sqlite3的数据库<code>/var/lib/grafana/grafana.db</code></li>
</ul>
<p>启动服务（的init.d服务）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span><span class="bash"> sudo service grafana-server start</span></div></pre></td></tr></table></figure>
<p>这将启动grafana服务进程作为grafana用户，这是包安装过程中创建。默认HTTP端口是 3000，和默认的用户和组管理。</p>
<p>要配置服务器Grafana在启动时启动：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo /sbin/chkconfig --<span class="keyword">add</span><span class="bash"> grafana-server</span></div></pre></td></tr></table></figure>
<p>centos 7 系统启动服务：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span><span class="bash"> systemctl daemon-reload</span></div><div class="line"><span class="meta">$</span><span class="bash"> systemctl start grafana-server</span></div><div class="line"><span class="meta">$</span><span class="bash"> systemctl status grafana-server</span></div></pre></td></tr></table></figure>
<p>centos 7 设置开机启动</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo systemctl <span class="built_in">enable</span> grafana-server.service</div></pre></td></tr></table></figure>
<h3 id="环境文件"><a href="#环境文件" class="headerlink" title="环境文件"></a>环境文件</h3><p>该systemd服务文件和脚本的init.d都使用位于文件 在<code>/etc/sysconfig/grafana</code>服务启动后端时所使用的环境变量。<br>在这里，您可以覆盖日志目录，数据目录和其他变量。</p>
<h3 id="记录"><a href="#记录" class="headerlink" title="记录"></a>记录</h3><p>默认情况下Grafana将记录到的<code>/var/log/grafana</code></p>
<h3 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h3><p>默认配置指定位于一个sqlite3的数据库 <code>/var/lib/grafana/grafana.db</code>。请备份升级之前，这个数据库。你也可以使用MySQL或者Postgres作为Grafana数据库上详述配置页面。</p>
<h3 id="组态"><a href="#组态" class="headerlink" title="组态"></a>组态</h3><p>该配置文件位于<code>/etc/grafana/grafana.ini</code>.去配置页面上的所有这些选项的详细信息。</p>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p><a href="http://docs.grafana.org/installation/configuration/#database" target="_blank" rel="external">http://docs.grafana.org/installation/configuration/#database</a></p>
<p>配置文件里分段给出了非常详细的说明，非常人性化</p>
<p>默认使用的是sqlite3的，这里我调整为自己MySQL的。</p>
<h3 id="1-创建数据库和用户"><a href="#1-创建数据库和用户" class="headerlink" title="1.创建数据库和用户"></a>1.创建数据库和用户</h3><figure class="highlight lasso"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">mysql&gt; CREATE DATABASE grafana DEFAULT CHARACTER <span class="built_in">SET</span> utf8;</div><div class="line">Query OK, <span class="number">1</span> row affected (<span class="number">0.02</span> sec)</div><div class="line"></div><div class="line">mysql&gt; GRANT <span class="literal">ALL</span> <span class="keyword">ON</span> grafana.* <span class="keyword">TO</span> grafana@<span class="string">'192.168.1.%'</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">'haozhuo.com'</span> <span class="keyword">WITH</span> GRANT OPTION;</div><div class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.26</span> sec)</div><div class="line"></div><div class="line">mysql&gt; FLUSH PRIVILEGES;</div><div class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.02</span> sec)</div></pre></td></tr></table></figure>
<h3 id="2-指定数据库及认证信息"><a href="#2-指定数据库及认证信息" class="headerlink" title="2.指定数据库及认证信息"></a>2.指定数据库及认证信息</h3><p>cp /etc/grafana/grafana.ini{,.default}<br>vim /etc/grafana/grafana.ini</p>
<p>配置文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">[database]</div><div class="line"><span class="comment"># Either "mysql", "postgres" or "sqlite3", it's your choice</span></div><div class="line"><span class="built_in">type</span> = mysql</div><div class="line">host = 192.168.1.201:3306</div><div class="line">name = grafana</div><div class="line">user = grafana</div><div class="line">password = haozhuo.com</div><div class="line"></div><div class="line">[session]</div><div class="line"><span class="comment"># Either "memory", "file", "redis", "mysql", "postgres", default is "file"</span></div><div class="line">provider = redis</div><div class="line">provider_config = addr=127.0.0.1:6379,pool_size=100,db=grafana</div><div class="line"> </div><div class="line">cookie_name = grafana_sess</div><div class="line">cookie_secure = <span class="literal">false</span></div><div class="line"> </div><div class="line">session_life_time = 86400</div></pre></td></tr></table></figure>
<h3 id="grafana-ini-配置文件详解"><a href="#grafana-ini-配置文件详解" class="headerlink" title="grafana.ini 配置文件详解"></a>grafana.ini 配置文件详解</h3><figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div></pre></td><td class="code"><pre><div class="line">app_mode：应用名称，默认是production</div><div class="line"></div><div class="line">[path]</div><div class="line">data：一个grafana用来存储sqlite3、临时文件、回话的地址路径</div><div class="line">logs：grafana存储logs的路径</div><div class="line"></div><div class="line">[server]</div><div class="line">http_addr：监听的ip地址，，默认是0.0.0.0</div><div class="line">http_port：监听的端口，默认是3000</div><div class="line">protocol：http或者https，，默认是http</div><div class="line">domain：这个设置是root_url的一部分，当你通过浏览器访问grafana时的公开的domian名称，默认是localhost</div><div class="line">enforce_domain：如果主机的header不匹配domian，则跳转到一个正确的domain上，默认是false</div><div class="line"><span class="section">root_url：这是一个web上访问grafana的全路径url，默认是%(protocol)s://%(domain)s:%(http_port)s/</span></div><div class="line">router_logging：是否记录web请求日志，默认是false</div><div class="line">cert_file：如果使用https则需要设置</div><div class="line">cert_key：如果使用https则需要设置</div><div class="line"></div><div class="line">[database]</div><div class="line">grafana默认需要使用数据库存储用户和dashboard信息，默认使用sqlite3来存储，你也可以换成其他数据库</div><div class="line">type：可以是mysql、postgres、sqlite3，默认是sqlite3</div><div class="line">path：只是sqlite3需要，定义sqlite3的存储路径</div><div class="line"><span class="section">host：只是mysql、postgres需要，默认是127.0.0.1:3306</span></div><div class="line">name：grafana的数据库名称，默认是grafana</div><div class="line">user：连接数据库的用户</div><div class="line">password：数据库用户的密码</div><div class="line">ssl_mode：只是postgres使用</div><div class="line"></div><div class="line"></div><div class="line">[security]</div><div class="line">admin_user：grafana默认的admin用户，默认是admin</div><div class="line">admin_password：grafana admin的默认密码，默认是admin</div><div class="line">login_remember_days：多少天内保持登录状态</div><div class="line">secret_key：保持登录状态的签名</div><div class="line">disable_gravatar：</div><div class="line"></div><div class="line"></div><div class="line">[users]</div><div class="line">allow_sign_up：是否允许普通用户登录，如果设置为false，则禁止用户登录，默认是true，则admin可以创建用户，并登录grafana</div><div class="line">allow_org_create：如果设置为false，则禁止用户创建新组织，默认是true</div><div class="line">auto_assign_org：当设置为true的时候，会自动的把新增用户增加到id为1的组织中，当设置为false的时候，新建用户的时候会新增一个组织</div><div class="line">auto_assign_org_role：新建用户附加的规则，默认是Viewer，还可以是Admin、Editor</div><div class="line"></div><div class="line"></div><div class="line">[auth.anonymous]</div><div class="line">enabled：设置为true，则开启允许匿名访问，默认是false</div><div class="line">org_name：为匿名用户设置组织名称</div><div class="line">org_role：为匿名用户设置的访问规则，默认是Viewer</div><div class="line"></div><div class="line"></div><div class="line">[auth.github]</div><div class="line">针对github项目的，很明显，呵呵</div><div class="line">enabled = false</div><div class="line">allow_sign_up = false</div><div class="line">client_id = some_id</div><div class="line">client_secret = some_secret</div><div class="line">scopes = user:email</div><div class="line">auth_url = https://github.com/login/oauth/authorize</div><div class="line">token_url = https://github.com/login/oauth/access_token</div><div class="line">api_url = https://api.github.com/user</div><div class="line">team_ids =</div><div class="line">allowed_domains =</div><div class="line">allowed_organizations =</div><div class="line"></div><div class="line"></div><div class="line">[auth.google]</div><div class="line">针对google app的，呵呵</div><div class="line">enabled = false</div><div class="line">allow_sign_up = false</div><div class="line">client_id = some_client_id</div><div class="line">client_secret = some_client_secret</div><div class="line">scopes = https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/userinfo.email</div><div class="line">auth_url = https://accounts.google.com/o/oauth2/auth</div><div class="line">token_url = https://accounts.google.com/o/oauth2/token</div><div class="line">api_url = https://www.googleapis.com/oauth2/v1/userinfo</div><div class="line">allowed_domains =</div><div class="line"></div><div class="line"></div><div class="line">[auth.basic]</div><div class="line">enabled：当设置为true，则http api开启基本认证</div><div class="line"></div><div class="line"></div><div class="line">[auth.ldap]</div><div class="line">enabled：设置为true则开启LDAP认证，默认是false</div><div class="line">config_file：如果开启LDAP，指定LDAP的配置文件/etc/grafana/ldap.toml</div><div class="line"></div><div class="line"></div><div class="line">[auth.proxy]</div><div class="line">允许你在一个HTTP反向代理上进行认证设置</div><div class="line">enabled：默认是false</div><div class="line">header_name：默认是X-WEBAUTH-USER</div><div class="line">header_property：默认是个名称username</div><div class="line">auto_sign_up：默认是true。开启自动注册，如果用户在grafana DB中不存在</div><div class="line"></div><div class="line">[analytics]</div><div class="line">reporting_enabled：如果设置为true，则会发送匿名使用分析到stats.grafana.org，主要用于跟踪允许实例、版本、dashboard、错误统计。默认是true</div><div class="line">google_analytics_ua_id：使用GA进行分析，填写你的GA ID即可</div><div class="line"></div><div class="line"></div><div class="line">[dashboards.json]</div><div class="line">如果你有一个系统自动产生json格式的dashboard，则可以开启这个特性试试</div><div class="line">enabled：默认是false</div><div class="line">path：一个全路径用来包含你的json dashboard，默认是/var/lib/grafana/dashboards</div><div class="line"></div><div class="line"></div><div class="line">[session]</div><div class="line">provider：默认是file，值还可以是memory、mysql、postgres</div><div class="line"><span class="section">provider_config：这个值的配置由provider的设置来确定，如果provider是file，则是data/xxxx路径类型，如果provider是mysql，则是user:password@tcp(127.0.0.1:3306)/database_name，如果provider是postgres，则是user=a password=b host=localhost port=5432 dbname=c sslmode=disable</span></div><div class="line">cookie_name：grafana的cookie名称</div><div class="line">cookie_secure：如果设置为true，则grafana依赖https，默认是false</div><div class="line">session_life_time：session过期时间，默认是86400秒，24小时</div><div class="line"></div><div class="line"></div><div class="line">以下是官方文档没有，配置文件中有的</div><div class="line">[smtp]</div><div class="line">enabled = false</div><div class="line">host = localhost:25</div><div class="line">user =</div><div class="line">password =</div><div class="line">cert_file =</div><div class="line">key_file =</div><div class="line">skip_verify = false</div><div class="line">from_address = admin@grafana.localhost</div><div class="line"></div><div class="line">[emails]</div><div class="line">welcome_email_on_sign_up = false</div><div class="line">templates_pattern = emails/*.html</div><div class="line"></div><div class="line"></div><div class="line">[log]</div><div class="line">mode：可以是console、file，默认是console、file，也可以设置多个，用逗号隔开</div><div class="line">buffer_len：channel的buffer长度，默认是10000</div><div class="line">level：可以是<span class="string">"Trace"</span>, <span class="string">"Debug"</span>, <span class="string">"Info"</span>, <span class="string">"Warn"</span>, <span class="string">"Error"</span>, <span class="string">"Critical"</span>，默认是info</div><div class="line"></div><div class="line">[log.console]</div><div class="line">level：设置级别</div><div class="line"></div><div class="line">[log.file]</div><div class="line">level：设置级别</div><div class="line">log_rotate：是否开启自动轮转</div><div class="line">max_lines：单个日志文件的最大行数，默认是1000000</div><div class="line">max_lines_shift：单个日志文件的最大大小，默认是28，表示256MB</div><div class="line">daily_rotate：每天是否进行日志轮转，默认是true</div><div class="line">max_days：日志过期时间，默认是7,7天后删除</div></pre></td></tr></table></figure>
<h3 id="3-重启grafana"><a href="#3-重启grafana" class="headerlink" title="3.重启grafana"></a>3.重启grafana</h3><p>service grafana-server restart<br>tail -f /var/log/grafana/grafana.log</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line">[root@LAN_zabbix ~]<span class="comment"># tail -f /var/log/grafana/grafana.log</span></div><div class="line">t=2016-07-14T00:49:01+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"Rename table dashboard to dashboard_v1 - v1"</span></div><div class="line">t=2016-07-14T00:49:01+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"create dashboard v2"</span></div><div class="line">t=2016-07-14T00:49:02+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"create index IDX_dashboard_org_id - v2"</span></div><div class="line">t=2016-07-14T00:49:02+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"create index UQE_dashboard_org_id_slug - v2"</span></div><div class="line">t=2016-07-14T00:49:02+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"copy dashboard v1 to v2"</span></div><div class="line">t=2016-07-14T00:49:02+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"drop table dashboard_v1"</span></div><div class="line">t=2016-07-14T00:49:02+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"alter dashboard.data to mediumtext v1"</span></div><div class="line">t=2016-07-14T00:49:02+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"Add column updated_by in dashboard - v2"</span></div><div class="line">t=2016-07-14T00:49:02+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"Add column created_by in dashboard - v2"</span></div><div class="line">t=2016-07-14T00:49:02+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"Add column gnetId in dashboard"</span></div><div class="line">t=2016-07-14T00:49:02+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"Add index for gnetId in dashboard"</span></div><div class="line">t=2016-07-14T00:49:02+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"create data_source table"</span></div><div class="line">t=2016-07-14T00:49:02+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"add index data_source.account_id"</span></div><div class="line">t=2016-07-14T00:49:02+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"add unique index data_source.account_id_name"</span></div><div class="line">t=2016-07-14T00:49:03+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"drop index IDX_data_source_account_id - v1"</span></div><div class="line">t=2016-07-14T00:49:03+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"drop index UQE_data_source_account_id_name - v1"</span></div><div class="line">t=2016-07-14T00:49:03+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"Rename table data_source to data_source_v1 - v1"</span></div><div class="line">t=2016-07-14T00:49:03+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"create data_source table v2"</span></div><div class="line">t=2016-07-14T00:49:03+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"create index IDX_data_source_org_id - v2"</span></div><div class="line">t=2016-07-14T00:49:03+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"create index UQE_data_source_org_id_name - v2"</span></div><div class="line">t=2016-07-14T00:49:03+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"copy data_source v1 to v2"</span></div><div class="line">t=2016-07-14T00:49:03+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"Drop old table data_source_v1 #2"</span></div><div class="line">t=2016-07-14T00:49:03+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"Add column with_credentials"</span></div><div class="line">t=2016-07-14T00:49:03+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"create api_key table"</span></div><div class="line">t=2016-07-14T00:49:03+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"add index api_key.account_id"</span></div><div class="line">t=2016-07-14T00:49:04+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"add index api_key.key"</span></div><div class="line">t=2016-07-14T00:49:04+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"add index api_key.account_id_name"</span></div><div class="line">t=2016-07-14T00:49:04+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"drop index IDX_api_key_account_id - v1"</span></div><div class="line">t=2016-07-14T00:49:04+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"drop index UQE_api_key_key - v1"</span></div><div class="line">t=2016-07-14T00:49:04+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"drop index UQE_api_key_account_id_name - v1"</span></div><div class="line">t=2016-07-14T00:49:04+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"Rename table api_key to api_key_v1 - v1"</span></div><div class="line">t=2016-07-14T00:49:04+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"create api_key table v2"</span></div><div class="line">t=2016-07-14T00:49:04+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"create index IDX_api_key_org_id - v2"</span></div><div class="line">t=2016-07-14T00:49:05+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"create index UQE_api_key_key - v2"</span></div><div class="line">t=2016-07-14T00:49:05+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"create index UQE_api_key_org_id_name - v2"</span></div><div class="line">t=2016-07-14T00:49:05+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"copy api_key v1 to v2"</span></div><div class="line">t=2016-07-14T00:49:05+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"Drop old table api_key_v1"</span></div><div class="line">t=2016-07-14T00:49:06+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"create dashboard_snapshot table v4"</span></div><div class="line">t=2016-07-14T00:49:18+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"drop table dashboard_snapshot_v4 #1"</span></div><div class="line">t=2016-07-14T00:49:18+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"create dashboard_snapshot table v5 #2"</span></div><div class="line">t=2016-07-14T00:49:18+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"create index UQE_dashboard_snapshot_key - v5"</span></div><div class="line">t=2016-07-14T00:49:18+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"create index UQE_dashboard_snapshot_delete_key - v5"</span></div><div class="line">t=2016-07-14T00:49:19+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"create index IDX_dashboard_snapshot_user_id - v5"</span></div><div class="line">t=2016-07-14T00:49:19+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"alter dashboard_snapshot to mediumtext v2"</span></div><div class="line">t=2016-07-14T00:49:19+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"create quota table v1"</span></div><div class="line">t=2016-07-14T00:49:19+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"create index UQE_quota_org_id_user_id_target - v1"</span></div><div class="line">t=2016-07-14T00:49:19+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"create plugin_setting table"</span></div><div class="line">t=2016-07-14T00:49:19+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"create index UQE_plugin_setting_org_id_plugin_id - v1"</span></div><div class="line">t=2016-07-14T00:49:19+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"create session table"</span></div><div class="line">t=2016-07-14T00:49:20+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"Drop old table playlist table"</span></div><div class="line">t=2016-07-14T00:49:20+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"Drop old table playlist_item table"</span></div><div class="line">t=2016-07-14T00:49:20+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"create playlist table v2"</span></div><div class="line">t=2016-07-14T00:49:20+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"create playlist item table v2"</span></div><div class="line">t=2016-07-14T00:49:20+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"drop preferences table v2"</span></div><div class="line">t=2016-07-14T00:49:20+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"drop preferences table v3"</span></div><div class="line">t=2016-07-14T00:49:20+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"create preferences table v3"</span></div><div class="line">t=2016-07-14T00:49:20+0800 lvl=info msg=<span class="string">"Created default admin user: [admin]"</span></div><div class="line">t=2016-07-14T00:49:20+0800 lvl=info msg=<span class="string">"Starting plugin search"</span> logger=plugins</div><div class="line">t=2016-07-14T00:49:20+0800 lvl=eror msg=<span class="string">"Plugins: Failed to load plugin json file: [/usr/share/grafana/public/app/plugins/datasource/zabbix/plugin.json invalid character '\"' after object key:value pair],  err: %!v(MISSING)"</span></div><div class="line">t=2016-07-14T00:49:20+0800 lvl=info msg=<span class="string">"Server Listening"</span> logger=server address=0.0.0.0:3000 protocol=http subUrl=</div></pre></td></tr></table></figure>
<p>logger=server <code>address=0.0.0.0:3000</code> protocol=http</p>
<h3 id="Dashboard"><a href="#Dashboard" class="headerlink" title="Dashboard"></a>Dashboard</h3><p>web:</p>
<p><a href="http://192.168.1.220:3000" target="_blank" rel="external">http://192.168.1.220:3000</a></p>
<p>默认用户名:admin</p>
<p>默认用户名密码:admin</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-grafana1.png" alt=""></figure></p>
<p>登录后一片空白，所以需要安装相应插件。</p>
<h3 id="grafana-zabbix插件"><a href="#grafana-zabbix插件" class="headerlink" title="grafana-zabbix插件"></a>grafana-zabbix插件</h3><figure class="highlight dts"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">https:</span><span class="comment">//github.com/alexanderzobnin/grafana-zabbix</span></div><div class="line"><span class="symbol">http:</span><span class="comment">//play.grafana-zabbix.org/</span></div><div class="line"><span class="symbol">http:</span><span class="comment">//docs.grafana-zabbix.org/installation/</span></div><div class="line"><span class="symbol">http:</span><span class="comment">//docs.grafana-zabbix.org/installation/configuration/</span></div><div class="line"><span class="symbol">https:</span><span class="comment">//grafana.net/plugins/alexanderzobnin-zabbix-app/installation</span></div></pre></td></tr></table></figure>
<p>1.安装插件</p>
<p>官网讲的非常详细参考链接：<a href="http://docs.grafana-zabbix.org/installation/" target="_blank" rel="external">http://docs.grafana-zabbix.org/installation/</a></p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@LAN_zabbix ~]<span class="comment"># grafana-cli plugins install alexanderzobnin-zabbix-app</span></div><div class="line">installing alexanderzobnin-zabbix-app @ <span class="number">3.0</span>.<span class="number">0</span></div><div class="line">from <span class="symbol">url:</span> <span class="symbol">https:</span>/<span class="regexp">/grafana.net/api</span><span class="regexp">/plugins/alexanderzobnin</span>-zabbix-app/versions/<span class="number">3.0</span>.<span class="number">0</span>/download</div><div class="line"><span class="symbol">into:</span> /var/<span class="class"><span class="keyword">lib</span>/<span class="title">grafana</span>/<span class="title">plugins</span></span></div><div class="line"></div><div class="line">✔ Installed alexanderzobnin-zabbix-app successfully</div><div class="line"></div><div class="line">Restart grafana after installing plugins . &lt;service grafana-server restart&gt;</div></pre></td></tr></table></figure>
<p>然后在登陆查看，这里已经安装上zabbix插件了。</p>
<h3 id="三、grafana使用"><a href="#三、grafana使用" class="headerlink" title="三、grafana使用"></a>三、grafana使用</h3><p>grafana的仪表和zabbix的监控差不多，基本是先创建监控模板、监控项，然后再添加仪表。这里先建立数据源，再创建仪表对象，并添加模板，最后添加仪表。</p>
<ul>
<li>可参考：<a href="https://github.com/alexanderzobnin/grafana-zabbix/wiki/Usage" target="_blank" rel="external">https://github.com/alexanderzobnin/grafana-zabbix/wiki/Usage</a></li>
</ul>
<h3 id="组态-1"><a href="#组态-1" class="headerlink" title="组态"></a>组态</h3><p>启用插件</p>
<p>转到Grafana侧面板插件，选择应用程序选项卡，然后选择的zabbix，打开配置 选项卡并启用插件。</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-grafana2.png" alt=""></figure></p>
<p>1.配置zabbix数据源</p>
<p>启用插件后可以添加的zabbix数据源。</p>
<p>要添加新的zabbix数据源公开数据源在侧面板中，单击添加数据源，并选择的zabbix从下拉列表中。</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-grafana3.png" alt=""></figure></p>
<p><a href="http://192.168.1.220/zabbix/api_jsonrpc.php" target="_blank" rel="external">http://192.168.1.220/zabbix/api_jsonrpc.php</a></p>
<p>注意: api_jsonrpc.php是zabbix的API调用接口</p>
<p>HTTP设置</p>
<ul>
<li>网址：设置的zabbix API URL（完整路径api_jsonrpc.php）。</li>
<li>访问：<ul>
<li>代理：通过Grafana后端访问</li>
<li>直接：从浏览器访问。</li>
</ul>
</li>
<li>HTTP认证：配置如果使用代理验证。<ul>
<li>基本认证：</li>
<li>凭据：<br>代理访问意味着Grafana后端将代理从浏览器的所有请求，并送他们到数据源。这是有用的，因为它可以消除CORS（跨产地站点资源）的问题，以及消除需要​​宣传认证细节数据源到浏览器。</li>
</ul>
</li>
</ul>
<p>直接访问仍然支持，因为在某些情况下，可能是有用的直接访问数据源取决于Grafana，用户，和数据源的使用情况和拓扑。</p>
<h3 id="ZABBIX-API细节"><a href="#ZABBIX-API细节" class="headerlink" title="ZABBIX API细节"></a>ZABBIX API细节</h3><ul>
<li>用户和密码：设置登录访问的zabbix API。同时检查用户的权限的zabbix如果你不能得到任何组和主机的Grafana。</li>
<li><p>趋势：启用如果您使用的zabbix 3.x或补丁中的zabbix 2.x的趋势支撑（ZBXNEXT-1193）。此选项严格推荐用于显示时间长周期（超过几天，在不同的zabbix您的项目的更新间隔的），因为项目历史几天包含吨的点。使用趋势将增加Grafana性能。</p>
<ul>
<li>从使用趋势之后的趋势将被使用的时间。默认值是7天（7天）。您可以在Grafana格式的时间。有效时间specificators是：</li>
</ul>
</li>
<li><p>^ h -小时</p>
</li>
<li>ð -天</li>
<li><p>中号 -个月</p>
</li>
<li><p>缓存更新间隔：插件缓存提高性能的一些API请求。将该值设置为所需的缓存生存期（此选项影响类的物品列表数据）。<br>然后单击添加 -数据源将被添加，您可以使用检查连接 测试连接按钮。此功能可以帮助找到一些错误，类似于无效的用户名或密码，错误的API网址。</p>
</li>
</ul>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-grafana4.png" alt=""></figure></p>
<h3 id="导入示例仪表板"><a href="#导入示例仪表板" class="headerlink" title="导入示例仪表板"></a>导入示例仪表板</h3><p>您可以从仪表盘导入示例仪表板选项卡中的插件配置。 </p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-grafana5.png" alt=""></figure></p>
<h3 id="请注意有关的zabbix-2-2或更低"><a href="#请注意有关的zabbix-2-2或更低" class="headerlink" title="请注意有关的zabbix 2.2或更低"></a>请注意有关的zabbix 2.2或更低</h3><p>ZABBIX 2.4之前的zabbix API（api_jsonrpc.php）不允许跨域请求（CORS）。你可以得到HTTP错误412（预处理失败）。要修复它添加此代码的版权后，立即api_jsonrpc.php：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">  标题（“访问控制允许来源：*<span class="string">'）;</span></div><div class="line">  </div><div class="line">标题（“访问控制允许信头：Content-Type的'）;</div><div class="line"></div><div class="line">标题（“访问控制允许的方法：POST<span class="string">'）;</span></div><div class="line"></div><div class="line">标题（“访问控制，最大年龄：1000'）;</div><div class="line"></div><div class="line">如果（<span class="variable">$ </span><span class="number">_</span> SERVER [ <span class="string">'REQUEST_METHOD'</span> ] === <span class="string">'选项'</span>）&#123;</div><div class="line"></div><div class="line">   返回 ;</div><div class="line">   </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>之前</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">require_once dirname( __FILE__ ). <span class="string">'/include/func.inc.php'</span> ;</div><div class="line">require_once dirname( __FILE__ ). <span class="string">'/include/classes/core/CHttpRequest.php'</span> ;</div></pre></td></tr></table></figure>
<p>完全修复上市。欲了解更多详情，请参见ZABBIX发出ZBXNEXT-1377 和ZBX-8459。<br>请注意有关浏览器缓存</p>
<p>更新插件，清除浏览器缓存和重新加载应用程序页面后。详情请参见铬， 火狐。您需要清除缓存而已，没有Cookie，历史记录和其他数据。</p>
<h3 id="升级"><a href="#升级" class="headerlink" title="升级"></a>升级</h3><h4 id="从2-X升级"><a href="#从2-X升级" class="headerlink" title="从2.X升级"></a>从2.X升级</h4><p>后启用的zabbix应用到数据源，打开你的配置的zabbix数据源端选择的zabbix从类型列表中再次。这是必要的，因为插件ID在Grafana 3.0改变。</p>
<p>参考官网配置数据源：<a href="http://docs.grafana-zabbix.org/installation/configuration/" target="_blank" rel="external">http://docs.grafana-zabbix.org/installation/configuration/</a></p>
<p>###入门Grafana-zabbix</p>
<p>你经过安装和配置<code>Grafana-zabbix</code>数据源，让我们创建一个简单的仪表板。</p>
<p>下面是自带的模板，自己新建的模板在我github上面有详细的创建步骤。</p>
<p>入门gafana创建仪表板：<a href="https://github.com/yangcvo/Grafana" target="_blank" rel="external">Grafana-github</a></p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-grafana7.png" alt=""></figure></p>
<ul>
<li>可参考：<a href="https://github.com/alexanderzobnin/grafana-zabbix/wiki/Usage" target="_blank" rel="external">https://github.com/alexanderzobnin/grafana-zabbix/wiki/Usage</a></li>
</ul>
<p><figure class="figure"><img src="https://cloud.githubusercontent.com/assets/4932851/8288883/9ec5b240-1921-11e5-9e0f-04d075b885e9.gif" alt=""></figure></p>
<p>zabbix-server2.4服务端编译安装 <a href="http://blog.yangcvo.me/2015/01/18/zabbix-server服务端编译安装/" target="_blank" rel="external">zabbix-server服务端编译安装</a></p>
<p>zabbix2.4监控80端口状态 : <a href="http://blog.yangcvo.me/2016/07/20/zabbix监控80端口状态/" target="_blank" rel="external">zabbix监控80端口状态</a></p>
<p>zabbix+Grafana安装使用监控结合 ：<a href="http://blog.yangcvo.me/2016/07/13/zabbix-Grafana安装使用结合/" target="_blank" rel="external">zabbix+Grafana安装使用监控结合</a></p>
<p>zabbix监控MySQL-添加自定义监控项 : <a href="http://blog.yangcvo.me/2015/09/29/zabbix监控MySQL-添加自定义监控项/" target="_blank" rel="external">zabbix监控MySQL-添加自定义监控项</a></p>
<p>zabbix的ICMP_Ping模版实现对客户端网络状态的监控 : <a href="http://blog.yangcvo.me/2015/11/18/zabbix的ICMP-Ping模版实现对客户端网络状态的监控/" target="_blank" rel="external">zabbix的ICMP_Ping模版实现对客户端网络状态的监控</a></p>
<p>zabbix性能监控故障总结 <a href="http://blog.yangcvo.me/2016/02/07/zabbix-故障总结/" target="_blank" rel="external">zabbix性能监控故障总结</a></p>

	

	

</article>




	<article>
	
		<h1><a href="/2016/06/10/自动化+Jenkins/Ansible/Ansible 安装出现 ImportError: No module named _text/">Ansible安装出现 ImportError/ No module named _text</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-06-10</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/Automation/">Automation</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Ansible/">Ansible</a>
			</span>
		
	</div>

	

	
		<h3 id="centos6-7-ansible-yum安装出现问题："><a href="#centos6-7-ansible-yum安装出现问题：" class="headerlink" title="centos6.7 ansible yum安装出现问题："></a>centos6.7 ansible yum安装出现问题：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">ansible --version</div><div class="line">Traceback (most recent call last):</div><div class="line">  File <span class="string">"/usr/bin/ansible"</span>, line 46, <span class="keyword">in</span> &lt;module&gt;</div><div class="line">    from ansible.module_utils._text import to_text</div><div class="line">ImportError: No module named _text</div></pre></td></tr></table></figure>
<p>提示这个错误，后面查看官网epel包需要更新，这里我已更新发现还是有问题。</p>
<h5 id="解决方法："><a href="#解决方法：" class="headerlink" title="解决方法："></a>解决方法：</h5><h5 id="使用pip-install安装过ansible就正常使用"><a href="#使用pip-install安装过ansible就正常使用" class="headerlink" title="使用pip install安装过ansible就正常使用"></a>使用pip install安装过ansible就正常使用</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">[root@ansible_01 ~]<span class="comment"># pip install ansible</span></div><div class="line">Collecting ansible</div><div class="line">  Downloading ansible-1.9.4.tar.gz (937kB)</div><div class="line">    100% |████████████████████████████████| 937kB 100kB/s </div><div class="line">Collecting paramiko (from ansible)</div><div class="line">  Downloading paramiko-1.15.3-py2.py3-none-any.whl (166kB)</div><div class="line">    100% |████████████████████████████████| 167kB 136kB/s </div><div class="line">Collecting jinja2 (from ansible)</div><div class="line">  Downloading Jinja2-2.8-py2.py3-none-any.whl (263kB)</div><div class="line">    100% |████████████████████████████████| 266kB 1.4MB/s </div><div class="line">Collecting PyYAML (from ansible)</div><div class="line">  Downloading PyYAML-3.11.tar.gz (248kB)</div><div class="line">    100% |████████████████████████████████| 249kB 72kB/s </div><div class="line">Requirement already satisfied (use --upgrade to upgrade): setuptools <span class="keyword">in</span> /usr/<span class="built_in">local</span>/python27/lib/python2.7/site-packages/setuptools-18.4-py2.7.egg (from ansible)</div><div class="line">Collecting pycrypto&gt;=2.6 (from ansible)</div><div class="line">  Downloading pycrypto-2.6.1.tar.gz (446kB)</div><div class="line">    100% |████████████████████████████████| 446kB 117kB/s </div><div class="line">Collecting ecdsa&gt;=0.11 (from paramiko-&gt;ansible)</div><div class="line">  Downloading ecdsa-0.13-py2.py3-none-any.whl (86kB)</div><div class="line">    100% |████████████████████████████████| 90kB 141kB/s </div><div class="line">Collecting MarkupSafe (from jinja2-&gt;ansible)</div><div class="line">  Downloading MarkupSafe-0.23.tar.gz</div><div class="line">Installing collected packages: ecdsa, pycrypto, paramiko, MarkupSafe, jinja2, PyYAML, ansible</div><div class="line">  Running setup.py install <span class="keyword">for</span> pycrypto</div><div class="line">  Running setup.py install <span class="keyword">for</span> MarkupSafe</div><div class="line">  Running setup.py install <span class="keyword">for</span> PyYAML</div><div class="line">  Running setup.py install <span class="keyword">for</span> ansible</div><div class="line">Successfully installed MarkupSafe-0.23 PyYAML-3.11 ansible-1.9.4 ecdsa-0.13 jinja2-2.8 paramiko-1.15.3 pycrypto-2.6.1</div></pre></td></tr></table></figure>
<p>如果提示没有<code>No package &#39;libffi&#39; found</code> </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install libffi-devel</div></pre></td></tr></table></figure>
<p>如果可以正常显示不需要设置 如果还是有问题设置下依赖：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">[root@ansible_01 ~]<span class="comment"># find / -name ansible</span></div><div class="line">/etc/ansible</div><div class="line">/usr/<span class="built_in">local</span>/bin/ansible</div><div class="line">/usr/<span class="built_in">local</span>/src/ansible</div><div class="line">/usr/<span class="built_in">local</span>/src/ansible/docsite/js/ansible</div><div class="line">/usr/<span class="built_in">local</span>/src/ansible/bin/ansible</div><div class="line">/usr/<span class="built_in">local</span>/src/ansible/packaging/port/sysutils/ansible</div><div class="line">/usr/<span class="built_in">local</span>/src/ansible/packaging/macports/sysutils/ansible</div><div class="line">/usr/<span class="built_in">local</span>/src/ansible/build/scripts-2.6/ansible</div><div class="line">/usr/<span class="built_in">local</span>/src/ansible/build/lib/ansible</div><div class="line">/usr/<span class="built_in">local</span>/src/ansible/lib/ansible</div><div class="line">/usr/<span class="built_in">local</span>/src/ansible/.git/modules/lib/ansible</div><div class="line">/usr/<span class="built_in">local</span>/lib/python2.7/site-packages/ansible</div><div class="line">/usr/lib/python2.6/site-packages/ansible-2.1.0-py2.6.egg/ansible</div><div class="line">/usr/lib/python2.6/site-packages/ansible-2.1.0-py2.6.egg/EGG-INFO/scripts/ansible</div><div class="line">/home/ansible</div></pre></td></tr></table></figure>
<p>然后安装完成正常显示版本信息：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"> ln <span class="_">-s</span> /usr/<span class="built_in">local</span>/bin/ansible /usr/bin/ansible </div><div class="line"> </div><div class="line"> [root@LAN_zabbix pip-9.0.1]<span class="comment"># ansible --version</span></div><div class="line">ansible 2.2.1.0</div><div class="line">  config file =</div><div class="line">  configured module search path = Default w/o overrides</div></pre></td></tr></table></figure>

	

	

</article>




	<article>
	
		<h1><a href="/2016/05/05/个人生活记录/黄山之旅/">黄山之旅</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-05-05</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/生活/">生活</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Personal-life-record/">Personal life record</a> <a class="article__tag-link" href="/tags/旅行日记/">旅行日记</a>
			</span>
		
	</div>

	

	
		<h4 id="俗话说：“五岳归来不看山-黄山归来不看岳-”黄山以奇松、怪石、云海、温泉、冬雪“五绝”闻名中外"><a href="#俗话说：“五岳归来不看山-黄山归来不看岳-”黄山以奇松、怪石、云海、温泉、冬雪“五绝”闻名中外" class="headerlink" title="俗话说：“五岳归来不看山,黄山归来不看岳.”黄山以奇松、怪石、云海、温泉、冬雪“五绝”闻名中外."></a>俗话说：“五岳归来不看山,黄山归来不看岳.”黄山以奇松、怪石、云海、温泉、冬雪“五绝”闻名中外.</h4><p>2016年5月1号 我和女票一起去黄山看日出。<br>出发前来一张：<br><img src="http://7xrthw.com1.z0.glb.clouddn.com/ghost9.pic.jpg" alt=""></p>
		<p><a class="article__read-more-link" href="/2016/05/05/个人生活记录/黄山之旅/">...read more</a></p>
	

	

</article>




	<article>
	
		<h1><a href="/2016/03/21/shell编程入门到简单/shell入门到简单 学习总结1-12章/">shell入门到简单 学习总结1-12章</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-03-21</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Shell-programming/">Shell programming</a>
			</span>
		
	</div>

	

	
		<h2 id="TOC"><a href="#TOC" class="headerlink" title="TOC"></a>TOC</h2><p>[TOC]</p>
<h2 id="第一章Shell前言："><a href="#第一章Shell前言：" class="headerlink" title="第一章Shell前言："></a>第一章Shell前言：</h2><p>Shell本身是一种用C语言编写的程序，从用户的角度来看，Shell是用户与Linux操作系统沟通的桥梁。用户既可以输入命令执行，又可以利用 Shell脚本编程，完成更加复杂的操作。在Linux GUI日益完善的今天在运维领域Shell编程仍然起着不可忽视的作用。深入地了解和熟练地掌握Shell编程，是每一个Linux用户的必修。</p>
		<p><a class="article__read-more-link" href="/2016/03/21/shell编程入门到简单/shell入门到简单 学习总结1-12章/">...read more</a></p>
	

	

</article>




	<article>
	
		<h1><a href="/2016/03/15/运维笔记/个人记录💥-走上全栈运维工程师学习笔记/">个人记录💥-走上全栈运维工程师学习笔记</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-03-15</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/运维笔记/">运维笔记</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Operation-and-maintenance-Road/">Operation and maintenance Road</a>
			</span>
		
	</div>

	

	
		<h2 id="个人运维💥学习笔记："><a href="#个人运维💥学习笔记：" class="headerlink" title="个人运维💥学习笔记："></a>个人运维💥学习笔记：</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">从2014年初就开始慢慢记录自己所接触和学习到的东西，慢慢的积累，整理出很多学习的好文章，在这里我并且记录下来。</div><div class="line">这是我现在维护的个人笔记库和博客不同，它们大多都不是直接来源于我的原创，而是我一边阅读一边整理加工而成的笔记列表.</div><div class="line">我的目的是将零散的知识点放在一个集中的地方. </div><div class="line"> 第一：方便我自己查看和学习，可以更好的找到我想要的文档。</div><div class="line"> 第二：可以给自己学习结果每年做一个总结。</div><div class="line"> </div><div class="line"> 每3个月都会更新记录。</div></pre></td></tr></table></figure>
<h3 id="交流学习："><a href="#交流学习：" class="headerlink" title="交流学习："></a>交流学习：</h3><p>🐧  Linux shell_高级运维派: <code>459096184</code>    圈子 (系统运维-应用运维-自动化运维-虚拟化技术研究欢迎加入)<br>🐧  BigData-Exchange School : <code>521621407</code>  圈子（大数据运维)（Hadoop开发人员)（大数据研究爱好者) 欢迎加入</p>
<p>相应Bidata有内部微信交流群互相学习，加入QQ群有链接。</p>
<h3 id="Linux-系统"><a href="#Linux-系统" class="headerlink" title="Linux 系统"></a>Linux 系统</h3><p><code>Centos源</code></p>
<ul>
<li><a href="http://distrowatch.com/table.php?distribution=centos" target="_blank" rel="external">centos源码包更新下载地址</a></li>
<li><a href="https://wiki.centos.org/Download" target="_blank" rel="external">centos 镜像下载地址</a></li>
</ul>
<p><code>硬盘分区</code></p>
<ul>
<li><a href="http://www.unix-ninja.com/p/Formatting_Ext4_volumes_beyond_the_16TB_limit" target="_blank" rel="external">格式化的ext4量超过16TB的限制(1)</a></li>
<li><a href="http://blog.ronnyegner-consulting.de/2011/08/18/ext4-and-the-16-tb-limit-now-solved/" target="_blank" rel="external">格式化的ext4量超过16TB的限制(2)</a></li>
</ul>
<p><code>FileZilla</code></p>
<ul>
<li><a href="https://filezilla-project.org/download.php?type=client" target="_blank" rel="external">filezilla下载地址</a></li>
</ul>
<p><code>PXE</code></p>
<ul>
<li><a href="http://jiarh.blog.51cto.com/3467177/1734985" target="_blank" rel="external">pxe 无人值守安装操作系统</a></li>
<li><a href="http://www.zyops.com/autoinstall-kickstart" target="_blank" rel="external">PXE 安装</a></li>
</ul>
<p><code>YUM库</code></p>
<ul>
<li><a href="http://www.zyops.com/autodeploy-yum" target="_blank" rel="external">自动化部署-搭建YUM仓库</a></li>
</ul>
<p><code>rpm</code></p>
<ul>
<li><a href="http://www.zyops.com/autodeploy-rpm" target="_blank" rel="external">定制化RPM包</a></li>
</ul>
<p><code>DNS</code></p>
<ul>
<li><a href="http://www.zyops.com/aliyun-dns-analysis" target="_blank" rel="external">DNS域名解析原理</a></li>
</ul>
<p><code>开源epel</code></p>
<ul>
<li><a href="http://mirrors.ustc.edu.cn/" target="_blank" rel="external">开源epel下载包</a></li>
<li><a href="http://mirrors.sohu.com/" target="_blank" rel="external">开源站点</a></li>
<li><a href="http://ftp.linux.ncsu.edu/pub/epel/6/x86_64/" target="_blank" rel="external">linux_epel</a> </li>
<li><a href="http://rpm.pbone.net/index.php3/stat/3/srodzaj/1/search/epel-release" target="_blank" rel="external">rpm-epel包</a></li>
<li><a href="https://dl.fedoraproject.org/pub/epel/" target="_blank" rel="external">epel rpm软件包</a></li>
</ul>
<p><code>samba</code></p>
<ul>
<li><a href="http://blog.csdn.net/liuaigui/article/details/5077935" target="_blank" rel="external">samba配置方法</a></li>
</ul>
<p><code>iperf</code></p>
<ul>
<li><a href="http://heylinux.com/archives/3825.html" target="_blank" rel="external">使用iperf检测主机间网络带宽</a></li>
</ul>
<h3 id="虚拟化"><a href="#虚拟化" class="headerlink" title="虚拟化"></a>虚拟化</h3><p><code>Docker</code></p>
<ul>
<li><a href="http://www.infoq.com/cn/articles/docker-command-line-quest/" target="_blank" rel="external">Docker 命令学习</a></li>
<li><a href="http://www.tuicool.com/articles/7V7vYn" target="_blank" rel="external">Docker操作使用</a></li>
<li><a href="http://openskill.cn/article/22" target="_blank" rel="external">Docker 入门学习</a></li>
<li><a href="http://yuedu.baidu.com/ebook/d817967416fc700abb68fca1?pn=1&amp;pa=1" target="_blank" rel="external">Docker 入门之战电子书</a></li>
<li><a href="http://blog.csdn.net/birdben/article/details/49873725" target="_blank" rel="external">Docker实战（1)-(15)</a></li>
<li><a href="http://www.cnblogs.com/hslzju/p/5839913.html" target="_blank" rel="external">SSH远程登陆docker容器</a></li>
<li><a href="http://www.cnblogs.com/hslzju/p/5839983.html" target="_blank" rel="external">部署Jenkins+docker集成环境</a></li>
</ul>
<p><code>Esxi</code></p>
<ul>
<li><a href="http://www.josephturley.com/vsphere-5-5-client-download/" target="_blank" rel="external">vsphere客户端下载</a></li>
<li><a href="http://www.josephturley.com/vsphere-web-client-download/" target="_blank" rel="external">vsphere web客户端</a></li>
<li><a href="http://www.josephturley.com/vsphere-5-5-client-download/" target="_blank" rel="external">vsphere web客户端下载</a></li>
<li><a href="http://www.prolved.com/vsphere-client-downloads/" target="_blank" rel="external">vSphere Client下载</a></li>
</ul>
<p><code>KVM</code></p>
<h3 id="容器平台"><a href="#容器平台" class="headerlink" title="容器平台"></a>容器平台</h3><p><code>Docker</code></p>
<blockquote>
<p>Docker 是一个开源的应用容器引擎，让开发者可以打包他们的应用以及依赖包到一个可移植的容器中，然后发布到任何流行的 Linux 机器上，也可以实现虚拟化。</p>
</blockquote>
<p><code>Rocket</code></p>
<blockquote>
<p>Rocket （也叫 rkt）是 CoreOS 推出的一款容器引擎，和 Docker 类似，帮助开发者打包应用和依赖包到可移植容器中，简化搭环境等部署工作。</p>
</blockquote>
<p><code>Ubuntu（LXC）</code></p>
<blockquote>
<p>LXD 是 ubuntu 基于 LXC 技术的重构，容器天然支持非特权和分布式。LXD 与 Docker 的思路不同，Docker 是 PAAS，LXD 是 IAAS。LXC 项目由一个 Linux 内核补丁和一些 userspace 工具组成。这些 userspace 工具使用由补丁增加的内核新特性，提供一套简化的工具来维护容器。</p>
</blockquote>
<h3 id="微服务平台"><a href="#微服务平台" class="headerlink" title="微服务平台"></a>微服务平台</h3><p><code>OpenShift</code></p>
<blockquote>
<p>OpenShift 是由红帽推出的一款面向开源开发人员开放的平台即服务(PaaS)。 OpenShift通过为开发人员提供在语言、框架和云上的更多的选择，使开发人员可以构建、测试、运行和管理他们的应用。</p>
</blockquote>
<p><code>Cloud Foundry</code></p>
<blockquote>
<p>Cloud Foundry 是VMware于2011年4月12日推出的业界第一个开源PaaS云平台，它支持多种框架、语言、运行时环境、云平台及应用服务，使开发 人员能够在几秒钟内进行应用程序的部署和扩展，无需担心任何基础架构的问题。</p>
</blockquote>
<p><code>Kubernetes</code></p>
<blockquote>
<p>Kubernetes 是来自 Google 云平台的开源容器集群管理系统。基于 Docker 构建一个容器的调度服务。该系统可以自动在一个容器集群中选择一个工作容器供使用。其核心概念是 Container Pod。</p>
</blockquote>
<p><code>Mesosphere</code></p>
<blockquote>
<p>Apache Mesos 是一个集群管理器，提供了有效的、跨分布式应用或框架的资源隔离和共享，可以运行Hadoop、MPI、Hypertable、Spark。</p>
</blockquote>
<h3 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h3><p><code>MySQL</code></p>
<ul>
<li><a href="http://www.phperz.com/article/15/0801/144981.html" target="_blank" rel="external">mysql 教程</a></li>
<li><a href="http://dev.mysql.com/downloads/repo/yum/" target="_blank" rel="external">MySQL官方软件包下载地址</a></li>
<li><a href="http://www.aiplaypc.com/371.html" target="_blank" rel="external">MySQL主从配置文档</a></li>
<li><a href="http://heylinux.com/archives/1004.html" target="_blank" rel="external">MySQL主从复制(Master-Slave)与读写分离（MySQL-Proxy）实践</a></li>
<li><a href="http://openskill.cn/article/244" target="_blank" rel="external">Mysql架构的演化</a></li>
</ul>
<p><code>mongodb</code></p>
<ul>
<li><a href="http://www.yiibai.com/mongodb/mongodb_quick_guide.html" target="_blank" rel="external">MongoDB快速入门</a></li>
<li><a href="http://www.runoob.com/mongodb/mongodb-tutorial.html" target="_blank" rel="external">MongoDB 教程</a></li>
<li><a href="http://heylinux.com/archives/1950.html" target="_blank" rel="external">安装配置MongoDB</a></li>
<li><a href="https://www.mongodb.com/download-center?jmp=nav#community" target="_blank" rel="external">MongoDB安装包官网地址</a></li>
<li><a href="http://limingnihao.iteye.com/blog/1938262" target="_blank" rel="external">第1章 MongoDB的安装</a></li>
<li><a href="http://limingnihao.iteye.com/blog/1938383" target="_blank" rel="external">第2章 MongoDB的增删改查</a></li>
<li><a href="http://limingnihao.iteye.com/blog/1940438" target="_blank" rel="external">第3章 MongoDB的Java驱动</a></li>
</ul>
<p><code>Robomongo</code></p>
<ul>
<li><a href="https://robomongo.org/" target="_blank" rel="external">官网</a>   MongoDB的一个客户端GUI工具</li>
<li><a href="http://app.robomongo.org/download.html" target="_blank" rel="external">下载地址</a></li>
</ul>
<h3 id="云☁️服务"><a href="#云☁️服务" class="headerlink" title="云☁️服务"></a>云☁️服务</h3><p><code>CDN</code></p>
<ul>
<li><a href="http://www.cedexis.com/reports/#?report=cdn_response_time&amp;country=CN&amp;date=2015-09-29" target="_blank" rel="external">CDN测试排行</a></li>
<li><a href="http://www.infoq.com/cn/articles/find-the-same-in-the-variable-from-CDN-to-cloud-computing/" target="_blank" rel="external">CDN变化</a></li>
<li><p><a href="http://www.17ce.com/" target="_blank" rel="external">网站测速</a></p>
<p><code>OpenStack</code></p>
</li>
</ul>
<ul>
<li><a href="https://www.ibm.com/developerworks/community/blogs/132cfa78-44b0-4376-85d0-d3096cd30d3f/entry/%E5%86%99%E5%9C%A8%E6%9C%80%E5%89%8D%E9%9D%A2_%E6%AF%8F%E5%A4%A95%E5%88%86%E9%92%9F%E7%8E%A9%E8%BD%AC_OpenStack_1?lang=en" target="_blank" rel="external">每天5分钟玩转 OpenStack</a></li>
<li><a href="https://docs.openstack.org/ocata/install-guide-rdo/" target="_blank" rel="external">Red Hat Enterprise Linux和CentOS的OpenStack安装指南</a>  </li>
<li><a href="http://xmodulo.com/manage-vms-openstack-command-line-tools.html" target="_blank" rel="external">如何使用OpenStack命令行工具管理虚拟机</a></li>
</ul>
<h3 id="大数据运维"><a href="#大数据运维" class="headerlink" title="大数据运维"></a>大数据运维</h3><p><code>HBase 集群安装部署</code> <a href="http://wuchong.me/blog/2015/04/05/hbase-cluster-deploy/" target="_blank" rel="external">HBase 集群安装部署</a></p>
<h3 id="编程script"><a href="#编程script" class="headerlink" title="编程script"></a>编程script</h3><p><code>shell</code></p>
<ul>
<li><a href="http://c.biancheng.net/cpp/shell/" target="_blank" rel="external">shell学习网站</a></li>
<li><a href="http://man.linuxde.net/" target="_blank" rel="external">Linux命令大全</a></li>
</ul>
<p><code>Python</code></p>
<ul>
<li><a href="http://edu.51cto.com/lesson/id-48608.html?edu_recommend_adid=174?edu_recommend_adid=174" target="_blank" rel="external">python 学习视频</a></li>
<li><a href="http://www.pythondoc.com/pythontutorial3/index.html" target="_blank" rel="external">Python 入门指南</a></li>
<li><a href="http://www.jobui.com/mianshiti/it/python/" target="_blank" rel="external">Python面试题</a></li>
<li><a href="http://www.pythondoc.com/" target="_blank" rel="external">python中文大本营</a></li>
<li><p><a href="https://bitbucket.org/rootart/bandersnatch/src/069c46166d9ed8cc236daa7eac39c2bb2f224644/src/bandersnatch/?at=default" target="_blank" rel="external">bandersnatch</a></p>
<p><code>pip</code></p>
</li>
<li><p><a href="http://rfyiamcool.blog.51cto.com/1030776/1290456?utm_source=tuicool&amp;utm_medium=referral" target="_blank" rel="external">构建快速部署的python pip环境及pypi本地源环境</a></p>
</li>
<li><a href="http://blog.csdn.net/tantexian/article/details/37724633" target="_blank" rel="external">CentOS 6.5 PYPI本地源制作</a></li>
</ul>
<h3 id="Web服务"><a href="#Web服务" class="headerlink" title="Web服务"></a>Web服务</h3><p><code>NGINX</code></p>
<ul>
<li><a href="http://www.phperz.com/article/15/0903/153754.html" target="_blank" rel="external">nginx 教程</a></li>
<li><a href="http://www.bysocket.com/?p=282" target="_blank" rel="external">图解http协议</a></li>
<li><a href="http://www.nginx.cn/591.html" target="_blank" rel="external">nginx 配置入门</a></li>
<li><a href="https://segmentfault.com/a/1190000002990165" target="_blank" rel="external">nginx 入门2</a></li>
<li><a href="http://blog.jobbole.com/89287/" target="_blank" rel="external">nginx 优化</a></li>
<li><a href="https://blog.martinfjordvald.com/2011/04/optimizing-nginx-for-high-traffic-loads/" target="_blank" rel="external">nginx  优化2</a></li>
<li><a href="https://www.nginx.com/resources/wiki/start/topics/examples/redhatnginxinit/" target="_blank" rel="external">nginx yum安装 脚本下载地址</a></li>
</ul>
<p><code>tomcat</code></p>
<ul>
<li><a href="http://www.zyops.com/java-tomcat" target="_blank" rel="external">JAVA企业级应用TOMCAT实战</a></li>
<li><a href="http://www.zyops.com/java-tomcat" target="_blank" rel="external">tomcat 集群</a></li>
<li><a href="http://www.zyops.com/java-tomcat" target="_blank" rel="external">tomcat 监控</a></li>
<li><a href="http://www.zyops.com/java-tomcat" target="_blank" rel="external">jvm 调优</a></li>
</ul>
<p><code>负载均衡</code></p>
<p><a href="https://www.shiyanlou.com/courses/652" target="_blank" rel="external">LVS 集群负载均衡实战</a></p>
<h3 id="开源的分布式版本控制系统"><a href="#开源的分布式版本控制系统" class="headerlink" title="开源的分布式版本控制系统"></a>开源的分布式版本控制系统</h3><p><code>Git</code></p>
<ul>
<li><a href="http://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000" target="_blank" rel="external">git教程</a></li>
</ul>
<p><code>Gitlab</code></p>
<ul>
<li><a href="https://www.gitlab.cc/downloads/#centos6" target="_blank" rel="external">gitlab官网</a></li>
</ul>
<h3 id="mail"><a href="#mail" class="headerlink" title="mail"></a>mail</h3><p><code>zimbra</code></p>
<ul>
<li><a href="http://aba.qzu.cn/archives/251.html" target="_blank" rel="external">Centos6.2下安装zimbra 7.2</a></li>
<li><a href="http://www.csdn.net/tag/zimbra" target="_blank" rel="external">zimbra</a></li>
</ul>
<h3 id="自动化运维"><a href="#自动化运维" class="headerlink" title="自动化运维"></a>自动化运维</h3><p><code>ansible</code></p>
<blockquote>
<p>Ansible 提供一种最简单的方式用于发布、管理和编排计算机系统的工具，你可在数分钟内搞定。Ansible 是一个模型驱动的配置管理器，支持多节点发布、远程任务执行。默认使用 SSH 进行远程连接。无需在被管理节点上安装附加软件，可使用各种编程语言进行扩展。</p>
<ul>
<li><a href="http://www.aikaiyuan.com/6299.html" target="_blank" rel="external">ansible指南</a></li>
</ul>
</blockquote>
<p><code>saltstack</code></p>
<blockquote>
<p>Saltstack 可以看做是func的增强版+Puppet的弱化版。使用Python编写。非常好用,快速可以基于EPEL部署。Salt 是一个开源的工具用来管理你的基础架构，可轻松管理成千上万台服务器。</p>
</blockquote>
<ul>
<li><a href="https://blog.cunss.com/?p=255" target="_blank" rel="external">saltstack指南</a></li>
<li><a href="https://docs.saltstack.com/en/getstarted/fundamentals/remotex.html" target="_blank" rel="external">salt官网入门基础</a></li>
<li><a href="http://setjs.com/?p=226" target="_blank" rel="external">salt使用总结</a></li>
<li><a href="http://www.saltstack.cn/kb/managing-firewall-with-salt/#managing-firewall-with-salt" target="_blank" rel="external">基于Salt管理iptables防火墙规则</a></li>
</ul>
<p><code>Django</code></p>
<ul>
<li><a href="http://www.ziqiangxuetang.com/django/django-intro.html" target="_blank" rel="external">基础教程</a></li>
</ul>
<h3 id="APP持续集成部署平台"><a href="#APP持续集成部署平台" class="headerlink" title="APP持续集成部署平台"></a>APP持续集成部署平台</h3><p><code>Jenkins</code></p>
<ul>
<li><a href="https://my.oschina.net/u/1242185/blog/323241?fromerr=YKc8u9du" target="_blank" rel="external">enkins安装配置</a></li>
<li><a href="https://hengyunabc.github.io/deploy-system-build-with-jenkins-ansible-supervisor/?spm=5176.blog6068.yqblogcon1.3.A6PSop" target="_blank" rel="external">jenkins 发布系统</a></li>
<li><a href="http://pkg.jenkins-ci.org/redhat/" target="_blank" rel="external">jenkins rpm 软件包</a></li>
<li><a href="https://www.jqlinux.com/archives/662" target="_blank" rel="external">jenkins简单使用</a></li>
<li><a href="http://www.cnblogs.com/mouseIT/p/5024718.html" target="_blank" rel="external">Jenkins将项目发送到tomcat</a></li>
<li><a href="https://wiki.jenkins-ci.org/display/JENKINS/Installing+Jenkins+on+Red+Hat+distributions" target="_blank" rel="external">centos7安装文档</a></li>
<li><a href="https://segmentfault.com/a/1190000004639325" target="_blank" rel="external">CentOS 安装 Jenkins</a></li>
</ul>
<h3 id="日志分析平台"><a href="#日志分析平台" class="headerlink" title="日志分析平台"></a>日志分析平台</h3><p><code>ELK</code> </p>
<p> <code>Logstash</code></p>
<blockquote>
<p>Logstash 是一个应用程序日志、事件的传输、处理、管理和搜索的平台。你可以用它来统一对应用程序日志进行收集管理，提供 Web 接口用于查询和统计。</p>
</blockquote>
<ul>
<li><a href="https://wsgzao.github.io/post/elk/" target="_blank" rel="external">ELK 搭建日志分析平台</a></li>
<li><a href="http://kibana.logstash.es/content/logstash/get_start/index.html" target="_blank" rel="external">ELK 中文执指南</a></li>
<li><a href="http://www.ttlsa.com/elk/elk-kibana-install-and-plugin-management/" target="_blank" rel="external">elk 插件管理</a></li>
<li><a href="http://www.sojson.com/blog/85" target="_blank" rel="external">elk 插件使用</a></li>
<li><a href="https://github.com/yangcvo/ELK_config" target="_blank" rel="external">elk 脚本</a></li>
</ul>
<p><code>Graylog</code></p>
<ul>
<li><a href="http://blog.topspeedsnail.com/archives/4066" target="_blank" rel="external">CentOS 7安装配置Graylog</a></li>
<li><a href="https://my.oschina.net/fitnessefan/blog/464351?utm_source=tuicool&amp;utm_medium=referral" target="_blank" rel="external">Graylog——日志聚合工具中的后起之秀</a></li>
<li><a href="http://docs.graylog.org/en/1.3/pages/extractors.html" target="_blank" rel="external">Graylog 入门到精通文档</a></li>
</ul>
<h3 id="开源监控，警告-amp-分析"><a href="#开源监控，警告-amp-分析" class="headerlink" title="开源监控，警告&amp;分析"></a>开源监控，警告&amp;分析</h3><p><code>zabbix</code></p>
<ul>
<li><a href="http://www.zabbix.net.cn/viewforum.php?f=13&amp;sid=2c1c952dbc2384612a1e22de916601b9" target="_blank" rel="external">zabbix学习论坛</a></li>
<li><a href="http://www.ttlsa.com/zabbix/follow-ttlsa-to-study-zabbix/" target="_blank" rel="external">zabbix入门</a></li>
<li><a href="http://dl528888.blog.51cto.com/2382721/1428561" target="_blank" rel="external">zabbix优化web事件打开速度</a></li>
<li><a href="http://canghai.coding.io/2015/07/29/monitoring-mysql-with-zabbix/" target="_blank" rel="external">zabbix监控MySQL</a></li>
<li><a href="https://share.zabbix.com/official-templates" target="_blank" rel="external">zabbix官方模块</a></li>
<li><a href="http://docs.grafana.org/v2.0/installation/" target="_blank" rel="external">grafana 二次开源安装</a></li>
<li><a href="https://github.com/alexanderzobnin/grafana-zabbix" target="_blank" rel="external">grafana-zabbix插件-官方网站</a></li>
<li><a href="http://play.grafana.org/" target="_blank" rel="external">grafana演示站点</a></li>
<li><a href="http://www.iyunv.com/thread-25966-1-1.html" target="_blank" rel="external">zabbix监控软件的使用排错</a></li>
<li><a href="http://www.zabbix.com/download.php" target="_blank" rel="external">zabbix软件包下载地址</a></li>
<li><a href="https://www.zabbix.com/documentation/3.0/manual/introduction/whatsnew300" target="_blank" rel="external">什么3.0.0的zabbix的新功能</a></li>
<li><a href="https://github.com/bushvin/zabbix-kvm-res" target="_blank" rel="external">通过ZABBIX KVM监控</a></li>
<li>个人github上面有整理比较详细的监控文档</li>
<li><a href="https://blog.cactifans.com/2015/07/24/monitoring-tomcat-with-zabbix/" target="_blank" rel="external">1. zabbix通过jmx监控tomcat</a></li>
<li><a href="http://www.cnblogs.com/Eivll0m/p/5446311.html" target="_blank" rel="external">2. zabbix通过jmx监控tomcat</a></li>
<li><a href="https://share.zabbix.com" target="_blank" rel="external">zabbix官网模板</a></li>
</ul>
<p><code>zabbix开源监控区别</code></p>
<ul>
<li><a href="http://www.sysopen.cn/20150524/" target="_blank" rel="external">Nagios、cacti、zabbix的对比？</a></li>
</ul>
<p><code>Nagios</code></p>
<blockquote>
<p>Nagios 是一个监视系统运行状态和网络信息的监视系统。Nagios能监视所指定的本地或远程主机以及服务，同时提供异常通知功能等。</p>
</blockquote>
<p><code>Ganglia</code></p>
<blockquote>
<p>Ganglia 是一个跨平台可扩展的，高 性能计算系统下的分布式监控系统，如集群和网格。它是基于分层设计，它使用广泛的技术，如XML数据代表，便携数据传输，RRDtool用于数据存储和可视化。</p>
</blockquote>
<p><code>Graphite</code></p>
<blockquote>
<p>Graphite 是一个用于采集网站实时信息并进行统计的开源项目，可用于采集多种网站服务运行状态信息。Graphite服务平均每分钟有4800次更新操作。</p>
</blockquote>
<p><code>Kibana</code></p>
<blockquote>
<p>Kibana 是一个为 Logstash 和 ElasticSearch 提供的日志分析的 Web 接口。可使用它对日志进行高效的搜索、可视化、分析等各种操作。</p>
</blockquote>
<h3 id="团队技术平台和项目管理平台-amp-测试平台"><a href="#团队技术平台和项目管理平台-amp-测试平台" class="headerlink" title="团队技术平台和项目管理平台&amp;测试平台"></a>团队技术平台和项目管理平台&amp;测试平台</h3><p><code>confluence团队项目协作平台</code></p>
<ul>
<li><a href="https://www.teambition.com" target="_blank" rel="external">teambition</a></li>
<li><a href="https://www.atlassian.com/software/confluence/" target="_blank" rel="external">confluence</a></li>
</ul>
<p><code>teambition 公司技术团队工作记录跟踪迭代平台</code></p>
<ul>
<li><a href="https://www.teambition.com" target="_blank" rel="external">teambition</a></li>
</ul>
<p><code>jira-敏捷项目管理工具</code></p>
<ul>
<li><a href="https://my.atlassian.com/products/index" target="_blank" rel="external">jira-敏捷项目管理工具</a></li>
</ul>
<p><code>创业公司禅道项目管理系统</code></p>
<ul>
<li><a href="http://www.zentao.net/download/79930.html" target="_blank" rel="external">禅道项目管理软件</a></li>
</ul>
<p><code>APP推广统计数据分析</code></p>
<ul>
<li><a href="www.talkingdata.com">talkingdata</a></li>
</ul>
<p><code>RAP是一个可视化接口管理工具 通过分析接口结构</code></p>
<ul>
<li><a href="http://rap.taobao.org/org/index.do" target="_blank" rel="external">RAP 接口管理工具</a></li>
</ul>
<h3 id="统一的账号管理认证平台"><a href="#统一的账号管理认证平台" class="headerlink" title="统一的账号管理认证平台"></a>统一的账号管理认证平台</h3><p><code>openLDAP</code></p>
<ul>
<li><a href="http://blog.csdn.net/hitabc141592/article/details/22931179" target="_blank" rel="external">openldap 部署1</a></li>
<li><a href="http://jianshi-dlw.iteye.com/blog/1557846" target="_blank" rel="external">openldap 部署2</a></li>
<li><a href="https://www.howtoforge.com/setting-up-an-openvpn-server-with-authentication-against-openldap-on-ubuntu-10.04-lts#-install-openvpn" target="_blank" rel="external">LDAP 认证</a></li>
<li><a href="http://wiki.yepn.net/lam" target="_blank" rel="external">Samba+LDAP+LAM管理工具应用</a></li>
<li><p><a href="http://blog.blackroom.cn/blog/2013/04/05/samba-web-modify-password/" target="_blank" rel="external">让Samba用户通过WEB页面修改密码</a></p>
<p><code>OpenLDAP + ProFTPD</code></p>
</li>
<li><p><a href="http://www.pudgecon.com/blog/2013/08/23/install-openldap-and-proftpd-on-ubuntu-12-dot-04/" target="_blank" rel="external">Install OpenLDAP and ProFTPD on Ubuntu 12.04</a></p>
</li>
</ul>
<h3 id="公司VPN"><a href="#公司VPN" class="headerlink" title="公司VPN"></a>公司VPN</h3><p><code>OpenVPN Server</code></p>
<ul>
<li><a href="http://heylinux.com/archives/3499.html" target="_blank" rel="external">CentOS 6上部署OpenVPN Server</a></li>
<li><a href="https://docs.ucloud.cn/software/vpn/OpenVPN4CentOS.html" target="_blank" rel="external">OpenVPN for CentOS</a></li>
<li><a href="https://www.unixmen.com/setup-openvpn-server-client-centos-6-5/" target="_blank" rel="external">centos 安装部署openvpn </a></li>
<li><p><a href="https://www.digitalocean.com/community/tutorials/how-to-setup-and-configure-an-openvpn-server-on-centos-6" target="_blank" rel="external">部署参考</a></p>
<ul>
<li>openVPN <a href="https://www.tunnelblick.net/" target="_blank" rel="external">Tunnelblick工具下载</a></li>
</ul>
</li>
</ul>
<h3 id="翻墙"><a href="#翻墙" class="headerlink" title="翻墙"></a>翻墙</h3><p><code>ssh隧道翻墙</code></p>
<ul>
<li><a href="http://www.cenhq.com/2015/12/18/ssh-tunnel-over-the-wall/" target="_blank" rel="external">ssh隧道翻墙</a></li>
</ul>
<h3 id="node-js-后台"><a href="#node-js-后台" class="headerlink" title="node.js 后台"></a>node.js 后台</h3><ul>
<li><a href="http://blog.csdn.net/nsrainbow/article/details/33740915" target="_blank" rel="external">如何卸载node.js</a> </li>
</ul>
<h3 id="海外代理服务器平台"><a href="#海外代理服务器平台" class="headerlink" title="海外代理服务器平台"></a>海外代理服务器平台</h3><p><code>服务器供应商</code></p>
<ul>
<li><a href="http://www.capitalonline.net/zh-cn/" target="_blank" rel="external">服务器</a></li>
</ul>
<h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><p><code>windows 防火墙</code></p>
<ul>
<li><a href="http://heylinux.com/archives/category/windows" target="_blank" rel="external">Windows Server 2008上的防火墙配置脚本</a></li>
</ul>
<p><code>Windows系统中文换英文</code></p>
<ul>
<li><a href="http://heylinux.com/archives/1667.html" target="_blank" rel="external">Windows 7中文旗舰版与英文版自由切换</a></li>
</ul>
<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><ul>
<li><a href="http://openstf.io/" target="_blank" rel="external">openstf</a></li>
<li><a href="http://www.open-open.com/lib/view/open1437967814581.html" target="_blank" rel="external">stf环境搭建</a></li>
<li><a href="https://www.sdk.cn/news/2794" target="_blank" rel="external">macaca 自动化测试</a></li>
<li><a href="https://xudafeng.github.io/slide/archives/macaca/#/" target="_blank" rel="external">移动时代的自动化</a></li>
</ul>
<h3 id="war包仓库"><a href="#war包仓库" class="headerlink" title="war包仓库"></a>war包仓库</h3><p><code>Maven私服nexus</code></p>
<ul>
<li><a href="http://www.cnblogs.com/dingyingsi/p/3776557.html" target="_blank" rel="external">Centos 基础开发环境搭建之Maven私服nexus</a></li>
</ul>
<h3 id="wkhtmltox-HTML效果转PDF格式"><a href="#wkhtmltox-HTML效果转PDF格式" class="headerlink" title="wkhtmltox-HTML效果转PDF格式"></a>wkhtmltox-HTML效果转PDF格式</h3><ul>
<li>参考我博客的wkhtmltox</li>
</ul>
<h3 id="博客"><a href="#博客" class="headerlink" title="博客"></a>博客</h3><p><code>Ghost</code></p>
<ul>
<li><a href="http://support.ghost.org/how-to-upgrade/" target="_blank" rel="external">官方-Ghost升级方法</a></li>
<li><a href="https://wiki.bitnami.com/Applications/BitNami_Ghost" target="_blank" rel="external">一键安装Ghost博客</a></li>
<li><a href="https://bitnami.com/stack/ghost/installer#linux" target="_blank" rel="external">bitnami 下载一键安装Ghost脚本包</a></li>
<li><a href="https://segmentfault.com/a/1190000002397419" target="_blank" rel="external">vps 安装 Ghost 博客系统记录</a></li>
<li><a href="http://www.open-open.com/news/view/144e24e" target="_blank" rel="external">15个免费的Ghost博客主题</a></li>
<li><a href="https://github.com/yangcvo/Ghost" target="_blank" rel="external">我自己整理的Ghost 20种博客主题</a></li>
<li><a href="http://www.ghostchina.com/" target="_blank" rel="external">Ghost中文官方版</a></li>
<li><a href="https://github.com/yangcvo/Ghost" target="_blank" rel="external">Ghost英文文档安装</a></li>
<li><a href="https://github.com/yangcvo/Ghost" target="_blank" rel="external">Ghost博客安装，使用，更新一条龙教程 - 中文版</a><br>在我github上面都有的，我安装的是7.0的。</li>
<li><a href="https://github.com/yangcvo/Ghost" target="_blank" rel="external">Ghost修改端口方法文档</a></li>
<li>Ghost20种主题主题包下载：<a href="https://github.com/yangcvo/Ghost/tree/master/Ghost-theme" target="_blank" rel="external">Ghost20种主题包</a></li>
<li><a href="https://www.bokeyy.com/post/ghost-install-in-vps-solution-in-china.html" target="_blank" rel="external">Ghost 博客安装中文全攻略</a></li>
<li><a href="http://docs.ghost.org/zh/themes/" target="_blank" rel="external">Ghost主题变更</a></li>
</ul>
<p><code>Wordpress</code></p>
<ul>
<li><a href="https://wordpress.org/showcase/" target="_blank" rel="external">官网</a></li>
<li><a href="https://cn.wordpress.org/" target="_blank" rel="external">中文官网WordPress</a> 访问有点慢。</li>
<li><a href="http://www.wpdaxue.com/tutorials/page/2" target="_blank" rel="external">非常有益的我是参考了建站网站有很详细说Wordpass</a></li>
<li><a href="http://www.wpdaxue.com/tutorials/page/2" target="_blank" rel="external">wordpass大学</a></li>
<li><a href="https://zh-cn.forums.wordpress.org/forum/plugins" target="_blank" rel="external">Wordpress下载插件-中文网站</a><br>非常好的一位博主很详细讲了WordPress的安装过程和主题更换，插件使用等等WordPress先生</li>
<li><a href="http://www.wpsir.cn/archives/tag/wordpress%E5%AE%89%E8%A3%85" target="_blank" rel="external">WordPress</a></li>
<li><a href="http://www.wpsir.cn/archives/768" target="_blank" rel="external">如何搭建WordPress博客?</a></li>
<li><a href="https://bbs.aliyun.com/read/259101.html?spm=5176.7189909.5.41.yW4V0H" target="_blank" rel="external">阿里云视频-如何在ECS上快递搭建一个WordPress站点</a></li>
<li><a href="http://www.wpdaxue.com/install-wordpress-theme-and-plugin.html" target="_blank" rel="external">WordPress入门 之 安装主题和插件</a></li>
</ul>
<p><code>hexo</code></p>
<p>这个是我现在的博客用的效果。</p>
<h3 id="网上书店-非常不错"><a href="#网上书店-非常不错" class="headerlink" title="网上书店-非常不错"></a>网上书店-非常不错</h3><ul>
<li><a href="https://www.packtpub.com/all" target="_blank" rel="external">packt</a></li>
</ul>
<h3 id="已学习视频"><a href="#已学习视频" class="headerlink" title="已学习视频"></a>已学习视频</h3><p><code>Linux</code></p>
<ul>
<li><a href="http://edu.51cto.com/course/course_id-549.html" target="_blank" rel="external">从0开始一步步实战深入学习Linux运维视频课程(三)</a>  2014-03-28 看完 –现在这需要付费，我当初看的时候免费的，给你们个链接 越过去：<a href="http://edu.51cto.com/lesson/id-11907.html" target="_blank" rel="external">http://edu.51cto.com/lesson/id-11907.html</a></li>
</ul>
<p><code>MySQL</code></p>
<ul>
<li><p><a href="https://ke.qq.com/course/134105" target="_blank" rel="external">企业Mysql实战系列入门篇</a> 2014年3月5日看完</p>
</li>
<li><p><a href="http://down.51cto.com/zt/535#0-sqq-1-75870-9737f6f9e09dfaf5d3fd14d775bfee85" target="_blank" rel="external">Mysql从入门到精通视频教程（共29集）</a>  2015年11月3日看完</p>
</li>
</ul>
<p>还有些网上分享的视频，存放在百度云。有数据库优化12篇视频。还有数据库架构</p>
<p><code>Docker</code></p>
<p><a href="https://ke.qq.com/user/tasks/index.html?cid=132963#tid=100148647&amp;fr=2" target="_blank" rel="external">实战企业Docker虚拟化系列</a>  2016年3月23日看完</p>
<p><code>Python</code></p>
<p><a href="https://ke.qq.com/course/139441" target="_blank" rel="external">学会Python编程基础篇</a>  2016-02-13 学完</p>
<p><code>监控</code></p>
<p><a href="http://edu.51cto.com/course/course_id-460.html" target="_blank" rel="external">企业级高级监控系统cacti+nagios【马哥linux视频课程】</a><br><a href="http://edu.51cto.com/course/course_id-6907.html" target="_blank" rel="external">Zabbix监控平台应用实战视频课程</a> 收费 需要可@我 2016-09-10 学完</p>
<h3 id="Ubuntu"><a href="#Ubuntu" class="headerlink" title="Ubuntu"></a>Ubuntu</h3><p><a href="http://www.lupaworld.com/article-221573.html" target="_blank" rel="external">Ubuntu上可使用的15个桌面环境</a> 很早就玩过了。</p>
<p><a href="http://mirrors.163.com/ubuntu-releases/14.04/" target="_blank" rel="external">Ubuntu iso镜像下载地址</a></p>
<h3 id="平面设计"><a href="#平面设计" class="headerlink" title="平面设计"></a>平面设计</h3><p><code>PS</code></p>
<ul>
<li><a href="http://wenku.baidu.com/course/view/994e6037ee06eff9aef8078d?cid=5" target="_blank" rel="external">Photoshop学习教程</a></li>
</ul>
<h6 id="陆续更新-（Update-time-：2016：12：11）"><a href="#陆续更新-（Update-time-：2016：12：11）" class="headerlink" title="@@ 陆续更新 ~~  （Update time ：2016：12：11）"></a>@@ 陆续更新 ~~  （Update time ：2016：12：11）</h6>
	

	

</article>




	<article>
	
		<h1><a href="/2016/03/10/自动化+Jenkins/Ansible/ansible 脚本(Playbook基本语法)远程控制/">Ansible 脚本(Playbook基本语法)远程控制</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-03-10</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/automation/">automation</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Ansible/">Ansible</a>
			</span>
		
	</div>

	

	
		<h1 id="ansible-脚本-Playbook基本语法-远程控制"><a href="#ansible-脚本-Playbook基本语法-远程控制" class="headerlink" title="ansible 脚本(Playbook基本语法)远程控制"></a>ansible 脚本(Playbook基本语法)远程控制</h1><p>Playbook基本语法</p>
<blockquote>
<p>本节列举了写第一个Playbook，你必须了解基本语法。<br>随着你面临的机器越多，配属的需求越复杂，你可能需要了解后面介绍的一些稍微复杂逻辑语句。</p>
</blockquote>
<ul>
<li>执行Playbook语法</li>
</ul>
<p>这里先</p>
<p>vim deploy.yml</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">deploy.yml文件</div><div class="line">---</div><div class="line">- hosts: tomcat_D1</div><div class="line">  vars:</div><div class="line">    http_port: 80</div><div class="line">    max_clients: 200</div><div class="line">  user: root</div><div class="line">  tasks:</div><div class="line">  - name: ensure apache is at the latest version</div><div class="line">    yum: name=httpd state=latest</div><div class="line">  - name: write the apache config file</div><div class="line">    template: src=/srv/httpd.j2 dest=/etc/httpd.conf</div><div class="line">    notify:</div><div class="line">    - restart apache</div><div class="line">  - name: start httpd </div><div class="line">    service: name=httpd state=started</div><div class="line">  handlers:</div><div class="line">    - name: restart apache</div><div class="line">      service: name=httpd state=restarted</div></pre></td></tr></table></figure>
<h4 id="执行Playbook语法"><a href="#执行Playbook语法" class="headerlink" title="执行Playbook语法"></a>执行Playbook语法</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ ansible-playbook deploy.yml</div></pre></td></tr></table></figure>
<p>查看输出的细节 1</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ansible-playbook playbook<span class="selector-class">.yml</span> --list-hosts</div></pre></td></tr></table></figure>
<p>查看该脚本影响哪些hosts</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ansible-playbook playbook<span class="selector-class">.yml</span> --list-hosts</div></pre></td></tr></table></figure>
<p>并行执行脚本</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ansible-playbook playbook<span class="selector-class">.yml</span> -f <span class="number">10</span></div></pre></td></tr></table></figure>
<h4 id="完整的playbook脚本示例"><a href="#完整的playbook脚本示例" class="headerlink" title="完整的playbook脚本示例"></a>完整的playbook脚本示例</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">最基本的playbook脚本分为三个部分:</div><div class="line">在什么机器上以什么身份执行</div><div class="line">hosts</div><div class="line">users</div><div class="line">...</div><div class="line">执行的任务是都有什么</div><div class="line">tasks</div><div class="line">善后的任务都有什么</div><div class="line">handlers</div></pre></td></tr></table></figure>
<p>这里我写了个tomcat发布，yml文件：<br>参考：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">- hosts: tomcat-system_01</div><div class="line">  environment:</div><div class="line">    LC_ALL: zh_CN.UTF-8</div><div class="line">    LANG : zh_CN.UTF-8</div><div class="line">  tasks:</div><div class="line">  - name  : cpfile-system</div><div class="line">    copy  : src=/root/.jenkins/workspace/yjk_master/haozhuo/haozhuo-system/target/haozhuo-system.war dest=/root/java_war/haozhuo-system.war</div><div class="line">  - name  : restart</div><div class="line">    shell : /root/update/system.sh</div><div class="line">    async : 0</div><div class="line">  - name  : shutdown</div><div class="line">    shell : /srv/tomcat/tomcat_system/bin/shutdown.sh</div><div class="line">    async : 0</div><div class="line">  - name  : start</div><div class="line">    shell : <span class="built_in">chdir</span>=/srv/tomcat/tomcat_system/bin nohup ./startup.sh &amp;</div><div class="line">    async : 0</div></pre></td></tr></table></figure>
<p>参考官网：<a href="https://ansible-book.gitbooks.io/ansible-first-book/content/playbookji_ben_yu_fa.html" target="_blank" rel="external">https://ansible-book.gitbooks.io/ansible-first-book/content/playbookji_ben_yu_fa.html</a></p>

	

	

</article>




	<article>
	
		<h1><a href="/2016/03/09/自动化+Jenkins/Ansible/ansible小结(五)常用模块/">Ansible小结 (五) 常用模块</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-03-09</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/automation/">automation</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Ansible/">Ansible</a>
			</span>
		
	</div>

	

	
		<h1 id="ansible命令总结使用："><a href="#ansible命令总结使用：" class="headerlink" title="ansible命令总结使用："></a>ansible命令总结使用：</h1><p>在上一篇中介绍了commands部分模块，本篇承接上篇介绍下常用的模块。根据官方的分类，将模块按功能分类为：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">云模块、命令模块、数据库模块、文件模块、资产模块、消息模块、监控模块、网络模块、通知模块、包管理模块、源码控制模块、系统模块、单元模块、web设施模块、windows模块</div></pre></td></tr></table></figure>
<p>具体可以参看<a href="http://docs.ansible.com/list_of_all_modules.html" target="_blank" rel="external">官方页面</a></p>
<p>这里从官方分类的模块里选择<code>最常用的一些模块</code>进行介绍（commands模块上一篇已经介绍，这里不再提）。</p>
<h3 id="一、ping模块"><a href="#一、ping模块" class="headerlink" title="一、ping模块"></a>一、ping模块</h3><h6 id="测试主机是否是通的，用法很简单，不涉及参数："><a href="#测试主机是否是通的，用法很简单，不涉及参数：" class="headerlink" title="测试主机是否是通的，用法很简单，不涉及参数："></a>测试主机是否是通的，用法很简单，不涉及参数：</h6><figure class="highlight autoit"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">ansible tomcat_B1 -m <span class="built_in">ping</span></div><div class="line"></div><div class="line">[root<span class="symbol">@ansible</span> ~]<span class="meta"># ansible tomcat_C1 -m ping</span></div><div class="line"><span class="number">192.168</span><span class="number">.1</span><span class="number">.177</span> | SUCCESS =&gt; &#123;</div><div class="line">    <span class="string">"changed"</span>: <span class="literal">false</span>,</div><div class="line">    <span class="string">"ping"</span>: <span class="string">"pong"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="二、setup模块"><a href="#二、setup模块" class="headerlink" title="二、setup模块"></a>二、setup模块</h3><p>setup模块，主要用于获取主机信息，在playbooks里经常会用到的一个参数<code>gather_facts</code>就与该模块相关。setup模块下经常使用的一个参数是filter参数，具体使用示例如下（由于输出结果较多，这里只列命令不写结果）：</p>
<h6 id="查看主机内存信息"><a href="#查看主机内存信息" class="headerlink" title="查看主机内存信息"></a>查看主机内存信息</h6><figure class="highlight autoit"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root<span class="symbol">@ansible</span> ~]<span class="meta"># ansible tomcat_C1 -m setup -a <span class="string">'filter=ansible_*_mb'</span></span></div></pre></td></tr></table></figure>
<h6 id="查看地接口为eth0-2的网卡信息"><a href="#查看地接口为eth0-2的网卡信息" class="headerlink" title="查看地接口为eth0-2的网卡信息"></a>查看地接口为eth0-2的网卡信息</h6><figure class="highlight autoit"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root<span class="symbol">@ansible</span> ~]<span class="meta"># ansible tomcat_C1 -m setup -a <span class="string">'filter=ansible_eth[0-2]'</span> </span></div><div class="line">[root<span class="symbol">@ansible</span> ~]<span class="meta"># ansible all -m setup --tree /tmp/facts</span></div></pre></td></tr></table></figure>
<p>  //将所有主机的信息输入到/tmp/facts目录下，每台主机的信息输入到主机名文件中（/etc/ansible/hosts里的主机名）</p>
<h3 id="三、file模块"><a href="#三、file模块" class="headerlink" title="三、file模块"></a>三、file模块</h3><p>file模块主要用于远程主机上的文件操作，file模块包含如下选项： </p>
<ul>
<li>force：需要在两种情况下强制创建软链接，一种是源文件不存在但之后会建立的情况下；另一种是目标软链接已存在,需要先取消之前的软链，然后创建新的软链，有两个选项：yes|no </li>
<li>group：定义文件/目录的属组 </li>
<li>mode：定义文件/目录的权限</li>
<li>owner：定义文件/目录的属主</li>
<li>path：必选项，定义文件/目录的路径</li>
<li>recurse：递归的设置文件的属性，只对目录有效</li>
<li>src：要被链接的源文件的路径，只应用于state=link的情况</li>
<li>dest：被链接到的路径，只应用于state=link的情况 </li>
<li>state：  directory：如果目录不存在，创建目录</li>
<li>file：即使文件不存在，也不会被创建</li>
<li>link：创建软链接</li>
<li>hard：创建硬链接</li>
<li>touch：如果文件不存在，则会创建一个新的文件，如果文件或目录已存在，则更新其最后修改时间</li>
<li>absent：删除目录、文件或者取消链接文件<br>使用示例：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ansible <span class="built_in">test</span> -m file <span class="_">-a</span> <span class="string">"src=/etc/fstab dest=/tmp/fstab state=link"</span></div><div class="line">ansible <span class="built_in">test</span> -m file <span class="_">-a</span> <span class="string">"path=/tmp/fstab state=absent"</span></div><div class="line">ansible <span class="built_in">test</span> -m file <span class="_">-a</span> <span class="string">"path=/tmp/test state=touch"</span></div><div class="line">ansible <span class="built_in">test</span> -m file <span class="_">-a</span> <span class="string">"path=/tmp/test state=directory"</span> ansible <span class="built_in">test</span> -m file <span class="_">-a</span> <span class="string">"path=/tmp/testd state=directory owner=root group=root mode=777"</span></div></pre></td></tr></table></figure>
<h3 id="四、copy模块"><a href="#四、copy模块" class="headerlink" title="四、copy模块"></a>四、copy模块</h3><h5 id="复制文件到远程主机，copy模块包含如下选项："><a href="#复制文件到远程主机，copy模块包含如下选项：" class="headerlink" title="复制文件到远程主机，copy模块包含如下选项："></a>复制文件到远程主机，copy模块包含如下选项：</h5><ul>
<li><code>backup</code>：在覆盖之前将原文件备份，备份文件包含时间信息。有两个选项：yes|no </li>
<li><code>content</code>：用于替代”src”,可以直接设定指定文件的值 </li>
<li><code>dest</code>：必选项。要将源文件复制到的远程主机的绝对路径，如果源文件是一个目录，那么该路径也必须是个目录 </li>
<li><code>directory_mode</code>：递归的设定目录的权限，默认为系统默认权限</li>
<li><code>force</code>：如果目标主机包含该文件，但内容不同，如果设置为yes，则强制覆盖，如果为no，则只有当目标主机的目标位置不存在该文件时，才复制。默认为yes</li>
<li><code>others</code>：所有的file模块里的选项都可以在这里使用</li>
<li><code>src</code>：要复制到远程主机的文件在本地的地址，可以是绝对路径，也可以是相对路径。如果路径是一个目录，它将递归复制。在这种情况下，如果路径使用”/“来结尾，则只复制目录里的内容，如果没有使用”/“来结尾，则包含目录在内的整个内容全部复制，类似于rsync。 </li>
<li><code>validate</code>：The validation command to run before copying into place. The path to the file to validate is passed in via ‘%s’ which must be present as in the visudo example below.</li>
</ul>
<p>示例如下：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ansible test -m <span class="keyword">copy</span><span class="bash"> <span class="_">-a</span> <span class="string">"src=/srv/myfiles/foo.conf dest=/etc/foo.conf owner=foo group=foo mode=0644"</span></span></div><div class="line">ansible test -m <span class="keyword">copy</span><span class="bash"> <span class="_">-a</span> <span class="string">"src=/mine/ntp.conf dest=/etc/ntp.conf owner=root group=root mode=644 backup=yes"</span></span></div><div class="line">ansible test -m <span class="keyword">copy</span><span class="bash"> <span class="_">-a</span> <span class="string">"src=/mine/sudoers dest=/etc/sudoers validate='visudo -cf %s'"</span></span></div></pre></td></tr></table></figure>
<p>这里在举个例子：</p>
<p>目的：把主控端/opt/目录下面logstash.tar.gz文件拷贝到到指定节点上/srv/下面<br>    命令：<code>ansible cluster1:children -m copy -a &quot;src=/opt/logstash.tar.gz dest=/srv/. owner=root group=root mode=644&quot;</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">root@salt ~]<span class="comment"># ansible cluster1:children -m copy -a "src=/opt/logstash.tar.gz dest=/srv/. 10.47.59.190 | SUCCESS =&gt; &#123;</span></div><div class="line">    <span class="string">"changed"</span>: <span class="literal">true</span>,</div><div class="line">    <span class="string">"checksum"</span>: <span class="string">"9d15ea324f39d08cb379f59ffee9fa7ad2a62ab8"</span>,</div><div class="line">    <span class="string">"dest"</span>: <span class="string">"/srv/./logstash.tar.gz"</span>,</div><div class="line">    <span class="string">"gid"</span>: 0,</div><div class="line">    <span class="string">"group"</span>: <span class="string">"root"</span>,</div><div class="line">    <span class="string">"md5sum"</span>: <span class="string">"c151602e79a336ca363928dea68d2567"</span>,</div><div class="line">    <span class="string">"mode"</span>: <span class="string">"0644"</span>,</div><div class="line">    <span class="string">"owner"</span>: <span class="string">"root"</span>,</div><div class="line">    <span class="string">"size"</span>: 84431108,</div><div class="line">    <span class="string">"src"</span>: <span class="string">"/root/.ansible/tmp/ansible-tmp-1483939085.93-201327709717575/source"</span>,</div><div class="line">    <span class="string">"state"</span>: <span class="string">"file"</span>,</div><div class="line">    <span class="string">"uid"</span>: 0</div><div class="line">&#125;</div><div class="line">10.47.106.105 | SUCCESS =&gt; &#123;</div><div class="line">    <span class="string">"changed"</span>: <span class="literal">true</span>,</div><div class="line">    <span class="string">"checksum"</span>: <span class="string">"9d15ea324f39d08cb379f59ffee9fa7ad2a62ab8"</span>,</div><div class="line">    <span class="string">"dest"</span>: <span class="string">"/srv/./logstash.tar.gz"</span>,</div><div class="line">    <span class="string">"gid"</span>: 0,</div><div class="line">    <span class="string">"group"</span>: <span class="string">"root"</span>,</div><div class="line">    <span class="string">"md5sum"</span>: <span class="string">"c151602e79a336ca363928dea68d2567"</span>,</div><div class="line">    <span class="string">"mode"</span>: <span class="string">"0644"</span>,</div><div class="line">    <span class="string">"owner"</span>: <span class="string">"root"</span>,</div><div class="line">    <span class="string">"size"</span>: 84431108,</div><div class="line">    <span class="string">"src"</span>: <span class="string">"/root/.ansible/tmp/ansible-tmp-1483939088.11-46151538408374/source"</span>,</div><div class="line">    <span class="string">"state"</span>: <span class="string">"file"</span>,</div><div class="line">    <span class="string">"uid"</span>: 0</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="批量控制解压文件"><a href="#批量控制解压文件" class="headerlink" title="批量控制解压文件"></a>批量控制解压文件</h4><p>批量解压命令：</p>
<p><code>ansible cluster1:children -m shell -a  &quot;tar -zxvf /srv/logstash.tar.gz&quot; -C /srv/.</code></p>
<h3 id="五、yum模块"><a href="#五、yum模块" class="headerlink" title="五、yum模块"></a>五、yum模块</h3><h5 id="yum安装使用："><a href="#yum安装使用：" class="headerlink" title="yum安装使用："></a>yum安装使用：</h5><p>使用yum包管理器来管理软件包，其选项有： </p>
<ul>
<li>config_file：yum的配置文件 </li>
<li>disable_gpg_check：关闭gpg_check </li>
<li>disablerepo：不启用某个源 </li>
<li>enablerepo：启用某个源</li>
<li>name：要进行操作的软件包的名字，也可以传递一个url或者一个本地的rpm包的路径<br>state：状态（present，absent，latest）</li>
</ul>
<p>示例如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ansible tomcat_D1 <span class="_">-s</span> -m yum <span class="_">-a</span> <span class="string">"name=wget state=latest"</span></div></pre></td></tr></table></figure>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/ansible_02.png" alt=""></figure></p>
<figure class="highlight prolog"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">[root@ansible playbook]# ansible tomcat_D1 -s -<span class="symbol">C</span> -m yum -a <span class="string">"name=kernel state=latest"</span></div><div class="line"><span class="number">192.168</span><span class="number">.1</span><span class="number">.178</span> | <span class="symbol">SUCCESS</span> =&gt; &#123;</div><div class="line">    <span class="string">"changed"</span>: true,</div><div class="line">    <span class="string">"changes"</span>: &#123;</div><div class="line">        <span class="string">"installed"</span>: [],</div><div class="line">        <span class="string">"updated"</span>: [</div><div class="line">            [</div><div class="line">                <span class="string">"kernel"</span>,</div><div class="line">                <span class="string">"2.6.32-642.4.2.el6.x86_64 from updates"</span></div><div class="line">            ]</div><div class="line">        ]</div><div class="line">    &#125;,</div><div class="line">    <span class="string">"msg"</span>: <span class="string">""</span>,</div><div class="line">    <span class="string">"rc"</span>: <span class="number">0</span>,</div><div class="line">    <span class="string">"results"</span>: []</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="六-service模块"><a href="#六-service模块" class="headerlink" title="六 service模块"></a>六 service模块</h3><p>用于管理服务 该模块包含如下选项：</p>
<ul>
<li>arguments：给命令行提供一些选项 </li>
<li>enabled：是否开机启动 yes|no name：必选项，服务名称</li>
<li>pattern：定义一个模式，如果通过status指令来查看服务的状态时，没有响应，就会通过ps指令在进程中根据该模式进行查找，如果匹配到，则认为该服务依然在运行</li>
<li>runlevel：运行级别 </li>
<li>sleep：如果执行了restarted，在则stop和start之间沉睡几秒钟 </li>
<li>state：对当前服务执行启动，停止、重启、重新加载等操作（started,stopped,restarted,reloaded） </li>
</ul>
<p>示例如下：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ansible test -m service -<span class="selector-tag">a</span> <span class="string">"name=httpd state=started enabled=yes"</span> </div><div class="line">ansible test -m service -<span class="selector-tag">a</span> <span class="string">"name=foo pattern=/usr/bin/foo state=started"</span> </div><div class="line">ansible test -m service -<span class="selector-tag">a</span> <span class="string">"name=network state=restarted args=eth0"</span></div><div class="line">ansible cluster2:children -m service -<span class="selector-tag">a</span> <span class="string">"name=logstash pattern=/etc/init.d/logstash state=started"</span></div></pre></td></tr></table></figure>
<p>参考：<a href="http://www.361way.com/ansible-modules/4415.html" target="_blank" rel="external">http://www.361way.com/ansible-modules/4415.html</a></p>
<h3 id="七-shell-模块"><a href="#七-shell-模块" class="headerlink" title="七 shell 模块"></a>七 shell 模块</h3><p>这里我写个例子：</p>
<p>批量更改组的机器的用户名密码。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">[root@salt ansible]<span class="comment"># ansible cluster1:children -m shell -a "echo "Ihaozhuo" | passwd --stdin "root" "</span></div><div class="line">10.43.59.190 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">更改用户 root 的密码 。</div><div class="line">passwd： 所有的身份验证令牌已经成功更新。</div><div class="line"></div><div class="line">10.23.2.106 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">更改用户 root 的密码 。</div><div class="line">passwd： 所有的身份验证令牌已经成功更新。</div><div class="line"></div><div class="line">10.23.232.85 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">更改用户 root 的密码 。</div><div class="line">passwd： 所有的身份验证令牌已经成功更新。</div><div class="line"></div><div class="line">10.23.232.131 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">更改用户 root 的密码 。</div><div class="line">passwd： 所有的身份验证令牌已经成功更新。</div></pre></td></tr></table></figure>
<p>查看分组上机器所有端口：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">[root@salt ansible]<span class="comment"># ansible zk1:children -m shell -a "netstat -ntulp"</span></div><div class="line">10.37.238.75 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">Active Internet connections (only servers)</div><div class="line">Proto Recv-Q Send-Q Local Address               Foreign Address             State       PID/Program name</div><div class="line">tcp        0      0 0.0.0.0:2181                0.0.0.0:*                   LISTEN      12497/java</div><div class="line">tcp        0      0 0.0.0.0:56521               0.0.0.0:*                   LISTEN      12497/java</div><div class="line">tcp        0      0 0.0.0.0:22                  0.0.0.0:*                   LISTEN      1251/sshd</div><div class="line">tcp        0      0 0.0.0.0:4888                0.0.0.0:*                   LISTEN      12497/java</div><div class="line">tcp        0      0 127.0.0.1:15770             0.0.0.0:*                   LISTEN      1434/aegis_quartz</div><div class="line">udp        0      0 118.178.240.129:123         0.0.0.0:*                               1262/ntpd</div><div class="line">udp        0      0 10.27.238.75:123            0.0.0.0:*                               1262/ntpd</div><div class="line">udp        0      0 127.0.0.1:123               0.0.0.0:*                               1262/ntpd</div><div class="line">udp        0      0 0.0.0.0:123                 0.0.0.0:*                               1262/ntpd</div><div class="line"></div><div class="line">10.37.100.200 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">Active Internet connections (only servers)</div><div class="line">Proto Recv-Q Send-Q Local Address               Foreign Address             State       PID/Program name</div><div class="line">tcp        0      0 0.0.0.0:58367               0.0.0.0:*                   LISTEN      11232/java</div><div class="line">tcp        0      0 10.47.100.200:10050         0.0.0.0:*                   LISTEN      646/zabbix_agentd</div><div class="line">tcp        0      0 0.0.0.0:2181                0.0.0.0:*                   LISTEN      11232/java</div><div class="line">tcp        0      0 0.0.0.0:22                  0.0.0.0:*                   LISTEN      1243/sshd</div><div class="line">tcp        0      0 0.0.0.0:4888                0.0.0.0:*                   LISTEN      11232/java</div><div class="line">tcp        0      0 127.0.0.1:15770             0.0.0.0:*                   LISTEN      1436/aegis_quartz</div><div class="line">udp        0      0 120.27.152.77:123           0.0.0.0:*                               1254/ntpd</div><div class="line">udp        0      0 10.47.100.200:123           0.0.0.0:*                               1254/ntpd</div><div class="line">udp        0      0 127.0.0.1:123               0.0.0.0:*                               1254/ntpd</div><div class="line">udp        0      0 0.0.0.0:123                 0.0.0.0:*                               1254/ntpd</div></pre></td></tr></table></figure>
<p>shell 模块 可以用的最多。查看目录执行文件等等。</p>
<p>ansible修改线上服务器上的密码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">ansible cluster1:children -m shell <span class="_">-a</span> <span class="string">"echo "</span>Ihaozhuo_b3314<span class="string">" | passwd --stdin "</span>root<span class="string">" "</span></div><div class="line"></div><div class="line">ansible cluster2:children -m shell <span class="_">-a</span> <span class="string">"echo "</span>Ihaozhuo_b3314<span class="string">" | passwd --stdin "</span>root<span class="string">" "</span></div><div class="line"></div><div class="line">ansible cluster3:children -m shell <span class="_">-a</span> <span class="string">"echo "</span>Ihaozhuo_b3314<span class="string">" | passwd --stdin "</span>root<span class="string">" "</span></div><div class="line"></div><div class="line">ansible zk1:children -m shell <span class="_">-a</span> <span class="string">"echo "</span>Ihaozhuo_b3314<span class="string">" | passwd --stdin "</span>root<span class="string">" "</span></div><div class="line"></div><div class="line">ansible  kafka1:children -m shell <span class="_">-a</span> <span class="string">"echo "</span>Ihaozhuo_b3314<span class="string">" | passwd --stdin "</span>root<span class="string">" "</span></div><div class="line"></div><div class="line">ansible  es1:children -m shell <span class="_">-a</span> <span class="string">"echo "</span>Ihaozhuo_b3314<span class="string">" | passwd --stdin "</span>root<span class="string">" "</span></div><div class="line"></div><div class="line">ansible  ihaozhuo1:children -m shell <span class="_">-a</span> <span class="string">"echo "</span>Ihaozhuo_b3314<span class="string">" | passwd --stdin "</span>root<span class="string">" "</span></div><div class="line"></div><div class="line">ansible  monitor1:children -m shell <span class="_">-a</span> <span class="string">"echo "</span>Ihaozhuo_b3314<span class="string">" | passwd --stdin "</span>root<span class="string">" "</span></div></pre></td></tr></table></figure>
<h2 id="2、Ansible-总结举例常用模块学习"><a href="#2、Ansible-总结举例常用模块学习" class="headerlink" title="2、Ansible 总结举例常用模块学习"></a>2、Ansible 总结举例常用模块学习</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">shell &gt; ansible-doc <span class="_">-l</span>    <span class="comment"># 列出 Ansible 支持的模块</span></div><div class="line">shell &gt; ansible-doc ping  <span class="comment"># 查看该模块帮助信息</span></div></pre></td></tr></table></figure>
<blockquote>
<p>远程命令模块（ command / raw / script / shell ）</p>
</blockquote>
<p>command 作为 Ansible 的默认模块，可以运行远程权限范围所有的 shell 命令，不支持管道符。</p>
<p>例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">shell &gt; ansible Client -m <span class="built_in">command</span> <span class="_">-a</span> <span class="string">"free -m"</span>               <span class="comment"># 查看 Client 分组主机内存使用情况</span></div></pre></td></tr></table></figure>
<p>raw模块 [类似于command模块、支持管道传递]</p>
<p>例：</p>
<figure class="highlight nsis"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ansible Client -m raw -a <span class="string">"ifconfig eth0 |sed -n 2p |awk '&#123;print \<span class="variable">$2</span>&#125;' |awk -F: '&#123;print \<span class="variable">$2</span>&#125;'"</span></div></pre></td></tr></table></figure>
<p>script 的功能是在远程主机执行主控端存储的 shell 脚本文件，相当于 scp + shell 组合。</p>
<p>例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">shell &gt; ansible Client -m script <span class="_">-a</span> <span class="string">"/home/test.sh 12 34"</span>    <span class="comment"># 远程执行本地脚本</span></div></pre></td></tr></table></figure>
<p>shell 的功能是执行远程主机上的 shell 脚本文件，支持管道符。</p>
<p>例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">shell &gt; ansible Client -m shell <span class="_">-a</span> <span class="string">"/home/test.sh"</span>           <span class="comment"># 执行远程脚本</span></div></pre></td></tr></table></figure>
<blockquote>
<p>copy 模块（实现主控端向目标主机拷贝文件，类似于 scp 功能）</p>
</blockquote>
<p>例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">shell &gt; ansible Client -m copy <span class="_">-a</span> <span class="string">"src=/home/test.sh desc=/tmp/ owner=root group=root mode=0755"</span>   </div><div class="line"><span class="comment"># 向 Client 组中主机拷贝 test.sh 到 /tmp 下，属主、组为 root ，权限为 0755</span></div></pre></td></tr></table></figure>
<blockquote>
<p>stat 模块（获取远程文件状态信息，atime/ctime/mtime/md5/uid/gid 等信息）</p>
</blockquote>
<p>例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">shell &gt; ansible Client -m <span class="built_in">stat</span> <span class="_">-a</span> <span class="string">"path=/etc/syctl.conf"</span></div></pre></td></tr></table></figure>
<blockquote>
<p>get_url 模块（实现在远程主机下载指定 URL 到本地，支持 sha256sum 文件校验）</p>
</blockquote>
<p>例：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">shell</span><span class="bash"> &gt; ansible Client -m get_utl <span class="_">-a</span> <span class="string">"url=http://www.baidu.com dest=/tmp/index.html mode=0440 force=yes"</span></span></div></pre></td></tr></table></figure>
<blockquote>
<p>yum 模块（软件包管理）</p>
</blockquote>
<p>例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">shell &gt; ansible Client -m yum <span class="_">-a</span> <span class="string">"name=curl state=latest"</span></div></pre></td></tr></table></figure>
<blockquote>
<p>cron 模块（远程主机 crontab 配置）</p>
</blockquote>
<p>例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">shell &gt; ansible Client -m cron <span class="_">-a</span> <span class="string">"name='check dirs' hour='5,2' job='ls -alh &gt; /dev/null'"</span></div><div class="line"></div><div class="line">效果：</div><div class="line"></div><div class="line"><span class="comment"># Ansible: check dirs</span></div><div class="line">* 5,2 * * * ls -alh &gt; /dev/null</div></pre></td></tr></table></figure>
<blockquote>
<p>mount 模块（远程主机分区挂载）</p>
</blockquote>
<p>例：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">shell</span><span class="bash"> &gt; ansible Client -m mount <span class="_">-a</span> <span class="string">"name=/mnt/data src=/dev/sd0 fstype=ext4 opts=ro state=present"</span></span></div></pre></td></tr></table></figure>
<blockquote>
<p>service 模块（远程主机系统服务管理）</p>
</blockquote>
<p>例：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">shell</span><span class="bash"> &gt; ansible Client -m service <span class="_">-a</span> <span class="string">"name=nginx state=stoped"</span></span></div><div class="line"><span class="keyword">shell</span><span class="bash"> &gt; ansible Client -m service <span class="_">-a</span> <span class="string">"name=nginx state=restarted"</span></span></div><div class="line"><span class="keyword">shell</span><span class="bash"> &gt; ansible Client -m service <span class="_">-a</span> <span class="string">"name=nginx state=reloaded"</span></span></div></pre></td></tr></table></figure>
<blockquote>
<p>user 服务模块（远程主机用户管理）</p>
</blockquote>
<p>例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">shell &gt; ansible Client -m user <span class="_">-a</span> <span class="string">"name=wang comment='user wang'"</span></div><div class="line">shell &gt; ansible Client -m user <span class="_">-a</span> <span class="string">"name=wang state=absent remove=yes"</span>    <span class="comment"># 添加删除用户</span></div></pre></td></tr></table></figure>

	

	

</article>




	<article>
	
		<h1><a href="/2016/03/09/自动化+Jenkins/Ansible/Ansible小结（四）Ad-hoc与commands模块 /">Ansible小结（四）Ad-hoc与commands模块</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-03-09</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/automation/">automation</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Ansible/">Ansible</a>
			</span>
		
	</div>

	

	
		<h1 id="ansible小结（四）Ad-hoc与commands模块"><a href="#ansible小结（四）Ad-hoc与commands模块" class="headerlink" title="ansible小结（四）Ad-hoc与commands模块"></a>ansible小结（四）Ad-hoc与commands模块</h1><p>Ad-Hoc 是指ansible下临时执行的一条命令，并且不需要保存的命令，对于复杂的命令后面会说playbook。讲到Ad-hoc 就要提到模块，所有的命令执行都要依赖于事先写好的模块，默认安装好的ansible 里面已经自带了很多模块，如：command、raw、shell、file、cron等，具体可以通过ansible-doc -l 进行查看 。</p>
<h3 id="1、Ad-hoc"><a href="#1、Ad-hoc" class="headerlink" title="1、Ad-hoc"></a>1、Ad-hoc</h3><p>1、直接执行</p>
<p>这里还是先来一个上几篇幅经常用到的一个例子：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># ansible tomcat_C1 -a "uptime" -k</span></div><div class="line">SSH <span class="symbol">password:</span></div><div class="line"><span class="meta">192.168.1.177 | SUCCESS | rc=0 &gt;</span>&gt;</div><div class="line"> <span class="number">10</span><span class="symbol">:</span><span class="number">37</span><span class="symbol">:</span><span class="number">10</span> up <span class="number">24</span> days, <span class="number">16</span><span class="symbol">:</span><span class="number">48</span>,  <span class="number">4</span> users,  load <span class="symbol">average:</span> <span class="number">0</span>.<span class="number">00</span>, <span class="number">0</span>.<span class="number">00</span>, <span class="number">0</span>.<span class="number">00</span></div></pre></td></tr></table></figure>
<p>一个ad-hoc命令的执行，需要按以下格式进行执行：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ansible 主机或组  -m 模块名 -<span class="selector-tag">a</span> <span class="string">'模块参数'</span>  ansible参数</div></pre></td></tr></table></figure>
<p><strong>主机和组，是在/etc/ansible/hosts 里进行指定的部分，当然动态Inventory 使用的是脚本从外部应用里获取的主机.</strong></p>
<ul>
<li><p>模块名，可以通过<code>ansible-doc -l</code>查看目前安装的模块，默认不指定时，使用的是command模块，具体可以查看<code>/etc/ansible/ansible.cfg</code> 的<code>“#module_name = command ”</code> 部分，默认模块可以在该配置文件中进行修改；</p>
</li>
<li><p>模块参数，可以通过 <code>“ansible-doc</code> 模块名” 查看具体的用法及后面的参数；</p>
</li>
<li><p>ansible参数，可以通过ansible命令的帮忙信息里查看到，这里有很多参数可以供选择，如是否需要输入密码、是否sudo等。</p>
</li>
</ul>
<h4 id="2、后台执行例子"><a href="#2、后台执行例子" class="headerlink" title="2、后台执行例子"></a>2、后台执行例子</h4><p>当命令执行时间比较长时，也可以放到后台执行，这里会用到-B、-P参数，如下：</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ansible all -B <span class="number">3600</span> -a <span class="string">"/usr/bin/long_running_operation --do-stuff"</span> \\后台执行命令 <span class="number">3600</span>s，-B 表示后台执行的时间</div><div class="line">ansible all -m async_status -a <span class="string">"jid=123456789"</span>  \\检查任务的状态</div><div class="line">ansible all -B <span class="number">1800</span> -P <span class="number">60</span> -a <span class="string">"/usr/bin/long_running_operation --do-stuff"</span> \\后台执行命令最大时间是 <span class="number">1800</span>s 即 <span class="number">30</span> 分钟，-P 每 <span class="number">60</span>s 检查下状态默认 <span class="number">15</span>s</div></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># ansible  -B 60 -P 1  tomcat_B1 -a  "uptime"</span></div><div class="line"><span class="meta">192.168.1.176 | SUCCESS | rc=0 &gt;</span>&gt;</div><div class="line"> <span class="number">11</span><span class="symbol">:</span><span class="number">23</span><span class="symbol">:</span><span class="number">00</span> up <span class="number">24</span> days, <span class="number">17</span><span class="symbol">:</span><span class="number">34</span>,  <span class="number">1</span> user,  load <span class="symbol">average:</span> <span class="number">0</span>.<span class="number">00</span>, <span class="number">0</span>.<span class="number">00</span>, <span class="number">0</span>.<span class="number">00</span></div></pre></td></tr></table></figure>
<h2 id="二、commands模块"><a href="#二、commands模块" class="headerlink" title="二、commands模块"></a>二、commands模块</h2><p>上面已经提到，ansbile自身已经自带了很多模块，可以通过ansible-doc -l 进行查看。这里就结合<code>command、shell、raw、script</code>模块了解下其用法。</p>
<p>上面四个模块都属于commands 类。</p>
<ul>
<li><code>command</code>模块，该模块通过<code>-a</code>跟上要执行的命令可以直接执行，不过命令里如果有带有如下字符部分则执行不成功 “ so variables like $HOME and operations like “&lt;”, “&gt;”, “|”, and “&amp;” will not work (use the shell module if you need these features).”；**</li>
<li><code>shell</code>模块，用法其本和<code>command</code>一样，不过的是其是通过/bin/sh进行执行，所以shell 模块可以执行任何命令，就像在本机执行一样，“ It is almost exactly like the command module but runs the command through a shell (/bin/sh) on the remote node.”；</li>
<li><code>raw</code>模块，用法和shell 模块一样 ，其也可以执行任意命令，就像在本机执行一样，“Executes a low-down and dirty SSH command, not going through the module subsystem. There is no change handler support for this module. This module does not require python on the remote system”</li>
<li><code>script</code>模块，其是将管理端的shell 在被管理主机上执行，其原理是先将shell 复制到远程主机，再在远程主机上执行，原理类似于raw模块，“This module does not require python on the remote system, much like the raw module.” 。</li>
</ul>
<blockquote>
<p>注：raw模块和comand、shell 模块不同的是其没有chdir、creates、removes参数，chdir参数的作用就是先切到chdir指定的目录后，再执行后面的命令，这在后面很多模块里都会有该参数 。</p>
</blockquote>
<p>###command模块包含如下选项： </p>
<ul>
<li>creates：一个文件名，当该文件存在，则该命令不执行 </li>
<li>free_form：要执行的linux指令 </li>
<li>chdir：在执行指令之前，先切换到该指定的目录 </li>
<li>removes：一个文件名，当该文件不存在，则该选项不执行</li>
<li>executable：切换shell来执行指令，该执行路径必须是一个绝对路径</li>
</ul>
<p><strong>command模块、raw模块、shell模块示例：</strong></p>
<h4 id="command例子："><a href="#command例子：" class="headerlink" title="command例子："></a>command例子：</h4><figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># ansible tomcat_B1 -m command -a "ps -ef|grep tomcat"</span></div><div class="line"><span class="number">192.168</span><span class="number">.1</span><span class="number">.176</span> | FAILED | rc=<span class="number">1</span> &gt;&gt;</div><div class="line">ERROR: Unsupported SysV option.</div><div class="line">********* simple selection *********  ********* selection <span class="keyword">by</span> <span class="built_in">list</span> *********</div><div class="line">-A all processes                      -C <span class="keyword">by</span> command <span class="built_in">name</span></div><div class="line">-N negate selection                   -G <span class="keyword">by</span> <span class="built_in">real</span> group ID (supports names)</div><div class="line">-a all w/ tty except session leaders  -U <span class="keyword">by</span> <span class="built_in">real</span> user ID (supports names)</div><div class="line">-d all except session leaders         -g <span class="keyword">by</span> session OR <span class="keyword">by</span> effective group <span class="built_in">name</span></div><div class="line">-e all processes                      -p <span class="keyword">by</span> process ID</div><div class="line">                                      -q <span class="keyword">by</span> process ID (unsorted &amp; quick)</div><div class="line">T  all processes <span class="keyword">on</span> this terminal     -s processes <span class="keyword">in</span> <span class="keyword">the</span> sessions <span class="keyword">given</span></div><div class="line">a  all w/ tty, including other users  -t <span class="keyword">by</span> tty</div><div class="line">g  OBSOLETE <span class="comment">-- DO NOT USE             -u by effective user ID (supports names)</span></div><div class="line">r  only <span class="built_in">running</span> processes             U  processes <span class="keyword">for</span> specified users</div><div class="line">x  processes w/o controlling ttys     t  <span class="keyword">by</span> tty</div><div class="line">*********** output format **********  *********** long options ***********</div><div class="line">-o,o user-defined  -f full            <span class="comment">--Group --User --pid --cols --ppid</span></div><div class="line">-j,j job control   s  signal          <span class="comment">--group --user --sid --rows --info</span></div><div class="line">-O,O preloaded -o  v  virtual memory  <span class="comment">--cumulative --format --deselect</span></div><div class="line">-l,l long          u  user-oriented   <span class="comment">--sort --tty --forest --version</span></div><div class="line">-F   extra full    X  registers       <span class="comment">--heading --no-heading --context</span></div><div class="line">                                      <span class="comment">--quick-pid</span></div><div class="line">                    ********* misc options *********</div><div class="line">-V,V  show <span class="built_in">version</span>      L  <span class="built_in">list</span> format codes  f  ASCII art forest</div><div class="line">-m,m,-L,-T,H  threads   S  children <span class="keyword">in</span> sum    -y change -l format</div><div class="line">-M,Z  security data     c  <span class="literal">true</span> command <span class="built_in">name</span>  -c scheduling <span class="built_in">class</span></div><div class="line">-w,w  wide output       n  numeric WCHAN,UID  -H process hierarchy</div></pre></td></tr></table></figure>
<p><strong>上面的执行结果可以看到，我这里加了管道，<code>command模块</code>执行时出错，而使用<code>raw模块</code>和<code>shell模块</code>都正常。</strong></p>
<h4 id="shell例子："><a href="#shell例子：" class="headerlink" title="shell例子："></a>shell例子：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># ansible tomcat_B1 -m shell -a "ps -ef|grep tomcat"</span></div><div class="line">192.168.1.176 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">root      1529     1  0 Aug11 ?        00:00:00 jsvc.exec -java-home /srv/jdk1.7.0_67 -user tomcat -pidfile /srv/tomcat/tomcat_manager/logs/catalina-daemon.pid -wait 10 -outfile /srv/tomcat/tomcat_manager/logs/catalina-daemon.out -errfile &amp;1 -classpath /srv/tomcat/tomcat_manager/bin/bootstrap.jar:/srv/tomcat/</div></pre></td></tr></table></figure>
<h4 id="使用chdir的示例："><a href="#使用chdir的示例：" class="headerlink" title="使用chdir的示例："></a>使用chdir的示例：</h4><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># ansible tomcat_B1 -m command -a "chdir=/tmp/ touch 1.txt"</span></div><div class="line"><span class="meta">192.168.1.176 | SUCCESS | rc=0 &gt;</span>&gt;</div><div class="line"></div><div class="line">[root@docker ~]<span class="comment"># ansible tomcat_B1 -m shell -a "chdir=/tmp/ touch 2.txt"</span></div><div class="line"><span class="meta">192.168.1.176 | SUCCESS | rc=0 &gt;</span>&gt;</div><div class="line"></div><div class="line">[root@docker ~]<span class="comment"># ansible tomcat_B1 -m raw -a "chdir=/tmp/ touch 3.txt"</span></div><div class="line"><span class="meta">192.168.1.176 | SUCCESS | rc=0 &gt;</span>&gt;</div></pre></td></tr></table></figure>
<p>从上面执行结果来看，三个命令都执行成功了。不过通过在远程主机上查看，前两个文件被成功创建：</p>
<figure class="highlight tap"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># ansible tomcat_B1 -m command -a "chdir=/tmp/ ls -lh"</span></div><div class="line">192.168.1.176 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">total 188K</div><div class="line">-rw-r--r--.<span class="number"> 1 </span>root   root     <span class="number"> 0 </span>Sep <span class="number"> 5 </span>22:52 1.txt</div><div class="line">-rw-r--r--.<span class="number"> 1 </span>root   root     <span class="number"> 0 </span>Sep <span class="number"> 5 </span>22:51 2.txt</div></pre></td></tr></table></figure>
<p>使用<code>raw模块</code>的执行的结果文件也被正常创建了，不过不是在chdir 指定的目录，而是在当前执行用户的家目录。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># ansible tomcat_B1 -m raw -a "ls ~/4.txt"</span></div><div class="line"><span class="meta">192.168.1.176 | SUCCESS | rc=0 &gt;</span>&gt;</div><div class="line"><span class="regexp">/root/</span><span class="number">4</span>.txt</div></pre></td></tr></table></figure>
<h4 id="creates与removes示例："><a href="#creates与removes示例：" class="headerlink" title="creates与removes示例："></a>creates与removes示例：</h4><p>这里我在测试主机上创建/tmp/server.txt文件，执行结果如下：</p>
<ul>
<li>creates：一个文件名，当该文件存在，则该命令不执行 </li>
</ul>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># ansible tomcat_B1  -a "creates=/tmp/1.txt uptime"</span></div><div class="line"> [<span class="type">WARNING</span>]: <span class="type">Failure</span> <span class="keyword">using</span> <span class="keyword">method</span> (v2_runner_on_ok) <span class="keyword">in</span> callback plugin (&lt;ansible.plugins.callback.minimal.<span class="type">CallbackModule</span> <span class="keyword">object</span> at <span class="number">0x2093e90</span>&gt;): coercing to</div><div class="line"><span class="type">Unicode</span>: need <span class="built_in">string</span> <span class="keyword">or</span> buffer, <span class="built_in">bool</span> found</div><div class="line"></div><div class="line">[root@docker ~]<span class="comment"># ansible tomcat_B1  -a "removes=/tmp/1.txt uptime"</span></div><div class="line"><span class="number">192</span>.<span class="number">168</span>.<span class="number">1</span>.<span class="number">176</span> | <span class="type">SUCCESS</span> | rc=<span class="number">0</span> &gt;&gt;</div><div class="line"> <span class="number">22</span>:<span class="number">59</span>:<span class="number">04</span> up <span class="number">25</span> days,  <span class="number">5</span>:<span class="number">10</span>,  <span class="number">1</span> user,  load average: <span class="number">0</span>.<span class="number">00</span>, <span class="number">0</span>.<span class="number">00</span>, <span class="number">0</span>.<span class="number">00</span></div></pre></td></tr></table></figure>
<h4 id="script模块示例："><a href="#script模块示例：" class="headerlink" title="script模块示例："></a>script模块示例：</h4><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[root@361way ~]# cat script.sh</div><div class="line">#!/bin/bash</div><div class="line">df -hl</div><div class="line">ifconfig</div><div class="line">ps auxf|grep snmp</div><div class="line">[root@361way ~]# ansible 10.212.52.252 -m script -a 'scrip.sh'</div><div class="line">10.212.52.252 | FAILED =&gt; file or module does not exist: /root/scrip.sh</div><div class="line">[root@361way ~]# ansible 10.212.52.252 -m script -a 'script.sh'</div><div class="line">10.212.52.252 | success &gt;&gt; &#123;</div><div class="line">    "changed": true,</div><div class="line">    "rc": 0,</div><div class="line">    "stderr": "OpenSSH_5.3p1, OpenSSL 1.0.1e-fips 11 Feb 2013<span class="symbol">\n</span>debug1: Reading configuration data /etc/ssh/ssh_config<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Applying options for *<span class="symbol">\r</span><span class="symbol">\n</span>debug1: auto-mux: Trying existing master<span class="symbol">\r</span><span class="symbol">\n</span>Control socket connect(/root/.ansible/cp/ansible-ssh-10.212.52.252-22-root): Connection refused<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Connecting to 10.212.52.252 [10.212.52.252] port 22.<span class="symbol">\r</span><span class="symbol">\n</span>debug1: fd 3 clearing O_NONBLOCK<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Connection established.<span class="symbol">\r</span><span class="symbol">\n</span>debug1: permanently_set_uid: 0/0<span class="symbol">\r</span><span class="symbol">\n</span>debug1: identity file /root/.ssh/identity type -1<span class="symbol">\r</span><span class="symbol">\n</span>debug1: identity file /root/.ssh/identity-cert type -1<span class="symbol">\r</span><span class="symbol">\n</span>debug1: identity file /root/.ssh/id_rsa type -1<span class="symbol">\r</span><span class="symbol">\n</span>debug1: identity file /root/.ssh/id_rsa-cert type -1<span class="symbol">\r</span><span class="symbol">\n</span>debug1: identity file /root/.ssh/id_dsa type -1<span class="symbol">\r</span><span class="symbol">\n</span>debug1: identity file /root/.ssh/id_dsa-cert type -1<span class="symbol">\r</span><span class="symbol">\n</span>debug1: identity file /root/.ssh/id_ecdsa type -1<span class="symbol">\r</span><span class="symbol">\n</span>debug1: identity file /root/.ssh/id_ecdsa-cert type -1<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Remote protocol version 2.0, remote software version OpenSSH_6.2<span class="symbol">\r</span><span class="symbol">\n</span>debug1: match: OpenSSH_6.2 pat OpenSSH*<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Enabling compatibility mode for protocol 2.0<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Local version string SSH-2.0-OpenSSH_5.3<span class="symbol">\r</span><span class="symbol">\n</span>debug1: SSH2_MSG_KEXINIT sent<span class="symbol">\r</span><span class="symbol">\n</span>debug1: SSH2_MSG_KEXINIT received<span class="symbol">\r</span><span class="symbol">\n</span>debug1: kex: server-&gt;client aes128-ctr hmac-md5 zlib@openssh.com<span class="symbol">\r</span><span class="symbol">\n</span>debug1: kex: client-&gt;server aes128-ctr hmac-md5 zlib@openssh.com<span class="symbol">\r</span><span class="symbol">\n</span>debug1: SSH2_MSG_KEX_DH_GEX_REQUEST(1024&lt;1024&lt;8192) sent<span class="symbol">\r</span><span class="symbol">\n</span>debug1: expecting SSH2_MSG_KEX_DH_GEX_GROUP<span class="symbol">\r</span><span class="symbol">\n</span>debug1: SSH2_MSG_KEX_DH_GEX_INIT sent<span class="symbol">\r</span><span class="symbol">\n</span>debug1: expecting SSH2_MSG_KEX_DH_GEX_REPLY<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Host '10.212.52.252' is known and matches the RSA host key.<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Found key in /root/.ssh/known_hosts:1<span class="symbol">\r</span><span class="symbol">\n</span>debug1: ssh_rsa_verify: signature correct<span class="symbol">\r</span><span class="symbol">\n</span>debug1: SSH2_MSG_NEWKEYS sent<span class="symbol">\r</span><span class="symbol">\n</span>debug1: expecting SSH2_MSG_NEWKEYS<span class="symbol">\r</span><span class="symbol">\n</span>debug1: SSH2_MSG_NEWKEYS received<span class="symbol">\r</span><span class="symbol">\n</span>debug1: SSH2_MSG_SERVICE_REQUEST sent<span class="symbol">\r</span><span class="symbol">\n</span>debug1: SSH2_MSG_SERVICE_ACCEPT received<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Authentications that can continue: publickey,password,keyboard-interactive<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Next authentication method: keyboard-interactive<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Enabling compression at level 6.<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Authentication succeeded (keyboard-interactive).<span class="symbol">\r</span><span class="symbol">\n</span>debug1: setting up multiplex master socket<span class="symbol">\r</span><span class="symbol">\n</span>ControlSocket /root/.ansible/cp/ansible-ssh-10.212.52.252-22-root already exists, disabling multiplexing<span class="symbol">\r</span><span class="symbol">\n</span>debug1: channel 0: new [client-session]<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Requesting no-more-sessions@openssh.com<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Entering interactive session.<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Sending environment.<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Sending env LANG = en_US.UTF-8<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Sending command: LANG=C LC_CTYPE=C /root/.ansible/tmp/ansible-tmp-1431924855.88-242473611260231/script.sh <span class="symbol">\r</span><span class="symbol">\n</span>debug1: client_input_channel_req: channel 0 rtype exit-status reply 0<span class="symbol">\r</span><span class="symbol">\n</span>debug1: client_input_channel_req: channel 0 rtype eow@openssh.com reply 0<span class="symbol">\r</span><span class="symbol">\n</span>debug1: channel 0: free: client-session, nchannels 1<span class="symbol">\r</span><span class="symbol">\n</span>debug1: fd 1 clearing O_NONBLOCK<span class="symbol">\r</span><span class="symbol">\n</span>debug1: fd 2 clearing O_NONBLOCK<span class="symbol">\r</span><span class="symbol">\n</span>Connection to 10.212.52.252 closed.<span class="symbol">\r</span><span class="symbol">\n</span>Transferred: sent 1928, received 3920 bytes, in 0.1 seconds<span class="symbol">\r</span><span class="symbol">\n</span>Bytes per second: sent 37017.0, received 75262.7<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Exit status 0<span class="symbol">\r</span><span class="symbol">\n</span>debug1: compress outgoing: raw data 537, compressed 375, factor 0.70<span class="symbol">\r</span><span class="symbol">\n</span>debug1: compress incoming: raw data 1837, compressed 1019, factor 0.55<span class="symbol">\r</span><span class="symbol">\n</span>",</div><div class="line">    "stdout": "Filesystem      Size  Used Avail Use<span class="variable">% Mounted on\r\n/dev/sda2       9.9G  872M  8.5G  10%</span> /<span class="symbol">\r</span><span class="symbol">\n</span>udev            3.9G  128K  3.9G   1<span class="variable">% /dev\r\ntmpfs           3.9G   76K  3.9G   1%</span> /dev/shm<span class="symbol">\r</span><span class="symbol">\n</span>/dev/sda3       5.0G  219M  4.5G   5<span class="variable">% /boot\r\n/dev/sda8        40G   15G   23G  40%</span> /home<span class="symbol">\r</span><span class="symbol">\n</span>/dev/sda9       9.9G  5.2G  4.3G  55<span class="variable">% /opt\r\n/dev/sda6       5.0G  2.7G  2.1G  57%</span> /tmp<span class="symbol">\r</span><span class="symbol">\n</span>/dev/sda5       9.9G  3.4G  6.0G  36<span class="variable">% /usr\r\n/dev/sda7       9.9G  823M  8.6G   9%</span> /var<span class="symbol">\r</span><span class="symbol">\n</span>eth0      Link encap:Ethernet  HWaddr 00:50:56:A8:65:7E  <span class="symbol">\r</span><span class="symbol">\n</span>          inet addr:10.212.52.252  Bcast:10.212.52.255  Mask:255.255.255.0<span class="symbol">\r</span><span class="symbol">\n</span>          inet6 addr: fe80::250:56ff:fea8:657e/64 Scope:Link<span class="symbol">\r</span><span class="symbol">\n</span>          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1<span class="symbol">\r</span><span class="symbol">\n</span>          RX packets:24112135 errors:0 dropped:792372 overruns:0 frame:0<span class="symbol">\r</span><span class="symbol">\n</span>          TX packets:10697339 errors:0 dropped:0 overruns:0 carrier:0<span class="symbol">\r</span><span class="symbol">\n</span>          collisions:0 txqueuelen:1000 <span class="symbol">\r</span><span class="symbol">\n</span>          RX bytes:17137233328 (16343.3 Mb)  TX bytes:13390377826 (12770.0 Mb)<span class="symbol">\r</span><span class="symbol">\n</span><span class="symbol">\r</span><span class="symbol">\n</span>lo        Link encap:Local Loopback  <span class="symbol">\r</span><span class="symbol">\n</span>          inet addr:127.0.0.1  Mask:255.0.0.0<span class="symbol">\r</span><span class="symbol">\n</span>          inet6 addr: ::1/128 Scope:Host<span class="symbol">\r</span><span class="symbol">\n</span>          UP LOOPBACK RUNNING  MTU:16436  Metric:1<span class="symbol">\r</span><span class="symbol">\n</span>          RX packets:3407332 errors:0 dropped:0 overruns:0 frame:0<span class="symbol">\r</span><span class="symbol">\n</span>          TX packets:3407332 errors:0 dropped:0 overruns:0 carrier:0<span class="symbol">\r</span><span class="symbol">\n</span>          collisions:0 txqueuelen:0 <span class="symbol">\r</span><span class="symbol">\n</span>          RX bytes:262675450 (250.5 Mb)  TX bytes:262675450 (250.5 Mb)<span class="symbol">\r</span><span class="symbol">\n</span><span class="symbol">\r</span><span class="symbol">\n</span>root     25332  0.0  0.0   4260   568 pts/2    S+   12:54   0:00          <span class="symbol">\\</span>_ grep snmp<span class="symbol">\r</span><span class="symbol">\n</span>root     24364  0.0  0.0  70416  6696 ?        SNl  May15   0:22 /usr/sbin/snmpd -r -A -LF i /var/log/net-snmpd.log -p /var/run/snmpd.pid<span class="symbol">\r</span><span class="symbol">\n</span>"</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>输出结果很多，看起来也很乱，不过查下stdout部分，这个部分是实际上执行后的结果。这里可以配合管道一起使用，可以如下使用：</p>
<p><code>`
[root@361way ~]# ansible 10.212.52.252 -m script -a &#39;script.sh&#39; |egrep &#39;&gt;&gt;|stdout&#39;</code></p>

	

	

</article>





	<span class="different-posts">📖 <a href="/page/9">more posts</a> 📖</span>



	</main>

	<footer class="footer">
	<div class="footer-content">
		
	      <div class="footer__element">
	<h5>Hi there,</h5>
	<p style="text-align:justify;">my name is Yancy, they know me as Radiant🐑🐑. This blog is about Bi-data and my live.<br> I like 🌳🌳🌳</p>
</div>


	    
	      <div class="footer__element">
	<h5>Check out</h5>
	<ul class="footer-links">
		<li class="footer-links__link"><a href="/archives">Archive</a></li>
		
		  <li class="footer-links__link"><a href="/atom.xml">RSS</a></li>
	    
		<li class="footer-links__link"><a href="/about">about page</a></li>
		<li class="footer-links__link"><a href="/tags">Tags</a></li>
		<li class="footer-links__link"><a href="/categories">Categories</a></li>
	</ul>
</div>

	    

		<div class="footer-credit">
			<span>© 2017 Yancy | Powered by <a href="http://blog.yancy.cc/">Yancy</a> | Theme <a href="https://github.com/yangcvo">Yancy_GitHub</a></span>
		</div>

	</div>


</footer>



</body>

</html>
