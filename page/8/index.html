<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="theme-color" content="#33474d">
	<title>Yancy&#39;s blog</title>
	<link rel="stylesheet" href="/css/style.css" />
	
      <link rel="alternate" href="/atom.xml" title="Yancy&#39;s blog" type="application/atom+xml">
    
</head>

<body>

	<header class="header">
		<nav class="header__nav">
			
				<a href="/" class="header__link">Home</a>
			
				<a href="/tags" class="header__link">Tags</a>
			
				<a href="/archives" class="header__link">ARCHIVES</a>
			
				<a href="/about/About" class="header__link">ABOUT</a>
			
				<a href="http://weibo.com/yangcvo" class="header__link">Weibo</a>
			
				<a href="/atom.xml" class="header__link">RSS</a>
			
		</nav>
		<h1 class="header__title"><a href="/">Yancy&#39;s blog</a></h1>
		<h2 class="header__subtitle">SIMPLICITY IS PREREQUISITE FOR  RELIABILITY</h2>
	</header>

	<main>
		
	<span class="different-posts different-posts_earlier">ğŸ“– <a href="/page/7">earlier posts</a> ğŸ“–</span>




	<article>
	
		<h1><a href="/2016/09/12/è‡ªåŠ¨åŒ–+Jenkins/Jenkins/ç”¨Ansible + Jenkins+mavenï¼‹nginxæå®šè‡ªåŠ¨å‘å¸ƒï¼Œæ„å»ºç¨‹åºçš„æŒç»­é›†æˆå¹³å°/">Ansible + Jenkins+Mavenï¼‹Nginxæå®šè‡ªåŠ¨å‘å¸ƒï¼Œæ„å»ºç¨‹åºçš„æŒç»­é›†æˆå¹³å°</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-09-12</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/automation/">automation</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Jenkins/">Jenkins</a> <a class="article__tag-link" href="/tags/Manven/">Manven</a>
			</span>
		
	</div>

	

	
		<h1 id="Ansible-Jenkinsæå®šè‡ªåŠ¨å‘å¸ƒï¼Œæ„å»ºç¨‹åºçš„æŒç»­é›†æˆå¹³å°"><a href="#Ansible-Jenkinsæå®šè‡ªåŠ¨å‘å¸ƒï¼Œæ„å»ºç¨‹åºçš„æŒç»­é›†æˆå¹³å°" class="headerlink" title="Ansible+Jenkinsæå®šè‡ªåŠ¨å‘å¸ƒï¼Œæ„å»ºç¨‹åºçš„æŒç»­é›†æˆå¹³å°"></a>Ansible+Jenkinsæå®šè‡ªåŠ¨å‘å¸ƒï¼Œæ„å»ºç¨‹åºçš„æŒç»­é›†æˆå¹³å°</h1><p>Ansibleæ˜¯ç›¸å¯¹ç®€å•çš„æ‰¹é‡ç®¡ç†å·¥å…·ï¼Œæ”¯æŒæ¨¡æ¿ç®¡ç†ç­‰é«˜çº§åŠŸèƒ½ã€‚æå®šäº†è‡ªåŠ¨å‘å¸ƒï¼Œå¼€å‘çš„æœåŠ¡å™¨éœ€æ±‚å·²ç»æ˜æ˜¾ä¸‹é™ï¼Œåªè¦æŠŠä»£ç æäº¤åˆ° Gitä¸»å¹²ï¼Œå°±ä¼šè‡ªåŠ¨è§¦å‘å‘å¸ƒã€‚</p>
<p>ä»Šå¤©æœ‰ç©ºå°±ç®€å•è®°å½•ä¸‹ç”¨Ansible + Jenkinsæå®šè‡ªåŠ¨å‘å¸ƒ ã€‚è¿™ç¯‡æ˜¯ä¸»è¦ç¯å¢ƒå®‰è£…ã€‚</p>
<h3 id="ä¸€ã€ä»€ä¹ˆæ˜¯æŒç»­é›†æˆ"><a href="#ä¸€ã€ä»€ä¹ˆæ˜¯æŒç»­é›†æˆ" class="headerlink" title="ä¸€ã€ä»€ä¹ˆæ˜¯æŒç»­é›†æˆ"></a>ä¸€ã€ä»€ä¹ˆæ˜¯æŒç»­é›†æˆ</h3><p><strong>1ã€ä»€ä¹ˆæ˜¯é›†æˆ</strong></p>
<p>æŒ‡çš„æ˜¯ä»£ç ç”±ç¼–è¯‘ã€å‘å¸ƒå’Œæµ‹è¯•ã€ç›´åˆ°ä¸Šçº¿çš„ä¸€ä¸ªè¿‡ç¨‹</p>
<p><strong>2ã€ä»€ä¹ˆæŒç»­é›†æˆ</strong></p>
<p>é«˜æ•ˆçš„ã€æŒç»­æ€§è´¨çš„ä¸æ–­è¿­ä»£ä»£ç çš„é›†æˆå·¥ä½œ</p>
<p><strong>3ã€å¦‚ä½•é«˜æ•ˆå‡†ç¡®çš„å®ç°æŒç»­é›†æˆ</strong></p>
<p>å¿…ä¸å¯å°‘çš„éœ€è¦ä¸€å¥—èƒ½è‡ªåŠ¨åŒ–ã€å¹¶ä¸”å¯è§†åŒ–çš„å¹³å°æ¥å¸®åŠ©æˆ‘ä»¬ã€‚</p>
<p>é‚£ä¹ˆæ€»ç»“æ¥çœ‹ï¼ŒJenkinså°±æ˜¯ä¸€ä¸ªå¯ä»¥å¸®åŠ©æˆ‘ä»¬å®ç°æŒç»­é›†æˆçš„å¹³å°ã€‚</p>
<h3 id="äºŒã€ä¸ºä»€ä¹ˆJenkinsèƒ½å¸®åŠ©æˆ‘ä»¬è¿›è¡ŒæŒç»­é›†æˆ"><a href="#äºŒã€ä¸ºä»€ä¹ˆJenkinsèƒ½å¸®åŠ©æˆ‘ä»¬è¿›è¡ŒæŒç»­é›†æˆ" class="headerlink" title="äºŒã€ä¸ºä»€ä¹ˆJenkinsèƒ½å¸®åŠ©æˆ‘ä»¬è¿›è¡ŒæŒç»­é›†æˆ"></a>äºŒã€ä¸ºä»€ä¹ˆJenkinsèƒ½å¸®åŠ©æˆ‘ä»¬è¿›è¡ŒæŒç»­é›†æˆ</h3><p> ç†ç”±æœ‰å¦‚ä¸‹å‡ ç‚¹ï¼š</p>
<p><strong>1ã€Jenkinsæ˜¯ä¸€ä¸ªå¼€æºçš„ã€ä¸”åŸºäºJAVAä»£ç å¼€å‘çš„æŒç»­é›†æˆç³»ç»Ÿã€‚</strong></p>
<p>å› ä¸ºå«æœ‰éå¸¸ä¸°å¯Œçš„æ’ä»¶æ”¯æŒæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ–¹ä¾¿çš„æ‰“é€šç‰ˆæœ¬åº“ã€æµ‹è¯•æ„å»ºç¯å¢ƒã€çº¿ä¸Šç¯å¢ƒçš„æ‰€æœ‰ç¯èŠ‚ã€‚å¹¶ä¸”ä¸°å¯Œå‹å¥½çš„é€šçŸ¥ä½¿ç”¨è€…å’Œå¼€å‘ã€ç®¡ç†äººå‘˜ã€‚</p>
<p><strong>2ã€å®‰è£…ç»´æŠ¤ç®€å•</strong></p>
<p>å®‰è£…Jenkinsï¼Œä¸å¤ªå¤æ‚ã€‚ä¸”æ”¯æŒé€šç”¨çš„å¹³å°ã€‚</p>
<p><strong>3ã€Java åº”ç”¨ å¸¸ç”¨</strong></p>
<p>åœ¨ä¼ä¸šçš„è½¯ä»¶æ„å»ºè¿‡ç¨‹ä¸­ï¼ŒJAVAçš„åº”ç”¨å·¥ç¨‹ç¨æ˜¾å¤æ‚ï¼Œç”±äºå¤æ‚æ„å»ºã€å’Œä»£ç ä¸Šçº¿ã€å¹¶ä¸”æœåŠ¡çš„é‡å¯ã€‚æ•´ä¸ªè¿‡ç¨‹ä¸‹æ¥ï¼Œæ¶ˆè€—çš„æ—¶é—´è¾ƒå¤šï¼ŒJenkinså´èƒ½å¾ˆå¥½çš„é›†æˆmavençš„ç¼–è¯‘æ–¹å¼ï¼Œä¸”åˆ©ç”¨è‡ªåŠ¨åŒ–çš„æ’ä»¶ã€å’Œè‡ªå®šä¹‰å¼€å‘è„šæœ¬çš„æ”¯æŒã€‚æ‰€ä»¥ç›®å‰å¹¿æ³›çš„åº”ç”¨äºJAVAå·¥ç¨‹çš„æŒç»­é›†æˆå¹³å°ã€‚</p>
<p>å¥½äº†ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘å°±æ¥ä»‹ç»ï¼Œå¦‚ä½•æ­å»ºä¸€å¥—å¿«é€Ÿæœ‰æ•ˆçš„Jenkinsè‡ªåŠ¨åŒ–å‘å¸ƒæŒç»­é›†æˆå¹³å°ã€‚</p>
<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¸ºäº†æé«˜å·¥ä½œæ•ˆç‡ï¼Œé¿å…é‡å¤çš„æ‰‹åŠ¨å‘åŒ…éƒ¨ç½²å·¥ä½œï¼Œç‰¹æ­å»ºJenkins+Ansibleçš„è‡ªåŠ¨éƒ¨ç½²å¹³å°ã€‚<br>ä¸»è¦å®ç°åŸç†æ˜¯ï¼š</p>
<ul>
<li>ç”±Jenkinsæ‹‰å–gitä»£ç   </li>
<li>ä½¿ç”¨Mavenå‘½ä»¤ç¼–è¯‘æ‰“åŒ…  </li>
<li>é€šè¿‡Ansible å‘é€waråŒ…åˆ°å¯¹åº”çš„æœåŠ¡å™¨  </li>
<li>é€šè¿‡Ansibleæ‰§è¡Œè¿œç¨‹æœåŠ¡å™¨çš„é‡å¯å‘½ä»¤ </li>
<li>å‘å¸ƒå®Œæˆã€‚</li>
</ul>
<h3 id="ä¸€-ç¯å¢ƒä»‹ç»"><a href="#ä¸€-ç¯å¢ƒä»‹ç»" class="headerlink" title="ä¸€. ç¯å¢ƒä»‹ç»"></a>ä¸€. ç¯å¢ƒä»‹ç»</h3><p>æœ¬å¹³å°æ­å»ºåœ¨CentOS6ç¯å¢ƒä¸­ï¼Œå…¶ä»–linuxç¯å¢ƒæƒ…å†µç±»ä¼¼ã€‚<br>åœ¨è‡ªåŠ¨éƒ¨ç½²æœåŠ¡å™¨ä¸­éœ€è¦å®‰è£…ä»¥ä¸‹è½¯ä»¶ï¼š</p>
<ol>
<li>JDK</li>
<li>Git</li>
<li>Maven</li>
<li>Tomcat</li>
<li>Jenkins</li>
<li>Ansible</li>
</ol>
<h3 id="äºŒ-æ­¥éª¤ï¼š"><a href="#äºŒ-æ­¥éª¤ï¼š" class="headerlink" title="äºŒ. æ­¥éª¤ï¼š"></a>äºŒ. æ­¥éª¤ï¼š</h3><ol>
<li>ansibleå®‰è£…ä¸é…ç½®ï¼›</li>
<li>Jenkinsçš„å®‰è£…ï¼›</li>
<li>Jenkinsçš„é…ç½®ï¼›</li>
<li>å®‰è£…é…ç½®tomcat</li>
<li>å®‰è£…é…ç½®Javaï¼›</li>
<li>å®‰è£…é…ç½®mavenï¼›</li>
<li>nginxåå‘ä»£ç†é…ç½®è®¿é—®åŸŸåï¼›</li>
<li>ç›¸å…³æ’ä»¶å®‰è£…ï¼›</li>
<li>ç³»ç»Ÿè®¾ç½®æ˜ç»†ï¼›</li>
<li>slaveèŠ‚ç‚¹é…ç½®ï¼›</li>
<li>ä¸€äº›ä¾èµ–é¡¹çš„å®‰è£…ã€‚</li>
</ol>
<h4 id="1-1-Ansibleç®€å•ä»‹ç»"><a href="#1-1-Ansibleç®€å•ä»‹ç»" class="headerlink" title="1.1    Ansibleç®€å•ä»‹ç»"></a>1.1    Ansibleç®€å•ä»‹ç»</h4><p>Ansibleæ˜¯ä¸€ä¸ªéƒ¨ç½²ä¸€ç¾¤è¿œç¨‹ä¸»æœºçš„å·¥å…·ã€‚è¿œç¨‹çš„ä¸»æœºå¯ä»¥æ˜¯æœ¬åœ°æˆ–è€…è¿œç¨‹çš„è™šæ‹Ÿ æœºï¼Œä¹Ÿå¯ä»¥æ˜¯è¿œç¨‹çš„ç‰©ç†æœºã€‚<br>Ansibleé€šè¿‡SSHåè®®è¿›è¡Œç®¡ç†èŠ‚ç‚¹å’Œè¿œç¨‹èŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡ã€‚ç†è®ºä¸Šè¯´ç®¡ç†å‘˜é€šè¿‡ sshåˆ°ä¸€å°è¿œç¨‹ä¸»æœºä¸Šèƒ½åšçš„æ“ä½œAnsibleéƒ½å¯ä»¥åšã€‚åŒ…æ‹¬ï¼šæ‹·è´æ–‡ä»¶ã€å®‰è£…åŒ…ã€å¯åŠ¨æœåŠ¡â€¦</p>
<p>æ€»ç»“ï¼š<strong>AnsibleæŠŠä¸€äº›shellå‘½ä»¤å°è£…æˆä¸€ä¸ªä¸ªæ¨¡å—ï¼Œå¹¶é€šè¿‡SSHè¿æ¥ï¼Œåœ¨è¿œç¨‹æœºå™¨ä¸Šæ‰§è¡Œè¿™äº›æ¨¡å—åŒ…å«çš„è„šæœ¬ã€‚</strong></p>
<h4 id="1-2-Ansibleå®‰è£…ä¸é…ç½®"><a href="#1-2-Ansibleå®‰è£…ä¸é…ç½®" class="headerlink" title="1.2    Ansibleå®‰è£…ä¸é…ç½®"></a>1.2    Ansibleå®‰è£…ä¸é…ç½®</h4><p>ç³»ç»Ÿç¯å¢ƒï¼šcentos7.1<br>ç›´æ¥ä½¿ç”¨yumå®‰è£…ansible</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># yum install http://mirrors.sohu.com/fedora-epel/6/x86_64/epel-release-6-8.noarch.rpm</span></div><div class="line"><span class="comment"># yum install ansible</span></div></pre></td></tr></table></figure>
<p>å®‰è£…å®Œæˆä¹‹åï¼Œéœ€è¦<code>ansible</code>ä¸­çš„<code>hosts</code>æ–‡ä»¶åˆ†ç»„ï¼Œç¼–è¾‘<code>/etc/ansible/hosts</code>æ–‡ä»¶ï¼Œå°†ç›®æ ‡æœºå™¨åŠ å…¥åˆ†ç»„ï¼Œå¹¶é…ç½®å¥½é¢ç§˜é’¥ç™»å½•ã€‚<br>Ansibleæ›´å¤šè¯¦ç»†å†…å®¹å¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰å†™çš„<a href="http://blog.yangcvo.me/2016/03/07/%E8%87%AA%E5%8A%A8%E5%8C%96/Ansible/Ansible%20%E5%B0%8F%E7%BB%93%EF%BC%88%E4%B8%80%EF%BC%89ansible%E7%9A%84%E5%AE%89%E8%A3%85%20/" target="_blank" rel="external">ansibleså­¦ä¹ ç¯‡</a></p>
<h4 id="äºŒ-å®‰è£…Jenkinsç¯å¢ƒ"><a href="#äºŒ-å®‰è£…Jenkinsç¯å¢ƒ" class="headerlink" title="äºŒ. å®‰è£…Jenkinsç¯å¢ƒ"></a>äºŒ. å®‰è£…Jenkinsç¯å¢ƒ</h4><p>1)    å®‰è£…å¹¶é…ç½®å¥½JAVAã€JDKã€Tomcatï¼Œå¹¶å»å®˜ç½‘ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„waråŒ…ã€‚</p>
<p>å»å®˜ç½‘ä¸‹è½½åŒ…èµ„æºï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">apache-tomcat-8.0.28.tar.gz</div><div class="line">jenkins.war</div><div class="line">jdk1.8.0_66.tar.gz</div><div class="line">maven.tar.gz</div></pre></td></tr></table></figure>
<p>æ²¡æœ‰ä¸‹è½½æˆåŠŸçš„æˆ‘è¿™é‡Œå·²ä¸‹è½½å¥½äº†ã€‚æœ€æ–°ç‰ˆæœ¬<br><a href="http://oak0aohum.bkt.clouddn.com/jenkins.war" target="_blank" rel="external">jenkins.war</a><br><a href="http://oak0aohum.bkt.clouddn.com/apache-tomcat-8.0.28.tar.gz" target="_blank" rel="external">tomcat.tar.gz</a><br><a href="http://oak0aohum.bkt.clouddn.com/maven.tar.gz" target="_blank" rel="external">maven.tar.gz</a></p>
<h5 id="2-1-jdkå®‰è£…ï¼š"><a href="#2-1-jdkå®‰è£…ï¼š" class="headerlink" title="2.1 jdkå®‰è£…ï¼š"></a>2.1 jdkå®‰è£…ï¼š</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">tar -zxvf jdk1.8.0_66.tar.gz -C /srv/.</div><div class="line">         </div><div class="line">è¿™é‡Œåœ¨é…ç½®ç¯å¢ƒå˜é‡ã€‚</div><div class="line"></div><div class="line">vim /etc/profile.d/java.sh</div><div class="line"><span class="built_in">export</span> JAVA_HOME=/srv/jdk1.8.0_66</div><div class="line"><span class="built_in">export</span> CLASS_PATH=<span class="string">"<span class="variable">$JAVA_HOME</span>/lib:<span class="variable">$JAVA_HOME</span>/jre/lib"</span></div><div class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin</div><div class="line"></div><div class="line">[root@Jenkins ~]<span class="comment"># java -version</span></div><div class="line">java version <span class="string">"1.8.0_66"</span></div><div class="line">Java(TM) SE Runtime Environment (build 1.8.0_66-b17)</div><div class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.66-b17, mixed mode)</div></pre></td></tr></table></figure>
<h5 id="2-2-Tomcatå®‰è£…é…ç½®ï¼š"><a href="#2-2-Tomcatå®‰è£…é…ç½®ï¼š" class="headerlink" title="2.2 Tomcatå®‰è£…é…ç½®ï¼š"></a>2.2 Tomcatå®‰è£…é…ç½®ï¼š</h5><p>Jenkinså®˜ç½‘ï¼š<a href="https://jenkins.io/index.html" target="_blank" rel="external">https://jenkins.io/index.html</a><br>å¯å‚è€ƒæˆ‘ä¹‹å‰å†™çš„æ–‡æ¡£ï¼š<a href="http://blog.yangcvo.me/2015/11/21/tomcat/%E6%90%AD%E5%BB%BA%E9%85%8D%E7%BD%AEtomcat%E7%8E%AF%E5%A2%83/" target="_blank" rel="external">æ­å»ºé…ç½®tomcatç¯å¢ƒ</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">tar -zxvf apache-tomcat-8.0.28.tar.gz -C /srv/.</div><div class="line">mv apache-tomcat-8.0.28 tomcat</div><div class="line">useradd <span class="_">-s</span> /sbin/nologin tomcat </div><div class="line">chown -R tomcat:tomcat tomcat</div></pre></td></tr></table></figure>
<p>2)    æ”¾åœ¨é…ç½®å¥½Tomcatï¼Œå¯åŠ¨Jenkinsï¼Œæ ¹æ®æç¤ºï¼Œè¾“å…¥å®‰è£…ç§˜é’¥ã€‚</p>
<h5 id="2-3-jenkinså®‰è£…é…ç½®ï¼š"><a href="#2-3-jenkinså®‰è£…é…ç½®ï¼š" class="headerlink" title="2.3 jenkinså®‰è£…é…ç½®ï¼š"></a>2.3 jenkinså®‰è£…é…ç½®ï¼š</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">mv jenkins.war /srv/tomcat/webapps/. </div><div class="line"><span class="built_in">cd</span> /tomcat</div><div class="line">./bin/startup.sh</div><div class="line">ç„¶åæ‰“å¼€åœ°å€ï¼šhttp://192.168.1.183:8080/jenkins</div><div class="line">æ–°ç‰ˆæœ¬ä¼šæç¤ºä¸‹è½½å®‰è£…æ’ä»¶ã€‚ä¸‹è½½ä»¥åä¼šè®©ä½ è®¾ç½®è´¦å·å’Œå¯†ç è¿˜æœ‰é‚®ç®±ã€‚</div></pre></td></tr></table></figure>
<p>è¿›å…¥å®‰è£…ç•Œé¢:<br>ç¬¬ä¸€æ¬¡ï¼Œç™»å½•ï¼Œéœ€è¦è¿›è¡Œä¸€ä¸ªè§£é” ï¼Œé¡µé¢ä¹Ÿä¼šæœ‰æç¤º.</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins1.png" alt=""></figure></p>
<p>ç§˜é’¥çš„å…·ä½“ä½ç½®åœ¨ï¼š<code>/root/.jenkins/secrets/initialAdminPassword</code>ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªæ–‡ä»¶ä¸­æŸ¥çœ‹å¯†ç ï¼Œå¹¶è¾“å…¥ã€‚</p>
<p>3)    è®¾ç½®å¥½ç™»å½•è´¦å·å¯†ç ï¼Œæ ¹æ®æ¨èé€‰é¡¹å®‰è£…æ’ä»¶ï¼Œç­‰å¾…ä¸‹è½½å®‰è£…å®Œæˆã€‚åœ¨æ’ä»¶å®‰è£…è¿‡ç¨‹ä¸­å¯èƒ½æœ‰äº›å®‰è£…ä¸æˆåŠŸï¼Œæš‚æ—¶å…ˆä¸ç”¨ç®¡ã€‚</p>
<p>å®ƒä¼šç»™æˆ‘ä»¬å®‰è£…ä¸€äº›åŸºç¡€çš„æ’ä»¶<br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins_01.png" alt=""></figure><br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins_02.png" alt=""></figure><br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins_03.png" alt=""></figure><br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins_04.png" alt=""></figure><br>æ—©æœŸjenkinsé»˜è®¤æ˜¯ä¸éœ€è¦ç™»é™†çš„ã€‚</p>
<h4 id="1-3-Maven-å®‰è£…å’Œé…ç½®"><a href="#1-3-Maven-å®‰è£…å’Œé…ç½®" class="headerlink" title="1.3 Maven å®‰è£…å’Œé…ç½®"></a>1.3 Maven å®‰è£…å’Œé…ç½®</h4><p>å®˜ç½‘ï¼š<a href="http://maven.apache.org/" target="_blank" rel="external">http://maven.apache.org/</a><br>å®˜ç½‘ä¸‹è½½ï¼š<a href="http://maven.apache.org/download.cgi" target="_blank" rel="external">http://maven.apache.org/download.cgi</a><br>å†å²ç‰ˆæœ¬ä¸‹è½½ï¼š<a href="https://archive.apache.org/dist/maven/binaries/" target="_blank" rel="external">https://archive.apache.org/dist/maven/binaries/</a><br>æ­¤æ—¶ï¼ˆ20160208ï¼‰ Maven æœ€æ–°ç‰ˆæœ¬ä¸ºï¼š<strong>3.3.9</strong></p>
<p>Maven 3.3 çš„ JDK æœ€ä½è¦æ±‚æ˜¯ JDK 1.7 - æˆ‘ä¸ªäººä¹ æƒ¯ <code>/opt</code> ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªç›®å½• <code>setups</code> ç”¨æ¥å­˜æ”¾å„ç§è½¯ä»¶å®‰è£…åŒ…ï¼›åœ¨ <code>/srv</code> ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª <code>program</code> ç”¨æ¥å­˜æ”¾å„ç§è§£å‹åçš„è½¯ä»¶åŒ…ï¼Œä¸‹é¢çš„è®²è§£ä¹Ÿéƒ½æ˜¯åŸºäºæ­¤ä¹ æƒ¯.</p>
<p>ä¸‹è½½å‹ç¼©åŒ…ï¼š<code>wget http://mirrors.cnnic.cn/apache/maven/maven-3/3.3.9/binaries/apache-maven-3.3.9-bin.tar.gz</code><br>è§£å‹æŒ‡å®šåˆ°æˆ‘ä¸ªäººä¹ æƒ¯çš„å®‰è£…ç›®å½•ä¸‹ï¼š<code>tar zxvf apache-maven-3.3.9-bin.tar.gz -C /srv/program/.</code><br>ç§»åˆ°æˆ‘ä¸ªäººä¹ æƒ¯çš„å®‰è£…ç›®å½•ä¸‹ï¼š<code>mv maven3.3.9/ /srv/program/maven3</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">ç¯å¢ƒå˜é‡è®¾ç½®ï¼švim /etc/profile.d/maven.sh</div><div class="line">    <span class="comment"># Maven</span></div><div class="line">    MAVEN_HOME=/srv/program/maven3</div><div class="line">    PATH=<span class="variable">$PATH</span>:<span class="variable">$MAVEN_HOME</span>/bin</div><div class="line">    MAVEN_OPTS=<span class="string">"-Xms256m -Xmx356m"</span></div><div class="line">    <span class="built_in">export</span> MAVEN_HOME</div><div class="line">    <span class="built_in">export</span> PATH</div><div class="line">    <span class="built_in">export</span> MAVEN_OPTS</div></pre></td></tr></table></figure>
<p>åˆ·æ–°é…ç½®æ–‡ä»¶ï¼š<code>source /etc/profile</code><br>æµ‹è¯•æ˜¯å¦å®‰è£…æˆåŠŸï¼š<code>mvn -version</code></p>
<h4 id="1-3-1-Maven-é…ç½®"><a href="#1-3-1-Maven-é…ç½®" class="headerlink" title="1.3.1 Maven é…ç½®"></a>1.3.1 Maven é…ç½®</h4><ul>
<li>é…ç½®é¡¹ç›®è¿æ¥ä¸Šç§æœ</li>
<li>å…¨å±€æ–¹å¼é…ç½®ï¼š</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span><span class="meta">?&gt;</span></span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">settings</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/SETTINGS/1.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/SETTINGS/1.0.0 http://maven.apache.org/xsd/settings-1.0.0.xsd"</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="comment">&lt;!--æœ¬åœ°ä»“åº“ä½ç½®--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">localRepository</span>&gt;</span>/srv/mv2<span class="tag">&lt;/<span class="name">localRepository</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">pluginGroups</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">pluginGroups</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">proxies</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">proxies</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="comment">&lt;!--è®¾ç½® Nexus è®¤è¯ä¿¡æ¯--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">servers</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">server</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-releases<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">username</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">username</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">password</span>&gt;</span>admin123<span class="tag">&lt;/<span class="name">password</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">server</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">server</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-snapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">username</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">username</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">password</span>&gt;</span>admin123<span class="tag">&lt;/<span class="name">password</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">server</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">servers</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="comment">&lt;!--è®¾ç½® Nexus é•œåƒï¼Œåé¢åªè¦æœ¬åœ°æ²¡å¯¹åº”çš„ä»¥æ¥ï¼Œåˆ™åˆ° Nexus å»æ‰¾--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">mirrors</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-releases<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>*<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://localhost:8081/nexus/content/groups/public<span class="tag">&lt;/<span class="name">url</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-snapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>*<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://localhost:8081/nexus/content/groups/public-snapshots<span class="tag">&lt;/<span class="name">url</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">mirrors</span>&gt;</span></div><div class="line"></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">profiles</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">profile</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">repositories</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">repository</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-releases<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://nexus-releases<span class="tag">&lt;/<span class="name">url</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">releases</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">repository</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-snapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://nexus-snapshots<span class="tag">&lt;/<span class="name">url</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">releases</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">pluginRepositories</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">pluginRepository</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-releases<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://nexus-releases<span class="tag">&lt;/<span class="name">url</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">releases</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">pluginRepository</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">pluginRepository</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-snapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://nexus-snapshots<span class="tag">&lt;/<span class="name">url</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">releases</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">pluginRepository</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">pluginRepositories</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">activeProfiles</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">activeProfile</span>&gt;</span>nexus<span class="tag">&lt;/<span class="name">activeProfile</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">activeProfiles</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></div></pre></td></tr></table></figure>
<ul>
<li>jenkinså‘å¸ƒä¿®æ”¹è¿‡ä»¥åï¼š</li>
</ul>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div></pre></td><td class="code"><pre><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">settings</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span></div><div class="line">          <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></div><div class="line">          <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0</span></div><div class="line">                               http://maven.apache.org/xsd/settings-1.0.0.xsd"&gt;</div><div class="line">                               </div><div class="line">                               </div><div class="line">         <span class="comment">&lt;!--è¡¨ç¤ºæœ¬åœ°åº“çš„ä¿å­˜ä½ç½®ï¼Œä¹Ÿå°±æ˜¯maven2ä¸»è¦çš„jarä¿å­˜ä½ç½®ï¼Œé»˜è®¤åœ¨$</span><span class="template-variable">&#123;user.dir&#125;</span><span class="xml"><span class="comment">/.m2/repositoryï¼Œå¦‚æœéœ€è¦å¦å¤–è®¾ç½®ï¼Œå°±æ¢æˆå…¶ä»–çš„è·¯å¾„ã€‚ --&gt;</span></span></div><div class="line">         </div><div class="line">  <span class="tag">&lt;<span class="name">localRepository</span>&gt;</span>/srv/m2<span class="tag">&lt;/<span class="name">localRepository</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">interactiveMode</span>/&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">usePluginRegistry</span>/&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">offline</span>&gt;</span>false<span class="tag">&lt;/<span class="name">offline</span>&gt;</span></div><div class="line">  </div><div class="line">  </div><div class="line">  <span class="comment">&lt;!--å½“æ’ä»¶çš„ç»„ç»‡Idï¼ˆgroupIdï¼‰æ²¡æœ‰æ˜¾å¼æä¾›æ—¶ï¼Œä¾›æœå¯»æ’ä»¶ç»„ç»‡Idï¼ˆgroupIdï¼‰çš„åˆ—è¡¨ã€‚è¯¥å…ƒç´ åŒ…å«ä¸€ä¸ªpluginGroupå…ƒç´ åˆ—è¡¨ï¼Œæ¯ä¸ªå­å…ƒç´ åŒ…å«äº†ä¸€ä¸ªç»„ç»‡Idï¼ˆgroupIdï¼‰ã€‚</span></div><div class="line">å½“æˆ‘ä»¬ä½¿ç”¨æŸä¸ªæ’ä»¶ï¼Œå¹¶ä¸”æ²¡æœ‰åœ¨å‘½ä»¤è¡Œä¸ºå…¶æä¾›ç»„ç»‡Idï¼ˆgroupIdï¼‰çš„æ—¶å€™ï¼ŒMavenå°±ä¼šä½¿ç”¨è¯¥åˆ—è¡¨ã€‚é»˜è®¤æƒ…å†µä¸‹è¯¥åˆ—è¡¨åŒ…å«äº†org.apache.maven.pluginsã€‚ --&gt;</div><div class="line"></div><div class="line"> <span class="tag">&lt;<span class="name">pluginGroups</span>&gt;</span></div><div class="line">  <span class="comment">&lt;!--pluginçš„ç»„ç»‡Idï¼ˆgroupIdï¼‰ --&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">pluginGroup</span>&gt;</span>org.codehaus.mojo<span class="tag">&lt;/<span class="name">pluginGroup</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">pluginGroup</span>&gt;</span>org.apache.tomcat.maven<span class="tag">&lt;/<span class="name">pluginGroup</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">pluginGroup</span>&gt;</span>org.mortbay.jetty<span class="tag">&lt;/<span class="name">pluginGroup</span>&gt;</span></div><div class="line"> <span class="tag">&lt;/<span class="name">pluginGroups</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">servers</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">server</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>tomcat<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">username</span>&gt;</span>tomcat<span class="tag">&lt;/<span class="name">username</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">password</span>&gt;</span>keyfree123<span class="tag">&lt;/<span class="name">password</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">server</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">server</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">id</span>&gt;</span>haozhuo<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">username</span>&gt;</span>haozhuo<span class="tag">&lt;/<span class="name">username</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">password</span>&gt;</span>haozhuo123<span class="tag">&lt;/<span class="name">password</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">server</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!--d:server çš„id,ç”¨äºåŒ¹é…distributionManagementåº“idï¼Œæ¯”è¾ƒé‡è¦ã€‚ --&gt;</span></div><div class="line">         <span class="tag">&lt;<span class="name">server</span>&gt;</span></div><div class="line">     <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-releases<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!--username, password:ç”¨äºç™»é™†æ­¤æœåŠ¡å™¨çš„ç”¨æˆ·åå’Œå¯†ç  --&gt;</span></div><div class="line">     <span class="tag">&lt;<span class="name">username</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">username</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">password</span>&gt;</span>123456<span class="tag">&lt;/<span class="name">password</span>&gt;</span></div><div class="line">   <span class="tag">&lt;/<span class="name">server</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">server</span>&gt;</span></div><div class="line">     <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-snapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">     <span class="tag">&lt;<span class="name">username</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">username</span>&gt;</span></div><div class="line">     <span class="tag">&lt;<span class="name">password</span>&gt;</span>123456<span class="tag">&lt;/<span class="name">password</span>&gt;</span></div><div class="line">   <span class="tag">&lt;/<span class="name">server</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">servers</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">mirrors</span>&gt;</span></div><div class="line">  <span class="comment">&lt;!--è¡¨ç¤ºé•œåƒåº“ï¼ŒæŒ‡å®šåº“çš„é•œåƒï¼Œç”¨äºå¢åŠ å…¶ä»–åº“ --&gt;</span></div><div class="line"></div><div class="line">   </div><div class="line">    <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-aliyun<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>*<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>Nexus aliyun<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public<span class="tag">&lt;/<span class="name">url</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>hz<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>hz Central<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://nexus.haozhuo.com:8083/nexus/content/groups/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>CN<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>OSChina Central<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.oschina.net/content/groups/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">          <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></div><div class="line">           <span class="tag">&lt;<span class="name">id</span>&gt;</span>ibiblio.org<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">           <span class="tag">&lt;<span class="name">name</span>&gt;</span>ibiblio Mirror of http://repo1.maven.org/maven2/<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">           <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://mirrors.ibiblio.org/pub/mirrors/maven2<span class="tag">&lt;/<span class="name">url</span>&gt;</span></div><div class="line">           <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></div><div class="line"></div><div class="line">     <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></div><div class="line">        </div><div class="line">           <span class="comment">&lt;!--</span></div><div class="line">     &lt;mirror&gt;</div><div class="line">         &lt;id&gt;jboss-public-repository-group&lt;/id&gt;</div><div class="line">         &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;</div><div class="line">         &lt;name&gt;JBoss Public Repository Group&lt;/name&gt;</div><div class="line">         &lt;url&gt;http://repository.jboss.org/nexus/content/groups/public&lt;/url&gt;</div><div class="line">     &lt;/mirror&gt;</div><div class="line">            --&gt;</div><div class="line">            </div><div class="line"> <span class="tag">&lt;/<span class="name">mirrors</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">activeProfiles</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!--make the profile active all the time --&gt;</span></div><div class="line">     <span class="comment">&lt;!--&lt;activeProfile&gt;nexus&lt;/activeProfile&gt;   --&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">activeProfiles</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="ä¸‰-é…ç½®nginxåå‘ä»£ç†"><a href="#ä¸‰-é…ç½®nginxåå‘ä»£ç†" class="headerlink" title="ä¸‰. é…ç½®nginxåå‘ä»£ç†."></a>ä¸‰. é…ç½®nginxåå‘ä»£ç†.</h3><p>åœ¨nginxé…ç½®ç›®å½•/usr/local/nginx/conf/nginx.confï¼Œé…ç½®æ–‡ä»¶å†…å®¹å¦‚ä¸‹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">upstream tomcat-jenkins &#123;</div><div class="line">     server  192.168.1.220:8080 weight=1;</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> server &#123;</div><div class="line">     listen       80;</div><div class="line">     server_name  jenkins.yjk.cn;</div><div class="line">     location / &#123;</div><div class="line">        index        index.html index.php index.jsp index.htm;</div><div class="line">        proxy_pass           http://tomcat-jenkins;</div><div class="line">        proxy_ignore_client_abort on;</div><div class="line">        proxy_redirect               off;</div><div class="line">        proxy_set_header     Host    <span class="variable">$host</span>;</div><div class="line">        proxy_set_header     X-Real-IP       <span class="variable">$remote_addr</span>;</div><div class="line">        proxy_set_header     X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</div><div class="line">     &#125;</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<p>ä¿®æ”¹/etc/hostsï¼Œåœ¨æœ«å°¾æ–°å¢ä¸€è¡Œ :</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">127.0.0.1     jenkins.yjk.cn</div></pre></td></tr></table></figure>
<p>é‡å¯nginxï¼Œ<code>/usr/sbin/nginx -s reload</code>ï¼Œå³å¯ä»¥åœ°å€ <code>jenkins.yjk.cn</code> è®¿é—®Jenkinsä¸»é¡µ.</p>
<h3 id="å››-å®‰è£…éƒ¨åˆ†Jenkinsæ’ä»¶"><a href="#å››-å®‰è£…éƒ¨åˆ†Jenkinsæ’ä»¶" class="headerlink" title="å››. å®‰è£…éƒ¨åˆ†Jenkinsæ’ä»¶"></a>å››. å®‰è£…éƒ¨åˆ†Jenkinsæ’ä»¶</h3><p>è®¿é—®Jenkinsä¸»é¡µï¼š<a href="http://jenkins.yjk.cn" target="_blank" rel="external">http://jenkins.yjk.cn</a><br>ç³»ç»Ÿç®¡ç† â€“&gt; ç®¡ç†æ’ä»¶ â€“&gt; å¯é€‰æ’ä»¶;<br>å®‰è£…æ‰€éœ€è¦çš„æ’ä»¶(æ ¹æ®éœ€è¦è‡ªè¡Œé€‰æ‹©)ï¼Œå¦‚ <code>GitBucket Pluginã€ FindBugs Plug-in ã€Cobertura Plugin ã€ Violations Plugin ã€Email Extension Plugin</code>ç­‰</p>
<p>âš ï¸æ’ä»¶å®‰è£…ä¸æˆåŠŸå¤„ç†åŠæ³•ï¼š</p>
<p>è¿›å…¥å·¦ä¾§èœå•æ çš„ç³»ç»Ÿç®¡ç†ï¼Œå‘ç°å¾ˆå¤šæ’ä»¶æ— æ³•å®‰è£…æˆåŠŸï¼Œå¦‚ä¸‹å›¾ï¼š<br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins.cah.png" alt=""></figure></p>
<p>å¤åˆ¶å®‰è£…å¤±è´¥çš„åç§°ï¼Œç‚¹å‡»å³ä¾§æŒ‰é’®ï¼Œé€‰æ‹©å¯é€‰æ’ä»¶ï¼Œè¾“å…¥åç§°é‡æ–°å®‰è£…ã€‚</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins.ansible.1.png" alt=""></figure></p>
<p>å¦‚æœè¿˜æ˜¯å¤±è´¥ï¼Œè¯·æ³¨æ„æç¤ºä¿¡æ¯ï¼Œå¯ç›´æ¥ä¸‹è½½è¯¥æ’ä»¶æ‰‹åŠ¨ä¸Šä¼ å®‰è£…ï¼Œæ‰‹åŠ¨ä¸‹è½½è¯¥æ’ä»¶ï¼Œåœ¨æ’ä»¶ç®¡ç†çš„é«˜çº§æ ‡ç­¾ä¸­ï¼Œé€‰æ‹©ä¸Šä¼ å®‰è£…ã€‚</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins.ansible.2.png" alt=""></figure><br>å¦‚æœä¸Šä¼ å¤±è´¥ï¼Œè¿˜æœ‰ä¸ªæ–¹æ³•ï¼šç›´æ¥æŠŠä¸‹è½½ä¸‹æ¥çš„æ’ä»¶ä¸Šä¼ åˆ°JenkinsæœåŠ¡å™¨ä¸Šé¢ã€‚é»˜è®¤å®‰è£…çš„è¯ç›®å½•åœ¨ï¼š/root/.jenkins/plugins/  é‡å¯æœåŠ¡å³å¯.</p>
<h3 id="äº”-ç³»ç»Ÿè®¾ç½®ä»¥åŠä»‹ç»ï¼ˆå¯è·³è¿‡ï¼‰"><a href="#äº”-ç³»ç»Ÿè®¾ç½®ä»¥åŠä»‹ç»ï¼ˆå¯è·³è¿‡ï¼‰" class="headerlink" title="äº”. ç³»ç»Ÿè®¾ç½®ä»¥åŠä»‹ç»ï¼ˆå¯è·³è¿‡ï¼‰"></a>äº”. ç³»ç»Ÿè®¾ç½®ä»¥åŠä»‹ç»ï¼ˆå¯è·³è¿‡ï¼‰</h3><h4 id="1-1-ç³»ç»Ÿé…ç½®"><a href="#1-1-ç³»ç»Ÿé…ç½®" class="headerlink" title="1.1 ç³»ç»Ÿé…ç½®"></a>1.1 ç³»ç»Ÿé…ç½®</h4><p>è¿›å…¥é¦–é¡µç³»ç»Ÿç®¡ç†â€”&gt;ç³»ç»Ÿè®¾ç½®ã€‚</p>
<ol>
<li>é…ç½®maven</li>
<li>é…ç½®é‚®ä»¶æœåŠ¡<br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins.ansible.3.png" alt=""></figure> </li>
</ol>
<p>ä¸»ç›®å½•é»˜è®¤åœ¨ /root/.jenkins  ä¸‹é¢ï¼Œæ­¤ç›®å½•ä¿å­˜jenkins çš„æ‰€æœ‰é…ç½®å’Œæ’ä»¶ç­‰ï¼Œå…·ä½“å¯ä»¥äºæœåŠ¡å™¨ä¸­æŸ¥çœ‹è¯¥ç›®å½•ã€‚<br>ä¸‹é¢å¯ä»¥ç»§ç»­é…ç½®mavenï¼Œjdkï¼Œgitç­‰ç­‰ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨é»˜è®¤çš„é…ç½®ã€‚</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins.ansible.4.png" alt=""></figure><br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins.ansible.5.png" alt=""></figure></p>
<h4 id="1-2-é¡¹ç›®é…ç½®"><a href="#1-2-é¡¹ç›®é…ç½®" class="headerlink" title="1.2 é¡¹ç›®é…ç½®"></a>1.2 é¡¹ç›®é…ç½®</h4><p>æ–°å»ºä¸€ä¸ªè‡ªç”±é£æ ¼çš„é¡¹ç›®ï¼Œè¾“å…¥é¡¹ç›®åç§°ã€‚</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins.ansible.6.png" alt=""></figure><br>1.å‚æ•°é…ç½®</p>
<p>ç®€å•çš„ä»Gitä¸­æ‹‰å–ä»£ç æ— æ³•æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œæœ€ç†æƒ³çš„çŠ¶æ€æ˜¯å¯ä»¥å¯¹å‘å¸ƒçš„åˆ†æ”¯è¿›è¡ŒåŠ¨æ€é€‰æ‹©ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦å®‰è£…ä¸€ä¸ªé…ç½®åŠ¨æ€å‚æ•°çš„æ’ä»¶ï¼š<a href="https://wiki.jenkins-ci.org/display/JENKINS/Dynamic+Parameter+Plug-in" target="_blank" rel="external">Dynamic Parameter Plug-in</a> </p>
<p>å®‰è£…å¥½æ’ä»¶ä¹‹åï¼Œåœ¨é¡¹ç›®é…ç½®ï¼Œå‚æ•°åŒ–æ„å»ºè¿‡ç¨‹ä¸­æ·»åŠ åŠ¨æ€å‚æ•°ï¼š</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins.ansible.7.png" alt=""></figure><br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins.ansible.8.png" alt=""></figure></p>
<p>è¾“å…¥å˜é‡åç§°å’Œè„šæœ¬ï¼Œåœ¨æ¥ä¸‹æ¥çš„é…ç½®ä¸­å°±å¯ä»¥ä½¿ç”¨<code>$Name</code>çš„æ–¹å¼ï¼Œä½¿ç”¨å˜é‡äº†ã€‚å¦‚ï¼š<code>$branch</code>ã€‚</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins.ansible.9.png" alt=""></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">def gettags = (<span class="string">"git ls-remote -h git@gitlab.ihaozhuo.com:Java_Service/YJK-Java.git"</span>).execute() </div><div class="line">gettags.text.readLines().collect &#123; it.split()[1].replaceAll(<span class="string">'refs/heads/'</span>, <span class="string">''</span>)  &#125;.unique()</div></pre></td></tr></table></figure>
<p> è¿™æ˜¯ä¸€æ®µ<code>Groovy</code>è„šæœ¬ï¼Œç”¨æ¥è·å–Gitåœ°å€çš„åˆ†æ”¯ï¼Œå°†Gitåœ°å€æ”¹æˆè‡ªå·±çš„å°±è¡Œã€‚</p>
<h4 id="1-3æ¥ä¸‹æ¥é€‰æ‹©æ‰©å±•åŠŸèƒ½ã€‚"><a href="#1-3æ¥ä¸‹æ¥é€‰æ‹©æ‰©å±•åŠŸèƒ½ã€‚" class="headerlink" title="1.3æ¥ä¸‹æ¥é€‰æ‹©æ‰©å±•åŠŸèƒ½ã€‚"></a>1.3æ¥ä¸‹æ¥é€‰æ‹©æ‰©å±•åŠŸèƒ½ã€‚</h4><p>ç”±äºæˆ‘ä»¬çš„é¡¹ç›®æ¨¡å—è¾ƒå¤šï¼Œæ‰€æœ‰çš„æœåŠ¡å…¨éƒ¨é‡å¯ä¼šéå¸¸æµªè´¹æ—¶é—´ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¯¹å•ç‹¬çš„æ¨¡å—è¿›è¡Œéƒ¨ç½²ï¼Œè¿™æ—¶å€™éœ€è¦æ·»åŠ ä¸€ä¸ªå¯é€‰æ‹©çš„å‚æ•°<code>Extensible Choice Parameter</code></p>
<p>æ‰©å±•é€‰æ‹©å‚æ•°æ’ä»¶<code>Extensible Choice Parameter</code>çµæ´»ä½¿ç”¨å®ç°éƒ¨ç½²å¤šåº”ç”¨æ¨¡å—æœåŠ¡åŒæ—¶å‘å¸ƒ.å•æ¨¡å—æœåŠ¡å•ç‹¬æ‰“åŒ…å¿«é€Ÿå‘å¸ƒ.</p>
<p>å®ç°æ•ˆæœï¼š</p>
<p>å‘å¸ƒé€‰æ‹©åº”ç”¨æ¨¡å—ï¼Œä¹‹å‰åªèƒ½å•ä¸ªé€‰æ‹©å‘å¸ƒï¼Œæ•ˆç‡å¤ªä½ï¼Œå®‰è£…choiceæ‰©å±•æ€§çš„æ’ä»¶ï¼Œå¯ä»¥é€‰æ‹©å¤šä¸ªæ¨¡å—åº”ç”¨ä¸€èµ·éƒ¨ç½²ã€‚éå¸¸æ–¹ä¾¿<br>ä¸‹è½½æ’ä»¶ï¼š<br><a href="https://plugins.jenkins.io/extended-choice-parameter" target="_blank" rel="external">Extended Choice Parameter Plug-In</a><br><a href="https://plugins.jenkins.io/extensible-choice-parameter" target="_blank" rel="external">Extensible Choice Parameter plugin</a></p>
<p>è¿™é‡Œjenkins ç¬¬ä¸€æ­¥å®‰è£…æ‰©å±•æ’ä»¶ï¼š</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins.peizhi.1.png" alt=""></figure><br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins.peizhi.2.png" alt=""></figure><br>å®‰è£…å¥½æ’ä»¶ä»¥å è¿›å…¥åˆ›å»ºé¡¹ç›®é…ç½®å‚æ•°ï¼š</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins.peizhi.3.png" alt=""></figure></p>
<p><code>Value</code> ï¼šè¿™é‡Œé€‰æ‹©æ¨¡å—åå­—æœ€å¥½æ˜¯gitæ‹‰å–ä¸‹æ¥çš„åç§°ä¸€æ ·ã€‚è¿™æ ·ä¸‹é¢æ‰“åŒ…å¯ä»¥é€‰æ‹©å¯¹åº”æ¨¡å—åç§°ä¸€æ ·ã€‚<br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins.peizhi.4.png" alt=""></figure></p>
<p>è¿™é‡Œæ„å»ºä½¿ç”¨shell åšä¸€å±‚<code>if</code> åˆ¤æ–­  é€‰æ‹©<code>all</code> å…¨éƒ¨å‘å¸ƒã€‚å’Œå•ç‹¬æ¨¡å—å‘å¸ƒã€‚</p>
<h4 id="1-4Gité…ç½®"><a href="#1-4Gité…ç½®" class="headerlink" title="1.4Gité…ç½®"></a>1.4Gité…ç½®</h4><p>åˆæ¬¡ä½¿ç”¨Jenkinséœ€è¦æ·»åŠ ä¸€ä¸ªæœ‰è®¿é—®Gitæƒé™çš„ç”¨æˆ·ã€‚<br>æˆ‘ç›´æ¥ä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„ssh-keyï¼Œä¹Ÿå¯ä»¥è‡ªå·±å»ç”Ÿæˆã€‚<br>åœ¨gitlabä¸Šæ·»åŠ ssh-keyå…¬é’¥ è¿™ä¸ªæ˜¯ä½ å‘å¸ƒæœºå™¨çš„å…¬é’¥ã€‚</p>
<p>1.æºç ç®¡ç†é€‰æ‹©Gitï¼Œè¾“å…¥URLï¼Œå¹¶é€‰æ‹©ç”¨æˆ·ã€‚</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins.ansible.10.png" alt=""></figure></p>
<p>ä»Jenkinså‘å¸ƒæœåŠ¡å™¨ä¸Šé¢æŸ¥çœ‹å…¬é’¥ä¸Šä¼ åˆ°gitlab.</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins.ansbile.11.png" alt=""></figure></p>
<p>2.åœ¨jenkinsä¸Šç‚¹å‡»æ·»åŠ ç§é’¥<br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins.ansible.12.png" alt=""></figure><br>3.é€‰æ‹©SSHâ€¦keyï¼Œè¾“å…¥ç”¨æˆ·åï¼Œè¾“å…¥ç§é’¥ï¼Œè¾“å…¥å¯†ç ï¼Œæ·»åŠ å®Œæˆã€‚<br>åœ¨Jenkinså‘å¸ƒæœåŠ¡å™¨ä¸Šé¢æŸ¥çœ‹ç§é’¥ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">[root@ansible_02 yaml]<span class="comment"># cat /root/.ssh/id_rsa</span></div><div class="line">-----BEGIN RSA PRIVATE KEY-----</div><div class="line">MIIEpAIBAAKCAQEAv5BSNmykQcvklQdb+3jV8d1I2tjq4tIiyVbQDhDBs6UFR4hj</div><div class="line">20EHg/3Tjvw+4mHtzWFYv1/rYeTg7xJ/bIf3XRIeRcrc/b2rvqo3wQBupRjHM6wb</div><div class="line">nd+Jgyv2v8Lk2c8yNzMoUIuYzcG5Dpv5mWyg1akbWcIH3tsGyTVXxxmAQ78L+J1N</div><div class="line">zj3a9fImQcx5ocKlV/Y1v9B+Uv4gTBmSBR7akvNg7E+3JKTphbbUv3rFrG6zqvTW</div><div class="line">CtEA/h9X//zPWTiwTjJv87NJkHQLqoo1TPYZcNjDEfki+jfc9gJzJvZ/5D0A3fA/</div><div class="line">mO8ApW9VMsaLiiwQvGP2RoiTVwU2G1iNASBcWwIDAQABAoIBABh64fawhYEfBDQD</div><div class="line">P77wHy8MXz4QUFvyDJ38KRRTEd3aLcWJaXFgawx0CHASThrx9sizMvspz9Ovwwrq</div><div class="line">Kzx8V6EeKp4yoXEPpv3zlLJmUr1oYDR7PwA6y8Dmgl7ZEhO/haRGNlWssTdCFVsH</div><div class="line">lasElb0YIjWjNQxGoyRdW71GxfxiGdZXgWDT7yYGvdavO5tGzDPhh6/vf5lpU2F2</div><div class="line">nJbMyXzWgrrqXqIG3W+jqg2kVA<span class="keyword">fi</span>MdNgeUOn6+SA/7uK8rNhxG/5dr7WKJE31uRS</div><div class="line">FJiVCATcHQBIRScDDd/nI8rGiVQOjHFt2oNV82DOIhNXhbzdWGROUcMiT04OoJgQ</div><div class="line">JeNL7IkCgYEA8wrgamw1w5dBoynzV6tUPgSdHhAMoMhPrzJTaG8qMamnHzZgz1fl</div><div class="line">3jqI7qCNsj1n6Y1UbzhKILHcTIoUj7lj41mY4XVBHqDLXh9Socf9IPrSabZIfe2n</div><div class="line">wMLMhdhoaMPUWtHj9SUn/Y+ESLuFLtF6LjR1Eghu8xKRwULo1GscSyUCgYEAycbY</div><div class="line">j1/KaFAcwSl7teRiYEY+LRHB/AUa7lc+r+p2YMjGQ3CiaN9wKqu1E4jEvL0eZXDK</div><div class="line">aXJ6qcDJiHa2M+Bf8qcVoyXtKFtlTfSVPJDviZjl3EPmhXbuKzW3et2w5zWv8lAU</div><div class="line">2fWU+3ta3fVrFXz2zlY1j47Dv9zUlDeCF+lRMX8CgYEA1hkKwDU612XzSEy4NM6U</div><div class="line">k111GvqAZVKP/4GRwDnNLZqJwhEhDwYbVLyzy6JbsFwvoaoCa0dm5Y5IxpQMsN9b</div><div class="line">Z9GGH7CWLEJ7a4gJmrYQYpECgYAIqe8WiOhp/jad3KghMUNAGwQEb2TC630yirB4</div><div class="line">YTrgAP7yWl2+3wkz69eElTTNXdl2RZeLW40EyPBeWaqNI686/g2hybkbKIF7DWtz</div><div class="line">BE4kvFnyUUAOrwKe/Fl6fxZfdyCs6N9cVH0nJy7JpQYKECmQxobaOSkSjerayl9d</div><div class="line">x1mI3d6fwqmAbbyiolLXbn3JySkxTaVBS8gjnQh6LO6JbpTspKlz3R2/CzUhDhEY</div><div class="line">n3vhU2trAGh6hY/bizI1oKNxwp/b9uAaLVmmHGNV/+V5glnDH+luQA==</div><div class="line">-----END RSA PRIVATE KEY-----</div></pre></td></tr></table></figure>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins.ansible.13.png" alt=""></figure></p>
<p>æ­¤å¤„è¦æ³¨æ„ï¼Œå°†é»˜è®¤çš„masteråˆ†æ”¯æ”¹ä¸ºæˆ‘ä»¬ä¹‹å‰å®šä¹‰å¥½çš„åˆ†æ”¯å˜é‡.<br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins.peizhi.5.png" alt=""></figure></p>
<h4 id="1-5é¡¹ç›®æ‰“åŒ…"><a href="#1-5é¡¹ç›®æ‰“åŒ…" class="headerlink" title="1.5é¡¹ç›®æ‰“åŒ…"></a>1.5é¡¹ç›®æ‰“åŒ…</h4><p>ç”±äºæˆ‘ä»¬ä½¿ç”¨æ‰‹åŠ¨å‡ºå‘æ„å»ºï¼Œè§¦å‘å™¨æˆ‘ä»¬æ­¤å¤„ä¸éœ€è¦é…ç½®ã€‚<br>æ„å»ºç¯å¢ƒæš‚æ—¶ä¹Ÿä¸éœ€è¦é…ç½®ï¼Œè¿™é‡Œè°ƒç”¨ansibleå»æ‰§è¡Œymlä»£ç å‘å¸ƒã€‚é¡¹ç›®æ‰“åŒ…ä¼˜åŒ–äº†ã€‚</p>
<p>å…³é”®åœ¨äºæ„å»ºçš„æ­¥éª¤ã€‚<br>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Shellå‘½ä»¤ï¼Œè¿›å…¥é¡¹ç›®ç›®å½•ï¼Œä½¿ç”¨Mavenå‘½ä»¤è¿›è¡Œæ‰“åŒ…ã€‚</p>
<p>è¿™é‡Œä¸»è¦æ˜¯<code>if</code> åˆ¤æ–­æ˜¯ æ‰§è¡Œå¯¹åº”æ¨¡å—æ‰“åŒ…ã€‚è¿™æ ·èŠ‚çœäº†æ‰“åŒ…æ—¶é—´ï¼Œå¦‚æœä¸åšå¯¹åº”å‘å¸ƒæ¨¡å—å‘å¸ƒï¼Œç¬¬ä¸€æ¡å¦‚ä½•<code>model</code>ç­‰äº<code>all</code> æ–‡ä»¶ï¼šå…¨éƒ¨æ‰§è¡Œ : <code>mvn clean install -U -T 1C -Dmaven.test.skip=true</code></p>
<p>å¦‚æœä¸ç­‰äºè¿™é‡ŒæŒ‡å®šå¯¹åº”æ¨¡å—æ‰“åŒ…ï¼š <code>mvn clean install -pl $model -amd -U -T 1C -Dmaven.test.skip=true</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">echo</span> <span class="variable">$model</span></div><div class="line"><span class="keyword">if</span> [[ <span class="variable">$model</span> == all* ]]; <span class="keyword">then</span></div><div class="line"><span class="built_in">cd</span> /srv/ &amp;&amp; rm dev-properties/ -rf &amp;&amp; git <span class="built_in">clone</span> git@gitlab.ihaozhuo.com:dev-properties/dev-properties.git &amp;&amp; <span class="built_in">cd</span> /root/.jenkins/workspace/yjk-dev_master/haozhuo/ &amp;&amp; mvn clean install -U -T 1C -Dmaven.test.skip=<span class="literal">true</span>  -Dmaven.compile.fork=<span class="literal">true</span> -Pdev -Dautoconfig.userProperties=/srv/dev-properties/dev1.properties -Dautoconfig.charset=utf-8</div><div class="line"><span class="keyword">else</span></div><div class="line"><span class="built_in">cd</span> /srv/ &amp;&amp; rm dev-properties/ -rf &amp;&amp; git <span class="built_in">clone</span> git@gitlab.ihaozhuo.com:dev-properties/dev-properties.git &amp;&amp; <span class="built_in">cd</span> /root/.jenkins/workspace/yjk-dev_master/haozhuo/ &amp;&amp; mvn clean install -pl <span class="variable">$model</span> -amd -U -T 1C -Dmaven.test.skip=<span class="literal">true</span>  -Dmaven.compile.fork=<span class="literal">true</span> -Pdev -Dautoconfig.userProperties=/srv/dev-properties/dev1.properties -Dautoconfig.charset=utf-8</div><div class="line"><span class="keyword">fi</span></div></pre></td></tr></table></figure>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins.peizhi.6.png" alt=""></figure></p>
<p>æ‰€æœ‰çš„è„šæœ¬å’Œå˜é‡çš„å‚æ•°åˆ—è¡¨ç»Ÿä¸€ã€‚</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins.peizhi8.png" alt=""></figure></p>
<p>è¿™é‡Œè¯´ä¸‹å‘å¸ƒæ¨¡å— ç»“åˆ<code>ansible-Playbook</code>åŸºæœ¬è¯­æ³•å†™æ§åˆ¶å‘å¸ƒæœåŠ¡å™¨ï¼Œç„¶ååœ¨<code>jenkins</code>ä¸Šé¢å†™ansible å‘å¸ƒè„šæœ¬&amp;å‘½ä»¤ã€‚<br>model.sh è„šæœ¬ï¼š </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/bin/sh</span></div><div class="line">  IFS=<span class="string">','</span></div><div class="line">  arr=<span class="variable">$1</span></div><div class="line">  <span class="keyword">for</span> split <span class="keyword">in</span> <span class="variable">$arr</span></div><div class="line">  <span class="keyword">do</span></div><div class="line">          <span class="built_in">echo</span> <span class="variable">$split</span></div><div class="line">       /usr/bin/ansible-playbook /srv/yaml/<span class="variable">$split</span>.yml</div><div class="line">          <span class="keyword">if</span> [ <span class="variable">$split</span> = <span class="string">'all'</span> ]</div><div class="line">          <span class="keyword">then</span></div><div class="line">                  <span class="built_in">echo</span> <span class="string">"model:all"</span></div><div class="line">                  <span class="built_in">break</span></div><div class="line">          <span class="keyword">fi</span></div><div class="line">  <span class="keyword">done</span></div></pre></td></tr></table></figure>
<p>è¿™é‡Œä¸¾ä¸ªä¾‹å­æˆ‘ä¸Šé¢å‘å¸ƒymlæ¨¡å—ä»£ç ã€‚</p>
<p>è¿™ä¸ªè„šæœ¬åšäº†äº”ä»¶äº‹ï¼š<br>1)               é¦–å…ˆæŒ‡å®šç¼–ç ä¸ºUTF-8ï¼ˆå¦åˆ™å¯åŠ¨é¡¹ç›®åä¼šä¹±ç ï¼è¿™æ˜¯ä¸ªå‘!ï¼‰<br>2)               æ‹·è´æ–‡ä»¶åˆ°æŒ‡å®šæœºå™¨çš„ç›®å½•ä¸‹ï¼Œæ‹·è´å‘½ä»¤çš„destä¸èƒ½ä½¿ç”¨å˜é‡ï¼å¦åˆ™æ‹·è´ä¸ä¼šæˆåŠŸï¼ï¼ˆç¬¬äºŒä¸ªå‘ï¼‰<br>3)               é‡å¯è¿œç¨‹æœåŠ¡ï¼Œæˆ‘ä»¬è¯•è¿‡ç›´æ¥é‡å¯tomcatæœåŠ¡ï¼Œè™½ç„¶æœåŠ¡é‡å¯ä¼šæˆåŠŸï¼Œä½†æ˜¯æœ€åä¼šæŠ¥ä¸€ä¸ªé”™è¯¯ï¼Œå¯¼è‡´é¡¹ç›®ç¼–ç æ— æ³•æŒ‡å®šä¸ºUTF-8ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜æ˜¯é€‰æ‹©ä½¿ç”¨Shellè„šæœ¬å»é‡å¯æœåŠ¡ï¼ˆç¬¬ä¸‰ä¸ªå‘ï¼‰ã€‚<br>4ï¼‰          è¿›è¡Œåˆ›å»ºç›®å½•å¤‡ä»½ã€‚<br>5ï¼‰          æŸ¥çœ‹è¿›ç¨‹åå°å¯åŠ¨ã€‚</p>
<p>Ansibleè„šæœ¬ç¼–å†™å®Œä¹‹åï¼Œå¯ä»¥ç°åœ¨è‡ªå·±æœ¬æœºä¸Šæ‰§è¡Œä¸€ä¸‹ã€‚<br>ç›®æ ‡æœºå™¨ä¸Šå¿…é¡»å®‰è£…libselinux-pythonï¼Œä¸ç„¶æ— æ³•æ‰§è¡ŒæˆåŠŸï¼ˆå°å‘ï¼‰ã€‚</p>
<p>åœ¨jenkinsä¸­æˆ‘ä»¬åšå¦‚ä¸‹é…ç½®ï¼š<br>åœ¨æ„å»ºæ‰“åŒ…å‘½ä»¤åé¢æˆ‘ä»¬å¢åŠ ä¸€ä¸ªShellå‘½ä»¤ï¼Œç”¨æ¥æ‰§è¡ŒAnsibleçš„è„šæœ¬ã€‚<br>æˆ‘ä»¬è„šæœ¬åç§°ä½¿ç”¨å˜é‡åç§°ï¼Œè¿™æ ·æˆ‘ä»¬é€‰æ‹©æ¨¡å—å°±èƒ½æ‰§è¡Œå¯¹åº”çš„è„šæœ¬ã€‚</p>
<h4 id="1-6å‘é€é‚®ä»¶"><a href="#1-6å‘é€é‚®ä»¶" class="headerlink" title="1.6å‘é€é‚®ä»¶"></a>1.6å‘é€é‚®ä»¶</h4><p>é…ç½®å¥½æ„å»ºå¤±è´¥åå‘é€é‚®ä»¶åˆ°æŒ‡å®šçš„é‚®ç®±ï¼Œå¤šä¸ªé‚®ç®±ç”¨é€—å·éš”å¼€ã€‚</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins.peizhi.7.png" alt=""></figure></p>
<p>è‡³æ­¤é¡¹ç›®é…ç½®ç»“æŸã€‚</p>
<h4 id="å…­-è¿è¡Œæ•ˆæœï¼Œæ‰“åŒ…æ•ˆæœã€‚"><a href="#å…­-è¿è¡Œæ•ˆæœï¼Œæ‰“åŒ…æ•ˆæœã€‚" class="headerlink" title="å…­.è¿è¡Œæ•ˆæœï¼Œæ‰“åŒ…æ•ˆæœã€‚"></a>å…­.è¿è¡Œæ•ˆæœï¼Œæ‰“åŒ…æ•ˆæœã€‚</h4><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins.peizhi.9.png" alt=""></figure><br>æŒ‡å®šæ¨¡å—å»æ‰“åŒ…ï¼Œç»ˆç«¯ä¸ŠæŸ¥çœ‹å‘å¸ƒæ—¥å¿— è¿™é‡Œå˜é‡ç”Ÿæ•ˆæ•ˆæœï¼š<br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins.peizhi.10.png" alt=""></figure></p>
<h3 id="ä¸ƒ-Jenkinså»¶ä¼¸å­¦ä¹ "><a href="#ä¸ƒ-Jenkinså»¶ä¼¸å­¦ä¹ " class="headerlink" title="ä¸ƒ. Jenkinså»¶ä¼¸å­¦ä¹ "></a>ä¸ƒ. Jenkinså»¶ä¼¸å­¦ä¹ </h3><p>æ•ˆæœå›¾ï¼š</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/jenkins_05.png" alt=""></figure></p>
<p><code>Blue Ocean</code> æ˜¯<code>Jenkins</code> éå¸¸ä¸é”™ä¸€ä¸ªæå‡ã€‚</p>
<p>è¿™é‡Œå¯ä»¥æŸ¥çœ‹ä¸‹æˆ‘åœ¨æˆ‘githubä¸Šé¢æ‰©å±•<a href="https://github.com/yangcvo/Jenkins-automation" target="_blank" rel="external">æ›´æ–°jenkinsæ–°åŠŸèƒ½Blue Oceanå®ç°å…ˆè¿›çš„å¯è§†åŒ–ç²¾ç¡®å®šä½é—®é¢˜</a></p>
<p>ç°åœ¨æˆ‘ä»¬Gitä½¿ç”¨çš„æ˜¯ GitLabï¼ŒåŒæ—¶ä¸ºäº†å®‰å…¨æˆ‘ä»¬åšäº†ä¸€å±‚LDAPä»£ç†ï¼Œæ•ˆæœç›¸å½“äºâ€œå°†å†›ä»¤â€ï¼Œæ“ä½œæœºã€Gitå’ŒJenkinsç”¨ OpenLDAP åšç»Ÿä¸€è®¤è¯ï¼Œåç»­ç”¨åˆ°çš„Redmineã€Grafanaã€Zabbix ç­‰éƒ½æ¥å…¥äº†OpenLDAPè®¤è¯ï¼Œæ¯ä¸ªäººéƒ½æœ‰ä¸ªåŠ¨æ€å£ä»¤ï¼Œæ¯æ¬¡éªŒè¯éƒ½éœ€è¦ç”¨åˆ°ã€‚</p>

	

	

</article>




	<article>
	
		<h1><a href="/2016/08/23/WebæœåŠ¡æŠ€æœ¯/Nginx/ä¼ä¸šçº§Nginx WebæœåŠ¡ä¼˜åŒ–å®æˆ˜/">ä¼ä¸šçº§Nginx WebæœåŠ¡ä¼˜åŒ–å®æˆ˜</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-08-23</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/nginx/">nginx</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Nginx/">Nginx</a> <a class="article__tag-link" href="/tags/Web-Service/">Web Service</a>
			</span>
		
	</div>

	

	
		<h3 id="ä¼ä¸šçº§Nginx-WebæœåŠ¡ä¼˜åŒ–å®æˆ˜"><a href="#ä¼ä¸šçº§Nginx-WebæœåŠ¡ä¼˜åŒ–å®æˆ˜" class="headerlink" title="ä¼ä¸šçº§Nginx WebæœåŠ¡ä¼˜åŒ–å®æˆ˜"></a>ä¼ä¸šçº§Nginx WebæœåŠ¡ä¼˜åŒ–å®æˆ˜</h3><h5 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€:"></a>å‰è¨€:</h5><p>  åœ¨è¿ç»´å·¥ä½œå·²ç»3ä¸ªå¹´ï¼Œè¿ç»´å²—ä½ï¼šå¯¹webæœåŠ¡æ˜¯å¿…é¡»è¦ä¼šçš„ï¼Œè¿™æ¬¡æˆ‘å¯¹Nginx WebæœåŠ¡åšä¸€æ¬¡ä¼˜åŒ–æ€»ç»“ï¼Œä¸Šæ¬¡è®°å¾—å†™åšå®¢æ˜¯å¯¹Nginxé…ç½®è¯¦è§£å’ŒæœåŠ¡çš„é«˜å¯ç”¨ã€‚å¸Œæœ›å†™çš„å¯¹ä½ çœ‹åˆ°æˆ‘åšå®¢çš„äººæœ‰æ‰€å¸®åŠ©ã€‚</p>
<h5 id="1-1-Nginx-åŸºæœ¬å®‰å…¨ä¼˜åŒ–"><a href="#1-1-Nginx-åŸºæœ¬å®‰å…¨ä¼˜åŒ–" class="headerlink" title="1.1 Nginx åŸºæœ¬å®‰å…¨ä¼˜åŒ–"></a>1.1 Nginx åŸºæœ¬å®‰å…¨ä¼˜åŒ–</h5><h6 id="1-1-2-è°ƒæ•´å‚æ•°éšè—Nginxè½¯ä»¶ç‰ˆæœ¬å·ä¿¡æ¯"><a href="#1-1-2-è°ƒæ•´å‚æ•°éšè—Nginxè½¯ä»¶ç‰ˆæœ¬å·ä¿¡æ¯" class="headerlink" title="1.1.2 è°ƒæ•´å‚æ•°éšè—Nginxè½¯ä»¶ç‰ˆæœ¬å·ä¿¡æ¯"></a>1.1.2 è°ƒæ•´å‚æ•°éšè—Nginxè½¯ä»¶ç‰ˆæœ¬å·ä¿¡æ¯</h6><p> è¿™é‡Œè¯´éšè—ç‰ˆæœ¬å·é‡è¦æ€§è½¯ä»¶å‡ºç°æ¼æ´è·Ÿç‰ˆæœ¬ç‰¹åˆ«æœ‰å…³ç³»ï¼Œæˆ‘ä»¬å°½å¯èƒ½éšè—æˆ–æ¶ˆé™¤webæœåŠ¡é˜Ÿè®¿é—®ç”¨æˆ·æ˜¾ç¤ºå„ç±»æ•æ„Ÿä¿¡æ¯ï¼Œè¿™æ ·æ¶æ„è¦æ”»å‡»ä½ çš„ç”¨æˆ·å°±å¾ˆéš¾çŒœåˆ°ä»–æ”»å‡»çš„æœåŠ¡æ‰€ç”¨çš„æ˜¯å¦æœ‰ç‰¹å®šçš„æ¼æ´çš„è½¯ä»¶ï¼Œæˆ–è€…æ˜¯å¦æœ‰å¯¹åº”æ¼æ´çš„æŸä¸€ç‰¹å®šç‰ˆæœ¬ï¼Œä»è€ŒåŠ å¼ºäº†WebæœåŠ¡çš„å®‰å…¨æ€§ã€‚</p>
<p> ä¾‹å­ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[root@nginx ~]<span class="comment"># curl -I 127.0.0.7 </span></div><div class="line">HTTP/1.1 200 OK</div><div class="line">Server: nginx/1.9.7   <span class="comment">#&lt;--è¿™é‡Œæ¸…æ™°åœ°æš´éœ²äº†webç‰ˆæœ¬å·ï¼ˆ1.9.7ï¼‰ä»¥åŠè½¯ä»¶åç§°ï¼ˆNginxï¼‰</span></div><div class="line">Date: Sat, 08 Apr 2017 08:15:59 GMT</div><div class="line">Content-Type: text/html</div><div class="line">Content-Length: 612</div><div class="line">Last-Modified: Thu, 19 Nov 2015 05:50:20 GMT</div><div class="line">Connection: keep-alive</div><div class="line">ETag: <span class="string">"564d631c-264"</span></div><div class="line">Accept-Ranges: bytes</div></pre></td></tr></table></figure>
<p>å¦‚ä½•éšè—å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶åŠ å‚æ•°æ¥å®ç°ï¼š</p>
<p>åœ¨Nginxé…ç½®æ–‡ä»¶Nginx.conf ä¸­çš„serveræ ‡ç­¾ğŸ·å†…åŠ å…¥<code>â€œserver_tokens offâ€</code>å‚æ•°ï¼Œå…·ä½“æŸ¥çœ‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">server &#123;</div><div class="line">      listen       80;</div><div class="line">      server_name  localhost;</div><div class="line">      server_tokens off;</div><div class="line"></div><div class="line">      location / &#123;</div><div class="line">          root   html;</div><div class="line">          index  index.html index.htm;</div><div class="line">      limit_req  zone=one;</div><div class="line">      &#125;</div></pre></td></tr></table></figure>
<p> é…ç½®å®Œæˆåä¿å­˜ï¼Œé‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ï¼Œå†æ¬¡curlæŸ¥çœ‹ï¼š</p>
<pre><code class="bash"> [root@nginx ~]<span class="comment"># curl -I 127.0.0.7</span>
HTTP/1.1 200 OK
Server: nginx
Date: Sat, 08 Apr 2017 08:20:31 GMT
Content-Type: text/html
Content-Length: 612
Last-Modified: Thu, 19 Nov 2015 05:50:20 GMT
Connection: keep-alive
ETag: <span class="string">"564d631c-264"</span>
Accept-Ranges: bytes
</code></pre>

	

	

</article>




	<article>
	
		<h1><a href="/2016/08/23/WebæœåŠ¡æŠ€æœ¯/Nginx/Nginx çš„å¯åŠ¨ã€åœæ­¢ã€å¹³æ»‘é‡å¯ã€ä¿¡å·æ§åˆ¶å’Œå¹³æ»‘å‡çº§ /">Nginx çš„å¯åŠ¨ã€åœæ­¢ã€å¹³æ»‘é‡å¯ã€ä¿¡å·æ§åˆ¶å’Œå¹³æ»‘å‡çº§</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-08-23</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/nginx/">nginx</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Nginx/">Nginx</a> <a class="article__tag-link" href="/tags/Web-Service/">Web Service</a>
			</span>
		
	</div>

	

	
		<h1 id="Nginx-çš„å¯åŠ¨ã€åœæ­¢ã€å¹³æ»‘é‡å¯ã€ä¿¡å·æ§åˆ¶å’Œå¹³æ»‘å‡çº§"><a href="#Nginx-çš„å¯åŠ¨ã€åœæ­¢ã€å¹³æ»‘é‡å¯ã€ä¿¡å·æ§åˆ¶å’Œå¹³æ»‘å‡çº§" class="headerlink" title="Nginx çš„å¯åŠ¨ã€åœæ­¢ã€å¹³æ»‘é‡å¯ã€ä¿¡å·æ§åˆ¶å’Œå¹³æ»‘å‡çº§"></a>Nginx çš„å¯åŠ¨ã€åœæ­¢ã€å¹³æ»‘é‡å¯ã€ä¿¡å·æ§åˆ¶å’Œå¹³æ»‘å‡çº§</h1><h2 id="Nginxçš„å¯åŠ¨"><a href="#Nginxçš„å¯åŠ¨" class="headerlink" title="Nginxçš„å¯åŠ¨"></a>Nginxçš„å¯åŠ¨</h2><p>å‡è®¾ nginx å®‰è£…åœ¨<code>/usr/local/nginx</code> ç›®å½•ä¸­ï¼Œé‚£ä¹ˆå¯åŠ¨ nginx çš„å‘½ä»¤å°±æ˜¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@Nginx_01 ~]<span class="comment"># /usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf</span></div></pre></td></tr></table></figure>
<p>å‚æ•°<code>&quot;-c&quot;</code> æŒ‡å®šäº†é…ç½®æ–‡ä»¶çš„è·¯å¾„ï¼Œå¦‚æœä¸åŠ <code>&quot;-c&quot;</code>å‚æ•°ï¼ŒNginx ä¼šé»˜è®¤åŠ è½½å…¶å®‰è£…ç›®å½•çš„ conf å­ç›®å½•ä¸­çš„ nginx.conf æ–‡ä»¶ã€‚</p>
<h2 id="Nginxçš„åœæ­¢"><a href="#Nginxçš„åœæ­¢" class="headerlink" title="Nginxçš„åœæ­¢"></a>Nginxçš„åœæ­¢</h2><p>nginx çš„åœæ­¢æ–¹æ³•æœ‰å¾ˆå¤šï¼Œä¸€èˆ¬é€šè¿‡å‘é€ç³»ç»Ÿä¿¡å·ç»™ nginx çš„ä¸»è¿›ç¨‹çš„æ–¹å¼æ¥åœæ­¢ nginxã€‚ </p>
<blockquote>
<p>1ã€ä»å®¹åœæ­¢Nginx</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@Nginx_01 ~]<span class="comment"># kill -QUIT ã€Nginxä¸»è¿›ç¨‹å·ã€‘</span></div><div class="line">æˆ–è€…</div><div class="line">[root@Nginx_01 ~]<span class="comment"># kill -QUIT `/usr/local/nginx/logs/nginx.pid`</span></div></pre></td></tr></table></figure>
<p>å­—ç¬¦æ˜¯æ•°å­—é”®ç›˜ 1 å­—ç¬¦å·¦è¾¹çš„é‚£ä¸ªå­—ç¬¦ï¼Œä¸éœ€è¦ Shiftï¼Œç›´æ¥æŒ‰ ` å­—ç¬¦å³å¯ã€‚<br>å¦‚æœåœ¨ nginx.conf é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šäº† pid æ–‡ä»¶å­˜æ”¾çš„è·¯å¾„ï¼Œè¯¥æ–‡ä»¶ä¸­å­˜æ”¾çš„å°±æ˜¯ nginx å½“å‰çš„ä¸»è¿›ç¨‹å·ã€‚é»˜è®¤æ˜¯æ”¾åœ¨ nginx å®‰è£…ç›®å½•çš„ logs ç›®å½•ä¸‹ã€‚</p>
<blockquote>
<p>2ã€å¿«é€Ÿåœæ­¢Nginx</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@Nginx_01 ~]<span class="comment"># kill -TERM ã€Nginxä¸»è¿›ç¨‹å·ã€‘</span></div><div class="line">æˆ–è€…</div><div class="line">[root@Nginx_01 ~]<span class="comment"># kill -INT ã€Nginxä¸»è¿›ç¨‹å·ã€‘  </span></div><div class="line">``` </div><div class="line">&gt;3ã€å¼ºåˆ¶åœæ­¢æ‰€æœ‰ nginx è¿›ç¨‹ </div><div class="line"></div><div class="line">```bash</div><div class="line">[root@Nginx_01 ~]<span class="comment"># pkill -9 nginx</span></div></pre></td></tr></table></figure>
<h2 id="Nginxçš„å¹³æ»‘å¯åŠ¨"><a href="#Nginxçš„å¹³æ»‘å¯åŠ¨" class="headerlink" title="Nginxçš„å¹³æ»‘å¯åŠ¨"></a>Nginxçš„å¹³æ»‘å¯åŠ¨</h2><p>å¦‚æœæ”¹å˜äº† nginx çš„é…ç½®æ–‡ä»¶ï¼Œæƒ³é‡å¯ nginxï¼ŒåŒæ ·å¯ä»¥å‘é€ç³»ç»Ÿä¿¡å·ç»™ nginx ä¸»è¿›ç¨‹çš„æ–¹å¼æ¥è¿›è¡Œã€‚ä¸è¿‡ï¼Œé‡å¯ä¹‹å‰ï¼Œè¦ç¡®è®¤ nginx é…ç½®æ–‡ä»¶çš„è¯­æ³•æ˜¯å¦æ­£ç¡®çš„ã€‚å¦åˆ™ nginx å°†ä¸ä¼šåŠ è½½æ–°çš„é…ç½®æ–‡ä»¶ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥åˆ¤æ–­é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -t å‚æ•°å°†æ£€æŸ¥é…ç½®æ–‡ä»¶çš„è¯­æ³•æ˜¯å¦æ­£ç¡®ï¼Œé»˜è®¤ä¼šæ£€æŸ¥ /usr/local/nginx/conf/nginx.conf æ–‡ä»¶ã€‚  </span></div><div class="line">[root@Nginx_01 ~]<span class="comment"># /usr/local/nginx/sbin/nginx -t  </span></div><div class="line"><span class="comment"># å¦‚æœè¦å¯¹æŒ‡å®šçš„é…ç½®æ–‡ä»¶è¿›è¡Œè¯­æ³•æ£€æŸ¥ï¼Œå¯ä»¥ç»§ç»­æ·»åŠ  -c å‚æ•°  </span></div><div class="line">[root@Nginx_01 ~]<span class="comment"># /usr/local/nginx/sbin/nginx -t -c /usr/local/nginx/conf/nginx.conf</span></div><div class="line"> </div><div class="line">è¿™ä¸ªæ—¶å€™ï¼Œå°±å¯ä»¥å¹³æ»‘é‡å¯ nginx äº†ã€‚</div><div class="line"> </div><div class="line">[root@Nginx_01 ~]<span class="comment"># kill -HUP ã€Nginxä¸»è¿›ç¨‹å·ã€‘ </span></div><div class="line">å½“ nginx æ¥æ”¶åˆ° HUP ä¿¡å·æ—¶ï¼Œå®ƒä¼šå°è¯•å…ˆè§£æé…ç½®æ–‡ä»¶ï¼Œå¦‚æœæˆåŠŸï¼Œå°±åº”ç”¨æ–°çš„é…ç½®æ–‡ä»¶(ä¾‹å¦‚ï¼Œé‡æ–°æ‰“å¼€æ—¥å¿—æ–‡ä»¶æˆ–ç›‘å¬çš„å¥—æ¥å­—)ã€‚ä¹‹åï¼Œnginx è¿è¡Œæ–°çš„å·¥ä½œè¿›ç¨‹å¹¶ä»å®¹å…³é—­æ—§çš„å·¥ä½œè¿›ç¨‹ã€‚é€šçŸ¥å·¥ä½œè¿›ç¨‹å…³é—­ç›‘å¬å¥—æ¥å­—ï¼Œä½†æ˜¯ç»§ç»­ä¸ºå½“å‰è¿æ¥çš„å®¢æˆ·æä¾›æœåŠ¡ã€‚æ‰€æœ‰çš„å®¢æˆ·ç«¯çš„æœåŠ¡å®Œæˆåï¼Œæ—§çš„å·¥ä½œè¿›ç¨‹è¢«å…³é—­ã€‚å¦‚æœæ–°çš„é…ç½®æ–‡ä»¶åº”ç”¨å¤±è´¥ï¼Œnginx å°†ç»§ç»­ä½¿ç”¨æ—§çš„é…ç½®æ–‡ä»¶è¿›è¡Œå·¥ä½œã€‚</div></pre></td></tr></table></figure>
<h2 id="Nginx-çš„å¹³æ»‘å‡çº§"><a href="#Nginx-çš„å¹³æ»‘å‡çº§" class="headerlink" title="Nginx çš„å¹³æ»‘å‡çº§"></a>Nginx çš„å¹³æ»‘å‡çº§</h2><p>å½“éœ€è¦å°†æ­£åœ¨è¿è¡Œä¸­çš„ nginx å‡çº§ã€æ·»åŠ /åˆ é™¤æœåŠ¡å™¨æ¨¡å—æ—¶ï¼Œå¯ä»¥åœ¨ä¸ä¸­æ–­æœåŠ¡çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨æ–°ç‰ˆæœ¬ã€é‡ç¼–è¯‘çš„ nginx å¯æ‰§è¡Œç¨‹åºæ›¿æ¢æ—§ç‰ˆæœ¬çš„è¯¾æ‰§è¡Œç¨‹åºã€‚æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">(1) ä½¿ç”¨æ–°çš„å¯æ‰§è¡Œç¨‹åºæ›¿æ¢æ—§çš„å¯æ‰§è¡Œç¨‹åºï¼Œå¯¹äºç¼–è¯‘å®‰è£…çš„ nginxï¼Œå¯ä»¥å°†æ–°ç‰ˆæœ¬ç¼–è¯‘å®‰è£…åˆ°æ—§ç‰ˆæœ¬çš„ nginx å®‰è£…è·¯å¾„ä¸­ã€‚æ›¿æ¢ä¹‹å‰ï¼Œæœ€å¥½å¤‡ä»½ä¸€ä¸‹æ—§çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚ </div><div class="line"> </div><div class="line">(2) å‘é€ä»¥ä¸‹æŒ‡ä»¤ï¼š </div><div class="line">[root@Nginx_01 ~]<span class="comment"># kill -USR2 ã€æ—§é¢å¸ƒçš„Nginxä¸»è¿›ç¨‹å·ã€‘ </span></div><div class="line"> </div><div class="line">(3) æ—§ç‰ˆæœ¬ nginx çš„ä¸»è¿›ç¨‹å°†é‡å‘½åå®ƒçš„ pid æ–‡ä»¶ä¸º .oldbin(ä¾‹å¦‚ï¼š/usr/<span class="built_in">local</span>/nginx/logs/nginx.pid.oldbin)ï¼Œç„¶åæ‰§è¡Œæ–°ç‰ˆæœ¬çš„ nginx å¯æ‰§è¡Œç¨‹åºï¼Œä¾æ¬¡å¯åŠ¨æ–°çš„ä¸»è¿›ç¨‹å’Œæ–°çš„å·¥ä½œè¿›ç¨‹ã€‚ </div><div class="line"> </div><div class="line">(4) æ­¤æ—¶ï¼Œæ–°ã€æ—§ç‰ˆæœ¬çš„ nginx å®ä¾‹ä¼šåŒæ—¶è¿è¡Œï¼Œå…±åŒå¤„ç†è¾“å…¥çš„è¯·æ±‚ã€‚è¦é€æ­¥åœæ­¢æ—§ç‰ˆæœ¬çš„ nginx å®ä¾‹ï¼Œä½ å¿…é¡»å‘é€ WINCH ä¿¡å·ç»™æ—§çš„ä¸»è¿›ç¨‹ï¼Œç„¶åï¼Œå®ƒçš„å·¥ä½œè¿›ç¨‹å°±å°†å¼€å§‹ä»å®¹å…³é—­ï¼š</div><div class="line">[root@Nginx_01 ~]<span class="comment"># kill -WINCH ã€æ—§ç‰ˆæœ¬çš„Nginxä¸»è¿›ç¨‹å·ã€‘ </span></div><div class="line"> </div><div class="line">(5) ä¸€æ®µæ—¶é—´åï¼Œæ—§çš„å·¥ä½œè¿›ç¨‹(worker process)å¤„ç†äº†æ‰€æœ‰å·²è¿æ¥çš„è¯·æ±‚åé€€å‡ºï¼Œä»…ç”±æ–°çš„å·¥ä½œè¿›ç¨‹æ¥å¤„ç†è¾“å…¥çš„è¯·æ±‚äº†ã€‚ </div><div class="line"> </div><div class="line">(6) è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥å†³å®šæ˜¯ä½¿ç”¨æ–°ç‰ˆæœ¬ï¼Œè¿˜æ˜¯æ¢å¤åˆ°æ—§ç‰ˆæœ¬ï¼š </div><div class="line">[root@Nginx_01 ~]<span class="comment"># kill -HUP ã€æ—§çš„ä¸»è¿›ç¨‹å·ã€‘ï¼šnginx å°†åœ¨ä¸é‡è½½é…ç½®æ–‡ä»¶çš„æƒ…å†µä¸‹å¯åŠ¨å®ƒçš„å·¥ä½œè¿›ç¨‹ </span></div><div class="line">[root@Nginx_01 ~]<span class="comment"># kill -QUIT ã€æ–°çš„ä¸»è¿›ç¨‹å·ã€‘ï¼šä»å®¹å…³é—­å…¶å·¥ä½œè¿›ç¨‹(worker process) </span></div><div class="line">[root@Nginx_01 ~]<span class="comment"># kill -TERM ã€æ–°çš„ä¸»è¿›ç¨‹å·ã€‘ï¼šå¼ºåˆ¶é€€å‡º </span></div><div class="line">[root@Nginx_01 ~]<span class="comment"># kill ã€æ–°çš„ä¸»è¿›ç¨‹å·æˆ–æ—§çš„ä¸»è¿›ç¨‹å·ã€‘ï¼šå¦‚æœå› ä¸ºæŸäº›åŸå› æ–°çš„å·¥ä½œè¿›ç¨‹ä¸èƒ½é€€å‡ºï¼Œåˆ™å‘å…¶å‘é€ kill ä¿¡å· </span></div><div class="line"> </div><div class="line">æ–°çš„ä¸»è¿›ç¨‹é€€å‡ºåï¼Œæ—§çš„ä¸»è¿›ç¨‹ä¼šç§»é™¤ .oldbin åç¼€ï¼Œæ¢å¤ä¸ºå®ƒ çš„ .pid æ–‡ä»¶ï¼Œè¿™æ ·ï¼Œä¸€åˆ‡å°±æ¢å¤åˆ°å‡çº§ä¹‹å‰äº†ã€‚å¦‚æœå°è¯•å‡çº§æˆåŠŸï¼Œè€Œä½ ä¹Ÿå¸Œæœ›ä¿ç•™æ–°çš„æœåŠ¡å™¨æ—¶ï¼Œå¯å‘é€ QUIT ä¿¡å·ç»™æ—§çš„ä¸»è¿›ç¨‹ï¼Œä½¿å…¶é€€å‡ºè€Œåªç•™ä¸‹æ–°çš„æœåŠ¡å™¨è¿è¡Œã€‚</div></pre></td></tr></table></figure>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">ä¸Šå›¾æ˜¯nginxå®˜æ–¹ç½‘ç«™å¯¹nginxä¿¡å·çš„è§£é‡Šæ–‡æ¡£æˆªå–</div><div class="line"></div><div class="line">ä¸‹é¢æ˜¯ä¸€äº›å¸¸è§nginxå‘½ä»¤</div><div class="line"></div><div class="line">nginx -c <span class="string">/path/to/nginx.conf</span>  <span class="string">//</span> ä»¥ç‰¹å®šç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶å¯åŠ¨nginx:</div><div class="line"></div><div class="line">nginx -s  <span class="keyword">reload</span>  <span class="string">//</span> ä¿®æ”¹é…ç½®åé‡æ–°åŠ è½½ç”Ÿæ•ˆ</div><div class="line"></div><div class="line">nginx -s  reopen   <span class="string">//</span> é‡æ–°æ‰“å¼€æ—¥å¿—æ–‡ä»¶</div><div class="line"></div><div class="line">nginx -s stop  <span class="string">//</span> å¿«é€Ÿåœæ­¢nginx</div><div class="line"></div><div class="line">nginx -s <span class="keyword">quit</span>  <span class="string">//</span> å®Œæ•´æœ‰åºçš„åœæ­¢nginx</div><div class="line"></div><div class="line">nginx -t     <span class="string">//</span> æµ‹è¯•å½“å‰é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®</div><div class="line"></div><div class="line">nginx -t -c <span class="string">/path/to/nginx.conf</span>  <span class="string">//</span>æµ‹è¯•ç‰¹å®šçš„nginxé…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®</div></pre></td></tr></table></figure>

	

	

</article>




	<article>
	
		<h1><a href="/2016/08/21/æ€§èƒ½ç›‘æ§/Zabbix/ç›´æ’­åˆ†äº«çš„ä¸»é¢˜æ˜¯äº‘ç›‘æ§----zabbix&amp;collectd äº’ç›¸è®¨è®º/">ç›´æ’­åˆ†äº«çš„ä¸»é¢˜æ˜¯äº‘ç›‘æ§----zabbix&amp;collectd äº’ç›¸è®¨è®º</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-08-21</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/monitoring/">monitoring</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Zabbix-monitoring/">Zabbix monitoring</a>
			</span>
		
	</div>

	

	
		<h3 id="ç›´æ’­åˆ†äº«çš„ä¸»é¢˜æ˜¯äº‘ç›‘æ§â€”-zabbix-amp-collectd-äº’ç›¸è®¨è®º"><a href="#ç›´æ’­åˆ†äº«çš„ä¸»é¢˜æ˜¯äº‘ç›‘æ§â€”-zabbix-amp-collectd-äº’ç›¸è®¨è®º" class="headerlink" title="ç›´æ’­åˆ†äº«çš„ä¸»é¢˜æ˜¯äº‘ç›‘æ§â€”-zabbix&amp;collectd äº’ç›¸è®¨è®º"></a>ç›´æ’­åˆ†äº«çš„ä¸»é¢˜æ˜¯äº‘ç›‘æ§â€”-zabbix&amp;collectd äº’ç›¸è®¨è®º</h3><p>å‰å‡ å¤©å‚åŠ KVMå¼€å±•çš„ç›´æ’­ç§€ï¼Œè‚–æ€»è¯·æ¥äº†å„ä½è¿ç»´å¤§å’–ç»™æˆ‘ä»¬å±•ç¤ºä»–ä»¬äº‘ç›‘æ§ã€‚è¿™é‡Œæˆ‘æ•´ç†ä¸‹å´”å¹¿ç« å¤§å¸ˆçš„èŠå¤©è®°å½•å„ä½å¯ä»¥ä¸€èµ·è†å¬ä¸‹ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"> å´”å¹¿ç«  19:58</div><div class="line">æˆ‘ä¹‹å‰ä¸€ç›´åœ¨åšç§æœ‰äº‘ï¼Œæˆ‘ä»¬æ•´ä¸ªäº‘å¹³å°çš„ç›‘æ§ç³»ç»Ÿç³»ç»Ÿç”¨çš„å°±æ˜¯zabbix</div><div class="line"> å´”å¹¿ç«  19:59</div><div class="line">åŸºæœ¬æ²¡ä»€ä¹ˆå˜åŒ–ï¼Œåšçš„æ¯”è¾ƒå¤šçš„å°±æ˜¯å›½é™…åŒ–ï¼Œå¤§å®¶éƒ½æ‡‚çš„</div><div class="line"> å´”å¹¿ç«  20:00</div><div class="line">æˆ‘å…ˆå€Ÿåº¦å¨˜ç»™æ­å»ºæ‰«ä¸ªç›²</div><div class="line"> å´”å¹¿ç«  20:00</div><div class="line">zabbixï¼ˆéŸ³åŒ zÃ¦bixï¼‰æ˜¯ä¸€ä¸ªåŸºäºWEBç•Œé¢çš„æä¾›åˆ†å¸ƒå¼ç³»ç»Ÿç›‘è§†ä»¥åŠç½‘ç»œç›‘è§†åŠŸèƒ½çš„ä¼ä¸šçº§çš„å¼€æºè§£å†³æ–¹æ¡ˆã€‚</div><div class="line"> å´”å¹¿ç«  20:01</div><div class="line">zabbixèƒ½ç›‘è§†å„ç§ç½‘ç»œå‚æ•°ï¼Œä¿è¯æœåŠ¡å™¨ç³»ç»Ÿçš„å®‰å…¨è¿è¥ï¼›å¹¶æä¾›çµæ´»çš„é€šçŸ¥æœºåˆ¶ä»¥è®©ç³»ç»Ÿç®¡ç†å‘˜å¿«é€Ÿå®šä½/è§£å†³å­˜åœ¨çš„å„ç§é—®é¢˜ã€‚</div><div class="line"> å´”å¹¿ç«  20:02</div><div class="line">zabbixç”±2éƒ¨åˆ†æ„æˆï¼Œzabbix serverä¸å¯é€‰ç»„ä»¶zabbix agentã€‚</div><div class="line"> å´”å¹¿ç«  20:02</div><div class="line">zabbix serverå¯ä»¥é€šè¿‡SNMPï¼Œzabbix agentï¼Œpingï¼Œç«¯å£ç›‘è§†ç­‰æ–¹æ³•æä¾›å¯¹è¿œç¨‹æœåŠ¡å™¨/ç½‘ç»œçŠ¶æ€çš„ç›‘è§†ï¼Œæ•°æ®æ”¶é›†ç­‰åŠŸèƒ½ï¼Œå®ƒå¯ä»¥è¿è¡Œåœ¨Linuxï¼ŒSolarisï¼ŒHP-UXï¼ŒAIXï¼ŒFree BSDï¼ŒOpen BSDï¼ŒOS Xç­‰å¹³å°ä¸Šã€‚</div><div class="line"> å´”å¹¿ç«  20:02</div><div class="line">æ‰«ç›²å°±åˆ°æ­¤ä¸ºæ­¢å§</div><div class="line"> å´”å¹¿ç«  20:03</div><div class="line">æŒ‰åº¦å¨˜çš„ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å®‰è£…å•¦ï¼Œæˆ‘å°±åœ¨è¿™è€½è¯¯å¤§å®¶çš„äººé—´å•¦</div><div class="line"> å´”å¹¿ç«  20:04</div><div class="line">zabbixç›‘æ§ä¸»è¦åˆ†å››å—ï¼Œzabbix-agent,SNMP,IPMI,å’ŒJMX</div><div class="line"> å´”å¹¿ç«  20:05</div><div class="line">å› ä¸ºæˆ‘ä»¬ä¸»è¦æ˜¯æ˜¯åšIaaså’ŒPassçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åªç”¨äº†å‰ä¸‰ç§åŠŸèƒ½</div><div class="line"> å´”å¹¿ç«  20:06</div><div class="line">å‰ä¸‰ç§åŠŸèƒ½åˆåˆ†ä¸ºä¸¤ç§æ–¹æ¡ˆï¼Œå°±æ˜¯è´Ÿè½½å¤§æ—¶çš„ä¸€ç§æ–¹æ¡ˆå’Œè´Ÿè½½å°æ—¶çš„æ–¹æ¡ˆ</div><div class="line"> å´”å¹¿ç«  20:07</div></pre></td></tr></table></figure>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix_yun.png" alt=""></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"> å´”å¹¿ç«  20:07</div><div class="line">è¿™æ˜¯å°è´Ÿè½½æ—¶çš„æ–¹æ¡ˆ</div><div class="line"> å´”å¹¿ç«  20:08</div><div class="line">æ¥ä¸‹æ¥æ˜¯å¤§è´Ÿè½½æ—¶çš„æ–¹æ¡ˆ</div><div class="line"> å´”å¹¿ç«  20:08</div></pre></td></tr></table></figure>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix_yun1.png" alt=""></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">å´”å¹¿ç«  20:11</div><div class="line">è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªzabbixçš„æ•´ä½“æ¶æ„å¹¿ç«  20:11</div></pre></td></tr></table></figure>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix_yun2.png" alt=""></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div></pre></td><td class="code"><pre><div class="line"> å´”å¹¿ç«  20:12</div><div class="line">æˆ‘ä»14å¹´æ‰å¼€å§‹å°†zabbixè¿›è¡Œåˆ†å¸ƒå¼éƒ¨ç½²</div><div class="line"> å´”å¹¿ç«  20:14</div><div class="line">åœ¨äº‘ç¯å¢ƒä¸‹ï¼Œzabbixæœ‰ä¸ªç¼ºç‚¹å°±æ˜¯ï¼Œå¯¹è™šæ‹Ÿæœºçš„ç›‘æ§è¾¾æˆ‘ä»¬æ„Ÿè§‰ä¸ç†æƒ³</div><div class="line"> å´”å¹¿ç«  20:15</div><div class="line">å› ä¸ºzabbixå¯¹ä¸è™šæ‹Ÿä¸ç‰©ç†æœºè¿›è¡Œç›‘æ§é‡‡å–çš„æ˜¯åŒæ ·çš„æ–¹æ³•ï¼Œå°±æ˜¯å‘ç³»ç»Ÿä¸­æ³¨å…¥ä»£ç†zabbix-agent</div><div class="line"> å´”å¹¿ç«  20:15</div><div class="line">å¯¹è¯¸å¦‚ä»£ç†æˆ‘æœ‰ä¸¤ç‚¹æ‹…å¿ƒ</div><div class="line"> å´”å¹¿ç«  20:17</div><div class="line">ä¸€ã€å› ä¸ºzabbix-agentå®ƒæœ¬èº«ä¹Ÿå ç”¨äº†èµ„æºï¼Œå¯¹äºè‡ªå·±å ç”¨çš„èµ„æºå®ƒèƒ½ä¸èƒ½å‡†ç¡®ç›‘æ§ï¼Œè¿™æˆ‘è¿˜ä¸èƒ½ç¡®å®šï¼Œå¦‚æœå®ƒä¸èƒ½å¯¹è‡ªå·±å ç”¨çš„èµ„æºè¿›è¡Œå‡†ç¡®ç›‘æ§ï¼Œé‚£å°±ç­‰äºæ±¡æŸ“äº†è™šæ‹Ÿæœº</div><div class="line"> å´”å¹¿ç«  20:19</div><div class="line">äºŒï¼Œzabbix-agentæ˜¯æ‰“åŒ…åœ¨äº‘ä¸»æœºçš„é•œåƒä¸­çš„ä¸€ä¸ªcronä»»åŠ¡ï¼Œè¯´ç™½ä»–å°±æ˜¯äº‘ä¸»æœºçš„ä¸€ä¸ªæ™®é€šè¿›ç¨‹ï¼Œå¦‚æœç”¨æˆ·æŠŠå®ƒç»™<span class="built_in">kill</span>äº†ï¼Œæ˜¯ä¸æ˜¯å°±ç›‘æ§ä¸åˆ°å•¦ï¼Ÿ</div><div class="line"> å´”å¹¿ç«  20:21</div><div class="line">æ‰€ä»¥æˆ‘å°±æ‰¾èƒ½è¿è¡Œåœ¨åº•å±‚åˆèƒ½å¯¹è™šæ‹Ÿæœºè¿›è¡Œå‡†ç¡®æ£€æµ‹çš„å·¥å…·</div><div class="line"> å´”å¹¿ç«  20:21</div><div class="line">é‚£å°±æ˜¯æ¥ä¸‹æ¥è¦è¯´çš„collectdå–½</div><div class="line"> å´”å¹¿ç«  20:21</div><div class="line">è€è§„çŸ©ï¼Œå’±ä»¬è¿˜æ¥ç€æ‰«ç›²</div><div class="line"> å´”å¹¿ç«  20:21</div><div class="line">collectdæ˜¯ä¸€ä¸ªå®ˆæŠ¤(daemon)è¿›ç¨‹ï¼Œç”¨æ¥æ”¶é›†ç³»ç»Ÿæ€§èƒ½å’Œæä¾›å„ç§å­˜å‚¨æ–¹å¼æ¥å­˜å‚¨ä¸åŒå€¼çš„æœºåˆ¶ã€‚æ¯”å¦‚ä»¥RRD æ–‡ä»¶å½¢å¼ã€‚</div><div class="line"> å´”å¹¿ç«  20:29</div><div class="line">collectdç¡®å®èƒ½å¤Ÿè¿è¡Œåœ¨åº•å±‚ï¼Œå¹¶èƒ½é‡‡é›†KVMè™šæ‹Ÿæœºçš„å„é¡¹æ•°æ®ï¼Œä½†ä»–çš„å±•ç¤ºä½¿ç”¨CGPè·Ÿzabbixæ¯”å¤ªå·®</div><div class="line"> å´”å¹¿ç«  20:31</div><div class="line">æˆ‘æ‰€ä»¥æˆ‘å°±è¯•ç€å°†ä¸¤è€…è¿›è¡Œä¼˜åŠ¿äº’è¡¥</div><div class="line"> å´”å¹¿ç«  20:32</div><div class="line">æˆ‘æ˜¯å°†collectdå­˜å‚¨åœ¨*.rrdä¸­çš„ç›¸å…³æ•°æ®å–å‡ºæ¥ï¼Œç„¶åå­˜å‚¨åˆ°zabbixçš„æ•°æ®åº“å½“ä¸­ï¼Œè®©zabbixè¿›è¡Œå±•ç¤º</div><div class="line"> å´”å¹¿ç«  20:33</div><div class="line">å…¶å®åªæ˜¯å°†collectdé‡‡é›†çš„è™šæ‹Ÿæœºçš„å†…å­˜çš„æ•°æ®è¿›è¡Œè½¬å­˜å’Œå±•ç¤º</div><div class="line"> å´”å¹¿ç«  20:36</div><div class="line">æ•´ä¸ªè¿‡ç¨‹åŒ…æ‹¬ï¼Œåˆ†æzabbixçš„æ•°æ®åº“è¡¨ä¹‹é—´çš„å…³ç³»ï¼Œç ”ç©¶æ€ä¹ˆä»collectdçš„*.rrdæ–‡ä»¶ä¸­å–æ•°æ®æ€ä¹ˆå°†å–å‡ºçš„æ•°æ®å‘æ•°æ®åº“é‡Œä¿å­˜ï¼Œè¿™æ˜¯ä¸€é¡¹å¾ˆå¤§çš„å·¥ç¨‹</div><div class="line"> å´”å¹¿ç«  20:36</div><div class="line">ä»Šå¤©å°±åˆ†äº«åˆ°è¿™å§å¥½å§ï¼Ÿ</div><div class="line"> ä¾¯ç‡š@è´µå·é«˜æ–°ç¿¼äº‘ 20:37</div><div class="line">è°¢è°¢</div><div class="line"> å´”å¹¿ç«  20:37</div><div class="line"> è¢è¿›å¤|å—äº¬|äº‘åº”ç”¨+å¤§æ•°æ®+äº‘è®¡ç®— 20:37</div><div class="line"> è–›ç¾¤ 20:37</div><div class="line">å…¶å®ä½ è¯´çš„ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œä¸æ˜¯é—®é¢˜</div><div class="line"> åŒ—æç†Š 20:37</div><div class="line">å¤§å®¶å¼€å§‹æé—®å§</div><div class="line"> è–›ç¾¤ 20:38</div><div class="line">åªè¦æ˜¯ç›‘æ§ï¼Œéƒ½éœ€è¦æ¶ˆè€—å°‘é‡èµ„æº</div><div class="line"> å´”å¹¿ç«  20:38</div><div class="line">è¿™ä¸ªé—®é¢˜æˆ‘ä¹Ÿè¯·æ•™è¿‡è‚–å“¥@è–›ç¾¤</div><div class="line"> åˆ˜æµ·å®¾ 20:38</div><div class="line">é€šè¿‡libvirtä¹Ÿèƒ½è·å–è™šæ‹Ÿæœºçš„å†…å­˜</div><div class="line"> å´”å¹¿ç«  20:38</div><div class="line">å—¯å—¯</div><div class="line"> è–›ç¾¤ 20:38</div><div class="line">ä¸å±äºæ±¡æŸ“è™šæ‹Ÿæœºå“¦</div><div class="line"> å´”å¹¿ç«  20:38</div><div class="line">å—¯å—¯</div><div class="line"> è–›ç¾¤ 20:39</div><div class="line">è…¾è®¯äº‘ä¸Šçš„è™šæ‹Ÿæœºåå‡ ä¸ªagent</div><div class="line"> å´”å¹¿ç«  20:39</div><div class="line">collectdå°±æ˜¯è°ƒç”¨äº†libvirt</div><div class="line"> å´”å¹¿ç«  20:39</div><div class="line">@è–›</div><div class="line"> å´”å¹¿ç«  20:40</div><div class="line">é”™å•¦</div><div class="line"> è¢è¿›å¤|å—äº¬|äº‘åº”ç”¨+å¤§æ•°æ®+äº‘è®¡ç®— 20:40</div><div class="line">åœ¨é€‰æ‹©ç›‘æ§å·¥å…·çš„æ—¶å€™ï¼Œæ˜¯å¦è€ƒè™‘è¿‡å…¶ä»–ç±»ä¼¼çš„å·¥å…·ï¼Œä¾‹å¦‚nagiosï¼Œåšå‡ºé€‰æ‹©çš„ä¸»è¦è€ƒè™‘æ˜¯ä»€ä¹ˆï¼Ÿ</div><div class="line"> è–›ç¾¤ 20:40</div><div class="line">ç¬¬äºŒç§æ–¹å¼ï¼Œæ¶ˆè€—èµ„æºå¤šä¸ï¼Ÿ</div><div class="line"> åˆ˜æµ·å®¾ 20:40</div><div class="line">é‚£collectedå°±å¹²è¿™ä¸€ä»¶äº‹å—</div><div class="line"> å´”å¹¿ç«  20:40</div><div class="line"> åˆ˜æµ·å®¾ 20:40</div><div class="line">å…¶å®è™šæ‹Ÿæœºç›‘æ§å¯ä»¥ç”¨qga</div><div class="line"> åˆ˜æµ·å®¾ 20:41</div><div class="line">èµ°channel</div><div class="line"> è–›ç¾¤ 20:41</div><div class="line">nagiosåŠŸèƒ½æ²¡æœ‰ZBXå¼ºï¼Œæ€§èƒ½ä¹Ÿä¸åŠ</div><div class="line"> å´”å¹¿ç«  20:41</div><div class="line">collectdç›®å‰æˆ‘åªè®©å®ƒå¹²äº†æ€ä¹ˆä¸€ä»¶äº‹</div><div class="line"> åˆ˜æµ·å®¾ 20:42</div><div class="line">é‚£è‡ªå·±å†™ä¸ªè„šæœ¬æ›´ç®€å•å§ å‘µå‘µ åªæ˜¯ä¸ªäººè§‚ç‚¹</div><div class="line"> å´”å¹¿ç«  20:42</div><div class="line">æˆ‘ä¹Ÿè¯•ç€å†™äº†ä¸€å¥—è„šæœ¬</div><div class="line"> åˆ˜æµ·å®¾ 20:43</div><div class="line">@è–›ç¾¤â€…ç§æœ‰äº‘è·‘agentè¿˜å¥½ å…¬æœ‰äº‘ ç”¨æˆ·å¾ˆåæ„Ÿ</div><div class="line"> è–›ç¾¤ 20:43</div><div class="line">@è¢è¿›å¤@å—äº¬ï¼Œäº‘è®¡ç®—â€…å…¶å®ç›‘æ§ä¸»è¦è€ƒè™‘ï¼šæ–¹ä¾¿ï¼Œæ‰©å±•æ€§å¥½(è§„æ¨¡å’ŒäºŒæ¬¡å¼€å‘)ï¼ŒåŠŸèƒ½å…¨ï¼Œ</div><div class="line"> å´”å¹¿ç«  20:43</div><div class="line">ä½†æ•°æ®è¯¯å·®å¤ªå¤§</div><div class="line"> å´”å¹¿ç«  20:44</div><div class="line">å°±æ˜¯è€ƒè™‘åˆ°è¿™ä¸€ç‚¹@åˆ˜æµ·å®¾@æ–°ç½‘</div><div class="line"> åˆ˜æµ·å®¾ 20:45</div><div class="line">è™šæ‹ŸæœºåŠ ä¸Šballon</div><div class="line"> è–›ç¾¤ 20:46</div><div class="line">å—¯ï¼Œæ˜¯çš„ã€‚è…¾è®¯äº‘ä¸Šè¿™ä¹ˆå¤šagentï¼Œæ˜¯ä¸çˆ½</div><div class="line"> å´”å¹¿ç«  20:46</div><div class="line">ballonè·Ÿå†…å­˜ç›‘æ§å…³ç³»ä¸å¤§@åˆ˜æµ·å®¾@æ–°ç½‘</div><div class="line"> äºæ±Ÿç£Š@å¥‡ç‚¹æ—¶ä»£ 20:47</div><div class="line">zabbixå†å¤šä¸ªé…ç½®ä¸åŒçš„vmæ—¶ï¼Œè¯·é—®æ¨¡æ¿æ˜¯åˆ†åˆ«å®šåˆ¶çš„ä¹ˆ</div><div class="line"> å´”å¹¿ç«  20:48</div><div class="line">å¯¹çš„</div><div class="line"> äºæ±Ÿç£Š@å¥‡ç‚¹æ—¶ä»£ 20:48</div><div class="line">ç›‘æ§å¤šä¸ª</div><div class="line"> åˆ˜æµ·å®¾ 20:49</div><div class="line">libguestfsä¹Ÿèƒ½å¹²è¿™äº‹</div><div class="line"> è¢è¿›å¤|å—äº¬|äº‘åº”ç”¨+å¤§æ•°æ®+äº‘è®¡ç®— 20:50</div><div class="line">@è–›ç¾¤â€…@å´”å¹¿ç« â€…è°¢è°¢</div><div class="line"> åˆ˜æµ·å®¾ 20:50</div><div class="line">é’äº‘çš„ç›‘æ§èµ°çš„channelåœ¨ inité‡Œè¾¹èµ·äº†ä¸ªè¿›ç¨‹ ä¸å®¹æ˜“æ€æ­» è¿˜ä¸é”™</div><div class="line"> åˆ˜æµ·å®¾ 20:51</div><div class="line">@å´”å¹¿ç« â€…è°¢è°¢åˆ†äº«</div><div class="line"> å´”å¹¿ç«  20:51</div><div class="line">@è¢è¿›å¤@å—äº¬ï¼Œäº‘è®¡ç®—</div><div class="line"> å´”å¹¿ç«  20:51</div><div class="line"> è¢è¿›å¤|å—äº¬|äº‘åº”ç”¨+å¤§æ•°æ®+äº‘è®¡ç®— 20:52</div><div class="line">@å´”å¹¿ç« â€…ä¸»è¦ç›‘æ§äº†å“ªäº›æŒ‡æ ‡ï¼Ÿå¦‚æœåœ¨openstackæ¶æ„ï¼Œceilometerå’Œzabbixçš„çš„å…³ç³»æ€ä¹ˆçœ‹ï¼Ÿ</div><div class="line"> åˆ˜æµ© 20:52</div><div class="line">æˆ‘æ±‚é—®ä¸ªé—®é¢˜ï¼šæŠŠzabbix agentç”¨superviseèµ·ã€‚æ˜¯ä¸æ˜¯å°±ä¸ç”¨æ‹…å¿ƒè¢«æ€æ­»çš„é—®é¢˜äº†ã€‚</div><div class="line"> äºæ±Ÿç£Š@å¥‡ç‚¹æ—¶ä»£ 20:53</div><div class="line">æˆ‘åœ¨ç”¨zabbixæ—¶,é‡åˆ°ä¸€ä¸ªé—®é¢˜,ç›‘æ§ä¸»æœºç½‘å¡çš„æ—¶å€™,zabbixé»˜è®¤é‡‡ç”¨äº†auto_discoveryçš„ç­–ç•¥,ä½†æ˜¯æˆ‘å®¿ä¸»æœºä¸Šè·‘äº†å¾ˆå¤šä¸ªå®¹å™¨,å®¹å™¨çš„ç½‘ç»œè¿è¡Œæ¨¡å¼ä¸ºæ¡¥æ¥,æ­¤æ—¶zabbixå°±ä¼šè‡ªåŠ¨å»æ£€æµ‹é‚£äº›vethçš„è®¾å¤‡,è¯·é—®æˆ‘è¯¥å¦‚ä½•é…ç½®å‘¢? è¾¾åˆ°è®©zabbixåªç›‘æ§em0 æˆ–è€…eth0çš„ç½‘å¡è®¾å¤‡å‘¢</div><div class="line"> å´”å¹¿ç«  20:54</div><div class="line">ceilometerå…¶å®æ˜¯openstackè‡ªå¸¦çš„åŠŸèƒ½ï¼Œä½†æ˜¯åŠŸèƒ½å¾ˆèœ@è¢è¿›å¤@å—äº¬ï¼Œäº‘è®¡ç®—</div><div class="line"> å´”å¹¿ç«  20:54</div><div class="line">@åˆ˜æµ©@360 å…¶å®æˆ‘å°±æ˜¯æ€æƒ³çš„</div><div class="line"> å¹´ç¦ç‘@å°ç‰›èµ„æœ¬ 20:57</div><div class="line">@äºæ±Ÿç£Š@å¥‡ç‚¹æ—¶ä»£â€…è‡ªå·±å†™è„šæœ¬ï¼Œå–ç‰©ç†åˆ«å</div><div class="line"> å´”å¹¿ç«  20:58</div><div class="line">æˆ‘ä¹Ÿé‡åˆ°è¿™æ ·çš„é—®é¢˜@äºæ±Ÿç£Š@å¥‡ç‚¹æ—¶ä»£</div><div class="line"> åˆ˜æµ© 20:59</div><div class="line">@å´”å¹¿ç« â€…é‚£æ˜¯ä¸æ˜¯å¯ä»¥ä¸ç”¨collectedäº†</div><div class="line"> å´”å¹¿ç«  21:00</div><div class="line">ç†è®ºä¸Šæ˜¯å¯ä»¥ï¼Œä½†æ•°æ®è½¬å­˜çš„æ—¶å€™ï¼Œå·¥ä½œé‡å¾ˆå¤§@åˆ˜æµ©@360</div><div class="line"> å´”å¹¿ç«  21:01</div><div class="line">éš¾ç‚¹ä¸»è¦åœ¨zabbixç«¯ï¼Œå…³ç³»é”™ç»¼å¤æ‚</div><div class="line"> è–›ç¾¤ 21:01</div><div class="line">@äºæ±Ÿç£Š@å¥‡ç‚¹æ—¶ä»£â€…ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿‡æ»¤</div><div class="line"> è–›ç¾¤ 21:03</div><div class="line">å…¬æœ‰äº‘èµ·agentç¡®å®æ˜¯ä¸ªé—®é¢˜</div><div class="line"> å´”å¹¿ç«  21:03</div><div class="line">è¿™æ˜¯å…¬æœ‰äº‘çš„ç—›ç‚¹</div></pre></td></tr></table></figure>
<p>è½¬è½½ï¼škvmè®ºå›</p>
<p>å°±æ•´ç†è¿™äº›ï¼Œæƒ³è¯´ç°åœ¨ç›‘æ§ä¹Ÿè¶Šæ¥è¶Šå®Œå–„äº†ï¼Œå¯ä»¥åšåˆ°é‚®ä»¶å‘Šè­¦ï¼Œå¾®ä¿¡å‘Šè­¦ï¼Œé’‰é’‰å‘Šè­¦çŸ­ä¿¡ç”µè¯å‘Šè­¦ã€‚ ä¸‡èƒ½çš„ç›‘æ§zabbixåªè¦æœ‰keyå€¼éƒ½å¯ä»¥åšåˆ°ä»»ä½•ç›‘æ§ã€‚</p>
<p>ä¹Ÿè¿˜æœ‰äº›å…¬å¸å¯¹ç›‘æ§æ›´åŠ è¦æ±‚æ€§é«˜å¯ä»¥é’ˆå¯¹æ€§æŠ€æœ¯å¼€å‘ä¸€å¥—ç›‘æ§å¤§å±ï¼Œè®°å¾—åœ¨ä¹‹å‰å…¬å¸è¿ç»´CDNå°±æ˜¯æ•´ä¸ªæŠ€æœ¯å›¢é˜Ÿç ”å‘ä¸€å¥—ç›‘æ§å¤§ç›˜çš„ï¼Œä¸»è¦ç›‘æ§æµé‡çš„çŠ¶æ€æ¯ä¸ªèŠ‚ç‚¹çš„æµé‡å¸¦å®½ã€‚</p>
<p>æœ‰å…´è¶£ä¸€èµ·ç ”ç©¶ç›‘æ§çš„å¯ä»¥åŠ æˆ‘QQ:1165958741 æˆ–è€…åŠ å…¥ç¾¤ä¸€èµ·è®¨è®ºï¼š459096184</p>

	

	

</article>




	<article>
	
		<h1><a href="/2016/08/21/Node.js-npm/npmç¿»å¢™åŠ é€Ÿå›½å†…é•œåƒ/">npmç¿»å¢™åŠ é€Ÿå›½å†…é•œåƒ</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-08-21</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Node-js/">Node.js</a>
			</span>
		
	</div>

	

	
		<h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><p>Node.js çš„ä¾èµ–åŒ…ç®¡ç†ç”Ÿæ€ç³»ç»Ÿ npm, æ˜¯ä¸–ç•Œä¸Šæœ€å¤§çš„ç”Ÿæ€ç³»ç»Ÿå¼€æºåº“ã€‚ ä½†å›½å†…ä½¿ç”¨ npm æ¥å®‰è£…è½¯ä»¶ï¼Œé€Ÿåº¦å¾ˆæ…¢ï¼Œæœ‰æ—¶å€™ç”šè‡³ç›´æ¥å°±å¤±è´¥äº†ï¼æ¯”å¦‚æˆ‘å®‰è£…stfå°±éœ€è¦ç¿»å¢™æˆ–è€…VPNå»å®‰è£…ï¼Œå¯æ˜¯å°±ä¸€ç›´å¡ç€ã€‚</p>
		<p><a class="article__read-more-link" href="/2016/08/21/Node.js-npm/npmç¿»å¢™åŠ é€Ÿå›½å†…é•œåƒ/">...read more</a></p>
	

	

</article>




	<article>
	
		<h1><a href="/2016/08/16/Node.js-npm/Centos7.1+Macç¯å¢ƒå®‰è£…Node.Jsä»¥åŠå½»åº•åˆ é™¤å¸è½½node.jsæ•™ç¨‹/">Centos7.1+Macç¯å¢ƒå®‰è£…Node.Jsä»¥åŠå½»åº•åˆ é™¤å¸è½½node.jsæ•™ç¨‹</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-08-16</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Node-js/">Node.js</a>
			</span>
		
	</div>

	

	
		<h3 id="linux-Centos7ç³»ç»Ÿå¿«é€Ÿå®‰è£…node-js-npm"><a href="#linux-Centos7ç³»ç»Ÿå¿«é€Ÿå®‰è£…node-js-npm" class="headerlink" title="linux Centos7ç³»ç»Ÿå¿«é€Ÿå®‰è£…node.js npm"></a>linux Centos7ç³»ç»Ÿå¿«é€Ÿå®‰è£…node.js npm</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">ç¬¬ä¸€ã€é€‰æ‹©åˆé€‚çš„ç‰ˆæœ¬å®‰è£…</div><div class="line"><span class="comment"># 4.xç‰ˆæœ¬</span></div><div class="line">curl --silent --location https://rpm.nodesource.com/setup_4.x | bash -</div><div class="line"><span class="comment"># 5.xç‰ˆæœ¬</span></div><div class="line">curl --silent --location https://rpm.nodesource.com/setup_5.x | bash -</div><div class="line"><span class="comment"># 6.xç‰ˆæœ¬</span></div><div class="line">curl --silent --location  https://rpm.nodesource.com/setup_6.x | bash -</div></pre></td></tr></table></figure>
<p>å¦‚æœæ˜¯Centos7çš„è¯ä¼šæç¤ºæŠ¥é”™<code>Requires: libhttp_parser.so.2()(64bit)</code></p>
		<p><a class="article__read-more-link" href="/2016/08/16/Node.js-npm/Centos7.1+Macç¯å¢ƒå®‰è£…Node.Jsä»¥åŠå½»åº•åˆ é™¤å¸è½½node.jsæ•™ç¨‹/">...read more</a></p>
	

	

</article>




	<article>
	
		<h1><a href="/2016/07/21/æ€§èƒ½ç›‘æ§/Zabbix/Zabbix ç›‘æ§ KVMé›†ç¾¤/">KVM monitoring through Zabbix</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-07-21</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/monitoring/">monitoring</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Zabbix-monitoring/">Zabbix monitoring</a>
			</span>
		
	</div>

	

	
		<h3 id="KVM-monitoring-through-Zabbix"><a href="#KVM-monitoring-through-Zabbix" class="headerlink" title="KVM monitoring through Zabbix"></a>KVM monitoring through Zabbix</h3><p>Monitor your KVM resources through Zabbix</p>
<p>Zabbix ç›‘æ§ KVM</p>
<h4 id="å®‰è£…ä¾èµ–"><a href="#å®‰è£…ä¾èµ–" class="headerlink" title="å®‰è£…ä¾èµ–"></a>å®‰è£…ä¾èµ–</h4><p>python2, libvirt-python (tested with 0.9.12.3, 0.10.2 and 1.1.3.x)</p>
<pre><code>pip install libvirt-python 
</code></pre><h4 id="KVM-Server-è®¾å®šç¨‹åº"><a href="#KVM-Server-è®¾å®šç¨‹åº" class="headerlink" title="KVM Server è®¾å®šç¨‹åº"></a>KVM Server è®¾å®šç¨‹åº</h4><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">cd</span> /usr/local/bin/</div><div class="line">wget http<span class="variable">s:</span>//github.<span class="keyword">com</span>/bushvin/zabbix-kvm-<span class="keyword">res</span>/raw/master/bin/zabbix-kvm-<span class="keyword">res</span>.<span class="keyword">py</span></div><div class="line">chmod <span class="keyword">a</span>+<span class="keyword">x</span> zabbix-kvm-<span class="keyword">res</span>.<span class="keyword">py</span></div><div class="line"><span class="keyword">cd</span> /etc/zabbix/zabbix_agentd.d</div><div class="line">wget http<span class="variable">s:</span>//github.<span class="keyword">com</span>/bushvin/zabbix-kvm-<span class="keyword">res</span>/raw/master/zabbix_agentd.<span class="keyword">conf</span>/UserParameters</div><div class="line">service zabbix-agent restart</div></pre></td></tr></table></figure>
<h4 id="Zabbix-Server-è®¾å®šç¨‹åº"><a href="#Zabbix-Server-è®¾å®šç¨‹åº" class="headerlink" title="Zabbix Server è®¾å®šç¨‹åº"></a>Zabbix Server è®¾å®šç¨‹åº</h4><p>è‡³<a href="https://github.com/bushvin/zabbix-kvm-resä¸‹è½½zabbix_kvm.xml" target="_blank" rel="external">https://github.com/bushvin/zabbix-kvm-resä¸‹è½½zabbix_kvm.xml</a><br>å°†<code>zabbix_kvm.xml æ±‡å…¥è‡³Zabbix Server â†’ Configuration â†’ Templates â†’ Import</code></p>
<h3 id="äº¤æµå­¦ä¹ ï¼š"><a href="#äº¤æµå­¦ä¹ ï¼š" class="headerlink" title="äº¤æµå­¦ä¹ ï¼š"></a>äº¤æµå­¦ä¹ ï¼š</h3><p>ğŸ§  Linux shell_é«˜çº§è¿ç»´æ´¾: <code>459096184</code>    åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)<br>ğŸ§  BigData-Exchange School : <code>521621407</code>  åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥</p>
<p>ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚</p>

	

	

</article>




	<article>
	
		<h1><a href="/2016/06/29/è¿ç»´å®‰å…¨/ åŒ–è§£è‡ªå·±çš„é˜¿é‡Œäº‘æœåŠ¡å™¨è¢«é»‘å®¢æ”»å‡»-æš´åŠ›ç ´è§£/">åŒ–è§£è‡ªå·±çš„é˜¿é‡Œäº‘æœåŠ¡å™¨è¢«é»‘å®¢æ”»å‡»-æš´åŠ›ç ´è§£</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-06-29</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/è¿ç»´å®‰å…¨/">è¿ç»´å®‰å…¨</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Operation-safety/">Operation safety</a>
			</span>
		
	</div>

	

	
		<p>è¯´æ˜ä¸‹ï¼šå› ä¸ºé˜¿é‡Œäº‘æœåŠ¡å™¨æˆ‘æ˜¯ç”¨æ¥è‡ªå·±æ­å»ºblog çš„åšäº†ä¸€äº›ç®€å•çš„ç›‘æ§ã€‚</p>
<p>å› ä¸ºé˜²æ­¢è¢«æ”»å‡»ç˜«ç—ªï¼Œåšåˆ°å®‰å…¨é˜²èŒƒï¼Œå¯æ˜¯ä»Šå¤©æ™šä¸Šåƒå®Œé¥­ï¼Œå‘ç°åˆè¢«äººæ”»å‡»ï¼Œæ˜¯å°åº¦å’Œå·´è¥¿IPåœ°å€æš´åŠ›ç ´è§£æ–¹å¼ä¸€ç›´åœ¨å°è¯•ç ´è§£æˆ‘å¯†ç ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">è¿˜å¥½æˆ‘åœ¨é˜¿é‡Œäº‘ä¸Šé¢ä½¿ç”¨äº†äº‘ç›¾å‘Šè­¦ï¼Œå…¶å®å®ƒè¿™ä¸ªä¸€èˆ¬èˆ¬ï¼Œåªèƒ½æé†’ï¼Œä¸èƒ½æœ‰æ•ˆé˜»æ­¢é»‘å®¢æ”»å‡»ã€‚</div></pre></td></tr></table></figure>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/aliyundun.png" alt=""></figure></p>
<p>æ”¶åˆ°å‘Šè­¦ä»¥åï¼Œé©¬ä¸Šæ‰“å¼€ç”µè„‘å»äº‘ç›¾ä¸Šé¢æŸ¥çœ‹ä¸‹ã€‚</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/aliyundun2.png" alt=""></figure></p>
<p>ç„¶åçœ‹äº†ä»¥åå‘ç°é—®é¢˜ä¸å¤§ï¼Œå¯æ˜¯ä¸Šæœºå™¨æŸ¥çœ‹ï¼Œå‘ç°æœ‰ä¸æ–­çš„æ”»å‡»ç—•è¿¹ã€‚<br>æ—¥å¿—æŸ¥çœ‹åˆ°å¾ˆå¤šæ¥å†ä¸æ˜çš„IPã€‚å¾·å›½ğŸ‡©ğŸ‡ª  å·´è¥¿ å°åº¦ã€‚</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/aliyundun3.png" alt=""></figure><br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/aliyundun4.png" alt=""></figure></p>
<p>çœ‹åˆ°è¿™ä¸ªï¼Œæˆ‘å°±å†™äº†ä¸ªè„šæœ¬è®°å½•è¢«æ”»å‡»ç•™ä¸‹çš„ä¿å­˜æŒ‡å®šæ–‡ä»¶å¤¹ï¼Œæˆ‘çœ‹ä¸‹æ˜¯å¦è¿˜åœ¨ç»§ç»­æ”»å‡»äº†ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">#!/bin/bash</span></div><div class="line"><span class="comment">#Denyhosts SHELL SCRIPT</span></div><div class="line"><span class="comment">#2016-2-18</span></div><div class="line">cat /var/<span class="built_in">log</span>/secure|awk <span class="string">'/Failed/&#123;print $(NF-  3)&#125;'</span>|sort|uniq -c|awk <span class="string">'&#123;print $2"=" $1;&#125;'</span> &gt;/root/bin/Denyhosts.txt</div><div class="line">DEFINE=<span class="string">"10"</span></div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `cat /root/bin/Denyhosts.txt`</div><div class="line"><span class="keyword">do</span></div><div class="line">    IP=`<span class="built_in">echo</span> <span class="variable">$i</span>|awk -F= <span class="string">'&#123;print $1&#125;'</span>`</div><div class="line">    NUM=`<span class="built_in">echo</span> <span class="variable">$i</span>|awk -F= <span class="string">'&#123;print $2&#125;'</span>`</div><div class="line">    <span class="keyword">if</span> [ <span class="variable">$NUM</span> <span class="_">-gt</span> <span class="variable">$DEFINE</span> ]</div><div class="line">    <span class="keyword">then</span></div><div class="line">            grep <span class="variable">$IP</span> /etc/hosts.deny &gt;/dev/null</div><div class="line">            <span class="keyword">if</span> [ $? <span class="_">-gt</span> 0 ];</div><div class="line">            <span class="keyword">then</span></div><div class="line">            <span class="built_in">echo</span> <span class="string">"sshd:<span class="variable">$IP</span>"</span> &gt;&gt; /etc/hosts.deny</div><div class="line">            <span class="keyword">fi</span></div><div class="line">    <span class="keyword">fi</span></div><div class="line"><span class="keyword">done</span></div></pre></td></tr></table></figure>
<p>å› ä¸ºä¿å­˜åˆ°å…¶ä»–çš„txtæ–‡ä»¶ä¸‹é¢ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@iZ28by3xm9eZ bin]<span class="comment"># ll</span></div><div class="line">æ€»ç”¨é‡ 4</div><div class="line">-rwxr-xr-x 1 root root 535 2æœˆ  17 21:38 Denyhosts.sh</div><div class="line">-rw-r--r-- 1 root root   0 2æœˆ  17 21:45 Denyhosts.txt</div></pre></td></tr></table></figure>
<p>æŸ¥çœ‹é‡Œé¢æœ‰ä¸æ–­æ”»å‡»çš„IP :</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[root@iZ28by3xm9eZ bin]<span class="comment"># vim Denyhosts.txt</span></div><div class="line"></div><div class="line">101.69.252.146=1</div><div class="line">115.196.20.181=11</div><div class="line">117.243.176.226=6</div><div class="line">186.208.19.61=5</div><div class="line">186.251.118.71=3</div><div class="line">89.238.64.148=2</div><div class="line">94.215.141.101=1</div></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘è®°å½•äº†æ”»å‡»çš„å¤šå°‘æ¬¡ä¹Ÿæœ‰çš„ã€‚</p>
<p>å¯æ˜¯å‘ç°çš„ç¡®åœ¨ç»§ç»­æ”»å‡»ï¼Œæˆ‘åœ¨æƒ³å¦‚ä½•é˜»æ­¢è¢«ç ´è§£å‘¢ã€‚</p>
<p>ä¸»è¦æ˜¯ä¾é denyhostè½¯ä»¶ã€‚ç¨³é‡æ‰€è®²çš„æ˜¯ä¸‹è½½å®‰è£…åŒ…å®‰è£…ï¼Œå®é™…ä¸Šå¯ä»¥ä»ç›´æ¥ä½¿ç”¨yumæˆ–è€…aptå®‰è£…ï¼Œæ‰¾åˆ°ç›¸åº”çš„æºå°±å¯ä»¥ã€‚ä¸‹è¾¹æ˜¯å¸–å­åŸæ–‡ï¼š DenyHostså®˜æ–¹ç½‘ç«™ä¸ºï¼š<a href="http://denyhosts.sourceforge.net" target="_blank" rel="external">http://denyhosts.sourceforge.net</a></p>
<p>è¿™é‡Œä¸‹è½½æœ€æ–°çš„ç‰ˆæœ¬æ˜¯2008å¹´ 2.6 ç‰ˆæœ¬çš„ ä¸€ç›´æ²¡æ›´æ–°ã€‚ä¸è¿‡å·²ç»è¶³å¤Ÿå¼ºå¤§ã€‚ 1. å®‰è£…</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># tar -zxvf DenyHosts-2.6.tar.gz</span></div><div class="line"><span class="comment"># cd DenyHosts-2.6</span></div><div class="line"><span class="comment"># python setup.py install</span></div></pre></td></tr></table></figure>
<p>é»˜è®¤æ˜¯å®‰è£…åˆ°/usr/share/denyhostsç›®å½•çš„ã€‚</p>
<p>1.é…ç½®</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment"># cd /usr/share/denyhosts/</span></div><div class="line"><span class="comment"># cp denyhosts.cfg-dist denyhosts.cfg</span></div><div class="line"><span class="comment"># vi denyhosts.cfg</span></div><div class="line">PURGE_DENY = 50m <span class="comment">#è¿‡å¤šä¹…åæ¸…é™¤å·²é˜»æ­¢IP</span></div><div class="line">HOSTS_DENY = /etc/hosts.deny </div><div class="line"><span class="comment">#å°†é˜»æ­¢IPå†™å…¥åˆ°hosts.deny</span></div><div class="line">BLOCK_SERVICE = sshd </div><div class="line"><span class="comment">#é˜»æ­¢æœåŠ¡å</span></div><div class="line">DENY_THRESHOLD_INVALID = 1 </div><div class="line"><span class="comment">#å…è®¸æ— æ•ˆç”¨æˆ·ç™»å½•å¤±è´¥çš„æ¬¡æ•°</span></div><div class="line">DENY_THRESHOLD_VALID = 10 </div><div class="line"><span class="comment">#å…è®¸æ™®é€šç”¨æˆ·ç™»å½•å¤±è´¥çš„æ¬¡æ•°</span></div><div class="line">DENY_THRESHOLD_ROOT = 5 </div><div class="line"><span class="comment">#å…è®¸rootç™»å½•å¤±è´¥çš„æ¬¡æ•°</span></div><div class="line">WORK_DIR = /usr/<span class="built_in">local</span>/share/denyhosts/data</div><div class="line"><span class="comment">#å°†denyçš„hostæˆ–ipçºªå½•åˆ°Work_dir</span></div><div class="line">DENY_THRESHOLD_RESTRICTED = 1 </div><div class="line"><span class="comment">#è®¾å®š deny host å†™å…¥åˆ°è¯¥èµ„æ–™å¤¹</span></div><div class="line">LOCK_FILE = /var/lock/subsys/denyhosts <span class="comment">#å°†DenyHOtså¯åŠ¨çš„pidçºªå½•åˆ°LOCK_FILEä¸­ï¼Œå·²ç¡®ä¿æœåŠ¡æ­£ç¡®å¯åŠ¨ï¼Œé˜²æ­¢åŒæ—¶å¯åŠ¨å¤šä¸ªæœåŠ¡ã€‚</span></div><div class="line">HOSTNAME_LOOKUP=NO <span class="comment">#æ˜¯å¦åšåŸŸååè§£            ADMIN_EMAIL = #è®¾ç½®ç®¡ç†å‘˜é‚®ä»¶åœ°å€</span></div><div class="line">DAEMON_LOG = /var/<span class="built_in">log</span>/denyhosts <span class="comment">#è‡ªå·±çš„æ—¥å¿—æ–‡ä»¶</span></div><div class="line">DAEMON_PURGE = 10m <span class="comment">#è¯¥é¡¹ä¸PURGE_DENY è®¾ç½®æˆä¸€æ ·ï¼Œä¹Ÿæ˜¯æ¸…é™¤hosts.deniedssh ç”¨æˆ·çš„æ—¶é—´ã€‚</span></div></pre></td></tr></table></figure>
<p>2.è®¾ç½®å¯åŠ¨è„šæœ¬</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># cp daemon-control-dist daemon-control</span></div><div class="line"><span class="comment"># chown root daemon-control</span></div><div class="line"><span class="comment"># chmod 700 daemon-control</span></div></pre></td></tr></table></figure>
<p>å®Œäº†ä¹‹åæ‰§è¡Œdaemon-contron startå°±å¯ä»¥äº†ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># ./daemon-control start</span></div></pre></td></tr></table></figure>
<p>å¦‚æœè¦ä½¿DenyHostsæ¯æ¬¡é‡èµ·åè‡ªåŠ¨å¯åŠ¨è¿˜éœ€åšå¦‚ä¸‹è®¾ç½®ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># ln -s /usr/share/denyhosts/daemon-control                 /etc/init.d/denyhosts</span></div><div class="line"><span class="comment"># chkconfig --add denyhosts</span></div><div class="line"><span class="comment"># chkconfig denyhosts on</span></div></pre></td></tr></table></figure>
<p>ç„¶åå°±å¯ä»¥å¯åŠ¨äº†ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># service denyhosts start</span></div></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹çœ‹/etc/hosts.denyå†…æ˜¯å¦æœ‰ç¦æ­¢çš„IPï¼Œæœ‰çš„è¯è¯´æ˜å·²ç»æˆåŠŸäº†ã€‚</p>
<p>å¯åŠ¨å‡ºç°é”™è¯¯è§£å†³ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./daemon-control start</div></pre></td></tr></table></figure>
<p>å‡ºç°ï¼š<code>starting DenyHosts: /usr/bin/env python /usr/bin/denyhosts.py --daemon --config=/usr/share/denyhosts/denyhosts.cfg 
DenyHosts could not obtain lock (pid: ) 
[Errno 17] File exists: &#39;/var/lock/subsys/denyhosts&#39;</code> ä½¿ç”¨ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"> touch /private/var/<span class="built_in">log</span>/system.log</div><div class="line"> touch /var/lock/subsys/denyhosts</div><div class="line">rm <span class="_">-f</span> /var/lock/subsys/denyhosts</div><div class="line"></div><div class="line">./daemon-control start</div><div class="line">starting DenyHosts: /usr/bin/env python /usr/bin/denyhosts.py â€“daemon â€“config=/usr/share/denyhosts/denyhosts.cfg </div><div class="line">OKï¼</div></pre></td></tr></table></figure>
<p>å¯åŠ¨å®Œæˆå•¦ã€‚ ä½ å¯ä»¥ä½¿ç”¨</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">service denyhosts statusæ¥æŸ¥çœ‹è¿è¡ŒçŠ¶æ€</div></pre></td></tr></table></figure>
<p>DenyHosts is running with pid = 25874 è¡¨ç¤ºå·²ç»å¯åŠ¨èµ·æ¥äº†ã€‚<br>æ¥ä¸‹æ¥å°±å¯ä»¥ä½¿ç”¨</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cat /etc/hosts.denyæ¥æŸ¥çœ‹è®°å½•äº†</div></pre></td></tr></table></figure>
<p>ç„¶åå¯åŠ¨æˆåŠŸä»¥åï¼Œæˆ‘è‡ªå·±æµ‹è¯•äº†ä¸‹ï¼Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">ssh root@115.28.175.207</div><div class="line">root@115.28.175.207<span class="string">'s password:</span></div><div class="line">Permission denied, please try again.</div><div class="line">root@115.28.175.207's password:</div><div class="line">cPermission denied, please try again.</div><div class="line">root@115.28.175.207<span class="string">'s password:</span></div><div class="line">Permission denied (publickey,gssapi-keyex,gssapi-with-mic,password).</div></pre></td></tr></table></figure>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/aliyundun5.png" alt=""></figure></p>
<p>å‘ç°è‡ªå·±ç™»é™†ä¸ä¸Šå»äº†ï¼Œç„¶ååªèƒ½å»é˜¿é‡Œæ§åˆ¶å°æ“ä½œæŸ¥çœ‹åŸå› ã€‚</p>
<p>åŸæ¥å‘ç° <code>cat /etc/hosts.deny</code>æ¥æŸ¥çœ‹è®°å½•äº†<br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/aliyundun6.png" alt=""></figure></p>
<p>ç„¶åå»æ‰ï¼Œ115IP å‘ç°å°±å¯ä»¥ç™»é™†äº†ã€‚ æ‰€ä»¥æˆ‘åšçš„è®¾ç½®æ˜¯<code>root</code>å°è¯•ç ´è§£4æ¬¡ä»¥ä¸Šï¼Œè¢«é”å®šã€‚</p>

	

	

</article>





	<span class="different-posts">ğŸ“– <a href="/page/9">more posts</a> ğŸ“–</span>



	</main>

	<footer class="footer">
	<div class="footer-content">
		
	      <div class="footer__element">
	<h5>Hi there,</h5>
	<p style="text-align:justify;">my name is Yancy, they know me as RadiantğŸ‘ğŸ‘. This blog is about Bi-data and my live.<br> I like ğŸŒ³ğŸŒ³ğŸŒ³</p>
</div>


	    
	      <div class="footer__element">
	<h5>Check out</h5>
	<ul class="footer-links">
		<li class="footer-links__link"><a href="/archives">Archive</a></li>
		
		  <li class="footer-links__link"><a href="/atom.xml">RSS</a></li>
	    
		<li class="footer-links__link"><a href="/about">about page</a></li>
		<li class="footer-links__link"><a href="/tags">Tags</a></li>
		<li class="footer-links__link"><a href="/categories">Categories</a></li>
	</ul>
</div>

	    

		<div class="footer-credit">
			<span>Â© 2018 Yancy | Powered by <a href="http://blog.yancy.cc/">Yancy</a> | Theme <a href="https://github.com/yangcvo">Yancy_GitHub</a></span>
		</div>

	</div>


</footer>



</body>

</html>
