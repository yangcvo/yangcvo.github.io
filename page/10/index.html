<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="theme-color" content="#33474d">
	<title>Yancy&#39;s blog</title>
	<link rel="stylesheet" href="/css/style.css" />
	
      <link rel="alternate" href="/atom.xml" title="Yancy&#39;s blog" type="application/atom+xml">
    
</head>

<body>

	<header class="header">
		<nav class="header__nav">
			
				<a href="/" class="header__link">Home</a>
			
				<a href="/tags" class="header__link">Tags</a>
			
				<a href="/archives" class="header__link">ARCHIVES</a>
			
				<a href="/about/About" class="header__link">ABOUT</a>
			
				<a href="http://weibo.com/yangcvo" class="header__link">Weibo</a>
			
				<a href="/atom.xml" class="header__link">RSS</a>
			
		</nav>
		<h1 class="header__title"><a href="/">Yancy&#39;s blog</a></h1>
		<h2 class="header__subtitle">SIMPLICITY IS PREREQUISITE FOR  RELIABILITY</h2>
	</header>

	<main>
		
	<span class="different-posts different-posts_earlier">ğŸ“– <a href="/page/9">earlier posts</a> ğŸ“–</span>




	<article>
	
		<h1><a href="/2016/03/10/è‡ªåŠ¨åŒ–+Jenkins/Ansible/ansible è„šæœ¬(PlaybookåŸºæœ¬è¯­æ³•)è¿œç¨‹æ§åˆ¶/">Ansible è„šæœ¬(PlaybookåŸºæœ¬è¯­æ³•)è¿œç¨‹æ§åˆ¶</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-03-10</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/automation/">automation</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Ansible/">Ansible</a>
			</span>
		
	</div>

	

	
		<h1 id="ansible-è„šæœ¬-PlaybookåŸºæœ¬è¯­æ³•-è¿œç¨‹æ§åˆ¶"><a href="#ansible-è„šæœ¬-PlaybookåŸºæœ¬è¯­æ³•-è¿œç¨‹æ§åˆ¶" class="headerlink" title="ansible è„šæœ¬(PlaybookåŸºæœ¬è¯­æ³•)è¿œç¨‹æ§åˆ¶"></a>ansible è„šæœ¬(PlaybookåŸºæœ¬è¯­æ³•)è¿œç¨‹æ§åˆ¶</h1><p>PlaybookåŸºæœ¬è¯­æ³•</p>
<blockquote>
<p>æœ¬èŠ‚åˆ—ä¸¾äº†å†™ç¬¬ä¸€ä¸ªPlaybookï¼Œä½ å¿…é¡»äº†è§£åŸºæœ¬è¯­æ³•ã€‚<br>éšç€ä½ é¢ä¸´çš„æœºå™¨è¶Šå¤šï¼Œé…å±çš„éœ€æ±‚è¶Šå¤æ‚ï¼Œä½ å¯èƒ½éœ€è¦äº†è§£åé¢ä»‹ç»çš„ä¸€äº›ç¨å¾®å¤æ‚é€»è¾‘è¯­å¥ã€‚</p>
</blockquote>
<ul>
<li>æ‰§è¡ŒPlaybookè¯­æ³•</li>
</ul>
<p>è¿™é‡Œå…ˆ</p>
<p>vim deploy.yml</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">deploy.ymlæ–‡ä»¶</div><div class="line">---</div><div class="line">- hosts: tomcat_D1</div><div class="line">  vars:</div><div class="line">    http_port: 80</div><div class="line">    max_clients: 200</div><div class="line">  user: root</div><div class="line">  tasks:</div><div class="line">  - name: ensure apache is at the latest version</div><div class="line">    yum: name=httpd state=latest</div><div class="line">  - name: write the apache config file</div><div class="line">    template: src=/srv/httpd.j2 dest=/etc/httpd.conf</div><div class="line">    notify:</div><div class="line">    - restart apache</div><div class="line">  - name: start httpd </div><div class="line">    service: name=httpd state=started</div><div class="line">  handlers:</div><div class="line">    - name: restart apache</div><div class="line">      service: name=httpd state=restarted</div></pre></td></tr></table></figure>
<h4 id="æ‰§è¡ŒPlaybookè¯­æ³•"><a href="#æ‰§è¡ŒPlaybookè¯­æ³•" class="headerlink" title="æ‰§è¡ŒPlaybookè¯­æ³•"></a>æ‰§è¡ŒPlaybookè¯­æ³•</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ ansible-playbook deploy.yml</div></pre></td></tr></table></figure>
<p>æŸ¥çœ‹è¾“å‡ºçš„ç»†èŠ‚ 1</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ansible-playbook playbook<span class="selector-class">.yml</span> --list-hosts</div></pre></td></tr></table></figure>
<p>æŸ¥çœ‹è¯¥è„šæœ¬å½±å“å“ªäº›hosts</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ansible-playbook playbook<span class="selector-class">.yml</span> --list-hosts</div></pre></td></tr></table></figure>
<p>å¹¶è¡Œæ‰§è¡Œè„šæœ¬</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ansible-playbook playbook<span class="selector-class">.yml</span> -f <span class="number">10</span></div></pre></td></tr></table></figure>
<h4 id="å®Œæ•´çš„playbookè„šæœ¬ç¤ºä¾‹"><a href="#å®Œæ•´çš„playbookè„šæœ¬ç¤ºä¾‹" class="headerlink" title="å®Œæ•´çš„playbookè„šæœ¬ç¤ºä¾‹"></a>å®Œæ•´çš„playbookè„šæœ¬ç¤ºä¾‹</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">æœ€åŸºæœ¬çš„playbookè„šæœ¬åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†:</div><div class="line">åœ¨ä»€ä¹ˆæœºå™¨ä¸Šä»¥ä»€ä¹ˆèº«ä»½æ‰§è¡Œ</div><div class="line">hosts</div><div class="line">users</div><div class="line">...</div><div class="line">æ‰§è¡Œçš„ä»»åŠ¡æ˜¯éƒ½æœ‰ä»€ä¹ˆ</div><div class="line">tasks</div><div class="line">å–„åçš„ä»»åŠ¡éƒ½æœ‰ä»€ä¹ˆ</div><div class="line">handlers</div></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘å†™äº†ä¸ªtomcatå‘å¸ƒï¼Œymlæ–‡ä»¶ï¼š<br>å‚è€ƒï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">- hosts: tomcat-system_01</div><div class="line">  environment:</div><div class="line">    LC_ALL: zh_CN.UTF-8</div><div class="line">    LANG : zh_CN.UTF-8</div><div class="line">  tasks:</div><div class="line">  - name  : cpfile-system</div><div class="line">    copy  : src=/root/.jenkins/workspace/yjk_master/haozhuo/haozhuo-system/target/haozhuo-system.war dest=/root/java_war/haozhuo-system.war</div><div class="line">  - name  : restart</div><div class="line">    shell : /root/update/system.sh</div><div class="line">    async : 0</div><div class="line">  - name  : shutdown</div><div class="line">    shell : /srv/tomcat/tomcat_system/bin/shutdown.sh</div><div class="line">    async : 0</div><div class="line">  - name  : start</div><div class="line">    shell : <span class="built_in">chdir</span>=/srv/tomcat/tomcat_system/bin nohup ./startup.sh &amp;</div><div class="line">    async : 0</div></pre></td></tr></table></figure>
<p>å‚è€ƒå®˜ç½‘ï¼š<a href="https://ansible-book.gitbooks.io/ansible-first-book/content/playbookji_ben_yu_fa.html" target="_blank" rel="external">https://ansible-book.gitbooks.io/ansible-first-book/content/playbookji_ben_yu_fa.html</a></p>

	

	

</article>




	<article>
	
		<h1><a href="/2016/03/09/è‡ªåŠ¨åŒ–+Jenkins/Ansible/Ansibleå°ç»“ï¼ˆå››ï¼‰Ad-hocä¸commandsæ¨¡å— /">Ansibleå°ç»“ï¼ˆå››ï¼‰Ad-hocä¸commandsæ¨¡å—</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-03-09</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/automation/">automation</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Ansible/">Ansible</a>
			</span>
		
	</div>

	

	
		<h1 id="ansibleå°ç»“ï¼ˆå››ï¼‰Ad-hocä¸commandsæ¨¡å—"><a href="#ansibleå°ç»“ï¼ˆå››ï¼‰Ad-hocä¸commandsæ¨¡å—" class="headerlink" title="ansibleå°ç»“ï¼ˆå››ï¼‰Ad-hocä¸commandsæ¨¡å—"></a>ansibleå°ç»“ï¼ˆå››ï¼‰Ad-hocä¸commandsæ¨¡å—</h1><p>Ad-Hoc æ˜¯æŒ‡ansibleä¸‹ä¸´æ—¶æ‰§è¡Œçš„ä¸€æ¡å‘½ä»¤ï¼Œå¹¶ä¸”ä¸éœ€è¦ä¿å­˜çš„å‘½ä»¤ï¼Œå¯¹äºå¤æ‚çš„å‘½ä»¤åé¢ä¼šè¯´playbookã€‚è®²åˆ°Ad-hoc å°±è¦æåˆ°æ¨¡å—ï¼Œæ‰€æœ‰çš„å‘½ä»¤æ‰§è¡Œéƒ½è¦ä¾èµ–äºäº‹å…ˆå†™å¥½çš„æ¨¡å—ï¼Œé»˜è®¤å®‰è£…å¥½çš„ansible é‡Œé¢å·²ç»è‡ªå¸¦äº†å¾ˆå¤šæ¨¡å—ï¼Œå¦‚ï¼šcommandã€rawã€shellã€fileã€cronç­‰ï¼Œå…·ä½“å¯ä»¥é€šè¿‡ansible-doc -l è¿›è¡ŒæŸ¥çœ‹ ã€‚</p>
<h3 id="1ã€Ad-hoc"><a href="#1ã€Ad-hoc" class="headerlink" title="1ã€Ad-hoc"></a>1ã€Ad-hoc</h3><p>1ã€ç›´æ¥æ‰§è¡Œ</p>
<p>è¿™é‡Œè¿˜æ˜¯å…ˆæ¥ä¸€ä¸ªä¸Šå‡ ç¯‡å¹…ç»å¸¸ç”¨åˆ°çš„ä¸€ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># ansible tomcat_C1 -a "uptime" -k</span></div><div class="line">SSH <span class="symbol">password:</span></div><div class="line"><span class="meta">192.168.1.177 | SUCCESS | rc=0 &gt;</span>&gt;</div><div class="line"> <span class="number">10</span><span class="symbol">:</span><span class="number">37</span><span class="symbol">:</span><span class="number">10</span> up <span class="number">24</span> days, <span class="number">16</span><span class="symbol">:</span><span class="number">48</span>,  <span class="number">4</span> users,  load <span class="symbol">average:</span> <span class="number">0</span>.<span class="number">00</span>, <span class="number">0</span>.<span class="number">00</span>, <span class="number">0</span>.<span class="number">00</span></div></pre></td></tr></table></figure>
<p>ä¸€ä¸ªad-hocå‘½ä»¤çš„æ‰§è¡Œï¼Œéœ€è¦æŒ‰ä»¥ä¸‹æ ¼å¼è¿›è¡Œæ‰§è¡Œï¼š</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ansible ä¸»æœºæˆ–ç»„  -m æ¨¡å—å -<span class="selector-tag">a</span> <span class="string">'æ¨¡å—å‚æ•°'</span>  ansibleå‚æ•°</div></pre></td></tr></table></figure>
<p><strong>ä¸»æœºå’Œç»„ï¼Œæ˜¯åœ¨/etc/ansible/hosts é‡Œè¿›è¡ŒæŒ‡å®šçš„éƒ¨åˆ†ï¼Œå½“ç„¶åŠ¨æ€Inventory ä½¿ç”¨çš„æ˜¯è„šæœ¬ä»å¤–éƒ¨åº”ç”¨é‡Œè·å–çš„ä¸»æœº.</strong></p>
<ul>
<li><p>æ¨¡å—åï¼Œå¯ä»¥é€šè¿‡<code>ansible-doc -l</code>æŸ¥çœ‹ç›®å‰å®‰è£…çš„æ¨¡å—ï¼Œé»˜è®¤ä¸æŒ‡å®šæ—¶ï¼Œä½¿ç”¨çš„æ˜¯commandæ¨¡å—ï¼Œå…·ä½“å¯ä»¥æŸ¥çœ‹<code>/etc/ansible/ansible.cfg</code> çš„<code>â€œ#module_name = command â€</code> éƒ¨åˆ†ï¼Œé»˜è®¤æ¨¡å—å¯ä»¥åœ¨è¯¥é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œä¿®æ”¹ï¼›</p>
</li>
<li><p>æ¨¡å—å‚æ•°ï¼Œå¯ä»¥é€šè¿‡ <code>â€œansible-doc</code> æ¨¡å—åâ€ æŸ¥çœ‹å…·ä½“çš„ç”¨æ³•åŠåé¢çš„å‚æ•°ï¼›</p>
</li>
<li><p>ansibleå‚æ•°ï¼Œå¯ä»¥é€šè¿‡ansibleå‘½ä»¤çš„å¸®å¿™ä¿¡æ¯é‡ŒæŸ¥çœ‹åˆ°ï¼Œè¿™é‡Œæœ‰å¾ˆå¤šå‚æ•°å¯ä»¥ä¾›é€‰æ‹©ï¼Œå¦‚æ˜¯å¦éœ€è¦è¾“å…¥å¯†ç ã€æ˜¯å¦sudoç­‰ã€‚</p>
</li>
</ul>
<h4 id="2ã€åå°æ‰§è¡Œä¾‹å­"><a href="#2ã€åå°æ‰§è¡Œä¾‹å­" class="headerlink" title="2ã€åå°æ‰§è¡Œä¾‹å­"></a>2ã€åå°æ‰§è¡Œä¾‹å­</h4><p>å½“å‘½ä»¤æ‰§è¡Œæ—¶é—´æ¯”è¾ƒé•¿æ—¶ï¼Œä¹Ÿå¯ä»¥æ”¾åˆ°åå°æ‰§è¡Œï¼Œè¿™é‡Œä¼šç”¨åˆ°-Bã€-På‚æ•°ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ansible all -B <span class="number">3600</span> -a <span class="string">"/usr/bin/long_running_operation --do-stuff"</span> \\åå°æ‰§è¡Œå‘½ä»¤ <span class="number">3600</span>sï¼Œ-B è¡¨ç¤ºåå°æ‰§è¡Œçš„æ—¶é—´</div><div class="line">ansible all -m async_status -a <span class="string">"jid=123456789"</span>  \\æ£€æŸ¥ä»»åŠ¡çš„çŠ¶æ€</div><div class="line">ansible all -B <span class="number">1800</span> -P <span class="number">60</span> -a <span class="string">"/usr/bin/long_running_operation --do-stuff"</span> \\åå°æ‰§è¡Œå‘½ä»¤æœ€å¤§æ—¶é—´æ˜¯ <span class="number">1800</span>s å³ <span class="number">30</span> åˆ†é’Ÿï¼Œ-P æ¯ <span class="number">60</span>s æ£€æŸ¥ä¸‹çŠ¶æ€é»˜è®¤ <span class="number">15</span>s</div></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># ansible  -B 60 -P 1  tomcat_B1 -a  "uptime"</span></div><div class="line"><span class="meta">192.168.1.176 | SUCCESS | rc=0 &gt;</span>&gt;</div><div class="line"> <span class="number">11</span><span class="symbol">:</span><span class="number">23</span><span class="symbol">:</span><span class="number">00</span> up <span class="number">24</span> days, <span class="number">17</span><span class="symbol">:</span><span class="number">34</span>,  <span class="number">1</span> user,  load <span class="symbol">average:</span> <span class="number">0</span>.<span class="number">00</span>, <span class="number">0</span>.<span class="number">00</span>, <span class="number">0</span>.<span class="number">00</span></div></pre></td></tr></table></figure>
<h2 id="äºŒã€commandsæ¨¡å—"><a href="#äºŒã€commandsæ¨¡å—" class="headerlink" title="äºŒã€commandsæ¨¡å—"></a>äºŒã€commandsæ¨¡å—</h2><p>ä¸Šé¢å·²ç»æåˆ°ï¼Œansbileè‡ªèº«å·²ç»è‡ªå¸¦äº†å¾ˆå¤šæ¨¡å—ï¼Œå¯ä»¥é€šè¿‡ansible-doc -l è¿›è¡ŒæŸ¥çœ‹ã€‚è¿™é‡Œå°±ç»“åˆ<code>commandã€shellã€rawã€script</code>æ¨¡å—äº†è§£ä¸‹å…¶ç”¨æ³•ã€‚</p>
<p>ä¸Šé¢å››ä¸ªæ¨¡å—éƒ½å±äºcommands ç±»ã€‚</p>
<ul>
<li><code>command</code>æ¨¡å—ï¼Œè¯¥æ¨¡å—é€šè¿‡<code>-a</code>è·Ÿä¸Šè¦æ‰§è¡Œçš„å‘½ä»¤å¯ä»¥ç›´æ¥æ‰§è¡Œï¼Œä¸è¿‡å‘½ä»¤é‡Œå¦‚æœæœ‰å¸¦æœ‰å¦‚ä¸‹å­—ç¬¦éƒ¨åˆ†åˆ™æ‰§è¡Œä¸æˆåŠŸ â€œ so variables like $HOME and operations like â€œ&lt;â€, â€œ&gt;â€, â€œ|â€, and â€œ&amp;â€ will not work (use the shell module if you need these features).â€ï¼›**</li>
<li><code>shell</code>æ¨¡å—ï¼Œç”¨æ³•å…¶æœ¬å’Œ<code>command</code>ä¸€æ ·ï¼Œä¸è¿‡çš„æ˜¯å…¶æ˜¯é€šè¿‡/bin/shè¿›è¡Œæ‰§è¡Œï¼Œæ‰€ä»¥shell æ¨¡å—å¯ä»¥æ‰§è¡Œä»»ä½•å‘½ä»¤ï¼Œå°±åƒåœ¨æœ¬æœºæ‰§è¡Œä¸€æ ·ï¼Œâ€œ It is almost exactly like the command module but runs the command through a shell (/bin/sh) on the remote node.â€ï¼›</li>
<li><code>raw</code>æ¨¡å—ï¼Œç”¨æ³•å’Œshell æ¨¡å—ä¸€æ · ï¼Œå…¶ä¹Ÿå¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå°±åƒåœ¨æœ¬æœºæ‰§è¡Œä¸€æ ·ï¼Œâ€œExecutes a low-down and dirty SSH command, not going through the module subsystem. There is no change handler support for this module. This module does not require python on the remote systemâ€</li>
<li><code>script</code>æ¨¡å—ï¼Œå…¶æ˜¯å°†ç®¡ç†ç«¯çš„shell åœ¨è¢«ç®¡ç†ä¸»æœºä¸Šæ‰§è¡Œï¼Œå…¶åŸç†æ˜¯å…ˆå°†shell å¤åˆ¶åˆ°è¿œç¨‹ä¸»æœºï¼Œå†åœ¨è¿œç¨‹ä¸»æœºä¸Šæ‰§è¡Œï¼ŒåŸç†ç±»ä¼¼äºrawæ¨¡å—ï¼Œâ€œThis module does not require python on the remote system, much like the raw module.â€ ã€‚</li>
</ul>
<blockquote>
<p>æ³¨ï¼šrawæ¨¡å—å’Œcomandã€shell æ¨¡å—ä¸åŒçš„æ˜¯å…¶æ²¡æœ‰chdirã€createsã€removeså‚æ•°ï¼Œchdirå‚æ•°çš„ä½œç”¨å°±æ˜¯å…ˆåˆ‡åˆ°chdiræŒ‡å®šçš„ç›®å½•åï¼Œå†æ‰§è¡Œåé¢çš„å‘½ä»¤ï¼Œè¿™åœ¨åé¢å¾ˆå¤šæ¨¡å—é‡Œéƒ½ä¼šæœ‰è¯¥å‚æ•° ã€‚</p>
</blockquote>
<p>###commandæ¨¡å—åŒ…å«å¦‚ä¸‹é€‰é¡¹ï¼š </p>
<ul>
<li>createsï¼šä¸€ä¸ªæ–‡ä»¶åï¼Œå½“è¯¥æ–‡ä»¶å­˜åœ¨ï¼Œåˆ™è¯¥å‘½ä»¤ä¸æ‰§è¡Œ </li>
<li>free_formï¼šè¦æ‰§è¡Œçš„linuxæŒ‡ä»¤ </li>
<li>chdirï¼šåœ¨æ‰§è¡ŒæŒ‡ä»¤ä¹‹å‰ï¼Œå…ˆåˆ‡æ¢åˆ°è¯¥æŒ‡å®šçš„ç›®å½• </li>
<li>removesï¼šä¸€ä¸ªæ–‡ä»¶åï¼Œå½“è¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™è¯¥é€‰é¡¹ä¸æ‰§è¡Œ</li>
<li>executableï¼šåˆ‡æ¢shellæ¥æ‰§è¡ŒæŒ‡ä»¤ï¼Œè¯¥æ‰§è¡Œè·¯å¾„å¿…é¡»æ˜¯ä¸€ä¸ªç»å¯¹è·¯å¾„</li>
</ul>
<p><strong>commandæ¨¡å—ã€rawæ¨¡å—ã€shellæ¨¡å—ç¤ºä¾‹ï¼š</strong></p>
<h4 id="commandä¾‹å­ï¼š"><a href="#commandä¾‹å­ï¼š" class="headerlink" title="commandä¾‹å­ï¼š"></a>commandä¾‹å­ï¼š</h4><figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># ansible tomcat_B1 -m command -a "ps -ef|grep tomcat"</span></div><div class="line"><span class="number">192.168</span><span class="number">.1</span><span class="number">.176</span> | FAILED | rc=<span class="number">1</span> &gt;&gt;</div><div class="line">ERROR: Unsupported SysV option.</div><div class="line">********* simple selection *********  ********* selection <span class="keyword">by</span> <span class="built_in">list</span> *********</div><div class="line">-A all processes                      -C <span class="keyword">by</span> command <span class="built_in">name</span></div><div class="line">-N negate selection                   -G <span class="keyword">by</span> <span class="built_in">real</span> group ID (supports names)</div><div class="line">-a all w/ tty except session leaders  -U <span class="keyword">by</span> <span class="built_in">real</span> user ID (supports names)</div><div class="line">-d all except session leaders         -g <span class="keyword">by</span> session OR <span class="keyword">by</span> effective group <span class="built_in">name</span></div><div class="line">-e all processes                      -p <span class="keyword">by</span> process ID</div><div class="line">                                      -q <span class="keyword">by</span> process ID (unsorted &amp; quick)</div><div class="line">T  all processes <span class="keyword">on</span> this terminal     -s processes <span class="keyword">in</span> <span class="keyword">the</span> sessions <span class="keyword">given</span></div><div class="line">a  all w/ tty, including other users  -t <span class="keyword">by</span> tty</div><div class="line">g  OBSOLETE <span class="comment">-- DO NOT USE             -u by effective user ID (supports names)</span></div><div class="line">r  only <span class="built_in">running</span> processes             U  processes <span class="keyword">for</span> specified users</div><div class="line">x  processes w/o controlling ttys     t  <span class="keyword">by</span> tty</div><div class="line">*********** output format **********  *********** long options ***********</div><div class="line">-o,o user-defined  -f full            <span class="comment">--Group --User --pid --cols --ppid</span></div><div class="line">-j,j job control   s  signal          <span class="comment">--group --user --sid --rows --info</span></div><div class="line">-O,O preloaded -o  v  virtual memory  <span class="comment">--cumulative --format --deselect</span></div><div class="line">-l,l long          u  user-oriented   <span class="comment">--sort --tty --forest --version</span></div><div class="line">-F   extra full    X  registers       <span class="comment">--heading --no-heading --context</span></div><div class="line">                                      <span class="comment">--quick-pid</span></div><div class="line">                    ********* misc options *********</div><div class="line">-V,V  show <span class="built_in">version</span>      L  <span class="built_in">list</span> format codes  f  ASCII art forest</div><div class="line">-m,m,-L,-T,H  threads   S  children <span class="keyword">in</span> sum    -y change -l format</div><div class="line">-M,Z  security data     c  <span class="literal">true</span> command <span class="built_in">name</span>  -c scheduling <span class="built_in">class</span></div><div class="line">-w,w  wide output       n  numeric WCHAN,UID  -H process hierarchy</div></pre></td></tr></table></figure>
<p><strong>ä¸Šé¢çš„æ‰§è¡Œç»“æœå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘è¿™é‡ŒåŠ äº†ç®¡é“ï¼Œ<code>commandæ¨¡å—</code>æ‰§è¡Œæ—¶å‡ºé”™ï¼Œè€Œä½¿ç”¨<code>rawæ¨¡å—</code>å’Œ<code>shellæ¨¡å—</code>éƒ½æ­£å¸¸ã€‚</strong></p>
<h4 id="shellä¾‹å­ï¼š"><a href="#shellä¾‹å­ï¼š" class="headerlink" title="shellä¾‹å­ï¼š"></a>shellä¾‹å­ï¼š</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># ansible tomcat_B1 -m shell -a "ps -ef|grep tomcat"</span></div><div class="line">192.168.1.176 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">root      1529     1  0 Aug11 ?        00:00:00 jsvc.exec -java-home /srv/jdk1.7.0_67 -user tomcat -pidfile /srv/tomcat/tomcat_manager/logs/catalina-daemon.pid -wait 10 -outfile /srv/tomcat/tomcat_manager/logs/catalina-daemon.out -errfile &amp;1 -classpath /srv/tomcat/tomcat_manager/bin/bootstrap.jar:/srv/tomcat/</div></pre></td></tr></table></figure>
<h4 id="ä½¿ç”¨chdirçš„ç¤ºä¾‹ï¼š"><a href="#ä½¿ç”¨chdirçš„ç¤ºä¾‹ï¼š" class="headerlink" title="ä½¿ç”¨chdirçš„ç¤ºä¾‹ï¼š"></a>ä½¿ç”¨chdirçš„ç¤ºä¾‹ï¼š</h4><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># ansible tomcat_B1 -m command -a "chdir=/tmp/ touch 1.txt"</span></div><div class="line"><span class="meta">192.168.1.176 | SUCCESS | rc=0 &gt;</span>&gt;</div><div class="line"></div><div class="line">[root@docker ~]<span class="comment"># ansible tomcat_B1 -m shell -a "chdir=/tmp/ touch 2.txt"</span></div><div class="line"><span class="meta">192.168.1.176 | SUCCESS | rc=0 &gt;</span>&gt;</div><div class="line"></div><div class="line">[root@docker ~]<span class="comment"># ansible tomcat_B1 -m raw -a "chdir=/tmp/ touch 3.txt"</span></div><div class="line"><span class="meta">192.168.1.176 | SUCCESS | rc=0 &gt;</span>&gt;</div></pre></td></tr></table></figure>
<p>ä»ä¸Šé¢æ‰§è¡Œç»“æœæ¥çœ‹ï¼Œä¸‰ä¸ªå‘½ä»¤éƒ½æ‰§è¡ŒæˆåŠŸäº†ã€‚ä¸è¿‡é€šè¿‡åœ¨è¿œç¨‹ä¸»æœºä¸ŠæŸ¥çœ‹ï¼Œå‰ä¸¤ä¸ªæ–‡ä»¶è¢«æˆåŠŸåˆ›å»ºï¼š</p>
<figure class="highlight tap"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># ansible tomcat_B1 -m command -a "chdir=/tmp/ ls -lh"</span></div><div class="line">192.168.1.176 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">total 188K</div><div class="line">-rw-r--r--.<span class="number"> 1 </span>root   root     <span class="number"> 0 </span>Sep <span class="number"> 5 </span>22:52 1.txt</div><div class="line">-rw-r--r--.<span class="number"> 1 </span>root   root     <span class="number"> 0 </span>Sep <span class="number"> 5 </span>22:51 2.txt</div></pre></td></tr></table></figure>
<p>ä½¿ç”¨<code>rawæ¨¡å—</code>çš„æ‰§è¡Œçš„ç»“æœæ–‡ä»¶ä¹Ÿè¢«æ­£å¸¸åˆ›å»ºäº†ï¼Œä¸è¿‡ä¸æ˜¯åœ¨chdir æŒ‡å®šçš„ç›®å½•ï¼Œè€Œæ˜¯åœ¨å½“å‰æ‰§è¡Œç”¨æˆ·çš„å®¶ç›®å½•ã€‚</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># ansible tomcat_B1 -m raw -a "ls ~/4.txt"</span></div><div class="line"><span class="meta">192.168.1.176 | SUCCESS | rc=0 &gt;</span>&gt;</div><div class="line"><span class="regexp">/root/</span><span class="number">4</span>.txt</div></pre></td></tr></table></figure>
<h4 id="createsä¸removesç¤ºä¾‹ï¼š"><a href="#createsä¸removesç¤ºä¾‹ï¼š" class="headerlink" title="createsä¸removesç¤ºä¾‹ï¼š"></a>createsä¸removesç¤ºä¾‹ï¼š</h4><p>è¿™é‡Œæˆ‘åœ¨æµ‹è¯•ä¸»æœºä¸Šåˆ›å»º/tmp/server.txtæ–‡ä»¶ï¼Œæ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<ul>
<li>createsï¼šä¸€ä¸ªæ–‡ä»¶åï¼Œå½“è¯¥æ–‡ä»¶å­˜åœ¨ï¼Œåˆ™è¯¥å‘½ä»¤ä¸æ‰§è¡Œ </li>
</ul>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># ansible tomcat_B1  -a "creates=/tmp/1.txt uptime"</span></div><div class="line"> [<span class="type">WARNING</span>]: <span class="type">Failure</span> <span class="keyword">using</span> <span class="keyword">method</span> (v2_runner_on_ok) <span class="keyword">in</span> callback plugin (&lt;ansible.plugins.callback.minimal.<span class="type">CallbackModule</span> <span class="keyword">object</span> at <span class="number">0x2093e90</span>&gt;): coercing to</div><div class="line"><span class="type">Unicode</span>: need <span class="built_in">string</span> <span class="keyword">or</span> buffer, <span class="built_in">bool</span> found</div><div class="line"></div><div class="line">[root@docker ~]<span class="comment"># ansible tomcat_B1  -a "removes=/tmp/1.txt uptime"</span></div><div class="line"><span class="number">192</span>.<span class="number">168</span>.<span class="number">1</span>.<span class="number">176</span> | <span class="type">SUCCESS</span> | rc=<span class="number">0</span> &gt;&gt;</div><div class="line"> <span class="number">22</span>:<span class="number">59</span>:<span class="number">04</span> up <span class="number">25</span> days,  <span class="number">5</span>:<span class="number">10</span>,  <span class="number">1</span> user,  load average: <span class="number">0</span>.<span class="number">00</span>, <span class="number">0</span>.<span class="number">00</span>, <span class="number">0</span>.<span class="number">00</span></div></pre></td></tr></table></figure>
<h4 id="scriptæ¨¡å—ç¤ºä¾‹ï¼š"><a href="#scriptæ¨¡å—ç¤ºä¾‹ï¼š" class="headerlink" title="scriptæ¨¡å—ç¤ºä¾‹ï¼š"></a>scriptæ¨¡å—ç¤ºä¾‹ï¼š</h4><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[root@361way ~]# cat script.sh</div><div class="line">#!/bin/bash</div><div class="line">df -hl</div><div class="line">ifconfig</div><div class="line">ps auxf|grep snmp</div><div class="line">[root@361way ~]# ansible 10.212.52.252 -m script -a 'scrip.sh'</div><div class="line">10.212.52.252 | FAILED =&gt; file or module does not exist: /root/scrip.sh</div><div class="line">[root@361way ~]# ansible 10.212.52.252 -m script -a 'script.sh'</div><div class="line">10.212.52.252 | success &gt;&gt; &#123;</div><div class="line">    "changed": true,</div><div class="line">    "rc": 0,</div><div class="line">    "stderr": "OpenSSH_5.3p1, OpenSSL 1.0.1e-fips 11 Feb 2013<span class="symbol">\n</span>debug1: Reading configuration data /etc/ssh/ssh_config<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Applying options for *<span class="symbol">\r</span><span class="symbol">\n</span>debug1: auto-mux: Trying existing master<span class="symbol">\r</span><span class="symbol">\n</span>Control socket connect(/root/.ansible/cp/ansible-ssh-10.212.52.252-22-root): Connection refused<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Connecting to 10.212.52.252 [10.212.52.252] port 22.<span class="symbol">\r</span><span class="symbol">\n</span>debug1: fd 3 clearing O_NONBLOCK<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Connection established.<span class="symbol">\r</span><span class="symbol">\n</span>debug1: permanently_set_uid: 0/0<span class="symbol">\r</span><span class="symbol">\n</span>debug1: identity file /root/.ssh/identity type -1<span class="symbol">\r</span><span class="symbol">\n</span>debug1: identity file /root/.ssh/identity-cert type -1<span class="symbol">\r</span><span class="symbol">\n</span>debug1: identity file /root/.ssh/id_rsa type -1<span class="symbol">\r</span><span class="symbol">\n</span>debug1: identity file /root/.ssh/id_rsa-cert type -1<span class="symbol">\r</span><span class="symbol">\n</span>debug1: identity file /root/.ssh/id_dsa type -1<span class="symbol">\r</span><span class="symbol">\n</span>debug1: identity file /root/.ssh/id_dsa-cert type -1<span class="symbol">\r</span><span class="symbol">\n</span>debug1: identity file /root/.ssh/id_ecdsa type -1<span class="symbol">\r</span><span class="symbol">\n</span>debug1: identity file /root/.ssh/id_ecdsa-cert type -1<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Remote protocol version 2.0, remote software version OpenSSH_6.2<span class="symbol">\r</span><span class="symbol">\n</span>debug1: match: OpenSSH_6.2 pat OpenSSH*<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Enabling compatibility mode for protocol 2.0<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Local version string SSH-2.0-OpenSSH_5.3<span class="symbol">\r</span><span class="symbol">\n</span>debug1: SSH2_MSG_KEXINIT sent<span class="symbol">\r</span><span class="symbol">\n</span>debug1: SSH2_MSG_KEXINIT received<span class="symbol">\r</span><span class="symbol">\n</span>debug1: kex: server-&gt;client aes128-ctr hmac-md5 zlib@openssh.com<span class="symbol">\r</span><span class="symbol">\n</span>debug1: kex: client-&gt;server aes128-ctr hmac-md5 zlib@openssh.com<span class="symbol">\r</span><span class="symbol">\n</span>debug1: SSH2_MSG_KEX_DH_GEX_REQUEST(1024&lt;1024&lt;8192) sent<span class="symbol">\r</span><span class="symbol">\n</span>debug1: expecting SSH2_MSG_KEX_DH_GEX_GROUP<span class="symbol">\r</span><span class="symbol">\n</span>debug1: SSH2_MSG_KEX_DH_GEX_INIT sent<span class="symbol">\r</span><span class="symbol">\n</span>debug1: expecting SSH2_MSG_KEX_DH_GEX_REPLY<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Host '10.212.52.252' is known and matches the RSA host key.<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Found key in /root/.ssh/known_hosts:1<span class="symbol">\r</span><span class="symbol">\n</span>debug1: ssh_rsa_verify: signature correct<span class="symbol">\r</span><span class="symbol">\n</span>debug1: SSH2_MSG_NEWKEYS sent<span class="symbol">\r</span><span class="symbol">\n</span>debug1: expecting SSH2_MSG_NEWKEYS<span class="symbol">\r</span><span class="symbol">\n</span>debug1: SSH2_MSG_NEWKEYS received<span class="symbol">\r</span><span class="symbol">\n</span>debug1: SSH2_MSG_SERVICE_REQUEST sent<span class="symbol">\r</span><span class="symbol">\n</span>debug1: SSH2_MSG_SERVICE_ACCEPT received<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Authentications that can continue: publickey,password,keyboard-interactive<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Next authentication method: keyboard-interactive<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Enabling compression at level 6.<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Authentication succeeded (keyboard-interactive).<span class="symbol">\r</span><span class="symbol">\n</span>debug1: setting up multiplex master socket<span class="symbol">\r</span><span class="symbol">\n</span>ControlSocket /root/.ansible/cp/ansible-ssh-10.212.52.252-22-root already exists, disabling multiplexing<span class="symbol">\r</span><span class="symbol">\n</span>debug1: channel 0: new [client-session]<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Requesting no-more-sessions@openssh.com<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Entering interactive session.<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Sending environment.<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Sending env LANG = en_US.UTF-8<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Sending command: LANG=C LC_CTYPE=C /root/.ansible/tmp/ansible-tmp-1431924855.88-242473611260231/script.sh <span class="symbol">\r</span><span class="symbol">\n</span>debug1: client_input_channel_req: channel 0 rtype exit-status reply 0<span class="symbol">\r</span><span class="symbol">\n</span>debug1: client_input_channel_req: channel 0 rtype eow@openssh.com reply 0<span class="symbol">\r</span><span class="symbol">\n</span>debug1: channel 0: free: client-session, nchannels 1<span class="symbol">\r</span><span class="symbol">\n</span>debug1: fd 1 clearing O_NONBLOCK<span class="symbol">\r</span><span class="symbol">\n</span>debug1: fd 2 clearing O_NONBLOCK<span class="symbol">\r</span><span class="symbol">\n</span>Connection to 10.212.52.252 closed.<span class="symbol">\r</span><span class="symbol">\n</span>Transferred: sent 1928, received 3920 bytes, in 0.1 seconds<span class="symbol">\r</span><span class="symbol">\n</span>Bytes per second: sent 37017.0, received 75262.7<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Exit status 0<span class="symbol">\r</span><span class="symbol">\n</span>debug1: compress outgoing: raw data 537, compressed 375, factor 0.70<span class="symbol">\r</span><span class="symbol">\n</span>debug1: compress incoming: raw data 1837, compressed 1019, factor 0.55<span class="symbol">\r</span><span class="symbol">\n</span>",</div><div class="line">    "stdout": "Filesystem      Size  Used Avail Use<span class="variable">% Mounted on\r\n/dev/sda2       9.9G  872M  8.5G  10%</span> /<span class="symbol">\r</span><span class="symbol">\n</span>udev            3.9G  128K  3.9G   1<span class="variable">% /dev\r\ntmpfs           3.9G   76K  3.9G   1%</span> /dev/shm<span class="symbol">\r</span><span class="symbol">\n</span>/dev/sda3       5.0G  219M  4.5G   5<span class="variable">% /boot\r\n/dev/sda8        40G   15G   23G  40%</span> /home<span class="symbol">\r</span><span class="symbol">\n</span>/dev/sda9       9.9G  5.2G  4.3G  55<span class="variable">% /opt\r\n/dev/sda6       5.0G  2.7G  2.1G  57%</span> /tmp<span class="symbol">\r</span><span class="symbol">\n</span>/dev/sda5       9.9G  3.4G  6.0G  36<span class="variable">% /usr\r\n/dev/sda7       9.9G  823M  8.6G   9%</span> /var<span class="symbol">\r</span><span class="symbol">\n</span>eth0      Link encap:Ethernet  HWaddr 00:50:56:A8:65:7E  <span class="symbol">\r</span><span class="symbol">\n</span>          inet addr:10.212.52.252  Bcast:10.212.52.255  Mask:255.255.255.0<span class="symbol">\r</span><span class="symbol">\n</span>          inet6 addr: fe80::250:56ff:fea8:657e/64 Scope:Link<span class="symbol">\r</span><span class="symbol">\n</span>          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1<span class="symbol">\r</span><span class="symbol">\n</span>          RX packets:24112135 errors:0 dropped:792372 overruns:0 frame:0<span class="symbol">\r</span><span class="symbol">\n</span>          TX packets:10697339 errors:0 dropped:0 overruns:0 carrier:0<span class="symbol">\r</span><span class="symbol">\n</span>          collisions:0 txqueuelen:1000 <span class="symbol">\r</span><span class="symbol">\n</span>          RX bytes:17137233328 (16343.3 Mb)  TX bytes:13390377826 (12770.0 Mb)<span class="symbol">\r</span><span class="symbol">\n</span><span class="symbol">\r</span><span class="symbol">\n</span>lo        Link encap:Local Loopback  <span class="symbol">\r</span><span class="symbol">\n</span>          inet addr:127.0.0.1  Mask:255.0.0.0<span class="symbol">\r</span><span class="symbol">\n</span>          inet6 addr: ::1/128 Scope:Host<span class="symbol">\r</span><span class="symbol">\n</span>          UP LOOPBACK RUNNING  MTU:16436  Metric:1<span class="symbol">\r</span><span class="symbol">\n</span>          RX packets:3407332 errors:0 dropped:0 overruns:0 frame:0<span class="symbol">\r</span><span class="symbol">\n</span>          TX packets:3407332 errors:0 dropped:0 overruns:0 carrier:0<span class="symbol">\r</span><span class="symbol">\n</span>          collisions:0 txqueuelen:0 <span class="symbol">\r</span><span class="symbol">\n</span>          RX bytes:262675450 (250.5 Mb)  TX bytes:262675450 (250.5 Mb)<span class="symbol">\r</span><span class="symbol">\n</span><span class="symbol">\r</span><span class="symbol">\n</span>root     25332  0.0  0.0   4260   568 pts/2    S+   12:54   0:00          <span class="symbol">\\</span>_ grep snmp<span class="symbol">\r</span><span class="symbol">\n</span>root     24364  0.0  0.0  70416  6696 ?        SNl  May15   0:22 /usr/sbin/snmpd -r -A -LF i /var/log/net-snmpd.log -p /var/run/snmpd.pid<span class="symbol">\r</span><span class="symbol">\n</span>"</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¾“å‡ºç»“æœå¾ˆå¤šï¼Œçœ‹èµ·æ¥ä¹Ÿå¾ˆä¹±ï¼Œä¸è¿‡æŸ¥ä¸‹stdoutéƒ¨åˆ†ï¼Œè¿™ä¸ªéƒ¨åˆ†æ˜¯å®é™…ä¸Šæ‰§è¡Œåçš„ç»“æœã€‚è¿™é‡Œå¯ä»¥é…åˆç®¡é“ä¸€èµ·ä½¿ç”¨ï¼Œå¯ä»¥å¦‚ä¸‹ä½¿ç”¨ï¼š</p>
<p><code>`
[root@361way ~]# ansible 10.212.52.252 -m script -a &#39;script.sh&#39; |egrep &#39;&gt;&gt;|stdout&#39;</code></p>

	

	

</article>




	<article>
	
		<h1><a href="/2016/03/09/è‡ªåŠ¨åŒ–+Jenkins/Ansible/ansibleå°ç»“(äº”)å¸¸ç”¨æ¨¡å—/">Ansibleå°ç»“ (äº”) å¸¸ç”¨æ¨¡å—</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-03-09</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/automation/">automation</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Ansible/">Ansible</a>
			</span>
		
	</div>

	

	
		<h1 id="ansibleå‘½ä»¤æ€»ç»“ä½¿ç”¨ï¼š"><a href="#ansibleå‘½ä»¤æ€»ç»“ä½¿ç”¨ï¼š" class="headerlink" title="ansibleå‘½ä»¤æ€»ç»“ä½¿ç”¨ï¼š"></a>ansibleå‘½ä»¤æ€»ç»“ä½¿ç”¨ï¼š</h1><p>åœ¨ä¸Šä¸€ç¯‡ä¸­ä»‹ç»äº†commandséƒ¨åˆ†æ¨¡å—ï¼Œæœ¬ç¯‡æ‰¿æ¥ä¸Šç¯‡ä»‹ç»ä¸‹å¸¸ç”¨çš„æ¨¡å—ã€‚æ ¹æ®å®˜æ–¹çš„åˆ†ç±»ï¼Œå°†æ¨¡å—æŒ‰åŠŸèƒ½åˆ†ç±»ä¸ºï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">äº‘æ¨¡å—ã€å‘½ä»¤æ¨¡å—ã€æ•°æ®åº“æ¨¡å—ã€æ–‡ä»¶æ¨¡å—ã€èµ„äº§æ¨¡å—ã€æ¶ˆæ¯æ¨¡å—ã€ç›‘æ§æ¨¡å—ã€ç½‘ç»œæ¨¡å—ã€é€šçŸ¥æ¨¡å—ã€åŒ…ç®¡ç†æ¨¡å—ã€æºç æ§åˆ¶æ¨¡å—ã€ç³»ç»Ÿæ¨¡å—ã€å•å…ƒæ¨¡å—ã€webè®¾æ–½æ¨¡å—ã€windowsæ¨¡å—</div></pre></td></tr></table></figure>
<p>å…·ä½“å¯ä»¥å‚çœ‹<a href="http://docs.ansible.com/list_of_all_modules.html" target="_blank" rel="external">å®˜æ–¹é¡µé¢</a></p>
<p>è¿™é‡Œä»å®˜æ–¹åˆ†ç±»çš„æ¨¡å—é‡Œé€‰æ‹©<code>æœ€å¸¸ç”¨çš„ä¸€äº›æ¨¡å—</code>è¿›è¡Œä»‹ç»ï¼ˆcommandsæ¨¡å—ä¸Šä¸€ç¯‡å·²ç»ä»‹ç»ï¼Œè¿™é‡Œä¸å†æï¼‰ã€‚</p>
<h3 id="ä¸€ã€pingæ¨¡å—"><a href="#ä¸€ã€pingæ¨¡å—" class="headerlink" title="ä¸€ã€pingæ¨¡å—"></a>ä¸€ã€pingæ¨¡å—</h3><h6 id="æµ‹è¯•ä¸»æœºæ˜¯å¦æ˜¯é€šçš„ï¼Œç”¨æ³•å¾ˆç®€å•ï¼Œä¸æ¶‰åŠå‚æ•°ï¼š"><a href="#æµ‹è¯•ä¸»æœºæ˜¯å¦æ˜¯é€šçš„ï¼Œç”¨æ³•å¾ˆç®€å•ï¼Œä¸æ¶‰åŠå‚æ•°ï¼š" class="headerlink" title="æµ‹è¯•ä¸»æœºæ˜¯å¦æ˜¯é€šçš„ï¼Œç”¨æ³•å¾ˆç®€å•ï¼Œä¸æ¶‰åŠå‚æ•°ï¼š"></a>æµ‹è¯•ä¸»æœºæ˜¯å¦æ˜¯é€šçš„ï¼Œç”¨æ³•å¾ˆç®€å•ï¼Œä¸æ¶‰åŠå‚æ•°ï¼š</h6><figure class="highlight autoit"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">ansible tomcat_B1 -m <span class="built_in">ping</span></div><div class="line"></div><div class="line">[root<span class="symbol">@ansible</span> ~]<span class="meta"># ansible tomcat_C1 -m ping</span></div><div class="line"><span class="number">192.168</span><span class="number">.1</span><span class="number">.177</span> | SUCCESS =&gt; &#123;</div><div class="line">    <span class="string">"changed"</span>: <span class="literal">false</span>,</div><div class="line">    <span class="string">"ping"</span>: <span class="string">"pong"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="äºŒã€setupæ¨¡å—"><a href="#äºŒã€setupæ¨¡å—" class="headerlink" title="äºŒã€setupæ¨¡å—"></a>äºŒã€setupæ¨¡å—</h3><p>setupæ¨¡å—ï¼Œä¸»è¦ç”¨äºè·å–ä¸»æœºä¿¡æ¯ï¼Œåœ¨playbooksé‡Œç»å¸¸ä¼šç”¨åˆ°çš„ä¸€ä¸ªå‚æ•°<code>gather_facts</code>å°±ä¸è¯¥æ¨¡å—ç›¸å…³ã€‚setupæ¨¡å—ä¸‹ç»å¸¸ä½¿ç”¨çš„ä¸€ä¸ªå‚æ•°æ˜¯filterå‚æ•°ï¼Œå…·ä½“ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼ˆç”±äºè¾“å‡ºç»“æœè¾ƒå¤šï¼Œè¿™é‡Œåªåˆ—å‘½ä»¤ä¸å†™ç»“æœï¼‰ï¼š</p>
<h6 id="æŸ¥çœ‹ä¸»æœºå†…å­˜ä¿¡æ¯"><a href="#æŸ¥çœ‹ä¸»æœºå†…å­˜ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹ä¸»æœºå†…å­˜ä¿¡æ¯"></a>æŸ¥çœ‹ä¸»æœºå†…å­˜ä¿¡æ¯</h6><figure class="highlight autoit"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root<span class="symbol">@ansible</span> ~]<span class="meta"># ansible tomcat_C1 -m setup -a <span class="string">'filter=ansible_*_mb'</span></span></div></pre></td></tr></table></figure>
<h6 id="æŸ¥çœ‹åœ°æ¥å£ä¸ºeth0-2çš„ç½‘å¡ä¿¡æ¯"><a href="#æŸ¥çœ‹åœ°æ¥å£ä¸ºeth0-2çš„ç½‘å¡ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹åœ°æ¥å£ä¸ºeth0-2çš„ç½‘å¡ä¿¡æ¯"></a>æŸ¥çœ‹åœ°æ¥å£ä¸ºeth0-2çš„ç½‘å¡ä¿¡æ¯</h6><figure class="highlight autoit"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root<span class="symbol">@ansible</span> ~]<span class="meta"># ansible tomcat_C1 -m setup -a <span class="string">'filter=ansible_eth[0-2]'</span> </span></div><div class="line">[root<span class="symbol">@ansible</span> ~]<span class="meta"># ansible all -m setup --tree /tmp/facts</span></div></pre></td></tr></table></figure>
<p>  //å°†æ‰€æœ‰ä¸»æœºçš„ä¿¡æ¯è¾“å…¥åˆ°/tmp/factsç›®å½•ä¸‹ï¼Œæ¯å°ä¸»æœºçš„ä¿¡æ¯è¾“å…¥åˆ°ä¸»æœºåæ–‡ä»¶ä¸­ï¼ˆ/etc/ansible/hostsé‡Œçš„ä¸»æœºåï¼‰</p>
<h3 id="ä¸‰ã€fileæ¨¡å—"><a href="#ä¸‰ã€fileæ¨¡å—" class="headerlink" title="ä¸‰ã€fileæ¨¡å—"></a>ä¸‰ã€fileæ¨¡å—</h3><p>fileæ¨¡å—ä¸»è¦ç”¨äºè¿œç¨‹ä¸»æœºä¸Šçš„æ–‡ä»¶æ“ä½œï¼Œfileæ¨¡å—åŒ…å«å¦‚ä¸‹é€‰é¡¹ï¼š </p>
<ul>
<li>forceï¼šéœ€è¦åœ¨ä¸¤ç§æƒ…å†µä¸‹å¼ºåˆ¶åˆ›å»ºè½¯é“¾æ¥ï¼Œä¸€ç§æ˜¯æºæ–‡ä»¶ä¸å­˜åœ¨ä½†ä¹‹åä¼šå»ºç«‹çš„æƒ…å†µä¸‹ï¼›å¦ä¸€ç§æ˜¯ç›®æ ‡è½¯é“¾æ¥å·²å­˜åœ¨,éœ€è¦å…ˆå–æ¶ˆä¹‹å‰çš„è½¯é“¾ï¼Œç„¶ååˆ›å»ºæ–°çš„è½¯é“¾ï¼Œæœ‰ä¸¤ä¸ªé€‰é¡¹ï¼šyes|no </li>
<li>groupï¼šå®šä¹‰æ–‡ä»¶/ç›®å½•çš„å±ç»„ </li>
<li>modeï¼šå®šä¹‰æ–‡ä»¶/ç›®å½•çš„æƒé™</li>
<li>ownerï¼šå®šä¹‰æ–‡ä»¶/ç›®å½•çš„å±ä¸»</li>
<li>pathï¼šå¿…é€‰é¡¹ï¼Œå®šä¹‰æ–‡ä»¶/ç›®å½•çš„è·¯å¾„</li>
<li>recurseï¼šé€’å½’çš„è®¾ç½®æ–‡ä»¶çš„å±æ€§ï¼Œåªå¯¹ç›®å½•æœ‰æ•ˆ</li>
<li>srcï¼šè¦è¢«é“¾æ¥çš„æºæ–‡ä»¶çš„è·¯å¾„ï¼Œåªåº”ç”¨äºstate=linkçš„æƒ…å†µ</li>
<li>destï¼šè¢«é“¾æ¥åˆ°çš„è·¯å¾„ï¼Œåªåº”ç”¨äºstate=linkçš„æƒ…å†µ </li>
<li>stateï¼š  directoryï¼šå¦‚æœç›®å½•ä¸å­˜åœ¨ï¼Œåˆ›å»ºç›®å½•</li>
<li>fileï¼šå³ä½¿æ–‡ä»¶ä¸å­˜åœ¨ï¼Œä¹Ÿä¸ä¼šè¢«åˆ›å»º</li>
<li>linkï¼šåˆ›å»ºè½¯é“¾æ¥</li>
<li>hardï¼šåˆ›å»ºç¡¬é“¾æ¥</li>
<li>touchï¼šå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ï¼Œå¦‚æœæ–‡ä»¶æˆ–ç›®å½•å·²å­˜åœ¨ï¼Œåˆ™æ›´æ–°å…¶æœ€åä¿®æ”¹æ—¶é—´</li>
<li>absentï¼šåˆ é™¤ç›®å½•ã€æ–‡ä»¶æˆ–è€…å–æ¶ˆé“¾æ¥æ–‡ä»¶<br>ä½¿ç”¨ç¤ºä¾‹ï¼š</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ansible <span class="built_in">test</span> -m file <span class="_">-a</span> <span class="string">"src=/etc/fstab dest=/tmp/fstab state=link"</span></div><div class="line">ansible <span class="built_in">test</span> -m file <span class="_">-a</span> <span class="string">"path=/tmp/fstab state=absent"</span></div><div class="line">ansible <span class="built_in">test</span> -m file <span class="_">-a</span> <span class="string">"path=/tmp/test state=touch"</span></div><div class="line">ansible <span class="built_in">test</span> -m file <span class="_">-a</span> <span class="string">"path=/tmp/test state=directory"</span> ansible <span class="built_in">test</span> -m file <span class="_">-a</span> <span class="string">"path=/tmp/testd state=directory owner=root group=root mode=777"</span></div></pre></td></tr></table></figure>
<h3 id="å››ã€copyæ¨¡å—"><a href="#å››ã€copyæ¨¡å—" class="headerlink" title="å››ã€copyæ¨¡å—"></a>å››ã€copyæ¨¡å—</h3><h5 id="å¤åˆ¶æ–‡ä»¶åˆ°è¿œç¨‹ä¸»æœºï¼Œcopyæ¨¡å—åŒ…å«å¦‚ä¸‹é€‰é¡¹ï¼š"><a href="#å¤åˆ¶æ–‡ä»¶åˆ°è¿œç¨‹ä¸»æœºï¼Œcopyæ¨¡å—åŒ…å«å¦‚ä¸‹é€‰é¡¹ï¼š" class="headerlink" title="å¤åˆ¶æ–‡ä»¶åˆ°è¿œç¨‹ä¸»æœºï¼Œcopyæ¨¡å—åŒ…å«å¦‚ä¸‹é€‰é¡¹ï¼š"></a>å¤åˆ¶æ–‡ä»¶åˆ°è¿œç¨‹ä¸»æœºï¼Œcopyæ¨¡å—åŒ…å«å¦‚ä¸‹é€‰é¡¹ï¼š</h5><ul>
<li><code>backup</code>ï¼šåœ¨è¦†ç›–ä¹‹å‰å°†åŸæ–‡ä»¶å¤‡ä»½ï¼Œå¤‡ä»½æ–‡ä»¶åŒ…å«æ—¶é—´ä¿¡æ¯ã€‚æœ‰ä¸¤ä¸ªé€‰é¡¹ï¼šyes|no </li>
<li><code>content</code>ï¼šç”¨äºæ›¿ä»£â€srcâ€,å¯ä»¥ç›´æ¥è®¾å®šæŒ‡å®šæ–‡ä»¶çš„å€¼ </li>
<li><code>dest</code>ï¼šå¿…é€‰é¡¹ã€‚è¦å°†æºæ–‡ä»¶å¤åˆ¶åˆ°çš„è¿œç¨‹ä¸»æœºçš„ç»å¯¹è·¯å¾„ï¼Œå¦‚æœæºæ–‡ä»¶æ˜¯ä¸€ä¸ªç›®å½•ï¼Œé‚£ä¹ˆè¯¥è·¯å¾„ä¹Ÿå¿…é¡»æ˜¯ä¸ªç›®å½• </li>
<li><code>directory_mode</code>ï¼šé€’å½’çš„è®¾å®šç›®å½•çš„æƒé™ï¼Œé»˜è®¤ä¸ºç³»ç»Ÿé»˜è®¤æƒé™</li>
<li><code>force</code>ï¼šå¦‚æœç›®æ ‡ä¸»æœºåŒ…å«è¯¥æ–‡ä»¶ï¼Œä½†å†…å®¹ä¸åŒï¼Œå¦‚æœè®¾ç½®ä¸ºyesï¼Œåˆ™å¼ºåˆ¶è¦†ç›–ï¼Œå¦‚æœä¸ºnoï¼Œåˆ™åªæœ‰å½“ç›®æ ‡ä¸»æœºçš„ç›®æ ‡ä½ç½®ä¸å­˜åœ¨è¯¥æ–‡ä»¶æ—¶ï¼Œæ‰å¤åˆ¶ã€‚é»˜è®¤ä¸ºyes</li>
<li><code>others</code>ï¼šæ‰€æœ‰çš„fileæ¨¡å—é‡Œçš„é€‰é¡¹éƒ½å¯ä»¥åœ¨è¿™é‡Œä½¿ç”¨</li>
<li><code>src</code>ï¼šè¦å¤åˆ¶åˆ°è¿œç¨‹ä¸»æœºçš„æ–‡ä»¶åœ¨æœ¬åœ°çš„åœ°å€ï¼Œå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„ï¼Œä¹Ÿå¯ä»¥æ˜¯ç›¸å¯¹è·¯å¾„ã€‚å¦‚æœè·¯å¾„æ˜¯ä¸€ä¸ªç›®å½•ï¼Œå®ƒå°†é€’å½’å¤åˆ¶ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœè·¯å¾„ä½¿ç”¨â€/â€œæ¥ç»“å°¾ï¼Œåˆ™åªå¤åˆ¶ç›®å½•é‡Œçš„å†…å®¹ï¼Œå¦‚æœæ²¡æœ‰ä½¿ç”¨â€/â€œæ¥ç»“å°¾ï¼Œåˆ™åŒ…å«ç›®å½•åœ¨å†…çš„æ•´ä¸ªå†…å®¹å…¨éƒ¨å¤åˆ¶ï¼Œç±»ä¼¼äºrsyncã€‚ </li>
<li><code>validate</code>ï¼šThe validation command to run before copying into place. The path to the file to validate is passed in via â€˜%sâ€™ which must be present as in the visudo example below.</li>
</ul>
<p>ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ansible test -m <span class="keyword">copy</span><span class="bash"> <span class="_">-a</span> <span class="string">"src=/srv/myfiles/foo.conf dest=/etc/foo.conf owner=foo group=foo mode=0644"</span></span></div><div class="line">ansible test -m <span class="keyword">copy</span><span class="bash"> <span class="_">-a</span> <span class="string">"src=/mine/ntp.conf dest=/etc/ntp.conf owner=root group=root mode=644 backup=yes"</span></span></div><div class="line">ansible test -m <span class="keyword">copy</span><span class="bash"> <span class="_">-a</span> <span class="string">"src=/mine/sudoers dest=/etc/sudoers validate='visudo -cf %s'"</span></span></div></pre></td></tr></table></figure>
<p>è¿™é‡Œåœ¨ä¸¾ä¸ªä¾‹å­ï¼š</p>
<p>ç›®çš„ï¼šæŠŠä¸»æ§ç«¯/opt/ç›®å½•ä¸‹é¢logstash.tar.gzæ–‡ä»¶æ‹·è´åˆ°åˆ°æŒ‡å®šèŠ‚ç‚¹ä¸Š/srv/ä¸‹é¢<br>    å‘½ä»¤ï¼š<code>ansible cluster1:children -m copy -a &quot;src=/opt/logstash.tar.gz dest=/srv/. owner=root group=root mode=644&quot;</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">root@salt ~]<span class="comment"># ansible cluster1:children -m copy -a "src=/opt/logstash.tar.gz dest=/srv/. 10.47.59.190 | SUCCESS =&gt; &#123;</span></div><div class="line">    <span class="string">"changed"</span>: <span class="literal">true</span>,</div><div class="line">    <span class="string">"checksum"</span>: <span class="string">"9d15ea324f39d08cb379f59ffee9fa7ad2a62ab8"</span>,</div><div class="line">    <span class="string">"dest"</span>: <span class="string">"/srv/./logstash.tar.gz"</span>,</div><div class="line">    <span class="string">"gid"</span>: 0,</div><div class="line">    <span class="string">"group"</span>: <span class="string">"root"</span>,</div><div class="line">    <span class="string">"md5sum"</span>: <span class="string">"c151602e79a336ca363928dea68d2567"</span>,</div><div class="line">    <span class="string">"mode"</span>: <span class="string">"0644"</span>,</div><div class="line">    <span class="string">"owner"</span>: <span class="string">"root"</span>,</div><div class="line">    <span class="string">"size"</span>: 84431108,</div><div class="line">    <span class="string">"src"</span>: <span class="string">"/root/.ansible/tmp/ansible-tmp-1483939085.93-201327709717575/source"</span>,</div><div class="line">    <span class="string">"state"</span>: <span class="string">"file"</span>,</div><div class="line">    <span class="string">"uid"</span>: 0</div><div class="line">&#125;</div><div class="line">10.47.106.105 | SUCCESS =&gt; &#123;</div><div class="line">    <span class="string">"changed"</span>: <span class="literal">true</span>,</div><div class="line">    <span class="string">"checksum"</span>: <span class="string">"9d15ea324f39d08cb379f59ffee9fa7ad2a62ab8"</span>,</div><div class="line">    <span class="string">"dest"</span>: <span class="string">"/srv/./logstash.tar.gz"</span>,</div><div class="line">    <span class="string">"gid"</span>: 0,</div><div class="line">    <span class="string">"group"</span>: <span class="string">"root"</span>,</div><div class="line">    <span class="string">"md5sum"</span>: <span class="string">"c151602e79a336ca363928dea68d2567"</span>,</div><div class="line">    <span class="string">"mode"</span>: <span class="string">"0644"</span>,</div><div class="line">    <span class="string">"owner"</span>: <span class="string">"root"</span>,</div><div class="line">    <span class="string">"size"</span>: 84431108,</div><div class="line">    <span class="string">"src"</span>: <span class="string">"/root/.ansible/tmp/ansible-tmp-1483939088.11-46151538408374/source"</span>,</div><div class="line">    <span class="string">"state"</span>: <span class="string">"file"</span>,</div><div class="line">    <span class="string">"uid"</span>: 0</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="æ‰¹é‡æ§åˆ¶è§£å‹æ–‡ä»¶"><a href="#æ‰¹é‡æ§åˆ¶è§£å‹æ–‡ä»¶" class="headerlink" title="æ‰¹é‡æ§åˆ¶è§£å‹æ–‡ä»¶"></a>æ‰¹é‡æ§åˆ¶è§£å‹æ–‡ä»¶</h4><p>æ‰¹é‡è§£å‹å‘½ä»¤ï¼š</p>
<p><code>ansible cluster1:children -m shell -a  &quot;tar -zxvf /srv/logstash.tar.gz&quot; -C /srv/.</code></p>
<h3 id="äº”ã€yumæ¨¡å—"><a href="#äº”ã€yumæ¨¡å—" class="headerlink" title="äº”ã€yumæ¨¡å—"></a>äº”ã€yumæ¨¡å—</h3><h5 id="yumå®‰è£…ä½¿ç”¨ï¼š"><a href="#yumå®‰è£…ä½¿ç”¨ï¼š" class="headerlink" title="yumå®‰è£…ä½¿ç”¨ï¼š"></a>yumå®‰è£…ä½¿ç”¨ï¼š</h5><p>ä½¿ç”¨yumåŒ…ç®¡ç†å™¨æ¥ç®¡ç†è½¯ä»¶åŒ…ï¼Œå…¶é€‰é¡¹æœ‰ï¼š </p>
<ul>
<li>config_fileï¼šyumçš„é…ç½®æ–‡ä»¶ </li>
<li>disable_gpg_checkï¼šå…³é—­gpg_check </li>
<li>disablerepoï¼šä¸å¯ç”¨æŸä¸ªæº </li>
<li>enablerepoï¼šå¯ç”¨æŸä¸ªæº</li>
<li>nameï¼šè¦è¿›è¡Œæ“ä½œçš„è½¯ä»¶åŒ…çš„åå­—ï¼Œä¹Ÿå¯ä»¥ä¼ é€’ä¸€ä¸ªurlæˆ–è€…ä¸€ä¸ªæœ¬åœ°çš„rpmåŒ…çš„è·¯å¾„<br>stateï¼šçŠ¶æ€ï¼ˆpresentï¼Œabsentï¼Œlatestï¼‰</li>
</ul>
<p>ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ansible tomcat_D1 <span class="_">-s</span> -m yum <span class="_">-a</span> <span class="string">"name=wget state=latest"</span></div></pre></td></tr></table></figure>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/ansible_02.png" alt=""></figure></p>
<figure class="highlight prolog"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">[root@ansible playbook]# ansible tomcat_D1 -s -<span class="symbol">C</span> -m yum -a <span class="string">"name=kernel state=latest"</span></div><div class="line"><span class="number">192.168</span><span class="number">.1</span><span class="number">.178</span> | <span class="symbol">SUCCESS</span> =&gt; &#123;</div><div class="line">    <span class="string">"changed"</span>: true,</div><div class="line">    <span class="string">"changes"</span>: &#123;</div><div class="line">        <span class="string">"installed"</span>: [],</div><div class="line">        <span class="string">"updated"</span>: [</div><div class="line">            [</div><div class="line">                <span class="string">"kernel"</span>,</div><div class="line">                <span class="string">"2.6.32-642.4.2.el6.x86_64 from updates"</span></div><div class="line">            ]</div><div class="line">        ]</div><div class="line">    &#125;,</div><div class="line">    <span class="string">"msg"</span>: <span class="string">""</span>,</div><div class="line">    <span class="string">"rc"</span>: <span class="number">0</span>,</div><div class="line">    <span class="string">"results"</span>: []</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="å…­-serviceæ¨¡å—"><a href="#å…­-serviceæ¨¡å—" class="headerlink" title="å…­ serviceæ¨¡å—"></a>å…­ serviceæ¨¡å—</h3><p>ç”¨äºç®¡ç†æœåŠ¡ è¯¥æ¨¡å—åŒ…å«å¦‚ä¸‹é€‰é¡¹ï¼š</p>
<ul>
<li>argumentsï¼šç»™å‘½ä»¤è¡Œæä¾›ä¸€äº›é€‰é¡¹ </li>
<li>enabledï¼šæ˜¯å¦å¼€æœºå¯åŠ¨ yes|no nameï¼šå¿…é€‰é¡¹ï¼ŒæœåŠ¡åç§°</li>
<li>patternï¼šå®šä¹‰ä¸€ä¸ªæ¨¡å¼ï¼Œå¦‚æœé€šè¿‡statusæŒ‡ä»¤æ¥æŸ¥çœ‹æœåŠ¡çš„çŠ¶æ€æ—¶ï¼Œæ²¡æœ‰å“åº”ï¼Œå°±ä¼šé€šè¿‡psæŒ‡ä»¤åœ¨è¿›ç¨‹ä¸­æ ¹æ®è¯¥æ¨¡å¼è¿›è¡ŒæŸ¥æ‰¾ï¼Œå¦‚æœåŒ¹é…åˆ°ï¼Œåˆ™è®¤ä¸ºè¯¥æœåŠ¡ä¾ç„¶åœ¨è¿è¡Œ</li>
<li>runlevelï¼šè¿è¡Œçº§åˆ« </li>
<li>sleepï¼šå¦‚æœæ‰§è¡Œäº†restartedï¼Œåœ¨åˆ™stopå’Œstartä¹‹é—´æ²‰ç¡å‡ ç§’é’Ÿ </li>
<li>stateï¼šå¯¹å½“å‰æœåŠ¡æ‰§è¡Œå¯åŠ¨ï¼Œåœæ­¢ã€é‡å¯ã€é‡æ–°åŠ è½½ç­‰æ“ä½œï¼ˆstarted,stopped,restarted,reloadedï¼‰ </li>
</ul>
<p>ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ansible test -m service -<span class="selector-tag">a</span> <span class="string">"name=httpd state=started enabled=yes"</span> </div><div class="line">ansible test -m service -<span class="selector-tag">a</span> <span class="string">"name=foo pattern=/usr/bin/foo state=started"</span> </div><div class="line">ansible test -m service -<span class="selector-tag">a</span> <span class="string">"name=network state=restarted args=eth0"</span></div><div class="line">ansible cluster2:children -m service -<span class="selector-tag">a</span> <span class="string">"name=logstash pattern=/etc/init.d/logstash state=started"</span></div></pre></td></tr></table></figure>
<p>å‚è€ƒï¼š<a href="http://www.361way.com/ansible-modules/4415.html" target="_blank" rel="external">http://www.361way.com/ansible-modules/4415.html</a></p>
<h3 id="ä¸ƒ-shell-æ¨¡å—"><a href="#ä¸ƒ-shell-æ¨¡å—" class="headerlink" title="ä¸ƒ shell æ¨¡å—"></a>ä¸ƒ shell æ¨¡å—</h3><p>è¿™é‡Œæˆ‘å†™ä¸ªä¾‹å­ï¼š</p>
<p>æ‰¹é‡æ›´æ”¹ç»„çš„æœºå™¨çš„ç”¨æˆ·åå¯†ç ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">[root@salt ansible]<span class="comment"># ansible cluster1:children -m shell -a "echo "Ihaozhuo" | passwd --stdin "root" "</span></div><div class="line">10.43.59.190 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">æ›´æ”¹ç”¨æˆ· root çš„å¯†ç  ã€‚</div><div class="line">passwdï¼š æ‰€æœ‰çš„èº«ä»½éªŒè¯ä»¤ç‰Œå·²ç»æˆåŠŸæ›´æ–°ã€‚</div><div class="line"></div><div class="line">10.23.2.106 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">æ›´æ”¹ç”¨æˆ· root çš„å¯†ç  ã€‚</div><div class="line">passwdï¼š æ‰€æœ‰çš„èº«ä»½éªŒè¯ä»¤ç‰Œå·²ç»æˆåŠŸæ›´æ–°ã€‚</div><div class="line"></div><div class="line">10.23.232.85 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">æ›´æ”¹ç”¨æˆ· root çš„å¯†ç  ã€‚</div><div class="line">passwdï¼š æ‰€æœ‰çš„èº«ä»½éªŒè¯ä»¤ç‰Œå·²ç»æˆåŠŸæ›´æ–°ã€‚</div><div class="line"></div><div class="line">10.23.232.131 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">æ›´æ”¹ç”¨æˆ· root çš„å¯†ç  ã€‚</div><div class="line">passwdï¼š æ‰€æœ‰çš„èº«ä»½éªŒè¯ä»¤ç‰Œå·²ç»æˆåŠŸæ›´æ–°ã€‚</div></pre></td></tr></table></figure>
<p>æŸ¥çœ‹åˆ†ç»„ä¸Šæœºå™¨æ‰€æœ‰ç«¯å£ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">[root@salt ansible]<span class="comment"># ansible zk1:children -m shell -a "netstat -ntulp"</span></div><div class="line">10.37.238.75 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">Active Internet connections (only servers)</div><div class="line">Proto Recv-Q Send-Q Local Address               Foreign Address             State       PID/Program name</div><div class="line">tcp        0      0 0.0.0.0:2181                0.0.0.0:*                   LISTEN      12497/java</div><div class="line">tcp        0      0 0.0.0.0:56521               0.0.0.0:*                   LISTEN      12497/java</div><div class="line">tcp        0      0 0.0.0.0:22                  0.0.0.0:*                   LISTEN      1251/sshd</div><div class="line">tcp        0      0 0.0.0.0:4888                0.0.0.0:*                   LISTEN      12497/java</div><div class="line">tcp        0      0 127.0.0.1:15770             0.0.0.0:*                   LISTEN      1434/aegis_quartz</div><div class="line">udp        0      0 118.178.240.129:123         0.0.0.0:*                               1262/ntpd</div><div class="line">udp        0      0 10.27.238.75:123            0.0.0.0:*                               1262/ntpd</div><div class="line">udp        0      0 127.0.0.1:123               0.0.0.0:*                               1262/ntpd</div><div class="line">udp        0      0 0.0.0.0:123                 0.0.0.0:*                               1262/ntpd</div><div class="line"></div><div class="line">10.37.100.200 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">Active Internet connections (only servers)</div><div class="line">Proto Recv-Q Send-Q Local Address               Foreign Address             State       PID/Program name</div><div class="line">tcp        0      0 0.0.0.0:58367               0.0.0.0:*                   LISTEN      11232/java</div><div class="line">tcp        0      0 10.47.100.200:10050         0.0.0.0:*                   LISTEN      646/zabbix_agentd</div><div class="line">tcp        0      0 0.0.0.0:2181                0.0.0.0:*                   LISTEN      11232/java</div><div class="line">tcp        0      0 0.0.0.0:22                  0.0.0.0:*                   LISTEN      1243/sshd</div><div class="line">tcp        0      0 0.0.0.0:4888                0.0.0.0:*                   LISTEN      11232/java</div><div class="line">tcp        0      0 127.0.0.1:15770             0.0.0.0:*                   LISTEN      1436/aegis_quartz</div><div class="line">udp        0      0 120.27.152.77:123           0.0.0.0:*                               1254/ntpd</div><div class="line">udp        0      0 10.47.100.200:123           0.0.0.0:*                               1254/ntpd</div><div class="line">udp        0      0 127.0.0.1:123               0.0.0.0:*                               1254/ntpd</div><div class="line">udp        0      0 0.0.0.0:123                 0.0.0.0:*                               1254/ntpd</div></pre></td></tr></table></figure>
<p>shell æ¨¡å— å¯ä»¥ç”¨çš„æœ€å¤šã€‚æŸ¥çœ‹ç›®å½•æ‰§è¡Œæ–‡ä»¶ç­‰ç­‰ã€‚</p>
<p>ansibleä¿®æ”¹çº¿ä¸ŠæœåŠ¡å™¨ä¸Šçš„å¯†ç </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">ansible cluster1:children -m shell <span class="_">-a</span> <span class="string">"echo "</span>Ihaozhuo_b3314<span class="string">" | passwd --stdin "</span>root<span class="string">" "</span></div><div class="line"></div><div class="line">ansible cluster2:children -m shell <span class="_">-a</span> <span class="string">"echo "</span>Ihaozhuo_b3314<span class="string">" | passwd --stdin "</span>root<span class="string">" "</span></div><div class="line"></div><div class="line">ansible cluster3:children -m shell <span class="_">-a</span> <span class="string">"echo "</span>Ihaozhuo_b3314<span class="string">" | passwd --stdin "</span>root<span class="string">" "</span></div><div class="line"></div><div class="line">ansible zk1:children -m shell <span class="_">-a</span> <span class="string">"echo "</span>Ihaozhuo_b3314<span class="string">" | passwd --stdin "</span>root<span class="string">" "</span></div><div class="line"></div><div class="line">ansible  kafka1:children -m shell <span class="_">-a</span> <span class="string">"echo "</span>Ihaozhuo_b3314<span class="string">" | passwd --stdin "</span>root<span class="string">" "</span></div><div class="line"></div><div class="line">ansible  es1:children -m shell <span class="_">-a</span> <span class="string">"echo "</span>Ihaozhuo_b3314<span class="string">" | passwd --stdin "</span>root<span class="string">" "</span></div><div class="line"></div><div class="line">ansible  ihaozhuo1:children -m shell <span class="_">-a</span> <span class="string">"echo "</span>Ihaozhuo_b3314<span class="string">" | passwd --stdin "</span>root<span class="string">" "</span></div><div class="line"></div><div class="line">ansible  monitor1:children -m shell <span class="_">-a</span> <span class="string">"echo "</span>Ihaozhuo_b3314<span class="string">" | passwd --stdin "</span>root<span class="string">" "</span></div></pre></td></tr></table></figure>
<h2 id="2ã€Ansible-æ€»ç»“ä¸¾ä¾‹å¸¸ç”¨æ¨¡å—å­¦ä¹ "><a href="#2ã€Ansible-æ€»ç»“ä¸¾ä¾‹å¸¸ç”¨æ¨¡å—å­¦ä¹ " class="headerlink" title="2ã€Ansible æ€»ç»“ä¸¾ä¾‹å¸¸ç”¨æ¨¡å—å­¦ä¹ "></a>2ã€Ansible æ€»ç»“ä¸¾ä¾‹å¸¸ç”¨æ¨¡å—å­¦ä¹ </h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">shell &gt; ansible-doc <span class="_">-l</span>    <span class="comment"># åˆ—å‡º Ansible æ”¯æŒçš„æ¨¡å—</span></div><div class="line">shell &gt; ansible-doc ping  <span class="comment"># æŸ¥çœ‹è¯¥æ¨¡å—å¸®åŠ©ä¿¡æ¯</span></div></pre></td></tr></table></figure>
<blockquote>
<p>è¿œç¨‹å‘½ä»¤æ¨¡å—ï¼ˆ command / raw / script / shell ï¼‰</p>
</blockquote>
<p>command ä½œä¸º Ansible çš„é»˜è®¤æ¨¡å—ï¼Œå¯ä»¥è¿è¡Œè¿œç¨‹æƒé™èŒƒå›´æ‰€æœ‰çš„ shell å‘½ä»¤ï¼Œä¸æ”¯æŒç®¡é“ç¬¦ã€‚</p>
<p>ä¾‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">shell &gt; ansible Client -m <span class="built_in">command</span> <span class="_">-a</span> <span class="string">"free -m"</span>               <span class="comment"># æŸ¥çœ‹ Client åˆ†ç»„ä¸»æœºå†…å­˜ä½¿ç”¨æƒ…å†µ</span></div></pre></td></tr></table></figure>
<p>rawæ¨¡å— [ç±»ä¼¼äºcommandæ¨¡å—ã€æ”¯æŒç®¡é“ä¼ é€’]</p>
<p>ä¾‹ï¼š</p>
<figure class="highlight nsis"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ansible Client -m raw -a <span class="string">"ifconfig eth0 |sed -n 2p |awk '&#123;print \<span class="variable">$2</span>&#125;' |awk -F: '&#123;print \<span class="variable">$2</span>&#125;'"</span></div></pre></td></tr></table></figure>
<p>script çš„åŠŸèƒ½æ˜¯åœ¨è¿œç¨‹ä¸»æœºæ‰§è¡Œä¸»æ§ç«¯å­˜å‚¨çš„ shell è„šæœ¬æ–‡ä»¶ï¼Œç›¸å½“äº scp + shell ç»„åˆã€‚</p>
<p>ä¾‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">shell &gt; ansible Client -m script <span class="_">-a</span> <span class="string">"/home/test.sh 12 34"</span>    <span class="comment"># è¿œç¨‹æ‰§è¡Œæœ¬åœ°è„šæœ¬</span></div></pre></td></tr></table></figure>
<p>shell çš„åŠŸèƒ½æ˜¯æ‰§è¡Œè¿œç¨‹ä¸»æœºä¸Šçš„ shell è„šæœ¬æ–‡ä»¶ï¼Œæ”¯æŒç®¡é“ç¬¦ã€‚</p>
<p>ä¾‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">shell &gt; ansible Client -m shell <span class="_">-a</span> <span class="string">"/home/test.sh"</span>           <span class="comment"># æ‰§è¡Œè¿œç¨‹è„šæœ¬</span></div></pre></td></tr></table></figure>
<blockquote>
<p>copy æ¨¡å—ï¼ˆå®ç°ä¸»æ§ç«¯å‘ç›®æ ‡ä¸»æœºæ‹·è´æ–‡ä»¶ï¼Œç±»ä¼¼äº scp åŠŸèƒ½ï¼‰</p>
</blockquote>
<p>ä¾‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">shell &gt; ansible Client -m copy <span class="_">-a</span> <span class="string">"src=/home/test.sh desc=/tmp/ owner=root group=root mode=0755"</span>   </div><div class="line"><span class="comment"># å‘ Client ç»„ä¸­ä¸»æœºæ‹·è´ test.sh åˆ° /tmp ä¸‹ï¼Œå±ä¸»ã€ç»„ä¸º root ï¼Œæƒé™ä¸º 0755</span></div></pre></td></tr></table></figure>
<blockquote>
<p>stat æ¨¡å—ï¼ˆè·å–è¿œç¨‹æ–‡ä»¶çŠ¶æ€ä¿¡æ¯ï¼Œatime/ctime/mtime/md5/uid/gid ç­‰ä¿¡æ¯ï¼‰</p>
</blockquote>
<p>ä¾‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">shell &gt; ansible Client -m <span class="built_in">stat</span> <span class="_">-a</span> <span class="string">"path=/etc/syctl.conf"</span></div></pre></td></tr></table></figure>
<blockquote>
<p>get_url æ¨¡å—ï¼ˆå®ç°åœ¨è¿œç¨‹ä¸»æœºä¸‹è½½æŒ‡å®š URL åˆ°æœ¬åœ°ï¼Œæ”¯æŒ sha256sum æ–‡ä»¶æ ¡éªŒï¼‰</p>
</blockquote>
<p>ä¾‹ï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">shell</span><span class="bash"> &gt; ansible Client -m get_utl <span class="_">-a</span> <span class="string">"url=http://www.baidu.com dest=/tmp/index.html mode=0440 force=yes"</span></span></div></pre></td></tr></table></figure>
<blockquote>
<p>yum æ¨¡å—ï¼ˆè½¯ä»¶åŒ…ç®¡ç†ï¼‰</p>
</blockquote>
<p>ä¾‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">shell &gt; ansible Client -m yum <span class="_">-a</span> <span class="string">"name=curl state=latest"</span></div></pre></td></tr></table></figure>
<blockquote>
<p>cron æ¨¡å—ï¼ˆè¿œç¨‹ä¸»æœº crontab é…ç½®ï¼‰</p>
</blockquote>
<p>ä¾‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">shell &gt; ansible Client -m cron <span class="_">-a</span> <span class="string">"name='check dirs' hour='5,2' job='ls -alh &gt; /dev/null'"</span></div><div class="line"></div><div class="line">æ•ˆæœï¼š</div><div class="line"></div><div class="line"><span class="comment"># Ansible: check dirs</span></div><div class="line">* 5,2 * * * ls -alh &gt; /dev/null</div></pre></td></tr></table></figure>
<blockquote>
<p>mount æ¨¡å—ï¼ˆè¿œç¨‹ä¸»æœºåˆ†åŒºæŒ‚è½½ï¼‰</p>
</blockquote>
<p>ä¾‹ï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">shell</span><span class="bash"> &gt; ansible Client -m mount <span class="_">-a</span> <span class="string">"name=/mnt/data src=/dev/sd0 fstype=ext4 opts=ro state=present"</span></span></div></pre></td></tr></table></figure>
<blockquote>
<p>service æ¨¡å—ï¼ˆè¿œç¨‹ä¸»æœºç³»ç»ŸæœåŠ¡ç®¡ç†ï¼‰</p>
</blockquote>
<p>ä¾‹ï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">shell</span><span class="bash"> &gt; ansible Client -m service <span class="_">-a</span> <span class="string">"name=nginx state=stoped"</span></span></div><div class="line"><span class="keyword">shell</span><span class="bash"> &gt; ansible Client -m service <span class="_">-a</span> <span class="string">"name=nginx state=restarted"</span></span></div><div class="line"><span class="keyword">shell</span><span class="bash"> &gt; ansible Client -m service <span class="_">-a</span> <span class="string">"name=nginx state=reloaded"</span></span></div></pre></td></tr></table></figure>
<blockquote>
<p>user æœåŠ¡æ¨¡å—ï¼ˆè¿œç¨‹ä¸»æœºç”¨æˆ·ç®¡ç†ï¼‰</p>
</blockquote>
<p>ä¾‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">shell &gt; ansible Client -m user <span class="_">-a</span> <span class="string">"name=wang comment='user wang'"</span></div><div class="line">shell &gt; ansible Client -m user <span class="_">-a</span> <span class="string">"name=wang state=absent remove=yes"</span>    <span class="comment"># æ·»åŠ åˆ é™¤ç”¨æˆ·</span></div></pre></td></tr></table></figure>

	

	

</article>




	<article>
	
		<h1><a href="/2016/03/07/è‡ªåŠ¨åŒ–+Jenkins/Ansible/Ansible å°ç»“ï¼ˆä¸€ï¼‰ansibleçš„å®‰è£… /">Ansible å°ç»“ï¼ˆä¸€ï¼‰ansibleçš„å®‰è£…</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-03-07</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/automation/">automation</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Ansible/">Ansible</a>
			</span>
		
	</div>

	

	
		<p>ä¸Šä¸€ç¯‡æ–‡ç« è®°å½•äº†è§£ansible,è¿™ç¯‡å¤§æ¦‚è®°å½•ä¸‹å¸¸è§„ä½¿ç”¨å‘½ä»¤ã€‚</p>
<p>è¿™é‡Œä»¥CentOS Linux release 7.2.1511 (Core)ç³»ç»Ÿä¸ºå‡†ã€‚</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/ansible_03.png" alt=""></figure></p>
<h3 id="ä¸€ã€Ansibleçš„å®‰è£…"><a href="#ä¸€ã€Ansibleçš„å®‰è£…" class="headerlink" title="ä¸€ã€Ansibleçš„å®‰è£…"></a>ä¸€ã€Ansibleçš„å®‰è£…</h3><h4 id="Centoså®‰è£…"><a href="#Centoså®‰è£…" class="headerlink" title="Centoså®‰è£…"></a>Centoså®‰è£…</h4><p>1ã€yumæºå®‰è£…</p>
<p>ä»¥centosä¸ºä¾‹ï¼Œé»˜è®¤åœ¨æºé‡Œæ²¡æœ‰ansibleï¼Œä¸è¿‡åœ¨fedora epelæºé‡Œæœ‰ansibleï¼Œé…ç½®å®Œepel æºåï¼Œå¯ä»¥ç›´æ¥é€šè¿‡yum è¿›è¡Œå®‰è£…ã€‚è¿™é‡Œä»¥centos6.8ä¸ºä¾‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">centos 6</div><div class="line"><span class="comment"># yum install http://mirrors.sohu.com/fedora-epel/6/x86_64/epel-release-6-8.noarch.rpm</span></div><div class="line"></div><div class="line">centos 7</div><div class="line"><span class="comment"># yum install http://mirrors.sohu.com/fedora-epel/7/x86_64/Packages/e/epel-release-7-11.noarch.rpm</span></div><div class="line"><span class="comment"># yum install -y ansible</span></div></pre></td></tr></table></figure>
<h4 id="Ubuntuå®‰è£…"><a href="#Ubuntuå®‰è£…" class="headerlink" title="Ubuntuå®‰è£…"></a>Ubuntuå®‰è£…</h4><p>2ã€apt-getå®‰è£…</p>
<p>åœ¨ubuntuåŠå…¶è¡ç”Ÿç‰ˆä¸­ï¼Œå¯ä»¥é€šè¿‡å¢åŠ ppaæºè¿›è¡Œapt-getå®‰è£…ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span><span class="bash"> sudo apt-get install software-properties-common</span></div><div class="line"><span class="meta">$</span><span class="bash"> sudo apt-add-repository ppa:ansible/ansible</span></div><div class="line"><span class="meta">$</span><span class="bash"> sudo apt-get update</span></div><div class="line"><span class="meta">$</span><span class="bash"> sudo apt-get install ansible</span></div></pre></td></tr></table></figure>
<p>3ã€æºç å®‰è£…</p>
<p>æºç å®‰è£…éœ€è¦python2.6ä»¥ä¸Šç‰ˆæœ¬ï¼Œå…¶ä¾èµ–æ¨¡å—paramikoã€PyYAMLã€Jinja2ã€httplib2ã€simplejsonã€pycryptoæ¨¡å—ï¼Œä»¥ä¸Šæ¨¡å—å¯ä»¥é€šè¿‡pipæˆ–easy_install è¿›è¡Œå®‰è£…ï¼Œä¸è¿‡æœ¬éƒ¨åˆ†æ—¢ç„¶æåˆ°çš„æ˜¯æºç å®‰è£…ï¼Œä¸»è¦é’ˆå¯¹çš„æ— æ³•ä¸Šå¤–ç½‘çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡pypi ç«™ç‚¹æœç´¢ä»¥ä¸ŠåŒ…ï¼Œä¸‹è½½åé€šè¿‡python setup.py install è¿›è¡Œå®‰è£…ã€‚</p>
<p>æœ€åé€šè¿‡githubæˆ–pypiä¸Šä¸‹è½½ansibleæºç åŒ…ï¼Œé€šè¿‡python setup.py install å®‰è£…å³å¯ã€‚ç”±äºå®‰è£…è¿‡ç¨‹ç›¸å¯¹ç®€å•ï¼Œè¿™é‡Œç•¥è¿‡ï¼Œä¸»è¦ä»‹ç»å®‰è£…åï¼Œå¯èƒ½é‡åˆ°çš„é—®é¢˜ã€‚</p>
<p>aã€å®‰è£…PyYAMLæ—¶ï¼ŒæŠ¥é”™å¦‚ä¸‹ï¼š</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"># python setup.py install</div><div class="line">libyaml is <span class="keyword">not</span> found <span class="keyword">or</span> a compiler error: forcing --without-libyaml</div><div class="line">(<span class="keyword">if</span> libyaml is installed correctly, you may need to</div><div class="line"> specify the <span class="keyword">option</span> --include-dirs <span class="keyword">or</span> uncomment <span class="keyword">and</span></div><div class="line"> modify the <span class="keyword">parameter</span> include_dirs <span class="comment">in setup.cfg)</span></div><div class="line">running <span class="comment">install_lib</span></div><div class="line">running <span class="comment">install_egg_info</span></div><div class="line">Removing /usr/<span class="comment">lib64</span>/python2<span class="number">.6</span>/<span class="comment">site-packages</span>/PyYAML<span class="number">-3.11</span>-py2<span class="number">.6</span>.egg-info</div><div class="line">Writing /<span class="comment">usr</span>/lib64/<span class="comment">python2.6</span>/site-packages/<span class="comment">PyYAML-3.11-py2.6.egg-info</span></div></pre></td></tr></table></figure>
<p>åœ¨centos6.8ç³»ç»Ÿä¸­ï¼Œå¯ä»¥é€šè¿‡<code>yum -y install libyaml</code>åŒ…è§£å†³ï¼Œæˆ–è€…ä»ISOæ–‡ä»¶ä¸­æä¾›è¯¥åŒ…ï¼Œé€šè¿‡rpm -ivhè¿›è¡Œå®‰è£…ã€‚</p>
<p>###äºŒã€Ansibleçš„é…ç½®ä¸éªŒè¯</p>
<p>yum å®‰è£…ä½¿ç”¨é»˜è®¤ç¤ºä¾‹é…ç½®æ–‡ä»¶åï¼Œç¼–è¾‘/etc/ansible/hostsæ–‡ä»¶ï¼Œé€šè¿‡ä»¥ä¸‹æ–¹å¼éªŒè¯ansibleæ˜¯å¦å¯ç”¨ï¼š</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]# cat /etc/ansible/hosts</div><div class="line">[test]</div><div class="line"><span class="number">10.212</span><span class="number">.52</span><span class="number">.252</span> ansible_ssh_user=root ansible_ssh_pass=qwe123.com</div><div class="line"><span class="number">10.212</span><span class="number">.52</span><span class="number">.14</span> ansible_ssh_user=root ansible_ssh_pass=abc123</div><div class="line"><span class="number">10.212</span><span class="number">.52</span><span class="number">.16</span> ansible_ssh_user=root ansible_ssh_pass=<span class="number">91</span>it.org</div></pre></td></tr></table></figure>
<p>ä»¥ä¸Šçš„é…ç½®ä¸­ï¼Œæˆ‘é…ç½®äº†ä¸€ä¸ªtestç»„ï¼Œè¯¥ç»„ä¸‹æœ‰ä¸‰å°ä¸»æœºï¼Œä¸‰å°éƒ½ä½¿ç”¨rootéªŒè¯ï¼Œä¸‰å°çš„å¯†ç åˆ†åˆ«æ˜¯361way.comã€abc123ã€91it.org ã€‚</p>
<p>æ³¨ï¼šåé¢çš„ç”¨æˆ·å’Œå¯†ç é¡¹æ˜¯éå¿…é¡»çš„ï¼Œåœ¨é…ç½®keyè®¤è¯çš„æƒ…å†µä¸‹ï¼Œä¸ä½¿ç”¨å¯†ç ä¹Ÿå¯ä»¥ç›´æ¥æ“ä½œ ã€‚æœªä½¿ç”¨keyçš„ï¼Œä¹Ÿå¯ä»¥åœ¨ansibleé€šè¿‡ -kå‚æ•°åœ¨æ“ä½œå‰è¯¢é—®æ‰‹åŠ¨è¾“å…¥å¯†ç ã€‚</p>
<p>é…ç½®æ–‡ä»¶å°±æ˜¯ä¸€èˆ¬ä¸‹ç›®å½•çš„hostsæ–‡ä»¶ã€‚</p>
<p>åœ¨åº“å­˜ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<ul>
<li>ä¸»æœºåœ°å€</li>
<li>ä¸»æœºåˆ†ç»„</li>
<li>è¿æ¥å±æ€§ï¼ˆç™»å½•åï¼Œå¯†ç ï¼Œç§˜é’¥ï¼Œç«¯å£ç­‰ï¼‰<br>1ï¼Œä¸»æœºåœ°å€å’Œåˆ†ç»„</li>
</ul>
<p>å®šä¹‰ä¸»æœºåœ°å€å’Œåç§°æ¯”è¾ƒç®€å•ï¼š</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">[&lt;ä¸»æœºå&gt;]</span></div><div class="line">&lt;ä¸»æœº IP&gt;</div></pre></td></tr></table></figure>
<p>å®šä¹‰åˆ†ç»„çš„è¯­æ³•ç±»ä¼¼ï¼Œå°±æ˜¯åœ¨åå­—ååŠ ä¸Š:childrenï¼Œæˆå‘˜å¯ä»¥æ˜¯ä¸»æœºåï¼Œä¹Ÿå¯ä»¥æ˜¯åˆ†ç»„åï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[<span class="tag">&lt;<span class="name">åˆ†ç»„å</span>&gt;</span>:children]</div><div class="line"><span class="tag">&lt;<span class="name">ä¸»æœºå</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">åˆ†ç»„å</span>&gt;</span></div></pre></td></tr></table></figure>
<p>2ï¼Œè¿æ¥å±æ€§</p>
<p>å¯ä»¥é’ˆå¯¹SSHè¿æ¥æŒ‡å®šä¸€äº›å‚æ•°ï¼š</p>
<ul>
<li><code>ansible_ssh_host</code>ï¼šä¸»æœºåã€‚</li>
<li><code>ansible_ssh_port</code>ï¼šSSHç«¯å£ï¼Œé»˜è®¤22ã€‚</li>
<li><code>ansible_ssh_user</code>ï¼šç™»å½•ç”¨æˆ·ã€‚</li>
<li><code>ansible_ssh_pass</code>ï¼šç™»é™†å¯†ç ã€‚</li>
<li><code>ansible_ssh_private_key_file</code>ï¼šç§é’¥ã€‚</li>
</ul>
<p>é€šè¿‡ç§é’¥ç™»é™†çš„è¯ï¼Œå°±ä¸è¦æŒ‡å®šç™»å½•å¯†ç äº†ï¼Œä¸»æœºåä¹Ÿå¯ä»¥å¿½ç•¥ã€‚å½“ç„¶ï¼Œæ—¢ç„¶æ˜¯ä½¿ç”¨ç§é’¥ç™»é™†ï¼Œéœ€è¦ä½ ç¡®ä¿å·²ç»åœ¨å„ä¸ªä¸­ä¸»æœºçš„authorized_keysé‡Œæ·»åŠ äº†å¯¹åº”çš„å…¬é’¥ã€‚</p>
<p>3ï¼Œæ¼”ç¤º</p>
<p>å®Œæ•´çš„åº“å­˜ä¾‹å­å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> -----------------</span></div><div class="line"><span class="meta">#</span><span class="bash"> é¦–å…ˆå®šä¹‰å„ä¸ªä¸»æœº</span></div><div class="line"><span class="meta">#</span><span class="bash"> -----------------</span></div><div class="line"><span class="meta">#</span><span class="bash">============================01_version=============================<span class="comment">#</span></span></div><div class="line"></div><div class="line">[tomcat-account_01]</div><div class="line">  10.27.232.82</div><div class="line">[tomcat-point_01]</div><div class="line">  10.27.2.12</div><div class="line">[tomcat-system_01]</div><div class="line">   10.27.232.12</div><div class="line"> [tomcat-family_01]</div><div class="line">   10.27.230.63</div><div class="line"> [tomcat-mission_01]</div><div class="line">   10.47.59.12</div><div class="line"> [tomcat-card_01]</div><div class="line">   10.47.74.12</div><div class="line"> [tomcat-check_01]</div><div class="line">   10.47.107.153</div><div class="line">   </div><div class="line"><span class="meta">#</span><span class="bash"> -----------------</span></div><div class="line"><span class="meta">#</span><span class="bash"> å®šä¹‰åˆ†ç»„</span></div><div class="line"><span class="meta">#</span><span class="bash"></span></div><div class="line"><span class="meta">#</span><span class="bash"> åœ¨è¿™é‡Œæˆ‘ä»¬å®šä¹‰äº†ä¸‰ä¸ªåˆ†ç»„ï¼Œåˆ†åˆ«åä¸ºï¼š</span></div><div class="line"><span class="meta">#</span><span class="bash">   - cluster1</span></div><div class="line"><span class="meta">#</span><span class="bash">   - light</span></div><div class="line"><span class="meta">#</span><span class="bash">   - starwar</span></div><div class="line"><span class="meta">#</span><span class="bash"> -----------------</span></div><div class="line"></div><div class="line">[cluster1:children]</div><div class="line">tomcat-account_01</div><div class="line">tomcat-point_01</div><div class="line">tomcat-system_01</div><div class="line">tomcat-family_01</div><div class="line">tomcat-mission_01</div><div class="line"></div><div class="line">[light:children]</div><div class="line">tomcat-account_01</div><div class="line">tomcat-point_01</div><div class="line">tomcat-system_01</div><div class="line">tomcat-family_01</div><div class="line">tomcat-mission_01</div><div class="line"></div><div class="line">[starwar:children]</div><div class="line">tomcat-account_01</div><div class="line">tomcat-point_01</div><div class="line">tomcat-system_01</div><div class="line">tomcat-family_01</div><div class="line">tomcat-mission_01</div><div class="line"><span class="meta"></span></div><div class="line">#<span class="bash"> -----------------</span></div><div class="line"><span class="meta">#</span><span class="bash"> ç»™åˆ†ç»„å®šä¹‰å˜é‡</span></div><div class="line"><span class="meta">#</span><span class="bash"></span></div><div class="line"><span class="meta">#</span><span class="bash"> è¿™é‡Œæˆ‘ä»¬ç»™ starwar ç»„å®šä¹‰äº†å˜é‡ </span></div><div class="line"><span class="meta">#</span><span class="bash"> -----------------</span></div><div class="line">[cluster1:vars]</div><div class="line">ansible_ssh_port=7525</div><div class="line">ansible_ssh_user=lucas</div><div class="line">ansible_ssh_private_key_file=./ssh/id_rsa</div></pre></td></tr></table></figure>
<p>è¿™é‡Œè®¾ç½®åˆ†ç»„çš„æ—¶å€™åå­—ä¸èƒ½ä¸å•å°æœºå™¨åç§°ä¸€æ ·ã€‚æ¯”å¦‚ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[tomcat-account_01]</div><div class="line">  10.27.232.82</div><div class="line">[tomcat-account_01:children]</div><div class="line">tomcat-account_01</div></pre></td></tr></table></figure>
<p>è¿™é‡Œä¾‹å­æ˜¯é”™è¯¯çš„ï¼Œä¼šæç¤ºåˆ†ç»„å­˜åœ¨ã€‚</p>
<p>ä¸ºäº†å®‰å…¨å’Œæ–¹ä¾¿åœ¨hostsé‡Œé¢å°±ä¸éœ€è¦å†™ç”¨æˆ·åå’Œå¯†ç ã€‚<br>åšä¸ªå…ç§˜é’¥ç™»é™†ã€‚<br>è¿™é‡Œæˆ‘è‡ªå·±å¯¹æ§åˆ¶çš„æœºå™¨å…¨éƒ¨åšäº†å…ç§˜é’¥ç™»é™†ï¼Œæ‰€ä»¥è¿™é‡Œåªéœ€è¦è¿™ä¹ˆå†™ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">[redis1]</div><div class="line">192.168.1.173</div><div class="line"></div><div class="line">[redis2]</div><div class="line">192.168.1.174</div><div class="line"></div><div class="line">[tomcat_A1]</div><div class="line">192.168.1.175</div><div class="line"></div><div class="line">[tomcat_B1]</div><div class="line">192.168.1.176</div><div class="line"></div><div class="line">[tomcat_C1]</div><div class="line">192.168.1.177</div><div class="line"></div><div class="line">[tomcat_D1]</div><div class="line">192.168.1.178</div></pre></td></tr></table></figure>
<p>è¿™é‡Œæ˜¯æ‰§è¡Œè„šæœ¬ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ansible tomcat_D1 -m shell <span class="_">-a</span> <span class="string">"sh +x  /root/update/shoppingmall.sh"</span></div></pre></td></tr></table></figure>
<p>ä¾‹å­æ“ä½œæŸ¥çœ‹zk1åˆ†ç»„ä¸Šæ‰€æœ‰æœºå™¨ç«¯å£ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">[root@salt ansible]<span class="comment"># ansible zk1:children -m shell -a "netstat -ntulp"</span></div><div class="line">10.27.238.75 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">Active Internet connections (only servers)</div><div class="line">Proto Recv-Q Send-Q Local Address               Foreign Address             State       PID/Program name</div><div class="line">tcp        0      0 0.0.0.0:2181                0.0.0.0:*                   LISTEN      12497/java</div><div class="line">tcp        0      0 0.0.0.0:56521               0.0.0.0:*                   LISTEN      12497/java</div><div class="line">tcp        0      0 0.0.0.0:22                  0.0.0.0:*                   LISTEN      1251/sshd</div><div class="line">tcp        0      0 0.0.0.0:4888                0.0.0.0:*                   LISTEN      12497/java</div><div class="line">tcp        0      0 127.0.0.1:15770             0.0.0.0:*                   LISTEN      1434/aegis_quartz</div><div class="line">udp        0      0 118.178.240.129:123         0.0.0.0:*                               1262/ntpd</div><div class="line">udp        0      0 10.27.238.75:123            0.0.0.0:*                               1262/ntpd</div><div class="line">udp        0      0 127.0.0.1:123               0.0.0.0:*                               1262/ntpd</div><div class="line">udp        0      0 0.0.0.0:123                 0.0.0.0:*                               1262/ntpd</div><div class="line"></div><div class="line">10.47.100.200 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">Active Internet connections (only servers)</div><div class="line">Proto Recv-Q Send-Q Local Address               Foreign Address             State       PID/Program name</div><div class="line">tcp        0      0 0.0.0.0:58367               0.0.0.0:*                   LISTEN      11232/java</div><div class="line">tcp        0      0 10.47.100.200:10050         0.0.0.0:*                   LISTEN      646/zabbix_agentd</div><div class="line">tcp        0      0 0.0.0.0:2181                0.0.0.0:*                   LISTEN      11232/java</div><div class="line">tcp        0      0 0.0.0.0:22                  0.0.0.0:*                   LISTEN      1243/sshd</div><div class="line">tcp        0      0 0.0.0.0:4888                0.0.0.0:*                   LISTEN      11232/java</div><div class="line">tcp        0      0 127.0.0.1:15770             0.0.0.0:*                   LISTEN      1436/aegis_quartz</div><div class="line">udp        0      0 120.27.152.77:123           0.0.0.0:*                               1254/ntpd</div><div class="line">udp        0      0 10.47.100.200:123           0.0.0.0:*                               1254/ntpd</div><div class="line">udp        0      0 127.0.0.1:123               0.0.0.0:*                               1254/ntpd</div><div class="line">udp        0      0 0.0.0.0:123                 0.0.0.0:*                               1254/ntpd</div></pre></td></tr></table></figure>

	

	

</article>




	<article>
	
		<h1><a href="/2016/03/07/è‡ªåŠ¨åŒ–+Jenkins/Ansible/ Ansible å­¦ä¹ å…¥é—¨ /">Ansible å­¦ä¹ å…¥é—¨</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-03-07</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/automation/">automation</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Ansible/">Ansible</a>
			</span>
		
	</div>

	

	
		<h1 id="Ansibleä»‹ç»"><a href="#Ansibleä»‹ç»" class="headerlink" title="Ansibleä»‹ç»"></a>Ansibleä»‹ç»</h1><hr>
<p><strong>å­¦ä¹ ansibleè¿™é‡Œæˆ‘è‡ªå·±åšäº†ç®€å•çš„ä»‹ç»æ€»ç»“ï¼š</strong></p>
<p>Ansibleæ˜¯ä¸€ä¸ªè‡ªåŠ¨åŒ–å·¥å…·ã€‚å®ƒå¯ä»¥é…ç½®ç³»ç»Ÿ,éƒ¨ç½²è½¯ä»¶,ç¼–æ’æ›´é«˜çº§çš„ä»»åŠ¡,æ¯”å¦‚è¿ç»­éƒ¨ç½²æˆ–é›¶åœæœºæ—¶é—´æ»šåŠ¨æ›´æ–°ã€‚</p>
<p>Ansibleçš„ç›®æ ‡æ˜¯æœ€ç®€å•å’Œæœ€æ˜“ç”¨ã€‚å®ƒä¹Ÿæœ‰ä¸€ä¸ªå¼ºçƒˆå…³æ³¨å®‰å…¨æ€§å’Œå¯é æ€§,ä»¥æœ€å°‘çš„ç§»åŠ¨éƒ¨ä»¶,ä½¿ç”¨OpenSSHè¿è¾“(åŠ é€Ÿæ’åº§æ¨¡å¼å’Œæ‹‰æ¨¡å¼é€‰æ‹©),å’Œè®¾è®¡è¯­è¨€,äººç±»å¯å®¡æ ¸æ€§çš„â€”â€”ç”šè‡³æ˜¯é‚£äº›ä¸ç†Ÿæ‚‰ç¨‹åºã€‚</p>
<p>æˆ‘ä»¬è®¤ä¸ºç®€å•æ˜¯æ‰€æœ‰å¤§å°çš„ç¯å¢ƒå’Œç›¸å…³çš„è®¾è®¡å¯¹äºå¿™ç¢Œçš„æ‰€æœ‰ç±»å‹çš„ç”¨æˆ·â€”â€”è¿™æ˜¯å¦æ„å‘³ç€å¼€å‘äººå‘˜ã€ç³»ç»Ÿç®¡ç†å‘˜,å‘å¸ƒå·¥ç¨‹å¸ˆ,ç»ç†,æ— å¤„ä¸åœ¨ã€‚Ansibleé€‚åˆç®¡ç†å°è®¾ç½®å°‘é‡çš„å®ä¾‹ä»¥åŠä¸è®¸å¤šæˆåƒä¸Šä¸‡çš„ä¼ä¸šç¯å¢ƒã€‚</p>
<p>Ansibleç®¡ç†æœºå™¨ä»¥æœ€å¥½çš„æ–¹å¼ã€‚æ²¡æœ‰ä¸€ä¸ªé—®é¢˜å¦‚ä½•å‡çº§è¿œç¨‹å®ˆæŠ¤è¿›ç¨‹æˆ–æ— æ³•ç®¡ç†ç³»ç»Ÿçš„é—®é¢˜å› ä¸ºå®ˆæŠ¤è¿›ç¨‹æ˜¯å¸è½½ã€‚OpenSSHæ˜¯æœ€åŒè¡Œè¯„è®®çš„å¼€æºç»„ä»¶,ä½¿ç”¨è¯¥å·¥å…·çš„å®‰å…¨é£é™©å¤§å¤§é™ä½ã€‚Ansibleæ˜¯åˆ†æ•£çš„,å®ƒä¾èµ–äºç°æœ‰çš„æ“ä½œç³»ç»Ÿå‡­è¯æ¥æ§åˆ¶è®¿é—®è¿œç¨‹æœºå™¨,å¦‚æœéœ€è¦ä½¿ç”¨Kerberos,å®ƒå¯ä»¥å¾ˆå®¹æ˜“åœ°è¿æ¥LDAPå’Œå…¶ä»–ç®¡ç†ç³»ç»Ÿçš„é›†ä¸­å¼èº«ä»½éªŒè¯ã€‚</p>
<p>Ansibleæ˜¯ä¸€ä¸ªå½»åº•çš„ç®€å•è‡ªåŠ¨åŒ–å¼•æ“,è‡ªåŠ¨åŒ–äº‘é…ç½®,é…ç½®ç®¡ç†ã€åº”ç”¨ç¨‹åºéƒ¨ç½²,intra-serviceç¼–æ’,ä»¥åŠè®¸å¤šå…¶ä»–çš„éœ€æ±‚ã€‚</p>
<p>è¢«è®¾è®¡ä¸ºå¤šå±‚éƒ¨ç½²è‡ªç¬¬ä¸€å¤©,Ansibleæ¨¡å‹ä½ çš„ITåŸºç¡€è®¾æ–½,æè¿°å¦‚ä½•æ¨åŠ¨ä½ æ‰€æœ‰çš„ç³»ç»Ÿ,è€Œä¸ä»…ä»…æ˜¯ç®¡ç†ä¸€ä¸ªç³»ç»Ÿã€‚</p>
<p>å®ƒä½¿ç”¨æ²¡æœ‰ä»£ç†,æ²¡æœ‰é¢å¤–çš„è‡ªå®šä¹‰å®‰å…¨åŸºç¡€è®¾æ–½,æ‰€ä»¥å¾ˆå®¹æ˜“éƒ¨ç½²,æœ€é‡è¦çš„æ˜¯,å®ƒä½¿ç”¨ä¸€ä¸ªéå¸¸ç®€å•çš„è¯­è¨€(YAML Ansible Playbooksçš„å½¢å¼),è®©ä½ æè¿°ä½ çš„è‡ªåŠ¨åŒ–å·¥ä½œçš„æ–¹å¼æ–¹æ³•ç®€æ˜è‹±è¯­ã€‚</p>
<p>æˆ‘ä»¬åˆ©ç”¨Ansibleä¸»è¦æ˜¯ä½œä¸ºå†…ç½‘æœåŠ¡å™¨çš„ä¸€äº›ç®¡ç†ï¼Œå› ä¸ºä»–ç”¨sshæ¥ç®¡ç†é…ç½®ï¼Œå†…ç½‘åŒå­¦è¿˜æ˜¯å¾ˆå¿«é€Ÿçš„ï¼Œå¤–ç½‘ä¸»è¦æ˜¯åˆ©ç”¨Saltstackï¼Œåˆ©ç”¨æ¶ˆæ¯é˜Ÿåˆ—è¿œç¨‹é€šä¿¡ï¼Œæˆ‘æ„Ÿè§‰æ˜¯æ¯”Ansibleå¥½çš„ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆé€‰æ‹©ansible</strong></p>
<p>Ansibleå¤§å®¶éƒ½çŸ¥é“ï¼Œå’Œsalt/puppetç­‰ä¸€æ ·ï¼Œæ˜¯ä¸€æ¬¾é…ç½®ç®¡ç†å·¥å…·ã€‚ä¸ºä»€ä¹ˆé€‰æ‹©å®ƒï¼Œå°±æ˜¯å› ä¸ºå®ƒç®€å•ï¼Œä¸éœ€è¦å®‰è£…agentï¼Œåªè¦æœåŠ¡å™¨èƒ½ç”¨sshè®¿é—®ï¼Œå°±å¯ä»¥ä½¿ç”¨å®ƒå»ç®¡ç†å¤§å®¶å¦‚æœè¦é—®ï¼Œå’Œæˆ‘ç”¨rsyncç›´æ¥åŒæ­¥æˆ–å†™ä¸ªforå¾ªç¯æ‰§è¡Œrpmæˆ–yumæœ‰ä»€ä¹ˆåŒºåˆ«.</p>
<p>æˆ‘æƒ³æœ€å¤§çš„åŒºåˆ«åº”è¯¥å°±æ˜¯â€œå¹¶å‘â€<br><strong>å½“ç„¶ï¼Œå¤§ä¼ä¸šä¼šè‡ªå·±å»å¼€å‘è‡ªå·±çš„æŒç»­éƒ¨ç½²å¹³å°ï¼Œè€Œå¤§éƒ¨åˆ†çš„è¿˜æ˜¯ä¸­å°å‹ä¼ä¸š</strong></p>
<p>å…¶å®éƒ¨ç½²æ¯ä¸ªç¯èŠ‚éƒ½å¯ä»¥ç”¨rpmå®‰è£…å‘å¸ƒã€‚</p>
<p>æˆ‘ä»¬çš„æŸä¸ªåº”ç”¨ç›´æ¥æ„å»ºæˆrpmï¼Œæ˜¯ç›´æ¥æ”¾åˆ°æˆ‘ä»¬å¦ä¸€ä¸ªå†…éƒ¨æœåŠ¡å™¨ä¸­ï¼Œæä¾›httpæ¥å£ï¼Œç„¶åæ‰§è¡Œçš„å°±æ˜¯yumæ¨¡å—è¿›è¡Œå®‰è£…ã€‚</p>
<p>ä¹Ÿæœ‰äººé—®æˆ‘saltæœ‰æ²¡æœ‰ç”¨è¿‡ã€‚å…¶å®æˆ‘ä»¬æœ€åˆæ˜¯ä½¿ç”¨saltçš„ï¼Œåæ¥å› ä¸ºç½‘ç»œçš„åŸå› ï¼Œé€‰æ‹©äº†æ²¡æœ‰agentçš„ansibleã€‚åœ¨é˜¿é‡Œäº‘ä¸Šé¢è¿˜æ˜¯saltå»æœåŠ¡ç®¡ç†ã€‚</p>
<p> å‚è€ƒå®˜ç½‘<a href="https://www.ansible.com/quick-start-video" target="_blank" rel="external">å…¥é—¨å­¦ä¹ è§†é¢‘</a></p>

	

	

</article>




	<article>
	
		<h1><a href="/2016/03/07/è‡ªåŠ¨åŒ–+Jenkins/Ansible/ansibleå°ç»“ï¼ˆäºŒï¼‰ansibleæ¶æ„ /">Ansibleå°ç»“ï¼ˆäºŒï¼‰ansibleæ¶æ„</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-03-07</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/automation/">automation</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Ansible/">Ansible</a>
			</span>
		
	</div>

	

	
		<p>Ansible æ˜¯ä¸€ä¸ªæ¨¡å‹é©±åŠ¨çš„é…ç½®ç®¡ç†å™¨ï¼Œæ”¯æŒå¤šèŠ‚ç‚¹å‘å¸ƒã€è¿œç¨‹ä»»åŠ¡æ‰§è¡Œã€‚é»˜è®¤ä½¿ç”¨ SSH è¿›è¡Œè¿œç¨‹è¿æ¥ã€‚æ— éœ€åœ¨è¢«ç®¡ç†èŠ‚ç‚¹ä¸Šå®‰è£…é™„åŠ è½¯ä»¶ï¼Œå¯ä½¿ç”¨å„ç§ç¼–ç¨‹è¯­è¨€è¿›è¡Œæ‰©å±•ã€‚</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/ansible_01.png" alt=""></figure></p>
<p>ä¸Šå›¾ä¸ºansibleçš„åŸºæœ¬æ¶æ„ï¼Œä»ä¸Šå›¾å¯ä»¥äº†è§£åˆ°å…¶ç”±ä»¥ä¸‹éƒ¨åˆ†ç»„æˆï¼š</p>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">æ ¸å¿ƒï¼šansible</div><div class="line">æ ¸å¿ƒæ¨¡å—ï¼ˆCore <span class="keyword">Modules</span>ï¼‰ï¼šè¿™äº›éƒ½æ˜¯ansibleè‡ªå¸¦çš„æ¨¡å— </div><div class="line">æ‰©å±•æ¨¡å—ï¼ˆCustom <span class="keyword">Modules</span>ï¼‰ï¼šå¦‚æœæ ¸å¿ƒæ¨¡å—ä¸è¶³ä»¥å®ŒæˆæŸç§åŠŸèƒ½ï¼Œå¯ä»¥æ·»åŠ æ‰©å±•æ¨¡å—</div><div class="line">æ’ä»¶ï¼ˆPluginsï¼‰ï¼šå®Œæˆæ¨¡å—åŠŸèƒ½çš„è¡¥å……</div><div class="line">å‰§æœ¬ï¼ˆPlaybooksï¼‰ï¼šansibleçš„ä»»åŠ¡é…ç½®æ–‡ä»¶ï¼Œå°†å¤šä¸ªä»»åŠ¡å®šä¹‰åœ¨å‰§æœ¬ä¸­ï¼Œç”±ansibleè‡ªåŠ¨æ‰§è¡Œ</div><div class="line">è¿æ¥æ’ä»¶ï¼ˆConnectior Pluginsï¼‰ï¼šansibleåŸºäºè¿æ¥æ’ä»¶è¿æ¥åˆ°å„ä¸ªä¸»æœºä¸Šï¼Œè™½ç„¶ansibleæ˜¯ä½¿ç”¨sshè¿æ¥åˆ°å„ä¸ªä¸»æœºçš„ï¼Œä½†æ˜¯å®ƒè¿˜æ”¯æŒå…¶ä»–çš„è¿æ¥æ–¹æ³•ï¼Œæ‰€ä»¥éœ€è¦æœ‰è¿æ¥æ’ä»¶</div><div class="line">ä¸»æœºç¾¤ï¼ˆHost Inventoryï¼‰ï¼šå®šä¹‰ansibleç®¡ç†çš„ä¸»æœº</div></pre></td></tr></table></figure>
<p>äºŒã€ansibleå·¥ä½œåŸç†</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"> <span class="number">1</span>ã€ç®¡ç†ç«¯æ”¯æŒlocal ã€sshã€zeromq ä¸‰ç§æ–¹å¼è¿æ¥è¢«ç®¡ç†ç«¯ï¼Œé»˜è®¤ä½¿ç”¨åŸºäºsshçš„è¿æ¥ï¼ï¼ï¼è¿™éƒ¨åˆ†å¯¹åº”åŸºæœ¬æ¶æ„å›¾ä¸­çš„è¿æ¥æ¨¡å—ï¼›</div><div class="line"></div><div class="line"><span class="number">2</span>ã€å¯ä»¥æŒ‰åº”ç”¨ç±»å‹ç­‰æ–¹å¼è¿›è¡ŒHost Inventoryï¼ˆä¸»æœºç¾¤ï¼‰åˆ†ç±»ï¼Œç®¡ç†èŠ‚ç‚¹é€šè¿‡å„ç±»æ¨¡å—å®ç°ç›¸åº”çš„æ“ä½œï¼ï¼ï¼å•ä¸ªæ¨¡å—ï¼Œå•æ¡å‘½ä»¤çš„æ‰¹é‡æ‰§è¡Œï¼Œæˆ‘ä»¬å¯ä»¥ç§°ä¹‹ä¸ºad-hocï¼›</div><div class="line"></div><div class="line"><span class="number">3</span>ã€ç®¡ç†èŠ‚ç‚¹å¯ä»¥é€šè¿‡playbooks å®ç°å¤šä¸ªtaskçš„é›†åˆå®ç°ä¸€ç±»åŠŸèƒ½ï¼Œå¦‚webæœåŠ¡çš„å®‰è£…éƒ¨ç½²ã€æ•°æ®åº“æœåŠ¡å™¨çš„æ‰¹é‡å¤‡ä»½ç­‰ã€‚playbooksæˆ‘ä»¬å¯ä»¥ç®€å•çš„ç†è§£ä¸ºï¼Œç³»ç»Ÿé€šè¿‡ç»„åˆå¤šæ¡ad-hocæ“ä½œçš„é…ç½®æ–‡ä»¶ ã€‚</div></pre></td></tr></table></figure>
<h2 id="ä¸‰ã€ansibleçš„ä¸ƒä¸ªå‘½ä»¤"><a href="#ä¸‰ã€ansibleçš„ä¸ƒä¸ªå‘½ä»¤" class="headerlink" title="ä¸‰ã€ansibleçš„ä¸ƒä¸ªå‘½ä»¤"></a>ä¸‰ã€ansibleçš„ä¸ƒä¸ªå‘½ä»¤</h2><p>å®‰è£…å®Œansibleåï¼Œå‘ç°ansibleä¸€å…±ä¸ºæˆ‘ä»¬æä¾›äº†ä¸ƒä¸ªæŒ‡ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">ansible</div><div class="line">ansible-doc</div><div class="line">ansible-galaxy</div><div class="line">ansible-lint</div><div class="line">ansible-playbook</div><div class="line">ansible-pull</div><div class="line">ansible-vault</div></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘ä»¬åªæŸ¥çœ‹usageéƒ¨åˆ†ï¼Œè¯¦ç»†éƒ¨åˆ†å¯ä»¥é€šè¿‡ â€œæŒ‡ä»¤ -hâ€  çš„æ–¹å¼è·å–ã€‚</p>
<h4 id="1ã€ansible"><a href="#1ã€ansible" class="headerlink" title="1ã€ansible"></a>1ã€ansible</h4><figure class="highlight haml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]# ansible -h</div><div class="line">Usage: ansible &lt;host-pattern&gt; [options]</div><div class="line">å‚æ•°ï¼š</div><div class="line">  -<span class="ruby">a <span class="string">'Arguments'</span>, --args=<span class="string">'Arguments'</span> å‘½ä»¤è¡Œå‚æ•°</span></div><div class="line">  -<span class="ruby">m NAME, --<span class="class"><span class="keyword">module</span>-<span class="title">name</span>=<span class="title">NAME</span> æ‰§è¡Œæ¨¡å—çš„åå­—ï¼Œé»˜è®¤ä½¿ç”¨ <span class="title">command</span> æ¨¡å—ï¼Œæ‰€ä»¥å¦‚æœæ˜¯åªæ‰§è¡Œå•ä¸€å‘½ä»¤å¯ä»¥ä¸ç”¨ -<span class="title">m</span>å‚æ•°</span></span></div><div class="line">  -<span class="ruby">i PATH, --inventory=PATH æŒ‡å®šåº“å­˜ä¸»æœºæ–‡ä»¶çš„è·¯å¾„,é»˜è®¤ä¸º/etc/ansible/hosts.</span></div><div class="line">  -<span class="ruby">u Usernameï¼Œ --user=Username æ‰§è¡Œç”¨æˆ·ï¼Œä½¿ç”¨è¿™ä¸ªè¿œç¨‹ç”¨æˆ·åè€Œä¸æ˜¯å½“å‰ç”¨æˆ·</span></div><div class="line">  -<span class="ruby">U --sud-user=SUDO_User  sudoåˆ°å“ªä¸ªç”¨æˆ·ï¼Œé»˜è®¤ä¸º root</span></div><div class="line">  -<span class="ruby">k --ask-pass  ç™»å½•å¯†ç ï¼Œæç¤ºè¾“å…¥SSHå¯†ç è€Œä¸æ˜¯å‡è®¾åŸºäºå¯†é’¥çš„éªŒè¯</span></div><div class="line">  -<span class="ruby">K --ask-sudo-pass æç¤ºå¯†ç ä½¿ç”¨sudo</span></div><div class="line">  -<span class="ruby">s --sudo sudoè¿è¡Œ</span></div><div class="line">  -<span class="ruby">S --su ç”¨ su å‘½ä»¤</span></div><div class="line">  -<span class="ruby">l  --list æ˜¾ç¤ºæ‰€æ”¯æŒçš„æ‰€æœ‰æ¨¡å—</span></div><div class="line">  -<span class="ruby">s --snippet æŒ‡å®šæ¨¡å—æ˜¾ç¤ºå‰§æœ¬ç‰‡æ®µ</span></div><div class="line">  -<span class="ruby">f  --forks=NUM å¹¶è¡Œä»»åŠ¡æ•°ã€‚NUMè¢«æŒ‡å®šä¸ºä¸€ä¸ªæ•´æ•°,é»˜è®¤æ˜¯<span class="number">5</span>ã€‚ <span class="comment">#ansible testhosts -a "/sbin/reboot" -f 10 é‡å¯testhostsç»„çš„æ‰€æœ‰æœºå™¨ï¼Œæ¯æ¬¡é‡å¯10å°</span></span></div><div class="line">  -<span class="ruby">-private-key=PRIVATE_KEY_FILE ç§é’¥è·¯å¾„ï¼Œä½¿ç”¨è¿™ä¸ªæ–‡ä»¶æ¥éªŒè¯è¿æ¥</span></div><div class="line">  -<span class="ruby">v --verbose è¯¦ç»†ä¿¡æ¯</span></div><div class="line">  all  é’ˆå¯¹hosts å®šä¹‰çš„æ‰€æœ‰ä¸»æœºæ‰§è¡Œ</div><div class="line">  -<span class="ruby">M MODULE_PATH, --<span class="class"><span class="keyword">module</span>-<span class="title">path</span>=<span class="title">MODULE_PATH</span> è¦æ‰§è¡Œçš„æ¨¡å—çš„è·¯å¾„ï¼Œé»˜è®¤ä¸º/<span class="title">usr</span>/<span class="title">share</span>/<span class="title">ansible</span>/</span></span></div><div class="line">  -<span class="ruby">-list-hosts åªæ‰“å°æœ‰å“ªäº›ä¸»æœºä¼šæ‰§è¡Œè¿™ä¸ª playbook æ–‡ä»¶ï¼Œä¸æ˜¯å®é™…æ‰§è¡Œè¯¥ playbook æ–‡ä»¶</span></div><div class="line">  -<span class="ruby">o --one-line å‹ç¼©è¾“å‡ºï¼Œæ‘˜è¦è¾“å‡º.å°è¯•ä¸€åˆ‡éƒ½åœ¨ä¸€è¡Œä¸Šè¾“å‡ºã€‚</span></div><div class="line">  -<span class="ruby">t Directory, --tree=Directory å°†å†…å®¹ä¿å­˜åœ¨è¯¥è¾“å‡ºç›®å½•,ç»“æœä¿å­˜åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­åœ¨æ¯å°ä¸»æœºä¸Šã€‚</span></div><div class="line">  -<span class="ruby">B åå°è¿è¡Œè¶…æ—¶æ—¶é—´</span></div><div class="line">  -<span class="ruby">P è°ƒæŸ¥åå°ç¨‹åºæ—¶é—´</span></div><div class="line">  -<span class="ruby">T Seconds, --timeout=Seconds æ—¶é—´ï¼Œå•ä½ç§’s</span></div><div class="line">  -<span class="ruby">P NUM, --poll=NUM è°ƒæŸ¥èƒŒæ™¯å·¥ä½œæ¯éš”æ•°ç§’ã€‚éœ€è¦- b</span></div><div class="line">  -<span class="ruby">c Connection, --connection=Connection  è¿æ¥ç±»å‹ä½¿ç”¨ã€‚å¯èƒ½çš„é€‰é¡¹æ˜¯paramiko(SSH),SSHå’Œåœ°æ–¹ã€‚å½“åœ°ä¸»è¦æ˜¯ç”¨äºcrontabæˆ–å¯åŠ¨ã€‚</span></div><div class="line">  -<span class="ruby">-tags=TAGS åªæ‰§è¡ŒæŒ‡å®šæ ‡ç­¾çš„ä»»åŠ¡    ä¾‹å­<span class="symbol">:ansible-playbook</span> test.yml --tags=copy  åªæ‰§è¡Œæ ‡ç­¾ä¸ºcopyçš„é‚£ä¸ªä»»åŠ¡</span></div><div class="line">  -<span class="ruby">-list-hosts åªæ‰“å°æœ‰å“ªäº›ä¸»æœºä¼šæ‰§è¡Œè¿™ä¸ª playbook æ–‡ä»¶ï¼Œä¸æ˜¯å®é™…æ‰§è¡Œè¯¥ playbook æ–‡ä»¶</span></div><div class="line">  -<span class="ruby">-list-tasks åˆ—å‡ºæ‰€æœ‰å°†è¢«æ‰§è¡Œçš„ä»»åŠ¡</span></div><div class="line">  -<span class="ruby">C, --check åªæ˜¯æµ‹è¯•ä¸€ä¸‹ä¼šæ”¹å˜ä»€ä¹ˆå†…å®¹ï¼Œä¸ä¼šçœŸæ­£å»æ‰§è¡Œ;ç›¸å,è¯•å›¾é¢„æµ‹ä¸€äº›å¯èƒ½å‘ç”Ÿçš„å˜åŒ–</span></div><div class="line">  -<span class="ruby">-syntax-check æ‰§è¡Œè¯­æ³•æ£€æŸ¥çš„å‰§æœ¬,ä½†ä¸æ‰§è¡Œå®ƒ</span></div><div class="line">  -<span class="ruby">l SUBSET, --limit=SUBSET è¿›ä¸€æ­¥é™åˆ¶æ‰€é€‰ä¸»æœº/ç»„æ¨¡å¼  --limit=<span class="number">192.168</span>.<span class="number">0</span>.<span class="number">15</span> åªå¯¹è¿™ä¸ªipæ‰§è¡Œ</span></div><div class="line">  -<span class="ruby">-skip-tags=SKIP_TAGS åªè¿è¡Œæˆå‰§å’Œä»»åŠ¡ä¸åŒ¹é…è¿™äº›å€¼çš„æ ‡ç­¾  --skip-tags=copy_start</span></div><div class="line">  -<span class="ruby">e EXTRA_VARS, --extra-vars=EXTRA_VARS  é¢å¤–çš„å˜é‡è®¾ç½®ä¸ºé”®=å€¼æˆ–YAML / JSON</span></div><div class="line">        #cat update.yml</div><div class="line">        -<span class="ruby">--</span></div><div class="line">        -<span class="ruby"> <span class="symbol">hosts:</span> &#123;&#123; hosts &#125;&#125;</span></div><div class="line">          remote_user: &#123;&#123; user &#125;&#125;</div><div class="line">        ..............</div><div class="line">        #ansible-playbook update.yml --extra-vars "hosts=vipers user=admin"   ä¼ é€’&#123;&#123;hosts&#125;&#125;ã€&#123;&#123;user&#125;&#125;å˜é‡,hostså¯ä»¥æ˜¯ ipæˆ–ç»„å</div><div class="line">  -<span class="ruby">l,--limit å¯¹æŒ‡å®šçš„ ä¸»æœº/ç»„ æ‰§è¡Œä»»åŠ¡  --limit=<span class="number">192.168</span>.<span class="number">0</span>.<span class="number">10</span>ï¼Œ<span class="number">192.168</span>.<span class="number">0</span>.<span class="number">11</span> æˆ– -l <span class="number">192.168</span>.<span class="number">0</span>.<span class="number">10</span>ï¼Œ<span class="number">192.168</span>.<span class="number">0</span>.<span class="number">11</span> åªå¯¹è¿™ä¸ª<span class="number">2</span>ä¸ªipæ‰§è¡Œä»»åŠ¡</span></div></pre></td></tr></table></figure>
<h4 id="2ã€ansible-doc"><a href="#2ã€ansible-doc" class="headerlink" title="2ã€ansible-doc"></a>2ã€ansible-doc</h4><figure class="highlight haml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]# ansible-doc -h</div><div class="line">Usage: ansible-doc [options] [module...]</div><div class="line"></div><div class="line">Options:</div><div class="line">  -<span class="ruby">h, --help            show this help message <span class="keyword">and</span> exit</span></div><div class="line">  -<span class="ruby">l, --list            List available modules</span></div><div class="line">  -<span class="ruby">M MODULE_PATH, --<span class="class"><span class="keyword">module</span>-<span class="title">path</span>=<span class="title">MODULE_PATH</span></span></span></div><div class="line">                        specify path(s) to module library (default=None)</div><div class="line">  -<span class="ruby">s, --snippet         Show playbook snippet <span class="keyword">for</span> specified <span class="class"><span class="keyword">module</span>(<span class="title">s</span>)</span></span></div><div class="line">  -<span class="ruby">v, --verbose         verbose mode (-vvv <span class="keyword">for</span> more, -vvvv to enable</span></div><div class="line">                        connection debugging)</div><div class="line">  -<span class="ruby">-version             show program<span class="string">'s version number and exit</span></span></div></pre></td></tr></table></figure>
<p>è¯¥æŒ‡ä»¤ç”¨äºæŸ¥çœ‹æ¨¡å—ä¿¡æ¯ï¼Œå¸¸ç”¨å‚æ•°æœ‰ä¸¤ä¸ª-l å’Œ -s ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">//åˆ—å‡ºæ‰€æœ‰å·²å®‰è£…çš„æ¨¡å—</div><div class="line"><span class="meta">#</span><span class="bash"> ansible-doc  <span class="_">-l</span></span></div><div class="line">//æŸ¥çœ‹å…·ä½“æŸæ¨¡å—çš„ç”¨æ³•ï¼Œè¿™é‡Œå¦‚æŸ¥çœ‹commandæ¨¡å—</div><div class="line"><span class="meta">#</span><span class="bash"> ansible-doc  <span class="_">-s</span> <span class="built_in">command</span></span></div></pre></td></tr></table></figure>
<h4 id="3ã€ansible-galaxy"><a href="#3ã€ansible-galaxy" class="headerlink" title="3ã€ansible-galaxy"></a>3ã€ansible-galaxy</h4><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]# ansible-galaxy -h</div><div class="line">Usage: ansible-galaxy [<span class="keyword">delete</span>|import|info|init|install|<span class="keyword">list</span>|login|<span class="built_in">remove</span>|<span class="built_in">search</span>|setup] [--<span class="keyword">help</span>] [<span class="keyword">options</span>] ...</div><div class="line"></div><div class="line">Option<span class="variable">s:</span></div><div class="line">  -h, --<span class="keyword">help</span>     show this <span class="keyword">help</span> message <span class="built_in">and</span> <span class="keyword">exit</span></div><div class="line">  -v, --<span class="keyword">verbose</span>  <span class="keyword">verbose</span> <span class="keyword">mode</span> (-vvv <span class="keyword">for</span> more, -vvvv <span class="keyword">to</span> enable connection</div><div class="line">                 debugging)</div><div class="line">  --<span class="keyword">version</span>      show program<span class="string">'s version number and exit</span></div></pre></td></tr></table></figure>
<p>ansible-galaxy æŒ‡ä»¤ç”¨äºæ–¹ä¾¿çš„ä»<a href="https://galaxy.ansible.com/" target="_blank" rel="external">https://galaxy.ansible.com/</a> ç«™ç‚¹ä¸‹è½½ç¬¬ä¸‰æ–¹æ‰©å±•æ¨¡å—ï¼Œæˆ‘ä»¬å¯ä»¥å½¢è±¡çš„ç†è§£å…¶ç±»ä¼¼äºcentosä¸‹çš„yumã€pythonä¸‹çš„pipæˆ–easy_install ã€‚å¦‚ä¸‹ç¤ºä¾‹ï¼š</p>
<figure class="highlight haml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]# ansible-galaxy install aeriscloud.docker</div><div class="line">-<span class="ruby"> downloading role <span class="string">'docker'</span>, owned by aeriscloud</span></div><div class="line">-<span class="ruby"> downloading role from <span class="symbol">https:</span>/<span class="regexp">/github.com/</span>AerisCloud/ansible-docker/archive/v1.<span class="number">0</span>.<span class="number">0</span>.tar.gz</span></div><div class="line">-<span class="ruby"> extracting aeriscloud.docker to /etc/ansible/roles/aeriscloud.docker</span></div><div class="line">-<span class="ruby"> aeriscloud.docker was installed successfully</span></div></pre></td></tr></table></figure>
<p>è¿™ä¸ªå®‰è£…äº†ä¸€ä¸ªaeriscloud.dockerç»„ä»¶ï¼Œå‰é¢aeriscloudæ˜¯galaxyä¸Šåˆ›å»ºè¯¥æ¨¡å—çš„ç”¨æˆ·åï¼Œåé¢å¯¹åº”çš„æ˜¯å…¶æ¨¡å—ã€‚åœ¨å®é™…åº”ç”¨ä¸­ä¹Ÿå¯ä»¥æŒ‡å®štxtæˆ–yml æ–‡ä»¶è¿›è¡Œå¤šä¸ªç»„ä»¶çš„ä¸‹è½½å®‰è£…ã€‚è¿™éƒ¨åˆ†å¯ä»¥å‚çœ‹å®˜æ–¹æ–‡æ¡£ã€‚</p>
<p>è¿™ä¸ªå®‰è£…äº†ä¸€ä¸ªaeriscloud.dockerç»„ä»¶ï¼Œå‰é¢aeriscloudæ˜¯galaxyä¸Šåˆ›å»ºè¯¥æ¨¡å—çš„ç”¨æˆ·åï¼Œåé¢å¯¹åº”çš„æ˜¯å…¶æ¨¡å—ã€‚åœ¨å®é™…åº”ç”¨ä¸­ä¹Ÿå¯ä»¥æŒ‡å®štxtæˆ–yml æ–‡ä»¶è¿›è¡Œå¤šä¸ªç»„ä»¶çš„ä¸‹è½½å®‰è£…ã€‚è¿™éƒ¨åˆ†å¯ä»¥å‚çœ‹å®˜æ–¹æ–‡æ¡£ã€‚</p>
<h4 id="4ã€ansible-lint"><a href="#4ã€ansible-lint" class="headerlink" title="4ã€ansible-lint"></a>4ã€ansible-lint</h4><p>ansible-lintæ˜¯å¯¹playbookçš„è¯­æ³•è¿›è¡Œæ£€æŸ¥çš„ä¸€ä¸ªå·¥å…·ã€‚ç”¨æ³•æ˜¯ansible-lint playbook.yml ã€‚</p>
<h4 id="5ã€ansible-playbook"><a href="#5ã€ansible-playbook" class="headerlink" title="5ã€ansible-playbook"></a>5ã€ansible-playbook</h4><p>è¯¥æŒ‡ä»¤æ˜¯ä½¿ç”¨æœ€å¤šçš„æŒ‡ä»¤ï¼Œå…¶é€šè¿‡è¯»å–playbook æ–‡ä»¶åï¼Œæ‰§è¡Œç›¸åº”çš„åŠ¨ä½œï¼Œè¿™ä¸ªåé¢ä¼šåšä¸ºä¸€ä¸ªé‡ç‚¹æ¥è®²ã€‚</p>
<h4 id="6ã€ansible-pull"><a href="#6ã€ansible-pull" class="headerlink" title="6ã€ansible-pull"></a>6ã€ansible-pull</h4><p>è¯¥æŒ‡ä»¤ä½¿ç”¨éœ€è¦è°ˆåˆ°ansibleçš„å¦ä¸€ç§æ¨¡å¼ï¼ï¼ï¼pull æ¨¡å¼ï¼Œè¿™å’Œæˆ‘ä»¬å¹³å¸¸ç»å¸¸ç”¨çš„pushæ¨¡å¼åˆšå¥½ç›¸åï¼Œå…¶é€‚ç”¨äºä»¥ä¸‹åœºæ™¯ï¼šä½ æœ‰æ•°é‡å·¨å¤§çš„æœºå™¨éœ€è¦é…ç½®ï¼Œå³ä½¿ä½¿ç”¨éå¸¸é«˜çš„çº¿ç¨‹è¿˜æ˜¯è¦èŠ±è´¹å¾ˆå¤šæ—¶é—´ï¼›ä½ è¦åœ¨ä¸€ä¸ªæ²¡æœ‰ç½‘ç»œè¿æ¥çš„æœºå™¨ä¸Šè¿è¡ŒAnisbleï¼Œæ¯”å¦‚åœ¨å¯åŠ¨ä¹‹åå®‰è£…ã€‚è¿™éƒ¨åˆ†ä¹Ÿä¼šå•ç‹¬åšä¸€èŠ‚æ¥è®²ã€‚</p>
<h4 id="7ã€ansible-vault"><a href="#7ã€ansible-vault" class="headerlink" title="7ã€ansible-vault"></a>7ã€ansible-vault</h4><p>ansible-vaultä¸»è¦åº”ç”¨äºé…ç½®æ–‡ä»¶ä¸­å«æœ‰æ•æ„Ÿä¿¡æ¯ï¼Œåˆä¸å¸Œæœ›ä»–èƒ½è¢«äººçœ‹åˆ°ï¼Œvaultå¯ä»¥å¸®ä½ åŠ å¯†/è§£å¯†è¿™ä¸ªé…ç½®æ–‡ä»¶ï¼Œå±é«˜çº§ç”¨æ³•ã€‚ä¸»è¦å¯¹äºplaybooksé‡Œæ¯”å¦‚æ¶‰åŠåˆ°é…ç½®å¯†ç æˆ–å…¶ä»–å˜é‡æ—¶ï¼Œå¯ä»¥é€šè¿‡è¯¥æŒ‡ä»¤åŠ å¯†ï¼Œè¿™æ ·æˆ‘ä»¬é€šè¿‡catçœ‹åˆ°çš„ä¼šæ˜¯ä¸€ä¸ªå¯†ç ä¸²ç±»çš„æ–‡ä»¶ï¼Œç¼–è¾‘çš„æ—¶å€™éœ€è¦è¾“å…¥äº‹å…ˆè®¾å®šçš„å¯†ç æ‰èƒ½æ‰“å¼€ã€‚è¿™ç§playbookæ–‡ä»¶åœ¨æ‰§è¡Œæ—¶ï¼Œéœ€è¦åŠ ä¸Š â€“ask-vault-passå‚æ•°ï¼ŒåŒæ ·éœ€è¦è¾“å…¥å¯†ç åæ‰èƒ½æ­£å¸¸æ‰§è¡Œã€‚å…·ä½“è¯¥éƒ¨åˆ†å¯ä»¥å‚æŸ¥å®˜æ–¹åšå®¢ã€‚</p>
<h4 id="æ³¨ï¼šä¸Šé¢ä¸ƒä¸ªæŒ‡ä»¤ï¼Œç”¨çš„æœ€å¤šçš„åªæœ‰ä¸¤ä¸ªansible-å’Œansible-playbook-ï¼Œè¿™ä¸¤ä¸ªä¸€å®šè¦æŒæ¡ï¼Œå…¶ä»–äº”ä¸ªå±äºæ‹“å±•æˆ–é«˜çº§éƒ¨åˆ†ã€‚"><a href="#æ³¨ï¼šä¸Šé¢ä¸ƒä¸ªæŒ‡ä»¤ï¼Œç”¨çš„æœ€å¤šçš„åªæœ‰ä¸¤ä¸ªansible-å’Œansible-playbook-ï¼Œè¿™ä¸¤ä¸ªä¸€å®šè¦æŒæ¡ï¼Œå…¶ä»–äº”ä¸ªå±äºæ‹“å±•æˆ–é«˜çº§éƒ¨åˆ†ã€‚" class="headerlink" title="æ³¨ï¼šä¸Šé¢ä¸ƒä¸ªæŒ‡ä»¤ï¼Œç”¨çš„æœ€å¤šçš„åªæœ‰ä¸¤ä¸ªansible å’Œansible-playbook ï¼Œè¿™ä¸¤ä¸ªä¸€å®šè¦æŒæ¡ï¼Œå…¶ä»–äº”ä¸ªå±äºæ‹“å±•æˆ–é«˜çº§éƒ¨åˆ†ã€‚"></a>æ³¨ï¼šä¸Šé¢ä¸ƒä¸ªæŒ‡ä»¤ï¼Œç”¨çš„æœ€å¤šçš„åªæœ‰ä¸¤ä¸ªansible å’Œansible-playbook ï¼Œè¿™ä¸¤ä¸ªä¸€å®šè¦æŒæ¡ï¼Œå…¶ä»–äº”ä¸ªå±äºæ‹“å±•æˆ–é«˜çº§éƒ¨åˆ†ã€‚</h4>
	

	

</article>




	<article>
	
		<h1><a href="/2016/03/07/è‡ªåŠ¨åŒ–+Jenkins/Ansible/Ansibleå°ç»“ï¼ˆä¸‰ï¼‰ansible.cfgä¸é»˜è®¤é…ç½® /">Ansibleå°ç»“ï¼ˆä¸‰ï¼‰ansible.cfgä¸é»˜è®¤é…ç½®</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-03-07</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/automation/">automation</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Ansible/">Ansible</a>
			</span>
		
	</div>

	

	
		<p>#Ansibleå°ç»“ï¼ˆå››ï¼‰ansible.cfgä¸é»˜è®¤é…ç½®</p>
<p>Ansibleé»˜è®¤å®‰è£…å¥½åæœ‰ä¸€ä¸ªé…ç½®æ–‡ä»¶<code>/etc/ansible/ansible.cfg</code>ï¼Œè¯¥é…ç½®æ–‡ä»¶ä¸­å®šä¹‰äº†ansibleçš„ä¸»æœºçš„é»˜è®¤é…ç½®éƒ¨åˆ†ï¼Œå¦‚é»˜è®¤æ˜¯å¦éœ€è¦è¾“å…¥å¯†ç ã€æ˜¯å¦å¼€å¯sudoè®¤è¯ã€action_pluginsæ’ä»¶çš„ä½ç½®ã€hostsä¸»æœºç»„çš„ä½ç½®ã€æ˜¯å¦å¼€å¯logåŠŸèƒ½ã€é»˜è®¤ç«¯å£ã€keyæ–‡ä»¶ä½ç½®ç­‰ç­‰ã€‚</p>
<p>å…·ä½“å¦‚ä¸‹ï¼š</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="section">[defaults]</span></div><div class="line"><span class="comment"># some basic default values...</span></div><div class="line"><span class="attr">hostfile</span>       = /etc/ansible/hosts   \\æŒ‡å®šé»˜è®¤hostsé…ç½®çš„ä½ç½®</div><div class="line"><span class="comment"># library_path = /usr/share/my_modules/</span></div><div class="line"><span class="attr">remote_tmp</span>     = <span class="variable">$HOME</span>/.ansible/tmp</div><div class="line"><span class="attr">pattern</span>        = *</div><div class="line"><span class="attr">forks</span>          = <span class="number">5</span></div><div class="line"><span class="attr">poll_interval</span>  = <span class="number">15</span></div><div class="line"><span class="attr">sudo_user</span>      = root  \\è¿œç¨‹sudoç”¨æˆ·</div><div class="line"><span class="comment">#ask_sudo_pass = True  \\æ¯æ¬¡æ‰§è¡Œansibleå‘½ä»¤æ˜¯å¦è¯¢é—®sshå¯†ç </span></div><div class="line"><span class="comment">#ask_pass      = True  \\æ¯æ¬¡æ‰§è¡Œansibleå‘½ä»¤æ—¶æ˜¯å¦è¯¢é—®sudoå¯†ç </span></div><div class="line"><span class="attr">transport</span>      = smart</div><div class="line"><span class="attr">remote_port</span>    = <span class="number">22</span></div><div class="line"><span class="attr">module_lang</span>    = C</div><div class="line"><span class="attr">gathering</span> = implicit</div><div class="line"><span class="attr">host_key_checking</span> = <span class="literal">False</span>    \\å…³é—­ç¬¬ä¸€æ¬¡ä½¿ç”¨ansibleè¿æ¥å®¢æˆ·ç«¯æ˜¯è¾“å…¥å‘½ä»¤æç¤º</div><div class="line"><span class="attr">log_path</span>    = /var/log/ansible.log \\éœ€è¦æ—¶å¯ä»¥è‡ªè¡Œæ·»åŠ ã€‚chown -R root:root ansible.log</div><div class="line"><span class="attr">system_warnings</span> = <span class="literal">False</span>    \\å…³é—­è¿è¡Œansibleæ—¶ç³»ç»Ÿçš„æç¤ºä¿¡æ¯ï¼Œä¸€èˆ¬ä¸ºæç¤ºå‡çº§</div><div class="line"><span class="comment"># set plugin path directories here, separate with colons</span></div><div class="line"><span class="attr">action_plugins</span>     = /usr/share/ansible_plugins/action_plugins</div><div class="line"><span class="attr">callback_plugins</span>   = /usr/share/ansible_plugins/callback_plugins</div><div class="line"><span class="attr">connection_plugins</span> = /usr/share/ansible_plugins/connection_plugins</div><div class="line"><span class="attr">lookup_plugins</span>     = /usr/share/ansible_plugins/lookup_plugins</div><div class="line"><span class="attr">vars_plugins</span>       = /usr/share/ansible_plugins/vars_plugins</div><div class="line"><span class="attr">filter_plugins</span>     = /usr/share/ansible_plugins/filter_plugins</div><div class="line"><span class="attr">fact_caching</span> = memory</div><div class="line"><span class="section">[accelerate]</span></div><div class="line"><span class="attr">accelerate_port</span> = <span class="number">5099</span></div><div class="line"><span class="attr">accelerate_timeout</span> = <span class="number">30</span></div><div class="line"><span class="attr">accelerate_connect_timeout</span> = <span class="number">5.0</span></div><div class="line"><span class="comment"># The daemon timeout is measured in minutes. This time is measured</span></div><div class="line"><span class="comment"># from the last activity to the accelerate daemon.</span></div><div class="line"><span class="attr">accelerate_daemon_timeout</span> = <span class="number">30</span></div></pre></td></tr></table></figure>
<p>åœ¨ansible.cfgé…ç½®æ–‡ä»¶ä¸­ï¼Œä¹Ÿä¼šæ‰¾åˆ°å¦‚ä¸‹éƒ¨åˆ†ï¼š</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># uncomment this to disable SSH key host checking</span></div><div class="line"><span class="attr">host_key_checking</span> = <span class="literal">False</span></div></pre></td></tr></table></figure>
<p>é»˜è®¤host_key_checkingéƒ¨åˆ†æ˜¯æ³¨é‡Šçš„ï¼Œé€šè¿‡æ‰¾å¼€è¯¥è¡Œçš„æ³¨é‡Šï¼ŒåŒæ ·ä¹Ÿå¯ä»¥å®ç°è·³è¿‡ ssh é¦–æ¬¡è¿æ¥æç¤ºéªŒè¯éƒ¨åˆ†ã€‚</p>
<p>æˆ‘è¿™é‡Œåšäº†å…ç§˜é’¥çš„æŸ¥çœ‹æ—¥å¿—å¦‚ä¸‹ï¼š</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># ansible tomcat_C1 -a "uptime"</span></div><div class="line"><span class="meta">192.168.1.177 | SUCCESS | rc=0 &gt;</span>&gt;</div><div class="line"> 09<span class="symbol">:</span><span class="number">28</span><span class="symbol">:</span><span class="number">03</span> up <span class="number">24</span> days, <span class="number">15</span><span class="symbol">:</span><span class="number">39</span>,  <span class="number">4</span> users,  load <span class="symbol">average:</span> <span class="number">0</span>.<span class="number">00</span>, <span class="number">0</span>.<span class="number">00</span>, <span class="number">0</span>.<span class="number">00</span></div><div class="line"></div><div class="line">[root@docker ~]<span class="comment">#</span></div><div class="line">[root@docker ~]<span class="comment">#</span></div><div class="line">[root@docker ~]<span class="comment">#  cat /var/log/ansible.log</span></div><div class="line"><span class="number">2016</span>-09-<span class="number">05</span> 09<span class="symbol">:</span><span class="number">19</span><span class="symbol">:</span><span class="number">23</span>,<span class="number">235</span> p=<span class="number">1412</span> u=root <span class="params">|  ERROR! Missing target hosts</span></div><div class="line">2016-09-05 09:19:54,580 p=1417 u=root |  <span class="number">192.168</span>.<span class="number">1.177</span> <span class="params">| SUCCESS |</span> rc=<span class="number">0</span> <span class="meta">&gt;&gt;</span></div><div class="line"> 09<span class="symbol">:</span><span class="number">20</span><span class="symbol">:</span><span class="number">24</span> up <span class="number">24</span> days, <span class="number">15</span><span class="symbol">:</span><span class="number">31</span>,  <span class="number">4</span> users,  load <span class="symbol">average:</span> <span class="number">0</span>.<span class="number">00</span>, <span class="number">0</span>.<span class="number">00</span>, <span class="number">0</span>.<span class="number">00</span></div><div class="line"></div><div class="line"><span class="number">2016</span>-09-<span class="number">05</span> 09<span class="symbol">:</span><span class="number">20</span><span class="symbol">:</span><span class="number">07</span>,<span class="number">206</span> p=<span class="number">1440</span> u=root <span class="params">|  192.168.1.177 |</span> SUCCESS <span class="params">| rc=0 &gt;&gt;</span></div><div class="line"> 09:20:37 up 24 days, 15:31,  4 users,  load average: 0.00, 0.00, 0.00</div><div class="line"></div><div class="line">2016-09-05 09:27:31,607 p=1460 u=root |  <span class="number">192.168</span>.<span class="number">1.177</span> <span class="params">| SUCCESS |</span> rc=<span class="number">0</span> <span class="meta">&gt;&gt;</span></div><div class="line"> 09<span class="symbol">:</span><span class="number">28</span><span class="symbol">:</span><span class="number">01</span> up <span class="number">24</span> days, <span class="number">15</span><span class="symbol">:</span><span class="number">39</span>,  <span class="number">4</span> users,  load <span class="symbol">average:</span> <span class="number">0</span>.<span class="number">00</span>, <span class="number">0</span>.<span class="number">00</span>, <span class="number">0</span>.<span class="number">00</span></div><div class="line"></div><div class="line"><span class="number">2016</span>-09-<span class="number">05</span> 09<span class="symbol">:</span><span class="number">27</span><span class="symbol">:</span><span class="number">33</span>,<span class="number">800</span> p=<span class="number">1482</span> u=root <span class="params">|  192.168.1.177 |</span> SUCCESS <span class="params">| rc=0 &gt;&gt;</span></div><div class="line"> 09:28:03 up 24 days, 15:39,  4 users,  load average: 0.00, 0.00, 0.00</div></pre></td></tr></table></figure>
<p>æ›´å¤šéƒ¨åˆ†å¯ä»¥å‚çœ‹<a href="http://docs.ansible.com/intro_configuration.html" target="_blank" rel="external">å®˜æ–¹æ–‡æ¡£</a></p>

	

	

</article>




	<article>
	
		<h1><a href="/2016/02/14/ä¸ªäººç”Ÿæ´»è®°å½•/åœ¨ä¸€èµ·çš„ç¬¬588å¤©ğŸ’•/">åœ¨ä¸€èµ·çš„ç¬¬588å¤©ğŸ’•</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-02-14</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/ç”Ÿæ´»/">ç”Ÿæ´»</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Personal-life-record/">Personal life record</a>
			</span>
		
	</div>

	

	
		<h3 id="ä»Šå¤©2016å¹´2æœˆ14æ—¥æˆ‘ä»¬çš„ç¬¬äºŒä¸ªæƒ…äººèŠ‚ï¼š"><a href="#ä»Šå¤©2016å¹´2æœˆ14æ—¥æˆ‘ä»¬çš„ç¬¬äºŒä¸ªæƒ…äººèŠ‚ï¼š" class="headerlink" title="ä»Šå¤©2016å¹´2æœˆ14æ—¥æˆ‘ä»¬çš„ç¬¬äºŒä¸ªæƒ…äººèŠ‚ï¼š"></a>ä»Šå¤©2016å¹´2æœˆ14æ—¥æˆ‘ä»¬çš„ç¬¬äºŒä¸ªæƒ…äººèŠ‚ï¼š</h3><p>å¤œå·²ç»å¾ˆæ·±äº†ï¼Œæˆ‘è¿˜ååœ¨ç”µè„‘å‰å†™ä¿¡ç»™ä½ ,æ…¢æ…¢æŠŠæˆ‘ä»¬åœ¨ä¸€èµ·ç‚¹ç‚¹æ»´æ»´è®°å½•ä¸‹æ¥,è¿™äº›å¤©æ€»æ˜¯æœ‰å¾ˆå¤šè¯æƒ³å¯¹ä½ è¯´,ä½†å¯¹ä½ çš„æ€å¿µæ‰°ä¹±äº†æˆ‘æ‰€æœ‰çš„æ€ç»ªã€‚æˆ‘ä¸çŸ¥é“è¯¥è¯´äº›ä»€ä¹ˆæˆ–æ€ä¹ˆè¯´ï¼Ÿè¯´å¿ƒé‡Œè¯ï¼Œå’Œä½ çš„æ¯ä¸€å¤©æˆ‘å¾ˆå¿«ä¹å¾ˆå¹¸ç¦ï¼Œæ˜¯æˆ‘ä¸€ç”Ÿä¸­ä»æœªæœ‰è¿‡çš„ï¼çœŸçš„XXLã€‚<br><img src="http://7xrthw.com1.z0.glb.clouddn.com/IMG_0200.JPG" alt=""></p>
		<p><a class="article__read-more-link" href="/2016/02/14/ä¸ªäººç”Ÿæ´»è®°å½•/åœ¨ä¸€èµ·çš„ç¬¬588å¤©ğŸ’•/">...read more</a></p>
	

	

</article>





	<span class="different-posts">ğŸ“– <a href="/page/11">more posts</a> ğŸ“–</span>



	</main>

	<footer class="footer">
	<div class="footer-content">
		
	      <div class="footer__element">
	<h5>Hi there,</h5>
	<p style="text-align:justify;">my name is Yancy, they know me as RadiantğŸ‘ğŸ‘. This blog is about Bi-data and my live.<br> I like ğŸŒ³ğŸŒ³ğŸŒ³</p>
</div>


	    
	      <div class="footer__element">
	<h5>Check out</h5>
	<ul class="footer-links">
		<li class="footer-links__link"><a href="/archives">Archive</a></li>
		
		  <li class="footer-links__link"><a href="/atom.xml">RSS</a></li>
	    
		<li class="footer-links__link"><a href="/about">about page</a></li>
		<li class="footer-links__link"><a href="/tags">Tags</a></li>
		<li class="footer-links__link"><a href="/categories">Categories</a></li>
	</ul>
</div>

	    

		<div class="footer-credit">
			<span>Â© 2018 Yancy | Powered by <a href="http://blog.yancy.cc/">Yancy</a> | Theme <a href="https://github.com/yangcvo">Yancy_GitHub</a></span>
		</div>

	</div>


</footer>



</body>

</html>
