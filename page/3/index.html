<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="theme-color" content="#33474d">
	<title>Yancy&#39;s blog</title>
	<link rel="stylesheet" href="/css/style.css" />
	
      <link rel="alternate" href="/atom.xml" title="Yancy&#39;s blog" type="application/atom+xml">
    
</head>

<body>

	<header class="header">
		<nav class="header__nav">
			
				<a href="/" class="header__link">Home</a>
			
				<a href="/tags" class="header__link">Tags</a>
			
				<a href="/archives" class="header__link">ARCHIVES</a>
			
				<a href="/about/About" class="header__link">ABOUT</a>
			
				<a href="/atom.xml" class="header__link">RSS</a>
			
		</nav>
		<h1 class="header__title"><a href="/">Yancy&#39;s blog</a></h1>
		<h2 class="header__subtitle">SIMPLICITY IS PREREQUISITE FOR  RELIABILITY</h2>
	</header>

	<main>
		
	<span class="different-posts different-posts_earlier">ğŸ“– <a href="/page/2">earlier posts</a> ğŸ“–</span>




	<article>
	
		<h1><a href="/2017/03/29/Bigdata-hadoop/countly/Bigdata-countlyéœ€è¦è¿ç§»/">Bigdata-countlyéœ€è¦è¿ç§»</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2017-03-29</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/Bigdata-Hadoop/">Bigdata Hadoop</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Bigdata-Hadoop/">Bigdata Hadoop</a> <a class="article__tag-link" href="/tags/Countly/">Countly</a>
			</span>
		
	</div>

	

	
		<h4 id="å®˜æ–¹å®‰è£…æ–‡æ¡£ï¼šhttp-resources-count-ly-docs-installing-countly-server"><a href="#å®˜æ–¹å®‰è£…æ–‡æ¡£ï¼šhttp-resources-count-ly-docs-installing-countly-server" class="headerlink" title="å®˜æ–¹å®‰è£…æ–‡æ¡£ï¼šhttp://resources.count.ly/docs/installing-countly-server"></a>å®˜æ–¹å®‰è£…æ–‡æ¡£ï¼š<a href="http://resources.count.ly/docs/installing-countly-server" target="_blank" rel="external">http://resources.count.ly/docs/installing-countly-server</a></h4><p>ç›®å‰<code>countly</code>éœ€è¦è¿ç§»ï¼Œæ‰€éœ€<code>countly</code>ç‰ˆæœ¬äºå®˜æ–¹æä¾›çš„å®‰è£…æ–¹æ¡ˆæœ‰å†²çªï¼Œæ‰€ä»¥å¦‚ä¸‹å®‰è£…ï¼š</p>
<p>å®‰è£…å®˜æ–¹<code>countly</code>è®©å…¶è®¾ç½®æ‰€éœ€ç¯å¢ƒå˜é‡åŠå…¶å¯åŠ¨è„šæœ¬ï¼Œæ‰‹åŠ¨æŒ‡å®šå®‰è£…nojsç‰ˆæœ¬ï¼Œæ‹·è´åŸcountlyæ–‡ä»¶ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">1ã€<span class="built_in">cd</span> /data <span class="comment">#countlyå®‰è£…åœ¨dataç›®å½• æˆ‘çœ‹äº†å®‰è£…è„šæœ¬ï¼Œæ˜¯å½“å‰åœ¨å“ªä¸ªç›®å½•ï¼Œå®‰è£…æ–‡ä»¶å°±åœ¨å“ªä¸ªç›®å½•</span></div><div class="line">wget -qO- http://c.ly/install | bash</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">2ã€rpm -qa | grep -i nodejs | xargs -I&#123;&#125;  yum remove &#123;&#125; -y</div><div class="line">å¸è½½æ‰å®˜ç½‘å®‰è£…çš„æœ€æ–°nodejs ç„¶åæ–°å»ºå¦‚ä¸‹yumæºï¼Œç”¨äºå®‰è£…æ—§ç‰ˆæ‰€éœ€nodejsï¼Œä¹Ÿå¯ä»¥åˆ°nodejså®˜ç½‘ä¸‹è½½æ‰€éœ€nodejs</div><div class="line">cat /etc/yum.repos.d/nodesource-el.repo </div><div class="line">[nodesource]</div><div class="line">name=Node.js Packages <span class="keyword">for</span> Enterprise Linux 7 - <span class="variable">$basearch</span></div><div class="line">baseurl=https://rpm.nodesource.com/pub_5.x/el/7/<span class="variable">$basearch</span></div><div class="line">failovermethod=priority</div><div class="line">enabled=1</div><div class="line">gpgcheck=1</div><div class="line">gpgkey=file:///etc/pki/rpm-gpg/NODESOURCE-GPG-SIGNING-KEY-EL</div><div class="line">[nodesource-source]</div><div class="line">name=Node.js <span class="keyword">for</span> Enterprise Linux 7 - <span class="variable">$basearch</span> - Source</div><div class="line">baseurl=https://rpm.nodesource.com/pub_5.x/el/7/SRPMS</div><div class="line">failovermethod=priority</div><div class="line">enabled=0</div><div class="line">gpgkey=file:///etc/pki/rpm-gpg/NODESOURCE-GPG-SIGNING-KEY-EL</div><div class="line">gpgcheck=1</div></pre></td></tr></table></figure>
<h3 id="å®‰è£…è€ç‰ˆæœ¬æ‰€éœ€nodejs"><a href="#å®‰è£…è€ç‰ˆæœ¬æ‰€éœ€nodejs" class="headerlink" title="å®‰è£…è€ç‰ˆæœ¬æ‰€éœ€nodejs"></a>å®‰è£…è€ç‰ˆæœ¬æ‰€éœ€nodejs</h3><figure class="highlight cmake"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum <span class="keyword">install</span> nodejs</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">3ã€æ‹·è´æºcountlyæ–‡ä»¶åˆ°/data/countlyç›®å½•</div><div class="line">ä¿®æ”¹ /data/countly/api/config.js å’Œ /data/countly/frontend/express/config.js      </div><div class="line">3001ç«¯å£å’Œ 6001ç«¯å£ç›‘å¬åœ°å€æ¢æˆ æœ¬åœ°ç§æœ‰åœ°å€   <span class="comment">#æºæ–‡ä»¶æ˜¯ç›‘å¬çš„åŸæ¥æœºå™¨çš„å†…ç½‘åœ°å€ï¼Œä¸ä¿®æ”¹çš„è¯ï¼ŒæœåŠ¡å¯åŠ¨ä¸äº†ã€‚</span></div></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="number">4</span><span class="string">ã€æ‹·è´mongoæ•°æ®ç›®å½•åˆ°/data/mongoç›®å½•ï¼Œä¿®æ”¹mongoé…ç½®æ–‡ä»¶.</span></div><div class="line"></div><div class="line"><span class="string">cat</span> <span class="string">/etc/mongod.conf</span></div><div class="line"><span class="attr">systemLog:</span></div><div class="line"><span class="attr">       destination:</span> <span class="string">file</span></div><div class="line"><span class="attr">       logAppend:</span> <span class="literal">true</span></div><div class="line"><span class="attr">       path:</span> <span class="string">/data/mongodb/mongod.log</span></div><div class="line"><span class="attr">storage:</span></div><div class="line"><span class="attr">       dbPath:</span> <span class="string">/data/mongo</span></div><div class="line"><span class="attr">       journal:</span></div><div class="line"><span class="attr">             enabled:</span> <span class="literal">true</span></div><div class="line"><span class="attr">       engine:</span> <span class="string">mmapv1</span></div><div class="line"><span class="attr">processManagement:</span></div><div class="line"><span class="attr">       fork:</span> <span class="literal">true</span></div><div class="line"><span class="attr">       pidFilePath:</span> <span class="string">/data/mongodb/mongod.pid</span></div><div class="line"><span class="attr">net:</span></div><div class="line"><span class="attr">       port:</span> <span class="number">27017</span></div><div class="line"><span class="attr">       bindIp:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></div><div class="line"><span class="attr">security:</span></div><div class="line"><span class="attr">       authorization:</span> <span class="string">enabled</span></div><div class="line"><span class="attr">operationProfiling:</span></div><div class="line"><span class="attr">       slowOpThresholdMs:</span> <span class="number">40960</span></div></pre></td></tr></table></figure>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/Bigdatacountly01.jpeg" alt=""></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">5ã€ä¿®æ”¹ç¡¬ç›˜blockï¼š</div><div class="line">     blockdev --setra 256 /dev/mapper/xvdc--vg-xvdcâ€“lv    <span class="comment">##æŒ‰ç…§mongoæç¤ºæ“ä½œ</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">6ã€ä¿®æ”¹nginxé…ç½®æ–‡ä»¶  conf.d/default.conf</div><div class="line">      å°†127.0.0.1ä¿®æ”¹ä¸ºæœ¬åœ°ç§æœ‰åœ°å€</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">7ã€é‡å¯countly   mongodb  nginx</div><div class="line"></div><div class="line">countly restart</div><div class="line"></div><div class="line">/etc/init.d/mongod restart</div><div class="line"></div><div class="line">service nginx restart</div><div class="line">è¿ç§»å®Œæ¯•</div></pre></td></tr></table></figure>
<h3 id="äº¤æµå­¦ä¹ ï¼š"><a href="#äº¤æµå­¦ä¹ ï¼š" class="headerlink" title="äº¤æµå­¦ä¹ ï¼š"></a>äº¤æµå­¦ä¹ ï¼š</h3><p>ğŸ§  Linux shell_é«˜çº§è¿ç»´æ´¾: <code>459096184</code>    åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)<br>ğŸ§  BigData-Exchange School : <code>521621407</code>  åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥</p>
<p>ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚</p>

	

	

</article>




	<article>
	
		<h1><a href="/2017/03/28/Bigdata-hadoop/Kafka/Bigdata-Kafkaé›†ç¾¤å¿«é€Ÿæ­å»ºä¸å¢åˆ æ”¹æŸ¥å‘½ä»¤è®²è§£/">Bigdata-Kafkaé›†ç¾¤å¿«é€Ÿæ­å»ºä¸å‘½ä»¤è®²è§£</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2017-03-28</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/å¤§æ•°æ®/">å¤§æ•°æ®</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Bigdata-Hadoop/">Bigdata Hadoop</a> <a class="article__tag-link" href="/tags/Kafka/">Kafka</a>
			</span>
		
	</div>

	

	
		<h1 id="Bigdata-Kafkaé›†ç¾¤å¿«é€Ÿæ­å»ºä¸å‘½ä»¤è®²è§£"><a href="#Bigdata-Kafkaé›†ç¾¤å¿«é€Ÿæ­å»ºä¸å‘½ä»¤è®²è§£" class="headerlink" title="Bigdata-Kafkaé›†ç¾¤å¿«é€Ÿæ­å»ºä¸å‘½ä»¤è®²è§£"></a>Bigdata-Kafkaé›†ç¾¤å¿«é€Ÿæ­å»ºä¸å‘½ä»¤è®²è§£</h1><h3 id="kafkaé›†ç¾¤å’Œzookeeperé›†ç¾¤è§„èŒƒ"><a href="#kafkaé›†ç¾¤å’Œzookeeperé›†ç¾¤è§„èŒƒ" class="headerlink" title="kafkaé›†ç¾¤å’Œzookeeperé›†ç¾¤è§„èŒƒ"></a>kafkaé›†ç¾¤å’Œzookeeperé›†ç¾¤è§„èŒƒ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">kafkaé›†ç¾¤å’Œzookeeperé›†ç¾¤è§„èŒƒ</div><div class="line">kafkaç‰ˆæœ¬ï¼škafka_2.10-0.8.2.1</div><div class="line">zookeeperç‰ˆæœ¬ï¼šzookeeper-3.4.5</div><div class="line"></div><div class="line">å¯åŠ¨ç”¨æˆ·ï¼šjollybi</div><div class="line">kafkaå®‰è£…ç›®å½•ï¼š/data/tools/</div><div class="line">kafkaæ–°å»ºæ¶ˆæ¯ç›®å½•ï¼š/data/tools/kafka_2.10-0.8.2.1/kafka-logs</div><div class="line"></div><div class="line">å¯åŠ¨ç”¨æˆ·ï¼šjollybi</div><div class="line">zookeeperå®‰è£…ç›®å½•ï¼š/data/tools/</div><div class="line">zookeeperæ–°å»ºæ—¥å¿—ç›®å½•ï¼š/data/tools/zookeeper-3.4.5/tmp/logs</div><div class="line"></div><div class="line">ç»Ÿä¸€é…ç½®hosts</div><div class="line"></div><div class="line"></div><div class="line">10.155.90.153 kafka1.jollychic.com kafka1</div><div class="line">10.155.90.155 kafka2.jollychic.com kafka2</div><div class="line">10.155.90.138 kafka3.jollychic.com kafka3</div></pre></td></tr></table></figure>
<p>æœ¬æ–‡ä½¿ç”¨äº†3å°æœºå™¨éƒ¨ç½²Kafkaé›†ç¾¤ï¼ŒIPå’Œä¸»æœºåå¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">10.155.90.153 kafka1.jollychic.com kafka1</div><div class="line">10.155.90.155 kafka2.jollychic.com kafka2</div><div class="line">10.155.90.138 kafka3.jollychic.com kafka3</div></pre></td></tr></table></figure>
<h3 id="Step1-é…ç½®-etc-hosts-ï¼ˆ3å°ä¸€è‡´ï¼‰"><a href="#Step1-é…ç½®-etc-hosts-ï¼ˆ3å°ä¸€è‡´ï¼‰" class="headerlink" title="Step1: é…ç½®/etc/hosts ï¼ˆ3å°ä¸€è‡´ï¼‰"></a>Step1: é…ç½®/etc/hosts ï¼ˆ3å°ä¸€è‡´ï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">127.0.0.1 localhost.localdomain localhost</div><div class="line">10.155.90.153 kafka1.jollychic.com kafka1</div><div class="line">10.155.90.155 kafka2.jollychic.com kafka2</div><div class="line">10.155.90.138 kafka3.jollychic.com kafka3</div></pre></td></tr></table></figure>
<h3 id="Step2-ç¯å¢ƒKafKaé›†ç¾¤ç¯å¢ƒ"><a href="#Step2-ç¯å¢ƒKafKaé›†ç¾¤ç¯å¢ƒ" class="headerlink" title="Step2: ç¯å¢ƒKafKaé›†ç¾¤ç¯å¢ƒ"></a>Step2: ç¯å¢ƒKafKaé›†ç¾¤ç¯å¢ƒ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ä¸‹è½½åœ°å€ï¼šhttp://mirrors.hust.edu.cn/apache/kafka/0.9.0.0/kafka_2.10-0.8.2.1.tgz</div><div class="line">[jollybi@kafka1 ]<span class="comment"># tar -xvf kafka_2.10-0.8.2.1.tgz -C /data/tools/</span></div><div class="line"><span class="built_in">cd</span> /data/tools/kafka_2.10-0.8.2.1/config</div></pre></td></tr></table></figure>
<h3 id="è®¾ç½®dataç›®å½•ï¼Œæœ€å¥½ä¸è¦ç”¨é»˜è®¤çš„-tmp-kafka-logs"><a href="#è®¾ç½®dataç›®å½•ï¼Œæœ€å¥½ä¸è¦ç”¨é»˜è®¤çš„-tmp-kafka-logs" class="headerlink" title="è®¾ç½®dataç›®å½•ï¼Œæœ€å¥½ä¸è¦ç”¨é»˜è®¤çš„/tmp/kafka-logs"></a>è®¾ç½®dataç›®å½•ï¼Œæœ€å¥½ä¸è¦ç”¨é»˜è®¤çš„/tmp/kafka-logs</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mkdir -p /data/tools/kafka_2.10-0.8.2.1/kafka-logs/</div></pre></td></tr></table></figure>
<p><em>ä¿®æ”¹kafkaé…ç½®æ–‡ä»¶</em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">[root@kafka_01 config]<span class="comment"># vim server.properties</span></div><div class="line"></div><div class="line"></div><div class="line"> è®¾ç½®brokeridï¼ˆä»0å¼€å§‹ï¼Œ3ä¸ªèŠ‚ç‚¹åˆ†åˆ«è®¾ä¸º1,2,3ï¼Œä¸èƒ½é‡å¤ï¼‰åœ¨è¿™é‡Œid=0è·Ÿzookeeper idè®¾ç½®ä¸€æ ·å°±è¡Œã€‚ é›†ç¾¤æœºå™¨ï¼šæŒ‰é¡ºåºå†™1</div><div class="line">broker.id=1  </div><div class="line"></div><div class="line">auto.leader.rebalance.enable=<span class="literal">true</span> </div><div class="line"></div><div class="line"><span class="comment">#ä¿®æ”¹æœ¬åœ°IPåœ°å€ï¼š</span></div><div class="line">listeners=PLAINTEXT://10.46.72.172:9092</div><div class="line">port=9292 //è®¾ç½®è®¿é—®ç«¯å£</div><div class="line">host.name=10.155.90.153   kafkaæœ¬æœºIP</div><div class="line">log.dirs=/data/tools/kafka_2.10-0.8.2.1/kafka-logs</div><div class="line"></div><div class="line"><span class="comment">#è®¾ç½®æ³¨å†Œåœ°å€ï¼ˆé‡è¦ï¼Œé»˜è®¤ä¼šæŠŠæœ¬æœºçš„hostanmeæ³¨å†Œåˆ°zkä¸­ï¼Œå®¢æˆ·ç«¯è¿æ¥æ—¶éœ€è¦è§£æè¯¥hostanmeï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥æ³¨å†Œæœ¬æœºçš„IPåœ°å€ï¼Œé¿å…hostnameè§£æå¤±è´¥ï¼ŒæŠ¥é”™java.nio.channels.UnresolvedAddressExceptionæˆ–java.io.IOException: Can not resolve addressï¼‰</span></div><div class="line"><span class="comment">#è®¾ç½®zookeeperåœ°å€</span></div><div class="line"><span class="comment">#zookeeper.connect=10.46.72.172:2181,10.47.88.103:2181,10.47.102.137:2181</span></div><div class="line">zookeeper.connect=kafka1.jollychic.com:2281,kafka2.jollychic.com:2281,kafka3.jollychic.com:2281</div><div class="line"></div><div class="line">//è¿™é‡Œæˆ‘è®¾ç½®hostsä»£æ›¿IP</div></pre></td></tr></table></figure>
<p><em>é…ç½®zookeeperåœ°å€</em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">vim zookeeper.properties </div><div class="line">dataDir=/data/tools/zookeeper-3.4.5/tmp</div><div class="line"><span class="comment"># the port at which the clients will connect</span></div><div class="line">clientPort=2281</div><div class="line"><span class="comment"># disable the per-ip limit on the number of connections since this is a non-production config</span></div><div class="line">maxClientCnxns=0</div><div class="line">~</div></pre></td></tr></table></figure>
<p><em>é…ç½®kafkaè®¿é—®åœ°å€</em></p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">vim</span> producer.properties </div><div class="line">metadata.broker.list=<span class="number">169.44.62.139:9292</span>,<span class="number">169.44.59.138:9292</span>,<span class="number">169.44.62.137:9292</span>   </div><div class="line"><span class="comment"># name of the partitioner class for partitioning events; default partition spreads data randomly</span></div><div class="line"><span class="comment">#partitioner.class=</span></div><div class="line"></div><div class="line"><span class="comment"># specifies whether the messages are sent asynchronously (async) or synchronously (sync)</span></div><div class="line">producer.type=sync</div><div class="line"></div><div class="line"><span class="comment"># specify the compression codec for all data generated: none, gzip, snappy, lz4.</span></div><div class="line"><span class="comment"># the old config values work as well: 0, 1, 2, 3 for none, gzip, snappy, lz4, respectively</span></div><div class="line">compression.codec=<span class="literal">none</span></div><div class="line"></div><div class="line"><span class="comment"># message encoder</span></div><div class="line">serializer.class=kafka.serializer.DefaultEncoder</div></pre></td></tr></table></figure>
<h3 id="Step3-é›†ç¾¤æœºå™¨å¿«é€Ÿæ‹·è´é…ç½®"><a href="#Step3-é›†ç¾¤æœºå™¨å¿«é€Ÿæ‹·è´é…ç½®" class="headerlink" title="Step3: é›†ç¾¤æœºå™¨å¿«é€Ÿæ‹·è´é…ç½®:"></a>Step3: é›†ç¾¤æœºå™¨å¿«é€Ÿæ‹·è´é…ç½®:</h3><p>è¿œç¨‹å¤åˆ¶åˆ†å‘å®‰è£…æ–‡ä»¶<br>æœ€å¥½æ˜¯æŠŠæ–‡ä»¶æ‰“åŒ…scpè¿‡å»<br>æ¥ä¸‹æ¥å°†ä¸Šé¢çš„å®‰è£…æ–‡ä»¶æ‹·è´åˆ°é›†ç¾¤ä¸­çš„å…¶ä»–æœºå™¨ä¸Šå¯¹åº”çš„ç›®å½•</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">scp -P58958 -r kafka_2.10-0.8.2.1 jollybi@169.44.62.137:/home/jollybi/tools/. </div><div class="line">scp -P58958 -r kafka_2.10-0.8.2.1 jollybi@169.44.62.138:/home/jollybi/tools/.</div></pre></td></tr></table></figure>
<p>ç»Ÿä¸€ä¿®æ”¹åˆ†åˆ«å…¶ä»–ä¸¤å°kafka <code>server.properties</code></p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">broker.id=<span class="number">2</span>  </div><div class="line">host.name=<span class="number">169.44</span><span class="number">.62</span><span class="number">.137</span>   kafka2æœ¬æœºIP</div><div class="line"></div><div class="line">broker.id=<span class="number">3</span> </div><div class="line">host.name=<span class="number">169.44</span><span class="number">.62</span><span class="number">.138</span>   kafka3æœ¬æœºIP</div></pre></td></tr></table></figure>
<h3 id="Step4-å¯åŠ¨-kafkaé›†ç¾¤"><a href="#Step4-å¯åŠ¨-kafkaé›†ç¾¤" class="headerlink" title="Step4:å¯åŠ¨ kafkaé›†ç¾¤"></a>Step4:å¯åŠ¨ kafkaé›†ç¾¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">./kafka-server-start.sh -daemon ../config/server.properties</div><div class="line"></div><div class="line">[jollybi@kafka1 config]$ jps</div><div class="line">3443 QuorumPeerMain</div><div class="line">16280 Jps</div><div class="line">3628 Kafka</div><div class="line">Step5: Kafkaå¸¸ç”¨å‘½ä»¤(æ™®åŠ)</div></pre></td></tr></table></figure>
<h4 id="Step5-æµ‹è¯•é›†ç¾¤åŸºæœ¬å‘½ä»¤"><a href="#Step5-æµ‹è¯•é›†ç¾¤åŸºæœ¬å‘½ä»¤" class="headerlink" title="Step5:æµ‹è¯•é›†ç¾¤åŸºæœ¬å‘½ä»¤"></a>Step5:æµ‹è¯•é›†ç¾¤åŸºæœ¬å‘½ä»¤</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div></pre></td><td class="code"><pre><div class="line"><span class="comment">### é»˜è®¤åˆ›å»ºkafka Topic:  1ä¸ªå‰¯æœ¬å¤‡ä»½ 1ä¸ªåˆ†åŒºæ¶ˆè´¹</span></div><div class="line"></div><div class="line">./kafka_2.10-0.8.2.1/bin/kafka-topics.sh --create --zookeeper  kafka1.jollychic.com:2281,kafka2.jollychic.com:2281,kafka3.jollychic.com:2281 --replication-factor 1 --partitions 1 --topic mongotail_lz4</div><div class="line">./kafka_2.10-0.8.2.1/bin/kafka-topics.sh --create --zookeeper  kafka1.jollychic.com:2281,kafka2.jollychic.com:2281,kafka3.jollychic.com:2281 --replication-factor 1 --partitions 1 --topic mongotail_lz4_imp</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">### å¤§æ•°æ®è¿™è¾¹éœ€è¦12ä¸ªåˆ†åŒºè¿™é‡Œæˆ‘åˆ é™¤Topicé‡æ–°åˆ›å»ºTopicï¼š</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">### åˆ é™¤kafka Topic:</span></div><div class="line"></div><div class="line"></div><div class="line">ç¬¬ä¸€æ­¥ï¼šåˆ é™¤kafka topic</div><div class="line">./kafka_2.10-0.8.2.1/bin/kafka-topics.sh --zookeeper  kafka1.jollychic.com:2281,kafka2.jollychic.com:2281,kafka3.jollychic.com:2281 --delete --topic  mongotail_lz4 </div><div class="line"></div><div class="line">./kafka_2.10-0.8.2.1/bin/kafka-topics.sh --zookeeper  kafka1.jollychic.com:2281,kafka2.jollychic.com:2281,kafka3.jollychic.com:2281 --delete --topic  mongotail_lz4_imp</div><div class="line"></div><div class="line"><span class="comment">### è¿™æ˜¯ç”±äºåˆ é™¤topicæ²¡åˆ å¹²å‡€ä¼šæŠ¥é”™ï¼š</span></div><div class="line"></div><div class="line">org.apache.kafka.common.errors.UnknownTopicOrPartitionException: This server does not host this topic-partition.</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">### åˆ é™¤çº¿ç¨‹æ‰§è¡Œåˆ é™¤æ“ä½œçš„çœŸæ­£é€»è¾‘æ˜¯ï¼š</span></div><div class="line">1. å®ƒé¦–å…ˆä¼šç»™å½“å‰æ‰€æœ‰brokerå‘é€æ›´æ–°å…ƒæ•°æ®ä¿¡æ¯çš„è¯·æ±‚ï¼Œå‘Šè¯‰è¿™äº›brokerè¯´è¿™ä¸ªtopicè¦åˆ é™¤äº†ï¼Œä½ ä»¬å¯ä»¥æŠŠå®ƒçš„ä¿¡æ¯ä»ç¼“å­˜ä¸­åˆ æ‰äº†</div><div class="line">2. å¼€å§‹åˆ é™¤è¿™ä¸ªtopicçš„æ‰€æœ‰åˆ†åŒº</div><div class="line">2.1 ç»™æ‰€æœ‰brokerå‘è¯·æ±‚ï¼Œå‘Šè¯‰å®ƒä»¬è¿™äº›åˆ†åŒºè¦è¢«åˆ é™¤ã€‚brokeræ”¶åˆ°åå°±ä¸å†æ¥å—ä»»ä½•åœ¨è¿™äº›åˆ†åŒºä¸Šçš„å®¢æˆ·ç«¯è¯·æ±‚äº†</div><div class="line">2.2 æŠŠæ¯ä¸ªåˆ†åŒºä¸‹çš„æ‰€æœ‰å‰¯æœ¬éƒ½ç½®äºOfflineReplicaçŠ¶æ€ï¼Œè¿™æ ·ISRå°±ä¸æ–­ç¼©å°ï¼Œå½“leaderå‰¯æœ¬æœ€åä¹Ÿè¢«ç½®äºOfflineReplicaçŠ¶æ€æ—¶leaderä¿¡æ¯å°†è¢«æ›´æ–°ä¸º-1</div><div class="line">2.3 å°†æ‰€æœ‰å‰¯æœ¬ç½®äºReplicaDeletionStartedçŠ¶æ€</div><div class="line">2.4 å‰¯æœ¬çŠ¶æ€æœºæ•è·çŠ¶æ€å˜æ›´ï¼Œç„¶åå‘èµ·StopReplicaRequestç»™brokerï¼Œbrokeræ¥åˆ°è¯·æ±‚ååœæ­¢æ‰€æœ‰fetcherçº¿ç¨‹ã€ç§»é™¤ç¼“å­˜ï¼Œç„¶ååˆ é™¤åº•å±‚<span class="built_in">log</span>æ–‡ä»¶</div><div class="line">2.5 å…³é—­æ‰€æœ‰ç©ºé—²çš„Fetcherçº¿ç¨‹</div><div class="line">    </div><div class="line"><span class="comment">### ç¬¬äºŒæ­¥ï¼šåˆ é™¤zookeeperç›¸å…³çš„è·¯å¾„ï¼š</span></div><div class="line">[jollybi@kafka1 zookeeper-3.4.5]$ ./bin/zkCli.sh -server 127.0.0.1:2281 </div><div class="line">[zk: 127.0.0.1:2281(CONNECTED) 1] rmr /brokers/topics/mongotail_lz4</div><div class="line">[zk: 127.0.0.1:2281(CONNECTED) 0] rmr /consumers/group_ml_general/offsets/mongotail_lz4</div><div class="line">[zk: 127.0.0.1:2281(CONNECTED) 1] rmr /consumers/group_ml_general/owners/mongotail_lz4</div><div class="line">[zk: 127.0.0.1:2281(CONNECTED) 3] rmr  /config/topics/mongotail_lz4</div><div class="line">[zk: 127.0.0.1:2281(CONNECTED) 4] rmr /admin/delete_topics/mongotail_lz4</div><div class="line"></div><div class="line"><span class="comment">### åˆ é™¤topicä¸Šé¢æ¶ˆè´¹ç»„ </span></div><div class="line"></div><div class="line">åˆ é™¤ ZooKeeper ä¸‹é¢çš„ /consumers/[group_id] è·¯å¾„å°±å¯ä»¥äº†ã€‚ZooKeeper åŸç”ŸAPIåªæ”¯æŒåˆ é™¤ç©ºçš„è·¯å¾„ï¼Œæ‰€ä»¥å»ºè®®ä½ ä½¿ç”¨ curator framework è¿›è¡Œè¿™ä¸ªåˆ é™¤æ“ä½œï¼ŒZkPaths.deleteChildren ä¼šé€’å½’å¼åœ°åˆ é™¤æ•´ä¸ªè·¯å¾„ï¼ˆåŒ…æ‹¬å­è·¯å¾„ï¼‰ã€‚</div><div class="line"></div><div class="line">[zk: 127.0.0.1:2281(CONNECTED) 0] rmr /consumers/kafka-node1-imp-group</div><div class="line">[zk: 127.0.0.1:2281(CONNECTED) 1] rmr /consumers/kafka-node1-group</div><div class="line">[zk: 127.0.0.1:2281(CONNECTED) 2] rmr /consumers/console-consumer-59053</div><div class="line">[zk: 127.0.0.1:2281(CONNECTED) 3] rmr /consumers/</div><div class="line"></div><div class="line"></div><div class="line">1ã€è®¾ç½®é…ç½®æ–‡ä»¶å…è®¸åˆ é™¤</div><div class="line">delete.topic.enable=<span class="literal">true</span> é…ç½®æ·»åŠ åˆ° config/server.properties</div><div class="line">2ã€æ‰§è¡Œåˆ é™¤å‘½ä»¤</div><div class="line">./bin/kafka-topics.sh --zookeeper localhost:2181 --delete --topic <span class="built_in">test</span>-topic</div><div class="line"></div><div class="line">åœ¨zookeeperä¸­ç¡®è®¤ï¼š</div><div class="line"></div><div class="line"> åˆ é™¤zookeeperä¸‹/brokers/topics/<span class="built_in">test</span>-topicèŠ‚ç‚¹</div><div class="line"> åˆ é™¤zookeeperä¸‹/config/topics/<span class="built_in">test</span>-topicèŠ‚ç‚¹</div><div class="line"> åˆ é™¤zookeeperä¸‹/admin/delete_topics/<span class="built_in">test</span>-topicèŠ‚ç‚¹</div><div class="line"> </div><div class="line">consumer çš„è¯ åˆ é™¤groupid</div><div class="line"> </div><div class="line"></div><div class="line"><span class="comment">### é‡å¯kafkaé›†ç¾¤</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">### å¤§æ•°æ®kafkaå»ºtopicï¼Œä¸èƒ½å»ºä¸€ä¸ªåˆ†åŒºï¼Œé‚£æ ·ååé‡ä¸Šä¸å»ï¼Œä¸å¤Ÿç”¨ï¼Œæˆ‘ä»¬ä»¥å‰å»ºäº†12ä¸ªåˆ†åŒºçš„</span></div><div class="line"><span class="comment">### åˆ›å»ºæ–° kafka Topic: 3ä¸ªå‰¯æœ¬ï¼Œ12ä¸ªåˆ†åŒº</span></div><div class="line"></div><div class="line"> ./kafka_2.10-0.8.2.1/bin/kafka-topics.sh --create --zookeeper  kafka1.jollychic.com:2281,kafka2.jollychic.com:2281,kafka3.jollychic.com:2281 --replication-factor 3 --partitions 12  --topic mongotail_lz4</div><div class="line">./kafka_2.10-0.8.2.1/bin/kafka-topics.sh --create --zookeeper  kafka1.jollychic.com:2281,kafka2.jollychic.com:2281,kafka3.jollychic.com:2281 --replication-factor 3 --partitions 12  --topic mongotail_lz4_imp</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">### æŸ¥çœ‹åˆ›å»ºçš„Topic:</span></div><div class="line">./kafka_2.10-0.8.2.1/bin/kafka-topics.sh  --describe --zookeeper kafka1.jollychic.com:2281,kafka2.jollychic.com:2281,kafka3.jollychic.com:2281  --topic mongotail_lz4</div><div class="line">./kafka_2.10-0.8.2.1/bin/kafka-topics.sh  --describe --zookeeper kafka1.jollychic.com:2281,kafka2.jollychic.com:2281,kafka3.jollychic.com:2281  --topic mongotail_lz4_imp</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">### æŸ¥çœ‹é›†ç¾¤æƒ…å†µï¼š</span></div><div class="line">./kafka_2.10-0.8.2.1/bin/kafka-topics.sh  --describe --zookeeper kafka1.jollychic.com:2281,kafka2.jollychic.com:2281,kafka3.jollychic.com:2281  --topic mongotail_lz4</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">### æ¨¡æ‹Ÿç”Ÿäº§è€…ï¼ˆproducerï¼‰kafkaç”Ÿäº§å®¢æˆ·ç«¯ç”Ÿäº§æ•°æ®å‘½ä»¤ï¼š</span></div><div class="line"></div><div class="line">./bin/kafka-console-producer.sh --broker-list 75.126.39.124:9292,75.126.5.162:9292,75.126.5.178:9292 --topic mongotail_lz4_imp                      </div><div class="line">......</div><div class="line">my <span class="built_in">test</span> message 1</div><div class="line">my <span class="built_in">test</span> message 2</div><div class="line">^C</div><div class="line"><span class="comment">### æ¨¡æ‹Ÿæ¶ˆè´¹è€…ï¼ˆconsumerï¼‰kafkaæ¶ˆè´¹å®¢æˆ·ç«¯æ•°æ®å‘½ä»¤ ç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹æ¶ˆæ¯ï¼š</span></div><div class="line"></div><div class="line"> ./bin/kafka-console-consumer.sh --zookeeper  75.126.39.124:2281,75.126.5.162:2281,75.126.5.178:2281  --fm-beginning --topic mongotail_lz4_imp</div><div class="line">......</div><div class="line">my <span class="built_in">test</span> message 1</div><div class="line">my <span class="built_in">test</span> message 2</div><div class="line"></div><div class="line">^C</div></pre></td></tr></table></figure>
<h3 id="Kafkaå¸¸ç”¨å‘½ä»¤"><a href="#Kafkaå¸¸ç”¨å‘½ä»¤" class="headerlink" title="Kafkaå¸¸ç”¨å‘½ä»¤"></a>Kafkaå¸¸ç”¨å‘½ä»¤</h3><p>ä»¥ä¸‹æ˜¯kafkaå¸¸ç”¨å‘½ä»¤è¡Œæ€»ç»“ï¼š  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">1ã€ list topic æ˜¾ç¤ºæ‰€æœ‰topic</div><div class="line">./bin/kafka-topics.sh --list --zookeeper kafka1.jollychic.com:2281,kafka2.jollychic.com:2281,kafka3.jollychic.com:2281</div><div class="line"></div><div class="line">2ã€ æŸ¥çœ‹topicçš„è¯¦ç»†ä¿¡æ¯  </div><div class="line"> ./bin/kafka-topics.sh --zookeeper  75.126.39.124:2281,75.126.5.162:2281,75.126.5.178:2281  -describe -topic mongotail_lz4_imp</div><div class="line"></div><div class="line">3ã€ä¸ºtopicå¢åŠ partitionåˆ†åŒº å‚æ•°ï¼š--alter --partitions</div><div class="line">./bin/kafka-topics.sh  --alter --zookeeper  75.126.39.124:2281,75.126.5.162:2281,75.126.5.178:2281  --partitions 20 --topic mongotail_lz4_imp</div><div class="line"></div><div class="line">4ã€kafkaç”Ÿäº§è€…å®¢æˆ·ç«¯å‘½ä»¤  </div><div class="line">./bin/kafka-console-producer.sh --broker-list 75.126.39.124:9292,75.126.5.162:9292,75.126.5.178:9292 --topic mongotail_lz4_imp                        </div><div class="line"></div><div class="line">5ã€kafkaæ¶ˆè´¹è€…å®¢æˆ·ç«¯å‘½ä»¤  </div><div class="line">./bin/kafka-console-consumer.sh --zookeeper  75.126.39.124:2281,75.126.5.162:2281,75.126.5.178:2281  --fm-beginning --topic </div><div class="line"></div><div class="line">6ã€kafkaæœåŠ¡å¯åŠ¨  </div><div class="line">./kafka-server-start.sh -daemon ../config/server.properties   </div><div class="line"></div><div class="line">7ã€ä¸‹çº¿broker  </div><div class="line">./kafka-run-class.sh kafka.admin.ShutdownBroker --zookeeper 127.0.0.1:2181 --broker <span class="comment">#brokerId# --num.retries 3 --retry.interval.ms 60  </span></div><div class="line">shutdown broker  </div><div class="line"></div><div class="line">8ã€åˆ é™¤topic  </div><div class="line">./kafka-run-class.sh kafka.admin.DeleteTopicCommand --topic <span class="built_in">test</span>KJ1 --zookeeper 127.0.0.1:2181  </div><div class="line">./kafka-topics.sh --zookeeper localhost:2181 --delete --topic <span class="built_in">test</span>KJ1  </div><div class="line"></div><div class="line">9ã€æŸ¥çœ‹consumerç»„å†…æ¶ˆè´¹çš„offset  </div><div class="line">./kafka-run-class.sh kafka.tools.ConsumerOffsetChecker --zookeeper localhost:2181 --group <span class="built_in">test</span> --topic <span class="built_in">test</span>KJ1</div></pre></td></tr></table></figure>
<h4 id="Step6-Kafkaå­˜å‚¨"><a href="#Step6-Kafkaå­˜å‚¨" class="headerlink" title="Step6:Kafkaå­˜å‚¨"></a>Step6:Kafkaå­˜å‚¨</h4><p>æ¯ä¸ªreplicaä¸€ä¸ªç›®å½•</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[jollybi@kafka1 kafka_2.10-0.8.2.0]<span class="comment"># cd /data/tools/kafka_2.10-0.8.2.0/kafka-logs/</span></div><div class="line">[root@master kafka-logs]<span class="comment"># ls</span></div><div class="line">__consumer_offsets-0   __consumer_offsets-20  __consumer_offsets-32  __consumer_offsets-44   my-replicatedtopic1-0</div><div class="line">__consumer_offsets-1   __consumer_offsets-21  __consumer_offsets-33  __consumer_offsets-45   my-replicated-topic1-1</div></pre></td></tr></table></figure>
<p>äºŒçº§ç»“æ„</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[jollybi@kafka1 kafka-logs]<span class="comment"># cd my-replicated-topic1-0/</span></div><div class="line">[jollybi@kafka1  my-replicated-topic1-0]<span class="comment"># ls</span></div><div class="line">00000000000000000000.index  00000000000000000000.log</div></pre></td></tr></table></figure>
<p><figure class="figure"><img src="http://static.zybuluo.com/sasaki/f71rtngyz2y8n3m6uxq1z2ec/%E5%9B%BE%E7%89%871.png" alt=""></figure></p>
<h3 id="äº¤æµå­¦ä¹ ï¼š"><a href="#äº¤æµå­¦ä¹ ï¼š" class="headerlink" title="äº¤æµå­¦ä¹ ï¼š"></a>äº¤æµå­¦ä¹ ï¼š</h3><p>ğŸ§  Linux shell_é«˜çº§è¿ç»´æ´¾: <code>459096184</code>    åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)<br>ğŸ§  BigData-Exchange School : <code>521621407</code>  åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥</p>
<p>ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚</p>

	

	

</article>




	<article>
	
		<h1><a href="/2016/12/29/æ—¥å¿—åˆ†æå¹³å°/Elasticsearch/æ­å»º(ElasticSearch-2.x Logstash-2.x Kibana-4.5.x zookeeper3.4.6) Kafkaä¸ºæ¶ˆæ¯ä¸­å¿ƒçš„ELKæ—¥å¿—å¹³å°/">æ­å»º(ElasticSearch-2.x Logstash-2.x Kibana-4.5.x zookeeper3.4.6) Kafkaä¸ºæ¶ˆæ¯ä¸­å¿ƒçš„ELKæ—¥å¿—å¹³å°</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-12-29</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/Log-Analysis-Platform/">Log Analysis Platform</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Elasticsearch/">Elasticsearch</a>
			</span>
		
	</div>

	

	
		<h3 id="æ­å»º-ElasticSearch-2-x-Logstash-2-x-Kibana-4-5-x-zookeeper3-4-6-Kafkaä¸ºæ¶ˆæ¯ä¸­å¿ƒçš„ELKæ—¥å¿—å¹³å°"><a href="#æ­å»º-ElasticSearch-2-x-Logstash-2-x-Kibana-4-5-x-zookeeper3-4-6-Kafkaä¸ºæ¶ˆæ¯ä¸­å¿ƒçš„ELKæ—¥å¿—å¹³å°" class="headerlink" title="æ­å»º(ElasticSearch-2.x Logstash-2.x Kibana-4.5.x zookeeper3.4.6) Kafkaä¸ºæ¶ˆæ¯ä¸­å¿ƒçš„ELKæ—¥å¿—å¹³å°"></a>æ­å»º(ElasticSearch-2.x Logstash-2.x Kibana-4.5.x zookeeper3.4.6) Kafkaä¸ºæ¶ˆæ¯ä¸­å¿ƒçš„ELKæ—¥å¿—å¹³å°</h3><h3 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><p>ELKæ˜¯ä¸šç•Œæ ‡å‡†çš„æ—¥å¿—é‡‡é›†,å­˜å‚¨ç´¢å¼•,å±•ç¤ºåˆ†æç³»ç»Ÿè§£å†³æ–¹æ¡ˆ</p>
<p>logstashæä¾›äº†çµæ´»å¤šæ ·çš„æ’ä»¶æ”¯æŒä¸åŒçš„input/output</p>
<p>ä¸»æµä½¿ç”¨redis/kafkaä½œä¸ºæ—¥å¿—/æ¶ˆæ¯çš„ä¸­é—´ç¯èŠ‚</p>
<p>å¦‚æœå·²æœ‰kafkaçš„ç¯å¢ƒäº†,ä½¿ç”¨kafkaæ¯”ä½¿ç”¨redisæ›´ä½³</p>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªæœ€ç®€åŒ–çš„é…ç½®åšä¸ªç¬”è®°,elasticå®˜ç½‘æä¾›äº†éå¸¸ä¸°å¯Œçš„æ–‡æ¡£</p>
<p>ä¸è¦ç”¨æœç´¢å¼•æ“å»æœç´¢,æ²¡å¤šå°‘ç»“æœçš„,è¯·ç›´æ¥çœ‹å®˜ç½‘æ–‡æ¡£</p>
<h3 id="ç‰ˆæœ¬åŠè¿æ¥"><a href="#ç‰ˆæœ¬åŠè¿æ¥" class="headerlink" title="ç‰ˆæœ¬åŠè¿æ¥"></a>ç‰ˆæœ¬åŠè¿æ¥</h3><p>elasticseearchç‰ˆæœ¬: 2.4.3</p>
<h3 id="ç³»ç»Ÿè¦æ±‚"><a href="#ç³»ç»Ÿè¦æ±‚" class="headerlink" title="ç³»ç»Ÿè¦æ±‚"></a>ç³»ç»Ÿè¦æ±‚</h3><p>å¦‚æœä»…ä½œæµ‹è¯•ç”¨, ä¸éœ€è¦ä¸¤å¤©æœºå™¨, å¯ä»¥å°†ä¸¤ä¸ªèŠ‚ç‚¹éƒ¨ç½²åœ¨åŒä¸€å°æœºå™¨ä¸Š, å¯¹ç£ç›˜/cpuè¦æ±‚ä¸é«˜, å†…å­˜å¤§äº2gåŸºæœ¬è¶³å¤Ÿäº†</p>
<p>å¦‚æœæ˜¯æ­£å¼ç¯å¢ƒ, éœ€è¦æ ¹æ®æ—¥å¿—é‡è¿›è¡Œè¯„ä¼°, ä¾‹å¦‚, æ¯å¤©æ—¥å¿—é‡å ç¡¬ç›˜çº¦çº¦10G, ä¸”ä¿ç•™30å¤©æ—¥å¿—, åˆ™ç£ç›˜ä¼šå ç”¨çº¦300g, esè®¾å®šçš„é˜ˆå€¼æ˜¯ç£ç›˜ç©ºé—´å æ»¡85%åˆ™æ—¥å¿—å¼€å§‹å‘Šè­¦. æ‰€ä»¥, éœ€è¦è‡³å°‘ 300/0.85=354g.</p>
<p>å‡†å¤‡4å°æœºå™¨, åœ¨åŒä¸€ä¸ªå±€åŸŸç½‘å†…(å¯pingé€š), åˆ†åˆ«åœ¨æ¯å°æœºå™¨ä¸Šéƒ¨ç½²ç›¸åº”esèŠ‚ç‚¹, æ­å»ºä¸€å¥—æ—¥å¿—é›†ç¾¤.</p>
<p>4å°æœºå™¨, æœ€å°‘çš„èµ„æºäº†, ä½†æ˜¯æ²¡æ³•åšåˆ°é«˜å¯ç”¨, æ‰€ä»¥, è¿˜éœ€è¦å†åŠ ä¸€å°æœºå™¨, é˜²æ­¢è„‘è£‚, å…·ä½“è§æœ€å(ä¸¤å°ä¸»åŠ›æœºå™¨+ä¸€å°ç¨³å®šçš„æœºå™¨å°±è¡Œ)</p>
<p>é›†ç¾¤èŠ‚ç‚¹: æœ€å°‘4å°æœºå™¨<br>å†…å­˜: 8GåŠä»¥ä¸Š<br>cpu: 4æ ¸åŠä»¥ä¸Š<br>ç¡¬ç›˜: 800GåŠä»¥ä¸Š, å»ºè®®1T, é›†ç¾¤å®¹é‡çº¦10äº¿çº§(å–å†³äºå¯¹åº”æ—¥å¿—å¤§å°)<br>æ“ä½œç³»ç»Ÿ: centos</p>
<h3 id="å‡†å¤‡å·¥ä½œ-åº”ç”¨-ç½‘ç»œ-ç¯å¢ƒ"><a href="#å‡†å¤‡å·¥ä½œ-åº”ç”¨-ç½‘ç»œ-ç¯å¢ƒ" class="headerlink" title="å‡†å¤‡å·¥ä½œ: åº”ç”¨/ç½‘ç»œ ç¯å¢ƒ"></a>å‡†å¤‡å·¥ä½œ: åº”ç”¨/ç½‘ç»œ ç¯å¢ƒ</h3><p>SLBï¼š é˜¿é‡Œäº‘åšè´Ÿè½½å‡è¡¡&amp; æˆ–è€…è‡ªå·±æ­å»ºnginx</p>
<blockquote>
<p>ELKæœåŠ¡ç«¯é›†ç¾¤ï¼š</p>
</blockquote>
<p>ç³»ç»Ÿcentos 6.7  JDK1.8  ç‰ˆæœ¬ï¼šElasticsearch-2.4.0</p>
<p>es_01 10.47.88.206<br>es_02 10.47.88.188</p>
<blockquote>
<p>KibanaæœåŠ¡ç«¯é›†ç¾¤ï¼š</p>
</blockquote>
<p>ç³»ç»Ÿcentos 6.7  JDK1.8  ç‰ˆæœ¬ï¼škibana-4.5.1</p>
<p>es_01 10.47.88.206<br>es_02 10.47.88.188</p>
<blockquote>
<p>KafKaé›†ç¾¤</p>
</blockquote>
<p>ç³»ç»Ÿcentos 6.7  JDK1.8  ç‰ˆæœ¬ï¼škafka_2.10-0.9</p>
<p>kafka_01 10.46.72.172<br>kafka_02 10.47.88.103<br>kafka_03 10.47.102.137</p>
<blockquote>
<p>zookeeperé›†ç¾¤</p>
</blockquote>
<p>ç³»ç»Ÿcentos 6.7  JDK1.8  ç‰ˆæœ¬ï¼šzookeeper-3.4.6</p>
<p>kafka_01 10.46.72.172<br>kafka_02 10.47.88.103<br>kafka_03 10.47.102.137</p>
<blockquote>
<p>logstash-2.4</p>
</blockquote>
<p>å®¢æˆ·ç«¯ï¼šç³»ç»Ÿcentos 6.7  JDK1.8  ç‰ˆæœ¬ï¼š logstash-2.4</p>
<p>tomcat-account_01: 10.27.232.85</p>
<p>éƒ½è¦jdk1.8æ”¯æŒã€‚</p>
<h3 id="æ•´ä½“è¯´æ˜"><a href="#æ•´ä½“è¯´æ˜" class="headerlink" title="æ•´ä½“è¯´æ˜"></a>æ•´ä½“è¯´æ˜</h3><h4 id="æ•°æ®æµå‘-gt-æ—¥å¿—-æ¶ˆæ¯æ•´ä½“æµå‘"><a href="#æ•°æ®æµå‘-gt-æ—¥å¿—-æ¶ˆæ¯æ•´ä½“æµå‘" class="headerlink" title="æ•°æ®æµå‘=&gt;æ—¥å¿—/æ¶ˆæ¯æ•´ä½“æµå‘"></a>æ•°æ®æµå‘=&gt;æ—¥å¿—/æ¶ˆæ¯æ•´ä½“æµå‘</h4><p>logstash =&gt; kafka =&gt; logstash =&gt; elasticsearch =&gt; kibana</p>
<h3 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h3><h4 id="1-ç¡®è®¤JDKç‰ˆæœ¬åŠå®‰è£…"><a href="#1-ç¡®è®¤JDKç‰ˆæœ¬åŠå®‰è£…" class="headerlink" title="1. ç¡®è®¤JDKç‰ˆæœ¬åŠå®‰è£…"></a>1. ç¡®è®¤JDKç‰ˆæœ¬åŠå®‰è£…</h4><p>esä¾èµ–javaçš„ç‰ˆæœ¬æœ€å°ä¸º1.7</p>
<p>å¦‚æœç³»ç»Ÿä¸­æœªå®‰è£…JDK<br>åˆ™å‘½ä»¤è¿”å›<code>bash: java: command not found,</code> éœ€è¦å®‰è£…<code>JDK</code></p>
<p>å¦‚æœç³»ç»Ÿä¸­å®‰è£…äº†JDK, éœ€ç¡®è®¤ç‰ˆæœ¬æ˜¯å¦å¤§äºjava 1.7, å¦åˆ™éœ€è¦å‡çº§</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">java -version</div><div class="line">java version <span class="string">"1.7.0_51"</span> Java(TM) SE Runtime Environment (build 1.7.0_51-b13) Java HotSpot(TM) Server VM (build 24.51-b03, mixed mode)</div><div class="line"></div><div class="line">å®‰è£…åŠå‡çº§java(æ³¨æ„æ ¹æ®ç³»ç»Ÿä¸åŒè¿è¡Œå¯¹åº”å®‰è£…å‘½ä»¤)</div><div class="line"></div><div class="line"><span class="comment"># Redhat/Centos/Fedora</span></div><div class="line">sudo yum install java-1.7.0-openjdk</div><div class="line"></div><div class="line">æˆ–è€…åˆ°å®˜ç½‘, ä¸‹è½½æœ€æ–°çš„jdkçš„rpmåŒ…, ç„¶åå®‰è£…</div><div class="line"></div><div class="line">wget http://download.oracle.com/otn-pub/java/jdk/8u91-b14/jdk-8u91-linux-x64.rpm</div><div class="line">rpm -Uvh jdk-8u91-linux-x64.rpm</div></pre></td></tr></table></figure>
<p>å†æ¬¡ç¡®è®¤å®‰è£…æˆåŠŸ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">java -version</div></pre></td></tr></table></figure>
<h4 id="åŸºæœ¬é…ç½®è®¾ç½®FQDNï¼š"><a href="#åŸºæœ¬é…ç½®è®¾ç½®FQDNï¼š" class="headerlink" title="åŸºæœ¬é…ç½®è®¾ç½®FQDNï¼š"></a>åŸºæœ¬é…ç½®è®¾ç½®FQDNï¼š</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#ä¿®æ”¹hostname</span></div><div class="line">cat /etc/hostname</div><div class="line">es_01</div><div class="line"></div><div class="line"><span class="comment">#ä¿®æ”¹hosts</span></div><div class="line">cat /etc/hosts</div><div class="line">127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4</div><div class="line">::1 localhost localhost.localdomain localhost6 localhost6.localdomain6</div><div class="line">10.47.88.206 es.ihaozhuo.com es_01</div><div class="line"></div><div class="line"><span class="comment">#åˆ·æ–°ç¯å¢ƒ</span></div><div class="line">hostname -F /etc/hostname</div><div class="line"></div><div class="line"><span class="comment">#å¤æŸ¥ç»“æœ</span></div><div class="line">hostname <span class="_">-f</span></div><div class="line">es.ihaozhuo.com</div><div class="line"></div><div class="line">hostname</div><div class="line">es_01</div></pre></td></tr></table></figure>
<h3 id="é˜²ç«å¢™é…ç½®"><a href="#é˜²ç«å¢™é…ç½®" class="headerlink" title="é˜²ç«å¢™é…ç½®"></a>é˜²ç«å¢™é…ç½®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#service iptables stop</span></div><div class="line"><span class="comment">#setenforce 0</span></div><div class="line"></div><div class="line">ä¸è¿‡è¿™é‡Œæˆ‘é˜²ç«å¢™æ˜¯å¼€å¯çš„ï¼ŒåæœŸæ·»åŠ å‡ºå»ç«¯å£å³å¯ã€‚</div><div class="line">æˆ–è€…å¯ä»¥ä¸å…³é—­é˜²ç«å¢™ï¼Œä½†æ˜¯è¦åœ¨iptablesä¸­æ‰“å¼€ç›¸å…³çš„ç«¯å£ï¼š</div><div class="line"></div><div class="line"><span class="comment"># vim /etc/sysconfig/iptables</span></div><div class="line">-A INPUT -m state --state NEW -m tcp -p tcp --dport 80 -j ACCEPT</div><div class="line">-A INPUT -m state --state NEW -m tcp -p tcp --dport 9200 -j ACCEPT</div><div class="line">-A INPUT -m state --state NEW -m tcp -p tcp --dport 9292 -j ACCEPT</div><div class="line"><span class="comment"># service iptables restart</span></div></pre></td></tr></table></figure>
<h4 id="RPMå¿«é€Ÿå®‰è£…"><a href="#RPMå¿«é€Ÿå®‰è£…" class="headerlink" title="RPMå¿«é€Ÿå®‰è£…"></a>RPMå¿«é€Ÿå®‰è£…</h4><p>elkæ‰€æœ‰å®‰è£…éƒ½å¯ä»¥ä½¿ç”¨rpmäºŒè¿›åˆ¶åŒ…çš„æ–¹å¼,å¢åŠ <code>elasticå®˜ç½‘</code>çš„ä»“åº“repoå°±å¯ä»¥ç”¨yumå®‰è£…äº†</p>
<p>elasticsearchçœ‹è¿™é‡Œ â€”â€“ <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/setup-repositories.html" target="_blank" rel="external">elasticsearch-rpmå®˜æ–¹æ–‡æ¡£</a></p>
<p>logstashçœ‹è¿™é‡Œ â€”-<a href="https://www.elastic.co/guide/en/logstash/current/installing-logstash.html" target="_blank" rel="external">logstash-rpmå®˜ç½‘æ–‡æ¡£</a></p>
<p>kibanaçœ‹è¿™é‡Œ â€”<a href="https://www.elastic.co/guide/en/kibana/current/setup.html" target="_blank" rel="external">kibana-rpmå®˜ç½‘æ–‡æ¡£</a></p>
<h3 id="es-01æœåŠ¡ç«¯æºç å®‰è£…"><a href="#es-01æœåŠ¡ç«¯æºç å®‰è£…" class="headerlink" title="es_01æœåŠ¡ç«¯æºç å®‰è£…"></a>es_01æœåŠ¡ç«¯æºç å®‰è£…</h3><p>è¿™é‡Œæˆ‘æ˜¯æºç å®‰è£…çš„<br>ä¸‹è½½ElasticSearch ElasticSearché»˜è®¤çš„å¯¹å¤–æœåŠ¡çš„HTTPç«¯å£æ˜¯9200ï¼ŒèŠ‚ç‚¹é—´äº¤äº’çš„TCPç«¯å£æ˜¯9300ã€‚</p>
<p>ä¸‹è½½åœ°å€ï¼š<a href="https://www.elastic.co/downloads/elasticsearch" target="_blank" rel="external">Elasticsearch</a></p>
<p>2.4ç‰ˆæœ¬ï¼š<br><a href="https://www.elastic.co/downloads/past-releases/elasticsearch-2-4-3" target="_blank" rel="external">Elasticsearch2.4.3</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">è§£å‹æºç åŒ…ï¼š</div><div class="line">[root@es_01 ~]<span class="comment"># tar -zxvf elasticsearch-2.4.3.tar.gz -C /usr/local/</span></div><div class="line">ç„¶åç»™ç›®å½•åšä¸ªè½¯é“¾æ¥ï¼š</div><div class="line">[root@es_01 <span class="built_in">local</span>]<span class="comment"># ln -s  /usr/local/elasticsearch-2.4.3/ /usr/local/elasticsearch</span></div><div class="line"></div><div class="line">è¿™é‡Œéœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š</div><div class="line">é…ç½®å‰å…ˆåˆ›å»ºå‡ ä¸ªç›®å½•æ–‡ä»¶</div><div class="line">æ–°å»ºç›®å½•, å‡è®¾/data/ç›®å½•æŒ‚è½½çš„ç¡¬ç›˜æœ€å¤§(500Gä»¥ä¸Š)</div><div class="line">[root@es_01 srv]]<span class="comment"># mkdir /srv/data/es-data -p</span></div><div class="line">[root@es_01 srv]<span class="comment"># mkdir /srv/data/es-work </span></div><div class="line"></div><div class="line">[root@es_01 <span class="built_in">local</span>]<span class="comment"># mkdir /usr/local/elasticsearch/logs</span></div><div class="line">[root@es_01 <span class="built_in">local</span>]<span class="comment"># mkdir /usr/local/elasticsearch/config/plugins</span></div><div class="line"></div><div class="line">æ–°å»ºç”¨æˆ·</div><div class="line">ä¿®æ”¹æºç ç›®å½•å±æ€§å±ç»„ï¼š</div><div class="line">[root@es_01 elasticsearch]<span class="comment"># useradd  -s /sbin/nologin elasticsearch</span></div><div class="line">[root@es_01 elasticsearch]<span class="comment"># chown -R elasticsearch:elasticsearch /usr/local/elasticsearch</span></div><div class="line">[root@es_01 elasticsearch]<span class="comment"># chown -R elasticsearch:elasticsearch /srv/data/</span></div><div class="line"></div><div class="line"></div><div class="line">åˆ‡æ¢ç”¨æˆ·</div><div class="line">åˆ‡æ¢åˆ°elasticsearchç”¨æˆ·, å¹¶è¿›å…¥elasticsearchç›®å½•</div><div class="line"></div><div class="line">su elasticsearch</div><div class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/elasticsearch/</div></pre></td></tr></table></figure>
<h3 id="é…ç½®Elasticsearchï¼š"><a href="#é…ç½®Elasticsearchï¼š" class="headerlink" title="é…ç½®Elasticsearchï¼š"></a>é…ç½®Elasticsearchï¼š</h3><p>ä»¥ç”¨æˆ·esçš„èº«ä»½è¿›è¡Œæ“ä½œ</p>
<p>æ–‡ä»¶è·¯å¾„: <code>config/elasticsearch.yml</code><br>ä¿®æ”¹è¯¥æ–‡ä»¶ä¸­é…ç½®é¡¹: (æ³¨æ„, åŸå§‹æ–‡ä»¶ä¸­éƒ½æ˜¯è¢«#å·æ³¨é‡Šæ‰äº†, éœ€è¦å»æ‰å¯¹åº”æ³¨é‡Šå¹¶ä¿®æ”¹é…ç½®å€¼)</p>
<ul>
<li>é›†ç¾¤å: cluster.name, æ³¨æ„: ä¸¤å°æœºå™¨é…ç½®ä¸€è‡´</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cluster.name: elk_cluster</div></pre></td></tr></table></figure>
<ul>
<li>èŠ‚ç‚¹å: node.name, æ³¨æ„: ä¸¤å°æœºå™¨é…ç½®ä¸åŒ, ä¸€å°ä¸º01, å¦ä¸€å°ä¸º02</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"> <span class="comment"># ç¬¬ä¸€å°æœºå™¨</span></div><div class="line"> </div><div class="line">node.name: inner_es_node_01</div><div class="line"></div><div class="line"><span class="comment"># ç¬¬äºŒå°æœºå™¨</span></div><div class="line">node.name: inner_es_node_02</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">[root@es_01 config]<span class="comment"># vim elasticsearch.yml</span></div><div class="line"></div><div class="line"><span class="comment"># Use a descriptive name for your cluster:</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#</span></div><div class="line">cluster.name: elk_cluster</div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># ------------------------------------ Node ------------------------------------</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Use a descriptive name for the node:</span></div><div class="line"><span class="comment">#</span></div><div class="line">node.name: es_01</div><div class="line"></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Add custom attributes to the node:</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># node.rack: r1</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># ----------------------------------- Paths ------------------------------------</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Path to directory where to store the data (separate multiple locations by comma):</span></div><div class="line"><span class="comment">#</span></div><div class="line">path.data: /srv/data/es-data</div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Path to log files:</span></div><div class="line"><span class="comment">#</span></div><div class="line">path.logs: /usr/<span class="built_in">local</span>/elasticsearch/logs</div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># ----------------------------------- Memory -----------------------------------</span></div><div class="line"><span class="comment">#</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># Lock the memory on startup:</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># bootstrap.memory_lock: true</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Make sure that the `ES_HEAP_SIZE` environment variable is set to about half the memory</span></div><div class="line"><span class="comment"># available on the system and that the owner of the process is allowed to use this limit.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Elasticsearch performs poorly when the system is swapping the memory.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># ---------------------------------- Network -----------------------------------</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Set the bind address to a specific IP (IPv4 or IPv6):</span></div><div class="line"><span class="comment">#</span></div><div class="line">network.host: 10.47.88.206</div></pre></td></tr></table></figure>
<p>åˆ‡æ¢åˆ°elasticsearchç”¨æˆ·å¯åŠ¨æœåŠ¡ã€‚</p>
<p>æºç å®‰è£…å¯åŠ¨éœ€è¦æ‰§è¡Œ ï¼š<code>/usr/local/elasticsearch/bin/elasticsearch &amp;</code><br>æ‰èƒ½å¯åŠ¨ï¼›</p>
<h3 id="æµ‹è¯•è®¿é—®æœåŠ¡æ­£å¸¸ï¼š"><a href="#æµ‹è¯•è®¿é—®æœåŠ¡æ­£å¸¸ï¼š" class="headerlink" title="æµ‹è¯•è®¿é—®æœåŠ¡æ­£å¸¸ï¼š"></a>æµ‹è¯•è®¿é—®æœåŠ¡æ­£å¸¸ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[elasticsearch@es_01 elasticsearch]$  curl http://10.47.88.206:9200</div><div class="line">&#123;</div><div class="line">  <span class="string">"name"</span> : <span class="string">"es_01"</span>,</div><div class="line">  <span class="string">"cluster_name"</span> : <span class="string">"elk_cluster"</span>,</div><div class="line">  <span class="string">"cluster_uuid"</span> : <span class="string">"mspLZT5nTL-d124suNbBBQ"</span>,</div><div class="line">  <span class="string">"version"</span> : &#123;</div><div class="line">    <span class="string">"number"</span> : <span class="string">"2.4.3"</span>,</div><div class="line">    <span class="string">"build_hash"</span> : <span class="string">"d38a34e7b75af4e17ead16f156feffa432b22be3"</span>,</div><div class="line">    <span class="string">"build_timestamp"</span> : <span class="string">"2016-12-07T16:28:56Z"</span>,</div><div class="line">    <span class="string">"build_snapshot"</span> : <span class="literal">false</span>,</div><div class="line">    <span class="string">"lucene_version"</span> : <span class="string">"5.5.2"</span></div><div class="line">  &#125;,</div><div class="line">  <span class="string">"tagline"</span> : <span class="string">"You Know, for Search"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä¸‹é¢æ˜¯å†™å¼€æœºå¯åŠ¨è„šæœ¬ï¼Œä¸å†™çš„ç›´æ¥åˆ‡æ¢esç”¨æˆ·åˆ°ç›®å½•å¯åŠ¨ -dåå°å¯åŠ¨ã€‚<br>è¿™é‡Œéœ€è¦/etc/init.d/åˆ›å»ºå¯åŠ¨è„šæœ¬ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">[root@ELK ~]<span class="comment"># git clone https://github.com/elastic/elasticsearch-servicewrapper.git</span></div><div class="line">Initialized empty Git repository <span class="keyword">in</span> /root/elasticsearch-servicewrapper/.git/</div><div class="line">remote: Counting objects: 184, done.</div><div class="line">remote: Total 184 (delta 0), reused 0 (delta 0), pack-reused 184</div><div class="line">Receiving objects: 100% (184/184), 4.55 MiB | 511 KiB/s, done.</div><div class="line">Resolving deltas: 100% (53/53), done.</div><div class="line">[root@ELK elasticsearch-servicewrapper]<span class="comment"># mv service/ /usr/local/elasticsearch/bin/</span></div><div class="line">[root@ELK elasticsearch-servicewrapper]<span class="comment"># cd /usr/local/elasticsearch</span></div><div class="line">[root@ELK elasticsearch]<span class="comment"># /usr/local/elasticsearch/bin/service/elasticsearch install    è¿™é‡Œæ˜¯å®‰è£…es</span></div><div class="line">Detected RHEL or Fedora:</div><div class="line">Installing the Elasticsearch daemon..</div><div class="line">[root@ELK elasticsearch]<span class="comment"># vim /etc/init.d/elasticsearch   æŸ¥çœ‹å®‰è£…eså¯åŠ¨é…ç½®æ–‡ä»¶</span></div><div class="line">[root@ELK elasticsearch]<span class="comment"># service elastic search start  å¯åŠ¨es </span></div><div class="line">Starting Elasticsearch...</div><div class="line">Waiting <span class="keyword">for</span> Elasticsearch......</div><div class="line">running: PID:31360   æœåŠ¡å·²å¯åŠ¨äº†ã€‚</div><div class="line"></div><div class="line">å¯åŠ¨ç›¸å…³æœåŠ¡</div><div class="line">service elasticsearch start</div><div class="line">service elasticsearch status</div><div class="line"></div><div class="line">é…ç½® elasticsearch æœåŠ¡éšç³»ç»Ÿè‡ªåŠ¨å¯åŠ¨</div><div class="line"><span class="comment"># chkconfig --add elasticsearch</span></div><div class="line"></div><div class="line">æµ‹è¯•ElasticSearchæœåŠ¡æ˜¯å¦æ­£å¸¸ï¼Œé¢„æœŸè¿”å›200çš„çŠ¶æ€ç </div><div class="line"><span class="comment"># curl -X GET http://localhost:9200</span></div></pre></td></tr></table></figure>
<h3 id="es-02æœåŠ¡ç«¯èŠ‚ç‚¹ï¼š"><a href="#es-02æœåŠ¡ç«¯èŠ‚ç‚¹ï¼š" class="headerlink" title="es_02æœåŠ¡ç«¯èŠ‚ç‚¹ï¼š"></a>es_02æœåŠ¡ç«¯èŠ‚ç‚¹ï¼š</h3><p>ç¬¬ä¸€æ­¥åŸºç¡€é…ç½®éƒ½æ˜¯ä¸€æ ·çš„ï¼Œè·Ÿes_01èŠ‚ç‚¹ä¸€æ ·ã€‚  å…¶ä»–åªéœ€è¦åˆ°es_01æ‹·è´è¿‡æ¥,ç„¶ååˆ›å»ºä¸‹esç”¨æˆ·ï¼Œä¿®æ”¹ä¸‹é…ç½®ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">/usr/<span class="built_in">local</span>/elasticsearch  ç›®å½•æ‹·è´åˆ°es_02æœºå™¨ã€‚</div><div class="line">è¿™é‡Œéœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š</div><div class="line">é…ç½®å‰å…ˆåˆ›å»ºå‡ ä¸ªç›®å½•æ–‡ä»¶</div><div class="line">[root@es_01 srv]]<span class="comment"># mkdir /srv/data/es-data -p</span></div><div class="line">[root@es_01 srv]<span class="comment"># mkdir /srv/data/es-work </span></div><div class="line">ä¿®æ”¹æºç ç›®å½•å±æ€§å±ç»„ï¼š</div><div class="line">[root@es_01 elasticsearch]<span class="comment"># useradd  -s /sbin/nologin elasticsearch</span></div><div class="line">[root@es_01 elasticsearch]<span class="comment"># chown -R elasticsearch:elasticsearch /usr/local/elasticsearch/*</span></div><div class="line">[root@es_01 elasticsearch]<span class="comment"># chown -R elasticsearch:elasticsearch /srv/data/</span></div><div class="line"></div><div class="line">ä¿®æ”¹é…ç½®æ–‡ä»¶</div><div class="line">vim elasticsearch.yml</div><div class="line">node.name: es_02</div><div class="line">network.host: 10.47.88.188</div><div class="line"></div><div class="line">å…¶ä»–ä¸éœ€è¦ä¿®æ”¹</div></pre></td></tr></table></figure>
<h3 id="é›†ç¾¤èŠ‚ç‚¹es-02æµ‹è¯•ï¼š"><a href="#é›†ç¾¤èŠ‚ç‚¹es-02æµ‹è¯•ï¼š" class="headerlink" title="é›†ç¾¤èŠ‚ç‚¹es_02æµ‹è¯•ï¼š"></a>é›†ç¾¤èŠ‚ç‚¹es_02æµ‹è¯•ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[root@es_02 home]<span class="comment"># curl http://10.47.88.188:9200</span></div><div class="line">&#123;</div><div class="line">  <span class="string">"name"</span> : <span class="string">"es_02"</span>,</div><div class="line">  <span class="string">"cluster_name"</span> : <span class="string">"elk_cluster"</span>,</div><div class="line">  <span class="string">"cluster_uuid"</span> : <span class="string">"-4Rqn4IzS1GfnsodqZD8Tg"</span>,</div><div class="line">  <span class="string">"version"</span> : &#123;</div><div class="line">    <span class="string">"number"</span> : <span class="string">"2.4.3"</span>,</div><div class="line">    <span class="string">"build_hash"</span> : <span class="string">"d38a34e7b75af4e17ead16f156feffa432b22be3"</span>,</div><div class="line">    <span class="string">"build_timestamp"</span> : <span class="string">"2016-12-07T16:28:56Z"</span>,</div><div class="line">    <span class="string">"build_snapshot"</span> : <span class="literal">false</span>,</div><div class="line">    <span class="string">"lucene_version"</span> : <span class="string">"5.5.2"</span></div><div class="line">  &#125;,</div><div class="line">  <span class="string">"tagline"</span> : <span class="string">"You Know, for Search"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>elké›†ç¾¤å·²å®‰è£…é…ç½®å®Œæ¯•ï¼Œæˆ‘è¿™é‡Œé…ç½®äº†nginxåšä¸‹åå‘ä»£ç†ï¼Œèµ°80ç«¯å£å‡ºå»ã€‚ç„¶ååœ¨nginxè®¾ç½®ä¸‹å†…éƒ¨å…¬å¸è®¿é—®ä¸å¯¹å¤–å¼€æ”¾ã€‚</p>
<h3 id="å®‰è£…-headã€marvelã€bigdeskæ’ä»¶"><a href="#å®‰è£…-headã€marvelã€bigdeskæ’ä»¶" class="headerlink" title="å®‰è£… headã€marvelã€bigdeskæ’ä»¶:"></a>å®‰è£… headã€marvelã€bigdeskæ’ä»¶:</h3><p>es1.5æ’ä»¶å®‰è£…æ˜¯<code>./plugin -install xxx</code>,è€Œes2.4æ’ä»¶å®‰è£…æ²¡æœ‰å‡å·<code>./plugin install xxx</code></p>
<p>1.5ç‰ˆæœ¬æ–¹æ³•ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">* headæ’ä»¶</div><div class="line"></div><div class="line">æ’ä»¶å®‰è£…æ–¹æ³•1ï¼š</div><div class="line">/usr/<span class="built_in">local</span>/elasticsearch/bin/plugin -install mobz/elasticsearch-head</div><div class="line">é‡å¯es å³å¯ã€‚</div><div class="line">æ‰“å¼€http://localhost:9200/_plugin/head/</div><div class="line"></div><div class="line">æ’ä»¶å®‰è£…æ–¹æ³•2ï¼š</div><div class="line">1.https://github.com/mobz/elasticsearch-headä¸‹è½½zip è§£å‹</div><div class="line">2.å»ºç«‹/usr/<span class="built_in">local</span>/elasticsearch/plugins/head/æ–‡ä»¶</div><div class="line">3.å°†è§£å‹åçš„elasticsearch-head-masteræ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶copyåˆ°/usr/<span class="built_in">local</span>/elasticsearch/plugins/head/</div><div class="line">é‡å¯es å³å¯ã€‚</div><div class="line"></div><div class="line">æ‰“å¼€http://localhost:9200/_plugin/head/</div></pre></td></tr></table></figure>
<p>2.4ç‰ˆæœ¬ä»¥ä¸Šå®‰è£…ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">* headæ’ä»¶</div><div class="line"></div><div class="line">æ’ä»¶å®‰è£…æ–¹æ³•1ï¼š</div><div class="line">/usr/<span class="built_in">local</span>/elasticsearch/bin/plugin install mobz/elasticsearch-head</div><div class="line">é‡å¯es å³å¯ã€‚</div><div class="line">æ‰“å¼€http://localhost:9200/_plugin/head/</div><div class="line"></div><div class="line">æ’ä»¶å®‰è£…æ–¹æ³•2ï¼š</div><div class="line">1.https://github.com/mobz/elasticsearch-headä¸‹è½½zip è§£å‹</div><div class="line">2.å»ºç«‹elasticsearch-1.0.0\plugins\head\_siteæ–‡ä»¶</div><div class="line">3.å°†è§£å‹åçš„elasticsearch-head-masteræ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶copyåˆ°_site</div><div class="line">é‡å¯es å³å¯ã€‚</div><div class="line"></div><div class="line">æ‰“å¼€http://localhost:9200/_plugin/head/</div></pre></td></tr></table></figure>
<p>ä¸ºäº†ä¿éšœæœç´¢æœåŠ¡çš„ç¨³å®šæ€§ï¼Œå¢åŠ äº†ä¸€å°æœºå™¨ï¼Œå°†Elasticsearchéƒ¨ç½²æˆäº†é›†ç¾¤æ¨¡å¼ï¼Œ éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒæ—¶å‘ç°ï¼Œæ–°çš„èŠ‚ç‚¹å¹¶ä¸èƒ½è¢«å‘ç°ï¼Œåå°å‘ç°é˜¿é‡Œäº‘å¹¶ä¸æ”¯æŒå¤šæ’­ï¼Œæœ€ååªèƒ½æ”¹ä¸ºå•æ’­çš„æ–¹å¼é…ç½®äº†ï¼Œå¥½åœ¨ä¹‹åä¸€åˆ‡é¡ºåˆ©ã€‚</p>
<p>ä¸‹é¢é™„ä¸Šæµ‹è¯•ç¯å¢ƒé…ç½®ç¤ºä¾‹ï¼šæ·»åŠ ä¸‹ä¸‹é¢ç›‘å¬é›†ç¾¤IPå’Œç«¯å£ã€‚</p>
<ul>
<li>es_01</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@es_01 config]<span class="comment"># vim elasticsearch.yml</span></div><div class="line"></div><div class="line">discovery.zen.ping.multicast.enabled: <span class="literal">false</span></div><div class="line">discovery.zen.ping.unicast.hosts: [<span class="string">"10.47.88.206:9300"</span>,<span class="string">"10.47.88.188:9300"</span>]</div></pre></td></tr></table></figure>
<ul>
<li>es_02</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@es_02 config]<span class="comment"># vim elasticsearch.yml</span></div><div class="line"></div><div class="line">discovery.zen.ping.multicast.enabled: <span class="literal">false</span></div><div class="line">discovery.zen.ping.unicast.hosts: [<span class="string">"10.47.88.206:9300"</span>,<span class="string">"10.47.88.188:9300"</span>]</div></pre></td></tr></table></figure>
<p>ç„¶åé‡å¯æœåŠ¡ï¼ŒæŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹ã€‚</p>
<h3 id="es-02å®‰è£…Kibana"><a href="#es-02å®‰è£…Kibana" class="headerlink" title="es_02å®‰è£…Kibana:"></a>es_02å®‰è£…Kibana:</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div></pre></td><td class="code"><pre><div class="line">åˆ°https://www.elastic.co/downloads/kibana  æ‰¾åˆé€‚çš„ç‰ˆæœ¬ã€‚</div><div class="line"></div><div class="line">wget https://download.elastic.co/kibana/kibana/kibana-4.5.1-linux-x64.tar.gz</div><div class="line"></div><div class="line"><span class="comment">#è§£å‹</span></div><div class="line"></div><div class="line">ï¼ƒtar zxvf kibana-4.1.2-linux-x64.tar.gz -C /usr/<span class="built_in">local</span> </div><div class="line">ï¼ƒ<span class="built_in">cd</span>  /usr/<span class="built_in">local</span>/ &amp;&amp; mv kibana-4.1.2-linux-x64 kibana</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#åˆ›å»ºkibanaå¯åŠ¨è„šæœ¬æœåŠ¡</span></div><div class="line">vi /etc/rc.d/init.d/kibana</div><div class="line"></div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment">### BEGIN INIT INFO</span></div><div class="line"><span class="comment"># Provides:          kibana</span></div><div class="line"><span class="comment"># Default-Start:     2 3 4 5</span></div><div class="line"><span class="comment"># Default-Stop:      0 1 6</span></div><div class="line"><span class="comment"># Short-Description: Runs kibana daemon</span></div><div class="line"><span class="comment"># Description: Runs the kibana daemon as a non-root user</span></div><div class="line"><span class="comment">### END INIT INFO</span></div><div class="line"></div><div class="line"><span class="comment"># Process name</span></div><div class="line">NAME=kibana</div><div class="line">DESC=<span class="string">"Kibana4"</span></div><div class="line">PROG=<span class="string">"/etc/init.d/kibana"</span></div><div class="line"></div><div class="line"><span class="comment"># Configure location of Kibana bin</span></div><div class="line">KIBANA_BIN=/usr/<span class="built_in">local</span>/kibana/bin</div><div class="line"></div><div class="line"><span class="comment"># PID Info</span></div><div class="line">PID_FOLDER=/var/run/kibana/</div><div class="line">PID_FILE=/var/run/kibana/<span class="variable">$NAME</span>.pid</div><div class="line">LOCK_FILE=/var/lock/subsys/<span class="variable">$NAME</span></div><div class="line">PATH=/bin:/usr/bin:/sbin:/usr/sbin:<span class="variable">$KIBANA_BIN</span></div><div class="line">DAEMON=<span class="variable">$KIBANA_BIN</span>/<span class="variable">$NAME</span></div><div class="line"></div><div class="line"><span class="comment"># Configure User to run daemon process</span></div><div class="line">DAEMON_USER=root</div><div class="line"><span class="comment"># Configure logging location</span></div><div class="line">KIBANA_LOG=/var/<span class="built_in">log</span>/kibana.log</div><div class="line"></div><div class="line"><span class="comment"># Begin Script</span></div><div class="line">RETVAL=0</div><div class="line"></div><div class="line"><span class="keyword">if</span> [ `id -u` <span class="_">-ne</span> 0 ]; <span class="keyword">then</span></div><div class="line">        <span class="built_in">echo</span> <span class="string">"You need root privileges to run this script"</span></div><div class="line">        <span class="built_in">exit</span> 1</div><div class="line"><span class="keyword">fi</span></div><div class="line"></div><div class="line"><span class="comment"># Function library</span></div><div class="line">. /etc/init.d/<span class="built_in">functions</span></div><div class="line"> </div><div class="line"><span class="function"><span class="title">start</span></span>() &#123;</div><div class="line">        <span class="built_in">echo</span> -n <span class="string">"Starting <span class="variable">$DESC</span> : "</span></div><div class="line"></div><div class="line">pid=`pidofproc -p <span class="variable">$PID_FILE</span> kibana`</div><div class="line">        <span class="keyword">if</span> [ -n <span class="string">"<span class="variable">$pid</span>"</span> ] ; <span class="keyword">then</span></div><div class="line">                <span class="built_in">echo</span> <span class="string">"Already running."</span></div><div class="line">                <span class="built_in">exit</span> 0</div><div class="line">        <span class="keyword">else</span></div><div class="line">        <span class="comment"># Start Daemon</span></div><div class="line"><span class="keyword">if</span> [ ! <span class="_">-d</span> <span class="string">"<span class="variable">$PID_FOLDER</span>"</span> ] ; <span class="keyword">then</span></div><div class="line">                        mkdir <span class="variable">$PID_FOLDER</span></div><div class="line">                <span class="keyword">fi</span></div><div class="line">daemon --user=<span class="variable">$DAEMON_USER</span> --pidfile=<span class="variable">$PID_FILE</span> <span class="variable">$DAEMON</span> 1&gt;<span class="string">"<span class="variable">$KIBANA_LOG</span>"</span> 2&gt;&amp;1 &amp;</div><div class="line">                sleep 2</div><div class="line">                pidofproc node &gt; <span class="variable">$PID_FILE</span></div><div class="line">                RETVAL=$?</div><div class="line">                [[ $? <span class="_">-eq</span> 0 ]] &amp;&amp; success || failure</div><div class="line"><span class="built_in">echo</span></div><div class="line">                [ <span class="variable">$RETVAL</span> = 0 ] &amp;&amp; touch <span class="variable">$LOCK_FILE</span></div><div class="line">                <span class="built_in">return</span> <span class="variable">$RETVAL</span></div><div class="line">        <span class="keyword">fi</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="title">reload</span></span>()</div><div class="line">&#123;</div><div class="line">    <span class="built_in">echo</span> <span class="string">"Reload command is not implemented for this service."</span></div><div class="line">    <span class="built_in">return</span> <span class="variable">$RETVAL</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="title">stop</span></span>() &#123;</div><div class="line">        <span class="built_in">echo</span> -n <span class="string">"Stopping <span class="variable">$DESC</span> : "</span></div><div class="line">        killproc -p <span class="variable">$PID_FILE</span> <span class="variable">$DAEMON</span></div><div class="line">        RETVAL=$?</div><div class="line"><span class="built_in">echo</span></div><div class="line">        [ <span class="variable">$RETVAL</span> = 0 ] &amp;&amp; rm <span class="_">-f</span> <span class="variable">$PID_FILE</span> <span class="variable">$LOCK_FILE</span></div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$1</span>"</span> <span class="keyword">in</span></div><div class="line">  start)</div><div class="line">        start</div><div class="line">;;</div><div class="line">  stop)</div><div class="line">        stop</div><div class="line">        ;;</div><div class="line">  status)</div><div class="line">        status -p <span class="variable">$PID_FILE</span> <span class="variable">$DAEMON</span></div><div class="line">        RETVAL=$?</div><div class="line">        ;;</div><div class="line">  restart)</div><div class="line">        stop</div><div class="line">        start</div><div class="line">        ;;</div><div class="line">  reload)</div><div class="line">reload</div><div class="line">;;</div><div class="line">  *)</div><div class="line"><span class="comment"># Invalid Arguments, print the following message.</span></div><div class="line">        <span class="built_in">echo</span> <span class="string">"Usage: <span class="variable">$0</span> &#123;start|stop|status|restart&#125;"</span> &gt;&amp;2</div><div class="line"><span class="built_in">exit</span> 2</div><div class="line">        ;;</div><div class="line"><span class="keyword">esac</span></div><div class="line"></div><div class="line"></div><div class="line">ä¿®æ”¹å¯åŠ¨æƒé™</div><div class="line">chmod +x /etc/rc.d/init.d/kibana</div></pre></td></tr></table></figure>
<p>é…ç½®Kibanaï¼š</p>
<h3 id="ç¼–è¾‘kibana-yaml-ä¿®æ”¹ç«¯å£ï¼Œè®¾ç½®host-å¯ä»¥è®¾ç½®æœ¬åœ°æœåŠ¡å™¨IP"><a href="#ç¼–è¾‘kibana-yaml-ä¿®æ”¹ç«¯å£ï¼Œè®¾ç½®host-å¯ä»¥è®¾ç½®æœ¬åœ°æœåŠ¡å™¨IP" class="headerlink" title="ç¼–è¾‘kibana.yaml  ä¿®æ”¹ç«¯å£ï¼Œè®¾ç½®host å¯ä»¥è®¾ç½®æœ¬åœ°æœåŠ¡å™¨IP"></a>ç¼–è¾‘kibana.yaml  ä¿®æ”¹ç«¯å£ï¼Œè®¾ç½®host å¯ä»¥è®¾ç½®æœ¬åœ°æœåŠ¡å™¨IP</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line">vim /usr/<span class="built_in">local</span>/kibana/config/kibana.yml</div><div class="line"></div><div class="line"><span class="comment"># Kibana is served by a back end server. This controls which port to use.</span></div><div class="line">server.port: 5601</div><div class="line"></div><div class="line"><span class="comment"># The host to bind the server to.</span></div><div class="line">server.host: <span class="string">"10.47.88.188"</span></div><div class="line"></div><div class="line"><span class="comment"># If you are running kibana behind a proxy, and want to mount it at a path,</span></div><div class="line"><span class="comment"># specify that path here. The basePath can't end in a slash.</span></div><div class="line"><span class="comment"># server.basePath: ""</span></div><div class="line"></div><div class="line"><span class="comment"># The maximum payload size in bytes on incoming server requests.</span></div><div class="line"><span class="comment"># server.maxPayloadBytes: 1048576</span></div><div class="line"></div><div class="line"><span class="comment"># The Elasticsearch instance to use for all your queries.</span></div><div class="line">elasticsearch.url: <span class="string">"http://10.47.88.188:9200"</span></div><div class="line"></div><div class="line"><span class="comment"># preserve_elasticsearch_host true will send the hostname specified in `elasticsearch`. If you set it to false,</span></div><div class="line"><span class="comment"># then the host you use to connect to *this* Kibana instance will be sent.</span></div><div class="line"></div><div class="line">elasticsearch.preserveHost: <span class="literal">true</span></div><div class="line"></div><div class="line"><span class="comment"># Kibana uses an index in Elasticsearch to store saved searches, visualizations</span></div><div class="line"><span class="comment"># and dashboards. It will create a new index if it doesn't already exist.</span></div><div class="line"><span class="comment"># kibana.index: ".kibana"</span></div><div class="line"></div><div class="line"><span class="comment"># The default application to load.</span></div><div class="line">kibana.defaultAppId: <span class="string">"discover"</span></div><div class="line"></div><div class="line"><span class="comment"># If your Elasticsearch is protected with basic auth, these are the user credentials</span></div><div class="line"><span class="comment"># used by the Kibana server to perform maintenance on the kibana_index at startup. Your Kibana</span></div><div class="line"><span class="comment"># users will still need to authenticate with Elasticsearch (which is proxied through</span></div><div class="line"><span class="comment"># the Kibana server)</span></div><div class="line"></div><div class="line"><span class="comment"># elasticsearch.ssl.key: /path/to/your/client.key</span></div><div class="line"></div><div class="line"><span class="comment"># If you need to provide a CA certificate for your Elasticsearch instance, put</span></div><div class="line"><span class="comment"># the path of the pem file here.</span></div><div class="line"><span class="comment"># elasticsearch.ssl.ca: /path/to/your/CA.pem</span></div><div class="line"></div><div class="line"><span class="comment"># Set to false to have a complete disregard for the validity of the SSL</span></div><div class="line"><span class="comment"># certificate.</span></div><div class="line"><span class="comment"># elasticsearch.ssl.verify: true</span></div><div class="line"></div><div class="line"><span class="comment"># Time in milliseconds to wait for elasticsearch to respond to pings, defaults to</span></div><div class="line"><span class="comment"># request_timeout setting</span></div><div class="line"><span class="comment"># elasticsearch.pingTimeout: 1500</span></div><div class="line"></div><div class="line"><span class="comment"># Time in milliseconds to wait for responses from the back end or elasticsearch.</span></div><div class="line"><span class="comment"># This must be &gt; 0</span></div><div class="line"></div><div class="line">elasticsearch.requestTimeout: 30000</div><div class="line"></div><div class="line"><span class="comment"># Time in milliseconds for Elasticsearch to wait for responses from shards.</span></div><div class="line"><span class="comment"># Set to 0 to disable.</span></div><div class="line"><span class="comment"># elasticsearch.shardTimeout: 0</span></div></pre></td></tr></table></figure>
<h3 id="å¯åŠ¨kibanaæœåŠ¡"><a href="#å¯åŠ¨kibanaæœåŠ¡" class="headerlink" title="å¯åŠ¨kibanaæœåŠ¡"></a>å¯åŠ¨kibanaæœåŠ¡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">service kibana start</div><div class="line">service kibana status</div></pre></td></tr></table></figure>
<h3 id="æŸ¥çœ‹ç«¯å£"><a href="#æŸ¥çœ‹ç«¯å£" class="headerlink" title="æŸ¥çœ‹ç«¯å£"></a>æŸ¥çœ‹ç«¯å£</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">netstat -nltp</div><div class="line">[root@es_02 config]<span class="comment"># netstat -nltp</span></div><div class="line">Active Internet connections (only servers)</div><div class="line">Proto Recv-Q Send-Q Local Address               Foreign Address             State       PID/Program name</div><div class="line">tcp        0      0 127.0.0.1:32000             0.0.0.0:*                   LISTEN      2517/java</div><div class="line">tcp        0      0 10.47.88.188:5601           0.0.0.0:*                   LISTEN      6474/node</div><div class="line">tcp        0      0 10.47.88.188:10050          0.0.0.0:*                   LISTEN      305/zabbix_agentd</div><div class="line">tcp        0      0 10.47.88.188:9200           0.0.0.0:*                   LISTEN      5198/java</div><div class="line">tcp        0      0 10.47.88.188:9300           0.0.0.0:*                   LISTEN      5198/java</div><div class="line">tcp        0      0 0.0.0.0:22                  0.0.0.0:*                   LISTEN      25265/sshd</div></pre></td></tr></table></figure>
<p>åˆ°æˆ‘Githubä¸Šé¢ä¸‹è½½kabanaå¯åŠ¨è„šæœ¬ã€‚</p>
<p>es_01æœºå™¨ä»es_02æœºå™¨æ‹·è´è¿‡å»ä¿®æ”¹ä¸‹é…ç½®å°±å¯ä»¥ã€‚ </p>
<h3 id="kibanaå®‰è£…æ’ä»¶å‚è€ƒï¼š"><a href="#kibanaå®‰è£…æ’ä»¶å‚è€ƒï¼š" class="headerlink" title="kibanaå®‰è£…æ’ä»¶å‚è€ƒï¼š"></a>kibanaå®‰è£…æ’ä»¶å‚è€ƒï¼š</h3><p><a href="https://www.elastic.co/guide/en/marvel/current/installing-marvel.html#installing-marvel" target="_blank" rel="external">Installing Marvel</a></p>
<p>è¿™é‡Œkibanaæˆ‘åšäº†nginxåå‘ä»£ç†ï¼Œé›†ç¾¤ä»£ç†ã€‚</p>
<h3 id="nginxé…ç½®kibanaåå‘ä»£ç†ï¼š"><a href="#nginxé…ç½®kibanaåå‘ä»£ç†ï¼š" class="headerlink" title="nginxé…ç½®kibanaåå‘ä»£ç†ï¼š"></a>nginxé…ç½®kibanaåå‘ä»£ç†ï¼š</h3><p>è¿™é‡Œæˆ‘åªå…è®¸æˆ‘å…¬å¸IPè®¿é—®ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">  upstream kibana.ihaozhuo.com &#123;</div><div class="line">        server 10.47.88.206:5601 weight=1;</div><div class="line">        server 10.47.88.188:5601 weight=1;</div><div class="line">&#125;</div><div class="line">  server &#123;</div><div class="line">        listen       80;</div><div class="line">        server_name  kibana.ihaozhuo.com;</div><div class="line">        location / &#123;</div><div class="line">             index        index.html index.php index.jsp index.htm;</div><div class="line">             allow 202.107.202.82/32;</div><div class="line">             deny all;</div><div class="line">             proxy_pass           http://kibana.ihaozhuo.com;</div><div class="line">             proxy_ignore_client_abort on;</div><div class="line">             proxy_redirect               off;</div><div class="line">             proxy_set_header     Host    <span class="variable">$host</span>;</div><div class="line">             proxy_set_header     X-Real-IP       <span class="variable">$remote_addr</span>;</div><div class="line">             proxy_set_header     X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</div><div class="line">             &#125;</div><div class="line">      &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="KafKaé›†ç¾¤æ­å»º"><a href="#KafKaé›†ç¾¤æ­å»º" class="headerlink" title="KafKaé›†ç¾¤æ­å»º"></a>KafKaé›†ç¾¤æ­å»º</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ä¸‹è½½åœ°å€ï¼šhttp://mirrors.hust.edu.cn/apache/kafka/0.9.0.0/kafka_2.10-0.9.0.0.tgz</div><div class="line">[root@kafka_01 srv]<span class="comment"># tar -xvf kafka_2.10-0.9.0.0.tgz</span></div><div class="line">[root@kafka_01 srv]<span class="comment"># mv kafka_2.10-0.9.0.0 kafka</span></div></pre></td></tr></table></figure>
<p><em>ä¿®æ”¹kafkaé…ç½®æ–‡ä»¶</em> </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">[root@kafka_01 config]<span class="comment"># vim /srv/kafka/config/server.properties</span></div><div class="line"></div><div class="line"><span class="comment">#è®¾ç½®brokeridï¼ˆä»0å¼€å§‹ï¼Œ3ä¸ªèŠ‚ç‚¹åˆ†åˆ«è®¾ä¸º0,1,2ï¼Œä¸èƒ½é‡å¤ï¼‰åœ¨è¿™é‡Œid=0è·Ÿzookeeper idè®¾ç½®ä¸€æ ·å°±è¡Œã€‚ é›†ç¾¤æœºå™¨ï¼šæŒ‰é¡ºåºå†™1</span></div><div class="line">broker.id=0  </div><div class="line"></div><div class="line"><span class="comment">#è®¾ç½®dataç›®å½•ï¼Œæœ€å¥½ä¸è¦ç”¨é»˜è®¤çš„/tmp/kafka-logs</span></div><div class="line">mkdir -p /srv/kafka/data/kafka-logs</div><div class="line"> </div><div class="line"></div><div class="line"><span class="comment">#ä¿®æ”¹æœ¬åœ°IPåœ°å€ï¼š</span></div><div class="line">listeners=PLAINTEXT://10.46.72.172:9092</div><div class="line"> </div><div class="line">log.dirs=/srv/kafka/data/kafka-logs</div><div class="line"><span class="comment">#è®¾ç½®æ³¨å†Œåœ°å€ï¼ˆé‡è¦ï¼Œé»˜è®¤ä¼šæŠŠæœ¬æœºçš„hostanmeæ³¨å†Œåˆ°zkä¸­ï¼Œå®¢æˆ·ç«¯è¿æ¥æ—¶éœ€è¦è§£æè¯¥hostanmeï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥æ³¨å†Œæœ¬æœºçš„IPåœ°å€ï¼Œé¿å…hostnameè§£æå¤±è´¥ï¼ŒæŠ¥é”™java.nio.channels.UnresolvedAddressExceptionæˆ–java.io.IOException: Can not resolve addressï¼‰</span></div><div class="line"><span class="comment">#è®¾ç½®zookeeperåœ°å€</span></div><div class="line">zookeeper.connect=10.46.72.172:2181,10.47.88.103:2181,10.47.102.137:2181</div></pre></td></tr></table></figure>
<p><em>é…ç½®zookeeperåœ°å€</em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">vim zookeeper.properties </div><div class="line">dataDir=/home/jollybi/tools/zookeeper-3.4.5/tmp</div><div class="line"><span class="comment"># the port at which the clients will connect</span></div><div class="line">clientPort=2281</div><div class="line"><span class="comment"># disable the per-ip limit on the number of connections since this is a non-production config</span></div><div class="line">maxClientCnxns=0</div><div class="line">~</div></pre></td></tr></table></figure>
<p><em>é…ç½®kafkaè®¿é—®åœ°å€</em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">vim producer.properties </div><div class="line">metadata.broker.list=169.44.62.139:9292,169.44.59.138:9292,169.44.62.137:9292   </div><div class="line"><span class="comment"># name of the partitioner class for partitioning events; default partition spreads data randomly</span></div><div class="line"><span class="comment">#partitioner.class=</span></div><div class="line"></div><div class="line"><span class="comment"># specifies whether the messages are sent asynchronously (async) or synchronously (sync)</span></div><div class="line">producer.type=sync</div><div class="line"></div><div class="line"><span class="comment"># specify the compression codec for all data generated: none, gzip, snappy, lz4.</span></div><div class="line"><span class="comment"># the old config values work as well: 0, 1, 2, 3 for none, gzip, snappy, lz4, respectively</span></div><div class="line">compression.codec=none</div><div class="line"></div><div class="line"><span class="comment"># message encoder</span></div><div class="line">serializer.class=kafka.serializer.DefaultEncoder</div></pre></td></tr></table></figure>
<h3 id="Kafkaå¸¸ç”¨å‘½ä»¤-æ™®åŠ"><a href="#Kafkaå¸¸ç”¨å‘½ä»¤-æ™®åŠ" class="headerlink" title="Kafkaå¸¸ç”¨å‘½ä»¤(æ™®åŠ)"></a>Kafkaå¸¸ç”¨å‘½ä»¤(æ™®åŠ)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">Kafkaå¸¸ç”¨å‘½ä»¤</div><div class="line">ä»¥ä¸‹æ˜¯kafkaå¸¸ç”¨å‘½ä»¤è¡Œæ€»ç»“ï¼š  </div><div class="line">1.æŸ¥çœ‹topicçš„è¯¦ç»†ä¿¡æ¯  </div><div class="line">./kafka-topics.sh -zookeeper 127.0.0.1:2181 -describe -topic <span class="built_in">test</span>KJ1  </div><div class="line">2ã€ä¸ºtopicå¢åŠ å‰¯æœ¬  </div><div class="line">./kafka-reassign-partitions.sh -zookeeper 127.0.0.1:2181 -reassignment-json-file json/partitions-to-move.json -execute  </div><div class="line">3ã€åˆ›å»ºtopic </div><div class="line">./kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic <span class="built_in">test</span>KJ1  </div><div class="line">4ã€ä¸ºtopicå¢åŠ partition  </div><div class="line">./bin/kafka-topics.sh â€“zookeeper 127.0.0.1:2181 â€“alter â€“partitions 20 â€“topic <span class="built_in">test</span>KJ1  </div><div class="line">5ã€kafkaç”Ÿäº§è€…å®¢æˆ·ç«¯å‘½ä»¤  </div><div class="line">./kafka-console-producer.sh --broker-list localhost:9092 --topic <span class="built_in">test</span>KJ1  </div><div class="line">6ã€kafkaæ¶ˆè´¹è€…å®¢æˆ·ç«¯å‘½ä»¤  </div><div class="line">./kafka-console-consumer.sh -zookeeper localhost:2181 --from-beginning --topic <span class="built_in">test</span>KJ1  </div><div class="line">7ã€kafkaæœåŠ¡å¯åŠ¨  </div><div class="line">./kafka-server-start.sh -daemon ../config/server.properties   </div><div class="line">8ã€ä¸‹çº¿broker  </div><div class="line">./kafka-run-class.sh kafka.admin.ShutdownBroker --zookeeper 127.0.0.1:2181 --broker <span class="comment">#brokerId# --num.retries 3 --retry.interval.ms 60  </span></div><div class="line">shutdown broker  </div><div class="line">9ã€åˆ é™¤topic  </div><div class="line">./kafka-run-class.sh kafka.admin.DeleteTopicCommand --topic <span class="built_in">test</span>KJ1 --zookeeper 127.0.0.1:2181  </div><div class="line">./kafka-topics.sh --zookeeper localhost:2181 --delete --topic <span class="built_in">test</span>KJ1  </div><div class="line">10ã€æŸ¥çœ‹consumerç»„å†…æ¶ˆè´¹çš„offset  </div><div class="line">./kafka-run-class.sh kafka.tools.ConsumerOffsetChecker --zookeeper localhost:2181 --group <span class="built_in">test</span> --topic <span class="built_in">test</span>KJ1</div></pre></td></tr></table></figure>
<h3 id="Kafkaç¾¤é›†æ–°å»ºä¸€ä¸ªTopic"><a href="#Kafkaç¾¤é›†æ–°å»ºä¸€ä¸ªTopic" class="headerlink" title="Kafkaç¾¤é›†æ–°å»ºä¸€ä¸ªTopic"></a>Kafkaç¾¤é›†æ–°å»ºä¸€ä¸ªTopic</h3><p>å«åšlogstash  Topic</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#æŸ¥çœ‹tocpicåˆ—è¡¨ï¼ˆ--zookeeperæŒ‡å®šä»»æ„ä¸€ä¸ªzkèŠ‚ç‚¹å³å¯ï¼Œç”¨äºè·å–é›†ç¾¤ä¿¡æ¯ï¼‰</span></div><div class="line">/usr/<span class="built_in">local</span>/kafka/bin/kafka-topics.sh --zookeeper zk1.yazuoyw.com:2181 --describe</div><div class="line"> </div><div class="line"><span class="comment">#åˆ›å»ºtopicï¼ˆ--replication-factorè¡¨ç¤ºå¤åˆ¶åˆ°å¤šå°‘ä¸ªèŠ‚ç‚¹ï¼Œ--partitionsè¡¨ç¤ºåˆ†åŒºæ•°ï¼Œä¸€èˆ¬éƒ½è®¾ç½®ä¸º2æˆ–ä¸èŠ‚ç‚¹æ•°ç›¸ç­‰ï¼Œä¸èƒ½å¤§äºæ€»èŠ‚ç‚¹æ•°ï¼‰</span></div><div class="line">/usr/<span class="built_in">local</span>/kafka/bin/kafka-topics.sh --zookeeper zk1.yazuoyw.com:2181 --create --topic topic1 --replication-factor 2 --partitions 2</div><div class="line"> </div><div class="line"><span class="comment">#å‘é€æ¶ˆæ¯ï¼ˆ--topic æŒ‡å®štopicï¼‰</span></div><div class="line">/usr/<span class="built_in">local</span>/kafka/bin/kafka-console-producer.sh --broker-list kafka1.yazuoyw.com:9092,kafka2.yazuoyw.com:9092,kafka3.yazuoyw.com:9092 --topic topic1</div><div class="line">message1</div><div class="line">message2</div><div class="line"> </div><div class="line"><span class="comment">#æ¶ˆè´¹æ¶ˆæ¯</span></div><div class="line">/usr/<span class="built_in">local</span>/kafka/bin/kafka-console-consumer.sh --zookeeper zk1.yazuoyw.com:2181 --topic topic1</div><div class="line"></div><div class="line"><span class="comment">#replicaæ£€æŸ¥</span></div><div class="line">/usr/<span class="built_in">local</span>/kafka/bin/kafka-replica-verification.sh --broker-list kafka1.yazuoyw.com:9092,kafka2.yazuoyw.com:9092,kafka3.yazuoyw.com:9092</div></pre></td></tr></table></figure>
<p>æ¯æ¡å‘å¸ƒåˆ°Kafkaé›†ç¾¤çš„æ¶ˆæ¯éƒ½æœ‰ä¸€ä¸ªç±»åˆ«ï¼Œè¿™ä¸ªç±»åˆ«è¢«ç§°ä¸ºtopicã€‚ï¼ˆç‰©ç†ä¸Šä¸åŒtopicçš„æ¶ˆæ¯åˆ†å¼€å­˜å‚¨ï¼Œé€»è¾‘ä¸Šä¸€ä¸ªtopicçš„æ¶ˆæ¯è™½ç„¶ä¿å­˜äºä¸€ä¸ªæˆ–å¤šä¸ªbrokerä¸Šä½†ç”¨æˆ·åªéœ€æŒ‡å®šæ¶ˆæ¯çš„topicå³å¯ç”Ÿäº§æˆ–æ¶ˆè´¹æ•°æ®è€Œä¸å¿…å…³å¿ƒæ•°æ®å­˜äºä½•å¤„ï¼‰</p>
<p><code>ElasticSearch</code>æœºå™¨<code>logstash</code>æŠŠæ•°æ®ä»<code>kafka</code>å­˜åˆ°<code>elasticsearch</code>çš„é…ç½®</p>
<p>å…¶ä¸­é€‰å–kafkaç¾¤é›†ä»»æ„ä¸€ä¸ªæœ‰zkçš„ipåšè¿æ¥ä½¿ç”¨</p>
<p><code>topic_id</code>å°±æ˜¯kafkaä¸­è®¾ç½®çš„<code>topic logstash</code></p>
<p>åœ¨esä¸Šé¢å®‰è£…logstashé…ç½®<br>/usr/local/logstash/config/kafka_to_es.conf</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"> input &#123;</div><div class="line">    kafka &#123;</div><div class="line">                zk_connect =&gt; <span class="string">"10.46.72.172:2181,10.47.88.103:2181,10.47.102.137:2181/kafka"</span></div><div class="line">                group_id =&gt; <span class="string">"logstash"</span></div><div class="line">                topic_id =&gt; <span class="string">"logstash"</span></div><div class="line">                reset_beginning =&gt; <span class="literal">false</span> <span class="comment"># boolean (optional)ï¼Œ default: false</span></div><div class="line">                consumer_threads =&gt; 2  <span class="comment"># number (optional)ï¼Œ default: 1</span></div><div class="line">                decorate_events =&gt; <span class="literal">false</span> <span class="comment"># boolean (optional)ï¼Œ default: false</span></div><div class="line">        &#125;</div><div class="line">  &#125;</div><div class="line">  output &#123;</div><div class="line">    elasticsearch &#123;</div><div class="line">      hosts =&gt; [<span class="string">"10.47.88.206:9200"</span>,<span class="string">"10.47.88.188:9200"</span>]</div><div class="line">      index =&gt; <span class="string">"%&#123;host&#125;-%&#123;+YYYY.MM.dd&#125;"</span></div><div class="line">&#125;</div><div class="line">   <span class="comment"># stdout &#123; codec =&gt; rubydebug &#125;</span></div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>æ–°å»ºäº†ä¸ªæµ‹è¯•çš„ï¼Œæµ‹è¯•ä¸‹å‘é€æ˜¯å¦æˆåŠŸï¼š/usr/local/logstash/config/stdin_to_es.conf </p>
<figure class="highlight puppet"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">input</span> &#123;</div><div class="line"> stdin &#123;&#125;</div><div class="line">&#125;</div><div class="line">  <span class="keyword">output</span> &#123;</div><div class="line">    elasticsearch &#123;</div><div class="line">      <span class="attr">hosts</span> =&gt; <span class="string">"10.47.88.206"</span>&#125;</div><div class="line">    <span class="keyword">stdout</span> &#123;</div><div class="line">      <span class="attr">codec</span> =&gt; rubydebug &#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<h3 id="Step-2-å¯åŠ¨æœåŠ¡"><a href="#Step-2-å¯åŠ¨æœåŠ¡" class="headerlink" title="Step 2: å¯åŠ¨æœåŠ¡"></a>Step 2: å¯åŠ¨æœåŠ¡</h3><figure class="highlight dts"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">Kafkaç”¨åˆ°äº†Zookeeperï¼Œæ‰€æœ‰é¦–å…ˆå¯åŠ¨Zookperï¼Œä¸‹é¢ç®€å•çš„å¯ç”¨ä¸€ä¸ªå•å®ä¾‹çš„ZookkeeperæœåŠ¡ã€‚å¯ä»¥åœ¨å‘½ä»¤çš„ç»“å°¾åŠ ä¸ª&amp;ç¬¦å·ï¼Œè¿™æ ·å°±å¯ä»¥å¯åŠ¨åç¦»å¼€æ§åˆ¶å°ã€‚</div><div class="line"></div><div class="line"><span class="meta">#ç°åœ¨å¯åŠ¨Kafka:</span></div><div class="line"></div><div class="line"><span class="meta-keyword">/srv/</span>kafka<span class="meta-keyword">/bin/</span>kafka-server-start.sh -daemon config/server.properties</div><div class="line"></div><div class="line"><span class="meta">#æ·»åŠ å¼€æœºå¯åŠ¨</span></div><div class="line">echo â€˜</div><div class="line"><span class="meta"># start kafka</span></div><div class="line"><span class="meta-keyword">/usr/</span>local<span class="meta-keyword">/kafka/</span>bin/kafka-server-start.sh -daemon <span class="meta-keyword">/usr/</span>local<span class="meta-keyword">/kafka/</span>config/server.properties</div><div class="line">â€˜ &gt;&gt; <span class="meta-keyword">/etc/</span>rc.local</div><div class="line"> </div><div class="line"><span class="meta">#å…³é—­</span></div><div class="line"><span class="meta-keyword">/usr/</span>local<span class="meta-keyword">/kafka/</span>bin/kafka-server-stop.sh</div></pre></td></tr></table></figure>
<h3 id="kafkaé…ç½®é˜²ç«å¢™ï¼š"><a href="#kafkaé…ç½®é˜²ç«å¢™ï¼š" class="headerlink" title="kafkaé…ç½®é˜²ç«å¢™ï¼š"></a>kafkaé…ç½®é˜²ç«å¢™ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">-A INPUT -i eth0 -p tcp -m state --state NEW -m tcp --dport 4888 -j ACCEPT</div></pre></td></tr></table></figure>
<h3 id="zookeeperé›†ç¾¤"><a href="#zookeeperé›†ç¾¤" class="headerlink" title="zookeeperé›†ç¾¤"></a>zookeeperé›†ç¾¤</h3><p>æŸ¥çœ‹æˆ‘ä¹‹å‰å†™çš„è¿™ç¯‡æ–‡æ¡£ <a href="http://blog.yangcvo.me/2016/05/28/%E5%A4%A7%E6%95%B0%E6%8D%AEhadoop/zookeeper/ZooKeeper%E9%9B%86%E7%BE%A4%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E4%B8%8E%E4%BC%98%E5%8C%96/" target="_blank" rel="external">ZooKeeperçš„é›†ç¾¤å¿«é€Ÿæ­å»ºä¸ä¼˜åŒ–</a> </p>
<h3 id="èµ°kafkaæŸ¥çœ‹æ˜¯å¦æ‰€æœ‰èŠ‚ç‚¹éƒ½å¯åŠ¨ï¼š"><a href="#èµ°kafkaæŸ¥çœ‹æ˜¯å¦æ‰€æœ‰èŠ‚ç‚¹éƒ½å¯åŠ¨ï¼š" class="headerlink" title="èµ°kafkaæŸ¥çœ‹æ˜¯å¦æ‰€æœ‰èŠ‚ç‚¹éƒ½å¯åŠ¨ï¼š"></a>èµ°kafkaæŸ¥çœ‹æ˜¯å¦æ‰€æœ‰èŠ‚ç‚¹éƒ½å¯åŠ¨ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[root@kafka_03 bin]<span class="comment"># sh zkCli.sh</span></div><div class="line">Connecting to localhost:2181</div><div class="line">2017-01-04 19:20:24,849 [myid:] - INFO  [main:Environment@100] - Client environment:zookeeper.version=3.4.6-1569965, built on 02/20/2014 09:09 GMT</div><div class="line">2017-01-04 19:20:24,853 [myid:] - INFO  [main:Environment@100] - Client environment:host.name=kafka_03</div><div class="line">2017-01-04 19:20:24,853 [myid:] - INFO  [main:Environment@100] - Client environment:java.version=1.8.0_66</div><div class="line">2017-01-04 19:20:24,856 [myid:] - INFO  [main:Environment@100] - Client environment:java.vendor=Oracle Corporation</div><div class="line">2017-01-04 19:20:24,856 [myid:] - INFO  [main:Environment@100] - Client environment:java.home=/srv/jdk1.8.0_66/jre</div><div class="line">2017-01-04 19:20:24,856 [myid:] - INFO  [main:Environment@100] - Client environment:java.class.path=/srv/zookeeper-3.4.6/bin/../build/classes:/srv/zookeeper-3.4.6/bin/../build/lib/*.jar:/srv/zookeeper-3.4.6/bin/../lib/slf4j-log4j12-1.6.1.jar:/srv/zookeeper-3.4.6/bin/../lib/slf4j-api-1.6.1.jar:/srv/zookeeper-3.4.6/bin/../lib/netty-3.7.0.Final.jar:/srv/zookeeper-3.4.6/bin/../lib/<span class="built_in">log</span>4j-1.2.16.jar:/srv/zookeeper-3.4.6/bin/../lib/jline-0.9.94.jar:/srv/zookeeper-3.4.6/bin/../zookeeper-3.4.6.jar:/srv/zookeeper-3.4.6/bin/../src/java/lib/*.jar:/srv/zookeeper-3.4.6/bin/../conf:</div><div class="line">2017-01-04 19:20:24,856 [myid:] - INFO  [main:Environment@100] - Client environment:java.library.path=/usr/java/packages/lib/amd64:/usr/lib64:/lib64:/lib:/usr/lib</div><div class="line"></div><div class="line">[zk: localhost:2181(CONNECTED) 0] ls /</div><div class="line">[controller_epoch, brokers, zookeeper, kafka, dubbo, admin, isr_change_notification, consumers, config, sthp]</div><div class="line">[zk: localhost:2181(CONNECTED) 5] ls /kafka/brokers/ids</div><div class="line">[0, 1, 2]</div></pre></td></tr></table></figure>
<p>kafka ä¸‰å°é›†ç¾¤è¿™é‡Œå¯ä»¥çœ‹åˆ°è·å–åˆ°idsã€‚</p>
<h4 id="å®‰å…¨é—®é¢˜"><a href="#å®‰å…¨é—®é¢˜" class="headerlink" title="å®‰å…¨é—®é¢˜"></a>å®‰å…¨é—®é¢˜</h4><p>ç‰¹åˆ«è¦æ³¨æ„elkæ‰€æœ‰è½¯ä»¶çš„ç«¯å£ç›‘å¬,åˆ‡å‹¿æš´éœ²ç›‘å¬åˆ°å…¬ç½‘ä¸Šå»,å¦å¤–å³ä¾¿æ˜¯å†…ç½‘ä½ ä¹Ÿå¾—æ³¨æ„é…ç½®å†…ç½‘çš„è®¿é—®é™åˆ¶ã€‚</p>
<h3 id="logstash-å®¢æˆ·ç«¯å®‰è£…ï¼š"><a href="#logstash-å®¢æˆ·ç«¯å®‰è£…ï¼š" class="headerlink" title="logstash å®¢æˆ·ç«¯å®‰è£…ï¼š"></a>logstash å®¢æˆ·ç«¯å®‰è£…ï¼š</h3><h5 id="æºç å®‰è£…"><a href="#æºç å®‰è£…" class="headerlink" title="æºç å®‰è£…"></a>æºç å®‰è£…</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line">æˆ‘è¿™é‡Œæºç åŒ…å®‰è£…</div><div class="line"><span class="comment"># wget https://download.elasticsearch.org/logstash/logstash/logstash-2.4.0.tar.gz</span></div><div class="line"><span class="comment">#curl -O https://download.elastic.co/logstash/logstash/logstash-2.4.0.tar.gz</span></div><div class="line"><span class="comment">#tar -zxvf logstash-2.4.0.tar.gz</span></div><div class="line"><span class="comment">#mv logstash-2.4.0 /usr/local/</span></div><div class="line"><span class="comment">#ln -s /usr/local/logstash-2.4.0/ /usr/local/logstash</span></div><div class="line"></div><div class="line">ä¸‹è½½å¯åŠ¨è„šæœ¬</div><div class="line">ç”Ÿäº§éƒ½æ˜¯è¿è¡Œåœ¨åå°çš„ï¼Œæˆ‘è¿™é‡Œæºç å®‰è£…æ²¡æœ‰initè„šæœ¬å¯åŠ¨ã€‚ å»Githubä¸‹è½½  https://github.com/benet1006/ELK_config.git</div><div class="line"><span class="comment">#cp logstash.init /etc/init.d/logstash</span></div><div class="line"><span class="comment">#chmod +x /etc/init.d/logstash</span></div><div class="line">è¿™ä¸ªè„šæœ¬æˆ‘åšè¿‡ä¿®æ”¹ã€‚</div><div class="line"></div><div class="line"><span class="comment">#å¯åŠ¨logstashæœåŠ¡</span></div><div class="line">service logstash start</div><div class="line">service logstash status</div><div class="line"></div><div class="line"><span class="comment">#æŸ¥çœ‹5000ç«¯å£</span></div><div class="line">netstat -nltp</div><div class="line"></div><div class="line">Active Internet connections (only servers)</div><div class="line">Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name</div><div class="line">tcp 0 0 0.0.0.0:9200 0.0.0.0:* LISTEN 1765/java</div><div class="line">tcp 0 0 0.0.0.0:9300 0.0.0.0:* LISTEN 1765/java</div><div class="line">tcp 0 0 0.0.0.0:9301 0.0.0.0:* LISTEN 2309/java</div><div class="line">tcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN 1509/sshd</div><div class="line">tcp 0 0 0.0.0.0:5601 0.0.0.0:* LISTEN 1876/node</div><div class="line">tcp 0 0 0.0.0.0:5000 0.0.0.0:* LISTEN 2309/java</div><div class="line">tcp 0 0 :::22 :::* LISTEN 1509/sshd</div><div class="line"></div><div class="line"></div><div class="line">ä¿®æ”¹å¯åŠ¨è„šæœ¬</div><div class="line">vim /etc/init.d/logstash </div><div class="line">æŒ‡å®šçš„ç›®å½•è‡ªå·±æºç å®‰è£…çš„è·¯å¾„ã€‚</div><div class="line"></div><div class="line">name=logstash</div><div class="line">pidfile=<span class="string">"/var/run/<span class="variable">$name</span>.pid"</span></div><div class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$JAVA_HOME</span>/jre/lib/rt.jar:<span class="variable">$JAVA_HOME</span>/lib/dt.jar:<span class="variable">$JAVA_HOME</span>/lib/tools.jar</div><div class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin</div><div class="line">LS_USER=logstash</div><div class="line">LS_GROUP=logstash</div><div class="line">LS_HOME=/usr/<span class="built_in">local</span>/logstash å®‰è£…è·¯å¾„</div><div class="line">LS_HEAP_SIZE=<span class="string">"1000m"</span></div><div class="line">LS_JAVA_OPTS=<span class="string">"-Djava.io.tmpdir=<span class="variable">$&#123;LS_HOME&#125;</span>"</span></div><div class="line">LS_LOG_DIR=/usr/<span class="built_in">local</span>/logstash</div><div class="line">LS_LOG_FILE=<span class="string">"<span class="variable">$&#123;LS_LOG_DIR&#125;</span>/<span class="variable">$name</span>.log"</span></div><div class="line">LS_CONF_FILE=/etc/logstash.conf     æ”¶é›†æ—¥å¿—çš„è§„åˆ™conf</div><div class="line">LS_OPEN_FILES=16384</div><div class="line">LS_NICE=19</div><div class="line">LS_OPTS=<span class="string">""</span></div><div class="line"></div><div class="line">https://www.elastic.co/guide/en/logstash/current/plugins-inputs-file.html</div><div class="line">è¿™ä¸ªæ˜¯<span class="built_in">log</span> stashçš„å®˜æ–¹æ–‡æ¡£çš„é…ç½®è¯´æ˜ã€‚</div><div class="line">è¿™ä¸ªé…ç½®è¯´æ˜ä¸Šé¢æˆ‘å…ˆä¿®æ”¹ä¸‹æˆ‘ä¹‹å‰çš„é…ç½®æ–‡ä»¶ã€‚</div></pre></td></tr></table></figure>
<h4 id="logstash-agenté…ç½®ï¼š"><a href="#logstash-agenté…ç½®ï¼š" class="headerlink" title="logstash agenté…ç½®ï¼š"></a>logstash agenté…ç½®ï¼š</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">é…ç½®<span class="built_in">log</span> stashï¼å®ç°ç³»ç»Ÿæ—¥å¿—æ”¶é›†input</div><div class="line">file_to_kafka.conf æ—¥å¿—æ–‡ä»¶è¯»å‡ºå†™å…¥åˆ°kafka</div><div class="line">input &#123;</div><div class="line">file &#123;</div><div class="line">path =&gt; <span class="string">"/srv/tomcat/logs/account/logFile.*.log"</span></div><div class="line"><span class="built_in">type</span> =&gt; <span class="string">"tomcat"</span></div><div class="line">discover_interval =&gt; 15 <span class="comment">#logstash</span></div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">output &#123;</div><div class="line"><span class="comment">#stdout &#123; codec =&gt; rubydebug &#125;</span></div><div class="line">kafka&#123;</div><div class="line">bootstrap_servers =&gt; <span class="string">"10.46.72.172:9092,10.47.88.103:9092,10.47.102.137:9092"</span></div><div class="line"><span class="comment">#group_id =&gt; "logstash"</span></div><div class="line">topic_id =&gt; <span class="string">"logstash"</span></div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">2.2 logstash indexer é…ç½®</div><div class="line">kafka_to_es.conf</div><div class="line">input &#123;</div><div class="line">kafka &#123;</div><div class="line">zk_connect =&gt; <span class="string">"10.46.72.172:2181,10.47.88.103:2181,10.47.102.137:2181kafka"</span></div><div class="line">group_id =&gt; <span class="string">"logstash"</span></div><div class="line">topic_id =&gt; <span class="string">"logstash"</span></div><div class="line">reset_beginning =&gt; <span class="literal">false</span> <span class="comment"># boolean (optional)ï¼Œ default: false</span></div><div class="line">consumer_threads =&gt; 2 <span class="comment"># number (optional)ï¼Œ default: 1</span></div><div class="line">decorate_events =&gt; <span class="literal">false</span> <span class="comment"># boolean (optional)ï¼Œ default: false</span></div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">output &#123;</div><div class="line">elasticsearch &#123;</div><div class="line">hosts =&gt; [<span class="string">"10.47.88.206:9200"</span>,<span class="string">"10.47.88.188:9200"</span>]</div><div class="line">index =&gt; <span class="string">"%&#123;host&#125;-%&#123;+YYYY.MM.dd&#125;"</span></div><div class="line">&#125;</div><div class="line"><span class="comment"># stdout &#123; codec =&gt; rubydebug &#125;</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="eså®‰è£…æ’ä»¶headæŸ¥çœ‹ä¸‹æ•ˆæœï¼š"><a href="#eså®‰è£…æ’ä»¶headæŸ¥çœ‹ä¸‹æ•ˆæœï¼š" class="headerlink" title="eså®‰è£…æ’ä»¶headæŸ¥çœ‹ä¸‹æ•ˆæœï¼š"></a>eså®‰è£…æ’ä»¶headæŸ¥çœ‹ä¸‹æ•ˆæœï¼š</h4><p>ç„¶åæ‰“å¼€ç½‘ç«™ï¼š<a href="http://elk.ihaozhuo.com/_plugin/head/" target="_blank" rel="external">http://elk.ihaozhuo.com/_plugin/head/</a></p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/es_head.png" alt=""></figure></p>
<p>####kibanaç½‘ç«™æ•ˆæœï¼š</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/es_kibana.png" alt=""></figure></p>
<h3 id="äº¤æµå­¦ä¹ ï¼š"><a href="#äº¤æµå­¦ä¹ ï¼š" class="headerlink" title="äº¤æµå­¦ä¹ ï¼š"></a>äº¤æµå­¦ä¹ ï¼š</h3><p>ğŸ§  Linux shell_é«˜çº§è¿ç»´æ´¾: <code>459096184</code>    åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)<br>ğŸ§  BigData-Exchange School : <code>521621407</code>  åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥</p>
<p>ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚</p>

	

	

</article>




	<article>
	
		<h1><a href="/2016/11/14/æ—¥å¿—åˆ†æå¹³å°/Graylog/graylog å‡çº§2.1 é›†ä¸­æ—¥å¿—è§£å†³æ–¹æ¡ˆ/">graylog å‡çº§2.1 é›†ä¸­æ—¥å¿—è§£å†³æ–¹æ¡ˆ</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-11-14</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/Log-Analysis-Platform/">Log Analysis Platform</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Log-analysis-platform/">Log analysis platform</a>
			</span>
		
	</div>

	

	
		<h1 id="graylog-å‡çº§2-1-é›†ä¸­æ—¥å¿—è§£å†³æ–¹æ¡ˆ"><a href="#graylog-å‡çº§2-1-é›†ä¸­æ—¥å¿—è§£å†³æ–¹æ¡ˆ" class="headerlink" title="graylog å‡çº§2.1 é›†ä¸­æ—¥å¿—è§£å†³æ–¹æ¡ˆ"></a>graylog å‡çº§2.1 é›†ä¸­æ—¥å¿—è§£å†³æ–¹æ¡ˆ</h1><p>å‚è€ƒå®˜ç½‘ï¼š<a href="http://docs.graylog.org/en/2.1/pages/upgrade/graylog-2.1.html" target="_blank" rel="external">å‡çº§åˆ°Graylogçš„2.1.x</a></p>
<h3 id="ä¸€ï¼šä¸ºä»€ä¹ˆéœ€è¦é›†ä¸­æ—¥å¿—è§£å†³æ–¹æ¡ˆï¼Ÿ"><a href="#ä¸€ï¼šä¸ºä»€ä¹ˆéœ€è¦é›†ä¸­æ—¥å¿—è§£å†³æ–¹æ¡ˆï¼Ÿ" class="headerlink" title="ä¸€ï¼šä¸ºä»€ä¹ˆéœ€è¦é›†ä¸­æ—¥å¿—è§£å†³æ–¹æ¡ˆï¼Ÿ"></a>ä¸€ï¼šä¸ºä»€ä¹ˆéœ€è¦é›†ä¸­æ—¥å¿—è§£å†³æ–¹æ¡ˆï¼Ÿ</h3><p>åœ¨å…¬å¸æœåŠ¡æœºå­éƒ¨ç½²è¶Šæ¥è¶Šå¤šçš„æƒ…å†µä¸‹ï¼Œè®©æˆ‘ä»¬æ¥æƒ³æƒ³ä¼šé‡åˆ°çš„é—®é¢˜ï¼š</p>
<ul>
<li>å¼€å‘äººå‘˜ä¸èƒ½ç™»å½•çº¿ä¸ŠæœåŠ¡å™¨æŸ¥çœ‹è¯¦ç»†æ—¥å¿—ï¼Œç»è¿‡è¿ç»´å‘¨è½¬è´¹æ—¶è´¹åŠ›</li>
<li>æ—¥å¿—æ•°æ®åˆ†æ•£åœ¨å¤šä¸ªç³»ç»Ÿï¼Œéš¾ä»¥æŸ¥æ‰¾</li>
<li>æ—¥å¿—æ•°æ®é‡å¤§ï¼ŒæŸ¥è¯¢é€Ÿåº¦æ…¢</li>
<li>ä¸€ä¸ªè°ƒç”¨ä¼šæ¶‰åŠå¤šä¸ªç³»ç»Ÿï¼Œéš¾ä»¥åœ¨è¿™äº›ç³»ç»Ÿçš„æ—¥å¿—ä¸­å¿«é€Ÿå®šä½æ•°æ®</li>
<li>æ•°æ®ä¸å¤Ÿå®æ—¶</li>
<li>å¾ˆéš¾å¯¹æ•°æ®è¿›è¡ŒæŒ–æ˜ï¼Œåˆ†æï¼Œä¸šåŠ¡å‘Šè­¦ï¼Œå®¡è®¡</li>
<li>è¿™äº›é—®é¢˜çš„å­˜åœ¨è®©å¼€å‘ä»¥åŠè¿ç»´äººå‘˜å¾ˆæ˜¯å¤´ç—›ï¼Œä¸¥é‡å½±å“æ•ˆç‡ï¼</li>
</ul>
<h3 id="äºŒï¼šä»€ä¹ˆæ˜¯graylogæŠ€æœ¯æ ˆï¼Ÿ"><a href="#äºŒï¼šä»€ä¹ˆæ˜¯graylogæŠ€æœ¯æ ˆï¼Ÿ" class="headerlink" title="äºŒï¼šä»€ä¹ˆæ˜¯graylogæŠ€æœ¯æ ˆï¼Ÿ"></a>äºŒï¼šä»€ä¹ˆæ˜¯graylogæŠ€æœ¯æ ˆï¼Ÿ</h3><p>ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ—¥å¿—çš„é›†ä¸­ç®¡ç†æ–¹æ¡ˆï¼ŒgraylogæŠ€æœ¯æ ˆï¼š</p>
<ul>
<li>java ï¼ˆjdk1.8.0_66/ï¼‰ç¯å¢ƒ</li>
<li>Collector-sidecarï¼ˆæ”¶é›†æ—¥å¿—ï¼‰æˆ–è€…syslog</li>
<li>Mongodbï¼ˆå­˜å‚¨æ—¥å¿—æºæ–‡ä»¶ï¼‰</li>
<li>Elasticsearchï¼ˆæä¾›æœç´¢æ—¥å¿—ï¼‰</li>
<li>Graylog2.1.1ï¼ˆæœç´¢å’Œè§†å›¾å±•ç¤ºæ—¥å¿—ï¼Œå‘Šè­¦å’Œæƒé™ï¼‰</li>
</ul>
<p>æœ‰äº†è¿™äº›ï¼Œæˆ‘ä»¬å°±èƒ½æŠŠæ—¥å¿—å…ˆæ”¶é›†èµ·æ¥ï¼Œè¿›è¡Œæˆ‘ä»¬æƒ³è¦çš„åˆ†æä¹‹åï¼Œwebçš„å½¢å¼å±•ç¤ºå‡ºæ¥ï¼Œæä¾›æŸ¥è¯¢ï¼</p>
<h3 id="ä¸‰ï¼šgraylogçš„å®‰è£…éƒ¨ç½²"><a href="#ä¸‰ï¼šgraylogçš„å®‰è£…éƒ¨ç½²" class="headerlink" title="ä¸‰ï¼šgraylogçš„å®‰è£…éƒ¨ç½²"></a>ä¸‰ï¼šgraylogçš„å®‰è£…éƒ¨ç½²</h3><p>å®‰è£…ç¯å¢ƒï¼šlinux centOSç³»ç»Ÿå®‰è£…ï¼Œå·²å®‰è£…JDK1.8ç‰ˆæœ¬ï¼Œå®‰è£…å¯åŠ¨é¡ºåº</p>
<p>1.å®‰è£…éƒ¨ç½²mongodb<br>2.å®‰è£…éƒ¨ç½²elasticsearch<br>3.å®‰è£…éƒ¨ç½²graylog<br>4.å®‰è£…éƒ¨ç½²Graylog Collector Sidecar</p>
<hr>
<p> <strong>1ï¼šå®‰è£…éƒ¨ç½²mongodb</strong> <strong>Javaä¹Ÿå®‰è£…</strong>  å‚è€ƒæˆ‘åšæ–‡æœ‰ä»‹ç»ã€‚ </p>
<p> <strong>2ï¼šå®‰è£…éƒ¨ç½²elasticsearch</strong></p>
<p><strong>(1)ä¸‹è½½jaråŒ…</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">wget https://download.elastic.co/elasticsearch/release/org/elasticsearch/distribution/tar/elasticsearch/2.3.5/elasticsearch-2.3.5.tar.gz</div><div class="line"></div><div class="line">å¦‚æœæŠ¥é”™</div><div class="line">æ‰§è¡Œ</div><div class="line"></div><div class="line">wget --no-check-certificate</div><div class="line"></div><div class="line">https://download.elastic.co/elasticsearch/release/org/elasticsearch/distribution/tar/elasticsearch/2.3.5/elasticsearch-2.3.5.tar.gz</div></pre></td></tr></table></figure>
<p><strong>(2)è§£å‹jaråŒ…</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tar -zxvf elasticsearch-2.3.5.tar.gz -C /opt/</div></pre></td></tr></table></figure>
<p><strong>(3)ä¿®æ”¹elasticsearch.ymlé…ç½®æ–‡ä»¶</strong></p>
<p> è¿™é‡Œéœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼šé…ç½®å‰å…ˆåˆ›å»ºå‡ ä¸ªç›®å½•æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mkdir /home/data/es-data -p</div><div class="line">mkdir /home/data/es-work -p</div></pre></td></tr></table></figure>
<p>elasticsearch-2.3.5å®‰è£…ç›®å½•confä¸‹æ‰§è¡Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">vim elasticsearch-2.3.5/config/elasticsearch.yml</div><div class="line"> </div><div class="line">cluster.name: graylog              <span class="comment">#é›†ç¾¤åç§°å»ºè®®å‘½ågraylogï¼Œä¾¿äºè¯†åˆ«åŒºåˆ†</span></div><div class="line">node.name: elasticsearch-node-1     <span class="comment"># elasticsearché›†ç¾¤èŠ‚ç‚¹åç§°</span></div><div class="line">network.host: 192.168.1.234    <span class="comment"># ç»‘å®šèŠ‚ç‚¹IP</span></div><div class="line">http.port: 9200         <span class="comment"># å¤–éƒ¨è®¿é—®ç«¯å£ï¼Œé»˜è®¤ï¼Œä¹Ÿå¯ä»¥å®‰å…¨è€ƒè™‘ä¿®æ”¹</span></div><div class="line">path.logs: /home/data/logs</div><div class="line">path.data: /home/data/es-data</div><div class="line">discovery.zen.ping.multicast.enabled: <span class="literal">false</span>   <span class="comment">#å¤šæ’­å‘ç°æ–¹å¼å…³é—­ï¼Œå› ä¸ºgraylogé‡‡ç”¨å•æ’­æ–¹å¼å‘ç°elasticsearché›†ç¾¤æ–¹å¼</span></div><div class="line">discovery.zen.ping.unicast.hosts                   <span class="comment">#å¤šä¸ªèŠ‚ç‚¹ç”¨é€—å·éš”å¼€</span></div><div class="line">discovery.zen.minimum_master_nodes: 3    <span class="comment"># elasticsearché›†ç¾¤èŠ‚ç‚¹ï¼Œæœ€å°‘é€‰ä¸¾æ•°ï¼Œè¿™ä¸ªæ•°ä¸€å®šè¦è®¾ç½®ä¸ºæ•´ä¸ªé›†ç¾¤èŠ‚ç‚¹ä¸ªæ•°çš„ä¸€åŠåŠ 1ï¼Œå³N/2+1ï¼Œå¿…é¡»ä¸ºå¥‡æ•°</span></div></pre></td></tr></table></figure>
<p><strong>(4)å¯åŠ¨elasticsearchæœåŠ¡</strong></p>
<p>æ–°å»ºä¸€ä¸ªelasticsearchç”¨æˆ·ï¼Œå‡ºäºå®‰å…¨è€ƒè™‘ï¼ŒelasticsearchæœåŠ¡ä¸èƒ½ä½¿ç”¨rootç”¨æˆ·å¯åŠ¨</p>
<p>åˆ›å»ºelasticsearchç”¨æˆ·ç»„åŠelasticsearchç”¨æˆ·ï¼Œæ‰§è¡Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">groupadd elasticsearch</div><div class="line">useradd elasticsearch -g elasticsearch -p elasticsearch</div></pre></td></tr></table></figure>
<p>å…¶ä¸­-gä½¿ç”¨æˆ·å±äºæŸä¸ªç»„ï¼Œ-pä¸ºæ–°ç”¨æˆ·ä½¿ç”¨åŠ å¯†å¯†ç ï¼‰<br>æ›´æ”¹elasticsearch-2.3.5æ–‡ä»¶å¤¹åŠå†…éƒ¨æ–‡ä»¶çš„æ‰€å±ç”¨æˆ·åŠç»„ä¸ºelasticsearch:elasticsearch</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">chown -R elasticsearch:elasticsearch  /home/data/</div><div class="line">chown -R elasticsearch:elasticsearch  elasticsearch-2.3.5</div></pre></td></tr></table></figure>
<p>åˆ‡æ¢ç”¨æˆ·</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">su elasticsearch</div></pre></td></tr></table></figure>
<p>åœ¨elasticsearch-2.3.5/binç›®å½•ä¸‹æ‰§è¡Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[elasticsearch@graylog bin]$ ps -ef | grep elasticsearch</div><div class="line">root     18265 16004  0 14:27 pts/1    00:00:00 su elasticsearch</div><div class="line">502      18405     1 62 14:27 pts/1    00:00:13 /srv/jdk1.8.0_66/bin/java -Xms256m -Xmx1g -Djava.awt.headless=<span class="literal">true</span> -XX:+UseParNewGC -XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFraction=75 -XX:+UseCMSInitiatingOccupancyOnly -XX:+HeapDumpOnOutOfMemoryError -XX:+DisableExplicitGC -Dfile.encoding=UTF-8 -Djna.nosys=<span class="literal">true</span> -Des.path.home=/opt/elasticsearch-2.3.5 -cp /opt/elasticsearch-2.3.5/lib/elasticsearch-2.3.5.jar:/opt/elasticsearch-2.3.5/lib/* org.elasticsearch.bootstrap.Elasticsearch start <span class="_">-d</span></div><div class="line">502      18530 18266  0 14:27 pts/1    00:00:00 grep --color=auto ela</div></pre></td></tr></table></figure>
<p><strong>(5)æ£€æŸ¥elasticsearchæœåŠ¡çŠ¶æ€</strong></p>
<p>æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤æµ‹è¯•Elasticsearchæ˜¯å¦æ­£å¸¸è¿è¡Œï¼š</p>
<p>$ curl -XGET â€˜<a href="http://localhost:9200/_cluster/health?pretty=true" target="_blank" rel="external">http://localhost:9200/_cluster/health?pretty=true</a>â€˜</p>
<p>è¾“å‡ºçš„ä¿¡æ¯å¦‚ä¸‹è¡¨ç¤ºElasticsearchå®‰è£…æˆåŠŸï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">[elasticsearch@graylog bin]$ curl -XGET <span class="string">'http://192.168.1.234:9200/_cluster/health?pretty=true'</span></div><div class="line">&#123;</div><div class="line">  <span class="string">"cluster_name"</span> : <span class="string">"graylog"</span>,</div><div class="line">  <span class="string">"status"</span> : <span class="string">"yellow"</span>,</div><div class="line">  <span class="string">"timed_out"</span> : <span class="literal">false</span>,</div><div class="line">  <span class="string">"number_of_nodes"</span> : 1,</div><div class="line">  <span class="string">"number_of_data_nodes"</span> : 1,</div><div class="line">  <span class="string">"active_primary_shards"</span> : 30,</div><div class="line">  <span class="string">"active_shards"</span> : 30,</div><div class="line">  <span class="string">"relocating_shards"</span> : 0,</div><div class="line">  <span class="string">"initializing_shards"</span> : 0,</div><div class="line">  <span class="string">"unassigned_shards"</span> : 30,</div><div class="line">  <span class="string">"delayed_unassigned_shards"</span> : 0,</div><div class="line">  <span class="string">"number_of_pending_tasks"</span> : 0,</div><div class="line">  <span class="string">"number_of_in_flight_fetch"</span> : 0,</div><div class="line">  <span class="string">"task_max_waiting_in_queue_millis"</span> : 0,</div><div class="line">  <span class="string">"active_shards_percent_as_number"</span> : 50.0</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="3ï¼šå®‰è£…éƒ¨ç½²graylog-2-1ç‰ˆæœ¬"><a href="#3ï¼šå®‰è£…éƒ¨ç½²graylog-2-1ç‰ˆæœ¬" class="headerlink" title="3ï¼šå®‰è£…éƒ¨ç½²graylog-2.1ç‰ˆæœ¬"></a>3ï¼šå®‰è£…éƒ¨ç½²graylog-2.1ç‰ˆæœ¬</h3><p><strong>(1)ä¸‹è½½å®‰è£…åŒ…</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wget https://packages.graylog2.org/releases/graylog/graylog-2.1.1.tgz</div></pre></td></tr></table></figure>
<p><strong>(2)è§£å‹å®‰è£…åŒ…</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tar -zxvf graylog-2.1.1.tgz -C /opt/.</div></pre></td></tr></table></figure>
<p><strong>(3)ä¿®æ”¹é…ç½®æ–‡ä»¶</strong></p>
<p>ä¿®æ”¹å®‰è£…ç›®å½•ä¸‹ graylog.conf.example æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vim graylog.conf.example</div></pre></td></tr></table></figure>
<p>web_listen_uri å€¼æ˜¯graylogå¯åŠ¨æˆåŠŸåï¼ŒwebæœåŠ¡è®¿é—®åœ°å€</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">web_listen_uri = http://192.168.1.234:9000/</div></pre></td></tr></table></figure>
<p>rest_listen_uri çš„å€¼ï¼Œæ˜¯graylogå¯åŠ¨æˆåŠŸåï¼Œapiè®¿é—®åœ°å€</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rest_listen_uri = http://192.168.1.234:9000/api/</div></pre></td></tr></table></figure>
<p>root_timezone = UTC  #è®¾ç½®æ—¶åŒºï¼Œå¦åˆ™é»˜è®¤ä½¿ç”¨çš„æ˜¯UTCæ—¶é—´ä¹Ÿå°±æ˜¯ä¸–ç•Œæ—¶é—´ è¿™é‡Œæ˜¯å¿…é¡»æ”¹ä¸‹çš„ï¼Œå› ä¸ºåæœŸæ”¶é›†æ—¥å¿—æ˜¾ç¤ºæ—¶é—´æ˜¯æœ‰å˜åŒ–çš„ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">root_timezone = Asia/Shanghai</div></pre></td></tr></table></figure>
<p>å…¶ä¸­ password_secret çš„å€¼ç”¨å‘½ä»¤ç”Ÿæˆ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">yum install -y pwgen</div><div class="line">pwgen -N 1 <span class="_">-s</span> 96       H1R5v17kWtyDxj2PzxLMxu41D6HDt9JzhfZcj6QlCURVddgkLAdnUmpkdIscmmu4ELKsTrHwKvPmxFKSYyTn0YlqebbpQqyr</div><div class="line"></div><div class="line">    password_secret = H1R5v17kWtyDxj2PzxLMxu41D6HDt9JzhfZcj6QlCURVddgkLAdnUmpkdIscmmu4ELKsTrHwKvPmxFKSYyTn0YlqebbpQqyr</div></pre></td></tr></table></figure>
<p>å…¶ä¸­root_password_sha2 çš„å€¼ä½¿ç”¨å‘½ä»¤ç”Ÿæˆ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="built_in">echo</span> -n Ihaozhuo_b313 | sha256sum  (è¿™é‡Œå¯¹å¯†ç 123456å“ˆå¸ŒåŠ å¯†)</div><div class="line"></div><div class="line"><span class="built_in">fc</span>88c28d48b0cb97f3fb5286cc35c520409ef037acd30ec687f0c0bd3d5a5115 </div><div class="line">   </div><div class="line">root_password_sha2 = <span class="built_in">fc</span>88c28d48b0cb97f3fb5286cc35c520409ef037acd30ec687f0c0bd3d5a5115</div></pre></td></tr></table></figure>
<p>elasticsearch_cluster_name å€¼å¿…é¡»æ˜¯elasticsearché…ç½®æ–‡ä»¶ä¸­çš„cluster_name</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">elasticsearch_cluster_name = graylog</div></pre></td></tr></table></figure>
<p>elasticsearch_discovery_zen_ping_unicast_hosts å¡«å†™elasticsearchåœ°å€ï¼Œå¦‚æœæ˜¯å¤šä¸ªï¼Œç”¨é€—å·éš”å¼€</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">elasticsearch_discovery_zen_ping_unicast_hosts = 192.168.1.234:9300</div></pre></td></tr></table></figure>
<p>elasticsearch_discovery_zen_ping_multicast_enabled = false å¤šæ’­æ¨¡å¼å…³é—­</p>
<p>ç”±äºæˆ‘ä»¬åªæœ‰ä¸€ä¸ªElasticsearch shardï¼Œéœ€è¦æŠŠelasticsearch_shardså‚æ•°è®¾ç½®ä¸º1ï¼š<br>elasticsearché›†ç¾¤åˆ†ç‰‡æ•°é‡</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">elasticsearch_shards = 1</div></pre></td></tr></table></figure>
<p>elasticsearchç»‘å®šçš„èŠ‚ç‚¹IP</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">299 elasticsearch_network_host = 192.168.1.234</div><div class="line">300 elasticsearch_network_bind_host = 192.168.1.234</div><div class="line">301 elasticsearch_network_publish_host = 192.168.1.234</div></pre></td></tr></table></figure>
<p>mongodbå®‰è£…æœåŠ¡çš„ipåœ°å€</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mongodb_uri = mongodb://192.168.1.234/graylog</div></pre></td></tr></table></figure>
<p>è¿™é‡Œmongodbæ˜¯å®‰è£…åœ¨æˆ‘åŒä¸€å°æœåŠ¡å™¨ä¸Šé¢çš„ã€‚å¦‚æœè¦æŠŠmongodbå•ç‹¬æœåŠ¡å™¨è·‘è¿æ¥æ–¹å¼é…ç½®æ–‡ä»¶é‡Œé¢ä¹Ÿæœ‰ä¾‹å­è¯´æ˜ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mongodb_uri =mongodb://graylog:123456@160.17.2.251:27017/graylog2             <span class="comment">#è¿æ¥åˆ°mongodbçš„æœåŠ¡å™¨åœ°å€ä¸º160.17.2.251:27017ï¼Œè´¦å·ä¸ºgraylogï¼Œå¯†ç ä¸º123456 æ•°æ®åº“ä¸ºgraylog2</span></div></pre></td></tr></table></figure>
<p> è®¾ç½®å‘Šè­¦é‚®ä»¶å‘é€è€…ä¿¡æ¯</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"> <span class="comment"># Email transport</span></div><div class="line">transport_email_enabled = <span class="literal">false</span></div><div class="line">transport_email_hostname = smtp.exmail.qq.com</div><div class="line">transport_email_port = 465</div><div class="line">transport_email_use_auth = <span class="literal">true</span></div><div class="line">transport_email_use_tls = <span class="literal">true</span></div><div class="line">transport_email_use_ssl = <span class="literal">true</span></div><div class="line">transport_email_auth_username = chengyangyang@qq.cn</div><div class="line">transport_email_auth_password = beneTqq</div><div class="line">transport_email_subject_prefix = [graylog]</div><div class="line">transport_email_from_email = chengyangyang@qq.cn</div></pre></td></tr></table></figure>
<p><strong>(4)å¤åˆ¶é…ç½®æ–‡ä»¶</strong></p>
<p> å› ä¸ºgraylogå®‰è£…binç›®å½•ä¸‹ï¼Œé»˜è®¤å¯åŠ¨é…ç½®æ–‡ä»¶</p>
<p>é…ç½®æ–‡ä»¶è·¯å¾„ï¼š<code>/etc/graylog/server/server.conf</code></p>
<p>æ‰€ä»¥éœ€è¦å°†<code>graylog.conf.example</code> å¤åˆ¶åˆ°<code>/etc/graylog/server/</code>ç›®å½•ä¸‹ï¼Œå¹¶ä¸”æ”¹å <code>server.conf</code></p>
<p>æ‰§è¡Œå‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mkdir -p /etc/graylog/server/ </div><div class="line">cp graylog.conf.example /etc/graylog/server/server.conf</div></pre></td></tr></table></figure>
<p><strong>(5)å¯åŠ¨graylog</strong></p>
<p>åœ¨graylogå®‰è£…binç›®å½•ä¸‹æ‰§è¡Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./graylogctl start</div></pre></td></tr></table></figure>
<p>æŸ¥çœ‹æ—¥å¿—ï¼Œåœ¨graylogå®‰è£…ç›®å½•ä¸‹æ‰§è¡Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tail -200f /<span class="built_in">log</span>/graylog-server.log</div></pre></td></tr></table></figure>
<p>å¦‚æœæŠ¥é”™ï¼š</p>
<p>åŸå› ï¼š</p>
<p>åœ¨mongodbç‰ˆæœ¬2.6ä¹‹åï¼Œæ˜¯éœ€è¦æ—¥å¿—journalingè®¾ç½®çš„ï¼Œè€Œé»˜è®¤æƒ…å†µä¸‹æ˜¯å…³é—­çš„</p>
<p>è§£å†³åŠæ³•ï¼š</p>
<p>åœ¨mongodbå¯åŠ¨å‘½ä»¤åŠ ä¸Š â€“journal</p>
<p>æœ€åå¯åŠ¨å‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./mongod --dbpath=/usr/<span class="built_in">local</span>/mongodb/data/ --fork --logpath=/usr/<span class="built_in">local</span>/mongodb/logs --storageEngine=mmapv1 --journal</div></pre></td></tr></table></figure>
<p>é‡å¯mongodbåï¼Œé‡å¯graylogæœåŠ¡å³å¯ï¼</p>
<p><strong>(6)å¯åŠ¨graylog(æŠ¥é”™äºŒ)</strong></p>
<p>æŸ¥çœ‹æ—¥å¿—ï¼Œåœ¨graylogå®‰è£…ç›®å½•ä¸‹æ‰§è¡Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">tail -200f /<span class="built_in">log</span>/graylog-server.log</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&#123;com.mongodb.MongoSocketOpenException: Exception opening socket&#125;, caused by &#123;java.net.ConnectException: æ‹’ç»è¿æ¥&#125;&#125;]&#125;. Waiting <span class="keyword">for</span> 30000 ms before timing out</div><div class="line">2016-11-22 15:10:29,355 INFO : org.graylog2.bootstrap.CmdLineTool - Loaded plugin: Elastic Beats Input 1.1.1 [org.graylog.plugins.beats.BeatsInputPlugin]</div><div class="line">2016-11-22 15:10:29,357 INFO : org.graylog2.bootstrap.CmdLineTool - Loaded plugin: Collector 1.1.1 [org.graylog.plugins.collector.CollectorPlugin]</div><div class="line">2016-11-22 15:10:29,357 INFO : org.graylog2.bootstrap.CmdLineTool - Loaded plugin: Enterprise Integration Plugin 1.1.1 [org.graylog.plugins.enterprise_integration.EnterpriseIntegrationPlugin]</div><div class="line">2016-11-22 15:10:29,358 INFO : org.graylog2.bootstrap.CmdLineTool - Loaded plugin: MapWidgetPlugin 1.1.1 [org.graylog.plugins.map.MapWidgetPlugin]</div><div class="line">2016-11-22 15:10:29,359 INFO : org.graylog2.bootstrap.CmdLineTool - Loaded plugin: Pipeline Processor Plugin 1.1.1 [org.graylog.plugins.pipelineprocessor.ProcessorPlugin]</div><div class="line">2016-11-22 15:10:29,359 INFO : org.graylog2.bootstrap.CmdLineTool - Loaded plugin: Anonymous Usage Statistics 2.1.1 [org.graylog.plugins.usagestatistics.UsageStatsPlugin]</div><div class="line">2016-11-22 15:10:29,487 INFO : org.graylog2.bootstrap.CmdLineTool - Running with JVM arguments: -Djava.library.path=./../lib/sigar -Xms1g -Xmx1g -XX:NewRatio=1 -XX:+ResizeTLAB -XX:+UseConcMarkSweepGC -XX:+CMSConcurrentMTEnabled -XX:+CMSClassUnloadingEnabled -XX:+UseParNewGC -XX:-OmitStackTraceInFastThrow</div></pre></td></tr></table></figure>
<p>æç¤ºmongodb æ‹’ç»è¿æ¥ã€‚ è¿™ä¸ªæ—¶å€™éœ€è¦çœ‹ä¸‹ç«¯å£åœ°å€æ˜¯å¦æ˜¯IPåœ°å€è¿˜æ˜¯127.0.0.1 å¦‚æœä¸æ˜¯éœ€è¦ä¿®æ”¹ä¸‹åœ¨é‡å¯æœåŠ¡å°±å¯ä»¥äº†ã€‚</p>
<p><strong>æŸ¥çœ‹å¯åŠ¨æœåŠ¡ç«¯å£ï¼š</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">[root@graylog graylog-2.1.1]<span class="comment"># netstat -ntulp</span></div><div class="line">Active Internet connections (only servers)</div><div class="line">Proto Recv-Q Send-Q Local Address               Foreign Address             State       PID/Program name</div><div class="line">tcp        0      0 127.0.0.1:27017             0.0.0.0:*                   LISTEN      22308/mongod</div><div class="line">tcp        0      0 0.0.0.0:22                  0.0.0.0:*                   LISTEN      1974/sshd</div><div class="line">tcp        0      0 127.0.0.1:25                0.0.0.0:*                   LISTEN      1287/master</div><div class="line">tcp        0      0 ::ffff:192.168.1.234:9350   :::*                        LISTEN      23642/java</div><div class="line">tcp        0      0 ::ffff:192.168.1.234:9000   :::*                        LISTEN      23642/java</div><div class="line">tcp        0      0 ::ffff:192.168.1.234:9200   :::*                        LISTEN      18405/java</div><div class="line">tcp        0      0 ::ffff:192.168.1.234:9300   :::*                        LISTEN      18405/java</div><div class="line">tcp        0      0 :::22                       :::*                        LISTEN      1974/sshd</div><div class="line">tcp        0      0 ::1:25                      :::*                        LISTEN      1287/master</div></pre></td></tr></table></figure>
<p><strong>(6)è®¿é—®graylog</strong></p>
<p>graylogå¯åŠ¨æˆåŠŸåï¼Œæµè§ˆå™¨è®¿é—®ï¼š<strong>graylogå®‰è£…IP:9000</strong></p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/graylog10.png" alt=""></figure></p>
<h3 id="å››ï¼šæ€»ç»“"><a href="#å››ï¼šæ€»ç»“" class="headerlink" title="å››ï¼šæ€»ç»“"></a>å››ï¼šæ€»ç»“</h3><p>åˆ°æ­¤ï¼ŒåŸºç¡€çš„é›†ä¸­æ—¥å¿—ç®¡ç†graylogå®‰è£…å®Œæ¯•ï¼ï¼Œåç»­å°†ç»§ç»­ä»‹ç»ï¼š</p>
<p>å®‰è£…éƒ¨ç½²Graylog Collector Sidecar æ”¶é›†åº”ç”¨æ—¥å¿—</p>
<p>é‡‡ç”¨syslogæ”¶é›†æ—¥å¿—æ–¹å¼</p>
<p>graylogä¸€äº›ä½¿ç”¨ï¼ŒåŒ…æ‹¬æ—¥å¿—æˆªå–ï¼Œå‘Šè­¦ç­‰ã€‚</p>
<p>ä¹‹å‰ä¹Ÿå®è·µè¿‡ELKæŠ€æœ¯æ ˆï¼Œåæ¥é€‰å‹graylogï¼Œæ˜¯åŸºäºgraylogå¸¦æœ‰çš„æƒé™ç®¡ç†ï¼Œå’Œå‘Šè­¦åŠŸèƒ½æ¯”è¾ƒå®Œå–„ï¼</p>

	

	

</article>




	<article>
	
		<h1><a href="/2016/11/13/æ—¥å¿—åˆ†æå¹³å°/Graylog/Graylogâ€”æ—¥å¿—åˆ†æå¹³å°å®Œç¾ä»£æ›¿Elasticsearch/">Graylogâ€”â€”æ—¥å¿—åˆ†æå¹³å°å®Œç¾ä»£æ›¿Elasticsearch</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-11-13</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/Log-Analysis-Platform/">Log Analysis Platform</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Log-analysis-platform/">Log analysis platform</a>
			</span>
		
	</div>

	

	
		<p>æ‘˜è¦: æèµ·æ—¥å¿—èšåˆå·¥å…·ï¼Œæœ‰å¼€æºç•Œçš„ELKï¼Œå•†ä¸šç•Œçš„Splunkï¼Œä½†æˆ‘è¦ä»‹ç»å¼€æºçš„åèµ·ä¹‹ç§€Graylogï¼Œå¯ä»¥è¯´æ˜¯é¾™å¤´è€å¤§Splunkçš„å¼€æºç‰ˆã€‚</p>
<h1 id="Graylogâ€”â€”æ—¥å¿—åˆ†æå¹³å°å®Œç¾ä»£æ›¿Elasticsearch"><a href="#Graylogâ€”â€”æ—¥å¿—åˆ†æå¹³å°å®Œç¾ä»£æ›¿Elasticsearch" class="headerlink" title="Graylogâ€”â€”æ—¥å¿—åˆ†æå¹³å°å®Œç¾ä»£æ›¿Elasticsearch"></a>Graylogâ€”â€”æ—¥å¿—åˆ†æå¹³å°å®Œç¾ä»£æ›¿Elasticsearch</h1><p>å…ˆçœ‹çœ‹ æ¨èï¼<a href="https://my.oschina.net/HeAlvin/blog/378262" target="_blank" rel="external">å›½å¤–ç¨‹åºå‘˜æ•´ç†çš„ç³»ç»Ÿç®¡ç†å‘˜èµ„æºå¤§å…¨</a> ä¸­ï¼Œå›½å¤–ç¨‹åºå‘˜æ•´ç†çš„æ—¥å¿—èšåˆå·¥å…·çš„åˆ—è¡¨ï¼š</p>
<p><strong>æ—¥å¿—ç®¡ç†å·¥å…·ï¼šæ”¶é›†ï¼Œè§£æï¼Œå¯è§†åŒ–</strong></p>
<ul>
<li>Elasticsearch - ä¸€ä¸ªåŸºäºLuceneçš„æ–‡æ¡£å­˜å‚¨ï¼Œä¸»è¦ç”¨äºæ—¥å¿—ç´¢å¼•ã€å­˜å‚¨å’Œåˆ†æã€‚</li>
<li>Fluentd - æ—¥å¿—æ”¶é›†å’Œå‘å‡º</li>
<li>Flume -åˆ†å¸ƒå¼æ—¥å¿—æ”¶é›†å’Œèšåˆç³»ç»Ÿ</li>
<li>Graylog2 -å…·æœ‰æŠ¥è­¦é€‰é¡¹çš„å¯æ’å…¥æ—¥å¿—å’Œäº‹ä»¶åˆ†ææœåŠ¡å™¨</li>
<li>Heka -æµå¤„ç†ç³»ç»Ÿï¼Œå¯ç”¨äºæ—¥å¿—èšåˆ</li>
<li>Kibana - å¯è§†åŒ–æ—¥å¿—å’Œæ—¶é—´æˆ³æ•°æ®</li>
<li>Logstash -ç®¡ç†äº‹ä»¶å’Œæ—¥å¿—çš„å·¥å…·</li>
<li>Octopussy -æ—¥å¿—ç®¡ç†è§£å†³æ–¹æ¡ˆï¼ˆå¯è§†åŒ–/æŠ¥è­¦/æŠ¥å‘Šï¼‰</li>
</ul>
<p>Graylogä¸ELKæ–¹æ¡ˆçš„å¯¹æ¯”</p>
<ul>
<li>ELKï¼š Logstash -&gt; Elasticsearch -&gt; Kibana ï¼ˆä½¿ç”¨äº†ä¸€äº›æ’ä»¶head ï¼Œmarvelï¼‰</li>
<li>Graylogï¼š Graylog Collector -&gt; Graylog Server(å°è£…Elasticsearch) -&gt; Graylog Web</li>
</ul>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/Graylog.png" alt=""></figure></p>
<p>åšä¸ºè¿ç»´ï¼Œå…¬å¸å†…éƒ¨ä½¿ç”¨elkå¤„ç†æ—¥å¿—å‘ç°å¾ˆå¤šé—®é¢˜ã€‚</p>
<p>é¡ºä¾¿æˆªå›¾äº†å‡ å¼ ï¼š</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/graylog-elk.png" alt=""></figure><br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/graylog-elk1.png" alt=""></figure></p>
<p>ä¹‹å‰è¯•è¿‡Logstash + Elasticsearch + Kibanaçš„æ–¹æ¡ˆï¼Œå‘ç°æœ‰å‡ ä¸ªç¼ºç‚¹ï¼š</p>
<ol>
<li>ä¸èƒ½å¤„ç†å¤šè¡Œæ—¥å¿—ï¼Œæ¯”å¦‚Mysqlæ…¢æŸ¥è¯¢ï¼ŒTomcat/Jettyåº”ç”¨çš„Javaå¼‚å¸¸æ‰“å°</li>
<li>ä¸èƒ½ä¿ç•™åŸå§‹æ—¥å¿—ï¼Œåªèƒ½æŠŠåŸå§‹æ—¥å¿—åˆ†å­—æ®µä¿å­˜ï¼Œè¿™æ ·æœç´¢æ—¥å¿—ç»“æœæ˜¯ä¸€å †Jsonæ ¼å¼æ–‡æœ¬ï¼Œæ— æ³•é˜…è¯»ã€‚</li>
<li>ä¸å¤åˆæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„æ—¥å¿—è¡Œï¼Œè¢«å…¨éƒ¨ä¸¢å¼ƒã€‚</li>
<li>kibanaç»“åˆä½¿ç”¨ç»å¸¸ä¼šå‡ºç°å¡æ­»ã€‚èµ„æºæ¶ˆè€—éå¸¸å¤§ã€‚</li>
</ol>
<p>æœ¬ç€è§£å†³ä»¥ä¸Š3ä¸ªç¼ºç‚¹çš„åŸåˆ™ï¼Œå†æ¬¡å¯»æ‰¾æ›¿ä»£æ–¹æ¡ˆã€‚ é¦–å…ˆæ‰¾åˆ°äº†å•†ä¸šæ—¥å¿—å·¥å…·Splunkï¼Œå·ç§°æ—¥å¿—ç•Œçš„Googleï¼Œæ„æ€æ˜¯å…¨æ–‡æœç´¢æ—¥å¿—çš„èƒ½åŠ›ï¼Œä¸å…‰èƒ½è§£å†³ä»¥ä¸Š3ä¸ªç¼ºç‚¹ï¼Œè¿˜æä¾›æœç´¢å•è¯é«˜äº®æ˜¾ç¤ºï¼Œä¸åŒé”™è¯¯çº§åˆ«æ—¥å¿—æ ‡è‰²ç­‰å¸å¼•äººçš„ç‰¹æ€§ï¼Œä½†æ˜¯å…è´¹ç‰ˆæœ‰500Mé™åˆ¶ï¼Œä»˜è´¹ç‰ˆæ®è¯´è¦3ä¸‡ç¾åˆ€ï¼Œåªèƒ½æ”¾å¼ƒï¼Œç»§ç»­å¯»æ‰¾ã€‚ æœ€åæ‰¾åˆ°äº†Graylogï¼Œç¬¬ä¸€çœ¼çœ‹åˆ°Graylogï¼Œåªæ˜¯ç³»ç»Ÿæ—¥å¿—syslogçš„é‡‡é›†å·¥å…·ï¼Œä¸€ç‚¹ä¹Ÿæ²¡å¸å¼•åˆ°æˆ‘ã€‚ä½†åæ¥æ·±å…¥äº†è§£åï¼Œæ‰å‘ç°Graylogç®€ç›´å°±æ˜¯å¼€æºç‰ˆçš„Splunkã€‚ æˆ‘è‡ªå·±æ€»ç»“çš„Graylogå¸å¼•äººçš„åœ°æ–¹ï¼š</p>
<ol>
<li>ä¸€ä½“åŒ–æ–¹æ¡ˆï¼Œå®‰è£…æ–¹ä¾¿ï¼Œä¸åƒELKæœ‰3ä¸ªç‹¬ç«‹ç³»ç»Ÿé—´çš„é›†æˆé—®é¢˜ã€‚</li>
<li>é‡‡é›†åŸå§‹æ—¥å¿—ï¼Œå¹¶å¯ä»¥äº‹åå†æ·»åŠ å­—æ®µï¼Œæ¯”å¦‚http_status_codeï¼Œresponse_timeç­‰ç­‰ã€‚</li>
<li>è‡ªå·±å¼€å‘é‡‡é›†æ—¥å¿—çš„è„šæœ¬ï¼Œå¹¶ç”¨curl/ncå‘é€åˆ°Graylog Serverï¼Œå‘é€æ ¼å¼æ˜¯è‡ªå®šä¹‰çš„GELFï¼ŒFluntedå’ŒLogstashéƒ½æœ‰ç›¸åº”çš„è¾“å‡ºGELFæ¶ˆæ¯çš„æ’ä»¶ã€‚è‡ªå·±å¼€å‘å¸¦æ¥å¾ˆå¤§çš„è‡ªç”±åº¦ã€‚å®é™…ä¸Šåªéœ€è¦ç”¨inotifywaitç›‘æ§æ—¥å¿—çš„modifyäº‹ä»¶ï¼Œå¹¶æŠŠæ—¥å¿—çš„æ–°å¢è¡Œç”¨curl/netcatå‘é€åˆ°Graylog Serverå°±å¯ã€‚</li>
<li>æœç´¢ç»“æœé«˜äº®æ˜¾ç¤ºï¼Œå°±åƒgoogleä¸€æ ·ã€‚</li>
<li>æœç´¢è¯­æ³•ç®€å•ï¼Œæ¯”å¦‚ï¼š source:mongo AND reponse_time_ms:&gt;5000ï¼Œé¿å…ç›´æ¥è¾“å…¥elasticsearchæœç´¢jsonè¯­æ³•</li>
<li>æœç´¢æ¡ä»¶å¯ä»¥å¯¼å‡ºä¸ºelasticsearchçš„æœç´¢jsonæ–‡æœ¬ï¼Œæ–¹ä¾¿ç›´æ¥å¼€å‘è°ƒç”¨elasticsearch rest apiçš„æœç´¢è„šæœ¬ã€‚</li>
</ol>
<p>Graylogå›¾è§£</p>
<p>Graylogå¼€æºç‰ˆå®˜ç½‘ï¼š <a href="https://www.graylog.org/" target="_blank" rel="external">https://www.graylog.org/</a></p>
<p>æ¥å‡ å¼ å®˜ç½‘çš„æˆªå›¾ï¼š</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/graylog2.png" alt=""></figure></p>
<p><figure class="figure"><img src="https://www.graylog.org/assets/itops_full-87fe2811ab676116142c145affa95b902635b1d6da99718057e8ae9d45c15007.png" alt=""></figure></p>
<p><figure class="figure"><img src="https://www.graylog.org/assets/overview_dashboard-3817012f923d4a00e9bde1c0547796319cf0396149464f434cfc2ae83a9da826.png" alt=""></figure></p>
<p>Graylogæ˜¯å¼ºå¤§çš„æ—¥å¿—ç®¡ç†ã€åˆ†æå·¥å…·ã€‚å®ƒåŸºäº Elasticsearch, Javaå’ŒMongoDBã€‚</p>
<p>Graylogå¯ä»¥æ”¶é›†ç›‘æ§å¤šç§ä¸åŒåº”ç”¨çš„æ—¥å¿—ã€‚ä½†æ˜¯ä¸ºäº†ç¤ºèŒƒè¯´æ˜ï¼Œæˆ‘åªæ”¶é›†syslogã€‚å¹¶ä¸”ï¼Œæˆ‘å°†ä¼šæŠŠç”¨åˆ°çš„ç»„ä»¶å…¨éƒ¨å®‰è£…åˆ°ä¸€ä¸ªå•ç‹¬çš„æœåŠ¡å™¨ä¸Šã€‚å¯¹äºå¤§å‹ã€ç”Ÿäº§ç³»ç»Ÿä½ å¯ä»¥æŠŠç»„ä»¶åˆ†å¼€å®‰è£…åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œè¿™æ ·å¯ä»¥æé«˜æ•ˆç‡ã€‚</p>
<h3 id="Graylogçš„ç»„ä»¶"><a href="#Graylogçš„ç»„ä»¶" class="headerlink" title="Graylogçš„ç»„ä»¶"></a>Graylogçš„ç»„ä»¶</h3><p>Graylogæœ‰4ä¸ªåŸºæœ¬ç»„ä»¶ï¼š</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Graylog <span class="built_in">Server</span>ï¼šè¿™ä¸ªæœåŠ¡è´Ÿè´£æ¥æ”¶å’Œå¤„ç†æ—¥å¿—/æ¶ˆæ¯ï¼Œå¹¶ä¸”å’Œå…¶ä»–ç»„ä»¶æ²Ÿé€šã€‚</div><div class="line">Elasticsearchï¼šå­˜å‚¨æ‰€æœ‰çš„æ—¥å¿—ï¼Œå®ƒçš„æ€§èƒ½ä¾èµ–å†…å­˜å’Œç¡¬ç›˜IOã€‚</div><div class="line">MongoDBï¼šå­˜å‚¨å…ƒæ•°æ®ï¼Œè´Ÿè½½ä¸é«˜ã€‚</div><div class="line">graylog-Webæ¥å£ï¼šç”¨æˆ·æ¥å£ã€‚</div></pre></td></tr></table></figure>
<p>ä¸‹é¢æ˜¯Graylogç»„ä»¶ä¹‹é—´çš„å…³ç³»å›¾ï¼š</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/graylog3.png" alt=""></figure></p>
<p>ä¸‹é¢æ¥è‡ªæˆ‘å…¬å¸å†…éƒ¨åˆ†äº«çš„PPTæ‹å›¾ï¼š</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/Graylog4-ppt.png" alt=""></figure></p>
<p>ç”Ÿäº§ç¯å¢ƒ æˆ‘å‚è€ƒç½‘ä¸Šä¸€äº›åšå®¢ç”»çš„å›¾ï¼š</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/graylog5.png" alt=""></figure></p>
<h3 id="ç³»ç»Ÿè¦æ±‚ï¼š"><a href="#ç³»ç»Ÿè¦æ±‚ï¼š" class="headerlink" title="ç³»ç»Ÿè¦æ±‚ï¼š"></a>ç³»ç»Ÿè¦æ±‚ï¼š</h3><ul>
<li>CentOS 6.7</li>
<li>å†…å­˜è‡³å°‘2GB</li>
<li>æœ‰rootæƒé™</li>
<li>æœåŠ¡å™¨ipæ˜¯192.168.1.234ï¼Œå·²å®‰è£… 1.8.0_77-b03</li>
</ul>
<p>è¿™é‡Œæˆ‘åªæ˜¯ä¸¾ä¾‹å•ä¸€æ¨¡å¼è·‘æœåŠ¡ã€‚</p>
<h3 id="å®‰è£…MongoDB"><a href="#å®‰è£…MongoDB" class="headerlink" title="å®‰è£…MongoDB"></a>å®‰è£…MongoDB</h3><p>MongoDBçš„å®‰è£…éå¸¸ç®€å•ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å¯¼å…¥MongoDB GPGå¯†é’¥åˆ°rpmï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="string">[root@graylog</span> <span class="string">yum.repos.d]#</span> <span class="string">vim</span> <span class="string">/etc/yum.repos.d/mongodb-org-3.0.repo</span></div><div class="line"><span class="meta">---</span></div><div class="line"><span class="string">[mongodb-org-3.0]</span></div><div class="line"><span class="string">name=MongoDB</span> <span class="string">Repository</span></div><div class="line"><span class="string">baseurl=http://repo.mongodb.org/yum/redhat/$releasever/mongodb-org/3.0/x86_64/</span></div><div class="line"><span class="string">gpgcheck=0</span></div><div class="line"><span class="string">enabled=1</span></div><div class="line"><span class="meta">---</span></div><div class="line"></div><div class="line"><span class="string">[root@graylog</span> <span class="string">yum.repos.d]#</span> <span class="string">yum</span> <span class="string">install</span> <span class="bullet">-y</span> <span class="string">mongodb-org</span></div><div class="line"></div><div class="line"><span class="string">[root@graylog</span> <span class="string">yum.repos.d]#</span> <span class="string">vi</span> <span class="string">/etc/yum.conf</span></div><div class="line"><span class="string">æœ€åä¸€è¡Œæ·»åŠ ï¼š</span></div><div class="line"><span class="meta">---</span></div><div class="line"><span class="string">exclude=mongodb-org,mongodb-org-server,mongodb-org-shell,mongodb-org-mongos,mongodb-org-tools</span></div><div class="line"><span class="meta">---</span></div><div class="line"></div><div class="line"><span class="string">[root@graylog</span> <span class="string">yum.repos.d]#</span> <span class="string">service</span> <span class="string">mongod</span> <span class="string">start</span></div><div class="line"><span class="string">[root@graylog</span> <span class="string">yum.repos.d]#</span> <span class="string">chkconfig</span> <span class="string">mongod</span> <span class="string">on</span></div><div class="line"></div><div class="line"><span class="string">[root@graylog</span> <span class="string">yum.repos.d]#</span> <span class="string">vi</span> <span class="string">/etc/security/limits.conf</span></div><div class="line"><span class="string">æœ€åä¸€è¡Œæ·»åŠ ï¼š</span></div><div class="line"><span class="meta">---</span></div><div class="line"><span class="string">*</span>                <span class="string">soft</span>    <span class="string">nproc</span>           <span class="number">65536</span></div><div class="line"><span class="string">*</span>                <span class="string">hard</span>    <span class="string">nproc</span>           <span class="number">65536</span></div><div class="line"><span class="string">mongod</span>           <span class="string">soft</span>    <span class="string">nproc</span>           <span class="number">65536</span></div><div class="line"></div><div class="line"><span class="string">*</span>                <span class="string">soft</span>    <span class="string">nofile</span>          <span class="number">131072</span></div><div class="line"><span class="string">*</span>                <span class="string">hard</span>    <span class="string">nofile</span>          <span class="number">131072</span></div><div class="line"><span class="meta">---</span></div><div class="line"></div><div class="line"><span class="string">[root@graylog</span> <span class="string">~]#</span> <span class="string">vi</span> <span class="string">/etc/init.d/mongod</span></div><div class="line"><span class="string">ulimit</span> <span class="bullet">-f</span> <span class="string">unlimited</span> <span class="string">è¡Œå‰æ’å…¥ï¼š</span></div><div class="line"><span class="meta">---</span></div><div class="line">  <span class="string">if</span> <span class="string">test</span> <span class="bullet">-f</span> <span class="string">/sys/kernel/mm/transparent_hugepage/enabled;</span> <span class="string">then</span></div><div class="line">    <span class="string">echo</span> <span class="string">never</span> <span class="string">&gt; /sys/kernel/mm/transparent_hugepage/enabled</span></div><div class="line">  fi</div><div class="line">  if test -f /sys/kernel/mm/transparent_hugepage/defrag; then</div><div class="line">    echo never &gt; /sys/kernel/mm/transparent_hugepage/defrag</div><div class="line">  fi</div><div class="line">---</div><div class="line">[root@graylog ~]# /etc/init.d/mongod restart</div></pre></td></tr></table></figure>
<h3 id="å®‰è£…Elasticsearch"><a href="#å®‰è£…Elasticsearch" class="headerlink" title="å®‰è£…Elasticsearch"></a>å®‰è£…Elasticsearch</h3><p>Graylogç›®å‰ä¸ºæ­¢åªèƒ½ä½¿ç”¨Elasticsearch 2.0ä»¥å‰çš„ç‰ˆæœ¬ï¼Œæ‰€ä»¥ï¼Œåœ¨è¿™ä¸€æ­¥ä¸­ï¼Œæˆ‘å°†å®‰è£…Elasticsearch 1.7.xã€‚</p>
<p>æ·»åŠ Elasticsearch GPGå¯†é’¥ï¼š</p>
<pre><code>$ sudo rpm --import http://packages.elastic.co/GPG-KEY-elasticsearch
</code></pre><p>åˆ›å»ºElasticsearchæºï¼š</p>
<pre><code>$ sudo vim /etc/yum.repos.d/elasticsearch.repo
</code></pre><p>å†™å…¥å¦‚ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="section">[elasticsearch-1.7]</span></div><div class="line"><span class="attr">name</span>=Elasticsearch repository for <span class="number">1.7</span>.x packages</div><div class="line"><span class="attr">baseurl</span>=http://packages.elastic.co/elasticsearch/<span class="number">1.7</span>/centos</div><div class="line"><span class="attr">gpgcheck</span>=<span class="number">1</span></div><div class="line"><span class="attr">gpgkey</span>=http://packages.elastic.co/GPG-KEY-elasticsearch</div><div class="line"><span class="attr">enabled</span>=<span class="number">1</span></div></pre></td></tr></table></figure>
<p>å®‰è£…Elasticsearchï¼š</p>
<pre><code>$ sudo yum -y install elasticsearch
</code></pre><p>é…ç½®å‰å…ˆåˆ›å»ºå‡ ä¸ªç›®å½•æ–‡ä»¶</p>
<pre><code>mkdir /data/es-data -p
mkdir /data/es-work -p
</code></pre><p>Elasticsearchå®‰è£…å®Œæˆä¹‹åï¼Œç¼–è¾‘é…ç½®æ–‡ä»¶ï¼š</p>
<pre><code>sudo vim /etc/elasticsearch/elasticsearch.yml

 node.data: true  # æ•°æ®å­˜æ”¾true
</code></pre><p>æ‰¾åˆ°cluster.nameä¸€è¡Œï¼Œå–æ¶ˆè¿™ä¸€è¡Œçš„æ³¨é‡Šï¼Œå¹¶æŠŠå€¼æ”¹ä¸ºgraylog-developmentï¼š</p>
<pre><code>cluster.name: graylog-development


 path.data: /data/es-data     esæ•°æ®å­˜æ”¾ç›®å½•  è¿™é‡Œéœ€è¦è‡ªå·±æ–°å»ºç›®å½•

 path.work: /data/es-work   
</code></pre><p>ä½ ä¹Ÿè®¸æƒ³è¦é™åˆ¶å¤–éƒ¨è®¿é—®Elasticsearchï¼ˆç«¯å£9200ï¼‰ï¼Œè¿™æ ·å¯ä»¥æé«˜ç³»ç»Ÿçš„å®‰å…¨æ€§ã€‚æ‰¾åˆ°network.hostä¸€è¡Œï¼Œå–æ¶ˆæ³¨é‡Šï¼Œå¹¶æŠŠå€¼æ”¹ä¸ºlocalhostï¼š</p>
<pre><code>network.host: 192.168.1.234
</code></pre><p>ä¿å­˜é€€å‡ºæ–‡ä»¶ã€‚</p>
<p>é‡å¯Elasticsearchï¼š</p>
<pre><code>$ service elasticsearch start
</code></pre><p>è®¾ç½®å¼€æœºå¯åŠ¨ï¼š</p>
<pre><code>$ chkconfig --add elasticsearch
</code></pre><p>æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤æµ‹è¯•Elasticsearchæ˜¯å¦æ­£å¸¸è¿è¡Œï¼š</p>
<pre><code>$ curl -XGET &apos;http://localhost:9200/_cluster/health?pretty=true&apos;
</code></pre><p>è¾“å‡ºçš„ä¿¡æ¯å¦‚ä¸‹è¡¨ç¤ºElasticsearchå®‰è£…æˆåŠŸï¼š</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">drwxr-xr-x. <span class="number">2</span> root   root  <span class="number">4096</span> <span class="number">9</span>æœˆ  <span class="number">23</span> <span class="number">2011</span> src</div><div class="line">[root<span class="symbol">@ELK</span> <span class="keyword">local</span>]<span class="meta">#  curl -XGET <span class="string">'http://192.168.1.234:9200/_cluster/health?pretty=true'</span></span></div><div class="line">&#123;</div><div class="line">  <span class="string">"cluster_name"</span> : <span class="string">"graylog-development"</span>,</div><div class="line">  <span class="string">"status"</span> : <span class="string">"yellow"</span>,</div><div class="line">  <span class="string">"timed_out"</span> : <span class="literal">false</span>,</div><div class="line">  <span class="string">"number_of_nodes"</span> : <span class="number">1</span>,</div><div class="line">  <span class="string">"number_of_data_nodes"</span> : <span class="number">1</span>,</div><div class="line">  <span class="string">"active_primary_shards"</span> : <span class="number">37</span>,</div><div class="line">  <span class="string">"active_shards"</span> : <span class="number">37</span>,</div><div class="line">  <span class="string">"relocating_shards"</span> : <span class="number">0</span>,</div><div class="line">  <span class="string">"initializing_shards"</span> : <span class="number">0</span>,</div><div class="line">  <span class="string">"unassigned_shards"</span> : <span class="number">37</span>,</div><div class="line">  <span class="string">"delayed_unassigned_shards"</span> : <span class="number">0</span>,</div><div class="line">  <span class="string">"number_of_pending_tasks"</span> : <span class="number">0</span>,</div><div class="line">  <span class="string">"number_of_in_flight_fetch"</span> : <span class="number">0</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å®‰è£…Graylag</p>
<p>Graylogçš„æœ€æ–°ç‰ˆæ˜¯1.1.4ï¼Œä¸‹è½½é“¾æ¥å¦‚ä¸‹ï¼š<br><a href="https://packages.graylog2.org/repo/el/6Server/1.1/x86_64/graylog-server-1.1.4-1.noarch.rpm" target="_blank" rel="external">https://packages.graylog2.org/repo/el/6Server/1.1/x86_64/graylog-server-1.1.4-1.noarch.rpm</a><br><a href="https://packages.graylog2.org/repo/el/6Server/1.1/x86_64/graylog-web-1.1.4-1.noarch.rpm" target="_blank" rel="external">https://packages.graylog2.org/repo/el/6Server/1.1/x86_64/graylog-web-1.1.4-1.noarch.rpm</a></p>
<p>ç°åœ¨Graylogçš„æ‰€æœ‰ä¾èµ–è½¯ä»¶å®‰è£…å®Œæˆï¼Œè¿™ä¸€æ­¥æˆ‘ä»¬æ¥å®‰è£…graylog-serverã€‚</p>
<p>é¦–å…ˆï¼Œä¸‹è½½Graylog RPMè½¯ä»¶åŒ…ï¼š</p>
<pre><code>$ cd 
$ sudo rpm -Uvh https://packages.graylog2.org/repo/packages/graylog-1.3-repository-el7_latest.rpm
</code></pre><p>å®‰è£…graylog-serverï¼š</p>
<pre><code>yum -y install graylog-server
</code></pre><p>å®‰è£…pwgenï¼Œæˆ‘ä»¬ä½¿ç”¨å®ƒç”Ÿæˆéšæœºå¯†ç ï¼š</p>
<pre><code>yum -y install epel-release
yum -y install pwgen
</code></pre><p>ç°åœ¨æˆ‘ä»¬æ¥è®¾ç½®Graylogç®¡ç†å‘˜çš„å¯†é’¥ã€‚é…ç½®æ–‡ä»¶ä½äº/etc/graylog/server/server.confç›®å½•ï¼Œéœ€è¦ä¿®æ”¹password_secretå‚æ•°ï¼š</p>
<pre><code>$ SECRET=$(pwgen -s 96 1)
$ sudo -E sed -i -e &apos;s/password_secret =.*/password_secret = &apos;$SECRET&apos;/&apos; /etc/graylog/server/server.conf
</code></pre><p>æ‰§è¡Œå®Œä¸Šé¢å‘½ä»¤ä¹‹åï¼Œpassword_secretå‚æ•°çš„æ ·å­ï¼š</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/graylog6.png" alt=""></figure></p>
<p>è¿™ä¸€æ­¥ï¼Œè®¾ç½®ç®¡ç†å‘˜å¯†ç ã€‚ç”±äºå¯†ç ä½¿ç”¨shaå“ˆå¸Œç®—æ³•ï¼Œæˆ‘ä»¬éœ€è¦æŠŠæ˜æ–‡å¯†ç è½¬æ¢ä¸ºhashï¼Œç„¶åèµ‹å€¼ç»™root_password_sha2å‚æ•°ã€‚ä¾‹å¦‚ï¼Œæˆ‘è¦è®¾ç½®çš„ç®¡ç†å‘˜å¯†ç æ˜¯ Ihaozhuo_b313ï¼Œå®ƒå¯¹åº”çš„hashä¸ºï¼š</p>
<pre><code>$ echo -n Ihaozhuo_b313 | sha256sum | awk &apos;{print $1}&apos;
</code></pre><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/graylog7.png" alt=""></figure></p>
<p>ç¼–è¾‘/etc/graylog/server/server.confï¼Œè®¾ç½®root_password_sha2å‚æ•°ï¼š</p>
<pre><code>$ sudo vim /etc/graylog/server/server.conf
</code></pre><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/graylog8.png" alt=""></figure></p>
<p>ç°åœ¨Graylogç®¡ç†å‘˜å¯†ç ä¸ºIhaozhuo_b313ã€‚</p>
<p>é…ç½®rest_transport_uriå‚æ•°ï¼Œè®¾ç½®Graylog webæ¥å£å’ŒæœåŠ¡å™¨çš„æ²Ÿé€šæ–¹å¼ã€‚ç”±äºæˆ‘ä»¬æŠŠæ‰€æœ‰ç»„ä»¶éƒ½å®‰è£…åˆ°äº†å•ç‹¬çš„ä¸€ä¸ªæœåŠ¡å™¨ä¸Šï¼Œéœ€è¦æŠŠå€¼è®¾ç½®ä¸º<strong>127.0.0.1</strong> æˆ– <strong>localhost</strong>ã€‚æ‰¾åˆ°rest_transport_uriä¸€è¡Œï¼Œå–æ¶ˆæ³¨é‡Šï¼Œå¹¶æŠŠå€¼è®¾ç½®ä¸ºï¼š</p>
<pre><code>rest_transport_uri = http://192.168.1.234:12900/
</code></pre><p>ç”±äºæˆ‘ä»¬åªæœ‰ä¸€ä¸ªElasticsearch shardï¼Œéœ€è¦æŠŠelasticsearch_shardså‚æ•°è®¾ç½®ä¸º1ï¼š</p>
<pre><code>elasticsearch_shards = 1
</code></pre><p>æ›´æ”¹elasticsearch_cluster_nameå‚æ•°ï¼Œåº”è¯¥å’Œå‰é¢Elasticsearchçš„<strong>cluster.name</strong>å‚æ•°ç›¸å¯¹åº”ï¼š</p>
<pre><code>elasticsearch_cluster_name = graylog-development
</code></pre><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/graylog9.png" alt=""></figure></p>
<p>å–æ¶ˆä¸‹é¢ä¸¤è¡Œçš„æ³¨é‡Šï¼Œæ£€æµ‹Elasticsearchï¼š</p>
<pre><code>172 elasticsearch_discovery_zen_ping_multicast_enabled = false
173 elasticsearch_discovery_zen_ping_unicast_hosts = 192.168.1.234:9300
</code></pre><p>å¯åŠ¨graylog-serverï¼š</p>
<pre><code>/etc/init.d/graylog-web restart
</code></pre><h3 id="å®‰è£…Graylog-Web"><a href="#å®‰è£…Graylog-Web" class="headerlink" title="å®‰è£…Graylog Web"></a>å®‰è£…Graylog Web</h3><p>å®‰è£…Graylog Webï¼š</p>
<pre><code>$ sudo yum -y install graylog-web
</code></pre><p>å®‰è£…å®Œæˆä¹‹åé…ç½®Graylog Webçš„å¯†é’¥ï¼Œé…ç½®æ–‡ä»¶ä½äº/etc/graylog/web/web.confï¼Œæ›´æ”¹application.secretå‚æ•°ï¼š</p>
<pre><code>$ SECRET=$(pwgen -s 96 1)
$ sudo -E sed -i -e &apos;s/application\.secret=&quot;&quot;/application\.secret=&quot;&apos;$SECRET&apos;&quot;/&apos; /etc/graylog/web/web.conf
</code></pre><p>é…ç½®graylog2-server.uriså‚æ•°ï¼Œå®ƒçš„å€¼åº”è¯¥å’ŒGraylogçš„rest_listen_uriå‚æ•°ç›¸å¯¹åº”ï¼š</p>
<pre><code>$ sudo vim /etc/graylog/web/web.conf

graylog2-server.uris=&quot;http://127.0.0.1:12900/&quot;
</code></pre><p>é‡å¯graylog-webï¼š</p>
<pre><code>/etc/init.d/graylog-web restart
</code></pre><h3 id="é…ç½®GraylogæœåŠ¡å™¨æ¥æ”¶å…¶ä»–æœåŠ¡å™¨çš„syslogæ—¥å¿—"><a href="#é…ç½®GraylogæœåŠ¡å™¨æ¥æ”¶å…¶ä»–æœåŠ¡å™¨çš„syslogæ—¥å¿—" class="headerlink" title="é…ç½®GraylogæœåŠ¡å™¨æ¥æ”¶å…¶ä»–æœåŠ¡å™¨çš„syslogæ—¥å¿—"></a>é…ç½®GraylogæœåŠ¡å™¨æ¥æ”¶å…¶ä»–æœåŠ¡å™¨çš„syslogæ—¥å¿—</h3><h4 id="ç™»å½•Graylog-Web"><a href="#ç™»å½•Graylog-Web" class="headerlink" title="ç™»å½•Graylog Web"></a>ç™»å½•Graylog Web</h4><p>ä½¿ç”¨æµè§ˆå™¨è®¿é—®GraylogæœåŠ¡å™¨çš„åŸŸåæˆ–IPï¼š<strong><a href="http://graylog_public_IP_domain:9000/" target="_blank" rel="external">http://graylog_public_IP_domain:9000/</a></strong>ã€‚</p>
<p>ä½ åº”è¯¥èƒ½çœ‹åˆ°ä¸€ä¸ªç™»å½•ç•Œé¢ï¼Œä½¿ç”¨adminåšä¸ºç”¨æˆ·åå’Œå‰é¢è®¾ç½®çš„å¯†ç ç™»å½•ã€‚</p>
<p>ç™»å½•ä¹‹åï¼š</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/graylog10.png" alt=""></figure></p>
<p>ä¸Šé¢çš„çº¢æ•°å­—1æ˜¯é€šçŸ¥ï¼ˆyou have a node without any running inputsï¼‰ï¼Œä¸‹é¢è®¾ç½®é€šè¿‡UDPæ¥æ”¶syslogã€‚</p>
<p>åˆ›å»ºsyslog UDPè¾“å…¥</p>
<p>æ·»åŠ è¦æ¥æ”¶çš„å…¶ä»–æœåŠ¡å™¨syslogæ—¥å¿—ï¼šSystem-&gt;Inputs-&gt;Syslog UDP-&gt;Launch new inputã€‚</p>
<p>åœ¨å¼¹å‡ºçš„çª—å£ä¸Šè¾“å…¥å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<ul>
<li>Title: syslog</li>
<li>Port: 8514</li>
<li>Bind address: è¿™é‡Œå†™Graylog-serveræœåŠ¡å™¨ä¸»æœºIP</li>
</ul>
<p>ç‚¹å‡»Launch</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/graylog11.png" alt=""></figure></p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/graylog12.png" alt=""></figure></p>
<p>å¦‚æœä½ éœ€è¦æ”¶é›†å¤šä¸ªæœåŠ¡å™¨çš„æ—¥å¿—ï¼Œé‡å¤ä¸Šé¢æ­¥éª¤ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬çš„GraylogæœåŠ¡å™¨å·²ç»åšå¥½äº†æ¥æ”¶å…¶ä»–æœåŠ¡å™¨å‘æ¥æ—¥å¿—çš„å‡†å¤‡ã€‚ä¸‹é¢æˆ‘ä»¬è¿˜éœ€è¦é…ç½®å…¶ä»–æœåŠ¡å™¨ï¼Œè®©è¿™äº›æœåŠ¡å™¨ç»™GraylogæœåŠ¡å™¨å‘é€æ—¥å¿—ã€‚</p>
<h4 id="é…ç½®å…¶ä»–æœåŠ¡å™¨ç»™GraylogæœåŠ¡å™¨å‘é€syslog"><a href="#é…ç½®å…¶ä»–æœåŠ¡å™¨ç»™GraylogæœåŠ¡å™¨å‘é€syslog" class="headerlink" title="é…ç½®å…¶ä»–æœåŠ¡å™¨ç»™GraylogæœåŠ¡å™¨å‘é€syslog"></a>é…ç½®å…¶ä»–æœåŠ¡å™¨ç»™GraylogæœåŠ¡å™¨å‘é€syslog</h4><p>å‚è€ƒå®˜ç½‘ï¼š<a href="https://marketplace.graylog.org/addons/a47beb3b-0bd9-4792-a56a-33b27b567856" target="_blank" rel="external">ä»Linuxç³»ç»Ÿæ—¥å¿—å‘é€åˆ°Graylog</a></p>
<p>SSHç™»å½•â€œå…¶ä»–æœåŠ¡å™¨â€ï¼Œåˆ›å»ºrsyslogé…ç½®æ–‡ä»¶90-graylog.confï¼š</p>
<pre><code>sudo vim /etc/rsyslog.d/90-graylog.conf
</code></pre><p>æ·»åŠ å¦‚ä¸‹ä»£ç ï¼ŒæŠŠ graylog_server_IP æ›¿æ¢ä¸ºGraylogæœåŠ¡å™¨ipåœ°å€ï¼š</p>
<pre><code>$template GRAYLOGRFC5424,&quot;&lt;%pri%&gt;%protocol-version% %timestamp:::date-rfc3339%    %HOSTNAME% %app-name% %procid% %msg%\n&quot;
*.* @graylog_server_IP:8514;GRAYLOGRFC5424
</code></pre><p>é‡å¯rsyslogæœåŠ¡ä½¿ç”Ÿæ•ˆï¼š</p>
<pre><code>/etc/init.d/rsyslog restart
</code></pre><p>é…ç½®å®Œæˆä¹‹åï¼Œå›åˆ°Graylog Webï¼Œç‚¹å‡»Sourcesï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰æ–°æ·»åŠ rsyslogã€‚</p>
<h4 id="Graylogä½¿ç”¨httpåè®®å‘é€ï¼š"><a href="#Graylogä½¿ç”¨httpåè®®å‘é€ï¼š" class="headerlink" title="Graylogä½¿ç”¨httpåè®®å‘é€ï¼š"></a>Graylogä½¿ç”¨httpåè®®å‘é€ï¼š</h4><p>æ·»åŠ è¦æ¥æ”¶çš„å…¶ä»–æœåŠ¡å™¨syslogæ—¥å¿—ï¼šSystem-&gt;Inputs-&gt;GELF HTTP-&gt;Launch new inputã€‚</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/graylog14.png" alt=""></figure></p>
<p>ç„¶ååœ¨æœåŠ¡å™¨ä¸Šé¢å‘é€ä¸‹é¢å‘½ä»¤ã€‚</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="string">[root@graylog-development ~]</span># curl -XPOST http://<span class="number">192.168.1.234:12201</span>/gelf -p0 -d '&#123;<span class="string">"short_message"</span>:<span class="string">"Hello there"</span>, <span class="string">"host"</span>:<span class="string">"example.org"</span>, <span class="string">"facility"</span>:<span class="string">"test"</span>, <span class="string">"_foo"</span>:<span class="string">"bar"</span>&#125;'</div><div class="line"><span class="string">[root@graylog-development ~]</span># curl -XPOST http://<span class="number">192.168.1.234:12201</span>/gelf -p0 -d '&#123;<span class="string">"short_message"</span>:<span class="string">"æµ‹è¯•"</span>, <span class="string">"host"</span>:<span class="string">"example.org"</span>, <span class="string">"facility"</span>:<span class="string">"test"</span>, <span class="string">"_foo"</span>:<span class="string">"bar"</span>&#125;'</div></pre></td></tr></table></figure>
<p>è¿™é‡Œå®šä¹‰192.168.1.234 æ˜¯graylog-serveræœåŠ¡å™¨åœ°å€ 12201 ç«¯å£æ˜¯ä¹‹å‰åˆ›å»ºå¥½çš„ã€‚</p>
<h3 id="æœç´ Graylog"><a href="#æœç´ Graylog" class="headerlink" title="æœç´ Graylog"></a>æœç´ Graylog</h3><p>å‡å¦‚ä½ è¦æœç´¢helloï¼š</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/graylog13.png" alt=""></figure></p>
<p>ä¸Šé¢å®‰è£…é…ç½®äº†åŸºæœ¬çš„GraylogæœåŠ¡å™¨ã€‚</p>
<h3 id="æ—¶åŒºå’Œé«˜äº®è®¾ç½®"><a href="#æ—¶åŒºå’Œé«˜äº®è®¾ç½®" class="headerlink" title="æ—¶åŒºå’Œé«˜äº®è®¾ç½®"></a>æ—¶åŒºå’Œé«˜äº®è®¾ç½®</h3><p>adminå¸å·çš„æ—¶åŒºï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="string">[root@graylog</span> <span class="string">~]#</span> <span class="string">vi</span> <span class="string">/etc/graylog/server/server.conf</span></div><div class="line"><span class="meta">---</span></div><div class="line"><span class="number">30</span> <span class="string">root_timezone</span> <span class="string">=</span> <span class="string">Asia/Shanghai</span></div><div class="line"><span class="meta">---</span></div><div class="line"><span class="string">[root@graylog</span> <span class="string">~]#</span> <span class="string">/etc/init.d/graylog-server</span> <span class="string">restart</span></div></pre></td></tr></table></figure>
<p>å…¶ä»–å¸å·çš„é»˜è®¤æ—¶åŒºï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="string">[root@graylog</span> <span class="string">~]#</span> <span class="string">vi</span> <span class="string">/etc/graylog/web/web.conf</span></div><div class="line"><span class="meta">---</span></div><div class="line"><span class="number">18</span> <span class="string">timezone="Asia/Shanghai"</span></div><div class="line"><span class="meta">---</span></div><div class="line"><span class="string">[root@graylog</span> <span class="string">~]#</span> <span class="string">/etc/init.d/graylog-web</span> <span class="string">restart</span></div></pre></td></tr></table></figure>
<p>å…è®¸æŸ¥è¯¢ç»“æœé«˜äº®ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="string">[root@graylog</span> <span class="string">~]#</span> <span class="string">vi</span> <span class="string">/etc/graylog/server/server.conf</span></div><div class="line"><span class="meta">---</span></div><div class="line"><span class="number">147</span> <span class="string">allow_highlighting</span> <span class="string">=</span> <span class="literal">true</span></div><div class="line"><span class="meta">---</span></div><div class="line"><span class="string">[root@graylog</span> <span class="string">~]#</span> <span class="string">/etc/init.d/graylog-server</span> <span class="string">restart</span></div></pre></td></tr></table></figure>
<h3 id="ç§»åŠ¨æ•°æ®ç›®å½•"><a href="#ç§»åŠ¨æ•°æ®ç›®å½•" class="headerlink" title="ç§»åŠ¨æ•°æ®ç›®å½•"></a>ç§»åŠ¨æ•°æ®ç›®å½•</h3><figure class="highlight livescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">ç§»åŠ¨elasticsearchçš„æ•°æ®ç›®å½•</div><div class="line">[root@graylog ~]<span class="comment"># sudo /etc/init.d/elasticsearch stop</span></div><div class="line">[root@graylog ~]<span class="comment"># sudo cp -rp /var/lib/elasticsearch/ /data/</span></div><div class="line">[root@graylog ~]<span class="comment"># sudo vi /etc/sysconfig/elasticsearch</span></div><div class="line">+<span class="number">16</span> DATA_DIR=/data/elasticsearch</div><div class="line">[root@graylog ~]<span class="comment"># sudo /etc/init.d/elasticsearch start</span></div><div class="line"></div><div class="line">ç§»åŠ¨mongoçš„æ•°æ®ç›®å½•</div><div class="line">[root@graylog ~]<span class="comment"># sudo /etc/init.d/mongod stop</span></div><div class="line">[root@graylog ~]<span class="comment"># sudo cp -rp /var/lib/mongo /data/</span></div><div class="line">[root@graylog ~]<span class="comment"># sudo vi /etc/mongod.conf</span></div><div class="line">---</div><div class="line"><span class="number">13</span> dbpath=/<span class="keyword">var</span>/lib/mongo<span class="function"></span></div><div class="line">-&gt;</div><div class="line"><span class="number">13</span> dbpath=/data/mongo</div><div class="line">---</div><div class="line">[mtagent@access2 ~]$ sudo /etc/init.d/mongod start</div></pre></td></tr></table></figure>
<h4 id="å…¶ä½™å‚è€ƒæ–‡æ¡£"><a href="#å…¶ä½™å‚è€ƒæ–‡æ¡£" class="headerlink" title="å…¶ä½™å‚è€ƒæ–‡æ¡£"></a>å…¶ä½™å‚è€ƒæ–‡æ¡£</h4><p><a href="http://docs.graylog.org/en/1.3/" target="_blank" rel="external">å‚è€ƒå®˜ç½‘</a></p>
<p><a href="http://blog.topspeedsnail.com/archives/4066" target="_blank" rel="external">Centos7 æ­å»ºgraylog</a></p>
<p><a href="https://my.oschina.net/fitnessefan/blog/464351?utm_source=tuicool&amp;utm_medium=referral" target="_blank" rel="external">Graylogâ€”â€”æ—¥å¿—èšåˆå·¥å…·ä¸­çš„åèµ·ä¹‹ç§€</a></p>

	

	

</article>




	<article>
	
		<h1><a href="/2016/09/11/ä¸ªäººç”Ÿæ´»è®°å½•/è€ƒé©¾ç…§çš„è‰°è¾›å†ç¨‹/">è€ƒé©¾ç…§çš„è‰°è¾›å†ç¨‹</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-09-11</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/ç”Ÿæ´»/">ç”Ÿæ´»</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Personal-life-record/">Personal life record</a>
			</span>
		
	</div>

	

	
		<p>ğŸ“</p>
<p>   ä»Šå¤©æ˜¯2016å¹´9æœˆ11å·ï¼Œåœ¨è¿‡å‡ å¤©å°±æ˜¯ä¸­ç§‹èŠ‚äº†ï¼Œåˆšåˆšå¤§å­¦æ¯•ä¸šå‡ºæ¥ä¸€å¹´äº†ï¼Œåœ¨åŠ ä¸Šå®ä¹ å·¥ä½œä¸€å¹´å¤šäº†ï¼Œç®—èµ·æ¥å·¥ä½œä¸¤å¹´å¤šäº†ï¼Œåœ¨è¯»å¤§å­¦å’Œå‚åŠ ä¸€äº›æŠ€æœ¯åŸ¹è®­ç­å°±æ²¡æœ‰æ—¶é—´å»è€ƒä¸€æœ¬å±äºè‡ªå·±çš„é©¾ç…§ï¼Œä¸€ç›´æ‹–åˆ°ç°åœ¨çš„ç¡®æ˜¯æŒºå¿™çš„ã€‚</p>
		<p><a class="article__read-more-link" href="/2016/09/11/ä¸ªäººç”Ÿæ´»è®°å½•/è€ƒé©¾ç…§çš„è‰°è¾›å†ç¨‹/">...read more</a></p>
	

	

</article>




	<article>
	
		<h1><a href="/2016/09/02/ä¸ªäººç”Ÿæ´»è®°å½•/å¨è‰ºä¾ç„¶å¥½ğŸ‘/">å¨è‰ºä¾ç„¶å¥½ğŸ‘</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-09-02</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/ç”Ÿæ´»/">ç”Ÿæ´»</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Personal-life-record/">Personal life record</a>
			</span>
		
	</div>

	

	
		<p> ä¸€ä¸ªç”·çš„èƒ½åšçš„å‡ºä¸€æ‰‹å¥½çš„ç¾é£Ÿæ˜¯å¤šä¹ˆæ£’ğŸ‘çš„ä¸€ä»¶äº‹ã€‚è¿™è¿˜è¦æ„Ÿè°¢æˆ‘æœ‰ä¸€ä¸ªç‰¹åˆ«çš„æ£’çš„çˆ¶äº²ã€‚</p>
<p> è®°å¾—å°æ—¶å€™12å²æˆ‘å°±å¼€å§‹å­¦ä¼šåšé¥­ï¼Œå­¦ä¼šç¬¬ä¸€é“èœå—ç“œé¥­ğŸƒã€‚</p>
<p> è¿™ä¸ªçš„ç¡®ä¹Ÿæ˜¯æˆ‘å¯¹åšç¾é£Ÿä¹Ÿå¾ˆæ„Ÿå…´è¶£ï¼Œä»€ä¹ˆçº¢çƒ§é¸¡ç¿…ï¼Œçº¢çƒ§æ’éª¨ï¼Œçº¢çƒ§è‚‰ï¼ŒğŸŸé±¼ç±»æœ€æ‹¿æ‰‹äº†ã€‚ æ±Ÿå—å®¶å¸¸èœéƒ½æ¯”è¾ƒä¼šç‚¹ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä¸€ä¸ªä¼˜ç‚¹å§ã€‚ </p>
<p>è‡ªå·±å‡ºæ¥å·¥ä½œï¼Œåœ¨å¤–é¢å·¥ä½œæ¥å¾€åŒäº‹æœ‹å‹æ¥å®¶é‡Œç©ï¼Œè‡ªå·±ä¼šä¸‹å¨å¯ä»¥éœ²ä¸€æ‰‹ã€‚</p>
<p><strong>æœ€è¿‘å·¥ä½œä¸æ˜¯ç‰¹åˆ«å¿™å°±ç»§ç»­æ‹¿èµ·ç¨‹å¼èœè°±å°å¼„äº†å‡ é“å°èœï¼š</strong></p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/cai.JPG" alt=""></figure></p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/cai1.JPG" alt=""></figure><br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/cai2.JPG" alt=""></figure><br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/cai3.JPG" alt=""></figure><br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/cai4.JPG" alt=""></figure><br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/cai5.JPG" alt=""></figure></p>
<p><strong>æ˜¯ä¸æ˜¯ç‰¹åˆ«æ£’</strong>ğŸ‘ ğŸ˜ </p>

	

	

</article>




	<article>
	
		<h1><a href="/2016/07/31/ä¸ªäººç”Ÿæ´»è®°å½•/æ¨èä¸€ä¸ªä¿æŠ¤çœ¼ç›ğŸ‘€çš„è½¯ä»¶ï¼f-lux/">æ¨èä¸€ä¸ªä¿æŠ¤çœ¼ç›ğŸ‘€çš„è½¯ä»¶ï¼f-lux</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-07-31</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/ç”Ÿæ´»/">ç”Ÿæ´»</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Personal-life-record/">Personal life record</a>
			</span>
		
	</div>

	

	
		<p>æœ€è¿‘å¤©å¤©åŠ ç­ç„¶åæ™šä¸Šç›¯ç€ç”µè„‘ï¼Œçœ¼ç›ä¸€ç›´å¾ˆå¹²æ¶©ï¼Œéå¸¸éš¾å—ã€‚æ­£å·§æ˜¨å¤©åœ¨GitHubä¸Šé—²é€›ï¼Œæ— æ„é—´å‘ç°äº†åˆ«äººæ¨èçš„è¿™ä¸ªè½¯ä»¶f.luxï¼ŒMacä¸Šä¸‹è½½è¯•ç”¨äº†ä¸€ä¸‹ã€‚è§‰å¾—å¾ˆä¸é”™ï¼Œæ¨èä¸€ä¸‹ï¼ä¹Ÿè®¸æ˜¯æˆ‘å­¤é™‹å¯¡é—»äº†ï¼Œå¯èƒ½å¤§å®¶éƒ½å·²ç»åœ¨ç”¨äº†â€¦â€¦</p>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p><code>f.lux</code>çš„åŠŸèƒ½å¾ˆç®€å•ï¼Œå°±æ˜¯å¯ä»¥æ ¹æ®æ—¶é—´çš„å˜åŒ–è°ƒèŠ‚ç”µè„‘çš„æ˜¾ç¤ºã€‚ä½†æ˜¯è¿™é‡Œçš„è°ƒèŠ‚ä¸æ˜¯ç®€å•çš„äº®åº¦è°ƒèŠ‚ï¼Œè€Œæ˜¯è°ƒèŠ‚æ˜¾ç¤ºå±çš„è‰²æ¸©ï¼ˆç®€å•çš„è¯´å°±æ˜¯ç™½å¤©å†·è‰²è°ƒï¼Œæ™šä¸Šæš–è‰²è°ƒï¼‰ã€‚å¯ä»¥ä»<a href="https://justgetflux.com/" target="_blank" rel="external">f.luxå®˜ç½‘</a>ä¸‹è½½å®‰è£…ï¼Œç„¶åæ‰“å¼€ï¼Œç•Œé¢å¦‚ä¸‹ï¼š</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/f.lux1.png" alt=""></figure></p>
<p>å®˜ç½‘ç¿»è¯‘:</p>
<p>ä½ <code>f.lux</code>å®‰è£…ç¨‹åºæ˜¯ä¸€ä¸ª.zipæ–‡ä»¶ - å®ƒåº”è¯¥æ˜¯åœ¨ä½ ä¸‹è½½çš„æ–‡ä»¶å¤¹ä¸­ã€‚åŒå‡»å®ƒå®‰è£…f.luxã€‚</p>
<p>ä¸€æ—¦f.luxå®‰è£…å¹¶è¿è¡Œï¼Œä½ åº”è¯¥çœ‹åˆ°f.lux Preferencesçª—å£å‡ºç°ã€‚åœ¨è¿™é‡Œï¼Œä½ å¯ä»¥è¾“å…¥è‡ªå·±çš„ä½ç½®ï¼Œå¹¶è®¾ç½®ä½ å¹³æ—¶çš„èµ·åºŠæ—¶é—´ã€‚f.luxä½¿ç”¨æ­¤ä¿¡æ¯ä¸ºæ‚¨åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰ç…§æ˜è®¡åˆ’ã€‚</p>
<p>ä½ å¯ä»¥æ‰“å¼€é¦–éšæ—¶æŸ¥çœ‹å’Œæ›´æ”¹æ‚¨çš„f.luxè®¾ç½®ã€‚<br>è¯¥f.luxèœå•æ€»æ˜¯å¯ä»¥æ‰¾åˆ°æ‚¨çš„ç³»ç»Ÿæ—¶é’Ÿçš„å·¦ä¾§ã€‚</p>
<p><a href="https://justgetflux.com/news/pages/macquickstart/" target="_blank" rel="external">å®˜ç½‘ä½¿ç”¨è¯´æ˜åœ°å€</a></p>
<h3 id="f-lux"><a href="#f-lux" class="headerlink" title="f.lux"></a>f.lux</h3><p>ç™½å¤©æ˜¯æ¯å½“å¤ªé˜³åœ¨ä½ çš„ä½ç½®ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œf.luxåœ¨6500Kç™½å¤©ï¼Œå¹¶ä¸”ä¸æ”¹å˜ä½ çš„å±å¹•çš„é¢œè‰²ã€‚</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/f.lux3.png" alt=""></figure></p>
<p>å¦‚æœä½ å–œæ¬¢å¾ˆæš–ç™½å¤©çš„é¢œè‰²ï¼Œé€‰æ‹©é€‰é¡¹&gt;æ‰©å±•ç™½å¤©è®¾ç½®ä»f.luxèœå•ã€‚</p>
<p>æ—¥è½æ—¶å¤ªé˜³å·²ç»ä¸‹å±±äº†ï¼Œä½†ä½ æ˜¯æ¸…é†’çš„ã€‚å¦‚æœä½ æ˜¯ä¸€ä¸ªæ—©èµ·çš„äººï¼Œè¿™ä¹Ÿæ˜¯ä½ çš„æ—¥å‡ºå‰çš„æ¸…æ™¨è®¾ç½®ã€‚<br>æ—¥è½çš„é¢œè‰²è¢«è®¾è®¡æˆä¸æ­£å¸¸çš„æš–ç™½å…‰å®¤å†…ç…§æ˜å¾ˆå¥½åœ°å·¥ä½œã€‚å¦‚æœå¹³æ—¶åœ¨æ—¥å‡ºå‰é†’æ¥ï¼Œä½ å¯èƒ½æ›´å–œæ¬¢ä¸€ä¸ªæ›´æ¸©å’Œçš„ï¼ˆ4500Kæˆ–äº®ï¼‰æ—¥è½è®¾ç½®ã€‚</p>
<p>ç¡å‰æ˜¯å½“ä½ ä¸ŠåºŠå‡†å¤‡ï¼ˆæˆ–å·²ç»åœ¨å®ƒï¼‰ç¡è§‰å‰çš„æ—¶é—´ã€‚<br>åœ¨ç¡å‰è®¾ç½®ä½ çš„å”¤é†’æ—¶é—´çš„å˜åŒ–ã€‚å®ƒæ¸…é™¤æ‰ï¼Œä»ä½ çš„å±å¹•å°½å¯èƒ½æé†’çš„å…‰èŠ’ä½¿ä½ èƒ½æ„Ÿè§‰åˆ°è‡ªå·±çš„èº«ä½“è¶Šæ¥è¶ŠåŒå€¦ã€‚ä½ å¯ä»¥å»ç”¨f.luxéšæ—¶éšåœ°ç¡è§‰-æ¯å½“ä½ æ„Ÿåˆ°å›°å€¦ã€‚</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/f.lux4.png" alt=""></figure></p>
<p><code>f.lux</code>çš„è‰²æ¸©è°ƒèŠ‚æœ‰ä¸‰ä¸ªæ—¶æ®µï¼Œåˆ†åˆ«æ˜¯ç™½å¤©ã€æ—¥è½å’Œç¡çœ ã€‚æ—¥è½æ—¶é—´ä¼šæ ¹æ®è®¾ç½®çš„ç»çº¬åº¦è‡ªåŠ¨è®¾ç½®ï¼Œæ¯ä¸ªæ—¶é—´æ®µçš„è‰²æ¸©å¯ä»¥è‡ªå·²å®šä¹‰ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©å³ä¸Šè§’çš„å®šä¹‰å¥½çš„æ¨¡å¼ã€‚</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/f.lux2.png" alt=""></figure></p>
<h3 id="å¤šç³»ç»Ÿæ”¯æŒ"><a href="#å¤šç³»ç»Ÿæ”¯æŒ" class="headerlink" title="å¤šç³»ç»Ÿæ”¯æŒ"></a>å¤šç³»ç»Ÿæ”¯æŒ</h3><p>ç›®å‰<code>f.lux</code> æ”¯æŒ<code>Windows</code>ã€<code>Mac</code>ã€<code>Linux</code>ä»¥åŠiOSï¼ˆè¦è¶Šç‹±ï¼‰ã€‚å‡ ä¹è¦†ç›–äº†å½“å‰ä¸»è¦çš„æ“ä½œç³»ç»Ÿï¼ŒAndroidä¹Ÿå¾ˆå¿«ä¼šæ”¯æŒã€‚</p>
<p>è¿™ä¸ªè½¯ä»¶å¾ˆå°ï¼Œè€Œä¸”è£…ä¸Šä¹‹åç³»ç»Ÿèµ„æºå ç”¨å¾ˆä½ï¼Œéå¸¸å€¼å¾—ä¸€è¯•çš„è½¯ä»¶ã€‚ä»ç°åœ¨å¼€å§‹ä¿æŠ¤ä½ çš„çœ¼ç›å§ï¼</p>

	

	

</article>





	<span class="different-posts">ğŸ“– <a href="/page/4">more posts</a> ğŸ“–</span>



	</main>

	<footer class="footer">
	<div class="footer-content">
		
	      <div class="footer__element">
	<h5>Hi there,</h5>
	<p style="text-align:justify;">my name is Yancy, they know me as RadiantğŸ‘ğŸ‘. This blog is about Bi-data and my live.<br> I like ğŸŒ³ğŸŒ³ğŸŒ³</p>
</div>


	    
	      <div class="footer__element">
	<h5>Check out</h5>
	<ul class="footer-links">
		<li class="footer-links__link"><a href="/archives">Archive</a></li>
		
		  <li class="footer-links__link"><a href="/atom.xml">RSS</a></li>
	    
		<li class="footer-links__link"><a href="/about">about page</a></li>
		<li class="footer-links__link"><a href="/tags">Tags</a></li>
		<li class="footer-links__link"><a href="/categories">Categories</a></li>
	</ul>
</div>

	    

		<div class="footer-credit">
			<span>Â© 2017 Yancy | Powered by <a href="http://blog.yancy.cc/">Yancy</a> | Theme <a href="https://github.com/yangcvo">Yancy_GitHub</a></span>
		</div>

	</div>


</footer>



</body>

</html>
