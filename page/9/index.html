<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="theme-color" content="#33474d">
	<title>Yancy&#39;s blog</title>
	<link rel="stylesheet" href="/css/style.css" />
	
      <link rel="alternate" href="/atom.xml" title="Yancy&#39;s blog" type="application/atom+xml">
    
</head>

<body>

	<header class="header">
		<nav class="header__nav">
			
				<a href="/" class="header__link">Home</a>
			
				<a href="/tags" class="header__link">Tags</a>
			
				<a href="/archives" class="header__link">ARCHIVES</a>
			
				<a href="/about/About" class="header__link">ABOUT</a>
			
				<a href="http://weibo.com/yangcvo" class="header__link">Weibo</a>
			
				<a href="/atom.xml" class="header__link">RSS</a>
			
		</nav>
		<h1 class="header__title"><a href="/">Yancy&#39;s blog</a></h1>
		<h2 class="header__subtitle">SIMPLICITY IS PREREQUISITE FOR  RELIABILITY</h2>
	</header>

	<main>
		
	<span class="different-posts different-posts_earlier">ğŸ“– <a href="/page/8">earlier posts</a> ğŸ“–</span>




	<article>
	
		<h1><a href="/2016/06/22/æ€§èƒ½ç›‘æ§/Zabbix/zabbix3-0å®ç°å¾®ä¿¡æŠ¥è­¦/">zabbix3.0å®ç°å¾®ä¿¡æŠ¥è­¦</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-06-22</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/monitoring/">monitoring</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Zabbix-monitoring/">Zabbix monitoring</a>
			</span>
		
	</div>

	

	
		<h3 id="å‰è¨€ï¼š"><a href="#å‰è¨€ï¼š" class="headerlink" title="å‰è¨€ï¼š"></a>å‰è¨€ï¼š</h3><p>  å› ä¸ºæˆ‘å·²ç»åœ¨<code>æµ‹è¯•ç¯å¢ƒ</code>å’ŒÂ·ç”Ÿäº§ç¯å¢ƒÂ·éƒ½å®ç°äº†å¾®ä¿¡å’Œé‚®ä»¶å‘Šè­¦ã€‚ä»Šå¤©æœ‰ç©ºå°±å†™äº†ç¯‡æ–‡æ¡£åæœŸå¯ä»¥åœ¨å¤ä¹ ä¸‹ï¼Œç°å®ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨é‚®ä»¶å’ŒçŸ­ä¿¡æ¥å—zabbixæŠ¥è­¦ä¿¡æ¯ï¼Œä½†æ˜¯é‚®ä»¶ç»å¸¸è¢«å·¥ä½œäººå‘˜æç½®åœ¨è§’è½ä¸­ç”šè‡³è¢«è®¾ç½®ä¸ºåƒåœ¾é‚®ä»¶è¢«è¿‡æ»¤æ‰ã€‚å…¬å¸çš„çŸ­ä¿¡æ¥å£åˆå¤ªè´µï¼Œå¤æ‚ç¯å¢ƒä¸­ä½¿ç”¨çŸ­æ¯æŠ¥è­¦ä¼šä½¿è¿ç»´æˆæœ¬å¢åŠ å¾ˆå¤šã€‚å¾®ä¿¡æä¾›äº†å¾ˆå¥½çš„ç¬¬ä¸‰æ–¹æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å¾®ä¿¡æŠ¥è­¦ä»¥æ±‚é™ä½è¿ç»´æˆæœ¬ã€‚</p>
<p>   è¿™é‡Œæˆ‘ç°åœ¨å…¬å¸ä¹Ÿç”¨ç¬¬ä¸‰æ–¹çš„<code>ç”µè¯çŸ­ä¿¡çŒ«åšå‘Šè­¦</code>ï¼Œä¸¥é‡çš„æ•…éšœä¼šç”¨çŸ­ä¿¡æ¥å‘é€åˆ°æŒ‡å®šçš„è¿ç»´äººå‘˜ã€‚è¿™æ ·å³ä½¿å¾®ä¿¡å’Œé‚®ä»¶éƒ½æ²¡æœ‰æ‰“å¼€æ”¶åˆ°ï¼ŒçŸ­ä¿¡å’Œç”µè¯ä¼šç¬¬ä¸€æ—¶é—´é€šçŸ¥ã€‚</p>
<h3 id="å¾®ä¿¡å‘Šè­¦çš„å¥½å¤„ï¼š"><a href="#å¾®ä¿¡å‘Šè­¦çš„å¥½å¤„ï¼š" class="headerlink" title="å¾®ä¿¡å‘Šè­¦çš„å¥½å¤„ï¼š"></a>å¾®ä¿¡å‘Šè­¦çš„å¥½å¤„ï¼š</h3><p>ç¬¬ä¸€ï¼šå¯ä»¥åŠæ—¶é€šçŸ¥æ—¶é—´é€šçŸ¥è¿ç»´äººå‘˜ã€‚åŠæ—¶çš„è§£å†³æ•…éšœã€‚</p>
<p>ç¬¬äºŒï¼šä¸‹ç­å‘¨æœ«è¯¾ä½™æ—¶é—´å¯ä»¥å‡†æ—¶æ¥æ”¶åˆ°ã€‚</p>
<h3 id="å®‰è£…ä¸é…ç½®ï¼š"><a href="#å®‰è£…ä¸é…ç½®ï¼š" class="headerlink" title="å®‰è£…ä¸é…ç½®ï¼š"></a>å®‰è£…ä¸é…ç½®ï¼š</h3><p>å¾®ä¿¡çš„ç¬¬ä¸‰æ–¹æ¥å£è¦æ±‚æˆ‘ä»¬å…ˆç”³è¯·ä¸€ä¸ªä¼ä¸šå·â€”â€”ä¼ é€é—¨ï¼š<a href="https://qy.weixin.qq.com/" target="_blank" rel="external">å¾®ä¿¡ä¼ä¸šå…¬ä¼—å·å¹³å°</a></p>
<p>  ç¬¬ä¸€æ­¥ï¼šç”³è¯·å¾®ä¿¡å…¬ä¼—å·<br> <figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin1.png" alt=""></figure><br> <figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin2.png" alt=""></figure><br> <figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin3.png" alt=""></figure><br> <figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin4.png" alt=""></figure><br> <figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin5.png" alt=""></figure><br> <figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin6.png" alt=""></figure><br> <figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin7.png" alt=""></figure><br> <figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin8.png" alt=""></figure><br> <figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin9.png" alt=""></figure><br> <figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin10.png" alt=""></figure></p>
<p>è¿™é‡Œè·Ÿå¾®ä¿¡ç»‘å®šåæœŸç™»é™†åªéœ€è¦æ‰«æä¸‹äºŒç»´ç å°±å¯ä»¥äº†ã€‚</p>
<p>å¦‚ä½•ç”³è¯·ä¹Ÿå¯å‚è€ƒè¿™ç¯‡æ–‡æ¡£ï¼š<a href="http://itnihao.blog.51cto.com/1741976/1733245" target="_blank" rel="external">ç”³è¯·å¾®ä¿¡å…¬ä¼—å·</a></p>
<h3 id="å¦‚ä½•æ“ä½œä¼ä¸šå·ï¼Ÿ"><a href="#å¦‚ä½•æ“ä½œä¼ä¸šå·ï¼Ÿ" class="headerlink" title="å¦‚ä½•æ“ä½œä¼ä¸šå·ï¼Ÿ"></a>å¦‚ä½•æ“ä½œä¼ä¸šå·ï¼Ÿ</h3><p>1.é€šè®¯å½•æ·»åŠ ä¼ä¸šæˆå‘˜</p>
<p> æˆ‘ä»¬è¦æå‰æŠŠæˆå‘˜ä¿¡æ¯æ·»åŠ è¿›ç»„ç»‡éƒ¨é—¨ï¼Œå¿…å¡«é¡¹+æ‰‹æœºå·æˆ–è€…å¾®ä¿¡å·ï¼Œè¿™æ ·åˆ«äººæ‰«æäºŒç»´ç çš„æ—¶å€™æ‰èƒ½æˆåŠŸå…³æ³¨ä¼ä¸šå·ã€‚<br>æ³¨æ„ï¼šè¿™é‡Œæœ‰ä¸¤ä¸ªæˆ‘ä»¬è¦ç”¨åˆ°ä¿¡æ¯ï¼Œä¸€ä¸ªç»„ç»‡éƒ¨é—¨çš„IDï¼Œä¸€ä¸ªéƒ¨é—¨æˆå‘˜çš„è´¦å·ï¼ˆè´¦å·æ˜¯è‡ªå·±æ‰‹åŠ¨æŒ‡å®šçš„ï¼Œä¸åŒäºå¾®ä¿¡å·ï¼Œæœ€å¥½æ˜¯å­—æ¯åŠ æ•°å­—ï¼‰</p>
<p> <figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin12.png" alt=""></figure><br> <figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin13.png" alt=""></figure></p>
<p> 2.åº”ç”¨ä¸­å¿ƒåˆ›å»ºåº”ç”¨</p>
<pre><code>æˆ‘ä»¬è¦åœ¨è¿™é‡Œåˆ›å»ºåº”ç”¨ï¼Œå› ä¸ºè¦é€šè¿‡åº”ç”¨å‘é€æ¶ˆæ¯ç»™éƒ¨é—¨æˆå‘˜
æ³¨æ„ï¼šè¿™é‡Œè¦è®°ä½ä¸€ä¸ªå€¼ï¼Œåº”ç”¨ID
</code></pre><p> <figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin14.png" alt=""></figure><br> <figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin15.png" alt=""></figure><br> <figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin16.png" alt=""></figure></p>
<p> 3.ç»™éƒ¨é—¨è®¾ç½®ç®¡ç†å‘˜</p>
<pre><code>è®¾ç½®---&gt;åŠŸèƒ½è®¾ç½®----&gt;æƒé™ç®¡ç†----&gt;æ–°å»ºç®¡ç†ç»„
ç®¡ç†å‘˜å¿…é¡»äº‹å…ˆå·²ç»å…³æ³¨äº†ä¼ä¸šå·ï¼Œå¹¶ä¸”å·²ç»è®¾ç½®å¥½é‚®ç®±åœ°å€  
</code></pre><p> <figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin17.png" alt=""></figure><br> <figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin18.png" alt=""></figure></p>
<p>  ç¡®å®šç®¡ç†å‘˜å¯ä»¥è¯»å–é€šè®¯å½•ï¼Œå¯ä»¥ä½¿ç”¨åº”ç”¨å‘æ¶ˆæ¯ã€‚<br>  <code>æ³¨æ„ï¼šæˆ‘ä»¬éœ€è¦ç®¡ç†å‘˜çš„CorpIDå’ŒSecret</code></p>
<p> <figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin19.png" alt=""></figure></p>
<p>   æˆ‘ä»¬è¦å‡†å¤‡è¿™äº›ä¸œè¥¿ï¼š</p>
<pre><code>ä¸€ä¸ªå¾®ä¿¡ä¼ä¸šå·
ä¼ä¸šå·å·²ç»è¢«éƒ¨é—¨æˆå‘˜å…³æ³¨
ä¼ä¸šå·é‡Œæœ‰ä¸€ä¸ªå¯ä»¥å‘æ¶ˆæ¯çš„åº”ç”¨
ä¸€ä¸ªæˆæƒç®¡ç†å‘˜ï¼Œå¯ä»¥ä½¿ç”¨è¯¥åº”ç”¨ç»™æˆå‘˜å‘æ¶ˆæ¯
</code></pre><p>æˆ‘ä»¬è¦å–åˆ°è¿™äº›ä¿¡æ¯ï¼š</p>
<pre><code>æˆå‘˜è´¦å·
ç»„ç»‡éƒ¨é—¨ID
åº”ç”¨ID
CropID
Secret
</code></pre><p>å¦‚ä½•è°ƒç”¨å¾®ä¿¡æ¥å£ï¼Ÿ</p>
<p>  è°ƒç”¨å¾®ä¿¡æ¥å£éœ€è¦ä¸€ä¸ªè°ƒç”¨æ¥å£çš„å‡­è¯ï¼šaccess_token</p>
<pre><code>é€šè¿‡ ï¼šCropID ã€Secret  æ‰èƒ½è·å–åˆ°access_tokenï¼Œä½†æ˜¯è·å–åˆ°çš„tokenæœ‰æ•ˆæœŸä¸ºä¸¤åˆ†é’Ÿ
</code></pre><p>å¾®ä¿¡ä¼ä¸šå·æ¥å£è°ƒè¯•å·¥å…·ä¼ é€é—¨ï¼š<a href="http://qydev.weixin.qq.com/debug" target="_blank" rel="external">http://qydev.weixin.qq.com/debug</a></p>
<p> <figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin20.png" alt=""></figure><br> <figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin21.png" alt=""></figure></p>
<h3 id="æµ‹è¯•æ˜¯å¦å¯é€šï¼š"><a href="#æµ‹è¯•æ˜¯å¦å¯é€šï¼š" class="headerlink" title="æµ‹è¯•æ˜¯å¦å¯é€šï¼š"></a>æµ‹è¯•æ˜¯å¦å¯é€šï¼š</h3><p>  ä½¿ç”¨ï¼š</p>
<pre><code>curl -s -G  url    è·å– AccessToke
</code></pre><p>  ä½¿ç”¨ï¼š</p>
<pre><code>curl --data  url  ä¼ é€å‡­è¯è°ƒç”¨ä¼ä¸šå·æ¥å£
</code></pre><p>è¿™é‡Œå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼š</p>
<p> curl -s -G  url  è·å– AccessTokeæ—¶å€™ä¸ºä»€ä¹ˆæˆ‘åœ¨ç”¨ä¼ä¸šå·å‘é€æ¶ˆæ¯çš„æ—¶å€™æ€»æ˜¯è¿”å›<code>{&quot;errcode&quot;:41004,&quot;errmsg&quot;:&quot;corpsecret missingâ€}</code>å‘¢ï¼Ÿ</p>
<p> <figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin22.png" alt=""></figure></p>
<p>ä¸»è¦åŸå› ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">â€œ41004â€è¯´æ˜ï¼šç¼ºå°‘secretå‚æ•°ï¼Œè¯·æ’æŸ¥ç›¸å…³é—®é¢˜ã€‚</div><div class="line"></div><div class="line">ç”¨â€œâ€æŠŠurlæ‹¬èµ·æ¥å°±OKï¼Œå³curl <span class="_">-s</span> -G <span class="string">"url"</span>ï¼Œä¼°è®¡ä½ å·²ç»è§£å†³äº†ï¼Œå¸®åŠ©åæ¥è€…å§ã€‚</div></pre></td></tr></table></figure>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin23.png" alt=""></figure></p>
<p>è¿™ä¸ªé—®é¢˜å¾ˆæ£˜æ‰‹ï¼Œä¸€å¼€å§‹å¼„æäº†ä¸€ä¸ªåŠä¸ªå°æ—¶åé¢çœ‹åˆ°ä¸€ç¯‡è¿‡æ¥äººçš„æ–‡ç« å¸®åŠ©äº†æˆ‘ï¼š<br>è¿™é‡Œæˆ‘ä¹Ÿè´´å‡ºæ¥äº†ã€‚<a href="å‚è€ƒé“¾æ¥ï¼šhttp://qydev.weixin.qq.com/qa/index.php?qa=16596&amp;qa_1=%E4%B8%BA%E4%BB%80%E4%B9%88%E6%88%91%E5%9C%A8%E7%94%A8%E4%BC%81%E4%B8%9A%E5%8F%B7%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF%E7%9A%84%E6%97%B6%E5%80%99%E6%80%BB%E6%98%AF%E8%BF%94%E5%9B%9E">å‚è€ƒæ–‡æ¡£</a></p>
<h3 id="pythonè„šæœ¬åŸç†"><a href="#pythonè„šæœ¬åŸç†" class="headerlink" title="pythonè„šæœ¬åŸç†"></a>pythonè„šæœ¬åŸç†</h3><pre><code> ä½¿ç”¨ï¼š

 self.__corpid =  corpid

 ä½¿ç”¨ï¼š

self.__secret = secret     ä¼ é€å‡­è¯è°ƒç”¨ä¼ä¸šå·æ¥å£
</code></pre><p>è„šæœ¬å·²è´´å‡ºæ¥äº†ï¼Œå¯ä»¥ä¸‹è½½ <a href="http://oak0aohum.bkt.clouddn.com/weixin4.py" target="_blank" rel="external">weixin.py</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div></pre></td><td class="code"><pre><div class="line">**<span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"></div><div class="line">import urllib,urllib2,json</div><div class="line">import sys</div><div class="line">import logging</div><div class="line">reload(sys)</div><div class="line">sys.setdefaultencoding( <span class="string">"utf-8"</span> )</div><div class="line"></div><div class="line">class WeChat(object):</div><div class="line">	__token_id = <span class="string">''</span></div><div class="line">	<span class="comment"># init attribute</span></div><div class="line">	def __init__(self,url):</div><div class="line">		self.__url = url.rstrip(<span class="string">'/'</span>)</div><div class="line">		self.__corpid = <span class="string">'xxx'</span></div><div class="line">		self.__secret = <span class="string">'xxx'</span></div><div class="line"></div><div class="line">	<span class="comment"># Get TokenID</span></div><div class="line">	def authID(self):</div><div class="line">		params = &#123;<span class="string">'corpid'</span>:self.__corpid, <span class="string">'corpsecret'</span>:self.__secret&#125;</div><div class="line">		data = urllib.urlencode(params)</div><div class="line"></div><div class="line">		content = self.getToken(data)</div><div class="line"></div><div class="line">		try:</div><div class="line">			self.__token_id = content[<span class="string">'access_token'</span>]</div><div class="line">			<span class="comment"># print content['access_token']</span></div><div class="line">		except KeyError:</div><div class="line">			raise KeyError</div><div class="line"></div><div class="line">	<span class="comment"># Establish a connection</span></div><div class="line">	def getToken(self,data,url_prefix=<span class="string">'/'</span>):</div><div class="line">		url = self.__url + url_prefix + <span class="string">'gettoken?'</span></div><div class="line">		try:</div><div class="line">			response = urllib2.Request(url + data)</div><div class="line">		except KeyError:</div><div class="line">			raise KeyError</div><div class="line">		result = urllib2.urlopen(response)</div><div class="line">		content = json.loads(result.read())</div><div class="line">		<span class="built_in">return</span> content</div><div class="line"></div><div class="line">	<span class="comment"># Get sendmessage url</span></div><div class="line">	def postData(self,data,url_prefix=<span class="string">'/'</span>):</div><div class="line">		url = self.__url + url_prefix + <span class="string">'message/send?access_token=%s'</span> % self.__token_id</div><div class="line">		request = urllib2.Request(url,data)</div><div class="line">		try:</div><div class="line">			result = urllib2.urlopen(request)</div><div class="line">		except urllib2.HTTPError as e:</div><div class="line">			<span class="keyword">if</span> hasattr(e,<span class="string">'reason'</span>):</div><div class="line">				<span class="built_in">print</span> <span class="string">'reason'</span>,e.reason</div><div class="line">			<span class="keyword">elif</span> hasattr(e,<span class="string">'code'</span>):</div><div class="line">				<span class="built_in">print</span> <span class="string">'code'</span>,e.code</div><div class="line">			<span class="built_in">return</span> 0</div><div class="line">		<span class="keyword">else</span>:</div><div class="line">			content = json.loads(result.read())</div><div class="line">			result.close()</div><div class="line">		<span class="built_in">return</span> content</div><div class="line"></div><div class="line">	<span class="comment"># send message</span></div><div class="line">	def sendMessage(self,touser,message):</div><div class="line"></div><div class="line">		self.authID()</div><div class="line"></div><div class="line">		data = json.dumps(&#123;</div><div class="line">			<span class="string">'touser'</span>:touser,</div><div class="line">			<span class="string">'toparty'</span>:<span class="string">"3"</span>,</div><div class="line">			<span class="string">'msgtype'</span>:<span class="string">"text"</span>,</div><div class="line">			<span class="string">'agentid'</span>:<span class="string">"3"</span>,</div><div class="line">			<span class="string">'text'</span>:&#123;</div><div class="line">				<span class="string">'content'</span>:message</div><div class="line">			&#125;,</div><div class="line">			<span class="string">'safe'</span>:<span class="string">"0"</span></div><div class="line">		&#125;,ensure_ascii=False)</div><div class="line"></div><div class="line">		response = self.postData(data)</div><div class="line"></div><div class="line">		log_file = <span class="string">"/home/zabbix/weixin.log"</span></div><div class="line"></div><div class="line">		logging.basicConfig(filename=log_file,filemode=<span class="string">'a'</span>,level=logging.DEBUG)</div><div class="line">		logging.info(data)</div><div class="line">		logging.debug(response)</div><div class="line">		<span class="built_in">print</span> response</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">        <span class="keyword">if</span> len(sys.argv) != 4:</div><div class="line">            <span class="built_in">print</span> <span class="string">'error segments, now exit'</span></div><div class="line">            sys.exit()</div><div class="line">	a = WeChat(<span class="string">'https://qyapi.weixin.qq.com/cgi-bin'</span>)</div><div class="line">	a.sendMessage(sys.argv[1],sys.argv[3])</div></pre></td></tr></table></figure>
<pre><code>log_file = &quot;/home/zabbix/weixin.log&quot; å¾®ä¿¡æ—¥å¿—
&apos;toparty&apos;:&quot;3&quot;,

 &apos;agentid&apos;:&quot;3&quot;, è¿™é‡Œ3 æ˜¯æˆ‘è¿™è¾¹åº”ç”¨ID 3
touserå¦æˆå‘˜IDåˆ—è¡¨ï¼ˆæ¶ˆæ¯æ¥æ”¶è€…ï¼Œå¤šä¸ªæ¥æ”¶è€…ç”¨â€˜|â€™åˆ†éš”ï¼Œæœ€å¤šæ”¯æŒ1000ä¸ªï¼‰ã€‚ç‰¹æ®Šæƒ…å†µï¼šæŒ‡å®šä¸º@allï¼Œåˆ™å‘å…³æ³¨è¯¥ä¼ä¸šåº”ç”¨çš„å…¨éƒ¨æˆå‘˜å‘é€
topartyå¦éƒ¨é—¨IDåˆ—è¡¨ï¼Œå¤šä¸ªæ¥æ”¶è€…ç”¨â€˜|â€™åˆ†éš”ï¼Œæœ€å¤šæ”¯æŒ100ä¸ªã€‚å½“touserä¸º@allæ—¶å¿½ç•¥æœ¬å‚æ•°
totagå¦æ ‡ç­¾IDåˆ—è¡¨ï¼Œå¤šä¸ªæ¥æ”¶è€…ç”¨â€˜|â€™åˆ†éš”ã€‚å½“touserä¸º@allæ—¶å¿½ç•¥æœ¬å‚æ•°
msgtypeæ˜¯æ¶ˆæ¯ç±»å‹ï¼Œæ­¤æ—¶å›ºå®šä¸ºï¼štext
agentidæ˜¯ä¼ä¸šåº”ç”¨çš„idï¼Œæ•´å‹ã€‚å¯åœ¨åº”ç”¨çš„è®¾ç½®é¡µé¢æŸ¥çœ‹
contentæ˜¯æ¶ˆæ¯å†…å®¹
safeå¦è¡¨ç¤ºæ˜¯å¦æ˜¯ä¿å¯†æ¶ˆæ¯ï¼Œ0è¡¨ç¤ºå¦ï¼Œ1è¡¨ç¤ºæ˜¯ï¼Œé»˜è®¤0


&quot;touser&quot;:&quot;touser&quot;,   #ä¼ä¸šå·ä¸­çš„ç”¨æˆ·å¸å·ï¼Œåœ¨zabbixç”¨æˆ·Mediaä¸­é…ç½®ï¼Œå¦‚æœé…ç½®ä¸æ­£å¸¸ï¼Œå°†æŒ‰éƒ¨é—¨å‘é€ã€‚
æ–‡ä¸­ä½¿ç”¨çš„ç”¨æˆ·, toparty éƒ¨é—¨iDä¸º3ï¼Œagentid åº”ç”¨IDä¸º3.
</code></pre><h3 id="ä¸ºä»€ä¹ˆè¦è¿™æ ·å†™è„šæœ¬ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦è¿™æ ·å†™è„šæœ¬ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦è¿™æ ·å†™è„šæœ¬ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦è¿™æ ·å†™è„šæœ¬ï¼Ÿ</h3><p>å› ä¸ºå¾®ä¿¡ä¼ä¸šå·å¼€æ”¾çš„ç«¯å£æœ‰å›ºå®šçš„æ ¼å¼é™åˆ¶<br> ä¼ä¸šå·æ”¯æŒçš„æ ¼å¼ï¼š<a href="http://qydev.weixin.qq.com/wiki/index.php?title=æ¶ˆæ¯ç±»å‹åŠæ•°æ®æ ¼å¼" target="_blank" rel="external">http://qydev.weixin.qq.com/wiki/index.php?title=æ¶ˆæ¯ç±»å‹åŠæ•°æ®æ ¼å¼</a></p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin24.png" alt=""></figure></p>
<p>å°†è„šæœ¬æ”¾å…¥zabbixé»˜è®¤æ‰§è¡Œè·¯å¾„ä¸‹</p>
<pre><code>mv weixin.sh /usr/local/zabbix/share/zabbix/alertscripts
chown zabbix.zabbix /usr/local/zabbix/share/zabbix/alertscripts/weixin.py
chmod +x /usr/local/zabbix/share/zabbix/alertscripts/weixin.py
</code></pre><hr>
<p>åˆ°è¿™é‡Œä¸Šé¢åŸºæœ¬çš„å·²ç»é…ç½®å®Œæ¯•äº†ã€‚</p>
<h3 id="æµ‹è¯•è„šæœ¬æ˜¯å¦å¯ä»¥å‘é€æˆåŠŸæ¶ˆæ¯"><a href="#æµ‹è¯•è„šæœ¬æ˜¯å¦å¯ä»¥å‘é€æˆåŠŸæ¶ˆæ¯" class="headerlink" title="æµ‹è¯•è„šæœ¬æ˜¯å¦å¯ä»¥å‘é€æˆåŠŸæ¶ˆæ¯"></a>æµ‹è¯•è„šæœ¬æ˜¯å¦å¯ä»¥å‘é€æˆåŠŸæ¶ˆæ¯</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@salt alertscripts]<span class="comment"># python weixin.py test world!</span></div><div class="line">&#123;<span class="string">u'errcode'</span>: <span class="number">60011</span>, <span class="string">u'errmsg'</span>: <span class="string">u'no privilege to access/modify contact/party/agent '</span>&#125;</div></pre></td></tr></table></figure>
<p>å‡ºç°æˆ‘æ˜¯ä¼ä¸šå·ä½“éªŒè´¦æˆ· æˆ‘å‘é€æ¶ˆæ¯ï¼šå¾®ä¿¡é”™è¯¯ errcode=60011. å¯å‚è€ƒï¼š<a href="http://qydev.weixin.qq.com/qa/index.php?qa=3197&amp;qa_1=%E6%88%91%E6%98%AF%E4%BC%81%E4%B8%9A%E5%8F%B7%E4%BD%93%E9%AA%8C%E8%B4%A6%E6%88%B7-%E6%88%91%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF%EF%BC%9A%E5%BE%AE%E4%BF%A1%E9%94%99%E8%AF%AF&amp;show=3197#q3197" target="_blank" rel="external">å¾®ä¿¡é”™è¯¯ errcode=60011</a></p>
<p>æˆ‘è¿™é‡Œçš„åŸå› æ˜¯åº”ç”¨IDä¸€å¼€å§‹å†™1ï¼Œåæ¥æ”¹æˆ3æµ‹è¯•å°±é€šäº†ã€‚</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@salt alertscripts]<span class="comment"># python weixin.py test hello world!</span></div><div class="line">&#123;<span class="string">u'invaliduser'</span>: <span class="string">u'all user invalid'</span>, <span class="string">u'errcode'</span>: <span class="number">0</span>, <span class="string">u'errmsg'</span>: <span class="string">u'ok'</span>&#125;</div></pre></td></tr></table></figure>
<p>è¿™é‡Œç”¨æˆ·å…³æ³¨äº†ä»¥åï¼š</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@salt alertscripts]<span class="comment"># python weixin.py jinyu hello world!</span></div><div class="line">&#123;<span class="string">u'errcode'</span>: <span class="number">0</span>, <span class="string">u'errmsg'</span>: <span class="string">u'ok'</span>&#125;</div></pre></td></tr></table></figure>
<h3 id="webæœåŠ¡ç«¯é…ç½®ï¼š"><a href="#webæœåŠ¡ç«¯é…ç½®ï¼š" class="headerlink" title="webæœåŠ¡ç«¯é…ç½®ï¼š"></a>webæœåŠ¡ç«¯é…ç½®ï¼š</h3><p>è‡³æ­¤å·¥å…·å®‰è£…å®Œæˆï¼Œåœ¨zabbixç•Œé¢é‡Œæ·»åŠ è„šæœ¬å‘Šè­¦</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin25.png" alt=""></figure></p>
<p>è®¾ç½®è„šæœ¬ï¼Œè„šæœ¬åç§°ä¸ºå·¥å…·åç§°ï¼Œè®¾ç½®å¥½ç‚¹æ·»åŠ æŒ‰é’®</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin26.png" alt=""></figure></p>
<p>æ·»åŠ æ–°çš„æŠ¥è­¦åª’ä»‹åˆ°ç”¨æˆ·ï¼Œæˆ‘ä»¥Adminç”¨æˆ·ä¸ºä¾‹</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin27.png" alt=""></figure><br>æ·»åŠ </p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin28.png" alt=""></figure></p>
<p>é€‰æ‹©åˆšæ‰çš„åª’ä»‹ï¼Œæ”¶ä»¶äººä¸ºæˆ‘æä¾›çš„UserIDï¼Œå¤šä¸ªç”¨æˆ·ç”¨ï½œéš”å¼€</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin29.png" alt=""></figure></p>
<p>æ·»åŠ åä¸€ç‚¹è¦ç‚¹æ›´æ–°</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin30.png" alt=""></figure></p>
<p>æˆ‘ä»¬åœ¨è¿™é‡Œç‹¬ç«‹è®¾ç½®ä¸€ä¸ªActionï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥åœ¨é»˜è®¤çš„Actioné‡Œæ·»åŠ </p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin31.png" alt=""></figure></p>
<p>åç§°ä¸ºweixin</p>
<p>å‘Šè­¦æ¶ˆæ¯çš„æ ¼å¼ï¼Œå¤§å®¶å¯ä»¥æ ¹æ®è‡ªå·±éœ€æ±‚å…·ä½“è®¾ç½®ï¼Œä¸‹é¢æ˜¯æˆ‘çš„è®¾ç½®<br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin32.png" alt=""></figure></p>
<p>é»˜è®¤æ¥æ”¶äººï¼šæ•…éšœ{TRIGGER.STATUS},æœåŠ¡å™¨:{HOSTNAME1}å‘ç”Ÿ: {TRIGGER.NAME}æ•…éšœ!</p>
<p>é»˜è®¤ä¿¡æ¯ï¼š</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="xml">å‘Šè­¦ä¸»æœº:</span><span class="template-variable">&#123;HOSTNAME1&#125;</span><span class="xml"></span></div><div class="line">å‘Šè­¦æ—¶é—´:<span class="template-variable">&#123;EVENT.DATE&#125;</span><span class="xml"> </span><span class="template-variable">&#123;EVENT.TIME&#125;</span><span class="xml"></span></div><div class="line">å‘Šè­¦ç­‰çº§:<span class="template-variable">&#123;TRIGGER.SEVERITY&#125;</span><span class="xml"></span></div><div class="line">å‘Šè­¦ä¿¡æ¯: <span class="template-variable">&#123;TRIGGER.NAME&#125;</span><span class="xml"></span></div><div class="line">å‘Šè­¦é¡¹ç›®:<span class="template-variable">&#123;TRIGGER.KEY1&#125;</span><span class="xml"></span></div><div class="line">é—®é¢˜è¯¦æƒ…:<span class="template-variable">&#123;ITEM.NAME&#125;</span><span class="xml">:</span><span class="template-variable">&#123;ITEM.VALUE&#125;</span><span class="xml"></span></div><div class="line">å‰çŠ¶æ€:<span class="template-variable">&#123;TRIGGER.STATUS&#125;</span><span class="xml">:</span><span class="template-variable">&#123;ITEM.VALUE1&#125;</span><span class="xml"></span></div><div class="line">äº‹ä»¶ID:<span class="template-variable">&#123;EVENT.ID&#125;</span><span class="xml"></span></div><div class="line"></div><div class="line">æ¢å¤ä¸»æ—¨ï¼šæ¢å¤<span class="template-variable">&#123;TRIGGER.STATUS&#125;</span><span class="xml">, æœåŠ¡å™¨:</span><span class="template-variable">&#123;HOSTNAME1&#125;</span><span class="xml">: </span><span class="template-variable">&#123;TRIGGER.NAME&#125;</span><span class="xml">å·²æ¢å¤!</span></div><div class="line"></div><div class="line">æ¢å¤ä¿¡æ¯ï¼š</div><div class="line"></div><div class="line">å‘Šè­¦ä¸»æœº:<span class="template-variable">&#123;HOSTNAME1&#125;</span><span class="xml"></span></div><div class="line">å‘Šè­¦æ—¶é—´:<span class="template-variable">&#123;EVENT.DATE&#125;</span><span class="xml"> </span><span class="template-variable">&#123;EVENT.TIME&#125;</span><span class="xml"></span></div><div class="line">å‘Šè­¦ç­‰çº§:<span class="template-variable">&#123;TRIGGER.SEVERITY&#125;</span><span class="xml"></span></div><div class="line">å‘Šè­¦ä¿¡æ¯: <span class="template-variable">&#123;TRIGGER.NAME&#125;</span><span class="xml"></span></div><div class="line">å‘Šè­¦é¡¹ç›®:<span class="template-variable">&#123;TRIGGER.KEY1&#125;</span><span class="xml"></span></div><div class="line">é—®é¢˜è¯¦æƒ…:<span class="template-variable">&#123;ITEM.NAME&#125;</span><span class="xml">:</span><span class="template-variable">&#123;ITEM.VALUE&#125;</span><span class="xml"></span></div><div class="line">å½“å‰çŠ¶æ€:<span class="template-variable">&#123;TRIGGER.STATUS&#125;</span><span class="xml">:</span><span class="template-variable">&#123;ITEM.VALUE1&#125;</span><span class="xml"></span></div><div class="line">äº‹ä»¶ID:<span class="template-variable">&#123;EVENT.ID&#125;</span><span class="xml"></span></div></pre></td></tr></table></figure>
<p>åˆ‡æ¢åˆ°æ“ä½œæ ‡ç­¾ï¼Œæ·»åŠ æ“ä½œ<br>é€‰æ‹©å‘é€åˆ°Adminç”¨æˆ·ï¼Œåªä½¿ç”¨weixinï¼Œé€‰æ‹©å¥½ä¹‹åç‚¹æ·»åŠ ,è¿™é‡Œæˆ‘å·²ç»æ·»åŠ è¿‡äº†ï¼Œæ‰€ä»¥æç¤ºæ›´æ–°ã€‚<br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin33.png" alt=""></figure><br>è®¾ç½®å¥½ä¹‹åå¦‚ä¸‹ï¼Œç‚¹æ·»åŠ </p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin35.png" alt=""></figure></p>
<p>ç»è¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œå°±å®Œæˆäº†é…ç½®ï¼Œå°±å¯ä»¥ä½¿ç”¨zabbixæ¥å‘Šè­¦å•¦ï¼Œç”¨ddå‘½ä»¤æµ‹è¯•ä¸‹ç£ç›˜i/oå‘Šè­¦ï¼Œä¸€ä¼šå°±ä¼šçœ‹åˆ°å¾®ä¿¡ä¸Šå‘è¿‡æ¥çš„å‘Šè­¦ä¿¡æ¯</p>
<pre><code>dd if=/dev/zero of=/tmp/test2.img bs=1024M count=1000 oflag=dsync
</code></pre><h3 id="è¯¾å¤–æ™®åŠï¼š"><a href="#è¯¾å¤–æ™®åŠï¼š" class="headerlink" title="è¯¾å¤–æ™®åŠï¼š"></a>è¯¾å¤–æ™®åŠï¼š</h3><p>æ™®åŠï¼š</p>
<p>å¦‚ä½•æ­£ç¡®ä½¿ç”¨ddå·¥å…·æµ‹è¯•ç£ç›˜çš„I/Oé€Ÿåº¦</p>
<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½æ˜¯ä½¿ç”¨ddå‘½ä»¤åˆ›å»ºä¸€ä¸ªå¤§æ–‡ä»¶æ¥æµ‹è¯•ç£ç›˜çš„è¯»å†™é€Ÿåº¦ã€‚ä½†æ˜¯ï¼Œå¾ˆå¤šäººéƒ½å­˜åœ¨ä¸€ä¸ªè¯¯åŒºï¼Œä»¥ä¸ºddå‘½ä»¤æ˜¾ç¤ºçš„é€Ÿåº¦å°±æ˜¯ç£ç›˜çš„å†™å…¥é€Ÿåº¦ï¼Œå…¶å®è¿™æ˜¯ä¸ç„¶çš„ã€‚æˆ‘ä»¬åˆ†æä¸€ä¸‹ddå‘½ä»¤æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p>
<ol>
<li>dd if=/dev/zero of=/xiaohan/test.iso bs=1024M count=1</li>
</ol>
<p>è¿™ç§æƒ…å†µä¸‹æµ‹è¯•æ˜¾ç¤ºçš„é€Ÿåº¦æ˜¯ddå‘½ä»¤å°†æ•°æ®å†™å…¥åˆ°å†…å­˜ç¼“å†²åŒºä¸­çš„é€Ÿåº¦ï¼Œåªæœ‰å½“æ•°æ®å†™å…¥å†…å­˜ç¼“å†²åŒºå®Œæˆåï¼Œæ‰å¼€å§‹å°†æ•°æ®åˆ·å…¥ç¡¬ç›˜ï¼Œæ‰€ä»¥è¿™æ—¶å€™çš„æ•°æ®æ˜¯æ— æ³•æ­£ç¡®è¡¡é‡ç£ç›˜å†™å…¥é€Ÿåº¦çš„ã€‚</p>
<ol>
<li>dd if=/dev/zero of=/xiaohan/test.iso bs=1024M count=1;sync</li>
</ol>
<p>è¿™ç§æƒ…å†µä¸‹æµ‹è¯•æ˜¾ç¤ºçš„è·Ÿä¸Šä¸€ç§æƒ…å†µæ˜¯ä¸€æ ·çš„ï¼Œä¸¤ä¸ªå‘½ä»¤æ˜¯å…ˆåæ‰§è¡Œçš„ï¼Œå½“syncå¼€å§‹æ‰§è¡Œçš„æ—¶å€™ï¼Œddå‘½ä»¤å·²ç»å°†é€Ÿåº¦ä¿¡æ¯æ‰“å°åˆ°äº†å±å¹•ä¸Šï¼Œä»ç„¶æ— æ³•æ˜¾ç¤ºä»å†…å­˜å†™ç¡¬ç›˜æ—¶çš„çœŸæ­£é€Ÿåº¦ã€‚</p>
<ol>
<li>dd if=/dev/zero of=/xiaohan/test.iso bs=1024M count=1 conv=fdatasync</li>
</ol>
<p>è¿™ç§æƒ…å†µåŠ å…¥è¿™ä¸ªå‚æ•°åï¼Œddå‘½ä»¤æ‰§è¡Œåˆ°æœ€åä¼šçœŸæ­£æ‰§è¡Œä¸€æ¬¡â€œåŒæ­¥(sync)â€æ“ä½œï¼Œæ‰€ä»¥è¿™æ—¶å€™ä½ å¾—åˆ°çš„æ˜¯è¯»å–è¿™128Mæ•°æ®åˆ°å†…å­˜å¹¶å†™å…¥åˆ°ç£ç›˜ä¸Šæ‰€éœ€çš„æ—¶é—´ï¼Œè¿™æ ·ç®—å‡ºæ¥çš„æ—¶é—´æ‰æ˜¯æ¯”è¾ƒç¬¦åˆå®é™…çš„ã€‚</p>
<ol>
<li>dd if=/dev/zero of=/xiaohan/test.iso bs=1024M count=1 oflag=dsync</li>
</ol>
<p>è¿™ç§æƒ…å†µä¸‹ï¼Œddåœ¨æ‰§è¡Œæ—¶æ¯æ¬¡éƒ½ä¼šè¿›è¡ŒåŒæ­¥å†™å…¥æ“ä½œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™æ¡å‘½ä»¤æ¯æ¬¡è¯»å–1Måå°±è¦å…ˆæŠŠè¿™1Må†™å…¥ç£ç›˜ï¼Œç„¶åå†è¯»å–ä¸‹é¢è¿™1Mï¼Œä¸€å…±é‡å¤128æ¬¡ã€‚è¿™å¯èƒ½æ˜¯æœ€æ…¢çš„ä¸€ç§æ–¹å¼ï¼ŒåŸºæœ¬ä¸Šæ²¡æœ‰ç”¨åˆ°å†™ç¼“å­˜(write cache)ã€‚</p>
<p>æ€»ç»“ï¼š</p>
<p>å»ºè®®ä½¿ç”¨æµ‹è¯•å†™é€Ÿåº¦çš„æ–¹å¼ä¸ºï¼š</p>
<p>dd if=/dev/zero of=/xiaohan/test.iso bs=1024M count=1 conv=fdatasync</p>
<p>å»ºè®®ä½¿ç”¨æµ‹è¯•è¯»é€Ÿåº¦çš„æ–¹å¼ä¸ºï¼š</p>
<p>dd if=/xiaohan/test.iso of=/dev/zero bs=1024M count=1 iflag=direct</p>
<p>*æ³¨ï¼šè¦æ­£ç¡®æµ‹è¯•ç£ç›˜è¯»å†™èƒ½åŠ›ï¼Œå»ºè®®æµ‹è¯•æ–‡ä»¶çš„å¤§å°è¦è¿œè¿œå¤§äºå†…å­˜çš„å®¹é‡ï¼ï¼ï¼</p>
<h3 id="PSï¼šåç»­è®¡åˆ’"><a href="#PSï¼šåç»­è®¡åˆ’" class="headerlink" title="PSï¼šåç»­è®¡åˆ’"></a>PSï¼šåç»­è®¡åˆ’</h3><p>1.åç»­å¯èƒ½ä¼šå¢åŠ å‘é€æ¬¡æ•°è®¡æ•°ï¼Œæ–¹ä¾¿ç®¡ç†ç”¨æˆ·</p>
<p>2.æ·»åŠ æŸ¥è¯¢æ“ä½œåˆ°å¾®ä¿¡ï¼Œé’ˆå¯¹ç”¨æˆ·å®šåˆ¶å¼€å‘ã€‚å¯é€šè¿‡å¾®ä¿¡æŸ¥è¯¢zabbixæœåŠ¡å™¨é‡Œç›‘æ§ä¸»æœºçš„çŠ¶æ€ï¼Œé€šè¿‡å¾®ä¿¡ç®€å•æ“ä½œzabbixã€‚</p>
<h3 id="é¢„è§ˆ"><a href="#é¢„è§ˆ" class="headerlink" title="é¢„è§ˆ"></a>é¢„è§ˆ</h3><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin38.png" alt=""></figure></p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin39.jpg" alt=""></figure></p>
<h3 id="æ³¨æ„äº‹é¡¹åŠæŠ¥é”™å¤„ç†"><a href="#æ³¨æ„äº‹é¡¹åŠæŠ¥é”™å¤„ç†" class="headerlink" title="æ³¨æ„äº‹é¡¹åŠæŠ¥é”™å¤„ç†"></a>æ³¨æ„äº‹é¡¹åŠæŠ¥é”™å¤„ç†</h3><pre><code> #Zabbix-webé¡µé¢æ–°å¢ç”¨æˆ·æƒé™å¤„ç†ï¼Œå‘é€å¯¹è±¡é€‰æ‹©ï¼ˆç”¨æˆ·çš„åç§°ï¼‰

#åº”ç”¨å½“ä¸­å¯è§èŒƒå›´é€‰æ‹©æ³¨æ„ï¼ˆé€‰è¿™è¦å‘é€çš„å¯¹è±¡ï¼ˆéƒ¨é—¨ï¼ŒåŠéƒ¨é—¨æˆå‘˜ï¼‰ï¼‰
</code></pre><p> zabbix-server2.4æœåŠ¡ç«¯ç¼–è¯‘å®‰è£… <a href="http://blog.yangcvo.me/2015/01/18/zabbix-serveræœåŠ¡ç«¯ç¼–è¯‘å®‰è£…/" target="_blank" rel="external">zabbix-serveræœåŠ¡ç«¯ç¼–è¯‘å®‰è£…</a></p>
<p>zabbix2.4ç›‘æ§80ç«¯å£çŠ¶æ€ : <a href="http://blog.yangcvo.me/2016/07/20/zabbixç›‘æ§80ç«¯å£çŠ¶æ€/" target="_blank" rel="external">zabbixç›‘æ§80ç«¯å£çŠ¶æ€</a></p>
<p>zabbix+Grafanaå®‰è£…ä½¿ç”¨ç›‘æ§ç»“åˆ ï¼š<a href="http://blog.yangcvo.me/2016/07/13/zabbix-Grafanaå®‰è£…ä½¿ç”¨ç»“åˆ/" target="_blank" rel="external">zabbix+Grafanaå®‰è£…ä½¿ç”¨ç›‘æ§ç»“åˆ</a></p>
<p>zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹ : <a href="http://blog.yangcvo.me/2015/09/29/zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹/" target="_blank" rel="external">zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹</a></p>
<p>zabbixçš„ICMP_Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§ : <a href="http://blog.yangcvo.me/2015/11/18/zabbixçš„ICMP-Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§/" target="_blank" rel="external">zabbixçš„ICMP_Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§</a></p>
<p>zabbixæ€§èƒ½ç›‘æ§æ•…éšœæ€»ç»“ <a href="http://blog.yangcvo.me/2016/02/07/zabbix-æ•…éšœæ€»ç»“/" target="_blank" rel="external">zabbixæ€§èƒ½ç›‘æ§æ•…éšœæ€»ç»“</a></p>

	

	

</article>




	<article>
	
		<h1><a href="/2016/06/21/æ€§èƒ½ç›‘æ§/Zabbix/zabbix3-0éƒ¨ç½²jmxç›‘æ§tomcat/">zabbix3.0éƒ¨ç½²jmxç›‘æ§tomcat</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-06-21</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/monitoring/">monitoring</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Zabbix-monitoring/">Zabbix monitoring</a>
			</span>
		
	</div>

	

	
		<p>zabbixæä¾›äº†ä¸€ä¸ªjava gatewayçš„åº”ç”¨å»ç›‘æ§jmxï¼ˆJava Management Extensionsï¼Œå³Javaç®¡ç†æ‰©å±•ï¼‰æ˜¯ä¸€ä¸ªä¸ºåº”ç”¨ç¨‹åºã€è®¾å¤‡ã€ç³»ç»Ÿç­‰æ¤å…¥ç®¡ç†åŠŸèƒ½çš„æ¡†æ¶ã€‚JMXå¯ä»¥è·¨è¶Šä¸€ç³»åˆ—å¼‚æ„æ“ä½œç³»ç»Ÿå¹³å°ã€ç³»ç»Ÿä½“ç³»ç»“æ„å’Œç½‘ç»œä¼ è¾“åè®®ï¼Œçµæ´»çš„å¼€å‘æ— ç¼é›†æˆçš„ç³»ç»Ÿã€ç½‘ç»œå’ŒæœåŠ¡ç®¡ç†åº”ç”¨ã€‚</p>
<h2 id="ä¸€-Zabbix-çš„JMXç›‘æ§æ¶æ„"><a href="#ä¸€-Zabbix-çš„JMXç›‘æ§æ¶æ„" class="headerlink" title="ä¸€. Zabbix çš„JMXç›‘æ§æ¶æ„"></a>ä¸€. Zabbix çš„JMXç›‘æ§æ¶æ„</h2><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-tomcat1.png" alt=""></figure></p>
<h3 id="ä¸€ï¼šéƒ¨ç½²ç¯å¢ƒ"><a href="#ä¸€ï¼šéƒ¨ç½²ç¯å¢ƒ" class="headerlink" title="ä¸€ï¼šéƒ¨ç½²ç¯å¢ƒ"></a>ä¸€ï¼šéƒ¨ç½²ç¯å¢ƒ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Centos   6.7</div><div class="line">Zabbix     3.0.3</div><div class="line">Tomcat     7.0.55</div></pre></td></tr></table></figure>
<h3 id="æœåŠ¡ç«¯é…ç½®"><a href="#æœåŠ¡ç«¯é…ç½®" class="headerlink" title="æœåŠ¡ç«¯é…ç½®"></a>æœåŠ¡ç«¯é…ç½®</h3><h3 id="1ã€å®‰è£…jdkï¼ˆç‰ˆæœ¬1-7-0-79ï¼‰"><a href="#1ã€å®‰è£…jdkï¼ˆç‰ˆæœ¬1-7-0-79ï¼‰" class="headerlink" title="1ã€å®‰è£…jdkï¼ˆç‰ˆæœ¬1.7.0_79ï¼‰"></a>1ã€å®‰è£…jdkï¼ˆç‰ˆæœ¬1.7.0_79ï¼‰</h3><p>JDK å„è‡ªçš„ç‰ˆæœ¬7.0 è¿˜æ˜¯8.0 ç‰ˆæœ¬å®˜ç½‘ä¸‹è½½ï¼š<a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html" target="_blank" rel="external">JDK</a></p>
<p>æˆ‘è¿™é‡Œä¹Ÿä¸Šä¼ äº†7.0.67 ç‰ˆæœ¬çš„å’Œ8.0ç‰ˆæœ¬çš„jdkæºç åŒ…ï¼š</p>
<p><a href="http://oak0aohum.bkt.clouddn.com/jdk1.7.0_67.tar.gz" target="_blank" rel="external">7.0JDKæºç åŒ…</a></p>
<p><a href="http://oak0aohum.bkt.clouddn.com/jdk1.8.0_66.tar.gz" target="_blank" rel="external">8.0JDKæºç åŒ…</a></p>
<p>å¹¶ä¸Šä¼ åˆ°zabbix server</p>
<p>ç›´æ¥è§£å‹ä¸‹è½½ä¸‹æ¥çš„åŒ…åˆ°è‡ªå®šä¹‰çš„ç›®å½•ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tar -zxvf jdk1.7.0_67.tar.gz -C /srv/</div></pre></td></tr></table></figure>
<p>å®‰è£…æˆåŠŸä¹‹åæ·»åŠ ç³»ç»Ÿç¯å¢ƒå˜é‡</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="built_in">cd</span> /etc/profile.d</div><div class="line">vim java.sh</div><div class="line"><span class="built_in">export</span> JAVA_HOME=/srv/jdk1.7.0_67</div><div class="line"><span class="built_in">export</span> CLASS_PATH=<span class="string">"<span class="variable">$JAVA_HOME</span>/lib:<span class="variable">$JAVA_HOME</span>/jre/lib"</span></div><div class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin</div></pre></td></tr></table></figure>
<p>ä½¿é…ç½®ç”Ÿæ•ˆ</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">source</span> <span class="regexp">/etc/</span>profile</div></pre></td></tr></table></figure>
<p>å®‰è£…ä¸é…ç½®æ¯”è¾ƒç®€å•ã€‚æ‰§è¡Œjava -versionå‘½ä»¤ï¼Œå‡ºç°ç±»ä¼¼ç•Œé¢è¡¨ç¤ºæˆåŠŸã€‚</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">java </span>-version</div><div class="line"><span class="keyword">java </span>version <span class="string">"1.7.0_67"</span></div><div class="line"><span class="keyword">Java(TM) </span>SE Runtime Environment (<span class="keyword">build </span><span class="number">1</span>.<span class="number">7</span>.<span class="number">0</span>_67-<span class="keyword">b01)</span></div><div class="line"><span class="keyword">Java </span>HotSpot(TM) <span class="number">64</span>-<span class="keyword">Bit </span>Server VM (<span class="keyword">build </span><span class="number">24</span>.<span class="number">65</span>-<span class="keyword">b04, </span>mixed mode)</div></pre></td></tr></table></figure>
<p>å¦‚æœå‡ºç°é—®é¢˜ï¼ŒæŸ¥çœ‹ä¸‹ç¯å¢ƒå˜é‡æ˜¯å¦è®¾ç½®ã€‚</p>
<h3 id="2ã€å®‰è£…Zabbix-Java-gateway"><a href="#2ã€å®‰è£…Zabbix-Java-gateway" class="headerlink" title="2ã€å®‰è£…Zabbix-Java-gateway"></a>2ã€å®‰è£…<code>Zabbix-Java-gateway</code></h3><p>Zabbix2.0èµ·æ·»åŠ äº†æ”¯æŒç”¨äºç›‘æ§JMXåº”ç”¨ç¨‹åºçš„æœåŠ¡è¿›ç¨‹ï¼Œç§°ä¸ºâ€œZabbix-Java-gatewayâ€ï¼Œå®ƒæ˜¯ç”¨javaå†™çš„ä¸€ä¸ªç¨‹åºã€‚</p>
<p>å¯ä½¿ç”¨rpmè¿›è¡Œå®‰è£…ï¼Œæˆ‘ä½¿ç”¨æºç å®‰è£…ï¼Œå¤§å®¶å¯åœ¨å®‰è£…zabbixæ—¶å¯ç”¨â€“enable-javaå‚æ•°å³å¯å®‰è£…zabbix java gatewayï¼Œå¦‚æœç¬¬ä¸€æ¬¡æ²¡æœ‰åŠ è½½ï¼Œå¯é‡æ–°åŠ è½½ç¼–è¯‘å®‰è£…</p>
<p>æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥å®‰è£…Zabbix-Java-gatewayï¼Œç¬¬1ç§æ˜¯ç¼–è¯‘å®‰è£…zabbixæ—¶æ·»åŠ â€“enable javaå‚æ•°ã€‚ç¬¬2ç§æ˜¯å•ç‹¬å®‰è£…ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>ç¬¬ä¸€ç§æ–¹æ³•</code>ï¼š</li>
</ul>
<p>å®‰è£…gatewayï¼Œéœ€è¦javaï¼Œjava-develä¾èµ–</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">yumã€€installã€€ï¼ï½™ã€€</div><div class="line">http://repo.zabbix.com/zabbix/2.4/rhel/6/x86_64/zabbix-release-2.4-1.el6.noarch.rpmã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€    å®‰è£…yumæº</div><div class="line">yum install -y  java  java-devel  zabbix-java-gatewayã€€ã€€å®‰è£…gateway</div></pre></td></tr></table></figure>
<p>æµ‹è¯•æ˜¯å¦æˆåŠŸï¼š</p>
<p>ç¬¬ä¸€ï¼šæµ‹è¯•javaæ˜¯å¦æˆåŠŸ</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">java </span>-version</div><div class="line"><span class="keyword">java </span>version <span class="string">"1.7.0_67"</span></div><div class="line"><span class="keyword">Java(TM) </span>SE Runtime Environment (<span class="keyword">build </span><span class="number">1</span>.<span class="number">7</span>.<span class="number">0</span>_67-<span class="keyword">b01)</span></div><div class="line"><span class="keyword">Java </span>HotSpot(TM) <span class="number">64</span>-<span class="keyword">Bit </span>Server VM (<span class="keyword">build </span><span class="number">24</span>.<span class="number">65</span>-<span class="keyword">b04, </span>mixed mode)</div></pre></td></tr></table></figure>
<p>ç¬¬äºŒï¼šæµ‹è¯•gatewayæ˜¯å¦å®‰è£…æˆåŠŸ</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">service zabbix-java-gateway <span class="built_in">status</span></div><div class="line">zabbix-java-gateway <span class="built_in">is</span> stopped</div></pre></td></tr></table></figure>
<ul>
<li><code>ç¬¬äºŒç§æ–¹æ³•</code>ï¼š</li>
</ul>
<p>æˆ‘è¿™é‡Œå‡çº§3.0.3ç‰ˆæœ¬çš„æ—¶å€™å·²ç»å®‰è£…å¥½äº†ã€‚æ‰€ä»¥å¦‚æœæ²¡æœ‰å®‰è£…ä¸Šçš„å¯ä»¥å•ç‹¬å®‰è£…æ²¡å…³ç³»çš„ï¼š</p>
<p>ä¸å—å½±å“æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># tar zxvf zabbix-3.0.3.tar.gz</span></div><div class="line"><span class="comment"># cd zabbix-3.0.3</span></div><div class="line"><span class="comment"># ./configure  --enable-java  --prefix=/data/zabbix/zabbix_java  #/data/zabbixæ˜¯æˆ‘çš„zabbixå®‰è£…ç›®å½•</span></div><div class="line"><span class="comment"># make &amp;&amp; make install</span></div></pre></td></tr></table></figure>
<p>æˆ‘çš„ç›®å½•æ˜¯é»˜è®¤åœ¨/usr/local/zabbix/sbin/zabbix_java/</p>
<h3 id="3ã€ä¿®æ”¹Java-gatewayçš„é…ç½®æ–‡ä»¶å¹¶å¯åŠ¨å®ƒ"><a href="#3ã€ä¿®æ”¹Java-gatewayçš„é…ç½®æ–‡ä»¶å¹¶å¯åŠ¨å®ƒ" class="headerlink" title="3ã€ä¿®æ”¹Java-gatewayçš„é…ç½®æ–‡ä»¶å¹¶å¯åŠ¨å®ƒ"></a>3ã€ä¿®æ”¹<code>Java-gateway</code>çš„é…ç½®æ–‡ä»¶å¹¶å¯åŠ¨å®ƒ</h3><p>é…ç½®æ–‡ä»¶å•ç‹¬å®‰è£…çš„è·¯å¾„ä¸º/data/zabbix/zabbix_java/sbin/zabbix_java/settings.sh<br>æˆ‘è¿™é‡Œæ˜¯è¿™ä¸ªç›®å½•ã€‚å…·ä½“æ ¹æ®å®é™…å®‰è£…æƒ…å†µï¼‰ /usr/local/zabbix/sbin/zabbix_java/settings.sh<br>å¯ç”¨ä»¥ä¸‹å‚æ•°ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">LISTEN_IP=<span class="string">"127.0.0.1"</span>       <span class="comment">#ç›‘å¬åœ°å€</span></div><div class="line">LISTEN_PORT=10052      <span class="comment">#ç›‘å¬ç«¯å£</span></div><div class="line">START_POLLERS=50        <span class="comment"># å¼€å¯çš„å·¥ä½œçº¿ç¨‹æ•°ï¼ˆå¿…é¡»å¤§äºç­‰äºåé¢zabbix_server.confæ–‡ä»¶çš„StartJavaPollerså‚æ•°ï¼‰ #å¿…é¡»é…ç½®ï¼Œå¯åŠ¨çš„è¿›å‡ºæ•°</span></div></pre></td></tr></table></figure>
<p><code>æ³¨æ„äº‹é¡¹ï¼š</code></p>
<ol>
<li>é…ç½®æ–‡ä»¶PID_FILEçš„è·¯å¾„å¿…é¡»æ˜¯æ­£ç¡®çš„ï¼Œå¯ä»¥è‡ªå·±å»cdæ‰¾ï¼Œyumå®‰è£…é»˜è®¤æƒ…å†µä¸‹ä¸ç”¨æ”¹åŠ¨ã€‚</li>
<li>START_POLLERSé¡¹æ˜¯é…ç½®å¯åŠ¨çš„è¿›å‡ºæ•°ï¼Œè¯¥å€¼å¿…é¡»å¤§äºç­‰äºZabbix-Serveré‡Œé¢çš„startJavaPollersé¡¹ã€‚</li>
</ol>
<p>è¿›å…¥/usr/local/zabbix/sbin/zabbix_java/ç›®å½•ï¼Œæ‰§è¡Œ./startup.sh</p>
<p>æ£€æŸ¥ç«¯å£æ˜¯å¦ç›‘å¬ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">netstat -anp|grep 10052</div><div class="line">tcp        0      0 0.0.0.0:10052               0.0.0.0:*                   LISTEN      21949/java</div></pre></td></tr></table></figure>
<p>æŸ¥çœ‹æ˜¯å¦å·²ç»ç›‘å¬10052ç«¯å£ï¼Œå¦‚æœå·²ç›‘å¬ï¼Œè¡¨ç¤ºå¯åŠ¨æˆåŠŸï¼Œå¦‚æœæ²¡æœ‰ï¼Œå¯é€šè¿‡zabbix_serveræ—¥å¿—æŸ¥çœ‹è§£å†³</p>
<h3 id="4ã€ä¿®æ”¹zabbix-serverçš„é…ç½®æ–‡ä»¶å¹¶é‡å¯"><a href="#4ã€ä¿®æ”¹zabbix-serverçš„é…ç½®æ–‡ä»¶å¹¶é‡å¯" class="headerlink" title="4ã€ä¿®æ”¹zabbix_serverçš„é…ç½®æ–‡ä»¶å¹¶é‡å¯"></a>4ã€ä¿®æ”¹<code>zabbix_server</code>çš„é…ç½®æ–‡ä»¶å¹¶é‡å¯</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">vim /usr/<span class="built_in">local</span>/zabbix/etc/zabbix_server.conf</div><div class="line"></div><div class="line">JavaGateway=127.0.0.1      <span class="comment"># JavaGateway æœåŠ¡å™¨åœ°å€ï¼Œzabbix_serverä¸zabbix_java_gatewayåœ¨åŒä¸€å°ä¸»æœº</span></div><div class="line">JavaGatewayPort=10052       <span class="comment">#ç«¯å£</span></div><div class="line">StartJavaPollers=5          <span class="comment"># #è®¾å®šè¿æ¥java gateway çš„è¿›ç¨‹æ•°ï¼Œå½“è®¾ç½®ä¸º0æ—¶è¡¨ç¤ºä¸å…·æœ‰æŠ“å–javaä¿¡æ¯çš„èƒ½åŠ›</span></div></pre></td></tr></table></figure>
<h3 id="5ã€-æ·»åŠ catalina-jmx-remote-jar"><a href="#5ã€-æ·»åŠ catalina-jmx-remote-jar" class="headerlink" title="5ã€ æ·»åŠ catalina-jmx-remote.jar"></a>5ã€ æ·»åŠ catalina-jmx-remote.jar</h3><p>æ·»åŠ catalina-jmx-remote.jaråˆ°zabbix java gatewayçš„libç›®å½•ä¸‹ï¼Œcatalina-jmx-remote.jaråŒ…å¯åœ¨<a href="http://archive.apache.org/dist/tomcat/ä¸‹ï¼Œåœ¨å„ç‰ˆæœ¬ç›®å½•çš„bin/extras/å­ç›®å½•ä¸‹" target="_blank" rel="external">http://archive.apache.org/dist/tomcat/ä¸‹ï¼Œåœ¨å„ç‰ˆæœ¬ç›®å½•çš„bin/extras/å­ç›®å½•ä¸‹</a></p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cd /usr/local/zabbix/sbin/zabbix_java/<span class="class"><span class="keyword">lib</span>/</span></div><div class="line">wget <span class="symbol">http:</span>/<span class="regexp">/archive.apache.org/dist</span><span class="regexp">/tomcat/tomcat</span>-<span class="number">7</span>/v7.<span class="number">0.55</span>/bin/extras/catalina-jmx-remote.jar</div></pre></td></tr></table></figure>
<p>é‡å¯æœåŠ¡zabbixå’Œjava gateway å¹¶åŠ å…¥å¯åŠ¨é¡¹å¹¶éªŒè¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">/etc/init.d/zabbix_server restart</div><div class="line">/usr/<span class="built_in">local</span>/zabbix/sbin/zabbix_java/shutdown.sh</div><div class="line">/usr/<span class="built_in">local</span>/zabbix/sbin/zabbix_java/startup.sh</div></pre></td></tr></table></figure>
<h3 id="6-ä¸‹è½½æµ‹è¯•å·¥å…·cmdline-jmxclient-0-10-3-jar"><a href="#6-ä¸‹è½½æµ‹è¯•å·¥å…·cmdline-jmxclient-0-10-3-jar" class="headerlink" title="6.ä¸‹è½½æµ‹è¯•å·¥å…·cmdline-jmxclient-0.10.3.jar"></a>6.ä¸‹è½½æµ‹è¯•å·¥å…·<code>cmdline-jmxclient-0.10.3.jar</code></h3><p>cmdline-jmxclient-0.10.3.jarä¸ºä¸€ä¸ªæµ‹è¯•å·¥å…·ï¼Œå¯ç”¨æ¥æµ‹è¯•jmxæ˜¯å¦é…ç½®æ­£ç¡®ï¼Œä¸‹è½½cmdline-jmxclient-0.10.3.jar(ä¸‹è½½åˆ°ä»»æ„ç›®å½•)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wget http://crawler.archive.org/cmdline-jmxclient/cmdline-jmxclient-0.10.3.jar</div></pre></td></tr></table></figure>
<h2 id="äºŒã€è¢«ç›‘æ§tomcat-é…ç½®ï¼»è¢«ç›‘æ§tomcatæ“ä½œï¼½"><a href="#äºŒã€è¢«ç›‘æ§tomcat-é…ç½®ï¼»è¢«ç›‘æ§tomcatæ“ä½œï¼½" class="headerlink" title="äºŒã€è¢«ç›‘æ§tomcat é…ç½®ï¼»è¢«ç›‘æ§tomcatæ“ä½œï¼½"></a>äºŒã€è¢«ç›‘æ§tomcat é…ç½®ï¼»è¢«ç›‘æ§tomcatæ“ä½œï¼½</h2><h3 id="ä¸‹è½½catalina-jmx-remote-jar"><a href="#ä¸‹è½½catalina-jmx-remote-jar" class="headerlink" title="ä¸‹è½½catalina-jmx-remote.jar"></a>ä¸‹è½½catalina-jmx-remote.jar</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /srv/tomcat/tomcat-account/lib/</div><div class="line">wget http://archive.apache.org/dist/tomcat/tomcat-7/v7.0.55/bin/extras/catalina-jmx-remote.jar <span class="comment">#æˆ‘çš„tomcatç‰ˆæœ¬æ˜¯7.0.55</span></div><div class="line">chown -R tomcat:tomcat catalina-jmx-remote.jar</div><div class="line">chmod +x catalina-jmx-remote.jar</div></pre></td></tr></table></figure>
<p>æˆ‘çš„tomcatç‰ˆæœ¬æ˜¯<code>7.0.55</code>  å°†ä¸‹è½½ååçš„jaråŒ…æ”¾åˆ°è¢«ç›‘æ§çš„tomcatå®ä¾‹çš„libç›®å½•ä¸‹ã€‚ </p>
<h3 id="æŸ¥çœ‹tomcatçš„ç‰ˆæœ¬"><a href="#æŸ¥çœ‹tomcatçš„ç‰ˆæœ¬" class="headerlink" title="æŸ¥çœ‹tomcatçš„ç‰ˆæœ¬"></a>æŸ¥çœ‹tomcatçš„ç‰ˆæœ¬</h3><ul>
<li>è¿™é‡Œä¹‹å‰ä¹Ÿè‡ªå·±ä¹Ÿå¿˜è®°äº†tomcatçš„ç‰ˆæœ¬æ˜¯å¤šå°‘äº†ï¼Œæ‰€ä»¥æˆ‘å…ˆæŸ¥çœ‹ä¸‹ç„¶ååœ¨ä¸‹è½½ï¼š</li>
</ul>
<figure class="highlight ldif"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">cd /srv/tomcat/tomcat_account/bin</span></div><div class="line">[root@tomcat_A1 bin]# ./version.sh --</div><div class="line">Using CATALINA_BASE:   /srv/tomcat/tomcat_account</div><div class="line"><span class="attribute">Using CATALINA_HOME</span>:   /srv/tomcat/tomcat_account</div><div class="line"><span class="attribute">Using CATALINA_TMPDIR</span>: /srv/tomcat/tomcat_account/temp</div><div class="line"><span class="attribute">Using JRE_HOME</span>:        /srv/jdk1.7.0_67</div><div class="line"><span class="attribute">Using CLASSPATH</span>:       /srv/tomcat/tomcat_account/bin/bootstrap.jar:/srv/tomcat/tomcat_account/bin/tomcat-juli.jar</div><div class="line"><span class="attribute">Server version</span>: Apache Tomcat/7.0.55</div><div class="line"><span class="attribute">Server built</span>:   Jul 18 2014 05:34:04</div><div class="line"><span class="attribute">Server number</span>:  7.0.55.0</div><div class="line"><span class="attribute">OS Name</span>:        Linux</div><div class="line"><span class="attribute">OS Version</span>:     2.6.32-573.8.1.el6.x86_64</div><div class="line"><span class="attribute">Architecture</span>:   amd64</div><div class="line"><span class="attribute">JVM Version</span>:    1.7.0_67-b01</div><div class="line"><span class="attribute">JVM Vendor</span>:     Oracle Corporation</div></pre></td></tr></table></figure>
<p>åœ¨tomcatç«¯é…ç½®JMXã€‚ï¼ˆtomcat/bin/catalina.shï¼‰è‡ªå·±å®‰è£…çš„tomcatè·¯å¾„ï¼Œæ‰¾åˆ°catalina.shæ–‡ä»¶ã€‚</p>
<p>ç½‘ä¸Šå¾ˆå¤šäººä¿®æ”¹tomcat/bin/ä¸‹çš„catalina.shï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">CATALINA_OPTS=<span class="string">"-Dcom.sun.management.jmxremote</span></div><div class="line">-Dcom.sun.management.jmxremote.authenticate=false</div><div class="line">-Dcom.sun.management.jmxremote.ssl=false</div><div class="line">-Dcom.sun.management.jmxremote.port=12345  #å®šä¹‰jmxç›‘å¬ç«¯å£</div><div class="line">-Djava.rmi.server.hostname=192.168.7.186"</div></pre></td></tr></table></figure>
<ul>
<li>æˆ‘è¿™é‡Œæ˜¯ç›´æ¥åœ¨binç›®å½•ä¸‹é¢åˆ›å»ºè‡ªå®šä¹‰çš„è„šæœ¬ã€‚</li>
</ul>
<h3 id="ä¿®æ”¹setenv-sh"><a href="#ä¿®æ”¹setenv-sh" class="headerlink" title="ä¿®æ”¹setenv.sh"></a>ä¿®æ”¹setenv.sh</h3><p>vi /srv/tomcat/tomcat-account/bin/setenv.sh</p>
<p>æ·»åŠ å¦‚ä¸‹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">CATALINA_OPTS=<span class="string">"<span class="variable">$&#123;CATALINA_OPTS&#125;</span> -Djava.rmi.server.hostname=192.168.7.186"</span></div><div class="line">CATALINA_OPTS=<span class="string">"<span class="variable">$&#123;CATALINA_OPTS&#125;</span> -Djavax.management.builder.initial="</span></div><div class="line">CATALINA_OPTS=<span class="string">"<span class="variable">$&#123;CATALINA_OPTS&#125;</span> -Dcom.sun.management.jmxremote=true"</span></div><div class="line">CATALINA_OPTS=<span class="string">"<span class="variable">$&#123;CATALINA_OPTS&#125;</span> -Dcom.sun.management.jmxremote.ssl=false"</span></div><div class="line">CATALINA_OPTS=<span class="string">"<span class="variable">$&#123;CATALINA_OPTS&#125;</span> -Dcom.sun.management.jmxremote.authenticate=false"</span></div></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼šhostnameä½æœºå™¨ipåœ°å€ï¼Œå³è¢«ç›‘æ§æœºå™¨å¯¹å¤–æœåŠ¡åœ°å€</p>
<h3 id="3-ä¿®æ”¹server-xml"><a href="#3-ä¿®æ”¹server-xml" class="headerlink" title="3.ä¿®æ”¹server.xml"></a>3.ä¿®æ”¹server.xml</h3><p>vi /opt/apache-tomcat/conf/server.xml<br>æ·»åŠ å¦‚ä¸‹ï¼Œæ³¨æ„æ·»åŠ ä½ç½®åœ¨</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;Listener className=<span class="string">"org.apache.catalina.core.ThreadLocalLeakPreventionListener"</span> /&gt;</div></pre></td></tr></table></figure>
<p>ä¹‹åæ·»åŠ å¦‚ä¸‹ä»£ç </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;Listener className=<span class="string">"org.apache.catalina.mbeans.JmxRemoteLifecycleListener"</span> rmiRegistryPortPlatform=<span class="string">"12345"</span> rmiServerPortPlatform=<span class="string">"12345"</span> /&gt;</div></pre></td></tr></table></figure>
<p>3ã€é‡å¯<code>tomcat</code><br>è¿™é‡Œæˆ‘ä¹‹å‰æ˜¯ç”¨å†™å¥½çš„å¯åŠ¨è„šæœ¬å»å¯åŠ¨çš„ï¼Œå‘ç°ä¸€ä¸ªé—®é¢˜ã€‚<br>å› ä¸ºæˆ‘éƒ½æ˜¯ç”¨/etc/init.d/tomcat stop start æ¥å¯åŠ¨ã€‚<br>å¯æ˜¯å‘ç°æœåŠ¡å¯åŠ¨äº†ï¼Œå¯æ˜¯ä¹‹å‰çš„tomcatæœåŠ¡ç«¯å£ä¸è§äº†ã€‚æˆ‘ä¹‹å‰çš„tomcatæœåŠ¡ç«¯å£<code>10001</code></p>
<p>ç„¶åæŸ¥çœ‹æ—¥å¿—å‡ºç°æŠ¥é”™ï¼š</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">	at java<span class="selector-class">.lang</span><span class="selector-class">.reflect</span><span class="selector-class">.Method</span><span class="selector-class">.invoke</span>(Method<span class="selector-class">.java</span>:<span class="number">606</span>)</div><div class="line">	at org<span class="selector-class">.apache</span><span class="selector-class">.commons</span><span class="selector-class">.daemon</span><span class="selector-class">.support</span><span class="selector-class">.DaemonLoader</span><span class="selector-class">.start</span>(DaemonLoader<span class="selector-class">.java</span>:<span class="number">243</span>)</div><div class="line">Caused by: java<span class="selector-class">.lang</span><span class="selector-class">.IllegalArgumentException</span>: jmxremote<span class="selector-class">.access</span> (æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•)</div><div class="line">	at javax<span class="selector-class">.management</span><span class="selector-class">.remote</span><span class="selector-class">.rmi</span><span class="selector-class">.RMIConnectorServer</span><span class="selector-class">.start</span>(RMIConnectorServer<span class="selector-class">.java</span>:<span class="number">373</span>)</div><div class="line">	at org<span class="selector-class">.apache</span><span class="selector-class">.catalina</span><span class="selector-class">.mbeans</span><span class="selector-class">.JmxRemoteLifecycleListener</span><span class="selector-class">.createServer</span>(JmxRemoteLifecycleListener<span class="selector-class">.java</span>:<span class="number">313</span>)</div><div class="line">	at org<span class="selector-class">.apache</span><span class="selector-class">.catalina</span><span class="selector-class">.mbeans</span><span class="selector-class">.JmxRemoteLifecycleListener</span><span class="selector-class">.lifecycleEvent</span>(JmxRemoteLifecycleListener<span class="selector-class">.java</span>:<span class="number">259</span>)</div><div class="line">	at org<span class="selector-class">.apache</span><span class="selector-class">.catalina</span><span class="selector-class">.util</span><span class="selector-class">.LifecycleSupport</span><span class="selector-class">.fireLifecycleEvent</span>(LifecycleSupport<span class="selector-class">.java</span>:<span class="number">117</span>)</div><div class="line">	at org<span class="selector-class">.apache</span><span class="selector-class">.catalina</span><span class="selector-class">.util</span><span class="selector-class">.LifecycleBase</span><span class="selector-class">.fireLifecycleEvent</span>(LifecycleBase<span class="selector-class">.java</span>:<span class="number">90</span>)</div><div class="line">	at org<span class="selector-class">.apache</span><span class="selector-class">.catalina</span><span class="selector-class">.util</span><span class="selector-class">.LifecycleBase</span><span class="selector-class">.setStateInternal</span>(LifecycleBase<span class="selector-class">.java</span>:<span class="number">402</span>)</div><div class="line">	at org<span class="selector-class">.apache</span><span class="selector-class">.catalina</span><span class="selector-class">.util</span><span class="selector-class">.LifecycleBase</span><span class="selector-class">.setState</span>(LifecycleBase<span class="selector-class">.java</span>:<span class="number">347</span>)</div><div class="line">	at org<span class="selector-class">.apache</span><span class="selector-class">.catalina</span><span class="selector-class">.core</span><span class="selector-class">.StandardServer</span><span class="selector-class">.startInternal</span>(StandardServer<span class="selector-class">.java</span>:<span class="number">732</span>)</div><div class="line">	at org<span class="selector-class">.apache</span><span class="selector-class">.catalina</span><span class="selector-class">.util</span><span class="selector-class">.LifecycleBase</span><span class="selector-class">.start</span>(LifecycleBase<span class="selector-class">.java</span>:<span class="number">150</span>)</div><div class="line">	... <span class="number">11</span> more</div><div class="line">Caused by: java<span class="selector-class">.io</span><span class="selector-class">.FileNotFoundException</span>: jmxremote<span class="selector-class">.access</span> (æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•)</div><div class="line">	at java<span class="selector-class">.io</span><span class="selector-class">.FileInputStream</span><span class="selector-class">.open</span>(Native Method)</div><div class="line">	at java<span class="selector-class">.io</span><span class="selector-class">.FileInputStream</span>.&lt;init&gt;(FileInputStream<span class="selector-class">.java</span>:<span class="number">146</span>)</div><div class="line">	at java<span class="selector-class">.io</span><span class="selector-class">.FileInputStream</span>.&lt;init&gt;(FileInputStream<span class="selector-class">.java</span>:<span class="number">101</span>)</div><div class="line">	at com<span class="selector-class">.sun</span><span class="selector-class">.jmx</span><span class="selector-class">.remote</span><span class="selector-class">.security</span><span class="selector-class">.MBeanServerFileAccessController</span><span class="selector-class">.propertiesFromFile</span>(MBeanServerFileAccessController<span class="selector-class">.java</span>:<span class="number">294</span>)</div><div class="line">	at com<span class="selector-class">.sun</span><span class="selector-class">.jmx</span><span class="selector-class">.remote</span><span class="selector-class">.security</span><span class="selector-class">.MBeanServerFileAccessController</span>.&lt;init&gt;(MBeanServerFileAccessController<span class="selector-class">.java</span>:<span class="number">133</span>)</div><div class="line">	at javax<span class="selector-class">.management</span><span class="selector-class">.remote</span><span class="selector-class">.rmi</span><span class="selector-class">.RMIConnectorServer</span><span class="selector-class">.start</span>(RMIConnectorServer<span class="selector-class">.java</span>:<span class="number">371</span>)</div><div class="line">	... <span class="number">19</span> more</div></pre></td></tr></table></figure>
<p>è¿™é‡Œå…ˆkill -9 tomcatè¿›ç¨‹<br>åªéœ€è¦åœ¨/bin/ç›®å½•ä¸‹é¢å¯åŠ¨æœåŠ¡ã€‚<code>./startup.sh</code><br>ç„¶åæŸ¥çœ‹æœ‰ä¸‹é¢çš„12345 12346 è¿›ç¨‹ å’Œtomcatè¿›ç¨‹10001 è¯´æ˜å°±å¯¹äº†ã€‚</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[root@tomcat_A1 bin]# netstat -ntulp</div><div class="line">Active Internet connections (only servers)</div><div class="line">Proto Recv-Q Send-Q Local Address               Foreign Address             State       PID/Program name</div><div class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">10.46</span><span class="meta">.72</span><span class="meta">.172</span>:<span class="number">10050</span>          <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:*                   LISTEN      <span class="number">8483</span>/zabbix_agentd</div><div class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">127.0</span><span class="meta">.0</span><span class="meta">.1</span>:<span class="number">8006</span>              <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:*                   LISTEN      <span class="number">8942</span>/java</div><div class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:<span class="number">4041</span>                <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:*                   LISTEN      <span class="number">8942</span>/java</div><div class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:<span class="number">10001</span>               <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:*                   LISTEN      <span class="number">8942</span>/java</div><div class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:<span class="number">22</span>                  <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:*                   LISTEN      <span class="number">1363</span>/sshd</div><div class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:<span class="number">36440</span>               <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:*                   LISTEN      <span class="number">8942</span>/java</div><div class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:<span class="number">12345</span>               <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:*                   LISTEN      <span class="number">8942</span>/java</div><div class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:<span class="number">12346</span>               <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:*                   <span class="number">1374</span>/ntpd</div><div class="line">udp        <span class="number">0</span>      <span class="number">0</span> <span class="number">10.46</span><span class="meta">.72</span><span class="meta">.172</span>:<span class="number">123</span>            <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:*                               <span class="number">1374</span>/ntpd</div><div class="line">udp        <span class="number">0</span>      <span class="number">0</span> <span class="number">127.0</span><span class="meta">.0</span><span class="meta">.1</span>:<span class="number">123</span>               <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:*                               <span class="number">1374</span>/ntpd</div><div class="line">udp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:<span class="number">123</span>                 <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:*                               <span class="number">1374</span>/ntpd</div></pre></td></tr></table></figure>
<p>é‡å¯zabbix agent</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">service zabbix-agent restart</span></div></pre></td></tr></table></figure>
<p>æ³¨ï¼šé˜²ç«å¢™éœ€è¦å¼€æ”¾12345ï¼Œ12346ç«¯å£</p>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">-A INPUT -i  eth0 -p tcp -m <span class="keyword">state</span> --state NEW -m tcp --dport <span class="number">12345</span> -j ACCEPT</div><div class="line">-A INPUT -i  eth0 -p tcp -m <span class="keyword">state</span> --state NEW -m tcp --dport <span class="number">12346</span> -j ACCEPT</div></pre></td></tr></table></figure>
<p>###4ã€æœåŠ¡ç«¯æµ‹è¯•æ˜¯å¦å¯ä»¥è·å–æ•°æ®</p>
<p>å‘½ä»¤è¡Œä¸‹æµ‹è¯•éœ€è¦cmdline-jmxclient-0.10.3.jarè¿™ä¸ªåŒ…ï¼Œæµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š</p>
<p>è¿™ä¸ªåŒ…ä¸‹è½½åœ°å€:<a href="http://oak0aohum.bkt.clouddn.com/cmdline-jmxclient-0.10.3.jar" target="_blank" rel="external">cmdline-jmxclient-0.10.3.jar</a></p>
<p>åœ¨zabbix serverä¸Šæ‰§è¡Œ</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">java -jar /tmp/cmdline-jmxclient-<span class="number">0.10</span>.<span class="number">3</span><span class="selector-class">.jar</span> - <span class="number">192.168</span>.<span class="number">7.186</span>:<span class="number">12345</span> java<span class="selector-class">.lang</span>:type=Memory NonHeapMemoryUsage</div></pre></td></tr></table></figure>
<p>å¦‚æœæœ‰å¦‚ä¸‹å›æ˜¾è¡¨ç¤ºjmxé…ç½®æ­£ç¡®ï¼Œå¦‚ä¸æ­£ç¡®ï¼Œè¯·æ£€æŸ¥é…ç½®,çœ‹ä¸‹ç«¯å£å¯åŠ¨æ˜¯å¦æ­£å¸¸ï¼Œserver.xml é…ç½®ã€‚</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="number">07</span><span class="regexp">/22/</span><span class="number">2016</span> <span class="number">14</span>:<span class="number">45</span>:<span class="number">28</span> +<span class="number">0800</span> org.archive.jmx.Client <span class="string">NonHeapMemoryUsage:</span></div><div class="line"><span class="string">committed:</span> <span class="number">80347136</span></div><div class="line"><span class="string">init:</span> <span class="number">24576000</span></div><div class="line"><span class="string">max:</span> <span class="number">136314880</span></div><div class="line"><span class="string">used:</span> <span class="number">46634984</span></div></pre></td></tr></table></figure>
<p>å†™ä¸ªè„šæœ¬è‡ªåŠ¨åˆ¤æ–­ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">vim context.sh</div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line">java -jar /opt/tomcat/cmdline-jmxclient-0.10.3.jar - 10.46.72.172:12345 Catalina:<span class="built_in">type</span>=Manager,*| awk -F <span class="string">","</span> <span class="string">'&#123; print $1 &#125;'</span>|awk -F: <span class="string">'&#123; print $2 &#125;'</span>&gt;/tmp/tomcat/context.csv</div></pre></td></tr></table></figure>
<h2 id="ä¸‰ã€å¯¼å…¥æ¨¡æ¿åˆ°zabbixï¼Œå¹¶å…³è”åˆ°ä¸»æœºï¼Œæ·»åŠ ç›‘æ§"><a href="#ä¸‰ã€å¯¼å…¥æ¨¡æ¿åˆ°zabbixï¼Œå¹¶å…³è”åˆ°ä¸»æœºï¼Œæ·»åŠ ç›‘æ§" class="headerlink" title="ä¸‰ã€å¯¼å…¥æ¨¡æ¿åˆ°zabbixï¼Œå¹¶å…³è”åˆ°ä¸»æœºï¼Œæ·»åŠ ç›‘æ§"></a>ä¸‰ã€å¯¼å…¥æ¨¡æ¿åˆ°zabbixï¼Œå¹¶å…³è”åˆ°ä¸»æœºï¼Œæ·»åŠ ç›‘æ§</h2><p>è¿™æ ·ä¹Ÿå¯ä»¥é€‰æ‹©ç³»ç»Ÿè‡ªå¸¦çš„ï¼Œæˆ‘è¿™é‡Œzabbixç‰ˆæœ¬æ˜¯3.0çš„ï¼Œç³»ç»Ÿè‡ªå¸¦çš„å¯ä»¥é€‰æ‹©ï¼š<br>é€‰æ‹©é…ç½®ï¼šä¸»æœº-æ¨¡æ¿-é€‰æ‹©-æ¨¡æ¿-ï¼š<br>Template JMX Tomcat<br>Template JMX Generic</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-tomcat4.png" alt=""></figure></p>
<p>ä»ç½‘ä¸Šä¸‹è½½äº†ä¸€ä¸ªä¸é”™çš„æ¨¡æ¿ï¼Œå¯¼å…¥åå¦‚ä¸‹ï¼š</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-tomcat2.png" alt=""></figure><br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-tomcat3.png" alt=""></figure></p>
<p>å¯¼å…¥æ¨¡æ¿ä»¥åä¸»æœºæ·»åŠ ç«¯å£ï¼š</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-tomcat6.png" alt=""></figure></p>
<p>ç„¶åæŸ¥çœ‹å›¾å½¢ï¼š<br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-tomcat5.png" alt=""></figure></p>
<p>å°±æœ‰äº†ã€‚</p>
<h3 id="å››ã€å¦‚ä½•ç›‘æ§å•ä¸»æœºå¤šä¸ªtomcat"><a href="#å››ã€å¦‚ä½•ç›‘æ§å•ä¸»æœºå¤šä¸ªtomcat" class="headerlink" title="å››ã€å¦‚ä½•ç›‘æ§å•ä¸»æœºå¤šä¸ªtomcat"></a>å››ã€å¦‚ä½•ç›‘æ§å•ä¸»æœºå¤šä¸ªtomcat</h3><p>ç›‘æ§å¤šä¸ªtomcatå®ä¾‹ï¼Œç½‘ä¸Šçš„è¯¦ç»†çš„é…ç½®æ–‡æ¡£å¾ˆå°‘ï¼Œå‡ ä¹æ²¡æœ‰ã€‚æ¯”è¾ƒå¥½çš„åŠæ³•æ˜¯ä½¿ç”¨è‡ªåŠ¨å‘ç°ï¼Œä½†åˆšä½¿ç”¨zabbixï¼Œæ¥ä¸åŠç ”ç©¶ï¼Œæ‰€ä»¥é‡‡ç”¨ç¬¨æ³•ï¼Œä¿®æ”¹æ¨¡æ¿ã€ç›‘æ§é¡¹ã€å›¾å½¢æ¥è¾¾åˆ°æœ€ç»ˆç›®çš„ã€‚<br>å…³é”®é…ç½®ï¼š<br>1ã€æ·»åŠ ä¸»æœºæ—¶æ·»åŠ å¤šä¸ªjmxç«¯å£</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-tomcat7.png" alt=""></figure></p>
<p>2ã€ä¿®æ”¹ç›‘æ§é¡¹ã€é”®å€¼<br>åœ¨åŒä¸€ä¸»æœºä¸Šï¼Œzabbixä¸å…é”®å€¼é‡å¤ï¼Œä½†æ˜¯ç›‘æ§çš„é¡¹ç›®æ˜¯ä¸€æ ·çš„ï¼Œä¸å¯èƒ½é”®å€¼å†™çš„ä¸é‡å¤ï¼Œç»è¿‡å‡ ç•ªæœç´¢ï¼Œæ‰¾åˆ°æ–¹æ³•å¦‚ä¸‹ï¼š<br>åªè¦åœ¨ç®­å¤´å¤„æ·»åŠ 1ä¸ªç©ºæ ¼å°±å¯ä»¥ï¼Œä¹Ÿå¯ä»¥æ˜¯å¤šä¸ªã€‚ï¼ˆæ³¨æ„ä½ç½®ä¸è¦é”™ï¼Œåœ¨é€—åˆ°åé¢ï¼‰</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-tomcat8.png" alt=""></figure></p>
<p>å‰©ä¸‹çš„å°±æ˜¯ä½“åŠ›æ´»äº†ï¼Œå…‹éš†ç›‘æ§é¡¹ã€ä¿®æ”¹ç›‘æ§é¡¹ã€å…‹éš†å›¾å½¢ã€ä¿®æ”¹å›¾å½¢ã€‚ã€‚ã€‚<br>ä»¥ä¸‹æ˜¯ä¸¤ä¸ªtomcatå®ä¾‹çš„ç›‘æ§é¡¹ï¼š</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-tomcat10.png" alt=""></figure></p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-tomcat9.png" alt=""></figure></p>
<p>å¤šä¸ªtomcatåœ¨ä¸€å°ä¸»æœºä¸Šé¢æœ€åçš„ç›‘æ§æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-tomcat11.png" alt=""></figure></p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-tomcat12.png" alt=""></figure></p>
<p>ä¸€å¼€å§‹zabbixç›‘æ§tomcat ä¸€è·¯é¡ºç•…ï¼Œå¯æ˜¯åˆ°æµ‹è¯•æ­£ä¸æ­£å¸¸æ—¶å€™ï¼Œè¿”å›æ‹’ç»è¿æ¥ï¼Œç¬¬ä¸€æ—¶é—´æƒ³åˆ°å°±æ˜¯é…ç½®æœ‰é—®é¢˜ï¼š</p>
<p>æˆ‘æ˜¯å‚è€ƒè¿™ä¸ªè§£å†³äº†ã€‚</p>
<p>å…·ä½“å‚æ•°å†…å®¹è¯·å‚è€ƒ <a href="https://tomcat.apache.org/tomcat-7.0-doc/config/listeners.html#Additional_Implementations" target="_blank" rel="external">apache tomcat æ–‡æ¡£</a></p>
<p>ä¹Ÿéå¸¸æ„Ÿè°¢ï¼šå¼ çˆ±å¾·å¤§ç¥ ä¸€è·¯zabbixä¸Šé¢çš„å¸®æˆ‘ä¸€èµ·æ’å‘ï¼š</p>
<p>zabbixå¤§ç¥ ä»–çš„åšå®¢blogï¼š<a href="https://blog.cactifans.com" target="_blank" rel="external">https://blog.cactifans.com</a></p>

	

	

</article>




	<article>
	
		<h1><a href="/2016/06/21/WebæœåŠ¡æŠ€æœ¯/tomcat/è®°ä¸€æ¬¡çº¿ä¸Štomcatå†…å­˜ä¸è¶³é…ç½®å¹¶å‘ä¼˜åŒ–è¿‡ç¨‹/">è®°ä¸€æ¬¡çº¿ä¸Štomcatå†…å­˜ä¸è¶³é…ç½®å¹¶å‘ä¼˜åŒ–è¿‡ç¨‹</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-06-21</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/tomcat/">tomcat</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Java-Tomcat-notes/">Java+Tomcat notes</a>
			</span>
		
	</div>

	

	
		<h2 id="å‰è¨€ï¼štomcatçš„å†…å­˜ä½¿ç”¨é…ç½®-æœ€å¤§è¿æ¥æ•°é…ç½®ã€‚"><a href="#å‰è¨€ï¼štomcatçš„å†…å­˜ä½¿ç”¨é…ç½®-æœ€å¤§è¿æ¥æ•°é…ç½®ã€‚" class="headerlink" title="å‰è¨€ï¼štomcatçš„å†…å­˜ä½¿ç”¨é…ç½®,æœ€å¤§è¿æ¥æ•°é…ç½®ã€‚"></a>å‰è¨€ï¼štomcatçš„å†…å­˜ä½¿ç”¨é…ç½®,æœ€å¤§è¿æ¥æ•°é…ç½®ã€‚</h2><p>å¦‚ä½•ä¿®æ”¹é…ç½®å‘¢ï¼Œåœ¨/tomcatçš„/bin/ä¸‹é¢æœ‰ä¸ªè¿™ä¸ªè„šæœ¬æ–‡ä»¶ã€‚catailna.sh è„šæœ¬æ–‡ä»¶ã€‚ å¦‚æœwindows æ˜¯batè®¾ç½®tomcatçš„ä½¿ç”¨å†…å­˜ï¼Œä¹Ÿå…¶å®å°±æ˜¯è®¾ç½®jimçš„ä½¿ç”¨å‚æ•°ã€‚</p>
<h4 id="è®¾ç½®Tomcatå¯åŠ¨çš„åˆå§‹å†…å­˜"><a href="#è®¾ç½®Tomcatå¯åŠ¨çš„åˆå§‹å†…å­˜" class="headerlink" title="è®¾ç½®Tomcatå¯åŠ¨çš„åˆå§‹å†…å­˜"></a>è®¾ç½®Tomcatå¯åŠ¨çš„åˆå§‹å†…å­˜</h4><p>å…¶åˆå§‹ç©ºé—´(å³-Xms)æ˜¯ç‰©ç†å†…å­˜çš„1/64ï¼Œæœ€å¤§ç©ºé—´(-Xmx)æ˜¯ç‰©ç†å†…å­˜çš„1/4ã€‚å¯ä»¥åˆ©ç”¨JVMæä¾›çš„-Xmn -Xms -Xmxç­‰é€‰é¡¹å¯</p>
<p>è¦åŠ â€œmâ€è¯´æ˜æ˜¯MBï¼Œå¦åˆ™å°±æ˜¯KBäº†ï¼Œåœ¨å¯åŠ¨tomcatæ—¶ä¼š æŠ¥å†…å­˜ä¸è¶³ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">-Xmsï¼šåˆå§‹å€¼  ã€åˆå§‹åŒ–å†…å­˜å¤§å°ã€‘</div><div class="line">-Xmxï¼šæœ€å¤§å€¼  ã€å¯ä»¥ä½¿ç”¨çš„æœ€å¤§å†…å­˜ã€‘</div><div class="line">-Xmnï¼šæœ€å°å€¼</div></pre></td></tr></table></figure>
<p>JVMå †çš„è®¾ç½®æ˜¯æŒ‡javaç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­JVMå¯ä»¥è°ƒé…ä½¿ç”¨çš„å†…å­˜ç©ºé—´çš„è®¾ç½®.JVMåœ¨å¯åŠ¨çš„æ—¶å€™ä¼šè‡ªåŠ¨è®¾ç½®Heap sizeçš„å€¼ï¼Œå…¶åˆå§‹ç©ºé—´(å³-Xms)æ˜¯ç‰©ç†å†…å­˜çš„1/64ï¼Œæœ€å¤§ç©ºé—´(-Xmx)æ˜¯ç‰©ç†å†…å­˜çš„1/4ã€‚å¯ä»¥åˆ©ç”¨JVMæä¾›çš„-Xmn -Xms -Xmxç­‰é€‰é¡¹å¯è¿›è¡Œè®¾ç½®ã€‚Heap size çš„å¤§å°æ˜¯Young Generation å’ŒTenured Generaion ä¹‹å’Œã€‚</p>
<p> æç¤ºï¼š<code>åœ¨JVMä¸­å¦‚æœ98ï¼…çš„æ—¶é—´æ˜¯ç”¨äºGCä¸”å¯ç”¨çš„Heap size ä¸è¶³2ï¼…çš„æ—¶å€™å°†æŠ›å‡ºæ­¤å¼‚å¸¸ä¿¡æ¯.</code></p>
<p>æç¤ºï¼š<code>Heap Size æœ€å¤§ä¸è¦è¶…è¿‡å¯ç”¨ç‰©ç†å†…å­˜çš„80ï¼…ï¼Œä¸€èˆ¬çš„è¦å°†-Xmså’Œ-Xmxé€‰é¡¹è®¾ç½®ä¸ºç›¸åŒï¼Œè€Œ-Xmnä¸º1/4çš„-Xmxå€¼ã€‚</code></p>
<p>è¿™ä¸¤ä¸ªå€¼çš„å¤§å°ä¸€èˆ¬æ ¹æ®éœ€è¦è¿›è¡Œè®¾ç½®ã€‚åˆå§‹åŒ–å †çš„å¤§å°æ‰§è¡Œäº†è™šæ‹Ÿæœºåœ¨å¯åŠ¨æ—¶å‘ç³»ç»Ÿç”³è¯·çš„å†…å­˜çš„å¤§å°ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œè¿™ä¸ªå‚æ•°ä¸é‡è¦ã€‚ä½†æ˜¯æœ‰çš„åº”ç”¨ ç¨‹åºåœ¨å¤§è´Ÿè½½çš„æƒ…å†µä¸‹ä¼šæ€¥å‰§åœ°å ç”¨æ›´å¤šçš„å†…å­˜ï¼Œæ­¤æ—¶è¿™ä¸ªå‚æ•°å°±æ˜¯æ˜¾å¾—éå¸¸é‡è¦ï¼Œå¦‚æœè™šæ‹Ÿæœºå¯åŠ¨æ—¶è®¾ç½®ä½¿ç”¨çš„å†…å­˜æ¯”è¾ƒå°è€Œåœ¨è¿™ç§æƒ…å†µä¸‹æœ‰è®¸å¤šå¯¹è±¡è¿›è¡Œåˆå§‹ åŒ–ï¼Œè™šæ‹Ÿæœºå°±å¿…é¡»é‡å¤åœ°å¢åŠ å†…å­˜æ¥æ»¡è¶³ä½¿ç”¨ã€‚ç”±äºè¿™ç§åŸå› ï¼Œæˆ‘ä»¬ä¸€èˆ¬æŠŠ-Xmså’Œ-Xmxè®¾ä¸ºä¸€æ ·å¤§ï¼Œè€Œå †çš„æœ€å¤§å€¼å—é™äºç³»ç»Ÿä½¿ç”¨çš„ç‰©ç†å†…å­˜ã€‚ä¸€èˆ¬ä½¿ç”¨æ•° æ®é‡è¾ƒå¤§çš„åº”ç”¨ç¨‹åºä¼šä½¿ç”¨æŒä¹…å¯¹è±¡ï¼Œå†…å­˜ä½¿ç”¨æœ‰å¯èƒ½è¿…é€Ÿåœ°å¢é•¿ã€‚å½“åº”ç”¨ç¨‹åºéœ€è¦çš„å†…å­˜è¶…å‡ºå †çš„æœ€å¤§å€¼æ—¶è™šæ‹Ÿæœºå°±ä¼šæç¤ºå†…å­˜æº¢å‡ºï¼Œå¹¶ä¸”å¯¼è‡´åº”ç”¨æœåŠ¡å´©æºƒã€‚å›  æ­¤ä¸€èˆ¬å»ºè®®å †çš„æœ€å¤§å€¼è®¾ç½®ä¸ºå¯ç”¨å†…å­˜çš„æœ€å¤§å€¼çš„80%ã€‚</p>
<p>å¦‚æœç³»ç»ŸèŠ±è´¹å¾ˆå¤šçš„æ—¶é—´æ”¶é›†åƒåœ¾ï¼Œè¯·å‡å°å †å¤§å°ã€‚ä¸€æ¬¡å®Œå…¨çš„åƒåœ¾æ”¶é›†åº”è¯¥ä¸è¶…è¿‡ 3-5 ç§’ã€‚å¦‚æœåƒåœ¾æ”¶é›†æˆä¸ºç“¶é¢ˆï¼Œé‚£ä¹ˆéœ€è¦æŒ‡å®šä»£çš„å¤§å°ï¼Œæ£€æŸ¥åƒåœ¾æ”¶é›†çš„è¯¦ç»†è¾“å‡ºï¼Œç ”ç©¶ åƒåœ¾æ”¶é›†å‚æ•°å¯¹æ€§èƒ½çš„å½±å“ã€‚ä¸€èˆ¬è¯´æ¥ï¼Œä½ åº”è¯¥ä½¿ç”¨ç‰©ç†å†…å­˜çš„ 80% ä½œä¸ºå †å¤§å°ã€‚å½“å¢åŠ å¤„ç†å™¨æ—¶ï¼Œè®°å¾—å¢åŠ å†…å­˜ï¼Œå› ä¸ºåˆ†é…å¯ä»¥å¹¶è¡Œè¿›è¡Œï¼Œè€Œåƒåœ¾æ”¶é›†ä¸æ˜¯å¹¶è¡Œçš„ã€‚<br>åœ¨é‡å¯ä½ çš„TomcatæœåŠ¡å™¨ä¹‹åï¼Œè¿™äº›é…ç½®çš„æ›´æ”¹æ‰ä¼šæœ‰æ•ˆã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Windowsä¸‹ï¼Œåœ¨æ–‡ä»¶&#123;tomcat_home&#125;/bin/catalina.batï¼ŒUnixä¸‹ï¼Œåœ¨æ–‡ä»¶&#123;tomcat_home&#125;/bin/catalina.shçš„å‰é¢ï¼Œå¢åŠ å¦‚ä¸‹è®¾ç½®ï¼š</div></pre></td></tr></table></figure>
<h4 id="Tomcatå†…å­˜ä¼˜åŒ–"><a href="#Tomcatå†…å­˜ä¼˜åŒ–" class="headerlink" title="Tomcatå†…å­˜ä¼˜åŒ–"></a>Tomcatå†…å­˜ä¼˜åŒ–</h4><p>Tomcatå†…å­˜ä¼˜åŒ–ä¸»è¦æ˜¯å¯¹ tomcat å¯åŠ¨å‚æ•°ä¼˜åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ tomcat çš„å¯åŠ¨è„šæœ¬ catalina.sh ä¸­è®¾ç½®JAVA_OPTS å‚æ•°ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">1.JAVA_OPTSå‚æ•°è¯´æ˜</div><div class="line"></div><div class="line">Javaä»£ç </div><div class="line"></div><div class="line">     -server  å¯ç”¨jdk çš„ server ç‰ˆï¼›</div><div class="line">     -Xms      javaè™šæ‹Ÿæœºåˆå§‹åŒ–æ—¶çš„æœ€å°å†…å­˜ï¼›</div><div class="line">     -Xmx      javaè™šæ‹Ÿæœºå¯ä½¿ç”¨çš„æœ€å¤§å†…å­˜ï¼›</div><div class="line">     -XX:PermSize    å†…å­˜æ°¸ä¹…ä¿ç•™åŒºåŸŸ</div><div class="line">     -XX:MaxPermSize   å†…å­˜æœ€å¤§æ°¸ä¹…ä¿ç•™åŒºåŸŸ</div></pre></td></tr></table></figure>
<h4 id="æœåŠ¡å™¨å‚æ•°é…ç½®"><a href="#æœåŠ¡å™¨å‚æ•°é…ç½®" class="headerlink" title="æœåŠ¡å™¨å‚æ•°é…ç½®"></a>æœåŠ¡å™¨å‚æ•°é…ç½®</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">    tomcaté»˜è®¤ï¼š -Xms1024m -Xmx1024m -Xss1024K -XX:PermSize=128m -XX:MaxPermSize=256m</div><div class="line"></div><div class="line">Javaä»£ç </div><div class="line"></div><div class="line">    JAVA_OPTS=<span class="string">"-Djava.awt.headless=true -Dfile.encoding=UTF-8</span></div><div class="line">    -server -Xms2048m -Xmx2048m</div><div class="line">    -XX:NewSize=512m -XX:MaxNewSize=512m -XX:PermSize=512m</div><div class="line">    -XX:MaxPermSize=512m -XX:+DisableExplicitGC"</div></pre></td></tr></table></figure>
<p>é…ç½®å®Œæˆåå¯é‡å¯Tomcat ï¼Œé€šè¿‡ä»¥ä¸‹å‘½ä»¤è¿›è¡ŒæŸ¥çœ‹é…ç½®æ˜¯å¦ç”Ÿæ•ˆï¼š</p>
<h4 id="é¦–å…ˆæŸ¥çœ‹Tomcatè¿›ç¨‹å·ï¼š"><a href="#é¦–å…ˆæŸ¥çœ‹Tomcatè¿›ç¨‹å·ï¼š" class="headerlink" title="é¦–å…ˆæŸ¥çœ‹Tomcatè¿›ç¨‹å·ï¼š"></a>é¦–å…ˆæŸ¥çœ‹Tomcatè¿›ç¨‹å·ï¼š</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ps -ef | grep tomcat</div></pre></td></tr></table></figure>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/tomcat_youhua.png" alt=""></figure></p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°Tomcat è¿›ç¨‹å·æ˜¯ 32179 ã€‚</p>
<ul>
<li>å®è·µä¾‹å­ï¼š</li>
</ul>
<p>å…ˆæŸ¥çœ‹æ²¡æœ‰ä¼˜åŒ–tomcatå†…å­˜å‰ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo jmap  â€“ heap 32179</div></pre></td></tr></table></figure>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/tomcat_youhua2.png" alt=""></figure></p>
<h4 id="æŸ¥çœ‹æ˜¯å¦é…ç½®ç”Ÿæ•ˆï¼š"><a href="#æŸ¥çœ‹æ˜¯å¦é…ç½®ç”Ÿæ•ˆï¼š" class="headerlink" title="æŸ¥çœ‹æ˜¯å¦é…ç½®ç”Ÿæ•ˆï¼š"></a>æŸ¥çœ‹æ˜¯å¦é…ç½®ç”Ÿæ•ˆï¼š</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Xmlä»£ç </div><div class="line"></div><div class="line">sudo jmap  â€“ heap 32179</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°MaxHeapSize ç­‰å‚æ•°å·²ç»ç”Ÿæ•ˆã€‚</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/tomcat_youhua3.png" alt=""></figure></p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/tomcat_youhua4.png" alt=""></figure></p>
<p>æç¤ºï¼šå¦‚æœjdk1.8 å¯åŠ¨æœåŠ¡ä¼šæœ‰è­¦å‘Šâš ï¸</p>
<p><code>Java HotSpot(TM) 64-Bit Server VM warning: ignoring option PermSize=512m; support was removed in 8.0</code></p>
<h2 id="Tomcatå¹¶å‘ä¼˜åŒ–"><a href="#Tomcatå¹¶å‘ä¼˜åŒ–" class="headerlink" title="Tomcatå¹¶å‘ä¼˜åŒ–"></a>Tomcatå¹¶å‘ä¼˜åŒ–</h2><p>1.Tomcatè¿æ¥ç›¸å…³å‚æ•°</p>
<p>åœ¨Tomcat é…ç½®æ–‡ä»¶confä¸‹é¢ server.xml ä¸­çš„ <connector ...=""> é…ç½®ä¸­</connector></p>
<p>åœ¨tomcaté…ç½®æ–‡ä»¶server.xmlä¸­çš„<connector ...="">é…ç½®ä¸­ï¼Œå’Œè¿æ¥æ•°ç›¸å…³çš„å‚æ•°æœ‰ï¼š</connector></p>
<p><code>minProcessors</code>ï¼šæœ€å°ç©ºé—²è¿æ¥çº¿ç¨‹æ•°ï¼Œç”¨äºæé«˜ç³»ç»Ÿå¤„ç†æ€§èƒ½ï¼Œé»˜è®¤å€¼ä¸º10<br><code>maxProcessors</code>ï¼šæœ€å¤§è¿æ¥çº¿ç¨‹æ•°ï¼Œå³ï¼šå¹¶å‘å¤„ç†çš„æœ€å¤§è¯·æ±‚æ•°ï¼Œé»˜è®¤å€¼ä¸º75<br><code>acceptCount</code>ï¼šå…è®¸çš„æœ€å¤§è¿æ¥æ•°ï¼Œåº”å¤§äºç­‰äºmaxProcessorsï¼Œé»˜è®¤å€¼ä¸º100<br><code>enableLookups</code>ï¼šæ˜¯å¦åæŸ¥åŸŸåï¼Œå–å€¼ä¸ºï¼štrueæˆ–falseã€‚ä¸ºäº†æé«˜å¤„ç†èƒ½åŠ›ï¼Œåº”è®¾ç½®ä¸ºfalse<br><code>connectionTimeout</code>ï¼šç½‘ç»œè¿æ¥è¶…æ—¶ï¼Œå•ä½ï¼šæ¯«ç§’ã€‚è®¾ç½®ä¸º0è¡¨ç¤ºæ°¸ä¸è¶…æ—¶ï¼Œè¿™æ ·è®¾ç½®æœ‰éšæ‚£çš„ã€‚é€šå¸¸å¯è®¾ç½®ä¸º30000æ¯«ç§’ã€‚</p>
<h3 id="å‚æ•°è¯´æ˜"><a href="#å‚æ•°è¯´æ˜" class="headerlink" title="å‚æ•°è¯´æ˜"></a>å‚æ•°è¯´æ˜</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">é»˜è®¤çš„tomcat å‚æ•°ï¼š</div><div class="line"></div><div class="line">    &lt;Connector port=â€œ8080<span class="string">" protocol="</span>HTTP/1.1<span class="string">"</span></div><div class="line">               connectionTimeout="20000<span class="string">"</span></div><div class="line">               redirectPort="8443<span class="string">" /&gt;</span></div><div class="line"></div><div class="line">ä¿®æ”¹ï¼š</div><div class="line">      </div><div class="line">    &lt;Connector port=â€œ8080" protocol=<span class="string">"HTTP/1.1"</span></div><div class="line">                 maxThreads=<span class="string">"600"</span></div><div class="line">                 minSpareThreads=<span class="string">"100"</span></div><div class="line">                 maxSpareThreads=<span class="string">"500"</span></div><div class="line">                 acceptCount=<span class="string">"700"</span></div><div class="line">                 connectionTimeout=<span class="string">"20000"</span></div><div class="line">                redirectPort=<span class="string">"8443"</span> /&gt;</div><div class="line"></div><div class="line">``` </div><div class="line">è¿™æ ·è®¾ç½®ä»¥åï¼ŒåŸºæœ¬ä¸Šæ²¡æœ‰å†å½“æœºè¿‡ã€‚</div><div class="line"></div><div class="line">``` bash </div><div class="line">  maxThreads=â€œ600<span class="string">" è¡¨ç¤ºæœ€å¤šåŒæ—¶å¤„ç†600ä¸ªè¿æ¥     ///æœ€å¤§çº¿ç¨‹æ•°</span></div><div class="line">  minSpareThreads=â€œ100" è¡¨ç¤ºå³ä½¿æ²¡æœ‰äººä½¿ç”¨ä¹Ÿå¼€è¿™ä¹ˆå¤šç©ºçº¿ç¨‹ç­‰å¾…   ///åˆå§‹åŒ–æ—¶åˆ›å»ºçš„çº¿ç¨‹æ•°   </div><div class="line">  maxSpareThreads=â€œ500<span class="string">" è¡¨ç¤ºå¦‚æœæœ€å¤šå¯ä»¥ç©º500ä¸ªçº¿ç¨‹ï¼Œä¾‹å¦‚æŸæ—¶åˆ»æœ‰505äººè®¿é—®ï¼Œä¹‹åæ²¡æœ‰äººè®¿é—®äº†ï¼Œåˆ™tomcatä¸ä¼šä¿ç•™505ä¸ªç©ºçº¿ç¨‹ï¼Œè€Œæ˜¯å…³é—­505ä¸ªç©ºçš„ã€‚   ///ä¸€æ—¦åˆ›å»ºçš„çº¿ç¨‹è¶…è¿‡è¿™ä¸ªå€¼ï¼ŒTomcatå°±ä¼šå…³é—­ä¸å†éœ€è¦çš„socketçº¿ç¨‹ã€‚</span></div><div class="line">  acceptCount="700<span class="string">"//æŒ‡å®šå½“æ‰€æœ‰å¯ä»¥ä½¿ç”¨çš„å¤„ç†è¯·æ±‚çš„çº¿ç¨‹æ•°éƒ½è¢«ä½¿ç”¨æ—¶ï¼Œå¯ä»¥æ”¾åˆ°å¤„ç†é˜Ÿåˆ—ä¸­çš„è¯·æ±‚æ•°ï¼Œè¶…è¿‡è¿™ä¸ªæ•°çš„è¯·æ±‚å°†ä¸äºˆå¤„ç†</span></div><div class="line">è¿™é‡Œæ˜¯http connectorçš„ä¼˜åŒ–ï¼Œå¦‚æœä½¿ç”¨apacheå’Œtomcatåšé›†ç¾¤çš„è´Ÿè½½å‡è¡¡ï¼Œå¹¶ä¸”ä½¿ç”¨ajpåè®®åšapacheå’Œtomcatçš„åè®®è½¬å‘ï¼Œé‚£ä¹ˆè¿˜éœ€è¦ä¼˜åŒ–ajp connectorã€‚</div><div class="line">   </div><div class="line">    &lt;Connector port="8009<span class="string">" protocol="</span>AJP/1.3<span class="string">" maxThreads="</span>600<span class="string">" minSpareThreads="</span>100<span class="string">" maxSpareThreads="</span>500<span class="string">" acceptCount="</span>700<span class="string">"</span></div><div class="line">connectionTimeout="20000<span class="string">" redirectPort="</span>8443<span class="string">" /&gt;</span></div></pre></td></tr></table></figure>
<h3 id="æŠ¥é”™error"><a href="#æŠ¥é”™error" class="headerlink" title="æŠ¥é”™error"></a>æŠ¥é”™error</h3><h3 id="Tomcatçš„JVMæç¤ºå†…å­˜æº¢å‡º"><a href="#Tomcatçš„JVMæç¤ºå†…å­˜æº¢å‡º" class="headerlink" title="Tomcatçš„JVMæç¤ºå†…å­˜æº¢å‡º"></a>Tomcatçš„JVMæç¤ºå†…å­˜æº¢å‡º</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">æŸ¥çœ‹%TOMCAT_HOME%\logsæ–‡ä»¶å¤¹ä¸‹ï¼Œæ—¥å¿—æ–‡ä»¶æ˜¯å¦æœ‰å†…å­˜æº¢å‡ºé”™è¯¯</div></pre></td></tr></table></figure>
<h3 id="ä¿®æ”¹Tomcatçš„JVM"><a href="#ä¿®æ”¹Tomcatçš„JVM" class="headerlink" title="ä¿®æ”¹Tomcatçš„JVM"></a>ä¿®æ”¹Tomcatçš„JVM</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">1ã€é”™è¯¯æç¤ºï¼šjava.lang.OutOfMemoryError: Java heap space</div></pre></td></tr></table></figure>
<p>Tomcaté»˜è®¤å¯ä»¥ä½¿ç”¨çš„å†…å­˜ä¸º128MBï¼Œåœ¨è¾ƒå¤§å‹çš„åº”ç”¨é¡¹ç›®ä¸­ï¼Œè¿™ç‚¹å†…å­˜æ˜¯ä¸å¤Ÿçš„ï¼Œæœ‰å¯èƒ½å¯¼è‡´ç³»ç»Ÿæ— æ³•è¿è¡Œã€‚å¸¸è§çš„é—®é¢˜æ˜¯æŠ¥Tomcatå†…å­˜æº¢å‡ºé”™è¯¯ï¼ŒOut of Memory(ç³»ç»Ÿå†…å­˜ä¸è¶³)çš„å¼‚å¸¸ï¼Œä»è€Œå¯¼è‡´å®¢æˆ·ç«¯æ˜¾ç¤º500é”™è¯¯ï¼Œä¸€èˆ¬è°ƒæ•´Tomcatçš„ä½¿ç”¨å†…å­˜å³å¯è§£å†³æ­¤é—®é¢˜ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">windowsç¯å¢ƒä¸‹ä¿®æ”¹     </div><div class="line">    â€œ%TOMCAT_HOME%\bin\catalina.batâ€æ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶å¼€å¤´å¢åŠ å¦‚ä¸‹è®¾ç½®ï¼šJAVA_OPTS=-Xms2048m -Xmx2048m</div></pre></td></tr></table></figure>
<h3 id="Linuxç¯å¢ƒä¸‹ä¿®æ”¹"><a href="#Linuxç¯å¢ƒä¸‹ä¿®æ”¹" class="headerlink" title="Linuxç¯å¢ƒä¸‹ä¿®æ”¹"></a>Linuxç¯å¢ƒä¸‹ä¿®æ”¹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">    â€œ%TOMCAT_HOME%\bin\catalina.shâ€æ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶å¼€å¤´å¢åŠ å¦‚ä¸‹è®¾ç½®ï¼šJAVA_OPTS=-Xms2048m -Xmx2048m</div><div class="line">å…¶ä¸­ï¼Œ-Xmsè®¾ç½®åˆå§‹åŒ–å†…å­˜å¤§å°ï¼Œ-Xmxè®¾ç½®å¯ä»¥ä½¿ç”¨çš„æœ€å¤§å†…å­˜ã€‚</div></pre></td></tr></table></figure>
<p>è·Ÿæˆ‘ä¸Šé¢é‚£ä¹ˆè®¾ç½®å°±å¯ä»¥äº†ã€‚</p>
<p>2.é”™è¯¯æç¤ºï¼šjava.lang.OutOfMemoryError: PermGen space</p>
<p>åŸå› ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"> PermGen spaceçš„å…¨ç§°æ˜¯Permanent Generation space,æ˜¯æŒ‡å†…å­˜çš„æ°¸ä¹…ä¿å­˜åŒºåŸŸï¼Œè¿™å—å†…å­˜ä¸»è¦æ˜¯è¢«JVMå­˜</div><div class="line">æ”¾Classå’ŒMetaä¿¡æ¯çš„,Classåœ¨è¢«Loaderæ—¶å°±ä¼šè¢«æ”¾åˆ°PermGen spaceä¸­ï¼Œå®ƒå’Œå­˜æ”¾ç±»å®ä¾‹(Instance)çš„HeapåŒºåŸŸä¸åŒ,GC(Garbage Collection)ä¸ä¼šåœ¨ä¸»ç¨‹åºè¿è¡ŒæœŸå¯¹PermGen spaceè¿›è¡Œæ¸…ç†ï¼Œæ‰€ä»¥å¦‚æœä½ çš„åº”ç”¨ä¸­æœ‰å¾ˆCLASSçš„è¯,å°±å¾ˆå¯èƒ½å‡ºç°PermGen spaceé”™è¯¯ï¼Œè¿™ç§é”™è¯¯å¸¸è§åœ¨webæœåŠ¡å™¨å¯¹JSPè¿›è¡Œpre compileçš„æ—¶å€™ã€‚å¦‚æœä½ çš„WEB APPä¸‹éƒ½ç”¨äº†å¤§é‡çš„ç¬¬ä¸‰æ–¹jar, å…¶å¤§å°è¶…è¿‡äº†jvmé»˜è®¤çš„å¤§å°(4M)é‚£ä¹ˆå°±ä¼šäº§ç”Ÿæ­¤é”™è¯¯ä¿¡æ¯äº†ã€‚</div></pre></td></tr></table></figure>
<p>è§£å†³æ–¹æ³•ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">åœ¨catalina.batçš„ç¬¬ä¸€è¡Œå¢åŠ ï¼š</div><div class="line">   </div><div class="line">    <span class="built_in">set</span> JAVA_OPTS=-Xms64m -Xmx256m -XX:PermSize=128M -XX:MaxNewSize=256m - XX:MaxPermSize=256m</div><div class="line">åœ¨catalina.shçš„ç¬¬ä¸€è¡Œå¢åŠ ï¼š</div><div class="line">    </div><div class="line">     JAVA_OPTS=-Xms64m -Xmx256m -XX:PermSize=128M -XX:MaxNewSize=256m  XX:MaxPermSize=256m</div></pre></td></tr></table></figure>
<h3 id="æŸ¥çœ‹Tomcatçš„JVMå†…å­˜"><a href="#æŸ¥çœ‹Tomcatçš„JVMå†…å­˜" class="headerlink" title="æŸ¥çœ‹Tomcatçš„JVMå†…å­˜"></a>æŸ¥çœ‹Tomcatçš„JVMå†…å­˜</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">1. Tomcat6ä¸­æ²¡æœ‰è®¾ç½®ä»»ä½•é»˜è®¤ç”¨æˆ·ï¼Œå› è€Œéœ€è¦æ‰‹åŠ¨å¾€Tomcat6çš„confæ–‡ä»¶å¤¹ä¸‹çš„tomcat-users.xmlæ–‡ä»¶ä¸­</div><div class="line">æ·»åŠ ç”¨æˆ·ã€‚</div><div class="line">å¦‚ï¼š       </div><div class="line">        &lt;role rolename=<span class="string">"manager"</span>/&gt;</div><div class="line">          &lt;user username=<span class="string">"tomcat"</span> password=<span class="string">"tomcat"</span> roles=<span class="string">"manager"</span>/&gt;</div><div class="line">    </div><div class="line">æ³¨ï¼šæ·»åŠ å®Œéœ€è¦é‡å¯Tomcat6ã€‚</div><div class="line"></div><div class="line">2. è®¿é—®http://localhost:8080/manager/statusï¼Œè¾“å…¥ä¸Šé¢æ·»åŠ çš„ç”¨æˆ·åå’Œå¯†ç ã€‚</div><div class="line"></div><div class="line">3. ç„¶ååœ¨å¦‚ä¸‹é¢çš„JVMä¸‹å¯ä»¥çœ‹åˆ°å†…å­˜çš„ä½¿ç”¨æƒ…å†µã€‚</div></pre></td></tr></table></figure>
<p>å­¦ä¹ Tomcatç»™è‡ªå·±æ€»ç»“ã€‚</p>

	

	

</article>




	<article>
	
		<h1><a href="/2016/06/21/æ€§èƒ½ç›‘æ§/Zabbix/zabbixç›‘æ§tcpè¿æ¥æ•°/">zabbixç›‘æ§tcpè¿æ¥æ•°</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-06-21</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/monitoring/">monitoring</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Zabbix-monitoring/">Zabbix monitoring</a>
			</span>
		
	</div>

	

	
		<p>ç³»ç»Ÿç¯å¢ƒ:</p>
<p>CentOS release 6.7 (Final)</p>
<p>zabbix.3.0.3</p>
<h3 id="zabbix-serverç«¯ï¼š"><a href="#zabbix-serverç«¯ï¼š" class="headerlink" title="zabbix-serverç«¯ï¼š"></a>zabbix-serverç«¯ï¼š</h3><p>é¦–å…ˆåˆ›å»ºè„šæœ¬ Shell</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mkdir /usr/<span class="built_in">local</span>/zabbix/scripts</div><div class="line">[root@zabbix scripts]<span class="comment"># vim /usr/local/zabbix/scripts/tcp_connections.sh</span></div></pre></td></tr></table></figure>
<p>scriptï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"> </div><div class="line"><span class="function"><span class="title">stat</span></span>() &#123;</div><div class="line">        netstat -an | awk <span class="string">'/^tcp/ &#123;++S[$NF]&#125; END &#123;for(a in S) print a, S[a]&#125;'</span></div><div class="line">        &#125;</div><div class="line"> </div><div class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></div><div class="line">        TIME_WAIT)</div><div class="line">        <span class="built_in">stat</span> |grep <span class="string">'TIME_WAIT'</span> |awk <span class="string">'&#123;print $2&#125;'</span></div><div class="line">        ;;</div><div class="line">        CLOSE_WAIT)</div><div class="line">        <span class="built_in">stat</span> | grep <span class="string">'CLOSE_WAIT'</span> |awk <span class="string">'&#123;print $2&#125;'</span></div><div class="line">        ;;</div><div class="line">        FIN_WAIT1)</div><div class="line">        <span class="built_in">stat</span> | grep <span class="string">'FIN_WAIT1'</span> |awk <span class="string">'&#123;print $2&#125;'</span></div><div class="line">        ;;</div><div class="line">        ESTABLISHED)</div><div class="line">        <span class="built_in">stat</span> | grep <span class="string">'ESTABLISHED'</span> |awk <span class="string">'&#123;print $2&#125;'</span></div><div class="line">        ;;</div><div class="line">        SYN_RECV)</div><div class="line">        <span class="built_in">stat</span> |grep <span class="string">'SYN_RECV'</span> |awk <span class="string">'&#123;print $2&#125;'</span></div><div class="line">        ;;</div><div class="line">        LAST_ACK)</div><div class="line">        <span class="built_in">stat</span> |grep <span class="string">'LAST_ACK'</span> |awk <span class="string">'&#123;print $2&#125;'</span></div><div class="line">        ;;</div><div class="line">        LISTEN)</div><div class="line">        <span class="built_in">stat</span> |grep <span class="string">'LISTEN'</span> |awk <span class="string">'&#123;print $2&#125;'</span></div><div class="line">        ;;</div><div class="line">        *)</div><div class="line">        <span class="built_in">echo</span> <span class="string">"Usage: TIME_WAIT CLOSE_WAIT FIN_WAIT1 ESTABLISHED SYN_RECV LAST_ACK LISTEN"</span></div><div class="line">        ;;</div><div class="line"><span class="keyword">esac</span></div></pre></td></tr></table></figure>
<p>æµ‹è¯•è„šæœ¬æ˜¯å¦å¯ç”¨</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@zabbix scripts]<span class="comment">#  chmod +x tcp_connections.sh</span></div><div class="line">[root@zabbix scripts]<span class="comment">#  ./tcp_connections.sh ESTABLISHED</span></div><div class="line">59</div></pre></td></tr></table></figure>
<h3 id="zabbix-agentç«¯ï¼š"><a href="#zabbix-agentç«¯ï¼š" class="headerlink" title="zabbix-agentç«¯ï¼š"></a>zabbix-agentç«¯ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@zabbix scripts]<span class="comment">#  vim /usr/local/zabbix/etc/zabbix_agentd.conf.d/monitor_tcp_connections.conf</span></div></pre></td></tr></table></figure>
<p>ç¼–è¾‘serverç«¯zabbix_agentdé…ç½®</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">UserParameter=tcp.time_wait,/usr/<span class="built_in">local</span>/zabbix/scripts/tcp_connections.sh TIME_WAIT</div><div class="line">UserParameter=tcp.close_wait,/usr/<span class="built_in">local</span>/zabbix/scripts/tcp_connections.sh CLOSE_WAIT</div><div class="line">UserParameter=tcp.fin_wait1,/usr/<span class="built_in">local</span>/zabbix/scripts/tcp_connections.sh FIN_WAIT1</div><div class="line">UserParameter=tcp.established,/usr/<span class="built_in">local</span>/zabbix/scripts/tcp_connections.sh ESTABLISHED</div><div class="line">UserParameter=tcp.syn_recv,/usr/<span class="built_in">local</span>/zabbix/scripts/tcp_connections.sh SYN_RECV</div><div class="line">UserParameter=tcp.last_ack,/usr/<span class="built_in">local</span>/zabbix/scripts/tcp_connections.sh LAST_ACK</div><div class="line">UserParameter=tcp.listen,/usr/<span class="built_in">local</span>/zabbix/scripts/tcp_connections.sh LISTEN</div></pre></td></tr></table></figure>
<h3 id="é‡å¯æœåŠ¡"><a href="#é‡å¯æœåŠ¡" class="headerlink" title="é‡å¯æœåŠ¡"></a>é‡å¯æœåŠ¡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@zabbix scripts]<span class="comment"># /etc/init.d/zabbix_agentd restart</span></div><div class="line">Shutting down zabbix_agentd:                               [ç¡®å®š]</div><div class="line">Starting zabbix_agentd:                                    [ç¡®å®š]</div></pre></td></tr></table></figure>
<h3 id="æµ‹è¯•ç›‘æ§æ˜¯å¦æœ‰æ•°æ®"><a href="#æµ‹è¯•ç›‘æ§æ˜¯å¦æœ‰æ•°æ®" class="headerlink" title="æµ‹è¯•ç›‘æ§æ˜¯å¦æœ‰æ•°æ®"></a>æµ‹è¯•ç›‘æ§æ˜¯å¦æœ‰æ•°æ®</h3><figure class="highlight dts"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta-keyword">/usr/</span>local<span class="meta-keyword">/zabbix/</span>bin/zabbix_get -s localhost -k tcp.established</div><div class="line"><span class="symbol">ZBX_NOTSUPPORTED:</span> Unsupported item key.</div></pre></td></tr></table></figure>
<p>å‡ºç°è¿™ä¸ªé”™è¯¯ï¼Œæç¤ºæˆ‘keyå€¼æœ‰é—®é¢˜ã€‚<br>æ‰€ä»¥æˆ‘æ£€æŸ¥äº†ä¸‹é…ç½®ã€‚</p>
<p>æ·»åŠ äº†ä¸€æ¡ç›®å½•ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">vim /usr/<span class="built_in">local</span>/zabbix/etc/zabbix_agentd.conf</div><div class="line">Include=/usr/<span class="built_in">local</span>/zabbix/etc/zabbix_agentd.conf.d/*.conf</div></pre></td></tr></table></figure>
<p>ç„¶åæµ‹è¯•ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@zabbix scripts]<span class="comment"># /usr/local/zabbix/bin/zabbix_get -s localhost -k tcp.established</span></div><div class="line">64</div></pre></td></tr></table></figure>
<p>ç„¶ååœ¨webé‡Œåˆ›å»ºæ¨¡ç‰ˆï¼Œæ–¹ä¾¿ä»¥åå¤šå°æ·»åŠ </p>
<p>é€‰æ‹©é…ç½®-æ¨¡æ¿-å³ä¸Šè§’.åˆ›å»ºæ¨¡æ¿</p>
<p>å¡«å†™æ¨¡ç‰ˆåç§°</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-tcp1.png" alt=""></figure></p>
<p>åˆ›å»ºç›‘æ§é¡¹</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-tcp2.png" alt=""></figure></p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-tcp3.png" alt=""></figure><br> å¯ä»¥å…‹éš†åˆ›å»ºç›‘æ§é¡¹ã€‚</p>
<p>åˆ›å»ºå›¾å½¢</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-tcp4.png" alt=""></figure></p>
<p>æ¨¡ç‰ˆåˆ›å»ºå®Œæˆåï¼Œè¦å…³è”åˆ°ç›‘æ§ä¸»æœº</p>
<p>ç‚¹å‡»ä¸»æœºï¼Œé€‰æ‹©æ¨¡ç‰ˆ</p>
<p>ç­‰ä¸€ä¼šå„¿æ•°æ®å›¾å½¢å°±ä¼šå‡ºç°</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-tcp6.png" alt=""></figure></p>
<p>å…¶ä»–æœºå™¨ä¹Ÿæ˜¯ä¸€æ ·ç›´æ¥æ·»åŠ æ¨¡æ¿å³å¯ã€‚åœ¨agentdä¸‹é¢æ·»åŠ keyé”®å€¼é‡å¯æœåŠ¡å°±è¡Œã€‚</p>
<p>å¯å‚è€ƒï¼š</p>
<p><a href="http://www.cenhq.com/2015/09/06/zabbix-monitor-tcp-connection-number/" target="_blank" rel="external">zabbixç›‘æ§tcpè¿æ¥æ•°</a></p>
<p>zabbix-server2.4æœåŠ¡ç«¯ç¼–è¯‘å®‰è£… <a href="http://blog.yangcvo.me/2015/01/18/zabbix-serveræœåŠ¡ç«¯ç¼–è¯‘å®‰è£…/" target="_blank" rel="external">zabbix-serveræœåŠ¡ç«¯ç¼–è¯‘å®‰è£…</a></p>
<p>zabbix2.4ç›‘æ§80ç«¯å£çŠ¶æ€ : <a href="http://blog.yangcvo.me/2016/07/20/zabbixç›‘æ§80ç«¯å£çŠ¶æ€/" target="_blank" rel="external">zabbixç›‘æ§80ç«¯å£çŠ¶æ€</a></p>
<p>zabbix+Grafanaå®‰è£…ä½¿ç”¨ç›‘æ§ç»“åˆ ï¼š<a href="http://blog.yangcvo.me/2016/07/13/zabbix-Grafanaå®‰è£…ä½¿ç”¨ç»“åˆ/" target="_blank" rel="external">zabbix+Grafanaå®‰è£…ä½¿ç”¨ç›‘æ§ç»“åˆ</a></p>
<p>zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹ : <a href="http://blog.yangcvo.me/2015/09/29/zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹/" target="_blank" rel="external">zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹</a></p>
<p>zabbixçš„ICMP_Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§ : <a href="http://blog.yangcvo.me/2015/11/18/zabbixçš„ICMP-Pingæ¨¡ç‰ˆ&gt;å®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§/" target="_blank" rel="external">zabbixçš„ICMP_Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§</a></p>
<p>zabbixæ€§èƒ½ç›‘æ§æ•…éšœæ€»ç»“ <a href="http://blog.yangcvo.me/2016/02/07/zabbix-æ•…éšœæ€»ç»“/" target="_blank" rel="external">zabbixæ€§èƒ½ç›‘æ§æ•…éšœæ€»ç»“</a></p>

	

	

</article>




	<article>
	
		<h1><a href="/2016/06/19/æ€§èƒ½ç›‘æ§/Zabbix/zabbix-server3-0-3ç‰ˆæœ¬ç¯å¢ƒå®‰è£…éƒ¨ç½²/">zabbix-server3.0.3ç‰ˆæœ¬ç¯å¢ƒå®‰è£…éƒ¨ç½²</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-06-19</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/monitoring/">monitoring</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Zabbix-monitoring/">Zabbix monitoring</a>
			</span>
		
	</div>

	

	
		<h2 id="ç³»ç»Ÿç¯å¢ƒï¼š"><a href="#ç³»ç»Ÿç¯å¢ƒï¼š" class="headerlink" title="ç³»ç»Ÿç¯å¢ƒï¼š"></a>ç³»ç»Ÿç¯å¢ƒï¼š</h2><ul>
<li>192.168.1.170 MySQLä¸» </li>
<li>192.168.1.183 zabbix-server</li>
</ul>
<p>CentOS Linux release 7.2.1511 (Core)</p>
<ul>
<li>zabbixæºç ä¸‹è½½ : <a href="http://www.zabbix.com/download.php" target="_blank" rel="external">http://www.zabbix.com/download.php</a></li>
<li>ä¾èµ–ä¸‹è½½ï¼š <a href="https://github.com/zabbixcn/curl-rpm/tree/master/RPMS" target="_blank" rel="external">https://github.com/zabbixcn/curl-rpm/tree/master/RPMS</a></li>
<li>zabbix Downä¸‹è½½å®‰è£…åŒ…ï¼š<a href="http://repo.zabbix.com/zabbix/3.2/rhel/6/x86_64/" target="_blank" rel="external">http://repo.zabbix.com/zabbix/3.2/rhel/6/x86_64/</a></li>
<li>zabbix3.2 <a href="http://jaist.dl.sourceforge.net/project/zabbix/ZABBIX%20Latest%20Stable/3.2.4/zabbix-3.2.4.tar.gz" target="_blank" rel="external">http://jaist.dl.sourceforge.net/project/zabbix/ZABBIX%20Latest%20Stable/3.2.4/zabbix-3.2.4.tar.gz</a></li>
</ul>
<h3 id="ç¬¬ä¸€æ­¥zabbixï¼š"><a href="#ç¬¬ä¸€æ­¥zabbixï¼š" class="headerlink" title="ç¬¬ä¸€æ­¥zabbixï¼š"></a>ç¬¬ä¸€æ­¥zabbixï¼š</h3><p>å…³é—­æœ¬æœºä¸Šçš„selinuxä¸iptablesæœåŠ¡</p>
<p>1ã€å…³é—­SELinux</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#ä¸‹é¢çš„å‘½ä»¤å®ç°æ°¸ä¹…å…³é—­SELinux</span></div><div class="line"> sed -i <span class="string">'s/^SELINUX=.*/#&amp;/;s/^SELINUXTYPE=.*/#&amp;/;/SELINUX=.*/a SELINUX=disabled'</span> /etc/sysconfig/selinux</div><div class="line"><span class="comment">#ä¸‹é¢çš„å‘½ä»¤å®ç°ä¸´æ—¶å…³é—­SELinux</span></div><div class="line"></div><div class="line">/usr/sbin/setenforce 0</div><div class="line">/usr/sbin/setenforce: SELinux is disabled</div></pre></td></tr></table></figure>
<p>ä¹Ÿå¯ä»¥è®¾ç½®å¼€æ”¾ç«¯å£å‡ºå»ã€‚</p>
<p>CentOS 7.0é»˜è®¤ä½¿ç”¨çš„æ˜¯firewallä½œä¸ºé˜²ç«å¢™ï¼Œè¿™é‡Œæ”¹ä¸ºiptablesé˜²ç«å¢™ã€‚</p>
<p>firewallï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">systemctl start firewalld.service<span class="comment">#å¯åŠ¨firewall</span></div><div class="line">systemctl stop firewalld.service<span class="comment">#åœæ­¢firewall</span></div><div class="line">systemctl <span class="built_in">disable</span> firewalld.service<span class="comment">#ç¦æ­¢firewallå¼€æœºå¯åŠ¨</span></div></pre></td></tr></table></figure>
<p>CentOS7é»˜è®¤çš„é˜²ç«å¢™ä¸æ˜¯iptables,è€Œæ˜¯firewalle.<br>centos 7 çš„é»˜è®¤æ²¡æœ‰å®‰è£…iptables éœ€è¦å®‰è£…ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">yum install iptables-services</div><div class="line"><span class="comment">#ä¿å­˜ä¸Šè¿°è§„åˆ™ </span></div><div class="line">service iptables save</div></pre></td></tr></table></figure>
<p>ç­‰ä¼šå†æ·»åŠ ç«¯å£ï¼š10050 ï¼Œ10051 </p>
<p>æ­å»ºLAMPç¯å¢ƒï¼Œæˆ–LNMPç¯å¢ƒ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install mysql-server httpd php â€“y</div></pre></td></tr></table></figure>
<p>å®‰è£…å…¶å®ƒä¾èµ–åŒ…</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install mysql-devel gcc net-snmp-devel curl-devel perl-DBI php-gd php-mysql php-bcmath  php-mbstring php-<span class="keyword">xml</span> <span class="title">â€“y</span>  gcc OpenIPMI-devel net-snmp-devel.x86_64 libxml2-devel mysql-devel</div></pre></td></tr></table></figure>
<p> è¿™é‡ŒMySQLæˆ‘å·²ç»åœ¨MySQLæœåŠ¡å™¨ä¸Šé¢å®‰è£…å¥½äº†ã€‚åªéœ€è¦åˆ›å»ºä¸ªæ–°çš„zabbixæ•°æ®åº“å³å¯ã€‚</p>
<p> å¢åŠ zabbixç”¨æˆ·å’Œç»„</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">groupadd zabbix</div><div class="line">useradd â€“g zabbix â€“m zabbix</div></pre></td></tr></table></figure>
<p>ä¸‹è½½zabbix3.0ç‰ˆæœ¬ï¼Œè§£å‹å®‰è£…</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">wget http://oak0aohum.bkt.clouddn.com/zabbix-3.0.3.tar.gz  -c /tmp/</div><div class="line"><span class="built_in">cd</span> /tmp/</div><div class="line">tar zxf zabbix-3.0.3.tar.gz</div><div class="line">./configure --prefix=/usr/<span class="built_in">local</span>/zabbix --enable-server --with-mysql --with-net-snmp --with-libxml2 --with-libcurl --with-openipmi --enable-proxy --enable-agent --enable-java --with-ldap</div><div class="line"></div><div class="line">ç¼–è¯‘æˆåŠŸè¿™é‡Œä¼šå‡ºç°ï¼š</div><div class="line">***********************************************************</div><div class="line">*            Now run <span class="string">'make install'</span>                       *</div><div class="line">*                                                         *</div><div class="line">*            Thank you <span class="keyword">for</span> using Zabbix!                  *</div><div class="line">*              &lt;http://www.zabbix.com&gt;                    *</div><div class="line">***********************************************************</div><div class="line"><span class="comment">#ç›´æ¥make install å®‰è£…å³å¯ï¼š</span></div><div class="line"> </div><div class="line">make install</div></pre></td></tr></table></figure>
<p>è¿™é‡Œç¼–è¯‘å®‰è£… æˆ‘åŠ ä¸Šäº†ï¼šâ€“enable-java è¿™æ ·é˜²æ­¢åæœŸç›‘æ§tomcatéœ€è¦é‡æ–°ç¼–è¯‘ã€‚</p>
<h3 id="3-é…ç½®æ•°æ®åº“"><a href="#3-é…ç½®æ•°æ®åº“" class="headerlink" title="3.é…ç½®æ•°æ®åº“"></a>3.é…ç½®æ•°æ®åº“</h3><p> ç™»é™†åˆ°192.168.1.170æœåŠ¡å™¨ä¸Šé¢ï¼š</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># mysql -e "create database zabbix character set utf8 collate  utf8_bin;"   #ä¿®æ”¹æ—¶åŒº</span></div><div class="line"><span class="comment"># mysql -e "grant all privileges on zabbix.* to zabbix@localhost identified by 'zabbix';"  #åˆ›å»ºæ•°æ®åº“å</span></div></pre></td></tr></table></figure>
<p> è¿™é‡Œæˆ‘è®¾ç½®äº†åªèƒ½192.168.1.0ç½‘æ®µå¯ä»¥è®¿é—®æ•°æ®åº“ã€‚<br> æ‰€ä»¥è¿™é‡Œåˆ›å»ºæ•°æ®åº“ç›´æ¥è¿™ä¹ˆæ“ä½œäº†ã€‚</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">[root@mysql ~]<span class="comment"># mysql -uroot -pIhaozhuo_b313 -h 192.168.1.170</span></div><div class="line">Warning: Using a password on the <span class="built_in">command</span> line interface can be insecure.</div><div class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</div><div class="line">Your MySQL connection id is 10</div><div class="line">Server version: 5.6.20-log MySQL Community Server (GPL)</div><div class="line"></div><div class="line">Copyright (c) 2000, 2014, Oracle and/or its affiliates. All rights reserved.</div><div class="line"></div><div class="line">Oracle is a registered trademark of Oracle Corporation and/or its</div><div class="line">affiliates. Other names may be trademarks of their respective</div><div class="line">owners.</div><div class="line"></div><div class="line">Type <span class="string">'help;'</span> or <span class="string">'\h'</span> <span class="keyword">for</span> help. Type <span class="string">'\c'</span> to clear the current input statement.</div><div class="line"></div><div class="line">mysql&gt; create database zabbix character <span class="built_in">set</span> utf8 collate  utf8_bin;</div><div class="line">Query OK, 1 row affected (0.06 sec)</div><div class="line">mysql&gt; GRANT ALL ON zabbix.* TO <span class="string">'zabbix'</span>@<span class="string">'192.168.1.%'</span> IDENTIFIED BY <span class="string">'zabbix123.com'</span>;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line">mysql&gt; flush privileges;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div></pre></td></tr></table></figure>
<h3 id="å››-å¯¼å…¥æ•°æ®åº“æ–‡ä»¶ï¼š"><a href="#å››-å¯¼å…¥æ•°æ®åº“æ–‡ä»¶ï¼š" class="headerlink" title="å››.å¯¼å…¥æ•°æ®åº“æ–‡ä»¶ï¼š"></a>å››.å¯¼å…¥æ•°æ®åº“æ–‡ä»¶ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /usr/share/doc/zabbix-server-mysql-2.4.8/create</div></pre></td></tr></table></figure>
<p>æ“ä½œä¸‰æ¡å‘½ä»¤æŠŠæ•°æ®å¯¼å…¥åˆ°åœ¨æŒ‡å®šçš„MySQLï¼šzabbix</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mysql -uzabbix -pzabbix123.com -h 192.168.1.170  zabbix &lt; schema.sql</div><div class="line">mysql -uzabbix -pzabbix123.com -h 192.168.1.170  zabbix &lt; images.sql</div><div class="line">mysql -uzabbix -pzabbix123.com -h 192.168.1.170  zabbix &lt; data.sql</div></pre></td></tr></table></figure>
<h3 id="äº”ã€é…ç½®æ–‡ä»¶åŠwebå‰ç«¯æ–‡ä»¶ä¿®æ”¹"><a href="#äº”ã€é…ç½®æ–‡ä»¶åŠwebå‰ç«¯æ–‡ä»¶ä¿®æ”¹" class="headerlink" title="äº”ã€é…ç½®æ–‡ä»¶åŠwebå‰ç«¯æ–‡ä»¶ä¿®æ”¹"></a>äº”ã€é…ç½®æ–‡ä»¶åŠwebå‰ç«¯æ–‡ä»¶ä¿®æ”¹</h3><p>æ·»åŠ æœåŠ¡ç«¯å£</p>
<p>vi /etc/services #ç¼–è¾‘ï¼Œåœ¨æœ€åæ·»åŠ ä»¥ä¸‹ä»£ç </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Zabbix</span></div><div class="line">zabbix-agent 10050/tcp   <span class="comment"># Zabbix Agent</span></div><div class="line">zabbix-agent 10050/udp   <span class="comment"># Zabbix Agent</span></div><div class="line">zabbix-trapper 10051/tcp <span class="comment"># Zabbix Trapper</span></div><div class="line">zabbix-trapper 10051/udp <span class="comment"># Zabbix Trapper</span></div><div class="line">:wq! <span class="comment">#ä¿å­˜é€€å‡º</span></div></pre></td></tr></table></figure>
<p>æ·»åŠ åå¦‚ä¸‹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># grep zabbix /etc/services</span></div><div class="line">zabbix-agent     10050/tcp  <span class="comment">#ZabbixAgent</span></div><div class="line">zabbix-agent     10050/udp  <span class="comment">#ZabbixAgent</span></div><div class="line">zabbix-trapper   10051/tcp  <span class="comment">#ZabbixTrapperz</span></div><div class="line">abbix-trapper    10051/udp  <span class="comment">#ZabbixTrapper</span></div></pre></td></tr></table></figure>
<p>ä¿®æ”¹zabbixé…ç½®æ–‡ä»¶</p>
<p>vim /usr/local/zabbix/etc/zabbix_server.conf</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">DBName=zabbix <span class="comment">#æ•°æ®åº“åç§°</span></div><div class="line">DBUser=zabbix <span class="comment">#æ•°æ®åº“ç”¨æˆ·å</span></div><div class="line">DBPassword=zabbix123.com <span class="comment">#æ•°æ®åº“å¯†ç </span></div><div class="line">ListenIP=192.168.1.170 <span class="comment">#æ•°æ®åº“ipåœ°å€</span></div><div class="line">AlertScriptsPath=/usr/<span class="built_in">local</span>/zabbix/share/zabbix/alertscripts   <span class="comment">#zabbixè¿è¡Œè„šæœ¬å­˜æ”¾ç›®å½•</span></div></pre></td></tr></table></figure>
<p>:wq! #ä¿å­˜é€€å‡º</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">vi /usr/<span class="built_in">local</span>/zabbix/etc/zabbix_agentd.conf</div><div class="line">Include=/usr/<span class="built_in">local</span>/zabbix/etc/zabbix_agentd.conf.d/</div><div class="line">UnsafeUserParameters=1 <span class="comment">#å¯ç”¨è‡ªå®šä¹‰key</span></div><div class="line">:wq! <span class="comment">#ä¿å­˜é€€å‡º</span></div></pre></td></tr></table></figure>
<p>1.2 COPYç›¸å…³è„šæœ¬åˆ°æ–°ç¼–è¯‘çš„ç›®å½•ä¸‹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"> cp /tmp/zabbix-3.0.3/misc/init.d/fedora/core/zabbix_server  /etc/rc.d/init.d/zabbix_server</div><div class="line">[root@salt etc]<span class="comment"># cp /tmp/zabbix-3.0.3/misc/init.d/fedora/core/zabbix_agentd /etc/rc.d/init.d/zabbix_agentd</span></div><div class="line"></div><div class="line"></div><div class="line">ä¿®æ”¹è„šæœ¬è·¯å¾„ï¼š</div><div class="line"></div><div class="line">vim /etc/init.d/zabbix_server </div><div class="line">  </div><div class="line"> BASEDIR=/usr/<span class="built_in">local</span>/zabbix/</div><div class="line"></div><div class="line">vim /etc/init.d/zabbix_agentd</div><div class="line"></div><div class="line">BASEDIR=/usr/<span class="built_in">local</span>/zabbix  </div><div class="line"></div><div class="line">chmod +x /etc/rc.d/init.d/zabbix_server <span class="comment">#æ·»åŠ è„šæœ¬æ‰§è¡Œæƒé™</span></div><div class="line">chmod +x /etc/rc.d/init.d/zabbix_agentd <span class="comment">#æ·»åŠ è„šæœ¬æ‰§è¡Œæƒé™</span></div><div class="line">chkconfig zabbix_server on <span class="comment">#æ·»åŠ å¼€æœºå¯åŠ¨</span></div><div class="line">chkconfig zabbix_agentd on <span class="comment">#æ·»åŠ å¼€æœºå¯åŠ¨</span></div></pre></td></tr></table></figure>
<p>å…«ã€é…ç½®webç«™ç‚¹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> zabbix-2.4.8</div><div class="line">cp -r /zabbix-2.4.8/frontends/php /var/www/html/zabbix</div><div class="line"><span class="built_in">cd</span> /var/www/html/</div><div class="line">chown -R zabbix:zabbix zabbix</div></pre></td></tr></table></figure>
<p>service zabbix_server start #å¯åŠ¨zabbixæœåŠ¡ç«¯</p>
<p>service zabbix_agentd start #å¯åŠ¨zabbixå®¢æˆ·ç«¯</p>
<p>ç„¶åé‡å¯æœåŠ¡ã€‚</p>
<p>å‘ç°å‡ºç°<code>500</code> ç½‘é¡µæ— æ³•æ˜¾ç¤ºï¼Œæˆ‘å»ç½‘ä¸ŠGoogleäº†ä¸‹ï¼Œè¯´æˆ‘çš„PHPæ–‡ä»¶ç‰ˆæœ¬è¿‡ä½ã€‚</p>
<p>æˆ‘æŸ¥çœ‹äº†ä¸‹æˆ‘çš„ç‰ˆæœ¬ï¼š</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">php -version</div><div class="line">PHP <span class="number">5.3</span><span class="number">.3</span> (cli) (<span class="string">built:</span> Feb  <span class="number">9</span> <span class="number">2016</span> <span class="number">10</span>:<span class="number">36</span>:<span class="number">17</span>)</div><div class="line">Copyright (c) <span class="number">1997</span><span class="number">-2010</span> The PHP Group</div><div class="line">Zend Engine v2<span class="number">.3</span><span class="number">.0</span>, Copyright (c) <span class="number">1998</span><span class="number">-2010</span> Zend Technologies</div><div class="line"></div><div class="line">whereis php</div><div class="line"><span class="string">php:</span> <span class="regexp">/usr/</span>bin<span class="regexp">/php /</span>etc<span class="regexp">/php.d /</span>etc<span class="regexp">/php.ini /</span>usr<span class="regexp">/lib64/</span>php <span class="regexp">/usr/</span>share<span class="regexp">/php /</span>usr<span class="regexp">/share/</span>man<span class="regexp">/man1/</span>php<span class="number">.1</span>.gz</div></pre></td></tr></table></figure>
<p>æŸ¥è¯¢äº†ä¸‹è¿™æ˜¯é»˜è®¤å®‰è£…çš„ï¼Œyumå®‰è£…çš„ã€‚</p>
<p>mv /usr/share/php/ /usr/share/php.5.3.3<br>å¤‡ä»½ä¹‹å‰çš„æ–¹ä¾¿å›æ»šï¼Œç„¶åå‡çº§PHPï¼š</p>
<h3 id="å¿«é€Ÿå°†PHP-5-3å‡çº§è‡³PHP-5-5"><a href="#å¿«é€Ÿå°†PHP-5-3å‡çº§è‡³PHP-5-5" class="headerlink" title="å¿«é€Ÿå°†PHP 5.3å‡çº§è‡³PHP 5.5"></a>å¿«é€Ÿå°†PHP 5.3å‡çº§è‡³PHP 5.5</h3><p>CentOS 6.7<br>ä»¥ä¸‹ä¸º CentOS ä¸‹å®‰è£… PHP æ–¹æ³•ï¼š</p>
<p>æ·»åŠ  epel æº</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta"># rpm -Uvh http:<span class="comment">//download.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm</span></span></div></pre></td></tr></table></figure>
<p>æ·»åŠ  remi æº</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta"># rpm -Uvh http:<span class="comment">//rpms.famillecollet.com/enterprise/remi-release-6.rpm</span></span></div></pre></td></tr></table></figure>
<p>å®‰è£… PHP</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> yum --enablerepo=remi,remi-php55 install php-fpm php-common php-devel php-mysqlnd php-mbstring php-mcrypt</span></div></pre></td></tr></table></figure>
<p>æŸ¥çœ‹ PHP ç‰ˆæœ¬</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># <span class="selector-tag">php</span> <span class="selector-tag">-v</span></div><div class="line"><span class="selector-tag">PHP</span> 5<span class="selector-class">.5</span><span class="selector-class">.9</span> (<span class="selector-tag">cli</span>) (<span class="selector-tag">built</span>: <span class="selector-tag">Feb</span> 11 2014 08<span class="selector-pseudo">:25</span><span class="selector-pseudo">:33)</span></div><div class="line"><span class="selector-tag">Copyright</span> (<span class="selector-tag">c</span>) 1997<span class="selector-tag">-2014</span> <span class="selector-tag">The</span> <span class="selector-tag">PHP</span> <span class="selector-tag">Group</span></div><div class="line"><span class="selector-tag">Zend</span> <span class="selector-tag">Engine</span> <span class="selector-tag">v2</span><span class="selector-class">.5</span><span class="selector-class">.0</span>, <span class="selector-tag">Copyright</span> (<span class="selector-tag">c</span>) 1998<span class="selector-tag">-2014</span> <span class="selector-tag">Zend</span> <span class="selector-tag">Technologies</span></div></pre></td></tr></table></figure>
<p>å¯åŠ¨ php-fpm</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># service php-fpm start</span></div><div class="line"><span class="attribute">Starting</span> php-fpm:ã€€<span class="meta">ã€€[  OK  ]</span></div></pre></td></tr></table></figure>
<p>è¿™é‡Œé‡å¯å®Œä»¥åï¼Œè®°å¾—è¦è®©phpç”Ÿæ•ˆï¼Œä¸ç„¶çš„è¯ä¸è¡Œã€‚</p>
<p>æˆ‘ä¸€å¼€å§‹åˆ·æ–°è¿˜æ˜¯å‡ºç°äº†500é”™è¯¯ï¼Œåæ¥ç”¨phpæŒ‡é’ˆæµ‹è¯•äº†ä¸‹ç‰ˆæœ¬æ˜¯å¤šå°‘ï¼Ÿ</p>
<p>wwwç«™ç‚¹æ·»åŠ ã€‚info.php </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?php</span></span></div><div class="line"></div><div class="line"> phpinfo();</div><div class="line"></div><div class="line"><span class="meta">?&gt;</span>;</div></pre></td></tr></table></figure>
<p>è®¿é—®åœ°å€/info.php  å‡ºç°ç‰ˆæœ¬æ˜¯5.3 ç¯å¢ƒé—®é¢˜ï¼Œé‡å¯httpå°±å¯ä»¥äº†ã€‚</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-server3.0.png" alt=""></figure></p>
<p>è¿™é‡Œå·²ç»æå®šå’¯ã€‚</p>
<p> å¦‚æœå‡ºç°å›¾å½¢ä¹±ç ï¼šå¯ä»¥å‚è€ƒä¸‹é¢çš„æ–‡æ¡£ã€‚</p>
<p>å…¶å®æŠŠä¹‹å‰çš„å­—ä½“æ‹·è´è¿‡å»ï¼Œç„¶åå…ˆä¿®æ”¹ä¸‹é…ç½®æ–‡ä»¶å³å¯ã€‚</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cp <span class="regexp">/var/</span>www<span class="regexp">/html/</span>zabbix.<span class="number">2.4</span>.<span class="number">7</span><span class="regexp">/fonts/</span>simkai.ttf <span class="regexp">/var/</span>www<span class="regexp">/html/</span>zabbix<span class="regexp">/fonts/</span>.</div></pre></td></tr></table></figure>
<p>zabbix-server2.4æœåŠ¡ç«¯ç¼–è¯‘å®‰è£… <a href="http://blog.yangcvo.me/2015/01/18/zabbix-serveræœåŠ¡ç«¯ç¼–è¯‘å®‰è£…/" target="_blank" rel="external">zabbix-serveræœåŠ¡ç«¯ç¼–è¯‘å®‰è£…</a></p>
<p>zabbix2.4ç›‘æ§80ç«¯å£çŠ¶æ€ : <a href="http://blog.yangcvo.me/2016/07/20/zabbixç›‘æ§80ç«¯å£çŠ¶æ€/" target="_blank" rel="external">zabbixç›‘æ§80ç«¯å£çŠ¶æ€</a></p>
<p>zabbix+Grafanaå®‰è£…ä½¿ç”¨ç›‘æ§ç»“åˆ ï¼š<a href="http://blog.yangcvo.me/2016/07/13/zabbix-Grafanaå®‰è£…ä½¿ç”¨ç»“åˆ/" target="_blank" rel="external">zabbix+Grafanaå®‰è£…ä½¿ç”¨ç›‘æ§ç»“åˆ</a></p>
<p>zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹ : <a href="http://blog.yangcvo.me/2015/09/29/zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹/" target="_blank" rel="external">zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹</a></p>
<p>zabbixçš„ICMP_Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§ : <a href="http://blog.yangcvo.me/2015/11/18/zabbixçš„ICMP-Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§/" target="_blank" rel="external">zabbixçš„ICMP_Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§</a></p>
<p>zabbixæ€§èƒ½ç›‘æ§æ•…éšœæ€»ç»“ <a href="http://blog.yangcvo.me/2016/02/07/zabbix-æ•…éšœæ€»ç»“/" target="_blank" rel="external">zabbixæ€§èƒ½ç›‘æ§æ•…éšœæ€»ç»“</a></p>

	

	

</article>




	<article>
	
		<h1><a href="/2016/06/18/æ€§èƒ½ç›‘æ§/Zabbix/zabbix-server2-4å…¨æ–°å‡çº§3-0ç‰ˆæœ¬/">zabbix-server2.4å…¨æ–°å‡çº§3.0ç‰ˆæœ¬</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-06-18</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/monitoring/">monitoring</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Zabbix-monitoring/">Zabbix monitoring</a>
			</span>
		
	</div>

	

	
		<p>zabbix3.0å‡ºæ¥äº†ä¸€æ®µæ—¶é—´äº†ï¼Œæœ€è¿‘å¿ä¸ä½æŠŠå…¬å¸åŸæ¥çš„2.4.7ç‰ˆæœ¬å‡çº§åˆ°äº†3.0ã€‚zabbixå‡çº§å…¶å®å¾ˆç®€å•ï¼ŒåŸºæœ¬æ­¥éª¤ä¸ºï¼šå¤‡ä»½-&gt;é‡æ–°å®‰è£…æ–°ç‰ˆæœ¬ã€‚æ¥ä¸‹æ¥ç®€å•å†™ä¸‹è¿™æ¬¡å‡çº§çš„æ“ä½œå’Œé—®é¢˜</p>
<h4 id="1ã€-å…³é—­zabbix-server"><a href="#1ã€-å…³é—­zabbix-server" class="headerlink" title="1ã€ å…³é—­zabbix server"></a>1ã€ å…³é—­zabbix server</h4><p>é˜²æ­¢æœ‰æ–°çš„æ•°æ®æäº¤åˆ°æ•°æ®åº“ä¸­ã€ç›´æ¥å…³é—­æ•°æ®åº“æ•ˆæœä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚è¿™é‡Œæˆ‘å…ˆå…³é—­æ‰æˆ‘çš„æœåŠ¡ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">/etc/init.d/zabbix_server stop  å…³é—­äº†serveræœåŠ¡ç«¯</div><div class="line">/etc/init.d/zabbix_agentd stop   å…³é—­äº†agentå®¢æˆ·ç«¯</div></pre></td></tr></table></figure>
<h3 id="2ã€-å¤‡ä»½"><a href="#2ã€-å¤‡ä»½" class="headerlink" title="2ã€ å¤‡ä»½"></a>2ã€ å¤‡ä»½</h3><h4 id="2-1-å¤‡ä»½æ•°æ®åº“"><a href="#2-1-å¤‡ä»½æ•°æ®åº“" class="headerlink" title="2.1 å¤‡ä»½æ•°æ®åº“"></a>2.1 å¤‡ä»½æ•°æ®åº“</h4><p>æœ€ç®€å•çš„å¤‡ä»½ï¼šå…³é—­æ•°æ®ï¼Œæ•´ä¸ªæ•°æ®åº“ç›®å½•copyä¸€ä»½ã€‚è™½è¯´å‡çº§ä¸€èˆ¬ä¸ä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯å®‰å…¨èµ·è§è¿˜æ˜¯æœ‰å¿…è¦å¤‡ä»½ä¸€ä¸‹ï¼Œå°±ç®—å‡çº§æˆåŠŸï¼Œä½†æ˜¯ä¸èƒ½ä¿è¯æ–°ç‰ˆæœ¬è®©ä½ å–œæ¬¢ï¼Œè¿™ä¸ªæ—¶å€™å›é€€ä¹Ÿæœ‰åè·¯ã€‚</p>
<p>è¿™é‡Œæˆ‘ç”¨çš„æ˜¯å‘½ä»¤å¯¼å‡ºçš„ï¼š<br>ä¹Ÿå¯ä»¥ç”¨NAvicatï¼Œå¯¼å‡ºç»“æ„å’Œæ•°æ®ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">mysqldump -u root -p*****  -h MySQLIPåœ°å€ --opt --skip-lock-tables --flush-logs --database zabbix &gt;  /tmp/zabbix.sql</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">mysqldump -uroot -p -P7306 --opt --skip-lock-tables --flush-logs --database zabbix3 --ignore-table=zabbix.history --ignore-table=zabbix.history_log --ignore-table=zabbix.history_str --ignore-table=zabbix.history_text --ignore-table=zabbix.history_uint --ignore-table=zabbix.trends --ignore-table=zabbix.trends_uint  &gt;/root/zabbix20183026.sql</div><div class="line"></div><div class="line"></div><div class="line">Warning: Using a password on the <span class="built_in">command</span> line interface can be insecure.</div><div class="line">Warning: Using unique option prefix database instead of databases is deprecated and will be removed <span class="keyword">in</span> a future release. Please use the full name instead.</div><div class="line">mysqldump: Got error: 1227: Access denied; you need (at least one of) the RELOAD privilege(s) <span class="keyword">for</span> this operation when doing refresh</div><div class="line"></div><div class="line">æç¤ºï¼š</div><div class="line"></div><div class="line">Login to mysql as root and enter your <span class="built_in">command</span>:</div><div class="line"></div><div class="line">FLUSH PRIVILEGES;</div></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼šzabbixæ•°æ®åº“å¤‡ä»½å¯ä»¥å¤‡ä»½æ•´ä¸ª/var/lib/zabbixç›®å½•ä¸‹æ‰€æœ‰æ•°æ®ï¼Œä½†æ˜¯æ–‡ä»¶æ¯”è¾ƒå¤§ï¼Œå¾ˆå ç©ºé—´ã€‚ä¸å»ºè®®è¿™ä¹ˆåšã€‚æ‰€ä»¥æˆ‘ä»¬è¿™é‡Œåªå¤‡ä»½zabbixçš„è¡¨æ–‡ä»¶ï¼Œå†å²æ•°æ®å’Œè¶‹åŠ¿æ•°æ®çš„è¡¨ä¸å¤‡ä»½ã€‚</p>
<h4 id="2-2-å¤‡ä»½æ–‡ä»¶"><a href="#2-2-å¤‡ä»½æ–‡ä»¶" class="headerlink" title="2.2 å¤‡ä»½æ–‡ä»¶"></a>2.2 å¤‡ä»½æ–‡ä»¶</h4><p>å¤‡ä»½é…ç½®æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯/etc/zabbixï¼‰ã€phpç½‘ç«™æºç ã€zabbixäºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆæ•´ä¸ªç¨‹åºç›®å½•å¤‡ä»½å°±OKï¼‰</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">å¤‡ä»½é…ç½®æ–‡ä»¶ï¼š mv /usr/<span class="built_in">local</span>/zabbix/ /usr/<span class="built_in">local</span>/zabbix.2.4.7</div><div class="line"></div><div class="line">å¤‡ä»½å¯åŠ¨è„šæœ¬ï¼š</div><div class="line"> mv /etc/init.d/zabbix_server /etc/init.d/zabbix_server.2.4.7</div><div class="line"> mv /etc/init.d/zabbix_agentd /etc/init.d/zabbix_agentd.2.4.7</div><div class="line"></div><div class="line">å¤‡ä»½zabbix.phpæ–‡ä»¶ï¼š</div><div class="line"></div><div class="line"> mv /var/www/html/zabbix/ /var/www/html/zabbix.2.4.7</div></pre></td></tr></table></figure>
<h2 id="3ã€å®‰è£…é…ç½®"><a href="#3ã€å®‰è£…é…ç½®" class="headerlink" title="3ã€å®‰è£…é…ç½®"></a>3ã€å®‰è£…é…ç½®</h2><h4 id="3-1-å®‰è£…Zabbix-server-é‡æ–°å®‰è£…æ–°ç‰ˆæœ¬"><a href="#3-1-å®‰è£…Zabbix-server-é‡æ–°å®‰è£…æ–°ç‰ˆæœ¬" class="headerlink" title="3.1 å®‰è£…Zabbix server é‡æ–°å®‰è£…æ–°ç‰ˆæœ¬"></a>3.1 å®‰è£…Zabbix server é‡æ–°å®‰è£…æ–°ç‰ˆæœ¬</h4><p>é‡å¤´å®‰è£…ä¸€æ¬¡zabbixï¼Œä¹Ÿå°±æ˜¯configure â€“â€¦ make make install.<br>å¤‡æ³¨ï¼šä¸€èˆ¬é«˜ç‰ˆæœ¬zabbix serverå…¼å®¹ä½ç‰ˆæœ¬zabbixå®¢æˆ·ç«¯ã€‚å¦‚æœå‘ç°æœ‰å¼‚å¸¸ï¼Œé‚£ä¹ˆä½ çš„zabbixå®¢æˆ·ç«¯ä¹Ÿç›¸åº”å‡çº§ä¸€ä¸‹ã€‚å®¢æˆ·ç«¯å‡çº§æ¯”è¾ƒç®€å•ï¼šæ›´æ–°äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œé…ç½®æ–‡ä»¶å¯¹ç…§ä¸‹æ˜¯å¦æœ‰ä¿®æ”¹å³å¯ã€‚</p>
<p>ä¸‹è½½zabbix3.0ç‰ˆæœ¬ï¼Œè§£å‹å®‰è£…</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">wget http://oak0aohum.bkt.clouddn.com/zabbix-3.0.3.tar.gz  -c /tmp/</div><div class="line"><span class="built_in">cd</span> /tmp/</div><div class="line">tar zxf zabbix-3.0.3.tar.gz</div><div class="line">./configure --prefix=/usr/<span class="built_in">local</span>/zabbix --enable-server --with-mysql --with-net-snmp --with-libxml2 --with-libcurl --with-openipmi --enable-proxy --enable-agent --enable-java --with-ldap</div><div class="line"></div><div class="line">å¦‚æœç¼–è¯‘å¤±è´¥æ²¡æœ‰libxml2 ldap éœ€è¦yumå®‰è£…ä¸‹ï¼š</div><div class="line">yum install openldap openldap-devel libxml2* -y </div><div class="line"> </div><div class="line">ç¼–è¯‘æˆåŠŸè¿™é‡Œä¼šå‡ºç°ï¼š</div><div class="line">***********************************************************</div><div class="line">*            Now run <span class="string">'make install'</span>                       *</div><div class="line">*                                                         *</div><div class="line">*            Thank you <span class="keyword">for</span> using Zabbix!                  *</div><div class="line">*              &lt;http://www.zabbix.com&gt;                    *</div><div class="line">***********************************************************</div><div class="line"><span class="comment">#ç›´æ¥make install å®‰è£…å³å¯ï¼š</span></div><div class="line"> </div><div class="line">make install</div></pre></td></tr></table></figure>
<p>è¿™é‡Œç¼–è¯‘å®‰è£… æˆ‘åŠ ä¸Šäº†ï¼šâ€“enable-java è¿™æ ·é˜²æ­¢åæœŸç›‘æ§tomcatéœ€è¦é‡æ–°ç¼–è¯‘ã€‚<br>å®‰è£…å¥½ä»¥åï¼š</p>
<p>3.2 æ£€æŸ¥é…ç½®æ–‡ä»¶<br>zabbix_server.confé…ç½®å‚æ•°å¯èƒ½ä¼šæœ‰å˜åŒ–ï¼Œä¿®æ”¹å˜æ›´åçš„å‚æ•°ï¼Œæˆ–è€…ç›´æ¥ä¿®æ”¹æ–°çš„é…ç½®æ–‡ä»¶ã€‚</p>
<p>1.1 å¯¹ç…§è€ç‰ˆæœ¬çš„zabbix_server.confè¿›è¡Œä¿®æ”¹ï¼Œä¸èƒ½ç›´æ¥æ›¿æ¢ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">vim /usr/<span class="built_in">local</span>/zabbix/etc/</div><div class="line"></div><div class="line">LogFile=/tmp/zabbix_server.log</div><div class="line">DBHost=rdsm5t6w65741u8q1y53.mysql.rds.aliyuncs.com</div><div class="line">DBName=zabbix</div><div class="line">DBUser=zabbix</div><div class="line">DBPassword=zabbix2015</div><div class="line">StartPollers=12</div><div class="line">JavaGateway=127.0.0.1</div><div class="line">JavaGatewayPort=10052</div><div class="line">StartJavaPollers=5</div><div class="line">Timeout=4</div><div class="line">FpingLocation=/usr/<span class="built_in">local</span>/fping/sbin/fping</div><div class="line">LogSlowQueries=3000</div><div class="line">AlertScriptsPath=/usr/<span class="built_in">local</span>/zabbix/share/zabbix/alertscripts</div></pre></td></tr></table></figure>
<p>1.2 COPYç›¸å…³è„šæœ¬åˆ°æ–°ç¼–è¯‘çš„ç›®å½•ä¸‹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"> cp /tmp/zabbix-3.0.3/misc/init.d/fedora/core/zabbix_server  /etc/rc.d/init.d/zabbix_server</div><div class="line">[root@salt etc]<span class="comment"># cp /tmp/zabbix-3.0.3/misc/init.d/fedora/core/zabbix_agentd /etc/rc.d/init.d/zabbix_agentd</span></div><div class="line"></div><div class="line">vim /etc/init.d/zabbix_server </div><div class="line"> BASEDIR=/usr/<span class="built_in">local</span>/zabbix/</div><div class="line"> </div><div class="line">vim /etc/init.d/zabbix_agentd</div><div class="line">BASEDIR=/usr/<span class="built_in">local</span>/zabbix</div></pre></td></tr></table></figure>
<p>1.3 alertscriptså’Œexternalscripts é‡Œé¢çš„ç›¸å…³è„šæœ¬å¤åˆ¶åˆ°æ–°çš„å®‰è£…ç›®å½•ä¸‹ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cp /usr/<span class="built_in">local</span>/zabbix.2.4.7/share/zabbix/alertscripts/* /usr/<span class="built_in">local</span>/zabbix/share/zabbix/alertscripts/.</div><div class="line">chown -R zabbix:zabbix /usr/<span class="built_in">local</span>/zabbix/share/zabbix/alertscripts/*</div></pre></td></tr></table></figure>
<p>4ã€ éƒ¨ç½²zabbix PHPæºç <br>4.1 å°†æ–°çš„å‰ç«¯PHPä»£ç ä¹ŸCOPYåˆ°å¯¹åº”çš„ç›®å½•ä¸‹ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /tmp/</div><div class="line">cp -r /zabbix-3.0.3/frontends/php /var/www/html/zabbix</div><div class="line"><span class="built_in">cd</span> /var/www/html/</div><div class="line">chown -R zabbix:zabbix zabbix</div><div class="line"></div><div class="line">cp zabbix.2.4.7/conf/zabbix.conf.php zabbix/conf/zabbix.conf.php</div></pre></td></tr></table></figure>
<p> æ‹·è´ä¸‹phpæ–‡ä»¶è¿™æ ·æ•°æ®å°±èƒ½è®¿é—®åŒæ­¥è¿‡æ¥äº†ã€‚ </p>
<p>ç„¶åé‡å¯æœåŠ¡ã€‚</p>
<p>å‘ç°å‡ºç°<code>500</code> ç½‘é¡µæ— æ³•æ˜¾ç¤ºï¼Œæˆ‘å»ç½‘ä¸ŠGoogleäº†ä¸‹ï¼Œè¯´æˆ‘çš„PHPæ–‡ä»¶ç‰ˆæœ¬è¿‡ä½ã€‚</p>
<p>æˆ‘æŸ¥çœ‹äº†ä¸‹æˆ‘çš„ç‰ˆæœ¬ï¼š</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">php -version</div><div class="line">PHP <span class="number">5.3</span><span class="number">.3</span> (cli) (<span class="string">built:</span> Feb  <span class="number">9</span> <span class="number">2016</span> <span class="number">10</span>:<span class="number">36</span>:<span class="number">17</span>)</div><div class="line">Copyright (c) <span class="number">1997</span><span class="number">-2010</span> The PHP Group</div><div class="line">Zend Engine v2<span class="number">.3</span><span class="number">.0</span>, Copyright (c) <span class="number">1998</span><span class="number">-2010</span> Zend Technologies</div><div class="line"></div><div class="line">whereis php</div><div class="line"><span class="string">php:</span> <span class="regexp">/usr/</span>bin<span class="regexp">/php /</span>etc<span class="regexp">/php.d /</span>etc<span class="regexp">/php.ini /</span>usr<span class="regexp">/lib64/</span>php <span class="regexp">/usr/</span>share<span class="regexp">/php /</span>usr<span class="regexp">/share/</span>man<span class="regexp">/man1/</span>php<span class="number">.1</span>.gz</div></pre></td></tr></table></figure>
<p>æŸ¥è¯¢äº†ä¸‹è¿™æ˜¯é»˜è®¤å®‰è£…çš„ï¼Œyumå®‰è£…çš„ã€‚</p>
<p>mv /usr/share/php/ /usr/share/php.5.3.3<br>å¤‡ä»½ä¹‹å‰çš„æ–¹ä¾¿å›æ»šï¼Œç„¶åå‡çº§PHPï¼š</p>
<h3 id="å¿«é€Ÿå°†PHP-5-3å‡çº§è‡³PHP-5-5"><a href="#å¿«é€Ÿå°†PHP-5-3å‡çº§è‡³PHP-5-5" class="headerlink" title="å¿«é€Ÿå°†PHP 5.3å‡çº§è‡³PHP 5.5"></a>å¿«é€Ÿå°†PHP 5.3å‡çº§è‡³PHP 5.5</h3><p>CentOS 6.7<br>ä»¥ä¸‹ä¸º CentOS ä¸‹å®‰è£… PHP æ–¹æ³•ï¼š</p>
<p>æ·»åŠ  epel æº</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta"># rpm -Uvh http:<span class="comment">//download.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm</span></span></div></pre></td></tr></table></figure>
<p>æ·»åŠ  remi æº</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta"># rpm -Uvh http:<span class="comment">//rpms.famillecollet.com/enterprise/remi-release-6.rpm</span></span></div></pre></td></tr></table></figure>
<p>å®‰è£… PHP</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> yum --enablerepo=remi,remi-php55 install php-fpm php-common php-devel php-mysqlnd php-mbstring php-mcrypt</span></div></pre></td></tr></table></figure>
<p>æŸ¥çœ‹ PHP ç‰ˆæœ¬</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># <span class="selector-tag">php</span> <span class="selector-tag">-v</span></div><div class="line"><span class="selector-tag">PHP</span> 5<span class="selector-class">.5</span><span class="selector-class">.9</span> (<span class="selector-tag">cli</span>) (<span class="selector-tag">built</span>: <span class="selector-tag">Feb</span> 11 2014 08<span class="selector-pseudo">:25</span><span class="selector-pseudo">:33)</span></div><div class="line"><span class="selector-tag">Copyright</span> (<span class="selector-tag">c</span>) 1997<span class="selector-tag">-2014</span> <span class="selector-tag">The</span> <span class="selector-tag">PHP</span> <span class="selector-tag">Group</span></div><div class="line"><span class="selector-tag">Zend</span> <span class="selector-tag">Engine</span> <span class="selector-tag">v2</span><span class="selector-class">.5</span><span class="selector-class">.0</span>, <span class="selector-tag">Copyright</span> (<span class="selector-tag">c</span>) 1998<span class="selector-tag">-2014</span> <span class="selector-tag">Zend</span> <span class="selector-tag">Technologies</span></div></pre></td></tr></table></figure>
<p>å¯åŠ¨ php-fpm</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># service php-fpm start</span></div><div class="line"><span class="attribute">Starting</span> php-fpm:ã€€<span class="meta">ã€€[  OK  ]</span></div></pre></td></tr></table></figure>
<p>è¿™é‡Œé‡å¯å®Œä»¥åï¼Œè®°å¾—è¦è®©phpç”Ÿæ•ˆï¼Œä¸ç„¶çš„è¯ä¸è¡Œã€‚</p>
<p>æˆ‘ä¸€å¼€å§‹åˆ·æ–°è¿˜æ˜¯å‡ºç°äº†500é”™è¯¯ï¼Œåæ¥ç”¨phpæŒ‡é’ˆæµ‹è¯•äº†ä¸‹ç‰ˆæœ¬æ˜¯å¤šå°‘ï¼Ÿ</p>
<p>wwwç«™ç‚¹æ·»åŠ ã€‚info.php </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?php</span></span></div><div class="line"></div><div class="line"> phpinfo();</div><div class="line"></div><div class="line"><span class="meta">?&gt;</span>;</div></pre></td></tr></table></figure>
<p>è®¿é—®åœ°å€/info.php  å‡ºç°ç‰ˆæœ¬æ˜¯5.3 ç¯å¢ƒé—®é¢˜ï¼Œé‡å¯httpå°±å¯ä»¥äº†ã€‚</p>
<p>è¿™é‡Œå·²ç»æå®šå’¯ã€‚</p>
<p> å¦‚æœå‡ºç°å›¾å½¢ä¹±ç ï¼šå¯ä»¥å‚è€ƒä¸‹é¢çš„æ–‡æ¡£ã€‚</p>
<p>å…¶å®æŠŠä¹‹å‰çš„å­—ä½“æ‹·è´è¿‡å»ï¼Œç„¶åå…ˆä¿®æ”¹ä¸‹é…ç½®æ–‡ä»¶å³å¯ã€‚</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cp <span class="regexp">/var/</span>www<span class="regexp">/html/</span>zabbix.<span class="number">2.4</span>.<span class="number">7</span><span class="regexp">/fonts/</span>simkai.ttf <span class="regexp">/var/</span>www<span class="regexp">/html/</span>zabbix<span class="regexp">/fonts/</span>.</div></pre></td></tr></table></figure>
<p>3.0ç‰ˆæœ¬å‡çº§ä»¥åå…¶å®å°±æ˜¯ä¸ªæ•°æ®åº“ä¸å˜ï¼Œå…¶ä»–çš„é‡æ–°å®‰è£…ä¸€éå³å¯ã€‚ 10å¤šåˆ†é’Ÿå°±å¯ä»¥æå®šçš„ã€‚</p>
<h4 id="å‡çº§é‡åˆ°çš„é—®é¢˜"><a href="#å‡çº§é‡åˆ°çš„é—®é¢˜" class="headerlink" title="å‡çº§é‡åˆ°çš„é—®é¢˜"></a>å‡çº§é‡åˆ°çš„é—®é¢˜</h4><ol>
<li><code>The frontend does not match Zabbix database. Current database version (mandatory/optional): 2050119/2050119. Required mandatory version: 3000000. Contact your system administrator.</code><br>ç™»å½•åˆ°æ•°æ®åº“æ‰§è¡Œä¸‹é¢çš„sql,å°±å¯ä»¥ä¿®å¤è¿™ä¸ªé—®é¢˜</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql&gt;update dbversion <span class="built_in">set</span> mandatory=3000000;</div></pre></td></tr></table></figure>
<ol>
<li>2 zabbix å†…å­˜æº¢å‡º<br>è·‘äº†æ–°ç‰ˆæœ¬1å¤©ï¼Œè€æ˜¯å¯åŠ¨ä¸èµ·æ¥zabbix_server ï¼Œçœ‹æ—¥å¿—å‡ºç°ä¸‹åˆ—é—®é¢˜</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">16701:20140925:191733.530 Starting Zabbix Server. Zabbix 3.0.3 (revision 48953).</div><div class="line">16701:20140925:191733.530 ****** Enabled features ******</div><div class="line">16701:20140925:191733.530 SNMP monitoring: YES</div><div class="line">16701:20140925:191733.530 IPMI monitoring: YES</div><div class="line">16701:20140925:191733.530 WEB monitoring: YES</div><div class="line">16701:20140925:191733.530 VMware monitoring: NO</div><div class="line">16701:20140925:191733.530 Jabber notifications: NO</div><div class="line">16701:20140925:191733.530 Ez Texting notifications: YES</div><div class="line">16701:20140925:191733.530 ODBC: NO</div><div class="line">16701:20140925:191733.530 SSH2 support: NO</div><div class="line">16701:20140925:191733.531 IPv6 support: NO</div><div class="line">16701:20140925:191733.531 ******************************</div><div class="line">16701:20140925:191733.531 using configuration file: /opt/zabbix/etc/zabbix_server.conf</div><div class="line">15996:20140925:191145.759 completed 97% of database upgrade</div><div class="line">15996:20140925:191147.139 completed 98% of database upgrade</div><div class="line">15996:20140925:191147.422 completed 99% of database upgrade</div><div class="line">15996:20140925:191147.428 completed 100% of database upgrade</div><div class="line">15996:20140925:191147.428 database upgrade fully completed</div><div class="line">15996:20140925:191148.800 __mem_malloc: skipped 0 asked 48 skip_min 0 skip_max 4294967295</div><div class="line">15996:20140925:191148.800 [file:dbconfig.c,line:445] zbx_mem_malloc(): out of memory (requested 44 bytes)</div><div class="line">15996:20140925:191148.800 [file:dbconfig.c,line:445] zbx_mem_malloc(): please increase CacheSize configuration parameter</div><div class="line">15996:20140925:191148.800 [file:dbconfig.c,line:445] zbx_mem_malloc(): out of memory (requested 44 bytes)</div><div class="line">15996:20140925:191148.800 [file:dbconfig.c,line:445] zbx_mem_malloc(): please increase CacheSize configuration parameter</div></pre></td></tr></table></figure>
<p>è§£å†³<br>æ‰“å¼€<code>zabbix_server.conf</code>æ‰¾åˆ° <code>Option: CacheSize</code><br>æŠŠåŸæ¥çš„<code># CacheSize=8M</code> å‰é¢çš„#æ³¨é‡Šå»æ‰ï¼Œå°†8Mä¿®æ”¹ä¸º1024ï¼Œè¿™ä¸ª1024æ ¹æ®æœåŠ¡å™¨æ€§èƒ½ä¿®æ”¹ã€‚</p>
<h3 id="äº¤æµå­¦ä¹ ï¼š"><a href="#äº¤æµå­¦ä¹ ï¼š" class="headerlink" title="äº¤æµå­¦ä¹ ï¼š"></a>äº¤æµå­¦ä¹ ï¼š</h3><p>ğŸ§  Linux shell_é«˜çº§è¿ç»´æ´¾: <code>459096184</code>    åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)<br>ğŸ§  BigData-Exchange School : <code>521621407</code>  åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥</p>
<p>ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚</p>

	

	

</article>




	<article>
	
		<h1><a href="/2016/06/17/æ€§èƒ½ç›‘æ§/Zabbix/zabbix-Grafanaå®‰è£…ä½¿ç”¨ç»“åˆ/">zabbix+Grafanaå®‰è£…ä½¿ç”¨ç›‘æ§ç»“åˆ</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-06-17</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/monitoring/">monitoring</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Zabbix-monitoring/">Zabbix monitoring</a>
			</span>
		
	</div>

	

	
		<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åšè¿ç»´çš„å¾ˆé‡è¦çš„åŸºç¡€å·¥ä½œå°±æ˜¯ç›‘æ§å»å‡†ç¡®å®šä½é—®é¢˜ï¼Œä¹‹å‰ç”¨çš„æ˜¯Nagiosåšè¿‡ç›‘æ§ï¼Œä¹Ÿç”¨è¿‡cactiï¼Œè¿™ä¸ªä¹‹å‰åœ¨IDCåšCDNç½‘ç»œæ–¹é¢ç”¨çš„æ¯”è¾ƒå¤šï¼Œç›‘æ§æµé‡å¥½å¸®æ‰‹ã€‚</p>
<p>ä¸ºä»€ä¹ˆé€‰æ‹©zabbixå…¶å®ç°åœ¨æ˜¯ç®—å¼€æºç›‘æ§æ¯”è¾ƒç«çš„ã€‚æ›´é‡è¦æ˜¯å‡ æ¬¾ç›‘æ§åšäº†å¯¹æ¯”ã€‚</p>
<p>cactiã€zabbixåŒnagiosä¸€æ ·ï¼Œéƒ½æ˜¯éå¸¸ä¼˜åŠ¿çš„å¼€æºç›‘æ§è½¯ä»¶ã€‚ </p>
<blockquote>
<p>Nagios: è½»é‡çº§/æ–¹ä¾¿/å¿«æ·æ˜¯nagiosæœ€å¤§çš„ä¼˜åŠ¿ï¼Œç‰¹åˆ«æ˜¯å®ƒçš„æ’ä»¶æœºåˆ¶ï¼Œä½ å¯ä»¥ç”¨è‡ªå·±ç†Ÿæ‚‰çš„è¯­è¨€å®ç°å‡ ä¹ä»»ä½•è‡ªå·±æƒ³è¦å®ç°çš„ç›‘æ§ã€‚ä½†nagiosçš„å›¾æ ‡å›¾å½¢æ˜¾ç¤ºçš„å¾ˆä¸‘ï¼Œè¿™æ–¹é¢çš„ç¡®ä¸æ•¢æ­ç»´ã€‚<br>Cacti: cactiçš„ä¼˜åŠ¿è¡¨ç°åœ¨ç³»ç»Ÿæ–¹é¢çš„ç›‘æ§ï¼Œç‰¹åˆ«é’ˆå¯¹æµé‡çš„ç›‘æ§åŠŸèƒ½ï¼Œ ä»¥åŠcactiå›¾å½¢æ˜¾ç¤ºç¾è§‚ç­‰ï¼Œcactiåœ¨è¿™ä¸¤æ–¹é¢è¡¨ç°çš„éƒ½ä¸é”™ã€‚<br>Zabbix: zabbixæ˜¯ä¸€ä¸ªåŸºäºWEBç•Œé¢çš„æä¾›åˆ†å¸ƒå¼ç³»ç»Ÿç›‘è§†ä»¥åŠç½‘ç»œç›‘è§†åŠŸèƒ½çš„ä¼ä¸šçº§çš„å¼€æºè§£å†³æ–¹æ¡ˆã€‚åŠŸèƒ½å…¨é¢ï¼Œå¾ˆå¤šå…¬å¸éƒ½æ˜¯åŸºäºzabbixè‡ªå»ºçš„ç›‘æ§å¹³å°ã€‚ä½†ç»´æŠ¤ç›¸å¯¹å›°éš¾ï¼Œç›¸æ¯”æ²¡æœ‰nagiosè½»é‡åŠçµæ´»ã€‚</p>
</blockquote>
<p>ç°åœ¨sassç›‘æ§ï¼Œä¹Ÿæˆä¸ºä¼ä¸šç›‘æ§çš„é€‰æ‹©ä¹‹ä¸€äº†ï¼ŒåŠ ä¸Š<code>zabbixã€Ganglia</code>ç­‰ï¼Œå†åŠ ä¸ŠAPMçš„å…´èµ·ï¼Œç›‘æ§ä½“ç³»ä¹Ÿè¶Šæ¥è¶Šå®Œå–„äº†ã€‚ä»åŸºç¡€ç½‘ç»œç›‘æ§ã€ç¡¬ä»¶ã€æœåŠ¡å™¨ã€åº”ç”¨ã€æ€§èƒ½ï¼Œç„¶åç«¯åˆ°ç«¯ç­‰æ–¹é¢ï¼Œéƒ½å¯ä»¥æ’å…¥ï¼Œä½†æ˜¯æ²¡æœ‰ä¸€ä¸ªæ¯”è¾ƒå®Œæ•´çš„ç›‘æ§ä½“ç³»æ˜¯å¯ä»¥å®Œå…¨èƒœä»»çš„ï¼Œæ‰€ä»¥è¿˜éœ€è¦æ ¹æ®è‡ªèº«çš„åº”ç”¨å’Œç›®æ ‡å»ç»¼åˆåšé€‰æ‹©ã€‚</p>
<p>å‰å‡ å¤©æ¥è§¦åˆ°äº†<code>ELK(logstash, elasticsearch, kibana)</code>è¿™å¥—æ—¥å¿—æ”¶é›†å±•ç¤ºå·¥å…·é›†,çš„ç¡®å¾ˆæ–¹ä¾¿ï¼Œè¿™æ ·å¯¹ä»¥åå¼€å‘æŒ‡å®šæƒé™æŸ¥çœ‹æ—¥å¿—ï¼Œå¯ä»¥å¾ˆå¥½ç®¡ç†ã€‚</p>
<p>è¿™é‡Œç®€å•è¯´äº†ä¸‹ä¸ºä»€ä¹ˆä½¿ç”¨zabbix, Gangliaçš„åŠŸèƒ½æ˜¯å“ªäº›ï¼Ÿä¸‹é¢æœ‰è®²åˆ°ã€‚</p>
<h3 id="Grafanaæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#Grafanaæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="Grafanaæ˜¯ä»€ä¹ˆï¼Ÿ"></a>Grafanaæ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>ä¸ªäººè®¤ä¸ºï¼š Grafanaæ˜¯ä¸€æ¬¾å¯¹åç«¯æ•°æ®è¿›è¡Œå®æ—¶å±•ç¤ºï¼Œè·Ÿelké‚£ç§å·®ä¸å¤šï¼Œéå¸¸æ¸…æ™°è€Œä¸”çµæ´»ä¸°å¯Œçš„å›¾å½¢åŒ–é€‰é¡¹ï¼Œå¯ä»¥æ··åˆå¤šç§é£æ ¼ï¼Œæ”¯æŒç™½å¤©å’Œå¤œé—´çš„æ¨¡å¼ï¼Œå¤šä¸ªæ•°æ®æºï¼Œè€Œè·Ÿzabbixæ¯”èµ·æ¥æ²¡æœ‰é‚£ä¹ˆä¸“ä¸šç›‘æ§ï¼Œæ²¡æœ‰é‚£ä¹ˆä¸°å¯Œçš„ç›‘æ§åŠŸèƒ½ï¼Œå°±æ˜¯ä¸€ä¸ªå›¾åƒå±•ç¤ºã€‚</p>
<p>åŠŸèƒ½äº®ç‚¹</p>
<ul>
<li>ä¸°å¯Œçš„å›¾å½¢ä¸Grafana</li>
<li>æ¨¡æ¿å˜é‡å¯ä»¥åˆ›å»ºå¯é‡ç”¨çš„ä»ªè¡¨æ¿</li>
</ul>
<p>å®˜æ–¹æ˜¯æ€ä¹ˆè§£é‡ŠGrafanaçš„ï¼š</p>
<p>grafanaæ˜¯ç”¨äºå¯è§†åŒ–å¤§å‹æµ‹é‡æ•°æ®çš„å¼€æºç¨‹åºï¼Œä»–æä¾›äº†å¼ºå¤§å’Œä¼˜é›…çš„æ–¹å¼å»åˆ›å»ºã€å…±äº«ã€æµè§ˆæ•°æ®ã€‚dashboardä¸­æ˜¾ç¤ºäº†ä½ ä¸åŒmetricæ•°æ®æºä¸­çš„æ•°æ®ã€‚<br>grafanaæœ€å¸¸ç”¨äºå› ç‰¹ç½‘åŸºç¡€è®¾æ–½å’Œåº”ç”¨åˆ†æï¼Œä½†åœ¨å…¶ä»–é¢†åŸŸä¹Ÿæœ‰æœºä¼šç”¨åˆ°ï¼Œæ¯”å¦‚ï¼šå·¥ä¸šä¼ æ„Ÿå™¨ã€å®¶åº­è‡ªåŠ¨åŒ–ã€è¿‡ç¨‹æ§åˆ¶ç­‰ç­‰ã€‚<br>grafanaæœ‰çƒ­æ’æ‹”æ§åˆ¶é¢æ¿å’Œå¯æ‰©å±•çš„æ•°æ®æºï¼Œç›®å‰å·²ç»æ”¯æŒGraphiteã€InfluxDBã€OpenTSDBã€Elasticsearchã€‚</p>
<h3 id="GrafanaåŠŸèƒ½äº®ç‚¹"><a href="#GrafanaåŠŸèƒ½äº®ç‚¹" class="headerlink" title="GrafanaåŠŸèƒ½äº®ç‚¹"></a>GrafanaåŠŸèƒ½äº®ç‚¹</h3><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">ä¸°å¯Œçš„å›¾å½¢</div><div class="line">å®Œå…¨äº¤äº’çš„ï¼Œå¯ç¼–è¾‘çš„å›¾è¡¨ã€‚å¤šä¸ªYè½´ï¼Œå¯¹æ•°åˆ»åº¦å’Œé€‰é¡¹ã€‚</div><div class="line"></div><div class="line">æ··åˆé€ å‹</div><div class="line">ç”»å‡ºä½ çš„å›¾å½¢ï¼Œä½ æƒ³æ€ä¹ˆã€‚æ··çº¿ï¼Œç‚¹å’Œé…’å§ã€‚æ··åˆå †å ç“¦ç‰¹/éš”ç¦»ç³»åˆ—ã€‚</div><div class="line"></div><div class="line">ä¸»é¢˜</div><div class="line">é™„å¸¦ä¸¤ä¸ªä¸»é¢˜ã€‚å¦‚æœä½ ä¸å–œæ¬¢é»˜è®¤çš„é»‘æš—çš„ä¸»é¢˜ï¼Œåˆ‡æ¢åˆ°å…‰çš„ä¸»é¢˜ã€‚</div><div class="line"></div><div class="line">æ¨¡æ¿å˜é‡</div><div class="line">åˆ›å»ºå˜é‡ä¼šè‡ªåŠ¨å¡«å…¥å€¼ä»æ‚¨çš„æ•°æ®åº“ã€‚</div><div class="line"></div><div class="line">ä¸€èˆ¬å¯é‡å¤ä½¿ç”¨</div><div class="line">æ‚¨å¯ä»¥åœ¨åº¦é‡æŸ¥è¯¢å’Œé¢æ¿æ ‡é¢˜ä¸­ä½¿ç”¨å˜é‡ã€‚</div><div class="line"></div><div class="line">é‡å¤é¢æ¿</div><div class="line">è‡ªåŠ¨é‡å¤æ¯ä¸ªé€‰å®šçš„å˜é‡å€¼çš„è¡Œæˆ–é¢æ¿ã€‚</div><div class="line"></div><div class="line">æ•°æ®æº</div><div class="line">æ”¯æŒGraphiteï¼ŒElasticsearchï¼ŒPrometheusï¼ŒInfluxDBï¼ŒOpenTSDBå’ŒKairosDBå¼€ç®±ã€‚æˆ–ä½¿ç”¨æ’ä»¶åŠŸèƒ½æ¥æ·»åŠ è‡ªå·±çš„ã€‚</div><div class="line"></div><div class="line">è®¤è¯</div><div class="line">ç®¡ç†ç”¨æˆ·ï¼Œè§’è‰²å’Œç»„ç»‡ã€‚é€šè¿‡LDAPï¼ŒåŸºæœ¬éªŒè¯ä¸è®¤è¯ä»£ç†</div><div class="line"></div><div class="line">æ³¨é‡Š</div><div class="line">æ³¨é‡Šä¸datasoucesåŒ…æ‹¬Elasticsearchï¼ŒçŸ³å¢¨å’ŒInfluxDBä¸°å¯Œçš„æ´»åŠ¨å›¾</div><div class="line"></div><div class="line">å¿«ç…§å…±äº«</div><div class="line">åˆ›å»ºå’Œå…±äº«åœ¨<span class="number">1</span>ç‚¹å‡»ä¸€ä¸ªå®Œå…¨äº¤äº’å¼å›¾è¡¨å’Œåªæœ‰ä½ çš„å›¢é˜Ÿæˆ–å…¨ä¸–ç•Œåˆ†äº«ã€‚</div></pre></td></tr></table></figure>
<h3 id="Grafanaå®˜ç½‘"><a href="#Grafanaå®˜ç½‘" class="headerlink" title="Grafanaå®˜ç½‘"></a>Grafanaå®˜ç½‘</h3><p>Granfanaå®˜ç½‘ï¼š<a href="http://grafana.org" target="_blank" rel="external">http://grafana.org</a></p>
<h3 id="Granfanaå®˜ç½‘å®‰è£…å‚è€ƒæ–‡æ¡£"><a href="#Granfanaå®˜ç½‘å®‰è£…å‚è€ƒæ–‡æ¡£" class="headerlink" title="Granfanaå®˜ç½‘å®‰è£…å‚è€ƒæ–‡æ¡£"></a>Granfanaå®˜ç½‘å®‰è£…å‚è€ƒæ–‡æ¡£</h3><p>å®‰è£…æ–‡æ¡£ï¼š<a href="http://docs.grafana.org/installation/" target="_blank" rel="external">http://docs.grafana.org/installation/</a></p>
<h3 id="grafanaå’ŒLDAPé›†æˆï¼š"><a href="#grafanaå’ŒLDAPé›†æˆï¼š" class="headerlink" title="grafanaå’ŒLDAPé›†æˆï¼š"></a>grafanaå’ŒLDAPé›†æˆï¼š</h3><p>LDAPé›†æˆï¼š<a href="http://docs.grafana.org/installation/ldap/" target="_blank" rel="external">http://docs.grafana.org/installation/ldap/</a></p>
<h3 id="grafanaæ¼”ç¤ºç«™ç‚¹"><a href="#grafanaæ¼”ç¤ºç«™ç‚¹" class="headerlink" title="grafanaæ¼”ç¤ºç«™ç‚¹"></a>grafanaæ¼”ç¤ºç«™ç‚¹</h3><p>grafanaæ¼”ç¤ºç«™ç‚¹: <a href="http://play.grafana.org/" target="_blank" rel="external">http://play.grafana.org/</a></p>
<h3 id="3-0ç‰ˆæœ¬å…³äºGrafana-zabbixæ’ä»¶å®˜æ–¹æ–‡æ¡£ï¼š"><a href="#3-0ç‰ˆæœ¬å…³äºGrafana-zabbixæ’ä»¶å®˜æ–¹æ–‡æ¡£ï¼š" class="headerlink" title="3.0ç‰ˆæœ¬å…³äºGrafana-zabbixæ’ä»¶å®˜æ–¹æ–‡æ¡£ï¼š"></a>3.0ç‰ˆæœ¬å…³äºGrafana-zabbixæ’ä»¶å®˜æ–¹æ–‡æ¡£ï¼š</h3><p><a href="http://docs.grafana-zabbix.org/" target="_blank" rel="external">Grafana-zabbixæ’ä»¶å®‰è£…å®˜æ–¹ä½¿ç”¨æ–‡æ¡£</a></p>
<h3 id="å®˜ç½‘ä¸‹è½½åœ°å€"><a href="#å®˜ç½‘ä¸‹è½½åœ°å€" class="headerlink" title="å®˜ç½‘ä¸‹è½½åœ°å€"></a>å®˜ç½‘ä¸‹è½½åœ°å€</h3><p>Download Grafana:<a href="https://grafana.com/grafana/download" target="_blank" rel="external">Download Grafana</a></p>
<h3 id="å®‰è£…Grafana"><a href="#å®‰è£…Grafana" class="headerlink" title="å®‰è£…Grafana"></a>å®‰è£…Grafana</h3><ul>
<li>æ¸©é¦¨æç¤ºï¼š</li>
</ul>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">grafanaçš„ç‰ˆæœ¬å’Œgrafana-zabbixçš„ç‰ˆæœ¬å¿…é¡»åŒ¹é…ï¼Œå¦åˆ™ä¼šå‡ºç°å¼‚å¸¸ã€‚</div><div class="line">æœ¬æ–‡ä»¥grafana2<span class="number">.5</span>ç‰ˆæœ¬ä¸ºä¾‹è®²è§£ï¼Œå¦‚æœåé¢grafanaå’Œgrafana-zabbixæ›´æ–°ï¼Œéœ€è¦å°†<span class="number">2</span>ä¸ªç‰ˆæœ¬åŒ¹é…å³å¯ã€‚</div></pre></td></tr></table></figure>
<p>ç°åœ¨æœ€æ–°ç‰ˆæœ¬æ˜¯3.0ç‰ˆæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥è¯•è¯•å®‰è£…åœ¨åŸºäºRPMçš„Linuxç‰ˆæœ¬ï¼ˆCentOSï¼ŒFedoraçš„ï¼ŒOpenSuseå½“ä¸­ï¼Œçº¢å¸½ï¼‰</p>
<p>å®‰è£…æœ€æ–°ç¨³å®šç‰ˆï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo yum install https://grafanarel.s3.amazonaws.com/builds/grafana-3.1.0-1468321182.x86_64.rpm</div></pre></td></tr></table></figure>
<p>å¦‚æœè¢«å¢™ï¼Œå¯ä»¥åˆ°æˆ‘githubä¸Šé¢ä¸‹è½½ï¼š<a href="https://github.com/yangcvo/Grafana" target="_blank" rel="external">Grafana</a></p>
<p>è¿™é‡Œéœ€è¦å®‰è£…ä¸‹ä¾èµ–åŒ…ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ sudo yum install initscripts fontconfig</div><div class="line">$ sudo rpm -Uvh grafana-3.1.0-1468321182.x86_64.rpm</div></pre></td></tr></table></figure>
<p>æˆ–è€…é€‰æ‹©YUMæ–¹å¼å®‰è£…ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">vim etc/yum.repos.d/grafana.repo</div><div class="line"></div><div class="line">[grafana]</div><div class="line">name=grafana</div><div class="line">baseurl=https://packagecloud.io/grafana/stable/el/6/<span class="variable">$basearch</span></div><div class="line">repo_gpgcheck=1</div><div class="line">enabled=1</div><div class="line">gpgcheck=1</div><div class="line">gpgkey=https://packagecloud.io/gpg.key https://grafanarel.s3.amazonaws.com/RPM-GPG-KEY-grafana</div><div class="line">sslverify=1</div><div class="line">sslcacert=/etc/pki/tls/certs/ca-bundle.crt</div></pre></td></tr></table></figure>
<p>è¿˜æœ‰ï¼Œå¦‚æœä½ æƒ³æµ‹è¯•ç‰ˆæˆ–å‘å¸ƒå€™é€‰æµ‹è¯•å­˜å‚¨åº“ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">baseurl=https://packagecloud.io/grafana/testing/el/6/<span class="variable">$basearch</span></div></pre></td></tr></table></figure>
<p>ç„¶åé€šè¿‡å®‰è£…Grafana <code>yum</code>çš„å‘½ä»¤ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span><span class="bash"> sudo yum install grafana</span></div></pre></td></tr></table></figure>
<p>RPM GPGå¯†é’¥<br>RPMåŒ…è¿›è¡Œç­¾åï¼Œå¯ä»¥éªŒè¯è¿™ä¸ªç­¾åå…¬å…±GPGå¯†é’¥ã€‚</p>
<h3 id="åŒ…è£…ç»†èŠ‚"><a href="#åŒ…è£…ç»†èŠ‚" class="headerlink" title="åŒ…è£…ç»†èŠ‚"></a>åŒ…è£…ç»†èŠ‚</h3><ul>
<li>å®‰è£…äºŒè¿›åˆ¶æ–‡ä»¶åˆ° <code>/usr/sbin/grafana-server</code></li>
<li>å‰¯æœ¬çš„init.dè„šæœ¬<code>/etc/init.d/grafana-server</code></li>
<li>é»˜è®¤çš„å®‰è£…æ–‡ä»¶ç¯å¢ƒï¼Œä»¥åœ¨<code>/etc/sysconfig/grafana-server</code></li>
<li>æ‹·è´é…ç½®æ–‡ä»¶<code>/etc/grafana/grafana.ini</code></li>
<li>å®‰è£…systemdæœåŠ¡ï¼ˆå¦‚æœsystemdå¯ç”¨ï¼‰åç§°<code>grafana-server.service</code></li>
<li>é»˜è®¤é…ç½®ä½¿ç”¨çš„æ—¥å¿—æ–‡ä»¶åœ¨<code>/var/log/grafana/grafana.log</code></li>
<li>é»˜è®¤é…ç½®æŒ‡å®šä»¥sqlite3çš„æ•°æ®åº“<code>/var/lib/grafana/grafana.db</code></li>
</ul>
<p>å¯åŠ¨æœåŠ¡ï¼ˆçš„init.dæœåŠ¡ï¼‰</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span><span class="bash"> sudo service grafana-server start</span></div></pre></td></tr></table></figure>
<p>è¿™å°†å¯åŠ¨grafanaæœåŠ¡è¿›ç¨‹ä½œä¸ºgrafanaç”¨æˆ·ï¼Œè¿™æ˜¯åŒ…å®‰è£…è¿‡ç¨‹ä¸­åˆ›å»ºã€‚é»˜è®¤HTTPç«¯å£æ˜¯ 3000ï¼Œå’Œé»˜è®¤çš„ç”¨æˆ·å’Œç»„ç®¡ç†ã€‚</p>
<p>è¦é…ç½®æœåŠ¡å™¨Grafanaåœ¨å¯åŠ¨æ—¶å¯åŠ¨ï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo /sbin/chkconfig --<span class="keyword">add</span><span class="bash"> grafana-server</span></div></pre></td></tr></table></figure>
<p>centos 7 ç³»ç»Ÿå¯åŠ¨æœåŠ¡ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span><span class="bash"> systemctl daemon-reload</span></div><div class="line"><span class="meta">$</span><span class="bash"> systemctl start grafana-server</span></div><div class="line"><span class="meta">$</span><span class="bash"> systemctl status grafana-server</span></div></pre></td></tr></table></figure>
<p>centos 7 è®¾ç½®å¼€æœºå¯åŠ¨</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo systemctl <span class="built_in">enable</span> grafana-server.service</div></pre></td></tr></table></figure>
<h3 id="ç¯å¢ƒæ–‡ä»¶"><a href="#ç¯å¢ƒæ–‡ä»¶" class="headerlink" title="ç¯å¢ƒæ–‡ä»¶"></a>ç¯å¢ƒæ–‡ä»¶</h3><p>è¯¥systemdæœåŠ¡æ–‡ä»¶å’Œè„šæœ¬çš„init.déƒ½ä½¿ç”¨ä½äºæ–‡ä»¶ åœ¨<code>/etc/sysconfig/grafana</code>æœåŠ¡å¯åŠ¨åç«¯æ—¶æ‰€ä½¿ç”¨çš„ç¯å¢ƒå˜é‡ã€‚<br>åœ¨è¿™é‡Œï¼Œæ‚¨å¯ä»¥è¦†ç›–æ—¥å¿—ç›®å½•ï¼Œæ•°æ®ç›®å½•å’Œå…¶ä»–å˜é‡ã€‚</p>
<h3 id="è®°å½•"><a href="#è®°å½•" class="headerlink" title="è®°å½•"></a>è®°å½•</h3><p>é»˜è®¤æƒ…å†µä¸‹Grafanaå°†è®°å½•åˆ°çš„<code>/var/log/grafana</code></p>
<h3 id="æ•°æ®åº“"><a href="#æ•°æ®åº“" class="headerlink" title="æ•°æ®åº“"></a>æ•°æ®åº“</h3><p>é»˜è®¤é…ç½®æŒ‡å®šä½äºä¸€ä¸ªsqlite3çš„æ•°æ®åº“ <code>/var/lib/grafana/grafana.db</code>ã€‚è¯·å¤‡ä»½å‡çº§ä¹‹å‰ï¼Œè¿™ä¸ªæ•°æ®åº“ã€‚ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨MySQLæˆ–è€…Postgresä½œä¸ºGrafanaæ•°æ®åº“ä¸Šè¯¦è¿°é…ç½®é¡µé¢ã€‚</p>
<h3 id="ç»„æ€"><a href="#ç»„æ€" class="headerlink" title="ç»„æ€"></a>ç»„æ€</h3><p>è¯¥é…ç½®æ–‡ä»¶ä½äº<code>/etc/grafana/grafana.ini</code>.å»é…ç½®é¡µé¢ä¸Šçš„æ‰€æœ‰è¿™äº›é€‰é¡¹çš„è¯¦ç»†ä¿¡æ¯ã€‚</p>
<h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><p><a href="http://docs.grafana.org/installation/configuration/#database" target="_blank" rel="external">http://docs.grafana.org/installation/configuration/#database</a></p>
<p>é…ç½®æ–‡ä»¶é‡Œåˆ†æ®µç»™å‡ºäº†éå¸¸è¯¦ç»†çš„è¯´æ˜ï¼Œéå¸¸äººæ€§åŒ–</p>
<p>é»˜è®¤ä½¿ç”¨çš„æ˜¯sqlite3çš„ï¼Œè¿™é‡Œæˆ‘è°ƒæ•´ä¸ºè‡ªå·±MySQLçš„ã€‚</p>
<h3 id="1-åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·"><a href="#1-åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·" class="headerlink" title="1.åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·"></a>1.åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·</h3><figure class="highlight lasso"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">mysql&gt; CREATE DATABASE grafana DEFAULT CHARACTER <span class="built_in">SET</span> utf8;</div><div class="line">Query OK, <span class="number">1</span> row affected (<span class="number">0.02</span> sec)</div><div class="line"></div><div class="line">mysql&gt; GRANT <span class="literal">ALL</span> <span class="keyword">ON</span> grafana.* <span class="keyword">TO</span> grafana@<span class="string">'192.168.1.%'</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">'haozhuo.com'</span> <span class="keyword">WITH</span> GRANT OPTION;</div><div class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.26</span> sec)</div><div class="line"></div><div class="line">mysql&gt; FLUSH PRIVILEGES;</div><div class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.02</span> sec)</div></pre></td></tr></table></figure>
<h3 id="2-æŒ‡å®šæ•°æ®åº“åŠè®¤è¯ä¿¡æ¯"><a href="#2-æŒ‡å®šæ•°æ®åº“åŠè®¤è¯ä¿¡æ¯" class="headerlink" title="2.æŒ‡å®šæ•°æ®åº“åŠè®¤è¯ä¿¡æ¯"></a>2.æŒ‡å®šæ•°æ®åº“åŠè®¤è¯ä¿¡æ¯</h3><p>cp /etc/grafana/grafana.ini{,.default}<br>vim /etc/grafana/grafana.ini</p>
<p>é…ç½®æ–‡ä»¶ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">[database]</div><div class="line"><span class="comment"># Either "mysql", "postgres" or "sqlite3", it's your choice</span></div><div class="line"><span class="built_in">type</span> = mysql</div><div class="line">host = 192.168.1.201:3306</div><div class="line">name = grafana</div><div class="line">user = grafana</div><div class="line">password = haozhuo.com</div><div class="line"></div><div class="line">[session]</div><div class="line"><span class="comment"># Either "memory", "file", "redis", "mysql", "postgres", default is "file"</span></div><div class="line">provider = redis</div><div class="line">provider_config = addr=127.0.0.1:6379,pool_size=100,db=grafana</div><div class="line"> </div><div class="line">cookie_name = grafana_sess</div><div class="line">cookie_secure = <span class="literal">false</span></div><div class="line"> </div><div class="line">session_life_time = 86400</div></pre></td></tr></table></figure>
<h3 id="grafana-ini-é…ç½®æ–‡ä»¶è¯¦è§£"><a href="#grafana-ini-é…ç½®æ–‡ä»¶è¯¦è§£" class="headerlink" title="grafana.ini é…ç½®æ–‡ä»¶è¯¦è§£"></a>grafana.ini é…ç½®æ–‡ä»¶è¯¦è§£</h3><figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div></pre></td><td class="code"><pre><div class="line">app_modeï¼šåº”ç”¨åç§°ï¼Œé»˜è®¤æ˜¯production</div><div class="line"></div><div class="line">[path]</div><div class="line">dataï¼šä¸€ä¸ªgrafanaç”¨æ¥å­˜å‚¨sqlite3ã€ä¸´æ—¶æ–‡ä»¶ã€å›è¯çš„åœ°å€è·¯å¾„</div><div class="line">logsï¼šgrafanaå­˜å‚¨logsçš„è·¯å¾„</div><div class="line"></div><div class="line">[server]</div><div class="line">http_addrï¼šç›‘å¬çš„ipåœ°å€ï¼Œï¼Œé»˜è®¤æ˜¯0.0.0.0</div><div class="line">http_portï¼šç›‘å¬çš„ç«¯å£ï¼Œé»˜è®¤æ˜¯3000</div><div class="line">protocolï¼šhttpæˆ–è€…httpsï¼Œï¼Œé»˜è®¤æ˜¯http</div><div class="line">domainï¼šè¿™ä¸ªè®¾ç½®æ˜¯root_urlçš„ä¸€éƒ¨åˆ†ï¼Œå½“ä½ é€šè¿‡æµè§ˆå™¨è®¿é—®grafanaæ—¶çš„å…¬å¼€çš„domianåç§°ï¼Œé»˜è®¤æ˜¯localhost</div><div class="line">enforce_domainï¼šå¦‚æœä¸»æœºçš„headerä¸åŒ¹é…domianï¼Œåˆ™è·³è½¬åˆ°ä¸€ä¸ªæ­£ç¡®çš„domainä¸Šï¼Œé»˜è®¤æ˜¯false</div><div class="line"><span class="section">root_urlï¼šè¿™æ˜¯ä¸€ä¸ªwebä¸Šè®¿é—®grafanaçš„å…¨è·¯å¾„urlï¼Œé»˜è®¤æ˜¯%(protocol)s://%(domain)s:%(http_port)s/</span></div><div class="line">router_loggingï¼šæ˜¯å¦è®°å½•webè¯·æ±‚æ—¥å¿—ï¼Œé»˜è®¤æ˜¯false</div><div class="line">cert_fileï¼šå¦‚æœä½¿ç”¨httpsåˆ™éœ€è¦è®¾ç½®</div><div class="line">cert_keyï¼šå¦‚æœä½¿ç”¨httpsåˆ™éœ€è¦è®¾ç½®</div><div class="line"></div><div class="line">[database]</div><div class="line">grafanaé»˜è®¤éœ€è¦ä½¿ç”¨æ•°æ®åº“å­˜å‚¨ç”¨æˆ·å’Œdashboardä¿¡æ¯ï¼Œé»˜è®¤ä½¿ç”¨sqlite3æ¥å­˜å‚¨ï¼Œä½ ä¹Ÿå¯ä»¥æ¢æˆå…¶ä»–æ•°æ®åº“</div><div class="line">typeï¼šå¯ä»¥æ˜¯mysqlã€postgresã€sqlite3ï¼Œé»˜è®¤æ˜¯sqlite3</div><div class="line">pathï¼šåªæ˜¯sqlite3éœ€è¦ï¼Œå®šä¹‰sqlite3çš„å­˜å‚¨è·¯å¾„</div><div class="line"><span class="section">hostï¼šåªæ˜¯mysqlã€postgreséœ€è¦ï¼Œé»˜è®¤æ˜¯127.0.0.1:3306</span></div><div class="line">nameï¼šgrafanaçš„æ•°æ®åº“åç§°ï¼Œé»˜è®¤æ˜¯grafana</div><div class="line">userï¼šè¿æ¥æ•°æ®åº“çš„ç”¨æˆ·</div><div class="line">passwordï¼šæ•°æ®åº“ç”¨æˆ·çš„å¯†ç </div><div class="line">ssl_modeï¼šåªæ˜¯postgresä½¿ç”¨</div><div class="line"></div><div class="line"></div><div class="line">[security]</div><div class="line">admin_userï¼šgrafanaé»˜è®¤çš„adminç”¨æˆ·ï¼Œé»˜è®¤æ˜¯admin</div><div class="line">admin_passwordï¼šgrafana adminçš„é»˜è®¤å¯†ç ï¼Œé»˜è®¤æ˜¯admin</div><div class="line">login_remember_daysï¼šå¤šå°‘å¤©å†…ä¿æŒç™»å½•çŠ¶æ€</div><div class="line">secret_keyï¼šä¿æŒç™»å½•çŠ¶æ€çš„ç­¾å</div><div class="line">disable_gravatarï¼š</div><div class="line"></div><div class="line"></div><div class="line">[users]</div><div class="line">allow_sign_upï¼šæ˜¯å¦å…è®¸æ™®é€šç”¨æˆ·ç™»å½•ï¼Œå¦‚æœè®¾ç½®ä¸ºfalseï¼Œåˆ™ç¦æ­¢ç”¨æˆ·ç™»å½•ï¼Œé»˜è®¤æ˜¯trueï¼Œåˆ™adminå¯ä»¥åˆ›å»ºç”¨æˆ·ï¼Œå¹¶ç™»å½•grafana</div><div class="line">allow_org_createï¼šå¦‚æœè®¾ç½®ä¸ºfalseï¼Œåˆ™ç¦æ­¢ç”¨æˆ·åˆ›å»ºæ–°ç»„ç»‡ï¼Œé»˜è®¤æ˜¯true</div><div class="line">auto_assign_orgï¼šå½“è®¾ç½®ä¸ºtrueçš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨çš„æŠŠæ–°å¢ç”¨æˆ·å¢åŠ åˆ°idä¸º1çš„ç»„ç»‡ä¸­ï¼Œå½“è®¾ç½®ä¸ºfalseçš„æ—¶å€™ï¼Œæ–°å»ºç”¨æˆ·çš„æ—¶å€™ä¼šæ–°å¢ä¸€ä¸ªç»„ç»‡</div><div class="line">auto_assign_org_roleï¼šæ–°å»ºç”¨æˆ·é™„åŠ çš„è§„åˆ™ï¼Œé»˜è®¤æ˜¯Viewerï¼Œè¿˜å¯ä»¥æ˜¯Adminã€Editor</div><div class="line"></div><div class="line"></div><div class="line">[auth.anonymous]</div><div class="line">enabledï¼šè®¾ç½®ä¸ºtrueï¼Œåˆ™å¼€å¯å…è®¸åŒ¿åè®¿é—®ï¼Œé»˜è®¤æ˜¯false</div><div class="line">org_nameï¼šä¸ºåŒ¿åç”¨æˆ·è®¾ç½®ç»„ç»‡åç§°</div><div class="line">org_roleï¼šä¸ºåŒ¿åç”¨æˆ·è®¾ç½®çš„è®¿é—®è§„åˆ™ï¼Œé»˜è®¤æ˜¯Viewer</div><div class="line"></div><div class="line"></div><div class="line">[auth.github]</div><div class="line">é’ˆå¯¹githubé¡¹ç›®çš„ï¼Œå¾ˆæ˜æ˜¾ï¼Œå‘µå‘µ</div><div class="line">enabled = false</div><div class="line">allow_sign_up = false</div><div class="line">client_id = some_id</div><div class="line">client_secret = some_secret</div><div class="line">scopes = user:email</div><div class="line">auth_url = https://github.com/login/oauth/authorize</div><div class="line">token_url = https://github.com/login/oauth/access_token</div><div class="line">api_url = https://api.github.com/user</div><div class="line">team_ids =</div><div class="line">allowed_domains =</div><div class="line">allowed_organizations =</div><div class="line"></div><div class="line"></div><div class="line">[auth.google]</div><div class="line">é’ˆå¯¹google appçš„ï¼Œå‘µå‘µ</div><div class="line">enabled = false</div><div class="line">allow_sign_up = false</div><div class="line">client_id = some_client_id</div><div class="line">client_secret = some_client_secret</div><div class="line">scopes = https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/userinfo.email</div><div class="line">auth_url = https://accounts.google.com/o/oauth2/auth</div><div class="line">token_url = https://accounts.google.com/o/oauth2/token</div><div class="line">api_url = https://www.googleapis.com/oauth2/v1/userinfo</div><div class="line">allowed_domains =</div><div class="line"></div><div class="line"></div><div class="line">[auth.basic]</div><div class="line">enabledï¼šå½“è®¾ç½®ä¸ºtrueï¼Œåˆ™http apiå¼€å¯åŸºæœ¬è®¤è¯</div><div class="line"></div><div class="line"></div><div class="line">[auth.ldap]</div><div class="line">enabledï¼šè®¾ç½®ä¸ºtrueåˆ™å¼€å¯LDAPè®¤è¯ï¼Œé»˜è®¤æ˜¯false</div><div class="line">config_fileï¼šå¦‚æœå¼€å¯LDAPï¼ŒæŒ‡å®šLDAPçš„é…ç½®æ–‡ä»¶/etc/grafana/ldap.toml</div><div class="line"></div><div class="line"></div><div class="line">[auth.proxy]</div><div class="line">å…è®¸ä½ åœ¨ä¸€ä¸ªHTTPåå‘ä»£ç†ä¸Šè¿›è¡Œè®¤è¯è®¾ç½®</div><div class="line">enabledï¼šé»˜è®¤æ˜¯false</div><div class="line">header_nameï¼šé»˜è®¤æ˜¯X-WEBAUTH-USER</div><div class="line">header_propertyï¼šé»˜è®¤æ˜¯ä¸ªåç§°username</div><div class="line">auto_sign_upï¼šé»˜è®¤æ˜¯trueã€‚å¼€å¯è‡ªåŠ¨æ³¨å†Œï¼Œå¦‚æœç”¨æˆ·åœ¨grafana DBä¸­ä¸å­˜åœ¨</div><div class="line"></div><div class="line">[analytics]</div><div class="line">reporting_enabledï¼šå¦‚æœè®¾ç½®ä¸ºtrueï¼Œåˆ™ä¼šå‘é€åŒ¿åä½¿ç”¨åˆ†æåˆ°stats.grafana.orgï¼Œä¸»è¦ç”¨äºè·Ÿè¸ªå…è®¸å®ä¾‹ã€ç‰ˆæœ¬ã€dashboardã€é”™è¯¯ç»Ÿè®¡ã€‚é»˜è®¤æ˜¯true</div><div class="line">google_analytics_ua_idï¼šä½¿ç”¨GAè¿›è¡Œåˆ†æï¼Œå¡«å†™ä½ çš„GA IDå³å¯</div><div class="line"></div><div class="line"></div><div class="line">[dashboards.json]</div><div class="line">å¦‚æœä½ æœ‰ä¸€ä¸ªç³»ç»Ÿè‡ªåŠ¨äº§ç”Ÿjsonæ ¼å¼çš„dashboardï¼Œåˆ™å¯ä»¥å¼€å¯è¿™ä¸ªç‰¹æ€§è¯•è¯•</div><div class="line">enabledï¼šé»˜è®¤æ˜¯false</div><div class="line">pathï¼šä¸€ä¸ªå…¨è·¯å¾„ç”¨æ¥åŒ…å«ä½ çš„json dashboardï¼Œé»˜è®¤æ˜¯/var/lib/grafana/dashboards</div><div class="line"></div><div class="line"></div><div class="line">[session]</div><div class="line">providerï¼šé»˜è®¤æ˜¯fileï¼Œå€¼è¿˜å¯ä»¥æ˜¯memoryã€mysqlã€postgres</div><div class="line"><span class="section">provider_configï¼šè¿™ä¸ªå€¼çš„é…ç½®ç”±providerçš„è®¾ç½®æ¥ç¡®å®šï¼Œå¦‚æœprovideræ˜¯fileï¼Œåˆ™æ˜¯data/xxxxè·¯å¾„ç±»å‹ï¼Œå¦‚æœprovideræ˜¯mysqlï¼Œåˆ™æ˜¯user:password@tcp(127.0.0.1:3306)/database_nameï¼Œå¦‚æœprovideræ˜¯postgresï¼Œåˆ™æ˜¯user=a password=b host=localhost port=5432 dbname=c sslmode=disable</span></div><div class="line">cookie_nameï¼šgrafanaçš„cookieåç§°</div><div class="line">cookie_secureï¼šå¦‚æœè®¾ç½®ä¸ºtrueï¼Œåˆ™grafanaä¾èµ–httpsï¼Œé»˜è®¤æ˜¯false</div><div class="line">session_life_timeï¼šsessionè¿‡æœŸæ—¶é—´ï¼Œé»˜è®¤æ˜¯86400ç§’ï¼Œ24å°æ—¶</div><div class="line"></div><div class="line"></div><div class="line">ä»¥ä¸‹æ˜¯å®˜æ–¹æ–‡æ¡£æ²¡æœ‰ï¼Œé…ç½®æ–‡ä»¶ä¸­æœ‰çš„</div><div class="line">[smtp]</div><div class="line">enabled = false</div><div class="line">host = localhost:25</div><div class="line">user =</div><div class="line">password =</div><div class="line">cert_file =</div><div class="line">key_file =</div><div class="line">skip_verify = false</div><div class="line">from_address = admin@grafana.localhost</div><div class="line"></div><div class="line">[emails]</div><div class="line">welcome_email_on_sign_up = false</div><div class="line">templates_pattern = emails/*.html</div><div class="line"></div><div class="line"></div><div class="line">[log]</div><div class="line">modeï¼šå¯ä»¥æ˜¯consoleã€fileï¼Œé»˜è®¤æ˜¯consoleã€fileï¼Œä¹Ÿå¯ä»¥è®¾ç½®å¤šä¸ªï¼Œç”¨é€—å·éš”å¼€</div><div class="line">buffer_lenï¼šchannelçš„bufferé•¿åº¦ï¼Œé»˜è®¤æ˜¯10000</div><div class="line">levelï¼šå¯ä»¥æ˜¯<span class="string">"Trace"</span>, <span class="string">"Debug"</span>, <span class="string">"Info"</span>, <span class="string">"Warn"</span>, <span class="string">"Error"</span>, <span class="string">"Critical"</span>ï¼Œé»˜è®¤æ˜¯info</div><div class="line"></div><div class="line">[log.console]</div><div class="line">levelï¼šè®¾ç½®çº§åˆ«</div><div class="line"></div><div class="line">[log.file]</div><div class="line">levelï¼šè®¾ç½®çº§åˆ«</div><div class="line">log_rotateï¼šæ˜¯å¦å¼€å¯è‡ªåŠ¨è½®è½¬</div><div class="line">max_linesï¼šå•ä¸ªæ—¥å¿—æ–‡ä»¶çš„æœ€å¤§è¡Œæ•°ï¼Œé»˜è®¤æ˜¯1000000</div><div class="line">max_lines_shiftï¼šå•ä¸ªæ—¥å¿—æ–‡ä»¶çš„æœ€å¤§å¤§å°ï¼Œé»˜è®¤æ˜¯28ï¼Œè¡¨ç¤º256MB</div><div class="line">daily_rotateï¼šæ¯å¤©æ˜¯å¦è¿›è¡Œæ—¥å¿—è½®è½¬ï¼Œé»˜è®¤æ˜¯true</div><div class="line">max_daysï¼šæ—¥å¿—è¿‡æœŸæ—¶é—´ï¼Œé»˜è®¤æ˜¯7,7å¤©ååˆ é™¤</div></pre></td></tr></table></figure>
<h3 id="3-é‡å¯grafana"><a href="#3-é‡å¯grafana" class="headerlink" title="3.é‡å¯grafana"></a>3.é‡å¯grafana</h3><p>service grafana-server restart<br>tail -f /var/log/grafana/grafana.log</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line">[root@LAN_zabbix ~]<span class="comment"># tail -f /var/log/grafana/grafana.log</span></div><div class="line">t=2016-07-14T00:49:01+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"Rename table dashboard to dashboard_v1 - v1"</span></div><div class="line">t=2016-07-14T00:49:01+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"create dashboard v2"</span></div><div class="line">t=2016-07-14T00:49:02+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"create index IDX_dashboard_org_id - v2"</span></div><div class="line">t=2016-07-14T00:49:02+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"create index UQE_dashboard_org_id_slug - v2"</span></div><div class="line">t=2016-07-14T00:49:02+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"copy dashboard v1 to v2"</span></div><div class="line">t=2016-07-14T00:49:02+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"drop table dashboard_v1"</span></div><div class="line">t=2016-07-14T00:49:02+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"alter dashboard.data to mediumtext v1"</span></div><div class="line">t=2016-07-14T00:49:02+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"Add column updated_by in dashboard - v2"</span></div><div class="line">t=2016-07-14T00:49:02+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"Add column created_by in dashboard - v2"</span></div><div class="line">t=2016-07-14T00:49:02+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"Add column gnetId in dashboard"</span></div><div class="line">t=2016-07-14T00:49:02+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"Add index for gnetId in dashboard"</span></div><div class="line">t=2016-07-14T00:49:02+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"create data_source table"</span></div><div class="line">t=2016-07-14T00:49:02+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"add index data_source.account_id"</span></div><div class="line">t=2016-07-14T00:49:02+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"add unique index data_source.account_id_name"</span></div><div class="line">t=2016-07-14T00:49:03+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"drop index IDX_data_source_account_id - v1"</span></div><div class="line">t=2016-07-14T00:49:03+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"drop index UQE_data_source_account_id_name - v1"</span></div><div class="line">t=2016-07-14T00:49:03+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"Rename table data_source to data_source_v1 - v1"</span></div><div class="line">t=2016-07-14T00:49:03+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"create data_source table v2"</span></div><div class="line">t=2016-07-14T00:49:03+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"create index IDX_data_source_org_id - v2"</span></div><div class="line">t=2016-07-14T00:49:03+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"create index UQE_data_source_org_id_name - v2"</span></div><div class="line">t=2016-07-14T00:49:03+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"copy data_source v1 to v2"</span></div><div class="line">t=2016-07-14T00:49:03+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"Drop old table data_source_v1 #2"</span></div><div class="line">t=2016-07-14T00:49:03+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"Add column with_credentials"</span></div><div class="line">t=2016-07-14T00:49:03+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"create api_key table"</span></div><div class="line">t=2016-07-14T00:49:03+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"add index api_key.account_id"</span></div><div class="line">t=2016-07-14T00:49:04+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"add index api_key.key"</span></div><div class="line">t=2016-07-14T00:49:04+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"add index api_key.account_id_name"</span></div><div class="line">t=2016-07-14T00:49:04+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"drop index IDX_api_key_account_id - v1"</span></div><div class="line">t=2016-07-14T00:49:04+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"drop index UQE_api_key_key - v1"</span></div><div class="line">t=2016-07-14T00:49:04+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"drop index UQE_api_key_account_id_name - v1"</span></div><div class="line">t=2016-07-14T00:49:04+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"Rename table api_key to api_key_v1 - v1"</span></div><div class="line">t=2016-07-14T00:49:04+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"create api_key table v2"</span></div><div class="line">t=2016-07-14T00:49:04+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"create index IDX_api_key_org_id - v2"</span></div><div class="line">t=2016-07-14T00:49:05+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"create index UQE_api_key_key - v2"</span></div><div class="line">t=2016-07-14T00:49:05+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"create index UQE_api_key_org_id_name - v2"</span></div><div class="line">t=2016-07-14T00:49:05+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"copy api_key v1 to v2"</span></div><div class="line">t=2016-07-14T00:49:05+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"Drop old table api_key_v1"</span></div><div class="line">t=2016-07-14T00:49:06+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"create dashboard_snapshot table v4"</span></div><div class="line">t=2016-07-14T00:49:18+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"drop table dashboard_snapshot_v4 #1"</span></div><div class="line">t=2016-07-14T00:49:18+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"create dashboard_snapshot table v5 #2"</span></div><div class="line">t=2016-07-14T00:49:18+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"create index UQE_dashboard_snapshot_key - v5"</span></div><div class="line">t=2016-07-14T00:49:18+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"create index UQE_dashboard_snapshot_delete_key - v5"</span></div><div class="line">t=2016-07-14T00:49:19+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"create index IDX_dashboard_snapshot_user_id - v5"</span></div><div class="line">t=2016-07-14T00:49:19+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"alter dashboard_snapshot to mediumtext v2"</span></div><div class="line">t=2016-07-14T00:49:19+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"create quota table v1"</span></div><div class="line">t=2016-07-14T00:49:19+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"create index UQE_quota_org_id_user_id_target - v1"</span></div><div class="line">t=2016-07-14T00:49:19+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"create plugin_setting table"</span></div><div class="line">t=2016-07-14T00:49:19+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"create index UQE_plugin_setting_org_id_plugin_id - v1"</span></div><div class="line">t=2016-07-14T00:49:19+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"create session table"</span></div><div class="line">t=2016-07-14T00:49:20+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"Drop old table playlist table"</span></div><div class="line">t=2016-07-14T00:49:20+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"Drop old table playlist_item table"</span></div><div class="line">t=2016-07-14T00:49:20+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"create playlist table v2"</span></div><div class="line">t=2016-07-14T00:49:20+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"create playlist item table v2"</span></div><div class="line">t=2016-07-14T00:49:20+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"drop preferences table v2"</span></div><div class="line">t=2016-07-14T00:49:20+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"drop preferences table v3"</span></div><div class="line">t=2016-07-14T00:49:20+0800 lvl=info msg=<span class="string">"Executing migration"</span> logger=migrator id=<span class="string">"create preferences table v3"</span></div><div class="line">t=2016-07-14T00:49:20+0800 lvl=info msg=<span class="string">"Created default admin user: [admin]"</span></div><div class="line">t=2016-07-14T00:49:20+0800 lvl=info msg=<span class="string">"Starting plugin search"</span> logger=plugins</div><div class="line">t=2016-07-14T00:49:20+0800 lvl=eror msg=<span class="string">"Plugins: Failed to load plugin json file: [/usr/share/grafana/public/app/plugins/datasource/zabbix/plugin.json invalid character '\"' after object key:value pair],  err: %!v(MISSING)"</span></div><div class="line">t=2016-07-14T00:49:20+0800 lvl=info msg=<span class="string">"Server Listening"</span> logger=server address=0.0.0.0:3000 protocol=http subUrl=</div></pre></td></tr></table></figure>
<p>logger=server <code>address=0.0.0.0:3000</code> protocol=http</p>
<h3 id="Dashboard"><a href="#Dashboard" class="headerlink" title="Dashboard"></a>Dashboard</h3><p>web:</p>
<p><a href="http://192.168.1.220:3000" target="_blank" rel="external">http://192.168.1.220:3000</a></p>
<p>é»˜è®¤ç”¨æˆ·å:admin</p>
<p>é»˜è®¤ç”¨æˆ·åå¯†ç :admin</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-grafana1.png" alt=""></figure></p>
<p>ç™»å½•åä¸€ç‰‡ç©ºç™½ï¼Œæ‰€ä»¥éœ€è¦å®‰è£…ç›¸åº”æ’ä»¶ã€‚</p>
<h3 id="grafana-zabbixæ’ä»¶"><a href="#grafana-zabbixæ’ä»¶" class="headerlink" title="grafana-zabbixæ’ä»¶"></a>grafana-zabbixæ’ä»¶</h3><figure class="highlight dts"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">https:</span><span class="comment">//github.com/alexanderzobnin/grafana-zabbix</span></div><div class="line"><span class="symbol">http:</span><span class="comment">//play.grafana-zabbix.org/</span></div><div class="line"><span class="symbol">http:</span><span class="comment">//docs.grafana-zabbix.org/installation/</span></div><div class="line"><span class="symbol">http:</span><span class="comment">//docs.grafana-zabbix.org/installation/configuration/</span></div><div class="line"><span class="symbol">https:</span><span class="comment">//grafana.net/plugins/alexanderzobnin-zabbix-app/installation</span></div></pre></td></tr></table></figure>
<p>1.å®‰è£…æ’ä»¶</p>
<p>å®˜ç½‘è®²çš„éå¸¸è¯¦ç»†å‚è€ƒé“¾æ¥ï¼š<a href="http://docs.grafana-zabbix.org/installation/" target="_blank" rel="external">http://docs.grafana-zabbix.org/installation/</a></p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@LAN_zabbix ~]<span class="comment"># grafana-cli plugins install alexanderzobnin-zabbix-app</span></div><div class="line">installing alexanderzobnin-zabbix-app @ <span class="number">3.0</span>.<span class="number">0</span></div><div class="line">from <span class="symbol">url:</span> <span class="symbol">https:</span>/<span class="regexp">/grafana.net/api</span><span class="regexp">/plugins/alexanderzobnin</span>-zabbix-app/versions/<span class="number">3.0</span>.<span class="number">0</span>/download</div><div class="line"><span class="symbol">into:</span> /var/<span class="class"><span class="keyword">lib</span>/<span class="title">grafana</span>/<span class="title">plugins</span></span></div><div class="line"></div><div class="line">âœ” Installed alexanderzobnin-zabbix-app successfully</div><div class="line"></div><div class="line">Restart grafana after installing plugins . &lt;service grafana-server restart&gt;</div></pre></td></tr></table></figure>
<p>ç„¶ååœ¨ç™»é™†æŸ¥çœ‹ï¼Œè¿™é‡Œå·²ç»å®‰è£…ä¸Šzabbixæ’ä»¶äº†ã€‚</p>
<h3 id="ä¸‰ã€grafanaä½¿ç”¨"><a href="#ä¸‰ã€grafanaä½¿ç”¨" class="headerlink" title="ä¸‰ã€grafanaä½¿ç”¨"></a>ä¸‰ã€grafanaä½¿ç”¨</h3><p>grafanaçš„ä»ªè¡¨å’Œzabbixçš„ç›‘æ§å·®ä¸å¤šï¼ŒåŸºæœ¬æ˜¯å…ˆåˆ›å»ºç›‘æ§æ¨¡æ¿ã€ç›‘æ§é¡¹ï¼Œç„¶åå†æ·»åŠ ä»ªè¡¨ã€‚è¿™é‡Œå…ˆå»ºç«‹æ•°æ®æºï¼Œå†åˆ›å»ºä»ªè¡¨å¯¹è±¡ï¼Œå¹¶æ·»åŠ æ¨¡æ¿ï¼Œæœ€åæ·»åŠ ä»ªè¡¨ã€‚</p>
<ul>
<li>å¯å‚è€ƒï¼š<a href="https://github.com/alexanderzobnin/grafana-zabbix/wiki/Usage" target="_blank" rel="external">https://github.com/alexanderzobnin/grafana-zabbix/wiki/Usage</a></li>
</ul>
<h3 id="ç»„æ€-1"><a href="#ç»„æ€-1" class="headerlink" title="ç»„æ€"></a>ç»„æ€</h3><p>å¯ç”¨æ’ä»¶</p>
<p>è½¬åˆ°Grafanaä¾§é¢æ¿æ’ä»¶ï¼Œé€‰æ‹©åº”ç”¨ç¨‹åºé€‰é¡¹å¡ï¼Œç„¶åé€‰æ‹©çš„zabbixï¼Œæ‰“å¼€é…ç½® é€‰é¡¹å¡å¹¶å¯ç”¨æ’ä»¶ã€‚</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-grafana2.png" alt=""></figure></p>
<p>1.é…ç½®zabbixæ•°æ®æº</p>
<p>å¯ç”¨æ’ä»¶åå¯ä»¥æ·»åŠ çš„zabbixæ•°æ®æºã€‚</p>
<p>è¦æ·»åŠ æ–°çš„zabbixæ•°æ®æºå…¬å¼€æ•°æ®æºåœ¨ä¾§é¢æ¿ä¸­ï¼Œå•å‡»æ·»åŠ æ•°æ®æºï¼Œå¹¶é€‰æ‹©çš„zabbixä»ä¸‹æ‹‰åˆ—è¡¨ä¸­ã€‚</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-grafana3.png" alt=""></figure></p>
<p><a href="http://192.168.1.220/zabbix/api_jsonrpc.php" target="_blank" rel="external">http://192.168.1.220/zabbix/api_jsonrpc.php</a></p>
<p>æ³¨æ„: api_jsonrpc.phpæ˜¯zabbixçš„APIè°ƒç”¨æ¥å£</p>
<p>HTTPè®¾ç½®</p>
<ul>
<li>ç½‘å€ï¼šè®¾ç½®çš„zabbix API URLï¼ˆå®Œæ•´è·¯å¾„api_jsonrpc.phpï¼‰ã€‚</li>
<li>è®¿é—®ï¼š<ul>
<li>ä»£ç†ï¼šé€šè¿‡Grafanaåç«¯è®¿é—®</li>
<li>ç›´æ¥ï¼šä»æµè§ˆå™¨è®¿é—®ã€‚</li>
</ul>
</li>
<li>HTTPè®¤è¯ï¼šé…ç½®å¦‚æœä½¿ç”¨ä»£ç†éªŒè¯ã€‚<ul>
<li>åŸºæœ¬è®¤è¯ï¼š</li>
<li>å‡­æ®ï¼š<br>ä»£ç†è®¿é—®æ„å‘³ç€Grafanaåç«¯å°†ä»£ç†ä»æµè§ˆå™¨çš„æ‰€æœ‰è¯·æ±‚ï¼Œå¹¶é€ä»–ä»¬åˆ°æ•°æ®æºã€‚è¿™æ˜¯æœ‰ç”¨çš„ï¼Œå› ä¸ºå®ƒå¯ä»¥æ¶ˆé™¤CORSï¼ˆè·¨äº§åœ°ç«™ç‚¹èµ„æºï¼‰çš„é—®é¢˜ï¼Œä»¥åŠæ¶ˆé™¤éœ€è¦â€‹â€‹å®£ä¼ è®¤è¯ç»†èŠ‚æ•°æ®æºåˆ°æµè§ˆå™¨ã€‚</li>
</ul>
</li>
</ul>
<p>ç›´æ¥è®¿é—®ä»ç„¶æ”¯æŒï¼Œå› ä¸ºåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯èƒ½æ˜¯æœ‰ç”¨çš„ç›´æ¥è®¿é—®æ•°æ®æºå–å†³äºGrafanaï¼Œç”¨æˆ·ï¼Œå’Œæ•°æ®æºçš„ä½¿ç”¨æƒ…å†µå’Œæ‹“æ‰‘ã€‚</p>
<h3 id="ZABBIX-APIç»†èŠ‚"><a href="#ZABBIX-APIç»†èŠ‚" class="headerlink" title="ZABBIX APIç»†èŠ‚"></a>ZABBIX APIç»†èŠ‚</h3><ul>
<li>ç”¨æˆ·å’Œå¯†ç ï¼šè®¾ç½®ç™»å½•è®¿é—®çš„zabbix APIã€‚åŒæ—¶æ£€æŸ¥ç”¨æˆ·çš„æƒé™çš„zabbixå¦‚æœä½ ä¸èƒ½å¾—åˆ°ä»»ä½•ç»„å’Œä¸»æœºçš„Grafanaã€‚</li>
<li><p>è¶‹åŠ¿ï¼šå¯ç”¨å¦‚æœæ‚¨ä½¿ç”¨çš„zabbix 3.xæˆ–è¡¥ä¸ä¸­çš„zabbix 2.xçš„è¶‹åŠ¿æ”¯æ’‘ï¼ˆZBXNEXT-1193ï¼‰ã€‚æ­¤é€‰é¡¹ä¸¥æ ¼æ¨èç”¨äºæ˜¾ç¤ºæ—¶é—´é•¿å‘¨æœŸï¼ˆè¶…è¿‡å‡ å¤©ï¼Œåœ¨ä¸åŒçš„zabbixæ‚¨çš„é¡¹ç›®çš„æ›´æ–°é—´éš”çš„ï¼‰ï¼Œå› ä¸ºé¡¹ç›®å†å²å‡ å¤©åŒ…å«å¨çš„ç‚¹ã€‚ä½¿ç”¨è¶‹åŠ¿å°†å¢åŠ Grafanaæ€§èƒ½ã€‚</p>
<ul>
<li>ä»ä½¿ç”¨è¶‹åŠ¿ä¹‹åçš„è¶‹åŠ¿å°†è¢«ä½¿ç”¨çš„æ—¶é—´ã€‚é»˜è®¤å€¼æ˜¯7å¤©ï¼ˆ7å¤©ï¼‰ã€‚æ‚¨å¯ä»¥åœ¨Grafanaæ ¼å¼çš„æ—¶é—´ã€‚æœ‰æ•ˆæ—¶é—´specificatorsæ˜¯ï¼š</li>
</ul>
</li>
<li><p>^ h -å°æ—¶</p>
</li>
<li>Ã° -å¤©</li>
<li><p>ä¸­å· -ä¸ªæœˆ</p>
</li>
<li><p>ç¼“å­˜æ›´æ–°é—´éš”ï¼šæ’ä»¶ç¼“å­˜æé«˜æ€§èƒ½çš„ä¸€äº›APIè¯·æ±‚ã€‚å°†è¯¥å€¼è®¾ç½®ä¸ºæ‰€éœ€çš„ç¼“å­˜ç”Ÿå­˜æœŸï¼ˆæ­¤é€‰é¡¹å½±å“ç±»çš„ç‰©å“åˆ—è¡¨æ•°æ®ï¼‰ã€‚<br>ç„¶åå•å‡»æ·»åŠ  -æ•°æ®æºå°†è¢«æ·»åŠ ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ£€æŸ¥è¿æ¥ æµ‹è¯•è¿æ¥æŒ‰é’®ã€‚æ­¤åŠŸèƒ½å¯ä»¥å¸®åŠ©æ‰¾åˆ°ä¸€äº›é”™è¯¯ï¼Œç±»ä¼¼äºæ— æ•ˆçš„ç”¨æˆ·åæˆ–å¯†ç ï¼Œé”™è¯¯çš„APIç½‘å€ã€‚</p>
</li>
</ul>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-grafana4.png" alt=""></figure></p>
<h3 id="å¯¼å…¥ç¤ºä¾‹ä»ªè¡¨æ¿"><a href="#å¯¼å…¥ç¤ºä¾‹ä»ªè¡¨æ¿" class="headerlink" title="å¯¼å…¥ç¤ºä¾‹ä»ªè¡¨æ¿"></a>å¯¼å…¥ç¤ºä¾‹ä»ªè¡¨æ¿</h3><p>æ‚¨å¯ä»¥ä»ä»ªè¡¨ç›˜å¯¼å…¥ç¤ºä¾‹ä»ªè¡¨æ¿é€‰é¡¹å¡ä¸­çš„æ’ä»¶é…ç½®ã€‚ </p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-grafana5.png" alt=""></figure></p>
<h3 id="è¯·æ³¨æ„æœ‰å…³çš„zabbix-2-2æˆ–æ›´ä½"><a href="#è¯·æ³¨æ„æœ‰å…³çš„zabbix-2-2æˆ–æ›´ä½" class="headerlink" title="è¯·æ³¨æ„æœ‰å…³çš„zabbix 2.2æˆ–æ›´ä½"></a>è¯·æ³¨æ„æœ‰å…³çš„zabbix 2.2æˆ–æ›´ä½</h3><p>ZABBIX 2.4ä¹‹å‰çš„zabbix APIï¼ˆapi_jsonrpc.phpï¼‰ä¸å…è®¸è·¨åŸŸè¯·æ±‚ï¼ˆCORSï¼‰ã€‚ä½ å¯ä»¥å¾—åˆ°HTTPé”™è¯¯412ï¼ˆé¢„å¤„ç†å¤±è´¥ï¼‰ã€‚è¦ä¿®å¤å®ƒæ·»åŠ æ­¤ä»£ç çš„ç‰ˆæƒåï¼Œç«‹å³api_jsonrpc.phpï¼š</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">  æ ‡é¢˜ï¼ˆâ€œè®¿é—®æ§åˆ¶å…è®¸æ¥æºï¼š*<span class="string">'ï¼‰;</span></div><div class="line">  </div><div class="line">æ ‡é¢˜ï¼ˆâ€œè®¿é—®æ§åˆ¶å…è®¸ä¿¡å¤´ï¼šContent-Typeçš„'ï¼‰;</div><div class="line"></div><div class="line">æ ‡é¢˜ï¼ˆâ€œè®¿é—®æ§åˆ¶å…è®¸çš„æ–¹æ³•ï¼šPOST<span class="string">'ï¼‰;</span></div><div class="line"></div><div class="line">æ ‡é¢˜ï¼ˆâ€œè®¿é—®æ§åˆ¶ï¼Œæœ€å¤§å¹´é¾„ï¼š1000'ï¼‰;</div><div class="line"></div><div class="line">å¦‚æœï¼ˆ<span class="variable">$ </span><span class="number">_</span> SERVER [ <span class="string">'REQUEST_METHOD'</span> ] === <span class="string">'é€‰é¡¹'</span>ï¼‰&#123;</div><div class="line"></div><div class="line">   è¿”å› ;</div><div class="line">   </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä¹‹å‰</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">require_once dirname( __FILE__ ). <span class="string">'/include/func.inc.php'</span> ;</div><div class="line">require_once dirname( __FILE__ ). <span class="string">'/include/classes/core/CHttpRequest.php'</span> ;</div></pre></td></tr></table></figure>
<p>å®Œå…¨ä¿®å¤ä¸Šå¸‚ã€‚æ¬²äº†è§£æ›´å¤šè¯¦æƒ…ï¼Œè¯·å‚è§ZABBIXå‘å‡ºZBXNEXT-1377 å’ŒZBX-8459ã€‚<br>è¯·æ³¨æ„æœ‰å…³æµè§ˆå™¨ç¼“å­˜</p>
<p>æ›´æ–°æ’ä»¶ï¼Œæ¸…é™¤æµè§ˆå™¨ç¼“å­˜å’Œé‡æ–°åŠ è½½åº”ç”¨ç¨‹åºé¡µé¢åã€‚è¯¦æƒ…è¯·å‚è§é“¬ï¼Œ ç«ç‹ã€‚æ‚¨éœ€è¦æ¸…é™¤ç¼“å­˜è€Œå·²ï¼Œæ²¡æœ‰Cookieï¼Œå†å²è®°å½•å’Œå…¶ä»–æ•°æ®ã€‚</p>
<h3 id="å‡çº§"><a href="#å‡çº§" class="headerlink" title="å‡çº§"></a>å‡çº§</h3><h4 id="ä»2-Xå‡çº§"><a href="#ä»2-Xå‡çº§" class="headerlink" title="ä»2.Xå‡çº§"></a>ä»2.Xå‡çº§</h4><p>åå¯ç”¨çš„zabbixåº”ç”¨åˆ°æ•°æ®æºï¼Œæ‰“å¼€ä½ çš„é…ç½®çš„zabbixæ•°æ®æºç«¯é€‰æ‹©çš„zabbixä»ç±»å‹åˆ—è¡¨ä¸­å†æ¬¡ã€‚è¿™æ˜¯å¿…è¦çš„ï¼Œå› ä¸ºæ’ä»¶IDåœ¨Grafana 3.0æ”¹å˜ã€‚</p>
<p>å‚è€ƒå®˜ç½‘é…ç½®æ•°æ®æºï¼š<a href="http://docs.grafana-zabbix.org/installation/configuration/" target="_blank" rel="external">http://docs.grafana-zabbix.org/installation/configuration/</a></p>
<p>###å…¥é—¨Grafana-zabbix</p>
<p>ä½ ç»è¿‡å®‰è£…å’Œé…ç½®<code>Grafana-zabbix</code>æ•°æ®æºï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç®€å•çš„ä»ªè¡¨æ¿ã€‚</p>
<p>ä¸‹é¢æ˜¯è‡ªå¸¦çš„æ¨¡æ¿ï¼Œè‡ªå·±æ–°å»ºçš„æ¨¡æ¿åœ¨æˆ‘githubä¸Šé¢æœ‰è¯¦ç»†çš„åˆ›å»ºæ­¥éª¤ã€‚</p>
<p>å…¥é—¨gafanaåˆ›å»ºä»ªè¡¨æ¿ï¼š<a href="https://github.com/yangcvo/Grafana" target="_blank" rel="external">Grafana-github</a></p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-grafana7.png" alt=""></figure></p>
<ul>
<li>å¯å‚è€ƒï¼š<a href="https://github.com/alexanderzobnin/grafana-zabbix/wiki/Usage" target="_blank" rel="external">https://github.com/alexanderzobnin/grafana-zabbix/wiki/Usage</a></li>
</ul>
<p><figure class="figure"><img src="https://cloud.githubusercontent.com/assets/4932851/8288883/9ec5b240-1921-11e5-9e0f-04d075b885e9.gif" alt=""></figure></p>
<p>zabbix-server2.4æœåŠ¡ç«¯ç¼–è¯‘å®‰è£… <a href="http://blog.yangcvo.me/2015/01/18/zabbix-serveræœåŠ¡ç«¯ç¼–è¯‘å®‰è£…/" target="_blank" rel="external">zabbix-serveræœåŠ¡ç«¯ç¼–è¯‘å®‰è£…</a></p>
<p>zabbix2.4ç›‘æ§80ç«¯å£çŠ¶æ€ : <a href="http://blog.yangcvo.me/2016/07/20/zabbixç›‘æ§80ç«¯å£çŠ¶æ€/" target="_blank" rel="external">zabbixç›‘æ§80ç«¯å£çŠ¶æ€</a></p>
<p>zabbix+Grafanaå®‰è£…ä½¿ç”¨ç›‘æ§ç»“åˆ ï¼š<a href="http://blog.yangcvo.me/2016/07/13/zabbix-Grafanaå®‰è£…ä½¿ç”¨ç»“åˆ/" target="_blank" rel="external">zabbix+Grafanaå®‰è£…ä½¿ç”¨ç›‘æ§ç»“åˆ</a></p>
<p>zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹ : <a href="http://blog.yangcvo.me/2015/09/29/zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹/" target="_blank" rel="external">zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹</a></p>
<p>zabbixçš„ICMP_Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§ : <a href="http://blog.yangcvo.me/2015/11/18/zabbixçš„ICMP-Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§/" target="_blank" rel="external">zabbixçš„ICMP_Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§</a></p>
<p>zabbixæ€§èƒ½ç›‘æ§æ•…éšœæ€»ç»“ <a href="http://blog.yangcvo.me/2016/02/07/zabbix-æ•…éšœæ€»ç»“/" target="_blank" rel="external">zabbixæ€§èƒ½ç›‘æ§æ•…éšœæ€»ç»“</a></p>

	

	

</article>




	<article>
	
		<h1><a href="/2016/06/10/è‡ªåŠ¨åŒ–+Jenkins/Ansible/Ansible å®‰è£…å‡ºç° ImportError: No module named _text/">Ansibleå®‰è£…å‡ºç° ImportError/ No module named _text</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-06-10</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/Automation/">Automation</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Ansible/">Ansible</a>
			</span>
		
	</div>

	

	
		<h3 id="centos6-7-ansible-yumå®‰è£…å‡ºç°é—®é¢˜ï¼š"><a href="#centos6-7-ansible-yumå®‰è£…å‡ºç°é—®é¢˜ï¼š" class="headerlink" title="centos6.7 ansible yumå®‰è£…å‡ºç°é—®é¢˜ï¼š"></a>centos6.7 ansible yumå®‰è£…å‡ºç°é—®é¢˜ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">ansible --version</div><div class="line">Traceback (most recent call last):</div><div class="line">  File <span class="string">"/usr/bin/ansible"</span>, line 46, <span class="keyword">in</span> &lt;module&gt;</div><div class="line">    from ansible.module_utils._text import to_text</div><div class="line">ImportError: No module named _text</div></pre></td></tr></table></figure>
<p>æç¤ºè¿™ä¸ªé”™è¯¯ï¼Œåé¢æŸ¥çœ‹å®˜ç½‘epelåŒ…éœ€è¦æ›´æ–°ï¼Œè¿™é‡Œæˆ‘å·²æ›´æ–°å‘ç°è¿˜æ˜¯æœ‰é—®é¢˜ã€‚</p>
<h5 id="è§£å†³æ–¹æ³•ï¼š"><a href="#è§£å†³æ–¹æ³•ï¼š" class="headerlink" title="è§£å†³æ–¹æ³•ï¼š"></a>è§£å†³æ–¹æ³•ï¼š</h5><h5 id="ä½¿ç”¨pip-installå®‰è£…è¿‡ansibleå°±æ­£å¸¸ä½¿ç”¨"><a href="#ä½¿ç”¨pip-installå®‰è£…è¿‡ansibleå°±æ­£å¸¸ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨pip installå®‰è£…è¿‡ansibleå°±æ­£å¸¸ä½¿ç”¨"></a>ä½¿ç”¨pip installå®‰è£…è¿‡ansibleå°±æ­£å¸¸ä½¿ç”¨</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">[root@ansible_01 ~]<span class="comment"># pip install ansible</span></div><div class="line">Collecting ansible</div><div class="line">  Downloading ansible-1.9.4.tar.gz (937kB)</div><div class="line">    100% |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 937kB 100kB/s </div><div class="line">Collecting paramiko (from ansible)</div><div class="line">  Downloading paramiko-1.15.3-py2.py3-none-any.whl (166kB)</div><div class="line">    100% |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 167kB 136kB/s </div><div class="line">Collecting jinja2 (from ansible)</div><div class="line">  Downloading Jinja2-2.8-py2.py3-none-any.whl (263kB)</div><div class="line">    100% |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 266kB 1.4MB/s </div><div class="line">Collecting PyYAML (from ansible)</div><div class="line">  Downloading PyYAML-3.11.tar.gz (248kB)</div><div class="line">    100% |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 249kB 72kB/s </div><div class="line">Requirement already satisfied (use --upgrade to upgrade): setuptools <span class="keyword">in</span> /usr/<span class="built_in">local</span>/python27/lib/python2.7/site-packages/setuptools-18.4-py2.7.egg (from ansible)</div><div class="line">Collecting pycrypto&gt;=2.6 (from ansible)</div><div class="line">  Downloading pycrypto-2.6.1.tar.gz (446kB)</div><div class="line">    100% |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 446kB 117kB/s </div><div class="line">Collecting ecdsa&gt;=0.11 (from paramiko-&gt;ansible)</div><div class="line">  Downloading ecdsa-0.13-py2.py3-none-any.whl (86kB)</div><div class="line">    100% |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 90kB 141kB/s </div><div class="line">Collecting MarkupSafe (from jinja2-&gt;ansible)</div><div class="line">  Downloading MarkupSafe-0.23.tar.gz</div><div class="line">Installing collected packages: ecdsa, pycrypto, paramiko, MarkupSafe, jinja2, PyYAML, ansible</div><div class="line">  Running setup.py install <span class="keyword">for</span> pycrypto</div><div class="line">  Running setup.py install <span class="keyword">for</span> MarkupSafe</div><div class="line">  Running setup.py install <span class="keyword">for</span> PyYAML</div><div class="line">  Running setup.py install <span class="keyword">for</span> ansible</div><div class="line">Successfully installed MarkupSafe-0.23 PyYAML-3.11 ansible-1.9.4 ecdsa-0.13 jinja2-2.8 paramiko-1.15.3 pycrypto-2.6.1</div></pre></td></tr></table></figure>
<p>å¦‚æœæç¤ºæ²¡æœ‰<code>No package &#39;libffi&#39; found</code> </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install libffi-devel</div></pre></td></tr></table></figure>
<p>å¦‚æœå¯ä»¥æ­£å¸¸æ˜¾ç¤ºä¸éœ€è¦è®¾ç½® å¦‚æœè¿˜æ˜¯æœ‰é—®é¢˜è®¾ç½®ä¸‹ä¾èµ–ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">[root@ansible_01 ~]<span class="comment"># find / -name ansible</span></div><div class="line">/etc/ansible</div><div class="line">/usr/<span class="built_in">local</span>/bin/ansible</div><div class="line">/usr/<span class="built_in">local</span>/src/ansible</div><div class="line">/usr/<span class="built_in">local</span>/src/ansible/docsite/js/ansible</div><div class="line">/usr/<span class="built_in">local</span>/src/ansible/bin/ansible</div><div class="line">/usr/<span class="built_in">local</span>/src/ansible/packaging/port/sysutils/ansible</div><div class="line">/usr/<span class="built_in">local</span>/src/ansible/packaging/macports/sysutils/ansible</div><div class="line">/usr/<span class="built_in">local</span>/src/ansible/build/scripts-2.6/ansible</div><div class="line">/usr/<span class="built_in">local</span>/src/ansible/build/lib/ansible</div><div class="line">/usr/<span class="built_in">local</span>/src/ansible/lib/ansible</div><div class="line">/usr/<span class="built_in">local</span>/src/ansible/.git/modules/lib/ansible</div><div class="line">/usr/<span class="built_in">local</span>/lib/python2.7/site-packages/ansible</div><div class="line">/usr/lib/python2.6/site-packages/ansible-2.1.0-py2.6.egg/ansible</div><div class="line">/usr/lib/python2.6/site-packages/ansible-2.1.0-py2.6.egg/EGG-INFO/scripts/ansible</div><div class="line">/home/ansible</div></pre></td></tr></table></figure>
<p>ç„¶åå®‰è£…å®Œæˆæ­£å¸¸æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"> ln <span class="_">-s</span> /usr/<span class="built_in">local</span>/bin/ansible /usr/bin/ansible </div><div class="line"> </div><div class="line"> [root@LAN_zabbix pip-9.0.1]<span class="comment"># ansible --version</span></div><div class="line">ansible 2.2.1.0</div><div class="line">  config file =</div><div class="line">  configured module search path = Default w/o overrides</div></pre></td></tr></table></figure>

	

	

</article>





	<span class="different-posts">ğŸ“– <a href="/page/10">more posts</a> ğŸ“–</span>



	</main>

	<footer class="footer">
	<div class="footer-content">
		
	      <div class="footer__element">
	<h5>Hi there,</h5>
	<p style="text-align:justify;">my name is Yancy, they know me as RadiantğŸ‘ğŸ‘. This blog is about Bi-data and my live.<br> I like ğŸŒ³ğŸŒ³ğŸŒ³</p>
</div>


	    
	      <div class="footer__element">
	<h5>Check out</h5>
	<ul class="footer-links">
		<li class="footer-links__link"><a href="/archives">Archive</a></li>
		
		  <li class="footer-links__link"><a href="/atom.xml">RSS</a></li>
	    
		<li class="footer-links__link"><a href="/about">about page</a></li>
		<li class="footer-links__link"><a href="/tags">Tags</a></li>
		<li class="footer-links__link"><a href="/categories">Categories</a></li>
	</ul>
</div>

	    

		<div class="footer-credit">
			<span>Â© 2019 Yancy | Powered by <a href="http://blog.yancy.cc/">Yancy</a> | Theme <a href="https://github.com/yangcvo">Yancy_GitHub</a></span>
		</div>

	</div>


</footer>



</body>

</html>
