<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="theme-color" content="#33474d">
	<title>Yancy&#39;s blog</title>
	<link rel="stylesheet" href="/css/style.css" />
	
      <link rel="alternate" href="/atom.xml" title="Yancy&#39;s blog" type="application/atom+xml">
    
</head>

<body>

	<header class="header">
		<nav class="header__nav">
			
				<a href="/" class="header__link">Home</a>
			
				<a href="/tags" class="header__link">Tags</a>
			
				<a href="/archives" class="header__link">ARCHIVES</a>
			
				<a href="/about/About" class="header__link">ABOUT</a>
			
				<a href="http://weibo.com/yangcvo" class="header__link">Weibo</a>
			
				<a href="/atom.xml" class="header__link">RSS</a>
			
		</nav>
		<h1 class="header__title"><a href="/">Yancy&#39;s blog</a></h1>
		<h2 class="header__subtitle">SIMPLICITY IS PREREQUISITE FOR  RELIABILITY</h2>
	</header>

	<main>
		
	<span class="different-posts different-posts_earlier">ğŸ“– <a href="/page/8">earlier posts</a> ğŸ“–</span>




	<article>
	
		<h1><a href="/2016/03/07/è‡ªåŠ¨åŒ–+Jenkins/Ansible/Ansible å°ç»“ï¼ˆä¸€ï¼‰ansibleçš„å®‰è£… /">Ansible å°ç»“ï¼ˆä¸€ï¼‰ansibleçš„å®‰è£…</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-03-07</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/automation/">automation</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Ansible/">Ansible</a>
			</span>
		
	</div>

	

	
		<p>ä¸Šä¸€ç¯‡æ–‡ç« è®°å½•äº†è§£ansible,è¿™ç¯‡å¤§æ¦‚è®°å½•ä¸‹å¸¸è§„ä½¿ç”¨å‘½ä»¤ã€‚</p>
<p>è¿™é‡Œä»¥CentOS Linux release 7.2.1511 (Core)ç³»ç»Ÿä¸ºå‡†ã€‚</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/ansible_03.png" alt=""></figure></p>
<h3 id="ä¸€ã€Ansibleçš„å®‰è£…"><a href="#ä¸€ã€Ansibleçš„å®‰è£…" class="headerlink" title="ä¸€ã€Ansibleçš„å®‰è£…"></a>ä¸€ã€Ansibleçš„å®‰è£…</h3><h4 id="Centoså®‰è£…"><a href="#Centoså®‰è£…" class="headerlink" title="Centoså®‰è£…"></a>Centoså®‰è£…</h4><p>1ã€yumæºå®‰è£…</p>
<p>ä»¥centosä¸ºä¾‹ï¼Œé»˜è®¤åœ¨æºé‡Œæ²¡æœ‰ansibleï¼Œä¸è¿‡åœ¨fedora epelæºé‡Œæœ‰ansibleï¼Œé…ç½®å®Œepel æºåï¼Œå¯ä»¥ç›´æ¥é€šè¿‡yum è¿›è¡Œå®‰è£…ã€‚è¿™é‡Œä»¥centos6.8ä¸ºä¾‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">centos 6</div><div class="line"><span class="comment"># yum install http://mirrors.sohu.com/fedora-epel/6/x86_64/epel-release-6-8.noarch.rpm</span></div><div class="line"></div><div class="line">centos 7</div><div class="line"><span class="comment"># yum install http://mirrors.sohu.com/fedora-epel/7/x86_64/Packages/e/epel-release-7-11.noarch.rpm</span></div><div class="line"><span class="comment"># yum install -y ansible</span></div></pre></td></tr></table></figure>
<h4 id="Ubuntuå®‰è£…"><a href="#Ubuntuå®‰è£…" class="headerlink" title="Ubuntuå®‰è£…"></a>Ubuntuå®‰è£…</h4><p>2ã€apt-getå®‰è£…</p>
<p>åœ¨ubuntuåŠå…¶è¡ç”Ÿç‰ˆä¸­ï¼Œå¯ä»¥é€šè¿‡å¢åŠ ppaæºè¿›è¡Œapt-getå®‰è£…ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span><span class="bash"> sudo apt-get install software-properties-common</span></div><div class="line"><span class="meta">$</span><span class="bash"> sudo apt-add-repository ppa:ansible/ansible</span></div><div class="line"><span class="meta">$</span><span class="bash"> sudo apt-get update</span></div><div class="line"><span class="meta">$</span><span class="bash"> sudo apt-get install ansible</span></div></pre></td></tr></table></figure>
<p>3ã€æºç å®‰è£…</p>
<p>æºç å®‰è£…éœ€è¦python2.6ä»¥ä¸Šç‰ˆæœ¬ï¼Œå…¶ä¾èµ–æ¨¡å—paramikoã€PyYAMLã€Jinja2ã€httplib2ã€simplejsonã€pycryptoæ¨¡å—ï¼Œä»¥ä¸Šæ¨¡å—å¯ä»¥é€šè¿‡pipæˆ–easy_install è¿›è¡Œå®‰è£…ï¼Œä¸è¿‡æœ¬éƒ¨åˆ†æ—¢ç„¶æåˆ°çš„æ˜¯æºç å®‰è£…ï¼Œä¸»è¦é’ˆå¯¹çš„æ— æ³•ä¸Šå¤–ç½‘çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡pypi ç«™ç‚¹æœç´¢ä»¥ä¸ŠåŒ…ï¼Œä¸‹è½½åé€šè¿‡python setup.py install è¿›è¡Œå®‰è£…ã€‚</p>
<p>æœ€åé€šè¿‡githubæˆ–pypiä¸Šä¸‹è½½ansibleæºç åŒ…ï¼Œé€šè¿‡python setup.py install å®‰è£…å³å¯ã€‚ç”±äºå®‰è£…è¿‡ç¨‹ç›¸å¯¹ç®€å•ï¼Œè¿™é‡Œç•¥è¿‡ï¼Œä¸»è¦ä»‹ç»å®‰è£…åï¼Œå¯èƒ½é‡åˆ°çš„é—®é¢˜ã€‚</p>
<p>aã€å®‰è£…PyYAMLæ—¶ï¼ŒæŠ¥é”™å¦‚ä¸‹ï¼š</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"># python setup.py install</div><div class="line">libyaml is <span class="keyword">not</span> found <span class="keyword">or</span> a compiler error: forcing --without-libyaml</div><div class="line">(<span class="keyword">if</span> libyaml is installed correctly, you may need to</div><div class="line"> specify the <span class="keyword">option</span> --include-dirs <span class="keyword">or</span> uncomment <span class="keyword">and</span></div><div class="line"> modify the <span class="keyword">parameter</span> include_dirs <span class="comment">in setup.cfg)</span></div><div class="line">running <span class="comment">install_lib</span></div><div class="line">running <span class="comment">install_egg_info</span></div><div class="line">Removing /usr/<span class="comment">lib64</span>/python2<span class="number">.6</span>/<span class="comment">site-packages</span>/PyYAML<span class="number">-3.11</span>-py2<span class="number">.6</span>.egg-info</div><div class="line">Writing /<span class="comment">usr</span>/lib64/<span class="comment">python2.6</span>/site-packages/<span class="comment">PyYAML-3.11-py2.6.egg-info</span></div></pre></td></tr></table></figure>
<p>åœ¨centos6.8ç³»ç»Ÿä¸­ï¼Œå¯ä»¥é€šè¿‡<code>yum -y install libyaml</code>åŒ…è§£å†³ï¼Œæˆ–è€…ä»ISOæ–‡ä»¶ä¸­æä¾›è¯¥åŒ…ï¼Œé€šè¿‡rpm -ivhè¿›è¡Œå®‰è£…ã€‚</p>
<p>###äºŒã€Ansibleçš„é…ç½®ä¸éªŒè¯</p>
<p>yum å®‰è£…ä½¿ç”¨é»˜è®¤ç¤ºä¾‹é…ç½®æ–‡ä»¶åï¼Œç¼–è¾‘/etc/ansible/hostsæ–‡ä»¶ï¼Œé€šè¿‡ä»¥ä¸‹æ–¹å¼éªŒè¯ansibleæ˜¯å¦å¯ç”¨ï¼š</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]# cat /etc/ansible/hosts</div><div class="line">[test]</div><div class="line"><span class="number">10.212</span><span class="number">.52</span><span class="number">.252</span> ansible_ssh_user=root ansible_ssh_pass=qwe123.com</div><div class="line"><span class="number">10.212</span><span class="number">.52</span><span class="number">.14</span> ansible_ssh_user=root ansible_ssh_pass=abc123</div><div class="line"><span class="number">10.212</span><span class="number">.52</span><span class="number">.16</span> ansible_ssh_user=root ansible_ssh_pass=<span class="number">91</span>it.org</div></pre></td></tr></table></figure>
<p>ä»¥ä¸Šçš„é…ç½®ä¸­ï¼Œæˆ‘é…ç½®äº†ä¸€ä¸ªtestç»„ï¼Œè¯¥ç»„ä¸‹æœ‰ä¸‰å°ä¸»æœºï¼Œä¸‰å°éƒ½ä½¿ç”¨rootéªŒè¯ï¼Œä¸‰å°çš„å¯†ç åˆ†åˆ«æ˜¯361way.comã€abc123ã€91it.org ã€‚</p>
<p>æ³¨ï¼šåé¢çš„ç”¨æˆ·å’Œå¯†ç é¡¹æ˜¯éå¿…é¡»çš„ï¼Œåœ¨é…ç½®keyè®¤è¯çš„æƒ…å†µä¸‹ï¼Œä¸ä½¿ç”¨å¯†ç ä¹Ÿå¯ä»¥ç›´æ¥æ“ä½œ ã€‚æœªä½¿ç”¨keyçš„ï¼Œä¹Ÿå¯ä»¥åœ¨ansibleé€šè¿‡ -kå‚æ•°åœ¨æ“ä½œå‰è¯¢é—®æ‰‹åŠ¨è¾“å…¥å¯†ç ã€‚</p>
<p>é…ç½®æ–‡ä»¶å°±æ˜¯ä¸€èˆ¬ä¸‹ç›®å½•çš„hostsæ–‡ä»¶ã€‚</p>
<p>åœ¨åº“å­˜ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<ul>
<li>ä¸»æœºåœ°å€</li>
<li>ä¸»æœºåˆ†ç»„</li>
<li>è¿æ¥å±æ€§ï¼ˆç™»å½•åï¼Œå¯†ç ï¼Œç§˜é’¥ï¼Œç«¯å£ç­‰ï¼‰<br>1ï¼Œä¸»æœºåœ°å€å’Œåˆ†ç»„</li>
</ul>
<p>å®šä¹‰ä¸»æœºåœ°å€å’Œåç§°æ¯”è¾ƒç®€å•ï¼š</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">[&lt;ä¸»æœºå&gt;]</span></div><div class="line">&lt;ä¸»æœº IP&gt;</div></pre></td></tr></table></figure>
<p>å®šä¹‰åˆ†ç»„çš„è¯­æ³•ç±»ä¼¼ï¼Œå°±æ˜¯åœ¨åå­—ååŠ ä¸Š:childrenï¼Œæˆå‘˜å¯ä»¥æ˜¯ä¸»æœºåï¼Œä¹Ÿå¯ä»¥æ˜¯åˆ†ç»„åï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[<span class="tag">&lt;<span class="name">åˆ†ç»„å</span>&gt;</span>:children]</div><div class="line"><span class="tag">&lt;<span class="name">ä¸»æœºå</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">åˆ†ç»„å</span>&gt;</span></div></pre></td></tr></table></figure>
<p>2ï¼Œè¿æ¥å±æ€§</p>
<p>å¯ä»¥é’ˆå¯¹SSHè¿æ¥æŒ‡å®šä¸€äº›å‚æ•°ï¼š</p>
<ul>
<li><code>ansible_ssh_host</code>ï¼šä¸»æœºåã€‚</li>
<li><code>ansible_ssh_port</code>ï¼šSSHç«¯å£ï¼Œé»˜è®¤22ã€‚</li>
<li><code>ansible_ssh_user</code>ï¼šç™»å½•ç”¨æˆ·ã€‚</li>
<li><code>ansible_ssh_pass</code>ï¼šç™»é™†å¯†ç ã€‚</li>
<li><code>ansible_ssh_private_key_file</code>ï¼šç§é’¥ã€‚</li>
</ul>
<p>é€šè¿‡ç§é’¥ç™»é™†çš„è¯ï¼Œå°±ä¸è¦æŒ‡å®šç™»å½•å¯†ç äº†ï¼Œä¸»æœºåä¹Ÿå¯ä»¥å¿½ç•¥ã€‚å½“ç„¶ï¼Œæ—¢ç„¶æ˜¯ä½¿ç”¨ç§é’¥ç™»é™†ï¼Œéœ€è¦ä½ ç¡®ä¿å·²ç»åœ¨å„ä¸ªä¸­ä¸»æœºçš„authorized_keysé‡Œæ·»åŠ äº†å¯¹åº”çš„å…¬é’¥ã€‚</p>
<p>3ï¼Œæ¼”ç¤º</p>
<p>å®Œæ•´çš„åº“å­˜ä¾‹å­å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> -----------------</span></div><div class="line"><span class="meta">#</span><span class="bash"> é¦–å…ˆå®šä¹‰å„ä¸ªä¸»æœº</span></div><div class="line"><span class="meta">#</span><span class="bash"> -----------------</span></div><div class="line"><span class="meta">#</span><span class="bash">============================01_version=============================<span class="comment">#</span></span></div><div class="line"></div><div class="line">[tomcat-account_01]</div><div class="line">  10.27.232.82</div><div class="line">[tomcat-point_01]</div><div class="line">  10.27.2.12</div><div class="line">[tomcat-system_01]</div><div class="line">   10.27.232.12</div><div class="line"> [tomcat-family_01]</div><div class="line">   10.27.230.63</div><div class="line"> [tomcat-mission_01]</div><div class="line">   10.47.59.12</div><div class="line"> [tomcat-card_01]</div><div class="line">   10.47.74.12</div><div class="line"> [tomcat-check_01]</div><div class="line">   10.47.107.153</div><div class="line">   </div><div class="line"><span class="meta">#</span><span class="bash"> -----------------</span></div><div class="line"><span class="meta">#</span><span class="bash"> å®šä¹‰åˆ†ç»„</span></div><div class="line"><span class="meta">#</span><span class="bash"></span></div><div class="line"><span class="meta">#</span><span class="bash"> åœ¨è¿™é‡Œæˆ‘ä»¬å®šä¹‰äº†ä¸‰ä¸ªåˆ†ç»„ï¼Œåˆ†åˆ«åä¸ºï¼š</span></div><div class="line"><span class="meta">#</span><span class="bash">   - cluster1</span></div><div class="line"><span class="meta">#</span><span class="bash">   - light</span></div><div class="line"><span class="meta">#</span><span class="bash">   - starwar</span></div><div class="line"><span class="meta">#</span><span class="bash"> -----------------</span></div><div class="line"></div><div class="line">[cluster1:children]</div><div class="line">tomcat-account_01</div><div class="line">tomcat-point_01</div><div class="line">tomcat-system_01</div><div class="line">tomcat-family_01</div><div class="line">tomcat-mission_01</div><div class="line"></div><div class="line">[light:children]</div><div class="line">tomcat-account_01</div><div class="line">tomcat-point_01</div><div class="line">tomcat-system_01</div><div class="line">tomcat-family_01</div><div class="line">tomcat-mission_01</div><div class="line"></div><div class="line">[starwar:children]</div><div class="line">tomcat-account_01</div><div class="line">tomcat-point_01</div><div class="line">tomcat-system_01</div><div class="line">tomcat-family_01</div><div class="line">tomcat-mission_01</div><div class="line"><span class="meta"></span></div><div class="line">#<span class="bash"> -----------------</span></div><div class="line"><span class="meta">#</span><span class="bash"> ç»™åˆ†ç»„å®šä¹‰å˜é‡</span></div><div class="line"><span class="meta">#</span><span class="bash"></span></div><div class="line"><span class="meta">#</span><span class="bash"> è¿™é‡Œæˆ‘ä»¬ç»™ starwar ç»„å®šä¹‰äº†å˜é‡ </span></div><div class="line"><span class="meta">#</span><span class="bash"> -----------------</span></div><div class="line">[cluster1:vars]</div><div class="line">ansible_ssh_port=7525</div><div class="line">ansible_ssh_user=lucas</div><div class="line">ansible_ssh_private_key_file=./ssh/id_rsa</div></pre></td></tr></table></figure>
<p>è¿™é‡Œè®¾ç½®åˆ†ç»„çš„æ—¶å€™åå­—ä¸èƒ½ä¸å•å°æœºå™¨åç§°ä¸€æ ·ã€‚æ¯”å¦‚ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[tomcat-account_01]</div><div class="line">  10.27.232.82</div><div class="line">[tomcat-account_01:children]</div><div class="line">tomcat-account_01</div></pre></td></tr></table></figure>
<p>è¿™é‡Œä¾‹å­æ˜¯é”™è¯¯çš„ï¼Œä¼šæç¤ºåˆ†ç»„å­˜åœ¨ã€‚</p>
<p>ä¸ºäº†å®‰å…¨å’Œæ–¹ä¾¿åœ¨hostsé‡Œé¢å°±ä¸éœ€è¦å†™ç”¨æˆ·åå’Œå¯†ç ã€‚<br>åšä¸ªå…ç§˜é’¥ç™»é™†ã€‚<br>è¿™é‡Œæˆ‘è‡ªå·±å¯¹æ§åˆ¶çš„æœºå™¨å…¨éƒ¨åšäº†å…ç§˜é’¥ç™»é™†ï¼Œæ‰€ä»¥è¿™é‡Œåªéœ€è¦è¿™ä¹ˆå†™ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">[redis1]</div><div class="line">192.168.1.173</div><div class="line"></div><div class="line">[redis2]</div><div class="line">192.168.1.174</div><div class="line"></div><div class="line">[tomcat_A1]</div><div class="line">192.168.1.175</div><div class="line"></div><div class="line">[tomcat_B1]</div><div class="line">192.168.1.176</div><div class="line"></div><div class="line">[tomcat_C1]</div><div class="line">192.168.1.177</div><div class="line"></div><div class="line">[tomcat_D1]</div><div class="line">192.168.1.178</div></pre></td></tr></table></figure>
<p>è¿™é‡Œæ˜¯æ‰§è¡Œè„šæœ¬ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ansible tomcat_D1 -m shell <span class="_">-a</span> <span class="string">"sh +x  /root/update/shoppingmall.sh"</span></div></pre></td></tr></table></figure>
<p>ä¾‹å­æ“ä½œæŸ¥çœ‹zk1åˆ†ç»„ä¸Šæ‰€æœ‰æœºå™¨ç«¯å£ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">[root@salt ansible]<span class="comment"># ansible zk1:children -m shell -a "netstat -ntulp"</span></div><div class="line">10.27.238.75 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">Active Internet connections (only servers)</div><div class="line">Proto Recv-Q Send-Q Local Address               Foreign Address             State       PID/Program name</div><div class="line">tcp        0      0 0.0.0.0:2181                0.0.0.0:*                   LISTEN      12497/java</div><div class="line">tcp        0      0 0.0.0.0:56521               0.0.0.0:*                   LISTEN      12497/java</div><div class="line">tcp        0      0 0.0.0.0:22                  0.0.0.0:*                   LISTEN      1251/sshd</div><div class="line">tcp        0      0 0.0.0.0:4888                0.0.0.0:*                   LISTEN      12497/java</div><div class="line">tcp        0      0 127.0.0.1:15770             0.0.0.0:*                   LISTEN      1434/aegis_quartz</div><div class="line">udp        0      0 118.178.240.129:123         0.0.0.0:*                               1262/ntpd</div><div class="line">udp        0      0 10.27.238.75:123            0.0.0.0:*                               1262/ntpd</div><div class="line">udp        0      0 127.0.0.1:123               0.0.0.0:*                               1262/ntpd</div><div class="line">udp        0      0 0.0.0.0:123                 0.0.0.0:*                               1262/ntpd</div><div class="line"></div><div class="line">10.47.100.200 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">Active Internet connections (only servers)</div><div class="line">Proto Recv-Q Send-Q Local Address               Foreign Address             State       PID/Program name</div><div class="line">tcp        0      0 0.0.0.0:58367               0.0.0.0:*                   LISTEN      11232/java</div><div class="line">tcp        0      0 10.47.100.200:10050         0.0.0.0:*                   LISTEN      646/zabbix_agentd</div><div class="line">tcp        0      0 0.0.0.0:2181                0.0.0.0:*                   LISTEN      11232/java</div><div class="line">tcp        0      0 0.0.0.0:22                  0.0.0.0:*                   LISTEN      1243/sshd</div><div class="line">tcp        0      0 0.0.0.0:4888                0.0.0.0:*                   LISTEN      11232/java</div><div class="line">tcp        0      0 127.0.0.1:15770             0.0.0.0:*                   LISTEN      1436/aegis_quartz</div><div class="line">udp        0      0 120.27.152.77:123           0.0.0.0:*                               1254/ntpd</div><div class="line">udp        0      0 10.47.100.200:123           0.0.0.0:*                               1254/ntpd</div><div class="line">udp        0      0 127.0.0.1:123               0.0.0.0:*                               1254/ntpd</div><div class="line">udp        0      0 0.0.0.0:123                 0.0.0.0:*                               1254/ntpd</div></pre></td></tr></table></figure>

	

	

</article>




	<article>
	
		<h1><a href="/2016/03/07/è‡ªåŠ¨åŒ–+Jenkins/Ansible/ansibleå°ç»“ï¼ˆäºŒï¼‰ansibleæ¶æ„ /">Ansibleå°ç»“ï¼ˆäºŒï¼‰ansibleæ¶æ„</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-03-07</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/automation/">automation</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Ansible/">Ansible</a>
			</span>
		
	</div>

	

	
		<p>Ansible æ˜¯ä¸€ä¸ªæ¨¡å‹é©±åŠ¨çš„é…ç½®ç®¡ç†å™¨ï¼Œæ”¯æŒå¤šèŠ‚ç‚¹å‘å¸ƒã€è¿œç¨‹ä»»åŠ¡æ‰§è¡Œã€‚é»˜è®¤ä½¿ç”¨ SSH è¿›è¡Œè¿œç¨‹è¿æ¥ã€‚æ— éœ€åœ¨è¢«ç®¡ç†èŠ‚ç‚¹ä¸Šå®‰è£…é™„åŠ è½¯ä»¶ï¼Œå¯ä½¿ç”¨å„ç§ç¼–ç¨‹è¯­è¨€è¿›è¡Œæ‰©å±•ã€‚</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/ansible_01.png" alt=""></figure></p>
<p>ä¸Šå›¾ä¸ºansibleçš„åŸºæœ¬æ¶æ„ï¼Œä»ä¸Šå›¾å¯ä»¥äº†è§£åˆ°å…¶ç”±ä»¥ä¸‹éƒ¨åˆ†ç»„æˆï¼š</p>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">æ ¸å¿ƒï¼šansible</div><div class="line">æ ¸å¿ƒæ¨¡å—ï¼ˆCore <span class="keyword">Modules</span>ï¼‰ï¼šè¿™äº›éƒ½æ˜¯ansibleè‡ªå¸¦çš„æ¨¡å— </div><div class="line">æ‰©å±•æ¨¡å—ï¼ˆCustom <span class="keyword">Modules</span>ï¼‰ï¼šå¦‚æœæ ¸å¿ƒæ¨¡å—ä¸è¶³ä»¥å®ŒæˆæŸç§åŠŸèƒ½ï¼Œå¯ä»¥æ·»åŠ æ‰©å±•æ¨¡å—</div><div class="line">æ’ä»¶ï¼ˆPluginsï¼‰ï¼šå®Œæˆæ¨¡å—åŠŸèƒ½çš„è¡¥å……</div><div class="line">å‰§æœ¬ï¼ˆPlaybooksï¼‰ï¼šansibleçš„ä»»åŠ¡é…ç½®æ–‡ä»¶ï¼Œå°†å¤šä¸ªä»»åŠ¡å®šä¹‰åœ¨å‰§æœ¬ä¸­ï¼Œç”±ansibleè‡ªåŠ¨æ‰§è¡Œ</div><div class="line">è¿æ¥æ’ä»¶ï¼ˆConnectior Pluginsï¼‰ï¼šansibleåŸºäºè¿æ¥æ’ä»¶è¿æ¥åˆ°å„ä¸ªä¸»æœºä¸Šï¼Œè™½ç„¶ansibleæ˜¯ä½¿ç”¨sshè¿æ¥åˆ°å„ä¸ªä¸»æœºçš„ï¼Œä½†æ˜¯å®ƒè¿˜æ”¯æŒå…¶ä»–çš„è¿æ¥æ–¹æ³•ï¼Œæ‰€ä»¥éœ€è¦æœ‰è¿æ¥æ’ä»¶</div><div class="line">ä¸»æœºç¾¤ï¼ˆHost Inventoryï¼‰ï¼šå®šä¹‰ansibleç®¡ç†çš„ä¸»æœº</div></pre></td></tr></table></figure>
<p>äºŒã€ansibleå·¥ä½œåŸç†</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"> <span class="number">1</span>ã€ç®¡ç†ç«¯æ”¯æŒlocal ã€sshã€zeromq ä¸‰ç§æ–¹å¼è¿æ¥è¢«ç®¡ç†ç«¯ï¼Œé»˜è®¤ä½¿ç”¨åŸºäºsshçš„è¿æ¥ï¼ï¼ï¼è¿™éƒ¨åˆ†å¯¹åº”åŸºæœ¬æ¶æ„å›¾ä¸­çš„è¿æ¥æ¨¡å—ï¼›</div><div class="line"></div><div class="line"><span class="number">2</span>ã€å¯ä»¥æŒ‰åº”ç”¨ç±»å‹ç­‰æ–¹å¼è¿›è¡ŒHost Inventoryï¼ˆä¸»æœºç¾¤ï¼‰åˆ†ç±»ï¼Œç®¡ç†èŠ‚ç‚¹é€šè¿‡å„ç±»æ¨¡å—å®ç°ç›¸åº”çš„æ“ä½œï¼ï¼ï¼å•ä¸ªæ¨¡å—ï¼Œå•æ¡å‘½ä»¤çš„æ‰¹é‡æ‰§è¡Œï¼Œæˆ‘ä»¬å¯ä»¥ç§°ä¹‹ä¸ºad-hocï¼›</div><div class="line"></div><div class="line"><span class="number">3</span>ã€ç®¡ç†èŠ‚ç‚¹å¯ä»¥é€šè¿‡playbooks å®ç°å¤šä¸ªtaskçš„é›†åˆå®ç°ä¸€ç±»åŠŸèƒ½ï¼Œå¦‚webæœåŠ¡çš„å®‰è£…éƒ¨ç½²ã€æ•°æ®åº“æœåŠ¡å™¨çš„æ‰¹é‡å¤‡ä»½ç­‰ã€‚playbooksæˆ‘ä»¬å¯ä»¥ç®€å•çš„ç†è§£ä¸ºï¼Œç³»ç»Ÿé€šè¿‡ç»„åˆå¤šæ¡ad-hocæ“ä½œçš„é…ç½®æ–‡ä»¶ ã€‚</div></pre></td></tr></table></figure>
<h2 id="ä¸‰ã€ansibleçš„ä¸ƒä¸ªå‘½ä»¤"><a href="#ä¸‰ã€ansibleçš„ä¸ƒä¸ªå‘½ä»¤" class="headerlink" title="ä¸‰ã€ansibleçš„ä¸ƒä¸ªå‘½ä»¤"></a>ä¸‰ã€ansibleçš„ä¸ƒä¸ªå‘½ä»¤</h2><p>å®‰è£…å®Œansibleåï¼Œå‘ç°ansibleä¸€å…±ä¸ºæˆ‘ä»¬æä¾›äº†ä¸ƒä¸ªæŒ‡ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">ansible</div><div class="line">ansible-doc</div><div class="line">ansible-galaxy</div><div class="line">ansible-lint</div><div class="line">ansible-playbook</div><div class="line">ansible-pull</div><div class="line">ansible-vault</div></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘ä»¬åªæŸ¥çœ‹usageéƒ¨åˆ†ï¼Œè¯¦ç»†éƒ¨åˆ†å¯ä»¥é€šè¿‡ â€œæŒ‡ä»¤ -hâ€  çš„æ–¹å¼è·å–ã€‚</p>
<h4 id="1ã€ansible"><a href="#1ã€ansible" class="headerlink" title="1ã€ansible"></a>1ã€ansible</h4><figure class="highlight haml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]# ansible -h</div><div class="line">Usage: ansible &lt;host-pattern&gt; [options]</div><div class="line">å‚æ•°ï¼š</div><div class="line">  -<span class="ruby">a <span class="string">'Arguments'</span>, --args=<span class="string">'Arguments'</span> å‘½ä»¤è¡Œå‚æ•°</span></div><div class="line">  -<span class="ruby">m NAME, --<span class="class"><span class="keyword">module</span>-<span class="title">name</span>=<span class="title">NAME</span> æ‰§è¡Œæ¨¡å—çš„åå­—ï¼Œé»˜è®¤ä½¿ç”¨ <span class="title">command</span> æ¨¡å—ï¼Œæ‰€ä»¥å¦‚æœæ˜¯åªæ‰§è¡Œå•ä¸€å‘½ä»¤å¯ä»¥ä¸ç”¨ -<span class="title">m</span>å‚æ•°</span></span></div><div class="line">  -<span class="ruby">i PATH, --inventory=PATH æŒ‡å®šåº“å­˜ä¸»æœºæ–‡ä»¶çš„è·¯å¾„,é»˜è®¤ä¸º/etc/ansible/hosts.</span></div><div class="line">  -<span class="ruby">u Usernameï¼Œ --user=Username æ‰§è¡Œç”¨æˆ·ï¼Œä½¿ç”¨è¿™ä¸ªè¿œç¨‹ç”¨æˆ·åè€Œä¸æ˜¯å½“å‰ç”¨æˆ·</span></div><div class="line">  -<span class="ruby">U --sud-user=SUDO_User  sudoåˆ°å“ªä¸ªç”¨æˆ·ï¼Œé»˜è®¤ä¸º root</span></div><div class="line">  -<span class="ruby">k --ask-pass  ç™»å½•å¯†ç ï¼Œæç¤ºè¾“å…¥SSHå¯†ç è€Œä¸æ˜¯å‡è®¾åŸºäºå¯†é’¥çš„éªŒè¯</span></div><div class="line">  -<span class="ruby">K --ask-sudo-pass æç¤ºå¯†ç ä½¿ç”¨sudo</span></div><div class="line">  -<span class="ruby">s --sudo sudoè¿è¡Œ</span></div><div class="line">  -<span class="ruby">S --su ç”¨ su å‘½ä»¤</span></div><div class="line">  -<span class="ruby">l  --list æ˜¾ç¤ºæ‰€æ”¯æŒçš„æ‰€æœ‰æ¨¡å—</span></div><div class="line">  -<span class="ruby">s --snippet æŒ‡å®šæ¨¡å—æ˜¾ç¤ºå‰§æœ¬ç‰‡æ®µ</span></div><div class="line">  -<span class="ruby">f  --forks=NUM å¹¶è¡Œä»»åŠ¡æ•°ã€‚NUMè¢«æŒ‡å®šä¸ºä¸€ä¸ªæ•´æ•°,é»˜è®¤æ˜¯<span class="number">5</span>ã€‚ <span class="comment">#ansible testhosts -a "/sbin/reboot" -f 10 é‡å¯testhostsç»„çš„æ‰€æœ‰æœºå™¨ï¼Œæ¯æ¬¡é‡å¯10å°</span></span></div><div class="line">  -<span class="ruby">-private-key=PRIVATE_KEY_FILE ç§é’¥è·¯å¾„ï¼Œä½¿ç”¨è¿™ä¸ªæ–‡ä»¶æ¥éªŒè¯è¿æ¥</span></div><div class="line">  -<span class="ruby">v --verbose è¯¦ç»†ä¿¡æ¯</span></div><div class="line">  all  é’ˆå¯¹hosts å®šä¹‰çš„æ‰€æœ‰ä¸»æœºæ‰§è¡Œ</div><div class="line">  -<span class="ruby">M MODULE_PATH, --<span class="class"><span class="keyword">module</span>-<span class="title">path</span>=<span class="title">MODULE_PATH</span> è¦æ‰§è¡Œçš„æ¨¡å—çš„è·¯å¾„ï¼Œé»˜è®¤ä¸º/<span class="title">usr</span>/<span class="title">share</span>/<span class="title">ansible</span>/</span></span></div><div class="line">  -<span class="ruby">-list-hosts åªæ‰“å°æœ‰å“ªäº›ä¸»æœºä¼šæ‰§è¡Œè¿™ä¸ª playbook æ–‡ä»¶ï¼Œä¸æ˜¯å®é™…æ‰§è¡Œè¯¥ playbook æ–‡ä»¶</span></div><div class="line">  -<span class="ruby">o --one-line å‹ç¼©è¾“å‡ºï¼Œæ‘˜è¦è¾“å‡º.å°è¯•ä¸€åˆ‡éƒ½åœ¨ä¸€è¡Œä¸Šè¾“å‡ºã€‚</span></div><div class="line">  -<span class="ruby">t Directory, --tree=Directory å°†å†…å®¹ä¿å­˜åœ¨è¯¥è¾“å‡ºç›®å½•,ç»“æœä¿å­˜åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­åœ¨æ¯å°ä¸»æœºä¸Šã€‚</span></div><div class="line">  -<span class="ruby">B åå°è¿è¡Œè¶…æ—¶æ—¶é—´</span></div><div class="line">  -<span class="ruby">P è°ƒæŸ¥åå°ç¨‹åºæ—¶é—´</span></div><div class="line">  -<span class="ruby">T Seconds, --timeout=Seconds æ—¶é—´ï¼Œå•ä½ç§’s</span></div><div class="line">  -<span class="ruby">P NUM, --poll=NUM è°ƒæŸ¥èƒŒæ™¯å·¥ä½œæ¯éš”æ•°ç§’ã€‚éœ€è¦- b</span></div><div class="line">  -<span class="ruby">c Connection, --connection=Connection  è¿æ¥ç±»å‹ä½¿ç”¨ã€‚å¯èƒ½çš„é€‰é¡¹æ˜¯paramiko(SSH),SSHå’Œåœ°æ–¹ã€‚å½“åœ°ä¸»è¦æ˜¯ç”¨äºcrontabæˆ–å¯åŠ¨ã€‚</span></div><div class="line">  -<span class="ruby">-tags=TAGS åªæ‰§è¡ŒæŒ‡å®šæ ‡ç­¾çš„ä»»åŠ¡    ä¾‹å­<span class="symbol">:ansible-playbook</span> test.yml --tags=copy  åªæ‰§è¡Œæ ‡ç­¾ä¸ºcopyçš„é‚£ä¸ªä»»åŠ¡</span></div><div class="line">  -<span class="ruby">-list-hosts åªæ‰“å°æœ‰å“ªäº›ä¸»æœºä¼šæ‰§è¡Œè¿™ä¸ª playbook æ–‡ä»¶ï¼Œä¸æ˜¯å®é™…æ‰§è¡Œè¯¥ playbook æ–‡ä»¶</span></div><div class="line">  -<span class="ruby">-list-tasks åˆ—å‡ºæ‰€æœ‰å°†è¢«æ‰§è¡Œçš„ä»»åŠ¡</span></div><div class="line">  -<span class="ruby">C, --check åªæ˜¯æµ‹è¯•ä¸€ä¸‹ä¼šæ”¹å˜ä»€ä¹ˆå†…å®¹ï¼Œä¸ä¼šçœŸæ­£å»æ‰§è¡Œ;ç›¸å,è¯•å›¾é¢„æµ‹ä¸€äº›å¯èƒ½å‘ç”Ÿçš„å˜åŒ–</span></div><div class="line">  -<span class="ruby">-syntax-check æ‰§è¡Œè¯­æ³•æ£€æŸ¥çš„å‰§æœ¬,ä½†ä¸æ‰§è¡Œå®ƒ</span></div><div class="line">  -<span class="ruby">l SUBSET, --limit=SUBSET è¿›ä¸€æ­¥é™åˆ¶æ‰€é€‰ä¸»æœº/ç»„æ¨¡å¼  --limit=<span class="number">192.168</span>.<span class="number">0</span>.<span class="number">15</span> åªå¯¹è¿™ä¸ªipæ‰§è¡Œ</span></div><div class="line">  -<span class="ruby">-skip-tags=SKIP_TAGS åªè¿è¡Œæˆå‰§å’Œä»»åŠ¡ä¸åŒ¹é…è¿™äº›å€¼çš„æ ‡ç­¾  --skip-tags=copy_start</span></div><div class="line">  -<span class="ruby">e EXTRA_VARS, --extra-vars=EXTRA_VARS  é¢å¤–çš„å˜é‡è®¾ç½®ä¸ºé”®=å€¼æˆ–YAML / JSON</span></div><div class="line">        #cat update.yml</div><div class="line">        -<span class="ruby">--</span></div><div class="line">        -<span class="ruby"> <span class="symbol">hosts:</span> &#123;&#123; hosts &#125;&#125;</span></div><div class="line">          remote_user: &#123;&#123; user &#125;&#125;</div><div class="line">        ..............</div><div class="line">        #ansible-playbook update.yml --extra-vars "hosts=vipers user=admin"   ä¼ é€’&#123;&#123;hosts&#125;&#125;ã€&#123;&#123;user&#125;&#125;å˜é‡,hostså¯ä»¥æ˜¯ ipæˆ–ç»„å</div><div class="line">  -<span class="ruby">l,--limit å¯¹æŒ‡å®šçš„ ä¸»æœº/ç»„ æ‰§è¡Œä»»åŠ¡  --limit=<span class="number">192.168</span>.<span class="number">0</span>.<span class="number">10</span>ï¼Œ<span class="number">192.168</span>.<span class="number">0</span>.<span class="number">11</span> æˆ– -l <span class="number">192.168</span>.<span class="number">0</span>.<span class="number">10</span>ï¼Œ<span class="number">192.168</span>.<span class="number">0</span>.<span class="number">11</span> åªå¯¹è¿™ä¸ª<span class="number">2</span>ä¸ªipæ‰§è¡Œä»»åŠ¡</span></div></pre></td></tr></table></figure>
<h4 id="2ã€ansible-doc"><a href="#2ã€ansible-doc" class="headerlink" title="2ã€ansible-doc"></a>2ã€ansible-doc</h4><figure class="highlight haml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]# ansible-doc -h</div><div class="line">Usage: ansible-doc [options] [module...]</div><div class="line"></div><div class="line">Options:</div><div class="line">  -<span class="ruby">h, --help            show this help message <span class="keyword">and</span> exit</span></div><div class="line">  -<span class="ruby">l, --list            List available modules</span></div><div class="line">  -<span class="ruby">M MODULE_PATH, --<span class="class"><span class="keyword">module</span>-<span class="title">path</span>=<span class="title">MODULE_PATH</span></span></span></div><div class="line">                        specify path(s) to module library (default=None)</div><div class="line">  -<span class="ruby">s, --snippet         Show playbook snippet <span class="keyword">for</span> specified <span class="class"><span class="keyword">module</span>(<span class="title">s</span>)</span></span></div><div class="line">  -<span class="ruby">v, --verbose         verbose mode (-vvv <span class="keyword">for</span> more, -vvvv to enable</span></div><div class="line">                        connection debugging)</div><div class="line">  -<span class="ruby">-version             show program<span class="string">'s version number and exit</span></span></div></pre></td></tr></table></figure>
<p>è¯¥æŒ‡ä»¤ç”¨äºæŸ¥çœ‹æ¨¡å—ä¿¡æ¯ï¼Œå¸¸ç”¨å‚æ•°æœ‰ä¸¤ä¸ª-l å’Œ -s ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">//åˆ—å‡ºæ‰€æœ‰å·²å®‰è£…çš„æ¨¡å—</div><div class="line"><span class="meta">#</span><span class="bash"> ansible-doc  <span class="_">-l</span></span></div><div class="line">//æŸ¥çœ‹å…·ä½“æŸæ¨¡å—çš„ç”¨æ³•ï¼Œè¿™é‡Œå¦‚æŸ¥çœ‹commandæ¨¡å—</div><div class="line"><span class="meta">#</span><span class="bash"> ansible-doc  <span class="_">-s</span> <span class="built_in">command</span></span></div></pre></td></tr></table></figure>
<h4 id="3ã€ansible-galaxy"><a href="#3ã€ansible-galaxy" class="headerlink" title="3ã€ansible-galaxy"></a>3ã€ansible-galaxy</h4><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]# ansible-galaxy -h</div><div class="line">Usage: ansible-galaxy [<span class="keyword">delete</span>|import|info|init|install|<span class="keyword">list</span>|login|<span class="built_in">remove</span>|<span class="built_in">search</span>|setup] [--<span class="keyword">help</span>] [<span class="keyword">options</span>] ...</div><div class="line"></div><div class="line">Option<span class="variable">s:</span></div><div class="line">  -h, --<span class="keyword">help</span>     show this <span class="keyword">help</span> message <span class="built_in">and</span> <span class="keyword">exit</span></div><div class="line">  -v, --<span class="keyword">verbose</span>  <span class="keyword">verbose</span> <span class="keyword">mode</span> (-vvv <span class="keyword">for</span> more, -vvvv <span class="keyword">to</span> enable connection</div><div class="line">                 debugging)</div><div class="line">  --<span class="keyword">version</span>      show program<span class="string">'s version number and exit</span></div></pre></td></tr></table></figure>
<p>ansible-galaxy æŒ‡ä»¤ç”¨äºæ–¹ä¾¿çš„ä»<a href="https://galaxy.ansible.com/" target="_blank" rel="external">https://galaxy.ansible.com/</a> ç«™ç‚¹ä¸‹è½½ç¬¬ä¸‰æ–¹æ‰©å±•æ¨¡å—ï¼Œæˆ‘ä»¬å¯ä»¥å½¢è±¡çš„ç†è§£å…¶ç±»ä¼¼äºcentosä¸‹çš„yumã€pythonä¸‹çš„pipæˆ–easy_install ã€‚å¦‚ä¸‹ç¤ºä¾‹ï¼š</p>
<figure class="highlight haml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]# ansible-galaxy install aeriscloud.docker</div><div class="line">-<span class="ruby"> downloading role <span class="string">'docker'</span>, owned by aeriscloud</span></div><div class="line">-<span class="ruby"> downloading role from <span class="symbol">https:</span>/<span class="regexp">/github.com/</span>AerisCloud/ansible-docker/archive/v1.<span class="number">0</span>.<span class="number">0</span>.tar.gz</span></div><div class="line">-<span class="ruby"> extracting aeriscloud.docker to /etc/ansible/roles/aeriscloud.docker</span></div><div class="line">-<span class="ruby"> aeriscloud.docker was installed successfully</span></div></pre></td></tr></table></figure>
<p>è¿™ä¸ªå®‰è£…äº†ä¸€ä¸ªaeriscloud.dockerç»„ä»¶ï¼Œå‰é¢aeriscloudæ˜¯galaxyä¸Šåˆ›å»ºè¯¥æ¨¡å—çš„ç”¨æˆ·åï¼Œåé¢å¯¹åº”çš„æ˜¯å…¶æ¨¡å—ã€‚åœ¨å®é™…åº”ç”¨ä¸­ä¹Ÿå¯ä»¥æŒ‡å®štxtæˆ–yml æ–‡ä»¶è¿›è¡Œå¤šä¸ªç»„ä»¶çš„ä¸‹è½½å®‰è£…ã€‚è¿™éƒ¨åˆ†å¯ä»¥å‚çœ‹å®˜æ–¹æ–‡æ¡£ã€‚</p>
<p>è¿™ä¸ªå®‰è£…äº†ä¸€ä¸ªaeriscloud.dockerç»„ä»¶ï¼Œå‰é¢aeriscloudæ˜¯galaxyä¸Šåˆ›å»ºè¯¥æ¨¡å—çš„ç”¨æˆ·åï¼Œåé¢å¯¹åº”çš„æ˜¯å…¶æ¨¡å—ã€‚åœ¨å®é™…åº”ç”¨ä¸­ä¹Ÿå¯ä»¥æŒ‡å®štxtæˆ–yml æ–‡ä»¶è¿›è¡Œå¤šä¸ªç»„ä»¶çš„ä¸‹è½½å®‰è£…ã€‚è¿™éƒ¨åˆ†å¯ä»¥å‚çœ‹å®˜æ–¹æ–‡æ¡£ã€‚</p>
<h4 id="4ã€ansible-lint"><a href="#4ã€ansible-lint" class="headerlink" title="4ã€ansible-lint"></a>4ã€ansible-lint</h4><p>ansible-lintæ˜¯å¯¹playbookçš„è¯­æ³•è¿›è¡Œæ£€æŸ¥çš„ä¸€ä¸ªå·¥å…·ã€‚ç”¨æ³•æ˜¯ansible-lint playbook.yml ã€‚</p>
<h4 id="5ã€ansible-playbook"><a href="#5ã€ansible-playbook" class="headerlink" title="5ã€ansible-playbook"></a>5ã€ansible-playbook</h4><p>è¯¥æŒ‡ä»¤æ˜¯ä½¿ç”¨æœ€å¤šçš„æŒ‡ä»¤ï¼Œå…¶é€šè¿‡è¯»å–playbook æ–‡ä»¶åï¼Œæ‰§è¡Œç›¸åº”çš„åŠ¨ä½œï¼Œè¿™ä¸ªåé¢ä¼šåšä¸ºä¸€ä¸ªé‡ç‚¹æ¥è®²ã€‚</p>
<h4 id="6ã€ansible-pull"><a href="#6ã€ansible-pull" class="headerlink" title="6ã€ansible-pull"></a>6ã€ansible-pull</h4><p>è¯¥æŒ‡ä»¤ä½¿ç”¨éœ€è¦è°ˆåˆ°ansibleçš„å¦ä¸€ç§æ¨¡å¼ï¼ï¼ï¼pull æ¨¡å¼ï¼Œè¿™å’Œæˆ‘ä»¬å¹³å¸¸ç»å¸¸ç”¨çš„pushæ¨¡å¼åˆšå¥½ç›¸åï¼Œå…¶é€‚ç”¨äºä»¥ä¸‹åœºæ™¯ï¼šä½ æœ‰æ•°é‡å·¨å¤§çš„æœºå™¨éœ€è¦é…ç½®ï¼Œå³ä½¿ä½¿ç”¨éå¸¸é«˜çš„çº¿ç¨‹è¿˜æ˜¯è¦èŠ±è´¹å¾ˆå¤šæ—¶é—´ï¼›ä½ è¦åœ¨ä¸€ä¸ªæ²¡æœ‰ç½‘ç»œè¿æ¥çš„æœºå™¨ä¸Šè¿è¡ŒAnisbleï¼Œæ¯”å¦‚åœ¨å¯åŠ¨ä¹‹åå®‰è£…ã€‚è¿™éƒ¨åˆ†ä¹Ÿä¼šå•ç‹¬åšä¸€èŠ‚æ¥è®²ã€‚</p>
<h4 id="7ã€ansible-vault"><a href="#7ã€ansible-vault" class="headerlink" title="7ã€ansible-vault"></a>7ã€ansible-vault</h4><p>ansible-vaultä¸»è¦åº”ç”¨äºé…ç½®æ–‡ä»¶ä¸­å«æœ‰æ•æ„Ÿä¿¡æ¯ï¼Œåˆä¸å¸Œæœ›ä»–èƒ½è¢«äººçœ‹åˆ°ï¼Œvaultå¯ä»¥å¸®ä½ åŠ å¯†/è§£å¯†è¿™ä¸ªé…ç½®æ–‡ä»¶ï¼Œå±é«˜çº§ç”¨æ³•ã€‚ä¸»è¦å¯¹äºplaybooksé‡Œæ¯”å¦‚æ¶‰åŠåˆ°é…ç½®å¯†ç æˆ–å…¶ä»–å˜é‡æ—¶ï¼Œå¯ä»¥é€šè¿‡è¯¥æŒ‡ä»¤åŠ å¯†ï¼Œè¿™æ ·æˆ‘ä»¬é€šè¿‡catçœ‹åˆ°çš„ä¼šæ˜¯ä¸€ä¸ªå¯†ç ä¸²ç±»çš„æ–‡ä»¶ï¼Œç¼–è¾‘çš„æ—¶å€™éœ€è¦è¾“å…¥äº‹å…ˆè®¾å®šçš„å¯†ç æ‰èƒ½æ‰“å¼€ã€‚è¿™ç§playbookæ–‡ä»¶åœ¨æ‰§è¡Œæ—¶ï¼Œéœ€è¦åŠ ä¸Š â€“ask-vault-passå‚æ•°ï¼ŒåŒæ ·éœ€è¦è¾“å…¥å¯†ç åæ‰èƒ½æ­£å¸¸æ‰§è¡Œã€‚å…·ä½“è¯¥éƒ¨åˆ†å¯ä»¥å‚æŸ¥å®˜æ–¹åšå®¢ã€‚</p>
<h4 id="æ³¨ï¼šä¸Šé¢ä¸ƒä¸ªæŒ‡ä»¤ï¼Œç”¨çš„æœ€å¤šçš„åªæœ‰ä¸¤ä¸ªansible-å’Œansible-playbook-ï¼Œè¿™ä¸¤ä¸ªä¸€å®šè¦æŒæ¡ï¼Œå…¶ä»–äº”ä¸ªå±äºæ‹“å±•æˆ–é«˜çº§éƒ¨åˆ†ã€‚"><a href="#æ³¨ï¼šä¸Šé¢ä¸ƒä¸ªæŒ‡ä»¤ï¼Œç”¨çš„æœ€å¤šçš„åªæœ‰ä¸¤ä¸ªansible-å’Œansible-playbook-ï¼Œè¿™ä¸¤ä¸ªä¸€å®šè¦æŒæ¡ï¼Œå…¶ä»–äº”ä¸ªå±äºæ‹“å±•æˆ–é«˜çº§éƒ¨åˆ†ã€‚" class="headerlink" title="æ³¨ï¼šä¸Šé¢ä¸ƒä¸ªæŒ‡ä»¤ï¼Œç”¨çš„æœ€å¤šçš„åªæœ‰ä¸¤ä¸ªansible å’Œansible-playbook ï¼Œè¿™ä¸¤ä¸ªä¸€å®šè¦æŒæ¡ï¼Œå…¶ä»–äº”ä¸ªå±äºæ‹“å±•æˆ–é«˜çº§éƒ¨åˆ†ã€‚"></a>æ³¨ï¼šä¸Šé¢ä¸ƒä¸ªæŒ‡ä»¤ï¼Œç”¨çš„æœ€å¤šçš„åªæœ‰ä¸¤ä¸ªansible å’Œansible-playbook ï¼Œè¿™ä¸¤ä¸ªä¸€å®šè¦æŒæ¡ï¼Œå…¶ä»–äº”ä¸ªå±äºæ‹“å±•æˆ–é«˜çº§éƒ¨åˆ†ã€‚</h4>
	

	

</article>




	<article>
	
		<h1><a href="/2016/03/07/è‡ªåŠ¨åŒ–+Jenkins/Ansible/ Ansible å­¦ä¹ å…¥é—¨ /">Ansible å­¦ä¹ å…¥é—¨</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-03-07</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/automation/">automation</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Ansible/">Ansible</a>
			</span>
		
	</div>

	

	
		<h1 id="Ansibleä»‹ç»"><a href="#Ansibleä»‹ç»" class="headerlink" title="Ansibleä»‹ç»"></a>Ansibleä»‹ç»</h1><hr>
<p><strong>å­¦ä¹ ansibleè¿™é‡Œæˆ‘è‡ªå·±åšäº†ç®€å•çš„ä»‹ç»æ€»ç»“ï¼š</strong></p>
<p>Ansibleæ˜¯ä¸€ä¸ªè‡ªåŠ¨åŒ–å·¥å…·ã€‚å®ƒå¯ä»¥é…ç½®ç³»ç»Ÿ,éƒ¨ç½²è½¯ä»¶,ç¼–æ’æ›´é«˜çº§çš„ä»»åŠ¡,æ¯”å¦‚è¿ç»­éƒ¨ç½²æˆ–é›¶åœæœºæ—¶é—´æ»šåŠ¨æ›´æ–°ã€‚</p>
<p>Ansibleçš„ç›®æ ‡æ˜¯æœ€ç®€å•å’Œæœ€æ˜“ç”¨ã€‚å®ƒä¹Ÿæœ‰ä¸€ä¸ªå¼ºçƒˆå…³æ³¨å®‰å…¨æ€§å’Œå¯é æ€§,ä»¥æœ€å°‘çš„ç§»åŠ¨éƒ¨ä»¶,ä½¿ç”¨OpenSSHè¿è¾“(åŠ é€Ÿæ’åº§æ¨¡å¼å’Œæ‹‰æ¨¡å¼é€‰æ‹©),å’Œè®¾è®¡è¯­è¨€,äººç±»å¯å®¡æ ¸æ€§çš„â€”â€”ç”šè‡³æ˜¯é‚£äº›ä¸ç†Ÿæ‚‰ç¨‹åºã€‚</p>
<p>æˆ‘ä»¬è®¤ä¸ºç®€å•æ˜¯æ‰€æœ‰å¤§å°çš„ç¯å¢ƒå’Œç›¸å…³çš„è®¾è®¡å¯¹äºå¿™ç¢Œçš„æ‰€æœ‰ç±»å‹çš„ç”¨æˆ·â€”â€”è¿™æ˜¯å¦æ„å‘³ç€å¼€å‘äººå‘˜ã€ç³»ç»Ÿç®¡ç†å‘˜,å‘å¸ƒå·¥ç¨‹å¸ˆ,ç»ç†,æ— å¤„ä¸åœ¨ã€‚Ansibleé€‚åˆç®¡ç†å°è®¾ç½®å°‘é‡çš„å®ä¾‹ä»¥åŠä¸è®¸å¤šæˆåƒä¸Šä¸‡çš„ä¼ä¸šç¯å¢ƒã€‚</p>
<p>Ansibleç®¡ç†æœºå™¨ä»¥æœ€å¥½çš„æ–¹å¼ã€‚æ²¡æœ‰ä¸€ä¸ªé—®é¢˜å¦‚ä½•å‡çº§è¿œç¨‹å®ˆæŠ¤è¿›ç¨‹æˆ–æ— æ³•ç®¡ç†ç³»ç»Ÿçš„é—®é¢˜å› ä¸ºå®ˆæŠ¤è¿›ç¨‹æ˜¯å¸è½½ã€‚OpenSSHæ˜¯æœ€åŒè¡Œè¯„è®®çš„å¼€æºç»„ä»¶,ä½¿ç”¨è¯¥å·¥å…·çš„å®‰å…¨é£é™©å¤§å¤§é™ä½ã€‚Ansibleæ˜¯åˆ†æ•£çš„,å®ƒä¾èµ–äºç°æœ‰çš„æ“ä½œç³»ç»Ÿå‡­è¯æ¥æ§åˆ¶è®¿é—®è¿œç¨‹æœºå™¨,å¦‚æœéœ€è¦ä½¿ç”¨Kerberos,å®ƒå¯ä»¥å¾ˆå®¹æ˜“åœ°è¿æ¥LDAPå’Œå…¶ä»–ç®¡ç†ç³»ç»Ÿçš„é›†ä¸­å¼èº«ä»½éªŒè¯ã€‚</p>
<p>Ansibleæ˜¯ä¸€ä¸ªå½»åº•çš„ç®€å•è‡ªåŠ¨åŒ–å¼•æ“,è‡ªåŠ¨åŒ–äº‘é…ç½®,é…ç½®ç®¡ç†ã€åº”ç”¨ç¨‹åºéƒ¨ç½²,intra-serviceç¼–æ’,ä»¥åŠè®¸å¤šå…¶ä»–çš„éœ€æ±‚ã€‚</p>
<p>è¢«è®¾è®¡ä¸ºå¤šå±‚éƒ¨ç½²è‡ªç¬¬ä¸€å¤©,Ansibleæ¨¡å‹ä½ çš„ITåŸºç¡€è®¾æ–½,æè¿°å¦‚ä½•æ¨åŠ¨ä½ æ‰€æœ‰çš„ç³»ç»Ÿ,è€Œä¸ä»…ä»…æ˜¯ç®¡ç†ä¸€ä¸ªç³»ç»Ÿã€‚</p>
<p>å®ƒä½¿ç”¨æ²¡æœ‰ä»£ç†,æ²¡æœ‰é¢å¤–çš„è‡ªå®šä¹‰å®‰å…¨åŸºç¡€è®¾æ–½,æ‰€ä»¥å¾ˆå®¹æ˜“éƒ¨ç½²,æœ€é‡è¦çš„æ˜¯,å®ƒä½¿ç”¨ä¸€ä¸ªéå¸¸ç®€å•çš„è¯­è¨€(YAML Ansible Playbooksçš„å½¢å¼),è®©ä½ æè¿°ä½ çš„è‡ªåŠ¨åŒ–å·¥ä½œçš„æ–¹å¼æ–¹æ³•ç®€æ˜è‹±è¯­ã€‚</p>
<p>æˆ‘ä»¬åˆ©ç”¨Ansibleä¸»è¦æ˜¯ä½œä¸ºå†…ç½‘æœåŠ¡å™¨çš„ä¸€äº›ç®¡ç†ï¼Œå› ä¸ºä»–ç”¨sshæ¥ç®¡ç†é…ç½®ï¼Œå†…ç½‘åŒå­¦è¿˜æ˜¯å¾ˆå¿«é€Ÿçš„ï¼Œå¤–ç½‘ä¸»è¦æ˜¯åˆ©ç”¨Saltstackï¼Œåˆ©ç”¨æ¶ˆæ¯é˜Ÿåˆ—è¿œç¨‹é€šä¿¡ï¼Œæˆ‘æ„Ÿè§‰æ˜¯æ¯”Ansibleå¥½çš„ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆé€‰æ‹©ansible</strong></p>
<p>Ansibleå¤§å®¶éƒ½çŸ¥é“ï¼Œå’Œsalt/puppetç­‰ä¸€æ ·ï¼Œæ˜¯ä¸€æ¬¾é…ç½®ç®¡ç†å·¥å…·ã€‚ä¸ºä»€ä¹ˆé€‰æ‹©å®ƒï¼Œå°±æ˜¯å› ä¸ºå®ƒç®€å•ï¼Œä¸éœ€è¦å®‰è£…agentï¼Œåªè¦æœåŠ¡å™¨èƒ½ç”¨sshè®¿é—®ï¼Œå°±å¯ä»¥ä½¿ç”¨å®ƒå»ç®¡ç†å¤§å®¶å¦‚æœè¦é—®ï¼Œå’Œæˆ‘ç”¨rsyncç›´æ¥åŒæ­¥æˆ–å†™ä¸ªforå¾ªç¯æ‰§è¡Œrpmæˆ–yumæœ‰ä»€ä¹ˆåŒºåˆ«.</p>
<p>æˆ‘æƒ³æœ€å¤§çš„åŒºåˆ«åº”è¯¥å°±æ˜¯â€œå¹¶å‘â€<br><strong>å½“ç„¶ï¼Œå¤§ä¼ä¸šä¼šè‡ªå·±å»å¼€å‘è‡ªå·±çš„æŒç»­éƒ¨ç½²å¹³å°ï¼Œè€Œå¤§éƒ¨åˆ†çš„è¿˜æ˜¯ä¸­å°å‹ä¼ä¸š</strong></p>
<p>å…¶å®éƒ¨ç½²æ¯ä¸ªç¯èŠ‚éƒ½å¯ä»¥ç”¨rpmå®‰è£…å‘å¸ƒã€‚</p>
<p>æˆ‘ä»¬çš„æŸä¸ªåº”ç”¨ç›´æ¥æ„å»ºæˆrpmï¼Œæ˜¯ç›´æ¥æ”¾åˆ°æˆ‘ä»¬å¦ä¸€ä¸ªå†…éƒ¨æœåŠ¡å™¨ä¸­ï¼Œæä¾›httpæ¥å£ï¼Œç„¶åæ‰§è¡Œçš„å°±æ˜¯yumæ¨¡å—è¿›è¡Œå®‰è£…ã€‚</p>
<p>ä¹Ÿæœ‰äººé—®æˆ‘saltæœ‰æ²¡æœ‰ç”¨è¿‡ã€‚å…¶å®æˆ‘ä»¬æœ€åˆæ˜¯ä½¿ç”¨saltçš„ï¼Œåæ¥å› ä¸ºç½‘ç»œçš„åŸå› ï¼Œé€‰æ‹©äº†æ²¡æœ‰agentçš„ansibleã€‚åœ¨é˜¿é‡Œäº‘ä¸Šé¢è¿˜æ˜¯saltå»æœåŠ¡ç®¡ç†ã€‚</p>
<p> å‚è€ƒå®˜ç½‘<a href="https://www.ansible.com/quick-start-video" target="_blank" rel="external">å…¥é—¨å­¦ä¹ è§†é¢‘</a></p>

	

	

</article>




	<article>
	
		<h1><a href="/2016/03/07/è‡ªåŠ¨åŒ–+Jenkins/Ansible/Ansibleå°ç»“ï¼ˆä¸‰ï¼‰ansible.cfgä¸é»˜è®¤é…ç½® /">Ansibleå°ç»“ï¼ˆä¸‰ï¼‰ansible.cfgä¸é»˜è®¤é…ç½®</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-03-07</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/automation/">automation</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Ansible/">Ansible</a>
			</span>
		
	</div>

	

	
		<p>#Ansibleå°ç»“ï¼ˆå››ï¼‰ansible.cfgä¸é»˜è®¤é…ç½®</p>
<p>Ansibleé»˜è®¤å®‰è£…å¥½åæœ‰ä¸€ä¸ªé…ç½®æ–‡ä»¶<code>/etc/ansible/ansible.cfg</code>ï¼Œè¯¥é…ç½®æ–‡ä»¶ä¸­å®šä¹‰äº†ansibleçš„ä¸»æœºçš„é»˜è®¤é…ç½®éƒ¨åˆ†ï¼Œå¦‚é»˜è®¤æ˜¯å¦éœ€è¦è¾“å…¥å¯†ç ã€æ˜¯å¦å¼€å¯sudoè®¤è¯ã€action_pluginsæ’ä»¶çš„ä½ç½®ã€hostsä¸»æœºç»„çš„ä½ç½®ã€æ˜¯å¦å¼€å¯logåŠŸèƒ½ã€é»˜è®¤ç«¯å£ã€keyæ–‡ä»¶ä½ç½®ç­‰ç­‰ã€‚</p>
<p>å…·ä½“å¦‚ä¸‹ï¼š</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="section">[defaults]</span></div><div class="line"><span class="comment"># some basic default values...</span></div><div class="line"><span class="attr">hostfile</span>       = /etc/ansible/hosts   \\æŒ‡å®šé»˜è®¤hostsé…ç½®çš„ä½ç½®</div><div class="line"><span class="comment"># library_path = /usr/share/my_modules/</span></div><div class="line"><span class="attr">remote_tmp</span>     = <span class="variable">$HOME</span>/.ansible/tmp</div><div class="line"><span class="attr">pattern</span>        = *</div><div class="line"><span class="attr">forks</span>          = <span class="number">5</span></div><div class="line"><span class="attr">poll_interval</span>  = <span class="number">15</span></div><div class="line"><span class="attr">sudo_user</span>      = root  \\è¿œç¨‹sudoç”¨æˆ·</div><div class="line"><span class="comment">#ask_sudo_pass = True  \\æ¯æ¬¡æ‰§è¡Œansibleå‘½ä»¤æ˜¯å¦è¯¢é—®sshå¯†ç </span></div><div class="line"><span class="comment">#ask_pass      = True  \\æ¯æ¬¡æ‰§è¡Œansibleå‘½ä»¤æ—¶æ˜¯å¦è¯¢é—®sudoå¯†ç </span></div><div class="line"><span class="attr">transport</span>      = smart</div><div class="line"><span class="attr">remote_port</span>    = <span class="number">22</span></div><div class="line"><span class="attr">module_lang</span>    = C</div><div class="line"><span class="attr">gathering</span> = implicit</div><div class="line"><span class="attr">host_key_checking</span> = <span class="literal">False</span>    \\å…³é—­ç¬¬ä¸€æ¬¡ä½¿ç”¨ansibleè¿æ¥å®¢æˆ·ç«¯æ˜¯è¾“å…¥å‘½ä»¤æç¤º</div><div class="line"><span class="attr">log_path</span>    = /var/log/ansible.log \\éœ€è¦æ—¶å¯ä»¥è‡ªè¡Œæ·»åŠ ã€‚chown -R root:root ansible.log</div><div class="line"><span class="attr">system_warnings</span> = <span class="literal">False</span>    \\å…³é—­è¿è¡Œansibleæ—¶ç³»ç»Ÿçš„æç¤ºä¿¡æ¯ï¼Œä¸€èˆ¬ä¸ºæç¤ºå‡çº§</div><div class="line"><span class="comment"># set plugin path directories here, separate with colons</span></div><div class="line"><span class="attr">action_plugins</span>     = /usr/share/ansible_plugins/action_plugins</div><div class="line"><span class="attr">callback_plugins</span>   = /usr/share/ansible_plugins/callback_plugins</div><div class="line"><span class="attr">connection_plugins</span> = /usr/share/ansible_plugins/connection_plugins</div><div class="line"><span class="attr">lookup_plugins</span>     = /usr/share/ansible_plugins/lookup_plugins</div><div class="line"><span class="attr">vars_plugins</span>       = /usr/share/ansible_plugins/vars_plugins</div><div class="line"><span class="attr">filter_plugins</span>     = /usr/share/ansible_plugins/filter_plugins</div><div class="line"><span class="attr">fact_caching</span> = memory</div><div class="line"><span class="section">[accelerate]</span></div><div class="line"><span class="attr">accelerate_port</span> = <span class="number">5099</span></div><div class="line"><span class="attr">accelerate_timeout</span> = <span class="number">30</span></div><div class="line"><span class="attr">accelerate_connect_timeout</span> = <span class="number">5.0</span></div><div class="line"><span class="comment"># The daemon timeout is measured in minutes. This time is measured</span></div><div class="line"><span class="comment"># from the last activity to the accelerate daemon.</span></div><div class="line"><span class="attr">accelerate_daemon_timeout</span> = <span class="number">30</span></div></pre></td></tr></table></figure>
<p>åœ¨ansible.cfgé…ç½®æ–‡ä»¶ä¸­ï¼Œä¹Ÿä¼šæ‰¾åˆ°å¦‚ä¸‹éƒ¨åˆ†ï¼š</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># uncomment this to disable SSH key host checking</span></div><div class="line"><span class="attr">host_key_checking</span> = <span class="literal">False</span></div></pre></td></tr></table></figure>
<p>é»˜è®¤host_key_checkingéƒ¨åˆ†æ˜¯æ³¨é‡Šçš„ï¼Œé€šè¿‡æ‰¾å¼€è¯¥è¡Œçš„æ³¨é‡Šï¼ŒåŒæ ·ä¹Ÿå¯ä»¥å®ç°è·³è¿‡ ssh é¦–æ¬¡è¿æ¥æç¤ºéªŒè¯éƒ¨åˆ†ã€‚</p>
<p>æˆ‘è¿™é‡Œåšäº†å…ç§˜é’¥çš„æŸ¥çœ‹æ—¥å¿—å¦‚ä¸‹ï¼š</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># ansible tomcat_C1 -a "uptime"</span></div><div class="line"><span class="meta">192.168.1.177 | SUCCESS | rc=0 &gt;</span>&gt;</div><div class="line"> 09<span class="symbol">:</span><span class="number">28</span><span class="symbol">:</span><span class="number">03</span> up <span class="number">24</span> days, <span class="number">15</span><span class="symbol">:</span><span class="number">39</span>,  <span class="number">4</span> users,  load <span class="symbol">average:</span> <span class="number">0</span>.<span class="number">00</span>, <span class="number">0</span>.<span class="number">00</span>, <span class="number">0</span>.<span class="number">00</span></div><div class="line"></div><div class="line">[root@docker ~]<span class="comment">#</span></div><div class="line">[root@docker ~]<span class="comment">#</span></div><div class="line">[root@docker ~]<span class="comment">#  cat /var/log/ansible.log</span></div><div class="line"><span class="number">2016</span>-09-<span class="number">05</span> 09<span class="symbol">:</span><span class="number">19</span><span class="symbol">:</span><span class="number">23</span>,<span class="number">235</span> p=<span class="number">1412</span> u=root <span class="params">|  ERROR! Missing target hosts</span></div><div class="line">2016-09-05 09:19:54,580 p=1417 u=root |  <span class="number">192.168</span>.<span class="number">1.177</span> <span class="params">| SUCCESS |</span> rc=<span class="number">0</span> <span class="meta">&gt;&gt;</span></div><div class="line"> 09<span class="symbol">:</span><span class="number">20</span><span class="symbol">:</span><span class="number">24</span> up <span class="number">24</span> days, <span class="number">15</span><span class="symbol">:</span><span class="number">31</span>,  <span class="number">4</span> users,  load <span class="symbol">average:</span> <span class="number">0</span>.<span class="number">00</span>, <span class="number">0</span>.<span class="number">00</span>, <span class="number">0</span>.<span class="number">00</span></div><div class="line"></div><div class="line"><span class="number">2016</span>-09-<span class="number">05</span> 09<span class="symbol">:</span><span class="number">20</span><span class="symbol">:</span><span class="number">07</span>,<span class="number">206</span> p=<span class="number">1440</span> u=root <span class="params">|  192.168.1.177 |</span> SUCCESS <span class="params">| rc=0 &gt;&gt;</span></div><div class="line"> 09:20:37 up 24 days, 15:31,  4 users,  load average: 0.00, 0.00, 0.00</div><div class="line"></div><div class="line">2016-09-05 09:27:31,607 p=1460 u=root |  <span class="number">192.168</span>.<span class="number">1.177</span> <span class="params">| SUCCESS |</span> rc=<span class="number">0</span> <span class="meta">&gt;&gt;</span></div><div class="line"> 09<span class="symbol">:</span><span class="number">28</span><span class="symbol">:</span><span class="number">01</span> up <span class="number">24</span> days, <span class="number">15</span><span class="symbol">:</span><span class="number">39</span>,  <span class="number">4</span> users,  load <span class="symbol">average:</span> <span class="number">0</span>.<span class="number">00</span>, <span class="number">0</span>.<span class="number">00</span>, <span class="number">0</span>.<span class="number">00</span></div><div class="line"></div><div class="line"><span class="number">2016</span>-09-<span class="number">05</span> 09<span class="symbol">:</span><span class="number">27</span><span class="symbol">:</span><span class="number">33</span>,<span class="number">800</span> p=<span class="number">1482</span> u=root <span class="params">|  192.168.1.177 |</span> SUCCESS <span class="params">| rc=0 &gt;&gt;</span></div><div class="line"> 09:28:03 up 24 days, 15:39,  4 users,  load average: 0.00, 0.00, 0.00</div></pre></td></tr></table></figure>
<p>æ›´å¤šéƒ¨åˆ†å¯ä»¥å‚çœ‹<a href="http://docs.ansible.com/intro_configuration.html" target="_blank" rel="external">å®˜æ–¹æ–‡æ¡£</a></p>

	

	

</article>




	<article>
	
		<h1><a href="/2016/02/14/ä¸ªäººç”Ÿæ´»è®°å½•/åœ¨ä¸€èµ·çš„ç¬¬588å¤©ğŸ’•/">åœ¨ä¸€èµ·çš„ç¬¬588å¤©ğŸ’•</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-02-14</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/ç”Ÿæ´»/">ç”Ÿæ´»</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Personal-life-record/">Personal life record</a>
			</span>
		
	</div>

	

	
		<h3 id="ä»Šå¤©2016å¹´2æœˆ14æ—¥æˆ‘ä»¬çš„ç¬¬äºŒä¸ªæƒ…äººèŠ‚ï¼š"><a href="#ä»Šå¤©2016å¹´2æœˆ14æ—¥æˆ‘ä»¬çš„ç¬¬äºŒä¸ªæƒ…äººèŠ‚ï¼š" class="headerlink" title="ä»Šå¤©2016å¹´2æœˆ14æ—¥æˆ‘ä»¬çš„ç¬¬äºŒä¸ªæƒ…äººèŠ‚ï¼š"></a>ä»Šå¤©2016å¹´2æœˆ14æ—¥æˆ‘ä»¬çš„ç¬¬äºŒä¸ªæƒ…äººèŠ‚ï¼š</h3><p>å¤œå·²ç»å¾ˆæ·±äº†ï¼Œæˆ‘è¿˜ååœ¨ç”µè„‘å‰å†™ä¿¡ç»™ä½ ,æ…¢æ…¢æŠŠæˆ‘ä»¬åœ¨ä¸€èµ·ç‚¹ç‚¹æ»´æ»´è®°å½•ä¸‹æ¥,è¿™äº›å¤©æ€»æ˜¯æœ‰å¾ˆå¤šè¯æƒ³å¯¹ä½ è¯´,ä½†å¯¹ä½ çš„æ€å¿µæ‰°ä¹±äº†æˆ‘æ‰€æœ‰çš„æ€ç»ªã€‚æˆ‘ä¸çŸ¥é“è¯¥è¯´äº›ä»€ä¹ˆæˆ–æ€ä¹ˆè¯´ï¼Ÿè¯´å¿ƒé‡Œè¯ï¼Œå’Œä½ çš„æ¯ä¸€å¤©æˆ‘å¾ˆå¿«ä¹å¾ˆå¹¸ç¦ï¼Œæ˜¯æˆ‘ä¸€ç”Ÿä¸­ä»æœªæœ‰è¿‡çš„ï¼çœŸçš„XXLã€‚<br><img src="http://7xrthw.com1.z0.glb.clouddn.com/IMG_0200.JPG" alt=""></p>
		<p><a class="article__read-more-link" href="/2016/02/14/ä¸ªäººç”Ÿæ´»è®°å½•/åœ¨ä¸€èµ·çš„ç¬¬588å¤©ğŸ’•/">...read more</a></p>
	

	

</article>




	<article>
	
		<h1><a href="/2016/01/30/æ—¥å¿—åˆ†æå¹³å°/Elasticsearch/Elasticsearch5.xç‰ˆæœ¬çš„ç´¢å¼•å®šæ—¶è‡ªåŠ¨æ¸…ç†å’Œæ£€æµ‹è¿›ç¨‹çŠ¶æ€è‡ªåŠ¨å¯åŠ¨/">Elasticsearch5.xç‰ˆæœ¬çš„ç´¢å¼•å®šæ—¶è‡ªåŠ¨æ¸…ç†å’Œæ£€æµ‹è¿›ç¨‹çŠ¶æ€è‡ªåŠ¨å¯åŠ¨</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-01-30</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/Log-Analysis-Platform/">Log Analysis Platform</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Elasticsearch/">Elasticsearch</a>
			</span>
		
	</div>

	

	
		<h1 id="elasticsearchçš„ç´¢å¼•å®šæ—¶è‡ªåŠ¨æ¸…ç†"><a href="#elasticsearchçš„ç´¢å¼•å®šæ—¶è‡ªåŠ¨æ¸…ç†" class="headerlink" title="elasticsearchçš„ç´¢å¼•å®šæ—¶è‡ªåŠ¨æ¸…ç†"></a>elasticsearchçš„ç´¢å¼•å®šæ—¶è‡ªåŠ¨æ¸…ç†</h1><p>ä¹‹å‰ç”¨ logstashæ¥åšæ—¥å¿—æ”¶é›† å¹¶ç”¨ elasticsearchæ¥æœç´¢ï¼Œå› ä¸ºæ—¥å¿—æ²¡æœ‰è¿›è¡Œè¿‡æ»¤ï¼Œæ²¡å‡ å¤©å°±å‘ç°elasticsearchçš„ç´¢å¼•æ–‡ä»¶å¤§çš„å“äººï¼Œä¹‹å‰è¿˜çœŸæ²¡æ¸…ç†è¿‡ã€‚å…¶å®è¦è¯´æ¸…ç†ä¹Ÿç®€å•ï¼Œç›´æ¥åˆ° elasticsearch dataæ–‡ä»¶å¤¹é‡Œåˆ æ‰å°±è¡Œäº†ï¼Œå†™ä¸ªè„šæœ¬å®šæœŸæ¸…ç†é›†ç¾¤esçš„æ—¥å¿—æ•°æ®ã€‚</p>
<p>è¿™é‡Œæˆ‘æ¸…ç†1æœˆ7å·çš„ã€‚</p>
<p>è¿™é‡Œåé¢æ˜¯ç´¢å¼•åç§°ã€‚<br>app_error-2017.01.07</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@es_01 sh]<span class="comment"># curl -XDELETE 'http://10.47.88.206:9200/app_error-2017.01.07'</span></div><div class="line">&#123;<span class="string">"acknowledged"</span>:<span class="literal">true</span>&#125;[root@es_01 sh]<span class="comment">#</span></div></pre></td></tr></table></figure>
<p>shell 7å¤©æ¸…ç†ä¸€æ¬¡æ•°æ®å†™åœ¨è®¡åˆ’ä»»åŠ¡é‡Œé¢ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"></div><div class="line">now=`date +%Y%m%d`</div><div class="line"><span class="built_in">echo</span> <span class="variable">$now</span></div><div class="line">days_07_before=`date <span class="_">-d</span> <span class="string">"<span class="variable">$now</span> 7 days ago"</span> +%Y.%m.%d`</div><div class="line"><span class="built_in">echo</span> <span class="variable">$days_07_before</span></div><div class="line">curl -XDELETE <span class="string">"http://<span class="variable">$(hostname)</span>:9200/log-spm-product-<span class="variable">$days_07_before</span>"</span>  &gt; /dev/null 2&gt;&amp;1</div><div class="line">curl -XDELETE <span class="string">"http://<span class="variable">$(hostname)</span>:9200/log-dataexport-product-<span class="variable">$days_07_before</span>"</span>  &gt; /dev/null 2&gt;&amp;1</div></pre></td></tr></table></figure>
<p>è®¡åˆ’ä»»åŠ¡ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">10 0 * * * /opt/sh/logstash-null.sh</div></pre></td></tr></table></figure>
<p>å®˜ç½‘ï¼š<a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/doc-exists.html" target="_blank" rel="external">æ£€æŸ¥çŠ¶æ€æ˜¯å¦å­˜åœ¨</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">æ£€æŸ¥æ–‡æ¡£æ˜¯å¦å­˜åœ¨ç¼–è¾‘</div><div class="line">å¦‚æœåªæƒ³æ£€æŸ¥ä¸€ä¸ªæ–‡æ¡£æ˜¯å¦å­˜åœ¨ --æ ¹æœ¬ä¸æƒ³å…³å¿ƒå†…å®¹--é‚£ä¹ˆç”¨ HEAD æ–¹æ³•æ¥ä»£æ›¿ GET æ–¹æ³•ã€‚ HEAD è¯·æ±‚æ²¡æœ‰è¿”å›ä½“ï¼Œåªè¿”å›ä¸€ä¸ª HTTP è¯·æ±‚æŠ¥å¤´ï¼š</div><div class="line"></div><div class="line">curl -i -XHEAD http://localhost:9200/website/blog/123</div><div class="line">å¦‚æœæ–‡æ¡£å­˜åœ¨ï¼Œ Elasticsearch å°†è¿”å›ä¸€ä¸ª 200 ok çš„çŠ¶æ€ç ï¼š</div><div class="line"></div><div class="line">HTTP/1.1 200 OK</div><div class="line">Content-Type: text/plain; charset=UTF-8</div><div class="line">Content-Length: 0</div><div class="line">è‹¥æ–‡æ¡£ä¸å­˜åœ¨ï¼Œ Elasticsearch å°†è¿”å›ä¸€ä¸ª 404 Not Found çš„çŠ¶æ€ç ï¼š</div><div class="line"></div><div class="line">curl -i -XHEAD http://localhost:9200/website/blog/124</div><div class="line">HTTP/1.1 404 Not Found</div><div class="line">Content-Type: text/plain; charset=UTF-8</div><div class="line">Content-Length: 0</div><div class="line">å½“ç„¶ï¼Œä¸€ä¸ªæ–‡æ¡£ä»…ä»…æ˜¯åœ¨æ£€æŸ¥çš„æ—¶å€™ä¸å­˜åœ¨ï¼Œå¹¶ä¸æ„å‘³ç€ä¸€æ¯«ç§’ä¹‹åå®ƒä¹Ÿä¸å­˜åœ¨ï¼šä¹Ÿè®¸åŒæ—¶æ­£å¥½å¦ä¸€ä¸ªè¿›ç¨‹å°±åˆ›å»ºäº†è¯¥æ–‡æ¡£ã€‚</div></pre></td></tr></table></figure>
<h4 id="è‡ªåŠ¨æ£€æµ‹esç«¯å£çŠ¶æ€å¦‚ä½•ä¸å­˜åœ¨å¯åŠ¨"><a href="#è‡ªåŠ¨æ£€æµ‹esç«¯å£çŠ¶æ€å¦‚ä½•ä¸å­˜åœ¨å¯åŠ¨" class="headerlink" title="è‡ªåŠ¨æ£€æµ‹esç«¯å£çŠ¶æ€å¦‚ä½•ä¸å­˜åœ¨å¯åŠ¨"></a>è‡ªåŠ¨æ£€æµ‹esç«¯å£çŠ¶æ€å¦‚ä½•ä¸å­˜åœ¨å¯åŠ¨</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">vim /bin/whole51/es_poss.sh</div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="built_in">source</span> /etc/profile</div><div class="line">curl -Is <span class="string">"10.11.10.26:9200"</span> | grep -q <span class="string">'HTTP/1.1 200 OK'</span> || su - elasticsearch -c <span class="string">"/usr/local/elasticsearch-5.5.2/bin/elasticsearch -d"</span></div><div class="line">curl -Is <span class="string">"10.11.10.26:5601"</span> | grep -q <span class="string">'HTTP/1.1 200 OK'</span> ||  /usr/<span class="built_in">local</span>/kibana-5.5.2/bin/kibana &amp;</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">*/2 * * * * /bin/whole51/es.sh</div></pre></td></tr></table></figure>
<h3 id="äº¤æµå­¦ä¹ ï¼š"><a href="#äº¤æµå­¦ä¹ ï¼š" class="headerlink" title="äº¤æµå­¦ä¹ ï¼š"></a>äº¤æµå­¦ä¹ ï¼š</h3><p>ğŸ§  Linux shell_é«˜çº§è¿ç»´æ´¾: <code>459096184</code>    åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)<br>ğŸ§  BigData-Exchange School : <code>521621407</code>  åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥</p>
<p>ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚</p>

	

	

</article>




	<article>
	
		<h1><a href="/2016/01/29/æ—¥å¿—åˆ†æå¹³å°/Elasticsearch/logstashå¦‚ä½•æ”¶é›†tomcatæ—¥å¿—åˆ†æ/">logstashå¦‚ä½•å†™tomcat,redis,nginxæ—¥å¿—æ”¶é›†è§„åˆ™</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-01-29</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/Log-Analysis-Platform/">Log Analysis Platform</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Log-analysis-platform/">Log analysis platform</a>
			</span>
		
	</div>

	

	
		<h5 id="logstashå¦‚ä½•æ”¶é›†tomcatæ—¥å¿—åˆ†æï¼ˆå¯ä»¥å‚è€ƒæˆ‘ä¸‹é¢å†™çš„æ¨¡æ¿ï¼‰"><a href="#logstashå¦‚ä½•æ”¶é›†tomcatæ—¥å¿—åˆ†æï¼ˆå¯ä»¥å‚è€ƒæˆ‘ä¸‹é¢å†™çš„æ¨¡æ¿ï¼‰" class="headerlink" title="logstashå¦‚ä½•æ”¶é›†tomcatæ—¥å¿—åˆ†æï¼ˆå¯ä»¥å‚è€ƒæˆ‘ä¸‹é¢å†™çš„æ¨¡æ¿ï¼‰"></a>logstashå¦‚ä½•æ”¶é›†tomcatæ—¥å¿—åˆ†æï¼ˆå¯ä»¥å‚è€ƒæˆ‘ä¸‹é¢å†™çš„æ¨¡æ¿ï¼‰</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line">æˆ‘æƒ³å®ç°å¯¹tomcatçš„æ—¥å¿—é‡‡é›†ï¼Œæ­£å¸¸åº”è¯¥åˆ›å»ºä¸€ä¸ªfileçš„inputï¼Œè¿™ä¸ªinputæŒ‡å®šäº†ç›‘å¬çš„æ–‡ä»¶æˆ–è€…ç›®å½•....ç„¶åè¿‡æ»¤å™¨ï¼ˆå¦‚æœæ²¡æœ‰ç‰¹æ®Šè¦æ±‚ï¼Œå…ˆå¯ä»¥ä¸è¿›è¡Œè§£æï¼ŒåŸå§‹çš„æ—¥å¿—ç›´æ¥å­˜å°±è¡Œï¼‰....æœ€åä½¿ç”¨ä¸€ä¸ªelastcisearchæ’ä»¶ï¼Œå‘é€åˆ°esä¸­å».</div><div class="line"></div><div class="line">input &#123;</div><div class="line">        stdin&#123;&#125;</div><div class="line"></div><div class="line">        file &#123;</div><div class="line">                <span class="built_in">type</span> =&gt; <span class="string">"tomcat_card"</span></div><div class="line">                path =&gt; <span class="string">"/srv/tomcat/logs/card/*.log"</span></div><div class="line">                start_position =&gt; <span class="string">"beginning"</span></div><div class="line">        &#125;</div><div class="line">        file &#123;</div><div class="line">                <span class="built_in">type</span> =&gt; <span class="string">"tomcat_family"</span></div><div class="line">                path =&gt; <span class="string">"/srv/tomcat/logs/family/*.log"</span></div><div class="line">                start_position =&gt; <span class="string">"beginning"</span></div><div class="line"></div><div class="line">        &#125;</div><div class="line">        file &#123;</div><div class="line">                <span class="built_in">type</span> =&gt; <span class="string">"tomcat_mission"</span></div><div class="line">                path =&gt; <span class="string">"/srv/tomcat/logs/mission/*.log"</span></div><div class="line">                start_position =&gt; <span class="string">"beginning"</span></div><div class="line"></div><div class="line">        &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">filter &#123;</div><div class="line"></div><div class="line">        grok &#123;</div><div class="line">                match =&gt; [</div><div class="line">                                <span class="string">"message"</span>, <span class="string">"%&#123;TIMESTAMP_ISO8601:logdate&#125; %&#123;WORD:loglevel&#125;%&#123;SPACE&#125;%&#123;NOTSPACE:loggername&#125; - %&#123;GREEDYDATA:msg&#125;"</span>,</div><div class="line">                                <span class="string">"message"</span>, <span class="string">"%&#123;GREEDYDATA:msg&#125;"</span></div><div class="line">                         ]</div><div class="line"></div><div class="line">        &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">output&#123;</div><div class="line">        <span class="keyword">if</span> [<span class="built_in">type</span>] == <span class="string">"tomcat_card"</span> &#123;</div><div class="line">        elasticsearch &#123;</div><div class="line">                host =&gt; <span class="string">"192.168.1.234"</span></div><div class="line">                protocol =&gt; <span class="string">"http"</span></div><div class="line">                index   =&gt; <span class="string">"tomcat_card-%&#123;+YYYYY.MM.dd&#125;"</span></div><div class="line">        &#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line">        <span class="keyword">if</span> [<span class="built_in">type</span>] == <span class="string">"tomcat_family"</span> &#123;</div><div class="line">        elasticsearch &#123;</div><div class="line">                host =&gt; <span class="string">"192.168.1.234"</span></div><div class="line">                protocol =&gt; <span class="string">"http"</span></div><div class="line">                index   =&gt; <span class="string">"tomcat_card-%&#123;+YYYYY.MM.dd&#125;"</span></div><div class="line">        &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> [<span class="built_in">type</span>] == <span class="string">"tomcat_mission"</span> &#123;</div><div class="line">        elasticsearch &#123;</div><div class="line">                host =&gt; <span class="string">"192.168.1.234"</span></div><div class="line">                protocol =&gt; <span class="string">"http"</span></div><div class="line">                index   =&gt; <span class="string">"tomcat_mission-%&#123;+YYYYY.MM.dd&#125;"</span></div><div class="line">                &#125;</div><div class="line">        &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="logstashæ—¥å¿—é‡‡é›†nginxé…ç½®"><a href="#logstashæ—¥å¿—é‡‡é›†nginxé…ç½®" class="headerlink" title="logstashæ—¥å¿—é‡‡é›†nginxé…ç½®"></a>logstashæ—¥å¿—é‡‡é›†nginxé…ç½®</h5><p>/etc/logstash/conf.d/nginx.conf</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">input &#123;</div><div class="line">file &#123;</div><div class="line">path =&gt; <span class="string">"/data/wwwlogs/nginx_json.log"</span></div><div class="line">codec =&gt; <span class="string">"json"</span></div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">filter &#123;</div><div class="line">mutate &#123;</div><div class="line">split =&gt; [ <span class="string">"upstreamtime"</span>, <span class="string">","</span> ]</div><div class="line">&#125;</div><div class="line">mutate &#123;</div><div class="line">convert =&gt; [ <span class="string">"upstreamtime"</span>, <span class="string">"float"</span> ]</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">output &#123;</div><div class="line">kafka &#123;</div><div class="line">bootstrap_servers =&gt; <span class="string">"10.0.0.11:9092"</span></div><div class="line">topic_id =&gt; <span class="string">"logstash"</span></div><div class="line">compression_type =&gt; <span class="string">"gzip"</span></div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="åˆ›å»ºä¸€ä¸ªä»æ—¥å¿—æ–‡ä»¶è¯»å–ï¼Œå¹¶å†™å…¥redisçš„é…ç½®æ–‡ä»¶-æœ¬æ–‡ä»¶é‡‡ç”¨é»˜è®¤æ–¹å¼è¿›è¡Œè¾“å…¥ï¼Œè¾“å‡º"><a href="#åˆ›å»ºä¸€ä¸ªä»æ—¥å¿—æ–‡ä»¶è¯»å–ï¼Œå¹¶å†™å…¥redisçš„é…ç½®æ–‡ä»¶-æœ¬æ–‡ä»¶é‡‡ç”¨é»˜è®¤æ–¹å¼è¿›è¡Œè¾“å…¥ï¼Œè¾“å‡º" class="headerlink" title="åˆ›å»ºä¸€ä¸ªä»æ—¥å¿—æ–‡ä»¶è¯»å–ï¼Œå¹¶å†™å…¥redisçš„é…ç½®æ–‡ä»¶(æœ¬æ–‡ä»¶é‡‡ç”¨é»˜è®¤æ–¹å¼è¿›è¡Œè¾“å…¥ï¼Œè¾“å‡º)"></a>åˆ›å»ºä¸€ä¸ªä»æ—¥å¿—æ–‡ä»¶è¯»å–ï¼Œå¹¶å†™å…¥redisçš„é…ç½®æ–‡ä»¶(æœ¬æ–‡ä»¶é‡‡ç”¨é»˜è®¤æ–¹å¼è¿›è¡Œè¾“å…¥ï¼Œè¾“å‡º)</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#cat agent.conf</span></div><div class="line">input &#123;</div><div class="line">    file &#123;</div><div class="line">        path =&gt; <span class="string">"/var/log/httpd/access_log"</span>    //è®¾ç½®è¯»å–çš„æ—¥å¿—è·¯å¾„</div><div class="line">        sincedb_path =&gt; <span class="string">"../.sincedb"</span></div><div class="line">        <span class="built_in">type</span> =&gt; <span class="string">"httpd"</span></div><div class="line">        start_position =&gt; <span class="string">"beginning"</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">output &#123;</div><div class="line">    redis &#123;</div><div class="line">        host =&gt; [<span class="string">"127.0.0.1"</span>]</div><div class="line">        port =&gt; 6379</div><div class="line">        batch =&gt; <span class="literal">true</span></div><div class="line">            batch_events =&gt; 5</div><div class="line">            data_type =&gt; <span class="string">"list"</span></div><div class="line">            key =&gt; <span class="string">"logstash:redis"</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">é…ç½®ä¸€ä¸ªä»redisè¯»å–æ—¥å¿—å¹¶è¾“å‡ºåˆ°esçš„é…ç½®æ–‡ä»¶</div><div class="line"></div><div class="line"><span class="comment">#cat index.conf</span></div><div class="line">input &#123;</div><div class="line">  redis &#123;</div><div class="line">    host =&gt; [<span class="string">"127.0.0.1"</span>]</div><div class="line">    port =&gt; 6379</div><div class="line">    data_type =&gt; <span class="string">"list"</span></div><div class="line">    key =&gt; â€œ<span class="built_in">log</span> stash:redis<span class="string">"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">output &#123;</div><div class="line">        elasticsearch &#123;</div><div class="line">        host =&gt; "127.0.0.1<span class="string">"</span></div><div class="line">        protocol =&gt; "http<span class="string">"</span></div><div class="line">        index =&gt; "logstash-%&#123;<span class="built_in">type</span>&#125;-%&#123;+YYYY.MM.dd&#125;<span class="string">"</span></div><div class="line">        index_type =&gt; "%&#123;<span class="built_in">type</span>&#125;<span class="string">"</span></div><div class="line">        &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">å¯åŠ¨logstash</div></pre></td></tr></table></figure>
<h3 id="äº¤æµå­¦ä¹ ï¼š"><a href="#äº¤æµå­¦ä¹ ï¼š" class="headerlink" title="äº¤æµå­¦ä¹ ï¼š"></a>äº¤æµå­¦ä¹ ï¼š</h3><p>ğŸ§  Linux shell_é«˜çº§è¿ç»´æ´¾: <code>459096184</code>    åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)<br>ğŸ§  BigData-Exchange School : <code>521621407</code>  åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥</p>
<p>ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚</p>

	

	

</article>




	<article>
	
		<h1><a href="/2016/01/21/æ—¥å¿—åˆ†æå¹³å°/Elasticsearch/ELK-Elasticsearch-Logstash-Kibana-æ­å»ºæ—¥å¿—é›†ä¸­åˆ†æå¹³å°å®è·µ/">ELK(Elasticsearch1.7+ + Logstash1.5+ + Kibana4.1)æ­å»ºæ—¥å¿—é›†ä¸­åˆ†æå¹³å°å®è·µ</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-01-21</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/Log-Analysis-Platform/">Log Analysis Platform</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Elasticsearch/">Elasticsearch</a> <a class="article__tag-link" href="/tags/Kibana/">Kibana</a>
			</span>
		
	</div>

	

	
		<h4 id="å…³æ³¨å¯å‚è€ƒï¼š"><a href="#å…³æ³¨å¯å‚è€ƒï¼š" class="headerlink" title="å…³æ³¨å¯å‚è€ƒï¼š"></a>å…³æ³¨å¯å‚è€ƒï¼š</h4><p>æœ¬æ–‡å°†å®‰è£…Elasticsearch-1.7.2, Logstash-1.5.5, Kibana-4.1.5ã€‚ è¯·æ³¨æ„ç‰ˆæœ¬è¦æ±‚ï¼Œæœ‰äº›ç»„ä»¶éœ€è¦å“åº”çš„ç‰ˆæœ¬è¦æ±‚ã€‚<br>logstashæ˜¯è´Ÿè´£æœé›†å’Œè½¬å‘æ—¥å¿—çš„ï¼Œesç”¨äºå­˜å‚¨å’Œæ£€ç´¢ï¼Œkibanaæä¾›webç«¯çš„å±•ç°â€¦ä»–ä»¬æ˜¯ç‹¬ç«‹è¿è¡Œçš„ï¼Œä¹Ÿå¯ä»¥éƒ¨ç½²åœ¨åŒä¸€å°æœºå™¨ï¼Œä¹Ÿå¯ä»¥ä¸åŒçš„æœºå™¨ã€‚</p>
<p>å¯ä»¥å…³æ³¨æˆ‘çš„Githubä¸Šé¢æœ‰è¯¦ç»†æ–‡æ¡£ï¼š<a href="https://github.com/yangcvo/ELK" target="_blank" rel="external">https://github.com/yangcvo/ELK</a></p>
<ul>
<li>å¯åŠ¨è„šæœ¬ä¸‹è½½ï¼š<a href="https://github.com/yangcvo/ELK" target="_blank" rel="external">https://github.com/yangcvo/ELK</a></li>
<li>è¯¦ç»†é…ç½®ä¼˜åŒ–åšé›†ç¾¤ä¸å†™æ”¶é›†æ—¥å¿—è§„åˆ™æ•™ç¨‹: <a href="https://github.com/yangcvo/ELK" target="_blank" rel="external">https://github.com/yangcvo/ELK</a></li>
</ul>
<h4 id="ç»„ä»¶é¢„è§ˆ"><a href="#ç»„ä»¶é¢„è§ˆ" class="headerlink" title="ç»„ä»¶é¢„è§ˆ"></a>ç»„ä»¶é¢„è§ˆ</h4><ul>
<li>JDK  <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html" target="_blank" rel="external">http://www.oracle.com/technetwork/java/javase/downloads/index.html</a></li>
<li>Elasticsearch <a href="https://www.elastic.co/downloads/elasticsearch" target="_blank" rel="external">https://www.elastic.co/downloads/elasticsearch</a></li>
<li>Logstash <a href="https://www.elastic.co/downloads/logstash" target="_blank" rel="external">https://www.elastic.co/downloads/logstash</a></li>
<li>Kibanaä¸‹è½½åœ°å€:<a href="https://www.elastic.co/downloads/kibana" target="_blank" rel="external">https://www.elastic.co/downloads/kibana</a></li>
<li>redisä¸‹è½½åœ°å€: <a href="http://redis.io/download" target="_blank" rel="external">http://redis.io/download</a></li>
</ul>
<h4 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ:"></a>å‡†å¤‡å·¥ä½œ:</h4><p>æœåŠ¡ç«¯ï¼šç³»ç»Ÿcentos 6.7   ip:192.168.1.234   JDK1.8    Elasticsearch-1.7.2  Kibana-4.1.2<br>å®¢æˆ·ç«¯ï¼šç³»ç»Ÿcentos 6.7   ip:192.168.1.235   JDK1.8    Logash-1.4.2</p>
<h4 id="åŸºæœ¬é…ç½®è®¾ç½®FQDNï¼š"><a href="#åŸºæœ¬é…ç½®è®¾ç½®FQDNï¼š" class="headerlink" title="åŸºæœ¬é…ç½®è®¾ç½®FQDNï¼š"></a>åŸºæœ¬é…ç½®è®¾ç½®FQDNï¼š</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">åˆ›å»ºSSLè¯ä¹¦çš„æ—¶å€™éœ€è¦é…ç½®FQDN</div><div class="line"><span class="comment">#ä¿®æ”¹hostname</span></div><div class="line">cat /etc/hostname</div><div class="line">elk</div><div class="line"></div><div class="line"><span class="comment">#ä¿®æ”¹hosts</span></div><div class="line">cat /etc/hosts</div><div class="line">127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4</div><div class="line">::1 localhost localhost.localdomain localhost6 localhost6.localdomain6</div><div class="line">192.168.1.234 elk.ooxx.com elk</div><div class="line"></div><div class="line"><span class="comment">#åˆ·æ–°ç¯å¢ƒ</span></div><div class="line">hostname -F /etc/hostname</div><div class="line"></div><div class="line"><span class="comment">#å¤æŸ¥ç»“æœ</span></div><div class="line">hostname <span class="_">-f</span></div><div class="line">elk.ooxx.com</div><div class="line"></div><div class="line">hostname</div><div class="line">elk</div></pre></td></tr></table></figure>
<h4 id="å…³é—­é˜²ç«å¢™"><a href="#å…³é—­é˜²ç«å¢™" class="headerlink" title="å…³é—­é˜²ç«å¢™"></a>å…³é—­é˜²ç«å¢™</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#service iptables stop</span></div><div class="line"><span class="comment">#setenforce 0</span></div><div class="line"></div><div class="line">ä¸è¿‡è¿™é‡Œæˆ‘é˜²ç«å¢™æ˜¯å¼€å¯çš„ï¼ŒåæœŸæ·»åŠ å‡ºå»ç«¯å£å³å¯ã€‚</div><div class="line">æˆ–è€…å¯ä»¥ä¸å…³é—­é˜²ç«å¢™ï¼Œä½†æ˜¯è¦åœ¨iptablesä¸­æ‰“å¼€ç›¸å…³çš„ç«¯å£ï¼š</div><div class="line"></div><div class="line"><span class="comment"># vim /etc/sysconfig/iptables</span></div><div class="line">-A INPUT -m state --state NEW -m tcp -p tcp --dport 80 -j ACCEPT</div><div class="line">-A INPUT -m state --state NEW -m tcp -p tcp --dport 9200 -j ACCEPT</div><div class="line">-A INPUT -m state --state NEW -m tcp -p tcp --dport 9292 -j ACCEPT</div><div class="line"><span class="comment"># service iptables restart</span></div></pre></td></tr></table></figure>
<h4 id="å®‰è£…javaï¼š"><a href="#å®‰è£…javaï¼š" class="headerlink" title="å®‰è£…javaï¼š"></a>å®‰è£…javaï¼š</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">ElasticSearchå’ŒLogstashä¾èµ–äºJDKï¼Œæ‰€ä»¥éœ€è¦å®‰è£…JDKï¼š</div><div class="line"><span class="comment"># yum -y install java-1.8.0-openjdk*</span></div><div class="line"><span class="comment"># java -version</span></div><div class="line">è¿™é‡Œæˆ‘æ˜¯ç”¨yumå®‰è£…æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥è‡ªè¡Œä¸‹è½½taråŒ…ï¼Œæ³¨æ„è®¾ç½®javaè·¯å¾„ã€‚</div><div class="line">javaä¹Ÿå¯åˆ°è¿™ä¸ªåœ°å€ä¸‹è½½https://www.reucon.com/cdn/java/</div></pre></td></tr></table></figure>
<h4 id="å®‰è£…Elasticsearchï¼š"><a href="#å®‰è£…Elasticsearchï¼š" class="headerlink" title="å®‰è£…Elasticsearchï¼š"></a>å®‰è£…Elasticsearchï¼š</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">RPMå®‰è£…</div><div class="line">ä¸‹è½½ElasticSearch ElasticSearché»˜è®¤çš„å¯¹å¤–æœåŠ¡çš„HTTPç«¯å£æ˜¯9200ï¼ŒèŠ‚ç‚¹é—´äº¤äº’çš„TCPç«¯å£æ˜¯9300ã€‚</div><div class="line">.ä»¥ CentOS ä¸‹ä½¿ç”¨å®‰è£…åŒ…RPMå®‰è£…</div><div class="line">ï¼ƒmkdir -p /opt/software &amp;&amp; <span class="built_in">cd</span> /opt/software</div><div class="line">ï¼ƒwget -c https://download.elastic.co/elasticsearch/elasticsearch/elasticsearch-1.7.2.noarch.rpm</div><div class="line">ï¼ƒrpm -ivh elasticsearch-1.7.2.noarch.rpm</div><div class="line"></div><div class="line">å¯ä»¥è‡ªå®šä¹‰ä¸‹å­˜å‚¨æ–‡ä»¶ç›®å½• ç”¨RPM å®‰è£…ã€‚</div><div class="line"></div><div class="line">vim /etc/elasticsearch/elasticsearch.yml</div><div class="line">cluster.name: graylog-development</div><div class="line">node.data: <span class="literal">true</span></div><div class="line">index.number_of_shards: 5</div><div class="line">index.number_of_replicas: 1</div><div class="line">path.data: /home/data/es-data   è‡ªå®šå­˜å‚¨ç›®å½•</div><div class="line">path.work: /home/data/es-work</div><div class="line">network.host: 192.168.1.234</div></pre></td></tr></table></figure>
<h4 id="å¯åŠ¨esç›¸å…³æœåŠ¡"><a href="#å¯åŠ¨esç›¸å…³æœåŠ¡" class="headerlink" title="å¯åŠ¨esç›¸å…³æœåŠ¡"></a>å¯åŠ¨esç›¸å…³æœåŠ¡</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">service elasticsearch <span class="keyword">start</span></div><div class="line">service elasticsearch <span class="keyword">status</span></div></pre></td></tr></table></figure>
<h4 id="esæºç å®‰è£…"><a href="#esæºç å®‰è£…" class="headerlink" title="esæºç å®‰è£…"></a>esæºç å®‰è£…</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">è¿™é‡Œæˆ‘æ˜¯æºç å®‰è£…çš„</div><div class="line">ä¸‹è½½ElasticSearch ElasticSearché»˜è®¤çš„å¯¹å¤–æœåŠ¡çš„HTTPç«¯å£æ˜¯9200ï¼ŒèŠ‚ç‚¹é—´äº¤äº’çš„TCPç«¯å£æ˜¯9300ã€‚</div><div class="line">Elasticsearch - https://www.elastic.co/downloads/elasticsearch</div><div class="line">tar -zxvf elasticsearch-1.7.1.tar.gz -C /usr/<span class="built_in">local</span>/</div><div class="line"> <span class="built_in">cd</span> /usr/<span class="built_in">local</span>/elasticsearch-1.7.1/config/</div><div class="line"></div><div class="line">ç„¶åç»™ç›®å½•åšä¸ªè½¯é“¾æ¥ï¼š</div><div class="line">ln <span class="_">-s</span> elasticsearch-1.7.1/ /usr/<span class="built_in">local</span>/elasticsearch</div><div class="line"></div><div class="line">è¿™é‡Œéœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š</div><div class="line">é…ç½®å‰å…ˆåˆ›å»ºå‡ ä¸ªç›®å½•æ–‡ä»¶</div><div class="line">mkdir /data/es-data -p</div><div class="line"> mkdir /data/es-work -p</div><div class="line"> mkdir   /usr/<span class="built_in">local</span>/elasticsearch-1.7.1/config/logs</div><div class="line"> mkdir   /usr/<span class="built_in">local</span>/elasticsearch-1.7.1/config/plugins</div></pre></td></tr></table></figure>
<h4 id="é…ç½®Elasticsearchï¼š"><a href="#é…ç½®Elasticsearchï¼š" class="headerlink" title="é…ç½®Elasticsearchï¼š"></a>é…ç½®Elasticsearchï¼š</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line">vim elasticsearch.yml</div><div class="line"></div><div class="line"></div><div class="line">cluster.name: elasticsearch   é›†ç¾¤åç§°  </div><div class="line"></div><div class="line"><span class="comment">#################################### Node #####################################</span></div><div class="line"></div><div class="line"><span class="comment"># Node names are generated dynamically on startup, so you're relieved</span></div><div class="line"><span class="comment"># from configuring them manually. You can tie this node to a specific name:</span></div><div class="line"><span class="comment">#</span></div><div class="line">node.name: â€œlinux_esâ€   è¿™é‡Œæˆ‘åšäº†é›†ç¾¤æ‰€ä»¥éœ€è¦ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œè¿™é‡Œæˆ‘å†™äº†ä¸€ä¸ªèŠ‚ç‚¹åç§°</div><div class="line"></div><div class="line"><span class="comment"># Every node can be configured to allow or deny being eligible as the master,</span></div><div class="line"><span class="comment"># and to allow or deny to store the data.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Allow this node to be eligible as a master node (enabled by default):</span></div><div class="line"><span class="comment">#</span></div><div class="line">node.master: <span class="literal">true</span>   é›†ç¾¤master å¯åŠ¨</div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Allow this node to store data (enabled by default):</span></div><div class="line"><span class="comment">#</span></div><div class="line">node.data: <span class="literal">true</span>  æ•°æ®å­˜æ”¾<span class="literal">true</span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># Set the number of shards (splits) of an index (5 by default):</span></div><div class="line"><span class="comment">#</span></div><div class="line">index.number_of_shards: 5</div><div class="line"></div><div class="line"><span class="comment"># Set the number of replicas (additional copies) of an index (1 by default):</span></div><div class="line"><span class="comment">#</span></div><div class="line">index.number_of_replicas: 1</div><div class="line"></div><div class="line"><span class="comment">#################################### Paths ####################################</span></div><div class="line"></div><div class="line"><span class="comment"># Path to directory containing configuration (this file and logging.yml):</span></div><div class="line"><span class="comment">#</span></div><div class="line">path.conf: /usr/<span class="built_in">local</span>/elasticsearch/config  è¿™é‡Œå¼€å¯esé…ç½®æ–‡ä»¶ç›®å½•è·¯å¾„</div><div class="line"></div><div class="line"><span class="comment"># Path to directory where to store index data allocated for this node.</span></div><div class="line"><span class="comment">#</span></div><div class="line">path.data: /data/es-data     esæ•°æ®å­˜æ”¾ç›®å½•  è¿™é‡Œéœ€è¦è‡ªå·±æ–°å»ºç›®å½•</div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Can optionally include more than one location, causing data to be striped across</span></div><div class="line"><span class="comment"># the locations (a la RAID 0) on a file level, favouring locations with most free</span></div><div class="line"><span class="comment"># space on creation. For example:</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#path.data: /path/to/data1,/path/to/data2</span></div><div class="line"></div><div class="line"><span class="comment"># Path to temporary files:</span></div><div class="line"><span class="comment">#</span></div><div class="line">path.work: /data/es-work   </div><div class="line"></div><div class="line"><span class="comment"># Path to log files:</span></div><div class="line"><span class="comment">#</span></div><div class="line">path.logs: /usr/<span class="built_in">local</span>/elasticsearch/logs   esçš„å­˜æ”¾æ—¥å¿—  è¿™é‡Œéœ€è¦è‡ªå·±åˆ›å»ºä¸‹æ–‡ä»¶</div><div class="line"></div><div class="line"><span class="comment"># Path to where plugins are installed:</span></div><div class="line"><span class="comment">#</span></div><div class="line">path.plugins: /usr/<span class="built_in">local</span>/elasticsearch/plugins   eså®‰è£…æ’ä»¶å­˜æ”¾è·¯å¾„</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Set this property to true to lock the memory:</span></div><div class="line"><span class="comment">#</span></div><div class="line">bootstrap.mlockall: <span class="literal">true</span></div></pre></td></tr></table></figure>
<p>æºç å®‰è£…å¯åŠ¨éœ€è¦æ‰§è¡Œ ï¼š<code>/usr/local/elasticsearch/bin/elasticsearch</code><br>æ‰èƒ½å¯åŠ¨ï¼›</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">è¿™é‡Œéœ€è¦/etc/init.d/åˆ›å»ºå¯åŠ¨è„šæœ¬ã€‚</div><div class="line">å¯ä»¥åˆ°æˆ‘githubä¸Šé¢ä¸‹è½½ã€‚</div><div class="line">[root@ELK elasticsearch-servicewrapper]<span class="comment"># mv service/ /usr/local/elasticsearch/bin/</span></div><div class="line">[root@ELK elasticsearch-servicewrapper]<span class="comment"># cd /usr/local/elasticsearch</span></div><div class="line">[root@ELK elasticsearch]<span class="comment"># /usr/local/elasticsearch/bin/service/elasticsearch install    è¿™é‡Œæ˜¯å®‰è£…es</span></div><div class="line">Detected RHEL or Fedora:</div><div class="line">Installing the Elasticsearch daemon..</div><div class="line">[root@ELK elasticsearch]<span class="comment"># vim /etc/init.d/elasticsearch   æŸ¥çœ‹å®‰è£…eså¯åŠ¨é…ç½®æ–‡ä»¶</span></div><div class="line">[root@ELK elasticsearch]<span class="comment"># service elasticsearch start  å¯åŠ¨es </span></div><div class="line">Starting Elasticsearch...</div><div class="line">Waiting <span class="keyword">for</span> Elasticsearch......</div><div class="line">running: PID:31360   æœåŠ¡å·²å¯åŠ¨äº†ã€‚</div><div class="line"></div><div class="line">å¯åŠ¨ç›¸å…³æœåŠ¡</div><div class="line">service elasticsearch start</div><div class="line">service elasticsearch status</div><div class="line"></div><div class="line">é…ç½® elasticsearch æœåŠ¡éšç³»ç»Ÿè‡ªåŠ¨å¯åŠ¨</div><div class="line"><span class="comment"># chkconfig --add elasticsearch</span></div><div class="line"></div><div class="line">æµ‹è¯•ElasticSearchæœåŠ¡æ˜¯å¦æ­£å¸¸ï¼Œé¢„æœŸè¿”å›200çš„çŠ¶æ€ç </div><div class="line"><span class="comment"># curl -X GET http://localhost:9200</span></div><div class="line">&#123;</div><div class="line">  <span class="string">"name"</span> : <span class="string">"elk"</span>,</div><div class="line">  <span class="string">"cluster_name"</span> : <span class="string">"elasticsearch"</span>,</div><div class="line">  <span class="string">"cluster_uuid"</span> : <span class="string">"-4Rqn4IzS1GfnsodqZD8Tg"</span>,</div><div class="line">  <span class="string">"version"</span> : &#123;</div><div class="line">    <span class="string">"number"</span> : <span class="string">"1.7.2"</span>,</div><div class="line">    <span class="string">"build_hash"</span> : <span class="string">"d38a34e7b75af4e17ead16f156feffa432b22be3"</span>,</div><div class="line">    <span class="string">"build_timestamp"</span> : <span class="string">"2016-01-03T16:28:56Z"</span>,</div><div class="line">    <span class="string">"build_snapshot"</span> : <span class="literal">false</span>,</div><div class="line">    <span class="string">"lucene_version"</span> : <span class="string">"5.5.2"</span></div><div class="line">  &#125;,</div><div class="line">  <span class="string">"tagline"</span> : <span class="string">"You Know, for Search"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="å®‰è£…-headã€marvelã€bigdeskæ’ä»¶"><a href="#å®‰è£…-headã€marvelã€bigdeskæ’ä»¶" class="headerlink" title="å®‰è£… headã€marvelã€bigdeskæ’ä»¶:"></a>å®‰è£… headã€marvelã€bigdeskæ’ä»¶:</h4><h6 id="headæ’ä»¶"><a href="#headæ’ä»¶" class="headerlink" title="headæ’ä»¶"></a>headæ’ä»¶</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">æ’ä»¶å®‰è£…æ–¹æ³•1ï¼š</div><div class="line">/usr/<span class="built_in">local</span>/elasticsearch/bin/plugin -install mobz/elasticsearch-head</div><div class="line">é‡å¯es å³å¯ã€‚</div><div class="line">æ‰“å¼€http://localhost:9200/_plugin/head/</div><div class="line"></div><div class="line">æ’ä»¶å®‰è£…æ–¹æ³•2ï¼š</div><div class="line">1.https://github.com/mobz/elasticsearch-headä¸‹è½½zip è§£å‹</div><div class="line">2.å»ºç«‹/usr/<span class="built_in">local</span>/elasticsearch/plugins/head/æ–‡ä»¶</div><div class="line">3.å°†è§£å‹åçš„elasticsearch-head-masteræ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶copyåˆ°/usr/<span class="built_in">local</span>/elasticsearch/plugins/head/</div><div class="line">é‡å¯es å³å¯ã€‚</div><div class="line"></div><div class="line">æ‰“å¼€http://localhost:9200/_plugin/head/</div></pre></td></tr></table></figure>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/elk_head.png" alt=""></figure></p>
<h6 id="Marvelæ’ä»¶"><a href="#Marvelæ’ä»¶" class="headerlink" title="Marvelæ’ä»¶"></a>Marvelæ’ä»¶</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">Elasticsearch çš„é›†ç¾¤å’Œæ•°æ®ç®¡ç†ç•Œé¢ Marvel éå¸¸èµï¼Œå¯æƒœåªå¯¹å¼€å‘ç¯å¢ƒå…è´¹ï¼Œ</div><div class="line">å‚è€ƒé“¾æ¥ï¼šhttps://www.elastic.co/guide/en/marvel/current/configuration.html</div><div class="line"></div><div class="line">æ’ä»¶å®‰è£…</div><div class="line">/usr/<span class="built_in">local</span>/elasticsearch/bin/plugin -i elasticsearch/marvel/latest</div><div class="line"></div><div class="line">é‡å¯es å³å¯ã€‚</div><div class="line">å®Œæˆåé‡å¯æœåŠ¡è®¿é—® http://192.168.1.234:9200/_plugin/marvel/</div><div class="line"></div><div class="line">å¦‚ä½•çœ‹ä¸åˆ°ä¸‹é¢çš„é¡µé¢ï¼Œå°±ä¿®æ”¹ä¸‹è¿™é‡Œçš„å‚æ•°çœ‹çœ‹æœ‰æ²¡æœ‰é…ç½®ï¼švim elasticsearch.yml  </div><div class="line">network.host: 192.168.1.234  </div><div class="line">åœ¨é‡å¯es ç„¶ååœ¨æŸ¥çœ‹å°±æœ‰æ•°æ®ã€‚</div></pre></td></tr></table></figure>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/elk_marvel.png" alt=""></figure></p>
<h4 id="bigdeskæ’ä»¶"><a href="#bigdeskæ’ä»¶" class="headerlink" title="bigdeskæ’ä»¶"></a>bigdeskæ’ä»¶</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">çœ‹éœ€æ±‚å®‰è£…</div><div class="line">åŠŸèƒ½: ç›‘æ§æŸ¥çœ‹cpuã€å†…å­˜ä½¿ç”¨æƒ…å†µ,ç´¢å¼•æ•°æ®ã€æœç´¢æƒ…å†µ,httpè¿æ¥æ•°ç­‰</div><div class="line">å®‰è£…</div><div class="line"><span class="comment">#/elstaicsearch/bin/plugin -i lukas-vlcek/bigdesk</span></div><div class="line">é‡å¯es å³å¯ã€‚</div><div class="line">å®Œæˆåé‡å¯æœåŠ¡è®¿é—® http://192.168.1.234:9200/_plugin/bigdesk</div></pre></td></tr></table></figure>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/elk_bigdesk.png" alt=""></figure></p>
<h4 id="å®‰è£…Kibana"><a href="#å®‰è£…Kibana" class="headerlink" title="å®‰è£…Kibana:"></a>å®‰è£…Kibana:</h4><p>åœ¨esæœºå™¨ä¸Šé¢å®‰è£…kibana.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">åˆ°https://www.elastic.co/downloads/kibana  æ‰¾åˆé€‚çš„ç‰ˆæœ¬ã€‚</div><div class="line">æ¯ä¸ªç‰ˆæœ¬ä¸‹é¢æœ‰è¿™ä¹ˆä¸€è¡Œå†…å®¹ï¼Œä¸€å®šè¦æ³¨æ„è¿™äº›å†…å®¹ï¼šCompatible with Elasticsearch 1.4.4 - 1.7</div><div class="line"><span class="built_in">cd</span> /opt/software/  &amp;&amp; wget https://download.elastic.co/kibana/kibana/kibana-4.1.2-linux-x64.tar.gz</div><div class="line"><span class="comment">#è§£å‹</span></div><div class="line"></div><div class="line">ï¼ƒtar zxvf kibana-4.1.2-linux-x64.tar.gz -C /usr/<span class="built_in">local</span> </div><div class="line">ï¼ƒ<span class="built_in">cd</span>  /usr/<span class="built_in">local</span>/ &amp;&amp; mv kibana-4.1.2-linux-x64 kibana</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#åˆ›å»ºkibanaå¯åŠ¨è„šæœ¬æœåŠ¡</span></div><div class="line">vi /etc/rc.d/init.d/kibana</div><div class="line"></div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment">### BEGIN INIT INFO</span></div><div class="line"><span class="comment"># Provides:          kibana</span></div><div class="line"><span class="comment"># Default-Start:     2 3 4 5</span></div><div class="line"><span class="comment"># Default-Stop:      0 1 6</span></div><div class="line"><span class="comment"># Short-Description: Runs kibana daemon</span></div><div class="line"><span class="comment"># Description: Runs the kibana daemon as a non-root user</span></div><div class="line"><span class="comment">### END INIT INFO</span></div><div class="line"></div><div class="line"><span class="comment"># Process name</span></div><div class="line">NAME=kibana</div><div class="line">DESC=<span class="string">"Kibana4"</span></div><div class="line">PROG=<span class="string">"/etc/init.d/kibana"</span></div><div class="line"></div><div class="line"><span class="comment"># Configure location of Kibana bin</span></div><div class="line">KIBANA_BIN=/usr/<span class="built_in">local</span>/kibana/bin</div><div class="line"></div><div class="line"><span class="comment"># PID Info</span></div><div class="line">PID_FOLDER=/var/run/kibana/</div><div class="line">PID_FILE=/var/run/kibana/<span class="variable">$NAME</span>.pid</div><div class="line">LOCK_FILE=/var/lock/subsys/<span class="variable">$NAME</span></div><div class="line">PATH=/bin:/usr/bin:/sbin:/usr/sbin:<span class="variable">$KIBANA_BIN</span></div><div class="line">DAEMON=<span class="variable">$KIBANA_BIN</span>/<span class="variable">$NAME</span></div><div class="line"></div><div class="line"><span class="comment"># Configure User to run daemon process</span></div><div class="line">DAEMON_USER=root</div><div class="line"><span class="comment"># Configure logging location</span></div><div class="line">KIBANA_LOG=/var/<span class="built_in">log</span>/kibana.log</div><div class="line"></div><div class="line"><span class="comment"># Begin Script</span></div><div class="line">RETVAL=0</div><div class="line"></div><div class="line"><span class="keyword">if</span> [ `id -u` <span class="_">-ne</span> 0 ]; <span class="keyword">then</span></div><div class="line">        <span class="built_in">echo</span> <span class="string">"You need root privileges to run this script"</span></div><div class="line">        <span class="built_in">exit</span> 1</div><div class="line"><span class="keyword">fi</span></div><div class="line"></div><div class="line"><span class="comment"># Function library</span></div><div class="line">. /etc/init.d/<span class="built_in">functions</span></div><div class="line"> </div><div class="line"><span class="function"><span class="title">start</span></span>() &#123;</div><div class="line">        <span class="built_in">echo</span> -n <span class="string">"Starting <span class="variable">$DESC</span> : "</span></div><div class="line"></div><div class="line">pid=`pidofproc -p <span class="variable">$PID_FILE</span> kibana`</div><div class="line">        <span class="keyword">if</span> [ -n <span class="string">"<span class="variable">$pid</span>"</span> ] ; <span class="keyword">then</span></div><div class="line">                <span class="built_in">echo</span> <span class="string">"Already running."</span></div><div class="line">                <span class="built_in">exit</span> 0</div><div class="line">        <span class="keyword">else</span></div><div class="line">        <span class="comment"># Start Daemon</span></div><div class="line"><span class="keyword">if</span> [ ! <span class="_">-d</span> <span class="string">"<span class="variable">$PID_FOLDER</span>"</span> ] ; <span class="keyword">then</span></div><div class="line">                        mkdir <span class="variable">$PID_FOLDER</span></div><div class="line">                <span class="keyword">fi</span></div><div class="line">daemon --user=<span class="variable">$DAEMON_USER</span> --pidfile=<span class="variable">$PID_FILE</span> <span class="variable">$DAEMON</span> 1&gt;<span class="string">"<span class="variable">$KIBANA_LOG</span>"</span> 2&gt;&amp;1 &amp;</div><div class="line">                sleep 2</div><div class="line">                pidofproc node &gt; <span class="variable">$PID_FILE</span></div><div class="line">                RETVAL=$?</div><div class="line">                [[ $? <span class="_">-eq</span> 0 ]] &amp;&amp; success || failure</div><div class="line"><span class="built_in">echo</span></div><div class="line">                [ <span class="variable">$RETVAL</span> = 0 ] &amp;&amp; touch <span class="variable">$LOCK_FILE</span></div><div class="line">                <span class="built_in">return</span> <span class="variable">$RETVAL</span></div><div class="line">        <span class="keyword">fi</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="title">reload</span></span>()</div><div class="line">&#123;</div><div class="line">    <span class="built_in">echo</span> <span class="string">"Reload command is not implemented for this service."</span></div><div class="line">    <span class="built_in">return</span> <span class="variable">$RETVAL</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="title">stop</span></span>() &#123;</div><div class="line">        <span class="built_in">echo</span> -n <span class="string">"Stopping <span class="variable">$DESC</span> : "</span></div><div class="line">        killproc -p <span class="variable">$PID_FILE</span> <span class="variable">$DAEMON</span></div><div class="line">        RETVAL=$?</div><div class="line"><span class="built_in">echo</span></div><div class="line">        [ <span class="variable">$RETVAL</span> = 0 ] &amp;&amp; rm <span class="_">-f</span> <span class="variable">$PID_FILE</span> <span class="variable">$LOCK_FILE</span></div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$1</span>"</span> <span class="keyword">in</span></div><div class="line">  start)</div><div class="line">        start</div><div class="line">;;</div><div class="line">  stop)</div><div class="line">        stop</div><div class="line">        ;;</div><div class="line">  status)</div><div class="line">        status -p <span class="variable">$PID_FILE</span> <span class="variable">$DAEMON</span></div><div class="line">        RETVAL=$?</div><div class="line">        ;;</div><div class="line">  restart)</div><div class="line">        stop</div><div class="line">        start</div><div class="line">        ;;</div><div class="line">  reload)</div><div class="line">reload</div><div class="line">;;</div><div class="line">  *)</div><div class="line"><span class="comment"># Invalid Arguments, print the following message.</span></div><div class="line">        <span class="built_in">echo</span> <span class="string">"Usage: <span class="variable">$0</span> &#123;start|stop|status|restart&#125;"</span> &gt;&amp;2</div><div class="line"><span class="built_in">exit</span> 2</div><div class="line">        ;;</div><div class="line"><span class="keyword">esac</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#ä¿®æ”¹å¯åŠ¨æƒé™</span></div><div class="line">chmod +x /etc/rc.d/init.d/kibana</div><div class="line"></div><div class="line"><span class="comment">#å¯åŠ¨kibanaæœåŠ¡</span></div><div class="line">service kibana start</div><div class="line">service kibana status</div><div class="line"></div><div class="line"><span class="comment">#æŸ¥çœ‹ç«¯å£</span></div><div class="line"></div><div class="line">netstat -nltp</div><div class="line"></div><div class="line">Active Internet connections (only servers)</div><div class="line">Proto Recv-Q Send-Q Local Address               Foreign Address             State       PID/Program name   </div><div class="line">tcp        0      0 0.0.0.0:9200                0.0.0.0:*                   LISTEN      1765/java           </div><div class="line">tcp        0      0 0.0.0.0:9300                0.0.0.0:*                   LISTEN      1765/java           </div><div class="line">tcp        0      0 0.0.0.0:22                  0.0.0.0:*                   LISTEN      1509/sshd           </div><div class="line">tcp        0      0 0.0.0.0:5601                0.0.0.0:*                   LISTEN      1876/node           </div><div class="line">tcp        0      0 :::22                       :::*                        LISTEN      1509/sshd</div></pre></td></tr></table></figure>
<h4 id="é…ç½®Kibanaï¼š"><a href="#é…ç½®Kibanaï¼š" class="headerlink" title="é…ç½®Kibanaï¼š"></a>é…ç½®Kibanaï¼š</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">#ç¼–è¾‘kibana.yaml  ä¿®æ”¹ç«¯å£ï¼Œè®¾ç½®host å¯ä»¥è®¾ç½®æœ¬åœ°æœåŠ¡å™¨IP</span></div><div class="line">vi /usr/<span class="built_in">local</span>/kibana/config/kibana.yml</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># Kibana is served by a back end server. This controls which port to use.</span></div><div class="line"></div><div class="line">port: 5601</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># The host to bind the server to.</span></div><div class="line">host: <span class="string">"0.0.0.0"</span></div><div class="line"></div><div class="line"><span class="comment"># The Elasticsearch instance to use for all your queries.</span></div><div class="line">elasticsearch_url: <span class="string">"http://localhost:9200"</span></div><div class="line"></div><div class="line"><span class="comment"># preserve_elasticsearch_host true will send the hostname specified in `elasticsearch`. If you set it to false,</span></div><div class="line"><span class="comment"># then the host you use to connect to *this* Kibana instance will be sent.</span></div><div class="line">elasticsearch_preserve_host: <span class="literal">true</span></div><div class="line"></div><div class="line"><span class="comment"># Kibana uses an index in Elasticsearch to store saved searches, visualizations</span></div><div class="line"><span class="comment"># and dashboards. It will create a new index if it doesn't already exist.</span></div><div class="line">kibana_index: <span class="string">".kibana"</span></div><div class="line"></div><div class="line"><span class="comment"># If your Elasticsearch is protected with basic auth, this is the user credentials</span></div><div class="line"><span class="comment"># used by the Kibana server to perform maintence on the kibana_index at statup. Your Kibana</span></div><div class="line"><span class="comment"># users will still need to authenticate with Elasticsearch (which is proxied thorugh</span></div><div class="line"><span class="comment"># the Kibana server)</span></div><div class="line"><span class="comment"># kibana_elasticsearch_username: user</span></div><div class="line"><span class="comment"># kibana_elasticsearch_password: pass</span></div><div class="line"></div><div class="line"><span class="comment"># If your Elasticsearch requires client certificate and key</span></div><div class="line"><span class="comment"># kibana_elasticsearch_client_crt: /path/to/your/client.crt</span></div><div class="line"><span class="comment"># kibana_elasticsearch_client_key: /path/to/your/client.key</span></div><div class="line"></div><div class="line"><span class="comment"># If you need to provide a CA certificate for your Elasticsarech instance, put</span></div><div class="line"><span class="comment"># the path of the pem file here.</span></div><div class="line"><span class="comment"># ca: /path/to/your/CA.pem</span></div><div class="line"></div><div class="line"><span class="comment"># The default application to load.</span></div><div class="line">default_app_id: <span class="string">"discover"</span></div><div class="line"></div><div class="line"><span class="comment"># Time in milliseconds to wait for elasticsearch to respond to pings, defaults to</span></div><div class="line"><span class="comment"># request_timeout setting</span></div><div class="line"><span class="comment"># ping_timeout: 1500</span></div><div class="line"></div><div class="line"><span class="comment"># Time in milliseconds to wait for responses from the back end or elasticsearch.</span></div><div class="line"><span class="comment"># This must be &gt; 0</span></div><div class="line">request_timeout: 300000</div><div class="line"></div><div class="line"><span class="comment"># Time in milliseconds for Elasticsearch to wait for responses from shards.</span></div><div class="line"><span class="comment"># Set to 0 to disable.</span></div><div class="line">shard_timeout: 0</div><div class="line"></div><div class="line"><span class="comment"># Time in milliseconds to wait for Elasticsearch at Kibana startup before retrying</span></div><div class="line"><span class="comment"># startup_timeout: 5000</span></div><div class="line"></div><div class="line"><span class="comment"># Set to false to have a complete disregard for the validity of the SSL</span></div><div class="line"><span class="comment"># certificate.</span></div><div class="line">verify_ssl: <span class="literal">true</span></div><div class="line"></div><div class="line"><span class="comment"># SSL for outgoing requests from the Kibana Server (PEM formatted)</span></div><div class="line"><span class="comment"># ssl_key_file: /path/to/your/server.key</span></div><div class="line"><span class="comment"># ssl_cert_file: /path/to/your/server.crt</span></div><div class="line"></div><div class="line"><span class="comment"># Set the path to where you would like the process id file to be created.</span></div><div class="line"><span class="comment"># pid_file: /var/run/kibana.pid</span></div><div class="line"></div><div class="line"><span class="comment"># If you would like to send the log output to a file you can set the path below.</span></div><div class="line"><span class="comment"># This will also turn off the STDOUT log output.</span></div><div class="line"><span class="comment"># log_file: ./kibana.log</span></div><div class="line"></div><div class="line"><span class="comment"># Plugins that are included in the build, and no longer found in the plugins/ folder</span></div><div class="line">bundled_plugin_ids:</div><div class="line">- plugins/dashboard/index</div><div class="line">- plugins/discover/index</div><div class="line">- plugins/doc/index</div><div class="line">- plugins/kibana/index</div><div class="line">- plugins/markdown_vis/index</div><div class="line">- plugins/metric_vis/index</div><div class="line">- plugins/settings/index</div><div class="line">- plugins/table_vis/index</div><div class="line">- plugins/vis_types/index</div><div class="line">- plugins/visualize/index</div></pre></td></tr></table></figure>
<h4 id="å®‰è£…Logstash"><a href="#å®‰è£…Logstash" class="headerlink" title="å®‰è£…Logstash"></a>å®‰è£…Logstash</h4><p>å®¢æˆ·ç«¯ï¼šç³»ç»Ÿcentos 6.7   ip:192.168.1.235 </p>
<h6 id="rpmå®‰è£…"><a href="#rpmå®‰è£…" class="headerlink" title="rpmå®‰è£…"></a>rpmå®‰è£…</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">#ä¸‹è½½rpmåŒ…</span></div><div class="line">wget https://download.elastic.co/logstash/logstash/packages/centos/logstash-1.5.4-1.noarch.rpm</div><div class="line"><span class="comment">#å®‰è£…</span></div><div class="line">yum localinstall logstash-1.5.4-1.noarch.rpm</div><div class="line"></div><div class="line">è¿™é‡Œä¿®æ”¹ä¸‹hostsï¼švim /etc/hosts</div><div class="line">127.0.0.1   tomcat_A1</div></pre></td></tr></table></figure>
<h6 id="æºç å®‰è£…"><a href="#æºç å®‰è£…" class="headerlink" title="æºç å®‰è£…"></a>æºç å®‰è£…</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line">æˆ‘è¿™é‡Œæºç åŒ…å®‰è£…</div><div class="line"><span class="comment"># wget https://download.elasticsearch.org/logstash/logstash/logstash-1.5.1.tar.gz</span></div><div class="line"><span class="comment">#curl -O https://download.elastic.co/logstash/logstash/logstash-1.5.4.tar.gz</span></div><div class="line"><span class="comment">#tar -zxvf logstash-1.5.1.tar.gz</span></div><div class="line"><span class="comment">#mv logstash-1.5.1 /usr/local/</span></div><div class="line"><span class="comment">#ln -s /usr/local/logstash-1.5.1/ /usr/local/logstash</span></div><div class="line"></div><div class="line">ä¸‹è½½å¯åŠ¨è„šæœ¬</div><div class="line">ç”Ÿäº§éƒ½æ˜¯è¿è¡Œåœ¨åå°çš„ï¼Œæˆ‘è¿™é‡Œæºç å®‰è£…æ²¡æœ‰initè„šæœ¬å¯åŠ¨ã€‚ å»Githubä¸‹è½½  https://github.com/benet1006/ELK_config.git</div><div class="line"><span class="comment">#cp logstash.init /etc/init.d/logstash</span></div><div class="line"><span class="comment">#chmod +x /etc/init.d/logstash</span></div><div class="line">è¿™ä¸ªè„šæœ¬æˆ‘åšè¿‡ä¿®æ”¹ã€‚</div><div class="line"></div><div class="line"><span class="comment">#å¯åŠ¨logstashæœåŠ¡</span></div><div class="line">service logstash start</div><div class="line">service logstash status</div><div class="line"></div><div class="line"><span class="comment">#æŸ¥çœ‹5000ç«¯å£</span></div><div class="line">netstat -nltp</div><div class="line"></div><div class="line">Active Internet connections (only servers)</div><div class="line">Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name</div><div class="line">tcp 0 0 0.0.0.0:9200 0.0.0.0:* LISTEN 1765/java</div><div class="line">tcp 0 0 0.0.0.0:9300 0.0.0.0:* LISTEN 1765/java</div><div class="line">tcp 0 0 0.0.0.0:9301 0.0.0.0:* LISTEN 2309/java</div><div class="line">tcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN 1509/sshd</div><div class="line">tcp 0 0 0.0.0.0:5601 0.0.0.0:* LISTEN 1876/node</div><div class="line">tcp 0 0 0.0.0.0:5000 0.0.0.0:* LISTEN 2309/java</div><div class="line">tcp 0 0 :::22 :::* LISTEN 1509/sshd</div><div class="line"></div><div class="line"></div><div class="line">ä¿®æ”¹å¯åŠ¨è„šæœ¬</div><div class="line">vim /etc/init.d/logstash </div><div class="line">æŒ‡å®šçš„ç›®å½•è‡ªå·±æºç å®‰è£…çš„è·¯å¾„ã€‚</div><div class="line"></div><div class="line">name=logstash</div><div class="line">pidfile=<span class="string">"/var/run/<span class="variable">$name</span>.pid"</span></div><div class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$JAVA_HOME</span>/jre/lib/rt.jar:<span class="variable">$JAVA_HOME</span>/lib/dt.jar:<span class="variable">$JAVA_HOME</span>/lib/tools.jar</div><div class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin</div><div class="line">LS_USER=logstash</div><div class="line">LS_GROUP=logstash</div><div class="line">LS_HOME=/usr/<span class="built_in">local</span>/logstash å®‰è£…è·¯å¾„</div><div class="line">LS_HEAP_SIZE=<span class="string">"1000m"</span></div><div class="line">LS_JAVA_OPTS=<span class="string">"-Djava.io.tmpdir=<span class="variable">$&#123;LS_HOME&#125;</span>"</span></div><div class="line">LS_LOG_DIR=/usr/<span class="built_in">local</span>/logstash</div><div class="line">LS_LOG_FILE=<span class="string">"<span class="variable">$&#123;LS_LOG_DIR&#125;</span>/<span class="variable">$name</span>.log"</span></div><div class="line">LS_CONF_FILE=/etc/logstash.conf     æ”¶é›†æ—¥å¿—çš„è§„åˆ™conf</div><div class="line">LS_OPEN_FILES=16384</div><div class="line">LS_NICE=19</div><div class="line">LS_OPTS=<span class="string">""</span></div><div class="line"></div><div class="line">https://www.elastic.co/guide/en/logstash/current/plugins-inputs-file.html</div><div class="line">è¿™ä¸ªæ˜¯<span class="built_in">log</span> stashçš„å®˜æ–¹æ–‡æ¡£çš„é…ç½®è¯´æ˜ã€‚</div><div class="line">è¿™ä¸ªé…ç½®è¯´æ˜ä¸Šé¢æˆ‘å…ˆä¿®æ”¹ä¸‹æˆ‘ä¹‹å‰çš„é…ç½®æ–‡ä»¶ã€‚</div></pre></td></tr></table></figure>
<h4 id="logstashæµ‹è¯•ï¼š"><a href="#logstashæµ‹è¯•ï¼š" class="headerlink" title="logstashæµ‹è¯•ï¼š"></a>logstashæµ‹è¯•ï¼š</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">å°†<span class="selector-tag">logstash</span><span class="selector-class">.ooxx</span><span class="selector-class">.com</span>æ¢æˆä½ è‡ªå·±çš„åŸŸåã€‚åŒæ—¶ï¼Œåˆ°åŸŸåè§£æé‚£æ·»åŠ <span class="selector-tag">elk</span><span class="selector-class">.ooxx</span><span class="selector-class">.com</span>çš„<span class="selector-tag">A</span>è®°å½•ã€‚</div><div class="line">ä½¿ç”¨é‚£ç§æ–¹å¼éƒ½è¡Œï¼Œä¸è¿‡å¦‚æœ<span class="selector-tag">logstash</span>æœåŠ¡ç«¯çš„<span class="selector-tag">IP</span>åœ°å€å˜æ¢äº†ï¼Œè¯ä¹¦ä¸å¯ç”¨äº†ã€‚</div><div class="line"></div><div class="line">è¿™é‡ŒæŸ¥çœ‹æ—¥å¿—æœ‰ä¸»æœºåè¿”å›ä¸ç„¶å°±è·Ÿä¸‹é¢ä¸€æ · <span class="selector-tag">host</span>ï¼š0<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.0</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ï¼ƒ/usr/<span class="built_in">local</span>/logstash/bin/logstash <span class="_">-e</span> <span class="string">'input &#123; stdin&#123; &#125; &#125; output &#123; stdout&#123;codec =&gt; rubydebug&#125; &#125;'</span></div></pre></td></tr></table></figure>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/elk_logstash.png" alt=""></figure></p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">é…ç½®log stashï¼å®ç°ç³»ç»Ÿæ—¥å¿—æ”¶é›†input</div><div class="line"></div><div class="line">vim <span class="meta-keyword">/etc/</span>logstash.conf  è¿™é‡Œæˆ‘ä»¬ä¹‹é—´å…ˆåˆ›å»ºä¸€ä¸ª.conf  æˆ‘ä»¬å†™åœ¨ï¼etc/ ç¼–å†™å¥½ä»¥åè®©logstashå»è°ƒç”¨ã€‚</div><div class="line"> <span class="class">input </span>&#123;</div><div class="line"> <span class="class">stdin </span>&#123; &#125;</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> <span class="class">output </span>&#123;</div><div class="line"></div><div class="line"> <span class="class">elasticsearch </span>&#123;</div><div class="line"> host =&gt; <span class="string">"192.168.1.234"</span></div><div class="line"> protocol =&gt; <span class="string">"http"</span></div><div class="line"> &#125;</div><div class="line"></div><div class="line"> <span class="class">stdout </span>&#123;</div><div class="line"> codec =&gt; rubydebug</div><div class="line"> &#125;</div><div class="line"> &#125;</div><div class="line"></div><div class="line">ç„¶ååœ¨ç”¨logstashå»è°ƒç”¨</div><div class="line"><span class="meta-keyword">/usr/</span>local<span class="meta-keyword">/logstash/</span>bin/logstash -f <span class="meta-keyword">/etc/</span>logstash.conf</div></pre></td></tr></table></figure>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/elk_logstash_01.png" alt=""></figure><br>vim /etc/logstash.conf   </p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/elk_logstash_03.png" alt=""></figure></p>
<p>å®˜æ–¹æ–‡æ¡£fileçš„é…ç½®æ–‡ä»¶å’Œç±»å‹ã€‚<br>å®˜æ–¹æ–‡æ¡£ä¸‹é¢è¿˜æœ‰ä¸ªè¿™ä¸ªä»å¤´è¯»åˆ°å°¾è¿™æ ·è§„å®šï¼Œè¿™ä¸ªéå¸¸å¥½ï¼Œè¿™é‡Œæˆ‘åœ¨åšä¿®æ”¹ã€‚</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/elk_logstash5.png" alt=""></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">ç„¶ååœ¨å¯åŠ¨<span class="built_in">log</span> stashè„šæœ¬.</div><div class="line"></div><div class="line"><span class="comment"># /etc/init.d/logstash start</span></div><div class="line"><span class="comment">## ps -ef | grep logstash</span></div><div class="line"></div><div class="line">å¯åŠ¨å®Œäº†ä»¥ååœ¨æŸ¥çœ‹ä¸‹ï¼var/<span class="built_in">log</span>/messages </div><div class="line">ç„¶ååœ¨ç™»é™†åˆ° http://192.168.1.234:9200/_plugin/head/</div></pre></td></tr></table></figure>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/elk.logstash06.png" alt=""></figure></p>
<h4 id="æ‰©å±•é˜…è¯»"><a href="#æ‰©å±•é˜…è¯»" class="headerlink" title="æ‰©å±•é˜…è¯»"></a>æ‰©å±•é˜…è¯»</h4><p><a href="http://www.chenshake.com/centos-install-7-x-elk-elasticsearchlogstashkibana/" target="_blank" rel="external">CentOS 7.xå®‰è£…ELK(Elasticsearch+Logstash+Kibana)</a></p>
<p><a href="http://blog.chinaunix.net/xmlrpc.php?r=blog/article&amp;uid=17291169&amp;id=4898582" target="_blank" rel="external">Centos 6.5 å®‰è£…nginxæ—¥å¿—åˆ†æç³»ç»Ÿ elasticsearch + logstash + redis + kibana</a></p>
<p><a href="https://www.ulyaoth.net/threads/logstash-forwarder-and-grok-examples.32413/" target="_blank" rel="external">logstash-forwarder and grok examples</a></p>
<h3 id="äº¤æµå­¦ä¹ ï¼š"><a href="#äº¤æµå­¦ä¹ ï¼š" class="headerlink" title="äº¤æµå­¦ä¹ ï¼š"></a>äº¤æµå­¦ä¹ ï¼š</h3><p>ğŸ§  Linux shell_é«˜çº§è¿ç»´æ´¾: <code>459096184</code>    åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)<br>ğŸ§  BigData-Exchange School : <code>521621407</code>  åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥</p>
<p>ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚</p>

	

	

</article>





	<span class="different-posts">ğŸ“– <a href="/page/10">more posts</a> ğŸ“–</span>



	</main>

	<footer class="footer">
	<div class="footer-content">
		
	      <div class="footer__element">
	<h5>Hi there,</h5>
	<p style="text-align:justify;">my name is Yancy, they know me as RadiantğŸ‘ğŸ‘. This blog is about Bi-data and my live.<br> I like ğŸŒ³ğŸŒ³ğŸŒ³</p>
</div>


	    
	      <div class="footer__element">
	<h5>Check out</h5>
	<ul class="footer-links">
		<li class="footer-links__link"><a href="/archives">Archive</a></li>
		
		  <li class="footer-links__link"><a href="/atom.xml">RSS</a></li>
	    
		<li class="footer-links__link"><a href="/about">about page</a></li>
		<li class="footer-links__link"><a href="/tags">Tags</a></li>
		<li class="footer-links__link"><a href="/categories">Categories</a></li>
	</ul>
</div>

	    

		<div class="footer-credit">
			<span>Â© 2017 Yancy | Powered by <a href="http://blog.yancy.cc/">Yancy</a> | Theme <a href="https://github.com/yangcvo">Yancy_GitHub</a></span>
		</div>

	</div>


</footer>



</body>

</html>
