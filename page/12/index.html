<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="theme-color" content="#33474d">
	<title>Yancy&#39;s blog</title>
	<link rel="stylesheet" href="/css/style.css" />
	
      <link rel="alternate" href="/atom.xml" title="Yancy&#39;s blog" type="application/atom+xml">
    
</head>

<body>

	<header class="header">
		<nav class="header__nav">
			
				<a href="/" class="header__link">Home</a>
			
				<a href="/tags" class="header__link">Tags</a>
			
				<a href="/archives" class="header__link">ARCHIVES</a>
			
				<a href="/about/About" class="header__link">ABOUT</a>
			
				<a href="http://weibo.com/yangcvo" class="header__link">Weibo</a>
			
				<a href="/atom.xml" class="header__link">RSS</a>
			
		</nav>
		<h1 class="header__title"><a href="/">Yancy&#39;s blog</a></h1>
		<h2 class="header__subtitle">SIMPLICITY IS PREREQUISITE FOR  RELIABILITY</h2>
	</header>

	<main>
		
	<span class="different-posts different-posts_earlier">ğŸ“– <a href="/page/11">earlier posts</a> ğŸ“–</span>




	<article>
	
		<h1><a href="/2014/10/01/æ€§èƒ½ç›‘æ§/Zabbix/zabbixçš„ICMP-Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§/">zabbixçš„ICMP_Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2014-10-01</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/monitoring/">monitoring</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Zabbix-monitoring/">Zabbix monitoring</a>
			</span>
		
	</div>

	

	
		<p>ä¸Šä¸€æ¬¡æ­å»ºäº†é‚®ä»¶å‘Šè­¦å’Œå¾®ä¿¡å‘Šè­¦ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åŠæ—¶æ¥æ”¶åˆ°å‘Šè­¦çš„ã€‚<br>è¿™é‡Œè®²zabbixé‡Œé¢ICMP-pingæ¨¡æ¿çš„å®ç°ç½‘ç»œç›‘æ§ã€‚</p>
<p>Zabbixä½¿ç”¨å¤–éƒ¨å‘½ä»¤fpingå¤„ç†ICMP pingçš„è¯·æ±‚ï¼Œfpingä¸åŒ…å«åœ¨zabbixçš„å‘è¡Œç‰ˆæœ¬ä¸­ï¼Œéœ€è¦é¢å¤–å»ä¸‹è½½å®‰è£…fpingç¨‹åºï¼Œå®‰è£…å®Œæ¯•ä¹‹åéœ€è¦åœ¨<code>zabinx_server.conf</code>ä¸­çš„å‚æ•°<code>FpingLocation</code>é…ç½®fpingå®‰è£…çš„è·¯å¾„ã€‚</p>
<p>ç”±äºfpingé»˜è®¤æ˜¯<code>root</code>æƒé™å·¥ä½œï¼Œè€Œ<code>zabbix-server</code>æ˜¯zabbixç”¨æˆ·è¿è¡Œçš„ï¼Œæ‰€ä»¥éœ€è¦å¯¹fpingç¨‹åºè®¾ç½®<code>setuid</code>æƒé™ï¼Œ<br>å¦‚æœåœ¨è‡ªå®šä¹‰keyçš„æ—¶å€™éœ€è¦ç”¨åˆ°<code>netstat</code>å‘½ä»¤ï¼Œä¹ŸåŒæ ·è¦è®¾ç½®<code>setuid</code>ï¼Œå¦åˆ™ä¸èƒ½è·å–åˆ°æ•°æ®ï¼Œè€Œåœ¨æ—¥å¿—ä¸­æç¤ºæƒæ‹’ç»ã€‚</p>
<h3 id="ä¸€ã€ç™»é™†ZabbixæœåŠ¡å™¨åšä»¥ä¸‹æ“ä½œï¼š"><a href="#ä¸€ã€ç™»é™†ZabbixæœåŠ¡å™¨åšä»¥ä¸‹æ“ä½œï¼š" class="headerlink" title="ä¸€ã€ç™»é™†ZabbixæœåŠ¡å™¨åšä»¥ä¸‹æ“ä½œï¼š"></a>ä¸€ã€ç™»é™†ZabbixæœåŠ¡å™¨åšä»¥ä¸‹æ“ä½œï¼š</h3><p>1.fpingå®‰è£…</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">wget http://www.fping.org/dist/fping-3.10.tar.gz</div><div class="line">tar zxvf fping-3.10.tar.gz</div><div class="line"><span class="built_in">cd</span> fping-3.10</div><div class="line">./configure --prefix=/usr/<span class="built_in">local</span>/fping/</div><div class="line">make &amp;&amp; make install</div></pre></td></tr></table></figure>
<p>2.ä¿®æ”¹zabbix_server.confé…ç½®æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">vim /usr/<span class="built_in">local</span>/zabbix/etc/zabbix_server.conf</div><div class="line"></div><div class="line">æŠŠFpingLocationè·¯å¾„ä¿®æ”¹ä¸ºåˆšå®‰è£…çš„fpingè·¯å¾„ã€‚</div><div class="line"></div><div class="line">FpingLocation=/usr/<span class="built_in">local</span>/fping/sbin/fping</div></pre></td></tr></table></figure>
<p>å¦‚æœä¸ä¿®æ”¹zabbix_server.confé…ç½®ä»¶éœ€è¦ä½¿ç”¨è½¯è¿æ¥åˆ°/usr/local/sbin/fpingï¼Œzabbixé»˜è®¤fpingçš„è·¯å¾„æ˜¯/usr/sbin/fping</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ln <span class="_">-s</span> /usr/sbin/fping /path/to/non-existant/fping</div><div class="line">ln <span class="_">-s</span> /usr/sbin/fping6 /path/to/non-existant/fping6</div></pre></td></tr></table></figure>
<p>3.ä¿®æ”¹fpingæƒé™ï¼ˆå¦‚æœä¸è®¾ä¸‹é¢æƒé™ï¼ŒzabbixæœåŠ¡ç«¯ä¼šé‡‡é›†ä¸åˆ°æ•°æ®ï¼‰</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># chown root:zabbix /usr/local/fping/sbin/fping</span></div><div class="line"><span class="comment"># chmod 4710 /usr/local/fping/sbin/fping</span></div></pre></td></tr></table></figure>
<p>å®‰è£…å®Œfpingï¼Œè®¾ç½®å¥½zabbix-server é…ç½®æ–‡ä»¶ï¼Œéœ€è¦é‡å¯æœåŠ¡ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">service zabbix_server restart  <span class="comment">#é‡å¯æœåŠ¡</span></div></pre></td></tr></table></figure>
<p>4.zabbixç”¨æˆ·æµ‹è¯•fpingå‘½ä»¤</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">/usr/<span class="built_in">local</span>/fping/sbin/fping www.baidu.com</div><div class="line">www.baidu.com is alive   <span class="comment"># è¯´æ˜å‘½ä»¤è¿”å›æˆåŠŸã€‚</span></div></pre></td></tr></table></figure>
<h3 id="äºŒã€ç™»é™†Zabbixç›‘æ§ç½‘é¡µåšä»¥ä¸‹è®¾ç½®"><a href="#äºŒã€ç™»é™†Zabbixç›‘æ§ç½‘é¡µåšä»¥ä¸‹è®¾ç½®" class="headerlink" title="äºŒã€ç™»é™†Zabbixç›‘æ§ç½‘é¡µåšä»¥ä¸‹è®¾ç½®"></a>äºŒã€ç™»é™†Zabbixç›‘æ§ç½‘é¡µåšä»¥ä¸‹è®¾ç½®</h3><p>æ‰“å¼€zabbix-configuration-host-creat </p>
<p>1.hostæ·»åŠ éœ€è¦ç›‘æ§çš„ipåœ°å€,è¿™é‡Œå°±ä¸ä»‹ç»äº†ã€‚</p>
<p>2.é€‰æ‹©æ¨¡ç‰ˆtemplate icmp ping</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-icmp.png" alt=""></figure></p>
<p>3.æ·»åŠ Graphs</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-icmp1.png" alt=""></figure></p>
<p>æ·»åŠ å®Œä»¥åå¯ä»¥æŸ¥çœ‹å¯¹åº”çš„æœºå™¨å›¾å½¢ï¼š</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-icmp2.png" alt=""></figure></p>
<p>å››ã€è§¦å‘å™¨æ¨¡ç‰ˆå·²è‡ªå¸¦ï¼Œè®¾ç½®æŠ¥è­¦æ–¹å¼åå°±å¯ä»¥æ¥æ”¶æŠ¥è­¦é‚®ä»¶äº†ã€‚</p>
<p>zabbix-server2.4æœåŠ¡ç«¯ç¼–è¯‘å®‰è£… <a href="http://blog.yangcvo.me/2015/01/18/zabbix-serveræœåŠ¡ç«¯ç¼–è¯‘å®‰è£…/" target="_blank" rel="external">zabbix-serveræœåŠ¡ç«¯ç¼–è¯‘å®‰è£…</a></p>
<p>zabbix2.4ç›‘æ§80ç«¯å£çŠ¶æ€ : <a href="http://blog.yangcvo.me/2016/07/20/zabbixç›‘æ§80ç«¯å£çŠ¶æ€/" target="_blank" rel="external">zabbixç›‘æ§80ç«¯å£çŠ¶æ€</a></p>
<p>zabbix+Grafanaå®‰è£…ä½¿ç”¨ç›‘æ§ç»“åˆ ï¼š<a href="http://blog.yangcvo.me/2016/07/13/zabbix-Grafanaå®‰è£…ä½¿ç”¨ç»“åˆ/" target="_blank" rel="external">zabbix+Grafanaå®‰è£…ä½¿ç”¨ç›‘æ§ç»“åˆ</a></p>
<p>zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹ : <a href="http://blog.yangcvo.me/2015/09/29/zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹/" target="_blank" rel="external">zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹</a></p>
<p>zabbixçš„ICMP_Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§ : <a href="http://blog.yangcvo.me/2015/11/18/zabbixçš„ICMP-Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§/" target="_blank" rel="external">zabbixçš„ICMP_Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§</a></p>
<p>zabbixæ€§èƒ½ç›‘æ§æ•…éšœæ€»ç»“ <a href="http://blog.yangcvo.me/2016/02/07/zabbix-æ•…éšœæ€»ç»“/" target="_blank" rel="external">zabbixæ€§èƒ½ç›‘æ§æ•…éšœæ€»ç»“</a></p>

	

	

</article>




	<article>
	
		<h1><a href="/2014/09/29/æ€§èƒ½ç›‘æ§/Zabbix/zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹/">zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2014-09-29</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/monitoring/">monitoring</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Zabbix-monitoring/">Zabbix monitoring</a>
			</span>
		
	</div>

	

	
		<h2 id="zabbixç›‘æ§MySQL"><a href="#zabbixç›‘æ§MySQL" class="headerlink" title="zabbixç›‘æ§MySQL"></a>zabbixç›‘æ§MySQL</h2><p>å‰é¢ä¸€äº›ç®€å•çš„å·²åœ¨ä¸Šä¸€ç¯‡æ–‡ç« å¤§æ¦‚è®²äº†zabbixåŸç†å’Œä½¿ç”¨å®‰è£…æ–¹æ³•ç­‰ç­‰ã€‚<br>åœ¨Zabbixçš„ç›‘æ§ç³»ç»Ÿä¸­é€šå¸¸æ˜¯ç”±Zabbix Serverä¸Zabbix Agentä¸€èµ·é…åˆå®ç°ç›‘æ§ã€‚åœ¨Zabbix Agentå†…ç½®äº†å¾ˆå¤šç›‘æ§åŸºç¡€çš„ç›‘æ§é¡¹ã€‚<a href="https://www.zabbix.com/documentation/2.0/manual/config/items/itemtypes/zabbix_agent" target="_blank" rel="external">å‚è§</a></p>
<p>è¿™äº›ç›‘æ§é¡¹éƒ½æ˜¯CPU, æ–‡ä»¶ç³»ç»Ÿ, ç½‘ç»œï¼Œç£ç›˜ç­‰åŸºç¡€çš„ç›‘æ§é¡¹ï¼Œå¯¹äºè‡ªå·±å¼€å‘æœåŠ¡çš„ç›‘æ§ï¼ŒZabbixæä¾›äº†è‰¯å¥½æ¡†æ¶ä¸ºç”¨æˆ·å®ç°ç›‘æ§å’ŒæŠ¥è­¦ï¼Œä¸‹é¢å°†ä»¥ä¸ºMySQLæ·»åŠ ç›‘æ§ä¸ºä¾‹ï¼Œä»‹ç»å¦‚ä½•æ·»åŠ è‡ªå®šä¹‰ç›‘æ§ã€‚</p>
<h3 id="å®éªŒç¯å¢ƒ"><a href="#å®éªŒç¯å¢ƒ" class="headerlink" title="å®éªŒç¯å¢ƒ"></a>å®éªŒç¯å¢ƒ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">MySQL æ˜¯åˆ†å¼€å®‰è£…çš„ ï¼š192.168.1.201</div><div class="line">zabbix server ç«¯ ï¼š192.168.1.220</div></pre></td></tr></table></figure>
<h3 id="è§’è‰²ï¼šZabbix-Agent-Zabbix-Server-MySQL-æ¨¡æ¿"><a href="#è§’è‰²ï¼šZabbix-Agent-Zabbix-Server-MySQL-æ¨¡æ¿" class="headerlink" title="è§’è‰²ï¼šZabbix Agent, Zabbix Server, MySQL, æ¨¡æ¿"></a>è§’è‰²ï¼šZabbix Agent, Zabbix Server, MySQL, æ¨¡æ¿</h3><h3 id="ç¬¬ä¸€æ­¥ï¼Œç›‘æ§è§„åˆ’"><a href="#ç¬¬ä¸€æ­¥ï¼Œç›‘æ§è§„åˆ’" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼Œç›‘æ§è§„åˆ’"></a>ç¬¬ä¸€æ­¥ï¼Œç›‘æ§è§„åˆ’</h3><p>åœ¨åˆ›å»ºç›‘æ§é¡¹ä¹‹å‰è¦å°½é‡è€ƒè™‘æ¸…æ¥šè¦ç›‘æ§ä»€ä¹ˆï¼Œæ€ä¹ˆç›‘æ§ï¼Œç›‘æ§æ•°æ®å¦‚ä½•å­˜å‚¨ï¼Œç›‘æ§æ•°æ®å¦‚ä½•å±•ç°ï¼Œå¦‚ä½•å¤„ç†æŠ¥è­¦ç­‰ã€‚è¦è¿›è¡Œç›‘æ§çš„ç³»ç»Ÿè§„åˆ’éœ€è¦å¯¹Zabbixå¾ˆäº†è§£ï¼Œè¿™é‡Œåªæ˜¯æå‡ºç›‘æ§çš„éœ€æ±‚ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">éœ€æ±‚ä¸€ï¼šç›‘æ§MySQLçš„çŠ¶æ€ï¼Œå½“çŠ¶æ€å‘ç”Ÿå¼‚å¸¸ï¼Œå‘å‡ºæŠ¥è­¦ï¼›</div><div class="line">éœ€æ±‚äºŒï¼šç›‘æ§MySQLçš„æ“ä½œï¼Œå¹¶ç”¨å›¾è¡¨å±•ç°ï¼›</div><div class="line">ç¬¬äºŒæ­¥ï¼Œä½¿ç”¨è‡ªå®šä¹‰è„šæœ¬ç›‘æ§æ‰©å±•Agentã€‚</div></pre></td></tr></table></figure>
<p>Zabbix Serverä¸Agentä¹‹é—´ç›‘æ§æ•°æ®çš„é‡‡é›†ä¸»è¦æ˜¯é€šè¿‡Zabbix Serverä¸»åŠ¨å‘Agentè¯¢é—®æŸä¸ªKeyçš„å€¼ï¼ŒAgentä¼šæ ¹æ®Keyå»è°ƒç”¨ç›¸åº”çš„å‡½æ•°å»è·å–è¿™ä¸ªå€¼å¹¶è¿”å›ç»™Serverç«¯ã€‚Zabbix 2.4.7çš„Agentæœ¬å¹¶æ²¡æœ‰å†…ç½®MySQLçš„ç›‘æ§åŠŸèƒ½ï¼ˆä½†æ˜¯Serverç«¯æä¾›äº†ç›¸åº”çš„Templateé…ç½®ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨Zabbixçš„User ParametersåŠŸèƒ½ï¼Œä¸ºMySQLæ·»åŠ ç›‘æ§è„šæœ¬ã€‚</p>
<h3 id="Trapperå·¥ä½œåŸç†"><a href="#Trapperå·¥ä½œåŸç†" class="headerlink" title="Trapperå·¥ä½œåŸç†:"></a>Trapperå·¥ä½œåŸç†:</h3><p>è¢«ç›‘æ§ä¸»æœºæ ¹æ®ç”¨æˆ·è®¾å®šçš„æ—¶é—´é—´éš”å®šæœŸå°†æ•°æ®pushåˆ°Zabbix Server.è¿™é‡Œä¸»è¦ä»‹ç»Agent.</p>
<h3 id="Agentå·¥ä½œåŸç†"><a href="#Agentå·¥ä½œåŸç†" class="headerlink" title="Agentå·¥ä½œåŸç†:"></a>Agentå·¥ä½œåŸç†:</h3><ul>
<li>Agent å®‰è£…åœ¨è¢«ç›‘æ§ä¸»æœºä¸Šï¼Œå®šæœŸä¸»åŠ¨çš„ç›‘æ§æœ¬æœºçš„èµ„æºå’Œåº”ç”¨,ç„¶åå°†æ•°æ®è¿›è¡Œå¤„ç†å‘é€ç»™ZabbixServer. Agentå·¥ä½œæ–¹å¼åˆåˆ†ä¸ºPassive Check å’Œ Active Checkã€‚</li>
<li>Passive Check: Zabbix Server å‘èµ·æ•°æ®ç´¢å–è¯·æ±‚ï¼ŒAgentå“åº”å¯¹åº”çš„æ•°æ®.</li>
<li>Active Check: Agenté¦–å…ˆä»Zabbix Server æ£€ç´¢ç›‘æ§é¡¹åˆ—è¡¨,ç„¶åå®šæœŸå°†å¯¹åº”çš„æ•°æ®ä¸»åŠ¨çš„å‘é€åˆ°.Zabbix ServerZabbix Agent æœ¬èº«é¢„å®šä¹‰äº†ä¸€äº›ç›‘æ§ç±»å‹,è€Œå¯¹äºæ²¡æœ‰é¢„å®šä¹‰çš„éœ€è¦ç®¡ç†å‘˜è‡ªè¡Œå®šä¹‰.å› æ­¤ï¼ŒZabbixæä¾›äº†â€UserParameterâ€å‚æ•°,ä»¥æ–¹ä¾¿ç”¨æˆ·æ ¹æ®è‡ªå·±çš„éœ€æ±‚è‡ªå®šä¹‰æƒ³è¦è·å–çš„æ•°æ®.</li>
</ul>
<h3 id="â€œUserParameterâ€-è¯­æ³•"><a href="#â€œUserParameterâ€-è¯­æ³•" class="headerlink" title="â€œUserParameterâ€ è¯­æ³•:"></a>â€œUserParameterâ€ è¯­æ³•:</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">UserParameter=&lt;key&gt;,&lt;<span class="built_in">command</span>&gt;</div></pre></td></tr></table></figure>
<p><key> ç”¨æˆ·è‡ªå®šä¹‰ä¸€ä¸ªkey; <command>ä¸ºå‘½ä»¤ï¼Œè¯¥å‘½ä»¤ç”¨æ¥è·å–ç”¨æˆ·æƒ³è¦ç›‘æ§çš„æ•°æ®,ä¹Ÿå°±æ˜¯keyçš„å€¼;<br>å®šå¥½UserParameterå‚æ•°åï¼Œåœ¨ä¸ºä¸»æœºæˆ–è€…æ¨¡æ¿é…ç½®ç›‘æ§é¡¹çš„æ—¶å€™ï¼Œåœ¨â€keyâ€ä¸­è¾“å…¥ä¸Šé¢è‡ªå®šä¹‰çš„keyçš„<br>åå­—å°±å¯ä»¥äº†.</key></p>
<p>å‡å¦‚æˆ‘è¦è·å–Mysql Serverçš„ç‰ˆæœ¬ï¼Œæˆ‘å¯ä»¥è¿™æ ·å®šä¹‰â€UserParameterâ€:<br>æ‰“å¼€ Zabbix Agentå®‰è£…è·¯å¾„ä¸‹çš„ ../etc/zabbix_agentd.conf é…ç½®æ–‡ä»¶ï¼Œç¿»é¡µåˆ°æœ€åé¡µé¢ï¼Œé”®å…¥å¦‚ä¸‹<br>è¡Œ:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">UserParameter=mysql.version,mysql -V</div></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘ä»¬è‡ªå®šä¹‰çš„keyåå°±æ˜¯<code>&quot;mysql.version&quot;</code>,å‘½ä»¤<code>&quot;mysql -V&quot;</code>ç”¨æ¥è·å–Mysql ç‰ˆæœ¬å·,å…¶å®å°±æ˜¯keyå¯¹<br>åº”çš„å€¼.</p>
<p>UserParameterå‚æ•°å®ç°çš„åŸç†é€šä¿—æ¥è®²ï¼Œå°±æ˜¯æˆ‘ä»¬å…ˆè¦ç†Ÿæ‚‰Mysqlå‘½ä»¤ï¼Œé€šè¿‡Mysqlçš„å‘½ä»¤è·å–æƒ³è¦çš„<br>æ•°æ®ï¼Œç„¶åèµ‹å€¼ç»™è‡ªå®šä¹‰çš„keyï¼Œæœ€åé€šè¿‡Zabbix Serverè·å–è¿™ä¸ªå€¼é€šè¿‡å›¾åƒç­‰æ–¹å¼å±•ç¤ºå‡ºæ¥.</p>
<p>ä¸‹é¢åˆ©ç”¨Agentæ¥å®ç°å¯¹mysqlæ€§èƒ½çš„ç›‘æ§ã€‚</p>
<h3 id="agentç«¯ï¼š"><a href="#agentç«¯ï¼š" class="headerlink" title="agentç«¯ï¼š"></a>agentç«¯ï¼š</h3><p>1.åˆ©ç”¨UserParameterå‚æ•°è‡ªå®šä¹‰Agent Keyã€‚<br>å¯¹äºéœ€æ±‚ä¸€ ï¼Œæˆ‘ä»¬é‡‡ç”¨mysqladminè¿™ä¸ªå·¥å…·æ¥å®ç°ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@mysql ~]<span class="comment"># mysqladmin -h 192.168.1.201 -uroot -ppassword ping</span></div><div class="line">mysqld is alive</div></pre></td></tr></table></figure>
<p>å¦‚æœMySQLçŠ¶æ€æ­£å¸¸ï¼Œä¼šæ˜¾ç¤ºmysqld is aliveï¼Œå¦åˆ™ä¼šæç¤ºè¿æ¥ä¸ä¸Šã€‚å¯¹äºæœåŠ¡å™¨ç«¯ï¼Œmysqld is aliveè¿™æ ·çš„å¥å­ä¸å¥½ç†è§£ï¼ŒæœåŠ¡å™¨ç«¯æœ€å¥½åªæ¥æ”¶1å’Œ0ï¼Œ1è¡¨ç¤ºæœåŠ¡å¯ç”¨ï¼Œ0è¡¨ç¤ºæœåŠ¡ä¸å¯ç”¨ã€‚é‚£ä¹ˆå†æ”¹è¿›ä¸€ä¸‹è¿™ä¸ªå‘½ä»¤ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@mysql ~]<span class="comment"># mysqladmin -h 192.168.1.201 -uroot -ppassword ping |  grep -c alive</span></div><div class="line">1</div></pre></td></tr></table></figure>
<p>ç”¨æˆ·åå’Œå¯†ç æ”¾åœ¨å‘½ä»¤ä¸­å¯¹äºä»¥åçš„ç»´æŠ¤ä¸å¥½ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨/var/lib/zabbix/ä¸‹åˆ›å»ºä¸€ä¸ªåŒ…å«MySQLç”¨æˆ·åå’Œå¯†ç çš„é…ç½®æ–‡ä»¶â€œ.my.cnfâ€ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[client]</div><div class="line">user=root</div><div class="line">host=192.168.1.201</div><div class="line">password=xxxx</div></pre></td></tr></table></figure>
<p>æœ‰äº†è¿™ä¸ªæ–‡ä»¶åçš„å‘½ä»¤å˜æ›´ä¸º</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">HOME=/etc mysqladmin ping | grep -c alive</div><div class="line">[root@mysql ~]<span class="comment">#   HOME=/var/lib/zabbix/ mysqladmin ping | grep -c alive</span></div><div class="line">1</div></pre></td></tr></table></figure>
<p>åšå®Œè¿™ä¸€æ­¥åéœ€è¦åšçš„å°±æ˜¯ï¼Œå°†è¿™ä¸ªç›‘æ§å‘½ä»¤æ·»åŠ åˆ°Zabbix Agentä¸­ï¼Œå¹¶ä¸ä¸€ä¸ªKeyå¯¹åº”ï¼Œè¿™æ ·Zabbox Serverå°±èƒ½é€šè¿‡è¿™ä¸ªKeyè·å–MySQLçš„çŠ¶æ€äº†ã€‚æˆ‘ä»¬ä½¿ç”¨mysql.pingä½œä¸ºMySQLçŠ¶æ€çš„Keyã€‚</p>
<p>é¦–å…ˆåœ¨å»é™¤/etc/zabbix/zabbix_agentd.confä¸­</p>
<p>â€œInclude=/etc/zabbix_agentd.conf.d/â€è¿™ä¸€è¡Œçš„æ³¨é‡Šç¬¦ã€‚</p>
<p>å…¶æ¬¡ï¼Œåœ¨etc/zabbix/zabbix_agentd.conf.d/ç›®å½•ä¸‹åˆ›å»ºuserparameter_mysql.confæ–‡ä»¶ã€‚åœ¨æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹å‘½ä»¤ï¼š</p>
<pre><code>UserParameter=mysql.ping,HOME=/var/lib/zabbix mysqladmin ping | grep -c alive
</code></pre><p>è¿™ä¸ªå‘½ä»¤ä¸­â€UserParameterâ€è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªç”¨æˆ·è‡ªå®šä¹‰çš„è„šæœ¬ï¼›â€œ=â€å·åæ˜¯è„šæœ¬çš„å†…å®¹ï¼›â€œmysql.pingâ€æ˜¯Keyï¼Œâ€œï¼Œâ€å·åçš„å‘½ä»¤ä¼šåœ¨Zabbix Serverå‘Agentå‘èµ·è·å–â€œmysql.pingâ€è¿™ä¸ªkeyçš„è¯·æ±‚æ—¶è¢«è°ƒç”¨ï¼Œå¹¶å°†è¿”å›å€¼è¿”å›ç»™Serverã€‚<br>ä¿å­˜å¹¶é€€å‡ºåå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æµ‹è¯•æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚</p>
<pre><code>[root@mysql ~]# /usr/sbin/zabbix_agentd -t mysql.ping
  mysql.ping                                    [t|1]
</code></pre><p>è¿™é‡Œzabbix_agentdä½¿ç”¨æ–¹æ³•å¯å‚è€ƒï¼š</p>
<pre><code>http://www.ttlsa.com/zabbix/zabbix-command-zabbix_agentd/
</code></pre><p>åŒæ—¶ï¼Œåœ¨Serverç«¯ä¹Ÿå¯ä»¥ä½¿ç”¨ä½¿ç”¨zabbix_getå‘½ä»¤æ¥æµ‹è¯•ä»Serverç«¯è·å–æŒ‡å®šçš„Clientç«¯çš„æ•°æ®ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ zabbix_get <span class="_">-s</span> 192.168.1.201 -p 10050 -k mysql.ping</div><div class="line">1</div></pre></td></tr></table></figure>
<p>è¿™é‡Œå¦‚æœæ˜¯è·Ÿæˆ‘ä¸€å¼€å§‹æœ‰é”™è¯¯çš„ã€‚<a href="https://www.zabbix.com/documentation/3.0/manual/config/items/userparameters/extending_agent" target="_blank" rel="external">zabbix</a></p>
<p>å¯èƒ½è·Ÿä½ å®‰è£…ç‰ˆæœ¬ä¸ç»Ÿä¸€æœ‰é—®é¢˜ã€‚</p>
<p>è¿™é‡Œzabbix_getä½¿ç”¨æ–¹æ³•å¯å‚è€ƒ: <a href="http://www.ttlsa.com/zabbix/zabbix-zabbix_get-get-items/" target="_blank" rel="external">zabbix_agent</a></p>
<p>æˆ‘è¿™é‡Œå‚è€ƒå®˜ç½‘æ–¹æ³•ï¼š</p>
<pre><code>https://www.zabbix.com/documentation/3.0/manual/config/items/userparameters/extending_agent
</code></pre><p>æˆ‘åœ¨æˆ‘è¿™é‡ŒæŸ¥çœ‹MySQLçŠ¶æ€zabbix_agentd.conf:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">UserParameter=mysql.questions,mysqladmin -uroot status | cut <span class="_">-f</span>4 <span class="_">-d</span><span class="string">":"</span> | cut <span class="_">-f</span>1 <span class="_">-d</span><span class="string">"S"</span></div></pre></td></tr></table></figure>
<h3 id="MySQLæœºå™¨ä¸Šé¢æŸ¥çœ‹æ˜¯æœ‰æ•°æ®çš„ï¼š"><a href="#MySQLæœºå™¨ä¸Šé¢æŸ¥çœ‹æ˜¯æœ‰æ•°æ®çš„ï¼š" class="headerlink" title="MySQLæœºå™¨ä¸Šé¢æŸ¥çœ‹æ˜¯æœ‰æ•°æ®çš„ï¼š"></a>MySQLæœºå™¨ä¸Šé¢æŸ¥çœ‹æ˜¯æœ‰æ•°æ®çš„ï¼š</h3><pre><code>[root@mysql scripts]# zabbix_agentd -t mysql.questions
 mysql.questions                               [t| 22273707]
</code></pre><h3 id="zabbix-serverç«¯ï¼š"><a href="#zabbix-serverç«¯ï¼š" class="headerlink" title="zabbix serverç«¯ï¼š"></a>zabbix serverç«¯ï¼š</h3><pre><code>[root@LAN_zabbix ~]# /usr/local/zabbix/bin/zabbix_get -s 192.168.1.201 -p10050 -k &apos;mysql.questions&apos;
ZBX_NOTSUPPORTED: Unsupported item key.
</code></pre><p>æç¤ºZBX_NOTSUPPORTED: Unsupported item key.</p>
<p>å¦‚æœç›´æ¥æŸ¥çœ‹å®šä¹‰çš„ç³»ç»Ÿcpu</p>
<pre><code>[root@LAN_zabbix ~]# /usr/local/zabbix/bin/zabbix_get -s 192.168.1.201 -p   10050 -k system.cpu.load[all,avg1]
0.350000
</code></pre><p>è¿™æ ·æ˜¯æœ‰æ•°æ®çš„ã€‚</p>
<p>æ‰€ä»¥å¯ä»¥åˆ¤æ–­ä¸Šé¢é‚£ä¸ªæç¤ºZBX_NOTSUPPORTED: Unsupported item key.</p>
<h3 id="æœåŠ¡ç«¯æµ‹è¯•å¯èƒ½æŠ¥å„ç±»é”™è¯¯ï¼š"><a href="#æœåŠ¡ç«¯æµ‹è¯•å¯èƒ½æŠ¥å„ç±»é”™è¯¯ï¼š" class="headerlink" title="æœåŠ¡ç«¯æµ‹è¯•å¯èƒ½æŠ¥å„ç±»é”™è¯¯ï¼š"></a>æœåŠ¡ç«¯æµ‹è¯•å¯èƒ½æŠ¥å„ç±»é”™è¯¯ï¼š</h3><ol>
<li>ZBX_NOTSUPPORTED: Unsupported item key</li>
</ol>
<p>ç¡®è®¤keyåå­—é…å¯¹äº†ï¼Œå¹¶ä¸”å®¢æˆ·ç«¯è¦é‡å¯</p>
<p>2.[root@zabbix zabbix]# zabbix_get -s 192.168.9.251 -k mysql.Innodb_log_buffer_size<br>sh: mysql: command not found<br>åŠ å…¨è·¯å¾„ï¼š/mysql/bin/mysql</p>
<p>æˆ‘è¯•ç€ä¿®æ”¹äº†/etc/zabbix/zabbix_agentd.d/userparameter_mysql.conf è¿™ä¸ªæ–‡ä»¶é‡Œâ€HOME=/var/lib/zabbix mysql -Nâ€ï¼ŒæŠŠmysqlçš„è·¯å¾„è¡¥å…¨ï¼Œå³æ”¹ä¸ºHOME=/etc/zabbix /usr/bin/mysql -Nã€‚æˆ‘æ˜¯æ”¹äº†è¿™ä¸ªå°±å¯ä»¥äº†</p>
<pre><code>serverç«¯ï¼š /usr/local/zabbix/bin/zabbix_get -s 192.168.1.201  /usr/bin/mysqladmin -k  mysql.questions
sh: mysqladmin: æœªæ‰¾åˆ°å‘½ä»¤
</code></pre><p>åŠ äº†ç»å¯¹è·¯å¾„ï¼Œæˆ‘å‡ ä¹è¦ç»æœ›äº†ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆå‘,åæ¥æˆ‘çœ‹äº†ä¸‹ï¼Œæ˜¯æˆ‘seLinuxæ²¡æœ‰å…³é—­ã€‚å…³é—­å°±å¯ä»¥äº†ã€‚</p>
<ul>
<li>æˆ‘å‚è€ƒè¿™ç¯‡æ–‡ç« æ“ä½œçš„ï¼š<a href="http://canghai.coding.io/2015/07/29/monitoring-mysql-with-zabbix/" target="_blank" rel="external">monitoring-mysql-with-zabbix</a></li>
</ul>
<p>å¦‚æœæœ‰ä¸€ä¸‹å›æ˜¾ï¼Œè¡¨ç¤ºå·¥ä½œæ­£å¸¸</p>
<pre><code>[root@zabbix ~]#  /usr/local/bin/zabbix_get -s 192.168.1.201 -k   mysql.status[GlobalStatus,Uptime]
 12364726
</code></pre><p>ç„¶åä¸‹è½½å®‰è£…MySQLç›‘æ§çš„æ¨¡æ¿åœ¨æˆ‘githubä¸Šé¢ï¼š</p>
<p>å¯¼å…¥æ¨¡ç‰ˆï¼š<a href="https://github.com/yangcvo/zabbix.2.4/" target="_blank" rel="external">MySQLç›‘æ§çš„æ¨¡æ¿</a></p>
<p>å¹¶å…³è”åˆ°ä¸»æœº</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-monitoring.jpg" alt=""></figure></p>
<p>PSï¼šå¯è‡ªè¡Œæ·»åŠ å¯¹åº”keyå¯ç›‘æ§é¡¹ç›®ï¼Œæ¨¡ç‰ˆè‡ªå¸¦äº†å‡ ç§ï¼Œè„šæœ¬åŒ…æ‹¬800å¤šé¡¹ç›®ï¼Œ<br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-mintor.jpg" alt=""></figure><br>ç„¶ååœ¨æ·»åŠ å„è‡ªé¡¹ç›®çš„å›¾è¡Œï¼š</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-moin1.jpg" alt=""></figure></p>
<p>zabbixç›‘æ§mysqlæ€§èƒ½<br>é€šè¿‡è·å–mysqlçŠ¶æ€å€¼å°†è¿™äº›çŠ¶æ€å€¼ä¼ é€’ç»™æœåŠ¡å™¨å¹¶ç»˜åˆ¶æˆå›¾ç‰‡ï¼Œè¿™æ ·å¯ä»¥è§‚å¯Ÿmysqlçš„å·¥ä½œæƒ…å†µï¼Œé€šå¸¸éœ€è¦è·å¾—çŠ¶æ€å˜é‡æœ‰ä»¥ä¸‹</p>
<pre><code>Com_updateï¼šmysqlæ‰§è¡Œçš„æ›´æ–°ä¸ªæ•°
Com_selectï¼šmysqlæ‰§è¡Œçš„æŸ¥è¯¢ä¸ªæ•°
Com_insertï¼šmysqlæ‰§è¡Œæ’å…¥çš„ä¸ªæ•°
Com_deleteï¼šæ‰§è¡Œåˆ é™¤çš„ä¸ªæ•°
Com_rollbackï¼šæ‰§è¡Œå›æ»šçš„æ“ä½œä¸ªæ•°
Bytes_received:æ¥å—çš„å­—èŠ‚æ•°
Bytes_sentï¼šå‘é€çš„å­—èŠ‚æ•°
Slow_queriesï¼šæ…¢æŸ¥è¯¢è¯­å¥çš„ä¸ªæ•°
</code></pre><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-mion2.png" alt=""></figure></p>
<p>æŸ¥çœ‹å›¾åƒéƒ½æ˜¯æœ‰æ•°æ®ï¼š<br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-mion3.png" alt=""></figure></p>
<p>   2)æˆ‘è¿™é‡Œæ˜¯æµ‹è¯•ç¯å¢ƒç”¨rootè´¦å·ï¼Œçº¿ä¸ŠæœåŠ¡å™¨å®‰å…¨æœŸé—´å¯ä»¥ç»™mysqlç”¨æˆ·æˆæƒreadonlyæƒé™ã€‚</p>
<p>   3)æ ¹æ®å®é™…çš„éœ€æ±‚ï¼Œé™¤äº†ç›‘æ§ä¸Šè¿°ç›‘æ§é¡¹ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ç›‘æ§mysql processlist,Innodbç­‰ã€‚</p>

	

	

</article>




	<article>
	
		<h1><a href="/2014/09/13/è¿ç»´å®‰å…¨/httpdè¿›ç¨‹éå¸¸å¤šï¼ŒæŸ¥æ‰¾è¢«æ”»å‡»çš„åŸå› /">httpdè¿›ç¨‹éå¸¸å¤šï¼ŒæŸ¥æ‰¾è¢«æ”»å‡»çš„åŸå› </a></h1>
	
	<div class="article__infos">
		<span class="article__date">2014-09-13</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/è¿ç»´å®‰å…¨/">è¿ç»´å®‰å…¨</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Operation-safety/">Operation safety</a>
			</span>
		
	</div>

	

	
		<p>å‰ä¸¤å¤©ï¼Œå…¬å¸æ‰˜ç®¡åœ¨ç”µä¿¡æœºæˆ¿çš„vpsæœåŠ¡å™¨çªç„¶ç½‘ç»œä¸­æ–­ï¼Œè¿è¥å•†é‚£è¾¹è¯´æˆ‘ä»¬çš„æœåŠ¡å™¨ä¸æ–­å¾€å¤–å‘åŒ…ï¼Œä¸¥é‡å½±å“åˆ°æœºæˆ¿çš„ç½‘ç»œï¼Œæ‰€ä»¥æŠŠè¯¥æœºå™¨çš„ç«¯å£å°äº†ï¼Œæ— æ¯”è›‹ç–¼å•Šï¼Œæ— å¥ˆä¸‹åªèƒ½äº²è‡ªè·‘åˆ°æœºæˆ¿è§£å†³é—®é¢˜ã€‚<br>å»åˆ°æœºæˆ¿ï¼Œä½¿ç”¨topå‘½ä»¤æŸ¥çœ‹åå‘ç°httpdè¿›ç¨‹å±…ç„¶å åˆ°90%å¤šçš„CPUã€‚</p>
<pre><code>ps -aux |grep httpd |wc -l
</code></pre><p>   å‘ç°æœ‰300å¤šä¸ªhttpdè¿›ç¨‹åº”è¯¥æ˜¯å—åˆ°SYN Floodæ”»å‡»è¿™æ—¶å€™æ²¡æœ‰ç›´æ¥æ€æ‰è¿›ç¨‹ï¼Œè¦æ‰¾å‡ºæ˜¯å“ªä¸ªç½‘ç«™å—æ”»å‡»ã€‚</p>
<pre><code>top |grep httpd
</code></pre><p>   é€‰å–è¿›ç¨‹ä¸­å ç”¨CPU%å¤šçš„ï¼Œç”¨lsof -p pid æ¥æŸ¥çœ‹ï¼Œå¦‚æœæœ‰å‡ ä¸ªhttpdè¿›ç¨‹éƒ½æ˜¾ç¤ºåŒä¸€ä¸ªç½‘ç«™ï¼Œåˆ™åŸºæœ¬ä¸Šå¯ä»¥åˆ¤å®šè¯¥ç½‘ç«™å°±æ˜¯é—®é¢˜ç½‘ç«™</p>
<pre><code>lsof -p &lt;pid&gt; 
</code></pre><p>æ‰¾åˆ°é—®é¢˜ç½‘ç«™ååœæ‰è¯¥ç½‘ç«™vps</p>
<pre><code>killall -9 httpd ,service httpd start å¼ºåˆ¶æ€æ‰httpè¿›ç¨‹ï¼Œå†é‡æ–°å¯åŠ¨ã€‚
</code></pre><p>ä»¥ä¸‹æ˜¯åœ¨ç½‘ä¸Šæ‰¾çš„é¢„é˜²SYN floodçš„åŠæ³•linuxä¸‹é˜²æ­¢SYN Floodæ”»å‡»ï¼Œèƒ½å¤Ÿæœ‰æ•ˆé˜²èŒƒSYN Floodæ”»å‡»çš„æ‰‹æ®µä¹‹ä¸€ï¼Œå°±æ˜¯SYN Cookie</p>
<p>Linuxä¸‹è®¾ç½®<br>å¦‚æœä½ çš„æœåŠ¡å™¨é…ç½®ä¸å¤ªå¥½ï¼ŒTCP TIME_WAITå¥—æ¥å­—æ•°é‡è¾¾åˆ°ä¸¤ã€ä¸‰ä¸‡ï¼ŒæœåŠ¡å™¨å¾ˆå®¹æ˜“è¢«æ‹–æ­»ã€‚é€šè¿‡ä¿®æ”¹Linuxå†…æ ¸å‚æ•°ï¼Œå¯ä»¥å‡å°‘æœåŠ¡å™¨çš„TIME_WAITå¥—æ¥å­—æ•°é‡ã€‚</p>
<p>TIME_WAITå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ï¼š</p>
<p>ä»¥ä¸‹æ˜¯ä»£ç ç‰‡æ®µï¼š</p>
<pre><code>netstat -an | grep &quot;TIME_WAIT&quot; | wc -l
</code></pre><p>åœ¨Linuxä¸‹ï¼Œå¦‚CentOSï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹/etc/sysctl.confæ–‡ä»¶æ¥è¾¾åˆ°ç›®çš„å¢åŠ ä»¥ä¸‹å‡ è¡Œï¼š</p>
<p>ä»¥ä¸‹æ˜¯ä»£ç ç‰‡æ®µï¼š</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">net<span class="selector-class">.ipv4</span><span class="selector-class">.tcp_fin_timeout</span> = <span class="number">30</span></div><div class="line">net<span class="selector-class">.ipv4</span><span class="selector-class">.tcp_keepalive_time</span> = <span class="number">1200</span></div><div class="line">net<span class="selector-class">.ipv4</span><span class="selector-class">.tcp_syncookies</span> = <span class="number">1</span></div><div class="line">net<span class="selector-class">.ipv4</span><span class="selector-class">.tcp_tw_reuse</span> = <span class="number">1</span></div><div class="line">net<span class="selector-class">.ipv4</span><span class="selector-class">.tcp_tw_recycle</span> = <span class="number">1</span></div><div class="line">net<span class="selector-class">.ipv4</span><span class="selector-class">.ip_local_port_range</span> = <span class="number">1024</span>    <span class="number">65000</span></div><div class="line">net<span class="selector-class">.ipv4</span><span class="selector-class">.tcp_max_syn_backlog</span> = <span class="number">8192</span></div><div class="line">net<span class="selector-class">.ipv4</span><span class="selector-class">.tcp_max_tw_buckets</span> = <span class="number">5000</span></div><div class="line">net<span class="selector-class">.ipv4</span><span class="selector-class">.tcp_synack_retries</span> = <span class="number">2</span></div><div class="line">net<span class="selector-class">.ipv4</span><span class="selector-class">.tcp_syn_retries</span> = <span class="number">2</span></div></pre></td></tr></table></figure>
<p>è¯´æ˜ï¼š</p>
<p><code>net.ipv4.tcp_syncookies = 1</code>è¡¨ç¤ºå¼€å¯SYN Cookiesï¼Œè¿™æ˜¯ä¸ªBOOLEANã€‚å½“å‡ºç°SYNç­‰å¾…é˜Ÿåˆ—æº¢å‡ºæ—¶ï¼Œå¯ç”¨cookiesæ¥å¤„ç†ï¼Œå¯é˜²èŒƒå°‘é‡SYNæ”»å‡»ï¼Œé»˜è®¤ä¸º0ï¼Œè¡¨ç¤ºå…³é—­ï¼›<br><code>net.ipv4.tcp_tw_reuse = 1</code> è¡¨ç¤ºå¼€å¯é‡ç”¨,è¿™æ˜¯ä¸ªBOOLEANã€‚å…è®¸å°†TIME-WAIT socketsé‡æ–°ç”¨äºæ–°çš„TCPè¿æ¥ï¼Œé»˜è®¤ä¸º0ï¼Œè¡¨ç¤ºå…³é—­ï¼›<br><code>net.ipv4.tcp_tw_recycle = 1</code>è¡¨ç¤ºå¼€å¯TCPè¿æ¥ä¸­TIME-WAIT socketsçš„å¿«é€Ÿå›æ”¶,è¿™æ˜¯ä¸ªBOOLEANï¼Œé»˜è®¤ä¸º0ï¼Œè¡¨ç¤ºå…³é—­ã€‚<br><code>net.ipv4.tcp_fin_timeout = 30</code> è¡¨ç¤ºå¦‚æœå¥—æ¥å­—ç”±æœ¬ç«¯è¦æ±‚å…³é—­ï¼Œè¿™ä¸ªå‚æ•°å†³å®šäº†å®ƒä¿æŒåœ¨FIN-WAIT-2çŠ¶æ€çš„æ—¶é—´ã€‚å•ä½ä¸ºç§’ã€‚<br><code>net.ipv4.tcp_keepalive_time = 1200</code>è¡¨ç¤ºå½“keepaliveèµ·ç”¨çš„æ—¶å€™ï¼ŒTCPå‘é€keepaliveæ¶ˆæ¯çš„é¢‘åº¦ã€‚ç¼ºçœæ˜¯2å°æ—¶ï¼Œæ”¹ä¸º20åˆ†é’Ÿã€‚å•ä½ä¸ºç§’ã€‚<br><code>net.ipv4.ip_local_port_range = 1024</code>   65000 è¡¨ç¤ºç”¨äºå‘å¤–è¿æ¥çš„ç«¯å£èŒƒå›´ã€‚ç¼ºçœæƒ…å†µä¸‹å¾ˆå°ï¼š32768åˆ°61000ï¼Œæ”¹ä¸º1024åˆ°65000ã€‚<br><code>net.ipv4.tcp_max_syn_backlog = 8192</code>è¡¨ç¤ºSYNé˜Ÿåˆ—çš„é•¿åº¦ï¼Œé»˜è®¤ä¸º1024ï¼ŒåŠ å¤§é˜Ÿåˆ—é•¿åº¦ä¸º8192ï¼Œå¯ä»¥å®¹çº³æ›´å¤šç­‰å¾…è¿æ¥çš„ç½‘ç»œè¿æ¥æ•°ã€‚<br><code>net.ipv4.tcp_max_tw_buckets = 5000</code> è¡¨ç¤ºç³»ç»ŸåŒæ—¶ä¿æŒTIME_WAITå¥—æ¥å­—çš„æœ€å¤§æ•°é‡ï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªæ•°å­—ï¼ŒTIME_WAITå¥—æ¥å­—å°†ç«‹åˆ»è¢«æ¸…é™¤å¹¶æ‰“å°è­¦å‘Šä¿¡æ¯ã€‚é»˜è®¤ä¸º180000ï¼Œæ”¹ä¸º5000ã€‚å¯¹äºApacheã€Nginxç­‰æœåŠ¡å™¨ï¼Œä¸Šå‡ è¡Œçš„å‚æ•°å¯ä»¥å¾ˆå¥½åœ°å‡å°‘TIME_WAITå¥—æ¥å­—æ•°é‡ï¼Œä½†æ˜¯å¯¹äºSquidï¼Œæ•ˆæœå´ä¸å¤§ã€‚æ­¤é¡¹å‚æ•°å¯ä»¥æ§åˆ¶TIME_WAITå¥—æ¥å­—çš„æœ€å¤§æ•°é‡ï¼Œé¿å…SquidæœåŠ¡å™¨è¢«å¤§é‡çš„TIME_WAITå¥—æ¥å­—æ‹–æ­»ã€‚<br><code>net.ipv4.tcp_synack_retries</code>å’Œ<code>net.ipv4.tcp_syn_retries</code>æ˜¯å®šä¹‰SYNé‡è¯•æ¬¡æ•°ã€‚</p>
<p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä½¿é…ç½®ç”Ÿæ•ˆï¼š</p>
<p>ä»¥ä¸‹æ˜¯ä»£ç ç‰‡æ®µï¼š<br><code>/sbin/sysctl -p</code></p>
<p>å¦‚æœä½ ä¸æƒ³ä¿®æ”¹/etc/sysctl.confï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨å‘½ä»¤ä¿®æ”¹:</p>
<p>ä»¥ä¸‹æ˜¯ä»£ç ç‰‡æ®µï¼š</p>
<p><code>/sbin/sysctl -w key=value</code></p>
<h4 id="æ‰¾æ¼æ´ï¼š"><a href="#æ‰¾æ¼æ´ï¼š" class="headerlink" title="æ‰¾æ¼æ´ï¼š"></a>æ‰¾æ¼æ´ï¼š</h4><p>é‡æ–°å®¡è§†äº†Mç«™ç›®å½•ä¸‹æ–‡ä»¶æƒé™ã€‚ä»…å¯¹å‡ ä¸ªå¿…è¦çš„ç¼“å­˜ã€é™æ€åŒ–çš„ç›®å½•ä¸ºapacheå¼€å¯äº†å†™æƒé™ï¼Œé˜²æ­¢<code>phzLtoxn.php</code>æ–‡ä»¶å†æ¬¡ç”Ÿæˆã€‚</p>
<p>é‡æ–°å¼€å¯httpdæœåŠ¡ï¼Œä½¿ç”¨360ç½‘ç«™æ£€æµ‹å¯¹Hç«™è¿›è¡Œæ¼æ´æ£€æµ‹ï¼Œå‘ç°Mç«™ä¸­æœ‰ä¸¥é‡çš„è¿œç¨‹æ‰§è¡Œæ¼æ´ï¼Œäºæ˜¯èµ¶ç´§æ‰“äº†è¡¥ä¸ã€‚</p>
<p>è¡¥ä¸æ‰“å¥½ä¹‹åï¼Œé¡ºä¾¿ä¿®æ”¹äº†ç³»ç»Ÿç”¨æˆ·ã€æ•°æ®åº“ç”¨æˆ·ã€ftpç”¨æˆ·çš„å¯†ç ã€Mç«™ç³»ç»Ÿç”¨æˆ·å¯†ç ã€‚<br>è§‚å¯Ÿå‡ æ—¥ä¹‹åï¼Œä¸€åˆ‡æ­£å¸¸ã€‚</p>

	

	

</article>




	<article>
	
		<h1><a href="/2014/04/19/æ€§èƒ½ç›‘æ§/Somekeping/ç”¨æœ€ç®€å•æ˜“æ‡‚çš„æ–¹å¼å®‰è£…smokeping/">ç”¨æœ€ç®€å•çš„æ–¹å¼å®‰è£…smokeping</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2014-04-19</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/monitoring/">monitoring</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/IDCç›‘æ§/">IDCç›‘æ§</a> <a class="article__tag-link" href="/tags/Performance-monitoring/">Performance monitoring</a> <a class="article__tag-link" href="/tags/Smokeping/">Smokeping</a>
			</span>
		
	</div>

	

	
		<p>smokepingè¿™ä¸ªç›‘æ§è¿˜æ˜¯å¾ˆå¼ºå¤§çš„ï¼Œç”¨è¿™ä¸ªç›‘æ§æ˜¯åœ¨ç¬¬ä¸€å®¶å…¬å¸åšIDCèµ·å®¶åé¢è½¬å‹CDNäº‘è®¡ç®—äº‘åŠ é€Ÿã€‚<br>è¿™ä¸ªä¹Ÿæ˜¯æˆ‘å­¦çš„æœ€æ—©çš„ä¸€æ¬¾ç›‘æ§ï¼Œåœ¨è¿™é‡Œæˆ‘ç”¨ç¼–è¯‘å®‰è£…æ–¹å¼ã€‚ä¹Ÿæœ‰è„šæœ¬å®‰è£…ä¸è¿‡éœ€è¦äº†è§£è¿‡somkepingå®‰è£…è¿‡ç¨‹ä¼šæ¯”è¾ƒçœ‹çš„æ‡‚è„šæœ¬ã€‚</p>
<p>é€‚ç”¨äºå®½å¸¦è¿è¥å•†ç»´æŠ¤å’ŒIDCæœºæˆ¿ç»´æŠ¤å¯ä»¥æ£€æµ‹æœ¬åœ°ç½‘ç»œçš„åˆ°ä¸Šçº§è¿è¥å•†å‡ºå£è¿™æ®µè·¯ç”±å„ä¸ªèŠ‚ç‚¹çš„ç¨³å®šæ€§            å¯ä»¥æ£€æµ‹æœ¬åœ°ç½‘ç»œåˆ°å„ä¸»è¦é—¨æˆ·ç½‘ç«™çš„<code>å»¶æ—¶ï¼Œä¸¢åŒ…ç‡ï¼Œç¨³å®šæ€§</code><br>å¯ä»¥æ£€æµ‹æœ¬åœ°ç½‘ç»œåˆ°å„åœ°æ¸¸æˆæœåŠ¡å™¨çš„<code>å»¶æ—¶ï¼Œä¸¢åŒ…ç‡ï¼Œç¨³å®šæ€§</code></p>
<p>smokepingç¼ºç‚¹ï¼šä¸èƒ½åœ¨å‰å°Webé¡µé¢æ·»åŠ è¦æ£€æµ‹çš„èŠ‚ç‚¹ï¼Œå¿…é¡»åœ¨åå°smokepingçš„é…ç½®æ–‡ä»¶ä¸­æ·»åŠ  </p>
<h3 id="å®‰è£…å‰çš„å‡†å¤‡ï¼š"><a href="#å®‰è£…å‰çš„å‡†å¤‡ï¼š" class="headerlink" title="å®‰è£…å‰çš„å‡†å¤‡ï¼š"></a>å®‰è£…å‰çš„å‡†å¤‡ï¼š</h3><ol>
<li>æ“ä½œç³»ç»Ÿï¼šé€‰æ‹©centOS6.5æœ€å°åŒ–ç‰ˆï¼Œ é‡Œé¢çš„RPMåŒ…åŸºæœ¬ä¸Šéƒ½æ˜¯æœ€æ–°çš„ã€‚   </li>
<li>æ³¨1: centOS 5.6ç‰ˆæœ¬åœ¨å®‰è£…rpmforge-release-0.5.3-1.el6.rf.x86_64.rpmåŒ…æ˜¯ä¼šé‡åˆ°ä¾èµ–æ€§é—®é¢˜ï¼Œè¦æ±‚å®‰è£…rpmlibåŒ…ï¼Œä½†centOS5.6ç‰ˆæœ¬ä¸­çš„rpmlibç‰ˆæœ¬è¾ƒä½ï¼Œæ— æ³•ç›´æ¥å®‰è£…   </li>
<li>æ³¨2ï¼šåœ¨å®‰è£…centOS6.5æ—¶ï¼Œè¦æ³¨æ„è®¾ç½®ç³»ç»Ÿçš„IPåœ°å€ï¼Œå¦‚ä¸‹å›¾,ç‚¹å‡»ã€configure networkã€‘æŒ‰é’®ï¼Œé€‰æ‹©ã€system eth0ã€‘, ç‚¹å‡» ã€IPv4Setingã€‘,è®¾ç½®IPåœ°å€    </li>
<li>æ³¨3: é€‰æ‹©å®‰è£…åŒ…æ—¶ï¼Œç‚¹é€‰ã€Basic Serverã€‘, è¦å®‰è£…621ä¸ªåŸºæœ¬åŒ… æ³¨4: å…¶ä»–å®‰è£…æ­¥éª¤ï¼ŒæŒ‰ç…§æ­£å¸¸çš„å®‰è£…æµç¨‹æ“ä½œå³å¯ </li>
</ol>
<h3 id="äºŒ-å®‰è£…è¿‡ç¨‹"><a href="#äºŒ-å®‰è£…è¿‡ç¨‹" class="headerlink" title="äºŒ. å®‰è£…è¿‡ç¨‹"></a>äºŒ. å®‰è£…è¿‡ç¨‹</h3><p>ä¿®æ”¹æ—¶åŒº</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">\cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</div></pre></td></tr></table></figure>
<p>åŒæ­¥æ—¶é—´</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ntpdate time.nist.gov</div></pre></td></tr></table></figure>
<p>å†™å…¥BIOS</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hwclock -w</div></pre></td></tr></table></figure>
<p>å…³é—­é˜²ç«å¢™</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">service iptables stop</div></pre></td></tr></table></figure>
<h3 id="1-å®‰è£…ç¬¬ä¸‰æ–¹è½¯ä»¶æº"><a href="#1-å®‰è£…ç¬¬ä¸‰æ–¹è½¯ä»¶æº" class="headerlink" title="1. å®‰è£…ç¬¬ä¸‰æ–¹è½¯ä»¶æº"></a>1. å®‰è£…ç¬¬ä¸‰æ–¹è½¯ä»¶æº</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">64ä½ç³»ç»Ÿ </div><div class="line">rpm  -Uvh http://apt.sw.be/redhat/el6/en/x86_64/rpmforge/RPMS/rpmforge-release-0.5.3-1.el6.rf.x86_64.rpm</div><div class="line">32ä½ç³»ç»Ÿ</div><div class="line">rpm  -Uvh http://apt.sw.be/redhat/el6/en/i386/rpmforge/RPMS/rpmforge-release-0.5.3-1.el6.rf.i686.rpm</div></pre></td></tr></table></figure>
<p>æ³¨ï¼šå®‰è£…è¿™ä¸ªæºåï¼Œæ¥ä¸‹æ¥è¦å®‰è£…çš„å¤§é‡çš„ä¾èµ–åŒ…å°±ä¸ä¼šæŠ¥é”™</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">rpm -Uvh  http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm </div><div class="line">sed -i <span class="string">'s/^#baseurl/baseurl/g'</span> /etc/yum.repos.d/epel.repo</div><div class="line">sed -i <span class="string">'s/mirrorlist/#mirrorlist/g'</span> /etc/yum.repos.d/epel.repo</div></pre></td></tr></table></figure>
<h3 id="2-å®‰è£…rrdtoolä¸ä¾èµ–åº“"><a href="#2-å®‰è£…rrdtoolä¸ä¾èµ–åº“" class="headerlink" title="2. å®‰è£…rrdtoolä¸ä¾èµ–åº“"></a>2. å®‰è£…rrdtoolä¸ä¾èµ–åº“</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install perl perl-Net-Telnet perl-Net-DNS perl-LDAP perl-libwww-perl perl-RadiusPerl perl-IO-Socket-SSL perl-Socket6 perl-CGI-SpeedyCGI perl-FCGI perl-CGI-SpeedCGI perl-Time-HiRes perl-ExtUtils-MakeMaker perl-RRD-Simple rrdtool rrdtool-perl curl fping echoping  httpd httpd-devel gcc make  wget libxml2-devel libpng-devel glib pango pango-devel freetype freetype-devel fontconfig cairo cairo-devel libart_lgpl libart_lgpl-devel mod_fastcgi screen wqy-zenhei-fonts.noarch wqy-zenhei-fonts-common.noarch lrzsz nginx</div></pre></td></tr></table></figure>
<p>æ³¨ï¼š<code>perl-CGI-SpeedyCGIï¼Œperl-CGI-SpeedCGI</code>è¿™ä¸¤ä¸ªåŒ…åœ¨å®‰è£…è¿‡ç¨‹ä¸­ä¼šæç¤ºæ‰¾ä¸åˆ°ï¼Œä½†æ²¡å…³ç³»<br>æ³¨ï¼šç”¨yumå®‰è£…å¤§é‡çš„ä¾èµ–åŒ…è¿˜æ˜¯å¾ˆæ–¹ä¾¿çš„ï¼Œè€Œç™¾åº¦ä¸Šæœ‰äº›å…³äºå®‰è£…smokepingçš„æ–‡æ¡£è¦æ±‚ä½¿ç”¨wgetä¸‹è½½åå†ç”¨<code>make,make install</code>æ–¹å¼å®‰è£…ï¼Œè™½ç„¶makeæ–¹å¼ä¸å¤æ‚ï¼Œä½†é€šè¿‡makeç¼–è¯‘å†å®‰è£…å‡ åä¸ªåŒ…å°±æ˜¾å¾—æœ‰ç‚¹ç¹é”äº†ã€‚</p>
<h3 id="3-ä¸‹è½½ä¸å®‰è£…smokeping"><a href="#3-ä¸‹è½½ä¸å®‰è£…smokeping" class="headerlink" title="3.ä¸‹è½½ä¸å®‰è£…smokeping"></a>3.ä¸‹è½½ä¸å®‰è£…smokeping</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">wget http://oss.oetiker.ch/smokeping/pub/smokeping-2.6.8.tar.gz</div><div class="line">wget http://oss.oetiker.ch/smokeping/pub/smokeping-2.6.11.tar.gz    </div><div class="line">tar zxvf smokeping-2.6.8.tar.gz</div><div class="line"><span class="built_in">cd</span> smokeping-2.6.8</div><div class="line">./configure --prefix=/usr/<span class="built_in">local</span>/smokeping</div></pre></td></tr></table></figure>
<p>å‡ºç°é—®é¢˜æ˜¯å› ä¸ºéœ€è¦å®‰è£…perlçš„æ¨¡å—ï¼Œæ‰€ä»¥è¿è¡Œä¸‹é¢å†…å®¹å³å¯</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">å¦‚æœåªå‡ºç° Config::Grammar<span class="string">' ... Failed</span></div><div class="line">è§£å†³ 'Config::Grammar<span class="string">' ... Failed</span></div><div class="line">wget http://search.cpan.org/CPAN/authors/id/D/DS/DSCHWEI/Config-Grammar-1.10.tar.gz</div><div class="line">tar zxvf Config-Grammar-1.10.tar.gz</div><div class="line">cd Config-Grammar-1.10</div><div class="line">perl Makefile.PL</div><div class="line">make &amp;&amp; make install</div></pre></td></tr></table></figure>
<p>å¦‚æœå‡ºç°å¾ˆå¤šä¸ªfailedï¼Œå°±ç”¨ä¸‹é¢çš„æ–¹æ³•</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">./setup/build-perl-modules.sh /usr/<span class="built_in">local</span>/smokeping/thirdparty  è¿™ä¸ªæ˜¯ä¸ºå‰é¢failedåšå®‰è£…  </div><div class="line">./co nfigure --prefix=/usr/<span class="built_in">local</span>/smokeping   </div><div class="line">                                                                      </div><div class="line">å¦‚æœè¿˜å‡ºç°é—®é¢˜å¯ä»¥çœ‹ä¸‹è¿™é‡Œé¢çš„å‚è€ƒã€‚http://bbs.51cto.com/thread-1106181-1.html</div><div class="line">/usr/bin/gmake install</div><div class="line"></div><div class="line">å®‰è£…ä¸‹yum install cpan     perl -MCPAN <span class="_">-e</span> <span class="string">'install CGI'</span>           perl -MCPAN <span class="_">-e</span> <span class="string">'install CGI::Fast '</span>  è¿™ä¸ªå®‰è£…å¥½äº†ç„¶åå†æ‰§è¡Œè¿™ä¸€æ­¥ã€‚</div></pre></td></tr></table></figure>
<p>å¦‚æœä¸Šé¢æç¤ºCGI æ²¡æœ‰å®‰è£…æˆåŠŸã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">wgethttp://www.cpan.org/authors/id/M/MA/MARKSTOS/</div><div class="line">CGI.pm-3.65.tar.gz</div><div class="line">tar zxvf CGI.pm-3.65.tar.gz</div><div class="line"><span class="built_in">cd</span> CGI.pm-3.65</div><div class="line">perl Makefile.PL</div><div class="line">make &amp;&amp; make install</div><div class="line">ç„¶åå†æ‰§è¡Œä¸‹ ./configure --prefix=/usr/<span class="built_in">local</span>/smokeping</div></pre></td></tr></table></figure>
<p>ç°åœ¨smokepingå®‰è£…å®Œæˆ</p>
<h3 id="4-é…ç½®smokeping"><a href="#4-é…ç½®smokeping" class="headerlink" title="4. é…ç½®smokeping"></a>4. é…ç½®smokeping</h3><h2 id="ç¬¬ä¸€ç§-ä½¿ç”¨nginx"><a href="#ç¬¬ä¸€ç§-ä½¿ç”¨nginx" class="headerlink" title="ç¬¬ä¸€ç§ ä½¿ç”¨nginx"></a>ç¬¬ä¸€ç§ ä½¿ç”¨nginx</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">1.å®‰è£…nginx</div><div class="line">rpm -Uvh  http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm</div><div class="line">yum install -y nginx</div><div class="line">https://metacpan.org/pod/release/MSTROUT/ExtUtils-MakeMaker-6.59/lib/ExtUtils/MakeMaker.pm  ä¸‹è½½Make è®©ä»–ç›´æ¥æ‰§è¡Œ</div></pre></td></tr></table></figure>
<p>2.å®‰è£…åŸºç¡€IO </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /root</div><div class="line">wget  http://220.194.199.196/download/IO-All-0.46.tar.gz</div><div class="line">tar xvzf IO-All-0.46.tar.gz</div><div class="line"><span class="built_in">cd</span> IO-All-0.46</div><div class="line">perl Makefile.PL       <span class="comment">#  è¿™é‡Œå‡ºç°è¿™ä¸ªé—®é¢˜ æŠŠé‚£ä¸ªæ–‡ä»¶åˆ äº†å°±è¡Œäº†ã€‚</span></div><div class="line">make &amp;&amp; make install</div></pre></td></tr></table></figure>
<p>3.é…ç½®nginxçš„sock<br>åˆ›å»ºfcgi sock æ–‡ä»¶ï¼Œé…ç½®nginx fcgiä½¿ç”¨</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#wget http://autonagios.googlecode.com/svn/trunk/autonagios-20100103/files/nginx-fcgi.txt  -O /etc/nginx-fcgi</span></div><div class="line">wget http://117.27.153.133/nginx-fcgi.txt -O /etc/nginx-fcgi </div><div class="line">chmod a+x /etc/nginx-fcgi</div><div class="line">/etc/nginx-fcgi <span class="_">-l</span> /var/<span class="built_in">log</span>/nginx-fcgi.log -pid /var/run/nginx-fcgi.pid -S /var/run/nginx-fcgi.sock</div><div class="line">chmod 777 /var/run/nginx-fcgi.sock</div></pre></td></tr></table></figure>
<p>4.å¢åŠ smokepingä½¿ç”¨çš„dataã€varã€å’Œcacheç›®å½•</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/smokeping</div><div class="line">mkdir data var cache</div><div class="line">mv htdocs/smokeping.fcgi.dist htdocs/smokeping.fcgi</div><div class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/smokeping/etc</div><div class="line">mv config.dist config</div><div class="line">chmod 600 /usr/<span class="built_in">local</span>/smokeping/etc/smokeping_secrets.dist</div></pre></td></tr></table></figure>
<p>5.ä¸Šä¼ ç›‘æ§èŠ‚ç‚¹confæ–‡ä»¶åˆ°smokepingçš„etcç›®å½•<br>6.ä¿®æ”¹smokpeingé…ç½®è„šæœ¬</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">vi config</div><div class="line">åœ¨å¦‚ä¸‹ä½ç½®ä¿®æ”¹</div><div class="line"></div><div class="line">*** Database ***</div><div class="line">step     = 300</div><div class="line">pings    = 20</div><div class="line">ä¿®æ”¹ä¸º</div><div class="line">*** Database ***</div><div class="line">step     = 60</div><div class="line">pings    = 20</div><div class="line"></div><div class="line">åœ¨å¦‚ä¸‹ä½ç½®æ·»åŠ ä¸€å¥è¯</div><div class="line">*** Presentation ***</div><div class="line">template = /usr/<span class="built_in">local</span>/smokeping/etc/basepage.html.dist</div><div class="line">charset=utf-8</div></pre></td></tr></table></figure>
<p>åœ¨ç¬¬ä¸€ä¸ªåŠ å·ä½ç½®ä¸‹å°†ç›‘æ§èŠ‚ç‚¹æ–‡ä»¶å¼•å…¥ï¼Œå¦‚ä¸‹ä¾‹å­</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">+ testnetwork</div><div class="line">menu=æµ‹è¯•ç½‘ç»œçŠ¶å†µ</div><div class="line">title= æµ‹è¯•ç½‘ç»œçŠ¶å†µ</div><div class="line">@include CT-IP.conf</div><div class="line">@include CN-IP.conf</div><div class="line">@include CT_IDC.conf</div><div class="line">@include CNC-IDC.conf</div></pre></td></tr></table></figure>
<p>ä¿å­˜é€€å‡º</p>
<p>7.å¢åŠ dataã€varã€cacheç›®å½•çš„è½¯è¿æ¥</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ln <span class="_">-s</span> /usr/<span class="built_in">local</span>/smokeping/data/ /usr/share/nginx/html/data</div><div class="line">ln <span class="_">-s</span>  /usr/<span class="built_in">local</span>/smokeping/cache/ /usr/share/nginx/html/cache</div><div class="line">ln <span class="_">-s</span> /usr/<span class="built_in">local</span>/smokeping/htdocs/cropper/ /usr/share/nginx/html/cropper</div></pre></td></tr></table></figure>
<p>8.ä¿®æ”¹nginx é…ç½®æ–‡ä»¶<br>æŸ¥çœ‹ä¸‹nginxçš„ç‰ˆæœ¬ï¼Œä½¿ç”¨nginx -v æŸ¥çœ‹ï¼Œå¦‚ä¸‹ä¾‹å­ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"> nginx -v</div><div class="line">nginx version: nginx/1.0.15</div></pre></td></tr></table></figure>
<p>ä¿®æ”¹nginxé…ç½®</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">vi</span> /etc/nginx/conf.d/default.conf</div><div class="line">--å¢åŠ fcgi æŒ‡å‘</div><div class="line">    location  <span class="regexp">~ .*\.fcgi$</span> &#123;</div><div class="line">        <span class="attribute">root</span> /usr/local/smokeping/htdocs/;</div><div class="line">        <span class="attribute">gzip</span> <span class="literal">off</span>;</div><div class="line">        <span class="attribute">fastcgi_pass</span>  unix:/var/run/nginx-fcgi.sock;</div><div class="line">        <span class="attribute">fastcgi_index</span> smokeping.fcgi;</div><div class="line">        <span class="attribute">include</span> fastcgi.conf;                 <span class="comment">#1.0.x ä¸0.8.x ç”¨è¿™ä¸ª</span></div><div class="line">        <span class="comment">#include fastcgi_params;            #1.4.xç‰ˆæœ¬ç”¨ fastcgi_params</span></div><div class="line">        <span class="comment">#fastcgi_param   SCRIPT_FILENAME /opt/smokeping/htdocs$fastcgi_script_name; #1.4.xç‰ˆæœ¬å¿…åŠ </span></div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>ä¿å­˜é€€å‡º</p>
<h2 id="ç¬¬äºŒç§-ä½¿ç”¨apache"><a href="#ç¬¬äºŒç§-ä½¿ç”¨apache" class="headerlink" title="ç¬¬äºŒç§ ä½¿ç”¨apache"></a>ç¬¬äºŒç§ ä½¿ç”¨apache</h2><p>(1) åˆ›å»ºcacheã€dataã€varç›®å½•</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/smokeping</div><div class="line">mkdir htdocs/cache data var</div></pre></td></tr></table></figure>
<p>(2) åœ¨åˆ›å»ºæ—¥å¿—</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">touch /var/<span class="built_in">log</span>/smokeping.log</div></pre></td></tr></table></figure>
<p>(3) ä¸Šä¼ ç›‘æ§èŠ‚ç‚¹çš„confæ–‡ä»¶åˆ°smokepingçš„etcç›®å½•ä¸‹<br>ä¿®æ”¹smokepingç›®å½•çš„ç”¨æˆ·å’Œç»„æƒé™</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">chown apache:apache -R /usr/<span class="built_in">local</span>/smokeping</div><div class="line">chown apache:apache /var/<span class="built_in">log</span>/smokeping.log</div></pre></td></tr></table></figure>
<p>(4) ä¿®æ”¹é…ç½®æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/smokeping/htdocs/</div><div class="line">mv smokeping.fcgi.dist smokeping.fcgi</div><div class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/smokeping/etc</div><div class="line">mv config.dist config</div><div class="line">vi config</div><div class="line"></div><div class="line">ä¿®æ”¹æ”¹è¡Œè®¾ç½®</div><div class="line">imgcache = /usr/<span class="built_in">local</span>/smokeping/cache</div><div class="line">imgcache = /usr/<span class="built_in">local</span>/smokeping/htdocs/cache</div><div class="line"></div><div class="line"> *** Database ***</div><div class="line">step  = 300</div><div class="line">pings  = 60</div><div class="line">ç„¶åä¿®æ”¹stepï¼Œä»300æ”¹ä¸º60ï¼Œè¿™æ˜¯æ£€æµ‹çš„æ—¶é—´, pings ä»20 æ”¹ä¸º60, å³60ç§’ping 60æ¬¡</div><div class="line"></div><div class="line">åœ¨å¦‚ä¸‹ä½ç½®æ·»åŠ ä¸€å¥è¯</div><div class="line">*** Presentation ***</div><div class="line">template = /usr/<span class="built_in">local</span>/smokeping/etc/basepage.html.dist</div><div class="line">charset=utf-8</div><div class="line"></div><div class="line">åœ¨ç¬¬ä¸€ä¸ªåŠ å·ä½ç½®ä¸‹å°†ç›‘æ§èŠ‚ç‚¹æ–‡ä»¶å¼•å…¥ï¼Œå¦‚ä¸‹ä¾‹å­</div><div class="line">+ testnetwork</div><div class="line">menu=æµ‹è¯•ç½‘ç»œçŠ¶å†µ</div><div class="line">title= æµ‹è¯•ç½‘ç»œçŠ¶å†µ</div><div class="line">@include CT-IP.conf</div><div class="line">@include CN-IP.conf</div><div class="line">@include CT_IDC.conf</div><div class="line">@include CNC-IDC.conf</div></pre></td></tr></table></figure>
<p>ä¿å­˜é€€å‡º </p>
<p> (5) é…ç½®å®Œæˆä¹‹åä¿®æ”¹å¯†ç æ–‡ä»¶æƒé™</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">chmod 600 /usr/<span class="built_in">local</span>/smokeping/etc/smokeping_secrets.dist</div></pre></td></tr></table></figure>
<ol>
<li>ä¿®æ”¹apacheçš„é…ç½®</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">vim /etc/httpd/conf/httpd.conf</div><div class="line">åœ¨DocumentRoot <span class="string">"/var/www/html"</span> è¿™ä¸€è¡Œä¹‹ä¸‹æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</div><div class="line"></div><div class="line">Alias /cache <span class="string">"/usr/local/smokeping/htdocs/cache"</span></div><div class="line">Alias /cropper <span class="string">"/usr/local/smokeping/htdocs/cropper"</span></div><div class="line">Alias /smokeping <span class="string">"/usr/local/smokeping/htdocs"</span></div><div class="line">&lt;Directory <span class="string">"/usr/local/smokeping/htdocs"</span>&gt;</div><div class="line">  AllowOverride None</div><div class="line">  AddHandler cgi-script .fcgi .cgi</div><div class="line">  Options ExecCGI</div><div class="line">  &lt;IfModule dir_module&gt;</div><div class="line">     DirectoryIndex smokeping.fcgi</div><div class="line">  &lt;/IfModule&gt;</div><div class="line">  Order allow,deny</div><div class="line">  Allow from all </div><div class="line">&lt;/Directory&gt;</div></pre></td></tr></table></figure>
<ol>
<li>è®¾ç½®å¼€æœºå¯åŠ¨httpd, smokeping,å¹¶å…³é—­iptables.</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">echo</span> <span class="string">"/usr/local/smokeping/bin/smokeping --logfile=/var/log/smokeping.log 2&gt;&amp;1 &amp;"</span> &gt;&gt; /etc/rc.local</div><div class="line">chkconfig httpd on      <span class="comment">#å¼€æœºå¯åŠ¨httpdè¿›ç¨‹</span></div><div class="line">chkconfig iptables off  <span class="comment">#å¼€æœºä¸å¯åŠ¨iptablesæœåŠ¡</span></div><div class="line">chkconfig nginx on</div></pre></td></tr></table></figure>
<ol>
<li>å¯åŠ¨httpæˆ–è€…nginxä»¥åŠsmokeping</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">service httpd start service nginx start</div><div class="line">/usr/<span class="built_in">local</span>/smokeping/bin/smokeping --debug-daemon</div><div class="line">chown apache:apache -R /usr/<span class="built_in">local</span>/smokeping</div></pre></td></tr></table></figure>
<ol>
<li>æ‰“å¼€æ£€æµ‹ä¸»æœºçš„Webé¡µé¢.</li>
</ol>
<p>ä½¿ç”¨httpdåšwebï¼Œåœ¨Webæµè§ˆå™¨é‡Œè¾“å…¥<code>http://æ‚¨çš„ç›‘æ§ä¸»æœºIP/smokeping</code>      è¿™é‡Œå¯åŠ¨ä¸äº†ï¼Œçœ‹ä¸‹ä»€ä¹ˆåŸå› ã€‚æ˜¯ä¸æ˜¯CT-IDC.conf æ²¡æœ‰ä¸Šä¼ åˆ°etcä¸‹é¢</p>
<p>æ‰“å¼€è¿™é‡Œå‡ºç°500  è¯´æ˜é…ç½®æ­£ç¡®é˜²ç«å¢™çœ‹ä¸‹ã€‚<code>serenfroce 0</code> æœ‰æ²¡æœ‰å…³é—­ã€‚</p>
<p>ä½¿ç”¨nginxåšwebï¼Œåœ¨Webæµè§ˆå™¨é‡Œè¾“å…¥ <a href="http://æ‚¨çš„ç›‘æ§ä¸»æœºIP/smokeping.fcgi" target="_blank" rel="external">http://æ‚¨çš„ç›‘æ§ä¸»æœºIP/smokeping.fcgi</a>    è¿™é‡Œå¯åŠ¨ä¸äº†ï¼Œçœ‹ä¸‹ä»€ä¹ˆåŸå› ã€‚æ˜¯ä¸æ˜¯CT-IDC.conf æ²¡æœ‰ä¸Šä¼ åˆ°etcä¸‹é¢</p>
<p>å¦‚æœé‡åˆ°500é”™è¯¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">Internal Server Error</div><div class="line">The server encountered an internal error or misconfiguration and was unable to complete your request.</div><div class="line">Please contact the server administrator, root@localhost and inform them of the time the error occurred, and anything you might have <span class="keyword">done</span> that may have caused the error.</div><div class="line">More information about this error may be available <span class="keyword">in</span> the server error log.</div><div class="line">--------------------------------------------------------------------------------</div><div class="line">Apache/2.2.15 (CentOS) Server at 192.168.2.101 Port 80</div><div class="line"></div><div class="line">è¯´æ˜æ²¡æœ‰å…³é—­SElinux é€‰é¡¹ï¼Œå…³é—­å°±æ­£å¸¸äº†</div><div class="line">vi /etc/sysconfig/selinux</div><div class="line">SELINUX=permissive</div><div class="line">[root@localhost ~]<span class="comment"># getenforce     #æŸ¥çœ‹SElinux çš„å‘½ä»¤</span></div><div class="line">Permissive                      <span class="comment">#è¿”å›çš„ç»“æœæ˜¯Permissive, è¡¨ç¤ºå·²ç»å…³é—­SElinuxäº†</span></div></pre></td></tr></table></figure>
<ol>
<li>åœ¨Webé¡µé¢å¢åŠ éªŒè¯ç”¨æˆ·åå’Œå¯†ç (å¯é€‰æ­¥éª¤)</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">(1)ä¿®æ”¹httpd.confé‡Œçš„å†…å®¹</div><div class="line">&lt;Directory <span class="string">"/usr/local/smokeping"</span>&gt;</div><div class="line">AllowOverride None</div><div class="line">Options All</div><div class="line">AddHandler cgi-script .fcgi .cgi</div><div class="line">AllowOverride AuthConfig</div><div class="line">Order allow,deny</div><div class="line">Allow from all</div><div class="line">AuthName <span class="string">"Smokeping"</span></div><div class="line">AuthType Basic</div><div class="line">AuthUserFile /usr/<span class="built_in">local</span>/smokeping/htdocs/htpasswd</div><div class="line">Require valid-user</div><div class="line">DirectoryIndex smokeping.fcgi</div><div class="line">&lt;/Directory&gt;</div></pre></td></tr></table></figure>
<p>æ³¨ï¼šä¸Šé¢çš„å†…å®¹éƒ¨åˆ†å·²ç»æ·»åŠ ï¼Œè¿™é‡Œä»…æ·»åŠ çº¢è‰²å­—ä½“å†…å®¹å³å¯ã€‚</p>
<p>(2) è®¾ç½®ç™»å½•è´¦æˆ·ä¸å¯†ç <br>è¿›å…¥cd /usr/local/smokeping/htdocsç›®å½•ï¼Œ æ‰§è¡Œå‘½ä»¤ï¼šhtpasswd -c /usr/local/smokeping/htdocs/htpasswd admin<br>è¿™ä¸ªæ˜¯è®¾ç½®ç™»å½•è´¦æˆ·ä¸ºadminï¼Œå¯†ç åœ¨åé¢è¾“å…¥ï¼Œç„¶åé‡å¯httpdå°±å¯ä»¥å®ç°å¯†ç éªŒè¯ç™»å½•<br>é‡æ–°ç™»å½•webé¡µé¢ï¼Œä¼šè¦æ±‚è¾“å…¥ç”¨æˆ·åå’Œå¯†ç .</p>
<ol>
<li>ä¸€å®šè¦åŒæ­¥å¥½æ—¶é—´</li>
</ol>
<p>åœ¨ESXI4çš„è™šæ‹Ÿæœºä¸­ï¼Œå®šæœŸæ‰§è¡Œ<code>ntpdate 210.72.145.44</code>    #æˆ–è€…ä¸æœ¬åœ°çš„æ—¶é—´æœåŠ¡å™¨åŒæ­¥<br>åœ¨vmware workstationä¸­ï¼Œå®‰è£…vmware-toolsï¼Œ è™šæ‹Ÿæœºçš„æ—¶é—´ä¼šè‡ªåŠ¨ä¸å…¶å®¿ä¸»æœºæ—¶é—´åŒæ­¥</p>
<p>æ³¨ï¼š å¦‚æœvmware workstationä¸­çš„è™šæ‹Ÿæœºä¸å®‰è£…vmware-toolsï¼Œåˆ™è™šæ‹Ÿæœºæ—¶é—´ä¼šä¸å®¿ä¸»æœºæ—¶é—´ç›¸éš”æ•´æ•´8ä¸ªå°æ—¶(è™šæ‹Ÿæœºæ—¶é—´æ—©äºå®¿ä¸»æœºæ—¶é—´)<br> vmware-toolsçš„å®‰è£…ä¸åœ¨æ­¤å™è¿°</p>
<ol>
<li><p>ç‰¹åˆ«è¯´æ˜: ä¿®æ”¹/usr/local/smokeping/etc/config æ–‡ä»¶çš„é…ç½®å‚æ•°ï¼Œå¿…é¡»é‡å¯åŠ¨smokepingç¨‹åº</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">(1)å¦‚æœé‡å¯åŠ¨smokepingç¨‹åºå¤±è´¥ï¼Œæ ¹æ®æŠ¥é”™æç¤ºåˆ é™¤/usr/<span class="built_in">local</span>/smokeping/dataå­æ–‡ä»¶å¤¹çš„rrdæ–‡ä»¶</div><div class="line">(2)ä¸­æ–‡é—®é¢˜ï¼šå¦‚æœéœ€è¦åœ¨ç½‘é¡µé‡Œå±•ç¤ºä¸­æ–‡ï¼Œä¿®æ”¹/usr/<span class="built_in">local</span>/smokeping/etcçš„configæ–‡ä»¶</div><div class="line">*** Presentation ***</div><div class="line">charset = utf-8 //æ³¨ï¼šåœ¨è¿™é‡Œæ·»åŠ </div><div class="line">ç„¶ååœ¨menuä¸titileé‡Œä¿®æ”¹ä¸­æ–‡ï¼Œé‡å¯å³å¯</div></pre></td></tr></table></figure>
<p>æœ‰ä¸€ä¸ªè¦æ³¨æ„çš„åœ°æ–¹å°±æ˜¯ï¼Œä½ è¾“å…¥çš„ä¸­æ–‡å¿…é¡»åœ¨utf-8çš„å­—ç¬¦ç¼–ç ä¸‹è¾“å…¥çš„ä¸­æ–‡å­—ç¬¦ï¼Œä¸ç„¶ä¼šå‡ºç°ä¹±ç ã€‚<br> å¦‚æœåœ¨xshelä¸‹ï¼Œé€‰æ‹©file-properities-terminal<br>å¦‚æœè¿˜æ˜¯ä¸æ˜¾ç¤ºå°±çœ‹çœ‹ä½ ç³»ç»Ÿé‡Œæ˜¯å¦å®‰è£…äº†ä¸­æ–‡å­—ä½“ï¼Œæˆ–è€…åœ¨å®‰è£…ä¸€ä¸ª</p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[root@smokeping data]<span class="comment"># ps -ef |grep smoke   #æŸ¥æ‰¾smokepingè¿›ç¨‹</span></div><div class="line">root      8740     1  0 09:08 ?        00:00:00 /usr/<span class="built_in">local</span>/smokeping/bin/smokeping [FPing]</div><div class="line">root     35552 35529  0 09:33 pts/2    00:00:00 grep smoke</div><div class="line">[root@smokeping data]<span class="comment"># kill 8740     #æ€æ‰smokepingè¿›ç¨‹</span></div><div class="line">[root@smokeping data]<span class="comment"># ps -ef |grep smoke</span></div><div class="line">root     35554 35529  4 09:33 pts/2    00:00:00 grep smoke</div><div class="line">smokepingè¿›ç¨‹å·²ç»è¢«æ€æ‰</div><div class="line">[root@smokeping data]<span class="comment">#screen                    #å¦‚æœé€šè¿‡SSHè¿œç¨‹ç™»å½•åˆ°ç›‘æ§ä¸»æœºï¼Œæœ€åæ‰§è¡Œscreenï¼Œåœ¨è™šæ‹Ÿçª—å£ä¸­å¯åŠ¨smokeping</span></div><div class="line">/usr/<span class="built_in">local</span>/smokeping/bin/smokeping --logfile=/var/<span class="built_in">log</span>/smokeping.log 2&gt;&amp;1 &amp;</div></pre></td></tr></table></figure>
<p>ä¸‰. æ·»åŠ éœ€è¦ç›‘æ§çš„ç½‘ç«™å’ŒèŠ‚ç‚¹(åœ¨/usr/local/smokeping/etc/configä¸­æ·»åŠ )</p>
<ul>
<li><p>smokepingå°±è¿™ç‚¹ä¸å¥½ï¼Œæ·»åŠ èŠ‚ç‚¹ä¸èƒ½åœ¨å‰å°Webé¡µé¢æ·»åŠ ï¼Œä¸€å®šè¦åœ¨åå°çš„é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ,å¸Œæœ›ä»¥åçš„ç‰ˆæœ¬ä¸­èƒ½æ”¹è¿›ä¸€ä¸‹  *</p>
</li>
<li><p>ä¿®æ”¹/usr/local/smokeping/etc/config åï¼Œå¿…é¡»é‡å¯smokeping ç¨‹åºï¼Œé…ç½®æ‰ä¼šç”Ÿæ•ˆ  *  </p>
</li>
<li><p>smokeping ä¼šæ ¹æ®é…ç½®æ–‡ä»¶config åœ¨/usr/local/smokeping/data ä¹‹ä¸‹æ·»åŠ moniteræ–‡ä»¶å¤¹ï¼Œå…¶ä¸‹åŒ…å«websiteå­æ–‡ä»¶å¤¹ *</p>
</li>
<li><p>ç”¨vmware workstationçš„è™šæ‹Ÿæœºæµ‹è¯•æœ‰ä¸€ç‚¹å¥½å¤„ï¼Œworkstationä¸‹çš„è™šæ‹Ÿç½‘å¡å¯ä»¥è®¾ç½®å‡ºå…¥çš„ä¸¢åŒ…ç‡ï¼Œé€‚åˆsmokepingåšä¸¢åŒ…æµ‹è¯•, ç»è¿‡æµ‹è¯•smokepingæ£€æµ‹å‡ºçš„ä¸¢åŒ…ç‡ä¸vmware worksationè™šæ‹Ÿç½‘å¡è®¾ç½®çš„ä¸¢åŒ…ç‡åŸºæœ¬ç›¸åŒ,ä¹Ÿå°±æ˜¯è¯´smokeping èƒ½å¤Ÿååº”ç½‘ç»œçš„çœŸå®çŠ¶å†µ *<br> æ·»åŠ ç›‘æ§èŠ‚ç‚¹ç¤ºä¾‹ï¼šæ³¨æ„+æ˜¯ç¬¬ä¸€å±‚ï¼Œ++æ˜¯ç¬¬äºŒå±‚ï¼Œ+++ æ˜¯ç¬¬ä¸‰å±‚</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">+ moniter                       </div><div class="line">menu = moniter</div><div class="line">++ website</div><div class="line">menu = website</div><div class="line">title = moniter website</div><div class="line"><span class="comment">#host = /moniter/website/baidu /moniter/website/sina /moniter/website/taobao /moniter/website/QQ</span></div><div class="line"></div><div class="line">+++ baidu</div><div class="line">menu = baidu</div><div class="line">title = baidu.com</div><div class="line">alerts = someloss</div><div class="line">host = www.baidu.com</div><div class="line"></div><div class="line">+++ sina</div><div class="line">menu = sina</div><div class="line">title = sina.com.cn</div><div class="line">alerts = someloss</div><div class="line">host = www.sina.com.cn</div><div class="line"></div><div class="line">+++ taobao</div><div class="line">menu = taobao</div><div class="line">title = taobao.com</div><div class="line">alerts = someloss</div><div class="line">host = www.taobao.com</div><div class="line"></div><div class="line">+++ QQ</div><div class="line">menu = QQ</div><div class="line">title = QQ</div><div class="line">alerts = someloss</div><div class="line">host = www.qq.com.cn</div><div class="line"></div><div class="line">+++ sohu</div><div class="line">menu = sohu</div><div class="line">title = sohu</div><div class="line">alerts = someloss</div><div class="line">host = www.sohu.com</div></pre></td></tr></table></figure>
<p>æ•ˆæœå›¾ï¼šå½“å‰èœå•ä¸‹ä¸»æœºå»¶æ—¶ï¼Œä¸¢åŒ…å›¾</p>
<p>æ•ˆæœå›¾ï¼šå½“å‰èœå•ä¸‹æŸä¸»æœºå»¶æ—¶ï¼Œä¸¢åŒ…è¯¦ç»†å›¾</p>
<p>13.å›¾ä¾‹è¯´æ˜</p>
<p>ç»¿å—è¡¨ç¤ºä¸ä¸¢åŒ…ï¼Œå…¶ä»–é¢œè‰²çš„å—è¡¨ç¤ºä¸åŒç¨‹åºçš„ä¸¢åŒ…ã€‚<br>å›¾å½¢è¶Šå¹³ç¨³ï¼Œè¡¨ç¤ºç½‘ç»œè¶Šç¨³å®šï¼Œå¦‚æœå›¾å½¢å³°å€¼å’Œä½è°·å¾ˆå¤šï¼Œåˆ™è¡¨ç¤ºç½‘ç»œæ—¶å»¶ä¸ç¨³å®šï¼Œå¿½é«˜å¿½ä½ã€‚</p>
<p>è¿™é‡Œapache å¦‚æœè¦ä½ åšä¸ªURLçš„æ–‡ä»¶ä¸‹è½½æµ‹è¯• </p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dd <span class="keyword">if</span>=<span class="regexp">/dev/</span><span class="keyword">null</span> bs=<span class="number">1</span>M <span class="keyword">count</span>=<span class="number">1</span> of=<span class="regexp">/var/</span>www<span class="regexp">/html/i</span>ndex.html</div></pre></td></tr></table></figure>

	

	

</article>






	<span class="different-posts">ğŸ“• end of posts ğŸ“•</span>


	</main>

	<footer class="footer">
	<div class="footer-content">
		
	      <div class="footer__element">
	<h5>Hi there,</h5>
	<p style="text-align:justify;">my name is Yancy, they know me as RadiantğŸ‘ğŸ‘. This blog is about Bi-data and my live.<br> I like ğŸŒ³ğŸŒ³ğŸŒ³</p>
</div>


	    
	      <div class="footer__element">
	<h5>Check out</h5>
	<ul class="footer-links">
		<li class="footer-links__link"><a href="/archives">Archive</a></li>
		
		  <li class="footer-links__link"><a href="/atom.xml">RSS</a></li>
	    
		<li class="footer-links__link"><a href="/about">about page</a></li>
		<li class="footer-links__link"><a href="/tags">Tags</a></li>
		<li class="footer-links__link"><a href="/categories">Categories</a></li>
	</ul>
</div>

	    

		<div class="footer-credit">
			<span>Â© 2017 Yancy | Powered by <a href="http://blog.yancy.cc/">Yancy</a> | Theme <a href="https://github.com/yangcvo">Yancy_GitHub</a></span>
		</div>

	</div>


</footer>



</body>

</html>
