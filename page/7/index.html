<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="theme-color" content="#33474d">
	<title>Yancy&#39;s blog</title>
	<link rel="stylesheet" href="/css/style.css" />
	
      <link rel="alternate" href="/atom.xml" title="Yancy&#39;s blog" type="application/atom+xml">
    
</head>

<body>

	<header class="header">
		<nav class="header__nav">
			
				<a href="/" class="header__link">Home</a>
			
				<a href="/tags" class="header__link">Tags</a>
			
				<a href="/archives" class="header__link">ARCHIVES</a>
			
				<a href="/about/About" class="header__link">ABOUT</a>
			
				<a href="http://weibo.com/yangcvo" class="header__link">Weibo</a>
			
				<a href="/atom.xml" class="header__link">RSS</a>
			
		</nav>
		<h1 class="header__title"><a href="/">Yancy&#39;s blog</a></h1>
		<h2 class="header__subtitle">SIMPLICITY IS PREREQUISITE FOR  RELIABILITY</h2>
	</header>

	<main>
		
	<span class="different-posts different-posts_earlier">ğŸ“– <a href="/page/6">earlier posts</a> ğŸ“–</span>




	<article>
	
		<h1><a href="/2016/07/31/ä¸ªäººç”Ÿæ´»è®°å½•/æ¨èä¸€ä¸ªä¿æŠ¤çœ¼ç›ğŸ‘€çš„è½¯ä»¶ï¼f-lux/">æ¨èä¸€ä¸ªä¿æŠ¤çœ¼ç›ğŸ‘€çš„è½¯ä»¶ï¼f-lux</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-07-31</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/ç”Ÿæ´»/">ç”Ÿæ´»</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Personal-life-record/">Personal life record</a>
			</span>
		
	</div>

	

	
		<p>æœ€è¿‘å¤©å¤©åŠ ç­ç„¶åæ™šä¸Šç›¯ç€ç”µè„‘ï¼Œçœ¼ç›ä¸€ç›´å¾ˆå¹²æ¶©ï¼Œéå¸¸éš¾å—ã€‚æ­£å·§æ˜¨å¤©åœ¨GitHubä¸Šé—²é€›ï¼Œæ— æ„é—´å‘ç°äº†åˆ«äººæ¨èçš„è¿™ä¸ªè½¯ä»¶f.luxï¼ŒMacä¸Šä¸‹è½½è¯•ç”¨äº†ä¸€ä¸‹ã€‚è§‰å¾—å¾ˆä¸é”™ï¼Œæ¨èä¸€ä¸‹ï¼ä¹Ÿè®¸æ˜¯æˆ‘å­¤é™‹å¯¡é—»äº†ï¼Œå¯èƒ½å¤§å®¶éƒ½å·²ç»åœ¨ç”¨äº†â€¦â€¦</p>
		<p><a class="article__read-more-link" href="/2016/07/31/ä¸ªäººç”Ÿæ´»è®°å½•/æ¨èä¸€ä¸ªä¿æŠ¤çœ¼ç›ğŸ‘€çš„è½¯ä»¶ï¼f-lux/">...read more</a></p>
	

	

</article>




	<article>
	
		<h1><a href="/2016/07/29/ä¸ªäººç”Ÿæ´»è®°å½•/åšæŒä¸€ä¸ªæœˆ3å…¬é‡Œè·‘æ­¥ğŸƒä¸‹æ¥/">åšæŒä¸€ä¸ªæœˆ3å…¬é‡Œè·‘æ­¥ğŸƒä¸‹æ¥</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-07-29</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/ç”Ÿæ´»/">ç”Ÿæ´»</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Personal-life-record/">Personal life record</a>
			</span>
		
	</div>

	

	
		<h3 id="åšæŒè·‘æ­¥ğŸƒéœ€è¦ä¸€ä¸ªåœˆå­"><a href="#åšæŒè·‘æ­¥ğŸƒéœ€è¦ä¸€ä¸ªåœˆå­" class="headerlink" title="åšæŒè·‘æ­¥ğŸƒéœ€è¦ä¸€ä¸ªåœˆå­"></a>åšæŒè·‘æ­¥ğŸƒéœ€è¦ä¸€ä¸ªåœˆå­</h3><p>å› ä¸ºä¹Ÿæœ‰ä¸€éƒ¨åˆ†çš„åŸå› æ˜¯ï¼šæœ‹å‹åœˆä¸€ç›´åœ¨åˆ·è·‘æ­¥çš„è®°å½•ï¼Œè®©æˆ‘ä¹Ÿå¾ˆæ„Ÿå…´è¶£ï¼Œå› ä¸ºä¸€ä¸ªäººçš„ç¡®æ˜¯ä¸æƒ³è·‘çš„ï¼Œè€Œä¸”è¿™æ—¶å€™ï¼š2016å¹´7æœˆ20æ—¥æ—¶æ­å·ä»Šå¹´æœ€çƒ­çš„å¤©æ°”ï¼š<code>é«˜æ¸©40Â°c</code>æ›´åŠ æ²¡æœ‰æ¯…åŠ›å»åšæŒæ¯å¤©ç»™è‡ªå·±èº«ä½“å……ç”µäº†ã€‚</p>
<p>åœ¨ä¹‹å‰çš„å…¬å¸ä¹Ÿæ˜¯å¤©å¤©åŠ ç­ç†¬å¤œï¼Œæ²¡æœ‰ç»å¸¸é”»ç‚¼ï¼Œä¸€ç±³8çš„ä¸ªå­ä»è¯»ä¹¦å‡ºæ¥ï¼Œ62ä½“é‡ã€‚<br>åˆ°ç°åœ¨58å·²ç»ç˜¦äº†å¾ˆå¤šï¼Œä¹‹å‰çš„å…«å—è…¹è‚Œï¼Œç°åœ¨æˆäº†4å—ã€‚<br>åœˆå­å¯ä»¥åŠ APPé‡Œé¢å¾ˆå¤šè¿åŠ¨è·‘æ­¥å›¢ï¼Œç°åœ¨APPåšçš„è¿˜æ˜¯å¾ˆä¸é”™çš„ã€‚</p>
		<p><a class="article__read-more-link" href="/2016/07/29/ä¸ªäººç”Ÿæ´»è®°å½•/åšæŒä¸€ä¸ªæœˆ3å…¬é‡Œè·‘æ­¥ğŸƒä¸‹æ¥/">...read more</a></p>
	

	

</article>




	<article>
	
		<h1><a href="/2016/07/21/æ€§èƒ½ç›‘æ§/Zabbix/Zabbix ç›‘æ§ KVMé›†ç¾¤/">KVM monitoring through Zabbix</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-07-21</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/monitoring/">monitoring</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Zabbix-monitoring/">Zabbix monitoring</a>
			</span>
		
	</div>

	

	
		<h3 id="KVM-monitoring-through-Zabbix"><a href="#KVM-monitoring-through-Zabbix" class="headerlink" title="KVM monitoring through Zabbix"></a>KVM monitoring through Zabbix</h3><p>Monitor your KVM resources through Zabbix</p>
<p>Zabbix ç›‘æ§ KVM</p>
<h4 id="å®‰è£…ä¾èµ–"><a href="#å®‰è£…ä¾èµ–" class="headerlink" title="å®‰è£…ä¾èµ–"></a>å®‰è£…ä¾èµ–</h4><p>python2, libvirt-python (tested with 0.9.12.3, 0.10.2 and 1.1.3.x)</p>
<pre><code>pip install libvirt-python 
</code></pre><h4 id="KVM-Server-è®¾å®šç¨‹åº"><a href="#KVM-Server-è®¾å®šç¨‹åº" class="headerlink" title="KVM Server è®¾å®šç¨‹åº"></a>KVM Server è®¾å®šç¨‹åº</h4><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">cd</span> /usr/local/bin/</div><div class="line">wget http<span class="variable">s:</span>//github.<span class="keyword">com</span>/bushvin/zabbix-kvm-<span class="keyword">res</span>/raw/master/bin/zabbix-kvm-<span class="keyword">res</span>.<span class="keyword">py</span></div><div class="line">chmod <span class="keyword">a</span>+<span class="keyword">x</span> zabbix-kvm-<span class="keyword">res</span>.<span class="keyword">py</span></div><div class="line"><span class="keyword">cd</span> /etc/zabbix/zabbix_agentd.d</div><div class="line">wget http<span class="variable">s:</span>//github.<span class="keyword">com</span>/bushvin/zabbix-kvm-<span class="keyword">res</span>/raw/master/zabbix_agentd.<span class="keyword">conf</span>/UserParameters</div><div class="line">service zabbix-agent restart</div></pre></td></tr></table></figure>
<h4 id="Zabbix-Server-è®¾å®šç¨‹åº"><a href="#Zabbix-Server-è®¾å®šç¨‹åº" class="headerlink" title="Zabbix Server è®¾å®šç¨‹åº"></a>Zabbix Server è®¾å®šç¨‹åº</h4><p>è‡³<a href="https://github.com/bushvin/zabbix-kvm-resä¸‹è½½zabbix_kvm.xml" target="_blank" rel="external">https://github.com/bushvin/zabbix-kvm-resä¸‹è½½zabbix_kvm.xml</a><br>å°†<code>zabbix_kvm.xml æ±‡å…¥è‡³Zabbix Server â†’ Configuration â†’ Templates â†’ Import</code></p>
<h3 id="äº¤æµå­¦ä¹ ï¼š"><a href="#äº¤æµå­¦ä¹ ï¼š" class="headerlink" title="äº¤æµå­¦ä¹ ï¼š"></a>äº¤æµå­¦ä¹ ï¼š</h3><p>ğŸ§  Linux shell_é«˜çº§è¿ç»´æ´¾: <code>459096184</code>    åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)<br>ğŸ§  BigData-Exchange School : <code>521621407</code>  åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥</p>
<p>ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚</p>

	

	

</article>




	<article>
	
		<h1><a href="/2016/06/29/è¿ç»´å®‰å…¨/ åŒ–è§£è‡ªå·±çš„é˜¿é‡Œäº‘æœåŠ¡å™¨è¢«é»‘å®¢æ”»å‡»-æš´åŠ›ç ´è§£/">åŒ–è§£è‡ªå·±çš„é˜¿é‡Œäº‘æœåŠ¡å™¨è¢«é»‘å®¢æ”»å‡»-æš´åŠ›ç ´è§£</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-06-29</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/è¿ç»´å®‰å…¨/">è¿ç»´å®‰å…¨</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Operation-safety/">Operation safety</a>
			</span>
		
	</div>

	

	
		<p>è¯´æ˜ä¸‹ï¼šå› ä¸ºé˜¿é‡Œäº‘æœåŠ¡å™¨æˆ‘æ˜¯ç”¨æ¥è‡ªå·±æ­å»ºblog çš„åšäº†ä¸€äº›ç®€å•çš„ç›‘æ§ã€‚</p>
<p>å› ä¸ºé˜²æ­¢è¢«æ”»å‡»ç˜«ç—ªï¼Œåšåˆ°å®‰å…¨é˜²èŒƒï¼Œå¯æ˜¯ä»Šå¤©æ™šä¸Šåƒå®Œé¥­ï¼Œå‘ç°åˆè¢«äººæ”»å‡»ï¼Œæ˜¯å°åº¦å’Œå·´è¥¿IPåœ°å€æš´åŠ›ç ´è§£æ–¹å¼ä¸€ç›´åœ¨å°è¯•ç ´è§£æˆ‘å¯†ç ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">è¿˜å¥½æˆ‘åœ¨é˜¿é‡Œäº‘ä¸Šé¢ä½¿ç”¨äº†äº‘ç›¾å‘Šè­¦ï¼Œå…¶å®å®ƒè¿™ä¸ªä¸€èˆ¬èˆ¬ï¼Œåªèƒ½æé†’ï¼Œä¸èƒ½æœ‰æ•ˆé˜»æ­¢é»‘å®¢æ”»å‡»ã€‚</div></pre></td></tr></table></figure>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/aliyundun.png" alt=""></figure></p>
<p>æ”¶åˆ°å‘Šè­¦ä»¥åï¼Œé©¬ä¸Šæ‰“å¼€ç”µè„‘å»äº‘ç›¾ä¸Šé¢æŸ¥çœ‹ä¸‹ã€‚</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/aliyundun2.png" alt=""></figure></p>
<p>ç„¶åçœ‹äº†ä»¥åå‘ç°é—®é¢˜ä¸å¤§ï¼Œå¯æ˜¯ä¸Šæœºå™¨æŸ¥çœ‹ï¼Œå‘ç°æœ‰ä¸æ–­çš„æ”»å‡»ç—•è¿¹ã€‚<br>æ—¥å¿—æŸ¥çœ‹åˆ°å¾ˆå¤šæ¥å†ä¸æ˜çš„IPã€‚å¾·å›½ğŸ‡©ğŸ‡ª  å·´è¥¿ å°åº¦ã€‚</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/aliyundun3.png" alt=""></figure><br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/aliyundun4.png" alt=""></figure></p>
<p>çœ‹åˆ°è¿™ä¸ªï¼Œæˆ‘å°±å†™äº†ä¸ªè„šæœ¬è®°å½•è¢«æ”»å‡»ç•™ä¸‹çš„ä¿å­˜æŒ‡å®šæ–‡ä»¶å¤¹ï¼Œæˆ‘çœ‹ä¸‹æ˜¯å¦è¿˜åœ¨ç»§ç»­æ”»å‡»äº†ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">#!/bin/bash</span></div><div class="line"><span class="comment">#Denyhosts SHELL SCRIPT</span></div><div class="line"><span class="comment">#2016-2-18</span></div><div class="line">cat /var/<span class="built_in">log</span>/secure|awk <span class="string">'/Failed/&#123;print $(NF-  3)&#125;'</span>|sort|uniq -c|awk <span class="string">'&#123;print $2"=" $1;&#125;'</span> &gt;/root/bin/Denyhosts.txt</div><div class="line">DEFINE=<span class="string">"10"</span></div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `cat /root/bin/Denyhosts.txt`</div><div class="line"><span class="keyword">do</span></div><div class="line">    IP=`<span class="built_in">echo</span> <span class="variable">$i</span>|awk -F= <span class="string">'&#123;print $1&#125;'</span>`</div><div class="line">    NUM=`<span class="built_in">echo</span> <span class="variable">$i</span>|awk -F= <span class="string">'&#123;print $2&#125;'</span>`</div><div class="line">    <span class="keyword">if</span> [ <span class="variable">$NUM</span> <span class="_">-gt</span> <span class="variable">$DEFINE</span> ]</div><div class="line">    <span class="keyword">then</span></div><div class="line">            grep <span class="variable">$IP</span> /etc/hosts.deny &gt;/dev/null</div><div class="line">            <span class="keyword">if</span> [ $? <span class="_">-gt</span> 0 ];</div><div class="line">            <span class="keyword">then</span></div><div class="line">            <span class="built_in">echo</span> <span class="string">"sshd:<span class="variable">$IP</span>"</span> &gt;&gt; /etc/hosts.deny</div><div class="line">            <span class="keyword">fi</span></div><div class="line">    <span class="keyword">fi</span></div><div class="line"><span class="keyword">done</span></div></pre></td></tr></table></figure>
<p>å› ä¸ºä¿å­˜åˆ°å…¶ä»–çš„txtæ–‡ä»¶ä¸‹é¢ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@iZ28by3xm9eZ bin]<span class="comment"># ll</span></div><div class="line">æ€»ç”¨é‡ 4</div><div class="line">-rwxr-xr-x 1 root root 535 2æœˆ  17 21:38 Denyhosts.sh</div><div class="line">-rw-r--r-- 1 root root   0 2æœˆ  17 21:45 Denyhosts.txt</div></pre></td></tr></table></figure>
<p>æŸ¥çœ‹é‡Œé¢æœ‰ä¸æ–­æ”»å‡»çš„IP :</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[root@iZ28by3xm9eZ bin]<span class="comment"># vim Denyhosts.txt</span></div><div class="line"></div><div class="line">101.69.252.146=1</div><div class="line">115.196.20.181=11</div><div class="line">117.243.176.226=6</div><div class="line">186.208.19.61=5</div><div class="line">186.251.118.71=3</div><div class="line">89.238.64.148=2</div><div class="line">94.215.141.101=1</div></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘è®°å½•äº†æ”»å‡»çš„å¤šå°‘æ¬¡ä¹Ÿæœ‰çš„ã€‚</p>
<p>å¯æ˜¯å‘ç°çš„ç¡®åœ¨ç»§ç»­æ”»å‡»ï¼Œæˆ‘åœ¨æƒ³å¦‚ä½•é˜»æ­¢è¢«ç ´è§£å‘¢ã€‚</p>
<p>ä¸»è¦æ˜¯ä¾é denyhostè½¯ä»¶ã€‚ç¨³é‡æ‰€è®²çš„æ˜¯ä¸‹è½½å®‰è£…åŒ…å®‰è£…ï¼Œå®é™…ä¸Šå¯ä»¥ä»ç›´æ¥ä½¿ç”¨yumæˆ–è€…aptå®‰è£…ï¼Œæ‰¾åˆ°ç›¸åº”çš„æºå°±å¯ä»¥ã€‚ä¸‹è¾¹æ˜¯å¸–å­åŸæ–‡ï¼š DenyHostså®˜æ–¹ç½‘ç«™ä¸ºï¼š<a href="http://denyhosts.sourceforge.net" target="_blank" rel="external">http://denyhosts.sourceforge.net</a></p>
<p>è¿™é‡Œä¸‹è½½æœ€æ–°çš„ç‰ˆæœ¬æ˜¯2008å¹´ 2.6 ç‰ˆæœ¬çš„ ä¸€ç›´æ²¡æ›´æ–°ã€‚ä¸è¿‡å·²ç»è¶³å¤Ÿå¼ºå¤§ã€‚ 1. å®‰è£…</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># tar -zxvf DenyHosts-2.6.tar.gz</span></div><div class="line"><span class="comment"># cd DenyHosts-2.6</span></div><div class="line"><span class="comment"># python setup.py install</span></div></pre></td></tr></table></figure>
<p>é»˜è®¤æ˜¯å®‰è£…åˆ°/usr/share/denyhostsç›®å½•çš„ã€‚</p>
<p>1.é…ç½®</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment"># cd /usr/share/denyhosts/</span></div><div class="line"><span class="comment"># cp denyhosts.cfg-dist denyhosts.cfg</span></div><div class="line"><span class="comment"># vi denyhosts.cfg</span></div><div class="line">PURGE_DENY = 50m <span class="comment">#è¿‡å¤šä¹…åæ¸…é™¤å·²é˜»æ­¢IP</span></div><div class="line">HOSTS_DENY = /etc/hosts.deny </div><div class="line"><span class="comment">#å°†é˜»æ­¢IPå†™å…¥åˆ°hosts.deny</span></div><div class="line">BLOCK_SERVICE = sshd </div><div class="line"><span class="comment">#é˜»æ­¢æœåŠ¡å</span></div><div class="line">DENY_THRESHOLD_INVALID = 1 </div><div class="line"><span class="comment">#å…è®¸æ— æ•ˆç”¨æˆ·ç™»å½•å¤±è´¥çš„æ¬¡æ•°</span></div><div class="line">DENY_THRESHOLD_VALID = 10 </div><div class="line"><span class="comment">#å…è®¸æ™®é€šç”¨æˆ·ç™»å½•å¤±è´¥çš„æ¬¡æ•°</span></div><div class="line">DENY_THRESHOLD_ROOT = 5 </div><div class="line"><span class="comment">#å…è®¸rootç™»å½•å¤±è´¥çš„æ¬¡æ•°</span></div><div class="line">WORK_DIR = /usr/<span class="built_in">local</span>/share/denyhosts/data</div><div class="line"><span class="comment">#å°†denyçš„hostæˆ–ipçºªå½•åˆ°Work_dir</span></div><div class="line">DENY_THRESHOLD_RESTRICTED = 1 </div><div class="line"><span class="comment">#è®¾å®š deny host å†™å…¥åˆ°è¯¥èµ„æ–™å¤¹</span></div><div class="line">LOCK_FILE = /var/lock/subsys/denyhosts <span class="comment">#å°†DenyHOtså¯åŠ¨çš„pidçºªå½•åˆ°LOCK_FILEä¸­ï¼Œå·²ç¡®ä¿æœåŠ¡æ­£ç¡®å¯åŠ¨ï¼Œé˜²æ­¢åŒæ—¶å¯åŠ¨å¤šä¸ªæœåŠ¡ã€‚</span></div><div class="line">HOSTNAME_LOOKUP=NO <span class="comment">#æ˜¯å¦åšåŸŸååè§£            ADMIN_EMAIL = #è®¾ç½®ç®¡ç†å‘˜é‚®ä»¶åœ°å€</span></div><div class="line">DAEMON_LOG = /var/<span class="built_in">log</span>/denyhosts <span class="comment">#è‡ªå·±çš„æ—¥å¿—æ–‡ä»¶</span></div><div class="line">DAEMON_PURGE = 10m <span class="comment">#è¯¥é¡¹ä¸PURGE_DENY è®¾ç½®æˆä¸€æ ·ï¼Œä¹Ÿæ˜¯æ¸…é™¤hosts.deniedssh ç”¨æˆ·çš„æ—¶é—´ã€‚</span></div></pre></td></tr></table></figure>
<p>2.è®¾ç½®å¯åŠ¨è„šæœ¬</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># cp daemon-control-dist daemon-control</span></div><div class="line"><span class="comment"># chown root daemon-control</span></div><div class="line"><span class="comment"># chmod 700 daemon-control</span></div></pre></td></tr></table></figure>
<p>å®Œäº†ä¹‹åæ‰§è¡Œdaemon-contron startå°±å¯ä»¥äº†ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># ./daemon-control start</span></div></pre></td></tr></table></figure>
<p>å¦‚æœè¦ä½¿DenyHostsæ¯æ¬¡é‡èµ·åè‡ªåŠ¨å¯åŠ¨è¿˜éœ€åšå¦‚ä¸‹è®¾ç½®ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># ln -s /usr/share/denyhosts/daemon-control                 /etc/init.d/denyhosts</span></div><div class="line"><span class="comment"># chkconfig --add denyhosts</span></div><div class="line"><span class="comment"># chkconfig denyhosts on</span></div></pre></td></tr></table></figure>
<p>ç„¶åå°±å¯ä»¥å¯åŠ¨äº†ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># service denyhosts start</span></div></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹çœ‹/etc/hosts.denyå†…æ˜¯å¦æœ‰ç¦æ­¢çš„IPï¼Œæœ‰çš„è¯è¯´æ˜å·²ç»æˆåŠŸäº†ã€‚</p>
<p>å¯åŠ¨å‡ºç°é”™è¯¯è§£å†³ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./daemon-control start</div></pre></td></tr></table></figure>
<p>å‡ºç°ï¼š<code>starting DenyHosts: /usr/bin/env python /usr/bin/denyhosts.py --daemon --config=/usr/share/denyhosts/denyhosts.cfg 
DenyHosts could not obtain lock (pid: ) 
[Errno 17] File exists: &#39;/var/lock/subsys/denyhosts&#39;</code> ä½¿ç”¨ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"> touch /private/var/<span class="built_in">log</span>/system.log</div><div class="line"> touch /var/lock/subsys/denyhosts</div><div class="line">rm <span class="_">-f</span> /var/lock/subsys/denyhosts</div><div class="line"></div><div class="line">./daemon-control start</div><div class="line">starting DenyHosts: /usr/bin/env python /usr/bin/denyhosts.py â€“daemon â€“config=/usr/share/denyhosts/denyhosts.cfg </div><div class="line">OKï¼</div></pre></td></tr></table></figure>
<p>å¯åŠ¨å®Œæˆå•¦ã€‚ ä½ å¯ä»¥ä½¿ç”¨</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">service denyhosts statusæ¥æŸ¥çœ‹è¿è¡ŒçŠ¶æ€</div></pre></td></tr></table></figure>
<p>DenyHosts is running with pid = 25874 è¡¨ç¤ºå·²ç»å¯åŠ¨èµ·æ¥äº†ã€‚<br>æ¥ä¸‹æ¥å°±å¯ä»¥ä½¿ç”¨</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cat /etc/hosts.denyæ¥æŸ¥çœ‹è®°å½•äº†</div></pre></td></tr></table></figure>
<p>ç„¶åå¯åŠ¨æˆåŠŸä»¥åï¼Œæˆ‘è‡ªå·±æµ‹è¯•äº†ä¸‹ï¼Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">ssh root@115.28.175.207</div><div class="line">root@115.28.175.207<span class="string">'s password:</span></div><div class="line">Permission denied, please try again.</div><div class="line">root@115.28.175.207's password:</div><div class="line">cPermission denied, please try again.</div><div class="line">root@115.28.175.207<span class="string">'s password:</span></div><div class="line">Permission denied (publickey,gssapi-keyex,gssapi-with-mic,password).</div></pre></td></tr></table></figure>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/aliyundun5.png" alt=""></figure></p>
<p>å‘ç°è‡ªå·±ç™»é™†ä¸ä¸Šå»äº†ï¼Œç„¶ååªèƒ½å»é˜¿é‡Œæ§åˆ¶å°æ“ä½œæŸ¥çœ‹åŸå› ã€‚</p>
<p>åŸæ¥å‘ç° <code>cat /etc/hosts.deny</code>æ¥æŸ¥çœ‹è®°å½•äº†<br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/aliyundun6.png" alt=""></figure></p>
<p>ç„¶åå»æ‰ï¼Œ115IP å‘ç°å°±å¯ä»¥ç™»é™†äº†ã€‚ æ‰€ä»¥æˆ‘åšçš„è®¾ç½®æ˜¯<code>root</code>å°è¯•ç ´è§£4æ¬¡ä»¥ä¸Šï¼Œè¢«é”å®šã€‚</p>

	

	

</article>




	<article>
	
		<h1><a href="/2016/06/22/æ€§èƒ½ç›‘æ§/Zabbix/zabbix3-0å®ç°å¾®ä¿¡æŠ¥è­¦/">zabbix3.0å®ç°å¾®ä¿¡æŠ¥è­¦</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-06-22</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/monitoring/">monitoring</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Zabbix-monitoring/">Zabbix monitoring</a>
			</span>
		
	</div>

	

	
		<h3 id="å‰è¨€ï¼š"><a href="#å‰è¨€ï¼š" class="headerlink" title="å‰è¨€ï¼š"></a>å‰è¨€ï¼š</h3><p>  å› ä¸ºæˆ‘å·²ç»åœ¨<code>æµ‹è¯•ç¯å¢ƒ</code>å’ŒÂ·ç”Ÿäº§ç¯å¢ƒÂ·éƒ½å®ç°äº†å¾®ä¿¡å’Œé‚®ä»¶å‘Šè­¦ã€‚ä»Šå¤©æœ‰ç©ºå°±å†™äº†ç¯‡æ–‡æ¡£åæœŸå¯ä»¥åœ¨å¤ä¹ ä¸‹ï¼Œç°å®ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨é‚®ä»¶å’ŒçŸ­ä¿¡æ¥å—zabbixæŠ¥è­¦ä¿¡æ¯ï¼Œä½†æ˜¯é‚®ä»¶ç»å¸¸è¢«å·¥ä½œäººå‘˜æç½®åœ¨è§’è½ä¸­ç”šè‡³è¢«è®¾ç½®ä¸ºåƒåœ¾é‚®ä»¶è¢«è¿‡æ»¤æ‰ã€‚å…¬å¸çš„çŸ­ä¿¡æ¥å£åˆå¤ªè´µï¼Œå¤æ‚ç¯å¢ƒä¸­ä½¿ç”¨çŸ­æ¯æŠ¥è­¦ä¼šä½¿è¿ç»´æˆæœ¬å¢åŠ å¾ˆå¤šã€‚å¾®ä¿¡æä¾›äº†å¾ˆå¥½çš„ç¬¬ä¸‰æ–¹æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å¾®ä¿¡æŠ¥è­¦ä»¥æ±‚é™ä½è¿ç»´æˆæœ¬ã€‚</p>
<p>   è¿™é‡Œæˆ‘ç°åœ¨å…¬å¸ä¹Ÿç”¨ç¬¬ä¸‰æ–¹çš„<code>ç”µè¯çŸ­ä¿¡çŒ«åšå‘Šè­¦</code>ï¼Œä¸¥é‡çš„æ•…éšœä¼šç”¨çŸ­ä¿¡æ¥å‘é€åˆ°æŒ‡å®šçš„è¿ç»´äººå‘˜ã€‚è¿™æ ·å³ä½¿å¾®ä¿¡å’Œé‚®ä»¶éƒ½æ²¡æœ‰æ‰“å¼€æ”¶åˆ°ï¼ŒçŸ­ä¿¡å’Œç”µè¯ä¼šç¬¬ä¸€æ—¶é—´é€šçŸ¥ã€‚</p>
<h3 id="å¾®ä¿¡å‘Šè­¦çš„å¥½å¤„ï¼š"><a href="#å¾®ä¿¡å‘Šè­¦çš„å¥½å¤„ï¼š" class="headerlink" title="å¾®ä¿¡å‘Šè­¦çš„å¥½å¤„ï¼š"></a>å¾®ä¿¡å‘Šè­¦çš„å¥½å¤„ï¼š</h3><p>ç¬¬ä¸€ï¼šå¯ä»¥åŠæ—¶é€šçŸ¥æ—¶é—´é€šçŸ¥è¿ç»´äººå‘˜ã€‚åŠæ—¶çš„è§£å†³æ•…éšœã€‚</p>
<p>ç¬¬äºŒï¼šä¸‹ç­å‘¨æœ«è¯¾ä½™æ—¶é—´å¯ä»¥å‡†æ—¶æ¥æ”¶åˆ°ã€‚</p>
<h3 id="å®‰è£…ä¸é…ç½®ï¼š"><a href="#å®‰è£…ä¸é…ç½®ï¼š" class="headerlink" title="å®‰è£…ä¸é…ç½®ï¼š"></a>å®‰è£…ä¸é…ç½®ï¼š</h3><p>å¾®ä¿¡çš„ç¬¬ä¸‰æ–¹æ¥å£è¦æ±‚æˆ‘ä»¬å…ˆç”³è¯·ä¸€ä¸ªä¼ä¸šå·â€”â€”ä¼ é€é—¨ï¼š<a href="https://qy.weixin.qq.com/" target="_blank" rel="external">å¾®ä¿¡ä¼ä¸šå…¬ä¼—å·å¹³å°</a></p>
<p>  ç¬¬ä¸€æ­¥ï¼šç”³è¯·å¾®ä¿¡å…¬ä¼—å·<br> <figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin1.png" alt=""></figure><br> <figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin2.png" alt=""></figure><br> <figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin3.png" alt=""></figure><br> <figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin4.png" alt=""></figure><br> <figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin5.png" alt=""></figure><br> <figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin6.png" alt=""></figure><br> <figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin7.png" alt=""></figure><br> <figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin8.png" alt=""></figure><br> <figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin9.png" alt=""></figure><br> <figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin10.png" alt=""></figure></p>
<p>è¿™é‡Œè·Ÿå¾®ä¿¡ç»‘å®šåæœŸç™»é™†åªéœ€è¦æ‰«æä¸‹äºŒç»´ç å°±å¯ä»¥äº†ã€‚</p>
<p>å¦‚ä½•ç”³è¯·ä¹Ÿå¯å‚è€ƒè¿™ç¯‡æ–‡æ¡£ï¼š<a href="http://itnihao.blog.51cto.com/1741976/1733245" target="_blank" rel="external">ç”³è¯·å¾®ä¿¡å…¬ä¼—å·</a></p>
<h3 id="å¦‚ä½•æ“ä½œä¼ä¸šå·ï¼Ÿ"><a href="#å¦‚ä½•æ“ä½œä¼ä¸šå·ï¼Ÿ" class="headerlink" title="å¦‚ä½•æ“ä½œä¼ä¸šå·ï¼Ÿ"></a>å¦‚ä½•æ“ä½œä¼ä¸šå·ï¼Ÿ</h3><p>1.é€šè®¯å½•æ·»åŠ ä¼ä¸šæˆå‘˜</p>
<p> æˆ‘ä»¬è¦æå‰æŠŠæˆå‘˜ä¿¡æ¯æ·»åŠ è¿›ç»„ç»‡éƒ¨é—¨ï¼Œå¿…å¡«é¡¹+æ‰‹æœºå·æˆ–è€…å¾®ä¿¡å·ï¼Œè¿™æ ·åˆ«äººæ‰«æäºŒç»´ç çš„æ—¶å€™æ‰èƒ½æˆåŠŸå…³æ³¨ä¼ä¸šå·ã€‚<br>æ³¨æ„ï¼šè¿™é‡Œæœ‰ä¸¤ä¸ªæˆ‘ä»¬è¦ç”¨åˆ°ä¿¡æ¯ï¼Œä¸€ä¸ªç»„ç»‡éƒ¨é—¨çš„IDï¼Œä¸€ä¸ªéƒ¨é—¨æˆå‘˜çš„è´¦å·ï¼ˆè´¦å·æ˜¯è‡ªå·±æ‰‹åŠ¨æŒ‡å®šçš„ï¼Œä¸åŒäºå¾®ä¿¡å·ï¼Œæœ€å¥½æ˜¯å­—æ¯åŠ æ•°å­—ï¼‰</p>
<p> <figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin12.png" alt=""></figure><br> <figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin13.png" alt=""></figure></p>
<p> 2.åº”ç”¨ä¸­å¿ƒåˆ›å»ºåº”ç”¨</p>
<pre><code>æˆ‘ä»¬è¦åœ¨è¿™é‡Œåˆ›å»ºåº”ç”¨ï¼Œå› ä¸ºè¦é€šè¿‡åº”ç”¨å‘é€æ¶ˆæ¯ç»™éƒ¨é—¨æˆå‘˜
æ³¨æ„ï¼šè¿™é‡Œè¦è®°ä½ä¸€ä¸ªå€¼ï¼Œåº”ç”¨ID
</code></pre><p> <figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin14.png" alt=""></figure><br> <figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin15.png" alt=""></figure><br> <figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin16.png" alt=""></figure></p>
<p> 3.ç»™éƒ¨é—¨è®¾ç½®ç®¡ç†å‘˜</p>
<pre><code>è®¾ç½®---&gt;åŠŸèƒ½è®¾ç½®----&gt;æƒé™ç®¡ç†----&gt;æ–°å»ºç®¡ç†ç»„
ç®¡ç†å‘˜å¿…é¡»äº‹å…ˆå·²ç»å…³æ³¨äº†ä¼ä¸šå·ï¼Œå¹¶ä¸”å·²ç»è®¾ç½®å¥½é‚®ç®±åœ°å€  
</code></pre><p> <figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin17.png" alt=""></figure><br> <figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin18.png" alt=""></figure></p>
<p>  ç¡®å®šç®¡ç†å‘˜å¯ä»¥è¯»å–é€šè®¯å½•ï¼Œå¯ä»¥ä½¿ç”¨åº”ç”¨å‘æ¶ˆæ¯ã€‚<br>  <code>æ³¨æ„ï¼šæˆ‘ä»¬éœ€è¦ç®¡ç†å‘˜çš„CorpIDå’ŒSecret</code></p>
<p> <figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin19.png" alt=""></figure></p>
<p>   æˆ‘ä»¬è¦å‡†å¤‡è¿™äº›ä¸œè¥¿ï¼š</p>
<pre><code>ä¸€ä¸ªå¾®ä¿¡ä¼ä¸šå·
ä¼ä¸šå·å·²ç»è¢«éƒ¨é—¨æˆå‘˜å…³æ³¨
ä¼ä¸šå·é‡Œæœ‰ä¸€ä¸ªå¯ä»¥å‘æ¶ˆæ¯çš„åº”ç”¨
ä¸€ä¸ªæˆæƒç®¡ç†å‘˜ï¼Œå¯ä»¥ä½¿ç”¨è¯¥åº”ç”¨ç»™æˆå‘˜å‘æ¶ˆæ¯
</code></pre><p>æˆ‘ä»¬è¦å–åˆ°è¿™äº›ä¿¡æ¯ï¼š</p>
<pre><code>æˆå‘˜è´¦å·
ç»„ç»‡éƒ¨é—¨ID
åº”ç”¨ID
CropID
Secret
</code></pre><p>å¦‚ä½•è°ƒç”¨å¾®ä¿¡æ¥å£ï¼Ÿ</p>
<p>  è°ƒç”¨å¾®ä¿¡æ¥å£éœ€è¦ä¸€ä¸ªè°ƒç”¨æ¥å£çš„å‡­è¯ï¼šaccess_token</p>
<pre><code>é€šè¿‡ ï¼šCropID ã€Secret  æ‰èƒ½è·å–åˆ°access_tokenï¼Œä½†æ˜¯è·å–åˆ°çš„tokenæœ‰æ•ˆæœŸä¸ºä¸¤åˆ†é’Ÿ
</code></pre><p>å¾®ä¿¡ä¼ä¸šå·æ¥å£è°ƒè¯•å·¥å…·ä¼ é€é—¨ï¼š<a href="http://qydev.weixin.qq.com/debug" target="_blank" rel="external">http://qydev.weixin.qq.com/debug</a></p>
<p> <figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin20.png" alt=""></figure><br> <figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin21.png" alt=""></figure></p>
<h3 id="æµ‹è¯•æ˜¯å¦å¯é€šï¼š"><a href="#æµ‹è¯•æ˜¯å¦å¯é€šï¼š" class="headerlink" title="æµ‹è¯•æ˜¯å¦å¯é€šï¼š"></a>æµ‹è¯•æ˜¯å¦å¯é€šï¼š</h3><p>  ä½¿ç”¨ï¼š</p>
<pre><code>curl -s -G  url    è·å– AccessToke
</code></pre><p>  ä½¿ç”¨ï¼š</p>
<pre><code>curl --data  url  ä¼ é€å‡­è¯è°ƒç”¨ä¼ä¸šå·æ¥å£
</code></pre><p>è¿™é‡Œå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼š</p>
<p> curl -s -G  url  è·å– AccessTokeæ—¶å€™ä¸ºä»€ä¹ˆæˆ‘åœ¨ç”¨ä¼ä¸šå·å‘é€æ¶ˆæ¯çš„æ—¶å€™æ€»æ˜¯è¿”å›<code>{&quot;errcode&quot;:41004,&quot;errmsg&quot;:&quot;corpsecret missingâ€}</code>å‘¢ï¼Ÿ</p>
<p> <figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin22.png" alt=""></figure></p>
<p>ä¸»è¦åŸå› ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">â€œ41004â€è¯´æ˜ï¼šç¼ºå°‘secretå‚æ•°ï¼Œè¯·æ’æŸ¥ç›¸å…³é—®é¢˜ã€‚</div><div class="line"></div><div class="line">ç”¨â€œâ€æŠŠurlæ‹¬èµ·æ¥å°±OKï¼Œå³curl <span class="_">-s</span> -G <span class="string">"url"</span>ï¼Œä¼°è®¡ä½ å·²ç»è§£å†³äº†ï¼Œå¸®åŠ©åæ¥è€…å§ã€‚</div></pre></td></tr></table></figure>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin23.png" alt=""></figure></p>
<p>è¿™ä¸ªé—®é¢˜å¾ˆæ£˜æ‰‹ï¼Œä¸€å¼€å§‹å¼„æäº†ä¸€ä¸ªåŠä¸ªå°æ—¶åé¢çœ‹åˆ°ä¸€ç¯‡è¿‡æ¥äººçš„æ–‡ç« å¸®åŠ©äº†æˆ‘ï¼š<br>è¿™é‡Œæˆ‘ä¹Ÿè´´å‡ºæ¥äº†ã€‚<a href="å‚è€ƒé“¾æ¥ï¼šhttp://qydev.weixin.qq.com/qa/index.php?qa=16596&amp;qa_1=%E4%B8%BA%E4%BB%80%E4%B9%88%E6%88%91%E5%9C%A8%E7%94%A8%E4%BC%81%E4%B8%9A%E5%8F%B7%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF%E7%9A%84%E6%97%B6%E5%80%99%E6%80%BB%E6%98%AF%E8%BF%94%E5%9B%9E">å‚è€ƒæ–‡æ¡£</a></p>
<h3 id="pythonè„šæœ¬åŸç†"><a href="#pythonè„šæœ¬åŸç†" class="headerlink" title="pythonè„šæœ¬åŸç†"></a>pythonè„šæœ¬åŸç†</h3><pre><code> ä½¿ç”¨ï¼š

 self.__corpid =  corpid

 ä½¿ç”¨ï¼š

self.__secret = secret     ä¼ é€å‡­è¯è°ƒç”¨ä¼ä¸šå·æ¥å£
</code></pre><p>è„šæœ¬å·²è´´å‡ºæ¥äº†ï¼Œå¯ä»¥ä¸‹è½½ <a href="http://oak0aohum.bkt.clouddn.com/weixin4.py" target="_blank" rel="external">weixin.py</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div></pre></td><td class="code"><pre><div class="line">**<span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"></div><div class="line">import urllib,urllib2,json</div><div class="line">import sys</div><div class="line">import logging</div><div class="line">reload(sys)</div><div class="line">sys.setdefaultencoding( <span class="string">"utf-8"</span> )</div><div class="line"></div><div class="line">class WeChat(object):</div><div class="line">	__token_id = <span class="string">''</span></div><div class="line">	<span class="comment"># init attribute</span></div><div class="line">	def __init__(self,url):</div><div class="line">		self.__url = url.rstrip(<span class="string">'/'</span>)</div><div class="line">		self.__corpid = <span class="string">'xxx'</span></div><div class="line">		self.__secret = <span class="string">'xxx'</span></div><div class="line"></div><div class="line">	<span class="comment"># Get TokenID</span></div><div class="line">	def authID(self):</div><div class="line">		params = &#123;<span class="string">'corpid'</span>:self.__corpid, <span class="string">'corpsecret'</span>:self.__secret&#125;</div><div class="line">		data = urllib.urlencode(params)</div><div class="line"></div><div class="line">		content = self.getToken(data)</div><div class="line"></div><div class="line">		try:</div><div class="line">			self.__token_id = content[<span class="string">'access_token'</span>]</div><div class="line">			<span class="comment"># print content['access_token']</span></div><div class="line">		except KeyError:</div><div class="line">			raise KeyError</div><div class="line"></div><div class="line">	<span class="comment"># Establish a connection</span></div><div class="line">	def getToken(self,data,url_prefix=<span class="string">'/'</span>):</div><div class="line">		url = self.__url + url_prefix + <span class="string">'gettoken?'</span></div><div class="line">		try:</div><div class="line">			response = urllib2.Request(url + data)</div><div class="line">		except KeyError:</div><div class="line">			raise KeyError</div><div class="line">		result = urllib2.urlopen(response)</div><div class="line">		content = json.loads(result.read())</div><div class="line">		<span class="built_in">return</span> content</div><div class="line"></div><div class="line">	<span class="comment"># Get sendmessage url</span></div><div class="line">	def postData(self,data,url_prefix=<span class="string">'/'</span>):</div><div class="line">		url = self.__url + url_prefix + <span class="string">'message/send?access_token=%s'</span> % self.__token_id</div><div class="line">		request = urllib2.Request(url,data)</div><div class="line">		try:</div><div class="line">			result = urllib2.urlopen(request)</div><div class="line">		except urllib2.HTTPError as e:</div><div class="line">			<span class="keyword">if</span> hasattr(e,<span class="string">'reason'</span>):</div><div class="line">				<span class="built_in">print</span> <span class="string">'reason'</span>,e.reason</div><div class="line">			<span class="keyword">elif</span> hasattr(e,<span class="string">'code'</span>):</div><div class="line">				<span class="built_in">print</span> <span class="string">'code'</span>,e.code</div><div class="line">			<span class="built_in">return</span> 0</div><div class="line">		<span class="keyword">else</span>:</div><div class="line">			content = json.loads(result.read())</div><div class="line">			result.close()</div><div class="line">		<span class="built_in">return</span> content</div><div class="line"></div><div class="line">	<span class="comment"># send message</span></div><div class="line">	def sendMessage(self,touser,message):</div><div class="line"></div><div class="line">		self.authID()</div><div class="line"></div><div class="line">		data = json.dumps(&#123;</div><div class="line">			<span class="string">'touser'</span>:touser,</div><div class="line">			<span class="string">'toparty'</span>:<span class="string">"3"</span>,</div><div class="line">			<span class="string">'msgtype'</span>:<span class="string">"text"</span>,</div><div class="line">			<span class="string">'agentid'</span>:<span class="string">"3"</span>,</div><div class="line">			<span class="string">'text'</span>:&#123;</div><div class="line">				<span class="string">'content'</span>:message</div><div class="line">			&#125;,</div><div class="line">			<span class="string">'safe'</span>:<span class="string">"0"</span></div><div class="line">		&#125;,ensure_ascii=False)</div><div class="line"></div><div class="line">		response = self.postData(data)</div><div class="line"></div><div class="line">		log_file = <span class="string">"/home/zabbix/weixin.log"</span></div><div class="line"></div><div class="line">		logging.basicConfig(filename=log_file,filemode=<span class="string">'a'</span>,level=logging.DEBUG)</div><div class="line">		logging.info(data)</div><div class="line">		logging.debug(response)</div><div class="line">		<span class="built_in">print</span> response</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">        <span class="keyword">if</span> len(sys.argv) != 4:</div><div class="line">            <span class="built_in">print</span> <span class="string">'error segments, now exit'</span></div><div class="line">            sys.exit()</div><div class="line">	a = WeChat(<span class="string">'https://qyapi.weixin.qq.com/cgi-bin'</span>)</div><div class="line">	a.sendMessage(sys.argv[1],sys.argv[3])</div></pre></td></tr></table></figure>
<pre><code>log_file = &quot;/home/zabbix/weixin.log&quot; å¾®ä¿¡æ—¥å¿—
&apos;toparty&apos;:&quot;3&quot;,

 &apos;agentid&apos;:&quot;3&quot;, è¿™é‡Œ3 æ˜¯æˆ‘è¿™è¾¹åº”ç”¨ID 3
touserå¦æˆå‘˜IDåˆ—è¡¨ï¼ˆæ¶ˆæ¯æ¥æ”¶è€…ï¼Œå¤šä¸ªæ¥æ”¶è€…ç”¨â€˜|â€™åˆ†éš”ï¼Œæœ€å¤šæ”¯æŒ1000ä¸ªï¼‰ã€‚ç‰¹æ®Šæƒ…å†µï¼šæŒ‡å®šä¸º@allï¼Œåˆ™å‘å…³æ³¨è¯¥ä¼ä¸šåº”ç”¨çš„å…¨éƒ¨æˆå‘˜å‘é€
topartyå¦éƒ¨é—¨IDåˆ—è¡¨ï¼Œå¤šä¸ªæ¥æ”¶è€…ç”¨â€˜|â€™åˆ†éš”ï¼Œæœ€å¤šæ”¯æŒ100ä¸ªã€‚å½“touserä¸º@allæ—¶å¿½ç•¥æœ¬å‚æ•°
totagå¦æ ‡ç­¾IDåˆ—è¡¨ï¼Œå¤šä¸ªæ¥æ”¶è€…ç”¨â€˜|â€™åˆ†éš”ã€‚å½“touserä¸º@allæ—¶å¿½ç•¥æœ¬å‚æ•°
msgtypeæ˜¯æ¶ˆæ¯ç±»å‹ï¼Œæ­¤æ—¶å›ºå®šä¸ºï¼štext
agentidæ˜¯ä¼ä¸šåº”ç”¨çš„idï¼Œæ•´å‹ã€‚å¯åœ¨åº”ç”¨çš„è®¾ç½®é¡µé¢æŸ¥çœ‹
contentæ˜¯æ¶ˆæ¯å†…å®¹
safeå¦è¡¨ç¤ºæ˜¯å¦æ˜¯ä¿å¯†æ¶ˆæ¯ï¼Œ0è¡¨ç¤ºå¦ï¼Œ1è¡¨ç¤ºæ˜¯ï¼Œé»˜è®¤0


&quot;touser&quot;:&quot;touser&quot;,   #ä¼ä¸šå·ä¸­çš„ç”¨æˆ·å¸å·ï¼Œåœ¨zabbixç”¨æˆ·Mediaä¸­é…ç½®ï¼Œå¦‚æœé…ç½®ä¸æ­£å¸¸ï¼Œå°†æŒ‰éƒ¨é—¨å‘é€ã€‚
æ–‡ä¸­ä½¿ç”¨çš„ç”¨æˆ·, toparty éƒ¨é—¨iDä¸º3ï¼Œagentid åº”ç”¨IDä¸º3.
</code></pre><h3 id="ä¸ºä»€ä¹ˆè¦è¿™æ ·å†™è„šæœ¬ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦è¿™æ ·å†™è„šæœ¬ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦è¿™æ ·å†™è„šæœ¬ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦è¿™æ ·å†™è„šæœ¬ï¼Ÿ</h3><p>å› ä¸ºå¾®ä¿¡ä¼ä¸šå·å¼€æ”¾çš„ç«¯å£æœ‰å›ºå®šçš„æ ¼å¼é™åˆ¶<br> ä¼ä¸šå·æ”¯æŒçš„æ ¼å¼ï¼š<a href="http://qydev.weixin.qq.com/wiki/index.php?title=æ¶ˆæ¯ç±»å‹åŠæ•°æ®æ ¼å¼" target="_blank" rel="external">http://qydev.weixin.qq.com/wiki/index.php?title=æ¶ˆæ¯ç±»å‹åŠæ•°æ®æ ¼å¼</a></p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin24.png" alt=""></figure></p>
<p>å°†è„šæœ¬æ”¾å…¥zabbixé»˜è®¤æ‰§è¡Œè·¯å¾„ä¸‹</p>
<pre><code>mv weixin.sh /usr/local/zabbix/share/zabbix/alertscripts
chown zabbix.zabbix /usr/local/zabbix/share/zabbix/alertscripts/weixin.py
chmod +x /usr/local/zabbix/share/zabbix/alertscripts/weixin.py
</code></pre><hr>
<p>åˆ°è¿™é‡Œä¸Šé¢åŸºæœ¬çš„å·²ç»é…ç½®å®Œæ¯•äº†ã€‚</p>
<h3 id="æµ‹è¯•è„šæœ¬æ˜¯å¦å¯ä»¥å‘é€æˆåŠŸæ¶ˆæ¯"><a href="#æµ‹è¯•è„šæœ¬æ˜¯å¦å¯ä»¥å‘é€æˆåŠŸæ¶ˆæ¯" class="headerlink" title="æµ‹è¯•è„šæœ¬æ˜¯å¦å¯ä»¥å‘é€æˆåŠŸæ¶ˆæ¯"></a>æµ‹è¯•è„šæœ¬æ˜¯å¦å¯ä»¥å‘é€æˆåŠŸæ¶ˆæ¯</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@salt alertscripts]<span class="comment"># python weixin.py test world!</span></div><div class="line">&#123;<span class="string">u'errcode'</span>: <span class="number">60011</span>, <span class="string">u'errmsg'</span>: <span class="string">u'no privilege to access/modify contact/party/agent '</span>&#125;</div></pre></td></tr></table></figure>
<p>å‡ºç°æˆ‘æ˜¯ä¼ä¸šå·ä½“éªŒè´¦æˆ· æˆ‘å‘é€æ¶ˆæ¯ï¼šå¾®ä¿¡é”™è¯¯ errcode=60011. å¯å‚è€ƒï¼š<a href="http://qydev.weixin.qq.com/qa/index.php?qa=3197&amp;qa_1=%E6%88%91%E6%98%AF%E4%BC%81%E4%B8%9A%E5%8F%B7%E4%BD%93%E9%AA%8C%E8%B4%A6%E6%88%B7-%E6%88%91%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF%EF%BC%9A%E5%BE%AE%E4%BF%A1%E9%94%99%E8%AF%AF&amp;show=3197#q3197" target="_blank" rel="external">å¾®ä¿¡é”™è¯¯ errcode=60011</a></p>
<p>æˆ‘è¿™é‡Œçš„åŸå› æ˜¯åº”ç”¨IDä¸€å¼€å§‹å†™1ï¼Œåæ¥æ”¹æˆ3æµ‹è¯•å°±é€šäº†ã€‚</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@salt alertscripts]<span class="comment"># python weixin.py test hello world!</span></div><div class="line">&#123;<span class="string">u'invaliduser'</span>: <span class="string">u'all user invalid'</span>, <span class="string">u'errcode'</span>: <span class="number">0</span>, <span class="string">u'errmsg'</span>: <span class="string">u'ok'</span>&#125;</div></pre></td></tr></table></figure>
<p>è¿™é‡Œç”¨æˆ·å…³æ³¨äº†ä»¥åï¼š</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@salt alertscripts]<span class="comment"># python weixin.py jinyu hello world!</span></div><div class="line">&#123;<span class="string">u'errcode'</span>: <span class="number">0</span>, <span class="string">u'errmsg'</span>: <span class="string">u'ok'</span>&#125;</div></pre></td></tr></table></figure>
<h3 id="webæœåŠ¡ç«¯é…ç½®ï¼š"><a href="#webæœåŠ¡ç«¯é…ç½®ï¼š" class="headerlink" title="webæœåŠ¡ç«¯é…ç½®ï¼š"></a>webæœåŠ¡ç«¯é…ç½®ï¼š</h3><p>è‡³æ­¤å·¥å…·å®‰è£…å®Œæˆï¼Œåœ¨zabbixç•Œé¢é‡Œæ·»åŠ è„šæœ¬å‘Šè­¦</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin25.png" alt=""></figure></p>
<p>è®¾ç½®è„šæœ¬ï¼Œè„šæœ¬åç§°ä¸ºå·¥å…·åç§°ï¼Œè®¾ç½®å¥½ç‚¹æ·»åŠ æŒ‰é’®</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin26.png" alt=""></figure></p>
<p>æ·»åŠ æ–°çš„æŠ¥è­¦åª’ä»‹åˆ°ç”¨æˆ·ï¼Œæˆ‘ä»¥Adminç”¨æˆ·ä¸ºä¾‹</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin27.png" alt=""></figure><br>æ·»åŠ </p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin28.png" alt=""></figure></p>
<p>é€‰æ‹©åˆšæ‰çš„åª’ä»‹ï¼Œæ”¶ä»¶äººä¸ºæˆ‘æä¾›çš„UserIDï¼Œå¤šä¸ªç”¨æˆ·ç”¨ï½œéš”å¼€</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin29.png" alt=""></figure></p>
<p>æ·»åŠ åä¸€ç‚¹è¦ç‚¹æ›´æ–°</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin30.png" alt=""></figure></p>
<p>æˆ‘ä»¬åœ¨è¿™é‡Œç‹¬ç«‹è®¾ç½®ä¸€ä¸ªActionï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥åœ¨é»˜è®¤çš„Actioné‡Œæ·»åŠ </p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin31.png" alt=""></figure></p>
<p>åç§°ä¸ºweixin</p>
<p>å‘Šè­¦æ¶ˆæ¯çš„æ ¼å¼ï¼Œå¤§å®¶å¯ä»¥æ ¹æ®è‡ªå·±éœ€æ±‚å…·ä½“è®¾ç½®ï¼Œä¸‹é¢æ˜¯æˆ‘çš„è®¾ç½®<br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin32.png" alt=""></figure></p>
<p>é»˜è®¤æ¥æ”¶äººï¼šæ•…éšœ{TRIGGER.STATUS},æœåŠ¡å™¨:{HOSTNAME1}å‘ç”Ÿ: {TRIGGER.NAME}æ•…éšœ!</p>
<p>é»˜è®¤ä¿¡æ¯ï¼š</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="xml">å‘Šè­¦ä¸»æœº:</span><span class="template-variable">&#123;HOSTNAME1&#125;</span><span class="xml"></span></div><div class="line">å‘Šè­¦æ—¶é—´:<span class="template-variable">&#123;EVENT.DATE&#125;</span><span class="xml"> </span><span class="template-variable">&#123;EVENT.TIME&#125;</span><span class="xml"></span></div><div class="line">å‘Šè­¦ç­‰çº§:<span class="template-variable">&#123;TRIGGER.SEVERITY&#125;</span><span class="xml"></span></div><div class="line">å‘Šè­¦ä¿¡æ¯: <span class="template-variable">&#123;TRIGGER.NAME&#125;</span><span class="xml"></span></div><div class="line">å‘Šè­¦é¡¹ç›®:<span class="template-variable">&#123;TRIGGER.KEY1&#125;</span><span class="xml"></span></div><div class="line">é—®é¢˜è¯¦æƒ…:<span class="template-variable">&#123;ITEM.NAME&#125;</span><span class="xml">:</span><span class="template-variable">&#123;ITEM.VALUE&#125;</span><span class="xml"></span></div><div class="line">å‰çŠ¶æ€:<span class="template-variable">&#123;TRIGGER.STATUS&#125;</span><span class="xml">:</span><span class="template-variable">&#123;ITEM.VALUE1&#125;</span><span class="xml"></span></div><div class="line">äº‹ä»¶ID:<span class="template-variable">&#123;EVENT.ID&#125;</span><span class="xml"></span></div><div class="line"></div><div class="line">æ¢å¤ä¸»æ—¨ï¼šæ¢å¤<span class="template-variable">&#123;TRIGGER.STATUS&#125;</span><span class="xml">, æœåŠ¡å™¨:</span><span class="template-variable">&#123;HOSTNAME1&#125;</span><span class="xml">: </span><span class="template-variable">&#123;TRIGGER.NAME&#125;</span><span class="xml">å·²æ¢å¤!</span></div><div class="line"></div><div class="line">æ¢å¤ä¿¡æ¯ï¼š</div><div class="line"></div><div class="line">å‘Šè­¦ä¸»æœº:<span class="template-variable">&#123;HOSTNAME1&#125;</span><span class="xml"></span></div><div class="line">å‘Šè­¦æ—¶é—´:<span class="template-variable">&#123;EVENT.DATE&#125;</span><span class="xml"> </span><span class="template-variable">&#123;EVENT.TIME&#125;</span><span class="xml"></span></div><div class="line">å‘Šè­¦ç­‰çº§:<span class="template-variable">&#123;TRIGGER.SEVERITY&#125;</span><span class="xml"></span></div><div class="line">å‘Šè­¦ä¿¡æ¯: <span class="template-variable">&#123;TRIGGER.NAME&#125;</span><span class="xml"></span></div><div class="line">å‘Šè­¦é¡¹ç›®:<span class="template-variable">&#123;TRIGGER.KEY1&#125;</span><span class="xml"></span></div><div class="line">é—®é¢˜è¯¦æƒ…:<span class="template-variable">&#123;ITEM.NAME&#125;</span><span class="xml">:</span><span class="template-variable">&#123;ITEM.VALUE&#125;</span><span class="xml"></span></div><div class="line">å½“å‰çŠ¶æ€:<span class="template-variable">&#123;TRIGGER.STATUS&#125;</span><span class="xml">:</span><span class="template-variable">&#123;ITEM.VALUE1&#125;</span><span class="xml"></span></div><div class="line">äº‹ä»¶ID:<span class="template-variable">&#123;EVENT.ID&#125;</span><span class="xml"></span></div></pre></td></tr></table></figure>
<p>åˆ‡æ¢åˆ°æ“ä½œæ ‡ç­¾ï¼Œæ·»åŠ æ“ä½œ<br>é€‰æ‹©å‘é€åˆ°Adminç”¨æˆ·ï¼Œåªä½¿ç”¨weixinï¼Œé€‰æ‹©å¥½ä¹‹åç‚¹æ·»åŠ ,è¿™é‡Œæˆ‘å·²ç»æ·»åŠ è¿‡äº†ï¼Œæ‰€ä»¥æç¤ºæ›´æ–°ã€‚<br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin33.png" alt=""></figure><br>è®¾ç½®å¥½ä¹‹åå¦‚ä¸‹ï¼Œç‚¹æ·»åŠ </p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin35.png" alt=""></figure></p>
<p>ç»è¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œå°±å®Œæˆäº†é…ç½®ï¼Œå°±å¯ä»¥ä½¿ç”¨zabbixæ¥å‘Šè­¦å•¦ï¼Œç”¨ddå‘½ä»¤æµ‹è¯•ä¸‹ç£ç›˜i/oå‘Šè­¦ï¼Œä¸€ä¼šå°±ä¼šçœ‹åˆ°å¾®ä¿¡ä¸Šå‘è¿‡æ¥çš„å‘Šè­¦ä¿¡æ¯</p>
<pre><code>dd if=/dev/zero of=/tmp/test2.img bs=1024M count=1000 oflag=dsync
</code></pre><h3 id="è¯¾å¤–æ™®åŠï¼š"><a href="#è¯¾å¤–æ™®åŠï¼š" class="headerlink" title="è¯¾å¤–æ™®åŠï¼š"></a>è¯¾å¤–æ™®åŠï¼š</h3><p>æ™®åŠï¼š</p>
<p>å¦‚ä½•æ­£ç¡®ä½¿ç”¨ddå·¥å…·æµ‹è¯•ç£ç›˜çš„I/Oé€Ÿåº¦</p>
<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½æ˜¯ä½¿ç”¨ddå‘½ä»¤åˆ›å»ºä¸€ä¸ªå¤§æ–‡ä»¶æ¥æµ‹è¯•ç£ç›˜çš„è¯»å†™é€Ÿåº¦ã€‚ä½†æ˜¯ï¼Œå¾ˆå¤šäººéƒ½å­˜åœ¨ä¸€ä¸ªè¯¯åŒºï¼Œä»¥ä¸ºddå‘½ä»¤æ˜¾ç¤ºçš„é€Ÿåº¦å°±æ˜¯ç£ç›˜çš„å†™å…¥é€Ÿåº¦ï¼Œå…¶å®è¿™æ˜¯ä¸ç„¶çš„ã€‚æˆ‘ä»¬åˆ†æä¸€ä¸‹ddå‘½ä»¤æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p>
<ol>
<li>dd if=/dev/zero of=/xiaohan/test.iso bs=1024M count=1</li>
</ol>
<p>è¿™ç§æƒ…å†µä¸‹æµ‹è¯•æ˜¾ç¤ºçš„é€Ÿåº¦æ˜¯ddå‘½ä»¤å°†æ•°æ®å†™å…¥åˆ°å†…å­˜ç¼“å†²åŒºä¸­çš„é€Ÿåº¦ï¼Œåªæœ‰å½“æ•°æ®å†™å…¥å†…å­˜ç¼“å†²åŒºå®Œæˆåï¼Œæ‰å¼€å§‹å°†æ•°æ®åˆ·å…¥ç¡¬ç›˜ï¼Œæ‰€ä»¥è¿™æ—¶å€™çš„æ•°æ®æ˜¯æ— æ³•æ­£ç¡®è¡¡é‡ç£ç›˜å†™å…¥é€Ÿåº¦çš„ã€‚</p>
<ol>
<li>dd if=/dev/zero of=/xiaohan/test.iso bs=1024M count=1;sync</li>
</ol>
<p>è¿™ç§æƒ…å†µä¸‹æµ‹è¯•æ˜¾ç¤ºçš„è·Ÿä¸Šä¸€ç§æƒ…å†µæ˜¯ä¸€æ ·çš„ï¼Œä¸¤ä¸ªå‘½ä»¤æ˜¯å…ˆåæ‰§è¡Œçš„ï¼Œå½“syncå¼€å§‹æ‰§è¡Œçš„æ—¶å€™ï¼Œddå‘½ä»¤å·²ç»å°†é€Ÿåº¦ä¿¡æ¯æ‰“å°åˆ°äº†å±å¹•ä¸Šï¼Œä»ç„¶æ— æ³•æ˜¾ç¤ºä»å†…å­˜å†™ç¡¬ç›˜æ—¶çš„çœŸæ­£é€Ÿåº¦ã€‚</p>
<ol>
<li>dd if=/dev/zero of=/xiaohan/test.iso bs=1024M count=1 conv=fdatasync</li>
</ol>
<p>è¿™ç§æƒ…å†µåŠ å…¥è¿™ä¸ªå‚æ•°åï¼Œddå‘½ä»¤æ‰§è¡Œåˆ°æœ€åä¼šçœŸæ­£æ‰§è¡Œä¸€æ¬¡â€œåŒæ­¥(sync)â€æ“ä½œï¼Œæ‰€ä»¥è¿™æ—¶å€™ä½ å¾—åˆ°çš„æ˜¯è¯»å–è¿™128Mæ•°æ®åˆ°å†…å­˜å¹¶å†™å…¥åˆ°ç£ç›˜ä¸Šæ‰€éœ€çš„æ—¶é—´ï¼Œè¿™æ ·ç®—å‡ºæ¥çš„æ—¶é—´æ‰æ˜¯æ¯”è¾ƒç¬¦åˆå®é™…çš„ã€‚</p>
<ol>
<li>dd if=/dev/zero of=/xiaohan/test.iso bs=1024M count=1 oflag=dsync</li>
</ol>
<p>è¿™ç§æƒ…å†µä¸‹ï¼Œddåœ¨æ‰§è¡Œæ—¶æ¯æ¬¡éƒ½ä¼šè¿›è¡ŒåŒæ­¥å†™å…¥æ“ä½œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™æ¡å‘½ä»¤æ¯æ¬¡è¯»å–1Måå°±è¦å…ˆæŠŠè¿™1Må†™å…¥ç£ç›˜ï¼Œç„¶åå†è¯»å–ä¸‹é¢è¿™1Mï¼Œä¸€å…±é‡å¤128æ¬¡ã€‚è¿™å¯èƒ½æ˜¯æœ€æ…¢çš„ä¸€ç§æ–¹å¼ï¼ŒåŸºæœ¬ä¸Šæ²¡æœ‰ç”¨åˆ°å†™ç¼“å­˜(write cache)ã€‚</p>
<p>æ€»ç»“ï¼š</p>
<p>å»ºè®®ä½¿ç”¨æµ‹è¯•å†™é€Ÿåº¦çš„æ–¹å¼ä¸ºï¼š</p>
<p>dd if=/dev/zero of=/xiaohan/test.iso bs=1024M count=1 conv=fdatasync</p>
<p>å»ºè®®ä½¿ç”¨æµ‹è¯•è¯»é€Ÿåº¦çš„æ–¹å¼ä¸ºï¼š</p>
<p>dd if=/xiaohan/test.iso of=/dev/zero bs=1024M count=1 iflag=direct</p>
<p>*æ³¨ï¼šè¦æ­£ç¡®æµ‹è¯•ç£ç›˜è¯»å†™èƒ½åŠ›ï¼Œå»ºè®®æµ‹è¯•æ–‡ä»¶çš„å¤§å°è¦è¿œè¿œå¤§äºå†…å­˜çš„å®¹é‡ï¼ï¼ï¼</p>
<h3 id="PSï¼šåç»­è®¡åˆ’"><a href="#PSï¼šåç»­è®¡åˆ’" class="headerlink" title="PSï¼šåç»­è®¡åˆ’"></a>PSï¼šåç»­è®¡åˆ’</h3><p>1.åç»­å¯èƒ½ä¼šå¢åŠ å‘é€æ¬¡æ•°è®¡æ•°ï¼Œæ–¹ä¾¿ç®¡ç†ç”¨æˆ·</p>
<p>2.æ·»åŠ æŸ¥è¯¢æ“ä½œåˆ°å¾®ä¿¡ï¼Œé’ˆå¯¹ç”¨æˆ·å®šåˆ¶å¼€å‘ã€‚å¯é€šè¿‡å¾®ä¿¡æŸ¥è¯¢zabbixæœåŠ¡å™¨é‡Œç›‘æ§ä¸»æœºçš„çŠ¶æ€ï¼Œé€šè¿‡å¾®ä¿¡ç®€å•æ“ä½œzabbixã€‚</p>
<h3 id="é¢„è§ˆ"><a href="#é¢„è§ˆ" class="headerlink" title="é¢„è§ˆ"></a>é¢„è§ˆ</h3><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin38.png" alt=""></figure></p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-weixin39.jpg" alt=""></figure></p>
<h3 id="æ³¨æ„äº‹é¡¹åŠæŠ¥é”™å¤„ç†"><a href="#æ³¨æ„äº‹é¡¹åŠæŠ¥é”™å¤„ç†" class="headerlink" title="æ³¨æ„äº‹é¡¹åŠæŠ¥é”™å¤„ç†"></a>æ³¨æ„äº‹é¡¹åŠæŠ¥é”™å¤„ç†</h3><pre><code> #Zabbix-webé¡µé¢æ–°å¢ç”¨æˆ·æƒé™å¤„ç†ï¼Œå‘é€å¯¹è±¡é€‰æ‹©ï¼ˆç”¨æˆ·çš„åç§°ï¼‰

#åº”ç”¨å½“ä¸­å¯è§èŒƒå›´é€‰æ‹©æ³¨æ„ï¼ˆé€‰è¿™è¦å‘é€çš„å¯¹è±¡ï¼ˆéƒ¨é—¨ï¼ŒåŠéƒ¨é—¨æˆå‘˜ï¼‰ï¼‰
</code></pre><p> zabbix-server2.4æœåŠ¡ç«¯ç¼–è¯‘å®‰è£… <a href="http://blog.yangcvo.me/2015/01/18/zabbix-serveræœåŠ¡ç«¯ç¼–è¯‘å®‰è£…/" target="_blank" rel="external">zabbix-serveræœåŠ¡ç«¯ç¼–è¯‘å®‰è£…</a></p>
<p>zabbix2.4ç›‘æ§80ç«¯å£çŠ¶æ€ : <a href="http://blog.yangcvo.me/2016/07/20/zabbixç›‘æ§80ç«¯å£çŠ¶æ€/" target="_blank" rel="external">zabbixç›‘æ§80ç«¯å£çŠ¶æ€</a></p>
<p>zabbix+Grafanaå®‰è£…ä½¿ç”¨ç›‘æ§ç»“åˆ ï¼š<a href="http://blog.yangcvo.me/2016/07/13/zabbix-Grafanaå®‰è£…ä½¿ç”¨ç»“åˆ/" target="_blank" rel="external">zabbix+Grafanaå®‰è£…ä½¿ç”¨ç›‘æ§ç»“åˆ</a></p>
<p>zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹ : <a href="http://blog.yangcvo.me/2015/09/29/zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹/" target="_blank" rel="external">zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹</a></p>
<p>zabbixçš„ICMP_Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§ : <a href="http://blog.yangcvo.me/2015/11/18/zabbixçš„ICMP-Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§/" target="_blank" rel="external">zabbixçš„ICMP_Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§</a></p>
<p>zabbixæ€§èƒ½ç›‘æ§æ•…éšœæ€»ç»“ <a href="http://blog.yangcvo.me/2016/02/07/zabbix-æ•…éšœæ€»ç»“/" target="_blank" rel="external">zabbixæ€§èƒ½ç›‘æ§æ•…éšœæ€»ç»“</a></p>

	

	

</article>




	<article>
	
		<h1><a href="/2016/06/21/æ€§èƒ½ç›‘æ§/Zabbix/zabbix3-0éƒ¨ç½²jmxç›‘æ§tomcat/">zabbix3.0éƒ¨ç½²jmxç›‘æ§tomcat</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-06-21</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/monitoring/">monitoring</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Zabbix-monitoring/">Zabbix monitoring</a>
			</span>
		
	</div>

	

	
		<p>zabbixæä¾›äº†ä¸€ä¸ªjava gatewayçš„åº”ç”¨å»ç›‘æ§jmxï¼ˆJava Management Extensionsï¼Œå³Javaç®¡ç†æ‰©å±•ï¼‰æ˜¯ä¸€ä¸ªä¸ºåº”ç”¨ç¨‹åºã€è®¾å¤‡ã€ç³»ç»Ÿç­‰æ¤å…¥ç®¡ç†åŠŸèƒ½çš„æ¡†æ¶ã€‚JMXå¯ä»¥è·¨è¶Šä¸€ç³»åˆ—å¼‚æ„æ“ä½œç³»ç»Ÿå¹³å°ã€ç³»ç»Ÿä½“ç³»ç»“æ„å’Œç½‘ç»œä¼ è¾“åè®®ï¼Œçµæ´»çš„å¼€å‘æ— ç¼é›†æˆçš„ç³»ç»Ÿã€ç½‘ç»œå’ŒæœåŠ¡ç®¡ç†åº”ç”¨ã€‚</p>
<h2 id="ä¸€-Zabbix-çš„JMXç›‘æ§æ¶æ„"><a href="#ä¸€-Zabbix-çš„JMXç›‘æ§æ¶æ„" class="headerlink" title="ä¸€. Zabbix çš„JMXç›‘æ§æ¶æ„"></a>ä¸€. Zabbix çš„JMXç›‘æ§æ¶æ„</h2><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-tomcat1.png" alt=""></figure></p>
<h3 id="ä¸€ï¼šéƒ¨ç½²ç¯å¢ƒ"><a href="#ä¸€ï¼šéƒ¨ç½²ç¯å¢ƒ" class="headerlink" title="ä¸€ï¼šéƒ¨ç½²ç¯å¢ƒ"></a>ä¸€ï¼šéƒ¨ç½²ç¯å¢ƒ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Centos   6.7</div><div class="line">Zabbix     3.0.3</div><div class="line">Tomcat     7.0.55</div></pre></td></tr></table></figure>
<h3 id="æœåŠ¡ç«¯é…ç½®"><a href="#æœåŠ¡ç«¯é…ç½®" class="headerlink" title="æœåŠ¡ç«¯é…ç½®"></a>æœåŠ¡ç«¯é…ç½®</h3><h3 id="1ã€å®‰è£…jdkï¼ˆç‰ˆæœ¬1-7-0-79ï¼‰"><a href="#1ã€å®‰è£…jdkï¼ˆç‰ˆæœ¬1-7-0-79ï¼‰" class="headerlink" title="1ã€å®‰è£…jdkï¼ˆç‰ˆæœ¬1.7.0_79ï¼‰"></a>1ã€å®‰è£…jdkï¼ˆç‰ˆæœ¬1.7.0_79ï¼‰</h3><p>JDK å„è‡ªçš„ç‰ˆæœ¬7.0 è¿˜æ˜¯8.0 ç‰ˆæœ¬å®˜ç½‘ä¸‹è½½ï¼š<a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html" target="_blank" rel="external">JDK</a></p>
<p>æˆ‘è¿™é‡Œä¹Ÿä¸Šä¼ äº†7.0.67 ç‰ˆæœ¬çš„å’Œ8.0ç‰ˆæœ¬çš„jdkæºç åŒ…ï¼š</p>
<p><a href="http://oak0aohum.bkt.clouddn.com/jdk1.7.0_67.tar.gz" target="_blank" rel="external">7.0JDKæºç åŒ…</a></p>
<p><a href="http://oak0aohum.bkt.clouddn.com/jdk1.8.0_66.tar.gz" target="_blank" rel="external">8.0JDKæºç åŒ…</a></p>
<p>å¹¶ä¸Šä¼ åˆ°zabbix server</p>
<p>ç›´æ¥è§£å‹ä¸‹è½½ä¸‹æ¥çš„åŒ…åˆ°è‡ªå®šä¹‰çš„ç›®å½•ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tar -zxvf jdk1.7.0_67.tar.gz -C /srv/</div></pre></td></tr></table></figure>
<p>å®‰è£…æˆåŠŸä¹‹åæ·»åŠ ç³»ç»Ÿç¯å¢ƒå˜é‡</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="built_in">cd</span> /etc/profile.d</div><div class="line">vim java.sh</div><div class="line"><span class="built_in">export</span> JAVA_HOME=/srv/jdk1.7.0_67</div><div class="line"><span class="built_in">export</span> CLASS_PATH=<span class="string">"<span class="variable">$JAVA_HOME</span>/lib:<span class="variable">$JAVA_HOME</span>/jre/lib"</span></div><div class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin</div></pre></td></tr></table></figure>
<p>ä½¿é…ç½®ç”Ÿæ•ˆ</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">source</span> <span class="regexp">/etc/</span>profile</div></pre></td></tr></table></figure>
<p>å®‰è£…ä¸é…ç½®æ¯”è¾ƒç®€å•ã€‚æ‰§è¡Œjava -versionå‘½ä»¤ï¼Œå‡ºç°ç±»ä¼¼ç•Œé¢è¡¨ç¤ºæˆåŠŸã€‚</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">java </span>-version</div><div class="line"><span class="keyword">java </span>version <span class="string">"1.7.0_67"</span></div><div class="line"><span class="keyword">Java(TM) </span>SE Runtime Environment (<span class="keyword">build </span><span class="number">1</span>.<span class="number">7</span>.<span class="number">0</span>_67-<span class="keyword">b01)</span></div><div class="line"><span class="keyword">Java </span>HotSpot(TM) <span class="number">64</span>-<span class="keyword">Bit </span>Server VM (<span class="keyword">build </span><span class="number">24</span>.<span class="number">65</span>-<span class="keyword">b04, </span>mixed mode)</div></pre></td></tr></table></figure>
<p>å¦‚æœå‡ºç°é—®é¢˜ï¼ŒæŸ¥çœ‹ä¸‹ç¯å¢ƒå˜é‡æ˜¯å¦è®¾ç½®ã€‚</p>
<h3 id="2ã€å®‰è£…Zabbix-Java-gateway"><a href="#2ã€å®‰è£…Zabbix-Java-gateway" class="headerlink" title="2ã€å®‰è£…Zabbix-Java-gateway"></a>2ã€å®‰è£…<code>Zabbix-Java-gateway</code></h3><p>Zabbix2.0èµ·æ·»åŠ äº†æ”¯æŒç”¨äºç›‘æ§JMXåº”ç”¨ç¨‹åºçš„æœåŠ¡è¿›ç¨‹ï¼Œç§°ä¸ºâ€œZabbix-Java-gatewayâ€ï¼Œå®ƒæ˜¯ç”¨javaå†™çš„ä¸€ä¸ªç¨‹åºã€‚</p>
<p>å¯ä½¿ç”¨rpmè¿›è¡Œå®‰è£…ï¼Œæˆ‘ä½¿ç”¨æºç å®‰è£…ï¼Œå¤§å®¶å¯åœ¨å®‰è£…zabbixæ—¶å¯ç”¨â€“enable-javaå‚æ•°å³å¯å®‰è£…zabbix java gatewayï¼Œå¦‚æœç¬¬ä¸€æ¬¡æ²¡æœ‰åŠ è½½ï¼Œå¯é‡æ–°åŠ è½½ç¼–è¯‘å®‰è£…</p>
<p>æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥å®‰è£…Zabbix-Java-gatewayï¼Œç¬¬1ç§æ˜¯ç¼–è¯‘å®‰è£…zabbixæ—¶æ·»åŠ â€“enable javaå‚æ•°ã€‚ç¬¬2ç§æ˜¯å•ç‹¬å®‰è£…ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>ç¬¬ä¸€ç§æ–¹æ³•</code>ï¼š</li>
</ul>
<p>å®‰è£…gatewayï¼Œéœ€è¦javaï¼Œjava-develä¾èµ–</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">yumã€€installã€€ï¼ï½™ã€€</div><div class="line">http://repo.zabbix.com/zabbix/2.4/rhel/6/x86_64/zabbix-release-2.4-1.el6.noarch.rpmã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€    å®‰è£…yumæº</div><div class="line">yum install -y  java  java-devel  zabbix-java-gatewayã€€ã€€å®‰è£…gateway</div></pre></td></tr></table></figure>
<p>æµ‹è¯•æ˜¯å¦æˆåŠŸï¼š</p>
<p>ç¬¬ä¸€ï¼šæµ‹è¯•javaæ˜¯å¦æˆåŠŸ</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">java </span>-version</div><div class="line"><span class="keyword">java </span>version <span class="string">"1.7.0_67"</span></div><div class="line"><span class="keyword">Java(TM) </span>SE Runtime Environment (<span class="keyword">build </span><span class="number">1</span>.<span class="number">7</span>.<span class="number">0</span>_67-<span class="keyword">b01)</span></div><div class="line"><span class="keyword">Java </span>HotSpot(TM) <span class="number">64</span>-<span class="keyword">Bit </span>Server VM (<span class="keyword">build </span><span class="number">24</span>.<span class="number">65</span>-<span class="keyword">b04, </span>mixed mode)</div></pre></td></tr></table></figure>
<p>ç¬¬äºŒï¼šæµ‹è¯•gatewayæ˜¯å¦å®‰è£…æˆåŠŸ</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">service zabbix-java-gateway <span class="built_in">status</span></div><div class="line">zabbix-java-gateway <span class="built_in">is</span> stopped</div></pre></td></tr></table></figure>
<ul>
<li><code>ç¬¬äºŒç§æ–¹æ³•</code>ï¼š</li>
</ul>
<p>æˆ‘è¿™é‡Œå‡çº§3.0.3ç‰ˆæœ¬çš„æ—¶å€™å·²ç»å®‰è£…å¥½äº†ã€‚æ‰€ä»¥å¦‚æœæ²¡æœ‰å®‰è£…ä¸Šçš„å¯ä»¥å•ç‹¬å®‰è£…æ²¡å…³ç³»çš„ï¼š</p>
<p>ä¸å—å½±å“æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># tar zxvf zabbix-3.0.3.tar.gz</span></div><div class="line"><span class="comment"># cd zabbix-3.0.3</span></div><div class="line"><span class="comment"># ./configure  --enable-java  --prefix=/data/zabbix/zabbix_java  #/data/zabbixæ˜¯æˆ‘çš„zabbixå®‰è£…ç›®å½•</span></div><div class="line"><span class="comment"># make &amp;&amp; make install</span></div></pre></td></tr></table></figure>
<p>æˆ‘çš„ç›®å½•æ˜¯é»˜è®¤åœ¨/usr/local/zabbix/sbin/zabbix_java/</p>
<h3 id="3ã€ä¿®æ”¹Java-gatewayçš„é…ç½®æ–‡ä»¶å¹¶å¯åŠ¨å®ƒ"><a href="#3ã€ä¿®æ”¹Java-gatewayçš„é…ç½®æ–‡ä»¶å¹¶å¯åŠ¨å®ƒ" class="headerlink" title="3ã€ä¿®æ”¹Java-gatewayçš„é…ç½®æ–‡ä»¶å¹¶å¯åŠ¨å®ƒ"></a>3ã€ä¿®æ”¹<code>Java-gateway</code>çš„é…ç½®æ–‡ä»¶å¹¶å¯åŠ¨å®ƒ</h3><p>é…ç½®æ–‡ä»¶å•ç‹¬å®‰è£…çš„è·¯å¾„ä¸º/data/zabbix/zabbix_java/sbin/zabbix_java/settings.sh<br>æˆ‘è¿™é‡Œæ˜¯è¿™ä¸ªç›®å½•ã€‚å…·ä½“æ ¹æ®å®é™…å®‰è£…æƒ…å†µï¼‰ /usr/local/zabbix/sbin/zabbix_java/settings.sh<br>å¯ç”¨ä»¥ä¸‹å‚æ•°ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">LISTEN_IP=<span class="string">"127.0.0.1"</span>       <span class="comment">#ç›‘å¬åœ°å€</span></div><div class="line">LISTEN_PORT=10052      <span class="comment">#ç›‘å¬ç«¯å£</span></div><div class="line">START_POLLERS=50        <span class="comment"># å¼€å¯çš„å·¥ä½œçº¿ç¨‹æ•°ï¼ˆå¿…é¡»å¤§äºç­‰äºåé¢zabbix_server.confæ–‡ä»¶çš„StartJavaPollerså‚æ•°ï¼‰ #å¿…é¡»é…ç½®ï¼Œå¯åŠ¨çš„è¿›å‡ºæ•°</span></div></pre></td></tr></table></figure>
<p><code>æ³¨æ„äº‹é¡¹ï¼š</code></p>
<ol>
<li>é…ç½®æ–‡ä»¶PID_FILEçš„è·¯å¾„å¿…é¡»æ˜¯æ­£ç¡®çš„ï¼Œå¯ä»¥è‡ªå·±å»cdæ‰¾ï¼Œyumå®‰è£…é»˜è®¤æƒ…å†µä¸‹ä¸ç”¨æ”¹åŠ¨ã€‚</li>
<li>START_POLLERSé¡¹æ˜¯é…ç½®å¯åŠ¨çš„è¿›å‡ºæ•°ï¼Œè¯¥å€¼å¿…é¡»å¤§äºç­‰äºZabbix-Serveré‡Œé¢çš„startJavaPollersé¡¹ã€‚</li>
</ol>
<p>è¿›å…¥/usr/local/zabbix/sbin/zabbix_java/ç›®å½•ï¼Œæ‰§è¡Œ./startup.sh</p>
<p>æ£€æŸ¥ç«¯å£æ˜¯å¦ç›‘å¬ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">netstat -anp|grep 10052</div><div class="line">tcp        0      0 0.0.0.0:10052               0.0.0.0:*                   LISTEN      21949/java</div></pre></td></tr></table></figure>
<p>æŸ¥çœ‹æ˜¯å¦å·²ç»ç›‘å¬10052ç«¯å£ï¼Œå¦‚æœå·²ç›‘å¬ï¼Œè¡¨ç¤ºå¯åŠ¨æˆåŠŸï¼Œå¦‚æœæ²¡æœ‰ï¼Œå¯é€šè¿‡zabbix_serveræ—¥å¿—æŸ¥çœ‹è§£å†³</p>
<h3 id="4ã€ä¿®æ”¹zabbix-serverçš„é…ç½®æ–‡ä»¶å¹¶é‡å¯"><a href="#4ã€ä¿®æ”¹zabbix-serverçš„é…ç½®æ–‡ä»¶å¹¶é‡å¯" class="headerlink" title="4ã€ä¿®æ”¹zabbix_serverçš„é…ç½®æ–‡ä»¶å¹¶é‡å¯"></a>4ã€ä¿®æ”¹<code>zabbix_server</code>çš„é…ç½®æ–‡ä»¶å¹¶é‡å¯</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">vim /usr/<span class="built_in">local</span>/zabbix/etc/zabbix_server.conf</div><div class="line"></div><div class="line">JavaGateway=127.0.0.1      <span class="comment"># JavaGateway æœåŠ¡å™¨åœ°å€ï¼Œzabbix_serverä¸zabbix_java_gatewayåœ¨åŒä¸€å°ä¸»æœº</span></div><div class="line">JavaGatewayPort=10052       <span class="comment">#ç«¯å£</span></div><div class="line">StartJavaPollers=5          <span class="comment"># #è®¾å®šè¿æ¥java gateway çš„è¿›ç¨‹æ•°ï¼Œå½“è®¾ç½®ä¸º0æ—¶è¡¨ç¤ºä¸å…·æœ‰æŠ“å–javaä¿¡æ¯çš„èƒ½åŠ›</span></div></pre></td></tr></table></figure>
<h3 id="5ã€-æ·»åŠ catalina-jmx-remote-jar"><a href="#5ã€-æ·»åŠ catalina-jmx-remote-jar" class="headerlink" title="5ã€ æ·»åŠ catalina-jmx-remote.jar"></a>5ã€ æ·»åŠ catalina-jmx-remote.jar</h3><p>æ·»åŠ catalina-jmx-remote.jaråˆ°zabbix java gatewayçš„libç›®å½•ä¸‹ï¼Œcatalina-jmx-remote.jaråŒ…å¯åœ¨<a href="http://archive.apache.org/dist/tomcat/ä¸‹ï¼Œåœ¨å„ç‰ˆæœ¬ç›®å½•çš„bin/extras/å­ç›®å½•ä¸‹" target="_blank" rel="external">http://archive.apache.org/dist/tomcat/ä¸‹ï¼Œåœ¨å„ç‰ˆæœ¬ç›®å½•çš„bin/extras/å­ç›®å½•ä¸‹</a></p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cd /usr/local/zabbix/sbin/zabbix_java/<span class="class"><span class="keyword">lib</span>/</span></div><div class="line">wget <span class="symbol">http:</span>/<span class="regexp">/archive.apache.org/dist</span><span class="regexp">/tomcat/tomcat</span>-<span class="number">7</span>/v7.<span class="number">0.55</span>/bin/extras/catalina-jmx-remote.jar</div></pre></td></tr></table></figure>
<p>é‡å¯æœåŠ¡zabbixå’Œjava gateway å¹¶åŠ å…¥å¯åŠ¨é¡¹å¹¶éªŒè¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">/etc/init.d/zabbix_server restart</div><div class="line">/usr/<span class="built_in">local</span>/zabbix/sbin/zabbix_java/shutdown.sh</div><div class="line">/usr/<span class="built_in">local</span>/zabbix/sbin/zabbix_java/startup.sh</div></pre></td></tr></table></figure>
<h3 id="6-ä¸‹è½½æµ‹è¯•å·¥å…·cmdline-jmxclient-0-10-3-jar"><a href="#6-ä¸‹è½½æµ‹è¯•å·¥å…·cmdline-jmxclient-0-10-3-jar" class="headerlink" title="6.ä¸‹è½½æµ‹è¯•å·¥å…·cmdline-jmxclient-0.10.3.jar"></a>6.ä¸‹è½½æµ‹è¯•å·¥å…·<code>cmdline-jmxclient-0.10.3.jar</code></h3><p>cmdline-jmxclient-0.10.3.jarä¸ºä¸€ä¸ªæµ‹è¯•å·¥å…·ï¼Œå¯ç”¨æ¥æµ‹è¯•jmxæ˜¯å¦é…ç½®æ­£ç¡®ï¼Œä¸‹è½½cmdline-jmxclient-0.10.3.jar(ä¸‹è½½åˆ°ä»»æ„ç›®å½•)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wget http://crawler.archive.org/cmdline-jmxclient/cmdline-jmxclient-0.10.3.jar</div></pre></td></tr></table></figure>
<h2 id="äºŒã€è¢«ç›‘æ§tomcat-é…ç½®ï¼»è¢«ç›‘æ§tomcatæ“ä½œï¼½"><a href="#äºŒã€è¢«ç›‘æ§tomcat-é…ç½®ï¼»è¢«ç›‘æ§tomcatæ“ä½œï¼½" class="headerlink" title="äºŒã€è¢«ç›‘æ§tomcat é…ç½®ï¼»è¢«ç›‘æ§tomcatæ“ä½œï¼½"></a>äºŒã€è¢«ç›‘æ§tomcat é…ç½®ï¼»è¢«ç›‘æ§tomcatæ“ä½œï¼½</h2><h3 id="ä¸‹è½½catalina-jmx-remote-jar"><a href="#ä¸‹è½½catalina-jmx-remote-jar" class="headerlink" title="ä¸‹è½½catalina-jmx-remote.jar"></a>ä¸‹è½½catalina-jmx-remote.jar</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /srv/tomcat/tomcat-account/lib/</div><div class="line">wget http://archive.apache.org/dist/tomcat/tomcat-7/v7.0.55/bin/extras/catalina-jmx-remote.jar <span class="comment">#æˆ‘çš„tomcatç‰ˆæœ¬æ˜¯7.0.55</span></div><div class="line">chown -R tomcat:tomcat catalina-jmx-remote.jar</div><div class="line">chmod +x catalina-jmx-remote.jar</div></pre></td></tr></table></figure>
<p>æˆ‘çš„tomcatç‰ˆæœ¬æ˜¯<code>7.0.55</code>  å°†ä¸‹è½½ååçš„jaråŒ…æ”¾åˆ°è¢«ç›‘æ§çš„tomcatå®ä¾‹çš„libç›®å½•ä¸‹ã€‚ </p>
<h3 id="æŸ¥çœ‹tomcatçš„ç‰ˆæœ¬"><a href="#æŸ¥çœ‹tomcatçš„ç‰ˆæœ¬" class="headerlink" title="æŸ¥çœ‹tomcatçš„ç‰ˆæœ¬"></a>æŸ¥çœ‹tomcatçš„ç‰ˆæœ¬</h3><ul>
<li>è¿™é‡Œä¹‹å‰ä¹Ÿè‡ªå·±ä¹Ÿå¿˜è®°äº†tomcatçš„ç‰ˆæœ¬æ˜¯å¤šå°‘äº†ï¼Œæ‰€ä»¥æˆ‘å…ˆæŸ¥çœ‹ä¸‹ç„¶ååœ¨ä¸‹è½½ï¼š</li>
</ul>
<figure class="highlight ldif"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">cd /srv/tomcat/tomcat_account/bin</span></div><div class="line">[root@tomcat_A1 bin]# ./version.sh --</div><div class="line">Using CATALINA_BASE:   /srv/tomcat/tomcat_account</div><div class="line"><span class="attribute">Using CATALINA_HOME</span>:   /srv/tomcat/tomcat_account</div><div class="line"><span class="attribute">Using CATALINA_TMPDIR</span>: /srv/tomcat/tomcat_account/temp</div><div class="line"><span class="attribute">Using JRE_HOME</span>:        /srv/jdk1.7.0_67</div><div class="line"><span class="attribute">Using CLASSPATH</span>:       /srv/tomcat/tomcat_account/bin/bootstrap.jar:/srv/tomcat/tomcat_account/bin/tomcat-juli.jar</div><div class="line"><span class="attribute">Server version</span>: Apache Tomcat/7.0.55</div><div class="line"><span class="attribute">Server built</span>:   Jul 18 2014 05:34:04</div><div class="line"><span class="attribute">Server number</span>:  7.0.55.0</div><div class="line"><span class="attribute">OS Name</span>:        Linux</div><div class="line"><span class="attribute">OS Version</span>:     2.6.32-573.8.1.el6.x86_64</div><div class="line"><span class="attribute">Architecture</span>:   amd64</div><div class="line"><span class="attribute">JVM Version</span>:    1.7.0_67-b01</div><div class="line"><span class="attribute">JVM Vendor</span>:     Oracle Corporation</div></pre></td></tr></table></figure>
<p>åœ¨tomcatç«¯é…ç½®JMXã€‚ï¼ˆtomcat/bin/catalina.shï¼‰è‡ªå·±å®‰è£…çš„tomcatè·¯å¾„ï¼Œæ‰¾åˆ°catalina.shæ–‡ä»¶ã€‚</p>
<p>ç½‘ä¸Šå¾ˆå¤šäººä¿®æ”¹tomcat/bin/ä¸‹çš„catalina.shï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">CATALINA_OPTS=<span class="string">"-Dcom.sun.management.jmxremote</span></div><div class="line">-Dcom.sun.management.jmxremote.authenticate=false</div><div class="line">-Dcom.sun.management.jmxremote.ssl=false</div><div class="line">-Dcom.sun.management.jmxremote.port=12345  #å®šä¹‰jmxç›‘å¬ç«¯å£</div><div class="line">-Djava.rmi.server.hostname=192.168.7.186"</div></pre></td></tr></table></figure>
<ul>
<li>æˆ‘è¿™é‡Œæ˜¯ç›´æ¥åœ¨binç›®å½•ä¸‹é¢åˆ›å»ºè‡ªå®šä¹‰çš„è„šæœ¬ã€‚</li>
</ul>
<h3 id="ä¿®æ”¹setenv-sh"><a href="#ä¿®æ”¹setenv-sh" class="headerlink" title="ä¿®æ”¹setenv.sh"></a>ä¿®æ”¹setenv.sh</h3><p>vi /srv/tomcat/tomcat-account/bin/setenv.sh</p>
<p>æ·»åŠ å¦‚ä¸‹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">CATALINA_OPTS=<span class="string">"<span class="variable">$&#123;CATALINA_OPTS&#125;</span> -Djava.rmi.server.hostname=192.168.7.186"</span></div><div class="line">CATALINA_OPTS=<span class="string">"<span class="variable">$&#123;CATALINA_OPTS&#125;</span> -Djavax.management.builder.initial="</span></div><div class="line">CATALINA_OPTS=<span class="string">"<span class="variable">$&#123;CATALINA_OPTS&#125;</span> -Dcom.sun.management.jmxremote=true"</span></div><div class="line">CATALINA_OPTS=<span class="string">"<span class="variable">$&#123;CATALINA_OPTS&#125;</span> -Dcom.sun.management.jmxremote.ssl=false"</span></div><div class="line">CATALINA_OPTS=<span class="string">"<span class="variable">$&#123;CATALINA_OPTS&#125;</span> -Dcom.sun.management.jmxremote.authenticate=false"</span></div></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼šhostnameä½æœºå™¨ipåœ°å€ï¼Œå³è¢«ç›‘æ§æœºå™¨å¯¹å¤–æœåŠ¡åœ°å€</p>
<h3 id="3-ä¿®æ”¹server-xml"><a href="#3-ä¿®æ”¹server-xml" class="headerlink" title="3.ä¿®æ”¹server.xml"></a>3.ä¿®æ”¹server.xml</h3><p>vi /opt/apache-tomcat/conf/server.xml<br>æ·»åŠ å¦‚ä¸‹ï¼Œæ³¨æ„æ·»åŠ ä½ç½®åœ¨</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;Listener className=<span class="string">"org.apache.catalina.core.ThreadLocalLeakPreventionListener"</span> /&gt;</div></pre></td></tr></table></figure>
<p>ä¹‹åæ·»åŠ å¦‚ä¸‹ä»£ç </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;Listener className=<span class="string">"org.apache.catalina.mbeans.JmxRemoteLifecycleListener"</span> rmiRegistryPortPlatform=<span class="string">"12345"</span> rmiServerPortPlatform=<span class="string">"12345"</span> /&gt;</div></pre></td></tr></table></figure>
<p>3ã€é‡å¯<code>tomcat</code><br>è¿™é‡Œæˆ‘ä¹‹å‰æ˜¯ç”¨å†™å¥½çš„å¯åŠ¨è„šæœ¬å»å¯åŠ¨çš„ï¼Œå‘ç°ä¸€ä¸ªé—®é¢˜ã€‚<br>å› ä¸ºæˆ‘éƒ½æ˜¯ç”¨/etc/init.d/tomcat stop start æ¥å¯åŠ¨ã€‚<br>å¯æ˜¯å‘ç°æœåŠ¡å¯åŠ¨äº†ï¼Œå¯æ˜¯ä¹‹å‰çš„tomcatæœåŠ¡ç«¯å£ä¸è§äº†ã€‚æˆ‘ä¹‹å‰çš„tomcatæœåŠ¡ç«¯å£<code>10001</code></p>
<p>ç„¶åæŸ¥çœ‹æ—¥å¿—å‡ºç°æŠ¥é”™ï¼š</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">	at java<span class="selector-class">.lang</span><span class="selector-class">.reflect</span><span class="selector-class">.Method</span><span class="selector-class">.invoke</span>(Method<span class="selector-class">.java</span>:<span class="number">606</span>)</div><div class="line">	at org<span class="selector-class">.apache</span><span class="selector-class">.commons</span><span class="selector-class">.daemon</span><span class="selector-class">.support</span><span class="selector-class">.DaemonLoader</span><span class="selector-class">.start</span>(DaemonLoader<span class="selector-class">.java</span>:<span class="number">243</span>)</div><div class="line">Caused by: java<span class="selector-class">.lang</span><span class="selector-class">.IllegalArgumentException</span>: jmxremote<span class="selector-class">.access</span> (æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•)</div><div class="line">	at javax<span class="selector-class">.management</span><span class="selector-class">.remote</span><span class="selector-class">.rmi</span><span class="selector-class">.RMIConnectorServer</span><span class="selector-class">.start</span>(RMIConnectorServer<span class="selector-class">.java</span>:<span class="number">373</span>)</div><div class="line">	at org<span class="selector-class">.apache</span><span class="selector-class">.catalina</span><span class="selector-class">.mbeans</span><span class="selector-class">.JmxRemoteLifecycleListener</span><span class="selector-class">.createServer</span>(JmxRemoteLifecycleListener<span class="selector-class">.java</span>:<span class="number">313</span>)</div><div class="line">	at org<span class="selector-class">.apache</span><span class="selector-class">.catalina</span><span class="selector-class">.mbeans</span><span class="selector-class">.JmxRemoteLifecycleListener</span><span class="selector-class">.lifecycleEvent</span>(JmxRemoteLifecycleListener<span class="selector-class">.java</span>:<span class="number">259</span>)</div><div class="line">	at org<span class="selector-class">.apache</span><span class="selector-class">.catalina</span><span class="selector-class">.util</span><span class="selector-class">.LifecycleSupport</span><span class="selector-class">.fireLifecycleEvent</span>(LifecycleSupport<span class="selector-class">.java</span>:<span class="number">117</span>)</div><div class="line">	at org<span class="selector-class">.apache</span><span class="selector-class">.catalina</span><span class="selector-class">.util</span><span class="selector-class">.LifecycleBase</span><span class="selector-class">.fireLifecycleEvent</span>(LifecycleBase<span class="selector-class">.java</span>:<span class="number">90</span>)</div><div class="line">	at org<span class="selector-class">.apache</span><span class="selector-class">.catalina</span><span class="selector-class">.util</span><span class="selector-class">.LifecycleBase</span><span class="selector-class">.setStateInternal</span>(LifecycleBase<span class="selector-class">.java</span>:<span class="number">402</span>)</div><div class="line">	at org<span class="selector-class">.apache</span><span class="selector-class">.catalina</span><span class="selector-class">.util</span><span class="selector-class">.LifecycleBase</span><span class="selector-class">.setState</span>(LifecycleBase<span class="selector-class">.java</span>:<span class="number">347</span>)</div><div class="line">	at org<span class="selector-class">.apache</span><span class="selector-class">.catalina</span><span class="selector-class">.core</span><span class="selector-class">.StandardServer</span><span class="selector-class">.startInternal</span>(StandardServer<span class="selector-class">.java</span>:<span class="number">732</span>)</div><div class="line">	at org<span class="selector-class">.apache</span><span class="selector-class">.catalina</span><span class="selector-class">.util</span><span class="selector-class">.LifecycleBase</span><span class="selector-class">.start</span>(LifecycleBase<span class="selector-class">.java</span>:<span class="number">150</span>)</div><div class="line">	... <span class="number">11</span> more</div><div class="line">Caused by: java<span class="selector-class">.io</span><span class="selector-class">.FileNotFoundException</span>: jmxremote<span class="selector-class">.access</span> (æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•)</div><div class="line">	at java<span class="selector-class">.io</span><span class="selector-class">.FileInputStream</span><span class="selector-class">.open</span>(Native Method)</div><div class="line">	at java<span class="selector-class">.io</span><span class="selector-class">.FileInputStream</span>.&lt;init&gt;(FileInputStream<span class="selector-class">.java</span>:<span class="number">146</span>)</div><div class="line">	at java<span class="selector-class">.io</span><span class="selector-class">.FileInputStream</span>.&lt;init&gt;(FileInputStream<span class="selector-class">.java</span>:<span class="number">101</span>)</div><div class="line">	at com<span class="selector-class">.sun</span><span class="selector-class">.jmx</span><span class="selector-class">.remote</span><span class="selector-class">.security</span><span class="selector-class">.MBeanServerFileAccessController</span><span class="selector-class">.propertiesFromFile</span>(MBeanServerFileAccessController<span class="selector-class">.java</span>:<span class="number">294</span>)</div><div class="line">	at com<span class="selector-class">.sun</span><span class="selector-class">.jmx</span><span class="selector-class">.remote</span><span class="selector-class">.security</span><span class="selector-class">.MBeanServerFileAccessController</span>.&lt;init&gt;(MBeanServerFileAccessController<span class="selector-class">.java</span>:<span class="number">133</span>)</div><div class="line">	at javax<span class="selector-class">.management</span><span class="selector-class">.remote</span><span class="selector-class">.rmi</span><span class="selector-class">.RMIConnectorServer</span><span class="selector-class">.start</span>(RMIConnectorServer<span class="selector-class">.java</span>:<span class="number">371</span>)</div><div class="line">	... <span class="number">19</span> more</div></pre></td></tr></table></figure>
<p>è¿™é‡Œå…ˆkill -9 tomcatè¿›ç¨‹<br>åªéœ€è¦åœ¨/bin/ç›®å½•ä¸‹é¢å¯åŠ¨æœåŠ¡ã€‚<code>./startup.sh</code><br>ç„¶åæŸ¥çœ‹æœ‰ä¸‹é¢çš„12345 12346 è¿›ç¨‹ å’Œtomcatè¿›ç¨‹10001 è¯´æ˜å°±å¯¹äº†ã€‚</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[root@tomcat_A1 bin]# netstat -ntulp</div><div class="line">Active Internet connections (only servers)</div><div class="line">Proto Recv-Q Send-Q Local Address               Foreign Address             State       PID/Program name</div><div class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">10.46</span><span class="meta">.72</span><span class="meta">.172</span>:<span class="number">10050</span>          <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:*                   LISTEN      <span class="number">8483</span>/zabbix_agentd</div><div class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">127.0</span><span class="meta">.0</span><span class="meta">.1</span>:<span class="number">8006</span>              <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:*                   LISTEN      <span class="number">8942</span>/java</div><div class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:<span class="number">4041</span>                <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:*                   LISTEN      <span class="number">8942</span>/java</div><div class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:<span class="number">10001</span>               <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:*                   LISTEN      <span class="number">8942</span>/java</div><div class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:<span class="number">22</span>                  <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:*                   LISTEN      <span class="number">1363</span>/sshd</div><div class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:<span class="number">36440</span>               <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:*                   LISTEN      <span class="number">8942</span>/java</div><div class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:<span class="number">12345</span>               <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:*                   LISTEN      <span class="number">8942</span>/java</div><div class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:<span class="number">12346</span>               <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:*                   <span class="number">1374</span>/ntpd</div><div class="line">udp        <span class="number">0</span>      <span class="number">0</span> <span class="number">10.46</span><span class="meta">.72</span><span class="meta">.172</span>:<span class="number">123</span>            <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:*                               <span class="number">1374</span>/ntpd</div><div class="line">udp        <span class="number">0</span>      <span class="number">0</span> <span class="number">127.0</span><span class="meta">.0</span><span class="meta">.1</span>:<span class="number">123</span>               <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:*                               <span class="number">1374</span>/ntpd</div><div class="line">udp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:<span class="number">123</span>                 <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:*                               <span class="number">1374</span>/ntpd</div></pre></td></tr></table></figure>
<p>é‡å¯zabbix agent</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">service zabbix-agent restart</span></div></pre></td></tr></table></figure>
<p>æ³¨ï¼šé˜²ç«å¢™éœ€è¦å¼€æ”¾12345ï¼Œ12346ç«¯å£</p>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">-A INPUT -i  eth0 -p tcp -m <span class="keyword">state</span> --state NEW -m tcp --dport <span class="number">12345</span> -j ACCEPT</div><div class="line">-A INPUT -i  eth0 -p tcp -m <span class="keyword">state</span> --state NEW -m tcp --dport <span class="number">12346</span> -j ACCEPT</div></pre></td></tr></table></figure>
<p>###4ã€æœåŠ¡ç«¯æµ‹è¯•æ˜¯å¦å¯ä»¥è·å–æ•°æ®</p>
<p>å‘½ä»¤è¡Œä¸‹æµ‹è¯•éœ€è¦cmdline-jmxclient-0.10.3.jarè¿™ä¸ªåŒ…ï¼Œæµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š</p>
<p>è¿™ä¸ªåŒ…ä¸‹è½½åœ°å€:<a href="http://oak0aohum.bkt.clouddn.com/cmdline-jmxclient-0.10.3.jar" target="_blank" rel="external">cmdline-jmxclient-0.10.3.jar</a></p>
<p>åœ¨zabbix serverä¸Šæ‰§è¡Œ</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">java -jar /tmp/cmdline-jmxclient-<span class="number">0.10</span>.<span class="number">3</span><span class="selector-class">.jar</span> - <span class="number">192.168</span>.<span class="number">7.186</span>:<span class="number">12345</span> java<span class="selector-class">.lang</span>:type=Memory NonHeapMemoryUsage</div></pre></td></tr></table></figure>
<p>å¦‚æœæœ‰å¦‚ä¸‹å›æ˜¾è¡¨ç¤ºjmxé…ç½®æ­£ç¡®ï¼Œå¦‚ä¸æ­£ç¡®ï¼Œè¯·æ£€æŸ¥é…ç½®,çœ‹ä¸‹ç«¯å£å¯åŠ¨æ˜¯å¦æ­£å¸¸ï¼Œserver.xml é…ç½®ã€‚</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="number">07</span><span class="regexp">/22/</span><span class="number">2016</span> <span class="number">14</span>:<span class="number">45</span>:<span class="number">28</span> +<span class="number">0800</span> org.archive.jmx.Client <span class="string">NonHeapMemoryUsage:</span></div><div class="line"><span class="string">committed:</span> <span class="number">80347136</span></div><div class="line"><span class="string">init:</span> <span class="number">24576000</span></div><div class="line"><span class="string">max:</span> <span class="number">136314880</span></div><div class="line"><span class="string">used:</span> <span class="number">46634984</span></div></pre></td></tr></table></figure>
<p>å†™ä¸ªè„šæœ¬è‡ªåŠ¨åˆ¤æ–­ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">vim context.sh</div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line">java -jar /opt/tomcat/cmdline-jmxclient-0.10.3.jar - 10.46.72.172:12345 Catalina:<span class="built_in">type</span>=Manager,*| awk -F <span class="string">","</span> <span class="string">'&#123; print $1 &#125;'</span>|awk -F: <span class="string">'&#123; print $2 &#125;'</span>&gt;/tmp/tomcat/context.csv</div></pre></td></tr></table></figure>
<h2 id="ä¸‰ã€å¯¼å…¥æ¨¡æ¿åˆ°zabbixï¼Œå¹¶å…³è”åˆ°ä¸»æœºï¼Œæ·»åŠ ç›‘æ§"><a href="#ä¸‰ã€å¯¼å…¥æ¨¡æ¿åˆ°zabbixï¼Œå¹¶å…³è”åˆ°ä¸»æœºï¼Œæ·»åŠ ç›‘æ§" class="headerlink" title="ä¸‰ã€å¯¼å…¥æ¨¡æ¿åˆ°zabbixï¼Œå¹¶å…³è”åˆ°ä¸»æœºï¼Œæ·»åŠ ç›‘æ§"></a>ä¸‰ã€å¯¼å…¥æ¨¡æ¿åˆ°zabbixï¼Œå¹¶å…³è”åˆ°ä¸»æœºï¼Œæ·»åŠ ç›‘æ§</h2><p>è¿™æ ·ä¹Ÿå¯ä»¥é€‰æ‹©ç³»ç»Ÿè‡ªå¸¦çš„ï¼Œæˆ‘è¿™é‡Œzabbixç‰ˆæœ¬æ˜¯3.0çš„ï¼Œç³»ç»Ÿè‡ªå¸¦çš„å¯ä»¥é€‰æ‹©ï¼š<br>é€‰æ‹©é…ç½®ï¼šä¸»æœº-æ¨¡æ¿-é€‰æ‹©-æ¨¡æ¿-ï¼š<br>Template JMX Tomcat<br>Template JMX Generic</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-tomcat4.png" alt=""></figure></p>
<p>ä»ç½‘ä¸Šä¸‹è½½äº†ä¸€ä¸ªä¸é”™çš„æ¨¡æ¿ï¼Œå¯¼å…¥åå¦‚ä¸‹ï¼š</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-tomcat2.png" alt=""></figure><br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-tomcat3.png" alt=""></figure></p>
<p>å¯¼å…¥æ¨¡æ¿ä»¥åä¸»æœºæ·»åŠ ç«¯å£ï¼š</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-tomcat6.png" alt=""></figure></p>
<p>ç„¶åæŸ¥çœ‹å›¾å½¢ï¼š<br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-tomcat5.png" alt=""></figure></p>
<p>å°±æœ‰äº†ã€‚</p>
<h3 id="å››ã€å¦‚ä½•ç›‘æ§å•ä¸»æœºå¤šä¸ªtomcat"><a href="#å››ã€å¦‚ä½•ç›‘æ§å•ä¸»æœºå¤šä¸ªtomcat" class="headerlink" title="å››ã€å¦‚ä½•ç›‘æ§å•ä¸»æœºå¤šä¸ªtomcat"></a>å››ã€å¦‚ä½•ç›‘æ§å•ä¸»æœºå¤šä¸ªtomcat</h3><p>ç›‘æ§å¤šä¸ªtomcatå®ä¾‹ï¼Œç½‘ä¸Šçš„è¯¦ç»†çš„é…ç½®æ–‡æ¡£å¾ˆå°‘ï¼Œå‡ ä¹æ²¡æœ‰ã€‚æ¯”è¾ƒå¥½çš„åŠæ³•æ˜¯ä½¿ç”¨è‡ªåŠ¨å‘ç°ï¼Œä½†åˆšä½¿ç”¨zabbixï¼Œæ¥ä¸åŠç ”ç©¶ï¼Œæ‰€ä»¥é‡‡ç”¨ç¬¨æ³•ï¼Œä¿®æ”¹æ¨¡æ¿ã€ç›‘æ§é¡¹ã€å›¾å½¢æ¥è¾¾åˆ°æœ€ç»ˆç›®çš„ã€‚<br>å…³é”®é…ç½®ï¼š<br>1ã€æ·»åŠ ä¸»æœºæ—¶æ·»åŠ å¤šä¸ªjmxç«¯å£</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-tomcat7.png" alt=""></figure></p>
<p>2ã€ä¿®æ”¹ç›‘æ§é¡¹ã€é”®å€¼<br>åœ¨åŒä¸€ä¸»æœºä¸Šï¼Œzabbixä¸å…é”®å€¼é‡å¤ï¼Œä½†æ˜¯ç›‘æ§çš„é¡¹ç›®æ˜¯ä¸€æ ·çš„ï¼Œä¸å¯èƒ½é”®å€¼å†™çš„ä¸é‡å¤ï¼Œç»è¿‡å‡ ç•ªæœç´¢ï¼Œæ‰¾åˆ°æ–¹æ³•å¦‚ä¸‹ï¼š<br>åªè¦åœ¨ç®­å¤´å¤„æ·»åŠ 1ä¸ªç©ºæ ¼å°±å¯ä»¥ï¼Œä¹Ÿå¯ä»¥æ˜¯å¤šä¸ªã€‚ï¼ˆæ³¨æ„ä½ç½®ä¸è¦é”™ï¼Œåœ¨é€—åˆ°åé¢ï¼‰</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-tomcat8.png" alt=""></figure></p>
<p>å‰©ä¸‹çš„å°±æ˜¯ä½“åŠ›æ´»äº†ï¼Œå…‹éš†ç›‘æ§é¡¹ã€ä¿®æ”¹ç›‘æ§é¡¹ã€å…‹éš†å›¾å½¢ã€ä¿®æ”¹å›¾å½¢ã€‚ã€‚ã€‚<br>ä»¥ä¸‹æ˜¯ä¸¤ä¸ªtomcatå®ä¾‹çš„ç›‘æ§é¡¹ï¼š</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-tomcat10.png" alt=""></figure></p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-tomcat9.png" alt=""></figure></p>
<p>å¤šä¸ªtomcatåœ¨ä¸€å°ä¸»æœºä¸Šé¢æœ€åçš„ç›‘æ§æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-tomcat11.png" alt=""></figure></p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-tomcat12.png" alt=""></figure></p>
<p>ä¸€å¼€å§‹zabbixç›‘æ§tomcat ä¸€è·¯é¡ºç•…ï¼Œå¯æ˜¯åˆ°æµ‹è¯•æ­£ä¸æ­£å¸¸æ—¶å€™ï¼Œè¿”å›æ‹’ç»è¿æ¥ï¼Œç¬¬ä¸€æ—¶é—´æƒ³åˆ°å°±æ˜¯é…ç½®æœ‰é—®é¢˜ï¼š</p>
<p>æˆ‘æ˜¯å‚è€ƒè¿™ä¸ªè§£å†³äº†ã€‚</p>
<p>å…·ä½“å‚æ•°å†…å®¹è¯·å‚è€ƒ <a href="https://tomcat.apache.org/tomcat-7.0-doc/config/listeners.html#Additional_Implementations" target="_blank" rel="external">apache tomcat æ–‡æ¡£</a></p>
<p>ä¹Ÿéå¸¸æ„Ÿè°¢ï¼šå¼ çˆ±å¾·å¤§ç¥ ä¸€è·¯zabbixä¸Šé¢çš„å¸®æˆ‘ä¸€èµ·æ’å‘ï¼š</p>
<p>zabbixå¤§ç¥ ä»–çš„åšå®¢blogï¼š<a href="https://blog.cactifans.com" target="_blank" rel="external">https://blog.cactifans.com</a></p>

	

	

</article>




	<article>
	
		<h1><a href="/2016/06/21/æ€§èƒ½ç›‘æ§/Zabbix/zabbixç›‘æ§tcpè¿æ¥æ•°/">zabbixç›‘æ§tcpè¿æ¥æ•°</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-06-21</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/monitoring/">monitoring</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Zabbix-monitoring/">Zabbix monitoring</a>
			</span>
		
	</div>

	

	
		<p>ç³»ç»Ÿç¯å¢ƒ:</p>
<p>CentOS release 6.7 (Final)</p>
<p>zabbix.3.0.3</p>
<h3 id="zabbix-serverç«¯ï¼š"><a href="#zabbix-serverç«¯ï¼š" class="headerlink" title="zabbix-serverç«¯ï¼š"></a>zabbix-serverç«¯ï¼š</h3><p>é¦–å…ˆåˆ›å»ºè„šæœ¬ Shell</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mkdir /usr/<span class="built_in">local</span>/zabbix/scripts</div><div class="line">[root@zabbix scripts]<span class="comment"># vim /usr/local/zabbix/scripts/tcp_connections.sh</span></div></pre></td></tr></table></figure>
<p>scriptï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"> </div><div class="line"><span class="function"><span class="title">stat</span></span>() &#123;</div><div class="line">        netstat -an | awk <span class="string">'/^tcp/ &#123;++S[$NF]&#125; END &#123;for(a in S) print a, S[a]&#125;'</span></div><div class="line">        &#125;</div><div class="line"> </div><div class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></div><div class="line">        TIME_WAIT)</div><div class="line">        <span class="built_in">stat</span> |grep <span class="string">'TIME_WAIT'</span> |awk <span class="string">'&#123;print $2&#125;'</span></div><div class="line">        ;;</div><div class="line">        CLOSE_WAIT)</div><div class="line">        <span class="built_in">stat</span> | grep <span class="string">'CLOSE_WAIT'</span> |awk <span class="string">'&#123;print $2&#125;'</span></div><div class="line">        ;;</div><div class="line">        FIN_WAIT1)</div><div class="line">        <span class="built_in">stat</span> | grep <span class="string">'FIN_WAIT1'</span> |awk <span class="string">'&#123;print $2&#125;'</span></div><div class="line">        ;;</div><div class="line">        ESTABLISHED)</div><div class="line">        <span class="built_in">stat</span> | grep <span class="string">'ESTABLISHED'</span> |awk <span class="string">'&#123;print $2&#125;'</span></div><div class="line">        ;;</div><div class="line">        SYN_RECV)</div><div class="line">        <span class="built_in">stat</span> |grep <span class="string">'SYN_RECV'</span> |awk <span class="string">'&#123;print $2&#125;'</span></div><div class="line">        ;;</div><div class="line">        LAST_ACK)</div><div class="line">        <span class="built_in">stat</span> |grep <span class="string">'LAST_ACK'</span> |awk <span class="string">'&#123;print $2&#125;'</span></div><div class="line">        ;;</div><div class="line">        LISTEN)</div><div class="line">        <span class="built_in">stat</span> |grep <span class="string">'LISTEN'</span> |awk <span class="string">'&#123;print $2&#125;'</span></div><div class="line">        ;;</div><div class="line">        *)</div><div class="line">        <span class="built_in">echo</span> <span class="string">"Usage: TIME_WAIT CLOSE_WAIT FIN_WAIT1 ESTABLISHED SYN_RECV LAST_ACK LISTEN"</span></div><div class="line">        ;;</div><div class="line"><span class="keyword">esac</span></div></pre></td></tr></table></figure>
<p>æµ‹è¯•è„šæœ¬æ˜¯å¦å¯ç”¨</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@zabbix scripts]<span class="comment">#  chmod +x tcp_connections.sh</span></div><div class="line">[root@zabbix scripts]<span class="comment">#  ./tcp_connections.sh ESTABLISHED</span></div><div class="line">59</div></pre></td></tr></table></figure>
<h3 id="zabbix-agentç«¯ï¼š"><a href="#zabbix-agentç«¯ï¼š" class="headerlink" title="zabbix-agentç«¯ï¼š"></a>zabbix-agentç«¯ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@zabbix scripts]<span class="comment">#  vim /usr/local/zabbix/etc/zabbix_agentd.conf.d/monitor_tcp_connections.conf</span></div></pre></td></tr></table></figure>
<p>ç¼–è¾‘serverç«¯zabbix_agentdé…ç½®</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">UserParameter=tcp.time_wait,/usr/<span class="built_in">local</span>/zabbix/scripts/tcp_connections.sh TIME_WAIT</div><div class="line">UserParameter=tcp.close_wait,/usr/<span class="built_in">local</span>/zabbix/scripts/tcp_connections.sh CLOSE_WAIT</div><div class="line">UserParameter=tcp.fin_wait1,/usr/<span class="built_in">local</span>/zabbix/scripts/tcp_connections.sh FIN_WAIT1</div><div class="line">UserParameter=tcp.established,/usr/<span class="built_in">local</span>/zabbix/scripts/tcp_connections.sh ESTABLISHED</div><div class="line">UserParameter=tcp.syn_recv,/usr/<span class="built_in">local</span>/zabbix/scripts/tcp_connections.sh SYN_RECV</div><div class="line">UserParameter=tcp.last_ack,/usr/<span class="built_in">local</span>/zabbix/scripts/tcp_connections.sh LAST_ACK</div><div class="line">UserParameter=tcp.listen,/usr/<span class="built_in">local</span>/zabbix/scripts/tcp_connections.sh LISTEN</div></pre></td></tr></table></figure>
<h3 id="é‡å¯æœåŠ¡"><a href="#é‡å¯æœåŠ¡" class="headerlink" title="é‡å¯æœåŠ¡"></a>é‡å¯æœåŠ¡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@zabbix scripts]<span class="comment"># /etc/init.d/zabbix_agentd restart</span></div><div class="line">Shutting down zabbix_agentd:                               [ç¡®å®š]</div><div class="line">Starting zabbix_agentd:                                    [ç¡®å®š]</div></pre></td></tr></table></figure>
<h3 id="æµ‹è¯•ç›‘æ§æ˜¯å¦æœ‰æ•°æ®"><a href="#æµ‹è¯•ç›‘æ§æ˜¯å¦æœ‰æ•°æ®" class="headerlink" title="æµ‹è¯•ç›‘æ§æ˜¯å¦æœ‰æ•°æ®"></a>æµ‹è¯•ç›‘æ§æ˜¯å¦æœ‰æ•°æ®</h3><figure class="highlight dts"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta-keyword">/usr/</span>local<span class="meta-keyword">/zabbix/</span>bin/zabbix_get -s localhost -k tcp.established</div><div class="line"><span class="symbol">ZBX_NOTSUPPORTED:</span> Unsupported item key.</div></pre></td></tr></table></figure>
<p>å‡ºç°è¿™ä¸ªé”™è¯¯ï¼Œæç¤ºæˆ‘keyå€¼æœ‰é—®é¢˜ã€‚<br>æ‰€ä»¥æˆ‘æ£€æŸ¥äº†ä¸‹é…ç½®ã€‚</p>
<p>æ·»åŠ äº†ä¸€æ¡ç›®å½•ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">vim /usr/<span class="built_in">local</span>/zabbix/etc/zabbix_agentd.conf</div><div class="line">Include=/usr/<span class="built_in">local</span>/zabbix/etc/zabbix_agentd.conf.d/*.conf</div></pre></td></tr></table></figure>
<p>ç„¶åæµ‹è¯•ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@zabbix scripts]<span class="comment"># /usr/local/zabbix/bin/zabbix_get -s localhost -k tcp.established</span></div><div class="line">64</div></pre></td></tr></table></figure>
<p>ç„¶ååœ¨webé‡Œåˆ›å»ºæ¨¡ç‰ˆï¼Œæ–¹ä¾¿ä»¥åå¤šå°æ·»åŠ </p>
<p>é€‰æ‹©é…ç½®-æ¨¡æ¿-å³ä¸Šè§’.åˆ›å»ºæ¨¡æ¿</p>
<p>å¡«å†™æ¨¡ç‰ˆåç§°</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-tcp1.png" alt=""></figure></p>
<p>åˆ›å»ºç›‘æ§é¡¹</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-tcp2.png" alt=""></figure></p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-tcp3.png" alt=""></figure><br> å¯ä»¥å…‹éš†åˆ›å»ºç›‘æ§é¡¹ã€‚</p>
<p>åˆ›å»ºå›¾å½¢</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-tcp4.png" alt=""></figure></p>
<p>æ¨¡ç‰ˆåˆ›å»ºå®Œæˆåï¼Œè¦å…³è”åˆ°ç›‘æ§ä¸»æœº</p>
<p>ç‚¹å‡»ä¸»æœºï¼Œé€‰æ‹©æ¨¡ç‰ˆ</p>
<p>ç­‰ä¸€ä¼šå„¿æ•°æ®å›¾å½¢å°±ä¼šå‡ºç°</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-tcp6.png" alt=""></figure></p>
<p>å…¶ä»–æœºå™¨ä¹Ÿæ˜¯ä¸€æ ·ç›´æ¥æ·»åŠ æ¨¡æ¿å³å¯ã€‚åœ¨agentdä¸‹é¢æ·»åŠ keyé”®å€¼é‡å¯æœåŠ¡å°±è¡Œã€‚</p>
<p>å¯å‚è€ƒï¼š</p>
<p><a href="http://www.cenhq.com/2015/09/06/zabbix-monitor-tcp-connection-number/" target="_blank" rel="external">zabbixç›‘æ§tcpè¿æ¥æ•°</a></p>
<p>zabbix-server2.4æœåŠ¡ç«¯ç¼–è¯‘å®‰è£… <a href="http://blog.yangcvo.me/2015/01/18/zabbix-serveræœåŠ¡ç«¯ç¼–è¯‘å®‰è£…/" target="_blank" rel="external">zabbix-serveræœåŠ¡ç«¯ç¼–è¯‘å®‰è£…</a></p>
<p>zabbix2.4ç›‘æ§80ç«¯å£çŠ¶æ€ : <a href="http://blog.yangcvo.me/2016/07/20/zabbixç›‘æ§80ç«¯å£çŠ¶æ€/" target="_blank" rel="external">zabbixç›‘æ§80ç«¯å£çŠ¶æ€</a></p>
<p>zabbix+Grafanaå®‰è£…ä½¿ç”¨ç›‘æ§ç»“åˆ ï¼š<a href="http://blog.yangcvo.me/2016/07/13/zabbix-Grafanaå®‰è£…ä½¿ç”¨ç»“åˆ/" target="_blank" rel="external">zabbix+Grafanaå®‰è£…ä½¿ç”¨ç›‘æ§ç»“åˆ</a></p>
<p>zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹ : <a href="http://blog.yangcvo.me/2015/09/29/zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹/" target="_blank" rel="external">zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹</a></p>
<p>zabbixçš„ICMP_Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§ : <a href="http://blog.yangcvo.me/2015/11/18/zabbixçš„ICMP-Pingæ¨¡ç‰ˆ&gt;å®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§/" target="_blank" rel="external">zabbixçš„ICMP_Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§</a></p>
<p>zabbixæ€§èƒ½ç›‘æ§æ•…éšœæ€»ç»“ <a href="http://blog.yangcvo.me/2016/02/07/zabbix-æ•…éšœæ€»ç»“/" target="_blank" rel="external">zabbixæ€§èƒ½ç›‘æ§æ•…éšœæ€»ç»“</a></p>

	

	

</article>




	<article>
	
		<h1><a href="/2016/06/19/æ€§èƒ½ç›‘æ§/Zabbix/zabbix-server3-0-3ç‰ˆæœ¬ç¯å¢ƒå®‰è£…éƒ¨ç½²/">zabbix-server3.0.3ç‰ˆæœ¬ç¯å¢ƒå®‰è£…éƒ¨ç½²</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-06-19</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/monitoring/">monitoring</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Zabbix-monitoring/">Zabbix monitoring</a>
			</span>
		
	</div>

	

	
		<h2 id="ç³»ç»Ÿç¯å¢ƒï¼š"><a href="#ç³»ç»Ÿç¯å¢ƒï¼š" class="headerlink" title="ç³»ç»Ÿç¯å¢ƒï¼š"></a>ç³»ç»Ÿç¯å¢ƒï¼š</h2><ul>
<li>192.168.1.170 MySQLä¸» </li>
<li>192.168.1.183 zabbix-server</li>
</ul>
<p>CentOS Linux release 7.2.1511 (Core)</p>
<ul>
<li>zabbixæºç ä¸‹è½½ : <a href="http://www.zabbix.com/download.php" target="_blank" rel="external">http://www.zabbix.com/download.php</a></li>
<li>ä¾èµ–ä¸‹è½½ï¼š <a href="https://github.com/zabbixcn/curl-rpm/tree/master/RPMS" target="_blank" rel="external">https://github.com/zabbixcn/curl-rpm/tree/master/RPMS</a></li>
<li>zabbix Downä¸‹è½½å®‰è£…åŒ…ï¼š<a href="http://repo.zabbix.com/zabbix/3.2/rhel/6/x86_64/" target="_blank" rel="external">http://repo.zabbix.com/zabbix/3.2/rhel/6/x86_64/</a></li>
<li>zabbix3.2 <a href="http://jaist.dl.sourceforge.net/project/zabbix/ZABBIX%20Latest%20Stable/3.2.4/zabbix-3.2.4.tar.gz" target="_blank" rel="external">http://jaist.dl.sourceforge.net/project/zabbix/ZABBIX%20Latest%20Stable/3.2.4/zabbix-3.2.4.tar.gz</a></li>
</ul>
<h3 id="ç¬¬ä¸€æ­¥zabbixï¼š"><a href="#ç¬¬ä¸€æ­¥zabbixï¼š" class="headerlink" title="ç¬¬ä¸€æ­¥zabbixï¼š"></a>ç¬¬ä¸€æ­¥zabbixï¼š</h3><p>å…³é—­æœ¬æœºä¸Šçš„selinuxä¸iptablesæœåŠ¡</p>
<p>1ã€å…³é—­SELinux</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#ä¸‹é¢çš„å‘½ä»¤å®ç°æ°¸ä¹…å…³é—­SELinux</span></div><div class="line"> sed -i <span class="string">'s/^SELINUX=.*/#&amp;/;s/^SELINUXTYPE=.*/#&amp;/;/SELINUX=.*/a SELINUX=disabled'</span> /etc/sysconfig/selinux</div><div class="line"><span class="comment">#ä¸‹é¢çš„å‘½ä»¤å®ç°ä¸´æ—¶å…³é—­SELinux</span></div><div class="line"></div><div class="line">/usr/sbin/setenforce 0</div><div class="line">/usr/sbin/setenforce: SELinux is disabled</div></pre></td></tr></table></figure>
<p>ä¹Ÿå¯ä»¥è®¾ç½®å¼€æ”¾ç«¯å£å‡ºå»ã€‚</p>
<p>CentOS 7.0é»˜è®¤ä½¿ç”¨çš„æ˜¯firewallä½œä¸ºé˜²ç«å¢™ï¼Œè¿™é‡Œæ”¹ä¸ºiptablesé˜²ç«å¢™ã€‚</p>
<p>firewallï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">systemctl start firewalld.service<span class="comment">#å¯åŠ¨firewall</span></div><div class="line">systemctl stop firewalld.service<span class="comment">#åœæ­¢firewall</span></div><div class="line">systemctl <span class="built_in">disable</span> firewalld.service<span class="comment">#ç¦æ­¢firewallå¼€æœºå¯åŠ¨</span></div></pre></td></tr></table></figure>
<p>CentOS7é»˜è®¤çš„é˜²ç«å¢™ä¸æ˜¯iptables,è€Œæ˜¯firewalle.<br>centos 7 çš„é»˜è®¤æ²¡æœ‰å®‰è£…iptables éœ€è¦å®‰è£…ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">yum install iptables-services</div><div class="line"><span class="comment">#ä¿å­˜ä¸Šè¿°è§„åˆ™ </span></div><div class="line">service iptables save</div></pre></td></tr></table></figure>
<p>ç­‰ä¼šå†æ·»åŠ ç«¯å£ï¼š10050 ï¼Œ10051 </p>
<p>æ­å»ºLAMPç¯å¢ƒï¼Œæˆ–LNMPç¯å¢ƒ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install mysql-server httpd php â€“y</div></pre></td></tr></table></figure>
<p>å®‰è£…å…¶å®ƒä¾èµ–åŒ…</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install mysql-devel gcc net-snmp-devel curl-devel perl-DBI php-gd php-mysql php-bcmath  php-mbstring php-<span class="keyword">xml</span> <span class="title">â€“y</span>  gcc OpenIPMI-devel net-snmp-devel.x86_64 libxml2-devel mysql-devel</div></pre></td></tr></table></figure>
<p> è¿™é‡ŒMySQLæˆ‘å·²ç»åœ¨MySQLæœåŠ¡å™¨ä¸Šé¢å®‰è£…å¥½äº†ã€‚åªéœ€è¦åˆ›å»ºä¸ªæ–°çš„zabbixæ•°æ®åº“å³å¯ã€‚</p>
<p> å¢åŠ zabbixç”¨æˆ·å’Œç»„</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">groupadd zabbix</div><div class="line">useradd â€“g zabbix â€“m zabbix</div></pre></td></tr></table></figure>
<p>ä¸‹è½½zabbix3.0ç‰ˆæœ¬ï¼Œè§£å‹å®‰è£…</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">wget http://oak0aohum.bkt.clouddn.com/zabbix-3.0.3.tar.gz  -c /tmp/</div><div class="line"><span class="built_in">cd</span> /tmp/</div><div class="line">tar zxf zabbix-3.0.3.tar.gz</div><div class="line">./configure --prefix=/usr/<span class="built_in">local</span>/zabbix --enable-server --with-mysql --with-net-snmp --with-libxml2 --with-libcurl --with-openipmi --enable-proxy --enable-agent --enable-java --with-ldap</div><div class="line"></div><div class="line">ç¼–è¯‘æˆåŠŸè¿™é‡Œä¼šå‡ºç°ï¼š</div><div class="line">***********************************************************</div><div class="line">*            Now run <span class="string">'make install'</span>                       *</div><div class="line">*                                                         *</div><div class="line">*            Thank you <span class="keyword">for</span> using Zabbix!                  *</div><div class="line">*              &lt;http://www.zabbix.com&gt;                    *</div><div class="line">***********************************************************</div><div class="line"><span class="comment">#ç›´æ¥make install å®‰è£…å³å¯ï¼š</span></div><div class="line"> </div><div class="line">make install</div></pre></td></tr></table></figure>
<p>è¿™é‡Œç¼–è¯‘å®‰è£… æˆ‘åŠ ä¸Šäº†ï¼šâ€“enable-java è¿™æ ·é˜²æ­¢åæœŸç›‘æ§tomcatéœ€è¦é‡æ–°ç¼–è¯‘ã€‚</p>
<h3 id="3-é…ç½®æ•°æ®åº“"><a href="#3-é…ç½®æ•°æ®åº“" class="headerlink" title="3.é…ç½®æ•°æ®åº“"></a>3.é…ç½®æ•°æ®åº“</h3><p> ç™»é™†åˆ°192.168.1.170æœåŠ¡å™¨ä¸Šé¢ï¼š</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># mysql -e "create database zabbix character set utf8 collate  utf8_bin;"   #ä¿®æ”¹æ—¶åŒº</span></div><div class="line"><span class="comment"># mysql -e "grant all privileges on zabbix.* to zabbix@localhost identified by 'zabbix';"  #åˆ›å»ºæ•°æ®åº“å</span></div></pre></td></tr></table></figure>
<p> è¿™é‡Œæˆ‘è®¾ç½®äº†åªèƒ½192.168.1.0ç½‘æ®µå¯ä»¥è®¿é—®æ•°æ®åº“ã€‚<br> æ‰€ä»¥è¿™é‡Œåˆ›å»ºæ•°æ®åº“ç›´æ¥è¿™ä¹ˆæ“ä½œäº†ã€‚</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">[root@mysql ~]<span class="comment"># mysql -uroot -pIhaozhuo_b313 -h 192.168.1.170</span></div><div class="line">Warning: Using a password on the <span class="built_in">command</span> line interface can be insecure.</div><div class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</div><div class="line">Your MySQL connection id is 10</div><div class="line">Server version: 5.6.20-log MySQL Community Server (GPL)</div><div class="line"></div><div class="line">Copyright (c) 2000, 2014, Oracle and/or its affiliates. All rights reserved.</div><div class="line"></div><div class="line">Oracle is a registered trademark of Oracle Corporation and/or its</div><div class="line">affiliates. Other names may be trademarks of their respective</div><div class="line">owners.</div><div class="line"></div><div class="line">Type <span class="string">'help;'</span> or <span class="string">'\h'</span> <span class="keyword">for</span> help. Type <span class="string">'\c'</span> to clear the current input statement.</div><div class="line"></div><div class="line">mysql&gt; create database zabbix character <span class="built_in">set</span> utf8 collate  utf8_bin;</div><div class="line">Query OK, 1 row affected (0.06 sec)</div><div class="line">mysql&gt; GRANT ALL ON zabbix.* TO <span class="string">'zabbix'</span>@<span class="string">'192.168.1.%'</span> IDENTIFIED BY <span class="string">'zabbix123.com'</span>;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line">mysql&gt; flush privileges;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div></pre></td></tr></table></figure>
<h3 id="å››-å¯¼å…¥æ•°æ®åº“æ–‡ä»¶ï¼š"><a href="#å››-å¯¼å…¥æ•°æ®åº“æ–‡ä»¶ï¼š" class="headerlink" title="å››.å¯¼å…¥æ•°æ®åº“æ–‡ä»¶ï¼š"></a>å››.å¯¼å…¥æ•°æ®åº“æ–‡ä»¶ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /usr/share/doc/zabbix-server-mysql-2.4.8/create</div></pre></td></tr></table></figure>
<p>æ“ä½œä¸‰æ¡å‘½ä»¤æŠŠæ•°æ®å¯¼å…¥åˆ°åœ¨æŒ‡å®šçš„MySQLï¼šzabbix</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mysql -uzabbix -pzabbix123.com -h 192.168.1.170  zabbix &lt; schema.sql</div><div class="line">mysql -uzabbix -pzabbix123.com -h 192.168.1.170  zabbix &lt; images.sql</div><div class="line">mysql -uzabbix -pzabbix123.com -h 192.168.1.170  zabbix &lt; data.sql</div></pre></td></tr></table></figure>
<h3 id="äº”ã€é…ç½®æ–‡ä»¶åŠwebå‰ç«¯æ–‡ä»¶ä¿®æ”¹"><a href="#äº”ã€é…ç½®æ–‡ä»¶åŠwebå‰ç«¯æ–‡ä»¶ä¿®æ”¹" class="headerlink" title="äº”ã€é…ç½®æ–‡ä»¶åŠwebå‰ç«¯æ–‡ä»¶ä¿®æ”¹"></a>äº”ã€é…ç½®æ–‡ä»¶åŠwebå‰ç«¯æ–‡ä»¶ä¿®æ”¹</h3><p>æ·»åŠ æœåŠ¡ç«¯å£</p>
<p>vi /etc/services #ç¼–è¾‘ï¼Œåœ¨æœ€åæ·»åŠ ä»¥ä¸‹ä»£ç </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Zabbix</span></div><div class="line">zabbix-agent 10050/tcp   <span class="comment"># Zabbix Agent</span></div><div class="line">zabbix-agent 10050/udp   <span class="comment"># Zabbix Agent</span></div><div class="line">zabbix-trapper 10051/tcp <span class="comment"># Zabbix Trapper</span></div><div class="line">zabbix-trapper 10051/udp <span class="comment"># Zabbix Trapper</span></div><div class="line">:wq! <span class="comment">#ä¿å­˜é€€å‡º</span></div></pre></td></tr></table></figure>
<p>æ·»åŠ åå¦‚ä¸‹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># grep zabbix /etc/services</span></div><div class="line">zabbix-agent     10050/tcp  <span class="comment">#ZabbixAgent</span></div><div class="line">zabbix-agent     10050/udp  <span class="comment">#ZabbixAgent</span></div><div class="line">zabbix-trapper   10051/tcp  <span class="comment">#ZabbixTrapperz</span></div><div class="line">abbix-trapper    10051/udp  <span class="comment">#ZabbixTrapper</span></div></pre></td></tr></table></figure>
<p>ä¿®æ”¹zabbixé…ç½®æ–‡ä»¶</p>
<p>vim /usr/local/zabbix/etc/zabbix_server.conf</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">DBName=zabbix <span class="comment">#æ•°æ®åº“åç§°</span></div><div class="line">DBUser=zabbix <span class="comment">#æ•°æ®åº“ç”¨æˆ·å</span></div><div class="line">DBPassword=zabbix123.com <span class="comment">#æ•°æ®åº“å¯†ç </span></div><div class="line">ListenIP=192.168.1.170 <span class="comment">#æ•°æ®åº“ipåœ°å€</span></div><div class="line">AlertScriptsPath=/usr/<span class="built_in">local</span>/zabbix/share/zabbix/alertscripts   <span class="comment">#zabbixè¿è¡Œè„šæœ¬å­˜æ”¾ç›®å½•</span></div></pre></td></tr></table></figure>
<p>:wq! #ä¿å­˜é€€å‡º</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">vi /usr/<span class="built_in">local</span>/zabbix/etc/zabbix_agentd.conf</div><div class="line">Include=/usr/<span class="built_in">local</span>/zabbix/etc/zabbix_agentd.conf.d/</div><div class="line">UnsafeUserParameters=1 <span class="comment">#å¯ç”¨è‡ªå®šä¹‰key</span></div><div class="line">:wq! <span class="comment">#ä¿å­˜é€€å‡º</span></div></pre></td></tr></table></figure>
<p>1.2 COPYç›¸å…³è„šæœ¬åˆ°æ–°ç¼–è¯‘çš„ç›®å½•ä¸‹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"> cp /tmp/zabbix-3.0.3/misc/init.d/fedora/core/zabbix_server  /etc/rc.d/init.d/zabbix_server</div><div class="line">[root@salt etc]<span class="comment"># cp /tmp/zabbix-3.0.3/misc/init.d/fedora/core/zabbix_agentd /etc/rc.d/init.d/zabbix_agentd</span></div><div class="line"></div><div class="line"></div><div class="line">ä¿®æ”¹è„šæœ¬è·¯å¾„ï¼š</div><div class="line"></div><div class="line">vim /etc/init.d/zabbix_server </div><div class="line">  </div><div class="line"> BASEDIR=/usr/<span class="built_in">local</span>/zabbix/</div><div class="line"></div><div class="line">vim /etc/init.d/zabbix_agentd</div><div class="line"></div><div class="line">BASEDIR=/usr/<span class="built_in">local</span>/zabbix  </div><div class="line"></div><div class="line">chmod +x /etc/rc.d/init.d/zabbix_server <span class="comment">#æ·»åŠ è„šæœ¬æ‰§è¡Œæƒé™</span></div><div class="line">chmod +x /etc/rc.d/init.d/zabbix_agentd <span class="comment">#æ·»åŠ è„šæœ¬æ‰§è¡Œæƒé™</span></div><div class="line">chkconfig zabbix_server on <span class="comment">#æ·»åŠ å¼€æœºå¯åŠ¨</span></div><div class="line">chkconfig zabbix_agentd on <span class="comment">#æ·»åŠ å¼€æœºå¯åŠ¨</span></div></pre></td></tr></table></figure>
<p>å…«ã€é…ç½®webç«™ç‚¹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> zabbix-2.4.8</div><div class="line">cp -r /zabbix-2.4.8/frontends/php /var/www/html/zabbix</div><div class="line"><span class="built_in">cd</span> /var/www/html/</div><div class="line">chown -R zabbix:zabbix zabbix</div></pre></td></tr></table></figure>
<p>service zabbix_server start #å¯åŠ¨zabbixæœåŠ¡ç«¯</p>
<p>service zabbix_agentd start #å¯åŠ¨zabbixå®¢æˆ·ç«¯</p>
<p>ç„¶åé‡å¯æœåŠ¡ã€‚</p>
<p>å‘ç°å‡ºç°<code>500</code> ç½‘é¡µæ— æ³•æ˜¾ç¤ºï¼Œæˆ‘å»ç½‘ä¸ŠGoogleäº†ä¸‹ï¼Œè¯´æˆ‘çš„PHPæ–‡ä»¶ç‰ˆæœ¬è¿‡ä½ã€‚</p>
<p>æˆ‘æŸ¥çœ‹äº†ä¸‹æˆ‘çš„ç‰ˆæœ¬ï¼š</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">php -version</div><div class="line">PHP <span class="number">5.3</span><span class="number">.3</span> (cli) (<span class="string">built:</span> Feb  <span class="number">9</span> <span class="number">2016</span> <span class="number">10</span>:<span class="number">36</span>:<span class="number">17</span>)</div><div class="line">Copyright (c) <span class="number">1997</span><span class="number">-2010</span> The PHP Group</div><div class="line">Zend Engine v2<span class="number">.3</span><span class="number">.0</span>, Copyright (c) <span class="number">1998</span><span class="number">-2010</span> Zend Technologies</div><div class="line"></div><div class="line">whereis php</div><div class="line"><span class="string">php:</span> <span class="regexp">/usr/</span>bin<span class="regexp">/php /</span>etc<span class="regexp">/php.d /</span>etc<span class="regexp">/php.ini /</span>usr<span class="regexp">/lib64/</span>php <span class="regexp">/usr/</span>share<span class="regexp">/php /</span>usr<span class="regexp">/share/</span>man<span class="regexp">/man1/</span>php<span class="number">.1</span>.gz</div></pre></td></tr></table></figure>
<p>æŸ¥è¯¢äº†ä¸‹è¿™æ˜¯é»˜è®¤å®‰è£…çš„ï¼Œyumå®‰è£…çš„ã€‚</p>
<p>mv /usr/share/php/ /usr/share/php.5.3.3<br>å¤‡ä»½ä¹‹å‰çš„æ–¹ä¾¿å›æ»šï¼Œç„¶åå‡çº§PHPï¼š</p>
<h3 id="å¿«é€Ÿå°†PHP-5-3å‡çº§è‡³PHP-5-5"><a href="#å¿«é€Ÿå°†PHP-5-3å‡çº§è‡³PHP-5-5" class="headerlink" title="å¿«é€Ÿå°†PHP 5.3å‡çº§è‡³PHP 5.5"></a>å¿«é€Ÿå°†PHP 5.3å‡çº§è‡³PHP 5.5</h3><p>CentOS 6.7<br>ä»¥ä¸‹ä¸º CentOS ä¸‹å®‰è£… PHP æ–¹æ³•ï¼š</p>
<p>æ·»åŠ  epel æº</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta"># rpm -Uvh http:<span class="comment">//download.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm</span></span></div></pre></td></tr></table></figure>
<p>æ·»åŠ  remi æº</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta"># rpm -Uvh http:<span class="comment">//rpms.famillecollet.com/enterprise/remi-release-6.rpm</span></span></div></pre></td></tr></table></figure>
<p>å®‰è£… PHP</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> yum --enablerepo=remi,remi-php55 install php-fpm php-common php-devel php-mysqlnd php-mbstring php-mcrypt</span></div></pre></td></tr></table></figure>
<p>æŸ¥çœ‹ PHP ç‰ˆæœ¬</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># <span class="selector-tag">php</span> <span class="selector-tag">-v</span></div><div class="line"><span class="selector-tag">PHP</span> 5<span class="selector-class">.5</span><span class="selector-class">.9</span> (<span class="selector-tag">cli</span>) (<span class="selector-tag">built</span>: <span class="selector-tag">Feb</span> 11 2014 08<span class="selector-pseudo">:25</span><span class="selector-pseudo">:33)</span></div><div class="line"><span class="selector-tag">Copyright</span> (<span class="selector-tag">c</span>) 1997<span class="selector-tag">-2014</span> <span class="selector-tag">The</span> <span class="selector-tag">PHP</span> <span class="selector-tag">Group</span></div><div class="line"><span class="selector-tag">Zend</span> <span class="selector-tag">Engine</span> <span class="selector-tag">v2</span><span class="selector-class">.5</span><span class="selector-class">.0</span>, <span class="selector-tag">Copyright</span> (<span class="selector-tag">c</span>) 1998<span class="selector-tag">-2014</span> <span class="selector-tag">Zend</span> <span class="selector-tag">Technologies</span></div></pre></td></tr></table></figure>
<p>å¯åŠ¨ php-fpm</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># service php-fpm start</span></div><div class="line"><span class="attribute">Starting</span> php-fpm:ã€€<span class="meta">ã€€[  OK  ]</span></div></pre></td></tr></table></figure>
<p>è¿™é‡Œé‡å¯å®Œä»¥åï¼Œè®°å¾—è¦è®©phpç”Ÿæ•ˆï¼Œä¸ç„¶çš„è¯ä¸è¡Œã€‚</p>
<p>æˆ‘ä¸€å¼€å§‹åˆ·æ–°è¿˜æ˜¯å‡ºç°äº†500é”™è¯¯ï¼Œåæ¥ç”¨phpæŒ‡é’ˆæµ‹è¯•äº†ä¸‹ç‰ˆæœ¬æ˜¯å¤šå°‘ï¼Ÿ</p>
<p>wwwç«™ç‚¹æ·»åŠ ã€‚info.php </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?php</span></span></div><div class="line"></div><div class="line"> phpinfo();</div><div class="line"></div><div class="line"><span class="meta">?&gt;</span>;</div></pre></td></tr></table></figure>
<p>è®¿é—®åœ°å€/info.php  å‡ºç°ç‰ˆæœ¬æ˜¯5.3 ç¯å¢ƒé—®é¢˜ï¼Œé‡å¯httpå°±å¯ä»¥äº†ã€‚</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-server3.0.png" alt=""></figure></p>
<p>è¿™é‡Œå·²ç»æå®šå’¯ã€‚</p>
<p> å¦‚æœå‡ºç°å›¾å½¢ä¹±ç ï¼šå¯ä»¥å‚è€ƒä¸‹é¢çš„æ–‡æ¡£ã€‚</p>
<p>å…¶å®æŠŠä¹‹å‰çš„å­—ä½“æ‹·è´è¿‡å»ï¼Œç„¶åå…ˆä¿®æ”¹ä¸‹é…ç½®æ–‡ä»¶å³å¯ã€‚</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cp <span class="regexp">/var/</span>www<span class="regexp">/html/</span>zabbix.<span class="number">2.4</span>.<span class="number">7</span><span class="regexp">/fonts/</span>simkai.ttf <span class="regexp">/var/</span>www<span class="regexp">/html/</span>zabbix<span class="regexp">/fonts/</span>.</div></pre></td></tr></table></figure>
<p>zabbix-server2.4æœåŠ¡ç«¯ç¼–è¯‘å®‰è£… <a href="http://blog.yangcvo.me/2015/01/18/zabbix-serveræœåŠ¡ç«¯ç¼–è¯‘å®‰è£…/" target="_blank" rel="external">zabbix-serveræœåŠ¡ç«¯ç¼–è¯‘å®‰è£…</a></p>
<p>zabbix2.4ç›‘æ§80ç«¯å£çŠ¶æ€ : <a href="http://blog.yangcvo.me/2016/07/20/zabbixç›‘æ§80ç«¯å£çŠ¶æ€/" target="_blank" rel="external">zabbixç›‘æ§80ç«¯å£çŠ¶æ€</a></p>
<p>zabbix+Grafanaå®‰è£…ä½¿ç”¨ç›‘æ§ç»“åˆ ï¼š<a href="http://blog.yangcvo.me/2016/07/13/zabbix-Grafanaå®‰è£…ä½¿ç”¨ç»“åˆ/" target="_blank" rel="external">zabbix+Grafanaå®‰è£…ä½¿ç”¨ç›‘æ§ç»“åˆ</a></p>
<p>zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹ : <a href="http://blog.yangcvo.me/2015/09/29/zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹/" target="_blank" rel="external">zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹</a></p>
<p>zabbixçš„ICMP_Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§ : <a href="http://blog.yangcvo.me/2015/11/18/zabbixçš„ICMP-Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§/" target="_blank" rel="external">zabbixçš„ICMP_Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§</a></p>
<p>zabbixæ€§èƒ½ç›‘æ§æ•…éšœæ€»ç»“ <a href="http://blog.yangcvo.me/2016/02/07/zabbix-æ•…éšœæ€»ç»“/" target="_blank" rel="external">zabbixæ€§èƒ½ç›‘æ§æ•…éšœæ€»ç»“</a></p>

	

	

</article>





	<span class="different-posts">ğŸ“– <a href="/page/8">more posts</a> ğŸ“–</span>



	</main>

	<footer class="footer">
	<div class="footer-content">
		
	      <div class="footer__element">
	<h5>Hi there,</h5>
	<p style="text-align:justify;">my name is Yancy, they know me as RadiantğŸ‘ğŸ‘. This blog is about Bi-data and my live.<br> I like ğŸŒ³ğŸŒ³ğŸŒ³</p>
</div>


	    
	      <div class="footer__element">
	<h5>Check out</h5>
	<ul class="footer-links">
		<li class="footer-links__link"><a href="/archives">Archive</a></li>
		
		  <li class="footer-links__link"><a href="/atom.xml">RSS</a></li>
	    
		<li class="footer-links__link"><a href="/about">about page</a></li>
		<li class="footer-links__link"><a href="/tags">Tags</a></li>
		<li class="footer-links__link"><a href="/categories">Categories</a></li>
	</ul>
</div>

	    

		<div class="footer-credit">
			<span>Â© 2017 Yancy | Powered by <a href="http://blog.yancy.cc/">Yancy</a> | Theme <a href="https://github.com/yangcvo">Yancy_GitHub</a></span>
		</div>

	</div>


</footer>



</body>

</html>
