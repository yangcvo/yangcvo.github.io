<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="theme-color" content="#33474d">
	<title>Yancy&#39;s blog</title>
	<link rel="stylesheet" href="/css/style.css" />
	
      <link rel="alternate" href="/atom.xml" title="Yancy&#39;s blog" type="application/atom+xml">
    
</head>

<body>

	<header class="header">
		<nav class="header__nav">
			
				<a href="/" class="header__link">Home</a>
			
				<a href="/tags" class="header__link">Tags</a>
			
				<a href="/archives" class="header__link">ARCHIVES</a>
			
				<a href="/about/About" class="header__link">ABOUT</a>
			
				<a href="http://weibo.com/yangcvo" class="header__link">Weibo</a>
			
				<a href="/atom.xml" class="header__link">RSS</a>
			
		</nav>
		<h1 class="header__title"><a href="/">Yancy&#39;s blog</a></h1>
		<h2 class="header__subtitle">SIMPLICITY IS PREREQUISITE FOR  RELIABILITY</h2>
	</header>

	<main>
		
	<span class="different-posts different-posts_earlier">ğŸ“– <a href="/page/12">earlier posts</a> ğŸ“–</span>




	<article>
	
		<h1><a href="/2014/10/04/æ€§èƒ½ç›‘æ§/Zabbix/zabbix-æ•…éšœæ€»ç»“/">zabbixæ€§èƒ½ç›‘æ§æ•…éšœæ€»ç»“</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2014-10-04</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/monitoring/">monitoring</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Zabbix-monitoring/">Zabbix monitoring</a>
			</span>
		
	</div>

	

	
		<h2 id="TOC"><a href="#TOC" class="headerlink" title="TOC"></a>TOC</h2><p>æ•ˆæœå¦‚ä¸‹ï¼š<br>[TOC]</p>
<h3 id="1-Zabbixçº¢è‰²å¼¹å‡ºæŠ¥é”™-zabbix-server-is-not-running-the-information-displayed-may-not-be-current"><a href="#1-Zabbixçº¢è‰²å¼¹å‡ºæŠ¥é”™-zabbix-server-is-not-running-the-information-displayed-may-not-be-current" class="headerlink" title="1.Zabbixçº¢è‰²å¼¹å‡ºæŠ¥é”™ zabbix server is not running: the information displayed may not be current"></a>1.Zabbixçº¢è‰²å¼¹å‡ºæŠ¥é”™ <code>zabbix server is not running: the information displayed may not be current</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">* æ’é”™:</div><div class="line">* </div><div class="line">1. æ£€æŸ¥   /var/www/html/zabbix/conf/zabbix.conf.php </div><div class="line">ç¡®å®š </div><div class="line"><span class="variable">$DB</span>[<span class="string">'DATABASE'</span>]  æ•°æ®åº“</div><div class="line"><span class="variable">$DB</span>[<span class="string">'USER'</span>]    ç”¨æˆ·</div><div class="line"><span class="variable">$DB</span>[<span class="string">'PASSWORD'</span>]   å¯†ç </div><div class="line">è¿™ä¸‰ä¸ªå‚æ•°éƒ½æ˜¯æ­£ç¡®çš„ã€‚ </div><div class="line">æ³¨æ„ï¼šæ¯æ¬¡æ”¹äº†å‚æ•°æ–‡ä»¶ä¸€å®šè¦è®°å¾—é‡å¯zabbix_server</div><div class="line">è¿™é‡Œéƒ½æ²¡é—®é¢˜ã€‚</div><div class="line"></div><div class="line">2. å…³é—­SELinuxçš„æ–¹æ³•:</div><div class="line">ä¿®æ”¹/etc/selinux/configæ–‡ä»¶ä¸­çš„SELINUX=<span class="string">""</span> ä¸º disabled ï¼Œç„¶åé‡å¯ã€‚</div><div class="line">å¦‚æœä¸æƒ³é‡å¯ç³»ç»Ÿï¼Œä½¿ç”¨å‘½ä»¤setenforce 0</div><div class="line">æ³¨:</div><div class="line">setenforce 1 è®¾ç½®SELinux æˆä¸ºenforcingæ¨¡å¼</div><div class="line">setenforce 0 è®¾ç½®SELinux æˆä¸ºpermissiveæ¨¡å¼ </div><div class="line">åœ¨liloæˆ–è€…grubçš„å¯åŠ¨å‚æ•°ä¸­å¢åŠ ï¼šselinux=0,ä¹Ÿå¯ä»¥å…³é—­selinux</div><div class="line">selinuxæ˜¯å¦å…³é—­ã€‚ä¸€å®šè¦å…³é—­è¿™ä¸ªï¼Œå¼€å¯selinuxä¼šå¼•èµ·ä¸€è¿ä¸²é—®é¢˜ï¼Œç”šè‡³zabbixçš„discoveryåŠŸèƒ½ä¹Ÿä¸èƒ½æ­£å¸¸ä½¿ç”¨</div><div class="line"></div><div class="line">3. ä¸Šé¢éƒ½æ²¡æœ‰é—®é¢˜ç„¶ååœ¨æŸ¥çœ‹æœåŠ¡æ˜¯å¦æ­£å¸¸å¯åŠ¨ã€‚</div><div class="line">æŸ¥çœ‹/tmp/zabbix_server.logå’Œ/tmp/zabbix_agent.logæ— ä»»ä½•å¼‚å¸¸ã€‚</div><div class="line">å¦‚æœæ—¥å¿—æç¤ºæŸ¥æ‰¾ä¸åˆ°ä¸»æœºåï¼Œæˆ‘ä»¬çœ‹ä¸‹æœåŠ¡æ˜¯å¦å¯åŠ¨ã€‚</div><div class="line"></div><div class="line">4. çœ‹zabbix_serverå’Œzabbix_agentè¿›ç¨‹ã€ç«¯å£éƒ½æ­£å¸¸ </div><div class="line">   netstat -ntulp</div><div class="line">å¦‚æœæ²¡æœ‰å¯åŠ¨ éœ€è¦æ‰‹åŠ¨å¯åŠ¨ä¸‹ï¼Œè¿™é‡Œå¯èƒ½æœåŠ¡æ²¡æœ‰å¯åŠ¨ï¼Œå¯åŠ¨æœåŠ¡å³å¯ã€‚</div></pre></td></tr></table></figure>
<h3 id="2-Zabbix-agentdæ—¥å¿—æŠ¥é”™Get-value-from-agent-failed-cannot-connect-to-192-168-1-218-10050-113-No-route-to-host"><a href="#2-Zabbix-agentdæ—¥å¿—æŠ¥é”™Get-value-from-agent-failed-cannot-connect-to-192-168-1-218-10050-113-No-route-to-host" class="headerlink" title="2.Zabbix-agentdæ—¥å¿—æŠ¥é”™Get value from agent failed: cannot connect to [[192.168.1.218]:10050]: [113] No route to host"></a>2.Zabbix-agentdæ—¥å¿—æŠ¥é”™<code>Get value from agent failed: cannot connect to [[192.168.1.218]:10050]: [113] No route to host</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">* æ’é”™:</div><div class="line"></div><div class="line">çœ‹æç¤ºâ€œNo route to hostâ€ï¼Œä¸ç½‘ç»œè¿æ¥æœ‰å…³ã€‚æ’é™¤çš„æ–¹æ³•å¦‚ä¸‹:</div><div class="line"></div><div class="line">aï¼‰æŸ¥çœ‹192.168.30.3è¿™å°æœºå™¨æ˜¯å¦å·²å¼€æœº</div><div class="line">b)åœ¨zabbix serverç«¯å‘è¿™å°æœºå™¨pingï¼Œçœ‹ç½‘ç»œæ˜¯å¦é€š</div><div class="line">cï¼‰ç”¨telnet ç™»å½•10050å’Œ10051ç«¯å£ï¼Œçœ‹è¯¥ä¸»æœºæ˜¯å¦å…è®¸è¿™ä¸¤ä¸ªç«¯å£é€šè®¯</div><div class="line">d)æŸ¥çœ‹iptablesé˜²ç«å¢™è§„åˆ™æ˜¯å¦æ‹¦æˆª10050ã€10051ç«¯å£</div></pre></td></tr></table></figure>
<h3 id="3-æ—¶é—´ä¸åŒæ­¥Check-if-client-local-time-is-in-sync-with-Zabbix-server-time"><a href="#3-æ—¶é—´ä¸åŒæ­¥Check-if-client-local-time-is-in-sync-with-Zabbix-server-time" class="headerlink" title="3.æ—¶é—´ä¸åŒæ­¥Check if client local time is in sync with Zabbix server time"></a>3.æ—¶é—´ä¸åŒæ­¥<code>Check if client local time is in sync with Zabbix server time</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">å› ä¸ºæˆ‘åœ¨æˆ‘çš„ç½‘ç»œä¸­çš„ä¸€äº›NTPæœåŠ¡å™¨ï¼Œè¿™å°†æ˜¯å¾ˆå¥½èƒ½å¤Ÿæµ‹é‡ä¸»æœºå’Œè¿™äº›æœåŠ¡å™¨ä¹‹ä¸€ä¹‹é—´çš„æ—¶é—´å·®ã€‚å¯æ‚²çš„æ˜¯ï¼Œè¿™å‡ ä¹æ˜¯ä¸å¯èƒ½çš„ã€‚</div><div class="line">ä½†æœ‰ä¸€ä¸ªè§£å†³æ–¹æ¡ˆ:</div><div class="line"></div><div class="line">`system.localtime.fuzzytime`ï¼Œç…§é¡¾è¿™åªæ˜¯ä¸€ä¸ª!!!è§¦å‘çš„â€œfuzzytimeâ€åŠŸèƒ½å‘å‡ºè­¦æŠ¥ï¼Œå¦‚æœè¢«ç›‘æ§æœåŠ¡å™¨çš„æ—¶é—´æ¼‚ç§»ã€‚å®ƒæ¯”è¾ƒæŠ¥å‘Šä¸»æœºçš„æ—¶é—´çš„zabbixæœåŠ¡å™¨åœ¨è§¦å‘å™¨è¢«å¤„ç†çš„æ—¶é—´ä¸Šçš„æ—¶é—´ã€‚fuzzytimeï¼ˆç§’ï¼‰ï¼Œå¯èƒ½æ˜¯ï¼ˆæµ®ç‚¹ï¼Œæ•´æ•°ï¼‰:</div><div class="line"></div><div class="line">è¿”å›1ï¼Œå¦‚æœæ—¶é—´æˆ³ï¼ˆé¡¹ç›®å€¼ï¼‰ä¸ä»çš„zabbixæœåŠ¡å™¨æ—¶é—´æœ‰æ‰€ä¸åŒè¶…è¿‡Nç§’ï¼Œ0 -å¦åˆ™é€šå¸¸ç”¨äºsystem.localtimeæ£€æŸ¥æœ¬åœ°æ—¶é—´åœ¨æœåŠ¡å™¨çš„zabbixæœ¬åœ°æ—¶é—´åŒæ­¥ã€‚</div><div class="line">æ³¨:æ·»åŠ å…¬å¼æ—¶ï¼Œä½¿ç”¨â€œæ·»åŠ â€æŒ‰é’®ï¼Œåœ¨å³ä¾§ï¼Œè¿™æ˜¯å¾ˆç®€å•çš„è¿™ç§æ–¹å¼ï¼</div><div class="line"></div><div class="line">ç³»ç»Ÿæ—¶é—´è·Ÿæˆ‘ç°åœ¨åŒ—äº¬æ—¶é—´ä¸åŒæ­¥ã€‚</div><div class="line">date -R </div><div class="line">æŸ¥çœ‹ä¸‹</div><div class="line"></div><div class="line">éœ€è¦æ‰‹åŠ¨æ·»åŠ è®¡åˆ’ä»»åŠ¡åŒæ­¥ä¸‹ï¼Œè®¾ç½®å¼€æœºå¯åŠ¨ã€‚è¿™é‡ŒIPæ˜¯zabbix-server IP</div><div class="line"></div><div class="line">00 * * * * /usr/sbin/ntpdate 192.168.47.20 &gt;/dev/null 2&gt;&amp;1</div></pre></td></tr></table></figure>
<p>è¿˜æœ‰ä¸æ‡‚å¾—å¯ä»¥çœ‹:<a href="http://en.linuxkitchen.com/2014/11/03/zabbix-and-time-difference-from-host-to-zabbix-server/" target="_blank" rel="external">å‚è€ƒ</a></p>
<h3 id="4-MySQLå†…å­˜ä¸å¤Ÿ-Lack-of-available-memory-on-server-MySQL"><a href="#4-MySQLå†…å­˜ä¸å¤Ÿ-Lack-of-available-memory-on-server-MySQL" class="headerlink" title="4.MySQLå†…å­˜ä¸å¤Ÿ Lack of available memory on server MySQL"></a>4.MySQLå†…å­˜ä¸å¤Ÿ <code>Lack of available memory on server MySQL</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">æ•…éšœåŸå› :Lack of available memory on server argus047072</div><div class="line"></div><div class="line">éœ€è¦æ·»åŠ å†…å­˜</div><div class="line">æ•…éšœåŸå› :Redisé“¾æ¥æ•°è¶…è¿‡æœ€å¤§å®¢æˆ·ç«¯æ•°é‡é™åˆ¶ã€‚</div><div class="line">æ˜¯å¦æœ‰å¤§é‡çš„è¿›ç¨‹åœ¨åå°è¿è¡Œ</div></pre></td></tr></table></figure>
<h3 id="5-Zabbix-agentä¸é€šReceived-empty-response-from-Zabbix-Agent"><a href="#5-Zabbix-agentä¸é€šReceived-empty-response-from-Zabbix-Agent" class="headerlink" title="5.Zabbix-agentä¸é€šReceived empty response from Zabbix Agent"></a>5.Zabbix-agentä¸é€š<code>Received empty response from Zabbix Agent</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">å‡ºç°å¦‚ä¸‹é”™è¯¯:</div><div class="line"></div><div class="line">Received empty response from Zabbix Agent at [192.168.1.2]. Assuming that agent dropped connection because of access permission</div><div class="line">å¤§æ¦‚æ„æ€æ˜¯è¯´æ²¡æœ‰æƒé™è®¿é—®agentç«¯å£10050ï¼Œè§£å†³æ–¹æ³•å¦‚ä¸‹:</div><div class="line"></div><div class="line"><span class="comment"># cat zabbix_agentd.conf| grep Server=</span></div><div class="line">Server=192.168.1.2  <span class="comment"># zabbix server ipåœ°å€</span></div><div class="line"></div><div class="line">å¦‚æœä½ çš„serveræœ‰å¤šä¸ªIPåœ°å€ï¼Œä½¿ç”¨é€—å·åˆ†éš”å¤šä¸ªIPåœ°å€ã€‚</div></pre></td></tr></table></figure>
<h3 id="6-ZabbixæŠ¥é”™ç£ç›˜ä¸è¶³Free-disk-space-is-less-than-20-on-volume-home"><a href="#6-ZabbixæŠ¥é”™ç£ç›˜ä¸è¶³Free-disk-space-is-less-than-20-on-volume-home" class="headerlink" title="6.ZabbixæŠ¥é”™ç£ç›˜ä¸è¶³Free disk space is less than 20% on volume /home"></a>6.ZabbixæŠ¥é”™ç£ç›˜ä¸è¶³<code>Free disk space is less than 20% on volume /home</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">ç£ç›˜æ€»å…±å¤§å°</div><div class="line">du -Th</div><div class="line"></div><div class="line">å®šä½æŸ¥çœ‹æ˜¯ä»€ä¹ˆæ¶ˆè€—é‚£ä¹ˆå¤šç£ç›˜ç©ºé—´ï¼ŒæŸ¥çœ‹homeç›®å½•ã€‚</div><div class="line">du <span class="_">-s</span> -h /srv/tomcat/tomcat_account/logs/* | sort</div><div class="line">1G localhost.2015-12-21.log</div><div class="line">2G localhost.2015-12-22.log</div><div class="line">2G localhost.2015-12-23.log</div><div class="line">.....</div><div class="line"></div><div class="line">find /srv/tomcat/tomcat_account/logs/ -mtime +1 -name <span class="string">"*.log"</span> -exec rm -rf &#123;&#125; \;</div><div class="line">è¿™ä¸ªä¿ç•™å‰ä¸€å¤©çš„æ—¥å¿—å…¶ä½™éƒ½åˆ é™¤ã€‚</div><div class="line"></div><div class="line">1. è®¡åˆ’ä»»åŠ¡è„šæœ¬æ¸…é™¤å‰ä¸€å¤©</div><div class="line"></div><div class="line">00 00 * * * find  /home/admin/output/ -mtime +1 -exec rm &#123;&#125; \;</div><div class="line"></div><div class="line">2. æˆ–è€…ä½¿ç”¨è„šæœ¬æ”¾åˆ°è®¡åˆ’ä»»åŠ¡é‡Œé¢è·‘</div><div class="line"></div><div class="line">1 0 * * * /opt/soft/<span class="built_in">log</span>/qingli-log.sh &gt;/dev/null 2&gt;&amp;1</div><div class="line"></div><div class="line">è¿™é‡Œçš„è®¾ç½®æ˜¯æ¯å¤©å‡Œæ™¨0ç‚¹1åˆ†æ‰§è¡Œqingli-log.sh .shæ–‡ä»¶è¿›è¡Œæ•°æ®æ¸…ç†ä»»åŠ¡äº†ã€‚</div><div class="line">åœ¨æŸ¥çœ‹ç£ç›˜æ€»å…±å¤§å°</div></pre></td></tr></table></figure>
<h3 id="7-Zabbixç›‘æ§æŠ¥é”™zabbix-server-is-not-running-the-information-displayed-may-not-be-current"><a href="#7-Zabbixç›‘æ§æŠ¥é”™zabbix-server-is-not-running-the-information-displayed-may-not-be-current" class="headerlink" title="7.Zabbixç›‘æ§æŠ¥é”™zabbix server is not running: the information displayed may not be current"></a>7.Zabbixç›‘æ§æŠ¥é”™<code>zabbix server is not running: the information displayed may not be current</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">æ•…éšœåŸå› :Zabbix agent on labs047093 is unreachable <span class="keyword">for</span> 5 minutesZabbixä½¿ç”¨ä¸€æ®µæ—¶é—´åæ€»æ˜¯æŠ¥Zabbix Agentä¸å¯åˆ°è¾¾</div><div class="line"></div><div class="line">è§£å†³ç»“æœ:è¿™ä¸‰å°æœºå™¨ç½‘ç»œä¸é€šï¼Œsshè¿æ¥ä¸ä¸Šï¼Œæ’é”™æ–¹æ³•æŸ¥çœ‹æ—¥å¿—æ˜¯å¦æœ‰æŠ¥é”™ï¼Œæ˜¯å¦æœåŠ¡æ²¡æœ‰èµ·æ¥ã€‚</div><div class="line">å¦‚æœæ•°æ®åº“æœåŠ¡å™¨æ˜¯ä¸€ç›´æ­£å¸¸çš„ï¼ŒSELinuxæ˜¯äº‹å…ˆå…³é—­æ²¡æœ‰ï¼Œä¿®æ”¹å®Œä¸Šè¿°æ‰€æåˆ°çš„åå‘ç°é—®é¢˜ä¾ç„¶ã€‚</div><div class="line"></div><div class="line">Zabbixä¾ç„¶æŠ¥é”™ï¼ˆZabbix Server Messages: PROBLEM: Zabbix agent on Zabbix server is unreachable <span class="keyword">for</span> 5 minutesã€‚</div><div class="line">æŸ¥çœ‹æ—¥å¿—æŠ¥ä»€ä¹ˆé”™ï¼Œå®šä½è§£å†³é—®é¢˜ï¼Œä¸€èˆ¬å‡ºç°è¿™ä¸ªå¤§éƒ¨åˆ†æ•°æ®å»¶è¿Ÿå¯¼è‡´ï¼Œåœ¨å›¾å½¢ä¸Šé¢æ˜æ˜¾çœ‹åˆ°æœ‰4åˆ°5åˆ†é’Ÿæ•°æ®æ˜¯ç©ºç™½çš„ã€‚</div></pre></td></tr></table></figure>
<h3 id="8-Zabbixå›¾å½¢å‡ºç°ä¹±ç æˆ–è€…æ²¡æœ‰æ–‡å­—"><a href="#8-Zabbixå›¾å½¢å‡ºç°ä¹±ç æˆ–è€…æ²¡æœ‰æ–‡å­—" class="headerlink" title="8.Zabbixå›¾å½¢å‡ºç°ä¹±ç æˆ–è€…æ²¡æœ‰æ–‡å­—"></a>8.Zabbixå›¾å½¢å‡ºç°ä¹±ç æˆ–è€…æ²¡æœ‰æ–‡å­—</h3><p>å‚è€ƒæ–‡æ¡£:<a href="https://github.com/yangcvo/zabbix.2.4" target="_blank" rel="external">zabbix2.4å›¾å½¢ä¹±ç </a></p>
<h3 id="9-Zabbixç›‘æ§ä¹‹é‚®ä»¶å‘Šè­¦å‘é€å¤±è´¥smtp-server-é”™è¯¯ä»£ç 550ä¸535"><a href="#9-Zabbixç›‘æ§ä¹‹é‚®ä»¶å‘Šè­¦å‘é€å¤±è´¥smtp-server-é”™è¯¯ä»£ç 550ä¸535" class="headerlink" title="9.Zabbixç›‘æ§ä¹‹é‚®ä»¶å‘Šè­¦å‘é€å¤±è´¥smtp-server: é”™è¯¯ä»£ç 550ä¸535"></a>9.Zabbixç›‘æ§ä¹‹é‚®ä»¶å‘Šè­¦å‘é€å¤±è´¥smtp-server: é”™è¯¯ä»£ç 550ä¸535</h3><p>å‚è€ƒæ–‡æ¡£:<a href="http://clovemfong.blog.51cto.com/3297559/1702105/" target="_blank" rel="external">zabbix163é‚®ä»¶å‘Šè­¦é”™è¯¯ä»£ç </a></p>
<h3 id="10-Zabbixä¸­æç¤ºï¼šLack-of-free-swap-space-on-hostname"><a href="#10-Zabbixä¸­æç¤ºï¼šLack-of-free-swap-space-on-hostname" class="headerlink" title="10.Zabbixä¸­æç¤ºï¼šLack of free swap space on hostname"></a>10.Zabbixä¸­æç¤ºï¼š<code>Lack of free swap space on hostname</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">æç¤ºï¼šç¼ºäº¤æ¢ç©ºé—´å¯ä»¥åˆ›å»ºä¹Ÿå¯ä»¥ä¸ç”¨åˆ›å»ºã€‚</div><div class="line"></div><div class="line">[root@xx ~]<span class="comment"># free -m</span></div><div class="line">             total       used       free     shared    buffers     cached</div><div class="line">Mem:          3832       3488        343          0        267       2389</div><div class="line">-/+ buffers/cache:        831       3000</div><div class="line">swap:            0          0          0</div><div class="line"></div><div class="line">ä¸ªèˆ¬ç‰©ç†æœºä¸å¯èƒ½ä¸è®¾äº¤æ¢åˆ†åŒºï¼Œæ˜¾ç„¶è¿™æ ·çš„è®¾è®¡æ²¡æœ‰è€ƒè™‘åˆ°äº‘ä¸»æœºç”¨æˆ·ã€‚åªéœ€è¦è°ƒèŠ‚ç›‘æ§æ–‡ä»¶ï¼Œå³å¯è§£å†³é—®é¢˜ï¼š</div><div class="line">è§£å†³æ­¤é—®é¢˜çš„æ­¥éª¤å¦‚ä¸‹:é€‰æ‹© Configuration-&gt;Templates(æ¨¡æ¿),åœ¨æ¨¡æ¿ç•Œé¢ä¸­é€‰æ‹©Template OS Linuxå³ä¾§çš„Triggersï¼ˆè§¦å‘å™¨ï¼‰,</div><div class="line">åœ¨è§¦å‘å™¨é¡µé¢ä¸­æ‰“å¼€Lack of free swap space on &#123;HOST.NAME&#125;é¡¹ç›®,åœ¨æ–°æ‰“å¼€çš„è§¦å‘å™¨ç¼–è¾‘é¡µé¢ä¸­ä¿®æ”¹Expressionï¼ˆè¡¨è¾¾å¼ï¼‰çš„å†…å®¹,</div><div class="line">ç”±åŸå…ˆçš„&#123;Template OS Linux:system.swap.size[,pfree].last(0)&#125;&lt;50</div><div class="line"></div><div class="line">ä¿®æ”¹ä¸º&#123;Template OS Linux:system.swap.size[,pfree].last(0)&#125;&lt;50 and &#123;Template OS Linux:system.swap.size[,free].last(0)&#125;&lt;&gt;0</div><div class="line"></div><div class="line"> æ­¤å¤„ä¿®æ”¹å¢åŠ äº†â€œand&#123;Template OS Linux:system.swap.size[,free].last(0)&#125;&lt;&gt;0â€åˆ¤æ–­ç³»ç»Ÿæœ‰äº¤æ¢ç©ºé—´ï¼Œå½“ç³»ç»Ÿæ— äº¤æ¢ç©ºé—´&#123;Template OS</div><div class="line">Linux:system.swap.size[,free].last(0)&#125;çš„å€¼ä¸º0æ—¶å°†ä¸ä¼šä½¿è¡¨è¾¾å¼æˆç«‹ï¼Œ</div><div class="line">ä¹Ÿå°±ä¸ä¼šè§¦å‘é”™è¯¯æç¤ºã€‚ä¿å­˜ååœ¨ä¸‹ä¸€ä¸ªæ›´æ–°å‘¨æœŸå†…zabbixä¹‹å‰æŠ¥å‘Šâ€œLack of free swap spaceâ€é—®é¢˜å°±ä¼šè¢«è‡ªåŠ¨æ ‡è®°ä¸ºResolved.</div><div class="line"></div><div class="line">æˆ–è€…åˆ›å»ºï¼š</div><div class="line"></div><div class="line">1ã€é¦–å…ˆçœ‹ä¸€ä¸‹å†…å­˜</div><div class="line">free -m</div><div class="line">2ã€ç„¶ååˆ›å»ºä¸€ä¸ªåˆ†åŒºæ·»åŠ äº¤æ¢æ–‡ä»¶</div><div class="line">mkdir /etc/swap/</div><div class="line">dd <span class="keyword">if</span>=/dev/zero of=/etc/swap/swap bs=1024 count=1024000  1ä¸ªG</div><div class="line">3ã€åˆ›å»ºäº¤æ¢ç©ºé—´</div><div class="line">mkswap /etc/swap/swap</div><div class="line">4ã€å¯åŠ¨äº¤æ¢ç©ºé—´</div><div class="line">swapon /etc/swap/swap</div><div class="line">5ã€æŸ¥çœ‹æ–°å¢ç©ºé—´</div><div class="line">free -tom</div><div class="line">6ã€ä¿®æ”¹/etc/fstabæ–‡ä»¶ä½¿ç³»ç»Ÿåœ¨é‡æ–°å¯åŠ¨çš„æ—¶å€™ç”Ÿæ•ˆ</div><div class="line">/etc/swap/swap         swap                    swap    defaults        0 0</div></pre></td></tr></table></figure>
<h3 id="11-Zabbix-agentæ—¥å¿—ç«¯hostnameä¸ä¸€è‡´ï¼šcannot-send-list-of-active-checks-to-192-168-0-1-host-Zabbix-server-not-found"><a href="#11-Zabbix-agentæ—¥å¿—ç«¯hostnameä¸ä¸€è‡´ï¼šcannot-send-list-of-active-checks-to-192-168-0-1-host-Zabbix-server-not-found" class="headerlink" title="11.Zabbix-agentæ—¥å¿—ç«¯hostnameä¸ä¸€è‡´ï¼šcannot send list of active checks to [192.168.0.1]: host [Zabbix server] not found"></a>11.Zabbix-agentæ—¥å¿—ç«¯hostnameä¸ä¸€è‡´ï¼š<code>cannot send list of active checks to [192.168.0.1]: host [Zabbix server] not found</code></h3><figure class="highlight vbscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">æŸ¥çœ‹è¢«ç›‘æ§æœºä¸Šçš„/tmp/zabbix_agentd.<span class="built_in">log</span>ï¼Œæ˜¾ç¤ºæ—¥å¿—ï¼š</div><div class="line">No active checks <span class="keyword">on</span> <span class="built_in">server</span>: host [Zabbix <span class="built_in">server</span>] <span class="keyword">not</span> found</div><div class="line"></div><div class="line">è¿™æ˜¯å› ä¸ºï¼Œé€šè¿‡zabbix dashboardé¡µé¢é…ç½®çš„è¢«ç›‘æ§ä¸»æœºåè·Ÿè¢«ç›‘æ§ä¸»æœºä¸Šzabbix_agentd.confä¸­é…ç½®çš„Hostnameä¸ä¸€è‡´ã€‚</div><div class="line"></div><div class="line">ä¿®æ”¹ä¸ºä¸€è‡´çš„åå­—åï¼Œé‡å¯zabbix_agentdå³å¯ã€‚</div></pre></td></tr></table></figure>
<h3 id="12-è§£å†³CentOS-7å®‰è£…zabbix-3-0-æ— æ³•å¯åŠ¨zabbix-serverçš„é—®é¢˜"><a href="#12-è§£å†³CentOS-7å®‰è£…zabbix-3-0-æ— æ³•å¯åŠ¨zabbix-serverçš„é—®é¢˜" class="headerlink" title="12.è§£å†³CentOS 7å®‰è£…zabbix 3.0 æ— æ³•å¯åŠ¨zabbix-serverçš„é—®é¢˜"></a>12.è§£å†³CentOS 7å®‰è£…zabbix 3.0 æ— æ³•å¯åŠ¨zabbix-serverçš„é—®é¢˜</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[root@kvm zabbix_agentd.d]<span class="comment"># service zabbix-agent restart</span></div><div class="line">Redirecting to /bin/systemctl restart  zabbix-agent.service</div><div class="line">Job <span class="keyword">for</span> zabbix-agent.service failed because a configured resource <span class="built_in">limit</span> was exceeded. See <span class="string">"systemctl status zabbix-agent.service"</span> and <span class="string">"journalctl -xe"</span> <span class="keyword">for</span> details.</div><div class="line"></div><div class="line">è§£å†³æ–¹æ¡ˆ:</div><div class="line">å…³é—­SELinuxæœåŠ¡ ã€‚ æ‰§è¡Œå‘½ä»¤</div><div class="line">setenforce 0 </div><div class="line"></div><div class="line">3. é‡å¯zabbix</div><div class="line">systemctl  restart  zabbix-server.service</div></pre></td></tr></table></figure>
<h3 id="13-zabbix-è¿”å›å€¼ä¸ºç©º-é”®å€¼æ¨¡æ¿æŠ¥é”™ï¼šReceived-value-is-not-suitable-for-value-type-Numeric-unsigned-and-data-type-Decimal"><a href="#13-zabbix-è¿”å›å€¼ä¸ºç©º-é”®å€¼æ¨¡æ¿æŠ¥é”™ï¼šReceived-value-is-not-suitable-for-value-type-Numeric-unsigned-and-data-type-Decimal" class="headerlink" title="13.zabbix è¿”å›å€¼ä¸ºç©º é”®å€¼æ¨¡æ¿æŠ¥é”™ï¼šReceived value [] is not suitable for value type [Numeric (unsigned)] and data type [Decimal]"></a>13.zabbix è¿”å›å€¼ä¸ºç©º é”®å€¼æ¨¡æ¿æŠ¥é”™ï¼š<code>Received value [] is not suitable for value type [Numeric (unsigned)] and data type [Decimal]</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">è§£å†³ï¼š</div><div class="line">æœ¬åœ°è„šæœ¬è·å–å€¼æœ‰è¿”å›ï¼Œè„šæœ¬æ²¡æœ‰zabbixèµ‹æƒ~</div><div class="line">ç›‘æ§ç«¯æ‰§è¡Œè„šæœ¬ï¼š</div><div class="line">[root@jollychic-db-slave4 zabbix]<span class="comment"># sh mysql3307.sh Qcache_queries_in_cache</span></div><div class="line">87</div><div class="line"></div><div class="line">zabbix æœåŠ¡ç«¯ï¼š</div><div class="line">[root@yum-zabbix ~]<span class="comment">#  zabbix_get -s 10.155.74.247 -k mysql.status3307[Threads_running]</span></div><div class="line"></div><div class="line">è¿”å›ç©ºè¿™é‡Œå°±æ˜¯è„šæœ¬æ²¡æœ‰zabbixèµ‹æƒ~</div><div class="line">è¿™é‡Œè„šæœ¬éœ€è¦æ·»åŠ ä¸‹-h127.0.0.1 å³å¯</div></pre></td></tr></table></figure>
<h3 id="14-è§£å†³Zabbixâ€œZBX-NOTSUPPORTED-Timeout-while-executing-a-shell-scriptâ€"><a href="#14-è§£å†³Zabbixâ€œZBX-NOTSUPPORTED-Timeout-while-executing-a-shell-scriptâ€" class="headerlink" title="14.è§£å†³Zabbixâ€œZBX_NOTSUPPORTED: Timeout while executing a shell scriptâ€"></a>14.è§£å†³<code>Zabbixâ€œZBX_NOTSUPPORTED: Timeout while executing a shell scriptâ€</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">è§£å†³æ–¹æ¡ˆ</div><div class="line"></div><div class="line">ï¼ˆ1ï¼‰ä¿®æ”¹zabbix_serverçš„zabbix_server.confï¼š</div><div class="line">[root@nmp01 scripts]<span class="comment"># vim /usr/local/zabbix/etc/zabbix_server.conf</span></div><div class="line">ä¿®æ”¹ä»¥ä¸‹å‚æ•°ï¼š</div><div class="line">Timeout=30</div><div class="line">æ³¨ï¼šè¶…æ—¶æ—¶é—´ä¸º30ç§’</div><div class="line"></div><div class="line">ï¼ˆ2ï¼‰ä¿®æ”¹è„šæœ¬æ‰€åœ¨zabbix_agentdçš„zabbix_agentd.confï¼š</div><div class="line"></div><div class="line">vim /usr/<span class="built_in">local</span>/zabbix/etc/zabbix_agentd.conf</div><div class="line">ä¿®æ”¹ä»¥ä¸‹å‚æ•°ï¼š</div><div class="line">Timeout=30</div><div class="line">ï¼ˆ3ï¼‰é‡å¯zabbixæœåŠ¡ç«¯å’Œè„šæœ¬æ‰€åœ¨å®¢æˆ·ç«¯ï¼š</div><div class="line">service zabbix_server restart</div><div class="line">service zabbix_agentd restart</div></pre></td></tr></table></figure>
<h3 id="15-Zabbix3-0-poller-processes-more-than-75-busyè­¦æŠ¥å¤„ç†"><a href="#15-Zabbix3-0-poller-processes-more-than-75-busyè­¦æŠ¥å¤„ç†" class="headerlink" title="15.Zabbix3.0 poller processes more than 75% busyè­¦æŠ¥å¤„ç†"></a>15.<code>Zabbix3.0 poller processes more than 75% busy</code>è­¦æŠ¥å¤„ç†</h3><p>è™½ç„¶Zabbixçš„ç›‘æ§è­¦æŠ¥å„ç§æœ‰ï¼Œä½†<code>yancy</code>ä½¿ç”¨ç¢°åˆ°æœ€å¤šçš„å‡ ä¸ªè«è¿‡äºå†…å­˜è€—å°½ï¼Œç½‘ç»œä¸é€šï¼ŒIOå¤ªæ…¢è¿˜æœ‰è¿™ä¸ªâ€œZabbix poller processes more than 75% busyâ€äº†ã€‚ä¸€å¼€å§‹çš„æ—¶å€™å› ä¸ºè¿™ä¸ªå³ä¸å½±å“ä½¿ç”¨ä¹ŸæŒç»­ä¸€ä¼šå„¿å°±è‡ªè¡Œè§£å†³å°±æ²¡æœ‰å¤šåœ¨æ„ã€‚ç„¶åéšç€æ•°æ®åº“çš„å¢å¤§ï¼ŒZabbixæ¶ˆè€—çš„å†…å­˜å¯æ˜¯è¶Šæ¥è¶Šå¤šï¼ŒPoller processesï¼ˆè½®è¯¢ï¼‰å¼€å§‹å¤©å¤©Busyäº†ï¼Œæœ€ç»ˆ<code>yancy</code>ä¸å¾—ä¸æŠŠZabbixæŒªåˆ°äº†å¦å¤–ä¸€å°æœåŠ¡å™¨ä¸Šã€‚</p>
<p>ä½†è¿™å¹¶æ²¡æœ‰å½»åº•è§£å†³é—®é¢˜ï¼Œè­¦æŠ¥ä»ç„¶ä¸‰å¤©ä¸¤å¤´æ¥å‡ ä¸ªã€‚ä¹‹åKaijiaå¼€å¯äº†Zabbixè­¦æŠ¥çš„é‚®ä»¶åŠŸèƒ½ï¼Œäºæ˜¯å¼€å§‹é¢‘ç¹æ”¶åˆ°è¿™ç±»é‚®ä»¶ï¼Œäºæ˜¯Kaijiaå†³å®šè§£å†³è¿™ä¸ªé—®é¢˜ã€‚Googleäº†ä¸€ä¸‹èµ„æ–™ï¼Œæ²¡æœ‰æ‰¾åˆ°å¾ˆæƒå¨çš„ç­”æ¡ˆï¼Œé€ æˆè½®è¯¢å¿™çš„é—®é¢˜æœ‰å¾ˆå¤šä¸­ï¼Œæ”¯æ’‘Zabbixçš„MySQLå¡ä½äº†ï¼ŒZabbixæœåŠ¡å™¨çš„IOå¡ä½äº†éƒ½æœ‰å¯èƒ½ï¼ŒZabbixè¿›ç¨‹åˆ†é…åˆ°å†…å­˜ä¸è¶³éƒ½æœ‰å¯èƒ½ã€‚ä¸€ä¸ªç®€å•çš„æ–¹æ³•æ˜¯å¢åŠ Zabbix Serverå¯åŠ¨æ—¶åˆå§‹åŒ–çš„è¿›ç¨‹æ•°é‡ï¼Œè¿™æ ·ç›´æ¥å¢åŠ äº†è½®è¯¢çš„è´Ÿè½½é‡ï¼Œä»æ¯”ä¾‹ä¸Šæ¥è®²å¿™çš„æƒ…å†µå°±å°‘äº†ã€‚</p>
<p>å¢åŠ åˆå§‹åŒ–è¿›ç¨‹çš„æ–¹æ³•éå¸¸ç®€å•ï¼Œç¼–è¾‘Zabbix Serverçš„é…ç½®æ–‡ä»¶<code>/etc/zabbix/zabbix_server.conf</code>ï¼Œæ‰¾åˆ°é…ç½®StartPollersçš„æ®µè½ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">1. <span class="comment">### Option: StartPollers</span></div><div class="line">2. <span class="comment">#       Number of pre-forked instances of pollers.</span></div><div class="line">3. <span class="comment">#</span></div><div class="line">4. <span class="comment"># Mandatory: no</span></div><div class="line">5. <span class="comment"># Range: 0-1000</span></div><div class="line">6. <span class="comment"># Default:</span></div><div class="line">7. <span class="comment"># StartPollers=5</span></div></pre></td></tr></table></figure>
<p>å–æ¶ˆStartPollers=ä¸€è¡Œçš„æ³¨é‡Šæˆ–è€…ç›´æ¥åœ¨åé¢å¢åŠ ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">StartPollers=10</div></pre></td></tr></table></figure>
<p>å› ä¸ºä¹‹å‰zabbixé™¤äº†å•ç‹¬è·‘ä¸€ä¸ªserveræœåŠ¡è¿˜æœ‰<code>agent</code>è¿˜æœ‰<code>grafana-server</code>è¿˜æœ‰ä»£ç†ï¼Œåé¢æˆ‘å…ˆæ‰©å¤§å†…å­˜å’ŒæœåŠ¡å™¨CPU.<br>å°†StartPollersæ”¹æˆå¤šå°‘å–å†³äºæœåŠ¡å™¨çš„æ€§èƒ½å’Œç›‘æ§çš„æ•°é‡ï¼ŒKaijiaå°†StartPollersè®¾ç½®æˆ12ä¹‹åå°±å†æ²¡æœ‰é‡åˆ°è¿‡è­¦æŠ¥ã€‚å¦‚æœå†…å­˜è¶³å¤Ÿçš„è¯å¯ä»¥è®¾ç½®æ›´é«˜ã€‚è®¾ç½®å®Œæˆä¹‹åè¿è¡Œï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">service zabbix-server restart</div></pre></td></tr></table></figure>
<p>é‡å¯Zabbixã€‚å½“ç„¶å¦å¤–ä¸€ç§ä»æ•´ä½“ä¸Šé™ä½ZabbixæœåŠ¡å™¨è´Ÿè½½çš„æ–¹æ³•å°±æ˜¯å®šæœŸé‡å¯Zabbixï¼Œè¿™ç§æ–¹æ³•å¯ä»¥ç”¨Cronå®ç°ï¼Œè¿è¡Œï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">crontab <span class="_">-e</span></div></pre></td></tr></table></figure>
<p>åœ¨è°ƒå‡ºçš„Cronç¼–è¾‘å™¨ä¸­å¢åŠ ä¸€ä¸ªè®¡åˆ’ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">00 * * * * service zabbix-server restart &gt; /dev/null 2&gt;&amp;1</div></pre></td></tr></table></figure>
<p>è¿™ä¸ªè®¡åˆ’ä¼šæ¯å¤©è‡ªåŠ¨é‡å¯ZabbixæœåŠ¡ä»¥ç»“æŸåƒµå°¸è¿›ç¨‹å¹¶æ¸…ç†å†…å­˜ç­‰ã€‚ç›®å‰Kaijiaè¿™æ ·é…ç½®Zabbixåè¿˜æ²¡æœ‰å†æ¬¡é‡åˆ°è¿‡â€œZabbix poller processes more than 75% busyâ€çš„é—®é¢˜ã€‚</p>
<h3 id="16ã€Zabbix3-0-monitoringå‡ºç°ä¹±ç "><a href="#16ã€Zabbix3-0-monitoringå‡ºç°ä¹±ç " class="headerlink" title="16ã€Zabbix3.0-monitoringå‡ºç°ä¹±ç "></a>16ã€Zabbix3.0-monitoringå‡ºç°ä¹±ç </h3><p>å‡ºç°ä¹±ç ï¼š</p>
<ul>
<li>ä¹±ç å®‰è£…åŒ…ä¸‹è½½åœ°å€ï¼š<a href="http://oak0aohum.bkt.clouddn.com/simkai.ttf" target="_blank" rel="external">ä¸­æ–‡æ±‰åŒ–ä¹±ç åŒ…</a></li>
</ul>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">* å‚è€ƒæ–‡æ¡£ï¼š</div><div class="line">zabbixç‰ˆæœ¬éƒ½å·²æœ‰æ±‰åŒ–åŠŸèƒ½äº†ï¼Œç›´æ¥é€‰æ‹©ä¸­æ–‡å°±è¡Œã€‚</div><div class="line">å¯æ˜¯ä½ç‰ˆæœ¬çš„å°±éœ€è¦å®‰è£…æ±‰åŒ–ï¼Œå¯æ˜¯å‘ç°æ‰“å¼€å›¾å½¢ç•Œé¢æ˜¯ç©ºç™½å›¾å½¢ï¼š</div><div class="line">é‡åˆ°ä¸­æ–‡ä¹±ç é—®é¢˜ã€‚zabbixä¹±ç æ˜¯æ€ä¹ˆç…§æˆçš„å‘¢ï¼Ÿzabbixä½¿ç”¨DejaVuSan.ttfå­—ä½“ï¼Œä¸æ”¯æŒä¸­æ–‡ï¼Œå¯¼è‡´ä¸­æ–‡å‡ºç°ä¹±ç ã€‚è§£å†³æ–¹æ³•å¾ˆç®€å•ï¼ŒæŠŠæˆ‘ä»¬ç”µè„‘é‡Œé¢å­—ä½“æ–‡ä»¶ä¼ åˆ°zabbixæœåŠ¡å™¨ä¸Šã€‚</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">* åœ¨zabbix<span class="params">-server</span>ç«¯ä¸Šé¢è¿›å…¥å®‰è£…ç›®å½•ï¼š</div><div class="line"></div><div class="line"><span class="built_in">var</span>/www/html/zabbix/fontsç›®å½•ä¸‹é¢æŸ¥çœ‹ï¼Œå‘ç°ä¹‹å‰ä¸Šä¼ å­—ä½“çš„æ–‡ä»¶ååç¼€æ˜¯.ttcï¼ŒçŒœç€ä¸€èˆ¬è§åˆ°çš„éƒ½åç¼€éƒ½æ˜¯ttfçš„ï¼Œä¼šä¸ä¼šæ˜¯è¿™ä¸ªé—®é¢˜å¯¼è‡´çš„å‘¢ã€‚äºæ˜¯åœ¨windowsç³»ç»Ÿä¸Šæ‰¾åˆ°simkai.ttf,ä¸Šä¼ åˆ°fontsä¸‹ï¼Œç¼–è¾‘/<span class="built_in">var</span>/www/html/zabbix/include/defines.inc.phpï¼Œæ›´æ”¹ä¸¤å¤„åœ°æ–¹ï¼š</div><div class="line"></div><div class="line"></div><div class="line">    <span class="class"><span class="keyword">define</span></span>(â€˜ZBX_FONT_NAMEâ€˜, â€˜simkaiâ€˜);</div><div class="line">    <span class="class"><span class="keyword">define</span></span>(â€˜ZBX_GRAPH_FONT_NAMEâ€˜,  â€˜simkaiâ€˜);</div><div class="line">fzytk</div></pre></td></tr></table></figure>
<p>è®¾ç½®å¥½äº†ï¼ŒæœåŠ¡é‡å¯ä¸‹ï¼Œåˆ·æ–°ï¼Œå›¾ä¸‹é¢å°±æœ‰å­—ä½“äº†ï¼š</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-luanma.png" alt=""></figure><br>graphfont</p>
<p>å¸¸è§é—®é¢˜ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">ä¾æ—§ä¹±ç ï¼šé€šè¿‡ä»¥ä¸Šçš„æ“ä½œï¼Œå¤§éƒ¨åˆ†åŒå­¦çš„ä¹±ç é—®é¢˜è§£å†³äº†ï¼Œä½†æ˜¯ä¾æ—§æœ‰ä¸€äº›åŒå­¦è¿˜æ˜¯ä¹±ç ï¼Ÿç»†å¿ƒçš„ç¾¤å‹æä¾›å¦å¤–ä¸€ç§æƒ…å†µï¼šåˆå§‹åŒ–æ•°æ®åº“çš„æ—¶å€™æœªä½¿ç”¨utf8ç¼–ç æ‰€è‡´.åˆå§‹åŒ–æ•°æ®åº“ä½¿ç”¨å‘½ä»¤</div><div class="line"></div><div class="line">create database zabbix default charset utf8;</div><div class="line">æˆ–è€…my.cnfå¢åŠ å¦‚ä¸‹é…ç½®</div><div class="line"></div><div class="line">default-character-set = utf8</div><div class="line"></div><div class="line">æ€»ç»“ </div><div class="line">ä¹±ç å¤„ç†æ–¹æ³•å¾ˆç®€å•ï¼Œå®é™…ä¸Šå°±æ˜¯æ›¿æ¢å­—ä½“ã€‚</div></pre></td></tr></table></figure>
<h3 id="äº¤æµå­¦ä¹ ï¼š"><a href="#äº¤æµå­¦ä¹ ï¼š" class="headerlink" title="äº¤æµå­¦ä¹ ï¼š"></a>äº¤æµå­¦ä¹ ï¼š</h3><p>ğŸ§  Linux shell_é«˜çº§è¿ç»´æ´¾: <code>459096184</code>    åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)<br>ğŸ§  BigData-Exchange School : <code>521621407</code>  åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥</p>
<p>ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚</p>

	

	

</article>




	<article>
	
		<h1><a href="/2014/10/03/æ€§èƒ½ç›‘æ§/Zabbix/zabbix2.4æœåŠ¡ç«¯yum-rpmå¿«é€Ÿå®‰è£…éƒ¨ç½²/">zabbix2.4æœåŠ¡ç«¯rpmå¿«é€Ÿå®‰è£…éƒ¨ç½²</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2014-10-03</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/monitoring/">monitoring</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Zabbix-monitoring/">Zabbix monitoring</a>
			</span>
		
	</div>

	

	
		<p>ç³»ç»Ÿç¯å¢ƒï¼š</p>
<ul>
<li>192.168.1.170 MySQLä¸» </li>
<li>192.168.1.183 zabbix-server</li>
</ul>
<h2 id="Zabbix-å¿«é€Ÿéƒ¨ç½²ï¼ˆRPMï¼‰"><a href="#Zabbix-å¿«é€Ÿéƒ¨ç½²ï¼ˆRPMï¼‰" class="headerlink" title="Zabbix å¿«é€Ÿéƒ¨ç½²ï¼ˆRPMï¼‰"></a>Zabbix å¿«é€Ÿéƒ¨ç½²ï¼ˆRPMï¼‰</h2><p>æ³¨é‡Šï¼šå®‰è£…ç¯å¢ƒä¸ºç³»ç»Ÿæœ€å°å®‰è£…ï¼Œæ³¨æ„æ—¶é—´åŒæ­¥</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># cat /etc/redhat-release</span></div><div class="line">CentOS Linux release 7.2.1511 (Core)</div></pre></td></tr></table></figure>
<h3 id="å…³é—­SELinuxï¼š"><a href="#å…³é—­SELinuxï¼š" class="headerlink" title="å…³é—­SELinuxï¼š"></a>å…³é—­SELinuxï¼š</h3><p>1ã€ä¸´æ—¶å…³é—­ï¼ˆä¸ç”¨é‡å¯æœºå™¨ï¼‰ï¼š</p>
<pre><code>#setenforce 0                  ##è®¾ç½®SELinux æˆä¸ºpermissiveæ¨¡å¼
#setenforce 1             ##è®¾ç½®SELinux æˆä¸ºenforcingæ¨¡å¼     
</code></pre><h3 id="1-é…ç½®å®˜æ–¹yumï¼š"><a href="#1-é…ç½®å®˜æ–¹yumï¼š" class="headerlink" title="1.é…ç½®å®˜æ–¹yumï¼š"></a>1.é…ç½®å®˜æ–¹yumï¼š</h3><ul>
<li><p>cnetos 32ä½ï¼š<code>#rpm -ivh http://repo.zabbix.com/zabbix/2.4/rhel/6/i386/zabbix-release-2.4-1.el6.noarch.rpm</code></p>
</li>
<li><p>cnetos 64ä½ï¼š<code>#rpm -ivh  http://repo.zabbix.com/zabbix/2.4/rhel/6/x86_64/zabbix-release-2.4-1.el6.noarch.rpm</code></p>
</li>
<li><p>centos7 64ä½ï¼š# <code>rpm -ivh http://repo.zabbix.com/zabbix/2.4/rhel/7/x86_64/zabbix-release-2.4-1.el7.noarch.rpm</code></p>
</li>
</ul>
<p>å¦‚æœé€‰æ‹©è¿™ä¸ªæ–¹å¼æ˜¯å®‰è£…æœ€é«˜çš„2.4.8ç‰ˆæœ¬</p>
<h3 id="2-å®‰è£…Zabbixï¼š"><a href="#2-å®‰è£…Zabbixï¼š" class="headerlink" title="2.å®‰è£…Zabbixï¼š"></a>2.å®‰è£…Zabbixï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#yum -y install zabbix-server-mysql zabbix-web-mysql zabbix-agent mysql-server mysql   #å®‰è£…ç›¸å…³è½¯ä»¶åŒ…</span></div><div class="line"><span class="comment">#yum -y install zabbix-get zabbix-sender      #æ–¹ä¾¿ä»¥åå¯¹zabbixè°ƒè¯•ç”¨</span></div></pre></td></tr></table></figure>
<h3 id="3-é…ç½®æ•°æ®åº“"><a href="#3-é…ç½®æ•°æ®åº“" class="headerlink" title="3.é…ç½®æ•°æ®åº“"></a>3.é…ç½®æ•°æ®åº“</h3><p> ç™»é™†åˆ°192.168.1.170æœåŠ¡å™¨ä¸Šé¢ï¼š</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># mysql -e "create database zabbix character set utf8 collate  utf8_bin;"   #ä¿®æ”¹æ—¶åŒº</span></div><div class="line"><span class="comment"># mysql -e "grant all privileges on zabbix.* to zabbix@localhost identified by 'zabbix';"  #åˆ›å»ºæ•°æ®åº“å</span></div></pre></td></tr></table></figure>
<p> è¿™é‡Œæˆ‘è®¾ç½®äº†åªèƒ½192.168.1.0ç½‘æ®µå¯ä»¥è®¿é—®æ•°æ®åº“ã€‚<br> æ‰€ä»¥è¿™é‡Œåˆ›å»ºæ•°æ®åº“ç›´æ¥è¿™ä¹ˆæ“ä½œäº†ã€‚</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"> [root@mysql ~]<span class="comment"># mysql -uroot -pIhaozhuo_b313 -h 192.168.1.170</span></div><div class="line">Warning: Using a password on the <span class="built_in">command</span> line interface can be insecure.</div><div class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</div><div class="line">Your MySQL connection id is 10</div><div class="line">Server version: 5.6.20-log MySQL Community Server (GPL)</div><div class="line"></div><div class="line">Copyright (c) 2000, 2014, Oracle and/or its affiliates. All rights reserved.</div><div class="line"></div><div class="line">Oracle is a registered trademark of Oracle Corporation and/or its</div><div class="line">affiliates. Other names may be trademarks of their respective</div><div class="line">owners.</div><div class="line"></div><div class="line">Type <span class="string">'help;'</span> or <span class="string">'\h'</span> <span class="keyword">for</span> help. Type <span class="string">'\c'</span> to clear the current input statement.</div><div class="line"></div><div class="line">mysql&gt; create database zabbix character <span class="built_in">set</span> utf8 collate  utf8_bin;</div><div class="line">Query OK, 1 row affected (0.06 sec)</div><div class="line">mysql&gt; GRANT ALL ON zabbix.* TO <span class="string">'zabbix'</span>@<span class="string">'192.168.1.%'</span> IDENTIFIED BY <span class="string">'zabbix123.com'</span>;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line">mysql&gt; flush privileges;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div></pre></td></tr></table></figure>
<p> 4.å¯¼å…¥æ•°æ®åº“æ–‡ä»¶ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /usr/share/doc/zabbix-server-mysql-2.4.8/create</div></pre></td></tr></table></figure>
<p>æ“ä½œä¸‰æ¡å‘½ä»¤æŠŠæ•°æ®å¯¼å…¥åˆ°åœ¨æŒ‡å®šçš„MySQLï¼šzabbix</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mysql -uzabbix -pzabbix123.com -h 192.168.1.170  zabbix &lt; schema.sql</div><div class="line">mysql -uzabbix -pzabbix123.com -h 192.168.1.170  zabbix &lt; images.sql</div><div class="line">mysql -uzabbix -pzabbix123.com -h 192.168.1.170  zabbix &lt; data.sql</div></pre></td></tr></table></figure>
<h3 id="4-ä¿®æ”¹zabbix-server-conf-æ–‡ä»¶"><a href="#4-ä¿®æ”¹zabbix-server-conf-æ–‡ä»¶" class="headerlink" title="4. ä¿®æ”¹zabbix_server.conf æ–‡ä»¶"></a>4. ä¿®æ”¹zabbix_server.conf æ–‡ä»¶</h3><p>vim /etc/zabbix/zabbix_server.conf</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># ListenPort=10051  //ç›‘å¬çš„ç«¯å£</span></div><div class="line"><span class="comment"># LogFile=/var/log/zabbix/zabbix_server.log  //æ—¥å¿—æ–‡ä»¶è·¯å¾„</span></div><div class="line"><span class="comment"># LogFileSize=0  //æ—¥å¿—æ–‡ä»¶æ»šåŠ¨ï¼Œåˆ†å‰²ã€‚ï¼ˆå‚æ•°ä¸ºâ€œ0â€ï¼Œä¸åšæ»šåŠ¨ï¼‰ï¼Œä¾‹å¦‚å½“æ—¥å¿—æ–‡ä»¶åˆ°è¾¾1Gï¼Œä¼šè‡ªåŠ¨åˆ›å»ºä¸ªæ–°çš„æ—¥å¿—æ–‡ä»¶ï¼Œå®Œæˆæ—¥å¿—æ»šåŠ¨ã€‚</span></div><div class="line">DBName=zabbix            </div><div class="line">DBUser=zabbix          <span class="comment">#æ•°æ®åº“ç”¨æˆ·å</span></div><div class="line">DBPassword=zabbix123.com    <span class="comment">#æ•°æ®åº“å¯†ç </span></div><div class="line">AlertScriptsPath=/usr/<span class="built_in">local</span>/zabbix/share/zabbix/alertscripts<span class="comment">#zabbixè¿è¡Œè„šæœ¬å­˜æ”¾ç›®å½•</span></div></pre></td></tr></table></figure>
<p>:wq! #ä¿å­˜é€€å‡º</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#cp /etc/zabbix/zabbix_server.conf &#123;,.bak&#125;   #å¤‡ä»½</span></div><div class="line">ln <span class="_">-s</span> /etc/alternatives/zabbix-server /usr/bin/zabbix-server</div><div class="line">cp /usr/sbin/zabbix_agentd /etc/init.d/zabbix_agentd</div><div class="line">[root@docker alternatives]<span class="comment"># cp /etc/alternatives/zabbix_server /etc/init.d/zabbix-server</span></div><div class="line"></div><div class="line">chmod +x /etc/rc.d/init.d/zabbix_server <span class="comment">#æ·»åŠ è„šæœ¬æ‰§è¡Œæƒé™</span></div><div class="line">chmod +x /etc/rc.d/init.d/zabbix_agentd <span class="comment">#æ·»åŠ è„šæœ¬æ‰§è¡Œæƒé™</span></div><div class="line"></div><div class="line">vim /etc/php.ini</div><div class="line">date.timezone = Asia/Shanghai</div><div class="line">post_max_size = 32M</div><div class="line">max_execution_time = 300</div><div class="line">max_input_time = 300</div></pre></td></tr></table></figure>
<h3 id="5-ä¿®æ”¹zabbixå¼€æœºå¯åŠ¨è„šæœ¬ä¸­çš„zabbixå®‰è£…ç›®å½•"><a href="#5-ä¿®æ”¹zabbixå¼€æœºå¯åŠ¨è„šæœ¬ä¸­çš„zabbixå®‰è£…ç›®å½•" class="headerlink" title="5. ä¿®æ”¹zabbixå¼€æœºå¯åŠ¨è„šæœ¬ä¸­çš„zabbixå®‰è£…ç›®å½•"></a>5. ä¿®æ”¹zabbixå¼€æœºå¯åŠ¨è„šæœ¬ä¸­çš„zabbixå®‰è£…ç›®å½•</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">vi <span class="regexp">/etc/</span>rc.d<span class="regexp">/init.d/</span>zabbix_server <span class="comment">#ç¼–è¾‘æœåŠ¡ç«¯é…ç½®æ–‡ä»¶</span></div><div class="line">BASEDIR=<span class="regexp">/usr/</span>local<span class="regexp">/zabbix/</span> <span class="comment">#zabbixå®‰è£…ç›®å½•</span></div><div class="line"></div><div class="line"><span class="comment"># /etc/init.d/zabbix-server start</span></div><div class="line"><span class="comment"># /etc/init.d/zabbix_agentd start</span></div><div class="line"><span class="comment">#/etc/init.d/httpd start</span></div></pre></td></tr></table></figure>
<h3 id="6-1-æ·»åŠ å¼€æœºå¯åŠ¨æœåŠ¡"><a href="#6-1-æ·»åŠ å¼€æœºå¯åŠ¨æœåŠ¡" class="headerlink" title="6.1 æ·»åŠ å¼€æœºå¯åŠ¨æœåŠ¡"></a>6.1 æ·»åŠ å¼€æœºå¯åŠ¨æœåŠ¡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">chkconfig --add zabbix-server    </div><div class="line">chkconfig --add zabbix-agent      </div><div class="line">chkconfig --add httpd </div><div class="line">chkconfig --add mysqld</div></pre></td></tr></table></figure>
<h3 id="6-2-æ·»åŠ å¼€æœºå¯åŠ¨"><a href="#6-2-æ·»åŠ å¼€æœºå¯åŠ¨" class="headerlink" title="6.2 æ·»åŠ å¼€æœºå¯åŠ¨"></a>6.2 æ·»åŠ å¼€æœºå¯åŠ¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">chkconfig zabbix-server on  </div><div class="line">chkconfig zabbix-agent on    </div><div class="line">chkconfig httpd on  </div><div class="line">chkconfig mysqld on</div></pre></td></tr></table></figure>
<h3 id="6-3-æ·»åŠ é˜²ç«å¢™"><a href="#6-3-æ·»åŠ é˜²ç«å¢™" class="headerlink" title="6.3 æ·»åŠ é˜²ç«å¢™"></a>6.3 æ·»åŠ é˜²ç«å¢™</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">-A INPUT -m state --state NEW -m tcp -p tcp --dport 80 -j ACCEPT</div><div class="line">-A INPUT -m state --state NEW -m tcp -p tcp --dport 10051 -j ACCEPT</div><div class="line">-A INPUT -m state --state NEW -m tcp -p tcp --dport 10050 -j ACCEPT</div></pre></td></tr></table></figure>
<h3 id="7-åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼š"><a href="#7-åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼š" class="headerlink" title="7.åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼š"></a>7.åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼š</h3><p><a href="http://192.168.1.183/zabbix/è¿›å…¥è®¾ç½®ç•Œé¢" target="_blank" rel="external">http://192.168.1.183/zabbix/è¿›å…¥è®¾ç½®ç•Œé¢</a>  </p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-server0.png" alt=""></figure></p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-server1.png" alt=""></figure></p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-server2.png" alt=""></figure></p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-server3.png" alt=""></figure></p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-server4.png" alt=""></figure></p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-server5.png" alt=""></figure><br>è¿›å…¥ï¼š â€œ/var/www/html/zabbix/conf/zabbix.conf.phpâ€</p>
<p>å¤‡ä»½ï¼š</p>
<p>cp zabbix.conf.php.example zabbix.conf.php<br>ä¸‹è½½ä¸‹æ¥çš„æ”¾åˆ°è¿™ä¸ªç›®å½•ä¸‹é¢ã€‚</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-server6.png" alt=""></figure></p>
<p>ç”¨æˆ·å:Admin å¯†ç ï¼šzabbix</p>
<p>è®¾ç½®ä¸­æ–‡ç‰ˆæœ¬ï¼Œ2.4ç‰ˆæœ¬ä»¥åéƒ½æ”¯æ’‘ä¸­æ–‡ç‰ˆæœ¬ï¼Œ2.2.0ç‰ˆæœ¬éƒ½æ˜¯ä¸æ”¯æŒçš„ï¼Œéœ€è¦ä¸‹è½½ä¸­æ–‡ç‰ˆæœ¬åŒ…ï¼Œæ”¾åˆ°zabbixç›®å½•ä¸‹é¢ã€‚</p>
<p>è®¾ç½®èƒŒæ™¯ä¸ºç»å…¸çš„æ˜¯ä¸æ˜¯çœ‹ç€ä¼šèˆ’æœç‚¹ï¼š3.0 å¯¹å¤–è§‚æ”¹çš„æ”¹åŠ¨å¾ˆå¤§ï¼Œæ”¯æ’‘ç¡¬ä»¶ç›‘æ§åŠŸèƒ½åŠ å¼ºã€‚</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-server7.png" alt=""></figure></p>
<p>ç®€å•çš„å®‰è£…å°±å·²ç»æå®šäº†ã€‚</p>
<h3 id="å®‰è£…å‡ºç°å‡ ç§é”™è¯¯æƒ…å†µï¼š"><a href="#å®‰è£…å‡ºç°å‡ ç§é”™è¯¯æƒ…å†µï¼š" class="headerlink" title="å®‰è£…å‡ºç°å‡ ç§é”™è¯¯æƒ…å†µï¼š"></a>å®‰è£…å‡ºç°å‡ ç§é”™è¯¯æƒ…å†µï¼š</h3><p>ç™»é™†zabbixæç¤º<code>zabbix server is not running:the information displayedmay not be current</code></p>
<p>è§£å†³æ–¹æ³•ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">å…³é—­selinuxä¸iptables</div><div class="line">vim /var/www/html/zabbix/conf/zabbix.conf.phpå°†zabbix.conf.phpé‡Œçš„serverå†™æˆipåœ°å€ï¼Œå°±è§£å†³äº†</div></pre></td></tr></table></figure>
<p>æŸ¥çœ‹æ—¥å¿—ï¼š</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="number">6576</span>:<span class="number">20160719</span>:<span class="number">045354.989</span> [Z3001] connection to database <span class="string">'zabbix'</span> </div><div class="line"><span class="symbol">failed:</span> [<span class="number">2002</span>] Can<span class="string">'t connect to local MySQL server through socket '</span>/var/<span class="class"><span class="keyword">lib</span>/<span class="title">mysql</span>/<span class="title">mysql</span>.<span class="title">sock</span>' (2)</span></div></pre></td></tr></table></figure>
<p>è¿™ä¸ªæŠ¥é”™çš„è¯ï¼Œå°±è¯´æ˜é…ç½®æ–‡ä»¶æœ‰é—®é¢˜ï¼š</p>
<p>è®¾ç½®æ•°æ®åº“è®¿é—®åœ°å€ï¼šDBHost=192.168.1.170</p>
<p>ç„¶åvi zabbix.conf.phpè®°å¾—ä¿®æ”¹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="variable">$ZBX_SERVER</span>      = <span class="string">'ZABBIX_SERVER_IP'</span>;  IPåœ°å€</div><div class="line"><span class="variable">$ZBX_SERVER_PORT</span> = <span class="string">'10051'</span>;</div></pre></td></tr></table></figure>
<p>ç„¶åé‡å¯ä¸‹æœåŠ¡ï¼Œå°±ä¸ä¼šå‡ºç°MySQLæœ¬åœ°æ— æ³•è¿æ¥ã€‚</p>
<p>å¦‚æœæŠ¥é”™ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">6664:20160719:050257.665 cannot send list of active checks to [127.0.0.1]: host [Zabbix server] not monitored</div></pre></td></tr></table></figure>
<p>ç¡®ä¿zabbixå‰å°ä¸Šçš„Host nameä¸ä¸»æœºçš„hostnameä¸€è‡´å³å¯ã€‚</p>
<p>è¿™æ˜¯å¿«é€Ÿç®€å•å®‰è£…2.4.8ç‰ˆæœ¬çš„ï¼Œåé¢è¿˜æœ‰ç¼–è¯‘å®‰è£…çš„ï¼Œç¼–è¯‘å®‰è£…çš„å¥½å¤„ï¼Œå¯ä»¥äº†è§£å®‰è£…çš„è·¯å¾„å’Œé…ç½®æ–‡ä»¶éƒ½æ˜¯è‡ªå·±ç†Ÿæ‚‰çš„ã€‚</p>
<ul>
<li>2.4.8æœåŠ¡ç«¯ç¼–è¯‘å®‰è£…ä¸éƒ¨ç½²ï¼š</li>
<li>2.4.8å‡çº§3.0å®‰è£…ä¸éƒ¨ç½²ï¼š</li>
<li>3.0å®‰è£…ä¸éƒ¨ç½²ï¼š</li>
<li>å®‰è£…å®Œæˆä»¥åå‡ºç°å›¾åƒä¹±ç ï¼š <a href="https://github.com/yangcvo/zabbix.2.4" target="_blank" rel="external">https://github.com/yangcvo/zabbix.2.4</a></li>
<li>2.4.8ç‰ˆæœ¬zabbix-serveræœåŠ¡ç«¯ç¼–è¯‘å®‰è£…ï¼š<a href="http://blog.yangcvo.me/2015/01/18/zabbix-serveræœåŠ¡ç«¯ç¼–è¯‘å®‰è£…/" target="_blank" rel="external">æºç ç¼–è¯‘å®‰è£…éƒ¨ç½²2.4.8ç‰ˆæœ¬zabbix-serveræœåŠ¡ç«¯</a></li>
</ul>

	

	

</article>




	<article>
	
		<h1><a href="/2014/10/01/æ€§èƒ½ç›‘æ§/Zabbix/zabbixçš„ICMP-Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§/">zabbixçš„ICMP_Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2014-10-01</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/monitoring/">monitoring</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Zabbix-monitoring/">Zabbix monitoring</a>
			</span>
		
	</div>

	

	
		<p>ä¸Šä¸€æ¬¡æ­å»ºäº†é‚®ä»¶å‘Šè­¦å’Œå¾®ä¿¡å‘Šè­¦ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åŠæ—¶æ¥æ”¶åˆ°å‘Šè­¦çš„ã€‚<br>è¿™é‡Œè®²zabbixé‡Œé¢ICMP-pingæ¨¡æ¿çš„å®ç°ç½‘ç»œç›‘æ§ã€‚</p>
<p>Zabbixä½¿ç”¨å¤–éƒ¨å‘½ä»¤fpingå¤„ç†ICMP pingçš„è¯·æ±‚ï¼Œfpingä¸åŒ…å«åœ¨zabbixçš„å‘è¡Œç‰ˆæœ¬ä¸­ï¼Œéœ€è¦é¢å¤–å»ä¸‹è½½å®‰è£…fpingç¨‹åºï¼Œå®‰è£…å®Œæ¯•ä¹‹åéœ€è¦åœ¨<code>zabinx_server.conf</code>ä¸­çš„å‚æ•°<code>FpingLocation</code>é…ç½®fpingå®‰è£…çš„è·¯å¾„ã€‚</p>
<p>ç”±äºfpingé»˜è®¤æ˜¯<code>root</code>æƒé™å·¥ä½œï¼Œè€Œ<code>zabbix-server</code>æ˜¯zabbixç”¨æˆ·è¿è¡Œçš„ï¼Œæ‰€ä»¥éœ€è¦å¯¹fpingç¨‹åºè®¾ç½®<code>setuid</code>æƒé™ï¼Œ<br>å¦‚æœåœ¨è‡ªå®šä¹‰keyçš„æ—¶å€™éœ€è¦ç”¨åˆ°<code>netstat</code>å‘½ä»¤ï¼Œä¹ŸåŒæ ·è¦è®¾ç½®<code>setuid</code>ï¼Œå¦åˆ™ä¸èƒ½è·å–åˆ°æ•°æ®ï¼Œè€Œåœ¨æ—¥å¿—ä¸­æç¤ºæƒæ‹’ç»ã€‚</p>
<h3 id="ä¸€ã€ç™»é™†ZabbixæœåŠ¡å™¨åšä»¥ä¸‹æ“ä½œï¼š"><a href="#ä¸€ã€ç™»é™†ZabbixæœåŠ¡å™¨åšä»¥ä¸‹æ“ä½œï¼š" class="headerlink" title="ä¸€ã€ç™»é™†ZabbixæœåŠ¡å™¨åšä»¥ä¸‹æ“ä½œï¼š"></a>ä¸€ã€ç™»é™†ZabbixæœåŠ¡å™¨åšä»¥ä¸‹æ“ä½œï¼š</h3><p>1.fpingå®‰è£…</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">wget http://www.fping.org/dist/fping-3.10.tar.gz</div><div class="line">tar zxvf fping-3.10.tar.gz</div><div class="line"><span class="built_in">cd</span> fping-3.10</div><div class="line">./configure --prefix=/usr/<span class="built_in">local</span>/fping/</div><div class="line">make &amp;&amp; make install</div></pre></td></tr></table></figure>
<p>2.ä¿®æ”¹zabbix_server.confé…ç½®æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">vim /usr/<span class="built_in">local</span>/zabbix/etc/zabbix_server.conf</div><div class="line"></div><div class="line">æŠŠFpingLocationè·¯å¾„ä¿®æ”¹ä¸ºåˆšå®‰è£…çš„fpingè·¯å¾„ã€‚</div><div class="line"></div><div class="line">FpingLocation=/usr/<span class="built_in">local</span>/fping/sbin/fping</div></pre></td></tr></table></figure>
<p>å¦‚æœä¸ä¿®æ”¹zabbix_server.confé…ç½®ä»¶éœ€è¦ä½¿ç”¨è½¯è¿æ¥åˆ°/usr/local/sbin/fpingï¼Œzabbixé»˜è®¤fpingçš„è·¯å¾„æ˜¯/usr/sbin/fping</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ln <span class="_">-s</span> /usr/sbin/fping /path/to/non-existant/fping</div><div class="line">ln <span class="_">-s</span> /usr/sbin/fping6 /path/to/non-existant/fping6</div></pre></td></tr></table></figure>
<p>3.ä¿®æ”¹fpingæƒé™ï¼ˆå¦‚æœä¸è®¾ä¸‹é¢æƒé™ï¼ŒzabbixæœåŠ¡ç«¯ä¼šé‡‡é›†ä¸åˆ°æ•°æ®ï¼‰</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># chown root:zabbix /usr/local/fping/sbin/fping</span></div><div class="line"><span class="comment"># chmod 4710 /usr/local/fping/sbin/fping</span></div></pre></td></tr></table></figure>
<p>å®‰è£…å®Œfpingï¼Œè®¾ç½®å¥½zabbix-server é…ç½®æ–‡ä»¶ï¼Œéœ€è¦é‡å¯æœåŠ¡ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">service zabbix_server restart  <span class="comment">#é‡å¯æœåŠ¡</span></div></pre></td></tr></table></figure>
<p>4.zabbixç”¨æˆ·æµ‹è¯•fpingå‘½ä»¤</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">/usr/<span class="built_in">local</span>/fping/sbin/fping www.baidu.com</div><div class="line">www.baidu.com is alive   <span class="comment"># è¯´æ˜å‘½ä»¤è¿”å›æˆåŠŸã€‚</span></div></pre></td></tr></table></figure>
<h3 id="äºŒã€ç™»é™†Zabbixç›‘æ§ç½‘é¡µåšä»¥ä¸‹è®¾ç½®"><a href="#äºŒã€ç™»é™†Zabbixç›‘æ§ç½‘é¡µåšä»¥ä¸‹è®¾ç½®" class="headerlink" title="äºŒã€ç™»é™†Zabbixç›‘æ§ç½‘é¡µåšä»¥ä¸‹è®¾ç½®"></a>äºŒã€ç™»é™†Zabbixç›‘æ§ç½‘é¡µåšä»¥ä¸‹è®¾ç½®</h3><p>æ‰“å¼€zabbix-configuration-host-creat </p>
<p>1.hostæ·»åŠ éœ€è¦ç›‘æ§çš„ipåœ°å€,è¿™é‡Œå°±ä¸ä»‹ç»äº†ã€‚</p>
<p>2.é€‰æ‹©æ¨¡ç‰ˆtemplate icmp ping</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-icmp.png" alt=""></figure></p>
<p>3.æ·»åŠ Graphs</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-icmp1.png" alt=""></figure></p>
<p>æ·»åŠ å®Œä»¥åå¯ä»¥æŸ¥çœ‹å¯¹åº”çš„æœºå™¨å›¾å½¢ï¼š</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix-icmp2.png" alt=""></figure></p>
<p>å››ã€è§¦å‘å™¨æ¨¡ç‰ˆå·²è‡ªå¸¦ï¼Œè®¾ç½®æŠ¥è­¦æ–¹å¼åå°±å¯ä»¥æ¥æ”¶æŠ¥è­¦é‚®ä»¶äº†ã€‚</p>
<p>zabbix-server2.4æœåŠ¡ç«¯ç¼–è¯‘å®‰è£… <a href="http://blog.yangcvo.me/2015/01/18/zabbix-serveræœåŠ¡ç«¯ç¼–è¯‘å®‰è£…/" target="_blank" rel="external">zabbix-serveræœåŠ¡ç«¯ç¼–è¯‘å®‰è£…</a></p>
<p>zabbix2.4ç›‘æ§80ç«¯å£çŠ¶æ€ : <a href="http://blog.yangcvo.me/2016/07/20/zabbixç›‘æ§80ç«¯å£çŠ¶æ€/" target="_blank" rel="external">zabbixç›‘æ§80ç«¯å£çŠ¶æ€</a></p>
<p>zabbix+Grafanaå®‰è£…ä½¿ç”¨ç›‘æ§ç»“åˆ ï¼š<a href="http://blog.yangcvo.me/2016/07/13/zabbix-Grafanaå®‰è£…ä½¿ç”¨ç»“åˆ/" target="_blank" rel="external">zabbix+Grafanaå®‰è£…ä½¿ç”¨ç›‘æ§ç»“åˆ</a></p>
<p>zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹ : <a href="http://blog.yangcvo.me/2015/09/29/zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹/" target="_blank" rel="external">zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹</a></p>
<p>zabbixçš„ICMP_Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§ : <a href="http://blog.yangcvo.me/2015/11/18/zabbixçš„ICMP-Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§/" target="_blank" rel="external">zabbixçš„ICMP_Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§</a></p>
<p>zabbixæ€§èƒ½ç›‘æ§æ•…éšœæ€»ç»“ <a href="http://blog.yangcvo.me/2016/02/07/zabbix-æ•…éšœæ€»ç»“/" target="_blank" rel="external">zabbixæ€§èƒ½ç›‘æ§æ•…éšœæ€»ç»“</a></p>

	

	

</article>




	<article>
	
		<h1><a href="/2014/09/13/è¿ç»´å®‰å…¨/httpdè¿›ç¨‹éå¸¸å¤šï¼ŒæŸ¥æ‰¾è¢«æ”»å‡»çš„åŸå› /">httpdè¿›ç¨‹éå¸¸å¤šï¼ŒæŸ¥æ‰¾è¢«æ”»å‡»çš„åŸå› </a></h1>
	
	<div class="article__infos">
		<span class="article__date">2014-09-13</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/è¿ç»´å®‰å…¨/">è¿ç»´å®‰å…¨</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Operation-safety/">Operation safety</a>
			</span>
		
	</div>

	

	
		<p>å‰ä¸¤å¤©ï¼Œå…¬å¸æ‰˜ç®¡åœ¨ç”µä¿¡æœºæˆ¿çš„vpsæœåŠ¡å™¨çªç„¶ç½‘ç»œä¸­æ–­ï¼Œè¿è¥å•†é‚£è¾¹è¯´æˆ‘ä»¬çš„æœåŠ¡å™¨ä¸æ–­å¾€å¤–å‘åŒ…ï¼Œä¸¥é‡å½±å“åˆ°æœºæˆ¿çš„ç½‘ç»œï¼Œæ‰€ä»¥æŠŠè¯¥æœºå™¨çš„ç«¯å£å°äº†ï¼Œæ— æ¯”è›‹ç–¼å•Šï¼Œæ— å¥ˆä¸‹åªèƒ½äº²è‡ªè·‘åˆ°æœºæˆ¿è§£å†³é—®é¢˜ã€‚<br>å»åˆ°æœºæˆ¿ï¼Œä½¿ç”¨topå‘½ä»¤æŸ¥çœ‹åå‘ç°httpdè¿›ç¨‹å±…ç„¶å åˆ°90%å¤šçš„CPUã€‚</p>
<pre><code>ps -aux |grep httpd |wc -l
</code></pre><p>   å‘ç°æœ‰300å¤šä¸ªhttpdè¿›ç¨‹åº”è¯¥æ˜¯å—åˆ°SYN Floodæ”»å‡»è¿™æ—¶å€™æ²¡æœ‰ç›´æ¥æ€æ‰è¿›ç¨‹ï¼Œè¦æ‰¾å‡ºæ˜¯å“ªä¸ªç½‘ç«™å—æ”»å‡»ã€‚</p>
<pre><code>top |grep httpd
</code></pre><p>   é€‰å–è¿›ç¨‹ä¸­å ç”¨CPU%å¤šçš„ï¼Œç”¨lsof -p pid æ¥æŸ¥çœ‹ï¼Œå¦‚æœæœ‰å‡ ä¸ªhttpdè¿›ç¨‹éƒ½æ˜¾ç¤ºåŒä¸€ä¸ªç½‘ç«™ï¼Œåˆ™åŸºæœ¬ä¸Šå¯ä»¥åˆ¤å®šè¯¥ç½‘ç«™å°±æ˜¯é—®é¢˜ç½‘ç«™</p>
<pre><code>lsof -p &lt;pid&gt; 
</code></pre><p>æ‰¾åˆ°é—®é¢˜ç½‘ç«™ååœæ‰è¯¥ç½‘ç«™vps</p>
<pre><code>killall -9 httpd ,service httpd start å¼ºåˆ¶æ€æ‰httpè¿›ç¨‹ï¼Œå†é‡æ–°å¯åŠ¨ã€‚
</code></pre><p>ä»¥ä¸‹æ˜¯åœ¨ç½‘ä¸Šæ‰¾çš„é¢„é˜²SYN floodçš„åŠæ³•linuxä¸‹é˜²æ­¢SYN Floodæ”»å‡»ï¼Œèƒ½å¤Ÿæœ‰æ•ˆé˜²èŒƒSYN Floodæ”»å‡»çš„æ‰‹æ®µä¹‹ä¸€ï¼Œå°±æ˜¯SYN Cookie</p>
<p>Linuxä¸‹è®¾ç½®<br>å¦‚æœä½ çš„æœåŠ¡å™¨é…ç½®ä¸å¤ªå¥½ï¼ŒTCP TIME_WAITå¥—æ¥å­—æ•°é‡è¾¾åˆ°ä¸¤ã€ä¸‰ä¸‡ï¼ŒæœåŠ¡å™¨å¾ˆå®¹æ˜“è¢«æ‹–æ­»ã€‚é€šè¿‡ä¿®æ”¹Linuxå†…æ ¸å‚æ•°ï¼Œå¯ä»¥å‡å°‘æœåŠ¡å™¨çš„TIME_WAITå¥—æ¥å­—æ•°é‡ã€‚</p>
<p>TIME_WAITå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ï¼š</p>
<p>ä»¥ä¸‹æ˜¯ä»£ç ç‰‡æ®µï¼š</p>
<pre><code>netstat -an | grep &quot;TIME_WAIT&quot; | wc -l
</code></pre><p>åœ¨Linuxä¸‹ï¼Œå¦‚CentOSï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹/etc/sysctl.confæ–‡ä»¶æ¥è¾¾åˆ°ç›®çš„å¢åŠ ä»¥ä¸‹å‡ è¡Œï¼š</p>
<p>ä»¥ä¸‹æ˜¯ä»£ç ç‰‡æ®µï¼š</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">net<span class="selector-class">.ipv4</span><span class="selector-class">.tcp_fin_timeout</span> = <span class="number">30</span></div><div class="line">net<span class="selector-class">.ipv4</span><span class="selector-class">.tcp_keepalive_time</span> = <span class="number">1200</span></div><div class="line">net<span class="selector-class">.ipv4</span><span class="selector-class">.tcp_syncookies</span> = <span class="number">1</span></div><div class="line">net<span class="selector-class">.ipv4</span><span class="selector-class">.tcp_tw_reuse</span> = <span class="number">1</span></div><div class="line">net<span class="selector-class">.ipv4</span><span class="selector-class">.tcp_tw_recycle</span> = <span class="number">1</span></div><div class="line">net<span class="selector-class">.ipv4</span><span class="selector-class">.ip_local_port_range</span> = <span class="number">1024</span>    <span class="number">65000</span></div><div class="line">net<span class="selector-class">.ipv4</span><span class="selector-class">.tcp_max_syn_backlog</span> = <span class="number">8192</span></div><div class="line">net<span class="selector-class">.ipv4</span><span class="selector-class">.tcp_max_tw_buckets</span> = <span class="number">5000</span></div><div class="line">net<span class="selector-class">.ipv4</span><span class="selector-class">.tcp_synack_retries</span> = <span class="number">2</span></div><div class="line">net<span class="selector-class">.ipv4</span><span class="selector-class">.tcp_syn_retries</span> = <span class="number">2</span></div></pre></td></tr></table></figure>
<p>è¯´æ˜ï¼š</p>
<p><code>net.ipv4.tcp_syncookies = 1</code>è¡¨ç¤ºå¼€å¯SYN Cookiesï¼Œè¿™æ˜¯ä¸ªBOOLEANã€‚å½“å‡ºç°SYNç­‰å¾…é˜Ÿåˆ—æº¢å‡ºæ—¶ï¼Œå¯ç”¨cookiesæ¥å¤„ç†ï¼Œå¯é˜²èŒƒå°‘é‡SYNæ”»å‡»ï¼Œé»˜è®¤ä¸º0ï¼Œè¡¨ç¤ºå…³é—­ï¼›<br><code>net.ipv4.tcp_tw_reuse = 1</code> è¡¨ç¤ºå¼€å¯é‡ç”¨,è¿™æ˜¯ä¸ªBOOLEANã€‚å…è®¸å°†TIME-WAIT socketsé‡æ–°ç”¨äºæ–°çš„TCPè¿æ¥ï¼Œé»˜è®¤ä¸º0ï¼Œè¡¨ç¤ºå…³é—­ï¼›<br><code>net.ipv4.tcp_tw_recycle = 1</code>è¡¨ç¤ºå¼€å¯TCPè¿æ¥ä¸­TIME-WAIT socketsçš„å¿«é€Ÿå›æ”¶,è¿™æ˜¯ä¸ªBOOLEANï¼Œé»˜è®¤ä¸º0ï¼Œè¡¨ç¤ºå…³é—­ã€‚<br><code>net.ipv4.tcp_fin_timeout = 30</code> è¡¨ç¤ºå¦‚æœå¥—æ¥å­—ç”±æœ¬ç«¯è¦æ±‚å…³é—­ï¼Œè¿™ä¸ªå‚æ•°å†³å®šäº†å®ƒä¿æŒåœ¨FIN-WAIT-2çŠ¶æ€çš„æ—¶é—´ã€‚å•ä½ä¸ºç§’ã€‚<br><code>net.ipv4.tcp_keepalive_time = 1200</code>è¡¨ç¤ºå½“keepaliveèµ·ç”¨çš„æ—¶å€™ï¼ŒTCPå‘é€keepaliveæ¶ˆæ¯çš„é¢‘åº¦ã€‚ç¼ºçœæ˜¯2å°æ—¶ï¼Œæ”¹ä¸º20åˆ†é’Ÿã€‚å•ä½ä¸ºç§’ã€‚<br><code>net.ipv4.ip_local_port_range = 1024</code>   65000 è¡¨ç¤ºç”¨äºå‘å¤–è¿æ¥çš„ç«¯å£èŒƒå›´ã€‚ç¼ºçœæƒ…å†µä¸‹å¾ˆå°ï¼š32768åˆ°61000ï¼Œæ”¹ä¸º1024åˆ°65000ã€‚<br><code>net.ipv4.tcp_max_syn_backlog = 8192</code>è¡¨ç¤ºSYNé˜Ÿåˆ—çš„é•¿åº¦ï¼Œé»˜è®¤ä¸º1024ï¼ŒåŠ å¤§é˜Ÿåˆ—é•¿åº¦ä¸º8192ï¼Œå¯ä»¥å®¹çº³æ›´å¤šç­‰å¾…è¿æ¥çš„ç½‘ç»œè¿æ¥æ•°ã€‚<br><code>net.ipv4.tcp_max_tw_buckets = 5000</code> è¡¨ç¤ºç³»ç»ŸåŒæ—¶ä¿æŒTIME_WAITå¥—æ¥å­—çš„æœ€å¤§æ•°é‡ï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªæ•°å­—ï¼ŒTIME_WAITå¥—æ¥å­—å°†ç«‹åˆ»è¢«æ¸…é™¤å¹¶æ‰“å°è­¦å‘Šä¿¡æ¯ã€‚é»˜è®¤ä¸º180000ï¼Œæ”¹ä¸º5000ã€‚å¯¹äºApacheã€Nginxç­‰æœåŠ¡å™¨ï¼Œä¸Šå‡ è¡Œçš„å‚æ•°å¯ä»¥å¾ˆå¥½åœ°å‡å°‘TIME_WAITå¥—æ¥å­—æ•°é‡ï¼Œä½†æ˜¯å¯¹äºSquidï¼Œæ•ˆæœå´ä¸å¤§ã€‚æ­¤é¡¹å‚æ•°å¯ä»¥æ§åˆ¶TIME_WAITå¥—æ¥å­—çš„æœ€å¤§æ•°é‡ï¼Œé¿å…SquidæœåŠ¡å™¨è¢«å¤§é‡çš„TIME_WAITå¥—æ¥å­—æ‹–æ­»ã€‚<br><code>net.ipv4.tcp_synack_retries</code>å’Œ<code>net.ipv4.tcp_syn_retries</code>æ˜¯å®šä¹‰SYNé‡è¯•æ¬¡æ•°ã€‚</p>
<p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä½¿é…ç½®ç”Ÿæ•ˆï¼š</p>
<p>ä»¥ä¸‹æ˜¯ä»£ç ç‰‡æ®µï¼š<br><code>/sbin/sysctl -p</code></p>
<p>å¦‚æœä½ ä¸æƒ³ä¿®æ”¹/etc/sysctl.confï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨å‘½ä»¤ä¿®æ”¹:</p>
<p>ä»¥ä¸‹æ˜¯ä»£ç ç‰‡æ®µï¼š</p>
<p><code>/sbin/sysctl -w key=value</code></p>
<h4 id="æ‰¾æ¼æ´ï¼š"><a href="#æ‰¾æ¼æ´ï¼š" class="headerlink" title="æ‰¾æ¼æ´ï¼š"></a>æ‰¾æ¼æ´ï¼š</h4><p>é‡æ–°å®¡è§†äº†Mç«™ç›®å½•ä¸‹æ–‡ä»¶æƒé™ã€‚ä»…å¯¹å‡ ä¸ªå¿…è¦çš„ç¼“å­˜ã€é™æ€åŒ–çš„ç›®å½•ä¸ºapacheå¼€å¯äº†å†™æƒé™ï¼Œé˜²æ­¢<code>phzLtoxn.php</code>æ–‡ä»¶å†æ¬¡ç”Ÿæˆã€‚</p>
<p>é‡æ–°å¼€å¯httpdæœåŠ¡ï¼Œä½¿ç”¨360ç½‘ç«™æ£€æµ‹å¯¹Hç«™è¿›è¡Œæ¼æ´æ£€æµ‹ï¼Œå‘ç°Mç«™ä¸­æœ‰ä¸¥é‡çš„è¿œç¨‹æ‰§è¡Œæ¼æ´ï¼Œäºæ˜¯èµ¶ç´§æ‰“äº†è¡¥ä¸ã€‚</p>
<p>è¡¥ä¸æ‰“å¥½ä¹‹åï¼Œé¡ºä¾¿ä¿®æ”¹äº†ç³»ç»Ÿç”¨æˆ·ã€æ•°æ®åº“ç”¨æˆ·ã€ftpç”¨æˆ·çš„å¯†ç ã€Mç«™ç³»ç»Ÿç”¨æˆ·å¯†ç ã€‚<br>è§‚å¯Ÿå‡ æ—¥ä¹‹åï¼Œä¸€åˆ‡æ­£å¸¸ã€‚</p>

	

	

</article>




	<article>
	
		<h1><a href="/2014/04/19/æ€§èƒ½ç›‘æ§/Somekeping/ç”¨æœ€ç®€å•æ˜“æ‡‚çš„æ–¹å¼å®‰è£…smokeping/">ç”¨æœ€ç®€å•çš„æ–¹å¼å®‰è£…smokeping</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2014-04-19</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/monitoring/">monitoring</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/IDCç›‘æ§/">IDCç›‘æ§</a> <a class="article__tag-link" href="/tags/Performance-monitoring/">Performance monitoring</a> <a class="article__tag-link" href="/tags/Smokeping/">Smokeping</a>
			</span>
		
	</div>

	

	
		<p>smokepingè¿™ä¸ªç›‘æ§è¿˜æ˜¯å¾ˆå¼ºå¤§çš„ï¼Œç”¨è¿™ä¸ªç›‘æ§æ˜¯åœ¨ç¬¬ä¸€å®¶å…¬å¸åšIDCèµ·å®¶åé¢è½¬å‹CDNäº‘è®¡ç®—äº‘åŠ é€Ÿã€‚<br>è¿™ä¸ªä¹Ÿæ˜¯æˆ‘å­¦çš„æœ€æ—©çš„ä¸€æ¬¾ç›‘æ§ï¼Œåœ¨è¿™é‡Œæˆ‘ç”¨ç¼–è¯‘å®‰è£…æ–¹å¼ã€‚ä¹Ÿæœ‰è„šæœ¬å®‰è£…ä¸è¿‡éœ€è¦äº†è§£è¿‡somkepingå®‰è£…è¿‡ç¨‹ä¼šæ¯”è¾ƒçœ‹çš„æ‡‚è„šæœ¬ã€‚</p>
<p>é€‚ç”¨äºå®½å¸¦è¿è¥å•†ç»´æŠ¤å’ŒIDCæœºæˆ¿ç»´æŠ¤å¯ä»¥æ£€æµ‹æœ¬åœ°ç½‘ç»œçš„åˆ°ä¸Šçº§è¿è¥å•†å‡ºå£è¿™æ®µè·¯ç”±å„ä¸ªèŠ‚ç‚¹çš„ç¨³å®šæ€§            å¯ä»¥æ£€æµ‹æœ¬åœ°ç½‘ç»œåˆ°å„ä¸»è¦é—¨æˆ·ç½‘ç«™çš„<code>å»¶æ—¶ï¼Œä¸¢åŒ…ç‡ï¼Œç¨³å®šæ€§</code><br>å¯ä»¥æ£€æµ‹æœ¬åœ°ç½‘ç»œåˆ°å„åœ°æ¸¸æˆæœåŠ¡å™¨çš„<code>å»¶æ—¶ï¼Œä¸¢åŒ…ç‡ï¼Œç¨³å®šæ€§</code></p>
<p>smokepingç¼ºç‚¹ï¼šä¸èƒ½åœ¨å‰å°Webé¡µé¢æ·»åŠ è¦æ£€æµ‹çš„èŠ‚ç‚¹ï¼Œå¿…é¡»åœ¨åå°smokepingçš„é…ç½®æ–‡ä»¶ä¸­æ·»åŠ  </p>
<h3 id="å®‰è£…å‰çš„å‡†å¤‡ï¼š"><a href="#å®‰è£…å‰çš„å‡†å¤‡ï¼š" class="headerlink" title="å®‰è£…å‰çš„å‡†å¤‡ï¼š"></a>å®‰è£…å‰çš„å‡†å¤‡ï¼š</h3><ol>
<li>æ“ä½œç³»ç»Ÿï¼šé€‰æ‹©centOS6.5æœ€å°åŒ–ç‰ˆï¼Œ é‡Œé¢çš„RPMåŒ…åŸºæœ¬ä¸Šéƒ½æ˜¯æœ€æ–°çš„ã€‚   </li>
<li>æ³¨1: centOS 5.6ç‰ˆæœ¬åœ¨å®‰è£…rpmforge-release-0.5.3-1.el6.rf.x86_64.rpmåŒ…æ˜¯ä¼šé‡åˆ°ä¾èµ–æ€§é—®é¢˜ï¼Œè¦æ±‚å®‰è£…rpmlibåŒ…ï¼Œä½†centOS5.6ç‰ˆæœ¬ä¸­çš„rpmlibç‰ˆæœ¬è¾ƒä½ï¼Œæ— æ³•ç›´æ¥å®‰è£…   </li>
<li>æ³¨2ï¼šåœ¨å®‰è£…centOS6.5æ—¶ï¼Œè¦æ³¨æ„è®¾ç½®ç³»ç»Ÿçš„IPåœ°å€ï¼Œå¦‚ä¸‹å›¾,ç‚¹å‡»ã€configure networkã€‘æŒ‰é’®ï¼Œé€‰æ‹©ã€system eth0ã€‘, ç‚¹å‡» ã€IPv4Setingã€‘,è®¾ç½®IPåœ°å€    </li>
<li>æ³¨3: é€‰æ‹©å®‰è£…åŒ…æ—¶ï¼Œç‚¹é€‰ã€Basic Serverã€‘, è¦å®‰è£…621ä¸ªåŸºæœ¬åŒ… æ³¨4: å…¶ä»–å®‰è£…æ­¥éª¤ï¼ŒæŒ‰ç…§æ­£å¸¸çš„å®‰è£…æµç¨‹æ“ä½œå³å¯ </li>
</ol>
<h3 id="äºŒ-å®‰è£…è¿‡ç¨‹"><a href="#äºŒ-å®‰è£…è¿‡ç¨‹" class="headerlink" title="äºŒ. å®‰è£…è¿‡ç¨‹"></a>äºŒ. å®‰è£…è¿‡ç¨‹</h3><p>ä¿®æ”¹æ—¶åŒº</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">\cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</div></pre></td></tr></table></figure>
<p>åŒæ­¥æ—¶é—´</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ntpdate time.nist.gov</div></pre></td></tr></table></figure>
<p>å†™å…¥BIOS</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hwclock -w</div></pre></td></tr></table></figure>
<p>å…³é—­é˜²ç«å¢™</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">service iptables stop</div></pre></td></tr></table></figure>
<h3 id="1-å®‰è£…ç¬¬ä¸‰æ–¹è½¯ä»¶æº"><a href="#1-å®‰è£…ç¬¬ä¸‰æ–¹è½¯ä»¶æº" class="headerlink" title="1. å®‰è£…ç¬¬ä¸‰æ–¹è½¯ä»¶æº"></a>1. å®‰è£…ç¬¬ä¸‰æ–¹è½¯ä»¶æº</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">64ä½ç³»ç»Ÿ </div><div class="line">rpm  -Uvh http://apt.sw.be/redhat/el6/en/x86_64/rpmforge/RPMS/rpmforge-release-0.5.3-1.el6.rf.x86_64.rpm</div><div class="line">32ä½ç³»ç»Ÿ</div><div class="line">rpm  -Uvh http://apt.sw.be/redhat/el6/en/i386/rpmforge/RPMS/rpmforge-release-0.5.3-1.el6.rf.i686.rpm</div></pre></td></tr></table></figure>
<p>æ³¨ï¼šå®‰è£…è¿™ä¸ªæºåï¼Œæ¥ä¸‹æ¥è¦å®‰è£…çš„å¤§é‡çš„ä¾èµ–åŒ…å°±ä¸ä¼šæŠ¥é”™</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">rpm -Uvh  http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm </div><div class="line">sed -i <span class="string">'s/^#baseurl/baseurl/g'</span> /etc/yum.repos.d/epel.repo</div><div class="line">sed -i <span class="string">'s/mirrorlist/#mirrorlist/g'</span> /etc/yum.repos.d/epel.repo</div></pre></td></tr></table></figure>
<h3 id="2-å®‰è£…rrdtoolä¸ä¾èµ–åº“"><a href="#2-å®‰è£…rrdtoolä¸ä¾èµ–åº“" class="headerlink" title="2. å®‰è£…rrdtoolä¸ä¾èµ–åº“"></a>2. å®‰è£…rrdtoolä¸ä¾èµ–åº“</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install perl perl-Net-Telnet perl-Net-DNS perl-LDAP perl-libwww-perl perl-RadiusPerl perl-IO-Socket-SSL perl-Socket6 perl-CGI-SpeedyCGI perl-FCGI perl-CGI-SpeedCGI perl-Time-HiRes perl-ExtUtils-MakeMaker perl-RRD-Simple rrdtool rrdtool-perl curl fping echoping  httpd httpd-devel gcc make  wget libxml2-devel libpng-devel glib pango pango-devel freetype freetype-devel fontconfig cairo cairo-devel libart_lgpl libart_lgpl-devel mod_fastcgi screen wqy-zenhei-fonts.noarch wqy-zenhei-fonts-common.noarch lrzsz nginx</div></pre></td></tr></table></figure>
<p>æ³¨ï¼š<code>perl-CGI-SpeedyCGIï¼Œperl-CGI-SpeedCGI</code>è¿™ä¸¤ä¸ªåŒ…åœ¨å®‰è£…è¿‡ç¨‹ä¸­ä¼šæç¤ºæ‰¾ä¸åˆ°ï¼Œä½†æ²¡å…³ç³»<br>æ³¨ï¼šç”¨yumå®‰è£…å¤§é‡çš„ä¾èµ–åŒ…è¿˜æ˜¯å¾ˆæ–¹ä¾¿çš„ï¼Œè€Œç™¾åº¦ä¸Šæœ‰äº›å…³äºå®‰è£…smokepingçš„æ–‡æ¡£è¦æ±‚ä½¿ç”¨wgetä¸‹è½½åå†ç”¨<code>make,make install</code>æ–¹å¼å®‰è£…ï¼Œè™½ç„¶makeæ–¹å¼ä¸å¤æ‚ï¼Œä½†é€šè¿‡makeç¼–è¯‘å†å®‰è£…å‡ åä¸ªåŒ…å°±æ˜¾å¾—æœ‰ç‚¹ç¹é”äº†ã€‚</p>
<h3 id="3-ä¸‹è½½ä¸å®‰è£…smokeping"><a href="#3-ä¸‹è½½ä¸å®‰è£…smokeping" class="headerlink" title="3.ä¸‹è½½ä¸å®‰è£…smokeping"></a>3.ä¸‹è½½ä¸å®‰è£…smokeping</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">wget http://oss.oetiker.ch/smokeping/pub/smokeping-2.6.8.tar.gz</div><div class="line">wget http://oss.oetiker.ch/smokeping/pub/smokeping-2.6.11.tar.gz    </div><div class="line">tar zxvf smokeping-2.6.8.tar.gz</div><div class="line"><span class="built_in">cd</span> smokeping-2.6.8</div><div class="line">./configure --prefix=/usr/<span class="built_in">local</span>/smokeping</div></pre></td></tr></table></figure>
<p>å‡ºç°é—®é¢˜æ˜¯å› ä¸ºéœ€è¦å®‰è£…perlçš„æ¨¡å—ï¼Œæ‰€ä»¥è¿è¡Œä¸‹é¢å†…å®¹å³å¯</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">å¦‚æœåªå‡ºç° Config::Grammar<span class="string">' ... Failed</span></div><div class="line">è§£å†³ 'Config::Grammar<span class="string">' ... Failed</span></div><div class="line">wget http://search.cpan.org/CPAN/authors/id/D/DS/DSCHWEI/Config-Grammar-1.10.tar.gz</div><div class="line">tar zxvf Config-Grammar-1.10.tar.gz</div><div class="line">cd Config-Grammar-1.10</div><div class="line">perl Makefile.PL</div><div class="line">make &amp;&amp; make install</div></pre></td></tr></table></figure>
<p>å¦‚æœå‡ºç°å¾ˆå¤šä¸ªfailedï¼Œå°±ç”¨ä¸‹é¢çš„æ–¹æ³•</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">./setup/build-perl-modules.sh /usr/<span class="built_in">local</span>/smokeping/thirdparty  è¿™ä¸ªæ˜¯ä¸ºå‰é¢failedåšå®‰è£…  </div><div class="line">./co nfigure --prefix=/usr/<span class="built_in">local</span>/smokeping   </div><div class="line">                                                                      </div><div class="line">å¦‚æœè¿˜å‡ºç°é—®é¢˜å¯ä»¥çœ‹ä¸‹è¿™é‡Œé¢çš„å‚è€ƒã€‚http://bbs.51cto.com/thread-1106181-1.html</div><div class="line">/usr/bin/gmake install</div><div class="line"></div><div class="line">å®‰è£…ä¸‹yum install cpan     perl -MCPAN <span class="_">-e</span> <span class="string">'install CGI'</span>           perl -MCPAN <span class="_">-e</span> <span class="string">'install CGI::Fast '</span>  è¿™ä¸ªå®‰è£…å¥½äº†ç„¶åå†æ‰§è¡Œè¿™ä¸€æ­¥ã€‚</div></pre></td></tr></table></figure>
<p>å¦‚æœä¸Šé¢æç¤ºCGI æ²¡æœ‰å®‰è£…æˆåŠŸã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">wgethttp://www.cpan.org/authors/id/M/MA/MARKSTOS/</div><div class="line">CGI.pm-3.65.tar.gz</div><div class="line">tar zxvf CGI.pm-3.65.tar.gz</div><div class="line"><span class="built_in">cd</span> CGI.pm-3.65</div><div class="line">perl Makefile.PL</div><div class="line">make &amp;&amp; make install</div><div class="line">ç„¶åå†æ‰§è¡Œä¸‹ ./configure --prefix=/usr/<span class="built_in">local</span>/smokeping</div></pre></td></tr></table></figure>
<p>ç°åœ¨smokepingå®‰è£…å®Œæˆ</p>
<h3 id="4-é…ç½®smokeping"><a href="#4-é…ç½®smokeping" class="headerlink" title="4. é…ç½®smokeping"></a>4. é…ç½®smokeping</h3><h2 id="ç¬¬ä¸€ç§-ä½¿ç”¨nginx"><a href="#ç¬¬ä¸€ç§-ä½¿ç”¨nginx" class="headerlink" title="ç¬¬ä¸€ç§ ä½¿ç”¨nginx"></a>ç¬¬ä¸€ç§ ä½¿ç”¨nginx</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">1.å®‰è£…nginx</div><div class="line">rpm -Uvh  http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm</div><div class="line">yum install -y nginx</div><div class="line">https://metacpan.org/pod/release/MSTROUT/ExtUtils-MakeMaker-6.59/lib/ExtUtils/MakeMaker.pm  ä¸‹è½½Make è®©ä»–ç›´æ¥æ‰§è¡Œ</div></pre></td></tr></table></figure>
<p>2.å®‰è£…åŸºç¡€IO </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /root</div><div class="line">wget  http://220.194.199.196/download/IO-All-0.46.tar.gz</div><div class="line">tar xvzf IO-All-0.46.tar.gz</div><div class="line"><span class="built_in">cd</span> IO-All-0.46</div><div class="line">perl Makefile.PL       <span class="comment">#  è¿™é‡Œå‡ºç°è¿™ä¸ªé—®é¢˜ æŠŠé‚£ä¸ªæ–‡ä»¶åˆ äº†å°±è¡Œäº†ã€‚</span></div><div class="line">make &amp;&amp; make install</div></pre></td></tr></table></figure>
<p>3.é…ç½®nginxçš„sock<br>åˆ›å»ºfcgi sock æ–‡ä»¶ï¼Œé…ç½®nginx fcgiä½¿ç”¨</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#wget http://autonagios.googlecode.com/svn/trunk/autonagios-20100103/files/nginx-fcgi.txt  -O /etc/nginx-fcgi</span></div><div class="line">wget http://117.27.153.133/nginx-fcgi.txt -O /etc/nginx-fcgi </div><div class="line">chmod a+x /etc/nginx-fcgi</div><div class="line">/etc/nginx-fcgi <span class="_">-l</span> /var/<span class="built_in">log</span>/nginx-fcgi.log -pid /var/run/nginx-fcgi.pid -S /var/run/nginx-fcgi.sock</div><div class="line">chmod 777 /var/run/nginx-fcgi.sock</div></pre></td></tr></table></figure>
<p>4.å¢åŠ smokepingä½¿ç”¨çš„dataã€varã€å’Œcacheç›®å½•</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/smokeping</div><div class="line">mkdir data var cache</div><div class="line">mv htdocs/smokeping.fcgi.dist htdocs/smokeping.fcgi</div><div class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/smokeping/etc</div><div class="line">mv config.dist config</div><div class="line">chmod 600 /usr/<span class="built_in">local</span>/smokeping/etc/smokeping_secrets.dist</div></pre></td></tr></table></figure>
<p>5.ä¸Šä¼ ç›‘æ§èŠ‚ç‚¹confæ–‡ä»¶åˆ°smokepingçš„etcç›®å½•<br>6.ä¿®æ”¹smokpeingé…ç½®è„šæœ¬</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">vi config</div><div class="line">åœ¨å¦‚ä¸‹ä½ç½®ä¿®æ”¹</div><div class="line"></div><div class="line">*** Database ***</div><div class="line">step     = 300</div><div class="line">pings    = 20</div><div class="line">ä¿®æ”¹ä¸º</div><div class="line">*** Database ***</div><div class="line">step     = 60</div><div class="line">pings    = 20</div><div class="line"></div><div class="line">åœ¨å¦‚ä¸‹ä½ç½®æ·»åŠ ä¸€å¥è¯</div><div class="line">*** Presentation ***</div><div class="line">template = /usr/<span class="built_in">local</span>/smokeping/etc/basepage.html.dist</div><div class="line">charset=utf-8</div></pre></td></tr></table></figure>
<p>åœ¨ç¬¬ä¸€ä¸ªåŠ å·ä½ç½®ä¸‹å°†ç›‘æ§èŠ‚ç‚¹æ–‡ä»¶å¼•å…¥ï¼Œå¦‚ä¸‹ä¾‹å­</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">+ testnetwork</div><div class="line">menu=æµ‹è¯•ç½‘ç»œçŠ¶å†µ</div><div class="line">title= æµ‹è¯•ç½‘ç»œçŠ¶å†µ</div><div class="line">@include CT-IP.conf</div><div class="line">@include CN-IP.conf</div><div class="line">@include CT_IDC.conf</div><div class="line">@include CNC-IDC.conf</div></pre></td></tr></table></figure>
<p>ä¿å­˜é€€å‡º</p>
<p>7.å¢åŠ dataã€varã€cacheç›®å½•çš„è½¯è¿æ¥</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ln <span class="_">-s</span> /usr/<span class="built_in">local</span>/smokeping/data/ /usr/share/nginx/html/data</div><div class="line">ln <span class="_">-s</span>  /usr/<span class="built_in">local</span>/smokeping/cache/ /usr/share/nginx/html/cache</div><div class="line">ln <span class="_">-s</span> /usr/<span class="built_in">local</span>/smokeping/htdocs/cropper/ /usr/share/nginx/html/cropper</div></pre></td></tr></table></figure>
<p>8.ä¿®æ”¹nginx é…ç½®æ–‡ä»¶<br>æŸ¥çœ‹ä¸‹nginxçš„ç‰ˆæœ¬ï¼Œä½¿ç”¨nginx -v æŸ¥çœ‹ï¼Œå¦‚ä¸‹ä¾‹å­ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"> nginx -v</div><div class="line">nginx version: nginx/1.0.15</div></pre></td></tr></table></figure>
<p>ä¿®æ”¹nginxé…ç½®</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">vi</span> /etc/nginx/conf.d/default.conf</div><div class="line">--å¢åŠ fcgi æŒ‡å‘</div><div class="line">    location  <span class="regexp">~ .*\.fcgi$</span> &#123;</div><div class="line">        <span class="attribute">root</span> /usr/local/smokeping/htdocs/;</div><div class="line">        <span class="attribute">gzip</span> <span class="literal">off</span>;</div><div class="line">        <span class="attribute">fastcgi_pass</span>  unix:/var/run/nginx-fcgi.sock;</div><div class="line">        <span class="attribute">fastcgi_index</span> smokeping.fcgi;</div><div class="line">        <span class="attribute">include</span> fastcgi.conf;                 <span class="comment">#1.0.x ä¸0.8.x ç”¨è¿™ä¸ª</span></div><div class="line">        <span class="comment">#include fastcgi_params;            #1.4.xç‰ˆæœ¬ç”¨ fastcgi_params</span></div><div class="line">        <span class="comment">#fastcgi_param   SCRIPT_FILENAME /opt/smokeping/htdocs$fastcgi_script_name; #1.4.xç‰ˆæœ¬å¿…åŠ </span></div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>ä¿å­˜é€€å‡º</p>
<h2 id="ç¬¬äºŒç§-ä½¿ç”¨apache"><a href="#ç¬¬äºŒç§-ä½¿ç”¨apache" class="headerlink" title="ç¬¬äºŒç§ ä½¿ç”¨apache"></a>ç¬¬äºŒç§ ä½¿ç”¨apache</h2><p>(1) åˆ›å»ºcacheã€dataã€varç›®å½•</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/smokeping</div><div class="line">mkdir htdocs/cache data var</div></pre></td></tr></table></figure>
<p>(2) åœ¨åˆ›å»ºæ—¥å¿—</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">touch /var/<span class="built_in">log</span>/smokeping.log</div></pre></td></tr></table></figure>
<p>(3) ä¸Šä¼ ç›‘æ§èŠ‚ç‚¹çš„confæ–‡ä»¶åˆ°smokepingçš„etcç›®å½•ä¸‹<br>ä¿®æ”¹smokepingç›®å½•çš„ç”¨æˆ·å’Œç»„æƒé™</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">chown apache:apache -R /usr/<span class="built_in">local</span>/smokeping</div><div class="line">chown apache:apache /var/<span class="built_in">log</span>/smokeping.log</div></pre></td></tr></table></figure>
<p>(4) ä¿®æ”¹é…ç½®æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/smokeping/htdocs/</div><div class="line">mv smokeping.fcgi.dist smokeping.fcgi</div><div class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/smokeping/etc</div><div class="line">mv config.dist config</div><div class="line">vi config</div><div class="line"></div><div class="line">ä¿®æ”¹æ”¹è¡Œè®¾ç½®</div><div class="line">imgcache = /usr/<span class="built_in">local</span>/smokeping/cache</div><div class="line">imgcache = /usr/<span class="built_in">local</span>/smokeping/htdocs/cache</div><div class="line"></div><div class="line"> *** Database ***</div><div class="line">step  = 300</div><div class="line">pings  = 60</div><div class="line">ç„¶åä¿®æ”¹stepï¼Œä»300æ”¹ä¸º60ï¼Œè¿™æ˜¯æ£€æµ‹çš„æ—¶é—´, pings ä»20 æ”¹ä¸º60, å³60ç§’ping 60æ¬¡</div><div class="line"></div><div class="line">åœ¨å¦‚ä¸‹ä½ç½®æ·»åŠ ä¸€å¥è¯</div><div class="line">*** Presentation ***</div><div class="line">template = /usr/<span class="built_in">local</span>/smokeping/etc/basepage.html.dist</div><div class="line">charset=utf-8</div><div class="line"></div><div class="line">åœ¨ç¬¬ä¸€ä¸ªåŠ å·ä½ç½®ä¸‹å°†ç›‘æ§èŠ‚ç‚¹æ–‡ä»¶å¼•å…¥ï¼Œå¦‚ä¸‹ä¾‹å­</div><div class="line">+ testnetwork</div><div class="line">menu=æµ‹è¯•ç½‘ç»œçŠ¶å†µ</div><div class="line">title= æµ‹è¯•ç½‘ç»œçŠ¶å†µ</div><div class="line">@include CT-IP.conf</div><div class="line">@include CN-IP.conf</div><div class="line">@include CT_IDC.conf</div><div class="line">@include CNC-IDC.conf</div></pre></td></tr></table></figure>
<p>ä¿å­˜é€€å‡º </p>
<p> (5) é…ç½®å®Œæˆä¹‹åä¿®æ”¹å¯†ç æ–‡ä»¶æƒé™</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">chmod 600 /usr/<span class="built_in">local</span>/smokeping/etc/smokeping_secrets.dist</div></pre></td></tr></table></figure>
<ol>
<li>ä¿®æ”¹apacheçš„é…ç½®</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">vim /etc/httpd/conf/httpd.conf</div><div class="line">åœ¨DocumentRoot <span class="string">"/var/www/html"</span> è¿™ä¸€è¡Œä¹‹ä¸‹æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</div><div class="line"></div><div class="line">Alias /cache <span class="string">"/usr/local/smokeping/htdocs/cache"</span></div><div class="line">Alias /cropper <span class="string">"/usr/local/smokeping/htdocs/cropper"</span></div><div class="line">Alias /smokeping <span class="string">"/usr/local/smokeping/htdocs"</span></div><div class="line">&lt;Directory <span class="string">"/usr/local/smokeping/htdocs"</span>&gt;</div><div class="line">  AllowOverride None</div><div class="line">  AddHandler cgi-script .fcgi .cgi</div><div class="line">  Options ExecCGI</div><div class="line">  &lt;IfModule dir_module&gt;</div><div class="line">     DirectoryIndex smokeping.fcgi</div><div class="line">  &lt;/IfModule&gt;</div><div class="line">  Order allow,deny</div><div class="line">  Allow from all </div><div class="line">&lt;/Directory&gt;</div></pre></td></tr></table></figure>
<ol>
<li>è®¾ç½®å¼€æœºå¯åŠ¨httpd, smokeping,å¹¶å…³é—­iptables.</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">echo</span> <span class="string">"/usr/local/smokeping/bin/smokeping --logfile=/var/log/smokeping.log 2&gt;&amp;1 &amp;"</span> &gt;&gt; /etc/rc.local</div><div class="line">chkconfig httpd on      <span class="comment">#å¼€æœºå¯åŠ¨httpdè¿›ç¨‹</span></div><div class="line">chkconfig iptables off  <span class="comment">#å¼€æœºä¸å¯åŠ¨iptablesæœåŠ¡</span></div><div class="line">chkconfig nginx on</div></pre></td></tr></table></figure>
<ol>
<li>å¯åŠ¨httpæˆ–è€…nginxä»¥åŠsmokeping</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">service httpd start service nginx start</div><div class="line">/usr/<span class="built_in">local</span>/smokeping/bin/smokeping --debug-daemon</div><div class="line">chown apache:apache -R /usr/<span class="built_in">local</span>/smokeping</div></pre></td></tr></table></figure>
<ol>
<li>æ‰“å¼€æ£€æµ‹ä¸»æœºçš„Webé¡µé¢.</li>
</ol>
<p>ä½¿ç”¨httpdåšwebï¼Œåœ¨Webæµè§ˆå™¨é‡Œè¾“å…¥<code>http://æ‚¨çš„ç›‘æ§ä¸»æœºIP/smokeping</code>      è¿™é‡Œå¯åŠ¨ä¸äº†ï¼Œçœ‹ä¸‹ä»€ä¹ˆåŸå› ã€‚æ˜¯ä¸æ˜¯CT-IDC.conf æ²¡æœ‰ä¸Šä¼ åˆ°etcä¸‹é¢</p>
<p>æ‰“å¼€è¿™é‡Œå‡ºç°500  è¯´æ˜é…ç½®æ­£ç¡®é˜²ç«å¢™çœ‹ä¸‹ã€‚<code>serenfroce 0</code> æœ‰æ²¡æœ‰å…³é—­ã€‚</p>
<p>ä½¿ç”¨nginxåšwebï¼Œåœ¨Webæµè§ˆå™¨é‡Œè¾“å…¥ <a href="http://æ‚¨çš„ç›‘æ§ä¸»æœºIP/smokeping.fcgi" target="_blank" rel="external">http://æ‚¨çš„ç›‘æ§ä¸»æœºIP/smokeping.fcgi</a>    è¿™é‡Œå¯åŠ¨ä¸äº†ï¼Œçœ‹ä¸‹ä»€ä¹ˆåŸå› ã€‚æ˜¯ä¸æ˜¯CT-IDC.conf æ²¡æœ‰ä¸Šä¼ åˆ°etcä¸‹é¢</p>
<p>å¦‚æœé‡åˆ°500é”™è¯¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">Internal Server Error</div><div class="line">The server encountered an internal error or misconfiguration and was unable to complete your request.</div><div class="line">Please contact the server administrator, root@localhost and inform them of the time the error occurred, and anything you might have <span class="keyword">done</span> that may have caused the error.</div><div class="line">More information about this error may be available <span class="keyword">in</span> the server error log.</div><div class="line">--------------------------------------------------------------------------------</div><div class="line">Apache/2.2.15 (CentOS) Server at 192.168.2.101 Port 80</div><div class="line"></div><div class="line">è¯´æ˜æ²¡æœ‰å…³é—­SElinux é€‰é¡¹ï¼Œå…³é—­å°±æ­£å¸¸äº†</div><div class="line">vi /etc/sysconfig/selinux</div><div class="line">SELINUX=permissive</div><div class="line">[root@localhost ~]<span class="comment"># getenforce     #æŸ¥çœ‹SElinux çš„å‘½ä»¤</span></div><div class="line">Permissive                      <span class="comment">#è¿”å›çš„ç»“æœæ˜¯Permissive, è¡¨ç¤ºå·²ç»å…³é—­SElinuxäº†</span></div></pre></td></tr></table></figure>
<ol>
<li>åœ¨Webé¡µé¢å¢åŠ éªŒè¯ç”¨æˆ·åå’Œå¯†ç (å¯é€‰æ­¥éª¤)</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">(1)ä¿®æ”¹httpd.confé‡Œçš„å†…å®¹</div><div class="line">&lt;Directory <span class="string">"/usr/local/smokeping"</span>&gt;</div><div class="line">AllowOverride None</div><div class="line">Options All</div><div class="line">AddHandler cgi-script .fcgi .cgi</div><div class="line">AllowOverride AuthConfig</div><div class="line">Order allow,deny</div><div class="line">Allow from all</div><div class="line">AuthName <span class="string">"Smokeping"</span></div><div class="line">AuthType Basic</div><div class="line">AuthUserFile /usr/<span class="built_in">local</span>/smokeping/htdocs/htpasswd</div><div class="line">Require valid-user</div><div class="line">DirectoryIndex smokeping.fcgi</div><div class="line">&lt;/Directory&gt;</div></pre></td></tr></table></figure>
<p>æ³¨ï¼šä¸Šé¢çš„å†…å®¹éƒ¨åˆ†å·²ç»æ·»åŠ ï¼Œè¿™é‡Œä»…æ·»åŠ çº¢è‰²å­—ä½“å†…å®¹å³å¯ã€‚</p>
<p>(2) è®¾ç½®ç™»å½•è´¦æˆ·ä¸å¯†ç <br>è¿›å…¥cd /usr/local/smokeping/htdocsç›®å½•ï¼Œ æ‰§è¡Œå‘½ä»¤ï¼šhtpasswd -c /usr/local/smokeping/htdocs/htpasswd admin<br>è¿™ä¸ªæ˜¯è®¾ç½®ç™»å½•è´¦æˆ·ä¸ºadminï¼Œå¯†ç åœ¨åé¢è¾“å…¥ï¼Œç„¶åé‡å¯httpdå°±å¯ä»¥å®ç°å¯†ç éªŒè¯ç™»å½•<br>é‡æ–°ç™»å½•webé¡µé¢ï¼Œä¼šè¦æ±‚è¾“å…¥ç”¨æˆ·åå’Œå¯†ç .</p>
<ol>
<li>ä¸€å®šè¦åŒæ­¥å¥½æ—¶é—´</li>
</ol>
<p>åœ¨ESXI4çš„è™šæ‹Ÿæœºä¸­ï¼Œå®šæœŸæ‰§è¡Œ<code>ntpdate 210.72.145.44</code>    #æˆ–è€…ä¸æœ¬åœ°çš„æ—¶é—´æœåŠ¡å™¨åŒæ­¥<br>åœ¨vmware workstationä¸­ï¼Œå®‰è£…vmware-toolsï¼Œ è™šæ‹Ÿæœºçš„æ—¶é—´ä¼šè‡ªåŠ¨ä¸å…¶å®¿ä¸»æœºæ—¶é—´åŒæ­¥</p>
<p>æ³¨ï¼š å¦‚æœvmware workstationä¸­çš„è™šæ‹Ÿæœºä¸å®‰è£…vmware-toolsï¼Œåˆ™è™šæ‹Ÿæœºæ—¶é—´ä¼šä¸å®¿ä¸»æœºæ—¶é—´ç›¸éš”æ•´æ•´8ä¸ªå°æ—¶(è™šæ‹Ÿæœºæ—¶é—´æ—©äºå®¿ä¸»æœºæ—¶é—´)<br> vmware-toolsçš„å®‰è£…ä¸åœ¨æ­¤å™è¿°</p>
<ol>
<li><p>ç‰¹åˆ«è¯´æ˜: ä¿®æ”¹/usr/local/smokeping/etc/config æ–‡ä»¶çš„é…ç½®å‚æ•°ï¼Œå¿…é¡»é‡å¯åŠ¨smokepingç¨‹åº</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">(1)å¦‚æœé‡å¯åŠ¨smokepingç¨‹åºå¤±è´¥ï¼Œæ ¹æ®æŠ¥é”™æç¤ºåˆ é™¤/usr/<span class="built_in">local</span>/smokeping/dataå­æ–‡ä»¶å¤¹çš„rrdæ–‡ä»¶</div><div class="line">(2)ä¸­æ–‡é—®é¢˜ï¼šå¦‚æœéœ€è¦åœ¨ç½‘é¡µé‡Œå±•ç¤ºä¸­æ–‡ï¼Œä¿®æ”¹/usr/<span class="built_in">local</span>/smokeping/etcçš„configæ–‡ä»¶</div><div class="line">*** Presentation ***</div><div class="line">charset = utf-8 //æ³¨ï¼šåœ¨è¿™é‡Œæ·»åŠ </div><div class="line">ç„¶ååœ¨menuä¸titileé‡Œä¿®æ”¹ä¸­æ–‡ï¼Œé‡å¯å³å¯</div></pre></td></tr></table></figure>
<p>æœ‰ä¸€ä¸ªè¦æ³¨æ„çš„åœ°æ–¹å°±æ˜¯ï¼Œä½ è¾“å…¥çš„ä¸­æ–‡å¿…é¡»åœ¨utf-8çš„å­—ç¬¦ç¼–ç ä¸‹è¾“å…¥çš„ä¸­æ–‡å­—ç¬¦ï¼Œä¸ç„¶ä¼šå‡ºç°ä¹±ç ã€‚<br> å¦‚æœåœ¨xshelä¸‹ï¼Œé€‰æ‹©file-properities-terminal<br>å¦‚æœè¿˜æ˜¯ä¸æ˜¾ç¤ºå°±çœ‹çœ‹ä½ ç³»ç»Ÿé‡Œæ˜¯å¦å®‰è£…äº†ä¸­æ–‡å­—ä½“ï¼Œæˆ–è€…åœ¨å®‰è£…ä¸€ä¸ª</p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[root@smokeping data]<span class="comment"># ps -ef |grep smoke   #æŸ¥æ‰¾smokepingè¿›ç¨‹</span></div><div class="line">root      8740     1  0 09:08 ?        00:00:00 /usr/<span class="built_in">local</span>/smokeping/bin/smokeping [FPing]</div><div class="line">root     35552 35529  0 09:33 pts/2    00:00:00 grep smoke</div><div class="line">[root@smokeping data]<span class="comment"># kill 8740     #æ€æ‰smokepingè¿›ç¨‹</span></div><div class="line">[root@smokeping data]<span class="comment"># ps -ef |grep smoke</span></div><div class="line">root     35554 35529  4 09:33 pts/2    00:00:00 grep smoke</div><div class="line">smokepingè¿›ç¨‹å·²ç»è¢«æ€æ‰</div><div class="line">[root@smokeping data]<span class="comment">#screen                    #å¦‚æœé€šè¿‡SSHè¿œç¨‹ç™»å½•åˆ°ç›‘æ§ä¸»æœºï¼Œæœ€åæ‰§è¡Œscreenï¼Œåœ¨è™šæ‹Ÿçª—å£ä¸­å¯åŠ¨smokeping</span></div><div class="line">/usr/<span class="built_in">local</span>/smokeping/bin/smokeping --logfile=/var/<span class="built_in">log</span>/smokeping.log 2&gt;&amp;1 &amp;</div></pre></td></tr></table></figure>
<p>ä¸‰. æ·»åŠ éœ€è¦ç›‘æ§çš„ç½‘ç«™å’ŒèŠ‚ç‚¹(åœ¨/usr/local/smokeping/etc/configä¸­æ·»åŠ )</p>
<ul>
<li><p>smokepingå°±è¿™ç‚¹ä¸å¥½ï¼Œæ·»åŠ èŠ‚ç‚¹ä¸èƒ½åœ¨å‰å°Webé¡µé¢æ·»åŠ ï¼Œä¸€å®šè¦åœ¨åå°çš„é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ,å¸Œæœ›ä»¥åçš„ç‰ˆæœ¬ä¸­èƒ½æ”¹è¿›ä¸€ä¸‹  *</p>
</li>
<li><p>ä¿®æ”¹/usr/local/smokeping/etc/config åï¼Œå¿…é¡»é‡å¯smokeping ç¨‹åºï¼Œé…ç½®æ‰ä¼šç”Ÿæ•ˆ  *  </p>
</li>
<li><p>smokeping ä¼šæ ¹æ®é…ç½®æ–‡ä»¶config åœ¨/usr/local/smokeping/data ä¹‹ä¸‹æ·»åŠ moniteræ–‡ä»¶å¤¹ï¼Œå…¶ä¸‹åŒ…å«websiteå­æ–‡ä»¶å¤¹ *</p>
</li>
<li><p>ç”¨vmware workstationçš„è™šæ‹Ÿæœºæµ‹è¯•æœ‰ä¸€ç‚¹å¥½å¤„ï¼Œworkstationä¸‹çš„è™šæ‹Ÿç½‘å¡å¯ä»¥è®¾ç½®å‡ºå…¥çš„ä¸¢åŒ…ç‡ï¼Œé€‚åˆsmokepingåšä¸¢åŒ…æµ‹è¯•, ç»è¿‡æµ‹è¯•smokepingæ£€æµ‹å‡ºçš„ä¸¢åŒ…ç‡ä¸vmware worksationè™šæ‹Ÿç½‘å¡è®¾ç½®çš„ä¸¢åŒ…ç‡åŸºæœ¬ç›¸åŒ,ä¹Ÿå°±æ˜¯è¯´smokeping èƒ½å¤Ÿååº”ç½‘ç»œçš„çœŸå®çŠ¶å†µ *<br> æ·»åŠ ç›‘æ§èŠ‚ç‚¹ç¤ºä¾‹ï¼šæ³¨æ„+æ˜¯ç¬¬ä¸€å±‚ï¼Œ++æ˜¯ç¬¬äºŒå±‚ï¼Œ+++ æ˜¯ç¬¬ä¸‰å±‚</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">+ moniter                       </div><div class="line">menu = moniter</div><div class="line">++ website</div><div class="line">menu = website</div><div class="line">title = moniter website</div><div class="line"><span class="comment">#host = /moniter/website/baidu /moniter/website/sina /moniter/website/taobao /moniter/website/QQ</span></div><div class="line"></div><div class="line">+++ baidu</div><div class="line">menu = baidu</div><div class="line">title = baidu.com</div><div class="line">alerts = someloss</div><div class="line">host = www.baidu.com</div><div class="line"></div><div class="line">+++ sina</div><div class="line">menu = sina</div><div class="line">title = sina.com.cn</div><div class="line">alerts = someloss</div><div class="line">host = www.sina.com.cn</div><div class="line"></div><div class="line">+++ taobao</div><div class="line">menu = taobao</div><div class="line">title = taobao.com</div><div class="line">alerts = someloss</div><div class="line">host = www.taobao.com</div><div class="line"></div><div class="line">+++ QQ</div><div class="line">menu = QQ</div><div class="line">title = QQ</div><div class="line">alerts = someloss</div><div class="line">host = www.qq.com.cn</div><div class="line"></div><div class="line">+++ sohu</div><div class="line">menu = sohu</div><div class="line">title = sohu</div><div class="line">alerts = someloss</div><div class="line">host = www.sohu.com</div></pre></td></tr></table></figure>
<p>æ•ˆæœå›¾ï¼šå½“å‰èœå•ä¸‹ä¸»æœºå»¶æ—¶ï¼Œä¸¢åŒ…å›¾</p>
<p>æ•ˆæœå›¾ï¼šå½“å‰èœå•ä¸‹æŸä¸»æœºå»¶æ—¶ï¼Œä¸¢åŒ…è¯¦ç»†å›¾</p>
<p>13.å›¾ä¾‹è¯´æ˜</p>
<p>ç»¿å—è¡¨ç¤ºä¸ä¸¢åŒ…ï¼Œå…¶ä»–é¢œè‰²çš„å—è¡¨ç¤ºä¸åŒç¨‹åºçš„ä¸¢åŒ…ã€‚<br>å›¾å½¢è¶Šå¹³ç¨³ï¼Œè¡¨ç¤ºç½‘ç»œè¶Šç¨³å®šï¼Œå¦‚æœå›¾å½¢å³°å€¼å’Œä½è°·å¾ˆå¤šï¼Œåˆ™è¡¨ç¤ºç½‘ç»œæ—¶å»¶ä¸ç¨³å®šï¼Œå¿½é«˜å¿½ä½ã€‚</p>
<p>è¿™é‡Œapache å¦‚æœè¦ä½ åšä¸ªURLçš„æ–‡ä»¶ä¸‹è½½æµ‹è¯• </p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dd <span class="keyword">if</span>=<span class="regexp">/dev/</span><span class="keyword">null</span> bs=<span class="number">1</span>M <span class="keyword">count</span>=<span class="number">1</span> of=<span class="regexp">/var/</span>www<span class="regexp">/html/i</span>ndex.html</div></pre></td></tr></table></figure>

	

	

</article>






	<span class="different-posts">ğŸ“• end of posts ğŸ“•</span>


	</main>

	<footer class="footer">
	<div class="footer-content">
		
	      <div class="footer__element">
	<h5>Hi there,</h5>
	<p style="text-align:justify;">my name is Yancy, they know me as RadiantğŸ‘ğŸ‘. This blog is about Bi-data and my live.<br> I like ğŸŒ³ğŸŒ³ğŸŒ³</p>
</div>


	    
	      <div class="footer__element">
	<h5>Check out</h5>
	<ul class="footer-links">
		<li class="footer-links__link"><a href="/archives">Archive</a></li>
		
		  <li class="footer-links__link"><a href="/atom.xml">RSS</a></li>
	    
		<li class="footer-links__link"><a href="/about">about page</a></li>
		<li class="footer-links__link"><a href="/tags">Tags</a></li>
		<li class="footer-links__link"><a href="/categories">Categories</a></li>
	</ul>
</div>

	    

		<div class="footer-credit">
			<span>Â© 2018 Yancy | Powered by <a href="http://blog.yancy.cc/">Yancy</a> | Theme <a href="https://github.com/yangcvo">Yancy_GitHub</a></span>
		</div>

	</div>


</footer>



</body>

</html>
