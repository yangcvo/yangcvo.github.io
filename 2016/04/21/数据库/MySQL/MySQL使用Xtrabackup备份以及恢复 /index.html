<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Personal blog, thinking and sharing of technology and life">
    <meta name="keyword"  content="undefined">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
          【第九章】MySQL使用Xtrabackup备份以及恢复 - Yancy&#39;s blog
        
    </title>

    <link rel="canonical" href="http://blog.yancy.cc/2016/04/21/数据库/MySQL/MySQL使用Xtrabackup备份以及恢复 /">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/hux-blog.min.css">

    <!-- Pygments Highlight CSS -->
    <link rel="stylesheet" href="/css/highlight.css">

    <!-- Custom Fonts -->
    <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- Hux Delete, sad but pending in China
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    -->


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Jolly-Yancy&#39;s blog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>

                    

                        
                    

                        
                        <li>
                            <a href="/about/About-me.html">About</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/archives/archives.html">Archives</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/tags/">Tags</a>
                        </li>
                        
                    
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Main Content -->
    
<!-- Image to hack wechat -->
<!-- <img src="http://blog.yancy.cc/img/icon_wechat.png" width="0" height="0"> -->
<!-- <img src="{{ site.baseurl }}/{% if page.header-img %}{{ page.header-img }}{% else %}{{ site.header-img }}{% endif %}" width="0" height="0"> -->

<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        background-image: url('/img/home-bg.jpg')
    }
</style>
<header class="intro-header" >
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                          <a class="tag" href="/tags/#MySQL.Database" title="MySQL.Database">MySQL.Database</a>
                        
                    </div>
                    <h1>【第九章】MySQL使用Xtrabackup备份以及恢复</h1>
                    <h2 class="subheading"></h2>
                    <span class="meta">
                        Posted by Yancy on
                        2016-04-21
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

    <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <h1 id="MySQL使用Xtrabackup备份以及恢复"><a href="#MySQL使用Xtrabackup备份以及恢复" class="headerlink" title="MySQL使用Xtrabackup备份以及恢复"></a>MySQL使用Xtrabackup备份以及恢复</h1><p>Xtrabackup是一个对InnoDB做数据备份的工具，支持在线热备份（备份时不影响数据读写），是商业备份工具InnoDB Hotbackup的一个很好的替代品。</p>
<p><a href="https：//www.percona.com/downloads/XtraBackup/">xtrabackup官方网址</a></p>
<h5 id="xtrabackup安装方法"><a href="#xtrabackup安装方法" class="headerlink" title="xtrabackup安装方法"></a>xtrabackup安装方法</h5><p>可以下载源码编译安装，也可以下载适合的RPM包或者yum进行安装。<br>1 . 安装的<code>Percona XtraBackup</code> 来自Percona的百胜库</p>
<p>安装<code>Percona XtraBackup Percona</code> yum资源库</p>
<pre><code>yum install -y http://www.percona.com/downloads/percona-release/redhat/0.1-3/percona-release-0.1-3.noarch.rpm
</code></pre><h5 id="查看软件包是否存在"><a href="#查看软件包是否存在" class="headerlink" title="查看软件包是否存在"></a>查看软件包是否存在</h5><pre><code>[root@mysql ~]＃yum list | grep percona
</code></pre><h5 id="测试是否存在软件包"><a href="#测试是否存在软件包" class="headerlink" title="测试是否存在软件包"></a>测试是否存在软件包</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">... ...</div><div class="line">percona-xtrabackup-20.x86_64 2.0.8-587.rhel5 percona-release-x86_64</div><div class="line">percona-xtrabackup-20-debuginfo.x86_64 2.0.8-587.rhel5 percona-release-x86_64</div><div class="line">percona-xtrabackup-20-test.x86_64 2.0.8-587.rhel5 percona-release-x86_64</div><div class="line">percona-xtrabackup-test-22.x86_64 2.2.13-1.el5 percona-release-x86_64</div><div class="line">... ...</div></pre></td></tr></table></figure>
<h5 id="安装软件包"><a href="#安装软件包" class="headerlink" title="安装软件包"></a>安装软件包</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install percona-xtrabackup-22</div></pre></td></tr></table></figure>
<h3 id="2-使用rpm包安装的Percona-XtraBackup-使用下载的rpm包安装Percona-Server"><a href="#2-使用rpm包安装的Percona-XtraBackup-使用下载的rpm包安装Percona-Server" class="headerlink" title="2 使用rpm包安装的Percona XtraBackup 使用下载的rpm包安装Percona Server"></a>2 使用rpm包安装的Percona XtraBackup 使用下载的rpm包安装Percona Server</h3><p>下载需要的版本：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wget https://www.percona.com/downloads/Percona-Server-5.7/Percona-Server-5.7.10-3/binary/redhat/7/x86_64/Percona-Server-5.7.10-3-r63dafaf-el7-x86_64-bundle.tar</div></pre></td></tr></table></figure>
<h5 id="需要解压"><a href="#需要解压" class="headerlink" title="需要解压"></a>需要解压</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">tar xvf Percona-Server-5.7.10-3-r63dafaf-el7-x86_64-bundle.tar</div><div class="line">ls *.rpm</div><div class="line"> </div><div class="line">Percona-Server-57-debuginfo-5.7.10-3.1.el7.x86_64.rpm</div><div class="line">Percona-Server-client-57-5.7.10-3.1.el7.x86_64.rpm</div><div class="line">Percona-Server-devel-57-5.7.10-3.1.el7.x86_64.rpm</div><div class="line">Percona-Server-server-57-5.7.10-3.1.el7.x86_64.rpm</div><div class="line">Percona-Server-shared-57-5.7.10-3.1.el7.x86_64.rpm</div><div class="line">Percona-Server-shared-compat-57-5.7.10-3.1.el7.x86_64.rpm</div><div class="line">Percona-Server-test-57-5.7.10-3.1.el7.x86_64.rpm</div><div class="line">Percona-Server-tokudb-57-5.7.10-3.1.el7.x86_64.rpm</div><div class="line">运行方式</div><div class="line">rpm -ivh Percona-Server-server-57-5.7.10-3.1.el7.x86_64.rpm \</div><div class="line">Percona-Server-client-57-5.7.10-3.1.el7.x86_64.rpm \</div><div class="line">Percona-Server-shared-57-5.7.10-3.1.el7.x86_64.rpm   ... ...</div></pre></td></tr></table></figure>
<p>卸载Percona XtraBackup</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum remove percona-xtrabackup</div></pre></td></tr></table></figure>
<p>官方解释每个软件包的作用：</p>
<p>每个RPM包中有什么？¶</p>
<p>每个Percona服务器的RPM包有一个特定的目的。</p>
<blockquote>
<p>Percona-Server-server-57包含了服务器本身（mysqld二进制）。<br>为服务器Percona-Server-57-debuginfo包含调试符号。<br>Percona-Server-client-57包含命令行客户端。<br>Percona-Server-devel-57包含所需的头文件编译软件使用客户端库。<br>Percona-Server-shared-57包含客户端共享库。<br>Percona-Server-shared-compat包含共享库的编辑软件旧版本的客户端库。<br>库包含在这个包：libmysqlclient.so。<br>12，libmysqlclient.so。<br>14日，libmysqlclient.so。<br>15日，libmysqlclient.so。<br>16，libmysqlclient.so.18。<br>Percona-Server-test-57包括Percona服务器的测试套件</p>
</blockquote>
<h5 id="检查安装结果："><a href="#检查安装结果：" class="headerlink" title="检查安装结果："></a>检查安装结果：</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[[root@mysql ~]<span class="comment"># rpm -qa|grep xtrabackup</span></div><div class="line">percona-xtrabackup-22-2.2.13-1.el6.x86_64</div></pre></td></tr></table></figure>
<h3 id="Xtrabackup中主要包含两个工具："><a href="#Xtrabackup中主要包含两个工具：" class="headerlink" title="Xtrabackup中主要包含两个工具："></a>Xtrabackup中主要包含两个工具：</h3><p>xtrabackup：是用于热备innodb，xtradb表中数据的工具，不能备份其他类型的表，也不能备份数据表结构;<br>innobackupex：是将xtrabackup进行封装的perl脚本，提供了备份myisam表的能力。<br>使用xtrabackup实现对MySQL的备份</p>
<p>1.完全备份</p>
<p>基本语法：<br>多实例备份：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@mysql ~]<span class="comment"># innobackupex --user=root --password=mysql4hz@2015 --socket=/var/lib/mysql/mysql.sock --defaults-file=/etc/my.cnf /tmp/</span></div></pre></td></tr></table></figure>
<p>语法解释：-user =数据库用户<br>        -password =数据库密码<br>        -socket =指定套接字<br>        -default-file =指定配置文件<br>        最后面是存放位置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div></pre></td><td class="code"><pre><div class="line">执行完上面那句：</div><div class="line">...... 省略</div><div class="line">[01]        ...done</div><div class="line">[01] Copying ./qjfsonar/dashboards.ibd to /tmp/2017-02-14_17-25-25/qjfsonar/dashboards.ibd</div><div class="line">[01]        ...done</div><div class="line">[01] Copying ./qjfsonar/ce_task_input.ibd to /tmp/2017-02-14_17-25-25/qjfsonar/ce_task_input.ibd</div><div class="line">&gt;&gt; <span class="built_in">log</span> scanned up to (161161029421)</div><div class="line">[01]        ...done</div><div class="line">[01] Copying ./qjfsonar/projects.ibd to /tmp/2017-02-14_17-25-25/qjfsonar/projects.ibd</div><div class="line">[01]        ...done</div><div class="line">[01] Copying ./qjfsonar/ce_activity.ibd to /tmp/2017-02-14_17-25-25/qjfsonar/ce_activity.ibd</div><div class="line">[01]        ...done</div><div class="line">[01] Copying ./qjfsonar/ce_scanner_context.ibd to /tmp/2017-02-14_17-25-25/qjfsonar/ce_scanner_context.ibd</div><div class="line">[01]        ...done</div><div class="line">[01] Copying ./qjfsonar/internal_properties.ibd to /tmp/2017-02-14_17-25-25/qjfsonar/internal_properties.ibd</div><div class="line">[01]        ...done</div><div class="line">[01] Copying ./qjfsonar/properties.ibd to /tmp/2017-02-14_17-25-25/qjfsonar/properties.ibd</div><div class="line">[01]        ...done</div><div class="line">&gt;&gt; <span class="built_in">log</span> scanned up to (161161040714)</div><div class="line">[01] Copying ./qjfsonar/qprofile_changes.ibd to /tmp/2017-02-14_17-25-25/qjfsonar/qprofile_changes.ibd</div><div class="line">[01]        ...done</div><div class="line">[01] Copying ./qjfsonar/rule_repositories.ibd to /tmp/2017-02-14_17-25-25/qjfsonar/rule_repositories.ibd</div><div class="line">[01]        ...done</div><div class="line">&gt;&gt; <span class="built_in">log</span> scanned up to (161161047373)</div><div class="line">[01] Copying ./yjk_bi/bi_factory_day_report.ibd to /tmp/2017-02-14_17-25-25/yjk_bi/bi_factory_day_report.ibd</div><div class="line">[01]        ...done</div><div class="line">[01] Copying ./yjk_bi/bi_order_day_report.ibd to /tmp/2017-02-14_17-25-25/yjk_bi/bi_order_day_report.ibd</div><div class="line">[01]        ...done</div><div class="line">[01] Copying ./yjk_bi/bi_qrcode_day_report.ibd to /tmp/2017-02-14_17-25-25/yjk_bi/bi_qrcode_day_report.ibd</div><div class="line">[01]        ...done</div><div class="line">[01] Copying ./yjk_bi/bi_sms_day_report.ibd to /tmp/2017-02-14_17-25-25/yjk_bi/bi_sms_day_report.ibd</div><div class="line">[01]        ...done</div><div class="line">[01] Copying ./yjk_bi/ezrpt_member_module.ibd to /tmp/2017-02-14_17-25-25/yjk_bi/ezrpt_member_module.ibd</div><div class="line">&gt;&gt; <span class="built_in">log</span> scanned up to (161161084981)</div><div class="line">[01]        ...done</div><div class="line">[01] Copying ./yjk_bi/ezrpt_member_permission.ibd to /tmp/2017-02-14_17-25-25/yjk_bi/ezrpt_member_permission.ibd</div><div class="line">[01]        ...done</div><div class="line">&gt;&gt; <span class="built_in">log</span> scanned up to (161161108056)</div><div class="line">[01] Copying ./yjk_bi/ezrpt_member_role.ibd to /tmp/2017-02-14_17-25-25/yjk_bi/ezrpt_member_role.ibd</div><div class="line">[01]        ...done</div><div class="line">[01] Copying ./yjk_bi/ezrpt_member_user.ibd to /tmp/2017-02-14_17-25-25/yjk_bi/ezrpt_member_user.ibd</div><div class="line">[01]        ...done</div><div class="line">[01] Copying ./yjk_bi/ezrpt_meta_category.ibd to /tmp/2017-02-14_17-25-25/yjk_bi/ezrpt_meta_category.ibd</div><div class="line">[01]        ...done</div><div class="line">[01] Copying ./yjk_bi/ezrpt_meta_conf.ibd to /tmp/2017-02-14_17-25-25/yjk_bi/ezrpt_meta_conf.ibd</div><div class="line">[01]        ...done</div><div class="line">[01] Copying ./yjk_bi/ezrpt_meta_datasource.ibd to /tmp/2017-02-14_17-25-25/yjk_bi/ezrpt_meta_datasource.ibd</div><div class="line">[01]        ...done</div><div class="line">[01] Copying ./yjk_bi/ezrpt_meta_report.ibd to /tmp/2017-02-14_17-25-25/yjk_bi/ezrpt_meta_report.ibd</div><div class="line">[01]        ...done</div><div class="line">[01] Copying ./yjk_bi/ezrpt_meta_report_history.ibd to /tmp/2017-02-14_17-25-25/yjk_bi/ezrpt_meta_report_history.ibd</div><div class="line">&gt;&gt; <span class="built_in">log</span> scanned up to (161161137440)</div><div class="line">[01]        ...done</div><div class="line">[01] Copying ./yjk_bi/ezrpt_schedule_task.ibd to /tmp/2017-02-14_17-25-25/yjk_bi/ezrpt_schedule_task.ibd</div><div class="line">[01]        ...done</div><div class="line">[01] Copying ./yjk_bi/ezrpt_sys_conf.ibd to /tmp/2017-02-14_17-25-25/yjk_bi/ezrpt_sys_conf.ibd</div><div class="line">[01]        ...done</div><div class="line">[01] Copying ./yjk_bi/ezrpt_sys_event.ibd to /tmp/2017-02-14_17-25-25/yjk_bi/ezrpt_sys_event.ibd</div><div class="line">&gt;&gt; <span class="built_in">log</span> scanned up to (161161163627)</div><div class="line">[01]        ...done</div><div class="line">[01] Copying ./yjk_bi/bi_custom_package_day_report.ibd to /tmp/2017-02-14_17-25-25/yjk_bi/bi_custom_package_day_report.ibd</div><div class="line">[01]        ...done</div><div class="line">[01] Copying ./yjk_bi/bi_custom_package_days.ibd to /tmp/2017-02-14_17-25-25/yjk_bi/bi_custom_package_days.ibd</div><div class="line">[01]        ...done</div><div class="line">[01] Copying ./yjk_bi/bi_consult_months.ibd to /tmp/2017-02-14_17-25-25/yjk_bi/bi_consult_months.ibd</div><div class="line">[01]        ...done</div><div class="line">[01] Copying ./yjk_bi/bi_consult_month_report.ibd to /tmp/2017-02-14_17-25-25/yjk_bi/bi_consult_month_report.ibd</div><div class="line">[01]        ...done</div><div class="line">[01] Copying ./yjk_bi/bi_task_days.ibd to /tmp/2017-02-14_17-25-25/yjk_bi/bi_task_days.ibd</div><div class="line">[01]        ...done</div><div class="line">[01] Copying ./yjk_bi/bi_task_day_report.ibd to /tmp/2017-02-14_17-25-25/yjk_bi/bi_task_day_report.ibd</div><div class="line">[01]        ...done</div><div class="line">[01] Copying ./yjk_bi/bi_goods_order_mall_days.ibd to /tmp/2017-02-14_17-25-25/yjk_bi/bi_goods_order_mall_days.ibd</div><div class="line">&gt;&gt; <span class="built_in">log</span> scanned up to (161161183076)</div><div class="line">[01]        ...done</div><div class="line">[01] Copying ./yjk_bi/bi_goods_order_day_report.ibd to /tmp/2017-02-14_17-25-25/yjk_bi/bi_goods_order_day_report.ibd</div><div class="line">[01]        ...done</div><div class="line">[01] Copying ./yjk_bi/bi_goods_order_ec_days.ibd to /tmp/2017-02-14_17-25-25/yjk_bi/bi_goods_order_ec_days.ibd</div><div class="line">[01]        ...done</div><div class="line">[01] Copying ./yjk_bi/bi_order_days.ibd to /tmp/2017-02-14_17-25-25/yjk_bi/bi_order_days.ibd</div><div class="line">[01]        ...done</div><div class="line">[01] Copying ./yjk_bi/bi_qrcode_days.ibd to /tmp/2017-02-14_17-25-25/yjk_bi/bi_qrcode_days.ibd</div><div class="line">[01]        ...done</div><div class="line">&gt;&gt; <span class="built_in">log</span> scanned up to (161161204179)</div><div class="line">xtrabackup: Creating <span class="built_in">suspend</span> file <span class="string">'/tmp/2017-02-14_17-25-25/xtrabackup_suspended_2'</span> with pid <span class="string">'20299'</span></div><div class="line">&gt;&gt; <span class="built_in">log</span> scanned up to (161161243249)</div><div class="line"></div><div class="line">170214 17:42:08  innobackupex: Continuing after ibbackup has suspended</div><div class="line">170214 17:42:08  innobackupex: Executing FLUSH NO_WRITE_TO_BINLOG TABLES...</div><div class="line">170214 17:42:08  innobackupex: Executing FLUSH TABLES WITH READ LOCK...</div><div class="line">170214 17:42:08  innobackupex: All tables locked and flushed to disk</div><div class="line"></div><div class="line">170214 17:42:08  innobackupex: Starting to backup non-InnoDB tables and files</div><div class="line">innobackupex: <span class="keyword">in</span> subdirectories of <span class="string">'/opt/mysql/data/'</span></div><div class="line">innobackupex: Backing up files <span class="string">'/opt/mysql/data//mysql/*.&#123;frm,isl,MYD,MYI,MAD,MAI,MRG,TRG,TRN,ARM,ARZ,CSM,CSV,opt,par&#125;'</span> (74 files)</div><div class="line">&gt;&gt; <span class="built_in">log</span> scanned up to (161161257731)</div><div class="line">innobackupex: Backing up files <span class="string">'/opt/mysql/data//performance_schema/*.&#123;frm,isl,MYD,MYI,MAD,MAI,MRG,TRG,TRN,ARM,ARZ,CSM,CSV,opt,par&#125;'</span> (53 files)</div><div class="line">innobackupex: Backing up file <span class="string">'/opt/mysql/data//wikidb/db.opt'</span></div><div class="line">innobackupex: Backing up files <span class="string">'/opt/mysql/data//zabbix/*.&#123;frm,isl,MYD,MYI,MAD,MAI,MRG,TRG,TRN,ARM,ARZ,CSM,CSV,opt,par&#125;'</span> (105 files)</div><div class="line">&gt;&gt; <span class="built_in">log</span> scanned up to (161161257731)</div><div class="line">innobackupex: Backing up files <span class="string">'/opt/mysql/data//yjk_big/*.&#123;frm,isl,MYD,MYI,MAD,MAI,MRG,TRG,TRN,ARM,ARZ,CSM,CSV,opt,par&#125;'</span> (15 files)</div><div class="line">innobackupex: Backing up files <span class="string">'/opt/mysql/data//yjk_event/*.&#123;frm,isl,MYD,MYI,MAD,MAI,MRG,TRG,TRN,ARM,ARZ,CSM,CSV,opt,par&#125;'</span> (18 files)</div><div class="line">innobackupex: Backing up file <span class="string">'/opt/mysql/data//hongbao/db.opt'</span></div><div class="line">innobackupex: Backing up files <span class="string">'/opt/mysql/data//rap/*.&#123;frm,isl,MYD,MYI,MAD,MAI,MRG,TRG,TRN,ARM,ARZ,CSM,CSV,opt,par&#125;'</span> (24 files)</div><div class="line">innobackupex: Backing up files <span class="string">'/opt/mysql/data//raptest/*.&#123;frm,isl,MYD,MYI,MAD,MAI,MRG,TRG,TRN,ARM,ARZ,CSM,CSV,opt,par&#125;'</span> (24 files)</div><div class="line">&gt;&gt; <span class="built_in">log</span> scanned up to (161161257731)</div><div class="line">innobackupex: Backing up files <span class="string">'/opt/mysql/data//yjk_test/*.&#123;frm,isl,MYD,MYI,MAD,MAI,MRG,TRG,TRN,ARM,ARZ,CSM,CSV,opt,par&#125;'</span> (78 files)</div><div class="line">innobackupex: Backing up file <span class="string">'/opt/mysql/data//yjk_event1/db.opt'</span></div><div class="line">innobackupex: Backing up file <span class="string">'/opt/mysql/data//yjk_event1/coupon.frm'</span></div><div class="line">&gt;&gt; <span class="built_in">log</span> scanned up to (161161257731)</div><div class="line">innobackupex: Backing up file <span class="string">'/opt/mysql/data//yjk_event1/coupon_use.frm'</span></div><div class="line">innobackupex: Backing up file <span class="string">'/opt/mysql/data//yjk_event1/qrcode.frm'</span></div><div class="line">innobackupex: Backing up file <span class="string">'/opt/mysql/data//yjk_event1/qrcode_scan_count.frm'</span></div><div class="line">innobackupex: Backing up files <span class="string">'/opt/mysql/data//yjk/*.&#123;frm,isl,MYD,MYI,MAD,MAI,MRG,TRG,TRN,ARM,ARZ,CSM,CSV,opt,par&#125;'</span> (152 files)</div><div class="line">&gt;&gt; <span class="built_in">log</span> scanned up to (161161257731)</div><div class="line">innobackupex: Backing up file <span class="string">'/opt/mysql/data//yjk_sec/db.opt'</span></div><div class="line">innobackupex: Backing up files <span class="string">'/opt/mysql/data//grafana/*.&#123;frm,isl,MYD,MYI,MAD,MAI,MRG,TRG,TRN,ARM,ARZ,CSM,CSV,opt,par&#125;'</span> (18 files)</div><div class="line">innobackupex: Backing up files <span class="string">'/opt/mysql/data//weixin/*.&#123;frm,isl,MYD,MYI,MAD,MAI,MRG,TRG,TRN,ARM,ARZ,CSM,CSV,opt,par&#125;'</span> (11 files)</div><div class="line">&gt;&gt; <span class="built_in">log</span> scanned up to (161161257731)</div><div class="line">innobackupex: Backing up file <span class="string">'/opt/mysql/data//clinicorder/db.opt'</span></div><div class="line">innobackupex: Backing up file <span class="string">'/opt/mysql/data//clinicorder/order_orderlist.frm'</span></div><div class="line">innobackupex: Backing up file <span class="string">'/opt/mysql/data//clinicorder/pat_patient_info.frm'</span></div><div class="line">innobackupex: Backing up files <span class="string">'/opt/mysql/data//tj_zjol/*.&#123;frm,isl,MYD,MYI,MAD,MAI,MRG,TRG,TRN,ARM,ARZ,CSM,CSV,opt,par&#125;'</span> (226 files)</div><div class="line">&gt;&gt; <span class="built_in">log</span> scanned up to (161161257731)</div><div class="line">&gt;&gt; <span class="built_in">log</span> scanned up to (161161257731)</div><div class="line">&gt;&gt; <span class="built_in">log</span> scanned up to (161161257731)</div><div class="line">innobackupex: Backing up files <span class="string">'/opt/mysql/data//tpshop/*.&#123;frm,isl,MYD,MYI,MAD,MAI,MRG,TRG,TRN,ARM,ARZ,CSM,CSV,opt,par&#125;'</span> (68 files)</div><div class="line">&gt;&gt; <span class="built_in">log</span> scanned up to (161161257731)</div><div class="line">&gt;&gt; <span class="built_in">log</span> scanned up to (161161257731)</div><div class="line">innobackupex: Backing up files <span class="string">'/opt/mysql/data//yjk_mall_2_0/*.&#123;frm,isl,MYD,MYI,MAD,MAI,MRG,TRG,TRN,ARM,ARZ,CSM,CSV,opt,par&#125;'</span> (25 files)</div><div class="line">innobackupex: Backing up file <span class="string">'/opt/mysql/data//test/db.opt'</span></div><div class="line">innobackupex: Backing up file <span class="string">'/opt/mysql/data//test/user.frm'</span></div><div class="line">innobackupex: Backing up file <span class="string">'/opt/mysql/data//test/dubbo_invoke.frm'</span></div><div class="line">innobackupex: Backing up file <span class="string">'/opt/mysql/data//test/dubbo_invoke_copy.frm'</span></div><div class="line">innobackupex: Backing up file <span class="string">'/opt/mysql/data//dubbokeeper/db.opt'</span></div><div class="line">innobackupex: Backing up file <span class="string">'/opt/mysql/data//dubbokeeper/dubbo_invoke.frm'</span></div><div class="line">innobackupex: Backing up file <span class="string">'/opt/mysql/data//hydra/db.opt'</span></div><div class="line">innobackupex: Backing up file <span class="string">'/opt/mysql/data//hydra/tb_data_seed.frm'</span></div><div class="line">innobackupex: Backing up file <span class="string">'/opt/mysql/data//hydra/tb_para_app.frm'</span></div><div class="line">innobackupex: Backing up file <span class="string">'/opt/mysql/data//hydra/tb_para_service.frm'</span></div><div class="line">innobackupex: Backing up file <span class="string">'/opt/mysql/data//hydra/tb_para_service_id_gen.frm'</span></div><div class="line">innobackupex: Backing up file <span class="string">'/opt/mysql/data//hydra/annotation.frm'</span></div><div class="line">innobackupex: Backing up file <span class="string">'/opt/mysql/data//hydra/span.frm'</span></div><div class="line">innobackupex: Backing up file <span class="string">'/opt/mysql/data//hydra/trace.frm'</span></div><div class="line">innobackupex: Backing up files <span class="string">'/opt/mysql/data//qjfsonar/*.&#123;frm,isl,MYD,MYI,MAD,MAI,MRG,TRG,TRN,ARM,ARZ,CSM,CSV,opt,par&#125;'</span> (51 files)</div><div class="line">innobackupex: Backing up files <span class="string">'/opt/mysql/data//yjk_bi/*.&#123;frm,isl,MYD,MYI,MAD,MAI,MRG,TRG,TRN,ARM,ARZ,CSM,CSV,opt,par&#125;'</span> (29 files)</div><div class="line">170214 17:42:19  innobackupex: Finished backing up non-InnoDB tables and files</div><div class="line"></div><div class="line">170214 17:42:19  innobackupex: Executing FLUSH NO_WRITE_TO_BINLOG ENGINE LOGS...</div><div class="line">170214 17:42:19  innobackupex: Waiting <span class="keyword">for</span> <span class="built_in">log</span> copying to finish</div><div class="line"></div><div class="line">&gt;&gt; <span class="built_in">log</span> scanned up to (161161257731)</div><div class="line">xtrabackup: The latest check point (<span class="keyword">for</span> incremental): <span class="string">'161161257731'</span></div><div class="line">xtrabackup: Stopping <span class="built_in">log</span> copying thread.</div><div class="line">.&gt;&gt; <span class="built_in">log</span> scanned up to (161161257731)</div><div class="line"></div><div class="line">xtrabackup: Creating <span class="built_in">suspend</span> file <span class="string">'/tmp/2017-02-14_17-25-25/xtrabackup_log_copied'</span> with pid <span class="string">'20299'</span></div><div class="line">xtrabackup: Transaction <span class="built_in">log</span> of lsn (161147778704) to (161161257731) was copied.</div><div class="line">170214 17:42:20  innobackupex: All tables unlocked</div><div class="line"></div><div class="line">innobackupex: Backup created <span class="keyword">in</span> directory <span class="string">'/tmp/2017-02-14_17-25-25'</span></div><div class="line">innobackupex: MySQL binlog position: filename <span class="string">'mysql-bin.000064'</span>, position 533794056</div><div class="line">170214 17:42:20  innobackupex: Connection to database server closed</div><div class="line">170214 17:42:20  innobackupex: completed OK!</div></pre></td></tr></table></figure>
<p>如果有错误提示：<br>如果执行该命令出现如下错误：</p>
<pre><code>Can&apos;t load &apos;/usr/local/lib64/perl5/auto/DBD/mysql/mysql.so&apos; for module DBD::mysql: libmysqlclient.so.18: 无法打开共享对象 at /usr/bin/innobackupex line 18
</code></pre><p>需要拷贝libmysqlclient.so.18至/ usr / lib64：</p>
<pre><code>[root@mysql ~]# cp /var/lib/mysql/lib/libmysqlclient.so.18 /usr/lib64/
</code></pre><p>备份后的文件：</p>
<p>在备份的同时，备份数据会在备份目录下创建一个以当前时间为名字的目录存放备份文件：</p>
<p><img src="media/14870659534295.jpg" alt=""></p>
<p>各文件说明：</p>
<p>（1）xtrabackup_checkpoints - 备份类型（如完全或增量），备份状态（如是否已经没准备状态）和LSN（日志序列号）范围信息.<br>每个InnoDB页面（通常大小为16K）都包含一个日志序列号，即LSN，LSN是整个数据库系统的系统版本号，每个页面相关的LSN能够表名此页面最近是如何发生改变的。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">backup_type =完全备份</div><div class="line">from_lsn = 0</div><div class="line">to_lsn = 2097320</div><div class="line">last_lsn = 2097320</div><div class="line">compact = 0</div></pre></td></tr></table></figure>
<p>（2）<code>xtrabackup_binlog_info --mysql</code>服务器当前正在使用的二进制日志及备份这一刻为二进制日志事件的位置<br>（3）<code>xtrabackup_pos_innodb</code> - 二进制日志及用于InnoDB或XtraDB表的二进制日志的当前posistion。<br>（4）<code>xtrabackup_binary</code> - 备份中用到的xtrabackup的可执行文件<br>（5）<code>backup-my.cnf</code> - 备份命令用到的配置选项信息;<br>在使用innobackupex命令备份时吗还可以使用-no-timestamp选项来阻止命令自动创建一个以时间命名的目录<br><code>innobackupex</code>命令将会创建一个BACKUP-DIR目录来存储备份数据</p>
<blockquote>
<p>还需要注意，备份数据库的用户需要具有相对应的权限，如果要使用一个最小权限的用户进行备份可以使用以下</p>
</blockquote>
<p>参数：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mysql&gt; GRANT RELOAD, LOCK TABLES, REPLICATION CLIENT ON *.* TO ‘bkpuser’@’localhost’;       </div><div class="line">mysql&gt; FLUSH PRIVILEGES;</div></pre></td></tr></table></figure>
<p>2.准备（prepare）一个完整备份.</p>
<p>一般情况下，在备份完成后，数据尚且不能用于恢复操作，因为备份的数据中可能包含尚未提交的事务或已提交但尚未同步至数据文件中的事务，因此，此时数据文件仍处理不准致状态。“准备”的主要作用是通过回滚未提交的事务及同步已经提交的事务至数据文件也使得数据文件处于一致性状态。<br>innobackupex命令的-apply-log选项可用于实现上述功能。</p>
<pre><code>[root@mysql ~]#＃innobackupex -apply-log / tmp /2017-02-14_17-25-25 /
</code></pre><p>如果执行正确，会输出以下内容：不提示错误即可</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mysql&gt; GRANT RELOAD, LOCK TABLES, REPLICATION CLIENT ON *.* TO ‘bkpuser’@’localhost’;       </div><div class="line">mysql&gt; FLUSH PRIVILEGES;</div></pre></td></tr></table></figure>
<h3 id="2-准备（prepare）一个完整备份"><a href="#2-准备（prepare）一个完整备份" class="headerlink" title="2.准备（prepare）一个完整备份"></a>2.准备（prepare）一个完整备份</h3><p>一般情况下，在备份完成后，数据尚且不能用于恢复操作，因为备份的数据中可能包含尚未提交的事务或已提交但尚未同步至数据文件中的事务，因此，此时数据文件仍处理不准致状态。“准备”的主要作用是通过回滚未提交的事务及同步已经提交的事务至数据文件也使得数据文件处于一致性状态。<br><code>innobackupex</code>命令的<code>-apply-log</code>选项可用于实现上述功能。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root @ db02 /]＃innobackupex -apply-log / tmp / 2016-07-03_21-07-38 /</div></pre></td></tr></table></figure>
<p>如果执行正确，会输出以下内容：不提示错误即可</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div></pre></td><td class="code"><pre><div class="line">InnoDB Backup Utility v1.5.1-xtrabackup; Copyright 2003, 2009 Innobase Oy</div><div class="line">and Percona LLC and/or its affiliates 2009-2013.  All Rights Reserved.</div><div class="line">This software is published under</div><div class="line">the GNU GENERAL PUBLIC LICENSE Version 2, June 1991.</div><div class="line">Get the latest version of Percona XtraBackup, documentation, and <span class="built_in">help</span> resources:</div><div class="line">http://www.percona.com/xb/p</div><div class="line">160703 21:43:08  innobackupex: Starting the apply-log operation</div><div class="line">IMPORTANT: Please check that the apply-log run completes successfully.</div><div class="line">           At the end of a successful apply-log run innobackupex</div><div class="line">           prints <span class="string">"completed OK!"</span>.</div><div class="line">160703 21:43:08  innobackupex: Starting ibbackup with <span class="built_in">command</span>: xtrabackup  --defaults-file=<span class="string">"/tmp/2016-07-03_21-07-38/backup-my.cnf"</span>  --defaults-group=<span class="string">"mysqld"</span> --prepare --target-dir=/tmp/2016-07-03_21-07-38</div><div class="line">xtrabackup version 2.2.13 based on MySQL server 5.6.24 Linux (x86_64) (revision id: 70f4be3)</div><div class="line">xtrabackup: <span class="built_in">cd</span> to /tmp/2016-07-03_21-07-38</div><div class="line">xtrabackup: This target seems to be not prepared yet.</div><div class="line">xtrabackup: xtrabackup_logfile detected: size=2097152, start_lsn=(2097320)</div><div class="line">xtrabackup: using the following InnoDB configuration <span class="keyword">for</span> recovery:</div><div class="line">xtrabackup:   innodb_data_home_dir = ./</div><div class="line">xtrabackup:   innodb_data_file_path = ibdata1:128M:autoextend</div><div class="line">xtrabackup:   innodb_log_group_home_dir = ./</div><div class="line">xtrabackup:   innodb_log_files_in_group = 1</div><div class="line">xtrabackup:   innodb_log_file_size = 2097152</div><div class="line">xtrabackup: using the following InnoDB configuration <span class="keyword">for</span> recovery:</div><div class="line">xtrabackup:   innodb_data_home_dir = ./</div><div class="line">xtrabackup:   innodb_data_file_path = ibdata1:128M:autoextend</div><div class="line">xtrabackup:   innodb_log_group_home_dir = ./</div><div class="line">xtrabackup:   innodb_log_files_in_group = 1</div><div class="line">xtrabackup:   innodb_log_file_size = 2097152</div><div class="line">xtrabackup: Starting InnoDB instance <span class="keyword">for</span> recovery.</div><div class="line">xtrabackup: Using 104857600 bytes <span class="keyword">for</span> buffer pool (<span class="built_in">set</span> by --use-memory parameter)</div><div class="line">InnoDB: Using atomics to ref count buffer pool pages</div><div class="line">InnoDB: The InnoDB memory heap is disabled</div><div class="line">InnoDB: Mutexes and rw_locks use GCC atomic builtins</div><div class="line">InnoDB: Memory barrier is not used</div><div class="line">InnoDB: Compressed tables use zlib 1.2.3</div><div class="line">InnoDB: Using CPU crc32 instructions</div><div class="line">InnoDB: Initializing buffer pool, size = 100.0M</div><div class="line">InnoDB: Completed initialization of buffer pool</div><div class="line">InnoDB: Highest supported file format is Barracuda.</div><div class="line">InnoDB: The <span class="built_in">log</span> sequence numbers 2085708 and 2085708 <span class="keyword">in</span> ibdata files <span class="keyword">do</span> not match the <span class="built_in">log</span> sequence number 2097320 <span class="keyword">in</span> the ib_logfiles!</div><div class="line">InnoDB: Database was not shutdown normally!</div><div class="line">InnoDB: Starting crash recovery.</div><div class="line">InnoDB: Reading tablespace information from the .ibd files...</div><div class="line">InnoDB: Restoring possible half-written data pages </div><div class="line">InnoDB: from the doublewrite buffer...</div><div class="line">InnoDB: Last MySQL binlog file position 0 9706, file name /data/3306/mysql-bin.000025</div><div class="line">InnoDB: 128 rollback segment(s) are active.</div><div class="line">InnoDB: Waiting <span class="keyword">for</span> purge to start</div><div class="line">InnoDB: 5.6.24 started; <span class="built_in">log</span> sequence number 2097320</div><div class="line">[notice (again)]</div><div class="line">  If you use binary <span class="built_in">log</span> and don<span class="string">'t use any hack of group commit,</span></div><div class="line">  the binary log position seems to be:</div><div class="line">InnoDB: Last MySQL binlog file position 0 9706, file name /data/3306/mysql-bin.000025</div><div class="line">xtrabackup: starting shutdown with innodb_fast_shutdown = 1</div><div class="line">InnoDB: FTS optimize thread exiting.</div><div class="line">InnoDB: Starting shutdown...</div><div class="line">InnoDB: Shutdown completed; log sequence number 2098397</div><div class="line">160703 21:43:11  innobackupex: Restarting xtrabackup with command: xtrabackup  --defaults-file="/tmp/2016-07-03_21-07-38/backup-my.cnf"  --defaults-group="mysqld" --prepare --target-dir=/tmp/2016-07-03_21-07-38</div><div class="line">for creating ib_logfile*</div><div class="line">xtrabackup version 2.2.13 based on MySQL server 5.6.24 Linux (x86_64) (revision id: 70f4be3)</div><div class="line">xtrabackup: cd to /tmp/2016-07-03_21-07-38</div><div class="line">xtrabackup: This target seems to be already prepared.</div><div class="line">xtrabackup: notice: xtrabackup_logfile was already used to '--prepare<span class="string">'.</span></div><div class="line">xtrabackup: using the following InnoDB configuration for recovery:</div><div class="line">xtrabackup:   innodb_data_home_dir = ./</div><div class="line">xtrabackup:   innodb_data_file_path = ibdata1:128M:autoextend</div><div class="line">xtrabackup:   innodb_log_group_home_dir = ./</div><div class="line">xtrabackup:   innodb_log_files_in_group = 3</div><div class="line">xtrabackup:   innodb_log_file_size = 4194304</div><div class="line">xtrabackup: using the following InnoDB configuration for recovery:</div><div class="line">xtrabackup:   innodb_data_home_dir = ./</div><div class="line">xtrabackup:   innodb_data_file_path = ibdata1:128M:autoextend</div><div class="line">xtrabackup:   innodb_log_group_home_dir = ./</div><div class="line">xtrabackup:   innodb_log_files_in_group = 3</div><div class="line">xtrabackup:   innodb_log_file_size = 4194304</div><div class="line">xtrabackup: Starting InnoDB instance for recovery.</div><div class="line">xtrabackup: Using 104857600 bytes for buffer pool (set by --use-memory parameter)</div><div class="line">InnoDB: Using atomics to ref count buffer pool pages</div><div class="line">InnoDB: The InnoDB memory heap is disabled</div><div class="line">InnoDB: Mutexes and rw_locks use GCC atomic builtins</div><div class="line">InnoDB: Memory barrier is not used</div><div class="line">InnoDB: Compressed tables use zlib 1.2.3</div><div class="line">InnoDB: Using CPU crc32 instructions</div><div class="line">InnoDB: Initializing buffer pool, size = 100.0M</div><div class="line">InnoDB: Completed initialization of buffer pool</div><div class="line">InnoDB: Setting log file ./ib_logfile101 size to 4 MB</div><div class="line">InnoDB: Setting log file ./ib_logfile1 size to 4 MB</div><div class="line">InnoDB: Setting log file ./ib_logfile2 size to 4 MB</div><div class="line">InnoDB: Renaming log file ./ib_logfile101 to ./ib_logfile0</div><div class="line">InnoDB: New log files created, LSN=2098397</div><div class="line">InnoDB: Highest supported file format is Barracuda.</div><div class="line">InnoDB: 128 rollback segment(s) are active.</div><div class="line">InnoDB: Waiting for purge to start</div><div class="line">InnoDB: 5.6.24 started; log sequence number 2098700</div><div class="line">[notice (again)]</div><div class="line">  If you use binary log and don't use any hack of group commit,</div><div class="line">  the binary <span class="built_in">log</span> position seems to be:</div><div class="line">InnoDB: Last MySQL binlog file position 0 9706, file name /data/3306/mysql-bin.000025</div><div class="line">xtrabackup: starting shutdown with innodb_fast_shutdown = 1</div><div class="line">InnoDB: FTS optimize thread exiting.</div><div class="line">InnoDB: Starting shutdown...</div><div class="line">InnoDB: Shutdown completed; <span class="built_in">log</span> sequence number 2099425</div><div class="line">160703 21:43:13  innobackupex: completed OK!</div></pre></td></tr></table></figure>
<p>查看完整备份时日志位置;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@db02 2016-07-03_21-07-38]<span class="comment"># cat xtrabackup_binlog_info </span></div><div class="line">mysql-bin.000029	107</div></pre></td></tr></table></figure>
<p>模式数据库修改</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">create table student(</div><div class="line">id int(4) not null,</div><div class="line">name char(20) not null,</div><div class="line">age tinyint(2)  NOT NULL default <span class="string">'0'</span>,</div><div class="line">dept varchar(16)  default NULL</div><div class="line">);</div><div class="line">insert into student(id,name,age) values(1,<span class="string">'good'</span>,15);</div><div class="line">insert into student(id,name,age) values(2,<span class="string">'hehe'</span>,18);</div></pre></td></tr></table></figure>
<p>模拟数据库损坏<br>进入数据库的数据目录删除所有<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@db02 data]<span class="comment"># rm -rf *</span></div><div class="line">mysql&gt;show databases;  现在已经造成了数据库文件被删除，里面的数据消失</div><div class="line">+--------------------+</div><div class="line">| Database           |</div><div class="line">+--------------------+</div><div class="line">| information_schema |</div><div class="line">+--------------------+</div><div class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</div></pre></td></tr></table></figure></p>
<p>还原完全备份<br>innobackupex命令的-copy-back选项用于执行恢复操作，其通过复制所有数据相关的文件至mysql服务器DATADIR目录中来执行恢复过程.innobackupex通过backup-my.cnf来获取DATADIR目录的相关信息<br>还原数据库语言</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root @ db02 data]＃innobackupex -user = root -password = 123456 -socket = / data / 3306 / mysql.sock -defaults-file = / data / 3306 / my.cnf -copy-back / tmp / 2016-07 -03_21-07-38 /</div></pre></td></tr></table></figure>
<p>只是在恢复的时候加入了<code>-copy-back</code><br>如果执行正确，会输出以下内容</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div></pre></td><td class="code"><pre><div class="line">InnoDB Backup Utility v1.5.1-xtrabackup; Copyright 2003, 2009 Innobase Oy</div><div class="line">and Percona LLC and/or its affiliates 2009-2013.  All Rights Reserved.</div><div class="line">This software is published under</div><div class="line">the GNU GENERAL PUBLIC LICENSE Version 2, June 1991.</div><div class="line">Get the latest version of Percona XtraBackup, documentation, and <span class="built_in">help</span> resources:</div><div class="line">http://www.percona.com/xb/p</div><div class="line">160704 00:03:33  innobackupex: Starting the copy-back operation</div><div class="line">IMPORTANT: Please check that the copy-back run completes successfully.</div><div class="line">           At the end of a successful copy-back run innobackupex</div><div class="line">           prints <span class="string">"completed OK!"</span>.</div><div class="line">innobackupex: Starting to copy files <span class="keyword">in</span> <span class="string">'/tmp/2016-07-03_21-07-38'</span></div><div class="line">innobackupex: back to original data directory <span class="string">'/data/3306/data'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/xtrabackup_info'</span> to <span class="string">'/data/3306/data/xtrabackup_info'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/xtrabackup_binlog_pos_innodb'</span> to <span class="string">'/data/3306/data/xtrabackup_binlog_pos_innodb'</span></div><div class="line">innobackupex: Creating directory <span class="string">'/data/3306/data/qqqqqqq41233'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/qqqqqqq41233/db.opt'</span> to <span class="string">'/data/3306/data/qqqqqqq41233/db.opt'</span></div><div class="line">innobackupex: Creating directory <span class="string">'/data/3306/data/dadadadadadad'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/dadadadadadad/db.opt'</span> to <span class="string">'/data/3306/data/dadadadadadad/db.opt'</span></div><div class="line">innobackupex: Creating directory <span class="string">'/data/3306/data/qqqqqqqq3'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/qqqqqqqq3/db.opt'</span> to <span class="string">'/data/3306/data/qqqqqqqq3/db.opt'</span></div><div class="line">innobackupex: Creating directory <span class="string">'/data/3306/data/qqqqqqqq'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/qqqqqqqq/db.opt'</span> to <span class="string">'/data/3306/data/qqqqqqqq/db.opt'</span></div><div class="line">innobackupex: Creating directory <span class="string">'/data/3306/data/qqqqqqq43'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/qqqqqqq43/db.opt'</span> to <span class="string">'/data/3306/data/qqqqqqq43/db.opt'</span></div><div class="line">innobackupex: Creating directory <span class="string">'/data/3306/data/oldboy_gbk'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/oldboy_gbk/db.opt'</span> to <span class="string">'/data/3306/data/oldboy_gbk/db.opt'</span></div><div class="line">innobackupex: Creating directory <span class="string">'/data/3306/data/oldboy'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/oldboy/student.frm'</span> to <span class="string">'/data/3306/data/oldboy/student.frm'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/oldboy/db.opt'</span> to <span class="string">'/data/3306/data/oldboy/db.opt'</span></div><div class="line">innobackupex: Creating directory <span class="string">'/data/3306/data/ooooooooooooooooo'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/ooooooooooooooooo/db.opt'</span> to <span class="string">'/data/3306/data/ooooooooooooooooo/db.opt'</span></div><div class="line">innobackupex: Creating directory <span class="string">'/data/3306/data/performance_schema'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/performance_schema/file_instances.frm'</span> to <span class="string">'/data/3306/data/performance_schema/file_instances.frm'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/performance_schema/setup_instruments.frm'</span> to <span class="string">'/data/3306/data/performance_schema/setup_instruments.frm'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/performance_schema/setup_consumers.frm'</span> to <span class="string">'/data/3306/data/performance_schema/setup_consumers.frm'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/performance_schema/file_summary_by_instance.frm'</span> to <span class="string">'/data/3306/data/performance_schema/file_summary_by_instance.frm'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/performance_schema/events_waits_summary_by_instance.frm'</span> to <span class="string">'/data/3306/data/performance_schema/events_waits_summary_by_instance.frm'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/performance_schema/mutex_instances.frm'</span> to <span class="string">'/data/3306/data/performance_schema/mutex_instances.frm'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/performance_schema/db.opt'</span> to <span class="string">'/data/3306/data/performance_schema/db.opt'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/performance_schema/performance_timers.frm'</span> to <span class="string">'/data/3306/data/performance_schema/performance_timers.frm'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/performance_schema/cond_instances.frm'</span> to <span class="string">'/data/3306/data/performance_schema/cond_instances.frm'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/performance_schema/setup_timers.frm'</span> to <span class="string">'/data/3306/data/performance_schema/setup_timers.frm'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/performance_schema/events_waits_current.frm'</span> to <span class="string">'/data/3306/data/performance_schema/events_waits_current.frm'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/performance_schema/file_summary_by_event_name.frm'</span> to <span class="string">'/data/3306/data/performance_schema/file_summary_by_event_name.frm'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/performance_schema/events_waits_history.frm'</span> to <span class="string">'/data/3306/data/performance_schema/events_waits_history.frm'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/performance_schema/events_waits_summary_by_thread_by_event_name.frm'</span> to <span class="string">'/data/3306/data/performance_schema/events_waits_summary_by_thread_by_event_name.frm'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/performance_schema/events_waits_history_long.frm'</span> to <span class="string">'/data/3306/data/performance_schema/events_waits_history_long.frm'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/performance_schema/events_waits_summary_global_by_event_name.frm'</span> to <span class="string">'/data/3306/data/performance_schema/events_waits_summary_global_by_event_name.frm'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/performance_schema/rwlock_instances.frm'</span> to <span class="string">'/data/3306/data/performance_schema/rwlock_instances.frm'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/performance_schema/threads.frm'</span> to <span class="string">'/data/3306/data/performance_schema/threads.frm'</span></div><div class="line">innobackupex: Creating directory <span class="string">'/data/3306/data/qqqqqqqq1'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/qqqqqqqq1/db.opt'</span> to <span class="string">'/data/3306/data/qqqqqqqq1/db.opt'</span></div><div class="line">innobackupex: Creating directory <span class="string">'/data/3306/data/wordpress'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/wordpress/db.opt'</span> to <span class="string">'/data/3306/data/wordpress/db.opt'</span></div><div class="line">innobackupex: Creating directory <span class="string">'/data/3306/data/aaa'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/aaa/db.opt'</span> to <span class="string">'/data/3306/data/aaa/db.opt'</span></div><div class="line">innobackupex: Creating directory <span class="string">'/data/3306/data/mysql'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/help_keyword.MYD'</span> to <span class="string">'/data/3306/data/mysql/help_keyword.MYD'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/general_log.CSV'</span> to <span class="string">'/data/3306/data/mysql/general_log.CSV'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/help_keyword.MYI'</span> to <span class="string">'/data/3306/data/mysql/help_keyword.MYI'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/help_topic.frm'</span> to <span class="string">'/data/3306/data/mysql/help_topic.frm'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/procs_priv.MYD'</span> to <span class="string">'/data/3306/data/mysql/procs_priv.MYD'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/servers.frm'</span> to <span class="string">'/data/3306/data/mysql/servers.frm'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/time_zone_transition_type.MYI'</span> to <span class="string">'/data/3306/data/mysql/time_zone_transition_type.MYI'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/time_zone.frm'</span> to <span class="string">'/data/3306/data/mysql/time_zone.frm'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/event.MYI'</span> to <span class="string">'/data/3306/data/mysql/event.MYI'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/db.frm'</span> to <span class="string">'/data/3306/data/mysql/db.frm'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/ndb_binlog_index.MYD'</span> to <span class="string">'/data/3306/data/mysql/ndb_binlog_index.MYD'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/proc.MYD'</span> to <span class="string">'/data/3306/data/mysql/proc.MYD'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/tables_priv.MYD'</span> to <span class="string">'/data/3306/data/mysql/tables_priv.MYD'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/user.MYD'</span> to <span class="string">'/data/3306/data/mysql/user.MYD'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/time_zone_name.MYI'</span> to <span class="string">'/data/3306/data/mysql/time_zone_name.MYI'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/general_log.CSM'</span> to <span class="string">'/data/3306/data/mysql/general_log.CSM'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/event.frm'</span> to <span class="string">'/data/3306/data/mysql/event.frm'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/help_topic.MYD'</span> to <span class="string">'/data/3306/data/mysql/help_topic.MYD'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/procs_priv.frm'</span> to <span class="string">'/data/3306/data/mysql/procs_priv.frm'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/time_zone_name.MYD'</span> to <span class="string">'/data/3306/data/mysql/time_zone_name.MYD'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/slow_log.CSM'</span> to <span class="string">'/data/3306/data/mysql/slow_log.CSM'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/time_zone_leap_second.MYI'</span> to <span class="string">'/data/3306/data/mysql/time_zone_leap_second.MYI'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/help_topic.MYI'</span> to <span class="string">'/data/3306/data/mysql/help_topic.MYI'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/proc.MYI'</span> to <span class="string">'/data/3306/data/mysql/proc.MYI'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/columns_priv.MYD'</span> to <span class="string">'/data/3306/data/mysql/columns_priv.MYD'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/slow_log.CSV'</span> to <span class="string">'/data/3306/data/mysql/slow_log.CSV'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/func.frm'</span> to <span class="string">'/data/3306/data/mysql/func.frm'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/time_zone_leap_second.MYD'</span> to <span class="string">'/data/3306/data/mysql/time_zone_leap_second.MYD'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/ndb_binlog_index.frm'</span> to <span class="string">'/data/3306/data/mysql/ndb_binlog_index.frm'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/help_category.frm'</span> to <span class="string">'/data/3306/data/mysql/help_category.frm'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/db.MYI'</span> to <span class="string">'/data/3306/data/mysql/db.MYI'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/func.MYI'</span> to <span class="string">'/data/3306/data/mysql/func.MYI'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/columns_priv.frm'</span> to <span class="string">'/data/3306/data/mysql/columns_priv.frm'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/user.MYI'</span> to <span class="string">'/data/3306/data/mysql/user.MYI'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/general_log.frm'</span> to <span class="string">'/data/3306/data/mysql/general_log.frm'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/help_keyword.frm'</span> to <span class="string">'/data/3306/data/mysql/help_keyword.frm'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/event.MYD'</span> to <span class="string">'/data/3306/data/mysql/event.MYD'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/time_zone_transition.frm'</span> to <span class="string">'/data/3306/data/mysql/time_zone_transition.frm'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/help_relation.frm'</span> to <span class="string">'/data/3306/data/mysql/help_relation.frm'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/time_zone_transition_type.MYD'</span> to <span class="string">'/data/3306/data/mysql/time_zone_transition_type.MYD'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/host.MYD'</span> to <span class="string">'/data/3306/data/mysql/host.MYD'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/help_relation.MYI'</span> to <span class="string">'/data/3306/data/mysql/help_relation.MYI'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/servers.MYD'</span> to <span class="string">'/data/3306/data/mysql/servers.MYD'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/host.frm'</span> to <span class="string">'/data/3306/data/mysql/host.frm'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/help_relation.MYD'</span> to <span class="string">'/data/3306/data/mysql/help_relation.MYD'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/time_zone.MYI'</span> to <span class="string">'/data/3306/data/mysql/time_zone.MYI'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/plugin.MYI'</span> to <span class="string">'/data/3306/data/mysql/plugin.MYI'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/servers.MYI'</span> to <span class="string">'/data/3306/data/mysql/servers.MYI'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/user.frm'</span> to <span class="string">'/data/3306/data/mysql/user.frm'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/ndb_binlog_index.MYI'</span> to <span class="string">'/data/3306/data/mysql/ndb_binlog_index.MYI'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/tables_priv.MYI'</span> to <span class="string">'/data/3306/data/mysql/tables_priv.MYI'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/plugin.MYD'</span> to <span class="string">'/data/3306/data/mysql/plugin.MYD'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/db.MYD'</span> to <span class="string">'/data/3306/data/mysql/db.MYD'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/proxies_priv.frm'</span> to <span class="string">'/data/3306/data/mysql/proxies_priv.frm'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/time_zone_transition.MYI'</span> to <span class="string">'/data/3306/data/mysql/time_zone_transition.MYI'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/plugin.frm'</span> to <span class="string">'/data/3306/data/mysql/plugin.frm'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/host.MYI'</span> to <span class="string">'/data/3306/data/mysql/host.MYI'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/columns_priv.MYI'</span> to <span class="string">'/data/3306/data/mysql/columns_priv.MYI'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/time_zone_transition_type.frm'</span> to <span class="string">'/data/3306/data/mysql/time_zone_transition_type.frm'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/help_category.MYD'</span> to <span class="string">'/data/3306/data/mysql/help_category.MYD'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/procs_priv.MYI'</span> to <span class="string">'/data/3306/data/mysql/procs_priv.MYI'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/time_zone_name.frm'</span> to <span class="string">'/data/3306/data/mysql/time_zone_name.frm'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/time_zone.MYD'</span> to <span class="string">'/data/3306/data/mysql/time_zone.MYD'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/proc.frm'</span> to <span class="string">'/data/3306/data/mysql/proc.frm'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/func.MYD'</span> to <span class="string">'/data/3306/data/mysql/func.MYD'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/proxies_priv.MYD'</span> to <span class="string">'/data/3306/data/mysql/proxies_priv.MYD'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/time_zone_leap_second.frm'</span> to <span class="string">'/data/3306/data/mysql/time_zone_leap_second.frm'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/help_category.MYI'</span> to <span class="string">'/data/3306/data/mysql/help_category.MYI'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/proxies_priv.MYI'</span> to <span class="string">'/data/3306/data/mysql/proxies_priv.MYI'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/time_zone_transition.MYD'</span> to <span class="string">'/data/3306/data/mysql/time_zone_transition.MYD'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/tables_priv.frm'</span> to <span class="string">'/data/3306/data/mysql/tables_priv.frm'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/mysql/slow_log.frm'</span> to <span class="string">'/data/3306/data/mysql/slow_log.frm'</span></div><div class="line">innobackupex: Creating directory <span class="string">'/data/3306/data/cyh'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/cyh/db.opt'</span> to <span class="string">'/data/3306/data/cyh/db.opt'</span></div><div class="line">innobackupex: Creating directory <span class="string">'/data/3306/data/wuyi'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/wuyi/db.opt'</span> to <span class="string">'/data/3306/data/wuyi/db.opt'</span></div><div class="line">innobackupex: Starting to copy InnoDB system tablespace</div><div class="line">innobackupex: <span class="keyword">in</span> <span class="string">'/tmp/2016-07-03_21-07-38'</span></div><div class="line">innobackupex: back to original InnoDB data directory <span class="string">'/data/3306/data'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/ibdata1'</span> to <span class="string">'/data/3306/data/ibdata1'</span></div><div class="line">innobackupex: Starting to copy InnoDB undo tablespaces</div><div class="line">innobackupex: <span class="keyword">in</span> <span class="string">'/tmp/2016-07-03_21-07-38'</span></div><div class="line">innobackupex: back to <span class="string">'/data/3306/data'</span></div><div class="line">innobackupex: Starting to copy InnoDB <span class="built_in">log</span> files</div><div class="line">innobackupex: <span class="keyword">in</span> <span class="string">'/tmp/2016-07-03_21-07-38'</span></div><div class="line">innobackupex: back to original InnoDB <span class="built_in">log</span> directory <span class="string">'/data/3306/data'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/ib_logfile1'</span> to <span class="string">'/data/3306/data/ib_logfile1'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/ib_logfile0'</span> to <span class="string">'/data/3306/data/ib_logfile0'</span></div><div class="line">innobackupex: Copying <span class="string">'/tmp/2016-07-03_21-07-38/ib_logfile2'</span> to <span class="string">'/data/3306/data/ib_logfile2'</span></div><div class="line">innobackupex: Finished copying back files.</div><div class="line">160704 00:03:38  innobackupex: completed OK!</div></pre></td></tr></table></figure>
<p>我们可以在查看结果：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select * from student; ＃我们添加的数据也都回来了 </div><div class="line">+ - + ... + - + - +</div><div class="line">| id | 名称| 年龄| dept |</div><div class="line">+ - + ... + - + - +</div><div class="line">| 0 | 1 | 0 | NULL |</div><div class="line">| 2 | oldboy | 0 | NULL |</div><div class="line">| 3 | 好| 0 | NULL |</div><div class="line">| 3 | 好| 15 | NULL |</div><div class="line">+ - + ... + - + - +</div><div class="line">4行套（0.00秒）</div></pre></td></tr></table></figure>
<p>增量备份二进制文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@db02 2016-07-03_21-07-38]<span class="comment"># mysqlbinlog --start-position=107 /data/3306/mysql-bin.000029 &gt;/tmp/$(date +%F).sql</span></div></pre></td></tr></table></figure>
<p>注：<code>--start-position=107</code>可以不指定，因为107是一个日志的默认起始位置。</p>
<h3 id="还原增量备份"><a href="#还原增量备份" class="headerlink" title="还原增量备份"></a>还原增量备份</h3><p>为了防止还原时产生大量的二进制日志，在还原可临时关闭二进制日志后再还原;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mysql&gt; <span class="built_in">set</span> sql_log_bin=0; </div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line">mysql&gt; SOURCE /tmp/2016-07-03_21-07-38/2016-07-03.sql</div></pre></td></tr></table></figure>
<p>使用innobackupex进行增量备份</p>
<p>前面我们进行增量备份时，使用的还是老方法：备实二进制日志。其实xtrabackup还支持进行增量备份。<br>每个InnoDB的页面都会包含一个LSN信息，每当相关的数据发生改变，相关的页面的LSN就会自动增长。这正是InnoDB表可以进行增量备份的基础，即innobackupex通过备份上次完整备份之后发生改变的页面来实现。<br>增量备份基本语法：</p>
<p>模拟插入数据</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">mysql&gt;create table <span class="built_in">test</span>(</div><div class="line">    -&gt; id int(4) not null,</div><div class="line">    -&gt; name char(20) not null,</div><div class="line">    -&gt; age tinyint(2)  NOT NULL default <span class="string">'0'</span>,</div><div class="line">    -&gt; dept varchar(16)  default NULL</div><div class="line">    -&gt; );</div><div class="line">Query OK, 0 rows affected (0.03 sec)</div><div class="line">mysql&gt;insert into <span class="built_in">test</span>(id,name,age) values(1,<span class="string">'oldboy'</span>,19);</div><div class="line">mysql&gt;insert into <span class="built_in">test</span>(id,name,age) values(2,<span class="string">'oldgro;'</span>,20);</div></pre></td></tr></table></figure>
<p>2.进行增量备份</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div></pre></td><td class="code"><pre><div class="line">[root@db02 tmp]<span class="comment"># innobackupex --user=root --password=123456 --socket=/data/3306/mysql.sock --defaults-file=/data/3306/my.cnf --incremental /tmp/ --incremental-basedir=/tmp/2016-07-04_00-21-06/</span></div><div class="line">如果没有错误提示就说说说没有问题</div><div class="line">InnoDB Backup Utility v1.5.1-xtrabackup; Copyright 2003, 2009 Innobase Oy</div><div class="line">and Percona LLC and/or its affiliates 2009-2013.  All Rights Reserved.</div><div class="line">This software is published under</div><div class="line">the GNU GENERAL PUBLIC LICENSE Version 2, June 1991.</div><div class="line">Get the latest version of Percona XtraBackup, documentation, and <span class="built_in">help</span> resources:</div><div class="line">http://www.percona.com/xb/p</div><div class="line">160704 00:22:03  innobackupex: Executing a version check against the server...</div><div class="line">160704 00:22:03  innobackupex: Connecting to MySQL server with DSN <span class="string">'dbi:mysql:;mysql_read_default_file=/data/3306/my.cnf;mysql_read_default_group=xtrabackup;mysql_socket=/data/3306/mysql.sock'</span> as <span class="string">'root'</span>  (using password: YES).</div><div class="line">160704 00:22:03  innobackupex: Connected to MySQL server</div><div class="line">160704 00:22:03  innobackupex: Done.</div><div class="line">160704 00:22:03  innobackupex: Connecting to MySQL server with DSN <span class="string">'dbi:mysql:;mysql_read_default_file=/data/3306/my.cnf;mysql_read_default_group=xtrabackup;mysql_socket=/data/3306/mysql.sock'</span> as <span class="string">'root'</span>  (using password: YES).</div><div class="line">160704 00:22:03  innobackupex: Connected to MySQL server</div><div class="line">160704 00:22:03  innobackupex: Starting the backup operation</div><div class="line">IMPORTANT: Please check that the backup run completes successfully.</div><div class="line">           At the end of a successful backup run innobackupex</div><div class="line">           prints <span class="string">"completed OK!"</span>.</div><div class="line">innobackupex:  Using server version 5.5.49-log</div><div class="line">innobackupex: Created backup directory /tmp/2016-07-04_00-22-03</div><div class="line">160704 00:22:03  innobackupex: Starting ibbackup with <span class="built_in">command</span>: xtrabackup  --defaults-file=<span class="string">"/data/3306/my.cnf"</span>  --defaults-group=<span class="string">"mysqld"</span> --backup --suspend-at-end --target-dir=/tmp/2016-07-04_00-22-03 --tmpdir=/tmp --extra-lsndir=<span class="string">'/tmp'</span> --incremental-basedir=<span class="string">'/tmp/2016-07-04_00-21-06/'</span></div><div class="line">innobackupex: Waiting <span class="keyword">for</span> ibbackup (pid=3312) to <span class="built_in">suspend</span></div><div class="line">innobackupex: Suspend file <span class="string">'/tmp/2016-07-04_00-22-03/xtrabackup_suspended_2'</span></div><div class="line">xtrabackup version 2.2.13 based on MySQL server 5.6.24 Linux (x86_64) (revision id: 70f4be3)</div><div class="line">incremental backup from 2099425 is enabled.</div><div class="line">xtrabackup: uses posix_fadvise().</div><div class="line">xtrabackup: <span class="built_in">cd</span> to /data/3306/data</div><div class="line">xtrabackup: open files <span class="built_in">limit</span> requested 1024, <span class="built_in">set</span> to 65535</div><div class="line">xtrabackup: using the following InnoDB configuration:</div><div class="line">xtrabackup:   innodb_data_home_dir = ./</div><div class="line">xtrabackup:   innodb_data_file_path = ibdata1:128M:autoextend</div><div class="line">xtrabackup:   innodb_log_group_home_dir = ./</div><div class="line">xtrabackup:   innodb_log_files_in_group = 3</div><div class="line">xtrabackup:   innodb_log_file_size = 4194304</div><div class="line">&gt;&gt; <span class="built_in">log</span> scanned up to (2099425)</div><div class="line">xtrabackup: Generating a list of tablespaces</div><div class="line">[01] Copying ./ibdata1 to /tmp/2016-07-04_00-22-03/ibdata1.delta</div><div class="line">[01]        ...done</div><div class="line">&gt;&gt; <span class="built_in">log</span> scanned up to (2099425)</div><div class="line">xtrabackup: Creating <span class="built_in">suspend</span> file <span class="string">'/tmp/2016-07-04_00-22-03/xtrabackup_suspended_2'</span> with pid <span class="string">'3312'</span></div><div class="line">160704 00:22:05  innobackupex: Continuing after ibbackup has suspended</div><div class="line">160704 00:22:05  innobackupex: Executing FLUSH NO_WRITE_TO_BINLOG TABLES...</div><div class="line">160704 00:22:05  innobackupex: Executing FLUSH TABLES WITH READ LOCK...</div><div class="line">160704 00:22:05  innobackupex: All tables locked and flushed to disk</div><div class="line">160704 00:22:05  innobackupex: Starting to backup non-InnoDB tables and files</div><div class="line">innobackupex: <span class="keyword">in</span> subdirectories of <span class="string">'/data/3306/data/'</span></div><div class="line">innobackupex: Backing up file <span class="string">'/data/3306/data//qqqqqqq41233/db.opt'</span></div><div class="line">innobackupex: Backing up file <span class="string">'/data/3306/data//dadadadadadad/db.opt'</span></div><div class="line">innobackupex: Backing up file <span class="string">'/data/3306/data//qqqqqqqq3/db.opt'</span></div><div class="line">&gt;&gt; <span class="built_in">log</span> scanned up to (2099425)</div><div class="line">innobackupex: Backing up file <span class="string">'/data/3306/data//qqqqqqqq/db.opt'</span></div><div class="line">innobackupex: Backing up file <span class="string">'/data/3306/data//qqqqqqq43/db.opt'</span></div><div class="line">innobackupex: Backing up file <span class="string">'/data/3306/data//oldboy_gbk/db.opt'</span></div><div class="line">innobackupex: Backing up file <span class="string">'/data/3306/data//oldboy/student.frm'</span></div><div class="line">innobackupex: Backing up file <span class="string">'/data/3306/data//oldboy/db.opt'</span></div><div class="line">innobackupex: Backing up file <span class="string">'/data/3306/data//ooooooooooooooooo/db.opt'</span></div><div class="line">innobackupex: Backing up files <span class="string">'/data/3306/data//performance_schema/*.&#123;frm,isl,MYD,MYI,MAD,MAI,MRG,TRG,TRN,ARM,ARZ,CSM,CSV,opt,par&#125;'</span> (18 files)</div><div class="line">innobackupex: Backing up file <span class="string">'/data/3306/data//qqqqqqqq1/db.opt'</span></div><div class="line">innobackupex: Backing up file <span class="string">'/data/3306/data//wordpress/db.opt'</span></div><div class="line">innobackupex: Backing up file <span class="string">'/data/3306/data//aaa/db.opt'</span></div><div class="line">innobackupex: Backing up files <span class="string">'/data/3306/data//mysql/*.&#123;frm,isl,MYD,MYI,MAD,MAI,MRG,TRG,TRN,ARM,ARZ,CSM,CSV,opt,par&#125;'</span> (72 files)</div><div class="line">innobackupex: Backing up file <span class="string">'/data/3306/data//cyh/db.opt'</span></div><div class="line">innobackupex: Backing up file <span class="string">'/data/3306/data//wuyi/db.opt'</span></div><div class="line">160704 00:22:06  innobackupex: Finished backing up non-InnoDB tables and files</div><div class="line">160704 00:22:06  innobackupex: Executing FLUSH NO_WRITE_TO_BINLOG ENGINE LOGS...</div><div class="line">160704 00:22:06  innobackupex: Waiting <span class="keyword">for</span> <span class="built_in">log</span> copying to finish</div><div class="line">xtrabackup: The latest check point (<span class="keyword">for</span> incremental): <span class="string">'2099425'</span></div><div class="line">xtrabackup: Stopping <span class="built_in">log</span> copying thread.</div><div class="line">.&gt;&gt; <span class="built_in">log</span> scanned up to (2099425)</div><div class="line">xtrabackup: Creating <span class="built_in">suspend</span> file <span class="string">'/tmp/2016-07-04_00-22-03/xtrabackup_log_copied'</span> with pid <span class="string">'3312'</span></div><div class="line">xtrabackup: Transaction <span class="built_in">log</span> of lsn (2099425) to (2099425) was copied.</div><div class="line">160704 00:22:07  innobackupex: All tables unlocked</div><div class="line">innobackupex: Backup created <span class="keyword">in</span> directory <span class="string">'/tmp/2016-07-04_00-22-03'</span></div><div class="line">innobackupex: MySQL binlog position: filename <span class="string">'mysql-bin.000029'</span>, position 1258</div><div class="line">160704 00:22:07  innobackupex: Connection to database server closed</div><div class="line">160704 00:22:07  innobackupex: completed OK!</div><div class="line">查看xtrabackup_checkpoints</div><div class="line">backup_type = incremental</div><div class="line">from_lsn = 1768597</div><div class="line">to_lsn = 1769413</div><div class="line">last_lsn = 1769413</div><div class="line">compact = 0</div><div class="line">recover_binlog_info = 0</div></pre></td></tr></table></figure>
<p>准备</p>
<p>准备（prepare）增量备份与整理完全备份有着一些不同，尤其是要注意的是：<br>（1）需要在每个备份（包括完全和增量备份）上，将已经提交的事务进行“重放”。<br>“重放”之后，所有的备份数据将合并到完全备份上</p>
<p>查看链接：<a href="http://www.abcdocker.com/abcdocker/51" target="_blank" rel="external">http://www.abcdocker.com/abcdocker/51</a></p>


                <hr>

                

                <ul class="pager">
                    
                        <li class="previous">
                            <a href="/2016/04/22/数据库/MySQL/MySQL中binglog数据恢复与定时删除/" data-toggle="tooltip" data-placement="top" title="【第十章】MySQL中binglog数据恢复与定时删除">&larr; Previous Post</a>
                        </li>
                    
                    
                        <li class="next">
                            <a href="/2016/04/21/数据库/MySQL/构建MySQL+keepalived高可用自动切换/" data-toggle="tooltip" data-placement="top" title="构建MySQL+keepalived高可用自动切换">Next Post &rarr;</a>
                        </li>
                    
                </ul>

                

                
                <!-- disqus 评论框 start -->
                <div class="comment">
                    <div id="disqus_thread" class="disqus-thread"></div>
                </div>
                <!-- disqus 评论框 end -->
                

            </div>
    <!-- Side Catalog Container -->
        

    <!-- Sidebar Container -->

            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                       
                          <a class="tag" href="/tags/#MySQL.Database" title="MySQL.Database">MySQL.Database</a>
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">

                    
                        <li><a href="http://openskill.cn/" target="_blank">openskill.cn</a></li>
                    
                        <li><a href="http://yuzhouwan.com/" target="_blank">Benedict Jin&#39;s Blog</a></li>
                    
                </ul>
                
            </div>

        </div>
    </div>
</article>




<!-- disqus 公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = "blog-yancy-cc";
    var disqus_identifier = "http://blog.yancy.cc/2016/04/21/数据库/MySQL/MySQL使用Xtrabackup备份以及恢复 /";
    var disqus_url = "http://blog.yancy.cc/2016/04/21/数据库/MySQL/MySQL使用Xtrabackup备份以及恢复 /";

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<!-- disqus 公共JS代码 end -->




<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("https://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'always',
          placement: 'right',
          icon: '#'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                
                
                    <li>
                        <a target="_blank" href="https://twitter.com/yancyoo">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                
                
                    <li>
                        <a target="_blank" href="https://www.zhihu.com/people/benet1006">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa  fa-stack-1x fa-inverse">知</i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank" href="http://weibo.com/yangcvo">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-weibo fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                

                
                    <li>
                        <a target="_blank"  href="https://github.com/yangcvo">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; Jolly-Yancy&#39;s blog 2017 
                    <br>
                 Theme by <a href="http://blog.yancy.cc">Yancy</a>
                    <span style="display: inline-block; margin: 0 5px;">
                        <i class="fa fa-heart"></i>
                    </span>
                    Ported by <a href="http://github.com/yangcvo">Github</a>

                    <!--<iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="91px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=kaijun&repo=hexo-theme-huxblog&type=star&count=true" >
                    </iframe>--> 
		</p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js"></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- 
     Because of the native support for backtick-style fenced code blocks 
     right within the Markdown is landed in Github Pages, 
     From V1.6, There is no need for Highlight.js, 
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0  
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/    
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("http://blog.yancy.cc/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->




<!-- Baidu Tongji -->


<!-- Side Catalog -->





<!-- Image to hack wechat -->
<img src="http://blog.yancy.cc/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
