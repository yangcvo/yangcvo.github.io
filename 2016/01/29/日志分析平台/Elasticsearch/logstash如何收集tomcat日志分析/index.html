<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>logstashå¦‚ä½•å†™tomcat,redis,nginxæ—¥å¿—æ”¶é›†è§„åˆ™ | Yancy&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="logstashå¦‚ä½•æ”¶é›†tomcatæ—¥å¿—åˆ†æï¼ˆå¯ä»¥å‚è€ƒæˆ‘ä¸‹é¢å†™çš„æ¨¡æ¿ï¼‰1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162æˆ‘æƒ³å®ç°å¯¹tomcatçš„æ—¥å¿—é‡‡é›†ï¼Œæ­£å¸¸åº”è¯¥åˆ›å»ºä¸€ä¸ªfileçš„inputï¼Œè¿™ä¸ªinputæŒ‡å®šäº†ç›‘å¬çš„æ–‡">
<meta name="keywords" content="Log analysis platform">
<meta property="og:type" content="article">
<meta property="og:title" content="logstashå¦‚ä½•å†™tomcat,redis,nginxæ—¥å¿—æ”¶é›†è§„åˆ™">
<meta property="og:url" content="http://blog.yancy.cc/2016/01/29/æ—¥å¿—åˆ†æå¹³å°/Elasticsearch/logstashå¦‚ä½•æ”¶é›†tomcatæ—¥å¿—åˆ†æ/index.html">
<meta property="og:site_name" content="Yancy&#39;s blog">
<meta property="og:description" content="logstashå¦‚ä½•æ”¶é›†tomcatæ—¥å¿—åˆ†æï¼ˆå¯ä»¥å‚è€ƒæˆ‘ä¸‹é¢å†™çš„æ¨¡æ¿ï¼‰1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162æˆ‘æƒ³å®ç°å¯¹tomcatçš„æ—¥å¿—é‡‡é›†ï¼Œæ­£å¸¸åº”è¯¥åˆ›å»ºä¸€ä¸ªfileçš„inputï¼Œè¿™ä¸ªinputæŒ‡å®šäº†ç›‘å¬çš„æ–‡">
<meta property="og:updated_time" content="2019-01-17T08:16:48.413Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="logstashå¦‚ä½•å†™tomcat,redis,nginxæ—¥å¿—æ”¶é›†è§„åˆ™">
<meta name="twitter:description" content="logstashå¦‚ä½•æ”¶é›†tomcatæ—¥å¿—åˆ†æï¼ˆå¯ä»¥å‚è€ƒæˆ‘ä¸‹é¢å†™çš„æ¨¡æ¿ï¼‰1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162æˆ‘æƒ³å®ç°å¯¹tomcatçš„æ—¥å¿—é‡‡é›†ï¼Œæ­£å¸¸åº”è¯¥åˆ›å»ºä¸€ä¸ªfileçš„inputï¼Œè¿™ä¸ªinputæŒ‡å®šäº†ç›‘å¬çš„æ–‡">
  
  <link rel="stylesheet" href="/css/index.css">
</head>

<body style="


  background-color: #eff0f6

">
  <div id="container">
    <nav id="nav">
  <header class="header">
    <a href="/" class="title">Clover Tuan</a>
  </header>
  <div class="ctnWrap">
    <div class="icons">
      
        
          
            <a href="https://dribbble.com/clovertuan" target="_blank" class="nav-icn iconfont icon-dribbble"></a>
          
        
          
            <a href="https://www.behance.net/clovertuan" target="_blank" class="nav-icn iconfont icon-behance"></a>
          
        
          
            <a href="http://clovertuan.lofter.com/" target="_blank" class="nav-icn iconfont icon-lofter"></a>
          
        
          
            <a href="https://www.instagram.com/clovertuan/" target="_blank" class="nav-icn iconfont icon-instagram"></a>
          
        
          
            <a href="https://github.com/cloverTuan" target="_blank" class="nav-icn iconfont icon-github"></a>
          
        
      
    </div>
    <div class="menu">
      
        
            <a href="/" class="nav-menu ">HOME</a>
          
        
            <a href="/archives" class="nav-menu ">ARCHIVE</a>
          
        
            <a href="/about" class="nav-menu ">ABOUT</a>
          
        
      
    </div>
  </div>
</nav>
    <div id="main"><section class="article">
  <h2 class="title">logstashå¦‚ä½•å†™tomcat,redis,nginxæ—¥å¿—æ”¶é›†è§„åˆ™</h2>
  <p class="sub">Jan 29, 2016</p>
  <article class="content">
    <h5 id="logstashå¦‚ä½•æ”¶é›†tomcatæ—¥å¿—åˆ†æï¼ˆå¯ä»¥å‚è€ƒæˆ‘ä¸‹é¢å†™çš„æ¨¡æ¿ï¼‰"><a href="#logstashå¦‚ä½•æ”¶é›†tomcatæ—¥å¿—åˆ†æï¼ˆå¯ä»¥å‚è€ƒæˆ‘ä¸‹é¢å†™çš„æ¨¡æ¿ï¼‰" class="headerlink" title="logstashå¦‚ä½•æ”¶é›†tomcatæ—¥å¿—åˆ†æï¼ˆå¯ä»¥å‚è€ƒæˆ‘ä¸‹é¢å†™çš„æ¨¡æ¿ï¼‰"></a>logstashå¦‚ä½•æ”¶é›†tomcatæ—¥å¿—åˆ†æï¼ˆå¯ä»¥å‚è€ƒæˆ‘ä¸‹é¢å†™çš„æ¨¡æ¿ï¼‰</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line">æˆ‘æƒ³å®ç°å¯¹tomcatçš„æ—¥å¿—é‡‡é›†ï¼Œæ­£å¸¸åº”è¯¥åˆ›å»ºä¸€ä¸ªfileçš„inputï¼Œè¿™ä¸ªinputæŒ‡å®šäº†ç›‘å¬çš„æ–‡ä»¶æˆ–è€…ç›®å½•....ç„¶åè¿‡æ»¤å™¨ï¼ˆå¦‚æœæ²¡æœ‰ç‰¹æ®Šè¦æ±‚ï¼Œå…ˆå¯ä»¥ä¸è¿›è¡Œè§£æï¼ŒåŸå§‹çš„æ—¥å¿—ç›´æ¥å­˜å°±è¡Œï¼‰....æœ€åä½¿ç”¨ä¸€ä¸ªelastcisearchæ’ä»¶ï¼Œå‘é€åˆ°esä¸­å».</div><div class="line"></div><div class="line">input &#123;</div><div class="line">        stdin&#123;&#125;</div><div class="line"></div><div class="line">        file &#123;</div><div class="line">                <span class="built_in">type</span> =&gt; <span class="string">"tomcat_card"</span></div><div class="line">                path =&gt; <span class="string">"/srv/tomcat/logs/card/*.log"</span></div><div class="line">                start_position =&gt; <span class="string">"beginning"</span></div><div class="line">        &#125;</div><div class="line">        file &#123;</div><div class="line">                <span class="built_in">type</span> =&gt; <span class="string">"tomcat_family"</span></div><div class="line">                path =&gt; <span class="string">"/srv/tomcat/logs/family/*.log"</span></div><div class="line">                start_position =&gt; <span class="string">"beginning"</span></div><div class="line"></div><div class="line">        &#125;</div><div class="line">        file &#123;</div><div class="line">                <span class="built_in">type</span> =&gt; <span class="string">"tomcat_mission"</span></div><div class="line">                path =&gt; <span class="string">"/srv/tomcat/logs/mission/*.log"</span></div><div class="line">                start_position =&gt; <span class="string">"beginning"</span></div><div class="line"></div><div class="line">        &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">filter &#123;</div><div class="line"></div><div class="line">        grok &#123;</div><div class="line">                match =&gt; [</div><div class="line">                                <span class="string">"message"</span>, <span class="string">"%&#123;TIMESTAMP_ISO8601:logdate&#125; %&#123;WORD:loglevel&#125;%&#123;SPACE&#125;%&#123;NOTSPACE:loggername&#125; - %&#123;GREEDYDATA:msg&#125;"</span>,</div><div class="line">                                <span class="string">"message"</span>, <span class="string">"%&#123;GREEDYDATA:msg&#125;"</span></div><div class="line">                         ]</div><div class="line"></div><div class="line">        &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">output&#123;</div><div class="line">        <span class="keyword">if</span> [<span class="built_in">type</span>] == <span class="string">"tomcat_card"</span> &#123;</div><div class="line">        elasticsearch &#123;</div><div class="line">                host =&gt; <span class="string">"192.168.1.234"</span></div><div class="line">                protocol =&gt; <span class="string">"http"</span></div><div class="line">                index   =&gt; <span class="string">"tomcat_card-%&#123;+YYYYY.MM.dd&#125;"</span></div><div class="line">        &#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line">        <span class="keyword">if</span> [<span class="built_in">type</span>] == <span class="string">"tomcat_family"</span> &#123;</div><div class="line">        elasticsearch &#123;</div><div class="line">                host =&gt; <span class="string">"192.168.1.234"</span></div><div class="line">                protocol =&gt; <span class="string">"http"</span></div><div class="line">                index   =&gt; <span class="string">"tomcat_card-%&#123;+YYYYY.MM.dd&#125;"</span></div><div class="line">        &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> [<span class="built_in">type</span>] == <span class="string">"tomcat_mission"</span> &#123;</div><div class="line">        elasticsearch &#123;</div><div class="line">                host =&gt; <span class="string">"192.168.1.234"</span></div><div class="line">                protocol =&gt; <span class="string">"http"</span></div><div class="line">                index   =&gt; <span class="string">"tomcat_mission-%&#123;+YYYYY.MM.dd&#125;"</span></div><div class="line">                &#125;</div><div class="line">        &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="logstashæ—¥å¿—é‡‡é›†nginxé…ç½®"><a href="#logstashæ—¥å¿—é‡‡é›†nginxé…ç½®" class="headerlink" title="logstashæ—¥å¿—é‡‡é›†nginxé…ç½®"></a>logstashæ—¥å¿—é‡‡é›†nginxé…ç½®</h5><p>/etc/logstash/conf.d/nginx.conf</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">input &#123;</div><div class="line">file &#123;</div><div class="line">path =&gt; <span class="string">"/data/wwwlogs/nginx_json.log"</span></div><div class="line">codec =&gt; <span class="string">"json"</span></div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">filter &#123;</div><div class="line">mutate &#123;</div><div class="line">split =&gt; [ <span class="string">"upstreamtime"</span>, <span class="string">","</span> ]</div><div class="line">&#125;</div><div class="line">mutate &#123;</div><div class="line">convert =&gt; [ <span class="string">"upstreamtime"</span>, <span class="string">"float"</span> ]</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">output &#123;</div><div class="line">kafka &#123;</div><div class="line">bootstrap_servers =&gt; <span class="string">"10.0.0.11:9092"</span></div><div class="line">topic_id =&gt; <span class="string">"logstash"</span></div><div class="line">compression_type =&gt; <span class="string">"gzip"</span></div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="åˆ›å»ºä¸€ä¸ªä»æ—¥å¿—æ–‡ä»¶è¯»å–ï¼Œå¹¶å†™å…¥redisçš„é…ç½®æ–‡ä»¶-æœ¬æ–‡ä»¶é‡‡ç”¨é»˜è®¤æ–¹å¼è¿›è¡Œè¾“å…¥ï¼Œè¾“å‡º"><a href="#åˆ›å»ºä¸€ä¸ªä»æ—¥å¿—æ–‡ä»¶è¯»å–ï¼Œå¹¶å†™å…¥redisçš„é…ç½®æ–‡ä»¶-æœ¬æ–‡ä»¶é‡‡ç”¨é»˜è®¤æ–¹å¼è¿›è¡Œè¾“å…¥ï¼Œè¾“å‡º" class="headerlink" title="åˆ›å»ºä¸€ä¸ªä»æ—¥å¿—æ–‡ä»¶è¯»å–ï¼Œå¹¶å†™å…¥redisçš„é…ç½®æ–‡ä»¶(æœ¬æ–‡ä»¶é‡‡ç”¨é»˜è®¤æ–¹å¼è¿›è¡Œè¾“å…¥ï¼Œè¾“å‡º)"></a>åˆ›å»ºä¸€ä¸ªä»æ—¥å¿—æ–‡ä»¶è¯»å–ï¼Œå¹¶å†™å…¥redisçš„é…ç½®æ–‡ä»¶(æœ¬æ–‡ä»¶é‡‡ç”¨é»˜è®¤æ–¹å¼è¿›è¡Œè¾“å…¥ï¼Œè¾“å‡º)</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#cat agent.conf</span></div><div class="line">input &#123;</div><div class="line">    file &#123;</div><div class="line">        path =&gt; <span class="string">"/var/log/httpd/access_log"</span>    //è®¾ç½®è¯»å–çš„æ—¥å¿—è·¯å¾„</div><div class="line">        sincedb_path =&gt; <span class="string">"../.sincedb"</span></div><div class="line">        <span class="built_in">type</span> =&gt; <span class="string">"httpd"</span></div><div class="line">        start_position =&gt; <span class="string">"beginning"</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">output &#123;</div><div class="line">    redis &#123;</div><div class="line">        host =&gt; [<span class="string">"127.0.0.1"</span>]</div><div class="line">        port =&gt; 6379</div><div class="line">        batch =&gt; <span class="literal">true</span></div><div class="line">            batch_events =&gt; 5</div><div class="line">            data_type =&gt; <span class="string">"list"</span></div><div class="line">            key =&gt; <span class="string">"logstash:redis"</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">é…ç½®ä¸€ä¸ªä»redisè¯»å–æ—¥å¿—å¹¶è¾“å‡ºåˆ°esçš„é…ç½®æ–‡ä»¶</div><div class="line"></div><div class="line"><span class="comment">#cat index.conf</span></div><div class="line">input &#123;</div><div class="line">  redis &#123;</div><div class="line">    host =&gt; [<span class="string">"127.0.0.1"</span>]</div><div class="line">    port =&gt; 6379</div><div class="line">    data_type =&gt; <span class="string">"list"</span></div><div class="line">    key =&gt; â€œ<span class="built_in">log</span> stash:redis<span class="string">"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">output &#123;</div><div class="line">        elasticsearch &#123;</div><div class="line">        host =&gt; "127.0.0.1<span class="string">"</span></div><div class="line">        protocol =&gt; "http<span class="string">"</span></div><div class="line">        index =&gt; "logstash-%&#123;<span class="built_in">type</span>&#125;-%&#123;+YYYY.MM.dd&#125;<span class="string">"</span></div><div class="line">        index_type =&gt; "%&#123;<span class="built_in">type</span>&#125;<span class="string">"</span></div><div class="line">        &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">å¯åŠ¨logstash</div></pre></td></tr></table></figure>
<h3 id="Communicative-learning"><a href="#Communicative-learning" class="headerlink" title="Communicative learning:"></a>Communicative learning:</h3><p>ğŸ§  Linux shell_ senior operation and maintenance faction: QQ group <code>459096184</code> circle (system operation and maintenance - application operation and maintenance - automation operation and maintenance - virtualization technology research, welcome to join)<br>ğŸ§  BigData-Exchange School:QQ group <code>521621407</code> circles (big data Yun Wei) (Hadoop developer) (big data research enthusiasts) welcome to join</p>
<p>Bidata have internal WeChat exchange group, learn from each other, join QQ group has links.</p>

  </article>
  <footer class="f-cf">
    
      <a href="/2016/01/30/æ—¥å¿—åˆ†æå¹³å°/Elasticsearch/Elasticsearch5.xç‰ˆæœ¬çš„ç´¢å¼•å®šæ—¶è‡ªåŠ¨æ¸…ç†å’Œæ£€æµ‹è¿›ç¨‹çŠ¶æ€è‡ªåŠ¨å¯åŠ¨/" class="link f-fl">âŸµElasticsearch5.xç‰ˆæœ¬çš„ç´¢å¼•å®šæ—¶è‡ªåŠ¨æ¸…ç†å’Œæ£€æµ‹è¿›ç¨‹çŠ¶æ€è‡ªåŠ¨å¯åŠ¨</a>
    
    
      <a href="/2016/01/21/æ—¥å¿—åˆ†æå¹³å°/Elasticsearch/ELK-Elasticsearch-Logstash-Kibana-æ­å»ºæ—¥å¿—é›†ä¸­åˆ†æå¹³å°å®è·µ/" class="link f-fr">ELK(Elasticsearch1.7+ + Logstash1.5+ + Kibana4.1)æ­å»ºæ—¥å¿—é›†ä¸­åˆ†æå¹³å°å®è·µâŸ¶</a>
    
  </footer>
</section></div>
    <footer id="footer" class="f-cf">
  d.guangying@foxmail.com
  
    
      
        Â· <a href="https://dribbble.com/clovertuan" target="_blank" class="nav-icn">Dribbble</a>
      
    
      
        Â· <a href="https://www.behance.net/clovertuan" target="_blank" class="nav-icn">Behance</a>
      
    
      
        Â· <a href="http://clovertuan.lofter.com/" target="_blank" class="nav-icn">Lofter</a>
      
    
      
        Â· <a href="https://www.instagram.com/clovertuan/" target="_blank" class="nav-icn">Instagram</a>
      
    
      
        Â· <a href="https://github.com/cloverTuan" target="_blank" class="nav-icn">GitHub</a>
      
    
  
  <span class="copyright">All rights reserved @Clover Tuan</span>
</footer>
  </div>
</body>
</html>