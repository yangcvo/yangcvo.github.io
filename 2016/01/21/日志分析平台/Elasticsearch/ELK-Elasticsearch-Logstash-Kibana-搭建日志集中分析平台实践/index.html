<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Personal blog, thinking and sharing of technology and life">
    <meta name="keyword"  content="undefined">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
          ELK(Elasticsearch + Logstash + Kibana)搭建日志集中分析平台实践 - Yancy&#39;s blog
        
    </title>

    <link rel="canonical" href="http://blog.yancy.cc/2016/01/21/日志分析平台/Elasticsearch/ELK-Elasticsearch-Logstash-Kibana-搭建日志集中分析平台实践/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/hux-blog.min.css">

    <!-- Pygments Highlight CSS -->
    <link rel="stylesheet" href="/css/highlight.css">

    <!-- Custom Fonts -->
    <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- Hux Delete, sad but pending in China
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    -->


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Yancy&#39;s blog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>

                    

                        
                    

                        
                        <li>
                            <a href="/about/About-me.html">About</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/archives/archives.html">Archives</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/tags/">Tags</a>
                        </li>
                        
                    
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Main Content -->
    
<!-- Image to hack wechat -->
<!-- <img src="http://blog.yancy.cc/img/icon_wechat.png" width="0" height="0"> -->
<!-- <img src="{{ site.baseurl }}/{% if page.header-img %}{{ page.header-img }}{% else %}{{ site.header-img }}{% endif %}" width="0" height="0"> -->

<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        background-image: url('/img/home-bg.jpg')
    }
</style>
<header class="intro-header" >
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                          <a class="tag" href="/tags/#Log analysis platform" title="Log analysis platform">Log analysis platform</a>
                        
                    </div>
                    <h1>ELK(Elasticsearch + Logstash + Kibana)搭建日志集中分析平台实践</h1>
                    <h2 class="subheading"></h2>
                    <span class="meta">
                        Posted by Yancy on
                        2016-01-21
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

    <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <h4 id="关注可参考："><a href="#关注可参考：" class="headerlink" title="关注可参考："></a>关注可参考：</h4><p>本文将安装Elasticsearch-1.7.2, Logstash-1.5.5, Kibana-4.1.5。 请注意版本要求，有些组件需要响应的版本要求。<br>logstash是负责搜集和转发日志的，es用于存储和检索，kibana提供web端的展现…他们是独立运行的，也可以部署在同一台机器，也可以不同的机器。</p>
<p>可以关注我的Github上面有详细文档：<a href="https://github.com/yangcvo/ELK" target="_blank" rel="external">https://github.com/yangcvo/ELK</a><br> 启动脚本下载：<a href="https://github.com/yangcvo/ELK" target="_blank" rel="external">https://github.com/yangcvo/ELK</a></p>
<ul>
<li>详细配置优化做集群与写收集日志规则教程: <a href="https://github.com/yangcvo/ELK" target="_blank" rel="external">https://github.com/yangcvo/ELK</a></li>
</ul>
<h4 id="组件预览"><a href="#组件预览" class="headerlink" title="组件预览"></a>组件预览</h4><ul>
<li><p>JDK  <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html" target="_blank" rel="external">http://www.oracle.com/technetwork/java/javase/downloads/index.html</a></p>
</li>
<li><p>Elasticsearch <a href="https://www.elastic.co/downloads/elasticsearch" target="_blank" rel="external">https://www.elastic.co/downloads/elasticsearch</a></p>
</li>
<li><p>Logstash <a href="https://www.elastic.co/downloads/logstash" target="_blank" rel="external">https://www.elastic.co/downloads/logstash</a></p>
</li>
</ul>
<ul>
<li><p>Kibana下载地址:<a href="https://www.elastic.co/downloads/kibana" target="_blank" rel="external">https://www.elastic.co/downloads/kibana</a></p>
</li>
<li><p>redis下载地址: <a href="http://redis.io/download" target="_blank" rel="external">http://redis.io/download</a></p>
</li>
</ul>
<h4 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作:"></a>准备工作:</h4><p>服务端：系统centos 6.7   ip:192.168.1.234   JDK1.8    Elasticsearch-1.7.2  Kibana-4.1.2<br>客户端：系统centos 6.7   ip:192.168.1.235   JDK1.8    Logash-1.4.2</p>
<h4 id="基本配置设置FQDN："><a href="#基本配置设置FQDN：" class="headerlink" title="基本配置设置FQDN："></a>基本配置设置FQDN：</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">创建SSL证书的时候需要配置FQDN</div><div class="line">#修改hostname</div><div class="line">cat /etc/hostname</div><div class="line">elk</div><div class="line"></div><div class="line">#修改hosts</div><div class="line">cat /etc/hosts</div><div class="line"><span class="number">127.0</span>.<span class="number">0.1</span> localhost localhost<span class="selector-class">.localdomain</span> localhost4 localhost4<span class="selector-class">.localdomain4</span></div><div class="line">::<span class="number">1</span> localhost localhost<span class="selector-class">.localdomain</span> localhost6 localhost6<span class="selector-class">.localdomain6</span></div><div class="line"><span class="number">192.168</span>.<span class="number">1.234</span> elk<span class="selector-class">.ooxx</span><span class="selector-class">.com</span> elk</div><div class="line"></div><div class="line">#刷新环境</div><div class="line">hostname -F /etc/hostname</div><div class="line"></div><div class="line">#复查结果</div><div class="line">hostname -f</div><div class="line">elk<span class="selector-class">.ooxx</span><span class="selector-class">.com</span></div><div class="line"></div><div class="line">hostname</div><div class="line">elk</div></pre></td></tr></table></figure>
<h4 id="关闭防火墙"><a href="#关闭防火墙" class="headerlink" title="关闭防火墙"></a>关闭防火墙</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#service iptables stop</span></div><div class="line"><span class="comment">#setenforce 0</span></div><div class="line"></div><div class="line">不过这里我防火墙是开启的，后期添加出去端口即可。</div><div class="line">或者可以不关闭防火墙，但是要在iptables中打开相关的端口：</div><div class="line"></div><div class="line"><span class="comment"># vim /etc/sysconfig/iptables</span></div><div class="line">-A INPUT -m state --state NEW -m tcp -p tcp --dport 80 -j ACCEPT</div><div class="line">-A INPUT -m state --state NEW -m tcp -p tcp --dport 9200 -j ACCEPT</div><div class="line">-A INPUT -m state --state NEW -m tcp -p tcp --dport 9292 -j ACCEPT</div><div class="line"><span class="comment"># service iptables restart</span></div></pre></td></tr></table></figure>
<h4 id="安装java："><a href="#安装java：" class="headerlink" title="安装java："></a>安装java：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">ElasticSearch和Logstash依赖于JDK，所以需要安装JDK：</div><div class="line"><span class="comment"># yum -y install java-1.8.0-openjdk*</span></div><div class="line"><span class="comment"># java -version</span></div><div class="line">这里我是用yum安装方法，也可以自行下载tar包，注意设置java路径。</div><div class="line">java也可到这个地址下载https://www.reucon.com/cdn/java/</div></pre></td></tr></table></figure>
<h4 id="安装Elasticsearch："><a href="#安装Elasticsearch：" class="headerlink" title="安装Elasticsearch："></a>安装Elasticsearch：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">RPM安装</div><div class="line">下载ElasticSearch ElasticSearch默认的对外服务的HTTP端口是9200，节点间交互的TCP端口是9300。</div><div class="line">.以 CentOS 下使用安装包RPM安装</div><div class="line">＃mkdir -p /opt/software &amp;&amp; <span class="built_in">cd</span> /opt/software</div><div class="line">＃wget -c https://download.elastic.co/elasticsearch/elasticsearch/elasticsearch-1.7.2.noarch.rpm</div><div class="line">＃rpm -ivh elasticsearch-1.7.2.noarch.rpm</div><div class="line"></div><div class="line">可以自定义下存储文件目录 用RPM 安装。</div><div class="line"></div><div class="line">vim /etc/elasticsearch/elasticsearch.yml</div><div class="line">cluster.name: graylog-development</div><div class="line">node.data: <span class="literal">true</span></div><div class="line">index.number_of_shards: 5</div><div class="line">index.number_of_replicas: 1</div><div class="line">path.data: /home/data/es-data   自定存储目录</div><div class="line">path.work: /home/data/es-work</div><div class="line">network.host: 192.168.1.234</div></pre></td></tr></table></figure>
<h4 id="启动es相关服务"><a href="#启动es相关服务" class="headerlink" title="启动es相关服务"></a>启动es相关服务</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">service elasticsearch <span class="keyword">start</span></div><div class="line">service elasticsearch <span class="keyword">status</span></div></pre></td></tr></table></figure>
<h4 id="es源码安装"><a href="#es源码安装" class="headerlink" title="es源码安装"></a>es源码安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">这里我是源码安装的</div><div class="line">下载ElasticSearch ElasticSearch默认的对外服务的HTTP端口是9200，节点间交互的TCP端口是9300。</div><div class="line">Elasticsearch - https://www.elastic.co/downloads/elasticsearch</div><div class="line">tar -zxvf elasticsearch-1.7.1.tar.gz -C /usr/<span class="built_in">local</span>/</div><div class="line"> <span class="built_in">cd</span> /usr/<span class="built_in">local</span>/elasticsearch-1.7.1/config/</div><div class="line"></div><div class="line">然后给目录做个软链接：</div><div class="line">ln <span class="_">-s</span> elasticsearch-1.7.1/ /usr/<span class="built_in">local</span>/elasticsearch</div><div class="line"></div><div class="line">这里需要修改配置文件：</div><div class="line">配置前先创建几个目录文件</div><div class="line">mkdir /data/es-data -p</div><div class="line"> mkdir /data/es-work -p</div><div class="line"> mkdir   /usr/<span class="built_in">local</span>/elasticsearch-1.7.1/config/logs</div><div class="line"> mkdir   /usr/<span class="built_in">local</span>/elasticsearch-1.7.1/config/plugins</div></pre></td></tr></table></figure>
<h4 id="配置Elasticsearch："><a href="#配置Elasticsearch：" class="headerlink" title="配置Elasticsearch："></a>配置Elasticsearch：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line">vim elasticsearch.yml</div><div class="line"></div><div class="line"></div><div class="line">cluster.name: elasticsearch   集群名称  </div><div class="line"></div><div class="line"><span class="comment">#################################### Node #####################################</span></div><div class="line"></div><div class="line"><span class="comment"># Node names are generated dynamically on startup, so you're relieved</span></div><div class="line"><span class="comment"># from configuring them manually. You can tie this node to a specific name:</span></div><div class="line"><span class="comment">#</span></div><div class="line">node.name: “linux_es”   这里我做了集群所以需要两个节点，这里我写了一个节点名称</div><div class="line"></div><div class="line"><span class="comment"># Every node can be configured to allow or deny being eligible as the master,</span></div><div class="line"><span class="comment"># and to allow or deny to store the data.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Allow this node to be eligible as a master node (enabled by default):</span></div><div class="line"><span class="comment">#</span></div><div class="line">node.master: <span class="literal">true</span>   集群master 启动</div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Allow this node to store data (enabled by default):</span></div><div class="line"><span class="comment">#</span></div><div class="line">node.data: <span class="literal">true</span>  数据存放<span class="literal">true</span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># Set the number of shards (splits) of an index (5 by default):</span></div><div class="line"><span class="comment">#</span></div><div class="line">index.number_of_shards: 5</div><div class="line"></div><div class="line"><span class="comment"># Set the number of replicas (additional copies) of an index (1 by default):</span></div><div class="line"><span class="comment">#</span></div><div class="line">index.number_of_replicas: 1</div><div class="line"></div><div class="line"><span class="comment">#################################### Paths ####################################</span></div><div class="line"></div><div class="line"><span class="comment"># Path to directory containing configuration (this file and logging.yml):</span></div><div class="line"><span class="comment">#</span></div><div class="line">path.conf: /usr/<span class="built_in">local</span>/elasticsearch/config  这里开启es配置文件目录路径</div><div class="line"></div><div class="line"><span class="comment"># Path to directory where to store index data allocated for this node.</span></div><div class="line"><span class="comment">#</span></div><div class="line">path.data: /data/es-data     es数据存放目录  这里需要自己新建目录</div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Can optionally include more than one location, causing data to be striped across</span></div><div class="line"><span class="comment"># the locations (a la RAID 0) on a file level, favouring locations with most free</span></div><div class="line"><span class="comment"># space on creation. For example:</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#path.data: /path/to/data1,/path/to/data2</span></div><div class="line"></div><div class="line"><span class="comment"># Path to temporary files:</span></div><div class="line"><span class="comment">#</span></div><div class="line">path.work: /data/es-work   </div><div class="line"></div><div class="line"><span class="comment"># Path to log files:</span></div><div class="line"><span class="comment">#</span></div><div class="line">path.logs: /usr/<span class="built_in">local</span>/elasticsearch/logs   es的存放日志  这里需要自己创建下文件</div><div class="line"></div><div class="line"><span class="comment"># Path to where plugins are installed:</span></div><div class="line"><span class="comment">#</span></div><div class="line">path.plugins: /usr/<span class="built_in">local</span>/elasticsearch/plugins   es安装插件存放路径</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Set this property to true to lock the memory:</span></div><div class="line"><span class="comment">#</span></div><div class="line">bootstrap.mlockall: <span class="literal">true</span></div></pre></td></tr></table></figure>
<p>源码安装启动需要执行 ：<code>/usr/local/elasticsearch/bin/elasticsearch</code><br>才能启动；</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">这里需要/etc/init.d/创建启动脚本。</div><div class="line">可以到我github上面下载。</div><div class="line">[root@ELK elasticsearch-servicewrapper]<span class="comment"># mv service/ /usr/local/elasticsearch/bin/</span></div><div class="line">[root@ELK elasticsearch-servicewrapper]<span class="comment"># cd /usr/local/elasticsearch</span></div><div class="line">[root@ELK elasticsearch]<span class="comment"># /usr/local/elasticsearch/bin/service/elasticsearch install    这里是安装es</span></div><div class="line">Detected RHEL or Fedora:</div><div class="line">Installing the Elasticsearch daemon..</div><div class="line">[root@ELK elasticsearch]<span class="comment"># vim /etc/init.d/elasticsearch   查看安装es启动配置文件</span></div><div class="line">[root@ELK elasticsearch]<span class="comment"># service elasticsearch start  启动es </span></div><div class="line">Starting Elasticsearch...</div><div class="line">Waiting <span class="keyword">for</span> Elasticsearch......</div><div class="line">running: PID:31360   服务已启动了。</div><div class="line"></div><div class="line">启动相关服务</div><div class="line">service elasticsearch start</div><div class="line">service elasticsearch status</div><div class="line"></div><div class="line">配置 elasticsearch 服务随系统自动启动</div><div class="line"><span class="comment"># chkconfig --add elasticsearch</span></div><div class="line"></div><div class="line">测试ElasticSearch服务是否正常，预期返回200的状态码</div><div class="line"><span class="comment"># curl -X GET http://localhost:9200</span></div><div class="line">&#123;</div><div class="line">  <span class="string">"name"</span> : <span class="string">"elk"</span>,</div><div class="line">  <span class="string">"cluster_name"</span> : <span class="string">"elasticsearch"</span>,</div><div class="line">  <span class="string">"cluster_uuid"</span> : <span class="string">"-4Rqn4IzS1GfnsodqZD8Tg"</span>,</div><div class="line">  <span class="string">"version"</span> : &#123;</div><div class="line">    <span class="string">"number"</span> : <span class="string">"1.7.2"</span>,</div><div class="line">    <span class="string">"build_hash"</span> : <span class="string">"d38a34e7b75af4e17ead16f156feffa432b22be3"</span>,</div><div class="line">    <span class="string">"build_timestamp"</span> : <span class="string">"2016-01-03T16:28:56Z"</span>,</div><div class="line">    <span class="string">"build_snapshot"</span> : <span class="literal">false</span>,</div><div class="line">    <span class="string">"lucene_version"</span> : <span class="string">"5.5.2"</span></div><div class="line">  &#125;,</div><div class="line">  <span class="string">"tagline"</span> : <span class="string">"You Know, for Search"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="安装-head、marvel、bigdesk插件"><a href="#安装-head、marvel、bigdesk插件" class="headerlink" title="安装 head、marvel、bigdesk插件:"></a>安装 head、marvel、bigdesk插件:</h4><h6 id="head插件"><a href="#head插件" class="headerlink" title="head插件"></a>head插件</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">插件安装方法1：</div><div class="line">/usr/<span class="built_in">local</span>/elasticsearch/bin/plugin -install mobz/elasticsearch-head</div><div class="line">重启es 即可。</div><div class="line">打开http://localhost:9200/_plugin/head/</div><div class="line"></div><div class="line">插件安装方法2：</div><div class="line">1.https://github.com/mobz/elasticsearch-head下载zip 解压</div><div class="line">2.建立/usr/<span class="built_in">local</span>/elasticsearch/plugins/head/文件</div><div class="line">3.将解压后的elasticsearch-head-master文件夹下的文件copy到/usr/<span class="built_in">local</span>/elasticsearch/plugins/head/</div><div class="line">重启es 即可。</div><div class="line"></div><div class="line">打开http://localhost:9200/_plugin/head/</div></pre></td></tr></table></figure>
<p><img src="http://7xrthw.com1.z0.glb.clouddn.com/elk_head.png" alt=""></p>
<h6 id="Marvel插件"><a href="#Marvel插件" class="headerlink" title="Marvel插件"></a>Marvel插件</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">Elasticsearch 的集群和数据管理界面 Marvel 非常赞，可惜只对开发环境免费，</div><div class="line">参考链接：https://www.elastic.co/guide/en/marvel/current/configuration.html</div><div class="line"></div><div class="line">插件安装</div><div class="line">/usr/<span class="built_in">local</span>/elasticsearch/bin/plugin -i elasticsearch/marvel/latest</div><div class="line"></div><div class="line">重启es 即可。</div><div class="line">完成后重启服务访问 http://192.168.1.234:9200/_plugin/marvel/</div><div class="line"></div><div class="line">如何看不到下面的页面，就修改下这里的参数看看有没有配置：vim elasticsearch.yml  </div><div class="line">network.host: 192.168.1.234  </div><div class="line">在重启es 然后在查看就有数据。</div></pre></td></tr></table></figure>
<p><img src="http://7xrthw.com1.z0.glb.clouddn.com/elk_marvel.png" alt=""></p>
<h4 id="bigdesk插件"><a href="#bigdesk插件" class="headerlink" title="bigdesk插件"></a>bigdesk插件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">看需求安装</div><div class="line">功能: 监控查看cpu、内存使用情况,索引数据、搜索情况,http连接数等</div><div class="line">安装</div><div class="line"><span class="comment">#/elstaicsearch/bin/plugin -i lukas-vlcek/bigdesk</span></div><div class="line">重启es 即可。</div><div class="line">完成后重启服务访问 http://192.168.1.234:9200/_plugin/bigdesk</div></pre></td></tr></table></figure>
<p><img src="http://7xrthw.com1.z0.glb.clouddn.com/elk_bigdesk.png" alt=""></p>
<h4 id="安装Kibana"><a href="#安装Kibana" class="headerlink" title="安装Kibana:"></a>安装Kibana:</h4><p>在es机器上面安装kibana.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">到https://www.elastic.co/downloads/kibana  找合适的版本。</div><div class="line">每个版本下面有这么一行内容，一定要注意这些内容：Compatible with Elasticsearch 1.4.4 - 1.7</div><div class="line"><span class="built_in">cd</span> /opt/software/  &amp;&amp; wget https://download.elastic.co/kibana/kibana/kibana-4.1.2-linux-x64.tar.gz</div><div class="line"><span class="comment">#解压</span></div><div class="line"></div><div class="line">＃tar zxvf kibana-4.1.2-linux-x64.tar.gz -C /usr/<span class="built_in">local</span> </div><div class="line">＃<span class="built_in">cd</span>  /usr/<span class="built_in">local</span>/ &amp;&amp; mv kibana-4.1.2-linux-x64 kibana</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#创建kibana启动脚本服务</span></div><div class="line">vi /etc/rc.d/init.d/kibana</div><div class="line"></div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment">### BEGIN INIT INFO</span></div><div class="line"><span class="comment"># Provides:          kibana</span></div><div class="line"><span class="comment"># Default-Start:     2 3 4 5</span></div><div class="line"><span class="comment"># Default-Stop:      0 1 6</span></div><div class="line"><span class="comment"># Short-Description: Runs kibana daemon</span></div><div class="line"><span class="comment"># Description: Runs the kibana daemon as a non-root user</span></div><div class="line"><span class="comment">### END INIT INFO</span></div><div class="line"></div><div class="line"><span class="comment"># Process name</span></div><div class="line">NAME=kibana</div><div class="line">DESC=<span class="string">"Kibana4"</span></div><div class="line">PROG=<span class="string">"/etc/init.d/kibana"</span></div><div class="line"></div><div class="line"><span class="comment"># Configure location of Kibana bin</span></div><div class="line">KIBANA_BIN=/usr/<span class="built_in">local</span>/kibana/bin</div><div class="line"></div><div class="line"><span class="comment"># PID Info</span></div><div class="line">PID_FOLDER=/var/run/kibana/</div><div class="line">PID_FILE=/var/run/kibana/<span class="variable">$NAME</span>.pid</div><div class="line">LOCK_FILE=/var/lock/subsys/<span class="variable">$NAME</span></div><div class="line">PATH=/bin:/usr/bin:/sbin:/usr/sbin:<span class="variable">$KIBANA_BIN</span></div><div class="line">DAEMON=<span class="variable">$KIBANA_BIN</span>/<span class="variable">$NAME</span></div><div class="line"></div><div class="line"><span class="comment"># Configure User to run daemon process</span></div><div class="line">DAEMON_USER=root</div><div class="line"><span class="comment"># Configure logging location</span></div><div class="line">KIBANA_LOG=/var/<span class="built_in">log</span>/kibana.log</div><div class="line"></div><div class="line"><span class="comment"># Begin Script</span></div><div class="line">RETVAL=0</div><div class="line"></div><div class="line"><span class="keyword">if</span> [ `id -u` <span class="_">-ne</span> 0 ]; <span class="keyword">then</span></div><div class="line">        <span class="built_in">echo</span> <span class="string">"You need root privileges to run this script"</span></div><div class="line">        <span class="built_in">exit</span> 1</div><div class="line"><span class="keyword">fi</span></div><div class="line"></div><div class="line"><span class="comment"># Function library</span></div><div class="line">. /etc/init.d/<span class="built_in">functions</span></div><div class="line"> </div><div class="line"><span class="function"><span class="title">start</span></span>() &#123;</div><div class="line">        <span class="built_in">echo</span> -n <span class="string">"Starting <span class="variable">$DESC</span> : "</span></div><div class="line"></div><div class="line">pid=`pidofproc -p <span class="variable">$PID_FILE</span> kibana`</div><div class="line">        <span class="keyword">if</span> [ -n <span class="string">"<span class="variable">$pid</span>"</span> ] ; <span class="keyword">then</span></div><div class="line">                <span class="built_in">echo</span> <span class="string">"Already running."</span></div><div class="line">                <span class="built_in">exit</span> 0</div><div class="line">        <span class="keyword">else</span></div><div class="line">        <span class="comment"># Start Daemon</span></div><div class="line"><span class="keyword">if</span> [ ! <span class="_">-d</span> <span class="string">"<span class="variable">$PID_FOLDER</span>"</span> ] ; <span class="keyword">then</span></div><div class="line">                        mkdir <span class="variable">$PID_FOLDER</span></div><div class="line">                <span class="keyword">fi</span></div><div class="line">daemon --user=<span class="variable">$DAEMON_USER</span> --pidfile=<span class="variable">$PID_FILE</span> <span class="variable">$DAEMON</span> 1&gt;<span class="string">"<span class="variable">$KIBANA_LOG</span>"</span> 2&gt;&amp;1 &amp;</div><div class="line">                sleep 2</div><div class="line">                pidofproc node &gt; <span class="variable">$PID_FILE</span></div><div class="line">                RETVAL=$?</div><div class="line">                [[ $? <span class="_">-eq</span> 0 ]] &amp;&amp; success || failure</div><div class="line"><span class="built_in">echo</span></div><div class="line">                [ <span class="variable">$RETVAL</span> = 0 ] &amp;&amp; touch <span class="variable">$LOCK_FILE</span></div><div class="line">                <span class="built_in">return</span> <span class="variable">$RETVAL</span></div><div class="line">        <span class="keyword">fi</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="title">reload</span></span>()</div><div class="line">&#123;</div><div class="line">    <span class="built_in">echo</span> <span class="string">"Reload command is not implemented for this service."</span></div><div class="line">    <span class="built_in">return</span> <span class="variable">$RETVAL</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="title">stop</span></span>() &#123;</div><div class="line">        <span class="built_in">echo</span> -n <span class="string">"Stopping <span class="variable">$DESC</span> : "</span></div><div class="line">        killproc -p <span class="variable">$PID_FILE</span> <span class="variable">$DAEMON</span></div><div class="line">        RETVAL=$?</div><div class="line"><span class="built_in">echo</span></div><div class="line">        [ <span class="variable">$RETVAL</span> = 0 ] &amp;&amp; rm <span class="_">-f</span> <span class="variable">$PID_FILE</span> <span class="variable">$LOCK_FILE</span></div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$1</span>"</span> <span class="keyword">in</span></div><div class="line">  start)</div><div class="line">        start</div><div class="line">;;</div><div class="line">  stop)</div><div class="line">        stop</div><div class="line">        ;;</div><div class="line">  status)</div><div class="line">        status -p <span class="variable">$PID_FILE</span> <span class="variable">$DAEMON</span></div><div class="line">        RETVAL=$?</div><div class="line">        ;;</div><div class="line">  restart)</div><div class="line">        stop</div><div class="line">        start</div><div class="line">        ;;</div><div class="line">  reload)</div><div class="line">reload</div><div class="line">;;</div><div class="line">  *)</div><div class="line"><span class="comment"># Invalid Arguments, print the following message.</span></div><div class="line">        <span class="built_in">echo</span> <span class="string">"Usage: <span class="variable">$0</span> &#123;start|stop|status|restart&#125;"</span> &gt;&amp;2</div><div class="line"><span class="built_in">exit</span> 2</div><div class="line">        ;;</div><div class="line"><span class="keyword">esac</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#修改启动权限</span></div><div class="line">chmod +x /etc/rc.d/init.d/kibana</div><div class="line"></div><div class="line"><span class="comment">#启动kibana服务</span></div><div class="line">service kibana start</div><div class="line">service kibana status</div><div class="line"></div><div class="line"><span class="comment">#查看端口</span></div><div class="line"></div><div class="line">netstat -nltp</div><div class="line"></div><div class="line">Active Internet connections (only servers)</div><div class="line">Proto Recv-Q Send-Q Local Address               Foreign Address             State       PID/Program name   </div><div class="line">tcp        0      0 0.0.0.0:9200                0.0.0.0:*                   LISTEN      1765/java           </div><div class="line">tcp        0      0 0.0.0.0:9300                0.0.0.0:*                   LISTEN      1765/java           </div><div class="line">tcp        0      0 0.0.0.0:22                  0.0.0.0:*                   LISTEN      1509/sshd           </div><div class="line">tcp        0      0 0.0.0.0:5601                0.0.0.0:*                   LISTEN      1876/node           </div><div class="line">tcp        0      0 :::22                       :::*                        LISTEN      1509/sshd</div></pre></td></tr></table></figure>
<h4 id="配置Kibana："><a href="#配置Kibana：" class="headerlink" title="配置Kibana："></a>配置Kibana：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">#编辑kibana.yaml  修改端口，设置host 可以设置本地服务器IP</span></div><div class="line">vi /usr/<span class="built_in">local</span>/kibana/config/kibana.yml</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># Kibana is served by a back end server. This controls which port to use.</span></div><div class="line"></div><div class="line">port: 5601</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># The host to bind the server to.</span></div><div class="line">host: <span class="string">"0.0.0.0"</span></div><div class="line"></div><div class="line"><span class="comment"># The Elasticsearch instance to use for all your queries.</span></div><div class="line">elasticsearch_url: <span class="string">"http://localhost:9200"</span></div><div class="line"></div><div class="line"><span class="comment"># preserve_elasticsearch_host true will send the hostname specified in `elasticsearch`. If you set it to false,</span></div><div class="line"><span class="comment"># then the host you use to connect to *this* Kibana instance will be sent.</span></div><div class="line">elasticsearch_preserve_host: <span class="literal">true</span></div><div class="line"></div><div class="line"><span class="comment"># Kibana uses an index in Elasticsearch to store saved searches, visualizations</span></div><div class="line"><span class="comment"># and dashboards. It will create a new index if it doesn't already exist.</span></div><div class="line">kibana_index: <span class="string">".kibana"</span></div><div class="line"></div><div class="line"><span class="comment"># If your Elasticsearch is protected with basic auth, this is the user credentials</span></div><div class="line"><span class="comment"># used by the Kibana server to perform maintence on the kibana_index at statup. Your Kibana</span></div><div class="line"><span class="comment"># users will still need to authenticate with Elasticsearch (which is proxied thorugh</span></div><div class="line"><span class="comment"># the Kibana server)</span></div><div class="line"><span class="comment"># kibana_elasticsearch_username: user</span></div><div class="line"><span class="comment"># kibana_elasticsearch_password: pass</span></div><div class="line"></div><div class="line"><span class="comment"># If your Elasticsearch requires client certificate and key</span></div><div class="line"><span class="comment"># kibana_elasticsearch_client_crt: /path/to/your/client.crt</span></div><div class="line"><span class="comment"># kibana_elasticsearch_client_key: /path/to/your/client.key</span></div><div class="line"></div><div class="line"><span class="comment"># If you need to provide a CA certificate for your Elasticsarech instance, put</span></div><div class="line"><span class="comment"># the path of the pem file here.</span></div><div class="line"><span class="comment"># ca: /path/to/your/CA.pem</span></div><div class="line"></div><div class="line"><span class="comment"># The default application to load.</span></div><div class="line">default_app_id: <span class="string">"discover"</span></div><div class="line"></div><div class="line"><span class="comment"># Time in milliseconds to wait for elasticsearch to respond to pings, defaults to</span></div><div class="line"><span class="comment"># request_timeout setting</span></div><div class="line"><span class="comment"># ping_timeout: 1500</span></div><div class="line"></div><div class="line"><span class="comment"># Time in milliseconds to wait for responses from the back end or elasticsearch.</span></div><div class="line"><span class="comment"># This must be &gt; 0</span></div><div class="line">request_timeout: 300000</div><div class="line"></div><div class="line"><span class="comment"># Time in milliseconds for Elasticsearch to wait for responses from shards.</span></div><div class="line"><span class="comment"># Set to 0 to disable.</span></div><div class="line">shard_timeout: 0</div><div class="line"></div><div class="line"><span class="comment"># Time in milliseconds to wait for Elasticsearch at Kibana startup before retrying</span></div><div class="line"><span class="comment"># startup_timeout: 5000</span></div><div class="line"></div><div class="line"><span class="comment"># Set to false to have a complete disregard for the validity of the SSL</span></div><div class="line"><span class="comment"># certificate.</span></div><div class="line">verify_ssl: <span class="literal">true</span></div><div class="line"></div><div class="line"><span class="comment"># SSL for outgoing requests from the Kibana Server (PEM formatted)</span></div><div class="line"><span class="comment"># ssl_key_file: /path/to/your/server.key</span></div><div class="line"><span class="comment"># ssl_cert_file: /path/to/your/server.crt</span></div><div class="line"></div><div class="line"><span class="comment"># Set the path to where you would like the process id file to be created.</span></div><div class="line"><span class="comment"># pid_file: /var/run/kibana.pid</span></div><div class="line"></div><div class="line"><span class="comment"># If you would like to send the log output to a file you can set the path below.</span></div><div class="line"><span class="comment"># This will also turn off the STDOUT log output.</span></div><div class="line"><span class="comment"># log_file: ./kibana.log</span></div><div class="line"></div><div class="line"><span class="comment"># Plugins that are included in the build, and no longer found in the plugins/ folder</span></div><div class="line">bundled_plugin_ids:</div><div class="line">- plugins/dashboard/index</div><div class="line">- plugins/discover/index</div><div class="line">- plugins/doc/index</div><div class="line">- plugins/kibana/index</div><div class="line">- plugins/markdown_vis/index</div><div class="line">- plugins/metric_vis/index</div><div class="line">- plugins/settings/index</div><div class="line">- plugins/table_vis/index</div><div class="line">- plugins/vis_types/index</div><div class="line">- plugins/visualize/index</div></pre></td></tr></table></figure>
<h4 id="安装Logstash"><a href="#安装Logstash" class="headerlink" title="安装Logstash"></a>安装Logstash</h4><p>客户端：系统centos 6.7   ip:192.168.1.235 </p>
<h6 id="rpm安装"><a href="#rpm安装" class="headerlink" title="rpm安装"></a>rpm安装</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">#下载rpm包</span></div><div class="line">wget https://download.elastic.co/logstash/logstash/packages/centos/logstash-1.5.4-1.noarch.rpm</div><div class="line"><span class="comment">#安装</span></div><div class="line">yum localinstall logstash-1.5.4-1.noarch.rpm</div><div class="line"></div><div class="line">这里修改下hosts：vim /etc/hosts</div><div class="line">127.0.0.1   tomcat_A1</div></pre></td></tr></table></figure>
<h6 id="源码安装"><a href="#源码安装" class="headerlink" title="源码安装"></a>源码安装</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line">我这里源码包安装</div><div class="line"><span class="comment"># wget https://download.elasticsearch.org/logstash/logstash/logstash-1.5.1.tar.gz</span></div><div class="line"><span class="comment">#curl -O https://download.elastic.co/logstash/logstash/logstash-1.5.4.tar.gz</span></div><div class="line"><span class="comment">#tar -zxvf logstash-1.5.1.tar.gz</span></div><div class="line"><span class="comment">#mv logstash-1.5.1 /usr/local/</span></div><div class="line"><span class="comment">#ln -s /usr/local/logstash-1.5.1/ /usr/local/logstash</span></div><div class="line"></div><div class="line">下载启动脚本</div><div class="line">生产都是运行在后台的，我这里源码安装没有init脚本启动。 去Github下载  https://github.com/benet1006/ELK_config.git</div><div class="line"><span class="comment">#cp logstash.init /etc/init.d/logstash</span></div><div class="line"><span class="comment">#chmod +x /etc/init.d/logstash</span></div><div class="line">这个脚本我做过修改。</div><div class="line"></div><div class="line"><span class="comment">#启动logstash服务</span></div><div class="line">service logstash start</div><div class="line">service logstash status</div><div class="line"></div><div class="line"><span class="comment">#查看5000端口</span></div><div class="line">netstat -nltp</div><div class="line"></div><div class="line">Active Internet connections (only servers)</div><div class="line">Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name</div><div class="line">tcp 0 0 0.0.0.0:9200 0.0.0.0:* LISTEN 1765/java</div><div class="line">tcp 0 0 0.0.0.0:9300 0.0.0.0:* LISTEN 1765/java</div><div class="line">tcp 0 0 0.0.0.0:9301 0.0.0.0:* LISTEN 2309/java</div><div class="line">tcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN 1509/sshd</div><div class="line">tcp 0 0 0.0.0.0:5601 0.0.0.0:* LISTEN 1876/node</div><div class="line">tcp 0 0 0.0.0.0:5000 0.0.0.0:* LISTEN 2309/java</div><div class="line">tcp 0 0 :::22 :::* LISTEN 1509/sshd</div><div class="line"></div><div class="line"></div><div class="line">修改启动脚本</div><div class="line">vim /etc/init.d/logstash </div><div class="line">指定的目录自己源码安装的路径。</div><div class="line"></div><div class="line">name=logstash</div><div class="line">pidfile=<span class="string">"/var/run/<span class="variable">$name</span>.pid"</span></div><div class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$JAVA_HOME</span>/jre/lib/rt.jar:<span class="variable">$JAVA_HOME</span>/lib/dt.jar:<span class="variable">$JAVA_HOME</span>/lib/tools.jar</div><div class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin</div><div class="line">LS_USER=logstash</div><div class="line">LS_GROUP=logstash</div><div class="line">LS_HOME=/usr/<span class="built_in">local</span>/logstash 安装路径</div><div class="line">LS_HEAP_SIZE=<span class="string">"1000m"</span></div><div class="line">LS_JAVA_OPTS=<span class="string">"-Djava.io.tmpdir=<span class="variable">$&#123;LS_HOME&#125;</span>"</span></div><div class="line">LS_LOG_DIR=/usr/<span class="built_in">local</span>/logstash</div><div class="line">LS_LOG_FILE=<span class="string">"<span class="variable">$&#123;LS_LOG_DIR&#125;</span>/<span class="variable">$name</span>.log"</span></div><div class="line">LS_CONF_FILE=/etc/logstash.conf     收集日志的规则conf</div><div class="line">LS_OPEN_FILES=16384</div><div class="line">LS_NICE=19</div><div class="line">LS_OPTS=<span class="string">""</span></div><div class="line"></div><div class="line">https://www.elastic.co/guide/en/logstash/current/plugins-inputs-file.html</div><div class="line">这个是<span class="built_in">log</span> stash的官方文档的配置说明。</div><div class="line">这个配置说明上面我先修改下我之前的配置文件。</div></pre></td></tr></table></figure>
<h4 id="logstash测试："><a href="#logstash测试：" class="headerlink" title="logstash测试："></a>logstash测试：</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">将<span class="selector-tag">logstash</span><span class="selector-class">.ooxx</span><span class="selector-class">.com</span>换成你自己的域名。同时，到域名解析那添加<span class="selector-tag">elk</span><span class="selector-class">.ooxx</span><span class="selector-class">.com</span>的<span class="selector-tag">A</span>记录。</div><div class="line">使用那种方式都行，不过如果<span class="selector-tag">logstash</span>服务端的<span class="selector-tag">IP</span>地址变换了，证书不可用了。</div><div class="line"></div><div class="line">这里查看日志有主机名返回不然就跟下面一样 <span class="selector-tag">host</span>：0<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.0</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">＃/usr/<span class="built_in">local</span>/logstash/bin/logstash <span class="_">-e</span> <span class="string">'input &#123; stdin&#123; &#125; &#125; output &#123; stdout&#123;codec =&gt; rubydebug&#125; &#125;'</span></div></pre></td></tr></table></figure>
<p><img src="http://7xrthw.com1.z0.glb.clouddn.com/elk_logstash.png" alt=""></p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">配置log stash－实现系统日志收集input</div><div class="line"></div><div class="line">vim <span class="meta-keyword">/etc/</span>logstash.conf  这里我们之间先创建一个.conf  我们写在／etc/ 编写好以后让logstash去调用。</div><div class="line"> <span class="class">input </span>&#123;</div><div class="line"> <span class="class">stdin </span>&#123; &#125;</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> <span class="class">output </span>&#123;</div><div class="line"></div><div class="line"> <span class="class">elasticsearch </span>&#123;</div><div class="line"> host =&gt; <span class="string">"192.168.1.234"</span></div><div class="line"> protocol =&gt; <span class="string">"http"</span></div><div class="line"> &#125;</div><div class="line"></div><div class="line"> <span class="class">stdout </span>&#123;</div><div class="line"> codec =&gt; rubydebug</div><div class="line"> &#125;</div><div class="line"> &#125;</div><div class="line"></div><div class="line">然后在用logstash去调用</div><div class="line"><span class="meta-keyword">/usr/</span>local<span class="meta-keyword">/logstash/</span>bin/logstash -f <span class="meta-keyword">/etc/</span>logstash.conf</div></pre></td></tr></table></figure>
<p><img src="http://7xrthw.com1.z0.glb.clouddn.com/elk_logstash_01.png" alt=""><br>vim /etc/logstash.conf   </p>
<p><img src="http://7xrthw.com1.z0.glb.clouddn.com/elk_logstash_03.png" alt=""></p>
<p>官方文档file的配置文件和类型。<br>官方文档下面还有个这个从头读到尾这样规定，这个非常好，这里我在做修改。</p>
<p><img src="http://7xrthw.com1.z0.glb.clouddn.com/elk_logstash5.png" alt=""></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">然后在启动<span class="built_in">log</span> stash脚本.</div><div class="line"></div><div class="line"><span class="comment"># /etc/init.d/logstash start</span></div><div class="line"><span class="comment">## ps -ef | grep logstash</span></div><div class="line"></div><div class="line">启动完了以后在查看下／var/<span class="built_in">log</span>/messages </div><div class="line">然后在登陆到 http://192.168.1.234:9200/_plugin/head/</div></pre></td></tr></table></figure>
<p><img src="http://7xrthw.com1.z0.glb.clouddn.com/elk.logstash06.png" alt=""></p>
<h4 id="扩展阅读"><a href="#扩展阅读" class="headerlink" title="扩展阅读"></a>扩展阅读</h4><p><a href="http://www.chenshake.com/centos-install-7-x-elk-elasticsearchlogstashkibana/" target="_blank" rel="external">CentOS 7.x安装ELK(Elasticsearch+Logstash+Kibana)</a></p>
<p><a href="http://blog.chinaunix.net/xmlrpc.php?r=blog/article&amp;uid=17291169&amp;id=4898582" target="_blank" rel="external">Centos 6.5 安装nginx日志分析系统 elasticsearch + logstash + redis + kibana</a></p>
<p><a href="https://www.ulyaoth.net/threads/logstash-forwarder-and-grok-examples.32413/" target="_blank" rel="external">logstash-forwarder and grok examples</a></p>


                <hr>

                

                <ul class="pager">
                    
                        <li class="previous">
                            <a href="/2016/01/29/日志分析平台/Elasticsearch/logstash如何收集tomcat日志分析/" data-toggle="tooltip" data-placement="top" title="logstash如何写tomcat,redis,nginx日志收集规则">&larr; Previous Post</a>
                        </li>
                    
                    
                </ul>
		 

                

                

            </div>
    <!-- Side Catalog Container -->
        

    <!-- Sidebar Container -->

            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                       
                          <a class="tag" href="/tags/#Log analysis platform" title="Log analysis platform">Log analysis platform</a>
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">

                    
                        <li><a href="http://openskill.cn/" target="_blank">openskill.cn</a></li>
                    
                        <li><a href="http://yuzhouwan.com/" target="_blank">Benedict Jin&#39;s Blog</a></li>
                    
                </ul>
                
            </div>

        </div>
    </div>
</article>








<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("https://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'always',
          placement: 'right',
          icon: '#'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                
                
                    <li>
                        <a target="_blank" href="https://twitter.com/yancyoo">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                
                
                    <li>
                        <a target="_blank" href="https://www.zhihu.com/people/benet1006">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa  fa-stack-1x fa-inverse">知</i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank" href="http://weibo.com/yangcvo">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-weibo fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                

                
                    <li>
                        <a target="_blank"  href="https://github.com/yangcvo">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; Yancy&#39;s blog 2017 
                    <br>
                 Theme by <a href="http://blog.yancy.cc">Yancy</a>
                    <span style="display: inline-block; margin: 0 5px;">
                        <i class="fa fa-heart"></i>
                    </span>
                    Ported by <a href="http://github.com/yangcvo">Github</a>

                    <!--<iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="91px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=kaijun&repo=hexo-theme-huxblog&type=star&count=true" >
                    </iframe>--> 
		</p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js"></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- 
     Because of the native support for backtick-style fenced code blocks 
     right within the Markdown is landed in Github Pages, 
     From V1.6, There is no need for Highlight.js, 
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0  
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/    
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("http://blog.yancy.cc/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->




<!-- Baidu Tongji -->


<!-- Side Catalog -->





<!-- Image to hack wechat -->
<img src="http://blog.yancy.cc/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
