<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="theme-color" content="#33474d">
	<title>å¦‚ä½•åœ¨Nginxç”³è¯·å®‰è£…é…ç½®å…è´¹HTTPSè¯ä¹¦+é˜¿é‡Œäº‘SLBå¦‚ä½•é…ç½®HTTPS | Yancy&#39;s blog</title>
	<link rel="stylesheet" href="/css/style.css" />
	
      <link rel="alternate" href="/atom.xml" title="Yancy&#39;s blog" type="application/atom+xml">
    
</head>

<body>

	<header class="header">
		<nav class="header__nav">
			
				<a href="/" class="header__link">Home</a>
			
				<a href="/tags" class="header__link">Tags</a>
			
				<a href="/archives" class="header__link">ARCHIVES</a>
			
				<a href="/about/About" class="header__link">ABOUT</a>
			
				<a href="http://weibo.com/yangcvo" class="header__link">Weibo</a>
			
				<a href="/atom.xml" class="header__link">RSS</a>
			
		</nav>
		<h1 class="header__title"><a href="/">Yancy&#39;s blog</a></h1>
		<h2 class="header__subtitle">SIMPLICITY IS PREREQUISITE FOR  RELIABILITY</h2>
	</header>

	<main>
		<article>
	
		<h1>å¦‚ä½•åœ¨Nginxç”³è¯·å®‰è£…é…ç½®å…è´¹HTTPSè¯ä¹¦+é˜¿é‡Œäº‘SLBå¦‚ä½•é…ç½®HTTPS</h1>
	
	<div class="article__infos">
		<span class="article__date">2016-11-23</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/nginx/">nginx</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Nginx/">Nginx</a> <a class="article__tag-link" href="/tags/Web-Service/">Web Service</a>
			</span>
		
	</div>

	

	
		<h2 id="å¦‚ä½•åœ¨Nginxç”³è¯·å®‰è£…é…ç½®å…è´¹HTTPSè¯ä¹¦"><a href="#å¦‚ä½•åœ¨Nginxç”³è¯·å®‰è£…é…ç½®å…è´¹HTTPSè¯ä¹¦" class="headerlink" title="å¦‚ä½•åœ¨Nginxç”³è¯·å®‰è£…é…ç½®å…è´¹HTTPSè¯ä¹¦"></a>å¦‚ä½•åœ¨Nginxç”³è¯·å®‰è£…é…ç½®å…è´¹HTTPSè¯ä¹¦</h2><p>HTTPSåœ¨å„å¤§äº’è”ç½‘ç«™å·²ç»æˆä¸ºæ ‡é…ï¼Œå°±è¿æŸåº¦ä¹Ÿåœ¨å‰ä¸ä¹…å…¨é¢å¯ç”¨HTTPSï¼Œå¾ˆå¤šå°ç½‘ç«™ä¹Ÿé…ç½®äº†HTTPSï¼Œè¿™æ˜¯æœªæ¥çš„ä¸€ç§è¶‹åŠ¿.HTTPSçš„å¥½å¤„å¤šå¤šï¼Œå¯ä»¥é˜²æ­¢å„ç§æ”»å‡»åŠ«æŒï¼Œè¿è¥å•†å¹¿å‘Šæ¤å…¥ï¼Œå®¢æˆ·ä¼ è¾“ä¿¡æ¯æ³„éœ²ç­‰é—®é¢˜ã€‚ä¸ºäº†è®©HTTPSèƒ½å¤Ÿå…¨é¢æ™®åŠï¼Œè®©æˆ‘ä»¬åŠ å¯†é¡¹ç›®åº”è¿è€Œç”Ÿï¼Œå®ƒç”±äº’è”ç½‘å®‰å…¨ç ”ç©¶å°ç»„ISRGï¼ˆäº’è”ç½‘å®‰å…¨ç ”ç©¶å°ç»„ï¼‰æä¾›æœåŠ¡ï¼Œå¾ˆæ—©ä¹‹å‰æˆ‘å°±åœ¨å…³æ³¨ <a href="https://letsencrypt.org/" target="_blank" rel="external">Letâ€™s Encrypt</a>è¿™ä¸ªå…è´¹ã€è‡ªåŠ¨åŒ–ã€å¼€æ”¾çš„è¯ä¹¦ç­¾å‘æœåŠ¡ã€‚<br>ISRGæ˜¯æ¥è‡ªç¾å›½åŠ åˆ©ç¦å°¼äºšå·çš„ä¸€ä¸ªå…¬ç›Šç»„ç»‡.Letâ€™s Encryptå¾—åˆ°äº†Mozillaï¼ŒCiscoå’ŒChromeç­‰ä¼—å¤šå…¬å¸å’Œæœºæ„çš„æ”¯æŒã€‚</p>
<p>ç”³è¯· <code>Let&#39;s Encrypt</code> è¯ä¹¦ä¸ä½†å…è´¹ï¼Œè¿˜éå¸¸ç®€å•ï¼Œè™½ç„¶æ¯æ¬¡åªæœ‰ 90 å¤©çš„æœ‰æ•ˆæœŸï¼Œä½†å¯ä»¥é€šè¿‡è„šæœ¬å®šæœŸæ›´æ–°ï¼Œé…å¥½ä¹‹åä¸€åŠ³æ°¸é€¸ã€‚æœ¬æ•™ç¨‹äº²æµ‹æœ‰æ•ˆï¼Œå¸Œæœ›å¯¹æ­£åœ¨å¯»æ‰¾å…è´¹HTTPSæ–¹æ¡ˆçš„ä½ æœ‰ä¸€å®šçš„å¸®åŠ©ï¼Œæœ¬æ–‡è®°å½•æœ¬ç«™ç”³è¯·è¿‡ç¨‹å’Œé‡åˆ°çš„é—®é¢˜ã€‚</p>
<p>æŒ‰ç…§æˆ‘ä»¬çš„åŠ å¯†å®˜æ–¹æä¾›çš„å·¥å…·å®‰è£…HTTPSçš„è¯ä¸è¿‡äºå¤æ‚ï¼Œäºæ˜¯æœ‰å¥½å¿ƒäººæä¾›äº†æ›´ä¸ºè½»å·§çš„å·¥å…·å®‰è£…ï¼Œæè‡´çº¤å·§è¯ç”Ÿäº†ï¼Œå®ƒçš„ä»£ç é‡åœ¨200è¡Œå†…ï¼Œåªéœ€ä¾èµ–çš„Pythonå’ŒOpenSSLçš„ã€‚</p>
<h3 id="ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºLetâ€™s-EncryptåŠ å¯†è´¦å·"><a href="#ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºLetâ€™s-EncryptåŠ å¯†è´¦å·" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºLetâ€™s EncryptåŠ å¯†è´¦å·"></a>ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºLetâ€™s EncryptåŠ å¯†è´¦å·</h3><p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œä¾‹å¦‚ <code>ssl</code>ç”¨æ¥å­˜æ”¾å„ç§ä¸´æ—¶æ–‡ä»¶å’Œæœ€åçš„è¯ä¹¦æ–‡ä»¶ã€‚è¿›å…¥è¿™ä¸ªç›®å½•ï¼Œåˆ›å»ºä¸€ä¸ª<code>RSA</code>ç§é’¥ç”¨äº Letâ€™s Encrypt è¯†åˆ«ä½ çš„èº«ä»½ï¼š</p>
<p>è®©æˆ‘ä»¬åŠ å¯†ä½¿ç”¨ä¸€ä¸ªç§é’¥æ¥è¿›è¡Œè´¦å·çš„åˆ›å»ºä¸ç™»é™†ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä½¿ç”¨opensslåˆ›å»ºä¸€ä¸ª<code>account.key</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@ihaozhuo1 srv]<span class="comment"># mkdir ssl &amp;&amp; cd ssl</span></div><div class="line">[root@ihaozhuo1 ssl]<span class="comment"># openssl genrsa 4096 &gt; account.key</span></div><div class="line">Generating RSA private key, 4096 bit long modulus</div><div class="line">...........................++</div><div class="line">...........................++</div><div class="line">e is 65537 (0x10001)</div></pre></td></tr></table></figure>
<h3 id="ç¬¬äºŒæ­¥ï¼šåˆ›å»ºåŸŸåçš„CSRï¼ˆè¯ä¹¦ç­¾åè¯·æ±‚ï¼‰"><a href="#ç¬¬äºŒæ­¥ï¼šåˆ›å»ºåŸŸåçš„CSRï¼ˆè¯ä¹¦ç­¾åè¯·æ±‚ï¼‰" class="headerlink" title="ç¬¬äºŒæ­¥ï¼šåˆ›å»ºåŸŸåçš„CSRï¼ˆè¯ä¹¦ç­¾åè¯·æ±‚ï¼‰"></a>ç¬¬äºŒæ­¥ï¼šåˆ›å»ºåŸŸåçš„CSRï¼ˆè¯ä¹¦ç­¾åè¯·æ±‚ï¼‰</h3><p>è®©æˆ‘ä»¬åŠ å¯†ä½¿ç”¨çš„ACMEåè®®éœ€è¦ä¸€ä¸ªCSRæ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨å®ƒæ¥é‡æ–°ç”³è¯·HTTPSè¯ä¹¦ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥åˆ›å»ºåŸŸåCSRï¼Œåœ¨åˆ›å»ºCSRä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ç»™æˆ‘ä»¬çš„åŸŸååˆ›å»ºä¸€ä¸ªç§é’¥ï¼ˆè¿™ä¸ªå’Œä¸Šé¢çš„è´¦æˆ·ç§é’¥æ— å…³ï¼‰ã€‚<br>æ¥ç€å°±å¯ä»¥ç”Ÿæˆ <code>CSRï¼ˆCertificate Signing Requestï¼Œè¯ä¹¦ç­¾åè¯·æ±‚ï¼‰æ–‡ä»¶äº†ã€‚</code>åœ¨è¿™ä¹‹å‰ï¼Œè¿˜éœ€è¦åˆ›å»ºåŸŸåç§é’¥ï¼ˆä¸€å®šä¸è¦ä½¿ç”¨ä¸Šé¢çš„è´¦æˆ·ç§é’¥ï¼‰ï¼Œæ ¹æ®è¯ä¹¦ä¸åŒç±»å‹ï¼ŒåŸŸåç§é’¥ä¹Ÿå¯ä»¥é€‰æ‹© RSA å’Œ ECC ä¸¤ç§ä¸åŒç±»å‹ã€‚ä»¥ä¸‹ä¸¤ç§æ–¹å¼è¯·æ ¹æ®å®é™…æƒ…å†µäºŒé€‰ä¸€ã€‚</p>
<p><strong>1ï¼‰åˆ›å»º RSA ç§é’¥ï¼ˆå…¼å®¹æ€§å¥½ï¼‰ï¼š</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">openssl genrsa 4096 &gt; domain.key</div></pre></td></tr></table></figure>
<p><strong>2ï¼‰æ³¨æ„ï¼šä¸€å®šä¸è¦ä½¿ç”¨ä¸Šé¢åˆ›å»ºå¥½çš„account.key æ¥å½“domain.key â—ï¸</strong></p>
<p>æœ‰äº†ç§é’¥æ–‡ä»¶ï¼Œå°±å¯ä»¥åˆ›å»ºç”Ÿæˆ <code>CSRæ–‡ä»¶</code>äº†ã€‚åœ¨ <code>CSR</code>ä¸­æ¨èè‡³å°‘æŠŠåŸŸåå¸¦ <code>www</code> å’Œä¸å¸¦<code>www</code>çš„ä¸¤ç§æƒ…å†µéƒ½åŠ è¿›å»ï¼Œå…¶å®ƒå­åŸŸå¯ä»¥æ ¹æ®éœ€è¦æ·»åŠ ,æ›¿æ¢ä¸‹é¢çš„ihaozhuo.comå³å¯  <code>(ç›®å‰ä¸€å¼ è¯ä¹¦æœ€å¤šå¯ä»¥åŒ…å« 100 ä¸ªåŸŸå)</code></p>
<p><strong>3ï¼‰æ³¨æ„ï¼Œç¨åä¼šè¯´åˆ°ï¼Œæ¯ä¸ªåŸŸåéƒ½ä¼šæ¶‰åŠåˆ°éªŒè¯ï¼‰</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">ï¼ƒå•ä¸ªåŸŸå</div><div class="line"></div><div class="line">openssl req -new -sha256 -key domain.key -subjâ€œ/CN=ihaozhuo.ccomâ€&gt; domain.csr</div><div class="line"></div><div class="line">ï¼ƒå¤šä¸ªåŸŸåï¼ˆå¦‚æœä½ æœ‰å¤šä¸ªåŸŸåï¼Œæ¯”å¦‚ï¼šwww.ihaozhuo.com å’Œihaozhuo.comï¼Œä½¿ç”¨è¿™ç§æ–¹å¼ï¼‰</div><div class="line"></div><div class="line">openssl req -new -sha256 -key domain.key -subj <span class="string">"/"</span> -reqexts SAN -config &lt;(cat /etc/ssl/openssl.cnf &lt;(<span class="built_in">printf</span> <span class="string">"[SAN]\nsubjectAltName=DNS:ihaozhuo.com,DNS:www.ihaozhuo.com"</span>)) &gt; domain.csr</div></pre></td></tr></table></figure>
<p><strong>4ï¼‰è¯´æ˜ï¼šihaozhuo.comï¼Œwww.ihaozhuo.com æ›¿æ¢æˆä½ çš„åŸŸåæ‰§è¡Œè¿™ä¸€æ­¥æ—¶ï¼Œéœ€è¦æŒ‡å®šopenssl.cnfæ–‡ä»¶ï¼Œä¸€èˆ¬è¿™ä¸ªæ–‡ä»¶åœ¨ä½ çš„opensslå®‰è£…ç›®å½•åº•ä¸‹ã€‚ å¦‚æœæç¤ºæ‰¾ä¸åˆ° /etc/ssl/openssl.cnfæ–‡ä»¶ï¼Œè¯·çœ‹çœ‹/usr/local/openssl/ssl/openssl.cnf å’Œ/etc/pki/tls/openssl.cnfæ˜¯å¦å­˜åœ¨ã€‚</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@ihaozhuo1 ssl]<span class="comment"># find / -name openssl.cnf    ##æŸ¥æ‰¾openssl.cnfæ–‡ä»¶</span></div><div class="line">/etc/pki/tls/openssl.cnf</div><div class="line">[root@ihaozhuo1 ssl]<span class="comment"># ln -s /etc/pki/tls/openssl.cnf /etc/ssl/openssl.cnf    #åšä¸ªè½¯é“¾æ¥ </span></div><div class="line"></div><div class="line">[root@ihaozhuo1 ssl]<span class="comment"># openssl req -new -sha256 -key domain.key -subj "/" -reqexts SAN -config &lt;(cat /etc/ssl/openssl.cnf &lt;(printf "[SAN]\nsubjectAltName=DNS:ihaozhuo.com,DNS:www.ihaozhuo.com")) &gt; domain.csr</span></div></pre></td></tr></table></figure>
<p>å¦‚æœè¿˜æ˜¯ä¸è¡Œï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨äº¤äº’æ–¹å¼åˆ›å»º<code>CSR</code>ï¼ˆéœ€è¦æ³¨æ„ <code>Common Name</code>å¿…é¡»ä¸ºä½ çš„åŸŸåï¼‰ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">openssl req -new -sha256 -key domain.key -out domain.csr</div></pre></td></tr></table></figure>
<h3 id="ç¬¬ä¸‰æ­¥ï¼šé…ç½®åŸŸåéªŒè¯"><a href="#ç¬¬ä¸‰æ­¥ï¼šé…ç½®åŸŸåéªŒè¯" class="headerlink" title="ç¬¬ä¸‰æ­¥ï¼šé…ç½®åŸŸåéªŒè¯"></a>ç¬¬ä¸‰æ­¥ï¼šé…ç½®åŸŸåéªŒè¯</h3><p>CAåœ¨ç­¾å‘DVï¼ˆåŸŸéªŒè¯ï¼‰è¯ä¹¦æ—¶ï¼Œéœ€è¦éªŒè¯åŸŸåæ‰€æœ‰æƒã€‚ä¼ ç»ŸCAçš„éªŒè¯æ–¹å¼ä¸€èˆ¬æ˜¯å¾€<code>admin@ihaozhuo.com</code>å‘éªŒéªŒé‚®ä»¶ï¼Œè€Œè®©æˆ‘ä»¬åŠ å¯†æ˜¯åœ¨ä½ çš„æœåŠ¡å™¨ä¸Šç”Ÿæˆä¸€ä¸ªéšæœºéªŒè¯æ–‡ä»¶ï¼Œå†é€šè¿‡åˆ›å»ºCSRæ—¶æŒ‡å®šçš„åŸŸåè®¿é—®ï¼Œå¦‚æœå¯ä»¥è®¿é—®åˆ™è¡¨æ˜ä½ å¯¹è¿™ä¸ªåŸŸåæœ‰æ§åˆ¶æƒã€‚</p>
<p>é¦–å…ˆåˆ›å»ºç”¨äºå­˜æ”¾éªŒè¯æ–‡ä»¶çš„ç›®å½•ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mkdir -p var/www/challenge</div></pre></td></tr></table></figure>
<p>ç„¶åé…ç½®ä¸€ä¸ª<code>Nginx</code>æœåŠ¡ï¼Œä»¥Nginxä¸ºä¾‹:(æ³¨æ„ï¼šè¿™é‡Œçš„ç«¯å£æ˜¯80ï¼Œä¸æ˜¯443ï¼‰</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">server &#123;</div><div class="line">    </div><div class="line">       listen       80;</div><div class="line">       server_name www.ihaozhuo.com ihaozhuo.com;</div><div class="line">       location /.well-known/acme-challenge/ &#123;</div><div class="line">       <span class="built_in">alias</span> /var/www/challenges/;</div><div class="line">       index  index.html index.php index.jsp index.htm;</div><div class="line">       try_files <span class="variable">$uri</span> =404;</div><div class="line">&#125;</div><div class="line">        error_page   500 502 503 504  /50x.html;</div><div class="line">        location = /50x.html &#123;</div><div class="line">            root   html;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™æ˜¯æˆ‘åœ¨ä¸Šé¢é…ç½®å®Œæˆä»¥åéœ€è¦é‡å¯Nginxï¼Œå…ˆ<code>Nginx -t</code>æ ¡éªŒä¸‹æ˜¯å¦æœ‰æ²¡æœ‰é—®é¢˜ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">[root@ihaozhuo1 conf]<span class="comment"># nginx -t</span></div><div class="line">nginx: the configuration file /usr/<span class="built_in">local</span>/nginx/conf/nginx.conf syntax is ok</div><div class="line">nginx: configuration file /usr/<span class="built_in">local</span>/nginx/conf/nginx.conf <span class="built_in">test</span> is successful</div><div class="line">``` </div><div class="line"></div><div class="line">å¦‚ä½•éªŒè¯ä¸Šé¢è®¾ç½®æ˜¯å¦æˆåŠŸï¼Ÿ æˆ‘ä»¬åªè¦åœ¨ç›®å½•ï¼š/var/www/challenges/ ä¸‹é¢åˆ›å»ºæ–‡ä»¶ï¼štest.html</div><div class="line">ç„¶åé€šè¿‡http://www.ihaozhuo.com/.well-known/acme-challenge/test.html URLè®¿é—®åœ°å€é‚£ä¸ªæ–‡ä»¶ï¼Œå¦‚æœèƒ½è®¿é—®æˆåŠŸè¯´æ˜ä½ é…ç½®æ²¡é—®é¢˜;å¦åˆ™å°±è¯´æ˜é…ç½®é”™è¯¯âŒï¼Œè¿™ä¸€æ­¥ä¸èƒ½å®ç°ä¸‹é¢å°±ä¸èƒ½æˆåŠŸäº†ã€‚</div><div class="line"></div><div class="line">ä»¥ä¸Šé…ç½®ä¼˜å…ˆæŸ¥æ‰¾ `var/www/challenge`ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œå¦‚æœæ‰¾ä¸åˆ°å°±é‡å®šå‘åˆ°` HTTPS` åœ°å€ã€‚è¿™ä¸ªéªŒè¯æœåŠ¡ä»¥åæ›´æ–°è¯ä¹¦è¿˜è¦ç”¨åˆ°ï¼Œå»ºè®®ä¸€ç›´ä¿ç•™ã€‚</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">### ç¬¬å››æ­¥ï¼šè·å–ç½‘ç«™è¯ä¹¦</span></div><div class="line"></div><div class="line">**1ï¼‰ä¸Šé¢é…ç½®å¥½ï¼Œç°åœ¨æˆ‘ä»¬ä½¿ç”¨acme-tiny.pyæ¥è·å–ç½‘ç«™è¯ä¹¦** acme-tinyè„šæœ¬æ–‡ä»¶ä¸ŠGithubä¸‹è½½ï¼š[acme-tiny.py](https://github.com/diafygi/acme-tiny)</div><div class="line"></div><div class="line">**2ï¼‰å…ˆæŠŠ acme-tiny è„šæœ¬ä¿å­˜åˆ°ä¹‹å‰çš„sslç›®å½•**</div><div class="line">```bash</div><div class="line">wget https://raw.githubusercontent.com/diafygi/acme-tiny/master/acme_tiny.py</div></pre></td></tr></table></figure>
<p><strong>3ï¼‰ç„¶åæŒ‡å®šè´¦æˆ·ç§é’¥ã€CSR ä»¥åŠéªŒè¯ç›®å½•ï¼Œæ‰§è¡Œè„šæœ¬æ¥è·å–ç½‘ç«™è¯ä¹¦</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">python acme_tiny.py --account-key ./account.key --csr ./domain.csr --acme-dir /var/www/challenges/ &gt; ./signed.crt</div></pre></td></tr></table></figure>
<p><strong>4ï¼‰å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œå½“å‰ç›®å½•ä¸‹å°±ä¼šç”Ÿæˆä¸€ä¸ª<code>signed.crt</code>è¿™å°±æ˜¯ç”³è¯·å¥½çš„è¯ä¹¦æ–‡ä»¶ï¼Œå¦‚æœè·Ÿæˆ‘ä¸€æ ·æŠ¥é”™äº†è¯·çœ‹ä¸‹é¢</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[root@ihaozhuo1 ssl]<span class="comment"># python acme_tiny.py --account-key ./account.key --csr ./domain.csr --acme-dir /var/www/challenges/ &gt; ./signed.crt</span></div><div class="line">Parsing account key...</div><div class="line">Parsing CSR...</div><div class="line">Registering account...</div><div class="line">Already registered!</div><div class="line">Verifying ihaozhuo.com...</div><div class="line">Traceback (most recent call last):</div><div class="line">  File <span class="string">"acme_tiny.py"</span>, line 198, <span class="keyword">in</span> &lt;module&gt;</div><div class="line">    main(sys.argv[1:])</div><div class="line">  File <span class="string">"acme_tiny.py"</span>, line 194, <span class="keyword">in</span> main</div><div class="line">    signed_crt = get_crt(args.account_key, args.csr, args.acme_dir, <span class="built_in">log</span>=LOGGER, CA=args.ca)</div><div class="line">  File <span class="string">"acme_tiny.py"</span>, line 123, <span class="keyword">in</span> get_crt</div><div class="line">    wellknown_path, wellknown_url))</div><div class="line">ValueError: Wrote file to /var/www/challenges/fWyC6BvCCSlVunoaltJrnEV-ewj6FBpOv7Eu8LluBUg, but couldn<span class="string">'t download http://ihaozhuo.com/.well-known/acme-challenge/fWyC6BvCCSlVunoaltJrnEV-ewj6FBpOv7Eu8LluBUg</span></div></pre></td></tr></table></figure>
<p><strong>5ï¼‰è„šæœ¬é—®é¢˜ï¼š</strong></p>
<ol>
<li>è®°å¾—åœ¨ç½‘ç«™è®°å¾—åŸŸåè§£æè¦å¯¹ï¼Œéƒ½æ˜¯ä½ ç°åœ¨ç”³è¯·è¯ä¹¦è¿™å°å¤–ç½‘è§£æåœ°å€ï¼š <code>http://ihaozhuo.com/</code>ä¸é€šé‚£è§£æå°±å‡ºç°é—®é¢˜äº†ã€‚</li>
<li>ç½‘ä¸Šä¹Ÿæœ‰å¾ˆå¤šäººè¯´åŸŸåDNSæœåŠ¡å™¨è§£æå¯¼è‡´åŸŸåä¸è¡Œï¼Œè¿™ä¸ªéªŒè¯äº†ä»¥åä¸æ˜¯çš„ï¼Œè¿™ä¸ªæ˜¯GitHubè¿™ä¸ªè„šæœ¬<code>acme_tiny.py</code>é—®é¢˜å¯¼è‡´çš„ï¼Œéœ€è¦ç¼–è¾‘è„šæœ¬æ³¨é‡Šæ‰ä¸‹é¢å…¨éƒ¨å†…å®¹å³å¯ 116è¡Œ-123è¡Œï¼š</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#  try:</span></div><div class="line"> <span class="comment">#     resp = urlopen(wellknown_url)</span></div><div class="line"> <span class="comment">#    resp_data = resp.read().decode('utf8').strip()</span></div><div class="line"> <span class="comment">#   assert resp_data == keyauthorization</span></div><div class="line"> <span class="comment"># except (IOError, AssertionError):</span></div><div class="line"> <span class="comment">#    os.remove(wellknown_path)</span></div><div class="line"> <span class="comment">#   raise ValueError("Wrote file to &#123;0&#125;, but couldn't download &#123;1&#125;".format(</span></div><div class="line"> <span class="comment">#      wellknown_path, wellknown_url))</span></div></pre></td></tr></table></figure>
<p>å¦‚æœä¿®æ”¹æ²¡æœ‰ç”¨ï¼Œå¯ä»¥åˆ°æˆ‘è¿™é‡Œä¸‹è½½Githubä¸‹è½½<a href="https://github.com/yangcvo/Let-s-Encrypt" target="_blank" rel="external">acme_tiny.py</a></p>
<p><strong>6ï¼‰ç„¶åä¿å­˜å†æ¬¡è·å–ç½‘ç«™è¯ä¹¦</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[root@ihaozhuo1 ssl]<span class="comment"># python acme_tiny.py --account-key ./account.key --csr ./domain.csr --acme-dir /var/www/challenges/ &gt; ./signed.crt</span></div><div class="line">Parsing account key...</div><div class="line">Parsing CSR...</div><div class="line">Registering account...</div><div class="line">Already registered!</div><div class="line">Verifying ihaozhuo.com...</div><div class="line">ihaozhuo.com verified!</div><div class="line">Verifying www.ihaozhuo.com...</div><div class="line">www.ihaozhuo.com verified!</div><div class="line">Signing certificate...</div><div class="line">Certificate signed!</div></pre></td></tr></table></figure>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zhengshu2.png" alt=""></figure></p>
<p>ãŠ—ï¸ å¦‚æœçœ‹åˆ°å¦‚ä¸Šå†…å®¹ï¼Œé‚£ä¹ˆæ­å–œä½ ï¼Œä½ çš„ç½‘ç«™è¯ä¹¦å·²ç»æˆåŠŸè·å–äº†ã€‚è¿™æ—¶å€™æŸ¥çœ‹ç›®å½•ä¸‹é¢æœ‰å¦‚ä¸‹å‡ ä¸ªæ–‡ä»¶ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@ihaozhuo1 ssl]<span class="comment"># ll</span></div><div class="line">æ€»ç”¨é‡ 36</div><div class="line">-rw-r--r-- 1 root root 3243 3æœˆ  30 16:42 account.key</div><div class="line">drwxr-xr-x 4 root root 4096 3æœˆ  30 17:31 acme-tiny</div><div class="line">-rw-r--r-- 1 root root 9159 3æœˆ  30 19:23 acme_tiny.py</div><div class="line">-rw-r--r-- 1 root root 1639 3æœˆ  30 17:00 domain.csr</div><div class="line">-rw-r--r-- 1 root root 3243 3æœˆ  30 16:53 domain.key</div><div class="line">-rw-r--r-- 1 root root 2159 3æœˆ  30 22:11 signed.crt</div></pre></td></tr></table></figure>
<p>åˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬å·²ç»æˆåŠŸç”³è¯·åˆ°Letâ€™sENcrpytçš„ç½‘ç«™è¯ä¹¦ï¼Œå¯¹äºNginxç”¨æˆ·æˆ‘ä»¬è¿˜éœ€è¦æŠŠLetâ€™s ENcrpytçš„ä¸­é—´è¯ä¹¦åŠ å…¥åˆ°åˆšåˆšç”Ÿæˆçš„signed.crtæ–‡ä»¶ä¸­ã€‚å…·ä½“æ“ä½œï¼š</p>
<h3 id="ç¬¬äº”æ­¥ï¼šå®‰è£…è¯ä¹¦"><a href="#ç¬¬äº”æ­¥ï¼šå®‰è£…è¯ä¹¦" class="headerlink" title="ç¬¬äº”æ­¥ï¼šå®‰è£…è¯ä¹¦"></a>ç¬¬äº”æ­¥ï¼šå®‰è£…è¯ä¹¦</h3><p>è¯ä¹¦ç”Ÿæˆåï¼Œå°±å¯ä»¥æŠŠå®ƒé…ç½®åœ¨web æœåŠ¡å™¨ä¸Šäº†ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒNginxéœ€è¦è¿½åŠ ä¸€ä¸ªLetâ€™s Encryptçš„ä¸­é—´è¯ä¹¦ï¼Œåœ¨ Nginx é…ç½®ä¸­ï¼Œéœ€è¦æŠŠä¸­é—´è¯ä¹¦å’Œç½‘ç«™è¯ä¹¦åˆåœ¨ä¸€èµ·ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">wget -O - https://letsencrypt.org/certs/lets-encrypt-x1-cross-signed.pem &gt; intermediate.pem</div><div class="line">cat signed.crt intermediate.pem &gt; chained.pem</div><div class="line"></div><div class="line">[root@ihaozhuo1 ssl]<span class="comment"># ll</span></div><div class="line">æ€»ç”¨é‡ 36</div><div class="line">-rw-r--r-- 1 root root 3243 3æœˆ  30 22:06 account.key</div><div class="line">-rw-r--r-- 1 root root 9159 3æœˆ  30 19:23 acme_tiny.py</div><div class="line">-rw-r--r-- 1 root root 3834 3æœˆ  30 22:51 chained.pem</div><div class="line">-rw-r--r-- 1 root root 1639 3æœˆ  30 22:07 domain.csr</div><div class="line">-rw-r--r-- 1 root root 3243 3æœˆ  30 22:06 domain.key</div><div class="line">-rw-r--r-- 1 root root 1675 3æœˆ  30 22:51 intermediate.pem</div><div class="line">-rw-r--r-- 1 root root 2159 3æœˆ  30 22:51 signed.crt</div></pre></td></tr></table></figure>
<p><strong>1ï¼‰ç°åœ¨æˆ‘ä»¬å¯ä»¥åœ¨Nginxå¯åŠ¨HTTPSï¼Œä½ å¯ä»¥ç›´æ¥åœ¨ä½ ä¹‹å‰ç½‘ç«™Nginx.confé‡Œé¢é…ç½®</strong></p>
<p>æ³¨æ„âš ï¸ ï¼šä¸ºäº†ä¸å½±å“ç°åœ¨æ­£åœ¨è¿è¡Œçš„ç½‘ç«™ï¼Œåœ¨é…ç½®HTTPSçš„æ—¶å€™æœ€å¥½å°†ä½ ç°åœ¨é…ç½®å¥½çš„æ–‡ä»¶å…¨éƒ¨å¤‡ä»½èµ·æ¥ï¼Œè¿™æ ·ä½ åœ¨å¯åŠ¨HTTPSå‡ºç°é—®é¢˜å¯ä»¥èƒ½å¤Ÿå¿«é€Ÿæ¢å¤å›æ¥ã€‚</p>
<p>Nginxé…ç½®æ–‡ä»¶åŠ å…¥ä»¥ä¸‹é…ç½®ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">server &#123;</div><div class="line">    listen 80;</div><div class="line">    server_name ihaozhuo.com, www.ihaozhuo.com;</div><div class="line"></div><div class="line">    location /.well-known/acme-challenge/ &#123;</div><div class="line">        <span class="built_in">alias</span> /var/www/challenges/;</div><div class="line">        try_files <span class="variable">$uri</span> =404;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    ...the rest of your config</div><div class="line">&#125;</div><div class="line"></div><div class="line">server &#123;</div><div class="line">    listen 443;</div><div class="line">    server_name ihaozhuo.com, www.ihaozhuo.com;</div><div class="line"></div><div class="line">    ssl on;</div><div class="line">    ssl_certificate /srv/ssl/chained.pem;</div><div class="line">    ssl_certificate_key /srv/ssl/domain.key;</div><div class="line">    ssl_session_timeout 5m;</div><div class="line">    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</div><div class="line">    ssl_ciphers ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA;</div><div class="line">    ssl_session_cache shared:SSL:50m;</div><div class="line">    ssl_prefer_server_ciphers on;</div><div class="line"></div><div class="line">    ...the rest of your config</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åœ¨Chromeæµè§ˆå™¨é‡Œé¢ä½ å¯ä»¥è®¿é—®httpså¼€å¤´çš„ï¼Œä½†æ²¡æœ‰çœ‹åˆ°ç»¿è‰²é”æ ‡è®°ï¼Œè¿™æ˜¯å› ä¸ºä½ ç½‘ç«™æœ‰è¯·æ±‚<code>http://xxx</code>èµ„æºï¼Œè¿™ä¸ªé—®é¢˜æˆ‘é‡åˆ°ä»¥åæŸ¥äº†å¾ˆå¤šï¼Œå› ä¸ºæˆ‘ç½‘ç«™å¾ˆæ—©ä¹‹å‰å°±æœ‰äº†ï¼Œé‡Œé¢é…ç½®çš„åœ°å€éƒ½æ˜¯httpè¦ä¿®æ”¹è¿‡æ¥éå¸¸éº»çƒ¦ï¼Œæ‰€ä»¥ç”³è¯·è¯ä¹¦ä¸€å¼€å§‹åŸŸåä¸‹æ¥å°±è¦ç”³è¯·è¿™æ˜¯æœ€å¥½çš„ï¼Œå¦‚æœä½ æƒ…å†µå·²ç»è·Ÿæˆ‘ä¸€æ ·ï¼Œé‚£ä½ éœ€è¦æŠŠæ‰€æœ‰çš„<code>http://xxxx</code> èµ„æºå…¨éƒ¨åˆ‡æ¢æˆï¼š<a href="https://xxx" target="_blank" rel="external">https://xxx</a> çš„èµ„æºï¼Œè¿™æ ·ç»¿è‰²çš„é”æ‰ä¼šå‡ºç°ã€‚<br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/zhengshu.png" alt=""></figure></p>
<h3 id="ç¬¬å…­æ­¥ï¼šå®šæœŸæ›´æ–°"><a href="#ç¬¬å…­æ­¥ï¼šå®šæœŸæ›´æ–°" class="headerlink" title="ç¬¬å…­æ­¥ï¼šå®šæœŸæ›´æ–°"></a>ç¬¬å…­æ­¥ï¼šå®šæœŸæ›´æ–°</h3><p>è®¿é—®æŸ¥çœ‹ä¸‹ç½‘ç«™è¯¦ç»†ä¿¡æ¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">[root@ihaozhuo1 conf]<span class="comment">#  curl -v https://www.ihaozhuo.com/home.html</span></div><div class="line">* About to connect() to www.ihaozhuo.com port 443 (<span class="comment">#0)</span></div><div class="line">*   Trying 120.27.185.86...</div><div class="line">* Connected to www.ihaozhuo.com (120.27.185.86) port 443 (<span class="comment">#0)</span></div><div class="line">* Initializing NSS with certpath: sql:/etc/pki/nssdb</div><div class="line">*   CAfile: /etc/pki/tls/certs/ca-bundle.crt</div><div class="line">  CApath: none</div><div class="line">* Server certificate:</div><div class="line">* 	subject: CN=ihaozhuo.com</div><div class="line">* 	start date: 3æœˆ 30 13:51:00 2017 GMT</div><div class="line">* 	expire date: 6æœˆ 28 13:51:00 2017 GMT</div><div class="line">* 	common name: ihaozhuo.com</div><div class="line">* 	issuer: CN=Let<span class="string">'s Encrypt Authority X3,O=Let'</span>s Encrypt,C=US</div><div class="line">* NSS error -8179 (SEC_ERROR_UNKNOWN_ISSUER)</div><div class="line">* Peer<span class="string">'s Certificate issuer is not recognized.</span></div><div class="line">* Closing connection 0</div><div class="line">curl: (60) Peer's Certificate issuer is not recognized.</div><div class="line">More details here: http://curl.haxx.se/docs/sslcerts.html</div><div class="line"></div><div class="line">curl performs SSL certificate verification by default, using a <span class="string">"bundle"</span></div><div class="line"> of Certificate Authority (CA) public keys (CA certs). If the default</div><div class="line"> bundle file isn<span class="string">'t adequate, you can specify an alternate file</span></div><div class="line"> using the --cacert option.</div><div class="line">If this HTTPS server uses a certificate signed by a CA represented in</div><div class="line"> the bundle, the certificate verification probably failed due to a</div><div class="line"> problem with the certificate (it might be expired, or the name might</div><div class="line"> not match the domain name in the URL).</div><div class="line">If you'd like to turn off curl<span class="string">'s verification of the certificate, use</span></div><div class="line"> the -k (or --insecure) option.</div></pre></td></tr></table></figure>
<p>Letâ€™s Encrypt ç­¾å‘çš„è¯ä¹¦åªæœ‰90å¤©æœ‰æ•ˆæœŸï¼Œä½†å¯ä»¥é€šè¿‡è„šæœ¬å®šæœŸæ›´æ–°ã€‚ä½ å¯ä»¥åˆ›å»ºäº†ä¸€ä¸ªè‡ªåŠ¨æ›´æ–°è„šæœ¬<code>renew_cert.sh</code>ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/usr/bin/sh</span></div><div class="line">python /srv/ssl/acme_tiny.py --account-key /srv/ssl/account.key --csr /srv/ssl/domain.csr --acme-dir /var/www/challenges/ &gt; /srv/ssl/signed.crt || <span class="built_in">exit</span></div><div class="line">wget -O - https://letsencrypt.org/certs/lets-encrypt-x1-cross-signed.pem &gt; intermediate.pem</div><div class="line"></div><div class="line">cat /srv/ssl/signed.crt intermediate.pem &gt; /srv/ssl/chained.pem</div><div class="line">service nginx reload</div></pre></td></tr></table></figure>
<p>ä¿®æ”¹crontabé…ç½®ï¼ŒåŠ å…¥ä»¥ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#æ¯ä¸ªæœˆæ‰§è¡Œä¸€æ¬¡</span></div><div class="line">0 0 1 * * /srv/ssl/renew_cert.sh 2&gt;&gt; /var/<span class="built_in">log</span>/acme_tiny.log</div></pre></td></tr></table></figure>
<p>å¤§åŠŸå‘Šæˆï¼Œä¸è¿‡å…ˆåˆ«æ€¥ï¼Œè®¿é—®ä¸‹è‡ªå·±çš„HTTPSç½‘ç«™æ˜¯å¦æ­£å¸¸ï¼Œä¸å‡ºæ„å¤–çš„è¯ï¼Œç½‘ç«™æ­£å¼å¯ç”¨HTTPSï¼Œä½†æ˜¯ç½‘ç«™å¦‚æœæœ‰ç”¨CDNçš„è¯ï¼Œé‚£ä¹ˆéœ€è¦CDNä¹Ÿæ”¯æŒHTTPSæ‰è¡Œï¼Œå¦åˆ™æ— æ³•æ­£å¸¸åŠ è½½CDNçš„èµ„æºï¼Œç±»ä¼¼çš„é”™è¯¯å¦‚ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Mixed Content: The page at <span class="string">'https://ihaozhuo.com/'</span> was loaded over HTTPS, but requested an insecure script <span class="string">'http://app.h5.ihaozhuo.combdimg.com/yjk/css/jquery.min.js'</span>. This request has been blocked; the content must be served over HTTPS.</div></pre></td></tr></table></figure>
<p>ä¸€ç§è§£å†³æ–¹æ³•å°±æ˜¯ä½¿ç”¨Upyunæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å¯å‚è€ƒï¼šæˆ‘å†™çš„ä¸€ç¯‡æ–‡ç« å¦‚ä½•è§£å†³httpsè·¨ç«™è®¿é—®è¯ä¹¦ä¸å®‰å…¨è®¿é—®ã€‚</p>
<p>ä¸€ç§è§£å†³æ–¹æ³•å°±æ˜¯ä½¿ç”¨ä¸ƒç‰›çš„äº‘å­˜å‚¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å¯å‚è€ƒï¼š<a href="https://blog.blahgeek.com/qiniu-cdn-serve-static/" target="_blank" rel="external">https://blog.blahgeek.com/qiniu-cdn-serve-static/</a></p>
<h2 id="é˜¿é‡Œäº‘SLBå¦‚ä½•é…ç½®HTTPS"><a href="#é˜¿é‡Œäº‘SLBå¦‚ä½•é…ç½®HTTPS" class="headerlink" title="é˜¿é‡Œäº‘SLBå¦‚ä½•é…ç½®HTTPS"></a>é˜¿é‡Œäº‘SLBå¦‚ä½•é…ç½®HTTPS</h2><p>ä½¿ç”¨é˜¿é‡Œäº‘å¾ˆç®€å•ï¼Œä¸éœ€è¦å¤ªå¤šçš„é…ç½®ä¸è¿‡ä¸ªäººè¿˜æ˜¯å–œæ¬¢Nginxå»åšä»£ç†è®¿é—®ã€‚</p>
<p>å…¬å¸åæœŸæ›´æ–°äº†æœ¬åœ°çš„Nginxå»åšè´Ÿè½½å‡è¡¡ç›´æ¥ä½¿ç”¨SLB ï¼Œè¿™é‡Œè®°å½•ä¸‹ç”³è¯·äº†è¯ä¹¦ä»¥ååªéœ€è¦<code>chained.pem</code>å’Œç§é’¥<code>domain.key</code>ã€‚</p>
<p>åœ¨SLBè´Ÿè½½å‡è¡¡å·¦ä¾§æœ‰è¯ä¹¦ç®¡ç†-åˆ›å»ºè¯ä¹¦-é€‰æ‹©æœåŠ¡å™¨è¯ä¹¦ã€‚</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/Nginx-ssl2.png" alt=""></figure></p>
<p>ç„¶ååœ¨è´Ÿè½½å‡è¡¡ä¸Šé¢è®¾ç½®ä¸‹ç›‘å¬ç«¯å£é€‰æ‹©ä¸‹å¯¹åº”è¯ä¹¦å°±å¯ä»¥äº†ã€‚ </p>
<h2 id="å‚è€ƒï¼š"><a href="#å‚è€ƒï¼š" class="headerlink" title="å‚è€ƒï¼š"></a>å‚è€ƒï¼š</h2><p><a href="https://github.com/diafygi/acme-tiny" target="_blank" rel="external">GitHub å®‰è£…æ•™ç¨‹ </a></p>

	

	
		<span class="different-posts"><a href="/2016/11/23/WebæœåŠ¡æŠ€æœ¯/ç”³è¯·è¯ä¹¦Https/å¦‚ä½•åœ¨Nginxç”³è¯·å®‰è£…é…ç½®å…è´¹HTTPSè¯ä¹¦+é˜¿é‡Œäº‘SLBå¦‚ä½•é…ç½®HTTPS/" onclick="window.history.go(-1); return false;">â¬…ï¸ Go back </a></span>

	

</article>

	</main>

	<footer class="footer">
	<div class="footer-content">
		
	      <div class="footer__element">
	<h5>Hi there,</h5>
	<p style="text-align:justify;">my name is Yancy, they know me as RadiantğŸ‘ğŸ‘. This blog is about Bi-data and my live.<br> I like ğŸŒ³ğŸŒ³ğŸŒ³</p>
</div>


	    
	      <div class="footer__element">
	<h5>Check out</h5>
	<ul class="footer-links">
		<li class="footer-links__link"><a href="/archives">Archive</a></li>
		
		  <li class="footer-links__link"><a href="/atom.xml">RSS</a></li>
	    
		<li class="footer-links__link"><a href="/about">about page</a></li>
		<li class="footer-links__link"><a href="/tags">Tags</a></li>
		<li class="footer-links__link"><a href="/categories">Categories</a></li>
	</ul>
</div>

	    

		<div class="footer-credit">
			<span>Â© 2019 Yancy | Powered by <a href="http://blog.yancy.cc/">Yancy</a> | Theme <a href="https://github.com/yangcvo">Yancy_GitHub</a></span>
		</div>

	</div>


</footer>



</body>

</html>
