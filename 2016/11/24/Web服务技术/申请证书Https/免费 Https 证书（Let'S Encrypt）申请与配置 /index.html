<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>免费 Https证书（Let&#39;S Encrypt）申请与配置 | Yancy&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="免费 Https 证书（Let’S Encrypt）申请与配置之前要申请免费的 https 证书操作步骤相当麻烦，今天看到有人在讨论，就搜索了一下。发现现在申请步骤简单多了。 1. 下载 certbot123git clone https://github.com/certbot/certbotcd certbot./certbot-auto --help 解压打开执行就会有相关提示 2. 生成免">
<meta name="keywords" content="Web Service,Nginx">
<meta property="og:type" content="article">
<meta property="og:title" content="免费 Https证书（Let&#39;S Encrypt）申请与配置">
<meta property="og:url" content="http://blog.yancy.cc/2016/11/24/Web服务技术/申请证书Https/免费 Https 证书（Let'S Encrypt）申请与配置 /index.html">
<meta property="og:site_name" content="Yancy&#39;s blog">
<meta property="og:description" content="免费 Https 证书（Let’S Encrypt）申请与配置之前要申请免费的 https 证书操作步骤相当麻烦，今天看到有人在讨论，就搜索了一下。发现现在申请步骤简单多了。 1. 下载 certbot123git clone https://github.com/certbot/certbotcd certbot./certbot-auto --help 解压打开执行就会有相关提示 2. 生成免">
<meta property="og:updated_time" content="2017-04-01T02:03:36.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="免费 Https证书（Let&#39;S Encrypt）申请与配置">
<meta name="twitter:description" content="免费 Https 证书（Let’S Encrypt）申请与配置之前要申请免费的 https 证书操作步骤相当麻烦，今天看到有人在讨论，就搜索了一下。发现现在申请步骤简单多了。 1. 下载 certbot123git clone https://github.com/certbot/certbotcd certbot./certbot-auto --help 解压打开执行就会有相关提示 2. 生成免">
  
  <link rel="stylesheet" href="/css/index.css">
</head>

<body style="


  background-color: #eff0f6

">
  <div id="container">
    <nav id="nav">
  <header class="header">
    <a href="/" class="title">Clover Tuan</a>
  </header>
  <div class="ctnWrap">
    <div class="icons">
      
        
          
            <a href="https://dribbble.com/clovertuan" target="_blank" class="nav-icn iconfont icon-dribbble"></a>
          
        
          
            <a href="https://www.behance.net/clovertuan" target="_blank" class="nav-icn iconfont icon-behance"></a>
          
        
          
            <a href="http://clovertuan.lofter.com/" target="_blank" class="nav-icn iconfont icon-lofter"></a>
          
        
          
            <a href="https://www.instagram.com/clovertuan/" target="_blank" class="nav-icn iconfont icon-instagram"></a>
          
        
          
            <a href="https://github.com/cloverTuan" target="_blank" class="nav-icn iconfont icon-github"></a>
          
        
      
    </div>
    <div class="menu">
      
        
            <a href="/" class="nav-menu ">HOME</a>
          
        
            <a href="/archives" class="nav-menu ">ARCHIVE</a>
          
        
            <a href="/about" class="nav-menu ">ABOUT</a>
          
        
      
    </div>
  </div>
</nav>
    <div id="main"><section class="article">
  <h2 class="title">免费 Https证书（Let&#39;S Encrypt）申请与配置</h2>
  <p class="sub">Nov 24, 2016</p>
  <article class="content">
    <h1 id="免费-Https-证书（Let’S-Encrypt）申请与配置"><a href="#免费-Https-证书（Let’S-Encrypt）申请与配置" class="headerlink" title="免费 Https 证书（Let’S Encrypt）申请与配置"></a>免费 Https 证书（Let’S Encrypt）申请与配置</h1><p>之前要申请免费的 https 证书操作步骤相当麻烦，今天看到有人在讨论，就搜索了一下。发现现在申请步骤简单多了。</p>
<h2 id="1-下载-certbot"><a href="#1-下载-certbot" class="headerlink" title="1. 下载 certbot"></a>1. 下载 certbot</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">git <span class="built_in">clone</span> https://github.com/certbot/certbot</div><div class="line"><span class="built_in">cd</span> certbot</div><div class="line">./certbot-auto --help</div></pre></td></tr></table></figure>
<p>解压打开执行就会有相关提示</p>
<h2 id="2-生成免费证书"><a href="#2-生成免费证书" class="headerlink" title="2. 生成免费证书"></a>2. 生成免费证书</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">./certbot-auto certonly --webroot --agree-tos -v -t --email 邮箱地址 -w 网站根目录 <span class="_">-d</span> 网站域名</div><div class="line">./certbot-auto certonly --webroot --agree-tos -v -t --email keeliizhou@gmail.com -w /path/to/your/web/root <span class="_">-d</span> ihaozhuo.com</div></pre></td></tr></table></figure>
<p>注意 这里 默认会自动生成 /网站根目录/.well-known/acme-challenge，然后 shell 脚本会对应的访问 网站域名<code>/.well-known/acme-challenge</code></p>
<p>如果返回正常就确认了你对这个网站的所有权，就能顺利生成</p>
<h2 id="3-获取证书"><a href="#3-获取证书" class="headerlink" title="3. 获取证书"></a>3. 获取证书</h2><p>如果上面的步骤正常 shell 脚本会展示如下信息：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">- Congratulations! Your certificate and chain have been saved at</div><div class="line">/etc/letsencrypt/live/网站域名/fullchain.pem</div><div class="line">...</div></pre></td></tr></table></figure>
<h2 id="4-生成-dhparams"><a href="#4-生成-dhparams" class="headerlink" title="4. 生成 dhparams"></a>4. 生成 dhparams</h2><p>使用 openssl 工具生成 dhparams</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">openssl dhparam -out /etc/ssl/certs/dhparams.pem 2048</div></pre></td></tr></table></figure>
<h2 id="5-配置-Nginx"><a href="#5-配置-Nginx" class="headerlink" title="5. 配置 Nginx"></a>5. 配置 Nginx</h2><p>打开 nginx server 配置文件加入如下设置：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">listen 443</div><div class="line"></div><div class="line">ssl on;</div><div class="line">ssl_certificate /etc/letsencrypt/live/网站域名/fullchain.pem;</div><div class="line">ssl_certificate_key /etc/letsencrypt/live/网站域名/privkey.pem;</div><div class="line">ssl_dhparam /etc/ssl/certs/dhparams.pem;</div><div class="line">ssl_protocols SSLv3 TLSv1 TLSv1.1 TLSv1.2;</div><div class="line">ssl_ciphers HIGH:!aNULL:!MD5;</div></pre></td></tr></table></figure>
<p>然后重启 nginx 服务就可以了</p>
<h2 id="6-强制跳转-https"><a href="#6-强制跳转-https" class="headerlink" title="6. 强制跳转 https"></a>6. 强制跳转 https</h2><p>https 默认是监听 443 端口的，没开启 https 访问的话一般默认是 80 端口。如果你确定网站 80 端口上的站点都支持 https 的话加入下面的配件可以自动重定向到 https</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">server &#123;</div><div class="line">    listen 80;</div><div class="line">    server_name your.domain.com;</div><div class="line">    <span class="built_in">return</span> 301 https://<span class="variable">$server_name</span><span class="variable">$request_uri</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="7-证书更新"><a href="#7-证书更新" class="headerlink" title="7. 证书更新"></a>7. 证书更新</h2><p>免费证书只有 90 天的有效期，到时需要手动更新 renew。刚好 Let’s encrypt 旗下还有一个 Let’s monitor 免费服务，注册账号添加需要监控的域名，系统会在证书马上到期时发出提醒邮件，非常方便。收到邮件后去后台执行 renew 即可，如果提示成功就表示 renew 成功</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./certbot-auto renew</div></pre></td></tr></table></figure>

  </article>
  <footer class="f-cf">
    
      <a href="/2016/11/24/Node.js-npm/Node.js-Grunt工具搭建后台管理实践/" class="link f-fl">⟵Node.js+Grunt工具搭建后台管理实践</a>
    
    
      <a href="/2016/11/23/Web服务技术/申请证书Https/如何在Nginx申请安装配置免费HTTPS证书+阿里云SLB如何配置HTTPS/" class="link f-fr">如何在Nginx申请安装配置免费HTTPS证书+阿里云SLB如何配置HTTPS⟶</a>
    
  </footer>
</section></div>
    <footer id="footer" class="f-cf">
  d.guangying@foxmail.com
  
    
      
        · <a href="https://dribbble.com/clovertuan" target="_blank" class="nav-icn">Dribbble</a>
      
    
      
        · <a href="https://www.behance.net/clovertuan" target="_blank" class="nav-icn">Behance</a>
      
    
      
        · <a href="http://clovertuan.lofter.com/" target="_blank" class="nav-icn">Lofter</a>
      
    
      
        · <a href="https://www.instagram.com/clovertuan/" target="_blank" class="nav-icn">Instagram</a>
      
    
      
        · <a href="https://github.com/cloverTuan" target="_blank" class="nav-icn">GitHub</a>
      
    
  
  <span class="copyright">All rights reserved @Clover Tuan</span>
</footer>
  </div>
</body>
</html>