<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="theme-color" content="#33474d">
	<title>Ansibleå°ç»“ï¼ˆå››ï¼‰Ad-hocä¸commandsæ¨¡å— | Yancy&#39;s blog</title>
	<link rel="stylesheet" href="/css/style.css" />
	
      <link rel="alternate" href="/atom.xml" title="Yancy&#39;s blog" type="application/atom+xml">
    
</head>

<body>

	<header class="header">
		<nav class="header__nav">
			
				<a href="/" class="header__link">Home</a>
			
				<a href="/tags" class="header__link">Tags</a>
			
				<a href="/archives" class="header__link">ARCHIVES</a>
			
				<a href="/about/About" class="header__link">ABOUT</a>
			
				<a href="http://weibo.com/yangcvo" class="header__link">Weibo</a>
			
				<a href="/atom.xml" class="header__link">RSS</a>
			
		</nav>
		<h1 class="header__title"><a href="/">Yancy&#39;s blog</a></h1>
		<h2 class="header__subtitle">SIMPLICITY IS PREREQUISITE FOR  RELIABILITY</h2>
	</header>

	<main>
		<article>
	
		<h1>Ansibleå°ç»“ï¼ˆå››ï¼‰Ad-hocä¸commandsæ¨¡å—</h1>
	
	<div class="article__infos">
		<span class="article__date">2016-03-09</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/automation/">automation</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Ansible/">Ansible</a>
			</span>
		
	</div>

	

	
		<h1 id="ansibleå°ç»“ï¼ˆå››ï¼‰Ad-hocä¸commandsæ¨¡å—"><a href="#ansibleå°ç»“ï¼ˆå››ï¼‰Ad-hocä¸commandsæ¨¡å—" class="headerlink" title="ansibleå°ç»“ï¼ˆå››ï¼‰Ad-hocä¸commandsæ¨¡å—"></a>ansibleå°ç»“ï¼ˆå››ï¼‰Ad-hocä¸commandsæ¨¡å—</h1><p>Ad-Hoc æ˜¯æŒ‡ansibleä¸‹ä¸´æ—¶æ‰§è¡Œçš„ä¸€æ¡å‘½ä»¤ï¼Œå¹¶ä¸”ä¸éœ€è¦ä¿å­˜çš„å‘½ä»¤ï¼Œå¯¹äºå¤æ‚çš„å‘½ä»¤åé¢ä¼šè¯´playbookã€‚è®²åˆ°Ad-hoc å°±è¦æåˆ°æ¨¡å—ï¼Œæ‰€æœ‰çš„å‘½ä»¤æ‰§è¡Œéƒ½è¦ä¾èµ–äºäº‹å…ˆå†™å¥½çš„æ¨¡å—ï¼Œé»˜è®¤å®‰è£…å¥½çš„ansible é‡Œé¢å·²ç»è‡ªå¸¦äº†å¾ˆå¤šæ¨¡å—ï¼Œå¦‚ï¼šcommandã€rawã€shellã€fileã€cronç­‰ï¼Œå…·ä½“å¯ä»¥é€šè¿‡ansible-doc -l è¿›è¡ŒæŸ¥çœ‹ ã€‚</p>
<h3 id="1ã€Ad-hoc"><a href="#1ã€Ad-hoc" class="headerlink" title="1ã€Ad-hoc"></a>1ã€Ad-hoc</h3><p>1ã€ç›´æ¥æ‰§è¡Œ</p>
<p>è¿™é‡Œè¿˜æ˜¯å…ˆæ¥ä¸€ä¸ªä¸Šå‡ ç¯‡å¹…ç»å¸¸ç”¨åˆ°çš„ä¸€ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># ansible tomcat_C1 -a "uptime" -k</span></div><div class="line">SSH <span class="symbol">password:</span></div><div class="line"><span class="meta">192.168.1.177 | SUCCESS | rc=0 &gt;</span>&gt;</div><div class="line"> <span class="number">10</span><span class="symbol">:</span><span class="number">37</span><span class="symbol">:</span><span class="number">10</span> up <span class="number">24</span> days, <span class="number">16</span><span class="symbol">:</span><span class="number">48</span>,  <span class="number">4</span> users,  load <span class="symbol">average:</span> <span class="number">0</span>.<span class="number">00</span>, <span class="number">0</span>.<span class="number">00</span>, <span class="number">0</span>.<span class="number">00</span></div></pre></td></tr></table></figure>
<p>ä¸€ä¸ªad-hocå‘½ä»¤çš„æ‰§è¡Œï¼Œéœ€è¦æŒ‰ä»¥ä¸‹æ ¼å¼è¿›è¡Œæ‰§è¡Œï¼š</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ansible ä¸»æœºæˆ–ç»„  -m æ¨¡å—å -<span class="selector-tag">a</span> <span class="string">'æ¨¡å—å‚æ•°'</span>  ansibleå‚æ•°</div></pre></td></tr></table></figure>
<p><strong>ä¸»æœºå’Œç»„ï¼Œæ˜¯åœ¨/etc/ansible/hosts é‡Œè¿›è¡ŒæŒ‡å®šçš„éƒ¨åˆ†ï¼Œå½“ç„¶åŠ¨æ€Inventory ä½¿ç”¨çš„æ˜¯è„šæœ¬ä»å¤–éƒ¨åº”ç”¨é‡Œè·å–çš„ä¸»æœº.</strong></p>
<ul>
<li><p>æ¨¡å—åï¼Œå¯ä»¥é€šè¿‡<code>ansible-doc -l</code>æŸ¥çœ‹ç›®å‰å®‰è£…çš„æ¨¡å—ï¼Œé»˜è®¤ä¸æŒ‡å®šæ—¶ï¼Œä½¿ç”¨çš„æ˜¯commandæ¨¡å—ï¼Œå…·ä½“å¯ä»¥æŸ¥çœ‹<code>/etc/ansible/ansible.cfg</code> çš„<code>â€œ#module_name = command â€</code> éƒ¨åˆ†ï¼Œé»˜è®¤æ¨¡å—å¯ä»¥åœ¨è¯¥é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œä¿®æ”¹ï¼›</p>
</li>
<li><p>æ¨¡å—å‚æ•°ï¼Œå¯ä»¥é€šè¿‡ <code>â€œansible-doc</code> æ¨¡å—åâ€ æŸ¥çœ‹å…·ä½“çš„ç”¨æ³•åŠåé¢çš„å‚æ•°ï¼›</p>
</li>
<li><p>ansibleå‚æ•°ï¼Œå¯ä»¥é€šè¿‡ansibleå‘½ä»¤çš„å¸®å¿™ä¿¡æ¯é‡ŒæŸ¥çœ‹åˆ°ï¼Œè¿™é‡Œæœ‰å¾ˆå¤šå‚æ•°å¯ä»¥ä¾›é€‰æ‹©ï¼Œå¦‚æ˜¯å¦éœ€è¦è¾“å…¥å¯†ç ã€æ˜¯å¦sudoç­‰ã€‚</p>
</li>
</ul>
<h4 id="2ã€åå°æ‰§è¡Œä¾‹å­"><a href="#2ã€åå°æ‰§è¡Œä¾‹å­" class="headerlink" title="2ã€åå°æ‰§è¡Œä¾‹å­"></a>2ã€åå°æ‰§è¡Œä¾‹å­</h4><p>å½“å‘½ä»¤æ‰§è¡Œæ—¶é—´æ¯”è¾ƒé•¿æ—¶ï¼Œä¹Ÿå¯ä»¥æ”¾åˆ°åå°æ‰§è¡Œï¼Œè¿™é‡Œä¼šç”¨åˆ°-Bã€-På‚æ•°ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ansible all -B <span class="number">3600</span> -a <span class="string">"/usr/bin/long_running_operation --do-stuff"</span> \\åå°æ‰§è¡Œå‘½ä»¤ <span class="number">3600</span>sï¼Œ-B è¡¨ç¤ºåå°æ‰§è¡Œçš„æ—¶é—´</div><div class="line">ansible all -m async_status -a <span class="string">"jid=123456789"</span>  \\æ£€æŸ¥ä»»åŠ¡çš„çŠ¶æ€</div><div class="line">ansible all -B <span class="number">1800</span> -P <span class="number">60</span> -a <span class="string">"/usr/bin/long_running_operation --do-stuff"</span> \\åå°æ‰§è¡Œå‘½ä»¤æœ€å¤§æ—¶é—´æ˜¯ <span class="number">1800</span>s å³ <span class="number">30</span> åˆ†é’Ÿï¼Œ-P æ¯ <span class="number">60</span>s æ£€æŸ¥ä¸‹çŠ¶æ€é»˜è®¤ <span class="number">15</span>s</div></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># ansible  -B 60 -P 1  tomcat_B1 -a  "uptime"</span></div><div class="line"><span class="meta">192.168.1.176 | SUCCESS | rc=0 &gt;</span>&gt;</div><div class="line"> <span class="number">11</span><span class="symbol">:</span><span class="number">23</span><span class="symbol">:</span><span class="number">00</span> up <span class="number">24</span> days, <span class="number">17</span><span class="symbol">:</span><span class="number">34</span>,  <span class="number">1</span> user,  load <span class="symbol">average:</span> <span class="number">0</span>.<span class="number">00</span>, <span class="number">0</span>.<span class="number">00</span>, <span class="number">0</span>.<span class="number">00</span></div></pre></td></tr></table></figure>
<h2 id="äºŒã€commandsæ¨¡å—"><a href="#äºŒã€commandsæ¨¡å—" class="headerlink" title="äºŒã€commandsæ¨¡å—"></a>äºŒã€commandsæ¨¡å—</h2><p>ä¸Šé¢å·²ç»æåˆ°ï¼Œansbileè‡ªèº«å·²ç»è‡ªå¸¦äº†å¾ˆå¤šæ¨¡å—ï¼Œå¯ä»¥é€šè¿‡ansible-doc -l è¿›è¡ŒæŸ¥çœ‹ã€‚è¿™é‡Œå°±ç»“åˆ<code>commandã€shellã€rawã€script</code>æ¨¡å—äº†è§£ä¸‹å…¶ç”¨æ³•ã€‚</p>
<p>ä¸Šé¢å››ä¸ªæ¨¡å—éƒ½å±äºcommands ç±»ã€‚</p>
<ul>
<li><code>command</code>æ¨¡å—ï¼Œè¯¥æ¨¡å—é€šè¿‡<code>-a</code>è·Ÿä¸Šè¦æ‰§è¡Œçš„å‘½ä»¤å¯ä»¥ç›´æ¥æ‰§è¡Œï¼Œä¸è¿‡å‘½ä»¤é‡Œå¦‚æœæœ‰å¸¦æœ‰å¦‚ä¸‹å­—ç¬¦éƒ¨åˆ†åˆ™æ‰§è¡Œä¸æˆåŠŸ â€œ so variables like $HOME and operations like â€œ&lt;â€, â€œ&gt;â€, â€œ|â€, and â€œ&amp;â€ will not work (use the shell module if you need these features).â€ï¼›**</li>
<li><code>shell</code>æ¨¡å—ï¼Œç”¨æ³•å…¶æœ¬å’Œ<code>command</code>ä¸€æ ·ï¼Œä¸è¿‡çš„æ˜¯å…¶æ˜¯é€šè¿‡/bin/shè¿›è¡Œæ‰§è¡Œï¼Œæ‰€ä»¥shell æ¨¡å—å¯ä»¥æ‰§è¡Œä»»ä½•å‘½ä»¤ï¼Œå°±åƒåœ¨æœ¬æœºæ‰§è¡Œä¸€æ ·ï¼Œâ€œ It is almost exactly like the command module but runs the command through a shell (/bin/sh) on the remote node.â€ï¼›</li>
<li><code>raw</code>æ¨¡å—ï¼Œç”¨æ³•å’Œshell æ¨¡å—ä¸€æ · ï¼Œå…¶ä¹Ÿå¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå°±åƒåœ¨æœ¬æœºæ‰§è¡Œä¸€æ ·ï¼Œâ€œExecutes a low-down and dirty SSH command, not going through the module subsystem. There is no change handler support for this module. This module does not require python on the remote systemâ€</li>
<li><code>script</code>æ¨¡å—ï¼Œå…¶æ˜¯å°†ç®¡ç†ç«¯çš„shell åœ¨è¢«ç®¡ç†ä¸»æœºä¸Šæ‰§è¡Œï¼Œå…¶åŸç†æ˜¯å…ˆå°†shell å¤åˆ¶åˆ°è¿œç¨‹ä¸»æœºï¼Œå†åœ¨è¿œç¨‹ä¸»æœºä¸Šæ‰§è¡Œï¼ŒåŸç†ç±»ä¼¼äºrawæ¨¡å—ï¼Œâ€œThis module does not require python on the remote system, much like the raw module.â€ ã€‚</li>
</ul>
<blockquote>
<p>æ³¨ï¼šrawæ¨¡å—å’Œcomandã€shell æ¨¡å—ä¸åŒçš„æ˜¯å…¶æ²¡æœ‰chdirã€createsã€removeså‚æ•°ï¼Œchdirå‚æ•°çš„ä½œç”¨å°±æ˜¯å…ˆåˆ‡åˆ°chdiræŒ‡å®šçš„ç›®å½•åï¼Œå†æ‰§è¡Œåé¢çš„å‘½ä»¤ï¼Œè¿™åœ¨åé¢å¾ˆå¤šæ¨¡å—é‡Œéƒ½ä¼šæœ‰è¯¥å‚æ•° ã€‚</p>
</blockquote>
<p>###commandæ¨¡å—åŒ…å«å¦‚ä¸‹é€‰é¡¹ï¼š </p>
<ul>
<li>createsï¼šä¸€ä¸ªæ–‡ä»¶åï¼Œå½“è¯¥æ–‡ä»¶å­˜åœ¨ï¼Œåˆ™è¯¥å‘½ä»¤ä¸æ‰§è¡Œ </li>
<li>free_formï¼šè¦æ‰§è¡Œçš„linuxæŒ‡ä»¤ </li>
<li>chdirï¼šåœ¨æ‰§è¡ŒæŒ‡ä»¤ä¹‹å‰ï¼Œå…ˆåˆ‡æ¢åˆ°è¯¥æŒ‡å®šçš„ç›®å½• </li>
<li>removesï¼šä¸€ä¸ªæ–‡ä»¶åï¼Œå½“è¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™è¯¥é€‰é¡¹ä¸æ‰§è¡Œ</li>
<li>executableï¼šåˆ‡æ¢shellæ¥æ‰§è¡ŒæŒ‡ä»¤ï¼Œè¯¥æ‰§è¡Œè·¯å¾„å¿…é¡»æ˜¯ä¸€ä¸ªç»å¯¹è·¯å¾„</li>
</ul>
<p><strong>commandæ¨¡å—ã€rawæ¨¡å—ã€shellæ¨¡å—ç¤ºä¾‹ï¼š</strong></p>
<h4 id="commandä¾‹å­ï¼š"><a href="#commandä¾‹å­ï¼š" class="headerlink" title="commandä¾‹å­ï¼š"></a>commandä¾‹å­ï¼š</h4><figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># ansible tomcat_B1 -m command -a "ps -ef|grep tomcat"</span></div><div class="line"><span class="number">192.168</span><span class="number">.1</span><span class="number">.176</span> | FAILED | rc=<span class="number">1</span> &gt;&gt;</div><div class="line">ERROR: Unsupported SysV option.</div><div class="line">********* simple selection *********  ********* selection <span class="keyword">by</span> <span class="built_in">list</span> *********</div><div class="line">-A all processes                      -C <span class="keyword">by</span> command <span class="built_in">name</span></div><div class="line">-N negate selection                   -G <span class="keyword">by</span> <span class="built_in">real</span> group ID (supports names)</div><div class="line">-a all w/ tty except session leaders  -U <span class="keyword">by</span> <span class="built_in">real</span> user ID (supports names)</div><div class="line">-d all except session leaders         -g <span class="keyword">by</span> session OR <span class="keyword">by</span> effective group <span class="built_in">name</span></div><div class="line">-e all processes                      -p <span class="keyword">by</span> process ID</div><div class="line">                                      -q <span class="keyword">by</span> process ID (unsorted &amp; quick)</div><div class="line">T  all processes <span class="keyword">on</span> this terminal     -s processes <span class="keyword">in</span> <span class="keyword">the</span> sessions <span class="keyword">given</span></div><div class="line">a  all w/ tty, including other users  -t <span class="keyword">by</span> tty</div><div class="line">g  OBSOLETE <span class="comment">-- DO NOT USE             -u by effective user ID (supports names)</span></div><div class="line">r  only <span class="built_in">running</span> processes             U  processes <span class="keyword">for</span> specified users</div><div class="line">x  processes w/o controlling ttys     t  <span class="keyword">by</span> tty</div><div class="line">*********** output format **********  *********** long options ***********</div><div class="line">-o,o user-defined  -f full            <span class="comment">--Group --User --pid --cols --ppid</span></div><div class="line">-j,j job control   s  signal          <span class="comment">--group --user --sid --rows --info</span></div><div class="line">-O,O preloaded -o  v  virtual memory  <span class="comment">--cumulative --format --deselect</span></div><div class="line">-l,l long          u  user-oriented   <span class="comment">--sort --tty --forest --version</span></div><div class="line">-F   extra full    X  registers       <span class="comment">--heading --no-heading --context</span></div><div class="line">                                      <span class="comment">--quick-pid</span></div><div class="line">                    ********* misc options *********</div><div class="line">-V,V  show <span class="built_in">version</span>      L  <span class="built_in">list</span> format codes  f  ASCII art forest</div><div class="line">-m,m,-L,-T,H  threads   S  children <span class="keyword">in</span> sum    -y change -l format</div><div class="line">-M,Z  security data     c  <span class="literal">true</span> command <span class="built_in">name</span>  -c scheduling <span class="built_in">class</span></div><div class="line">-w,w  wide output       n  numeric WCHAN,UID  -H process hierarchy</div></pre></td></tr></table></figure>
<p><strong>ä¸Šé¢çš„æ‰§è¡Œç»“æœå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘è¿™é‡ŒåŠ äº†ç®¡é“ï¼Œ<code>commandæ¨¡å—</code>æ‰§è¡Œæ—¶å‡ºé”™ï¼Œè€Œä½¿ç”¨<code>rawæ¨¡å—</code>å’Œ<code>shellæ¨¡å—</code>éƒ½æ­£å¸¸ã€‚</strong></p>
<h4 id="shellä¾‹å­ï¼š"><a href="#shellä¾‹å­ï¼š" class="headerlink" title="shellä¾‹å­ï¼š"></a>shellä¾‹å­ï¼š</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># ansible tomcat_B1 -m shell -a "ps -ef|grep tomcat"</span></div><div class="line">192.168.1.176 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">root      1529     1  0 Aug11 ?        00:00:00 jsvc.exec -java-home /srv/jdk1.7.0_67 -user tomcat -pidfile /srv/tomcat/tomcat_manager/logs/catalina-daemon.pid -wait 10 -outfile /srv/tomcat/tomcat_manager/logs/catalina-daemon.out -errfile &amp;1 -classpath /srv/tomcat/tomcat_manager/bin/bootstrap.jar:/srv/tomcat/</div></pre></td></tr></table></figure>
<h4 id="ä½¿ç”¨chdirçš„ç¤ºä¾‹ï¼š"><a href="#ä½¿ç”¨chdirçš„ç¤ºä¾‹ï¼š" class="headerlink" title="ä½¿ç”¨chdirçš„ç¤ºä¾‹ï¼š"></a>ä½¿ç”¨chdirçš„ç¤ºä¾‹ï¼š</h4><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># ansible tomcat_B1 -m command -a "chdir=/tmp/ touch 1.txt"</span></div><div class="line"><span class="meta">192.168.1.176 | SUCCESS | rc=0 &gt;</span>&gt;</div><div class="line"></div><div class="line">[root@docker ~]<span class="comment"># ansible tomcat_B1 -m shell -a "chdir=/tmp/ touch 2.txt"</span></div><div class="line"><span class="meta">192.168.1.176 | SUCCESS | rc=0 &gt;</span>&gt;</div><div class="line"></div><div class="line">[root@docker ~]<span class="comment"># ansible tomcat_B1 -m raw -a "chdir=/tmp/ touch 3.txt"</span></div><div class="line"><span class="meta">192.168.1.176 | SUCCESS | rc=0 &gt;</span>&gt;</div></pre></td></tr></table></figure>
<p>ä»ä¸Šé¢æ‰§è¡Œç»“æœæ¥çœ‹ï¼Œä¸‰ä¸ªå‘½ä»¤éƒ½æ‰§è¡ŒæˆåŠŸäº†ã€‚ä¸è¿‡é€šè¿‡åœ¨è¿œç¨‹ä¸»æœºä¸ŠæŸ¥çœ‹ï¼Œå‰ä¸¤ä¸ªæ–‡ä»¶è¢«æˆåŠŸåˆ›å»ºï¼š</p>
<figure class="highlight tap"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># ansible tomcat_B1 -m command -a "chdir=/tmp/ ls -lh"</span></div><div class="line">192.168.1.176 | SUCCESS | rc=0 &gt;&gt;</div><div class="line">total 188K</div><div class="line">-rw-r--r--.<span class="number"> 1 </span>root   root     <span class="number"> 0 </span>Sep <span class="number"> 5 </span>22:52 1.txt</div><div class="line">-rw-r--r--.<span class="number"> 1 </span>root   root     <span class="number"> 0 </span>Sep <span class="number"> 5 </span>22:51 2.txt</div></pre></td></tr></table></figure>
<p>ä½¿ç”¨<code>rawæ¨¡å—</code>çš„æ‰§è¡Œçš„ç»“æœæ–‡ä»¶ä¹Ÿè¢«æ­£å¸¸åˆ›å»ºäº†ï¼Œä¸è¿‡ä¸æ˜¯åœ¨chdir æŒ‡å®šçš„ç›®å½•ï¼Œè€Œæ˜¯åœ¨å½“å‰æ‰§è¡Œç”¨æˆ·çš„å®¶ç›®å½•ã€‚</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># ansible tomcat_B1 -m raw -a "ls ~/4.txt"</span></div><div class="line"><span class="meta">192.168.1.176 | SUCCESS | rc=0 &gt;</span>&gt;</div><div class="line"><span class="regexp">/root/</span><span class="number">4</span>.txt</div></pre></td></tr></table></figure>
<h4 id="createsä¸removesç¤ºä¾‹ï¼š"><a href="#createsä¸removesç¤ºä¾‹ï¼š" class="headerlink" title="createsä¸removesç¤ºä¾‹ï¼š"></a>createsä¸removesç¤ºä¾‹ï¼š</h4><p>è¿™é‡Œæˆ‘åœ¨æµ‹è¯•ä¸»æœºä¸Šåˆ›å»º/tmp/server.txtæ–‡ä»¶ï¼Œæ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<ul>
<li>createsï¼šä¸€ä¸ªæ–‡ä»¶åï¼Œå½“è¯¥æ–‡ä»¶å­˜åœ¨ï¼Œåˆ™è¯¥å‘½ä»¤ä¸æ‰§è¡Œ </li>
</ul>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># ansible tomcat_B1  -a "creates=/tmp/1.txt uptime"</span></div><div class="line"> [<span class="type">WARNING</span>]: <span class="type">Failure</span> <span class="keyword">using</span> <span class="keyword">method</span> (v2_runner_on_ok) <span class="keyword">in</span> callback plugin (&lt;ansible.plugins.callback.minimal.<span class="type">CallbackModule</span> <span class="keyword">object</span> at <span class="number">0x2093e90</span>&gt;): coercing to</div><div class="line"><span class="type">Unicode</span>: need <span class="built_in">string</span> <span class="keyword">or</span> buffer, <span class="built_in">bool</span> found</div><div class="line"></div><div class="line">[root@docker ~]<span class="comment"># ansible tomcat_B1  -a "removes=/tmp/1.txt uptime"</span></div><div class="line"><span class="number">192</span>.<span class="number">168</span>.<span class="number">1</span>.<span class="number">176</span> | <span class="type">SUCCESS</span> | rc=<span class="number">0</span> &gt;&gt;</div><div class="line"> <span class="number">22</span>:<span class="number">59</span>:<span class="number">04</span> up <span class="number">25</span> days,  <span class="number">5</span>:<span class="number">10</span>,  <span class="number">1</span> user,  load average: <span class="number">0</span>.<span class="number">00</span>, <span class="number">0</span>.<span class="number">00</span>, <span class="number">0</span>.<span class="number">00</span></div></pre></td></tr></table></figure>
<h4 id="scriptæ¨¡å—ç¤ºä¾‹ï¼š"><a href="#scriptæ¨¡å—ç¤ºä¾‹ï¼š" class="headerlink" title="scriptæ¨¡å—ç¤ºä¾‹ï¼š"></a>scriptæ¨¡å—ç¤ºä¾‹ï¼š</h4><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[root@361way ~]# cat script.sh</div><div class="line">#!/bin/bash</div><div class="line">df -hl</div><div class="line">ifconfig</div><div class="line">ps auxf|grep snmp</div><div class="line">[root@361way ~]# ansible 10.212.52.252 -m script -a 'scrip.sh'</div><div class="line">10.212.52.252 | FAILED =&gt; file or module does not exist: /root/scrip.sh</div><div class="line">[root@361way ~]# ansible 10.212.52.252 -m script -a 'script.sh'</div><div class="line">10.212.52.252 | success &gt;&gt; &#123;</div><div class="line">    "changed": true,</div><div class="line">    "rc": 0,</div><div class="line">    "stderr": "OpenSSH_5.3p1, OpenSSL 1.0.1e-fips 11 Feb 2013<span class="symbol">\n</span>debug1: Reading configuration data /etc/ssh/ssh_config<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Applying options for *<span class="symbol">\r</span><span class="symbol">\n</span>debug1: auto-mux: Trying existing master<span class="symbol">\r</span><span class="symbol">\n</span>Control socket connect(/root/.ansible/cp/ansible-ssh-10.212.52.252-22-root): Connection refused<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Connecting to 10.212.52.252 [10.212.52.252] port 22.<span class="symbol">\r</span><span class="symbol">\n</span>debug1: fd 3 clearing O_NONBLOCK<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Connection established.<span class="symbol">\r</span><span class="symbol">\n</span>debug1: permanently_set_uid: 0/0<span class="symbol">\r</span><span class="symbol">\n</span>debug1: identity file /root/.ssh/identity type -1<span class="symbol">\r</span><span class="symbol">\n</span>debug1: identity file /root/.ssh/identity-cert type -1<span class="symbol">\r</span><span class="symbol">\n</span>debug1: identity file /root/.ssh/id_rsa type -1<span class="symbol">\r</span><span class="symbol">\n</span>debug1: identity file /root/.ssh/id_rsa-cert type -1<span class="symbol">\r</span><span class="symbol">\n</span>debug1: identity file /root/.ssh/id_dsa type -1<span class="symbol">\r</span><span class="symbol">\n</span>debug1: identity file /root/.ssh/id_dsa-cert type -1<span class="symbol">\r</span><span class="symbol">\n</span>debug1: identity file /root/.ssh/id_ecdsa type -1<span class="symbol">\r</span><span class="symbol">\n</span>debug1: identity file /root/.ssh/id_ecdsa-cert type -1<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Remote protocol version 2.0, remote software version OpenSSH_6.2<span class="symbol">\r</span><span class="symbol">\n</span>debug1: match: OpenSSH_6.2 pat OpenSSH*<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Enabling compatibility mode for protocol 2.0<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Local version string SSH-2.0-OpenSSH_5.3<span class="symbol">\r</span><span class="symbol">\n</span>debug1: SSH2_MSG_KEXINIT sent<span class="symbol">\r</span><span class="symbol">\n</span>debug1: SSH2_MSG_KEXINIT received<span class="symbol">\r</span><span class="symbol">\n</span>debug1: kex: server-&gt;client aes128-ctr hmac-md5 zlib@openssh.com<span class="symbol">\r</span><span class="symbol">\n</span>debug1: kex: client-&gt;server aes128-ctr hmac-md5 zlib@openssh.com<span class="symbol">\r</span><span class="symbol">\n</span>debug1: SSH2_MSG_KEX_DH_GEX_REQUEST(1024&lt;1024&lt;8192) sent<span class="symbol">\r</span><span class="symbol">\n</span>debug1: expecting SSH2_MSG_KEX_DH_GEX_GROUP<span class="symbol">\r</span><span class="symbol">\n</span>debug1: SSH2_MSG_KEX_DH_GEX_INIT sent<span class="symbol">\r</span><span class="symbol">\n</span>debug1: expecting SSH2_MSG_KEX_DH_GEX_REPLY<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Host '10.212.52.252' is known and matches the RSA host key.<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Found key in /root/.ssh/known_hosts:1<span class="symbol">\r</span><span class="symbol">\n</span>debug1: ssh_rsa_verify: signature correct<span class="symbol">\r</span><span class="symbol">\n</span>debug1: SSH2_MSG_NEWKEYS sent<span class="symbol">\r</span><span class="symbol">\n</span>debug1: expecting SSH2_MSG_NEWKEYS<span class="symbol">\r</span><span class="symbol">\n</span>debug1: SSH2_MSG_NEWKEYS received<span class="symbol">\r</span><span class="symbol">\n</span>debug1: SSH2_MSG_SERVICE_REQUEST sent<span class="symbol">\r</span><span class="symbol">\n</span>debug1: SSH2_MSG_SERVICE_ACCEPT received<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Authentications that can continue: publickey,password,keyboard-interactive<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Next authentication method: keyboard-interactive<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Enabling compression at level 6.<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Authentication succeeded (keyboard-interactive).<span class="symbol">\r</span><span class="symbol">\n</span>debug1: setting up multiplex master socket<span class="symbol">\r</span><span class="symbol">\n</span>ControlSocket /root/.ansible/cp/ansible-ssh-10.212.52.252-22-root already exists, disabling multiplexing<span class="symbol">\r</span><span class="symbol">\n</span>debug1: channel 0: new [client-session]<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Requesting no-more-sessions@openssh.com<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Entering interactive session.<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Sending environment.<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Sending env LANG = en_US.UTF-8<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Sending command: LANG=C LC_CTYPE=C /root/.ansible/tmp/ansible-tmp-1431924855.88-242473611260231/script.sh <span class="symbol">\r</span><span class="symbol">\n</span>debug1: client_input_channel_req: channel 0 rtype exit-status reply 0<span class="symbol">\r</span><span class="symbol">\n</span>debug1: client_input_channel_req: channel 0 rtype eow@openssh.com reply 0<span class="symbol">\r</span><span class="symbol">\n</span>debug1: channel 0: free: client-session, nchannels 1<span class="symbol">\r</span><span class="symbol">\n</span>debug1: fd 1 clearing O_NONBLOCK<span class="symbol">\r</span><span class="symbol">\n</span>debug1: fd 2 clearing O_NONBLOCK<span class="symbol">\r</span><span class="symbol">\n</span>Connection to 10.212.52.252 closed.<span class="symbol">\r</span><span class="symbol">\n</span>Transferred: sent 1928, received 3920 bytes, in 0.1 seconds<span class="symbol">\r</span><span class="symbol">\n</span>Bytes per second: sent 37017.0, received 75262.7<span class="symbol">\r</span><span class="symbol">\n</span>debug1: Exit status 0<span class="symbol">\r</span><span class="symbol">\n</span>debug1: compress outgoing: raw data 537, compressed 375, factor 0.70<span class="symbol">\r</span><span class="symbol">\n</span>debug1: compress incoming: raw data 1837, compressed 1019, factor 0.55<span class="symbol">\r</span><span class="symbol">\n</span>",</div><div class="line">    "stdout": "Filesystem      Size  Used Avail Use<span class="variable">% Mounted on\r\n/dev/sda2       9.9G  872M  8.5G  10%</span> /<span class="symbol">\r</span><span class="symbol">\n</span>udev            3.9G  128K  3.9G   1<span class="variable">% /dev\r\ntmpfs           3.9G   76K  3.9G   1%</span> /dev/shm<span class="symbol">\r</span><span class="symbol">\n</span>/dev/sda3       5.0G  219M  4.5G   5<span class="variable">% /boot\r\n/dev/sda8        40G   15G   23G  40%</span> /home<span class="symbol">\r</span><span class="symbol">\n</span>/dev/sda9       9.9G  5.2G  4.3G  55<span class="variable">% /opt\r\n/dev/sda6       5.0G  2.7G  2.1G  57%</span> /tmp<span class="symbol">\r</span><span class="symbol">\n</span>/dev/sda5       9.9G  3.4G  6.0G  36<span class="variable">% /usr\r\n/dev/sda7       9.9G  823M  8.6G   9%</span> /var<span class="symbol">\r</span><span class="symbol">\n</span>eth0      Link encap:Ethernet  HWaddr 00:50:56:A8:65:7E  <span class="symbol">\r</span><span class="symbol">\n</span>          inet addr:10.212.52.252  Bcast:10.212.52.255  Mask:255.255.255.0<span class="symbol">\r</span><span class="symbol">\n</span>          inet6 addr: fe80::250:56ff:fea8:657e/64 Scope:Link<span class="symbol">\r</span><span class="symbol">\n</span>          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1<span class="symbol">\r</span><span class="symbol">\n</span>          RX packets:24112135 errors:0 dropped:792372 overruns:0 frame:0<span class="symbol">\r</span><span class="symbol">\n</span>          TX packets:10697339 errors:0 dropped:0 overruns:0 carrier:0<span class="symbol">\r</span><span class="symbol">\n</span>          collisions:0 txqueuelen:1000 <span class="symbol">\r</span><span class="symbol">\n</span>          RX bytes:17137233328 (16343.3 Mb)  TX bytes:13390377826 (12770.0 Mb)<span class="symbol">\r</span><span class="symbol">\n</span><span class="symbol">\r</span><span class="symbol">\n</span>lo        Link encap:Local Loopback  <span class="symbol">\r</span><span class="symbol">\n</span>          inet addr:127.0.0.1  Mask:255.0.0.0<span class="symbol">\r</span><span class="symbol">\n</span>          inet6 addr: ::1/128 Scope:Host<span class="symbol">\r</span><span class="symbol">\n</span>          UP LOOPBACK RUNNING  MTU:16436  Metric:1<span class="symbol">\r</span><span class="symbol">\n</span>          RX packets:3407332 errors:0 dropped:0 overruns:0 frame:0<span class="symbol">\r</span><span class="symbol">\n</span>          TX packets:3407332 errors:0 dropped:0 overruns:0 carrier:0<span class="symbol">\r</span><span class="symbol">\n</span>          collisions:0 txqueuelen:0 <span class="symbol">\r</span><span class="symbol">\n</span>          RX bytes:262675450 (250.5 Mb)  TX bytes:262675450 (250.5 Mb)<span class="symbol">\r</span><span class="symbol">\n</span><span class="symbol">\r</span><span class="symbol">\n</span>root     25332  0.0  0.0   4260   568 pts/2    S+   12:54   0:00          <span class="symbol">\\</span>_ grep snmp<span class="symbol">\r</span><span class="symbol">\n</span>root     24364  0.0  0.0  70416  6696 ?        SNl  May15   0:22 /usr/sbin/snmpd -r -A -LF i /var/log/net-snmpd.log -p /var/run/snmpd.pid<span class="symbol">\r</span><span class="symbol">\n</span>"</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¾“å‡ºç»“æœå¾ˆå¤šï¼Œçœ‹èµ·æ¥ä¹Ÿå¾ˆä¹±ï¼Œä¸è¿‡æŸ¥ä¸‹stdoutéƒ¨åˆ†ï¼Œè¿™ä¸ªéƒ¨åˆ†æ˜¯å®é™…ä¸Šæ‰§è¡Œåçš„ç»“æœã€‚è¿™é‡Œå¯ä»¥é…åˆç®¡é“ä¸€èµ·ä½¿ç”¨ï¼Œå¯ä»¥å¦‚ä¸‹ä½¿ç”¨ï¼š</p>
<p><code>`
[root@361way ~]# ansible 10.212.52.252 -m script -a &#39;script.sh&#39; |egrep &#39;&gt;&gt;|stdout&#39;</code></p>

	

	
		<span class="different-posts"><a href="/2016/03/09/è‡ªåŠ¨åŒ–+Jenkins/Ansible/Ansibleå°ç»“ï¼ˆå››ï¼‰Ad-hocä¸commandsæ¨¡å— /" onclick="window.history.go(-1); return false;">â¬…ï¸ Go back </a></span>

	

</article>

	</main>

	<footer class="footer">
	<div class="footer-content">
		
	      <div class="footer__element">
	<h5>Hi there,</h5>
	<p style="text-align:justify;">my name is Yancy, they know me as RadiantğŸ‘ğŸ‘. This blog is about Bi-data and my live.<br> I like ğŸŒ³ğŸŒ³ğŸŒ³</p>
</div>


	    
	      <div class="footer__element">
	<h5>Check out</h5>
	<ul class="footer-links">
		<li class="footer-links__link"><a href="/archives">Archive</a></li>
		
		  <li class="footer-links__link"><a href="/atom.xml">RSS</a></li>
	    
		<li class="footer-links__link"><a href="/about">about page</a></li>
		<li class="footer-links__link"><a href="/tags">Tags</a></li>
		<li class="footer-links__link"><a href="/categories">Categories</a></li>
	</ul>
</div>

	    

		<div class="footer-credit">
			<span>Â© 2017 Yancy | Powered by <a href="http://blog.yancy.cc/">Yancy</a> | Theme <a href="https://github.com/yangcvo">Yancy_GitHub</a></span>
		</div>

	</div>


</footer>



</body>

</html>
