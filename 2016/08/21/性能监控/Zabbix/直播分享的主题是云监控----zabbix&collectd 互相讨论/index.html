<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>直播分享的主题是云监控----zabbix&amp;collectd 互相讨论 | Yancy&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="直播分享的主题是云监控—-zabbix&amp;amp;collectd 互相讨论前几天参加KVM开展的直播秀，肖总请来了各位运维大咖给我们展示他们云监控。这里我整理下崔广章大师的聊天记录各位可以一起聆听下。 12345678910111213141516171819202122232425 崔广章 19:58我之前一直在做私有云，我们整个云平台的监控系统系统用的就是zabbix 崔广章 19:59基本没">
<meta name="keywords" content="Zabbix monitoring">
<meta property="og:type" content="article">
<meta property="og:title" content="直播分享的主题是云监控----zabbix&amp;collectd 互相讨论">
<meta property="og:url" content="http://blog.yancy.cc/2016/08/21/性能监控/Zabbix/直播分享的主题是云监控----zabbix&collectd 互相讨论/index.html">
<meta property="og:site_name" content="Yancy&#39;s blog">
<meta property="og:description" content="直播分享的主题是云监控—-zabbix&amp;amp;collectd 互相讨论前几天参加KVM开展的直播秀，肖总请来了各位运维大咖给我们展示他们云监控。这里我整理下崔广章大师的聊天记录各位可以一起聆听下。 12345678910111213141516171819202122232425 崔广章 19:58我之前一直在做私有云，我们整个云平台的监控系统系统用的就是zabbix 崔广章 19:59基本没">
<meta property="og:image" content="http://7xrthw.com1.z0.glb.clouddn.com/zabbix_yun.png">
<meta property="og:image" content="http://7xrthw.com1.z0.glb.clouddn.com/zabbix_yun1.png">
<meta property="og:image" content="http://7xrthw.com1.z0.glb.clouddn.com/zabbix_yun2.png">
<meta property="og:updated_time" content="2017-11-30T08:16:27.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="直播分享的主题是云监控----zabbix&amp;collectd 互相讨论">
<meta name="twitter:description" content="直播分享的主题是云监控—-zabbix&amp;amp;collectd 互相讨论前几天参加KVM开展的直播秀，肖总请来了各位运维大咖给我们展示他们云监控。这里我整理下崔广章大师的聊天记录各位可以一起聆听下。 12345678910111213141516171819202122232425 崔广章 19:58我之前一直在做私有云，我们整个云平台的监控系统系统用的就是zabbix 崔广章 19:59基本没">
<meta name="twitter:image" content="http://7xrthw.com1.z0.glb.clouddn.com/zabbix_yun.png">
  
  <link rel="stylesheet" href="/css/index.css">
</head>

<body style="


  background-color: #eff0f6

">
  <div id="container">
    <nav id="nav">
  <header class="header">
    <a href="/" class="title">Clover Tuan</a>
  </header>
  <div class="ctnWrap">
    <div class="icons">
      
        
          
            <a href="https://dribbble.com/clovertuan" target="_blank" class="nav-icn iconfont icon-dribbble"></a>
          
        
          
            <a href="https://www.behance.net/clovertuan" target="_blank" class="nav-icn iconfont icon-behance"></a>
          
        
          
            <a href="http://clovertuan.lofter.com/" target="_blank" class="nav-icn iconfont icon-lofter"></a>
          
        
          
            <a href="https://www.instagram.com/clovertuan/" target="_blank" class="nav-icn iconfont icon-instagram"></a>
          
        
          
            <a href="https://github.com/cloverTuan" target="_blank" class="nav-icn iconfont icon-github"></a>
          
        
      
    </div>
    <div class="menu">
      
        
            <a href="/" class="nav-menu ">HOME</a>
          
        
            <a href="/archives" class="nav-menu ">ARCHIVE</a>
          
        
            <a href="/about" class="nav-menu ">ABOUT</a>
          
        
      
    </div>
  </div>
</nav>
    <div id="main"><section class="article">
  <h2 class="title">直播分享的主题是云监控----zabbix&amp;collectd 互相讨论</h2>
  <p class="sub">Aug 21, 2016</p>
  <article class="content">
    <h3 id="直播分享的主题是云监控—-zabbix-amp-collectd-互相讨论"><a href="#直播分享的主题是云监控—-zabbix-amp-collectd-互相讨论" class="headerlink" title="直播分享的主题是云监控—-zabbix&amp;collectd 互相讨论"></a>直播分享的主题是云监控—-zabbix&amp;collectd 互相讨论</h3><p>前几天参加KVM开展的直播秀，肖总请来了各位运维大咖给我们展示他们云监控。这里我整理下崔广章大师的聊天记录各位可以一起聆听下。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"> 崔广章 19:58</div><div class="line">我之前一直在做私有云，我们整个云平台的监控系统系统用的就是zabbix</div><div class="line"> 崔广章 19:59</div><div class="line">基本没什么变化，做的比较多的就是国际化，大家都懂的</div><div class="line"> 崔广章 20:00</div><div class="line">我先借度娘给搭建扫个盲</div><div class="line"> 崔广章 20:00</div><div class="line">zabbix（音同 zæbix）是一个基于WEB界面的提供分布式系统监视以及网络监视功能的企业级的开源解决方案。</div><div class="line"> 崔广章 20:01</div><div class="line">zabbix能监视各种网络参数，保证服务器系统的安全运营；并提供灵活的通知机制以让系统管理员快速定位/解决存在的各种问题。</div><div class="line"> 崔广章 20:02</div><div class="line">zabbix由2部分构成，zabbix server与可选组件zabbix agent。</div><div class="line"> 崔广章 20:02</div><div class="line">zabbix server可以通过SNMP，zabbix agent，ping，端口监视等方法提供对远程服务器/网络状态的监视，数据收集等功能，它可以运行在Linux，Solaris，HP-UX，AIX，Free BSD，Open BSD，OS X等平台上。</div><div class="line"> 崔广章 20:02</div><div class="line">扫盲就到此为止吧</div><div class="line"> 崔广章 20:03</div><div class="line">按度娘的，接下来就是安装啦，我就在这耽误大家的人间啦</div><div class="line"> 崔广章 20:04</div><div class="line">zabbix监控主要分四块，zabbix-agent,SNMP,IPMI,和JMX</div><div class="line"> 崔广章 20:05</div><div class="line">因为我们主要是是做Iaas和Pass的，所以我们只用了前三种功能</div><div class="line"> 崔广章 20:06</div><div class="line">前三种功能又分为两种方案，就是负载大时的一种方案和负载小时的方案</div><div class="line"> 崔广章 20:07</div></pre></td></tr></table></figure>
<p><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix_yun.png" alt=""></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"> 崔广章 20:07</div><div class="line">这是小负载时的方案</div><div class="line"> 崔广章 20:08</div><div class="line">接下来是大负载时的方案</div><div class="line"> 崔广章 20:08</div></pre></td></tr></table></figure>
<p><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix_yun1.png" alt=""></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">崔广章 20:11</div><div class="line">这里还有一个zabbix的整体架构广章 20:11</div></pre></td></tr></table></figure>
<p><img src="http://7xrthw.com1.z0.glb.clouddn.com/zabbix_yun2.png" alt=""></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div></pre></td><td class="code"><pre><div class="line"> 崔广章 20:12</div><div class="line">我从14年才开始将zabbix进行分布式部署</div><div class="line"> 崔广章 20:14</div><div class="line">在云环境下，zabbix有个缺点就是，对虚拟机的监控达我们感觉不理想</div><div class="line"> 崔广章 20:15</div><div class="line">因为zabbix对与虚拟与物理机进行监控采取的是同样的方法，就是向系统中注入代理zabbix-agent</div><div class="line"> 崔广章 20:15</div><div class="line">对诸如代理我有两点担心</div><div class="line"> 崔广章 20:17</div><div class="line">一、因为zabbix-agent它本身也占用了资源，对于自己占用的资源它能不能准确监控，这我还不能确定，如果它不能对自己占用的资源进行准确监控，那就等于污染了虚拟机</div><div class="line"> 崔广章 20:19</div><div class="line">二，zabbix-agent是打包在云主机的镜像中的一个cron任务，说白他就是云主机的一个普通进程，如果用户把它给<span class="built_in">kill</span>了，是不是就监控不到啦？</div><div class="line"> 崔广章 20:21</div><div class="line">所以我就找能运行在底层又能对虚拟机进行准确检测的工具</div><div class="line"> 崔广章 20:21</div><div class="line">那就是接下来要说的collectd喽</div><div class="line"> 崔广章 20:21</div><div class="line">老规矩，咱们还接着扫盲</div><div class="line"> 崔广章 20:21</div><div class="line">collectd是一个守护(daemon)进程，用来收集系统性能和提供各种存储方式来存储不同值的机制。比如以RRD 文件形式。</div><div class="line"> 崔广章 20:29</div><div class="line">collectd确实能够运行在底层，并能采集KVM虚拟机的各项数据，但他的展示使用CGP跟zabbix比太差</div><div class="line"> 崔广章 20:31</div><div class="line">我所以我就试着将两者进行优势互补</div><div class="line"> 崔广章 20:32</div><div class="line">我是将collectd存储在*.rrd中的相关数据取出来，然后存储到zabbix的数据库当中，让zabbix进行展示</div><div class="line"> 崔广章 20:33</div><div class="line">其实只是将collectd采集的虚拟机的内存的数据进行转存和展示</div><div class="line"> 崔广章 20:36</div><div class="line">整个过程包括，分析zabbix的数据库表之间的关系，研究怎么从collectd的*.rrd文件中取数据怎么将取出的数据向数据库里保存，这是一项很大的工程</div><div class="line"> 崔广章 20:36</div><div class="line">今天就分享到这吧好吧？</div><div class="line"> 侯燚@贵州高新翼云 20:37</div><div class="line">谢谢</div><div class="line"> 崔广章 20:37</div><div class="line"> 袁进坤|南京|云应用+大数据+云计算 20:37</div><div class="line"> 薛群 20:37</div><div class="line">其实你说的第一个问题，不是问题</div><div class="line"> 北极熊 20:37</div><div class="line">大家开始提问吧</div><div class="line"> 薛群 20:38</div><div class="line">只要是监控，都需要消耗少量资源</div><div class="line"> 崔广章 20:38</div><div class="line">这个问题我也请教过肖哥@薛群</div><div class="line"> 刘海宾 20:38</div><div class="line">通过libvirt也能获取虚拟机的内存</div><div class="line"> 崔广章 20:38</div><div class="line">嗯嗯</div><div class="line"> 薛群 20:38</div><div class="line">不属于污染虚拟机哦</div><div class="line"> 崔广章 20:38</div><div class="line">嗯嗯</div><div class="line"> 薛群 20:39</div><div class="line">腾讯云上的虚拟机十几个agent</div><div class="line"> 崔广章 20:39</div><div class="line">collectd就是调用了libvirt</div><div class="line"> 崔广章 20:39</div><div class="line">@薛</div><div class="line"> 崔广章 20:40</div><div class="line">错啦</div><div class="line"> 袁进坤|南京|云应用+大数据+云计算 20:40</div><div class="line">在选择监控工具的时候，是否考虑过其他类似的工具，例如nagios，做出选择的主要考虑是什么？</div><div class="line"> 薛群 20:40</div><div class="line">第二种方式，消耗资源多不？</div><div class="line"> 刘海宾 20:40</div><div class="line">那collected就干这一件事吗</div><div class="line"> 崔广章 20:40</div><div class="line"> 刘海宾 20:40</div><div class="line">其实虚拟机监控可以用qga</div><div class="line"> 刘海宾 20:41</div><div class="line">走channel</div><div class="line"> 薛群 20:41</div><div class="line">nagios功能没有ZBX强，性能也不及</div><div class="line"> 崔广章 20:41</div><div class="line">collectd目前我只让它干了怎么一件事</div><div class="line"> 刘海宾 20:42</div><div class="line">那自己写个脚本更简单吧 呵呵 只是个人观点</div><div class="line"> 崔广章 20:42</div><div class="line">我也试着写了一套脚本</div><div class="line"> 刘海宾 20:43</div><div class="line">@薛群 私有云跑agent还好 公有云 用户很反感</div><div class="line"> 薛群 20:43</div><div class="line">@袁进坤@南京，云计算 其实监控主要考虑：方便，扩展性好(规模和二次开发)，功能全，</div><div class="line"> 崔广章 20:43</div><div class="line">但数据误差太大</div><div class="line"> 崔广章 20:44</div><div class="line">就是考虑到这一点@刘海宾@新网</div><div class="line"> 刘海宾 20:45</div><div class="line">虚拟机加上ballon</div><div class="line"> 薛群 20:46</div><div class="line">嗯，是的。腾讯云上这么多agent，是不爽</div><div class="line"> 崔广章 20:46</div><div class="line">ballon跟内存监控关系不大@刘海宾@新网</div><div class="line"> 于江磊@奇点时代 20:47</div><div class="line">zabbix再多个配置不同的vm时，请问模板是分别定制的么</div><div class="line"> 崔广章 20:48</div><div class="line">对的</div><div class="line"> 于江磊@奇点时代 20:48</div><div class="line">监控多个</div><div class="line"> 刘海宾 20:49</div><div class="line">libguestfs也能干这事</div><div class="line"> 袁进坤|南京|云应用+大数据+云计算 20:50</div><div class="line">@薛群 @崔广章 谢谢</div><div class="line"> 刘海宾 20:50</div><div class="line">青云的监控走的channel在 init里边起了个进程 不容易杀死 还不错</div><div class="line"> 刘海宾 20:51</div><div class="line">@崔广章 谢谢分享</div><div class="line"> 崔广章 20:51</div><div class="line">@袁进坤@南京，云计算</div><div class="line"> 崔广章 20:51</div><div class="line"> 袁进坤|南京|云应用+大数据+云计算 20:52</div><div class="line">@崔广章 主要监控了哪些指标？如果在openstack架构，ceilometer和zabbix的的关系怎么看？</div><div class="line"> 刘浩 20:52</div><div class="line">我求问个问题：把zabbix agent用supervise起。是不是就不用担心被杀死的问题了。</div><div class="line"> 于江磊@奇点时代 20:53</div><div class="line">我在用zabbix时,遇到一个问题,监控主机网卡的时候,zabbix默认采用了auto_discovery的策略,但是我宿主机上跑了很多个容器,容器的网络运行模式为桥接,此时zabbix就会自动去检测那些veth的设备,请问我该如何配置呢? 达到让zabbix只监控em0 或者eth0的网卡设备呢</div><div class="line"> 崔广章 20:54</div><div class="line">ceilometer其实是openstack自带的功能，但是功能很菜@袁进坤@南京，云计算</div><div class="line"> 崔广章 20:54</div><div class="line">@刘浩@360 其实我就是怎想的</div><div class="line"> 年福瑞@小牛资本 20:57</div><div class="line">@于江磊@奇点时代 自己写脚本，取物理别名</div><div class="line"> 崔广章 20:58</div><div class="line">我也遇到这样的问题@于江磊@奇点时代</div><div class="line"> 刘浩 20:59</div><div class="line">@崔广章 那是不是可以不用collected了</div><div class="line"> 崔广章 21:00</div><div class="line">理论上是可以，但数据转存的时候，工作量很大@刘浩@360</div><div class="line"> 崔广章 21:01</div><div class="line">难点主要在zabbix端，关系错综复杂</div><div class="line"> 薛群 21:01</div><div class="line">@于江磊@奇点时代 用正则表达式过滤</div><div class="line"> 薛群 21:03</div><div class="line">公有云起agent确实是个问题</div><div class="line"> 崔广章 21:03</div><div class="line">这是公有云的痛点</div></pre></td></tr></table></figure>
<p>转载：kvm论坛</p>
<p>就整理这些，想说现在监控也越来越完善了，可以做到邮件告警，微信告警，钉钉告警短信电话告警。 万能的监控zabbix只要有key值都可以做到任何监控。</p>
<p>也还有些公司对监控更加要求性高可以针对性技术开发一套监控大屏，记得在之前公司运维CDN就是整个技术团队研发一套监控大盘的，主要监控流量的状态每个节点的流量带宽。</p>
<p>有兴趣一起研究监控的可以加我QQ:1165958741 或者加入群一起讨论：459096184</p>

  </article>
  <footer class="f-cf">
    
      <a href="/2016/08/23/Web服务技术/Nginx/Nginx 的启动、停止、平滑重启、信号控制和平滑升级 /" class="link f-fl">⟵Nginx 的启动、停止、平滑重启、信号控制和平滑升级</a>
    
    
      <a href="/2016/08/21/Node.js-npm/npm翻墙加速国内镜像/" class="link f-fr">npm翻墙加速国内镜像⟶</a>
    
  </footer>
</section></div>
    <footer id="footer" class="f-cf">
  d.guangying@foxmail.com
  
    
      
        · <a href="https://dribbble.com/clovertuan" target="_blank" class="nav-icn">Dribbble</a>
      
    
      
        · <a href="https://www.behance.net/clovertuan" target="_blank" class="nav-icn">Behance</a>
      
    
      
        · <a href="http://clovertuan.lofter.com/" target="_blank" class="nav-icn">Lofter</a>
      
    
      
        · <a href="https://www.instagram.com/clovertuan/" target="_blank" class="nav-icn">Instagram</a>
      
    
      
        · <a href="https://github.com/cloverTuan" target="_blank" class="nav-icn">GitHub</a>
      
    
  
  <span class="copyright">All rights reserved @Clover Tuan</span>
</footer>
  </div>
</body>
</html>