<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> DNS服务使用dig查询解析 · Cheng yang's Blog</title><meta name="description" content="DNS服务使用dig查询解析 - yangc"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://blog.yangcvo.me/atom.xml" title="Cheng yang's Blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/yangcvo" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/yangcvo" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="http://blog.yangcvo.me/2014/05/04/%E4%B8%AA%E4%BA%BA%E8%AE%B0%E5%BD%95/About-me/" target="_blank" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">DNS服务使用dig查询解析</h1><div class="post-info">2016年12月28日</div><div class="post-content"><p>##使用dig查询DNS解析</p>
<p>今天整理下前段时间搭建的DNS主从服务器，DNS主从复制虚拟域名设置等等，总结写了篇文档：<a href="http://blog.yangcvo.me/2015/12/28/DNS/DNS%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E6%90%AD%E5%BB%BA/">DNS服务器主从复制搭建</a></p>
<p>这里就顺便写了下dig使用查询DNS解析：</p>
<p>一般来说linux下查询域名解析有两种选择，<code>nslookup或者dig</code>，而在使用上我觉得<code>dig</code>更加方便顺手。<br>如果是在centos下的话，只要yum装上<code>dig</code>这个包就可以使用<code>dig</code>命令了。</p>
<p><code>nslookup</code> 使用在我印象中在读大学Windows服务器用的非常多。</p>
<ul>
<li>最基本的使用方式就是</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dig rap.test.intranet.</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@DNS-master ~]# dig rap.test.intranet.</span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.9.4-RedHat-9.9.4-29.el7_2.3 &lt;&lt;&gt;&gt; rap.test.intranet.</span><br><span class="line">;; global options: +cmd</span><br><span class="line">;; Got answer:</span><br><span class="line">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 40150</span><br><span class="line">;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 2, ADDITIONAL: 3</span><br><span class="line"></span><br><span class="line">;; OPT PSEUDOSECTION:</span><br><span class="line">; EDNS: version: 0, flags:; udp: 4096</span><br><span class="line">;; QUESTION SECTION:</span><br><span class="line">;rap.test.intranet.             IN      A</span><br><span class="line"></span><br><span class="line">;; ANSWER SECTION:</span><br><span class="line">rap.test.intranet.      1200    IN      A       192.168.1.211</span><br><span class="line"></span><br><span class="line">;; AUTHORITY SECTION:</span><br><span class="line">test.intranet.          1200    IN      NS      ns1.test.intranet.</span><br><span class="line">test.intranet.          1200    IN      NS      ns2.test.intranet.</span><br><span class="line"></span><br><span class="line">;; ADDITIONAL SECTION:</span><br><span class="line">ns1.test.intranet.      1200    IN      A       192.168.1.204</span><br><span class="line">ns2.test.intranet.      1200    IN      A       192.168.1.205</span><br><span class="line"></span><br><span class="line">;; Query time: 0 msec</span><br><span class="line">;; SERVER: 127.0.0.1#53(127.0.0.1)</span><br><span class="line">;; WHEN: 三 9月 14 14:47:45 CST 2016</span><br><span class="line">;; MSG SIZE  rcvd: 130</span><br></pre></td></tr></table></figure>
<p>即查询域名的A记录，查询的<code>dns</code>服务器将采用系统配置的服务器，即<code>/etc/resovle.conf</code> 中的。<br>如果要查询其他类型的记录，比如<code>MX，CNAME，NS，PTR</code>等，只需将类型加在命令后面即可</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dig rap.test.intranet mx</span><br><span class="line">dig rap.test.intranet ns</span><br></pre></td></tr></table></figure>
<p>此外，如果你是一个系统管理员，部署好了一台dns服务器之后想对它进行解析测试，就必须要显式指定待测试的dns服务器地址了，例如:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dig @1.168.192 rap.test.intranet a</span><br></pre></td></tr></table></figure>
<p>默认情况下dig将采用udp协议进行查询，如果要采用tcp方式，可以加上 +tcp参数<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dig rap.test.intranet a +tcp</span><br></pre></td></tr></table></figure></p>
<p>另外一个重要的功能是+trace参数，使用这个参数之后将显示从根域逐级查询的过程</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dig rap.test.intranet a +trace</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@DNS-master ~]# dig rap.test.intranet a +trace</span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.9.4-RedHat-9.9.4-29.el7_2.3 &lt;&lt;&gt;&gt; rap.test.intranet a +trace</span><br><span class="line">;; global options: +cmd</span><br><span class="line">.                       329687  IN      NS      g.root-servers.net.</span><br><span class="line">.                       329687  IN      NS      a.root-servers.net.</span><br><span class="line">.                       329687  IN      NS      j.root-servers.net.</span><br><span class="line">.                       329687  IN      NS      d.root-servers.net.</span><br><span class="line">.                       329687  IN      NS      e.root-servers.net.</span><br><span class="line">.                       329687  IN      NS      c.root-servers.net.</span><br><span class="line">.                       329687  IN      NS      l.root-servers.net.</span><br><span class="line">.                       329687  IN      NS      i.root-servers.net.</span><br><span class="line">.                       329687  IN      NS      f.root-servers.net.</span><br><span class="line">.                       329687  IN      NS      m.root-servers.net.</span><br><span class="line">.                       329687  IN      NS      b.root-servers.net.</span><br><span class="line">.                       329687  IN      NS      k.root-servers.net.</span><br><span class="line">.                       329687  IN      NS      h.root-servers.net.</span><br><span class="line">.                       518303  IN      RRSIG   NS 8 0 518400 20160927050000 20160914040000 46551 . oGlpdQKJ+s6h7AW/HfNVN6w8zzrwU8Q5LP4So9LP65JBqHQqLDtpNz1j OtTiJVwdpxlF/uTQ1HOqUVNOxV7Anpcj08x/LXjCQYUco2X12/Gxats6 oX1h9FfzFtd3JKrxuo08x7fBQ7uVY9WvkHW/AcWCIRBMMpuIJqZcHlGz 92c=</span><br><span class="line"></span><br><span class="line">;; Received 941 bytes from 127.0.0.1#53(127.0.0.1) in 1421 ms</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">.                       86400   IN      SOA     a.root-servers.net. nstld.verisign-grs.com. 2016091400 1800 900 604800 86400</span><br><span class="line">.                       86400   IN      RRSIG   SOA 8 0 86400 20160927050000 20160914040000 46551 . t2MmM3Ei/JkicFHIjsQHz4vOvfld02aXKa4Jc3cHHnzTYQ6sqcKBGoNB mhrSs51ImUQj7SXjm9T4xb7ZvnzezqWqNA2mQc6j2eFHcJgtIfryitIt WumvYo6j3PzgufTtlidWob60Y7KE0sy3Y1g3jVKwjH9YFE+8imwEPhiI vhY=</span><br><span class="line">international.          86400   IN      NSEC    intuit. NS DS RRSIG NSEC</span><br><span class="line">international.          86400   IN      RRSIG   NSEC 8 1 86400 20160927050000 20160914040000 46551 . PBLSHTQ/qRan5U7tZ2KEIJkQaOs356o0YRJP2SY+WjCwOfBRcVb6ljYG pgh+X45M1IXFzOEs5V36UmNZ9EZ5m+hy67dQs64Mam10WTRHsmO55RCN abR8nkLuAU20qdp2d5RbqlPUPqOmvLMhmxFwy2eRW+4+OdSmEwaYKubP YSc=</span><br><span class="line">.                       86400   IN      NSEC    aaa. NS SOA RRSIG NSEC DNSKEY</span><br><span class="line">.                       86400   IN      RRSIG   NSEC 8 0 86400 20160927050000 20160914040000 46551 . PlKRTXs02kT6qpQJw2FJibwuU56Olwo5hEzXZ4X6DQ4ONUI76mpAWuKM jtZi2OK111STK6cehRK/RTfH6qX8YF+06DpGxLkJx9oShk/G5Zj9xXid 7CRDf9ccpC+740iGK/KSWdE36LCkPw+6lU9oyXlFbqhS0YDRz4xuzbqi pSc=</span><br><span class="line">;; Received 662 bytes from 192.58.128.30#53(j.root-servers.net) in 120 ms</span><br></pre></td></tr></table></figure>
<p>比如，对本站域名 <code>rap.test.intranet</code> A记录的trace查询可以看到根域.，顶级域.intranet，以及test.intranet的域名权威服务器的地址及其各自的返回结果，这样对于追踪dns解析中的问题有很大的帮助。<br>```</p>
</div></article></div></section><footer><div class="paginator"><a href="/2016/09/11/个人记录/考驾照的艰辛历程/" class="next">下一篇</a></div><div data-thread-key="2016/12/28/DNS/DNS服务使用dig查询解析/" data-title="DNS服务使用dig查询解析" data-url="http://blog.yangcvo.me/2016/12/28/DNS/DNS服务使用dig查询解析/" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"true"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();

</script><div class="copyright"><p>© 2014 - 2016 <a href="http://blog.yangcvo.me">yangc</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yangcvo" target="_blank">Github-yangcvo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>