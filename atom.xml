<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Yancy&#39;s blog</title>
  <icon>https://www.gravatar.com/avatar/4bb94619692fa63fbfa18343b7c7965c</icon>
  <subtitle>SIMPLICITY IS PREREQUISITE FOR  RELIABILITY</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://blog.yancy.cc/"/>
  <updated>2017-09-23T16:20:40.000Z</updated>
  <id>http://blog.yancy.cc/</id>
  
  <author>
    <name>Yancy</name>
    <email>yangcvo@gmail.com</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Bigdata-Cloudera Manager5åŠCDH5å®‰è£…æŒ‡å¯¼</title>
    <link href="http://blog.yancy.cc/2017/08/29/Bigdata-hadoop/countly/Cloudera%20Manager5%E5%8F%8ACDH5%E5%AE%89%E8%A3%85%E6%8C%87%E5%AF%BC/"/>
    <id>http://blog.yancy.cc/2017/08/29/Bigdata-hadoop/countly/Cloudera Manager5åŠCDH5å®‰è£…æŒ‡å¯¼/</id>
    <published>2017-08-29T06:46:00.000Z</published>
    <updated>2017-09-23T16:20:40.000Z</updated>
    
    <content type="html"><![CDATA[<p><figure class="figure"><img src="https://www.cardinalsolutions.com/~/media/Images/cardinal/events/ClouderaSessions-660.jpg" alt=""></figure></p><h3 id="é—®é¢˜å¯¼è¯»ï¼š"><a href="#é—®é¢˜å¯¼è¯»ï¼š" class="headerlink" title="é—®é¢˜å¯¼è¯»ï¼š"></a>é—®é¢˜å¯¼è¯»ï¼š</h3><p>1.ä»€ä¹ˆæ˜¯cloudera CM ã€CDH?<br>2.CDHã€CMæœ‰å“ªäº›ç‰ˆæœ¬ï¼Ÿ<br>3.CDHã€CMæœ‰å“ªäº›å®‰è£…æ–¹å¼ï¼Ÿ<br>4.CDHå¦‚ä½•å¼€å‘ï¼Ÿ</p><a id="more"></a><h3 id="ä»€ä¹ˆæ˜¯CDH"><a href="#ä»€ä¹ˆæ˜¯CDH" class="headerlink" title="ä»€ä¹ˆæ˜¯CDH"></a>ä»€ä¹ˆæ˜¯CDH</h3><p>hadoopæ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œæ‰€ä»¥å¾ˆå¤šå…¬å¸åœ¨è¿™ä¸ªåŸºç¡€è¿›è¡Œå•†ä¸šåŒ–ï¼ŒClouderaå¯¹hadoopåšäº†ç›¸åº”çš„æ”¹å˜ã€‚<br>Clouderaå…¬å¸çš„å‘è¡Œç‰ˆï¼Œæˆ‘ä»¬å°†è¯¥ç‰ˆæœ¬ç§°ä¸ºCDHã€‚</p><p>å¾ˆå¤šæ–°æ‰‹é—®çš„æœ€å¤šçš„é—®é¢˜æ˜¯ï¼Œå“ªä¸ªæ˜¯æ”¶è´¹çš„ï¼Œé‚£ä¸ªæ˜¯å…è´¹çš„ã€‚<br>Cloudera Expressç‰ˆæœ¬æ˜¯å…è´¹çš„<br>Cloudera Enterpriseæ˜¯éœ€è¦è´­ä¹°æ³¨å†Œç çš„</p><p>æ›´å¤šå†…å®¹ï¼š<br>Cloudera Hadoopä»€ä¹ˆæ˜¯CDHåŠCDHç‰ˆæœ¬ä»‹ç» :<a href="http://www.aboutyun.com/thread-6788-1-1.html" target="_blank" rel="external">http://www.aboutyun.com/thread-6788-1-1.html</a> </p><p>CDHï¼ˆClouderaï¼‰ä¸hadoopï¼ˆapacheï¼‰å¯¹æ¯” : <a href="http://www.aboutyun.com/thread-9225-1-1.html" target="_blank" rel="external">http://www.aboutyun.com/thread-9225-1-1.html</a></p><p>å¤§æ•°æ®æ¶æ„å¸ˆåŸºç¡€ï¼šhadoopå®¶æ—ï¼ŒClouderaäº§å“ç³»åˆ—ç­‰å„ç§æŠ€æœ¯ : <a href="http://www.aboutyun.com/thread-6842-1-1.html" target="_blank" rel="external">http://www.aboutyun.com/thread-6842-1-1.html</a> </p><h3 id="å®˜ç½‘ä»‹ç»"><a href="#å®˜ç½‘ä»‹ç»" class="headerlink" title="å®˜ç½‘ä»‹ç»"></a>å®˜ç½‘ä»‹ç»</h3><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera1.png" alt=""></figure></p><p><strong>ä¸»é¡µï¼š</strong><br><a href="https://www.cloudera.com/downloads/manager/5-12-0.html" target="_blank" rel="external">https://www.cloudera.com/downloads/manager/5-12-0.html</a></p><h3 id="CM-Cloudera-Manager-æœ‰ä¸‰ç§å®‰è£…æ–¹å¼ï¼š"><a href="#CM-Cloudera-Manager-æœ‰ä¸‰ç§å®‰è£…æ–¹å¼ï¼š" class="headerlink" title="CM(Cloudera Manager)æœ‰ä¸‰ç§å®‰è£…æ–¹å¼ï¼š"></a>CM(Cloudera Manager)æœ‰ä¸‰ç§å®‰è£…æ–¹å¼ï¼š</h3><p><strong>1.ç¬¬ä¸€ç§ä½¿ç”¨cloudera-manager-installer.binå®‰è£…</strong></p><p>è¿™ç§å®‰è£…æ–¹å¼ï¼Œåªè¦ä»å®˜ç½‘ä¸‹è½½<code>cloudera-manager-installer.bin</code> ç„¶åæ‰§è¡Œè¿™ä¸ª<code>bin</code>æ–‡ä»¶ï¼Œå‰©ä¸‹çš„å°±æ˜¯ç­‰å¾…ä¸‹è½½å’Œå®‰è£…ã€‚ä½†æ˜¯è¿™ä¸ªæ—¶é—´ä¸æ˜¯ä¸€èˆ¬çš„é•¿ï¼Œæœ€å¥½åƒä¸ªé¥­ï¼Œç¡ä¸ªè§‰ï¼Œæœ€åçœ‹åˆ°è¿˜åœ¨å®‰è£…è¿‡ç¨‹ä¸­ã€‚æ­¤å¸–å®‰è£…æ­¥éª¤åŠé‡åˆ°é—®é¢˜è®°å½•å¾ˆè¯¦ç»†ï¼Œå¯å‚è€ƒ<br><a href="http://www.aboutyun.com/thread-9303-1-1.html" target="_blank" rel="external">Cloudera Manager5åŠCDH5åœ¨çº¿ï¼ˆcloudera-manager-installer.binï¼‰å®‰è£…è¯¦ç»†æ–‡æ¡£</a><br><a href="http://www.aboutyun.com/thread-9075-1-1.html" target="_blank" rel="external">Cloudera Manager5åŠCDH5å®‰è£…æŒ‡å¯¼ï¼ˆç»ˆæåœ¨çº¿å®‰è£…ï¼‰</a></p><h3 id="é—®é¢˜å¯¼è¯»ï¼š-1"><a href="#é—®é¢˜å¯¼è¯»ï¼š-1" class="headerlink" title="é—®é¢˜å¯¼è¯»ï¼š"></a>é—®é¢˜å¯¼è¯»ï¼š</h3><p>1.Cloudera Manager5å®‰è£…éœ€è¦å“ªäº›ç¯å¢ƒè¦æ±‚ï¼Ÿ<br>2.å“ªäº›Linuxç³»ç»Ÿä¸Šï¼Œå¯ä»¥å®‰è£…Cloudera Manager5ï¼Ÿ<br>3.åœ¨å®‰è£…cdhçš„è¿‡ç¨‹ä¸­ï¼Œè¯¥å¦‚ä½•é€‰æ‹©ç‰ˆæœ¬ï¼Ÿ</p><p><strong>å®‰è£…ç¯å¢ƒè¦æ±‚</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">é›†ç¾¤ä¸­çš„å››å°ä¸»æœºå¿…é¡»æ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼š</div><div class="line">ä¸»æœºå¿…é¡»è‡³å°‘æœ‰16 GBçš„RAM</div><div class="line">å¯¹äºRAMï¼Œæˆ‘ä»¬æˆ–è®¸æ²¡æœ‰å¤ªå¤šçš„æ¦‚å¿µï¼Œä¸‹é¢å¯ä»¥å‚è€ƒ</div><div class="line">RAMå®¹é‡æ˜¯è¿è¡Œä¸­çš„ç¨‹åºæ‰€å ç”¨çš„ç©ºé—´ï¼Œä»–è¿è¡Œéœ€è¦çš„ç©ºé—´ã€</div><div class="line">ROMå®¹é‡æ˜¯ä½ çš„ç³»ç»Ÿå¯ä»¥å­˜æ”¾ï¼Œå ç”¨çš„ç©ºé—´ï¼Œä½ çš„æ‰€æœ‰ç³»ç»Ÿæ–‡ä»¶ï¼Œç¨‹åºéƒ½åœ¨è¿™é‡Œå­˜æ”¾ã€‚</div><div class="line"></div><div class="line">å¿…é¡»ä½¿ç”¨rootç”¨æˆ·ï¼Œæˆ–åˆ™ä½¿ç”¨sudoæ— å¯†ç è®¿é—®</div><div class="line">ï¼ˆä¹Ÿå°±æ˜¯è¯´å½“ä½ ä½¿ç”¨å…¶å®ƒç”¨æˆ·ï¼Œä½¿ç”¨sudoçš„æ—¶å€™ï¼Œä¸èƒ½è¾“å…¥å¯†ç ï¼‰</div><div class="line"></div><div class="line">å¦‚æœä½¿ç”¨rootç”¨æˆ·ï¼Œå¿…é¡»ä½¿ç”¨ç›¸åŒçš„å¯†ç </div><div class="line">ä¸»æœºå¿…é¡»èƒ½ä¸Šç½‘ï¼Œå…è®¸å®‰è£…å‘å¯¼è®¿é—®cdm.jollychic.com</div><div class="line">å¯ä»¥ä»ä¸‹é¢é€‰æ‹©ä¸€ä¸ªç³»ç»Ÿ</div><div class="line"></div><div class="line">RHEL-å…¼å®¹ç³»ç»Ÿ</div><div class="line">Red Hat Enterprise Linux and CentOS 5, 64-bit</div><div class="line">Red Hat Enterprise Linux and CentOS 6, 64-bit</div><div class="line">Red Hat Enterprise Linux and CentOS 7 <span class="keyword">in</span> SE Linux Mode</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">SLES - SUSE Linux Enterprise Server 11, 64-bit. Service Pack 2æˆ–åˆ™æ›´é«˜ç‰ˆæœ¬. æ›´æ–°å­˜å‚¨åº“å¿…é¡»æ˜¯æ¿€æ´»çš„å’Œ SUSE Linux Enterprise è½¯ä»¶å¼€å‘åŒ…11 SP1 .</div><div class="line">Debian - Debian 7.0 and 7.1, 64-bit</div><div class="line">Ubuntu - Ubuntu 12.04, 64-bit</div><div class="line"></div><div class="line">å¦‚æœè¦æ±‚ä¸èƒ½ä¸Šé¢æ»¡è¶³ï¼Œå®‰è£…ä¼šä¸æˆåŠŸã€‚å…³äºCloudera Managerå®‰è£…é€‰é¡¹å’Œå®‰è£…è¦æ±‚çš„è¯¦ç»†ä¿¡æ¯å¯ä»¥æŸ¥çœ‹Cloudera Managerå®‰è£…å‘å¯¼ï¼ˆè‹±æ–‡ç‰ˆï¼‰</div><div class="line">è¡¥å……å’Œå¼ºè°ƒä¸€äº›å†…å®¹</div><div class="line">1.å…³é—­é˜²ç«å¢™</div><div class="line">2.é…ç½®hostï¼Œå¦‚ä¸‹å½¢å¼</div><div class="line">3.swapoff <span class="_">-a</span> å…³é—­swapåˆ†åŒº</div><div class="line">æ·»åŠ å¼€æœºå¯åŠ¨ç”Ÿæ•ˆï¼š</div><div class="line"><span class="built_in">echo</span> never &gt; /sys/kernel/mm/transparent_hugepage/defrag</div><div class="line"><span class="built_in">echo</span> never &gt; /sys/kernel/mm/transparent_hugepage/enabled</div></pre></td></tr></table></figure><h3 id="ç¯å¢ƒï¼š"><a href="#ç¯å¢ƒï¼š" class="headerlink" title="ç¯å¢ƒï¼š"></a>ç¯å¢ƒï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">ç³»ç»Ÿï¼š CentOS Linux release 7.3.1611 (Core)  </div><div class="line">2å°Namenode</div><div class="line">10å°DataNode</div><div class="line">1å°cdm å®‰è£…Cloudera Manager</div><div class="line">1å°gateway</div></pre></td></tr></table></figure><h3 id="å®‰è£…æ­¥éª¤ï¼š"><a href="#å®‰è£…æ­¥éª¤ï¼š" class="headerlink" title="å®‰è£…æ­¥éª¤ï¼š"></a>å®‰è£…æ­¥éª¤ï¼š</h3><ul><li>å‡†å¤‡å·¥ä½œ</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">é…ç½®hosts</div><div class="line"></div><div class="line">14å°æœåŠ¡å™¨éœ€è¦é…ç½®hostnameåŠhostså¦‚ä¸‹</div><div class="line">ï¼ˆè¿™é‡Œä¸€å®šè¦é…ç½®æ­£ç¡®å¦åˆ™ï¼Œä¼šé¢ä¼šå‡ºé€šä¿¡é—®é¢˜ï¼‰</div><div class="line"></div><div class="line">vim /etc/hosts</div><div class="line">127.0.0.1 localhost.localdomain localhost</div><div class="line">10.155.90.132  cdm  cdm.jollychic.com</div><div class="line">10.155.90.134  gateway gateway.jollychic.com</div><div class="line">10.155.90.165  namenode1  namenode1.jollychic.com</div><div class="line">10.155.90.146  namenode2  namenode2.jollychic.com</div><div class="line">10.155.90.177  datanode1  datanode1.jollychic.com</div><div class="line">10.155.90.184  datanode2  datanode2.jollychic.com</div><div class="line">10.155.90.166  datanode3  datanode3.jollychic.com</div><div class="line">10.155.90.188  datanode4  datanode4.jollychic.com</div><div class="line">10.155.90.156  datanode5  datanode5.jollychic.com</div><div class="line">10.155.90.172  datanode6  datanode6.jollychic.com</div><div class="line">10.155.90.182  datanode7  datanode7.jollychic.com</div><div class="line">10.155.90.142  datanode8  datanode8.jollychic.com</div><div class="line">10.155.90.151  datanode9  datanode9.jollychic.com</div><div class="line">10.155.90.159  datanode10  datanode10.jollychic.com</div><div class="line"></div><div class="line">å…³é—­SELinux</div><div class="line">[root@cdm ~]<span class="comment"># setenforce 0</span></div><div class="line">[root@cdm ~]<span class="comment"># getenforce</span></div><div class="line">Disabled</div></pre></td></tr></table></figure><ul><li>ä¸‹è½½å®‰è£…ï¼š</li></ul><figure class="highlight armasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">å•å‡»ä¸‹è½½ Cloudera Express æˆ–åˆ™ Download Cloudera Enterprise. æŸ¥çœ‹ Cloudera Express <span class="keyword">and </span>Cloudera Enterprise Features.</div><div class="line">é€‰æ‹©æ³¨å†Œå’Œå•å‡»<span class="keyword">Submit </span>æˆ–åˆ™ç›´æ¥å•å‡»ä¸‹è½½é¡µé“¾æ¥ï¼ˆ download pageï¼‰ï¼Œä¸‹è½½ cloudera-manager-installer.<span class="keyword">binæ–‡ä»¶</span></div><div class="line"></div><div class="line"><span class="symbol">Pre</span>-requisites: <span class="keyword">multiple, </span>Internet-connected Linux machines, with SSH access, <span class="keyword">and </span>significant free <span class="meta">space</span> in /var <span class="keyword">and </span>/<span class="meta">opt</span>.</div><div class="line"></div><div class="line"><span class="number">1</span>. ä¸‹è½½cloudera-manager-installer.<span class="keyword">bin</span></div><div class="line">$ wget http://archive.cloudera.com/cm5/installer/latest/cloudera-manager-installer.<span class="keyword">bin</span></div><div class="line"></div><div class="line"><span class="number">2</span>.æ”¹å˜ cloudera-manager-installer.<span class="keyword">bin </span>çš„æ‰§è¡Œæƒé™</div><div class="line"></div><div class="line">$ chmod u+x cloudera-manager-installer.<span class="keyword">bin</span></div><div class="line">å¤åˆ¶ä»£ç </div><div class="line"></div><div class="line"><span class="number">3</span>.æ‰§è¡Œ cloudera-manager-installer.<span class="keyword">bin</span></div><div class="line"></div><div class="line">$ sudo ./cloudera-manager-installer.<span class="keyword">bin</span></div><div class="line">å¤åˆ¶ä»£ç </div><div class="line"></div><div class="line"><span class="number">4</span>.æŒ‰ç…§cloudera-managerçš„README æ¥å®‰è£…</div><div class="line"><span class="number">5</span>.é˜…è¯»Cloudera Manager Express Licenseï¼Œç„¶åæŒ‰ç…§æç¤ºé€‰æ‹©YESæ¥ç¡®å®šæ¥å—æˆæƒï¼ˆlicenseï¼‰</div><div class="line"><span class="number">6</span>.è¯»å– Oracle äºŒè¿›åˆ¶ <span class="meta">Code</span> æˆæƒè®¸å¯åè®®ï¼Œç„¶åå®‰è£… </div><div class="line"><span class="number">7</span>.å½“å®‰è£…å®Œæˆï¼ŒCloudera Manager ç®¡ç†æ§åˆ¶å°ä¼šæä¾›ä¸€ä¸ªå®Œæˆçš„urlåŒ…æ‹¬é»˜è®¤ç«¯å£<span class="number">7180</span></div><div class="line"></div><div class="line">æˆ‘è¿™ç§æ–¹æ³•æ˜¯åœ¨çº¿å®‰è£…æ–¹å¼ï¼Œå°±è¯´ç›´æ¥ç”¨.<span class="keyword">binè®©ç³»ç»Ÿè‡ªåŠ¨ä¸‹è½½éœ€è¦çš„jdkå’Œcmç®¡ç†åŒ…ã€‚ </span></div><div class="line">å¦‚æœç½‘ç»œå·®å»ºè®®ç”¨ç¦»çº¿å®‰è£…æ–¹å¼ã€‚</div></pre></td></tr></table></figure><p>å…ˆåœ¨æœ¬åœ°æ­å»ºä¸€ä¸ª<a href="https://www.cloudera.com/documentation/enterprise/latest/topics/cdh_ig_yumrepo_local_create.html" target="_blank" rel="external">Creating a Local Yum Repository:</a><br>ä¸‹è½½ç‹¬ç«‹çš„åŒ…è·¯å¾„ï¼š<a href="http://archive.cloudera.com/cm5/redhat/6/x86_64/cm/5/RPMS/x86_64/" target="_blank" rel="external">cm need package</a></p><p>å®‰è£…å®Œæˆä»¥åæœåŠ¡ä¹Ÿå¯åŠ¨ã€‚</p><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera2.png" alt=""></figure></p><p>è¿™é‡Œæ˜¾ç¤ºå®‰è£…æˆåŠŸï¼Œè®¿é—®åœ°å€ï¼Œå¦‚æœç¦»çº¿å®‰è£…ä¸åˆ°è¿™ä¸€æ­¥ä¸èƒ½æ“ä½œï¼Œä¼šæç¤ºæŠ¥é”™æŒ‡ç¤ºã€‚å…ˆæ‰‹åŠ¨ä¸‹è½½å¥½åŒ…rpmå®‰è£…ä¸Šå³å¯ã€‚</p><h4 id="å®‰è£…ç›®å½•è¯¦æƒ…ï¼š"><a href="#å®‰è£…ç›®å½•è¯¦æƒ…ï¼š" class="headerlink" title="å®‰è£…ç›®å½•è¯¦æƒ…ï¼š"></a>å®‰è£…ç›®å½•è¯¦æƒ…ï¼š</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">é»˜è®¤å®‰è£…ç›®å½•ï¼š/opt/cloudera</div><div class="line">æ—¥å¿—ç›®å½•ï¼š/var/<span class="built_in">log</span>/cloudera-scm-server</div><div class="line">å¯åŠ¨æœåŠ¡ï¼š[root@yancy cloudera-scm-server]<span class="comment"># /etc/init.d/cloudera-scm-server status</span></div><div class="line">cloudera-scm-server (pid  2723) æ­£åœ¨è¿è¡Œ...</div></pre></td></tr></table></figure><h4 id="æŸ¥çœ‹å¯åŠ¨è¿›ç¨‹ç«¯å£ï¼š"><a href="#æŸ¥çœ‹å¯åŠ¨è¿›ç¨‹ç«¯å£ï¼š" class="headerlink" title="æŸ¥çœ‹å¯åŠ¨è¿›ç¨‹ç«¯å£ï¼š"></a>æŸ¥çœ‹å¯åŠ¨è¿›ç¨‹ç«¯å£ï¼š</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@cdm opt]<span class="comment"># netstat -ntulp | grep java</span></div><div class="line">tcp        0      0 0.0.0.0:7180            0.0.0.0:*               LISTEN      25780/java</div><div class="line">tcp        0      0 0.0.0.0:7182            0.0.0.0:*               LISTEN      25780/java   </div><div class="line"></div><div class="line">è®¿é—®åœ°å€ï¼šhttp://cdm.jollychic.com:7180 </div><div class="line">ç™»å½•Cloudera Manager Admin æ§åˆ¶</div><div class="line">Username: admin </div><div class="line">Password: admin.</div></pre></td></tr></table></figure><h3 id="ä½¿ç”¨Cloudera-Manager-å‘å¯¼å®‰è£…å’Œé…ç½®è½¯ä»¶"><a href="#ä½¿ç”¨Cloudera-Manager-å‘å¯¼å®‰è£…å’Œé…ç½®è½¯ä»¶" class="headerlink" title="ä½¿ç”¨Cloudera Manager å‘å¯¼å®‰è£…å’Œé…ç½®è½¯ä»¶"></a>ä½¿ç”¨Cloudera Manager å‘å¯¼å®‰è£…å’Œé…ç½®è½¯ä»¶</h3><h4 id="clouderaé¦–é¡µï¼š"><a href="#clouderaé¦–é¡µï¼š" class="headerlink" title="clouderaé¦–é¡µï¼š"></a>clouderaé¦–é¡µï¼š</h4><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera3.png" alt=""></figure></p><h5 id="1-æ·»åŠ æœåŠ¡å™¨é›†ç¾¤ï¼š"><a href="#1-æ·»åŠ æœåŠ¡å™¨é›†ç¾¤ï¼š" class="headerlink" title="1. æ·»åŠ æœåŠ¡å™¨é›†ç¾¤ï¼š"></a>1. æ·»åŠ æœåŠ¡å™¨é›†ç¾¤ï¼š</h5><p>åœ¨é›†ç¾¤ä¸»æœºä¸Šå®‰è£…å’Œé…ç½®Cloudera Manager ï¼ŒCDHï¼Œå’Œç®¡ç†æœåŠ¡è½¯ä»¶åŒ…æ‹¬ä»¥ä¸‹ä¸‰ä¸ªä¸»è¦æ­¥éª¤<br>é€‰æ‹© Cloudera Manager ç‰ˆæœ¬ å’ŒæŒ‡å®šä¸»æœº</p><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera5.png" alt=""></figure></p><h5 id="2-é€‰æ‹©å…è´¹ç‰ˆï¼Œaddç»§ç»­"><a href="#2-é€‰æ‹©å…è´¹ç‰ˆï¼Œaddç»§ç»­" class="headerlink" title="2. é€‰æ‹©å…è´¹ç‰ˆï¼Œaddç»§ç»­"></a>2. é€‰æ‹©å…è´¹ç‰ˆï¼Œaddç»§ç»­</h5><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera6.png" alt=""></figure></p><h5 id="3-æ˜¾ç¤ºçš„æ˜¯å®‰è£…Cloudera-Manageråé¢å¯ä»¥å®‰è£…çš„æœåŠ¡çš„è½¯ä»¶åŒ…"><a href="#3-æ˜¾ç¤ºçš„æ˜¯å®‰è£…Cloudera-Manageråé¢å¯ä»¥å®‰è£…çš„æœåŠ¡çš„è½¯ä»¶åŒ…" class="headerlink" title="3. æ˜¾ç¤ºçš„æ˜¯å®‰è£…Cloudera Manageråé¢å¯ä»¥å®‰è£…çš„æœåŠ¡çš„è½¯ä»¶åŒ…"></a>3. æ˜¾ç¤ºçš„æ˜¯å®‰è£…Cloudera Manageråé¢å¯ä»¥å®‰è£…çš„æœåŠ¡çš„è½¯ä»¶åŒ…</h5><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera7.png" alt=""></figure></p><h5 id="4-è¿™é‡Œéœ€è¦è¯´æ˜çš„æ˜¯æŒ‡å®šä¸»æœºå®‰è£…æœ‰å¤šç§æ–¹å¼ï¼š"><a href="#4-è¿™é‡Œéœ€è¦è¯´æ˜çš„æ˜¯æŒ‡å®šä¸»æœºå®‰è£…æœ‰å¤šç§æ–¹å¼ï¼š" class="headerlink" title="4. è¿™é‡Œéœ€è¦è¯´æ˜çš„æ˜¯æŒ‡å®šä¸»æœºå®‰è£…æœ‰å¤šç§æ–¹å¼ï¼š"></a>4. è¿™é‡Œéœ€è¦è¯´æ˜çš„æ˜¯æŒ‡å®šä¸»æœºå®‰è£…æœ‰å¤šç§æ–¹å¼ï¼š</h5><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="number">1.</span>ç›´æ¥åˆ—å‡ºipæˆ–åˆ™hostï¼Œå¤šå°ä»¥é€—å·ã€åˆ†å·ã€åˆ¶è¡¨ç¬¦ã€ç©ºæ ¼æˆ–æ”¾ç½®åœ¨å•ç‹¬çš„è¡Œã€‚</div><div class="line"><span class="number">2.</span>æŒ‡å®šipçš„åœ°å€èŒƒå›´ä¾‹å¦‚ï¼š<span class="number">10.1</span><span class="number">.1</span>.[<span class="number">1</span><span class="number">-4</span>] æˆ–åˆ™ host[<span class="number">1</span><span class="number">-3</span>].hadoop.com<span class="number">.3</span>.è®°å¾—æŒ‡å®šçš„ä¸»æœºéœ€è¦å…³é—­é˜²ç«å¢™ï¼Œï¼ˆå¦‚æœé‡åˆ°ä¸èƒ½å®‰è£…ï¼Œæœ€å¥½ä½¿ç”¨å®‰è£…cloudera managerè™šæ‹Ÿæœºè¿›è¡Œå¤åˆ¶ï¼‰</div><div class="line">é€‰æ‹©éœ€è¦å®‰è£…çš„Hadoop datanodeæœåŠ¡å™¨ï¼šè¿™é‡Œæˆ‘ä»¬çº¿ä¸Šè®¿é—®ç«¯å£ä¸æ˜¯<span class="number">22</span>æ˜¯<span class="number">58958</span></div></pre></td></tr></table></figure><p>æ˜¾ç¤ºå¦‚ä¸‹å›¾è¯´æ˜æœºå™¨é€šä¿¡æ²¡é—®é¢˜ã€‚</p><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera8.png" alt=""></figure></p><h5 id="5-å®‰è£…CDH"><a href="#5-å®‰è£…CDH" class="headerlink" title="5. å®‰è£…CDH"></a>5. å®‰è£…CDH</h5><p>é€‰æ‹©å®‰è£…æ–¹å¼<br>å½“æˆ‘ä»¬é€‰æ‹©å®‰è£…çš„hostä¹‹åï¼Œæˆ‘ä»¬éœ€è¦é€‰æ‹©CDHçš„å®‰è£…æ–¹å¼ï¼ˆæ–¹æ³•ï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</p><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera9.png" alt=""></figure><br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera10.png" alt=""></figure></p><h5 id="6-è¿™é‡Œç‚¹å‡»å®‰è£…Javaå·¥å…·åŒ…"><a href="#6-è¿™é‡Œç‚¹å‡»å®‰è£…Javaå·¥å…·åŒ…" class="headerlink" title="6. è¿™é‡Œç‚¹å‡»å®‰è£…Javaå·¥å…·åŒ…"></a>6. è¿™é‡Œç‚¹å‡»å®‰è£…Javaå·¥å…·åŒ…</h5><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera11.png" alt=""></figure></p><h5 id="7-è¿™é‡ŒæŠŠéœ€è¦å®‰è£…çš„HadoopæœåŠ¡å™¨rootå¯†ç è®¾ç½®ä¸€æ ·ï¼Œæˆ–è€…ä½¿ç”¨å…¶ä»–ç”¨æˆ·ä¹Ÿå¯ä»¥ï¼Œåªè¦æœ‰sudoæƒé™éƒ½å¯ä»¥ã€‚"><a href="#7-è¿™é‡ŒæŠŠéœ€è¦å®‰è£…çš„HadoopæœåŠ¡å™¨rootå¯†ç è®¾ç½®ä¸€æ ·ï¼Œæˆ–è€…ä½¿ç”¨å…¶ä»–ç”¨æˆ·ä¹Ÿå¯ä»¥ï¼Œåªè¦æœ‰sudoæƒé™éƒ½å¯ä»¥ã€‚" class="headerlink" title="7. è¿™é‡ŒæŠŠéœ€è¦å®‰è£…çš„HadoopæœåŠ¡å™¨rootå¯†ç è®¾ç½®ä¸€æ ·ï¼Œæˆ–è€…ä½¿ç”¨å…¶ä»–ç”¨æˆ·ä¹Ÿå¯ä»¥ï¼Œåªè¦æœ‰sudoæƒé™éƒ½å¯ä»¥ã€‚"></a>7. è¿™é‡ŒæŠŠéœ€è¦å®‰è£…çš„HadoopæœåŠ¡å™¨rootå¯†ç è®¾ç½®ä¸€æ ·ï¼Œæˆ–è€…ä½¿ç”¨å…¶ä»–ç”¨æˆ·ä¹Ÿå¯ä»¥ï¼Œåªè¦æœ‰sudoæƒé™éƒ½å¯ä»¥ã€‚</h5><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera12.png" alt=""></figure><br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera13.png" alt=""></figure></p><h5 id="8-å®‰è£…è¿™é‡Œå¦‚æœæç¤ºå‡ºç°æŠ¥é”™ï¼šæŸ¥çœ‹å¥½æ–‡-Cloudera-Manager5-åœ¨çº¿binå®‰è£…é‡åˆ°-æ— æ³•æ£€æµ‹åˆ°-Agent-å‘å‡ºçš„æ£€æµ‹ä¿¡å·-æ€»ç»“"><a href="#8-å®‰è£…è¿™é‡Œå¦‚æœæç¤ºå‡ºç°æŠ¥é”™ï¼šæŸ¥çœ‹å¥½æ–‡-Cloudera-Manager5-åœ¨çº¿binå®‰è£…é‡åˆ°-æ— æ³•æ£€æµ‹åˆ°-Agent-å‘å‡ºçš„æ£€æµ‹ä¿¡å·-æ€»ç»“" class="headerlink" title="8.å®‰è£…è¿™é‡Œå¦‚æœæç¤ºå‡ºç°æŠ¥é”™ï¼šæŸ¥çœ‹å¥½æ–‡ Cloudera Manager5 åœ¨çº¿binå®‰è£…é‡åˆ° æ— æ³•æ£€æµ‹åˆ° Agent å‘å‡ºçš„æ£€æµ‹ä¿¡å· æ€»ç»“"></a>8.å®‰è£…è¿™é‡Œå¦‚æœæç¤ºå‡ºç°æŠ¥é”™ï¼šæŸ¥çœ‹å¥½æ–‡ <a href="http://www.aboutyun.com/thread-9293-1-1.html" target="_blank" rel="external">Cloudera Manager5 åœ¨çº¿binå®‰è£…é‡åˆ° æ— æ³•æ£€æµ‹åˆ° Agent å‘å‡ºçš„æ£€æµ‹ä¿¡å· æ€»ç»“</a></h5><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera14.png" alt=""></figure><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">è¿™é‡Œåªéœ€è¦å¸è½½ï¼š</div><div class="line">yum remove cloudera-manager-agent </div><div class="line"></div><div class="line">å¦‚æœæƒ³é‡æ–°å®‰è£…å¯ä»¥å¸è½½æ‰€æœ‰ï¼š</div><div class="line">yum remove cloudera-manager-repository cloudera-manager-agent cloudera-manager-daemons cloudera-manager-server-db cloudera-manager-server -y</div></pre></td></tr></table></figure></p><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera15.png" alt=""></figure></p><h5 id="9-é›†ç¾¤å®‰è£…"><a href="#9-é›†ç¾¤å®‰è£…" class="headerlink" title="9.é›†ç¾¤å®‰è£…"></a>9.é›†ç¾¤å®‰è£…</h5><p><strong>å›¾1</strong></p><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera16.png" alt=""></figure><br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera17.png" alt=""></figure><br><strong>è¿™æ˜¯ä¸€ä¸ªå¾ˆæ¼«é•¿çš„è¿‡ç¨‹ï¼Œä¸å¹¸çš„æ˜¯åœ¨ä¸‹è½½å®Œæ¯•ï¼Œæ‰§è¡Œåˆ†å‘çš„æ—¶å€™ï¼Œè¿™ä¸ªè¿‡ç¨‹è¢«æ‰“æ–­ï¼Œå®‰è£…è¢«ç»ˆæ­¢ã€‚å¯¼è‡´å›ä¸åˆ°å›¾2ï¼Œè¿™ä¸ªè¯¥å¦‚ä½•è§£å†³ï¼Ÿ</strong><br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera18.png" alt=""></figure></p><p>éš¾é“çœŸçš„è¦é‡è£…å—ï¼ŸèŠ±è´¹äº†å¤§åŠå¤©åŠŸå¤«ï¼Œåˆä¸å¾—ä¸é‡æ¥ã€‚<br>è¿™é‡Œé¢çš„é—®é¢˜æ˜¯æ‰¾ä¸åˆ°cloudera manager5æ‰€ç®¡ç†çš„èŠ‚ç‚¹äº†ï¼Ÿ</p><p>è®°å¾—aboutäº‘æœ‰è¿™ç¯‡æ–‡ç« <a href="http://www.aboutyun.com/thread-8992-1-1.html" target="_blank" rel="external">å¸è½½ Cloudera Manager 5.1.x.å’Œ ç›¸å…³è½¯ä»¶</a>ã€å®˜ç½‘ç¿»è¯‘ï¼šé«˜å¯ç”¨ã€‘<br>ä½†æ˜¯è¿™ç¯‡æ–‡ç« æ˜¯å¸è½½Cloudera Managerä»¥åŠCDHçš„ï¼Œç”±äºcloudera-scm-serverå’Œcloudera-scm-agentæŸ¥çœ‹éƒ½æ˜¯è¿è¡Œæ­£å¸¸çš„ï¼Œå¦‚ä½•æŸ¥çœ‹çŠ¶æ€ï¼Œå¯ä»¥å‚è€ƒï¼š</p><p><a href="http://www.aboutyun.com/thread-9096-1-1.html" target="_blank" rel="external">Cloudera Manager Server5åŠCloudera Manager Agents5å‘½ä»¤æ•´ç†ï¼ˆaboutäº‘ï¼‰</a>ï¼Œæ‰€ä»¥cloudera managerä¸éœ€è¦å¸è½½ï¼Œå¸è½½çš„æ˜¯CDHçš„ç›¸å…³å†…å®¹ã€‚<br>äºæ˜¯æ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼š</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">sudo apt-<span class="keyword">update</span> remove avro-tools crunch flume-ng hadoop-hdfs-fuse hadoop-hdfs-nfs3 hadoop-httpfs hbase-solr hive-hbase hive-webhcat hue-beeswax hue-hbase hue-impala hue-pig hue-plugins hue-rdbms hue-<span class="keyword">search</span> hue-spark hue-sqoop hue-zookeeper impala impala-<span class="keyword">shell</span> kite llama mahout oozie pig pig-udf-datafu <span class="keyword">search</span> sentry solr-mapreduce spark-python sqoop sqoop2 whirr</div><div class="line">å¤åˆ¶ä»£ç </div><div class="line">sudo apt-get clean</div><div class="line">å¤åˆ¶ä»£ç </div><div class="line">sudo <span class="keyword">rm</span> -Rf /<span class="keyword">var</span>/lib/flume-ng /<span class="keyword">var</span>/lib/hadoop* /<span class="keyword">var</span>/lib/hue /<span class="keyword">var</span>/lib/navigator /<span class="keyword">var</span>/lib/oozie /<span class="keyword">var</span>/lib/solr /<span class="keyword">var</span>/lib/sqoop* /<span class="keyword">var</span>/lib/zookeeper</div><div class="line">å¤åˆ¶ä»£ç </div><div class="line">sudo <span class="keyword">rm</span> -Rf /dfs /mapred /yarn</div><div class="line">å¤åˆ¶ä»£ç </div><div class="line">é€šè¿‡ä¸Šé¢ç»ˆäºæ‰¾åˆ°æ‰€ç®¡ç†çš„ä¸‰ä¸ªèŠ‚ç‚¹ã€‚ç„¶åä»æ–°ç™»å½•ï¼Œé€‰æ‹©ä¸‰ä¸ªä¸»æœºï¼Œç„¶åç»§ç»­ç»§ç»­ï¼Œæœ€åç»ˆäºè¿›å…¥äº†è¿™ä¸ªç•Œé¢ã€‚ä½†æ˜¯ç»†å¿ƒçš„åŒå­¦ä¼šå‘ç°è¿™é‡Œå·²ç»æ›´æ¢ä¸ºä¸­æ–‡ç‰ˆæœ¬ã€‚å› ä¸ºè¿™æ˜¯é€šè¿‡å®¿ä¸»ä¸»æœºè®¿é—®çš„ã€‚è€Œå‰é¢æ˜¯åœ¨è™šæ‹Ÿæœºé‡Œä½¿ç”¨firefoxè®¿é—®çš„ã€‚</div></pre></td></tr></table></figure><h4 id="æˆåŠŸåˆ°è¿™ä¸€æ­¥ï¼šé›†ç¾¤å®‰è£…"><a href="#æˆåŠŸåˆ°è¿™ä¸€æ­¥ï¼šé›†ç¾¤å®‰è£…" class="headerlink" title="æˆåŠŸåˆ°è¿™ä¸€æ­¥ï¼šé›†ç¾¤å®‰è£…"></a>æˆåŠŸåˆ°è¿™ä¸€æ­¥ï¼šé›†ç¾¤å®‰è£…</h4><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera19.png" alt=""></figure><br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera20.png" alt=""></figure></p><h5 id="10-é€‰æ‹©é›†ç¾¤è®¾ç½®"><a href="#10-é€‰æ‹©é›†ç¾¤è®¾ç½®" class="headerlink" title="10.é€‰æ‹©é›†ç¾¤è®¾ç½®"></a>10.é€‰æ‹©é›†ç¾¤è®¾ç½®</h5><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera21.png" alt=""></figure></p><h5 id="10-1-é›†ç¾¤è®¾ç½®ï¼šè‡ªå®šä¹‰è§’è‰²åˆ†é…"><a href="#10-1-é›†ç¾¤è®¾ç½®ï¼šè‡ªå®šä¹‰è§’è‰²åˆ†é…" class="headerlink" title="10.1 é›†ç¾¤è®¾ç½®ï¼šè‡ªå®šä¹‰è§’è‰²åˆ†é…"></a>10.1 é›†ç¾¤è®¾ç½®ï¼šè‡ªå®šä¹‰è§’è‰²åˆ†é…</h5><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera22.png" alt=""></figure><br>è®¾ç½®å¥½è§’è‰²åˆ†é…æŸ¥çœ‹ä¸»æœºï¼š</p><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera23.png" alt=""></figure></p><h5 id="11-æ•°æ®åº“è®¾ç½®"><a href="#11-æ•°æ®åº“è®¾ç½®" class="headerlink" title="11. æ•°æ®åº“è®¾ç½®"></a>11. æ•°æ®åº“è®¾ç½®</h5><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera24.png" alt=""></figure></p><p>âœ¨âœ¨ <strong>è¿™é‡Œä½¿ç”¨é»˜è®¤è®¾ç½®ï¼Œå¡«å†™MySQLæœåŠ¡å™¨IPï¼Œç»™äºˆMySQL ç”¨æˆ·åå’Œå¯†ç allæƒé™ï¼Œä¸ç„¶ä¼šæç¤ºæƒé™ä¸è¶³ã€‚</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">Create the Oozie Database and Oozie MySQL User</div><div class="line">For example, using the MySQL mysql <span class="built_in">command</span>-line tool:</div><div class="line"></div><div class="line">$ mysql -u root -p</div><div class="line">Enter password:</div><div class="line"></div><div class="line">mysql&gt; create database oozie default character <span class="built_in">set</span> utf8;</div><div class="line">Query OK, 1 row affected (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt;  grant all privileges on oozie.* to <span class="string">'oozie'</span>@<span class="string">'localhost'</span> identified by <span class="string">'oozie'</span>;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt;  grant all privileges on oozie.* to <span class="string">'oozie'</span>@<span class="string">'%'</span> identified by <span class="string">'oozie'</span>;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; <span class="built_in">exit</span></div><div class="line">Bye</div></pre></td></tr></table></figure><p>é€‰æ‹©ç„¶åå•å‡»æµ‹è¯•è¿æ¥å³å¯ã€‚</p><p><strong>æµ‹è¯• Activity Monitor çš„æ•°æ®åº“è¿æ¥</strong><br><strong>JDBC driver cannot be found. Unable to find the JDBC database jar on host : wlj-cdm.</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">å¦‚æœå‡ºç°éœ€è¦MySQLé©±åŠ¨,ä¸‹è½½å¯¹åº”ç‰ˆæœ¬é©±åŠ¨ï¼Œcopyåˆ°ç›¸åº”ç›®å½•/usr/share/java/ ç»Ÿä¸€å»æ‰ç‰ˆæœ¬å·.</div><div class="line">å‚è€ƒInstalling the MySQL JDBC Driverå®˜ç½‘æ–‡æ¡£ï¼šhttps://www.cloudera.com/documentation/enterprise/latest/topics/cm_ig_mysql.html</div><div class="line"></div><div class="line"><span class="comment">#### Installing the MySQL JDBC Driver </span></div><div class="line"></div><div class="line"></div><div class="line">Download the MySQL JDBC driver from http://www.mysql.com/downloads/connector/j/5.1.html.</div><div class="line">Extract the JDBC driver JAR file from the downloaded file. For example:</div><div class="line"></div><div class="line"><span class="comment">### $ wget https://dev.mysql.com/get/Downloads/Connector-J/mysql-connector-java-5.1.44.tar.gz</span></div><div class="line"><span class="comment">### $ tar zxvf mysql-connector-java-5.1.31.tar.gz</span></div><div class="line">Copy the JDBC driver, renamed, to the relevant host. For example:</div><div class="line"><span class="comment">### $ sudo cp mysql-connector-java-5.1.31/mysql-connector-java-5.1.31-bin.jar /usr/share/java/mysql-connector-java.jar</span></div><div class="line">If the target directory does not yet exist on this host, you can create it before copying the JAR file. For example:</div><div class="line"></div><div class="line"><span class="comment">### $ sudo mkdir -p /usr/share/java/</span></div><div class="line"><span class="comment">### $ sudo cp mysql-connector-java-5.1.31/mysql-connector-java-5.1.31-bin.jar /usr/share/java/mysql-connector-java.jar</span></div></pre></td></tr></table></figure><h5 id="12-å®¡æ ¸æ›´æ”¹-è¿™é‡Œé€‰æ‹©é»˜è®¤è·¯å¾„"><a href="#12-å®¡æ ¸æ›´æ”¹-è¿™é‡Œé€‰æ‹©é»˜è®¤è·¯å¾„" class="headerlink" title="12. å®¡æ ¸æ›´æ”¹(è¿™é‡Œé€‰æ‹©é»˜è®¤è·¯å¾„)"></a>12. å®¡æ ¸æ›´æ”¹(è¿™é‡Œé€‰æ‹©é»˜è®¤è·¯å¾„)</h5><p>ç­‰å¾…å®‰è£…ï¼š<br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera25.png" alt=""></figure></p><h5 id="13-å®‰è£…æˆåŠŸ"><a href="#13-å®‰è£…æˆåŠŸ" class="headerlink" title="13. å®‰è£…æˆåŠŸ"></a>13. å®‰è£…æˆåŠŸ</h5><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera25.png" alt=""></figure></p><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera26.png" alt=""></figure></p><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera27.png" alt=""></figure></p><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera28.png" alt=""></figure></p><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera29.png" alt=""></figure></p><h3 id="äº¤æµå­¦ä¹ ï¼š"><a href="#äº¤æµå­¦ä¹ ï¼š" class="headerlink" title="äº¤æµå­¦ä¹ ï¼š"></a>äº¤æµå­¦ä¹ ï¼š</h3><p>ğŸ§  Linux shell_é«˜çº§è¿ç»´æ´¾: <code>459096184</code>    åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)<br>ğŸ§  BigData-Exchange School : <code>521621407</code>  åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥</p><p>ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;https://www.cardinalsolutions.com/~/media/Images/cardinal/events/ClouderaSessions-660.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;é—®é¢˜å¯¼è¯»ï¼š&quot;&gt;&lt;a href=&quot;#é—®é¢˜å¯¼è¯»ï¼š&quot; class=&quot;headerlink&quot; title=&quot;é—®é¢˜å¯¼è¯»ï¼š&quot;&gt;&lt;/a&gt;é—®é¢˜å¯¼è¯»ï¼š&lt;/h3&gt;&lt;p&gt;1.ä»€ä¹ˆæ˜¯cloudera CM ã€CDH?&lt;br&gt;2.CDHã€CMæœ‰å“ªäº›ç‰ˆæœ¬ï¼Ÿ&lt;br&gt;3.CDHã€CMæœ‰å“ªäº›å®‰è£…æ–¹å¼ï¼Ÿ&lt;br&gt;4.CDHå¦‚ä½•å¼€å‘ï¼Ÿ&lt;/p&gt;
    
    </summary>
    
      <category term="Bigdata Hadoop" scheme="http://blog.yancy.cc/categories/Bigdata-Hadoop/"/>
    
    
      <category term="Countly" scheme="http://blog.yancy.cc/tags/Countly/"/>
    
      <category term="Bigdata" scheme="http://blog.yancy.cc/tags/Bigdata/"/>
    
  </entry>
  
  <entry>
    <title>ElasticStack 5.x+Kibana-5.5.x+Logstashç‰ˆæœ¬éƒ¨ç½²æ¦‚è¿°</title>
    <link href="http://blog.yancy.cc/2017/08/11/%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%10%E5%B9%B3%E5%8F%B0/Elasticsearch/ElasticStack%205.x+Kibana-5.5.x+Logstash%E7%89%88%E6%9C%AC%E9%83%A8%E7%BD%B2%E6%A6%82%E8%BF%B0/"/>
    <id>http://blog.yancy.cc/2017/08/11/æ—¥å¿—åˆ†æå¹³å°/Elasticsearch/ElasticStack 5.x+Kibana-5.5.x+Logstashç‰ˆæœ¬éƒ¨ç½²æ¦‚è¿°/</id>
    <published>2017-08-11T09:56:03.000Z</published>
    <updated>2017-09-23T16:21:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ElasticStack-5-xä»‹ç»"><a href="#ElasticStack-5-xä»‹ç»" class="headerlink" title="ElasticStack 5.xä»‹ç»"></a>ElasticStack 5.xä»‹ç»</h2><h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><p><figure class="figure"><img src="https://www.elastic.co/cn/assets/blt08fb2e862c57956e/elastic-elk-b.png" alt="img-w550"><figcaption class="figure__caption">img-w550</figcaption></figure><br><code>ELK=ElasticSearch å®˜æ–¹åšå®¢:åˆ†å¸ƒå¼ä»¥åŠ Elastic</code></p><p>Elastic Stackæ˜¯ELKæ—¥å¿—ç³»ç»Ÿçš„å®˜æ–¹ç§°å‘¼ï¼Œè€ŒELKåˆ™æ˜¯ç››ååœ¨å¤–çš„ä¸€æ¬¾å¼€æºåˆ†å¸ƒå¼æ—¥å¿—ç³»ç»Ÿï¼Œä¸€èˆ¬è¯´æ¥åŒ…æ‹¬äº†Elasticsearchã€Logstashå’ŒKibanaï¼Œæ¶µç›–äº†åç«¯æ—¥å¿—é‡‡é›†ã€æ—¥å¿—æœç´¢æœåŠ¡å’Œå‰ç«¯æ•°æ®å±•ç¤ºç­‰åŠŸèƒ½ã€‚<br>æœ¬æ–‡å°†ä¼šå¯¹Elastic Stackçš„å®‰è£…éƒ¨ç½²æµç¨‹è¿›è¡Œä¸€ç³»åˆ—ç®€å•çš„ä»‹ç»ï¼Œå¹¶è®°å½•ä¸‹äº†ä¸€äº›éƒ¨ç½²è¿‡ç¨‹ä¸­é‡åˆ°çš„å‘åŠè§£å†³æ–¹æ³•ã€‚</p><p>å¯¹äºä¸€ä¸ªè½¯ä»¶æˆ–äº’è”ç½‘å…¬å¸æ¥è¯´ï¼Œå¯¹è®¡ç®—èµ„æºå’Œåº”ç”¨è¿›è¡Œç›‘æ§å’Œå‘Šè­¦æ˜¯éå¸¸åŸºç¡€çš„éœ€æ±‚ã€‚å¯¹äºå¤§å…¬å¸æˆ–æˆç†Ÿå…¬å¸ï¼Œä¸€ä¸ªé«˜åº¦å®šåˆ¶åŒ–çš„ç›‘æ§ç³»ç»Ÿåº”è¯¥å·²ç»å­˜åœ¨äº†å¾ˆé•¿æ—¶é—´å¹¶ä¸”éå¸¸æˆç†Ÿäº†ã€‚è€Œå¯¹äºä¸€ä¸ªåˆåˆ›å…¬å¸æˆ–å°å…¬å¸æ¥è¯´ï¼Œå¦‚ä½•åˆ©ç”¨ç°æœ‰å¼€æºå·¥å…·å¿«é€Ÿæ­å»ºä¸€å¥—æ—¥å¿—ç›‘æ§åŠåˆ†æå¹³å°æ˜¯éœ€è¦æ¢ç´¢çš„äº‹æƒ…ã€‚</p><a id="more"></a><h3 id="ç›‘æ§ç³»ç»Ÿçš„ç”¨æˆ·ï¼š"><a href="#ç›‘æ§ç³»ç»Ÿçš„ç”¨æˆ·ï¼š" class="headerlink" title="ç›‘æ§ç³»ç»Ÿçš„ç”¨æˆ·ï¼š"></a>ç›‘æ§ç³»ç»Ÿçš„ç”¨æˆ·ï¼š</h3><ul><li>è¿ç»´ï¼Œå¼€å‘ï¼Œäº§å“</li></ul><p>ç›‘æ§ç³»ç»Ÿåº”è¯¥å¯ä»¥è§£å†³å¦‚ä¸‹çš„é—®é¢˜ï¼š</p><ul><li>ç›‘æ§serverçš„å„é¡¹åŸºç¡€æŒ‡æ ‡ï¼Œæ¯”å¦‚<code>memory,cpu,load,network</code>ç­‰</li><li>ç›‘æ§åº”ç”¨çš„çŠ¶æ€ã€‚</li><li>æœé›†åº”ç”¨æ—¥å¿—ï¼Œå¹¶è¿›è¡Œåˆ†æå’Œç»Ÿè®¡ã€‚é€šè¿‡æ—¥å¿—åˆ†æå’Œç»Ÿè®¡å¯å¾—åˆ°åº”ç”¨çš„è®¿é—®ç»Ÿè®¡ï¼Œå¼‚å¸¸ç»Ÿè®¡ï¼Œä¸šåŠ¡ç»Ÿè®¡ã€‚å…·æœ‰è¿›è¡Œå¤§è§„æ¨¡æ—¥å¿—æ•°æ®çš„åˆ†æå’Œå¤„ç†èƒ½åŠ›ã€‚</li><li>å¯åˆ¶å®šå‘Šè­¦è§„åˆ™ã€‚å„ç§ç›‘æ§æ•°æ®è¿›å…¥ç³»ç»Ÿåï¼Œå¯ä»¥æ ¹æ®æ¡ä»¶è§¦å‘å‘Šè­¦ï¼Œå®æ—¶çš„å°†åº”ç”¨å¼‚å¸¸æƒ…å†µæ¨é€åˆ°è¿ç»´ã€å¼€å‘æˆ–ä¸šåŠ¡äººå‘˜çš„IM/SMSä¸Šã€‚</li><li>å¯å®šåˆ¶çš„çœ‹æ¿ã€‚å¯ä»¥å°†å„ç§å®æ—¶ç»Ÿè®¡æˆ–æŠ¥è¡¨ç›´è§‚çš„æ˜¾ç¤ºå‡ºæ¥ã€‚</li></ul><h3 id="å¯é€‰æ–¹æ¡ˆï¼š"><a href="#å¯é€‰æ–¹æ¡ˆï¼š" class="headerlink" title="å¯é€‰æ–¹æ¡ˆï¼š"></a>å¯é€‰æ–¹æ¡ˆï¼š</h3><p>æ—¥å¿—å®ï¼Œæ—¥å¿—æ˜“ï¼ŒLogtail(é˜¿é‡Œäº‘) è¿™æ˜¯æˆ‘ä»¬åé¢æ¢ <code>Graylog</code>è¿™ä¸ªæ˜¯ä¸€æ‰¹é»‘é©¬ ä¹Ÿåˆ†äº«å‡ºæ¥ã€‚</p><p>ä¼˜åŠ¿ï¼šä½¿ç”¨ç®€å•<br>åŠ£åŠ¿ï¼šéœ€ä¸Šä¼ æ—¥å¿—åˆ°å¤–éƒ¨ï¼Œä¸çµæ´»ï¼Œä¸æ˜“æ‰©å±•ï¼Œéœ€ä»˜è´¹</p><p>flume-ng + kafka + spark streaming + hbase(es/mysql) + zepplin/è‡ªç ”webå±•ç¤º</p><p>ä¼˜åŠ¿ï¼š<code>çµæ´»ï¼Œæ˜“äºæ‰©å±•ï¼Œæ•°æ®åˆ†æå’Œå¤„ç†èƒ½åŠ›å¼º</code><br>åŠ£åŠ¿ï¼š<code>å¼€å‘éš¾åº¦é«˜ï¼Œå‘¨æœŸé•¿ï¼Œç»´æŠ¤æˆæœ¬é«˜</code></p><h3 id="ELKä¼˜åŠ¿å’ŒåŠ£åŠ¿ï¼š"><a href="#ELKä¼˜åŠ¿å’ŒåŠ£åŠ¿ï¼š" class="headerlink" title="ELKä¼˜åŠ¿å’ŒåŠ£åŠ¿ï¼š"></a>ELKä¼˜åŠ¿å’ŒåŠ£åŠ¿ï¼š</h3><p>ä¼˜åŠ¿ï¼š<code>å¼€æºæˆç†Ÿè§£å†³æ–¹æ¡ˆï¼Œä½¿ç”¨ç®€å•ï¼Œæ‰©å±•èƒ½åŠ›å¼º</code><br>åŠ£åŠ¿ï¼š<code>æ—¥å¿—åˆ†æå’Œå¤„ç†ä¾é logstashå®Œæˆï¼Œå¤„ç†èƒ½åŠ›è¾ƒä½ï¼Œæ— æ³•é€‚åº”å¤æ‚çš„æ—¥å¿—åˆ†æåœºæ™¯</code><br>ç»“è®ºï¼š<code>åˆæ­¥é€‰æ‹©ELKæ­å»ºèµ·ç›‘æ§å¹³å°ï¼Œå…¶èƒ½å¤Ÿæ»¡è¶³å½“å‰è¾ƒä¸ºç®€å•çš„ç›‘æ§å’Œåˆ†æéœ€æ±‚ã€‚æœªæ¥å¦‚æœä¸èƒ½é€‚åº”ï¼Œå†è€ƒè™‘å…¶ä»–æ–¹æ¡ˆã€‚</code></p><p>åœ¨æœ¬æ¬¡å®è·µä¸­ï¼Œæˆ‘ä»¬æ‰€éƒ¨ç½²çš„ELKåˆ†å¸ƒå¼æ—¥å¿—ç³»ç»Ÿï¼Œå…¶æ¶æ„å¤§è‡´å¦‚ä¸‹ï¼š</p><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/elasticstack_011.png" alt=""></figure><br>é¦–å…ˆåœ¨å„æ—¥å¿—äº§ç”Ÿæœºä¸Šéƒ¨ç½²æ”¶é›†å™¨<code>Filebeat</code>ï¼Œç„¶åFilebeatå°†ç›‘æ§åˆ°çš„logæ–‡ä»¶å˜åŒ–æ•°æ®ä¼ è‡³Kafkaé›†ç¾¤ï¼Œ<code>Logstash</code>è´Ÿè´£å°†æ•°æ®ä»<code>kafka</code>ä¸­æ‹‰å–ä¸‹æ¥ï¼Œå¹¶è¿›è¡Œå­—æ®µè§£æï¼Œå‘<code>Elasticsearch</code>è¾“å‡ºç»“æ„åŒ–åçš„æ—¥å¿—ï¼Œ<code>Kibanaè´Ÿè´£å°†Elasticsearch</code>ä¸­çš„æ•°æ®è¿›è¡Œå¯è§†åŒ–ã€‚</p><p>ã€é‡ç‚¹å‚è€ƒã€‘ï¼š<a href="http://kibana.logstash.es/content/" target="_blank" rel="external">ELKä¸­æ–‡ä¹¦</a></p><h3 id="ä¸€ã€Elasticsearchçš„éƒ¨ç½²"><a href="#ä¸€ã€Elasticsearchçš„éƒ¨ç½²" class="headerlink" title="ä¸€ã€Elasticsearchçš„éƒ¨ç½²"></a>ä¸€ã€Elasticsearchçš„éƒ¨ç½²</h3><p>é¦–å…ˆåœ¨<code>https://www.elastic.co</code>ä¸­æ‰¾åˆ°ESçš„å®‰è£…åŒ…ã€‚ä¸‹æ–‡ä¸­æ‰€ç”¨çš„å®‰è£…åŒ…å‡ä¸ºLinux 64çš„<code>tar.gz</code>å‹ç¼©åŒ…ï¼Œè§£å‹å³å¯ç”¨ã€‚å®˜ç½‘å®‰è£…æ–¹æ³•:<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/_installation.html" target="_blank" rel="external">Installation example with tar</a></p><p><code>Elasticsearch</code>è‡³å°‘éœ€è¦<code>Java 8</code>ã€‚åœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼Œå»ºè®®æ‚¨ä½¿ç”¨<code>Oracle JDK</code>ç‰ˆæœ¬<code>1.8.0_131</code>ã€‚Javaå®‰è£…å› å¹³å°è€Œå¼‚ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è¿™é‡Œä¸å†èµ˜è¿°ã€‚Oracleçš„æ¨èå®‰è£…æ–‡æ¡£å¯ä»¥åœ¨Oracleçš„ç½‘ç«™ä¸Šæ‰¾åˆ°ã€‚åœ¨å®‰è£…Elasticsearchä¹‹å‰ï¼Œè¯·å…ˆæ£€æŸ¥æ‚¨çš„Javaç‰ˆæœ¬ï¼Œç„¶åå†è¿è¡Œï¼ˆå¦‚æœéœ€è¦ï¼Œè¯·ç›¸åº”åœ°è¿›è¡Œå®‰è£…/å‡çº§ï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">java -version</div><div class="line"><span class="built_in">echo</span> <span class="variable">$JAVA_HOME</span></div><div class="line"></div><div class="line">curl -L -O https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-5.5.2.tar.gz</div><div class="line">tar -xvf elasticsearch-5.5.2.tar.gz</div><div class="line"><span class="built_in">cd</span> elasticsearch-5.5.2/bin</div><div class="line">./elasticsearch <span class="_">-d</span> åå°å¯åŠ¨</div><div class="line"></div><div class="line">è¿™é‡Œæˆ‘åˆ‡æ¢æ™®é€šesç”¨æˆ·å¯åŠ¨ï¼Œè®°å¾—ç»™äºˆæƒé™ã€‚</div></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[root@logstash ~]<span class="comment"># curl http://localhost:9200?pretty</span></div><div class="line">&#123;</div><div class="line">  <span class="string">"name"</span> : <span class="string">"s-28M-e"</span>,</div><div class="line">  <span class="string">"cluster_name"</span> : <span class="string">"elasticsearch"</span>,</div><div class="line">  <span class="string">"cluster_uuid"</span> : <span class="string">"0U3blQviRcSG_pq8KFQ5EA"</span>,</div><div class="line">  <span class="string">"version"</span> : &#123;</div><div class="line">    <span class="string">"number"</span> : <span class="string">"5.5.2"</span>,</div><div class="line">    <span class="string">"build_hash"</span> : <span class="string">"b2f0c09"</span>,</div><div class="line">    <span class="string">"build_date"</span> : <span class="string">"2017-08-14T12:33:14.154Z"</span>,</div><div class="line">    <span class="string">"build_snapshot"</span> : <span class="literal">false</span>,</div><div class="line">    <span class="string">"lucene_version"</span> : <span class="string">"6.6.0"</span></div><div class="line">  &#125;,</div><div class="line">  <span class="string">"tagline"</span> : <span class="string">"You Know, for Search"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure><h3 id="1-1-Elasticsearchçš„é…ç½®"><a href="#1-1-Elasticsearchçš„é…ç½®" class="headerlink" title="1.1 Elasticsearchçš„é…ç½®"></a>1.1 Elasticsearchçš„é…ç½®</h3><p>ESçš„é…ç½®æ–‡ä»¶åœ¨è§£å‹æ ¹ç›®å½•ä¸‹çš„configæ–‡ä»¶å¤¹ä¸­ï¼Œå…¶ä¸­elasticsearch.ymlæ˜¯ä¸»é…ç½®æ–‡ä»¶ã€‚<br>ä»¥åŸºæœ¬å¯ç”¨ä½œä¸ºéƒ¨ç½²ç›®æ ‡ï¼Œåœ¨è¯¥æ–‡ä»¶ä¸­ä»…éœ€è¦è®¾ç½®å‡ ä¸ªé‡è¦å‚æ•°ï¼š</p><ol><li><code>cluster.nameã€node.name</code>è¿™ä¸¤è€…é¡¾åæ€ä¹‰ï¼Œä½œä¸ºé›†ç¾¤å’ŒèŠ‚ç‚¹çš„æ ‡è¯†ç¬¦ã€‚</li><li><code>Pathséƒ¨åˆ†ä¸‹çš„path.dataå’Œpath.logs</code>ï¼Œè¡¨ç¤ºESçš„æ•°æ®å­˜æ”¾ä½ç½®ï¼Œå‰è€…ä¸ºæ•°æ®å­˜å‚¨ä½ç½®ï¼Œåè€…ä¸ºESçš„logå­˜å‚¨ä½ç½®ã€‚è¯·å°½é‡æ”¾åˆ°å‰©ä½™ç©ºé—´è¶³å¤Ÿçš„åœ°æ–¹ï¼Œæ­¤å¤–åœ¨è¿›è¡Œè°ƒä¼˜æ—¶æœ‰ä¸€ç§æ–¹æ³•æ˜¯å°†æ•°æ®æ”¾ç½®åˆ°SSDä¸Šã€‚</li><li><code>bootstrap.memory_lock: true</code>ï¼Œè®¾ä¸ºtrueä»¥ç¡®ä¿ESæ‹¥æœ‰è¶³å¤Ÿçš„JVMå†…å­˜ã€‚</li><li><code>network.host: localhostå’Œhttp.port</code>ï¼Œåœ¨æ­¤å¤„è®¾ç½®ESå¯¹å¤–æœåŠ¡çš„IPåœ°å€ä¸ç«¯å£<br>è®¾ç½®å®Œä»¥ä¸Šå‡ é¡¹å‚æ•°åï¼Œå³å¯åœ¨ESæ ¹ç›®å½•ä¸‹ä½¿ç”¨å‘½ä»¤./bin/elasticsearchå¯åŠ¨ESè¿›ç¨‹ã€‚ä¹Ÿæœ‰ç›¸åº”çš„åå°å¯åŠ¨æ–¹å¼ï¼Œå…·ä½“ä¸èµ˜è¿°ã€‚</li></ol><p><strong>ä¸»è¦é…ç½®æ–‡ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[elasticsearch@logstash elasticsearch-5.5.2]$ cat config/elasticsearch.yml | grep -Pv <span class="string">"^$|^#"</span></div><div class="line">cluster.name: jolly-cluster</div><div class="line">node.name: es-jollychic-node1</div><div class="line">path.data: /data/elasticsearch/es-data</div><div class="line">path.logs: /data/elasticsearch/es-logs</div><div class="line">bootstrap.memory_lock: <span class="literal">true</span></div><div class="line">network.host: 10.11.10.26</div><div class="line">http.port: 9200</div></pre></td></tr></table></figure><p>es é…ç½®å®Œä»¥åå¯åŠ¨ä¼šå‡ºç°æŠ¥é”™ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">[2017-08-19T22:06:01,722][INFO ][o.e.n.Node               ] [es-jollychic-node1] initializing ...</div><div class="line">[2017-08-19T22:06:01,789][INFO ][o.e.e.NodeEnvironment    ] [es-jollychic-node1] using [1] data paths, mounts [[/data (/dev/mapper/sdb--vg-sdb--lv)]], net usable_space [190.2gb], net total_space [196.7gb], spins? [possibly], types [ext4]</div><div class="line">[2017-08-19T22:06:01,789][INFO ][o.e.e.NodeEnvironment    ] [es-jollychic-node1] heap size [1.9gb], compressed ordinary object pointers [<span class="literal">true</span>]</div><div class="line">[2017-08-19T22:06:01,790][INFO ][o.e.n.Node               ] [es-jollychic-node1] node name [es-jollychic-node1], node ID [yjFGVTcIRg2YQectzevnOA]</div><div class="line">[2017-08-19T22:06:01,790][INFO ][o.e.n.Node               ] [es-jollychic-node1] version[5.5.2], pid[13530], build[b2f0c09/2017-08-14T12:33:14.154Z], OS[Linux/3.10.0-514.26.2.el7.x86_64/amd64], JVM[Oracle Corporation/Java HotSpot(TM) 64-Bit Server VM/1.8.0_144/25.144-b01]</div><div class="line">[2017-08-19T22:06:01,790][INFO ][o.e.n.Node               ] [es-jollychic-node1] JVM arguments [-Xms2g, -Xmx2g, -XX:+UseConcMarkSweepGC, -XX:CMSInitiatingOccupancyFraction=75, -XX:+UseCMSInitiatingOccupancyOnly, -XX:+AlwaysPreTouch, -Xss1m, -Djava.awt.headless=<span class="literal">true</span>, -Dfile.encoding=UTF-8, -Djna.nosys=<span class="literal">true</span>, -Djdk.io.permissionsUseCanonicalPath=<span class="literal">true</span>, -Dio.netty.noUnsafe=<span class="literal">true</span>, -Dio.netty.noKeySetOptimization=<span class="literal">true</span>, -Dio.netty.recycler.maxCapacityPerThread=0, -D<span class="built_in">log</span>4j.shutdownHookEnabled=<span class="literal">false</span>, -D<span class="built_in">log</span>4j2.disable.jmx=<span class="literal">true</span>, -D<span class="built_in">log</span>4j.skipJansi=<span class="literal">true</span>, -XX:+HeapDumpOnOutOfMemoryError, -Des.path.home=/usr/<span class="built_in">local</span>/elasticsearch-5.5.2]</div><div class="line">[2017-08-19T22:06:02,583][INFO ][o.e.p.PluginsService     ] [es-jollychic-node1] loaded module [aggs-matrix-stats]</div><div class="line">[2017-08-19T22:06:02,583][INFO ][o.e.p.PluginsService     ] [es-jollychic-node1] loaded module [ingest-common]</div><div class="line">[2017-08-19T22:06:02,586][INFO ][o.e.p.PluginsService     ] [es-jollychic-node1] loaded module [lang-expression]</div><div class="line">[2017-08-19T22:06:02,586][INFO ][o.e.p.PluginsService     ] [es-jollychic-node1] loaded module [lang-groovy]</div><div class="line">[2017-08-19T22:06:02,586][INFO ][o.e.p.PluginsService     ] [es-jollychic-node1] loaded module [lang-mustache]</div><div class="line">[2017-08-19T22:06:02,587][INFO ][o.e.p.PluginsService     ] [es-jollychic-node1] loaded module [lang-painless]</div><div class="line">[2017-08-19T22:06:02,587][INFO ][o.e.p.PluginsService     ] [es-jollychic-node1] loaded module [parent-join]</div><div class="line">[2017-08-19T22:06:02,587][INFO ][o.e.p.PluginsService     ] [es-jollychic-node1] loaded module [percolator]</div><div class="line">[2017-08-19T22:06:02,587][INFO ][o.e.p.PluginsService     ] [es-jollychic-node1] loaded module [reindex]</div><div class="line">[2017-08-19T22:06:02,587][INFO ][o.e.p.PluginsService     ] [es-jollychic-node1] loaded module [transport-netty3]</div><div class="line">[2017-08-19T22:06:02,587][INFO ][o.e.p.PluginsService     ] [es-jollychic-node1] loaded module [transport-netty4]</div><div class="line">[2017-08-19T22:06:02,587][INFO ][o.e.p.PluginsService     ] [es-jollychic-node1] no plugins loaded</div><div class="line">[2017-08-19T22:06:04,212][INFO ][o.e.d.DiscoveryModule    ] [es-jollychic-node1] using discovery <span class="built_in">type</span> [zen]</div><div class="line">[2017-08-19T22:06:04,635][INFO ][o.e.n.Node               ] [es-jollychic-node1] initialized</div><div class="line">[2017-08-19T22:06:04,635][INFO ][o.e.n.Node               ] [es-jollychic-node1] starting ...</div><div class="line">[2017-08-19T22:06:04,812][INFO ][o.e.t.TransportService   ] [es-jollychic-node1] publish_address &#123;10.11.10.26:9300&#125;, bound_addresses &#123;10.11.10.26:9300&#125;</div><div class="line">[2017-08-19T22:06:04,821][INFO ][o.e.b.BootstrapChecks    ] [es-jollychic-node1] bound or publishing to a non-loopback or non-link-local address, enforcing bootstrap checks</div><div class="line">[2017-08-19T22:06:04,823][ERROR][o.e.b.Bootstrap          ] [es-jollychic-node1] node validation exception</div><div class="line">[1] bootstrap checks failed</div><div class="line">[1]: max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]</div><div class="line">[2017-08-19T22:06:04,825][INFO ][o.e.n.Node               ] [es-jollychic-node1] stopping ...</div><div class="line">[2017-08-19T22:06:04,840][INFO ][o.e.n.Node               ] [es-jollychic-node1] stopped</div><div class="line">[2017-08-19T22:06:04,840][INFO ][o.e.n.Node               ] [es-jollychic-node1] closing ...</div><div class="line">[2017-08-19T22:06:04,851][INFO ][o.e.n.Node               ] [es-jollychic-node1] closed</div></pre></td></tr></table></figure><ul><li>å¦‚æœä¿®æ”¹å®Œä¼šæŠ¥é”™ï¼Œä¿®æ”¹ä¸‹Linuxç³»ç»Ÿå‚æ•°ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">max file descriptors [4096] <span class="keyword">for</span> elasticsearch process likely too low, increase to at least [65536]</div><div class="line">max number of threads [1024] <span class="keyword">for</span> user [lishang] likely too low, increase to at least [2048]</div><div class="line">è§£å†³ï¼šåˆ‡æ¢åˆ°rootç”¨æˆ·ï¼Œç¼–è¾‘limits.conf æ·»åŠ ç±»ä¼¼å¦‚ä¸‹å†…å®¹</div><div class="line">vi /etc/security/limits.conf </div><div class="line"></div><div class="line">æ·»åŠ å¦‚ä¸‹å†…å®¹:</div><div class="line"></div><div class="line">* soft nofile 65536</div><div class="line">* hard nofile 131072</div><div class="line">* soft nproc 2048</div><div class="line">* hard nproc 4096</div><div class="line"></div><div class="line">é—®é¢˜ä¸‰ï¼šmax number of threads [1024] <span class="keyword">for</span> user [lish] likely too low, increase to at least [2048]</div><div class="line"></div><div class="line">è§£å†³ï¼šåˆ‡æ¢åˆ°rootç”¨æˆ·ï¼Œè¿›å…¥limits.dç›®å½•ä¸‹ä¿®æ”¹é…ç½®æ–‡ä»¶ã€‚</div><div class="line">vi /etc/security/limits.d/90-nproc.conf </div><div class="line">ä¿®æ”¹å¦‚ä¸‹å†…å®¹ï¼š</div><div class="line"></div><div class="line">* soft nproc 1024</div><div class="line"><span class="comment">#ä¿®æ”¹ä¸º</span></div><div class="line">* soft nproc 2048</div><div class="line"></div><div class="line">é—®é¢˜å››ï¼šmax virtual memory areas vm.max_map_count [65530] likely too low, increase to at least [262144]</div><div class="line"></div><div class="line">è§£å†³ï¼šåˆ‡æ¢åˆ°rootç”¨æˆ·ä¿®æ”¹é…ç½®sysctl.conf</div><div class="line"></div><div class="line">vi /etc/sysctl.conf </div><div class="line">æ·»åŠ ä¸‹é¢é…ç½®ï¼š</div><div class="line">vm.max_map_count=655360</div><div class="line">å¹¶æ‰§è¡Œå‘½ä»¤ï¼š</div><div class="line">sysctl -p</div><div class="line">ç„¶åï¼Œé‡æ–°å¯åŠ¨elasticsearchï¼Œå³å¯å¯åŠ¨æˆåŠŸã€‚</div></pre></td></tr></table></figure><h3 id="é›†ç¾¤å¥åº·æ£€æŸ¥-Cluster-Health"><a href="#é›†ç¾¤å¥åº·æ£€æŸ¥-Cluster-Health" class="headerlink" title="é›†ç¾¤å¥åº·æ£€æŸ¥ Cluster Health"></a>é›†ç¾¤å¥åº·æ£€æŸ¥ Cluster Health</h3><p>è¦æ£€æŸ¥ç¾¤é›†çš„è¿è¡ŒçŠ¶å†µï¼Œæˆ‘ä»¬å°†ä½¿ç”¨<a href="https://www.elastic.co/guide/en/elasticsearch/reference/5.5/cat.html" target="_blank" rel="external">_catAPI</a>ã€‚æ‚¨å¯ä»¥åœ¨<a href="https://www.elastic.co/guide/en/kibana/5.5/console-kibana.html" target="_blank" rel="external">Kibana</a>çš„æ§åˆ¶å°ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œæ–¹æ³•æ˜¯ å•å‡»â€œæŸ¥çœ‹æ§åˆ¶å°â€æˆ–curlå•å‡»ä¸‹é¢çš„â€œå¤åˆ¶ä¸ºCURLâ€é“¾æ¥å¹¶å°†å…¶ç²˜è´´åˆ°ç»ˆç«¯ä¸­ã€‚</p><p><strong>åˆ›å»ºç´¢å¼•ï¼š</strong><br>ç¬¬ä¸€ä¸ªå‘½ä»¤ä½¿ç”¨PUTåˆ›å»ºäº†ä¸€ä¸ªå«åšâ€œcustomerâ€çš„ç´¢å¼•ã€‚æˆ‘ä»¬ç®€å•åœ°å°†prettyé™„åŠ åˆ°è°ƒç”¨çš„å°¾éƒ¨ï¼Œä½¿å…¶ä»¥ç¾è§‚çš„å½¢å¼æ‰“å°å‡ºJSONå“åº” </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -XPUT <span class="string">'http://10.11.10.26:9200/customer?pretty'</span></div></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥å¾—åˆ°æˆ‘ä»¬é›†ç¾¤ä¸­èŠ‚ç‚¹çš„åˆ—è¡¨å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@logstash ~]<span class="comment">#  curl -XGET http://10.11.10.26:9200/_cat/nodes?v</span></div><div class="line">ip          heap.percent ram.percent cpu load_1m load_5m load_15m node.role master name</div><div class="line">10.11.10.26           14          96  18    0.02    0.60     0.58 mdi       *      es-jollychic-node1</div></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@logstash ~]<span class="comment">#  curl -XGET http://10.11.10.26:9200/_cat/master?help</span></div><div class="line">id   |   | node id</div><div class="line">host | h | host name</div><div class="line">ip   |   | ip address</div><div class="line">node | n | node name</div></pre></td></tr></table></figure><p>æŸ¥çœ‹æ‰€æœ‰è¿æ¥çš„ç´¢å¼•ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">[elasticsearch@logstash ~]$ curl <span class="_">-s</span>XGET <span class="string">"http://<span class="variable">$(hostname)</span>:9200/_cat/indices?v"</span></div><div class="line">health status index                                     uuid                   pri rep docs.count docs.deleted store.size pri.store.size</div><div class="line">yellow open   <span class="built_in">log</span>-wms31-web-product-2017.08.25          LIKJyNXrRcmQSt8aXRoyLg   5   1        614            0    361.6kb        361.6kb</div><div class="line">yellow open   <span class="built_in">log</span>-payment-center-product-2017.08.26     w-ucGJUoTDOdhEkfrq9g-g   5   1    1712756            0    808.4mb        808.4mb</div><div class="line">yellow open   .kibana                                   p9MnvKHRS6K_jCeBtB7CXA   1   1         18            1     77.8kb         77.8kb</div><div class="line">yellow open   <span class="built_in">log</span>-jcm-product-2017.08.25                Cs0XHa-xRQOHxt1-HYz1Xw   5   1   46303455            0      8.1gb          8.1gb</div><div class="line">yellow open   <span class="built_in">log</span>-spm_mq-product-2017.08.25             FXYNV08zQselbnVKK7k01g   5   1     465127            0    148.1mb        148.1mb</div><div class="line">yellow open   <span class="built_in">log</span>-erpsearchservice-product-2017.08.26   Z4ECtHCJS2uma_UTxJqDLw   5   1       2217            0     15.3mb         15.3mb</div><div class="line">yellow open   <span class="built_in">log</span>-wms31-web-product-2017.08.24          mYAhjM5UQFyIZAN8nFeYQQ   5   1     951572            0    237.5mb        237.5mb</div><div class="line">yellow open   <span class="built_in">log</span>-spm_mq-product-2017.08.26             -PJCMMVqRwWXux8V5SRbCA   5   1    1457469            0    503.1mb        503.1mb</div><div class="line">yellow open   <span class="built_in">log</span>-jcm-product-2017.08.26                Jp7jQdciSMyrDmc82Y8YPQ   5   1   12753864            0      1.8gb          1.8gb</div><div class="line">yellow open   <span class="built_in">log</span>-gp-export-product-2017.08.26          tsFNVopYRXCM4vrCfU7IbQ   5   1     809526            0    169.8mb        169.8mb</div><div class="line">yellow open   <span class="built_in">log</span>-mq-product-2017.08.25                 dxXemS5RR_OpohepAUNcfg   5   1   32670880            0      5.6gb          5.6gb</div><div class="line">yellow open   <span class="built_in">log</span>-wms31-pda-product-2017.08.26          nE6s79S4RN2qIFkUt-FJsg   5   1       2323            0      1.6mb          1.6mb</div><div class="line">yellow open   <span class="built_in">log</span>-erpsearchservice-product-2017.08.25   Mj3-2ZrBRSuJaZQebPqcWA   5   1        369            0    390.6kb        390.6kb</div><div class="line">yellow open   <span class="built_in">log</span>-wms31-web-product-2017.08.26          X3GUYOZtTW6g1eGV_YW0HQ   5   1     275155            0     65.9mb         65.9mb</div><div class="line">yellow open   <span class="built_in">log</span>-mq-product-2017.08.26                 PwkQ9eOcQl2ie0f2fpnVRg   5   1   12519174            0      2.5gb          2.5gb</div><div class="line">yellow open   <span class="built_in">log</span>-wms31_mq_consumer-product-2017.08.26  iG3bCUybSamJC9l58RlbNw   5   1      25703            0     13.1mb         13.1mb</div><div class="line">yellow open   <span class="built_in">log</span>-spm-product-2017.08.25                fr2fFfTKTOSl8Pm7qfU7eA   5   1        438            0    436.8kb        436.8kb</div><div class="line">yellow open   <span class="built_in">log</span>-dataexporttask-product-2017.08.26     01lRzmfYTDaFj9nXvTnmEg   5   1    1283861            0    145.2mb        145.2mb</div><div class="line">yellow open   <span class="built_in">log</span>-spm-task-scheduler-product-2017.08.26 7We8iXEHSYmk168PO6zUVA   5   1     463587            0    108.9mb        108.9mb</div><div class="line">yellow open   <span class="built_in">log</span>-wms-product-2017.08.25                XvyfywXmTYybccS1GLIkAw   5   1          1            0      8.1kb          8.1kb</div><div class="line">yellow open   <span class="built_in">log</span>-payment-center-product-2017.08.25     wUlvN1VhQ5Wb0pFgg1BkgA   5   1     691080            0    332.5mb        332.5mb</div><div class="line">yellow open   <span class="built_in">log</span>-dataexport-product-2017.08.26         SOh6vF8LQnOOWLsI9R_CcA   5   1     850019            0    499.5mb        499.5mb</div><div class="line">yellow open   <span class="built_in">log</span>-image-finder-product-2017.08.26       OGkYlpkzTPKReMsArJoyVA   5   1       9752            0      2.2mb          2.2mb</div><div class="line">yellow open   <span class="built_in">log</span>-gplatform_v2-product-2017.08.26       XEp5aM23SfaHfZ8qkgMjQw   5   1       8521            0      2.8mb          2.8mb</div><div class="line">yellow open   <span class="built_in">log</span>-payment-center-product-2017.08.24     4NDXMAQKRQqljZ1pcGp8yQ   5   1      70898            0       39mb           39mb</div><div class="line">yellow open   <span class="built_in">log</span>-wms31-pda-product-2017.08.25          caYLQMwlSZmBYl0YeZohpQ   5   1        237            0    214.8kb        214.8kb</div><div class="line">yellow open   <span class="built_in">log</span>-wms-product-2017.08.22                3NLXCSLyQJ2JHoCCeS41xQ   5   1          1            0      8.1kb          8.1kb</div></pre></td></tr></table></figure><p>åˆ é™¤æŒ‡å®šç´¢å¼•ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -XDELETE <span class="string">"http://<span class="variable">$(hostname)</span>:9200/log-wms-product-2017.08.19"</span></div></pre></td></tr></table></figure><h3 id="1-2-Elasticsearch-5-xçš„Bootstrap-Checks"><a href="#1-2-Elasticsearch-5-xçš„Bootstrap-Checks" class="headerlink" title="1.2 Elasticsearch 5.xçš„Bootstrap Checks"></a>1.2 Elasticsearch 5.xçš„Bootstrap Checks</h3><p>Elasticsearchåœ¨å‡çº§åˆ°5.xç‰ˆæœ¬åï¼Œå¯åŠ¨æ—¶ä¼šå¼ºåˆ¶æ‰§è¡Œ<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/bootstrap-checks.html" target="_blank" rel="external">Bootstrap Checks</a>(å®˜æ–¹æ–‡æ¡£)<br>å…¶ä¸­ç»å¸¸æ€§çš„é—®é¢˜æ˜¯éœ€è¦å¢å¤§ç³»ç»Ÿå¯ä½¿ç”¨çš„æœ€å¤§FileDescriptorsæ•°ï¼ˆå‚è€ƒ<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/file-descriptors.htmlï¼‰" target="_blank" rel="external">https://www.elastic.co/guide/en/elasticsearch/reference/current/file-descriptors.htmlï¼‰</a><br>å‰©ä¸‹çš„å…¶ä»–é—®é¢˜å¯ä»¥æŸ¥è¯¢å®˜æ–¹æ–‡æ¡£ã€‚</p><h3 id="1-3-Elasticsearchçš„X-packæ’ä»¶"><a href="#1-3-Elasticsearchçš„X-packæ’ä»¶" class="headerlink" title="1.3 Elasticsearchçš„X-packæ’ä»¶"></a>1.3 Elasticsearchçš„X-packæ’ä»¶</h3><p><code>X-pack</code>æ˜¯å®˜æ–¹æä¾›çš„ä¸€ç³»åˆ—é›†æˆæ’ä»¶ï¼ŒåŒ…æ‹¬äº†<code>alertã€monitorã€secure</code>ç­‰åŠŸèƒ½ï¼Œååˆ†å¼ºå¤§ï¼ˆä½†æ˜¯å¹¶ä¸å…è´¹ï¼‰ã€‚<br>åœ¨ELK 5.0ä¸­å®‰è£…å¤§éƒ¨åˆ†æ’ä»¶ä»…éœ€è¦è¾“å…¥å‘½ä»¤ï¼š<code>./bin/elasticsearch-plugin install &lt;plugin name&gt;</code>å³å¯<br><code>X-pack</code>æ’ä»¶å®‰è£…åä¼šè‡ªåŠ¨å¼€å¯ELKçš„æƒé™åŠŸèƒ½ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯å¦‚æœå¯ç”¨äº†<code>X-pack</code>ï¼Œåˆ™åœ¨å‘ESè¾“å…¥æ•°æ®æˆ–å‘èµ·APIè¯·æ±‚æ—¶ï¼Œå‡éœ€è¦é™„å¸¦ç›¸åº”çš„authä¿¡æ¯ã€‚<br>è€ƒè™‘åˆ°X-packå¹¶éå…è´¹ä¸”ä»·æ ¼æ˜‚è´µï¼Œæš‚æ—¶ä¸å®‰è£…X-packåŒ…ã€‚</p><h3 id="1-4-Elasticsearchçš„Headæ’ä»¶"><a href="#1-4-Elasticsearchçš„Headæ’ä»¶" class="headerlink" title="1.4 Elasticsearchçš„Headæ’ä»¶"></a>1.4 Elasticsearchçš„Headæ’ä»¶</h3><p><code>Head</code>æ’ä»¶ä½œä¸º<code>ELK 2.x</code>ç‰ˆæœ¬ä¸­è¾ƒä¸ºé€šç”¨çš„å‰ç«¯ç®¡ç†æ’ä»¶ï¼Œåœ¨<code>ELK 5.x</code>ç‰ˆæœ¬ä¸­æ— æ³•ç›´æ¥ä½¿ç”¨<code>./bin/elasticsearch-plugin install head</code>çš„æ–¹å¼å®‰è£…ï¼Œä½†æ˜¯å¯ä»¥é‡‡å–standaloneçš„æ–¹å¼è¿›è¡Œè¿è¡Œã€‚</p><p>å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://github.com/mobz/elasticsearch-head#running-with-built-in-server" target="_blank" rel="external">elasticsearch-head</a></p><p>ä¸€ç¯‡è¾ƒå¥½çš„<a href="http://www.cnblogs.com/xing901022/p/6030296.html" target="_blank" rel="external">ES 5.xå®‰è£…Headçš„åšæ–‡ï¼š</a></p><p>ã€ç‰¹åˆ«æ³¨æ„ã€‘ï¼šæš‚æ—¶æ²¡æœ‰æ‰¾åˆ°x-packå’Œheadç›¸äº’å…¼å®¹çš„æ–¹æ³•ï¼Œç›®å‰ç”±äºè®¤è¯çš„é—®é¢˜ï¼Œå¦‚æœ<code>å¯ç”¨äº†x-packçš„secure</code>åŠŸèƒ½ï¼Œä¼šå¯¼è‡´headæ’ä»¶æ— æ³•è¿æ¥ESé›†ç¾¤ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">git <span class="built_in">clone</span> git://github.com/mobz/elasticsearch-head.git</div><div class="line"><span class="built_in">cd</span> elasticsearch-head</div><div class="line">npm install</div><div class="line">npm run start</div><div class="line">open http://localhost:9100/</div></pre></td></tr></table></figure><ul><li>ä¿®æ”¹headç›®å½•ä¸‹çš„Gruntfile.jsé…ç½®ï¼Œheadé»˜è®¤ç›‘å¬127.0.0.1 æ–°å¢ï¼šhostname: â€˜0.0.0.0â€™</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># vim Gruntfile.js</span></div><div class="line">                connect: &#123;</div><div class="line">                        server: &#123;</div><div class="line">                                options: &#123;</div><div class="line">                                        hostname: <span class="string">'0.0.0.0'</span>,</div><div class="line">                                        port: 9100,</div><div class="line">                                        base: <span class="string">'.'</span>,</div><div class="line">                                        keepalive: <span class="literal">true</span></div><div class="line">                                &#125;</div><div class="line">                        &#125;</div><div class="line">                &#125;</div><div class="line"></div><div class="line">        &#125;);</div></pre></td></tr></table></figure><ul><li>ä¿®æ”¹elasticsearché…ç½®æ–‡ä»¶ elasticsearch.yml</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">http.cors.enabled: <span class="literal">true</span></div><div class="line">http.cors.allow-origin: <span class="string">"*"</span></div></pre></td></tr></table></figure><ul><li>é‡å¯elasticsearchï¼Œå¹¶å¯åŠ¨node </li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ln <span class="_">-s</span> /usr/<span class="built_in">local</span>/elasticsearch-head/node_modules/grunt/bin/grunt /usr/bin/grunt</div><div class="line"></div><div class="line">åå°å¯åŠ¨ï¼šgrunt server &amp;</div></pre></td></tr></table></figure><ul><li>è®¿é—®æ•ˆæœï¼š</li></ul><p><figure class="figure"><img src="media/15033045476000.jpg" alt=""></figure></p><h3 id="1-5-Elasticsearch-Kibana"><a href="#1-5-Elasticsearch-Kibana" class="headerlink" title="1.5 Elasticsearch-Kibana"></a>1.5 Elasticsearch-Kibana</h3><p>RPMæ–¹æ³•å®‰è£…å‚è€ƒå®˜ç½‘æ–‡æ¡£ï¼š<a href="https://www.elastic.co/guide/en/kibana/current/rpm.html#rpm" target="_blank" rel="external">ä½¿ç”¨RPM ç¼–è¾‘å®‰è£…Kibana</a></p><p>Running Kibana on Docker: <a href="https://www.elastic.co/guide/en/kibana/current/_pulling_the_image.html" target="_blank" rel="external">Docker æ­å»ºæ–¹æ³•</a></p><p>taræ–¹å¼å®‰è£…Kibana </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">wget https://artifacts.elastic.co/downloads/kibana/kibana-5.5.2-linux-x86_64.tar.gz</div><div class="line">sha1sum kibana-5.5.2-linux-x86_64.tar.gz </div><div class="line">tar -xzf kibana-5.5.2-linux-x86_64.tar.gz</div><div class="line"><span class="built_in">cd</span> kibana/</div></pre></td></tr></table></figure><h3 id="é€šè¿‡é…ç½®æ–‡ä»¶ç¼–è¾‘é…ç½®Kibana"><a href="#é€šè¿‡é…ç½®æ–‡ä»¶ç¼–è¾‘é…ç½®Kibana" class="headerlink" title="é€šè¿‡é…ç½®æ–‡ä»¶ç¼–è¾‘é…ç½®Kibana"></a>é€šè¿‡é…ç½®æ–‡ä»¶ç¼–è¾‘é…ç½®Kibana</h3><p><code>kibana.yml</code>å¯åŠ¨æ—¶KibanaæœåŠ¡å™¨ä»æ–‡ä»¶è¯»å–å±æ€§ã€‚é»˜è®¤è®¾ç½®é…ç½®Kibanaè¿è¡Œ<code>localhost:5601</code>ã€‚è¦æ›´æ”¹ä¸»æœºæˆ–ç«¯å£å·ï¼Œæˆ–è€…è¿æ¥åˆ°åœ¨å…¶ä»–æœºå™¨ä¸Šè¿è¡Œçš„<code>Elasticsearch</code>ï¼Œæ‚¨éœ€è¦æ›´æ–°kibana.ymlæ–‡ä»¶ã€‚æ‚¨è¿˜å¯ä»¥å¯ç”¨SSLå¹¶è®¾ç½®å„ç§å…¶ä»–é€‰é¡¹ã€‚</p><p>kibana.yml å…¨éƒ¨åŸºæœ¬é…ç½® ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">server.port:</div><div class="line">é»˜è®¤å€¼ï¼š5601 Kibanaç”±åç«¯æœåŠ¡å™¨æä¾›æœåŠ¡ã€‚æ­¤è®¾ç½®æŒ‡å®šè¦ä½¿ç”¨çš„ç«¯å£ã€‚</div><div class="line"></div><div class="line">server.host:</div><div class="line">é»˜è®¤å€¼ï¼šâ€œlocalhostâ€æ­¤è®¾ç½®æŒ‡å®šåç«¯æœåŠ¡å™¨çš„ä¸»æœºã€‚</div><div class="line"></div><div class="line">server.basePath:</div><div class="line">å¦‚æœæ‚¨åœ¨ä»£ç†æœåŠ¡å™¨åé¢è¿è¡Œï¼Œåˆ™å…è®¸æ‚¨æŒ‡å®šå®‰è£…Kibanaçš„è·¯å¾„ã€‚è¿™ä»…å½±å“ç”±Kibanaç”Ÿæˆçš„URLï¼Œæ‚¨çš„ä»£ç†é¢„æœŸåœ¨å°†è¯·æ±‚è½¬å‘ç»™Kibanaä¹‹å‰åˆ é™¤basePathå€¼ã€‚æ­¤è®¾ç½®æ— æ³•ä»¥æ–œæ ï¼ˆ/ï¼‰ç»“å°¾ã€‚</div><div class="line"></div><div class="line">server.maxPayloadBytes:</div><div class="line">é»˜è®¤å€¼ï¼š1048576ä¼ å…¥æœåŠ¡å™¨è¯·æ±‚çš„æœ€å¤§æœ‰æ•ˆè´Ÿè½½å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚</div><div class="line"></div><div class="line">server.name:</div><div class="line">é»˜è®¤å€¼ï¼šâ€œyour-hostnameâ€ç”¨äºæ ‡è¯†æ­¤Kibanaå®ä¾‹çš„äººæ€§åŒ–æ˜¾ç¤ºåç§°ã€‚</div><div class="line"></div><div class="line">server.defaultRoute:</div><div class="line">é»˜è®¤å€¼ï¼šâ€œ/ app / kibanaâ€æ­¤è®¾ç½®æŒ‡å®šæ‰“å¼€Kibanaæ—¶çš„é»˜è®¤è·¯ç”±ã€‚æ‰“å¼€Kibanaæ—¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ­¤è®¾ç½®ä¿®æ”¹ç€é™†é¡µã€‚</div><div class="line"></div><div class="line">elasticsearch.url:</div><div class="line">é»˜è®¤å€¼ï¼šâ€œhttpï¼š// localhostï¼š9200â€ç”¨äºæ‰€æœ‰æŸ¥è¯¢çš„Elasticsearchå®ä¾‹çš„URLã€‚</div><div class="line"></div><div class="line">elasticsearch.preserveHost:</div><div class="line">é»˜è®¤å€¼ï¼š<span class="literal">true</span>å½“æ­¤è®¾ç½®çš„å€¼ä¸ºçœŸæ—¶ï¼ŒKibanaä½¿ç”¨server.hostè®¾ç½®ä¸­æŒ‡å®šçš„ä¸»æœºåã€‚å½“æ­¤è®¾ç½®çš„å€¼ä¸º<span class="literal">false</span>ï¼ŒKibanaä½¿ç”¨è¿æ¥åˆ°æ­¤Kibanaå®ä¾‹çš„ä¸»æœºçš„ä¸»æœºåã€‚</div><div class="line"></div><div class="line">kibana.index:</div><div class="line">é»˜è®¤ï¼šâ€œ.kibanaâ€ Kibanaä½¿ç”¨Elasticsearchä¸­çš„ç´¢å¼•æ¥å­˜å‚¨å·²ä¿å­˜çš„æœç´¢ï¼Œå¯è§†åŒ–å’Œä»ªè¡¨æ¿ã€‚å¦‚æœç´¢å¼•ä¸å­˜åœ¨ï¼ŒKibanaå°†åˆ›å»ºä¸€ä¸ªæ–°çš„ç´¢å¼•ã€‚</div><div class="line"></div><div class="line">kibana.defaultAppId:</div><div class="line">é»˜è®¤å€¼ï¼šâ€œdiscoverâ€è¦åŠ è½½çš„é»˜è®¤åº”ç”¨ç¨‹åºã€‚</div><div class="line"></div><div class="line">tilemap.url:</div><div class="line">Kibanaç”¨äºåœ¨tilemapå¯è§†åŒ–ä¸­æ˜¾ç¤ºåœ°å›¾å›¾å—çš„tileæœåŠ¡çš„URLã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒKibanaä»å¤–éƒ¨å…ƒæ•°æ®æœåŠ¡è¯»å–æ­¤URLï¼Œä½†ç”¨æˆ·ä»ç„¶å¯ä»¥è¦†ç›–æ­¤å‚æ•°ä»¥ä½¿ç”¨è‡ªå·±çš„Tile Map Serviceã€‚ä¾‹å¦‚ï¼š<span class="string">"https://tiles.elastic.co/v2/default/&#123;z&#125;/&#123;x&#125;/&#123;y&#125;.png?elastic_tile_service_tos=agree&amp;my_app_name=kibana"</span></div><div class="line"></div><div class="line">tilemap.options.minZoom:</div><div class="line">é»˜è®¤å€¼ï¼š1æœ€å°ç¼©æ”¾çº§åˆ«ã€‚</div><div class="line"></div><div class="line">tilemap.options.maxZoom:</div><div class="line">é»˜è®¤å€¼ï¼š10æœ€å¤§ç¼©æ”¾çº§åˆ«ã€‚</div><div class="line"></div><div class="line">tilemap.options.attribution:</div><div class="line">é»˜è®¤å€¼ï¼š<span class="string">"Â© [Elastic Maps Service](https://www.elastic.co/elastic-maps-service)"</span>åœ°å›¾å±æ€§å­—ç¬¦ä¸²ã€‚</div><div class="line"></div><div class="line">regionmap</div><div class="line">æŒ‡å®šç”¨äºåŒºåŸŸæ˜ å°„å¯è§†åŒ–çš„å…¶ä»–çŸ¢é‡å›¾å±‚ã€‚æ¯ä¸ªå±‚å¯¹è±¡éƒ½æŒ‡å‘ä¸€ä¸ªå¤–éƒ¨çŸ¢é‡æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªgeojson FeatureCollectionã€‚è¯¥æ–‡ä»¶å¿…é¡»ä½¿ç”¨WGS84åæ ‡å‚è€ƒç³»ï¼Œå¹¶ä¸”åªåŒ…æ‹¬å¤šè¾¹å½¢ã€‚å¦‚æœæ–‡ä»¶æ‰˜ç®¡åœ¨ä¸Kibanaä¸åŒçš„åŸŸä¸Šï¼Œåˆ™æœåŠ¡å™¨éœ€è¦å¯ç”¨CORSï¼Œå› æ­¤Kibanaå¯ä»¥ä¸‹è½½è¯¥æ–‡ä»¶ã€‚urlå­—æ®µä¹Ÿç”¨ä½œæ–‡ä»¶çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚æ¯ä¸ªå›¾å±‚å¯ä»¥åŒ…å«å¤šä¸ªå­—æ®µï¼Œä»¥æŒ‡ç¤ºè¦å…¬å¼€çš„geojsonè¦ç´ çš„å“ªäº›å±æ€§ã€‚field.descriptionæ˜¯åœ¨Region Mapå¯è§†åŒ–çš„å­—æ®µèœå•ä¸­æ˜¾ç¤ºçš„äººç±»å¯è¯»æ–‡æœ¬ã€‚ä¹Ÿå¯ä»¥æ·»åŠ å¯é€‰çš„å½’å› å€¼ã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºæœ‰æ•ˆçš„regionmapé…ç½®ã€‚</div><div class="line"></div><div class="line">regionmapï¼š</div><div class="line">  å±‚ï¼š</div><div class="line">     - åç§°ï¼šâ€œæ³•å›½éƒ¨â€</div><div class="line">       urlï¼šâ€œhttp://my.cors.enabled.server.org/france_departements.geojsonâ€</div><div class="line">       å½’å› ï¼šâ€œINRAPâ€</div><div class="line">       å­—æ®µï¼š</div><div class="line">          - åç§°ï¼šâ€œéƒ¨é—¨â€</div><div class="line">            è¯´æ˜ï¼šâ€œå…¨éƒ¨åç§°â€</div><div class="line">          - åç§°ï¼šâ€œINSEEâ€</div><div class="line">            è¯´æ˜ï¼šâ€œINSEEæ•°å­—æ ‡è¯†ç¬¦â€</div><div class="line"></div><div class="line">elasticsearch.username: å’Œ elasticsearch.password:</div><div class="line">å¦‚æœæ‚¨çš„Elasticsearchå—åˆ°åŸºæœ¬èº«ä»½éªŒè¯çš„ä¿æŠ¤ï¼Œè¿™äº›è®¾ç½®å°†æä¾›KibanaæœåŠ¡å™¨åœ¨å¯åŠ¨æ—¶å¯¹Kibanaç´¢å¼•æ‰§è¡Œç»´æŠ¤æ‰€ç”¨çš„ç”¨æˆ·åå’Œå¯†ç ã€‚æ‚¨çš„Kibanaç”¨æˆ·ä»ç„¶éœ€è¦ä½¿ç”¨é€šè¿‡KibanaæœåŠ¡å™¨ä»£ç†çš„Elasticsearchè¿›è¡Œèº«ä»½éªŒè¯ã€‚</div><div class="line"></div><div class="line">server.ssl.enabled</div><div class="line">é»˜è®¤å€¼ï¼šâ€œ<span class="literal">false</span>â€å¯ç”¨ä»KibanaæœåŠ¡å™¨åˆ°æµè§ˆå™¨çš„ä¼ å‡ºè¯·æ±‚çš„SSLã€‚å½“è®¾ç½®ä¸º<span class="literal">true</span>ï¼Œ</div><div class="line">server.ssl.certificateå¹¶server.ssl.keyè¦æ±‚</div><div class="line"></div><div class="line">server.ssl.certificate: å’Œ server.ssl.key:</div><div class="line">è·¯ç”±åˆ°PEMæ ¼å¼çš„SSLè¯ä¹¦å’ŒSSLå¯†é’¥æ–‡ä»¶ã€‚</div><div class="line"></div><div class="line">server.ssl.keyPassphrase</div><div class="line">å°†ç”¨äºè§£å¯†ç§é’¥çš„å¯†ç çŸ­è¯­ã€‚è¯¥å€¼æ˜¯å¯é€‰çš„ï¼Œå› ä¸ºå¯†é’¥å¯èƒ½æœªè¢«åŠ å¯†ã€‚</div><div class="line"></div><div class="line">server.ssl.certificateAuthorities</div><div class="line">åˆ—å‡ºå¯ä¿¡èµ–çš„PEMç¼–ç è¯ä¹¦æ–‡ä»¶çš„è·¯å¾„ã€‚</div><div class="line"></div><div class="line">server.ssl.supportedProtocols</div><div class="line">é»˜è®¤å€¼ï¼šTLSv1ï¼ŒTLSv1.1ï¼ŒTLSv1.2 æ”¯æŒçš„ç‰ˆæœ¬åè®®ã€‚æœ‰æ•ˆåè®®ï¼šTLSv1ï¼ŒTLSv1.1ï¼ŒTLSv1.2</div><div class="line"></div><div class="line">server.ssl.cipherSuites</div><div class="line">é»˜è®¤å€¼ï¼šECDHE-RSA-AES128-GCM-SHA256ï¼ŒECDHE-ECDSA-AES128-GCM-SHA256ï¼ŒECDHE-RSA-AES256-GCM-SHA384ï¼ŒECDHE-ECDSA-AES256-GCM-SHA384ï¼ŒDHE-RSA-AES128-GCM- SHA256ï¼ŒECDHE-RSA-AES128-SHA256ï¼ŒDHE-RSA-AES128-SHA256ï¼ŒECDHE-RSA-AES256-SHA384ï¼ŒDHE-RSA-AES256-SHA384ï¼ŒECDHE-RSA-AES256-SHA256ï¼ŒDHE-RSA-AES256-SHA256ï¼Œ HIGHï¼Œï¼aNULLï¼Œï¼eNULLï¼Œï¼EXPORTï¼Œï¼DESï¼Œï¼RC4ï¼Œï¼MD5ï¼Œï¼PSKï¼Œï¼SRPï¼Œï¼CAMELLIAã€‚æ ¼å¼å’Œæœ‰æ•ˆé€‰é¡¹çš„è¯¦ç»†ä¿¡æ¯å¯é€šè¿‡[OpenSSLå¯†ç åˆ—è¡¨æ ¼å¼æ–‡æ¡£]ï¼ˆ https://www.openssl.org/docs/man1.0.2/apps/ciphers.html<span class="comment">#CIPHER-LIST-FORMATï¼‰è·å¾—ã€‚</span></div><div class="line"></div><div class="line"></div><div class="line">elasticsearch.ssl.certificate: å’Œ elasticsearch.ssl.key:</div><div class="line">æä¾›PEMæ ¼å¼SSLè¯ä¹¦å’Œå¯†é’¥æ–‡ä»¶è·¯å¾„çš„å¯é€‰è®¾ç½®ã€‚è¿™äº›æ–‡ä»¶éªŒè¯æ‚¨çš„Elasticsearchåç«¯ä½¿ç”¨ç›¸åŒçš„å¯†é’¥æ–‡ä»¶ã€‚</div><div class="line"></div><div class="line">elasticsearch.ssl.keyPassphrase</div><div class="line">å°†ç”¨äºè§£å¯†ç§é’¥çš„å¯†ç çŸ­è¯­ã€‚è¯¥å€¼æ˜¯å¯é€‰çš„ï¼Œå› ä¸ºå¯†é’¥å¯èƒ½æœªè¢«åŠ å¯†ã€‚</div><div class="line"></div><div class="line">elasticsearch.ssl.certificateAuthorities:</div><div class="line">å¯é€‰è®¾ç½®ï¼Œä½¿æ‚¨èƒ½å¤ŸæŒ‡å®šElasticsearchå®ä¾‹çš„è¯ä¹¦é¢å‘æœºæ„çš„PEMæ–‡ä»¶çš„è·¯å¾„åˆ—è¡¨ã€‚</div><div class="line"></div><div class="line">elasticsearch.ssl.verificationMode:</div><div class="line">é»˜è®¤å€¼ï¼šfullæ§åˆ¶è¯ä¹¦çš„éªŒè¯ã€‚æœ‰æ•ˆå€¼æ˜¯noneï¼Œcertificateå’Œfullã€‚ fullæ‰§è¡Œä¸»æœºåéªŒè¯ï¼Œcertificateä¸æ‰§è¡Œã€‚</div><div class="line"></div><div class="line">elasticsearch.pingTimeout:</div><div class="line">é»˜è®¤å€¼ï¼šelasticsearch.requestTimeoutè®¾ç½®æ—¶é—´ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ç­‰å¾…å¼¹æ€§æœç´¢å“åº”pingçš„å€¼ã€‚</div><div class="line"></div><div class="line">elasticsearch.requestTimeout:</div><div class="line">é»˜è®¤å€¼ï¼š30000ç­‰å¾…åç«¯æˆ–å¼¹æ€§æœç´¢çš„å“åº”çš„æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ã€‚è¯¥å€¼å¿…é¡»ä¸ºæ­£æ•´æ•°ã€‚</div><div class="line"></div><div class="line">elasticsearch.requestHeadersWhitelist:</div><div class="line">é»˜è®¤å€¼ï¼š[ <span class="string">'authorization'</span> ]è¦å‘é€åˆ°Elasticsearchçš„Kibanaå®¢æˆ·ç«¯æ ‡é¢˜åˆ—è¡¨ã€‚è¦å‘é€æ²¡æœ‰å®¢æˆ·ç«¯æ ‡é¢˜ï¼Œè¯·å°†æ­¤å€¼è®¾ç½®ä¸º[]ï¼ˆç©ºåˆ—è¡¨ï¼‰ã€‚</div><div class="line"></div><div class="line">elasticsearch.customHeaders:</div><div class="line">é»˜è®¤å€¼ï¼š&#123;&#125;è¦å‘é€åˆ°Elasticsearchçš„æ ‡é¢˜åç§°å’Œå€¼ã€‚æ— è®ºelasticsearch.requestHeadersWhitelisté…ç½®å¦‚ä½•ï¼Œå®¢æˆ·ç«¯å¤´éƒ½ä¸èƒ½è¦†ç›–ä»»ä½•è‡ªå®šä¹‰å¤´æ–‡ä»¶ã€‚</div><div class="line"></div><div class="line">elasticsearch.shardTimeout:</div><div class="line">é»˜è®¤å€¼ï¼š0 Elasticsearchç­‰å¾…åˆ†ç‰‡å“åº”çš„æ—¶é—´ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ã€‚è®¾ç½®ä¸º0ä»¥ç¦ç”¨ã€‚</div><div class="line"></div><div class="line">elasticsearch.startupTimeout:</div><div class="line">é»˜è®¤å€¼ï¼š5000é‡è¯•ä¹‹å‰ç­‰å¾…Kibanaå¯åŠ¨æ—¶çš„å¼¹æ€§æœç´¢çš„æ—¶é—´ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ã€‚</div><div class="line"></div><div class="line">pid.file:</div><div class="line">æŒ‡å®šKibanaåˆ›å»ºè¿›ç¨‹IDæ–‡ä»¶çš„è·¯å¾„ã€‚</div><div class="line"></div><div class="line">logging.dest:</div><div class="line">é»˜è®¤å€¼ï¼šstdoutå…è®¸æ‚¨æŒ‡å®šKibanaå­˜å‚¨æ—¥å¿—è¾“å‡ºçš„æ–‡ä»¶ã€‚</div><div class="line"></div><div class="line">logging.silent:</div><div class="line">é»˜è®¤å€¼ï¼š<span class="literal">false</span>å°†æ­¤è®¾ç½®çš„å€¼è®¾ç½®<span class="literal">true</span>ä¸ºç¦æ­¢æ‰€æœ‰æ—¥å¿—è¾“å‡ºã€‚</div><div class="line"></div><div class="line">logging.quiet:</div><div class="line">é»˜è®¤å€¼ï¼š<span class="literal">false</span>å°†æ­¤è®¾ç½®çš„å€¼è®¾ç½®<span class="literal">true</span>ä¸ºç¦æ­¢é™¤é”™è¯¯æ¶ˆæ¯ä¹‹å¤–çš„æ‰€æœ‰æ—¥å¿—è¾“å‡ºã€‚</div><div class="line"></div><div class="line">logging.verbose</div><div class="line">é»˜è®¤å€¼ï¼š<span class="literal">false</span>å°†æ­¤è®¾ç½®çš„å€¼è®¾ç½®ä¸º<span class="literal">true</span>è®°å½•æ‰€æœ‰äº‹ä»¶ï¼ŒåŒ…æ‹¬ç³»ç»Ÿä½¿ç”¨æƒ…å†µä¿¡æ¯å’Œæ‰€æœ‰è¯·æ±‚ã€‚</div><div class="line"></div><div class="line">ops.interval</div><div class="line">é»˜è®¤å€¼ï¼š5000è®¾ç½®é‡‡æ ·ç³»ç»Ÿå’Œè¿›ç¨‹æ€§èƒ½æŒ‡æ ‡çš„é—´éš”ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ã€‚æœ€å°å€¼ä¸º100ã€‚</div><div class="line"></div><div class="line">status.allowAnonymous</div><div class="line">é»˜è®¤å€¼ï¼š<span class="literal">false</span>å¦‚æœå¯ç”¨äº†èº«ä»½éªŒè¯ï¼Œ<span class="literal">true</span>è¯·å°†å…¶è®¾ç½®ä¸ºå…è®¸æœªç»èº«ä»½éªŒè¯çš„ç”¨æˆ·è®¿é—®KibanaæœåŠ¡å™¨çŠ¶æ€APIå’ŒçŠ¶æ€é¡µé¢ã€‚</div><div class="line"></div><div class="line">cpu.cgroup.path.override</div><div class="line">è¦†ç›–cgroup cpuè·¯å¾„ï¼Œä»¥ä¸ä¸€è‡´çš„æ–¹å¼å®‰è£… /proc/self/cgroup</div><div class="line"></div><div class="line">cpuacct.cgroup.path.override</div><div class="line">åœ¨ä¸ä¸ä¸€è‡´çš„æ–¹å¼å®‰è£…æ—¶ï¼Œè¦†ç›–cgroup cpuacctè·¯å¾„ /proc/self/cgroup</div><div class="line"></div><div class="line">console.enabled</div><div class="line">é»˜è®¤å€¼ï¼š<span class="literal">true</span>è®¾ç½®ä¸º<span class="literal">false</span>ä»¥ç¦ç”¨æ§åˆ¶å°ã€‚åˆ‡æ¢æ­¤æ“ä½œå°†å¯¼è‡´æœåŠ¡å™¨åœ¨ä¸‹æ¬¡å¯åŠ¨æ—¶é‡æ–°ç”Ÿæˆèµ„æºï¼Œè¿™å¯èƒ½ä¼šåœ¨é¡µé¢å¼€å§‹æŠ•æ”¾ä¹‹å‰é€ æˆå»¶è¿Ÿã€‚</div><div class="line"></div><div class="line">elasticsearch.tribe.url:</div><div class="line">ç”¨äºæ‰€æœ‰æŸ¥è¯¢çš„Elasticsearchéƒ¨è½å®ä¾‹çš„å¯é€‰URLã€‚</div><div class="line"></div><div class="line">elasticsearch.tribe.username: å’Œ elasticsearch.tribe.password:</div><div class="line">å¦‚æœæ‚¨çš„Elasticsearchå—åˆ°åŸºæœ¬èº«ä»½éªŒè¯çš„ä¿æŠ¤ï¼Œè¿™äº›è®¾ç½®å°†æä¾›KibanaæœåŠ¡å™¨åœ¨å¯åŠ¨æ—¶å¯¹Kibanaç´¢å¼•æ‰§è¡Œç»´æŠ¤æ‰€ç”¨çš„ç”¨æˆ·åå’Œå¯†ç ã€‚æ‚¨çš„Kibanaç”¨æˆ·ä»ç„¶éœ€è¦ä½¿ç”¨é€šè¿‡KibanaæœåŠ¡å™¨ä»£ç†çš„Elasticsearchè¿›è¡Œèº«ä»½éªŒè¯ã€‚</div><div class="line"></div><div class="line">elasticsearch.tribe.ssl.certificate: å’Œ elasticsearch.tribe.ssl.key:</div><div class="line">æä¾›PEMæ ¼å¼SSLè¯ä¹¦å’Œå¯†é’¥æ–‡ä»¶è·¯å¾„çš„å¯é€‰è®¾ç½®ã€‚è¿™äº›æ–‡ä»¶éªŒè¯æ‚¨çš„Elasticsearchåç«¯ä½¿ç”¨ç›¸åŒçš„å¯†é’¥æ–‡ä»¶ã€‚</div><div class="line"></div><div class="line">elasticsearch.tribe.ssl.keyPassphrase</div><div class="line">å°†ç”¨äºè§£å¯†ç§é’¥çš„å¯†ç çŸ­è¯­ã€‚è¯¥å€¼æ˜¯å¯é€‰çš„ï¼Œå› ä¸ºå¯†é’¥å¯èƒ½æœªè¢«åŠ å¯†ã€‚</div><div class="line"></div><div class="line">elasticsearch.tribe.ssl.certificateAuthorities:</div><div class="line">å¯é€‰è®¾ç½®ï¼Œä½¿æ‚¨èƒ½å¤Ÿä¸ºæ‚¨çš„éƒ¨è½Elasticsearchå®ä¾‹çš„è¯ä¹¦é¢å‘æœºæ„æŒ‡å®šPEMæ–‡ä»¶çš„è·¯å¾„ã€‚</div><div class="line"></div><div class="line">elasticsearch.tribe.ssl.verificationMode:</div><div class="line">é»˜è®¤å€¼ï¼šfullæ§åˆ¶è¯ä¹¦çš„éªŒè¯ã€‚æœ‰æ•ˆå€¼æ˜¯noneï¼Œcertificateå’Œfullã€‚fullæ‰§è¡Œä¸»æœºåéªŒè¯ï¼Œ</div><div class="line">certificateä¸æ‰§è¡Œã€‚</div><div class="line"></div><div class="line">elasticsearch.tribe.pingTimeout:</div><div class="line">é»˜è®¤å€¼ï¼šelasticsearch.tribe.requestTimeoutè®¾ç½®æ—¶é—´ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ç­‰å¾…å¼¹æ€§æœç´¢å“åº”pingçš„å€¼ã€‚</div><div class="line"></div><div class="line">elasticsearch.tribe.requestTimeout:</div><div class="line">é»˜è®¤å€¼ï¼š30000ç­‰å¾…åç«¯æˆ–å¼¹æ€§æœç´¢çš„å“åº”çš„æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ã€‚è¯¥å€¼å¿…é¡»ä¸ºæ­£æ•´æ•°ã€‚</div><div class="line"></div><div class="line">elasticsearch.tribe.requestHeadersWhitelist:</div><div class="line">é»˜è®¤å€¼ï¼š[ <span class="string">'authorization'</span> ]è¦å‘é€åˆ°Elasticsearchçš„Kibanaå®¢æˆ·ç«¯æ ‡é¢˜åˆ—è¡¨ã€‚è¦å‘é€æ²¡æœ‰å®¢æˆ·ç«¯æ ‡é¢˜ï¼Œè¯·å°†æ­¤å€¼è®¾ç½®ä¸º[]ï¼ˆç©ºåˆ—è¡¨ï¼‰ã€‚</div><div class="line"></div><div class="line">elasticsearch.tribe.customHeaders:</div><div class="line">é»˜è®¤å€¼ï¼š&#123;&#125;è¦å‘é€åˆ°Elasticsearchçš„æ ‡é¢˜åç§°å’Œå€¼ã€‚æ— è®º</div><div class="line">elasticsearch.tribe.requestHeadersWhitelisté…ç½®å¦‚ä½•ï¼Œå®¢æˆ·ç«¯å¤´éƒ½ä¸èƒ½è¦†ç›–ä»»ä½•è‡ªå®šä¹‰å¤´æ–‡ä»¶ã€‚</div></pre></td></tr></table></figure><p>æ ¹æ®ä¸åŒçš„éœ€æ±‚é…ç½®ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@logstash config]<span class="comment"># cat kibana.yml | grep -Pv "^#|^$"</span></div><div class="line">server.port: 5601</div><div class="line">server.host: <span class="string">"10.11.10.26"</span></div><div class="line">server.name: <span class="string">"jollychic-log"</span></div><div class="line">elasticsearch.url: <span class="string">"http://10.11.10.26:9200"</span></div><div class="line">elasticsearch.preserveHost: <span class="literal">true</span></div><div class="line">kibana.index: <span class="string">".kibana"</span></div></pre></td></tr></table></figure><p>é…ç½®å¥½é…ç½®ï¼Œå¯åŠ¨æœåŠ¡ï¼š<code>./bin/kibana &amp; åå°å¯åŠ¨</code></p><h3 id="1-6è®¿é—®Kibana"><a href="#1-6è®¿é—®Kibana" class="headerlink" title="1.6è®¿é—®Kibana"></a>1.6è®¿é—®Kibana</h3><ul><li>æ£€æŸ¥KibanaçŠ¶æ€</li></ul><p>æ‚¨å¯ä»¥é€šè¿‡å¯¼èˆªåˆ°è¾¾KibanaæœåŠ¡å™¨çš„çŠ¶æ€é¡µé¢localhost:5601/statusã€‚çŠ¶æ€é¡µé¢æ˜¾ç¤ºæœ‰å…³æœåŠ¡å™¨èµ„æºä½¿ç”¨æƒ…å†µçš„ä¿¡æ¯ï¼Œå¹¶åˆ—å‡ºå·²å®‰è£…çš„æ’ä»¶ã€‚</p><p><code>http://10.11.10.26:5601/status</code></p><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/elasticstack_022.png" alt=""></figure></p><ul><li>é…ç½®ç´¢å¼•æ¨¡å¼<br>æŒ‡å®šä¸ä¸€ä¸ªæˆ–å¤šä¸ªå¼¹æ€§æœç´¢ç´¢å¼•çš„åç§°ç›¸åŒ¹é…çš„ç´¢å¼•æ¨¡å¼ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒKibanaçŒœæµ‹æ‚¨æ­£åœ¨ä½¿ç”¨ç”±Logstashæä¾›ç»™Elasticsearchçš„æ•°æ®ã€‚å¦‚æœæ˜¯è¿™æ ·ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨é»˜è®¤å€¼logstash-<em>ä½œä¸ºç´¢å¼•æ¨¡å¼ã€‚æ˜Ÿå·ï¼ˆ</em>ï¼‰åŒ¹é…ç´¢å¼•åç§°ä¸­çš„é›¶ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ã€‚å¦‚æœæ‚¨çš„å¼¹æ€§æœç´¢ç´¢å¼•éµå¾ªå…¶ä»–å‘½åçº¦å®šï¼Œè¯·è¾“å…¥é€‚å½“çš„æ¨¡å¼ã€‚â€œæ¨¡å¼â€ä¹Ÿå¯ä»¥ç®€å•åœ°æ˜¯å•ä¸ªç´¢å¼•çš„åç§°ã€‚<br>é€‰æ‹©åŒ…å«è¦ç”¨äºæ‰§è¡ŒåŸºäºæ—¶é—´çš„æ¯”è¾ƒçš„æ—¶é—´æˆ³çš„ç´¢å¼•å­—æ®µã€‚Kibanaè¯»å–ç´¢å¼•æ˜ å°„ä»¥åˆ—å‡ºåŒ…å«æ—¶é—´æˆ³çš„æ‰€æœ‰å­—æ®µã€‚å¦‚æœæ‚¨çš„ç´¢å¼•æ²¡æœ‰åŸºäºæ—¶é—´çš„æ•°æ®ï¼Œè¯·ç¦ç”¨ç´¢å¼•åŒ…å«åŸºäºæ—¶é—´çš„äº‹ä»¶é€‰é¡¹ã€‚</li></ul><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/elasticstack_033.png" alt=""></figure></p><ul><li>é€‰æ‹©ç´¢å¼•æŸ¥çœ‹æ—¥å¿—</li></ul><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/elasticstack_044.png" alt=""></figure></p><p>å®˜ç½‘ä¸­åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨Kibana è¯´çš„å¾ˆè¯¦ç»†ï¼š<a href="https://www.elastic.co/guide/en/kibana/current/production.html" target="_blank" rel="external">åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨Kibana</a></p><p>ä¸Šé¢æ˜¯æˆ‘logstashå·²ç»æ­å»ºé…ç½®å¥½ç´¢å¼•æ‰èƒ½è·å–åˆ°ã€‚ä¸‹é¢è®²å¦‚ä½•éƒ¨ç½²logstash</p><h2 id="äºŒã€Logstashçš„éƒ¨ç½²"><a href="#äºŒã€Logstashçš„éƒ¨ç½²" class="headerlink" title="äºŒã€Logstashçš„éƒ¨ç½²"></a>äºŒã€Logstashçš„éƒ¨ç½²</h2><p>ä¸Elasticsearchç±»ä¼¼ï¼Œåœ¨å®˜ç½‘ä¸‹è½½å‹ç¼©åŒ…åï¼Œè§£å‹å³å¯ç”¨ã€‚</p><p>åœ¨éé«˜çº§åœºæ™¯ä¸‹ï¼ŒLogstashæœ¬èº«ä¸éœ€è¦è¿›è¡Œå¤ªå¤šçš„é…ç½®ï¼ˆé…ç½®æ–‡ä»¶åœ¨logstashæ ¹ç›®å½•ä¸‹çš„<code>./config/logstash.yml</code>ï¼‰ï¼Œé«˜çº§åœºæ™¯è¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚<br>logstashçš„å¯åŠ¨å‘½ä»¤ä¸º:<code>./bin/logstash -f &lt;pipeline_conf_file&gt; --config.reload.automatic</code>ï¼Œå…¶ä¸­-fæŒ‡å®šäº†pipelineé…ç½®æ–‡ä»¶çš„ä½ç½®<code>ï¼Œ--config.reload.automatic</code>æŒ‡å®šäº†pipelineé…ç½®æ–‡ä»¶å¯ä»¥è¿›è¡Œçƒ­åŠ è½½ã€‚<br>æœ¬æ¬¡æˆ‘ä»¬ä½¿ç”¨Logstashä½œä¸ºæ—¥å¿—è§£ææ¨¡å—ï¼ˆLogstashå…¶å®ä¹Ÿå¯ä»¥ä½œä¸ºæ—¥å¿—é‡‡é›†å™¨ï¼‰ï¼Œé‡ç‚¹éœ€è¦é…ç½®pipelineçš„ä¸‰å¤§éƒ¨åˆ†ï¼š<code>inputã€filterå’Œoutputã€‚pipeline</code>æ–‡ä»¶éœ€è¦è‡ªå·±åˆ›å»ºã€‚</p><h3 id="Installing-Logstash"><a href="#Installing-Logstash" class="headerlink" title="Installing Logstash"></a>Installing Logstash</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">java version <span class="string">"1.8.0_65"</span></div><div class="line">Java(TM) SE Runtime Environment (build 1.8.0_65-b17)</div><div class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.65-b01, mixed mode)</div><div class="line"></div><div class="line">rpm --import https://artifacts.elastic.co/GPG-KEY-elasticsearch</div><div class="line"></div><div class="line">vim /etc/yum.repos.d/logstash.repo</div><div class="line">[logstash-5.x]</div><div class="line">name=Elastic repository <span class="keyword">for</span> 5.x packages</div><div class="line">baseurl=https://artifacts.elastic.co/packages/5.x/yum</div><div class="line">gpgcheck=1</div><div class="line">gpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch</div><div class="line">enabled=1</div><div class="line">autorefresh=1</div><div class="line"><span class="built_in">type</span>=rpm-md</div><div class="line"></div><div class="line">sudo yum install logstash</div></pre></td></tr></table></figure><p>é¦–å…ˆï¼Œæˆ‘ä»¬é€šè¿‡è¿è¡Œæœ€åŸºæœ¬çš„<code>Logstash</code>ç®¡é“æ¥æµ‹è¯•æ‚¨çš„<code>Logstash</code>å®‰è£…ã€‚</p><p><code>Logstash</code>ç®¡é“æœ‰ä¸¤ä¸ªå¿…éœ€çš„å…ƒç´ ï¼Œ<code>input</code>å¹¶ä¸”<code>output</code>ï¼Œå’Œä¸€ä¸ªå¯é€‰çš„å…ƒç´ ï¼Œ<code>filter</code>ã€‚è¾“å…¥æ’ä»¶æ¶ˆè€—æ¥è‡ªæºçš„æ•°æ®ï¼Œè¿‡æ»¤å™¨æ’ä»¶ä¼šæŒ‰ç…§æ‚¨æŒ‡å®šçš„æ–¹å¼ä¿®æ”¹æ•°æ®ï¼Œå¹¶ä¸”è¾“å‡ºæ’ä»¶å°†æ•°æ®å†™å…¥åˆ°ç›®çš„åœ°ã€‚</p><p><figure class="figure"><img src="https://www.elastic.co/guide/en/logstash/current/static/images/basic_logstash_pipeline.png" alt=""></figure></p><p>è¦æµ‹è¯•æ‚¨çš„Logstashå®‰è£…ï¼Œè¿è¡Œæœ€åŸºæœ¬çš„Logstashç®¡é“ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> logstash-5.5.2</div><div class="line">bin / logstash <span class="_">-e</span><span class="string">'input &#123;stdin &#123;&#125;&#125; output &#123;stdout &#123;&#125;&#125;'</span></div></pre></td></tr></table></figure><p>è¯¥<code>-e</code>æ ‡å¿—ä½¿æ‚¨èƒ½å¤Ÿç›´æ¥ä»å‘½ä»¤è¡ŒæŒ‡å®šé…ç½®ã€‚åœ¨å‘½ä»¤è¡Œä¸­æŒ‡å®šé…ç½®å¯ä»¥å¿«é€Ÿæµ‹è¯•é…ç½®ï¼Œè€Œæ— éœ€åœ¨è¿­ä»£ä¹‹é—´ç¼–è¾‘æ–‡ä»¶ã€‚ç¤ºä¾‹ä¸­çš„æµæ°´çº¿ä»æ ‡å‡†è¾“å…¥ç«¯è¾“å…¥ï¼Œ<code>stdinå¹¶stdout</code>ä»¥ç»“æ„åŒ–æ ¼å¼å°†è¯¥è¾“å…¥ç§»åŠ¨åˆ°æ ‡å‡†è¾“å‡º ã€‚</p><p>å¯åŠ¨<code>Logstash</code>åï¼Œç­‰åˆ°çœ‹åˆ°<code>â€œPipeline main startedâ€</code>ï¼Œç„¶åhello worldåœ¨å‘½ä»¤æç¤ºç¬¦ä¸‹è¾“å…¥ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">hello world</div><div class="line">2017-07-21T01:22:14.405+0000 0.0.0.0 hello world</div></pre></td></tr></table></figure><p>Logstashå°†æ—¶é—´æˆ³å’ŒIPåœ°å€ä¿¡æ¯æ·»åŠ åˆ°æ¶ˆæ¯ä¸­ã€‚é€šè¿‡åœ¨è¿è¡ŒLogstashçš„shellä¸­å‘å‡ºCTRL-Då‘½ä»¤é€€å‡ºLogstash ã€‚</p><p>logstashçš„é…ç½®ç‰‡æ®µï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">#character at the beginning of a line indicates a comment. Use</span></div><div class="line"><span class="comment"># comments to describe your configuration.</span></div><div class="line">input &#123;</div><div class="line">    udp &#123;</div><div class="line">        port =&gt; 25826</div><div class="line">        buffer_size =&gt; 1452</div><div class="line">        workers =&gt; 3          <span class="comment"># Default is 2</span></div><div class="line">        queue_size =&gt; 30000   <span class="comment"># Default is 2000</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">output &#123;</div><div class="line">  elasticsearch &#123;</div><div class="line">    hosts =&gt; [ <span class="string">"10.11.10.26:9200"</span> ]</div><div class="line">    user =&gt; logstash</div><div class="line">    password =&gt; logstash</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p><strong>â˜ºå¾…æ•´ç†ç»­å†™~~</strong></p><h3 id="äº¤æµå­¦ä¹ ï¼š"><a href="#äº¤æµå­¦ä¹ ï¼š" class="headerlink" title="äº¤æµå­¦ä¹ ï¼š"></a>äº¤æµå­¦ä¹ ï¼š</h3><p>ğŸ§  Linux shell_é«˜çº§è¿ç»´æ´¾: <code>459096184</code>    åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)<br>ğŸ§  BigData-Exchange School : <code>521621407</code>  åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥</p><p>ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;ElasticStack-5-xä»‹ç»&quot;&gt;&lt;a href=&quot;#ElasticStack-5-xä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;ElasticStack 5.xä»‹ç»&quot;&gt;&lt;/a&gt;ElasticStack 5.xä»‹ç»&lt;/h2&gt;&lt;h4 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h4&gt;&lt;p&gt;&lt;img src=&quot;https://www.elastic.co/cn/assets/blt08fb2e862c57956e/elastic-elk-b.png&quot; alt=&quot;img-w550&quot;&gt;&lt;br&gt;&lt;code&gt;ELK=ElasticSearch å®˜æ–¹åšå®¢:åˆ†å¸ƒå¼ä»¥åŠ Elastic&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Elastic Stackæ˜¯ELKæ—¥å¿—ç³»ç»Ÿçš„å®˜æ–¹ç§°å‘¼ï¼Œè€ŒELKåˆ™æ˜¯ç››ååœ¨å¤–çš„ä¸€æ¬¾å¼€æºåˆ†å¸ƒå¼æ—¥å¿—ç³»ç»Ÿï¼Œä¸€èˆ¬è¯´æ¥åŒ…æ‹¬äº†Elasticsearchã€Logstashå’ŒKibanaï¼Œæ¶µç›–äº†åç«¯æ—¥å¿—é‡‡é›†ã€æ—¥å¿—æœç´¢æœåŠ¡å’Œå‰ç«¯æ•°æ®å±•ç¤ºç­‰åŠŸèƒ½ã€‚&lt;br&gt;æœ¬æ–‡å°†ä¼šå¯¹Elastic Stackçš„å®‰è£…éƒ¨ç½²æµç¨‹è¿›è¡Œä¸€ç³»åˆ—ç®€å•çš„ä»‹ç»ï¼Œå¹¶è®°å½•ä¸‹äº†ä¸€äº›éƒ¨ç½²è¿‡ç¨‹ä¸­é‡åˆ°çš„å‘åŠè§£å†³æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºä¸€ä¸ªè½¯ä»¶æˆ–äº’è”ç½‘å…¬å¸æ¥è¯´ï¼Œå¯¹è®¡ç®—èµ„æºå’Œåº”ç”¨è¿›è¡Œç›‘æ§å’Œå‘Šè­¦æ˜¯éå¸¸åŸºç¡€çš„éœ€æ±‚ã€‚å¯¹äºå¤§å…¬å¸æˆ–æˆç†Ÿå…¬å¸ï¼Œä¸€ä¸ªé«˜åº¦å®šåˆ¶åŒ–çš„ç›‘æ§ç³»ç»Ÿåº”è¯¥å·²ç»å­˜åœ¨äº†å¾ˆé•¿æ—¶é—´å¹¶ä¸”éå¸¸æˆç†Ÿäº†ã€‚è€Œå¯¹äºä¸€ä¸ªåˆåˆ›å…¬å¸æˆ–å°å…¬å¸æ¥è¯´ï¼Œå¦‚ä½•åˆ©ç”¨ç°æœ‰å¼€æºå·¥å…·å¿«é€Ÿæ­å»ºä¸€å¥—æ—¥å¿—ç›‘æ§åŠåˆ†æå¹³å°æ˜¯éœ€è¦æ¢ç´¢çš„äº‹æƒ…ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Log Analysis Platform" scheme="http://blog.yancy.cc/categories/Log-Analysis-Platform/"/>
    
    
      <category term="Elasticsearch" scheme="http://blog.yancy.cc/tags/Elasticsearch/"/>
    
      <category term="Kibana" scheme="http://blog.yancy.cc/tags/Kibana/"/>
    
  </entry>
  
  <entry>
    <title>Kafkaæ€§èƒ½ä¼˜åŒ–â€“JVMå‚æ•°é…ç½®ä¼˜åŒ–</title>
    <link href="http://blog.yancy.cc/2017/07/04/Bigdata-hadoop/Kafka/kafka%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E2%80%93JVM%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE%E4%BC%98%E5%8C%96/"/>
    <id>http://blog.yancy.cc/2017/07/04/Bigdata-hadoop/Kafka/kafkaæ€§èƒ½ä¼˜åŒ–â€“JVMå‚æ•°é…ç½®ä¼˜åŒ–/</id>
    <published>2017-07-04T03:22:00.000Z</published>
    <updated>2017-09-23T16:20:06.000Z</updated>
    
    <content type="html"><![CDATA[<p><figure class="figure"><img src="https://cdn2.hubspot.net/hubfs/540072/Kafka_Connect_graphic.png" alt="img-w650"><figcaption class="figure__caption">img-w650</figcaption></figure></p><h3 id="Kafkaé›†ç¾¤ç¨³å®š"><a href="#Kafkaé›†ç¾¤ç¨³å®š" class="headerlink" title="Kafkaé›†ç¾¤ç¨³å®š"></a>Kafkaé›†ç¾¤ç¨³å®š</h3><p>GCè°ƒä¼˜<br>ã€€ã€€è°ƒGCæ˜¯é—¨æ‰‹è‰ºæ´»ï¼Œå¹¸äºJava 7å¼•è¿›äº†G1 åƒåœ¾å›æ”¶ï¼Œä½¿å¾—GCè°ƒä¼˜å˜çš„æ²¡é‚£ä¹ˆéš¾ã€‚G1ä¸»è¦æœ‰ä¸¤ä¸ªé…ç½®é€‰é¡¹æ¥è°ƒä¼˜ï¼šMaxGCPauseMillis å’Œ InitiatingHeapOccupancyPercentï¼Œå…·ä½“å‚æ•°è®¾ç½®å¯ä»¥å‚è€ƒGoogleï¼Œè¿™é‡Œä¸èµ˜è¿°ã€‚</p><p>ã€€ã€€Kafka brokerèƒ½å¤Ÿæœ‰æ•ˆçš„åˆ©ç”¨å †å†…å­˜å’Œå¯¹è±¡å›æ”¶ï¼Œæ‰€ä»¥è¿™äº›å€¼å¯ä»¥è°ƒå°ç‚¹ã€‚å¯¹äº 64Gbå†…å­˜ï¼ŒKafkaè¿è¡Œå †å†…å­˜5Gbï¼ŒMaxGCPauseMillis å’Œ InitiatingHeapOccupancyPercent åˆ†åˆ«è®¾ç½®ä¸º 20æ¯«ç§’å’Œ 35ã€‚Kafkaçš„å¯åŠ¨è„šæœ¬ä½¿ç”¨çš„ä¸æ˜¯ G1å›æ”¶ï¼Œéœ€è¦åœ¨ç¯å¢ƒå˜é‡ä¸­åŠ å…¥ã€‚</p><a id="more"></a><h3 id="Kafka-Brokerä¸ªæ•°å†³å®šå› ç´ "><a href="#Kafka-Brokerä¸ªæ•°å†³å®šå› ç´ " class="headerlink" title="Kafka Brokerä¸ªæ•°å†³å®šå› ç´ "></a>Kafka Brokerä¸ªæ•°å†³å®šå› ç´ </h3><p>ã€€ã€€ç£ç›˜å®¹é‡ï¼šé¦–å…ˆè€ƒè™‘çš„æ˜¯æ‰€éœ€ä¿å­˜çš„æ¶ˆæ¯æ‰€å ç”¨çš„æ€»ç£ç›˜å®¹é‡å’Œæ¯ä¸ªbrokeræ‰€èƒ½æä¾›çš„ç£ç›˜ç©ºé—´ã€‚å¦‚æœKafkaé›†ç¾¤éœ€è¦ä¿ç•™ 10 TBæ•°æ®ï¼Œå•ä¸ªbrokerèƒ½å­˜å‚¨ 2 TBï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦çš„æœ€å°Kafkaé›†ç¾¤å¤§å°5ä¸ªbrokerã€‚æ­¤å¤–ï¼Œå¦‚æœå¯ç”¨å‰¯æœ¬å‚æ•°ï¼Œåˆ™å¯¹åº”çš„å­˜å‚¨ç©ºé—´éœ€è‡³å°‘å¢åŠ ä¸€å€ï¼ˆå–å†³äºå‰¯æœ¬å‚æ•°ï¼‰ã€‚è¿™æ„å‘³ç€å¯¹åº”çš„Kafkaé›†ç¾¤è‡³å°‘éœ€è¦ 10 ä¸ªbrokerã€‚</p><p>ã€€ã€€è¯·æ±‚é‡ï¼šå¦å¤–ä¸€ä¸ªè¦è€ƒè™‘çš„æ˜¯Kafkaé›†ç¾¤å¤„ç†è¯·æ±‚çš„èƒ½åŠ›ã€‚è¿™ä¸»è¦å–å†³äºå¯¹Kafka clientè¯·æ±‚çš„ç½‘ç»œå¤„ç†èƒ½åŠ›ï¼Œç‰¹åˆ«æ˜¯ï¼Œæœ‰å¤šä¸ªconsumeræˆ–è€…ç½‘è·¯æµé‡ä¸ç¨³å®šã€‚å¦‚æœï¼Œé«˜å³°æ—¶åˆ»ï¼Œå•ä¸ªbrokerçš„ç½‘ç»œæµé‡è¾¾åˆ°80%ï¼Œè¿™æ—¶æ˜¯æ’‘ä¸ä½ä¸¤ä¸ªconsumerçš„ï¼Œé™¤éæœ‰ä¸¤ä¸ªbrokerã€‚å†è€…ï¼Œå¦‚æœå¯ç”¨äº†å‰¯æœ¬å‚æ•°ï¼Œåˆ™éœ€è¦è€ƒè™‘å‰¯æœ¬è¿™ä¸ªé¢å¤–çš„consumerã€‚ä¹Ÿå¯ä»¥æ‰©å±•å¤šä¸ªbrokeræ¥å‡å°‘ç£ç›˜çš„ååé‡å’Œç³»ç»Ÿå†…å­˜ã€‚</p><h3 id="ä¸»è¦æ˜¯å¯åŠ¨è„šæœ¬å’Œlog4jåŸºæœ¬å‚æ•°çš„è®¾ç½®å’Œä¼˜åŒ–ï¼Œè¿™äº›å‚æ•°è—çš„æ¯”è¾ƒæ·±ã€‚"><a href="#ä¸»è¦æ˜¯å¯åŠ¨è„šæœ¬å’Œlog4jåŸºæœ¬å‚æ•°çš„è®¾ç½®å’Œä¼˜åŒ–ï¼Œè¿™äº›å‚æ•°è—çš„æ¯”è¾ƒæ·±ã€‚" class="headerlink" title="ä¸»è¦æ˜¯å¯åŠ¨è„šæœ¬å’Œlog4jåŸºæœ¬å‚æ•°çš„è®¾ç½®å’Œä¼˜åŒ–ï¼Œè¿™äº›å‚æ•°è—çš„æ¯”è¾ƒæ·±ã€‚"></a>ä¸»è¦æ˜¯å¯åŠ¨è„šæœ¬å’Œlog4jåŸºæœ¬å‚æ•°çš„è®¾ç½®å’Œä¼˜åŒ–ï¼Œè¿™äº›å‚æ•°è—çš„æ¯”è¾ƒæ·±ã€‚</h3><h3 id="1ã€JVMå‚æ•°é…ç½®ä¼˜åŒ–"><a href="#1ã€JVMå‚æ•°é…ç½®ä¼˜åŒ–" class="headerlink" title="1ã€JVMå‚æ•°é…ç½®ä¼˜åŒ–"></a>1ã€JVMå‚æ•°é…ç½®ä¼˜åŒ–</h3><p>å¦‚æœä½¿ç”¨çš„CMS GCç®—æ³•ï¼Œå»ºè®®JVM Heapä¸è¦å¤ªå¤§ï¼Œåœ¨4GBä»¥å†…å°±å¯ä»¥ã€‚JVMå¤ªå¤§ï¼Œå¯¼è‡´Major GCæˆ–è€…Full GCäº§ç”Ÿçš„â€œstop the worldâ€æ—¶é—´è¿‡é•¿ï¼Œå¯¼è‡´brokerå’Œzkä¹‹é—´çš„sessionè¶…æ—¶ï¼Œæ¯”å¦‚é‡æ–°é€‰ä¸¾controllerèŠ‚ç‚¹å’Œæå‡follow replicaä¸ºleader replicaã€‚<br>JVMä¹Ÿä¸èƒ½è¿‡å°ï¼Œå¦åˆ™ä¼šå¯¼è‡´é¢‘ç¹åœ°è§¦å‘gcæ“ä½œï¼Œä¹Ÿå½±å“Kafkaçš„ååé‡ã€‚å¦å¤–ï¼Œéœ€è¦é¿å…CMS GCè¿‡ç¨‹ä¸­çš„å‘ç”Ÿpromotion failureå’Œconcurrent failureé—®é¢˜ã€‚CMSInitiatingOccupancyFraction=70å¯ä»¥é¢„é˜²concurrent failureé—®é¢˜ï¼Œæå‰å‡ºå‘Major GCã€‚<br>Kafka JVMå‚æ•°å¯ä»¥ç›´æ¥ä¿®æ”¹å¯åŠ¨è„šæœ¬<code>bin/kafka-server-start.sh</code><br>ä¸­çš„å˜é‡å€¼ã€‚ä¸‹é¢æ˜¯ä¸€äº›åŸºæœ¬å‚æ•°ï¼Œä¹Ÿå¯ä»¥æ ¹æ®å®é™…çš„gcçŠ¶å†µå’Œè°ƒè¯•GCéœ€è¦å¢åŠ ä¸€äº›ç›¸å…³çš„å‚æ•°ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">export</span> KAFKA_HEAP_OPTS=<span class="string">"-Xmx4G -Xms4G -Xmn2G -XX:PermSize=64m -XX:MaxPermSize=128m  -XX:SurvivorRatio=6  -XX:CMSInitiatingOccupancyFraction=70 -XX:+UseCMSInitiatingOccupancyOnly"</span></div></pre></td></tr></table></figure><p>éœ€è¦å…³æ³¨gcæ—¥å¿—ä¸­çš„YGCæ—¶é—´ä»¥åŠCMS GCé‡Œé¢çš„CMS-initial-markå’ŒCMS-remarkä¸¤ä¸ªé˜¶æ®µçš„æ—¶é—´ï¼Œè¿™äº›GCè¿‡ç¨‹æ˜¯â€œstop the worldâ€æ–¹å¼å®Œæˆçš„ã€‚</p><blockquote><p>jdk1.8 ä¼˜åŒ–çš„è¯ä¼šæç¤ºMaxPermSize=128m,PermSize=64m å­—é¢æ„æ€æ˜¯MaxPermSizeä¸éœ€è¦æˆ‘ä»¬é…ç½®äº†,jdk1.8 ç‰ˆæœ¬åŠŸèƒ½å…¶å®å·²ä¸éœ€è¦è¿™ä¸ªä¼˜åŒ–å‚æ•°ï¼š</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[jollybi@kafka3 kafka_2.10-0.8.2.1]$ /data/tools/kafka_2.10-0.8.2.1/bin/kafka-server-start.sh /data/tools/kafka_2.10-0.8.2.1/config/server.properties &amp;</div><div class="line">[1] 10312</div><div class="line">[jollybi@kafka3 kafka_2.10-0.8.2.1]$ Java HotSpot(TM) 64-Bit Server VM warning: ignoring option PermSize=64m; support was removed <span class="keyword">in</span> 8.0</div><div class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize=128m; support was removed <span class="keyword">in</span> 8.0</div><div class="line"></div><div class="line">ä¼˜åŒ–å‚æ•°ï¼š</div><div class="line"><span class="built_in">export</span> KAFKA_HEAP_OPTS=<span class="string">"-Xmx4G -Xms4G -Xmn2G  -XX:SurvivorRatio=6  -XX:CMSInitiatingOccupancyFraction=70 -XX:+UseCMSInitiatingOccupancyOnly"</span></div><div class="line"><span class="built_in">export</span> JMX_PORT=<span class="string">"9999"</span>  <span class="comment">### Kafka Managerç›‘æ§ç›‘å¬jmxç«¯å£,å¦‚æœæ²¡æœ‰å¯ä¸è®¾ç½®ã€‚</span></div></pre></td></tr></table></figure><h3 id="2ã€æ‰“å¼€JMXç«¯å£"><a href="#2ã€æ‰“å¼€JMXç«¯å£" class="headerlink" title="2ã€æ‰“å¼€JMXç«¯å£"></a>2ã€æ‰“å¼€JMXç«¯å£</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ä¸»è¦æ˜¯ä¸ºäº†é€šè¿‡JMXç«¯å£ç›‘æ§Kafka Brokerä¿¡æ¯ã€‚å¯ä»¥åœ¨bin/kafka-server-start.shä¸­æ‰“å¼€JMXç«¯å£å˜é‡ã€‚</div><div class="line"><span class="built_in">export</span> JMX_PORT=9999</div></pre></td></tr></table></figure><h3 id="3ã€è°ƒæ•´log4jçš„æ—¥å¿—çº§åˆ«"><a href="#3ã€è°ƒæ•´log4jçš„æ—¥å¿—çº§åˆ«" class="headerlink" title="3ã€è°ƒæ•´log4jçš„æ—¥å¿—çº§åˆ«"></a>3ã€è°ƒæ•´log4jçš„æ—¥å¿—çº§åˆ«</h3><p>å¦‚æœé›†ç¾¤ä¸­topicå’Œpartitionæ•°é‡è¾ƒå¤§æ—¶ï¼Œå› ä¸ºlog4jçš„æ—¥å¿—çº§åˆ«å¤ªä½ï¼Œå¯¼è‡´è¿›ç¨‹æŒç»­å¾ˆé•¿çš„æ—¶é—´åœ¨æ‰“å°æ—¥å¿—ã€‚æ—¥å¿—é‡å·¨å¤§ï¼Œå¯¼è‡´å¾ˆå¤šé¢å¤–çš„æ€§èƒ½å¼€é”€ã€‚ç‰¹åˆ«æ˜¯contolleræ—¥å¿—çº§åˆ«ä¸ºtraceçº§åˆ«ï¼Œè¿™ç‚¹æ¯”è¾ƒå‘ã€‚<br>Tips é€šè¿‡JMXç«¯å£è®¾ç½®log4jæ—¥å¿—çº§åˆ«ï¼Œä¸ç”¨é‡å¯brokerèŠ‚ç‚¹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">è®¾ç½®æ—¥å¿—çº§åˆ«ï¼š</div><div class="line">java -jar cmdline-jmxclient-0.10.3.jar - localhost:9999 kafka:<span class="built_in">type</span>=kafka.Log4jController <span class="built_in">set</span>LogLevel=kafka.controller,INFO</div><div class="line">java -jar cmdline-jmxclient-0.10.3.jar - localhost:9999 kafka:<span class="built_in">type</span>=kafka.Log4jController <span class="built_in">set</span>LogLevel=state.change.logger,INFO</div><div class="line"> </div><div class="line">æ£€æŸ¥æ—¥å¿—çº§åˆ«ï¼š</div><div class="line">java -jar cmdline-jmxclient-0.10.3.jar - localhost:9999 kafka:<span class="built_in">type</span>=kafka.Log4jController getLogLevel=kafka.controller</div><div class="line">java -jar cmdline-jmxclient-0.10.3.jar - localhost:9999 kafka:<span class="built_in">type</span>=kafka.Log4jController getLogLevel=state.change.logger</div></pre></td></tr></table></figure><h3 id="4ã€æ€§èƒ½ä¼˜åŒ–æŠ€å·§"><a href="#4ã€æ€§èƒ½ä¼˜åŒ–æŠ€å·§" class="headerlink" title="4ã€æ€§èƒ½ä¼˜åŒ–æŠ€å·§"></a>4ã€æ€§èƒ½ä¼˜åŒ–æŠ€å·§</h3><p>4.1ã€é…ç½®åˆé€‚çš„partitonsæ•°é‡ã€‚</p><p>è¿™ä¼¼ä¹æ˜¯kafkaæ–°æ‰‹å¿…é—®å¾—é—®é¢˜ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å¿…é¡»ç†è§£ï¼Œpartitonæ˜¯kafkaçš„å¹¶è¡Œå•å…ƒã€‚ä»producerå’Œbrokerçš„è§†è§’çœ‹ï¼Œå‘ä¸åŒçš„partitionå†™å…¥æ˜¯å®Œå…¨å¹¶è¡Œçš„ï¼›è€Œå¯¹äºconsumerï¼Œå¹¶å‘æ•°å®Œå…¨å–å†³äºpartitionçš„æ•°é‡ï¼Œå³ï¼Œå¦‚æœconsumeræ•°é‡å¤§äºpartitionæ•°é‡ï¼Œåˆ™å¿…æœ‰consumeré—²ç½®ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºkafkaçš„ååä¸partitionæ—¶çº¿æ€§å…³ç³»ã€‚partitionçš„æ•°é‡è¦æ ¹æ®ååæ¥æ¨æ–­ï¼Œå‡å®špä»£è¡¨ç”Ÿäº§è€…å†™å…¥å•ä¸ªpartitionçš„æœ€å¤§ååï¼Œcä»£è¡¨æ¶ˆè´¹è€…ä»å•ä¸ªpartitionæ¶ˆè´¹çš„æœ€å¤§ååï¼Œæˆ‘ä»¬çš„ç›®æ ‡ååæ˜¯tï¼Œé‚£ä¹ˆpartitionçš„æ•°é‡åº”è¯¥æ˜¯t/på’Œt/cä¸­è¾ƒå¤§çš„é‚£ä¸€ä¸ªã€‚å®é™…æƒ…å†µä¸­ï¼Œpçš„å½±å“å› ç´ æœ‰æ‰¹å¤„ç†çš„è§„æ¨¡ï¼Œå‹ç¼©ç®—æ³•ï¼Œç¡®è®¤æœºåˆ¶å’Œå‰¯æœ¬æ•°ç­‰ï¼Œç„¶è€Œï¼Œå¤šæ¬¡benchmarkçš„ç»“æœè¡¨æ˜ï¼Œå•ä¸ªpartitionçš„æœ€å¤§å†™å…¥åååœ¨10MB/secå·¦å³ï¼›cçš„å½±å“å› ç´ æ˜¯é€»è¾‘ç®—æ³•ï¼Œéœ€è¦åœ¨ä¸åŒåœºæ™¯ä¸‹å®æµ‹å¾—å‡ºã€‚</p><p>è¿™ä¸ªç»“è®ºä¼¼ä¹å¤ªä¹¦ç”Ÿæ°”å’Œä¸å®ç”¨ã€‚æˆ‘ä»¬é€šå¸¸å»ºè®®partitionçš„æ•°é‡ä¸€å®šè¦å¤§äºç­‰äºæ¶ˆè´¹è€…çš„æ•°é‡æ¥å®ç°æœ€å¤§å¹¶å‘ã€‚å®˜æ–¹æ›¾æµ‹è¯•è¿‡1ä¸‡ä¸ªpartitionçš„æƒ…å†µï¼Œæ‰€ä»¥ä¸éœ€è¦å¤ªæ‹…å¿ƒpartitionè¿‡å¤šçš„é—®é¢˜ã€‚ä¸‹é¢çš„çŸ¥è¯†ä¼šæœ‰åŠ©äºè¯»è€…åœ¨ç”Ÿäº§ç¯å¢ƒåšå‡ºæœ€ä½³çš„é€‰æ‹©ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">aã€ä¸€ä¸ªpartitionå°±æ˜¯ä¸€ä¸ªå­˜å‚¨kafka-logçš„ç›®å½•ã€‚</div><div class="line">bã€ä¸€ä¸ªpartitionåªèƒ½å¯„å®¿åœ¨ä¸€ä¸ªbrokerä¸Šã€‚</div><div class="line">cã€å•ä¸ªpartitionæ˜¯å¯ä»¥å®ç°æ¶ˆæ¯çš„é¡ºåºå†™å…¥çš„ã€‚</div><div class="line">dã€å•ä¸ªpartitionåªèƒ½è¢«å•ä¸ªæ¶ˆè´¹è€…è¿›ç¨‹æ¶ˆè´¹ï¼Œä¸è¯¥æ¶ˆè´¹è€…æ‰€å±äºçš„æ¶ˆè´¹ç»„æ— å…³ã€‚è¿™æ ·åšï¼Œæœ‰åŠ©äºå®ç°é¡ºåºæ¶ˆè´¹ã€‚</div><div class="line">eã€å•ä¸ªæ¶ˆè´¹è€…è¿›ç¨‹å¯åŒæ—¶æ¶ˆè´¹å¤šä¸ªpartitionï¼Œå³partitioné™åˆ¶äº†æ¶ˆè´¹ç«¯çš„å¹¶å‘èƒ½åŠ›ã€‚</div><div class="line">fã€partitionè¶Šå¤šåˆ™fileå’Œmemoryæ¶ˆè€—è¶Šå¤§ï¼Œè¦åœ¨æœåŠ¡å™¨æ‰¿å—æœåŠ¡å™¨è®¾ç½®ã€‚</div><div class="line">gã€æ¯ä¸ªpartitionä¿¡æ¯éƒ½å­˜åœ¨æ‰€æœ‰çš„zkèŠ‚ç‚¹ä¸­ã€‚</div><div class="line">hã€partitionè¶Šå¤šåˆ™å¤±è´¥é€‰ä¸¾è€—æ—¶è¶Šé•¿ã€‚</div><div class="line">kã€offsetæ˜¯å¯¹æ¯ä¸ªpartitionè€Œè¨€çš„ï¼Œpartitionè¶Šå¤šï¼ŒæŸ¥è¯¢offsetå°±è¶Šè€—æ—¶ã€‚</div><div class="line">iã€partitionçš„æ•°é‡æ˜¯å¯ä»¥åŠ¨æ€å¢åŠ çš„ï¼ˆåªèƒ½åŠ ä¸èƒ½å‡ï¼‰ã€‚</div></pre></td></tr></table></figure><p>æˆ‘ä»¬å»ºè®®çš„åšæ³•æ˜¯ï¼Œå¦‚æœæ˜¯3ä¸ªbrokerçš„é›†ç¾¤ï¼Œæœ‰5ä¸ªæ¶ˆè´¹è€…ï¼Œé‚£ä¹ˆå»ºè®®partitionçš„æ•°é‡æ˜¯15ï¼Œä¹Ÿå°±æ˜¯brokerå’Œconsumeræ•°é‡çš„æœ€å°å…¬å€æ•°ã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå¤§äºæ¶ˆè´¹è€…çš„brokeræ•°é‡çš„å€æ•°ï¼Œæ¯”å¦‚6æˆ–è€…9ï¼Œè¿˜è¯·è¯»è€…è‡ªè¡Œæ ¹æ®å®é™…ç¯å¢ƒè£å®šã€‚</p><h3 id="äº¤æµå­¦ä¹ ï¼š"><a href="#äº¤æµå­¦ä¹ ï¼š" class="headerlink" title="äº¤æµå­¦ä¹ ï¼š"></a>äº¤æµå­¦ä¹ ï¼š</h3><p>ğŸ§  Linux shell_é«˜çº§è¿ç»´æ´¾: <code>459096184</code>    åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)<br>ğŸ§  BigData-Exchange School : <code>521621407</code>  åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥</p><p>ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;https://cdn2.hubspot.net/hubfs/540072/Kafka_Connect_graphic.png&quot; alt=&quot;img-w650&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;Kafkaé›†ç¾¤ç¨³å®š&quot;&gt;&lt;a href=&quot;#Kafkaé›†ç¾¤ç¨³å®š&quot; class=&quot;headerlink&quot; title=&quot;Kafkaé›†ç¾¤ç¨³å®š&quot;&gt;&lt;/a&gt;Kafkaé›†ç¾¤ç¨³å®š&lt;/h3&gt;&lt;p&gt;GCè°ƒä¼˜&lt;br&gt;ã€€ã€€è°ƒGCæ˜¯é—¨æ‰‹è‰ºæ´»ï¼Œå¹¸äºJava 7å¼•è¿›äº†G1 åƒåœ¾å›æ”¶ï¼Œä½¿å¾—GCè°ƒä¼˜å˜çš„æ²¡é‚£ä¹ˆéš¾ã€‚G1ä¸»è¦æœ‰ä¸¤ä¸ªé…ç½®é€‰é¡¹æ¥è°ƒä¼˜ï¼šMaxGCPauseMillis å’Œ InitiatingHeapOccupancyPercentï¼Œå…·ä½“å‚æ•°è®¾ç½®å¯ä»¥å‚è€ƒGoogleï¼Œè¿™é‡Œä¸èµ˜è¿°ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€Kafka brokerèƒ½å¤Ÿæœ‰æ•ˆçš„åˆ©ç”¨å †å†…å­˜å’Œå¯¹è±¡å›æ”¶ï¼Œæ‰€ä»¥è¿™äº›å€¼å¯ä»¥è°ƒå°ç‚¹ã€‚å¯¹äº 64Gbå†…å­˜ï¼ŒKafkaè¿è¡Œå †å†…å­˜5Gbï¼ŒMaxGCPauseMillis å’Œ InitiatingHeapOccupancyPercent åˆ†åˆ«è®¾ç½®ä¸º 20æ¯«ç§’å’Œ 35ã€‚Kafkaçš„å¯åŠ¨è„šæœ¬ä½¿ç”¨çš„ä¸æ˜¯ G1å›æ”¶ï¼Œéœ€è¦åœ¨ç¯å¢ƒå˜é‡ä¸­åŠ å…¥ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Bigdata Hadoop" scheme="http://blog.yancy.cc/categories/Bigdata-Hadoop/"/>
    
    
      <category term="Kafka" scheme="http://blog.yancy.cc/tags/Kafka/"/>
    
      <category term="Hadoop" scheme="http://blog.yancy.cc/tags/Hadoop/"/>
    
  </entry>
  
  <entry>
    <title>Kafkaæ—¥å¿—å­˜å‚¨è§£æä¸å®è·µæ•°æ®å­˜å‚¨ä¼˜åŒ–</title>
    <link href="http://blog.yancy.cc/2017/06/30/Bigdata-hadoop/Kafka/Kafka%E6%97%A5%E5%BF%97%E5%AD%98%E5%82%A8%E8%A7%A3%E6%9E%90%E4%B8%8E%E5%AE%9E%E8%B7%B5%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E4%BC%98%E5%8C%96/"/>
    <id>http://blog.yancy.cc/2017/06/30/Bigdata-hadoop/Kafka/Kafkaæ—¥å¿—å­˜å‚¨è§£æä¸å®è·µæ•°æ®å­˜å‚¨ä¼˜åŒ–/</id>
    <published>2017-06-30T06:46:00.000Z</published>
    <updated>2017-09-23T16:20:13.000Z</updated>
    
    <content type="html"><![CDATA[<p><figure class="figure"><img src="https://cdn-images-1.medium.com/max/640/1*kV768OHeCILNIYVCNPUyuQ.jpeg" alt=""></figure></p><h4 id="Kafkaçš„åè¯è§£é‡Š"><a href="#Kafkaçš„åè¯è§£é‡Š" class="headerlink" title="Kafkaçš„åè¯è§£é‡Š"></a>Kafkaçš„åè¯è§£é‡Š</h4><p>kafkaæ˜¯ä¸€æ¬¾åˆ†å¸ƒå¼æ¶ˆæ¯å‘å¸ƒå’Œè®¢é˜…çš„ç³»ç»Ÿï¼Œå…·æœ‰é«˜æ€§èƒ½å’Œé«˜ååç‡ã€‚ </p><ul><li>1ï¼Œ<code>Broker</code>ï¼š ä¸€ä¸ªå•ç‹¬çš„kafkaæœºå™¨èŠ‚ç‚¹å°±ç§°ä¸ºä¸€ä¸ªbrokerï¼Œå¤šä¸ªbrokerç»„æˆçš„é›†ç¾¤ï¼Œç§°ä¸ºkafkaé›†ç¾¤</li><li>2ï¼Œ<code>Topic</code>ï¼šç±»ä¼¼æ•°æ®åº“ä¸­çš„ä¸€ä¸ªè¡¨ï¼Œæˆ‘ä»¬å°†æ•°æ®å­˜å‚¨åœ¨Topicé‡Œé¢ï¼Œå½“ç„¶è¿™åªæ˜¯é€»è¾‘ä¸Šçš„ï¼Œåœ¨ç‰©ç†ä¸Šï¼Œä¸€ä¸ªTopic å¯èƒ½è¢«å¤šä¸ªBrokeråˆ†åŒºå­˜å‚¨ï¼Œè¿™å¯¹ç”¨æˆ·æ˜¯é€æ˜çš„ï¼Œç”¨æˆ·åªéœ€å…³æ³¨æ¶ˆæ¯çš„äº§ç”Ÿäºæ¶ˆè´¹å³å¯.</li><li>3ï¼Œ<code>Partition</code>ï¼šç±»ä¼¼åˆ†åŒºè¡¨ï¼Œæ¯ä¸ªTopicå¯æ ¹æ®è®¾ç½®å°†æ•°æ®å­˜å‚¨åœ¨å¤šä¸ªæ•´ä½“æœ‰åºçš„Partitionä¸­ï¼Œæ¯ä¸ªé¡ºåºåŒ–partitionä¼šç”Ÿæˆ2ä¸ªæ–‡ä»¶ï¼Œä¸€ä¸ªæ˜¯indexæ–‡ä»¶ä¸€ä¸ªæ˜¯logæ–‡ä»¶ï¼Œindexæ–‡ä»¶å­˜å‚¨ç´¢å¼•å’Œåç§»é‡ï¼Œlogæ–‡ä»¶å­˜å‚¨å…·ä½“çš„æ•°æ®.</li><li>4ï¼Œ<code>Producer</code>ï¼šç”Ÿäº§è€…ï¼Œå‘Topicé‡Œé¢å‘é€æ¶ˆæ¯çš„è§’è‰² </li><li>5ï¼Œ<code>Consumer</code>ï¼šæ¶ˆè´¹è€…ï¼Œä»Topicé‡Œé¢è¯»å–æ¶ˆæ¯çš„è§’è‰² </li><li>6ï¼Œ<code>Consumer Group</code>ï¼šæ¯ä¸ªConsumerå±äºä¸€ä¸ªç‰¹å®šçš„æ¶ˆè´¹è€…ç»„ï¼Œå¯ä¸ºConsumeræŒ‡å®šgroup nameï¼Œå¦‚æœä¸æŒ‡å®šé»˜è®¤å±äºgroup </li></ul><a id="more"></a><p><strong>é›†ç¾¤å®‰è£…ç•¥è¿‡~</strong></p><h4 id="æ—¥å¿—å­˜å‚¨"><a href="#æ—¥å¿—å­˜å‚¨" class="headerlink" title="æ—¥å¿—å­˜å‚¨"></a>æ—¥å¿—å­˜å‚¨</h4><p>Kafkaçš„dataæ˜¯ä¿å­˜åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„ã€‚Kafkaä¸­çš„Messageæ˜¯ä»¥topicä¸ºåŸºæœ¬å•ä½ç»„ç»‡çš„ï¼Œä¸åŒçš„topicä¹‹é—´æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚</p><p>æ¯ä¸ªtopicåˆå¯ä»¥åˆ†æˆå‡ ä¸ªä¸åŒçš„partitionï¼Œæ¯ä¸ªtopicæœ‰å‡ ä¸ªpartitionæ˜¯åœ¨åˆ›å»ºtopicæ—¶æŒ‡å®šçš„ï¼Œæ¯ä¸ªpartitionå­˜å‚¨ä¸€éƒ¨åˆ†Messageã€‚</p><p><code>partition</code>æ˜¯ä»¥æ–‡ä»¶çš„å½¢å¼å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œæ¯”å¦‚ï¼Œåˆ›å»ºäº†ä¸€ä¸ªåä¸º<code>kakfa-node1</code>çš„topicï¼Œå…¶æœ‰12ä¸ªpartitionï¼Œé‚£ä¹ˆåœ¨Kafkaçš„æ•°æ®ç›®å½•ä¸­(ç”±é…ç½®æ–‡ä»¶ä¸­çš„log.dirsæŒ‡å®šçš„)ä¸­å°±æœ‰è¿™æ ·5ä¸ªç›®å½•: </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">[jollybi@kafka1 kafka-logs]$ ll</div><div class="line">drwxrwxr-x 2 jollybi jollybi  4096 Aug 23 15:56 kakfa-node1-0</div><div class="line">drwxrwxr-x 2 jollybi jollybi  4096 Aug 23 15:56 kakfa-node1-1</div><div class="line">drwxrwxr-x 2 jollybi jollybi  4096 Aug 23 15:56 kakfa-node1-10</div><div class="line">drwxrwxr-x 2 jollybi jollybi  4096 Aug 23 15:56 kakfa-node1-11</div><div class="line">drwxrwxr-x 2 jollybi jollybi  4096 Aug 23 15:56 kakfa-node1-2</div><div class="line">drwxrwxr-x 2 jollybi jollybi  4096 Aug 23 15:56 kakfa-node1-3</div><div class="line">drwxrwxr-x 2 jollybi jollybi  4096 Aug 23 15:56 kakfa-node1-4</div><div class="line">drwxrwxr-x 2 jollybi jollybi  4096 Aug 23 15:56 kakfa-node1-5</div><div class="line">drwxrwxr-x 2 jollybi jollybi  4096 Aug 23 15:56 kakfa-node1-6</div><div class="line">drwxrwxr-x 2 jollybi jollybi  4096 Aug 23 15:56 kakfa-node1-7</div><div class="line">drwxrwxr-x 2 jollybi jollybi  4096 Aug 23 15:56 kakfa-node1-8</div><div class="line">drwxrwxr-x 2 jollybi jollybi  4096 Aug 23 15:56 kakfa-node1-9</div></pre></td></tr></table></figure><p>å…¶å‘½åè§„åˆ™ä¸º<code>&lt;topic_name&gt;-&lt;partition_id&gt;</code>ï¼Œé‡Œé¢å­˜å‚¨çš„åˆ†åˆ«å°±æ˜¯è¿™12ä¸ª<code>partition</code>çš„æ•°æ®ã€‚<br><code>zookeeper</code>ä¼šå°†åˆ†åŒºå¹³å‡åˆ†é…åˆ›å»ºåˆ°ä¸åŒçš„<code>broker</code>ä¸Šï¼Œä¾‹å¦‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[jollybi@kafka1 tools]$ ./kafka_2.10-0.8.2.1/bin/kafka-topics.sh  --describe --zookeeper kafka1.jollychic.com:2281,kafka2.jollychic.com:2281,kafka3.jollychic.com:2281  --topic kakfa-node1</div><div class="line">Topic:kakfa-node1PartitionCount:12ReplicationFactor:3Configs:</div><div class="line">Topic: kakfa-node1Partition: 0Leader: 1Replicas: 1,2,3Isr: 1,2,3</div><div class="line">Topic: kakfa-node1Partition: 1Leader: 2Replicas: 2,3,1Isr: 2,3,1</div><div class="line">Topic: kakfa-node1Partition: 2Leader: 3Replicas: 3,1,2Isr: 3,1,2</div><div class="line">Topic: kakfa-node1Partition: 3Leader: 1Replicas: 1,3,2Isr: 1,3,2</div><div class="line">Topic: kakfa-node1Partition: 4Leader: 2Replicas: 2,1,3Isr: 2,1,3</div><div class="line">Topic: kakfa-node1Partition: 5Leader: 3Replicas: 3,2,1Isr: 3,2,1</div><div class="line">Topic: kakfa-node1Partition: 6Leader: 1Replicas: 1,2,3Isr: 1,2,3</div><div class="line">Topic: kakfa-node1Partition: 7Leader: 2Replicas: 2,3,1Isr: 2,3,1</div><div class="line">Topic: kakfa-node1Partition: 8Leader: 3Replicas: 3,1,2Isr: 3,1,2</div><div class="line">Topic: kakfa-node1Partition: 9Leader: 1Replicas: 1,3,2Isr: 1,3,2</div><div class="line">Topic: kakfa-node1Partition: 10Leader: 2Replicas: 2,1,3Isr: 2,1,3</div><div class="line">Topic: kakfa-node1Partition: 11Leader: 3Replicas: 3,2,1Isr: 3,2,1</div></pre></td></tr></table></figure><p>Isrè¡¨ç¤ºåˆ†åŒºåˆ›å»ºåœ¨å“ªä¸ªbrokerä¸Šã€‚<br>Partitionä¸­çš„æ¯æ¡Messageç”±offsetæ¥è¡¨ç¤ºå®ƒåœ¨è¿™ä¸ªpartitionä¸­çš„åç§»é‡ï¼Œè¿™ä¸ªoffsetä¸æ˜¯è¯¥Messageåœ¨partitionæ•°æ®æ–‡ä»¶ä¸­çš„å®é™…å­˜å‚¨ä½ç½®ï¼Œè€Œæ˜¯é€»è¾‘ä¸Šä¸€ä¸ªå€¼ï¼Œå®ƒå”¯ä¸€ç¡®å®šäº†partitionä¸­çš„ä¸€æ¡Messageã€‚å› æ­¤ï¼Œå¯ä»¥è®¤ä¸ºoffsetæ˜¯partitionä¸­Messageçš„idã€‚partitionä¸­çš„æ¯æ¡MessageåŒ…å«äº†ä»¥ä¸‹ä¸‰ä¸ªå±æ€§ï¼š</p><figure class="highlight haskell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="title">offset</span></div><div class="line"><span class="type">MessageSize</span></div><div class="line"><span class="class"><span class="keyword">data</span></span></div></pre></td></tr></table></figure><p>å…¶ä¸­offsetä¸ºlongå‹ï¼ŒMessageSizeä¸ºint32ï¼Œè¡¨ç¤ºdataæœ‰å¤šå¤§ï¼Œdataä¸ºmessageçš„å…·ä½“å†…å®¹ã€‚</p><h4 id="Kafkaé€šè¿‡åˆ†æ®µå’Œç´¢å¼•çš„æ–¹å¼æ¥æé«˜æŸ¥è¯¢æ•ˆç‡"><a href="#Kafkaé€šè¿‡åˆ†æ®µå’Œç´¢å¼•çš„æ–¹å¼æ¥æé«˜æŸ¥è¯¢æ•ˆç‡" class="headerlink" title="Kafkaé€šè¿‡åˆ†æ®µå’Œç´¢å¼•çš„æ–¹å¼æ¥æé«˜æŸ¥è¯¢æ•ˆç‡"></a>Kafkaé€šè¿‡åˆ†æ®µå’Œç´¢å¼•çš„æ–¹å¼æ¥æé«˜æŸ¥è¯¢æ•ˆç‡</h4><ul><li>1ï¼‰åˆ†æ®µ</li></ul><p>Kafkaè§£å†³æŸ¥è¯¢æ•ˆç‡çš„æ‰‹æ®µä¹‹ä¸€æ˜¯å°†æ•°æ®æ–‡ä»¶åˆ†æ®µï¼Œæ¯”å¦‚æœ‰100æ¡Messageï¼Œå®ƒä»¬çš„offsetæ˜¯ä»0åˆ°99ã€‚å‡è®¾å°†æ•°æ®æ–‡ä»¶åˆ†æˆ5æ®µï¼Œç¬¬ä¸€æ®µä¸º0-19ï¼Œç¬¬äºŒæ®µä¸º20-39ï¼Œä»¥æ­¤ç±»æ¨ï¼Œæ¯æ®µæ”¾åœ¨ä¸€ä¸ªå•ç‹¬çš„æ•°æ®æ–‡ä»¶é‡Œé¢ï¼Œæ•°æ®æ–‡ä»¶ä»¥è¯¥æ®µä¸­æœ€å°çš„offsetå‘½åã€‚è¿™æ ·åœ¨æŸ¥æ‰¾æŒ‡å®šoffsetçš„Messageçš„æ—¶å€™ï¼Œç”¨äºŒåˆ†æŸ¥æ‰¾å°±å¯ä»¥å®šä½åˆ°è¯¥Messageåœ¨å“ªä¸ªæ®µä¸­ã€‚</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[jollybi@kafka1 kafka-logs]$ ll /data/tools/kafka_2.10-0.8.2.1/kafka-logs/</div><div class="line">total 548</div><div class="line">drwxrwxr-x<span class="number"> 2 </span>jollybi jollybi <span class="number"> 4096 </span>Aug<span class="number"> 25 </span>11:03 kafkanode-0</div><div class="line">drwxrwxr-x<span class="number"> 2 </span>jollybi jollybi <span class="number"> 4096 </span>Aug<span class="number"> 25 </span>11:03 kafkanode-1</div><div class="line">drwxrwxr-x<span class="number"> 2 </span>jollybi jollybi <span class="number"> 4096 </span>Aug<span class="number"> 25 </span>11:03 kafkanode-10</div><div class="line">drwxrwxr-x<span class="number"> 2 </span>jollybi jollybi <span class="number"> 4096 </span>Aug<span class="number"> 25 </span>11:03 kafkanode-11</div><div class="line">drwxrwxr-x<span class="number"> 2 </span>jollybi jollybi <span class="number"> 4096 </span>Aug<span class="number"> 25 </span>11:03 kafkanode-2</div><div class="line">drwxrwxr-x<span class="number"> 2 </span>jollybi jollybi <span class="number"> 4096 </span>Aug<span class="number"> 25 </span>11:03 kafkanode-3</div><div class="line">drwxrwxr-x<span class="number"> 2 </span>jollybi jollybi <span class="number"> 4096 </span>Aug<span class="number"> 25 </span>11:03 kafkanode-4</div><div class="line">drwxrwxr-x<span class="number"> 2 </span>jollybi jollybi <span class="number"> 4096 </span>Aug<span class="number"> 25 </span>11:03 kafkanode-5</div><div class="line">drwxrwxr-x<span class="number"> 2 </span>jollybi jollybi <span class="number"> 4096 </span>Aug<span class="number"> 25 </span>11:03 kafkanode-6</div><div class="line">drwxrwxr-x<span class="number"> 2 </span>jollybi jollybi <span class="number"> 4096 </span>Aug<span class="number"> 25 </span>11:03 kafkanode-7</div><div class="line">drwxrwxr-x<span class="number"> 2 </span>jollybi jollybi <span class="number"> 4096 </span>Aug<span class="number"> 25 </span>11:03 kafkanode-8</div><div class="line">drwxrwxr-x<span class="number"> 2 </span>jollybi jollybi <span class="number"> 4096 </span>Aug<span class="number"> 25 </span>11:03 kafkanode-9</div></pre></td></tr></table></figure><h5 id="2ï¼‰ä¸ºæ•°æ®æ–‡ä»¶å»ºç´¢å¼•"><a href="#2ï¼‰ä¸ºæ•°æ®æ–‡ä»¶å»ºç´¢å¼•" class="headerlink" title="2ï¼‰ä¸ºæ•°æ®æ–‡ä»¶å»ºç´¢å¼•"></a>2ï¼‰ä¸ºæ•°æ®æ–‡ä»¶å»ºç´¢å¼•</h5><p>æ•°æ®æ–‡ä»¶åˆ†æ®µä½¿å¾—å¯ä»¥åœ¨ä¸€ä¸ªè¾ƒå°çš„æ•°æ®æ–‡ä»¶ä¸­æŸ¥æ‰¾å¯¹åº”offsetçš„Messageäº†ï¼Œä½†æ˜¯è¿™ä¾ç„¶éœ€è¦é¡ºåºæ‰«ææ‰èƒ½æ‰¾åˆ°å¯¹åº”<code>offsetçš„Message</code>ã€‚ä¸ºäº†è¿›ä¸€æ­¥æé«˜æŸ¥æ‰¾çš„æ•ˆç‡ï¼ŒKafkaä¸ºæ¯ä¸ªåˆ†æ®µåçš„æ•°æ®æ–‡ä»¶å»ºç«‹äº†ç´¢å¼•æ–‡ä»¶ï¼Œæ–‡ä»¶åä¸æ•°æ®æ–‡ä»¶çš„åå­—æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯æ–‡ä»¶æ‰©å±•åä¸º.indexã€‚<br>ç´¢å¼•æ–‡ä»¶ä¸­åŒ…å«è‹¥å¹²ä¸ªç´¢å¼•æ¡ç›®ï¼Œæ¯ä¸ªæ¡ç›®è¡¨ç¤ºæ•°æ®æ–‡ä»¶ä¸­ä¸€æ¡Messageçš„ç´¢å¼•ã€‚ç´¢å¼•åŒ…å«ä¸¤ä¸ªéƒ¨åˆ†ï¼ˆå‡ä¸º4ä¸ªå­—èŠ‚çš„æ•°å­—ï¼‰ï¼Œåˆ†åˆ«ä¸ºç›¸å¯¹<code>offsetå’Œposition</code>ã€‚</p><p>ç›¸å¯¹<code>offset</code>ï¼šå› ä¸ºæ•°æ®æ–‡ä»¶åˆ†æ®µä»¥åï¼Œæ¯ä¸ªæ•°æ®æ–‡ä»¶çš„èµ·å§‹offsetä¸ä¸º0ï¼Œç›¸å¯¹offsetè¡¨ç¤ºè¿™æ¡Messageç›¸å¯¹äºå…¶æ‰€å±æ•°æ®æ–‡ä»¶ä¸­æœ€å°çš„offsetçš„å¤§å°ã€‚ä¸¾ä¾‹ï¼Œåˆ†æ®µåçš„ä¸€ä¸ªæ•°æ®æ–‡ä»¶çš„offsetæ˜¯ä»20å¼€å§‹ï¼Œé‚£ä¹ˆoffsetä¸º25çš„Messageåœ¨indexæ–‡ä»¶ä¸­çš„ç›¸å¯¹offsetå°±æ˜¯25-20 = 5ã€‚å­˜å‚¨ç›¸å¯¹offsetå¯ä»¥å‡å°ç´¢å¼•æ–‡ä»¶å ç”¨çš„ç©ºé—´ã€‚</p><p><code>position</code>ï¼Œè¡¨ç¤ºè¯¥æ¡<code>Message</code>åœ¨æ•°æ®æ–‡ä»¶ä¸­çš„ç»å¯¹ä½ç½®ã€‚åªè¦æ‰“å¼€æ–‡ä»¶å¹¶ç§»åŠ¨æ–‡ä»¶æŒ‡é’ˆåˆ°è¿™ä¸ªpositionå°±å¯ä»¥è¯»å–å¯¹åº”çš„<code>Message</code>äº†ã€‚<br>indexæ–‡ä»¶ä¸­å¹¶æ²¡æœ‰ä¸ºæ•°æ®æ–‡ä»¶ä¸­çš„æ¯æ¡Messageå»ºç«‹ç´¢å¼•ï¼Œè€Œæ˜¯é‡‡ç”¨äº†ç¨€ç–å­˜å‚¨çš„æ–¹å¼ï¼Œæ¯éš”ä¸€å®šå­—èŠ‚çš„æ•°æ®å»ºç«‹ä¸€æ¡ç´¢å¼•ã€‚è¿™æ ·é¿å…äº†ç´¢å¼•æ–‡ä»¶å ç”¨è¿‡å¤šçš„ç©ºé—´ï¼Œä»è€Œå¯ä»¥å°†ç´¢å¼•æ–‡ä»¶ä¿ç•™åœ¨å†…å­˜ä¸­ã€‚ä½†ç¼ºç‚¹æ˜¯æ²¡æœ‰å»ºç«‹ç´¢å¼•çš„Messageä¹Ÿä¸èƒ½ä¸€æ¬¡å®šä½åˆ°å…¶åœ¨æ•°æ®æ–‡ä»¶çš„ä½ç½®ï¼Œä»è€Œéœ€è¦åšä¸€æ¬¡é¡ºåºæ‰«æï¼Œä½†æ˜¯è¿™æ¬¡é¡ºåºæ‰«æçš„èŒƒå›´å°±å¾ˆå°äº†ã€‚</p><h3 id="äº¤æµå­¦ä¹ ï¼š"><a href="#äº¤æµå­¦ä¹ ï¼š" class="headerlink" title="äº¤æµå­¦ä¹ ï¼š"></a>äº¤æµå­¦ä¹ ï¼š</h3><p>ğŸ§  Linux shell_é«˜çº§è¿ç»´æ´¾: <code>459096184</code>    åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)<br>ğŸ§  BigData-Exchange School : <code>521621407</code>  åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥</p><p>ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;https://cdn-images-1.medium.com/max/640/1*kV768OHeCILNIYVCNPUyuQ.jpeg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h4 id=&quot;Kafkaçš„åè¯è§£é‡Š&quot;&gt;&lt;a href=&quot;#Kafkaçš„åè¯è§£é‡Š&quot; class=&quot;headerlink&quot; title=&quot;Kafkaçš„åè¯è§£é‡Š&quot;&gt;&lt;/a&gt;Kafkaçš„åè¯è§£é‡Š&lt;/h4&gt;&lt;p&gt;kafkaæ˜¯ä¸€æ¬¾åˆ†å¸ƒå¼æ¶ˆæ¯å‘å¸ƒå’Œè®¢é˜…çš„ç³»ç»Ÿï¼Œå…·æœ‰é«˜æ€§èƒ½å’Œé«˜ååç‡ã€‚ &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;1ï¼Œ&lt;code&gt;Broker&lt;/code&gt;ï¼š ä¸€ä¸ªå•ç‹¬çš„kafkaæœºå™¨èŠ‚ç‚¹å°±ç§°ä¸ºä¸€ä¸ªbrokerï¼Œå¤šä¸ªbrokerç»„æˆçš„é›†ç¾¤ï¼Œç§°ä¸ºkafkaé›†ç¾¤&lt;/li&gt;
&lt;li&gt;2ï¼Œ&lt;code&gt;Topic&lt;/code&gt;ï¼šç±»ä¼¼æ•°æ®åº“ä¸­çš„ä¸€ä¸ªè¡¨ï¼Œæˆ‘ä»¬å°†æ•°æ®å­˜å‚¨åœ¨Topicé‡Œé¢ï¼Œå½“ç„¶è¿™åªæ˜¯é€»è¾‘ä¸Šçš„ï¼Œåœ¨ç‰©ç†ä¸Šï¼Œä¸€ä¸ªTopic å¯èƒ½è¢«å¤šä¸ªBrokeråˆ†åŒºå­˜å‚¨ï¼Œè¿™å¯¹ç”¨æˆ·æ˜¯é€æ˜çš„ï¼Œç”¨æˆ·åªéœ€å…³æ³¨æ¶ˆæ¯çš„äº§ç”Ÿäºæ¶ˆè´¹å³å¯.&lt;/li&gt;
&lt;li&gt;3ï¼Œ&lt;code&gt;Partition&lt;/code&gt;ï¼šç±»ä¼¼åˆ†åŒºè¡¨ï¼Œæ¯ä¸ªTopicå¯æ ¹æ®è®¾ç½®å°†æ•°æ®å­˜å‚¨åœ¨å¤šä¸ªæ•´ä½“æœ‰åºçš„Partitionä¸­ï¼Œæ¯ä¸ªé¡ºåºåŒ–partitionä¼šç”Ÿæˆ2ä¸ªæ–‡ä»¶ï¼Œä¸€ä¸ªæ˜¯indexæ–‡ä»¶ä¸€ä¸ªæ˜¯logæ–‡ä»¶ï¼Œindexæ–‡ä»¶å­˜å‚¨ç´¢å¼•å’Œåç§»é‡ï¼Œlogæ–‡ä»¶å­˜å‚¨å…·ä½“çš„æ•°æ®.&lt;/li&gt;
&lt;li&gt;4ï¼Œ&lt;code&gt;Producer&lt;/code&gt;ï¼šç”Ÿäº§è€…ï¼Œå‘Topicé‡Œé¢å‘é€æ¶ˆæ¯çš„è§’è‰² &lt;/li&gt;
&lt;li&gt;5ï¼Œ&lt;code&gt;Consumer&lt;/code&gt;ï¼šæ¶ˆè´¹è€…ï¼Œä»Topicé‡Œé¢è¯»å–æ¶ˆæ¯çš„è§’è‰² &lt;/li&gt;
&lt;li&gt;6ï¼Œ&lt;code&gt;Consumer Group&lt;/code&gt;ï¼šæ¯ä¸ªConsumerå±äºä¸€ä¸ªç‰¹å®šçš„æ¶ˆè´¹è€…ç»„ï¼Œå¯ä¸ºConsumeræŒ‡å®šgroup nameï¼Œå¦‚æœä¸æŒ‡å®šé»˜è®¤å±äºgroup &lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="Bigdata Hadoop" scheme="http://blog.yancy.cc/categories/Bigdata-Hadoop/"/>
    
    
      <category term="Kafka" scheme="http://blog.yancy.cc/tags/Kafka/"/>
    
  </entry>
  
  <entry>
    <title>Bigdata-å¦‚ä½•æ‰‹åŠ¨æ›´æ–°Kafkaä¸­æŸä¸ªTopicçš„åç§»é‡</title>
    <link href="http://blog.yancy.cc/2017/06/29/Bigdata-hadoop/Kafka/%E5%A6%82%E4%BD%95%E6%89%8B%E5%8A%A8%E6%9B%B4%E6%96%B0Kafka%E4%B8%AD%E6%9F%90%E4%B8%AATopic%E7%9A%84%E5%81%8F%E7%A7%BB%E9%87%8F/"/>
    <id>http://blog.yancy.cc/2017/06/29/Bigdata-hadoop/Kafka/å¦‚ä½•æ‰‹åŠ¨æ›´æ–°Kafkaä¸­æŸä¸ªTopicçš„åç§»é‡/</id>
    <published>2017-06-29T06:46:00.000Z</published>
    <updated>2017-09-23T16:20:29.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å¦‚ä½•æ‰‹åŠ¨æ›´æ–°Kafkaä¸­æŸä¸ªTopicçš„åç§»é‡"><a href="#å¦‚ä½•æ‰‹åŠ¨æ›´æ–°Kafkaä¸­æŸä¸ªTopicçš„åç§»é‡" class="headerlink" title="å¦‚ä½•æ‰‹åŠ¨æ›´æ–°Kafkaä¸­æŸä¸ªTopicçš„åç§»é‡"></a>å¦‚ä½•æ‰‹åŠ¨æ›´æ–°Kafkaä¸­æŸä¸ªTopicçš„åç§»é‡</h3><p><figure class="figure"><img src="http://danlebrero.com/images/kafka-streams-poc-old-solution.jpg" alt=""></figure></p><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒKafka topicçš„åç§»é‡ä¸€èˆ¬éƒ½æ˜¯å­˜å‚¨åœ¨Zookeeperä¸­ï¼Œå…·ä½“çš„è·¯å¾„ä¸º<code>/consumers/[groupId]/offsets/[topic]/[partitionId]</code>ï¼Œæ¯”å¦‚iteblogä¸»é¢˜åˆ†åŒº10çš„åç§»é‡è·å–å¦‚ä¸‹ï¼š<br>åœ¨æœ‰äº›åœºæ™¯ä¸‹ï¼Œè¿™ä¸ªå·¥å…·ä¸æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯èƒ½å¤Ÿæ‰‹åŠ¨è®¾ç½®åˆ†åŒºçš„åç§»é‡ä¸ºä»»ä½•æœ‰æ„ä¹‰çš„å€¼ï¼Œè€Œä¸ä»…ä»…æ˜¯earliestæˆ–è€…latestã€‚é‚£å’‹åŠï¼Ÿ</p><a id="more"></a><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒKafka topicçš„åç§»é‡ä¸€èˆ¬éƒ½æ˜¯å­˜å‚¨åœ¨Zookeeperä¸­ï¼Œå…·ä½“çš„è·¯å¾„ä¸º<code>/consumers/[groupId]/offsets/[topic]/[partitionId]</code>ï¼Œæ¯”å¦‚<code>mongotail_lz4</code>ä¸»é¢˜åˆ†åŒº10çš„åç§»é‡è·å–å¦‚ä¸‹ï¼š<br>ã€€ã€€<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">[zk: 127.0.0.1:2281(CONNECTED) 2]  get /consumers/ibm_event/offsets/mongotail_lz4/10</div><div class="line">293894</div><div class="line">cZxid = 0x6000011f3</div><div class="line">ctime = Wed Jul 26 17:57:27 CST 2017</div><div class="line">mZxid = 0x6000018c9</div><div class="line">mtime = Wed Jul 26 18:18:27 CST 2017</div><div class="line">pZxid = 0x6000011f3</div><div class="line">cversion = 0</div><div class="line">dataVersion = 20</div><div class="line">aclVersion = 0</div><div class="line">ephemeralOwner = 0x0</div><div class="line">dataLength = 6</div><div class="line">numChildren = 0</div></pre></td></tr></table></figure></p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡setå‘½ä»¤æ¥è®¾ç½®æŸä¸ªåˆ†åŒºçš„åç§»é‡ï¼Œå¦‚ä¸‹ï¼›</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">[zk: 127.0.0.1:2281(CONNECT get /consumers/ibm_event/offsets/mongotail_lz4/10 0 </div><div class="line">0</div><div class="line">cZxid = 0x6000011f3</div><div class="line">ctime = Wed Jul 26 17:57:27 CST 2017</div><div class="line">mZxid = 0x60000204c</div><div class="line">mtime = Wed Jul 26 18:37:21 CST 2017</div><div class="line">pZxid = 0x6000011f3</div><div class="line">cversion = 0</div><div class="line">dataVersion = 21</div><div class="line">aclVersion = 0</div><div class="line">ephemeralOwner = 0x0</div><div class="line">dataLength = 1</div><div class="line">numChildren = 0</div></pre></td></tr></table></figure><p>12ä¸ªåˆ†åŒºåˆ†åˆ«æ›´æ–°è¿‡å»ã€‚</p><h3 id="äº¤æµå­¦ä¹ ï¼š"><a href="#äº¤æµå­¦ä¹ ï¼š" class="headerlink" title="äº¤æµå­¦ä¹ ï¼š"></a>äº¤æµå­¦ä¹ ï¼š</h3><p>ğŸ§  Linux shell_é«˜çº§è¿ç»´æ´¾: <code>459096184</code>    åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)<br>ğŸ§  BigData-Exchange School : <code>521621407</code>  åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥</p><p>ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;å¦‚ä½•æ‰‹åŠ¨æ›´æ–°Kafkaä¸­æŸä¸ªTopicçš„åç§»é‡&quot;&gt;&lt;a href=&quot;#å¦‚ä½•æ‰‹åŠ¨æ›´æ–°Kafkaä¸­æŸä¸ªTopicçš„åç§»é‡&quot; class=&quot;headerlink&quot; title=&quot;å¦‚ä½•æ‰‹åŠ¨æ›´æ–°Kafkaä¸­æŸä¸ªTopicçš„åç§»é‡&quot;&gt;&lt;/a&gt;å¦‚ä½•æ‰‹åŠ¨æ›´æ–°Kafkaä¸­æŸä¸ªTopicçš„åç§»é‡&lt;/h3&gt;&lt;p&gt;&lt;img src=&quot;http://danlebrero.com/images/kafka-streams-poc-old-solution.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒKafka topicçš„åç§»é‡ä¸€èˆ¬éƒ½æ˜¯å­˜å‚¨åœ¨Zookeeperä¸­ï¼Œå…·ä½“çš„è·¯å¾„ä¸º&lt;code&gt;/consumers/[groupId]/offsets/[topic]/[partitionId]&lt;/code&gt;ï¼Œæ¯”å¦‚iteblogä¸»é¢˜åˆ†åŒº10çš„åç§»é‡è·å–å¦‚ä¸‹ï¼š&lt;br&gt;åœ¨æœ‰äº›åœºæ™¯ä¸‹ï¼Œè¿™ä¸ªå·¥å…·ä¸æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯èƒ½å¤Ÿæ‰‹åŠ¨è®¾ç½®åˆ†åŒºçš„åç§»é‡ä¸ºä»»ä½•æœ‰æ„ä¹‰çš„å€¼ï¼Œè€Œä¸ä»…ä»…æ˜¯earliestæˆ–è€…latestã€‚é‚£å’‹åŠï¼Ÿ&lt;/p&gt;
    
    </summary>
    
      <category term="å¤§æ•°æ®" scheme="http://blog.yancy.cc/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
    
      <category term="Kafka" scheme="http://blog.yancy.cc/tags/Kafka/"/>
    
      <category term="Bigdata Hadoop" scheme="http://blog.yancy.cc/tags/Bigdata-Hadoop/"/>
    
  </entry>
  
  <entry>
    <title>Bigdata-Kafka-nodeæ¨¡å—å®ç°è°ƒç”¨jså‘é€æ•°æ®</title>
    <link href="http://blog.yancy.cc/2017/06/29/Bigdata-hadoop/Kafka/Kafka-node%E6%A8%A1%E5%9D%97%E5%AE%9E%E7%8E%B0%E8%B0%83%E7%94%A8js%E5%8F%91%E9%80%81%E6%95%B0%E6%8D%AE/"/>
    <id>http://blog.yancy.cc/2017/06/29/Bigdata-hadoop/Kafka/Kafka-nodeæ¨¡å—å®ç°è°ƒç”¨jså‘é€æ•°æ®/</id>
    <published>2017-06-29T06:46:00.000Z</published>
    <updated>2017-09-23T16:20:18.000Z</updated>
    
    <content type="html"><![CDATA[<p><figure class="figure"><img src="https://kafka.apache.org/0110/images/streams-interactive-queries-02.png" alt=""></figure></p><p>mongodbå†™åˆ°kafka æŒ‡å®štopicæ¶ˆè´¹ã€‚ä¸ºäº†ä¿è¯æ•°æ®ç¨³å®šå¯é æ€§ã€‚<br>é…åˆå¤§æ•°æ®åœ¨countly ä½¿ç”¨å¼€æº<code>Kafka-node</code>æ˜¯ä¸€ä¸ªNode.jså®¢æˆ·ç«¯ å†™jsç¨‹åºè®©countlyä¸‰å°é›†ç¾¤åˆ†åˆ«æ•°æ®åˆ°kafka åšæ–°çš„topicä¸»é¢˜å¤‡ä»½ã€‚</p><a id="more"></a><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install kafka-node</div></pre></td></tr></table></figure><p>è¿›å…¥kafka-nodeç›®å½•: vim kafka_test.js</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">var kafka = require(<span class="string">'kafka-node'</span>),</div><div class="line">HighLevelProducer = kafka.HighLevelProducer,</div><div class="line">    //Producer = kafka.Producer,</div><div class="line">    client = new kafka.Client(<span class="string">'169.44.62.139:2281,169.44.59.138:2281,169.44.62.137:2281'</span>),</div><div class="line">    //producer = new Producer(client);</div><div class="line">producer = new HighLevelProducer(client);</div><div class="line"></div><div class="line">console.log(<span class="string">'è¿æ¥kafkaä¸­'</span>);</div><div class="line"></div><div class="line">var argv = &#123;</div><div class="line">    topic: <span class="string">"test1"</span></div><div class="line">&#125;;</div><div class="line">var topic = argv.topic || <span class="string">'test1'</span>;</div><div class="line">var p = argv.p || 0;</div><div class="line">var a = argv.a || 0;</div><div class="line">var producer = new HighLevelProducer(client, &#123;</div><div class="line">    requireAcks: 1,</div><div class="line">    partitionerType: 3</div><div class="line">&#125;);</div><div class="line"></div><div class="line">console.log(producer);</div><div class="line"></div><div class="line">producer.on(<span class="string">'ready'</span>, <span class="function"><span class="title">function</span></span>() &#123;</div><div class="line">    var args = &#123;</div><div class="line">        appid: <span class="string">'222-wx238c28839a133d0e'</span>,</div><div class="line">        createTime: <span class="string">'222-ddd'</span>,</div><div class="line">        toUserName: <span class="string">'222-wx238c28839a133d0e'</span>,</div><div class="line">        fromUserName: <span class="string">'222-wx238c28839a133d0e'</span></div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    producer.send([&#123;</div><div class="line">        topic: topic,</div><div class="line">        partition: p,</div><div class="line">        messages: [JSON.stringify(args)],</div><div class="line">        attributes: a</div><div class="line">    &#125;], <span class="keyword">function</span>(err, result) &#123;</div><div class="line">        console.log(err || result);</div><div class="line">        process.exit();</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    console.log(args);</div><div class="line">&#125;);</div></pre></td></tr></table></figure><h4 id="å®˜ç½‘åœ°å€ï¼šhttps-www-npmjs-com-package-kafka-node-install-kafka"><a href="#å®˜ç½‘åœ°å€ï¼šhttps-www-npmjs-com-package-kafka-node-install-kafka" class="headerlink" title="å®˜ç½‘åœ°å€ï¼šhttps://www.npmjs.com/package/kafka-node#install-kafka"></a>å®˜ç½‘åœ°å€ï¼š<a href="https://www.npmjs.com/package/kafka-node#install-kafka" target="_blank" rel="external">https://www.npmjs.com/package/kafka-node#install-kafka</a></h4><h3 id="äº¤æµå­¦ä¹ ï¼š"><a href="#äº¤æµå­¦ä¹ ï¼š" class="headerlink" title="äº¤æµå­¦ä¹ ï¼š"></a>äº¤æµå­¦ä¹ ï¼š</h3><p>ğŸ§  Linux shell_é«˜çº§è¿ç»´æ´¾: <code>459096184</code>    åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)<br>ğŸ§  BigData-Exchange School : <code>521621407</code>  åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥</p><p>ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;https://kafka.apache.org/0110/images/streams-interactive-queries-02.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;mongodbå†™åˆ°kafka æŒ‡å®štopicæ¶ˆè´¹ã€‚ä¸ºäº†ä¿è¯æ•°æ®ç¨³å®šå¯é æ€§ã€‚&lt;br&gt;é…åˆå¤§æ•°æ®åœ¨countly ä½¿ç”¨å¼€æº&lt;code&gt;Kafka-node&lt;/code&gt;æ˜¯ä¸€ä¸ªNode.jså®¢æˆ·ç«¯ å†™jsç¨‹åºè®©countlyä¸‰å°é›†ç¾¤åˆ†åˆ«æ•°æ®åˆ°kafka åšæ–°çš„topicä¸»é¢˜å¤‡ä»½ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="å¤§æ•°æ®" scheme="http://blog.yancy.cc/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
    
      <category term="Kafka" scheme="http://blog.yancy.cc/tags/Kafka/"/>
    
      <category term="Bigdata Hadoop" scheme="http://blog.yancy.cc/tags/Bigdata-Hadoop/"/>
    
  </entry>
  
  <entry>
    <title>Bigdata-å¼€æºçš„Kafkaé›†ç¾¤ç®¡ç†å™¨(Kafka Manager)</title>
    <link href="http://blog.yancy.cc/2017/06/28/Bigdata-hadoop/Kafka/%E5%BC%80%E6%BA%90%E7%9A%84Kafka%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E5%99%A8(Kafka%20Manager)/"/>
    <id>http://blog.yancy.cc/2017/06/28/Bigdata-hadoop/Kafka/å¼€æºçš„Kafkaé›†ç¾¤ç®¡ç†å™¨(Kafka Manager)/</id>
    <published>2017-06-28T06:46:00.000Z</published>
    <updated>2017-09-23T16:20:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Kafka-Manager"><a href="#Kafka-Manager" class="headerlink" title="Kafka Manager"></a>Kafka Manager</h2><p>A tool for managing <a href="http://kafka.apache.org/" target="_blank" rel="external">Apache Kafka.</a></p><h4 id="It-supports-the-following"><a href="#It-supports-the-following" class="headerlink" title="It supports the following:"></a>It supports the following:</h4><ul><li>ç®¡ç†å¤šä¸ªç¾¤é›†</li><li>å®¹æ˜“æ£€æŸ¥é›†ç¾¤çŠ¶æ€ï¼ˆä¸»é¢˜ï¼Œæ¶ˆè´¹è€…ï¼Œåç§»é‡ï¼Œç»çºªäººï¼Œå‰¯æœ¬åˆ†å‘ï¼Œåˆ†åŒºåˆ†é…ï¼‰</li><li>è¿è¡Œé¦–é€‰å‰¯æœ¬é€‰ä¸¾</li><li>ä½¿ç”¨é€‰é¡¹ç”Ÿæˆåˆ†åŒºåˆ†é…ï¼Œä»¥é€‰æ‹©è¦ä½¿ç”¨çš„ä»£ç†</li><li>è¿è¡Œåˆ†åŒºçš„é‡æ–°åˆ†é…ï¼ˆåŸºäºç”Ÿæˆçš„åˆ†é…ï¼‰</li><li>åˆ›å»ºå¯é€‰ä¸»é¢˜é…ç½®çš„ä¸»é¢˜ï¼ˆ0.8.1.1å…·æœ‰ä¸åŒäº0.8.2+çš„é…ç½®ï¼‰</li><li>åˆ é™¤ä¸»é¢˜ï¼ˆä»…æ”¯æŒ0.8.2+ï¼Œå¹¶è®°ä½åœ¨ä»£ç†é… ç½®ä¸­è®¾ç½®delete.topic.enable = trueï¼‰</li><li>ä¸»é¢˜åˆ—è¡¨ç°åœ¨è¡¨ç¤ºæ ‡è®°ä¸ºåˆ é™¤çš„ä¸»é¢˜ï¼ˆä»…æ”¯æŒ0.8.2+ï¼‰</li><li>æ‰¹é‡ç”Ÿæˆå¤šä¸ªä¸»é¢˜çš„åˆ†åŒºåˆ†é…ï¼Œå¹¶é€‰æ‹©è¦ä½¿ç”¨çš„ä»£ç†</li><li>æ‰¹é‡è¿è¡Œå¤šä¸ªä¸»é¢˜çš„åˆ†åŒºé‡æ–°åˆ†é…</li><li>å°†åˆ†åŒºæ·»åŠ åˆ°ç°æœ‰ä¸»é¢˜</li><li>æ›´æ–°ç°æœ‰ä¸»é¢˜çš„é…ç½®</li><li>å¯é€‰åœ°ï¼Œå¯ç”¨JMXè½®è¯¢ä»£ç†çº§å’Œä¸»é¢˜çº§åº¦é‡ã€‚</li><li>å¯é€‰åœ°ç­›é€‰å‡ºåœ¨zookeeperä¸­æ²¡æœ‰ids / owner /ï¼†offset /ç›®å½•çš„æ¶ˆè´¹è€…ã€‚</li></ul><p>å‚è€ƒå¼€æºåœ°å€ï¼š<a href="https://github.com/yahoo/kafka-manager" target="_blank" rel="external">https://github.com/yahoo/kafka-manager</a></p><h4 id="Requirements"><a href="#Requirements" class="headerlink" title="Requirements"></a>Requirements</h4><p>Kafka 0.8.1.1 or 0.8.2.<em> or 0.9.0.</em> or 0.10.0.*<br>Java 8+</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">sudo wget --header <span class="string">"Cookie: oraclelicense=accept-securebackup-cookieâ€   http://download.oracle.com/otn-pub/java/jdk/8u144-b01/090f390dda5b47b9b721c7dfaa008135/jdk-8u144-linux-x64.tar.gz</span></div><div class="line"></div><div class="line">sudo vim /etc/profile</div><div class="line">export JAVA_HOME=/home/jollybi/tools/jdk1.8.0_144</div><div class="line">export LASSPATH=.:<span class="variable">$JAVA_HOME</span>/lib/tools.jar:<span class="variable">$JAVA_HOME</span>/lib/dt.jar:<span class="variable">$JAVA_HOME</span>/lib:<span class="variable">$JAVA_HOME</span>/jre/lib:<span class="variable">$JAVA_HOME</span>/bin</div><div class="line">export PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$JAVA_HOME</span>/jre/bin:<span class="variable">$TOMCAT_HOME</span>/bin:<span class="variable">$PATH</span></div></pre></td></tr></table></figure><h4 id="Deployment"><a href="#Deployment" class="headerlink" title="Deployment"></a>Deployment</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">git <span class="built_in">clone</span> https://github.com/yahoo/kafka-manager.git</div><div class="line">./sbt clean dist</div><div class="line"></div><div class="line">[info]   Compilation completed <span class="keyword">in</span> 13.366 s</div><div class="line">model contains 672 documentable templates</div><div class="line">[info] Main Scala API documentation successful.</div><div class="line">[info] Packaging /home/jollybi/kafka-manager/target/scala-2.11/kafka-manager_2.11-1.3.3.8-javadoc.jar ...</div><div class="line">[info] Done packaging.</div><div class="line">[info] Packaging /home/jollybi/kafka-manager/target/scala-2.11/kafka-manager_2.11-1.3.3.8.jar ...</div><div class="line">[info] Done packaging.</div><div class="line">[info] Packaging /home/jollybi/kafka-manager/target/scala-2.11/kafka-manager_2.11-1.3.3.8-sans-externalized.jar ...</div><div class="line">[info] Done packaging.</div><div class="line">[info]</div><div class="line">[info] Your package is ready <span class="keyword">in</span> /home/jollybi/kafka-manager/target/universal/kafka-manager-1.3.3.8.zip</div><div class="line">[info]</div><div class="line">[success] Total time: 142 s, completed Jul 27, 2017 3:48:35 PM</div><div class="line">å®Œæˆ</div></pre></td></tr></table></figure><h4 id="Starting-the-service"><a href="#Starting-the-service" class="headerlink" title="Starting the service"></a>Starting the service</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">è§£å‹ç¼©ç”Ÿæˆçš„zipæ–‡ä»¶åï¼Œå°†å·¥ä½œç›®å½•æ›´æ”¹ä¸ºå¯ä»¥è¿è¡Œçš„æœåŠ¡ï¼š</div><div class="line"></div><div class="line">unzip /home/jollybi/kafka-manager/target/universal/kafka-manager-1.3.3.8.zip</div><div class="line"></div><div class="line"></div><div class="line">ä¿®æ”¹zkåœ°å€å’Œç®¡ç†å‘˜è´¦å·å’Œå¯†ç ï¼š</div><div class="line"></div><div class="line">vim kafka-manager-1.3.3.8/conf/application.conf</div><div class="line"></div><div class="line"><span class="comment">#kafka-manager.zkhosts="kafka-manager-zookeeper:2181"</span></div><div class="line"><span class="comment">#zké›†ç¾¤å¯ä»¥è¿™ä¹ˆé…ç½®ï¼š</span></div><div class="line">kafka-manager.zkhosts=<span class="string">"kafka1.jollychic.com:2281,kafka2.jollychic.com:2281,kafka3.jollychic.com:2281"</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#æ ¹æ®ä¸ªäººå…¬å¸è¿™é‡Œå¯ä»¥å¼€å¯true è®¾ç½®è´¦å·å’Œå¯†ç </span></div><div class="line">basicAuthentication.enabled=<span class="literal">true</span></div><div class="line">basicAuthentication.username=<span class="string">"admin"</span></div><div class="line">basicAuthentication.password=<span class="string">"admin"</span></div><div class="line"></div><div class="line"></div><div class="line">é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒå°†é€‰æ‹©ç«¯å£9000.è¿™æ˜¯å¯ä»¥è¦†ç›–çš„ï¼Œé…ç½®æ–‡ä»¶çš„ä½ç½®ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ä¾‹å¦‚ï¼š</div><div class="line"></div><div class="line">$ ./bin/kafka-manager -Dconfig.file=conf/application.conf -Dhttp.port=8080</div><div class="line"></div><div class="line">åå°ç”Ÿæ•ˆï¼š</div><div class="line"></div><div class="line">$ ./bin/kafka-manager -Dconfig.file=conf/application.conf -Dhttp.port=8080 &amp;</div><div class="line"></div><div class="line">å†æ¬¡ï¼Œå¦‚æœjavaä¸åœ¨æ‚¨çš„è·¯å¾„ä¸­ï¼Œæˆ–è€…æ‚¨éœ€è¦é’ˆå¯¹ä¸åŒç‰ˆæœ¬çš„Javaè¿è¡Œï¼Œè¯·æŒ‰å¦‚ä¸‹æ‰€ç¤ºæ·»åŠ -java-homeé€‰é¡¹ï¼š</div><div class="line"></div><div class="line">$ bin/kafka-manager -java-home /usr/<span class="built_in">local</span>/oracle-java-8</div></pre></td></tr></table></figure><h4 id="Packaging"><a href="#Packaging" class="headerlink" title="Packaging"></a>Packaging</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">If you<span class="string">'d like to create a Debian or RPM package instead, you can run one of:</span></div><div class="line"></div><div class="line">sbt debian:packageBin</div><div class="line"></div><div class="line">sbt rpm:packageBin</div></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹ç«¯å£ï¼š"><a href="#æŸ¥çœ‹ç«¯å£ï¼š" class="headerlink" title="æŸ¥çœ‹ç«¯å£ï¼š"></a>æŸ¥çœ‹ç«¯å£ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">[jollybi@kafka1 conf]$ netstat -ntulp | grep 8080</div><div class="line">(Not all processes could be identified, non-owned process info</div><div class="line"> will not be shown, you would have to be root to see it all.)</div><div class="line">tcp6       0      0 :::8080                 :::*                    LISTEN      70517/java</div></pre></td></tr></table></figure><h3 id="ç½‘ç«™è®¿é—®kafka-Manger"><a href="#ç½‘ç«™è®¿é—®kafka-Manger" class="headerlink" title="ç½‘ç«™è®¿é—®kafka Manger"></a>ç½‘ç«™è®¿é—®kafka Manger</h3><p>è¿™é‡Œæˆ‘è®¾ç½®äº†ç™»å½•è´¦å·å’Œå¯†ç ï¼š admin admin</p><p><figure class="figure"><img src="media/15014722977191.jpg" alt=""></figure></p><p>åˆ›å»ºkafkaåå­—;<br>é€‰æ‹©kafkaç‰ˆæœ¬å·;<br>JMXè¿™ä¸ªä¸éœ€è¦;<br>ä¸‹é¢é€‰æ‹©é»˜è®¤ç‚¹å‡»ç¡®è®¤å³å¯.</p><p><figure class="figure"><img src="media/15014724051756.jpg" alt=""></figure></p><blockquote><p>(2)kafka å¯ç”¨ JMXç«¯å£</p></blockquote><p><figure class="figure"><img src="media/15020729297106.jpg" alt=""></figure></p><figure class="highlight vbscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">ä»¥å¦‚ä¸‹å‘½ä»¤é‡æ–°å¯åŠ¨kafka</div><div class="line"></div><div class="line">JMX_PORT=<span class="number">9999</span> bin/kafka-<span class="built_in">server</span>-start.sh config/<span class="built_in">server</span>.properties</div><div class="line">æˆ–è€…ä¿®æ”¹kafka-<span class="built_in">server</span>-start.sh æ–‡ä»¶ï¼Œè¿½åŠ JMX_PORT=<span class="string">"9999"</span></div><div class="line"></div><div class="line"> <span class="keyword">if</span> [ <span class="string">"x$KAFKA_HEAP_OPTS"</span> = <span class="string">"x"</span> ]; <span class="keyword">then</span></div><div class="line">    export KAFKA_HEAP_OPTS=<span class="string">"-Xmx1G -Xms1G"</span></div><div class="line">    export JMX_PORT=<span class="string">"9999"</span></div><div class="line">fi</div><div class="line">ç„¶åé‡æ–°å¯åŠ¨kafka</div><div class="line">bin/kafka-<span class="built_in">server</span>-start.sh config/<span class="built_in">server</span>.properties</div><div class="line"></div><div class="line">ä½†æ˜¯Metricsä¸­æ•°æ®éƒ½æ˜¯é›¶</div><div class="line">æŸ¥çœ‹ kafka manager æŠ¥é”™ï¼Œæ— æ³•è¿æ¥jxm</div></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">è§£å†³æ–¹æ³• ä¿®æ”¹æ¯ä¸ªkafka brokerçš„ kafka_2.11-0.10.1.0/bin/kafka-run-class.shæ–‡ä»¶</div><div class="line">â€‹</div><div class="line"><span class="comment"># JMX settings</span></div><div class="line"><span class="keyword">if</span> [ -z <span class="string">"<span class="variable">$KAFKA_JMX_OPTS</span>"</span> ]; <span class="keyword">then</span></div><div class="line">  KAFKA_JMX_OPTS=<span class="string">"-Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.authenticate=false  -Dcom.sun.management.jmxremote.ssl=false -Djava.rmi.server.hostname=75.126.5.162"</span></div><div class="line"><span class="keyword">fi</span></div><div class="line"></div><div class="line"></div><div class="line">-Djava.rmi.server.hostname çš„å€¼ä¸ºå½“å‰kafkaæœåŠ¡å™¨ip</div><div class="line"></div><div class="line">è¿™é‡Œè¯´æ˜ä¸‹é›†ç¾¤kafkaéƒ½éœ€è¦ä¿®æ”¹</div></pre></td></tr></table></figure><p><figure class="figure"><img src="media/15020745879851.jpg" alt=""></figure></p><p><figure class="figure"><img src="media/15014725443386.jpg" alt=""></figure></p><p><figure class="figure"><img src="media/15014725288425.jpg" alt=""></figure></p><p><figure class="figure"><img src="media/15014725659340.jpg" alt=""></figure></p><p><figure class="figure"><img src="media/15014725864134.jpg" alt=""></figure></p><p><figure class="figure"><img src="media/15014726361909.jpg" alt=""></figure></p><p><figure class="figure"><img src="media/15014727525618.jpg" alt=""></figure></p><p><figure class="figure"><img src="media/15014727932029.jpg" alt=""></figure></p><h3 id="äº¤æµå­¦ä¹ ï¼š"><a href="#äº¤æµå­¦ä¹ ï¼š" class="headerlink" title="äº¤æµå­¦ä¹ ï¼š"></a>äº¤æµå­¦ä¹ ï¼š</h3><p>ğŸ§  Linux shell_é«˜çº§è¿ç»´æ´¾: <code>459096184</code>    åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)<br>ğŸ§  BigData-Exchange School : <code>521621407</code>  åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥</p><p>ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;Kafka-Manager&quot;&gt;&lt;a href=&quot;#Kafka-Manager&quot; class=&quot;headerlink&quot; title=&quot;Kafka Manager&quot;&gt;&lt;/a&gt;Kafka Manager&lt;/h2&gt;&lt;p&gt;A tool for managing &lt;a hre
      
    
    </summary>
    
      <category term="å¤§æ•°æ®" scheme="http://blog.yancy.cc/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
    
      <category term="Kafka" scheme="http://blog.yancy.cc/tags/Kafka/"/>
    
      <category term="Bigdata Hadoop" scheme="http://blog.yancy.cc/tags/Bigdata-Hadoop/"/>
    
  </entry>
  
  <entry>
    <title>Bigdata-å¼€æºçš„Kafkaé›†ç¾¤ç®¡ç†å™¨(kafka-web-console)</title>
    <link href="http://blog.yancy.cc/2017/06/28/Bigdata-hadoop/Kafka/Bigdata-%E5%BC%80%E6%BA%90%E7%9A%84Kafka%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E5%99%A8(kafka-web-console)/"/>
    <id>http://blog.yancy.cc/2017/06/28/Bigdata-hadoop/Kafka/Bigdata-å¼€æºçš„Kafkaé›†ç¾¤ç®¡ç†å™¨(kafka-web-console)/</id>
    <published>2017-06-28T06:46:00.000Z</published>
    <updated>2017-09-23T16:20:24.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>æºç çš„åœ°å€åœ¨:<a href="https://github.com/claudemamo/kafka-web-console" target="_blank" rel="external">kafka-web-console</a></p><p><code>Kafka Web Console</code>ä¹Ÿæ˜¯ç”¨Scalaè¯­è¨€ç¼–å†™çš„<code>Java web</code>ç¨‹åºç”¨äºç›‘æ§<code>Apache Kafka</code>ã€‚è¿™ä¸ªç³»ç»Ÿçš„åŠŸèƒ½å’Œ<code>KafkaOffsetMonitor</code>å¾ˆç±»ä¼¼ï¼Œä½†æ˜¯æˆ‘ä»¬ä»æºç è§’åº¦æ¥çœ‹ï¼Œè¿™æ¬¾ç³»ç»Ÿå®ç°æ¯”<code>KafkaOffsetMonitor</code>è¦å¤æ‚å¾ˆå¤šï¼Œè€Œä¸”ç¼–è¯‘é…ç½®æ¯”<code>KafkaOffsetMonitor</code>è¾ƒéº»çƒ¦ã€‚</p><p>ã€€è¦æƒ³è¿è¡Œè¿™å¥—ç³»ç»Ÿæˆ‘ä»¬éœ€è¦çš„å…ˆè¡Œæ¡ä»¶ä¸ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Play Framework 2.2.x</div><div class="line">Apache Kafka 0.8.x</div><div class="line">Zookeeper 3.3.3 or 3.3.4</div></pre></td></tr></table></figure><h3 id="å…¥é—¨"><a href="#å…¥é—¨" class="headerlink" title="å…¥é—¨"></a>å…¥é—¨</h3><p>åŒæ ·ï¼Œæˆ‘ä»¬ä»<code>https://github.com/claudemamo/kafka-web-console</code>ä¸Šé¢å°†æºç ä¸‹è½½ä¸‹æ¥ï¼Œç„¶åç”¨<code>sbt</code>è¿›è¡Œç¼–è¯‘ï¼Œåœ¨ç¼–è¯‘å‰æˆ‘ä»¬éœ€è¦åšå¦‚ä¸‹çš„ä¿®æ”¹ï¼š</p><p>Kafka Webæ§åˆ¶å°éœ€è¦ä¸€ä¸ªå…³ç³»æ•°æ®åº“ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨è¿æ¥åˆ°åµŒå…¥å¼H2æ•°æ®åº“ï¼Œä¸éœ€è¦æ•°æ®åº“å®‰è£…æˆ–é…ç½®ã€‚è¯·å’¨è¯¢Playï¼çš„æ–‡æ¡£ä»¥æŒ‡å®šæ§åˆ¶å°çš„æ•°æ®åº“ã€‚æ”¯æŒä»¥ä¸‹æ•°æ®åº“ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git <span class="built_in">clone</span> https://github.com/claudemamo/kafka-web-console.git</div></pre></td></tr></table></figure><ul><li>H2ï¼ˆé»˜è®¤ï¼‰</li><li>PostgreSql</li><li>Oracle</li><li>DB2</li><li>MySQL</li><li>Apache Derby</li><li>Microsoft SQL Server</li></ul><p>ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Mysqlæ•°æ®åº“ï¼Œåªè¦åšå¦‚ä¸‹ä¿®æ”¹å³å¯ï¼Œæ‰¾åˆ° <code>conf/application.conf</code>æ–‡ä»¶ï¼Œå¹¶ä¿®æ”¹å¦‚ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">å°†è¿™ä¸ª</div><div class="line">db.default.driver=org.h2.Driver</div><div class="line">db.default.url=<span class="string">"jdbc:h2:file:play"</span></div><div class="line"><span class="comment"># db.default.user=sa</span></div><div class="line"><span class="comment"># db.default.password=""</span></div><div class="line"> </div><div class="line"> </div><div class="line">ä¿®æ”¹æˆ</div><div class="line">db.default.driver=com.mysql.jdbc.Driver</div><div class="line">db.default.url=<span class="string">"jdbc:mysql://localhost:3306/kafkamonitor"</span></div><div class="line">db.default.user=iteblog</div><div class="line">db.default.pass=wyp</div></pre></td></tr></table></figure><p>æˆ‘ä»¬è¿˜éœ€è¦ä¿®æ”¹build.sbtï¼ŒåŠ å…¥å¯¹Mysqlçš„ä¾èµ–:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="string">"mysql"</span> % <span class="string">"mysql-connector-java"</span> % <span class="string">"5.1.31"</span></div></pre></td></tr></table></figure><p>ã€€2ã€æ‰§è¡Œ<code>conf/evolutions/default/bak</code>ç›®å½•ä¸‹é¢çš„<code>1.sqlã€2.sqlå’Œ3.sql</code>ä¸‰ä¸ªæ–‡ä»¶ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸‰ä¸ªsqlæ–‡ä»¶ä¸èƒ½ç›´æ¥è¿è¡Œï¼Œæœ‰è¯­æ³•é”™è¯¯ï¼Œéœ€è¦åšä¸€äº›ä¿®æ”¹ã€‚<br>ä¸Šé¢çš„æ³¨æ„äº‹é¡¹å¼„å®Œä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥ç¼–è¯‘ä¸‹è½½è¿‡æ¥çš„æºç ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> sbt package</span></div></pre></td></tr></table></figure><p>ç¼–è¯‘çš„è¿‡ç¨‹æ¯”è¾ƒæ…¢ï¼Œæœ‰äº›ä¾èµ–åŒ…ä¸‹è½½é€Ÿåº¦éå¸¸åœ°æ…¢ï¼Œè¯·è€å¿ƒç­‰å¾…ã€‚<br>ã€€åœ¨ç¼–è¯‘çš„è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šå‡ºç°æœ‰äº›ä¾èµ–åŒ…æ— æ³•ä¸‹è½½ï¼Œå¦‚ä¸‹é”™è¯¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">[warn] module not found: com.typesafe.play<span class="comment">#sbt-plugin;2.2.1</span></div><div class="line">[warn] ==== typesafe-ivy-releases: tried</div><div class="line">[warn] http://repo.typesafe.com/typesafe/ivy-releases/</div><div class="line">com.typesafe.play/sbt-plugin/scala_2.9.2/sbt_0.12/2.2.1/ivys/ivy.xml</div><div class="line">[warn] ==== sbt-plugin-releases: tried</div><div class="line">[warn] http://scalasbt.artifactoryonline.com/scalasbt/sbt-plugin-releases/</div><div class="line">com.typesafe.play/sbt-plugin/scala_2.9.2/sbt_0.12/2.2.1/ivys/ivy.xml</div><div class="line">[warn] ==== <span class="built_in">local</span>: tried</div><div class="line">[warn] /home/iteblog/.ivy2/<span class="built_in">local</span>/com.typesafe.play/</div><div class="line">sbt-plugin/scala_2.9.2/sbt_0.12/2.2.1/ivys/ivy.xml</div><div class="line">[warn] ==== Typesafe repository: tried</div><div class="line">[warn] http://repo.typesafe.com/typesafe/releases/com/</div><div class="line">typesafe/play/sbt-plugin_2.9.2_0.12/2.2.1/sbt-plugin-2.2.1.pom</div><div class="line">[warn] ==== public: tried</div><div class="line">[warn] http://repo1.maven.org/maven2/com/typesafe/play/</div><div class="line">sbt-plugin_2.9.2_0.12/2.2.1/sbt-plugin-2.2.1.pom</div><div class="line">[warn] ::::::::::::::::::::::::::::::::::::::::::::::</div><div class="line"> </div><div class="line">==== <span class="built_in">local</span>: tried</div><div class="line"> </div><div class="line">/home/iteblog/.ivy2/<span class="built_in">local</span>/org.scala-sbt/collections/0.13.0/jars/collections.jar</div><div class="line"> </div><div class="line">::::::::::::::::::::::::::::::::::::::::::::::</div><div class="line"> </div><div class="line">:: FAILED DOWNLOADS ::</div><div class="line"> </div><div class="line">:: ^ see resolution messages <span class="keyword">for</span> details ^ ::</div><div class="line"> </div><div class="line">::::::::::::::::::::::::::::::::::::::::::::::</div><div class="line"> </div><div class="line">:: org.scala-sbt<span class="comment">#collections;0.13.0!collections.jar</span></div><div class="line"> </div><div class="line">::::::::::::::::::::::::::::::::::::::::::::::</div></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨åœ°ä¸‹è½½ç›¸å…³ä¾èµ–ï¼Œå¹¶æ”¾åˆ°ç±»ä¼¼<code>/home/iteblog/.ivy2/local/org.scala-sbt/collections/0.13.0/jars/</code>ç›®å½•ä¸‹é¢ã€‚ç„¶åå†ç¼–è¯‘å°±å¯ä»¥äº†ã€‚</p><p>ã€€ã€€æœ€åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢å‘½ä»¤å¯åŠ¨<code>Kafka Web Console</code>ç›‘æ§ç³»ç»Ÿï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> sbt run</span></div></pre></td></tr></table></figure><p>å¹¶å¯ä»¥åœ¨<a href="http://localhost:9000" target="_blank" rel="external">http://localhost:9000</a> æŸ¥çœ‹ä¸‹é¢æ˜¯ä¸€å¼ æ•ˆæœå›¾</p><p><figure class="figure"><img src="https://www.iteblog.com/pic/topics.png" alt=""></figure></p><h3 id="äº¤æµå­¦ä¹ ï¼š"><a href="#äº¤æµå­¦ä¹ ï¼š" class="headerlink" title="äº¤æµå­¦ä¹ ï¼š"></a>äº¤æµå­¦ä¹ ï¼š</h3><p>ğŸ§  Linux shell_é«˜çº§è¿ç»´æ´¾: <code>459096184</code>    åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)<br>ğŸ§  BigData-Exchange School : <code>521621407</code>  åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥</p><p>ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h3&gt;&lt;p&gt;æºç çš„åœ°å€åœ¨:&lt;a href=&quot;https://github.com/claudemamo/kafka-web-console&quot; targe
      
    
    </summary>
    
      <category term="å¤§æ•°æ®" scheme="http://blog.yancy.cc/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
    
      <category term="Kafka" scheme="http://blog.yancy.cc/tags/Kafka/"/>
    
  </entry>
  
  <entry>
    <title>Zabbixç›‘æ§Kafkaé›†ç¾¤ BrokersæœåŠ¡</title>
    <link href="http://blog.yancy.cc/2017/06/01/Monitoring/Zabbix%E7%9B%91%E6%8E%A7Kafka%E9%9B%86%E7%BE%A4%20Brokers%E6%9C%8D%E5%8A%A1/"/>
    <id>http://blog.yancy.cc/2017/06/01/Monitoring/Zabbixç›‘æ§Kafkaé›†ç¾¤ BrokersæœåŠ¡/</id>
    <published>2017-06-01T09:56:03.000Z</published>
    <updated>2017-09-23T16:38:48.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Zabbixç›‘æ§Kafkaé›†ç¾¤-BrokersæœåŠ¡"><a href="#Zabbixç›‘æ§Kafkaé›†ç¾¤-BrokersæœåŠ¡" class="headerlink" title="Zabbixç›‘æ§Kafkaé›†ç¾¤ BrokersæœåŠ¡"></a>Zabbixç›‘æ§Kafkaé›†ç¾¤ BrokersæœåŠ¡</h3><p><figure class="figure"><img src="https://datadog-prod.imgix.net/img/blog/monitor-kafka-with-datadog/dash1.png?fit=max" alt=""></figure></p><h4 id="å‰è¨€ï¼š"><a href="#å‰è¨€ï¼š" class="headerlink" title="å‰è¨€ï¼š"></a>å‰è¨€ï¼š</h4><p>Monitoring Kafka with Datadog</p><p>This post is the final part of a 3-part series on how to monitor Kafka. Part 1 explores the key metrics available from Kafka, and Part 2 is about collecting those metrics on an ad hoc basis.</p><p>To implement ongoing, meaningful monitoring, you will need a dedicated system that allows you to store, visualize, and correlate your Kafka metrics with the rest of your infrastructure.</p><p>Kafka deployments often rely on additional software packages not included in the Kafka codebase itself, in particular Apache ZooKeeper. A comprehensive monitoring implementation includes all the layers of your deployment, including host-level metrics when appropriate, and not just the metrics emitted by Kafka itself.</p><a id="more"></a><p>æˆ‘åœ¨å¤„ç†HadoopåŠç›¸å…³æœåŠ¡ç›‘æ§ã€æŠ¥è­¦è¿™é‡Œä¸»è¦è®²kafkaé›†ç¾¤æœåŠ¡ã€‚è¿™é‡Œæˆ‘ä¹Ÿçœ‹äº†å‡ ç¯‡kafkaç›¸å…³æ–‡ç« ï¼Œå¥½æ–‡è´´å‡ºæ¥ï¼š</p><ul><li><a href="http://www.infoq.com/cn/articles/kafka-analysis-part-1" target="_blank" rel="external">infoq kafka å…¥é—¨äº†è§£</a></li><li><a href="https://www.ibm.com/developerworks/cn/opensource/os-cn-kafka/index.html" target="_blank" rel="external">kafka å·¥ä½œåŸç†ä»‹ç»</a></li></ul><p>åœ¨æˆ‘ä»¬å…¬å¸ä¸»è¦Kafka çš„å‡ ä¸ªç‰¹æ€§éå¸¸æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼šå¯æ‰©å±•æ€§ã€æ•°æ®åˆ†åŒºã€ä½å»¶è¿Ÿã€å¤„ç†å¤§é‡ä¸åŒæ¶ˆè´¹è€…çš„èƒ½åŠ›ã€‚</p><p>è€Œè¿™é‡Œæˆ‘æƒ³å¸®å¿™BIå›¢é˜Ÿå®ç°Kafkaå…¨é¢ç›‘æ§ã€‚åˆ†ä¸¤ç‚¹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">1. ç›‘æ§Kafka BrokersæœåŠ¡</div><div class="line">2. ç›‘æ§Kafka Lagå †ç§¯æ•°</div></pre></td></tr></table></figure><p>å¯¹äºKafkaçš„ç›‘æ§ï¼Œå·²ç»æœ‰ç°æˆçš„å¼€æºè½¯ä»¶äº†ï¼Œåœ¨æˆ‘ä»¬å…¬å¸å†…éƒ¨ä¹Ÿä½¿ç”¨äº†ä¸€æ®µæ—¶é—´ï¼Œæœ‰ä¸¤ç§æ–¹æ¡ˆã€‚æˆ‘ä»¬å…¬å¸ç”¨ç¬¬ä¸‰ç§æ–¹æ¡ˆã€‚<br>ä¸€èˆ¬éƒ½ä¼šé€‰æ‹©ä¸¤ä¸ªå¼€æºçš„å·¥å…·ï¼šKafkaOffsetMonitorå’Œkafka-web-consoleï¼Œè¿™ä¸¤æ¬¾æˆ‘éƒ½æœ‰ç”¨è¿‡.</p><ul><li>Kafkaä¸‰æ¬¾ç›‘æ§å·¥å…·æ¯”è¾ƒ</li></ul><p>ç›®å½•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">1ã€Kafka Web Conslole</div><div class="line">2ã€Kafka Manager</div><div class="line">3ã€KafkaOffsetMonitor</div></pre></td></tr></table></figure><p><a href="https://github.com/quantifind/KafkaOffsetMonitor" target="_blank" rel="external">KafkaOffsetMonitor</a>ï¼šæœ€å¤§çš„å¥½å¤„å°±æ˜¯é…ç½®ç®€å•ï¼Œåªéœ€è¦é…ä¸ªzookeeperçš„åœ°å€å°±èƒ½ç”¨äº†ï¼Œå‘çˆ¹çš„åœ°æ–¹å°±æ˜¯ä¸èƒ½è‡ªåŠ¨åˆ·æ–°ï¼Œæ‰‹åŠ¨åˆ·æ–°æ—¶è€—æ—¶è¾ƒé•¿ï¼Œè€Œä¸”æœ‰æ—¶å€™éƒ½åˆ·ä¸å‡ºæ¥ï¼Œå¦å¤–å°±æ˜¯å›¾åƒç”¨äº†ä¸€æ®µæ—¶é—´å°±å®Œå…¨æ˜¾ç¤ºä¸äº†äº†ï¼Œä¸çŸ¥é“å¤§å®¶æ˜¯ä¸æ˜¯è¿™æ ·ã€‚</p><p><a href="https://github.com/claudemamo/kafka-web-console" target="_blank" rel="external">kafka-web-console</a>ï¼šç›¸æ¯”ä¸å‰è€…ï¼Œæ•°æ®æ˜¯è½åœ°çš„ï¼Œå› æ­¤åˆ·æ–°è¾ƒå¿«ï¼Œè€Œä¸”æ”¯æŒåœ¨å‰ç«¯è‡ªå®šä¹‰zookeeperçš„åœ°å€ï¼Œè¿˜èƒ½åˆ—å‡ºå®æ—¶çš„topicé‡Œçš„å…·ä½“å†…å®¹ã€‚ä½†æ˜¯æ­å»ºæ¯”è¾ƒå¤æ‚ï¼Œè€Œä¸”githubä¸Šçš„é»˜è®¤æ•°æ®åº“æ˜¯H2çš„ï¼Œåƒæˆ‘ä»¬ä¸€èˆ¬ç”¨mysqlçš„ï¼Œè¿˜å¾—è‡ªå·±è½¬åŒ–ã€‚å¦å¤–åœ¨ç”¨çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨è¿æ¥kafkaçš„leaderå¤±è´¥çš„æ—¶å€™ï¼Œä¼šä¸€ç›´é‡è¯•ï¼Œå…¶ç»“æœå°±æ˜¯å¯¼è‡´æˆ‘kafkaçš„é‚£å°æœºå­è¿æ¥æ•°è¿‡é«˜ï¼Œéƒ½åˆ°2wäº†ï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯å®ƒçš„ä¸€ä¸ªbugã€‚</p><p>å…·ä½“ä»‹ç»ä»¥åŠå®‰è£…åœ¨æˆ‘å¦å¤–ç¯‡åšæ–‡ã€‚è¿™é‡Œä¸è¯¦ç»†è®²è§£å¼€æºè½¯ä»¶ï¼Œè¿™é‡Œç”¨zabbixç›‘æ§Kafka BrokersæœåŠ¡ã€‚</p><h4 id="kafka-monitoring-BrokersæœåŠ¡"><a href="#kafka-monitoring-BrokersæœåŠ¡" class="headerlink" title="kafka-monitoring BrokersæœåŠ¡"></a>kafka-monitoring BrokersæœåŠ¡</h4><p>æ“ä½œç³»ç»Ÿç¯å¢ƒï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Centos 7.1 </div><div class="line">64Gå†…å­˜</div><div class="line">2Tç£ç›˜ç©ºé—´ï¼ŒæŒ‡å®škafkaå†™å…¥æ•°æ®ç›®å½•ã€‚</div></pre></td></tr></table></figure><p>è¯´æ˜ä¸‹:</p><p>ç›‘æ§Brokersæ˜¯åˆ©ç”¨Zabbix JMXç›‘æ§è·å–æ•°æ®ã€‚</p><p>â˜ï¸ç¬¬ä¸€æ­¥ï¼šä¸ç”¨è§£é‡Šå‰æä½ åœ¨zabbix-serverç«¯å·²ç»å®‰è£…è¿‡abbix-java-gataway å¦‚æœæ²¡æœ‰å®‰è£…å¯ä»¥çœ‹ä¸‹é¢ï¼Œå®‰è£…è¿‡å¯ä»¥ç•¥è¿‡ç¬¬ä¸€æ­¥ã€‚</p><p>1.0 å®‰è£…é…ç½®zabbix-java-gataway</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">yum install -y zabbix-java-gataway</div><div class="line">vi /etc/zabbix/zabbix_java_gateway.conf</div><div class="line">START_POLLERS=10 </div><div class="line">Uncomentå¹¶è®¾ç½®ä¸ºStartJavaPollers = 5 æ›´æ”¹JavaGatewayçš„ IP = IP_address_java_gateway</div><div class="line">``` </div><div class="line">1.1 é‡æ–°å¯åŠ¨zabbix-server</div><div class="line"></div><div class="line">```bash</div><div class="line">/etc/init.d/zabbix-java-gataway restart</div><div class="line">chkconfig --level 345 zabbix-java-gataway on</div><div class="line">/etc/init.d/zabbix-java-gataway start</div></pre></td></tr></table></figure><p>â˜ï¸ç¬¬äºŒæ­¥ï¼šKafkaé…ç½®</p><p>è¿™é‡Œæˆ‘ä»¬æœåŠ¡å™¨ç»™å¤§æ•°æ®é‚£è¾¹å®‰è£…åœ¨æŒ‡å®šç”¨æˆ·ç›®å½•ä¸‹é¢ï¼š/home/jollybi/tools/kafka_2.10-0.8.2.1</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">su - jollybi è¿›å…¥ç›¸åº”ç”¨æˆ·</div><div class="line">vim /home/jollybi/tools/kafka_2.10-0.8.2.1/kafka-run-class.sh</div><div class="line"></div><div class="line">ä»</div><div class="line"></div><div class="line"><span class="comment"># JMX settings</span></div><div class="line"><span class="keyword">if</span> [ -z <span class="string">"<span class="variable">$KAFKA_JMX_OPTS</span>"</span> ]; <span class="keyword">then</span></div><div class="line">KAFKA_JMX_OPTS=<span class="string">"-Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.authenticate=false -   Dcom.sun.management.jmxremote.ssl=false "</span></div><div class="line"><span class="keyword">fi</span></div><div class="line">è‡³</div><div class="line"></div><div class="line"><span class="comment"># JMX settings</span></div><div class="line"><span class="keyword">if</span> [ -z <span class="string">"<span class="variable">$KAFKA_JMX_OPTS</span>"</span> ]; <span class="keyword">then</span></div><div class="line">KAFKA_JMX_OPTS=<span class="string">"-Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.port=12345 -    Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false "</span></div><div class="line"><span class="keyword">fi</span></div></pre></td></tr></table></figure><p>é‡å¯æœåŠ¡ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">/home/jollybi/tools/kafka_2.10-0.8.2.1/bin/kafka-server-stop.sh</div><div class="line">/home/jollybi/tools/kafka_2.10-0.8.2.1/bin/kafka-server-start.sh</div></pre></td></tr></table></figure><p>â˜ï¸ç¬¬ä¸‰æ­¥ï¼šå¯¼å…¥æ¨¡æ¿ç™»å½•åˆ°æ‚¨çš„zabbixç½‘é¡µ.</p><p>å¯¼å…¥æ¨¡æ¿ç™»å½•åˆ°æ‚¨çš„zabbixç½‘é¡µ</p><p>å•å‡»é…ç½® - &gt;æ¨¡æ¿ - &gt;å¯¼å…¥</p><p>ä¸‹è½½æ¨¡æ¿ <a href="https://github.com/yangcvo/Zabbix-Monitoring-Kafka" target="_blank" rel="external">zbx_kafka_templates.xml</a> å¹¶ä¸Šä¼ åˆ°zabbixç„¶åå°†æ­¤æ¨¡æ¿æ·»åŠ åˆ°Kafkaå¹¶åœ¨zabbixä¸Šé…ç½®JMXæ¥å£</p><p>è¾“å…¥Kafka IPåœ°å€å’ŒJMXç«¯å£å¦‚æœçœ‹åˆ°jmxå›¾æ ‡ï¼Œæ‚¨é…ç½®äº†JMXç›‘æ§å¥½ï¼</p><ul><li>æŸ¥çœ‹æ•°æ®ï¼š</li></ul><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/kafka-Brokers_01.png" alt=""></figure><br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/kafka-Brokers_02.png" alt=""></figure></p><ul><li>æŸ¥çœ‹æ•ˆæœå›¾ï¼š</li></ul><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/kafka-Brokers_03.png" alt=""></figure></p><p>å‚è€ƒå®˜ç½‘ç›‘æ§æŒ‡æ ‡çš„å«ä¹‰;</p><p><a href="http://docs.confluent.io/current/kafka/monitoring.html" target="_blank" rel="external">Servilo Metrics broker Metrics</a><br><a href="http://docs.confluent.io/current/kafka/monitoring.html" target="_blank" rel="external">Producer Metrics Global Request Metrics</a><br><a href="http://docs.confluent.io/current/kafka/monitoring.html" target="_blank" rel="external">Global Connection Metrics</a></p><h3 id="äº¤æµå­¦ä¹ ï¼š"><a href="#äº¤æµå­¦ä¹ ï¼š" class="headerlink" title="äº¤æµå­¦ä¹ ï¼š"></a>äº¤æµå­¦ä¹ ï¼š</h3><p>ğŸ§  Linux shell_é«˜çº§è¿ç»´æ´¾: <code>459096184</code>    åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)<br>ğŸ§  BigData-Exchange School : <code>521621407</code>  åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥</p><p>ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;Zabbixç›‘æ§Kafkaé›†ç¾¤-BrokersæœåŠ¡&quot;&gt;&lt;a href=&quot;#Zabbixç›‘æ§Kafkaé›†ç¾¤-BrokersæœåŠ¡&quot; class=&quot;headerlink&quot; title=&quot;Zabbixç›‘æ§Kafkaé›†ç¾¤ BrokersæœåŠ¡&quot;&gt;&lt;/a&gt;Zabbixç›‘æ§Kafkaé›†ç¾¤ BrokersæœåŠ¡&lt;/h3&gt;&lt;p&gt;&lt;img src=&quot;https://datadog-prod.imgix.net/img/blog/monitor-kafka-with-datadog/dash1.png?fit=max&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h4 id=&quot;å‰è¨€ï¼š&quot;&gt;&lt;a href=&quot;#å‰è¨€ï¼š&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€ï¼š&quot;&gt;&lt;/a&gt;å‰è¨€ï¼š&lt;/h4&gt;&lt;p&gt;Monitoring Kafka with Datadog&lt;/p&gt;
&lt;p&gt;This post is the final part of a 3-part series on how to monitor Kafka. Part 1 explores the key metrics available from Kafka, and Part 2 is about collecting those metrics on an ad hoc basis.&lt;/p&gt;
&lt;p&gt;To implement ongoing, meaningful monitoring, you will need a dedicated system that allows you to store, visualize, and correlate your Kafka metrics with the rest of your infrastructure.&lt;/p&gt;
&lt;p&gt;Kafka deployments often rely on additional software packages not included in the Kafka codebase itself, in particular Apache ZooKeeper. A comprehensive monitoring implementation includes all the layers of your deployment, including host-level metrics when appropriate, and not just the metrics emitted by Kafka itself.&lt;/p&gt;
    
    </summary>
    
      <category term="Kafka" scheme="http://blog.yancy.cc/categories/Kafka/"/>
    
    
      <category term="Kafka" scheme="http://blog.yancy.cc/tags/Kafka/"/>
    
      <category term="Zabbix" scheme="http://blog.yancy.cc/tags/Zabbix/"/>
    
  </entry>
  
  <entry>
    <title>Zabbix-Monitoring Kafkaé›†ç¾¤ Consumer | kafkaçš„ç›‘æ§å’Œå‘Šè­¦</title>
    <link href="http://blog.yancy.cc/2017/05/29/Monitoring/Zabbix-Monitoring%20Kafka%20Consumer%20%7C%20kafka%E7%9A%84%E7%9B%91%E6%8E%A7%E5%92%8C%E5%91%8A%E8%AD%A6/"/>
    <id>http://blog.yancy.cc/2017/05/29/Monitoring/Zabbix-Monitoring Kafka Consumer | kafkaçš„ç›‘æ§å’Œå‘Šè­¦/</id>
    <published>2017-05-29T09:56:03.000Z</published>
    <updated>2017-09-23T16:21:39.000Z</updated>
    
    <content type="html"><![CDATA[<p><figure class="figure"><img src="http://adminotes.com/wp-content/uploads/2016/08/Screenshot-from-2016-08-12-16-41-55.png" alt=""></figure></p><h3 id="Zabbix-Monitoring-Kafkaé›†ç¾¤-Consumer-kafkaçš„ç›‘æ§å’Œå‘Šè­¦"><a href="#Zabbix-Monitoring-Kafkaé›†ç¾¤-Consumer-kafkaçš„ç›‘æ§å’Œå‘Šè­¦" class="headerlink" title="Zabbix-Monitoring Kafkaé›†ç¾¤ Consumer | kafkaçš„ç›‘æ§å’Œå‘Šè­¦"></a>Zabbix-Monitoring Kafkaé›†ç¾¤ Consumer | kafkaçš„ç›‘æ§å’Œå‘Šè­¦</h3><p>å‰é¢ä¸€ç¯‡è®²äº†æˆ‘ä»¬ç›‘æ§kafkaé›†ç¾¤BrokersæœåŠ¡çŠ¶æ€ç›‘æ§ã€‚ç”Ÿäº§ç¯å¢ƒç›‘æ§ï¼Œå¯ä»¥åœ¨Zabbixä¸­å¯¹Kafkaè¿›è¡Œç›‘æ§ï¼Œä¸€ç§æ˜¯ç›‘æ§JMXç«¯å£ï¼Œå¦å¤–ä¸€ç§æ˜¯ç›´æ¥å†™è„šæœ¬ï¼Œä½¿ç”¨bin/kafka-run-class.shé‡Œæä¾›çš„ç›¸å…³æ–¹æ³•ç±»ã€‚</p><p>æ ¹æ®æˆ‘ä»¬çš„ä¸šåŠ¡åœºæ™¯ï¼Œæœ€ä¸ºä¸»è¦çš„çš„æ˜¯ç›‘æ§æ¶ˆè´¹è€…Lagçš„æƒ…å†µã€‚æ‰€æœ‰æˆ‘ç›´æ¥å†™è„šæœ¬äº†ã€‚<br>æˆ‘ä»¬å¯¹æŸä¸€ä¸ªTopicçš„30ä¸ªåˆ†åŒºï¼Œæ¯ä¸ªåˆ†åŒºï¼Œå½“å‰Consumerçš„Lagæƒ…å†µã€‚<br>å½“ç„¶è¿˜å¯ä»¥ç”Ÿæˆæ±‡æ€»å›¾ï¼Œåœ¨æ­¤ä¸åšå¤šå±•ç¤ºã€‚åœ¨Zabbixä¸­é…ç½®å¯¹åº”çš„Triggersï¼Œå½“Lagè¶…è¿‡é˜€å€¼ï¼Œå®ç°æŠ¥è­¦ã€‚</p><a id="more"></a><p>è¿™é‡Œæˆ‘ç”¨å‘½ä»¤åœ¨kafkaå½“ä¸­ä¸€å°æœåŠ¡å™¨è·å–äº†å…¶ä¸­ä¸€ä¸ªTopic groupçš„Lagã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">[jollybi@countly2 kafka_2.10]$ </div><div class="line">bin/kafka-run-class.sh kafka.tools.ConsumerOffsetChecker --zookeeper 75.126.39.4:2281,75.126.5.2:2281,75.126.5.1:2281 --group group_zybi --topic mongotail_lz4  </div><div class="line">æ¶ˆè´¹ç»„           è¯é¢˜id                        åˆ†åŒºID å½“å‰å·²æ¶ˆè´¹çš„æ¡æ•°   æ€»æ¡æ•°         æœªæ¶ˆè´¹çš„            </div><div class="line">Group           Topic                          Pid Offset          <span class="built_in">log</span>Size         Lag             Owner</div><div class="line">group_zybi      mongotail_lz4                  0   1092163900      2253744158      1161580258      none</div><div class="line">group_zybi      mongotail_lz4                  1   1092281117      2253795899      1161514782      none</div><div class="line">group_zybi      mongotail_lz4                  2   1092834883      2253771036      1160936153      none</div><div class="line">group_zybi      mongotail_lz4                  3   1092822121      2253772916      1160950795      none</div><div class="line">group_zybi      mongotail_lz4                  4   1092040532      2253775432      1161734900      none</div><div class="line">group_zybi      mongotail_lz4                  5   1095163824      2253744329      1158580505      none</div><div class="line">group_zybi      mongotail_lz4                  6   1097623779      2253781500      1156157721      none</div><div class="line">group_zybi      mongotail_lz4                  7   1097459357      2253782032      1156322675      none</div><div class="line">group_zybi      mongotail_lz4                  8   1099080546      2253741287      1154660741      none</div><div class="line">group_zybi      mongotail_lz4                  9   1099028190      2253785053      1154756863      none</div><div class="line">group_zybi      mongotail_lz4                  10  1099535928      2253795680      1154259752      none</div><div class="line">group_zybi      mongotail_lz4                  11  1099701993      2253742880      1154040887      none</div></pre></td></tr></table></figure><p>å…¶å®å‘½ä»¤å¤§ä½“çš„é€»è¾‘å°±æ˜¯é€šè¿‡Consumerè·å–åˆ°å½“å‰çš„offsetï¼Œå°±èƒ½æœ‰lagä¿¡æ¯äº†ï¼Œå¦‚ä½•å†™æˆè„šæœ¬è·å–æˆ‘ä»¬æƒ³è¦çš„æ¶ˆè´¹å’Œæœªæ¶ˆè´¹ä¸æ€»æ¶ˆæ¯æ¡æ•°å‘¢ã€‚</p><p>è„šæœ¬è´´å‡ºæ¥äº†ï¼Œå¾ˆç®€å•ç†è§£ï¼ŒæŠŠè‡ªå·±è·å–åˆ°topicçš„æ¶ˆè´¹æ¡æ•°è¿‡æ»¤ã€‚æˆ‘å…¬å¸æœ‰ä¸¤ä¸ªä¸»é¢˜topicåˆ†åˆ«å¯¹ä¸åŒç»„è·å–lag.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line">[root@countly2 zabbix]<span class="comment"># vim monitor_kafka.sh</span></div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"></div><div class="line"><span class="built_in">export</span> JAVA_HOME=/home/jollybi/tools/java-7-sun</div><div class="line"><span class="built_in">export</span> CLASSPATH=<span class="variable">$CLASSPATH</span>:.:<span class="variable">$JAVA_HOME</span>/lib:<span class="variable">$JAVA_HOME</span>/jre/lib</div><div class="line"><span class="built_in">export</span> PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$JAVA_HOME</span>/jre/bin:<span class="variable">$PATH</span></div><div class="line">topic=mongotail_lz4_imp</div><div class="line">group=group_imp</div><div class="line"></div><div class="line"><span class="comment">#topic2</span></div><div class="line"></div><div class="line">topic2=mongotail_lz4</div><div class="line">group2=group_event</div><div class="line">group3=group_event_spm</div><div class="line"></div><div class="line"><span class="comment">#å¯åŠ¨ç›®å½•</span></div><div class="line">kafkaserver=/home/jollybi/tools/kafka_2.10-0.8.2.1/bin/kafka-run-class.sh</div><div class="line">zk=75.126.39.4:2281,75.126.5.2:2281,75.126.5.8:2281</div><div class="line"></div><div class="line"><span class="keyword">function</span> imp_lag &#123;</div><div class="line"><span class="built_in">echo</span> <span class="string">"`<span class="variable">$kafkaserver</span> kafka.tools.ConsumerOffsetChecker --zookeeper <span class="variable">$zk</span> --group <span class="variable">$group</span>  --topic <span class="variable">$topic</span>  | sed -n 2p | awk '&#123;print <span class="variable">$6</span>&#125;'`"</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">function</span> imp_logsize &#123;</div><div class="line"><span class="built_in">echo</span> <span class="string">"`<span class="variable">$kafkaserver</span> kafka.tools.ConsumerOffsetChecker --zookeeper <span class="variable">$zk</span> --group <span class="variable">$group</span>  --topic <span class="variable">$topic</span>  | sed -n 2p | awk '&#123;print <span class="variable">$5</span>&#125;'`"</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">function</span> imp_offset &#123;</div><div class="line"><span class="built_in">echo</span> <span class="string">"`<span class="variable">$kafkaserver</span> kafka.tools.ConsumerOffsetChecker --zookeeper <span class="variable">$zk</span> --group <span class="variable">$group</span>  --topic <span class="variable">$topic</span>  | sed -n 2p | awk '&#123;print <span class="variable">$4</span>&#125;'`"</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">function</span> event_spm_lag &#123;</div><div class="line"><span class="built_in">echo</span> <span class="string">"`<span class="variable">$kafkaserver</span> kafka.tools.ConsumerOffsetChecker --zookeeper <span class="variable">$zk</span> --group <span class="variable">$group2</span>  --topic <span class="variable">$topic2</span>  | sed -n 2p | awk '&#123;print <span class="variable">$6</span>&#125;'`"</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">function</span> event_spm_logsize &#123;</div><div class="line"><span class="built_in">echo</span> <span class="string">"`<span class="variable">$kafkaserver</span> kafka.tools.ConsumerOffsetChecker --zookeeper <span class="variable">$zk</span> --group <span class="variable">$group2</span>  --topic <span class="variable">$topic2</span>  | sed -n 2p | awk '&#123;print <span class="variable">$5</span>&#125;'`"</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">function</span> event_spm_offset &#123;</div><div class="line"><span class="built_in">echo</span> <span class="string">"`<span class="variable">$kafkaserver</span> kafka.tools.ConsumerOffsetChecker --zookeeper <span class="variable">$zk</span> --group <span class="variable">$group2</span>  --topic <span class="variable">$topic2</span>  | sed -n 2p | awk '&#123;print <span class="variable">$4</span>&#125;'`"</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">function</span> event_lag &#123;</div><div class="line"><span class="built_in">echo</span> <span class="string">"`<span class="variable">$kafkaserver</span> kafka.tools.ConsumerOffsetChecker --zookeeper <span class="variable">$zk</span> --group <span class="variable">$group3</span>  --topic <span class="variable">$topic2</span>  | sed -n 2p | awk '&#123;print <span class="variable">$6</span>&#125;'`"</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">function</span> event_logsize &#123;</div><div class="line"><span class="built_in">echo</span> <span class="string">"`<span class="variable">$kafkaserver</span> kafka.tools.ConsumerOffsetChecker --zookeeper <span class="variable">$zk</span> --group <span class="variable">$group3</span>  --topic <span class="variable">$topic2</span>  | sed -n 2p | awk '&#123;print <span class="variable">$5</span>&#125;'`"</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">function</span> event_offset &#123;</div><div class="line"><span class="built_in">echo</span> <span class="string">"`<span class="variable">$kafkaserver</span> kafka.tools.ConsumerOffsetChecker --zookeeper <span class="variable">$zk</span> --group <span class="variable">$group3</span>  --topic <span class="variable">$topic2</span>  | sed -n 2p | awk '&#123;print <span class="variable">$4</span>&#125;'`"</span></div><div class="line">&#125;</div><div class="line"><span class="comment"># Run the requested function</span></div><div class="line"><span class="variable">$1</span></div></pre></td></tr></table></figure><p>â° <strong>è¿™é‡Œè„šæœ¬æˆ‘æ›´æ–°è¿‡äº†ï¼Œè¿™ä¸ªè„šæœ¬å®ç°æ˜¯å½“ä¸ªåˆ†ç‰‡çš„æ¶ˆè´¹æƒ…å†µã€‚ ä¸æ˜¯æ€»çš„æ¶ˆè´¹å’Œæœªæ¶ˆè´¹çš„å–åˆ°çš„å€¼ã€‚</strong><br>ğŸ‹ éœ€è¦åŸè„šæœ¬çš„ç•™è¨€å–”ï¼Œä¸‹é¢æ­¥éª¤éƒ½æ˜¯ä¸€æ ·çš„æ•ˆæœã€‚</p><h4 id="è„šæœ¬æ”¾åˆ°kafkaæœåŠ¡å™¨-etc-zabbix-ä¸‹é¢ï¼Œå¹¶é…åˆzabbixç›‘æ§ã€‚"><a href="#è„šæœ¬æ”¾åˆ°kafkaæœåŠ¡å™¨-etc-zabbix-ä¸‹é¢ï¼Œå¹¶é…åˆzabbixç›‘æ§ã€‚" class="headerlink" title="è„šæœ¬æ”¾åˆ°kafkaæœåŠ¡å™¨/etc/zabbix/ä¸‹é¢ï¼Œå¹¶é…åˆzabbixç›‘æ§ã€‚"></a>è„šæœ¬æ”¾åˆ°kafkaæœåŠ¡å™¨/etc/zabbix/ä¸‹é¢ï¼Œå¹¶é…åˆzabbixç›‘æ§ã€‚</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@countly2 zabbix]<span class="comment"># ll</span></div><div class="line">total 8</div><div class="line">-rwxrwxr-x 1 jollybi jollybi 1932 Jun  7 10:40 monitor_kafka.sh</div><div class="line">-rw-r--r-- 1 root    root     218 Jun  7 14:19 zabbix_agentd.conf</div><div class="line">drwxr-xr-x 2 root    root      45 Sep 20  2016 zabbix_agentd.d</div></pre></td></tr></table></figure><h4 id="ç„¶åzabbix-agentd-confæ‰©å±•é…ç½®"><a href="#ç„¶åzabbix-agentd-confæ‰©å±•é…ç½®" class="headerlink" title="ç„¶åzabbix_agentd.confæ‰©å±•é…ç½®"></a>ç„¶åzabbix_agentd.confæ‰©å±•é…ç½®</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">UserParameter=kafka.[*],/etc/zabbix/monitor_kafka.sh <span class="variable">$1</span></div></pre></td></tr></table></figure><blockquote><p>ä¹Ÿå¯ä»¥è¿™ä¹ˆå†™ï¼š</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">UserParameter=kafka.imp_lag,/etc/zabbix/monitor_kafka.sh imp_lag</div><div class="line">UserParameter=kafka.imp_offset,/etc/zabbix/monitor_kafka.sh imp_offset</div><div class="line">UserParameter=kafka.imp_logsize,/etc/zabbix/monitor_kafka.sh imp_logsize</div><div class="line">UserParameter=kafka.event_spm_lag,/etc/zabbix/monitor_kafka.sh event_spm_lag</div><div class="line">UserParameter=kafka.event_spm_logsize,/etc/zabbix/monitor_kafka.sh event_spm_logsize</div><div class="line">UserParameter=kafka.event_spm_offset,/etc/zabbix/monitor_kafka.sh event_spm_offset </div><div class="line">UserParameter=kafka.event_lag,/etc/zabbix/monitor_kafka.sh event_lag</div><div class="line">UserParameter=kafka.event_offset,/etc/zabbix/monitor_kafka.sh event_offset</div><div class="line">UserParameter=kafka.event_logsize,/etc/zabbix/monitor_kafka.sh event_logsize</div></pre></td></tr></table></figure><p>è¿™é‡Œå†™é”®å€¼å°±ä¸éœ€è¦åŠ []</p><p>ç„¶åé…ç½®å®Œæˆé‡å¯zabbix-agentæœåŠ¡ã€‚</p><h4 id="zabbixè®¾ç½®Key"><a href="#zabbixè®¾ç½®Key" class="headerlink" title="zabbixè®¾ç½®Key"></a>zabbixè®¾ç½®Key</h4><p>zabbix-ç»„æ€-æ¨¡æ¿-åˆ›å»ºæ¨¡æ¿ã€‚</p><p>åˆ›å»ºï¼šKafkaConsumersæ¨¡æ¿<br>ç„¶åç‚¹å‡»KafkaConsumersæ¨¡æ¿ï¼Œåˆ›å»ºç›¸åº”çš„é¡¹ç›®:kafka.event_lag æœªæ¶ˆè´¹çš„æ¡æ•° </p><p>è®¾ç½®zabbixä»£ç†ã€‚é»˜è®¤çš„ä»£ç†æ–¹å¼ã€‚</p><p>zabbix,key é”®å€¼</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kafka.[event_lag]</div></pre></td></tr></table></figure><p>æ•°æ®ç±»å‹é»˜è®¤æµ®ç‚¹å°±å¯ä»¥äº†ã€‚ åé¢åº”ç”¨é›†é€‰æ‹©ä¸‹KafkaConsumers å³å¯ã€‚</p><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/kafka-Consumer.01.png" alt=""></figure><br>é™†é™†ç»­ç»­é…ç½®å®Œæ‰€æœ‰é¡¹ç›®ã€‚</p><h3 id="ç„¶åé…ç½®å›¾å½¢ã€‚"><a href="#ç„¶åé…ç½®å›¾å½¢ã€‚" class="headerlink" title="ç„¶åé…ç½®å›¾å½¢ã€‚"></a>ç„¶åé…ç½®å›¾å½¢ã€‚</h3><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/kafka-Consumer.02.png" alt=""></figure></p><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/kafka-Consumer.04.png" alt=""></figure></p><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/kafka-Consumer.05.png" alt=""></figure></p><h3 id="æŸ¥çœ‹æœ€æ–°æ•°æ®å›¾ï¼š"><a href="#æŸ¥çœ‹æœ€æ–°æ•°æ®å›¾ï¼š" class="headerlink" title="æŸ¥çœ‹æœ€æ–°æ•°æ®å›¾ï¼š"></a>æŸ¥çœ‹æœ€æ–°æ•°æ®å›¾ï¼š</h3><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/kafka-Consumer.06.png" alt=""></figure><br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/kafka-Consumer.07.png" alt=""></figure></p><p>å‡ºç°é—®é¢˜ç¬¬ä¸€æ—¶é—´å‘é€æŠ¥è­¦æ¶ˆæ¯ã€‚<br>æŠ¥è­¦çš„Triggerè§¦å‘è§„åˆ™ä¹Ÿæ˜¯å¯¹lagçš„å€¼åšæŠ¥è­¦ï¼Œå…·ä½“é˜€å€¼è®¾ç½®ä¸ºå¤šå°‘ï¼Œè¿˜æ˜¯çœ‹å¤§å®¶å„è‡ªä¸šåŠ¡éœ€æ±‚äº†ã€‚</p><h3 id="è¿™é‡Œæˆ‘å¯¹æœªæ¶ˆè´¹å‘Šè­¦å®šæ—¶60åˆ†é’Ÿè§¦å‘ä¸€æ¬¡ã€‚"><a href="#è¿™é‡Œæˆ‘å¯¹æœªæ¶ˆè´¹å‘Šè­¦å®šæ—¶60åˆ†é’Ÿè§¦å‘ä¸€æ¬¡ã€‚" class="headerlink" title="è¿™é‡Œæˆ‘å¯¹æœªæ¶ˆè´¹å‘Šè­¦å®šæ—¶60åˆ†é’Ÿè§¦å‘ä¸€æ¬¡ã€‚"></a>è¿™é‡Œæˆ‘å¯¹æœªæ¶ˆè´¹å‘Šè­¦å®šæ—¶60åˆ†é’Ÿè§¦å‘ä¸€æ¬¡ã€‚</h3><p>âš ï¸æ³¨é‡Šï¼šè®¾ç½®group_event_lagæœ€è¿‘æ¶ˆæ¯æ¡æ•°çš„60åˆ†é’Ÿæ—¶é—´ä¹‹å†…ä¸€ç›´è¶…è¿‡200ä¸‡æ¶ˆè´¹åˆ™æŠ¥è­¦</p><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/kafka-Consumer.08.png" alt=""></figure><br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/kafka-Consumer.09.png" alt=""></figure></p><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/kafka-Consumer.10.png" alt=""></figure></p><h3 id="äº¤æµå­¦ä¹ ï¼š"><a href="#äº¤æµå­¦ä¹ ï¼š" class="headerlink" title="äº¤æµå­¦ä¹ ï¼š"></a>äº¤æµå­¦ä¹ ï¼š</h3><p>ğŸ§  Linux shell_é«˜çº§è¿ç»´æ´¾: <code>459096184</code>    åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)<br>ğŸ§  BigData-Exchange School : <code>521621407</code>  åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥</p><p>ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://adminotes.com/wp-content/uploads/2016/08/Screenshot-from-2016-08-12-16-41-55.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;Zabbix-Monitoring-Kafkaé›†ç¾¤-Consumer-kafkaçš„ç›‘æ§å’Œå‘Šè­¦&quot;&gt;&lt;a href=&quot;#Zabbix-Monitoring-Kafkaé›†ç¾¤-Consumer-kafkaçš„ç›‘æ§å’Œå‘Šè­¦&quot; class=&quot;headerlink&quot; title=&quot;Zabbix-Monitoring Kafkaé›†ç¾¤ Consumer | kafkaçš„ç›‘æ§å’Œå‘Šè­¦&quot;&gt;&lt;/a&gt;Zabbix-Monitoring Kafkaé›†ç¾¤ Consumer | kafkaçš„ç›‘æ§å’Œå‘Šè­¦&lt;/h3&gt;&lt;p&gt;å‰é¢ä¸€ç¯‡è®²äº†æˆ‘ä»¬ç›‘æ§kafkaé›†ç¾¤BrokersæœåŠ¡çŠ¶æ€ç›‘æ§ã€‚ç”Ÿäº§ç¯å¢ƒç›‘æ§ï¼Œå¯ä»¥åœ¨Zabbixä¸­å¯¹Kafkaè¿›è¡Œç›‘æ§ï¼Œä¸€ç§æ˜¯ç›‘æ§JMXç«¯å£ï¼Œå¦å¤–ä¸€ç§æ˜¯ç›´æ¥å†™è„šæœ¬ï¼Œä½¿ç”¨bin/kafka-run-class.shé‡Œæä¾›çš„ç›¸å…³æ–¹æ³•ç±»ã€‚&lt;/p&gt;
&lt;p&gt;æ ¹æ®æˆ‘ä»¬çš„ä¸šåŠ¡åœºæ™¯ï¼Œæœ€ä¸ºä¸»è¦çš„çš„æ˜¯ç›‘æ§æ¶ˆè´¹è€…Lagçš„æƒ…å†µã€‚æ‰€æœ‰æˆ‘ç›´æ¥å†™è„šæœ¬äº†ã€‚&lt;br&gt;æˆ‘ä»¬å¯¹æŸä¸€ä¸ªTopicçš„30ä¸ªåˆ†åŒºï¼Œæ¯ä¸ªåˆ†åŒºï¼Œå½“å‰Consumerçš„Lagæƒ…å†µã€‚&lt;br&gt;å½“ç„¶è¿˜å¯ä»¥ç”Ÿæˆæ±‡æ€»å›¾ï¼Œåœ¨æ­¤ä¸åšå¤šå±•ç¤ºã€‚åœ¨Zabbixä¸­é…ç½®å¯¹åº”çš„Triggersï¼Œå½“Lagè¶…è¿‡é˜€å€¼ï¼Œå®ç°æŠ¥è­¦ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Kafka" scheme="http://blog.yancy.cc/categories/Kafka/"/>
    
    
      <category term="Kafka" scheme="http://blog.yancy.cc/tags/Kafka/"/>
    
      <category term="Zabbix" scheme="http://blog.yancy.cc/tags/Zabbix/"/>
    
  </entry>
  
  <entry>
    <title>Bigdata-Kafkaé›†ç¾¤å¿«é€Ÿæ­å»ºä¸å‘½ä»¤è®²è§£</title>
    <link href="http://blog.yancy.cc/2017/05/28/Bigdata-hadoop/Kafka/Bigdata-Kafka%E9%9B%86%E7%BE%A4%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E4%B8%8E%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5%E5%91%BD%E4%BB%A4%E8%AE%B2%E8%A7%A3/"/>
    <id>http://blog.yancy.cc/2017/05/28/Bigdata-hadoop/Kafka/Bigdata-Kafkaé›†ç¾¤å¿«é€Ÿæ­å»ºä¸å¢åˆ æ”¹æŸ¥å‘½ä»¤è®²è§£/</id>
    <published>2017-05-28T06:46:00.000Z</published>
    <updated>2017-09-23T16:20:36.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Bigdata-Kafkaé›†ç¾¤å¿«é€Ÿæ­å»ºä¸å‘½ä»¤è®²è§£"><a href="#Bigdata-Kafkaé›†ç¾¤å¿«é€Ÿæ­å»ºä¸å‘½ä»¤è®²è§£" class="headerlink" title="Bigdata-Kafkaé›†ç¾¤å¿«é€Ÿæ­å»ºä¸å‘½ä»¤è®²è§£"></a>Bigdata-Kafkaé›†ç¾¤å¿«é€Ÿæ­å»ºä¸å‘½ä»¤è®²è§£</h1><h3 id="kafkaé›†ç¾¤å’Œzookeeperé›†ç¾¤è§„èŒƒ"><a href="#kafkaé›†ç¾¤å’Œzookeeperé›†ç¾¤è§„èŒƒ" class="headerlink" title="kafkaé›†ç¾¤å’Œzookeeperé›†ç¾¤è§„èŒƒ"></a>kafkaé›†ç¾¤å’Œzookeeperé›†ç¾¤è§„èŒƒ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">kafkaé›†ç¾¤å’Œzookeeperé›†ç¾¤è§„èŒƒ</div><div class="line">kafkaç‰ˆæœ¬ï¼škafka_2.10-0.8.2.1</div><div class="line">zookeeperç‰ˆæœ¬ï¼šzookeeper-3.4.5</div><div class="line"></div><div class="line">å¯åŠ¨ç”¨æˆ·ï¼šjollybi</div><div class="line">kafkaå®‰è£…ç›®å½•ï¼š/data/tools/</div><div class="line">kafkaæ–°å»ºæ¶ˆæ¯ç›®å½•ï¼š/data/tools/kafka_2.10-0.8.2.1/kafka-logs</div><div class="line"></div><div class="line">å¯åŠ¨ç”¨æˆ·ï¼šjollybi</div><div class="line">zookeeperå®‰è£…ç›®å½•ï¼š/data/tools/</div><div class="line">zookeeperæ–°å»ºæ—¥å¿—ç›®å½•ï¼š/data/tools/zookeeper-3.4.5/tmp/logs</div><div class="line"></div><div class="line">ç»Ÿä¸€é…ç½®hosts</div><div class="line"></div><div class="line"></div><div class="line">10.155.90.153 kafka1.jollychic.com kafka1</div><div class="line">10.155.90.155 kafka2.jollychic.com kafka2</div><div class="line">10.155.90.138 kafka3.jollychic.com kafka3</div></pre></td></tr></table></figure><p>æœ¬æ–‡ä½¿ç”¨äº†3å°æœºå™¨éƒ¨ç½²Kafkaé›†ç¾¤ï¼ŒIPå’Œä¸»æœºåå¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">10.155.90.153 kafka1.jollychic.com kafka1</div><div class="line">10.155.90.155 kafka2.jollychic.com kafka2</div><div class="line">10.155.90.138 kafka3.jollychic.com kafka3</div></pre></td></tr></table></figure><h3 id="Step1-é…ç½®-etc-hosts-ï¼ˆ3å°ä¸€è‡´ï¼‰"><a href="#Step1-é…ç½®-etc-hosts-ï¼ˆ3å°ä¸€è‡´ï¼‰" class="headerlink" title="Step1: é…ç½®/etc/hosts ï¼ˆ3å°ä¸€è‡´ï¼‰"></a>Step1: é…ç½®/etc/hosts ï¼ˆ3å°ä¸€è‡´ï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">127.0.0.1 localhost.localdomain localhost</div><div class="line">10.155.90.153 kafka1.jollychic.com kafka1</div><div class="line">10.155.90.155 kafka2.jollychic.com kafka2</div><div class="line">10.155.90.138 kafka3.jollychic.com kafka3</div></pre></td></tr></table></figure><h3 id="Step2-ç¯å¢ƒKafKaé›†ç¾¤ç¯å¢ƒ"><a href="#Step2-ç¯å¢ƒKafKaé›†ç¾¤ç¯å¢ƒ" class="headerlink" title="Step2: ç¯å¢ƒKafKaé›†ç¾¤ç¯å¢ƒ"></a>Step2: ç¯å¢ƒKafKaé›†ç¾¤ç¯å¢ƒ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ä¸‹è½½åœ°å€ï¼šhttp://mirrors.hust.edu.cn/apache/kafka/0.9.0.0/kafka_2.10-0.8.2.1.tgz</div><div class="line">[jollybi@kafka1 ]<span class="comment"># tar -xvf kafka_2.10-0.8.2.1.tgz -C /data/tools/</span></div><div class="line"><span class="built_in">cd</span> /data/tools/kafka_2.10-0.8.2.1/config</div></pre></td></tr></table></figure><h3 id="è®¾ç½®dataç›®å½•ï¼Œæœ€å¥½ä¸è¦ç”¨é»˜è®¤çš„-tmp-kafka-logs"><a href="#è®¾ç½®dataç›®å½•ï¼Œæœ€å¥½ä¸è¦ç”¨é»˜è®¤çš„-tmp-kafka-logs" class="headerlink" title="è®¾ç½®dataç›®å½•ï¼Œæœ€å¥½ä¸è¦ç”¨é»˜è®¤çš„/tmp/kafka-logs"></a>è®¾ç½®dataç›®å½•ï¼Œæœ€å¥½ä¸è¦ç”¨é»˜è®¤çš„/tmp/kafka-logs</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mkdir -p /data/tools/kafka_2.10-0.8.2.1/kafka-logs/</div></pre></td></tr></table></figure><p><em>ä¿®æ”¹kafkaé…ç½®æ–‡ä»¶</em></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">[root@kafka_01 config]<span class="comment"># vim server.properties</span></div><div class="line"></div><div class="line"></div><div class="line"> è®¾ç½®brokeridï¼ˆä»0å¼€å§‹ï¼Œ3ä¸ªèŠ‚ç‚¹åˆ†åˆ«è®¾ä¸º1,2,3ï¼Œä¸èƒ½é‡å¤ï¼‰åœ¨è¿™é‡Œid=0è·Ÿzookeeper idè®¾ç½®ä¸€æ ·å°±è¡Œã€‚ é›†ç¾¤æœºå™¨ï¼šæŒ‰é¡ºåºå†™1</div><div class="line">broker.id=1  </div><div class="line"></div><div class="line">auto.leader.rebalance.enable=<span class="literal">true</span> </div><div class="line"></div><div class="line"><span class="comment">#ä¿®æ”¹æœ¬åœ°IPåœ°å€ï¼š</span></div><div class="line">listeners=PLAINTEXT://10.46.72.172:9092</div><div class="line">port=9292 //è®¾ç½®è®¿é—®ç«¯å£</div><div class="line">host.name=10.155.90.153   kafkaæœ¬æœºIP</div><div class="line">log.dirs=/data/tools/kafka_2.10-0.8.2.1/kafka-logs</div><div class="line"></div><div class="line"><span class="comment">#è®¾ç½®æ³¨å†Œåœ°å€ï¼ˆé‡è¦ï¼Œé»˜è®¤ä¼šæŠŠæœ¬æœºçš„hostanmeæ³¨å†Œåˆ°zkä¸­ï¼Œå®¢æˆ·ç«¯è¿æ¥æ—¶éœ€è¦è§£æè¯¥hostanmeï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥æ³¨å†Œæœ¬æœºçš„IPåœ°å€ï¼Œé¿å…hostnameè§£æå¤±è´¥ï¼ŒæŠ¥é”™java.nio.channels.UnresolvedAddressExceptionæˆ–java.io.IOException: Can not resolve addressï¼‰</span></div><div class="line"><span class="comment">#è®¾ç½®zookeeperåœ°å€</span></div><div class="line"><span class="comment">#zookeeper.connect=10.46.72.172:2181,10.47.88.103:2181,10.47.102.137:2181</span></div><div class="line">zookeeper.connect=kafka1.jollychic.com:2281,kafka2.jollychic.com:2281,kafka3.jollychic.com:2281</div><div class="line"></div><div class="line">//è¿™é‡Œæˆ‘è®¾ç½®hostsä»£æ›¿IP</div></pre></td></tr></table></figure><p><em>é…ç½®zookeeperåœ°å€</em></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">vim zookeeper.properties </div><div class="line">dataDir=/data/tools/zookeeper-3.4.5/tmp</div><div class="line"><span class="comment"># the port at which the clients will connect</span></div><div class="line">clientPort=2281</div><div class="line"><span class="comment"># disable the per-ip limit on the number of connections since this is a non-production config</span></div><div class="line">maxClientCnxns=0</div><div class="line">~</div></pre></td></tr></table></figure><p><em>é…ç½®kafkaè®¿é—®åœ°å€</em></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">vim</span> producer.properties </div><div class="line">metadata.broker.list=<span class="number">169.44.62.139:9292</span>,<span class="number">169.44.59.138:9292</span>,<span class="number">169.44.62.137:9292</span>   </div><div class="line"><span class="comment"># name of the partitioner class for partitioning events; default partition spreads data randomly</span></div><div class="line"><span class="comment">#partitioner.class=</span></div><div class="line"></div><div class="line"><span class="comment"># specifies whether the messages are sent asynchronously (async) or synchronously (sync)</span></div><div class="line">producer.type=sync</div><div class="line"></div><div class="line"><span class="comment"># specify the compression codec for all data generated: none, gzip, snappy, lz4.</span></div><div class="line"><span class="comment"># the old config values work as well: 0, 1, 2, 3 for none, gzip, snappy, lz4, respectively</span></div><div class="line">compression.codec=<span class="literal">none</span></div><div class="line"></div><div class="line"><span class="comment"># message encoder</span></div><div class="line">serializer.class=kafka.serializer.DefaultEncoder</div></pre></td></tr></table></figure><h3 id="Step3-é›†ç¾¤æœºå™¨å¿«é€Ÿæ‹·è´é…ç½®"><a href="#Step3-é›†ç¾¤æœºå™¨å¿«é€Ÿæ‹·è´é…ç½®" class="headerlink" title="Step3: é›†ç¾¤æœºå™¨å¿«é€Ÿæ‹·è´é…ç½®:"></a>Step3: é›†ç¾¤æœºå™¨å¿«é€Ÿæ‹·è´é…ç½®:</h3><p>è¿œç¨‹å¤åˆ¶åˆ†å‘å®‰è£…æ–‡ä»¶<br>æœ€å¥½æ˜¯æŠŠæ–‡ä»¶æ‰“åŒ…scpè¿‡å»<br>æ¥ä¸‹æ¥å°†ä¸Šé¢çš„å®‰è£…æ–‡ä»¶æ‹·è´åˆ°é›†ç¾¤ä¸­çš„å…¶ä»–æœºå™¨ä¸Šå¯¹åº”çš„ç›®å½•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">scp -P58958 -r kafka_2.10-0.8.2.1 jollybi@169.44.62.137:/home/jollybi/tools/. </div><div class="line">scp -P58958 -r kafka_2.10-0.8.2.1 jollybi@169.44.62.138:/home/jollybi/tools/.</div></pre></td></tr></table></figure><p>ç»Ÿä¸€ä¿®æ”¹åˆ†åˆ«å…¶ä»–ä¸¤å°kafka <code>server.properties</code></p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">broker.id=<span class="number">2</span>  </div><div class="line">host.name=<span class="number">169.44</span><span class="number">.62</span><span class="number">.137</span>   kafka2æœ¬æœºIP</div><div class="line"></div><div class="line">broker.id=<span class="number">3</span> </div><div class="line">host.name=<span class="number">169.44</span><span class="number">.62</span><span class="number">.138</span>   kafka3æœ¬æœºIP</div></pre></td></tr></table></figure><h3 id="Step4-å¯åŠ¨-kafkaé›†ç¾¤"><a href="#Step4-å¯åŠ¨-kafkaé›†ç¾¤" class="headerlink" title="Step4:å¯åŠ¨ kafkaé›†ç¾¤"></a>Step4:å¯åŠ¨ kafkaé›†ç¾¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">./kafka-server-start.sh -daemon ../config/server.properties</div><div class="line"></div><div class="line">[jollybi@kafka1 config]$ jps</div><div class="line">3443 QuorumPeerMain</div><div class="line">16280 Jps</div><div class="line">3628 Kafka</div><div class="line">Step5: Kafkaå¸¸ç”¨å‘½ä»¤(æ™®åŠ)</div></pre></td></tr></table></figure><h4 id="Step5-æµ‹è¯•é›†ç¾¤åŸºæœ¬å‘½ä»¤"><a href="#Step5-æµ‹è¯•é›†ç¾¤åŸºæœ¬å‘½ä»¤" class="headerlink" title="Step5:æµ‹è¯•é›†ç¾¤åŸºæœ¬å‘½ä»¤"></a>Step5:æµ‹è¯•é›†ç¾¤åŸºæœ¬å‘½ä»¤</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div></pre></td><td class="code"><pre><div class="line"><span class="comment">### é»˜è®¤åˆ›å»ºkafka Topic:  1ä¸ªå‰¯æœ¬å¤‡ä»½ 1ä¸ªåˆ†åŒºæ¶ˆè´¹</span></div><div class="line"></div><div class="line">./kafka_2.10-0.8.2.1/bin/kafka-topics.sh --create --zookeeper  kafka1.jollychic.com:2281,kafka2.jollychic.com:2281,kafka3.jollychic.com:2281 --replication-factor 1 --partitions 1 --topic mongotail_lz4</div><div class="line">./kafka_2.10-0.8.2.1/bin/kafka-topics.sh --create --zookeeper  kafka1.jollychic.com:2281,kafka2.jollychic.com:2281,kafka3.jollychic.com:2281 --replication-factor 1 --partitions 1 --topic mongotail_lz4_imp</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">### å¤§æ•°æ®è¿™è¾¹éœ€è¦12ä¸ªåˆ†åŒºè¿™é‡Œæˆ‘åˆ é™¤Topicé‡æ–°åˆ›å»ºTopicï¼š</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">### åˆ é™¤kafka Topic:</span></div><div class="line"></div><div class="line"></div><div class="line">ç¬¬ä¸€æ­¥ï¼šåˆ é™¤kafka topic</div><div class="line">./kafka_2.10-0.8.2.1/bin/kafka-topics.sh --zookeeper  kafka1.jollychic.com:2281,kafka2.jollychic.com:2281,kafka3.jollychic.com:2281 --delete --topic  mongotail_lz4 </div><div class="line"></div><div class="line">./kafka_2.10-0.8.2.1/bin/kafka-topics.sh --zookeeper  kafka1.jollychic.com:2281,kafka2.jollychic.com:2281,kafka3.jollychic.com:2281 --delete --topic  mongotail_lz4_imp</div><div class="line"></div><div class="line"><span class="comment">### è¿™æ˜¯ç”±äºåˆ é™¤topicæ²¡åˆ å¹²å‡€ä¼šæŠ¥é”™ï¼š</span></div><div class="line"></div><div class="line">org.apache.kafka.common.errors.UnknownTopicOrPartitionException: This server does not host this topic-partition.</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">### åˆ é™¤çº¿ç¨‹æ‰§è¡Œåˆ é™¤æ“ä½œçš„çœŸæ­£é€»è¾‘æ˜¯ï¼š</span></div><div class="line">1. å®ƒé¦–å…ˆä¼šç»™å½“å‰æ‰€æœ‰brokerå‘é€æ›´æ–°å…ƒæ•°æ®ä¿¡æ¯çš„è¯·æ±‚ï¼Œå‘Šè¯‰è¿™äº›brokerè¯´è¿™ä¸ªtopicè¦åˆ é™¤äº†ï¼Œä½ ä»¬å¯ä»¥æŠŠå®ƒçš„ä¿¡æ¯ä»ç¼“å­˜ä¸­åˆ æ‰äº†</div><div class="line">2. å¼€å§‹åˆ é™¤è¿™ä¸ªtopicçš„æ‰€æœ‰åˆ†åŒº</div><div class="line">2.1 ç»™æ‰€æœ‰brokerå‘è¯·æ±‚ï¼Œå‘Šè¯‰å®ƒä»¬è¿™äº›åˆ†åŒºè¦è¢«åˆ é™¤ã€‚brokeræ”¶åˆ°åå°±ä¸å†æ¥å—ä»»ä½•åœ¨è¿™äº›åˆ†åŒºä¸Šçš„å®¢æˆ·ç«¯è¯·æ±‚äº†</div><div class="line">2.2 æŠŠæ¯ä¸ªåˆ†åŒºä¸‹çš„æ‰€æœ‰å‰¯æœ¬éƒ½ç½®äºOfflineReplicaçŠ¶æ€ï¼Œè¿™æ ·ISRå°±ä¸æ–­ç¼©å°ï¼Œå½“leaderå‰¯æœ¬æœ€åä¹Ÿè¢«ç½®äºOfflineReplicaçŠ¶æ€æ—¶leaderä¿¡æ¯å°†è¢«æ›´æ–°ä¸º-1</div><div class="line">2.3 å°†æ‰€æœ‰å‰¯æœ¬ç½®äºReplicaDeletionStartedçŠ¶æ€</div><div class="line">2.4 å‰¯æœ¬çŠ¶æ€æœºæ•è·çŠ¶æ€å˜æ›´ï¼Œç„¶åå‘èµ·StopReplicaRequestç»™brokerï¼Œbrokeræ¥åˆ°è¯·æ±‚ååœæ­¢æ‰€æœ‰fetcherçº¿ç¨‹ã€ç§»é™¤ç¼“å­˜ï¼Œç„¶ååˆ é™¤åº•å±‚<span class="built_in">log</span>æ–‡ä»¶</div><div class="line">2.5 å…³é—­æ‰€æœ‰ç©ºé—²çš„Fetcherçº¿ç¨‹</div><div class="line">    </div><div class="line"><span class="comment">### ç¬¬äºŒæ­¥ï¼šåˆ é™¤zookeeperç›¸å…³çš„è·¯å¾„ï¼š</span></div><div class="line">[jollybi@kafka1 zookeeper-3.4.5]$ ./bin/zkCli.sh -server 127.0.0.1:2281 </div><div class="line">[zk: 127.0.0.1:2281(CONNECTED) 1] rmr /brokers/topics/mongotail_lz4</div><div class="line">[zk: 127.0.0.1:2281(CONNECTED) 0] rmr /consumers/group_ml_general/offsets/mongotail_lz4</div><div class="line">[zk: 127.0.0.1:2281(CONNECTED) 1] rmr /consumers/group_ml_general/owners/mongotail_lz4</div><div class="line">[zk: 127.0.0.1:2281(CONNECTED) 3] rmr  /config/topics/mongotail_lz4</div><div class="line">[zk: 127.0.0.1:2281(CONNECTED) 4] rmr /admin/delete_topics/mongotail_lz4</div><div class="line"></div><div class="line"><span class="comment">### åˆ é™¤topicä¸Šé¢æ¶ˆè´¹ç»„ </span></div><div class="line"></div><div class="line">åˆ é™¤ ZooKeeper ä¸‹é¢çš„ /consumers/[group_id] è·¯å¾„å°±å¯ä»¥äº†ã€‚ZooKeeper åŸç”ŸAPIåªæ”¯æŒåˆ é™¤ç©ºçš„è·¯å¾„ï¼Œæ‰€ä»¥å»ºè®®ä½ ä½¿ç”¨ curator framework è¿›è¡Œè¿™ä¸ªåˆ é™¤æ“ä½œï¼ŒZkPaths.deleteChildren ä¼šé€’å½’å¼åœ°åˆ é™¤æ•´ä¸ªè·¯å¾„ï¼ˆåŒ…æ‹¬å­è·¯å¾„ï¼‰ã€‚</div><div class="line"></div><div class="line">[zk: 127.0.0.1:2281(CONNECTED) 0] rmr /consumers/kafka-node1-imp-group</div><div class="line">[zk: 127.0.0.1:2281(CONNECTED) 1] rmr /consumers/kafka-node1-group</div><div class="line">[zk: 127.0.0.1:2281(CONNECTED) 2] rmr /consumers/console-consumer-59053</div><div class="line">[zk: 127.0.0.1:2281(CONNECTED) 3] rmr /consumers/</div><div class="line"></div><div class="line"></div><div class="line">1ã€è®¾ç½®é…ç½®æ–‡ä»¶å…è®¸åˆ é™¤</div><div class="line">delete.topic.enable=<span class="literal">true</span> é…ç½®æ·»åŠ åˆ° config/server.properties</div><div class="line">2ã€æ‰§è¡Œåˆ é™¤å‘½ä»¤</div><div class="line">./bin/kafka-topics.sh --zookeeper localhost:2181 --delete --topic <span class="built_in">test</span>-topic</div><div class="line"></div><div class="line">åœ¨zookeeperä¸­ç¡®è®¤ï¼š</div><div class="line"></div><div class="line"> åˆ é™¤zookeeperä¸‹/brokers/topics/<span class="built_in">test</span>-topicèŠ‚ç‚¹</div><div class="line"> åˆ é™¤zookeeperä¸‹/config/topics/<span class="built_in">test</span>-topicèŠ‚ç‚¹</div><div class="line"> åˆ é™¤zookeeperä¸‹/admin/delete_topics/<span class="built_in">test</span>-topicèŠ‚ç‚¹</div><div class="line"> </div><div class="line">consumer çš„è¯ åˆ é™¤groupid</div><div class="line"> </div><div class="line"></div><div class="line"><span class="comment">### é‡å¯kafkaé›†ç¾¤</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">### å¤§æ•°æ®kafkaå»ºtopicï¼Œä¸èƒ½å»ºä¸€ä¸ªåˆ†åŒºï¼Œé‚£æ ·ååé‡ä¸Šä¸å»ï¼Œä¸å¤Ÿç”¨ï¼Œæˆ‘ä»¬ä»¥å‰å»ºäº†12ä¸ªåˆ†åŒºçš„</span></div><div class="line"><span class="comment">### åˆ›å»ºæ–° kafka Topic: 3ä¸ªå‰¯æœ¬ï¼Œ12ä¸ªåˆ†åŒº</span></div><div class="line"></div><div class="line"> ./kafka_2.10-0.8.2.1/bin/kafka-topics.sh --create --zookeeper  kafka1.jollychic.com:2281,kafka2.jollychic.com:2281,kafka3.jollychic.com:2281 --replication-factor 3 --partitions 12  --topic mongotail_lz4</div><div class="line">./kafka_2.10-0.8.2.1/bin/kafka-topics.sh --create --zookeeper  kafka1.jollychic.com:2281,kafka2.jollychic.com:2281,kafka3.jollychic.com:2281 --replication-factor 3 --partitions 12  --topic mongotail_lz4_imp</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">### æŸ¥çœ‹åˆ›å»ºçš„Topic:</span></div><div class="line">./kafka_2.10-0.8.2.1/bin/kafka-topics.sh  --describe --zookeeper kafka1.jollychic.com:2281,kafka2.jollychic.com:2281,kafka3.jollychic.com:2281  --topic mongotail_lz4</div><div class="line">./kafka_2.10-0.8.2.1/bin/kafka-topics.sh  --describe --zookeeper kafka1.jollychic.com:2281,kafka2.jollychic.com:2281,kafka3.jollychic.com:2281  --topic mongotail_lz4_imp</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">### æŸ¥çœ‹é›†ç¾¤æƒ…å†µï¼š</span></div><div class="line">./kafka_2.10-0.8.2.1/bin/kafka-topics.sh  --describe --zookeeper kafka1.jollychic.com:2281,kafka2.jollychic.com:2281,kafka3.jollychic.com:2281  --topic mongotail_lz4</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">### æ¨¡æ‹Ÿç”Ÿäº§è€…ï¼ˆproducerï¼‰kafkaç”Ÿäº§å®¢æˆ·ç«¯ç”Ÿäº§æ•°æ®å‘½ä»¤ï¼š</span></div><div class="line"></div><div class="line">./bin/kafka-console-producer.sh --broker-list 75.126.39.124:9292,75.126.5.162:9292,75.126.5.178:9292 --topic mongotail_lz4_imp                      </div><div class="line">......</div><div class="line">my <span class="built_in">test</span> message 1</div><div class="line">my <span class="built_in">test</span> message 2</div><div class="line">^C</div><div class="line"><span class="comment">### æ¨¡æ‹Ÿæ¶ˆè´¹è€…ï¼ˆconsumerï¼‰kafkaæ¶ˆè´¹å®¢æˆ·ç«¯æ•°æ®å‘½ä»¤ ç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹æ¶ˆæ¯ï¼š</span></div><div class="line"></div><div class="line"> ./bin/kafka-console-consumer.sh --zookeeper  75.126.39.124:2281,75.126.5.162:2281,75.126.5.178:2281  --fm-beginning --topic mongotail_lz4_imp</div><div class="line">......</div><div class="line">my <span class="built_in">test</span> message 1</div><div class="line">my <span class="built_in">test</span> message 2</div><div class="line"></div><div class="line">^C</div></pre></td></tr></table></figure><h3 id="Kafkaå¸¸ç”¨å‘½ä»¤"><a href="#Kafkaå¸¸ç”¨å‘½ä»¤" class="headerlink" title="Kafkaå¸¸ç”¨å‘½ä»¤"></a>Kafkaå¸¸ç”¨å‘½ä»¤</h3><p>ä»¥ä¸‹æ˜¯kafkaå¸¸ç”¨å‘½ä»¤è¡Œæ€»ç»“ï¼š  </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">1ã€ list topic æ˜¾ç¤ºæ‰€æœ‰topic</div><div class="line">./bin/kafka-topics.sh --list --zookeeper kafka1.jollychic.com:2281,kafka2.jollychic.com:2281,kafka3.jollychic.com:2281</div><div class="line"></div><div class="line">2ã€ æŸ¥çœ‹topicçš„è¯¦ç»†ä¿¡æ¯  </div><div class="line"> ./bin/kafka-topics.sh --zookeeper  75.126.39.124:2281,75.126.5.162:2281,75.126.5.178:2281  -describe -topic mongotail_lz4_imp</div><div class="line"></div><div class="line">3ã€ä¸ºtopicå¢åŠ partitionåˆ†åŒº å‚æ•°ï¼š--alter --partitions</div><div class="line">./bin/kafka-topics.sh  --alter --zookeeper  75.126.39.124:2281,75.126.5.162:2281,75.126.5.178:2281  --partitions 20 --topic mongotail_lz4_imp</div><div class="line"></div><div class="line">4ã€kafkaç”Ÿäº§è€…å®¢æˆ·ç«¯å‘½ä»¤  </div><div class="line">./bin/kafka-console-producer.sh --broker-list 75.126.39.124:9292,75.126.5.162:9292,75.126.5.178:9292 --topic mongotail_lz4_imp                        </div><div class="line"></div><div class="line">5ã€kafkaæ¶ˆè´¹è€…å®¢æˆ·ç«¯å‘½ä»¤  </div><div class="line">./bin/kafka-console-consumer.sh --zookeeper  75.126.39.124:2281,75.126.5.162:2281,75.126.5.178:2281  --fm-beginning --topic </div><div class="line"></div><div class="line">6ã€kafkaæœåŠ¡å¯åŠ¨  </div><div class="line">./kafka-server-start.sh -daemon ../config/server.properties   </div><div class="line"></div><div class="line">7ã€ä¸‹çº¿broker  </div><div class="line">./kafka-run-class.sh kafka.admin.ShutdownBroker --zookeeper 127.0.0.1:2181 --broker <span class="comment">#brokerId# --num.retries 3 --retry.interval.ms 60  </span></div><div class="line">shutdown broker  </div><div class="line"></div><div class="line">8ã€åˆ é™¤topic  </div><div class="line">./kafka-run-class.sh kafka.admin.DeleteTopicCommand --topic <span class="built_in">test</span>KJ1 --zookeeper 127.0.0.1:2181  </div><div class="line">./kafka-topics.sh --zookeeper localhost:2181 --delete --topic <span class="built_in">test</span>KJ1  </div><div class="line"></div><div class="line">9ã€æŸ¥çœ‹consumerç»„å†…æ¶ˆè´¹çš„offset  </div><div class="line">./kafka-run-class.sh kafka.tools.ConsumerOffsetChecker --zookeeper localhost:2181 --group <span class="built_in">test</span> --topic <span class="built_in">test</span>KJ1</div></pre></td></tr></table></figure><h4 id="Step6-Kafkaå­˜å‚¨"><a href="#Step6-Kafkaå­˜å‚¨" class="headerlink" title="Step6:Kafkaå­˜å‚¨"></a>Step6:Kafkaå­˜å‚¨</h4><p>æ¯ä¸ªreplicaä¸€ä¸ªç›®å½•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[jollybi@kafka1 kafka_2.10-0.8.2.0]<span class="comment"># cd /data/tools/kafka_2.10-0.8.2.0/kafka-logs/</span></div><div class="line">[root@master kafka-logs]<span class="comment"># ls</span></div><div class="line">__consumer_offsets-0   __consumer_offsets-20  __consumer_offsets-32  __consumer_offsets-44   my-replicatedtopic1-0</div><div class="line">__consumer_offsets-1   __consumer_offsets-21  __consumer_offsets-33  __consumer_offsets-45   my-replicated-topic1-1</div></pre></td></tr></table></figure><p>äºŒçº§ç»“æ„</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[jollybi@kafka1 kafka-logs]<span class="comment"># cd my-replicated-topic1-0/</span></div><div class="line">[jollybi@kafka1  my-replicated-topic1-0]<span class="comment"># ls</span></div><div class="line">00000000000000000000.index  00000000000000000000.log</div></pre></td></tr></table></figure><p><figure class="figure"><img src="http://static.zybuluo.com/sasaki/f71rtngyz2y8n3m6uxq1z2ec/%E5%9B%BE%E7%89%871.png" alt=""></figure></p><h3 id="äº¤æµå­¦ä¹ ï¼š"><a href="#äº¤æµå­¦ä¹ ï¼š" class="headerlink" title="äº¤æµå­¦ä¹ ï¼š"></a>äº¤æµå­¦ä¹ ï¼š</h3><p>ğŸ§  Linux shell_é«˜çº§è¿ç»´æ´¾: <code>459096184</code>    åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)<br>ğŸ§  BigData-Exchange School : <code>521621407</code>  åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥</p><p>ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Bigdata-Kafkaé›†ç¾¤å¿«é€Ÿæ­å»ºä¸å‘½ä»¤è®²è§£&quot;&gt;&lt;a href=&quot;#Bigdata-Kafkaé›†ç¾¤å¿«é€Ÿæ­å»ºä¸å‘½ä»¤è®²è§£&quot; class=&quot;headerlink&quot; title=&quot;Bigdata-Kafkaé›†ç¾¤å¿«é€Ÿæ­å»ºä¸å‘½ä»¤è®²è§£&quot;&gt;&lt;/a&gt;Bigdata-Kafkaé›†
      
    
    </summary>
    
      <category term="å¤§æ•°æ®" scheme="http://blog.yancy.cc/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
    
      <category term="Kafka" scheme="http://blog.yancy.cc/tags/Kafka/"/>
    
      <category term="Bigdata Hadoop" scheme="http://blog.yancy.cc/tags/Bigdata-Hadoop/"/>
    
  </entry>
  
  <entry>
    <title>Bigdata-ZooKeeperçš„é…ç½®è¯¦è§£ä¼˜åŒ–</title>
    <link href="http://blog.yancy.cc/2017/05/27/Bigdata-hadoop/zookeeper/Bigdata-ZooKeeper%E7%9A%84%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3%E4%BC%98%E5%8C%96/"/>
    <id>http://blog.yancy.cc/2017/05/27/Bigdata-hadoop/zookeeper/Bigdata-ZooKeeperçš„é…ç½®è¯¦è§£ä¼˜åŒ–/</id>
    <published>2017-05-27T06:46:00.000Z</published>
    <updated>2017-09-23T16:20:50.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p><code>ZooKeeper</code>çš„åŠŸèƒ½ç‰¹æ€§é€šè¿‡ <code>ZooKeeper</code> é…ç½®æ–‡ä»¶æ¥è¿›è¡Œæ§åˆ¶ç®¡ç†ï¼ˆ <code>zoo.cfg</code> é…ç½®æ–‡ä»¶ï¼‰ã€‚ ZooKeeper è¿™æ ·çš„è®¾è®¡å…¶å®æ˜¯æœ‰å®ƒè‡ªèº«çš„åŸå› çš„ã€‚é€šè¿‡å‰é¢å¯¹ <code>ZooKeeper</code> çš„é…ç½®å¯ä»¥çœ‹å‡ºï¼Œå¯¹ <code>ZooKeeper</code>é›†ç¾¤è¿›è¡Œé…ç½®çš„æ—¶å€™ï¼Œå®ƒçš„é…ç½®æ–‡æ¡£æ˜¯å®Œå…¨ç›¸åŒçš„ï¼ˆå¯¹äºé›†ç¾¤ä¼ªåˆ†å¸ƒæ¨¡å¼æ¥è¯´ï¼Œåªæœ‰å¾ˆå°‘çš„éƒ¨åˆ†æ˜¯ä¸åŒçš„ï¼‰ã€‚è¿™æ ·çš„é…ç½®æ–¹ä½¿å¾—åœ¨éƒ¨ç½² <code>ZooKeeper</code> æœåŠ¡çš„æ—¶å€™éå¸¸åœ°æ–¹ä¾¿ã€‚å¦å¤–ï¼Œå¦‚æœæœåŠ¡å™¨ä½¿ç”¨ä¸åŒçš„é…ç½®æ–‡ä»¶ï¼Œå¿…é¡»è¦ç¡®ä¿ä¸åŒé…ç½®æ–‡ä»¶ä¸­çš„æœåŠ¡å™¨åˆ—è¡¨ç›¸åŒ¹é…ã€‚</p><p>åœ¨è®¾ç½® <code>ZooKeeper</code> é…ç½®æ–‡æ¡£çš„æ—¶å€™ï¼ŒæŸäº›å‚æ•°æ˜¯å¯é€‰çš„ï¼Œä½†æ˜¯æŸäº›å‚æ•°æ˜¯å¿…é¡»çš„ã€‚è¿™äº›å¿…é¡»çš„å‚æ•°å°±æ„æˆäº†<code>ZooKeeper</code> é…ç½®æ–‡æ¡£çš„æœ€ä½é…ç½®è¦æ±‚ã€‚</p><a id="more"></a><h5 id="æœ€è¿‘å‘ç°åœ¨ç”¨zookeeperå‡ºç°ç»å¸¸å‡ºç°è¿æ¥è¶…æ—¶ï¼Œå‡ºç°è¿æ¥ä¸­æ–­ï¼Œæ•°æ®ä¸¢å¤±ç­‰åŸå› ã€‚åé¢çœ‹äº†å®˜ç½‘é…ç½®è‡ªå·±æ•´ç†ä¼˜åŒ–å‡ ç‚¹ï¼š"><a href="#æœ€è¿‘å‘ç°åœ¨ç”¨zookeeperå‡ºç°ç»å¸¸å‡ºç°è¿æ¥è¶…æ—¶ï¼Œå‡ºç°è¿æ¥ä¸­æ–­ï¼Œæ•°æ®ä¸¢å¤±ç­‰åŸå› ã€‚åé¢çœ‹äº†å®˜ç½‘é…ç½®è‡ªå·±æ•´ç†ä¼˜åŒ–å‡ ç‚¹ï¼š" class="headerlink" title="æœ€è¿‘å‘ç°åœ¨ç”¨zookeeperå‡ºç°ç»å¸¸å‡ºç°è¿æ¥è¶…æ—¶ï¼Œå‡ºç°è¿æ¥ä¸­æ–­ï¼Œæ•°æ®ä¸¢å¤±ç­‰åŸå› ã€‚åé¢çœ‹äº†å®˜ç½‘é…ç½®è‡ªå·±æ•´ç†ä¼˜åŒ–å‡ ç‚¹ï¼š"></a>æœ€è¿‘å‘ç°åœ¨ç”¨zookeeperå‡ºç°ç»å¸¸å‡ºç°è¿æ¥è¶…æ—¶ï¼Œå‡ºç°è¿æ¥ä¸­æ–­ï¼Œæ•°æ®ä¸¢å¤±ç­‰åŸå› ã€‚åé¢çœ‹äº†å®˜ç½‘é…ç½®è‡ªå·±æ•´ç†ä¼˜åŒ–å‡ ç‚¹ï¼š</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">2.1é”™è¯¯æ—¥å¿—ï¼š</div><div class="line"></div><div class="line">2016-04-11 15:00:58,981 [myid:] - WARN  [SyncThread:0:FileTxnLog@334] - fsync-ing the write ahead <span class="built_in">log</span> <span class="keyword">in</span> SyncThread:0 took 13973ms <span class="built_in">which</span> will adversely effect operation latency. See the ZooKeeper troubleshooting guide</div><div class="line"></div><div class="line"></div><div class="line">&gt;2.2ï¼Œé”™è¯¯åŸå› åˆ†æ</div><div class="line"></div><div class="line">â€œFOLLOWERâ€åœ¨è·Ÿâ€œLEADERâ€åŒæ­¥æ—¶ï¼Œfsyncæ“ä½œæ—¶é—´è¿‡é•¿ï¼Œå¯¼è‡´è¶…æ—¶ã€‚</div><div class="line"></div><div class="line"></div><div class="line">ç¬¬ä¸€æ­¥ï¼šåˆ†ææœåŠ¡å™¨é—®é¢˜ï¼š</div><div class="line"></div><div class="line">æˆ‘æŸ¥çœ‹äº†æœåŠ¡å™¨ioå’Œè´Ÿè½½éƒ½ä¸é«˜ã€‚å†…å­˜ç©ºé—´å®é™…ä½¿ç”¨ç‡ä¸é«˜ã€‚å¯æ˜¯ç¼–è¾‘æ–‡ä»¶å‡ºç°äº†å¡é¡¿.</div><div class="line"></div><div class="line">å¯ä»¥å‘ç°ï¼š</div><div class="line"></div><div class="line">æœåŠ¡å™¨å¹¶æ²¡æœ‰å ç”¨å¾ˆå¤šå†…å­˜çš„è¿›ç¨‹ï¼›</div><div class="line">æœåŠ¡å™¨ä¹Ÿæ²¡æœ‰å­˜åœ¨å¾ˆå¤šçš„è¿›ç¨‹ï¼›</div><div class="line">cat /var/<span class="built_in">log</span>/messageæŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—å¹¶æ²¡æœ‰å‘ç°ä»€ä¹ˆå¼‚å¸¸ï¼›</div><div class="line">å¦å¤–pingæœåŠ¡å™¨åªæœ‰0.1mså¤šçš„å»¶è¿Ÿï¼Œå› æ­¤ä¸æ˜¯ç½‘ç»œé—®é¢˜ã€‚</div><div class="line"></div><div class="line">åé¢å‘ç°ç¡¬ç›˜æœ‰æ•…éšœé‡æ–°æ›´æ¢äº†ä¸€å—ç¡¬ç›˜ã€‚æˆ–è€…æ›´æ¢æœåŠ¡å™¨ã€‚</div><div class="line"></div><div class="line"></div><div class="line">&gt;2.3ï¼Œé”™è¯¯è§£å†³</div><div class="line"></div><div class="line">å¢åŠ â€œtickTimeâ€æˆ–è€…â€œinitLimitå’ŒsyncLimitâ€çš„å€¼ï¼Œæˆ–è€…ä¸¤è€…éƒ½å¢å¤§ã€‚</div><div class="line"></div><div class="line"></div><div class="line">&gt;2.4ï¼Œå…¶ä»–</div><div class="line"></div><div class="line">è¿™ä¸ªé”™è¯¯åœ¨ä¸Šçº¿â€œä½¿ç”¨ZooKeeperè·å–åœ°å€æ–¹æ¡ˆâ€ä¹‹å‰ä¹Ÿå­˜åœ¨ï¼Œåªä¸è¿‡è¿‡æ²¡æœ‰è¿™ä¹ˆé«˜é¢‘ç‡ï¼Œè€Œä¸Šçº¿äº†â€œZooKeeperè·å–åœ°å€æ–¹æ¡ˆâ€ä¹‹åï¼ŒZooKeeper Serverä¹‹é—´çš„åŒæ­¥æ•°æ®é‡å¢å¤§ï¼ŒZooKeeper Serverçš„è´Ÿè½½åŠ é‡ï¼Œå› è€Œæœ€ç»ˆå¯¼è‡´é«˜é¢‘ç‡å‡ºç°ä¸Šè¿°é”™è¯¯ã€‚</div></pre></td></tr></table></figure><h2 id="ä¸‹é¢æ˜¯åœ¨æœ€ä½é…ç½®è¦æ±‚ä¸­å¿…é¡»é…ç½®çš„å‚æ•°ï¼š"><a href="#ä¸‹é¢æ˜¯åœ¨æœ€ä½é…ç½®è¦æ±‚ä¸­å¿…é¡»é…ç½®çš„å‚æ•°ï¼š" class="headerlink" title="ä¸‹é¢æ˜¯åœ¨æœ€ä½é…ç½®è¦æ±‚ä¸­å¿…é¡»é…ç½®çš„å‚æ•°ï¼š"></a>ä¸‹é¢æ˜¯åœ¨æœ€ä½é…ç½®è¦æ±‚ä¸­å¿…é¡»é…ç½®çš„å‚æ•°ï¼š</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">### æœ€å°é…ç½®</span></div><div class="line"></div><div class="line">æœ€å°é…ç½®æ„å‘³ç€æ‰€æœ‰çš„é…ç½®æ–‡ä»¶ä¸­å¿…é¡»è¦åŒ…å«è¿™äº›é…ç½®é€‰é¡¹ã€‚</div><div class="line"></div><div class="line"><span class="comment">#### clientPort</span></div><div class="line"></div><div class="line">æœåŠ¡å™¨ç›‘å¬å®¢æˆ·ç«¯è¿æ¥çš„ç«¯å£, äº¦å³å®¢æˆ·ç«¯å°è¯•è¿æ¥åˆ°æœåŠ¡å™¨ä¸Šçš„æŒ‡å®šç«¯å£ã€‚</div><div class="line"></div><div class="line"><span class="comment">##### dataDir</span></div><div class="line"></div><div class="line">ZooKeeper å­˜å‚¨å†…å­˜æ•°æ®åº“å¿«ç…§æ–‡ä»¶çš„è·¯å¾„, å¹¶ä¸”å¦‚æœæ²¡æœ‰æŒ‡å®šå…¶å®ƒè·¯å¾„çš„è¯, æ•°æ®åº“æ›´æ–°çš„äº‹åŠ¡æ—¥å¿—ä¹Ÿå°†å­˜å‚¨åˆ°è¯¥è·¯å¾„ä¸‹ã€‚</div><div class="line"></div><div class="line">æ³¨æ„: äº‹åŠ¡æ—¥å¿—ä¼šå½±å“ ZooKeeper æœåŠ¡å™¨çš„æ•´ä½“æ€§èƒ½, æ‰€ä»¥å»ºè®®å°†äº‹åŠ¡æ—¥å¿—æ”¾ç½®åˆ°ç”± dataLogDir å‚æ•°æŒ‡å®šçš„è·¯å¾„ä¸‹ã€‚</div><div class="line"></div><div class="line"><span class="comment">##### tickTime</span></div><div class="line"></div><div class="line">å•ä¸ª tick çš„æ—¶é—´é•¿åº¦, å®ƒæ˜¯ ZooKeeper ä¸­ä½¿ç”¨çš„åŸºæœ¬æ—¶é—´å•å…ƒ, ä»¥æ¯«ç§’ä¸ºå•ä½ã€‚å®ƒç”¨æ¥è°ƒèŠ‚å¿ƒè·³å’Œè¶…æ—¶æ—¶é—´ã€‚ä¾‹å¦‚, æœ€å°ä¼šè¯è¶…æ—¶æ—¶é—´æ˜¯ 2 ä¸ª tickã€‚</div></pre></td></tr></table></figure><p>ç”Ÿäº§ç¯å¢ƒä¾‹å­ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line">1.tickTimeï¼šCSé€šä¿¡å¿ƒè·³æ•°</div><div class="line"></div><div class="line">Zookeeper æœåŠ¡å™¨ä¹‹é—´æˆ–å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´ç»´æŒå¿ƒè·³çš„æ—¶é—´é—´éš”ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ª tickTime æ—¶é—´å°±ä¼šå‘é€ä¸€ä¸ªå¿ƒè·³ã€‚tickTimeä»¥æ¯«ç§’ä¸ºå•ä½ã€‚</div><div class="line"></div><div class="line">tickTime=2000  </div><div class="line"></div><div class="line">2.initLimitï¼šLFåˆå§‹é€šä¿¡æ—¶é™</div><div class="line">é›†ç¾¤ä¸­çš„followeræœåŠ¡å™¨(F)ä¸leaderæœåŠ¡å™¨(L)ä¹‹é—´åˆå§‹è¿æ¥æ—¶èƒ½å®¹å¿çš„æœ€å¤šå¿ƒè·³æ•°ï¼ˆtickTimeçš„æ•°é‡ï¼‰ã€‚</div><div class="line"></div><div class="line">initLimit=5  </div><div class="line"></div><div class="line">3.syncLimitï¼šLFåŒæ­¥é€šä¿¡æ—¶é™</div><div class="line">é›†ç¾¤ä¸­çš„followeræœåŠ¡å™¨ä¸leaderæœåŠ¡å™¨ä¹‹é—´è¯·æ±‚å’Œåº”ç­”ä¹‹é—´èƒ½å®¹å¿çš„æœ€å¤šå¿ƒè·³æ•°ï¼ˆtickTimeçš„æ•°é‡ï¼‰ã€‚</div><div class="line"></div><div class="line">syncLimit=2  </div><div class="line"> </div><div class="line">4.dataDirï¼šæ•°æ®æ–‡ä»¶ç›®å½•</div><div class="line">Zookeeperä¿å­˜æ•°æ®çš„ç›®å½•ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒZookeeperå°†å†™æ•°æ®çš„æ—¥å¿—æ–‡ä»¶ä¹Ÿä¿å­˜åœ¨è¿™ä¸ªç›®å½•é‡Œã€‚</div><div class="line"></div><div class="line">dataDir=/home/michael/opt/zookeeper/data  </div><div class="line"></div><div class="line">5.dataLogDirï¼šæ—¥å¿—æ–‡ä»¶ç›®å½•</div><div class="line">Zookeeperä¿å­˜æ—¥å¿—æ–‡ä»¶çš„ç›®å½•ã€‚</div><div class="line"></div><div class="line">dataLogDir=/home/michael/opt/zookeeper/<span class="built_in">log</span>  </div><div class="line"></div><div class="line">6.clientPortï¼šå®¢æˆ·ç«¯è¿æ¥ç«¯å£</div><div class="line">å®¢æˆ·ç«¯è¿æ¥ Zookeeper æœåŠ¡å™¨çš„ç«¯å£ï¼ŒZookeeper ä¼šç›‘å¬è¿™ä¸ªç«¯å£ï¼Œæ¥å—å®¢æˆ·ç«¯çš„è®¿é—®è¯·æ±‚ã€‚</div><div class="line"></div><div class="line">clientPort=2333  </div><div class="line"></div><div class="line">7.æœåŠ¡å™¨åç§°ä¸åœ°å€ï¼šé›†ç¾¤ä¿¡æ¯ï¼ˆæœåŠ¡å™¨ç¼–å·ï¼ŒæœåŠ¡å™¨åœ°å€ï¼ŒLFé€šä¿¡ç«¯å£ï¼Œé€‰ä¸¾ç«¯å£ï¼‰</div><div class="line">è¿™ä¸ªé…ç½®é¡¹çš„ä¹¦å†™æ ¼å¼æ¯”è¾ƒç‰¹æ®Šï¼Œè§„åˆ™å¦‚ä¸‹ï¼š</div><div class="line"></div><div class="line">server.N=YYY:A:B  </div><div class="line"></div><div class="line">å…¶ä¸­Nè¡¨ç¤ºæœåŠ¡å™¨ç¼–å·ï¼ŒYYYè¡¨ç¤ºæœåŠ¡å™¨çš„IPåœ°å€ï¼ŒAä¸ºLFé€šä¿¡ç«¯å£ï¼Œè¡¨ç¤ºè¯¥æœåŠ¡å™¨ä¸é›†ç¾¤ä¸­çš„leaderäº¤æ¢çš„ä¿¡æ¯çš„ç«¯å£ã€‚Bä¸ºé€‰ä¸¾ç«¯å£ï¼Œè¡¨ç¤ºé€‰ä¸¾æ–°leaderæ—¶æœåŠ¡å™¨é—´ç›¸äº’é€šä¿¡çš„ç«¯å£ï¼ˆå½“leaderæŒ‚æ‰æ—¶ï¼Œå…¶ä½™æœåŠ¡å™¨ä¼šç›¸äº’é€šä¿¡ï¼Œé€‰æ‹©å‡ºæ–°çš„leaderï¼‰ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œé›†ç¾¤ä¸­æ¯ä¸ªæœåŠ¡å™¨çš„Aç«¯å£éƒ½æ˜¯ä¸€æ ·ï¼Œæ¯ä¸ªæœåŠ¡å™¨çš„Bç«¯å£ä¹Ÿæ˜¯ä¸€æ ·ã€‚ä½†æ˜¯å½“æ‰€é‡‡ç”¨çš„ä¸ºä¼ªé›†ç¾¤æ—¶ï¼ŒIPåœ°å€éƒ½ä¸€æ ·ï¼Œåªèƒ½æ—¶Aç«¯å£å’ŒBç«¯å£ä¸ä¸€æ ·ã€‚</div><div class="line">ä¸‹é¢æ˜¯ä¸€ä¸ªéä¼ªé›†ç¾¤çš„ä¾‹å­ï¼š</div><div class="line"></div><div class="line">server.0=233.34.9.144:2008:6008  </div><div class="line">server.1=233.34.9.145:2008:6008  </div><div class="line">server.2=233.34.9.146:2008:6008  </div><div class="line">server.3=233.34.9.147:2008:6008  </div><div class="line"></div><div class="line">ä¸‹é¢æ˜¯ä¸€ä¸ªä¼ªé›†ç¾¤çš„ä¾‹å­ï¼š</div><div class="line"></div><div class="line">server.0=127.0.0.1:2008:6008  </div><div class="line">server.1=127.0.0.1:2007:6007  </div><div class="line">server.2=127.0.0.1:2006:6006  </div><div class="line">server.3=127.0.0.1:2005:6005</div></pre></td></tr></table></figure><h2 id="é«˜çº§é…ç½®"><a href="#é«˜çº§é…ç½®" class="headerlink" title="é«˜çº§é…ç½®"></a>é«˜çº§é…ç½®</h2><p>æœ¬èŠ‚çš„é…ç½®é€‰é¡¹æ˜¯å¯é€‰çš„ã€‚ä½ å¯ä»¥ä½¿ç”¨å®ƒä»¬è¿›ä¸€æ­¥çš„ä¼˜åŒ– ZooKeeper æœåŠ¡å™¨çš„è¡Œä¸ºã€‚æœ‰äº›å¯ä»¥ä½¿ç”¨ Java ç³»ç»Ÿå±æ€§æ¥è®¾ç½®, ä¸€èˆ¬çš„æ ¼å¼æ˜¯ â€œzookeeper.keywordâ€ã€‚å¦‚æœæœ‰å…·ä½“çš„ç³»ç»Ÿå±æ€§, ä¼šåœ¨é…ç½®é€‰é¡¹ä¸‹é¢æ ‡æ³¨å‡ºæ¥ã€‚</p><h5 id="dataLogDir"><a href="#dataLogDir" class="headerlink" title="dataLogDir"></a>dataLogDir</h5><p>æ²¡æœ‰å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§ã€‚</p><p>è¯¥å‚æ•°ç”¨äºé…ç½® ZooKeeper æœåŠ¡å™¨å­˜å‚¨äº‹åŠ¡æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„, ZooKeeper é»˜è®¤å°†äº‹åŠ¡æ—¥å¿—æ–‡ä»¶å’Œæ•°æ®å¿«ç…§å­˜å‚¨åœ¨åŒä¸€ä¸ªç›®å½•ä¸‹, åº”å°½é‡å°†å®ƒä»¬åˆ†å¼€å­˜å‚¨ã€‚</p><p>æ³¨æ„: å°†äº‹åŠ¡æ—¥å¿—æ–‡ä»¶å­˜å‚¨åˆ°ä¸€ä¸ªä¸“é—¨çš„æ—¥å¿—è®¾å¤‡ä¸Šå¯¹äºæœåŠ¡å™¨çš„ååé‡å’Œç¨³å®šçš„å»¶è¿Ÿæœ‰å¾ˆå¤§çš„å½±å“ã€‚äº‹åŠ¡æ—¥å¿—å¯¹ç£ç›˜æ€§èƒ½è¦æ±‚æ¯”è¾ƒé«˜, ä¸ºäº†ä¿è¯æ•°æ®ä¸€è‡´æ€§, ZooKeeper åœ¨å“åº”å®¢æˆ·ç«¯äº‹åŠ¡è¯·æ±‚ä¹‹å‰, éœ€è¦å°†è¯·æ±‚çš„äº‹åŠ¡æ—¥å¿—å†™åˆ°ç£ç›˜ä¸Š, æ‰€ä»¥äº‹åŠ¡æ—¥å¿—çš„å†™å…¥æ€§èƒ½ç›´æ¥å½±å“ ZooKeeper æœåŠ¡å™¨å¤„ç†è¯·æ±‚çš„ååã€‚æ‰€ä»¥å»ºè®®ç»™äº‹åŠ¡æ—¥å¿—çš„è¾“å‡ºé…ç½®ä¸€ä¸ªå•ç‹¬çš„ç£ç›˜æˆ–è€…æŒ‚è½½ç‚¹ã€‚</p><h5 id="globalOutstandingLimit"><a href="#globalOutstandingLimit" class="headerlink" title="globalOutstandingLimit"></a>globalOutstandingLimit</h5><p>å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: zookeeper.globalOutstandingLimitã€‚</p><p>å®¢æˆ·ç«¯æäº¤è¯·æ±‚çš„é€Ÿåº¦å¯èƒ½æ¯” ZooKeeper å¤„ç†çš„é€Ÿåº¦å¿«å¾—å¤š, ç‰¹åˆ«æ˜¯å½“å®¢æˆ·ç«¯çš„æ•°é‡éå¸¸å¤šçš„æ—¶å€™ã€‚ä¸ºäº†é˜²æ­¢ ZooKeeper å› ä¸ºæ’é˜Ÿçš„è¯·æ±‚è€Œè€—å°½å†…å­˜, ZooKeeper å°†ä¼šå¯¹å®¢æˆ·ç«¯è¿›è¡Œé™æµ, å³é™åˆ¶ç³»ç»Ÿä¸­æœªå¤„ç†çš„è¯·æ±‚æ•°é‡ä¸è¶…è¿‡ globalOutstandingLimit è®¾ç½®çš„å€¼ã€‚é»˜è®¤çš„é™åˆ¶æ˜¯ 1,000ã€‚</p><h5 id="preAllocSize"><a href="#preAllocSize" class="headerlink" title="preAllocSize"></a>preAllocSize</h5><p>å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: zookeeper.preAllocSizeã€‚</p><p>ç”¨äºé…ç½® ZooKeeper äº‹åŠ¡æ—¥å¿—æ–‡ä»¶é¢„åˆ†é…çš„ç£ç›˜ç©ºé—´å¤§å°ã€‚é»˜è®¤çš„å—å¤§å°æ˜¯ 64Mã€‚æ”¹å˜å—å¤§å°çš„å…¶ä¸­ä¸€ä¸ªåŸå› æ˜¯å½“æ•°æ®å¿«ç…§æ–‡ä»¶ç”Ÿæˆæ¯”è¾ƒé¢‘ç¹æ—¶å¯ä»¥é€‚å½“å‡å°‘å—å¤§å°ã€‚æ¯”å¦‚ 1000 æ¬¡äº‹åŠ¡ä¼šæ–°äº§ç”Ÿä¸€ä¸ªå¿«ç…§(å‚æ•°ä¸ºsnapCount), æ–°äº§ç”Ÿå¿«ç…§åä¼šç”¨æ–°çš„äº‹åŠ¡æ—¥å¿—æ–‡ä»¶, å‡è®¾ä¸€ä¸ªäº‹åŠ¡ä¿¡æ¯å¤§å°100b, é‚£ä¹ˆäº‹åŠ¡æ—¥å¿—é¢„åˆ†é…çš„ç£ç›˜ç©ºé—´å¤§å°ä¸º100kbä¼šæ¯”è¾ƒå¥½ã€‚</p><h5 id="snapCount"><a href="#snapCount" class="headerlink" title="snapCount"></a>snapCount</h5><p>å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: zookeeper.snapCountã€‚</p><p>ZooKeeper å°†äº‹åŠ¡è®°å½•åˆ°äº‹åŠ¡æ—¥å¿—ä¸­ã€‚å½“ snapCount ä¸ªäº‹åŠ¡è¢«å†™åˆ°ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶å, å¯åŠ¨ä¸€ä¸ªå¿«ç…§å¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡æ—¥å¿—æ–‡ä»¶ã€‚snapCount çš„é»˜è®¤å€¼æ˜¯ 100,000ã€‚</p><h5 id="traceFile"><a href="#traceFile" class="headerlink" title="traceFile"></a>traceFile</h5><p>å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: requestTraceFileã€‚</p><p>å¦‚æœå®šä¹‰äº†è¯¥é€‰é¡¹, é‚£ä¹ˆè¯·æ±‚å°†ä¼šè®°å½•åˆ°ä¸€ä¸ªåä¸º traceFile.year.month.day çš„è·Ÿè¸ªæ–‡ä»¶ä¸­ã€‚ä½¿ç”¨è¯¥é€‰é¡¹å¯ä»¥æä¾›å¾ˆæœ‰ç”¨çš„è°ƒè¯•ä¿¡æ¯, ä½†æ˜¯ä¼šå½±å“æ€§èƒ½ã€‚</p><p>æ³¨æ„: requestTraceFile è¿™ä¸ªç³»ç»Ÿå±æ€§æ²¡æœ‰ zookeeper å‰ç¼€, å¹¶ä¸”é…ç½®çš„å˜é‡åç§°å’Œç³»ç»Ÿå±æ€§ä¸ä¸€æ ·ã€‚</p><h5 id="maxClientCnxns"><a href="#maxClientCnxns" class="headerlink" title="maxClientCnxns"></a>maxClientCnxns</h5><p>æ²¡æœ‰å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§</p><p>åœ¨ socket çº§åˆ«é™åˆ¶å•ä¸ªå®¢æˆ·ç«¯åˆ° ZooKeeper é›†ç¾¤ä¸­å•å°æœåŠ¡å™¨çš„å¹¶å‘è¿æ¥æ•°é‡, å¯ä»¥é€šè¿‡ IP åœ°å€æ¥åŒºåˆ†ä¸åŒçš„å®¢æˆ·ç«¯ã€‚å®ƒç”¨æ¥é˜»æ­¢æŸç§ç±»å‹çš„ DoS æ”»å‡», åŒ…æ‹¬æ–‡ä»¶æè¿°ç¬¦èµ„æºè€—å°½ã€‚é»˜è®¤å€¼æ˜¯ 60ã€‚å°†å€¼è®¾ç½®ä¸º 0 å°†å®Œå…¨ç§»é™¤å¹¶å‘è¿æ¥çš„é™åˆ¶ã€‚</p><h5 id="clientPortAddress"><a href="#clientPortAddress" class="headerlink" title="clientPortAddress"></a>clientPortAddress</h5><p>æœåŠ¡å™¨ç›‘å¬å®¢æˆ·ç«¯è¿æ¥çš„åœ°å€ (ipv4, ipv6 æˆ– ä¸»æœºå) , äº¦å³å®¢æˆ·ç«¯å°è¯•è¿æ¥åˆ°æœåŠ¡å™¨ä¸Šçš„åœ°å€ã€‚è¯¥å‚æ•°æ˜¯å¯é€‰çš„, é»˜è®¤æˆ‘ä»¬ä»¥è¿™æ ·ä¸€ç§æ–¹å¼ç»‘å®š, å³å¯¹äºæœåŠ¡å™¨ä¸Šä»»æ„ address/interface/nic, ä»»ä½•è¿æ¥åˆ° clientPort çš„è¯·æ±‚å°†ä¼šè¢«æ¥å—ã€‚</p><h5 id="minSessionTimeout"><a href="#minSessionTimeout" class="headerlink" title="minSessionTimeout"></a>minSessionTimeout</h5><p>æ²¡æœ‰å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§</p><p>æœåŠ¡å™¨å…è®¸å®¢æˆ·ç«¯ä¼šè¯çš„æœ€å°è¶…æ—¶æ—¶é—´, ä»¥æ¯«ç§’ä¸ºå•ä½ã€‚é»˜è®¤å€¼æ˜¯ 2 å€çš„ tickTimeã€‚</p><h5 id="maxSessionTimeout"><a href="#maxSessionTimeout" class="headerlink" title="maxSessionTimeout"></a>maxSessionTimeout</h5><p>æ²¡æœ‰å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§</p><p>æœåŠ¡å™¨å…è®¸å®¢æˆ·ç«¯ä¼šè¯çš„æœ€å¤§è¶…æ—¶æ—¶é—´, ä»¥æ¯«ç§’ä¸ºå•ä½ã€‚é»˜è®¤å€¼æ˜¯ 20 å€çš„ tickTimeã€‚</p><h5 id="fsync-warningthresholdms"><a href="#fsync-warningthresholdms" class="headerlink" title="fsync.warningthresholdms"></a>fsync.warningthresholdms</h5><p>å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: fsync.warningthresholdmsã€‚</p><p>ç”¨äºé…ç½® ZooKeeper è¿›è¡Œäº‹åŠ¡æ—¥å¿— (WAL) fsync æ“ä½œæ¶ˆè€—æ—¶é—´çš„æŠ¥è­¦é˜ˆå€¼, ä¸€æ—¦è¶…è¿‡è¿™ä¸ªé˜ˆå€¼å°†ä¼šæ‰“å°è¾“å‡ºæŠ¥è­¦æ—¥å¿—ã€‚è¯¥å‚æ•°çš„é»˜è®¤å€¼æ˜¯ 1000, ä»¥æ¯«ç§’ä¸ºå•ä½ã€‚å‚æ•°å€¼åªèƒ½ä½œä¸ºç³»ç»Ÿå±æ€§æ¥è®¾ç½®ã€‚</p><h5 id="autopurge-snapRetainCount"><a href="#autopurge-snapRetainCount" class="headerlink" title="autopurge.snapRetainCount"></a>autopurge.snapRetainCount</h5><p>æ²¡æœ‰å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§ã€‚</p><p>å½“å¯ç”¨è‡ªåŠ¨æ¸…ç†åŠŸèƒ½å, ZooKeeper å°†åªä¿ç•™ autopurge.snapRetainCount ä¸ªæœ€è¿‘çš„æ•°æ®å¿«ç…§(dataDir)å’Œå¯¹åº”çš„äº‹åŠ¡æ—¥å¿—æ–‡ä»¶(dataLogDir), å…¶ä½™çš„å°†ä¼šåˆ é™¤æ‰ã€‚é»˜è®¤å€¼æ˜¯ 3ã€‚æœ€å°å€¼ä¹Ÿæ˜¯ 3ã€‚</p><h5 id="autopurge-purgeInterval"><a href="#autopurge-purgeInterval" class="headerlink" title="autopurge.purgeInterval"></a>autopurge.purgeInterval</h5><p>æ²¡æœ‰å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§ã€‚</p><p>ç”¨äºé…ç½®è§¦å‘æ¸…ç†ä»»åŠ¡çš„æ—¶é—´é—´éš”, ä»¥å°æ—¶ä¸ºå•ä½ã€‚è¦å¯ç”¨è‡ªåŠ¨æ¸…ç†, å¯ä»¥å°†å…¶å€¼è®¾ç½®ä¸ºä¸€ä¸ªæ­£æ•´æ•° (å¤§äº 1) ã€‚é»˜è®¤å€¼æ˜¯ 0ã€‚</p><h5 id="syncEnabled"><a href="#syncEnabled" class="headerlink" title="syncEnabled"></a>syncEnabled</h5><p>å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: zookeeper.observer.syncEnabledã€‚</p><p>å’Œå‚ä¸è€…ä¸€æ ·, è§‚å¯Ÿè€…ç°åœ¨é»˜è®¤å°†äº‹åŠ¡æ—¥å¿—ä»¥åŠæ•°æ®å¿«ç…§å†™åˆ°ç£ç›˜ä¸Š, è¿™å°†å‡å°‘è§‚å¯Ÿè€…åœ¨æœåŠ¡å™¨é‡å¯æ—¶çš„æ¢å¤æ—¶é—´ã€‚å°†å…¶å€¼è®¾ç½®ä¸º â€œfalseâ€ å¯ä»¥ç¦ç”¨è¯¥ç‰¹æ€§ã€‚é»˜è®¤å€¼æ˜¯ â€œtrueâ€ã€‚</p><p>é›†ç¾¤é…ç½®é€‰é¡¹</p><p>æœ¬èŠ‚ä¸­çš„é€‰é¡¹ä¸»è¦ç”¨äºZooKeeperé›†ç¾¤ã€‚</p><h5 id="electionAlg"><a href="#electionAlg" class="headerlink" title="electionAlg"></a>electionAlg</h5><p>æ²¡æœ‰å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§ã€‚</p><p>ç”¨äºé€‰æ‹©ä½¿ç”¨çš„ leader é€‰ä¸¾ç®—æ³•ã€‚â€0â€ å¯¹åº”äºåŸå§‹çš„åŸºäº UDP çš„ç‰ˆæœ¬, â€œ1â€ å¯¹åº”äºå¿«é€Ÿ leader é€‰ä¸¾åŸºäºUDPçš„æ— èº«ä»½éªŒè¯çš„ç‰ˆæœ¬, â€œ2â€ å¯¹åº”äºå¿«é€Ÿ leader é€‰ä¸¾æœ‰åŸºäºUDPçš„èº«ä»½éªŒè¯çš„ç‰ˆæœ¬, è€Œ â€œ3â€ å¯¹åº”äºå¿«é€Ÿ leader é€‰ä¸¾åŸºäºTCPçš„ç‰ˆæœ¬ã€‚ç›®å‰é»˜è®¤å€¼æ˜¯ç®—æ³• 3ã€‚</p><p>æ³¨æ„: leader é€‰ä¸¾ 0, 1, 2 è¿™ä¸‰ç§å®ç°å·²ç»åºŸå¼ƒ, åœ¨æ¥ä¸‹æ¥çš„ç‰ˆæœ¬ä¸­å°†ä¼šç§»é™¤å®ƒä»¬, è¿™æ ·å°±åªå‰©ä¸‹ FastLeaderElection ç®—æ³•ã€‚</p><h5 id="initLimit"><a href="#initLimit" class="headerlink" title="initLimit"></a>initLimit</h5><p>æ²¡æœ‰å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§ã€‚</p><p>é»˜è®¤å€¼æ˜¯ 10, å³ tickTime å±æ€§å€¼çš„ 10 å€ã€‚å®ƒç”¨äºé…ç½®å…è®¸ followers è¿æ¥å¹¶åŒæ­¥åˆ° leader çš„æœ€å¤§æ—¶é—´ã€‚å¦‚æœ ZooKeeper ç®¡ç†çš„æ•°æ®é‡å¾ˆå¤§çš„è¯å¯ä»¥å¢åŠ è¿™ä¸ªå€¼ã€‚</p><h5 id="leaderServes"><a href="#leaderServes" class="headerlink" title="leaderServes"></a>leaderServes</h5><p>å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: zookeeper.leaderServesã€‚</p><p>ç”¨äºé…ç½® Leader æ˜¯å¦æ¥å—å®¢æˆ·ç«¯è¿æ¥, é»˜è®¤å€¼æ˜¯ â€œyesâ€, å³ leader å°†ä¼šæ¥å—å®¢æˆ·ç«¯è¿æ¥ã€‚åœ¨ ZooKeeper ä¸­, leader æœåŠ¡å™¨ä¸»è¦åè°ƒäº‹åŠ¡æ›´æ–°è¯·æ±‚ã€‚å¯¹äºäº‹åŠ¡æ›´æ–°è¯·æ±‚ååå¾ˆé«˜è€Œè¯»å–è¯·æ±‚ååå¾ˆä½çš„æƒ…å†µå¯ä»¥é…ç½® leader ä¸æ¥å—å®¢æˆ·ç«¯è¿æ¥, è¿™æ ·å°±å¯ä»¥ä¸“æ³¨äºåè°ƒå·¥ä½œã€‚</p><p>æ³¨æ„: å½“ ZooKeeper é›†ç¾¤ä¸­æœåŠ¡å™¨çš„æ•°é‡è¶…è¿‡ 3 ä¸ªæ—¶, å»ºè®®å¼€å¯ leader é€‰ä¸¾ã€‚</p><h5 id="server-x-hostname-nnnnn-nnnnn"><a href="#server-x-hostname-nnnnn-nnnnn" class="headerlink" title="server.x=[hostname]:nnnnn:nnnnn"></a>server.x=[hostname]:nnnnn:nnnnn</h5><p>æ²¡æœ‰å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§ã€‚</p><p>ç»„æˆ ZooKeeper é›†ç¾¤çš„æœåŠ¡å™¨ã€‚å½“æœåŠ¡å™¨å¯åŠ¨æ—¶, å¯ä»¥é€šè¿‡æŸ¥æ‰¾æ•°æ®ç›®å½•ä¸­çš„ myid æ–‡ä»¶æ¥å†³å®šå®ƒæ˜¯å“ªä¸€å°æœåŠ¡å™¨ã€‚myid æ–‡ä»¶åŒ…å«æœåŠ¡å™¨ç¼–å·, å¹¶ä¸”å®ƒè¦åŒ¹é… â€œserver.xâ€ ä¸­çš„ xã€‚</p><p>å®¢æˆ·ç«¯ç”¨æ¥ç»„æˆ ZooKeeper é›†ç¾¤çš„æœåŠ¡å™¨åˆ—è¡¨å¿…é¡»å’Œæ¯ä¸ª ZooKeeper æœåŠ¡å™¨ä¸­é…ç½®çš„ ZooKeeper æœåŠ¡å™¨åˆ—è¡¨ç›¸åŒ¹é…ã€‚</p><p>æœ‰ä¸¤ä¸ªç«¯å£å· nnnnn, ç¬¬ä¸€ä¸ªæ˜¯ followers ç”¨æ¥è¿æ¥åˆ° leader, ç¬¬äºŒä¸ªæ˜¯ç”¨äº leader é€‰ä¸¾ã€‚å¦‚æœæƒ³åœ¨å•å°æœºå™¨ä¸Šæµ‹è¯•å¤šä¸ªæœåŠ¡, åˆ™å¯ä»¥ä¸ºæ¯ä¸ªæœåŠ¡é…ç½®ä¸åŒçš„ç«¯å£ã€‚</p><h5 id="syncLimit"><a href="#syncLimit" class="headerlink" title="syncLimit"></a>syncLimit</h5><p>æ²¡æœ‰å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§ã€‚</p><p>é»˜è®¤å€¼æ˜¯ 5, å³ tickTime å±æ€§å€¼çš„ 5 å€ã€‚å®ƒç”¨äºé…ç½®leader å’Œ followers é—´è¿›è¡Œå¿ƒè·³æ£€æµ‹çš„æœ€å¤§å»¶è¿Ÿæ—¶é—´ã€‚å¦‚æœåœ¨è®¾ç½®çš„æ—¶é—´å†… followers æ— æ³•ä¸ leader è¿›è¡Œé€šä¿¡, é‚£ä¹ˆ followers å°†ä¼šè¢«ä¸¢å¼ƒã€‚</p><h5 id="group-x-nnnnn-nnnnn"><a href="#group-x-nnnnn-nnnnn" class="headerlink" title="group.x=nnnnn[:nnnnn]"></a>group.x=nnnnn[:nnnnn]</h5><p>æ²¡æœ‰å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§ã€‚</p><p>Enables a hierarchical quorum construction.â€xâ€ æ˜¯ä¸€ä¸ªç»„çš„æ ‡è¯†, ç­‰å·å³è¾¹çš„æ•°å­—å¯¹åº”äºæœåŠ¡å™¨çš„æ ‡è¯†. èµ‹å€¼æ“ä½œå³è¾¹æ˜¯å†’å·åˆ†éš”çš„æœåŠ¡å™¨æ ‡è¯†ã€‚æ³¨æ„: ç»„å¿…é¡»æ˜¯ä¸ç›¸äº¤çš„, å¹¶ä¸”æ‰€æœ‰ç»„è”åˆåå¿…é¡»æ˜¯ ZooKeeper é›†ç¾¤ã€‚</p><h5 id="weight-x-nnnnn"><a href="#weight-x-nnnnn" class="headerlink" title="weight.x=nnnnn"></a>weight.x=nnnnn</h5><p>æ²¡æœ‰å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§ã€‚</p><p>å’Œ â€œgroupâ€ ä¸€èµ·ä½¿ç”¨, å½“å½¢æˆé›†ç¾¤æ—¶å®ƒç»™æ¯ä¸ªæœåŠ¡å™¨èµ‹æƒé‡å€¼ã€‚è¿™ä¸ªå€¼å¯¹åº”äºæŠ•ç¥¨æ—¶æœåŠ¡å™¨çš„æƒé‡ã€‚ZooKeeper ä¸­åªæœ‰å°‘æ•°éƒ¨åˆ†éœ€è¦æŠ•ç¥¨, æ¯”å¦‚ leader é€‰ä¸¾ä»¥åŠåŸå­çš„å¹¿æ’­åè®®ã€‚æœåŠ¡å™¨æƒé‡çš„é»˜è®¤å€¼æ˜¯ 1ã€‚å¦‚æœé…ç½®æ–‡ä»¶ä¸­å®šä¹‰äº†ç»„, ä½†æ˜¯æ²¡æœ‰æƒé‡, é‚£ä¹ˆæ‰€æœ‰æœåŠ¡å™¨çš„æƒé‡å°†ä¼šèµ‹å€¼ä¸º 1ã€‚</p><h5 id="cnxTimeout"><a href="#cnxTimeout" class="headerlink" title="cnxTimeout"></a>cnxTimeout</h5><p>å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: zookeeper.cnxTimeoutã€‚</p><p>ç”¨äºé…ç½® leaderé€‰ä¸¾è¿‡ç¨‹ä¸­ï¼Œæ‰“å¼€ä¸€æ¬¡è¿æ¥ï¼ˆé€‰ä¸¾çš„ server äº’ç›¸é€šä¿¡å»ºç«‹è¿æ¥ï¼‰çš„è¶…æ—¶æ—¶é—´ã€‚é»˜è®¤å€¼æ˜¯ 5sã€‚</p><h2 id="èº«ä»½è®¤è¯å’Œæˆæƒé€‰é¡¹"><a href="#èº«ä»½è®¤è¯å’Œæˆæƒé€‰é¡¹" class="headerlink" title="èº«ä»½è®¤è¯å’Œæˆæƒé€‰é¡¹"></a>èº«ä»½è®¤è¯å’Œæˆæƒé€‰é¡¹</h2><p>æœ¬èŠ‚çš„é€‰é¡¹å…è®¸é€šè¿‡èº«ä»½è®¤è¯å’Œæˆæƒæ¥æ§åˆ¶æœåŠ¡æ‰§è¡Œã€‚</p><p>zookeeper.DigestAuthenticationProvider.superDigest</p><p>å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: zookeeper.DigestAuthenticationProvider.superDigestã€‚</p><p>è¯¥åŠŸèƒ½é»˜è®¤æ˜¯ç¦ç”¨çš„ã€‚</p><p>èƒ½å¤Ÿä½¿ ZooKeeper é›†ç¾¤ç®¡ç†å‘˜å¯ä»¥ä½œä¸ºä¸€ä¸ª â€œsuperâ€ ç”¨æˆ·æ¥è®¿é—® znode å±‚çº§ç»“æ„ã€‚ç‰¹åˆ«æ˜¯å¯¹äºä¸€ä¸ªå·²ç»è®¤è¯ä¸ºè¶…çº§ç®¡ç†å‘˜çš„ç”¨æˆ·ä¸éœ€è¦ ACL æ£€æŸ¥ã€‚</p><p>org.apache.zookeeper.server.auth.DigestAuthenticationProvider å¯ä»¥ç”¨æ¥ç”Ÿæˆ superDigest, è°ƒç”¨å®ƒå¸¦æœ‰ â€œsuper:<password>â€œ å‚æ•°çš„æ–¹æ³•ã€‚å½“å¯åŠ¨é›†ç¾¤ä¸­çš„æ¯å°æœåŠ¡å™¨æ—¶, å°†ç”Ÿæˆçš„ â€œsuper:<data>â€œ ä½œä¸ºç³»ç»Ÿå±æ€§æä¾›ã€‚</data></password></p><p>å½“ ZooKeeper å®¢æˆ·ç«¯å‘ ZooKeeper æœåŠ¡å™¨è¿›è¡Œèº«ä»½è®¤è¯æ—¶, ä¼šä¼ é€’ä¸€ä¸ª â€œdigestâ€ å’Œ â€œsuper:<password>â€œ çš„è®¤è¯æ•°æ®. æ³¨æ„æ‘˜è¦å¼èº«ä»½éªŒè¯å°†è®¤è¯æ•°æ®ä»¥æ™®é€šæ–‡æœ¬çš„å½¢å¼ä¼ é€’ç»™æœåŠ¡å™¨, åœ¨ç½‘ç»œä¸­éœ€è¦è°¨æ…ä½¿ç”¨è¯¥è®¤è¯æ–¹æ³•, è¦ä¹ˆåªåœ¨æœ¬æœºä¸Šæˆ–é€šè¿‡ä¸€ä¸ªåŠ å¯†çš„è¿æ¥ã€‚</password></p><h5 id="å®éªŒæ€§é€‰é¡¹-ç‰¹æ€§"><a href="#å®éªŒæ€§é€‰é¡¹-ç‰¹æ€§" class="headerlink" title="å®éªŒæ€§é€‰é¡¹/ç‰¹æ€§"></a>å®éªŒæ€§é€‰é¡¹/ç‰¹æ€§</h5><p>æœ¬èŠ‚åˆ—ä¸¾äº†ä¸€äº›ç›®å‰è¿˜å¤„äºå®éªŒé˜¶æ®µçš„æ–°ç‰¹æ€§ã€‚</p><h5 id="æœåŠ¡å™¨åªè¯»æ¨¡å¼"><a href="#æœåŠ¡å™¨åªè¯»æ¨¡å¼" class="headerlink" title="æœåŠ¡å™¨åªè¯»æ¨¡å¼"></a>æœåŠ¡å™¨åªè¯»æ¨¡å¼</h5><p>å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: readonlymode.enabledã€‚</p><p>å°†å…¶è®¾ç½®ä¸º true å°†ä¼šå¯ç”¨æœåŠ¡å™¨åªè¯»æ¨¡å¼æ”¯æŒ, é»˜è®¤æ˜¯ç¦ç”¨çš„ã€‚ROM å…è®¸è¯·æ±‚äº† ROM æ”¯æŒçš„å®¢æˆ·ç«¯ä¼šè¯è¿æ¥åˆ°æœåŠ¡å™¨, å³ä½¿å½“æœåŠ¡å™¨å¯èƒ½å·²ç»ä»é›†ç¾¤ä¸­åˆ†éš”å‡ºå»ã€‚åœ¨è¯¥æ¨¡å¼ä¸­, ROM å®¢æˆ·ç«¯ä»ç„¶å¯ä»¥ä» ZK æœåŠ¡ä¸­è¯»å–å€¼, ä½†æ˜¯ä¸èƒ½è¿›è¡Œå†™æ“ä½œä»¥åŠçœ‹è§å…¶å®ƒå®¢æˆ·ç«¯æ‰€åšçš„ä¸€äº›å˜æ›´ã€‚æ›´å¤šè¯¦ç»†ä¿¡æ¯å¯ä»¥å‚è§ ZOOKEEPER-784 è·å–æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚</p><h5 id="ä¸å®‰å…¨çš„é€‰é¡¹"><a href="#ä¸å®‰å…¨çš„é€‰é¡¹" class="headerlink" title="ä¸å®‰å…¨çš„é€‰é¡¹"></a>ä¸å®‰å…¨çš„é€‰é¡¹</h5><p>ä¸‹é¢çš„é€‰é¡¹ä¼šå¾ˆæœ‰ç”¨, ä½†æ˜¯ä½¿ç”¨çš„æ—¶å€™éœ€è¦ç‰¹åˆ«å°å¿ƒã€‚</p><h5 id="forceSync"><a href="#forceSync" class="headerlink" title="forceSync"></a>forceSync</h5><p>å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: zookeeper.forceSyncã€‚</p><p>ç”¨äºé…ç½®æ˜¯å¦éœ€è¦åœ¨äº‹åŠ¡æ—¥å¿—æäº¤çš„æ—¶å€™è°ƒç”¨ FileChannel.force æ¥ä¿è¯æ•°æ®å®Œå…¨åŒæ­¥åˆ°ç£ç›˜ã€‚é»˜è®¤å€¼æ˜¯ â€œyesâ€ã€‚å¦‚æœè¯¥é€‰é¡¹è®¾ç½®ä¸º â€œnoâ€, ZooKeeper å°†ä¸ä¼šå¼ºåˆ¶åŒæ­¥äº‹åŠ¡æ›´æ–°æ—¥å¿—åˆ°ç£ç›˜ã€‚</p><h5 id="jute-maxbuffer"><a href="#jute-maxbuffer" class="headerlink" title="jute.maxbuffer:"></a>jute.maxbuffer:</h5><p>å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: jute.maxbufferã€‚æ²¡æœ‰ zookeeper å‰ç¼€ã€‚</p><p>ç”¨äºæŒ‡å®šä¸€ä¸ª znode ä¸­å¯ä»¥å­˜å‚¨æ•°æ®é‡çš„æœ€å¤§å€¼, é»˜è®¤å€¼æ˜¯ 0xfffff, æˆ– 1M å†…ã€‚å¦‚æœè¿™ä¸ªé€‰é¡¹æ”¹å˜äº†, é‚£ä¹ˆè¯¥ç³»ç»Ÿå±æ€§å¿…é¡»åœ¨æ‰€æœ‰çš„æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯è¿›è¡Œè®¾ç½®, å¦åˆ™ä¼šå‡ºç°é—®é¢˜ã€‚ZooKeeperæ—¨åœ¨å­˜å‚¨å¤§å°ä¸ºåƒå­—èŠ‚æ•°é‡çš„æ•°æ®ã€‚</p><h5 id="skipACL"><a href="#skipACL" class="headerlink" title="skipACL"></a>skipACL</h5><p>å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: zookeeper.skipACLã€‚</p><p>ç”¨äºé…ç½® ZooKeeper æœåŠ¡å™¨è·³è¿‡ ACL æƒé™æ£€æŸ¥ã€‚è¿™å°†ä¸€å®šç¨‹åº¦çš„æé«˜æœåŠ¡å™¨ååé‡, ä½†æ˜¯ä¹Ÿå‘æ‰€æœ‰å®¢æˆ·ç«¯å®Œå…¨å¼€æ”¾æ•°æ®è®¿é—®ã€‚</p><h5 id="quorumListenOnAllIPs"><a href="#quorumListenOnAllIPs" class="headerlink" title="quorumListenOnAllIPs"></a>quorumListenOnAllIPs</h5><p>å½“è®¾ç½®ä¸º true æ—¶, ZooKeeper æœåŠ¡å™¨å°†ä¼šåœ¨æ‰€æœ‰å¯ç”¨çš„ IP åœ°å€ä¸Šç›‘å¬æ¥è‡ªå…¶å¯¹ç­‰ç‚¹çš„è¿æ¥è¯·æ±‚, è€Œä¸ä»…æ˜¯é…ç½®æ–‡ä»¶çš„æœåŠ¡å™¨åˆ—è¡¨ä¸­é…ç½®çš„åœ°å€ã€‚å®ƒä¼šå½±å“å¤„ç† ZAB åè®®å’Œ Fast Leader Election åè®®çš„è¿æ¥ã€‚é»˜è®¤å€¼æ˜¯ falseã€‚</p><h3 id="äº¤æµå­¦ä¹ ï¼š"><a href="#äº¤æµå­¦ä¹ ï¼š" class="headerlink" title="äº¤æµå­¦ä¹ ï¼š"></a>äº¤æµå­¦ä¹ ï¼š</h3><p>ğŸ§  Linux shell_é«˜çº§è¿ç»´æ´¾: <code>459096184</code>    åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)<br>ğŸ§  BigData-Exchange School : <code>521621407</code>  åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥</p><p>ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h3&gt;&lt;p&gt;&lt;code&gt;ZooKeeper&lt;/code&gt;çš„åŠŸèƒ½ç‰¹æ€§é€šè¿‡ &lt;code&gt;ZooKeeper&lt;/code&gt; é…ç½®æ–‡ä»¶æ¥è¿›è¡Œæ§åˆ¶ç®¡ç†ï¼ˆ &lt;code&gt;zoo.cfg&lt;/code&gt; é…ç½®æ–‡ä»¶ï¼‰ã€‚ ZooKeeper è¿™æ ·çš„è®¾è®¡å…¶å®æ˜¯æœ‰å®ƒè‡ªèº«çš„åŸå› çš„ã€‚é€šè¿‡å‰é¢å¯¹ &lt;code&gt;ZooKeeper&lt;/code&gt; çš„é…ç½®å¯ä»¥çœ‹å‡ºï¼Œå¯¹ &lt;code&gt;ZooKeeper&lt;/code&gt;é›†ç¾¤è¿›è¡Œé…ç½®çš„æ—¶å€™ï¼Œå®ƒçš„é…ç½®æ–‡æ¡£æ˜¯å®Œå…¨ç›¸åŒçš„ï¼ˆå¯¹äºé›†ç¾¤ä¼ªåˆ†å¸ƒæ¨¡å¼æ¥è¯´ï¼Œåªæœ‰å¾ˆå°‘çš„éƒ¨åˆ†æ˜¯ä¸åŒçš„ï¼‰ã€‚è¿™æ ·çš„é…ç½®æ–¹ä½¿å¾—åœ¨éƒ¨ç½² &lt;code&gt;ZooKeeper&lt;/code&gt; æœåŠ¡çš„æ—¶å€™éå¸¸åœ°æ–¹ä¾¿ã€‚å¦å¤–ï¼Œå¦‚æœæœåŠ¡å™¨ä½¿ç”¨ä¸åŒçš„é…ç½®æ–‡ä»¶ï¼Œå¿…é¡»è¦ç¡®ä¿ä¸åŒé…ç½®æ–‡ä»¶ä¸­çš„æœåŠ¡å™¨åˆ—è¡¨ç›¸åŒ¹é…ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è®¾ç½® &lt;code&gt;ZooKeeper&lt;/code&gt; é…ç½®æ–‡æ¡£çš„æ—¶å€™ï¼ŒæŸäº›å‚æ•°æ˜¯å¯é€‰çš„ï¼Œä½†æ˜¯æŸäº›å‚æ•°æ˜¯å¿…é¡»çš„ã€‚è¿™äº›å¿…é¡»çš„å‚æ•°å°±æ„æˆäº†&lt;code&gt;ZooKeeper&lt;/code&gt; é…ç½®æ–‡æ¡£çš„æœ€ä½é…ç½®è¦æ±‚ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Bigdata" scheme="http://blog.yancy.cc/categories/Bigdata/"/>
    
    
      <category term="ZooKeeper" scheme="http://blog.yancy.cc/tags/ZooKeeper/"/>
    
  </entry>
  
  <entry>
    <title>Bigdata-ZooKeeperé›†ç¾¤å¿«é€Ÿæ­å»ºä¸ä¼˜åŒ–</title>
    <link href="http://blog.yancy.cc/2017/05/26/Bigdata-hadoop/zookeeper/Bigdata-ZooKeeper%E9%9B%86%E7%BE%A4%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E4%B8%8E%E4%BC%98%E5%8C%96/"/>
    <id>http://blog.yancy.cc/2017/05/26/Bigdata-hadoop/zookeeper/Bigdata-ZooKeeperé›†ç¾¤å¿«é€Ÿæ­å»ºä¸ä¼˜åŒ–/</id>
    <published>2017-05-26T06:46:00.000Z</published>
    <updated>2017-09-23T16:20:54.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ZooKeeperé›†ç¾¤å¿«é€Ÿæ­å»ºä¸ä¼˜åŒ–"><a href="#ZooKeeperé›†ç¾¤å¿«é€Ÿæ­å»ºä¸ä¼˜åŒ–" class="headerlink" title="ZooKeeperé›†ç¾¤å¿«é€Ÿæ­å»ºä¸ä¼˜åŒ–"></a>ZooKeeperé›†ç¾¤å¿«é€Ÿæ­å»ºä¸ä¼˜åŒ–</h3><p>ä¹‹å‰æè¿‡äº†hadoopå’Œsparkï¼Œhueï¼Œç°åœ¨åœ¨å¼„ä¸‹zookeeperé›†ç¾¤ï¼Œæ–‡æ¡£å°±æ•´ç†ä¸‹ã€‚<br>æœ¬æ–‡æ˜¯<code>ZooKeeper</code>çš„å¿«é€Ÿæ­å»º,æ—¨åœ¨å¸®åŠ©å¤§å®¶ä»¥æœ€å¿«çš„é€Ÿåº¦å®Œæˆä¸€ä¸ª<code>ZK</code>é›†ç¾¤çš„æ­å»º,ä»¥ä¾¿å¼€å±•å…¶å®ƒå·¥ä½œã€‚</p><a id="more"></a><h2 id="é›†ç¾¤ï¼š"><a href="#é›†ç¾¤ï¼š" class="headerlink" title="é›†ç¾¤ï¼š"></a>é›†ç¾¤ï¼š</h2><p>æœ¬æ–‡ä½¿ç”¨äº†3å°æœºå™¨éƒ¨ç½²ZooKeeperé›†ç¾¤ï¼ŒIPå’Œä¸»æœºåå¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">IP            ä¸»æœºå</div><div class="line">10.46.72.172  namenode</div><div class="line">10.47.88.103  datenode1</div><div class="line">10.47.88.206  datenode2</div></pre></td></tr></table></figure><h3 id="å®‰è£…è¯´æ˜"><a href="#å®‰è£…è¯´æ˜" class="headerlink" title="å®‰è£…è¯´æ˜"></a>å®‰è£…è¯´æ˜</h3><p><code>Zookeeper</code>æœºå™¨é—´ä¸éœ€è¦è®¾ç½®å…å¯†ç ç™»å½•ï¼Œå…¶å®ƒhadoopä¹Ÿå¯ä»¥ä¸è®¾ç½®ï¼Œåªè¦ä¸ä½¿ç”¨hadoop-daemons.shæ¥å¯åŠ¨ã€åœæ­¢è¿›ç¨‹ï¼Œæ³¨æ„ä¸æ˜¯hadoop-daemon.shï¼Œè€Œæ˜¯å¸¦â€œsâ€çš„é‚£ä¸ªï¼Œå¸¦â€œsâ€çš„ä¼šè¯»å–hadoopçš„salvesæ–‡ä»¶ï¼Œè¿œç¨‹sshå¯åŠ¨DataNodeå’Œå¤‡NameNodeç­‰ã€‚</p><h3 id="é…ç½®-etc-hosts"><a href="#é…ç½®-etc-hosts" class="headerlink" title="é…ç½®/etc/hosts"></a>é…ç½®/etc/hosts</h3><p>å°†3å°æœºå™¨çš„IPå’Œä¸»æœºåæ˜ å°„å…³ç³»ï¼Œåœ¨3å°æœºå™¨ä¸Šéƒ½é…ç½®ä¸€ä¸‹ï¼Œäº¦å³åœ¨3å°æœºå™¨çš„/etc/hostsæ–‡ä»¶ä¸­ï¼Œå‡å¢åŠ ä»¥ä¸‹å†…å®¹ï¼ˆå¯ä»¥å…ˆé…ç½®å¥½ä¸€å°ï¼Œç„¶åé€šè¿‡scpç­‰å‘½ä»¤å¤åˆ¶åˆ°å…¶å®ƒæœºå™¨ä¸Šï¼Œæ³¨æ„ä¸»æœºåä¸èƒ½åŒ…å«ä»»ä½•ä¸‹åˆ’çº¿ï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">127.0.0.1 localhost  namenode</div><div class="line">::1        localhost localhost.localdomain localhost6 localhost6.localdomain6</div><div class="line">10.47.100.90 salt</div><div class="line">10.46.72.172  namenode</div><div class="line">10.47.88.103 datenode1</div><div class="line">10.47.88.206 datenode2</div><div class="line">10.47.102.137 datenode3</div></pre></td></tr></table></figure><h3 id="Step1"><a href="#Step1" class="headerlink" title="Step1:"></a>Step1:</h3><p>é…ç½® JAVA ç¯å¢ƒã€‚æ£€éªŒæ–¹æ³•:æ‰§è¡Œ <code>java â€“version</code> å’Œ <code>javac â€“version</code> å‘½ä»¤ã€‚</p><p>ä¸‹è½½å¹¶è§£å‹ <code>zookeeper</code>ã€‚<a href="http://mirror.bjtu.edu.cn/apache/zookeeper/zookeeper-3.4.3/" target="_blank" rel="external">é“¾æ¥ä¸€</a> ï¼Œ<a href="http://www-eu.apache.org/dist/zookeeper/" target="_blank" rel="external">é“¾æ¥äºŒ</a> (æ›´å¤šç‰ˆæœ¬:<a href="http://dwz.cn/37HGI" target="_blank" rel="external">http://dwz.cn/37HGI</a>)</p><h3 id="Step2"><a href="#Step2" class="headerlink" title="Step2:"></a>Step2:</h3><p>2.zookeeperçš„ç¯å¢ƒå˜é‡çš„é…ç½®ï¼š<br>ä¸ºäº†ä»Šåæ“ä½œæ–¹ä¾¿ï¼Œæˆ‘ä»¬éœ€è¦å¯¹Zookeeperçš„ç¯å¢ƒå˜é‡è¿›è¡Œé…ç½®ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š<br>åœ¨/etc/profileæ–‡ä»¶ä¸­åŠ å…¥å¦‚ä¸‹çš„å†…å®¹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#set zookeeper environment</span></div><div class="line"></div><div class="line"><span class="built_in">export</span> ZOOKEEPER_HOME=/srv/hadoop/zookeeper-3.3.6</div><div class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$ZOOKEEPER_HOME</span>/bin:<span class="variable">$ZOOKEEPER_HOME</span>/conf</div></pre></td></tr></table></figure><h3 id="Step3"><a href="#Step3" class="headerlink" title="Step3:"></a>Step3:</h3><p>ä¸‹è½½ä»¥åè§£å‹åˆ°æˆ‘è‡ªå·±æ–°å»ºçš„ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[hadoop@namenode ~]$ tar -zxvf zookeeper-3.3.6.tar.gz -C /srv/hadoop/</div><div class="line">[hadoop@namenode ]$ <span class="built_in">cd</span> /srv/hadoop/zookeeper-3.3.6/conf/</div></pre></td></tr></table></figure><p>å°†<code>zoo_sample.cfg</code>æ‹·è´ä¸€ä»½å‘½åä¸º<code>zoo.cfg</code>,è¿™é‡Œæˆ‘æ‹·è´ä¸€ä»½å‘½åä¸ºï¼š<code>zoo.cfg</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[hadoop@namenode conf]$ cp -r zoo_sample.cfg zoo.cfg</div></pre></td></tr></table></figure><p>è¿™é‡Œå…ˆåˆ›å»º/dataå’Œ/logs è¿™ä¸¤ä¸ªç›®å½•ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mkdir -p /srv/hadoop/zookeeper-3.3.6/zookeeper/data</div><div class="line">mkdir -p /srv/hadoop/zookeeper-3.3.6/zookeeper/logs</div></pre></td></tr></table></figure><p>æ³¨æ„ä¸Šå›¾çš„é…ç½®ä¸­masterï¼Œslave1åˆ†åˆ«ä¸ºä¸»æœºåã€‚</p><p>åœ¨ä¸Šé¢çš„é…ç½®æ–‡ä»¶ä¸­<code>&quot;server.id=host:port:port&quot;</code>ä¸­çš„ç¬¬ä¸€ä¸ªportæ˜¯ä»æœºå™¨<code>ï¼ˆfollowerï¼‰</code>è¿æ¥åˆ°ä¸»æœºå™¨<code>ï¼ˆleaderï¼‰</code>çš„ç«¯å£å·ï¼Œç¬¬äºŒä¸ªportæ˜¯è¿›è¡Œleadershipé€‰ä¸¾çš„ç«¯å£å·ã€‚</p><p>ä¿®æ”¹é…ç½®ï¼š</p><p><code>vi zoo.cfg</code>ï¼Œä¿®æ”¹æœ‰çš„é»˜è®¤å­˜åœ¨ï¼Œæ·»åŠ çº¢è‰²çš„å†…å®¹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">tickTime=2000</div><div class="line"></div><div class="line">clientPort=2181</div><div class="line"></div><div class="line">initLimit=10</div><div class="line"></div><div class="line">syncLimit=5</div><div class="line">maxClientCnxns=0 è¿™ä¸ªæ˜¯è®¾ç½®è¿æ¥æ•°0æ²¡æœ‰åšé™åˆ¶</div><div class="line">dataDir=/haozhuo/hadoop/zookeeper-3.3.6/zookeeper/data</div><div class="line">dataLogDir=/haozhuo/hadoop/zookeeper-3.3.6/zookeeper/logs</div><div class="line"></div><div class="line">server.0=namenode:2888:3888</div><div class="line">server.1=datanode1:2888:3888</div><div class="line">server.2=datanode2:2888:3888</div></pre></td></tr></table></figure><h3 id="åˆ›å»ºmaid"><a href="#åˆ›å»ºmaid" class="headerlink" title="åˆ›å»ºmaid:"></a>åˆ›å»ºmaid:</h3><p>è¿™é‡Œæ‰€æœ‰èŠ‚ç‚¹éƒ½éœ€è¦åˆ›å»ºã€‚<br>æ¥ä¸‹æ¥åœ¨<code>dataDir</code>æ‰€æŒ‡å®šçš„ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–‡ä»¶åä¸º<code>myid</code>çš„æ–‡ä»¶ï¼Œæ–‡ä»¶ä¸­çš„å†…å®¹åªæœ‰ä¸€è¡Œï¼Œä¸ºæœ¬ä¸»æœºå¯¹åº”çš„idå€¼ï¼Œä¹Ÿå°±æ˜¯ä¸Šå›¾ä¸­server.idä¸­çš„idã€‚ä¾‹å¦‚ï¼šåœ¨æœåŠ¡å™¨1ä¸­çš„myidçš„å†…å®¹åº”è¯¥å†™å…¥1ã€‚<br>åˆ›å»ºmyidï¼šåœ¨<code>zoo.cfg</code>é…ç½®æ–‡ä»¶ä¸­çš„dataDirçš„ç›®å½•ä¸‹é¢åˆ›å»º<code>myid</code>ï¼Œæ¯ä¸ªèŠ‚ç‚¹myidè¦æ±‚ä¸ä¸€æ ·ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /srv/hadoop/zookeeper-3.3.6/zookeeper/data</div><div class="line">touch myid</div></pre></td></tr></table></figure><h3 id="Step4"><a href="#Step4" class="headerlink" title="Step4:"></a>Step4:</h3><p>è¿œç¨‹å¤åˆ¶åˆ†å‘å®‰è£…æ–‡ä»¶<br>æœ€å¥½æ˜¯æŠŠæ–‡ä»¶æ‰“åŒ…scpè¿‡å»<br>æ¥ä¸‹æ¥å°†ä¸Šé¢çš„å®‰è£…æ–‡ä»¶æ‹·è´åˆ°é›†ç¾¤ä¸­çš„å…¶ä»–æœºå™¨ä¸Šå¯¹åº”çš„ç›®å½•ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">haduser@master:~/zookeeper$ scp -r zookeeper-3.4.5/ slave1:/srv/hadoop/</div><div class="line"></div><div class="line">haduser@master:~/zookeeper$ scp -r zookeeper-3.4.5/ slave2:/srv/hadoop/</div></pre></td></tr></table></figure><p>æ‹·è´å®Œæˆåä¿®æ”¹å¯¹åº”çš„æœºå™¨ä¸Šçš„myidã€‚ä¾‹å¦‚ä¿®æ”¹slave1ä¸­çš„myidå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">haduser@slave1:~/zookeeper/zookeeper-3.4.5$ <span class="built_in">echo</span> <span class="string">"2"</span> &gt; data/myid</div><div class="line">haduser@slave1:~/zookeeper/zookeeper-3.4.5$ cat data/myid</div><div class="line">[hadoop@namenode hadoop]$ <span class="built_in">echo</span> 0 &gt; /haozhuo/hadoop/zookeeper-3.3.6/zookeeper/data/myid</div><div class="line">[hadoop@datanode1 hadoop]$ <span class="built_in">echo</span> 1 &gt; /haozhuo/hadoop/zookeeper-3.3.6/zookeeper/data/myid</div><div class="line">[hadoop@datanode2 hadoop]$ <span class="built_in">echo</span> 2 &gt; /haozhuo/hadoop/zookeeper-3.3.6/zookeeper/data/myid</div></pre></td></tr></table></figure><h3 id="Step5"><a href="#Step5" class="headerlink" title="Step5:"></a>Step5:</h3><p>å¯åŠ¨ ZooKeeperé›†ç¾¤<br>åœ¨ZooKeeperé›†ç¾¤çš„æ¯ä¸ªç»“ç‚¹ä¸Šï¼Œæ‰§è¡Œå¯åŠ¨ZooKeeperæœåŠ¡çš„è„šæœ¬ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">hadoop@namenode:~ /srv/hadoop/zookeeper-3.3.6/bin/zkServer.sh start</div><div class="line">hadoop@datanode1:~ /srv/hadoop/zookeeper-3.3.6/bin/zkServer.sh start</div><div class="line">haduser@datanode2:~ /srv/hadoop/zookeeper-3.3.6/bin/zkServer.sh start</div></pre></td></tr></table></figure><p>æ‰§è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/haozhuo/hadoop/zookeeper-3.3.6/bin/zkServer.sh start</div></pre></td></tr></table></figure><h3 id="Step6"><a href="#Step6" class="headerlink" title="Step6:"></a>Step6:</h3><p>æ£€æµ‹æ˜¯å¦æˆåŠŸå¯åŠ¨:æ‰§è¡Œ <code>jps</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">24933 QuorumPeerMain</div></pre></td></tr></table></figure><p>å…¶ä¸­ï¼ŒQuorumPeerMainæ˜¯zookeeperè¿›ç¨‹ï¼Œå¯åŠ¨æ­£å¸¸ã€‚</p><p><code>./zkServer.sh status</code> æŸ¥çœ‹å½“å‰è¿è¡ŒçŠ¶æ€ã€‚</p><p>namenode1</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[hadoop@namenode zookeeper-3.3.6]<span class="comment"># ./zkServer.sh status</span></div><div class="line">JMX enabled by default</div><div class="line">Using config: /srv/zookeeper-3.3.6/bin/../conf/zoo.cfg</div><div class="line">Mode: follower</div><div class="line"></div><div class="line">[hadoop@datanode1 zookeeper-3.3.6]<span class="comment"># ./bin/zkServer.sh status</span></div><div class="line">JMX enabled by default</div><div class="line">Using config: /srv/zookeeper-3.3.6/bin/../conf/zoo.cfg</div><div class="line">Mode: leader</div><div class="line"></div><div class="line">[hadoop@datanode2 zookeeper-3.3.6]<span class="comment"># ./bin/zkServer.sh status</span></div><div class="line">JMX enabled by default</div><div class="line">Using config: /srv/zookeeper-3.3.6/bin/../conf/zoo.cfg</div><div class="line">Mode: leader</div></pre></td></tr></table></figure><h3 id="é“¾æ¥æµ‹è¯•"><a href="#é“¾æ¥æµ‹è¯•" class="headerlink" title="é“¾æ¥æµ‹è¯•"></a>é“¾æ¥æµ‹è¯•</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">bin/zkCli.sh -server 127.0.0.1:2181</div><div class="line">bin/zkCli.sh -server 127.0.0.1:2181</div><div class="line">bin/zkCli.sh -server 127.0.0.1:2181</div></pre></td></tr></table></figure><h3 id="Step7"><a href="#Step7" class="headerlink" title="Step7:"></a>Step7:</h3><p>å¦‚æœå•å°å¯ä»¥å…¶ä»–å‡ å°ä¸è¡Œï¼Œçœ‹é…ç½®ï¼Œå¦‚æœæ²¡æœ‰é—®é¢˜ã€‚å¯åŠ¨æŸ¥çœ‹çŠ¶æ€å‡ºç°å¼‚å¸¸ã€‚</p><p>å¼‚å¸¸è§£å†³:<code>Error contacting service. It is probably not running.</code></p><p>è€Œå…¶ä»–ä¸€ä¸ªèŠ‚ç‚¹å´æ˜¯ç°å®æ­£å¸¸;</p><p>å…ˆ<code>stop</code> æ‰åŸ<code>zk</code></p><p><code>./bin/zkServer.sh stop</code></p><p>ç„¶åä»¥start-foregroundæ–¹å¼å¯åŠ¨ï¼Œä¼šçœ‹åˆ°å¯åŠ¨æ—¥å¿—</p><p><code>./bin/zkServer.sh start</code></p><p>å½“å‡ºç°é—®é¢˜çš„æ—¶å€™ï¼Œè®°å¾—æŸ¥çœ‹æ—¥å¿—zookeeper.outï¼Œåœ¨ä½ é…ç½®çš„dataDirï¼ˆåœ¨conf/zoo.cfgä¸­æŸ¥çœ‹ï¼‰ç›®å½•ä¸‹ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">2015-12-29 11:09:38,034 [myid:1] - WARN  [WorkerSender[myid=1]:QuorumCnxManager@400] - Cannot open channel to 3 at election address Node2/10.0.0.102:38888</div><div class="line">java.net.ConnectException: æ‹’ç»è¿æ¥</div><div class="line">        at java.net.PlainSocketImpl.socketConnect(Native Method)</div><div class="line">        at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:339)</div><div class="line">        at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:200)</div><div class="line">        at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:182)</div><div class="line">        at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392)</div><div class="line">        at java.net.Socket.connect(Socket.java:579)</div><div class="line">        at org.apache.zookeeper.server.quorum.QuorumCnxManager.connectOne(QuorumCnxManager.java:381)</div><div class="line">        at org.apache.zookeeper.server.quorum.QuorumCnxManager.toSend(QuorumCnxManager.java:354)</div><div class="line">        at org.apache.zookeeper.server.quorum.FastLeaderElection<span class="variable">$Messenger</span><span class="variable">$WorkerSender</span>.process(FastLeaderElection.java:452)</div><div class="line">        at org.apache.zookeeper.server.quorum.FastLeaderElection<span class="variable">$Messenger</span><span class="variable">$WorkerSender</span>.run(FastLeaderElection.java:433)</div><div class="line">        at java.lang.Thread.run(Thread.java:745)</div></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æ˜¯è¿æ¥åˆ°Node2çš„3888ç«¯å£ä¸é€šï¼ˆæˆ‘é…ç½®æ–‡ä»¶è®¾ç½®çš„èŠ‚ç‚¹ç«¯å£ï¼Œserver.3=Node2:2888:3888ï¼‰ï¼Œè¿™æ ·å°±æ‰¾åˆ°é—®é¢˜äº†ï¼Œæ‰€ä»¥å½“é‡åˆ°é—®é¢˜çš„æ—¶å€™è®°å¾—æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ï¼Œè¿™æ‰æ˜¯æœ€æœ‰å¸®åŠ©çš„ï¼Œè€Œä¸æ˜¯ä¿®æ”¹ä»€ä¹ˆncå‚æ•°ã€‚</p><p>è¿™é‡Œä¸»è¦çœ‹ä¸‹æ˜¯å¦åŠ å…¥hosts</p><p>æŸ¥çœ‹Node2èŠ‚ç‚¹å‘ç°ï¼Œ38888ç«¯å£ç»‘å¸¦åˆ°127.0.0.1ä¸Šäº†ï¼Œè¿™è®©MasterèŠ‚ç‚¹æ€ä¹ˆè¿æ¥å‘€ï¼Œåªéœ€ä¿®æ”¹/etc/hostsæ–‡ä»¶å³å¯ï¼ŒåŒç†ï¼Œä¿®æ”¹Node1ï¼Œç„¶åé‡å¯zookeeperï¼Œå‘ç°é—®é¢˜è§£å†³ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">127.0.0.1 localhost  namenode</div><div class="line">::1        localhost localhost.localdomain localhost6 localhost6.localdomain6</div><div class="line">10.47.100.90 salt</div><div class="line">10.46.72.172  namenode</div><div class="line">10.47.88.103 datenode1</div><div class="line">10.47.88.206 datenode2</div><div class="line">10.47.102.137 datenode3</div></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘<code>127.0.0.1 localhost namenode</code> å°±å¯ä»¥äº†ã€‚</p><h3 id="Step8-å¦‚ä½•æ‰©å®¹zookeeperï¼Ÿ"><a href="#Step8-å¦‚ä½•æ‰©å®¹zookeeperï¼Ÿ" class="headerlink" title="Step8: å¦‚ä½•æ‰©å®¹zookeeperï¼Ÿ"></a>Step8: å¦‚ä½•æ‰©å®¹zookeeperï¼Ÿ</h3><p>åªéœ€è¦å°†å·²æœ‰çš„zookeeperæ‰“åŒ…å¤åˆ¶åˆ°æ–°çš„æœºå™¨ä¸Šï¼Œç„¶åä¿®æ”¹myidæ–‡ä»¶å¹¶è®¾ç½®å¥½ï¼Œç„¶åå¯åŠ¨zookeeperå³å¯ã€‚</p><hr><h3 id="è®¾ç½®å¼€æœºè‡ªåŠ¨å¯åŠ¨"><a href="#è®¾ç½®å¼€æœºè‡ªåŠ¨å¯åŠ¨" class="headerlink" title="è®¾ç½®å¼€æœºè‡ªåŠ¨å¯åŠ¨"></a>è®¾ç½®å¼€æœºè‡ªåŠ¨å¯åŠ¨</h3><p>1.å†™ä¸ªå¯åŠ¨è„šæœ¬æ”¾åˆ°/etc/rc.d/init.d/zookeeper</p><p>è¿™é‡Œtouch zookeeper &amp;&amp; chmod +x zookeeper &amp;&amp; vim zookeeper</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">!/bin/bash</div><div class="line"><span class="comment">#chkconfig:2345 20 90</span></div><div class="line"><span class="comment">#description:zookeeper</span></div><div class="line"><span class="comment">#processname:zookeeper</span></div><div class="line"><span class="built_in">export</span> JAVA_HOME=/srv/jdk1.8.0_66</div><div class="line"><span class="built_in">export</span> PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$PATH</span></div><div class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></div><div class="line">    start) su root /srv/zookeeper-3.3.6/bin/zkServer.sh start;;</div><div class="line">    stop) su root /srv/zookeeper-3.3.6/bin/zkServer.sh stop;;</div><div class="line">    status) su root /srv/zookeeper-3.3.6/bin/zkServer.sh status;;</div><div class="line">    restart) su root /srv/zookeeper-3.3.6/bin/zkServer.shrestart;;</div><div class="line">    *)  <span class="built_in">echo</span> <span class="string">"requirestart|stop|status|restart"</span>;;</div><div class="line"><span class="keyword">esac</span></div></pre></td></tr></table></figure><p>2.è®¾ç½®å¼€æœºå¯åŠ¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">chkconfig zookeeper on</div></pre></td></tr></table></figure><p>3.éªŒè¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">chkconfig --add zookeeper</div><div class="line">chkconfig --list zookeeper</div></pre></td></tr></table></figure><p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥ç”¨service zookeeper start/stopæ¥å¯åŠ¨åœæ­¢zookeeperæœåŠ¡äº†.<br>ä½¿ç”¨<code>chkconfig--add zookeeper</code>å‘½ä»¤æŠŠ<code>zookeeper</code>æ·»åŠ åˆ°å¼€æœºå¯åŠ¨é‡Œé¢<br>æ·»åŠ å®Œæˆä¹‹åæ¥è¿™ä¸ªä½¿ç”¨<code>chkconfig--list</code>æ¥çœ‹çœ‹æˆ‘ä»¬æ·»åŠ çš„<code>zookeeper</code>æ˜¯å¦åœ¨é‡Œé¢<br>å¦‚æœä¸Šé¢çš„æ“ä½œéƒ½æ­£å¸¸çš„è¯ï¼›é‡å¯æœåŠ¡å™¨æµ‹è¯•å°±è¡Œã€‚</p><div class="tip"><br><br>æ³¨æ„ï¼šzookeeperé‡å¯å‡ºç°å‡ ç§æŠ¥é”™ï¼š<br><br>1. å¯åŠ¨æœåŠ¡æŠ¥é”™æ‰¾ä¸åˆ°æŒ‡å®šå¥½çš„pidæ–‡ä»¶ã€‚<br>2. å…³é—­æœåŠ¡æŠ¥é”™æ²¡æœ‰åœ¨/tmp/è·¯å¾„ä¸‹é¢æ²¡æœ‰/srv/zookeeper-3.3.6/zookeeper/data/zookeeper_server.pid<br></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">[root@zookeeper zookeeper-3.3.6]<span class="comment"># ./bin/zkServer.sh start</span></div><div class="line">JMX enabled by default</div><div class="line">Using config: /srv/zookeeper-3.3.6/bin/../conf/zoo.cfg</div><div class="line">Starting zookeeper ... ./bin/zkServer.sh: line 93: [: /tmp/zookeeper: binary operator expected</div><div class="line">./bin/zkServer.sh: line 103: /tmp/zookeeper</div><div class="line">/srv/zookeeper-3.3.6/zookeeper/data/zookeeper_server.pid: æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•</div><div class="line">FAILED TO WRITE PID</div><div class="line">[root@zookeeper zookeeper-3.3.6]<span class="comment"># ./bin/zkServer.sh stop</span></div><div class="line">JMX enabled by default</div><div class="line">Using config: /srv/zookeeper-3.3.6/bin/../conf/zoo.cfg</div><div class="line">Stopping zookeeper ... no zookeeper to stop (could not find file /tmp/zookeeper</div><div class="line">/srv/zookeeper-3.3.6/zookeeper/data/zookeeper_server.pid)</div></pre></td></tr></table></figure><p>è§£å†³æ–¹æ³•ï¼šç½‘ä¸Šå¾ˆå°‘æœ‰äººè®²è¿™ä¹ˆè¯¦ç»†ï¼Œè¿™é‡Œæˆ‘å°±è¯´ä¸‹ï¼Œå°±æ˜¯ä½ åœ¨ä¿®æ”¹zoo.cfgé…ç½®æ–‡ä»¶é‡Œé¢ï¼š</p><p>dataDiræŒ‡å®šçš„è·¯å¾„æ˜¯è‡ªå®šä¹‰çš„è¯ç­‰äºçš„æ—¶å€™ä¸è¦ç©ºæ ¼å†™ã€‚</p><p>å¦‚æœé‡æ–°å¦å¤–å†™dataDir ,ä¸è¦æ³¨é‡Šæ‰ä¹‹å‰çš„ï¼Œæœ€å¥½ç›´æ¥åˆ é™¤ï¼Œé‡æ–°æŒ‡å®šè¿™æ ·å°±ä¸ä¼šæŠ¥é”™äº†ï¼Œå¦‚æœæ³¨é‡Šæ‰é»˜è®¤çš„<code>#dataDir = /tmp</code>è¿™é‡Œéœ€è¦ç©ºæ ¼ã€‚</p><h3 id="æŠ¥é”™-å ç”¨ç«¯å£ï¼š"><a href="#æŠ¥é”™-å ç”¨ç«¯å£ï¼š" class="headerlink" title="æŠ¥é”™ å ç”¨ç«¯å£ï¼š"></a>æŠ¥é”™ å ç”¨ç«¯å£ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">JMX enabled by default</div><div class="line">Using config: /opt/app/zookeeper/bin/../conf/zoo3.cfg</div><div class="line">Starting zookeeper ... STARTED</div></pre></td></tr></table></figure><p>æŸ¥çœ‹çŠ¶æ€ï¼š<br>ç”¨jpså‘½ä»¤æŸ¥çœ‹è¿›ç¨‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># jps</span></div><div class="line">24617 QuorumPeerMain ï¼ˆè¿™ä¸ªå°±æ˜¯zookeeperè¿›ç¨‹ï¼‰</div><div class="line"></div><div class="line">/opt/app/zookeeper/bin/zkServer.sh status zoo1.cfg</div><div class="line">JMX enabled by default</div><div class="line">Using config: /opt/app/zookeeper/bin/../conf/zoo1.cfg</div><div class="line">Error contacting service. It is probably not running.</div></pre></td></tr></table></figure><p>Ihaozhuo_b3314<br>è¯´æ˜æœ‰é”™è¯¯ï¼ŒæŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># cd &lt;zookeeper_home&gt;</span></div><div class="line"><span class="comment"># less zookeeper.out</span></div><div class="line">java.net.BindException: åœ°å€å·²åœ¨ä½¿ç”¨</div><div class="line">æ€æ‰å½“å‰è¿›ç¨‹ï¼š</div><div class="line"><span class="comment"># kill -9 24617</span></div></pre></td></tr></table></figure><h3 id="æŠ¥é”™-å¯åŠ¨æœåŠ¡æ­£å¸¸ã€‚"><a href="#æŠ¥é”™-å¯åŠ¨æœåŠ¡æ­£å¸¸ã€‚" class="headerlink" title="æŠ¥é”™: å¯åŠ¨æœåŠ¡æ­£å¸¸ã€‚"></a>æŠ¥é”™: å¯åŠ¨æœåŠ¡æ­£å¸¸ã€‚</h3><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@api1 zookeeper<span class="number">-3.3</span><span class="number">.6</span>]<span class="comment"># ./bin/zkServer.sh start</span></div><div class="line">JMX enabled <span class="keyword">by</span> <span class="keyword">default</span></div><div class="line">Using config: <span class="regexp">/srv/zookeeper-3.3.6/bin/</span>../conf/zoo.cfg</div><div class="line">Starting zookeeper ... STARTED</div></pre></td></tr></table></figure><p>å¯æ˜¯æŸ¥è¯¢è¿›ç¨‹ä¸å­˜åœ¨ï¼Œå¯æ˜¯çœ‹pidæ˜¯æœ‰çš„ï¼Œç„¶åå…³é—­æœåŠ¡å°±è¯´æ²¡æœ‰è¿™ä¸ªè¿›ç¨‹ã€‚</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">JMX enabled by <span class="keyword">default</span></div><div class="line">Using <span class="string">config:</span> <span class="regexp">/srv/</span>zookeeper<span class="number">-3.3</span><span class="number">.6</span><span class="regexp">/bin/</span>..<span class="regexp">/conf/</span>zoo.cfg</div><div class="line">Stopping zookeeper ... ./zkServer.<span class="string">sh:</span> line <span class="number">133</span>: <span class="string">kill:</span> (<span class="number">31415</span>) - æ²¡æœ‰é‚£ä¸ªè¿›ç¨‹</div></pre></td></tr></table></figure><h3 id="èµ°kafkaæŸ¥çœ‹æ˜¯å¦æ‰€æœ‰èŠ‚ç‚¹éƒ½å¯åŠ¨ï¼š"><a href="#èµ°kafkaæŸ¥çœ‹æ˜¯å¦æ‰€æœ‰èŠ‚ç‚¹éƒ½å¯åŠ¨ï¼š" class="headerlink" title="èµ°kafkaæŸ¥çœ‹æ˜¯å¦æ‰€æœ‰èŠ‚ç‚¹éƒ½å¯åŠ¨ï¼š"></a>èµ°kafkaæŸ¥çœ‹æ˜¯å¦æ‰€æœ‰èŠ‚ç‚¹éƒ½å¯åŠ¨ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">[root@kafka_03 bin]<span class="comment"># sh zkCli.sh</span></div><div class="line">Connecting to localhost:2181</div><div class="line">2017-01-04 19:20:24,849 [myid:] - INFO  [main:Environment@100] - Client environment:zookeeper.version=3.4.6-1569965, built on 02/20/2014 09:09 GMT</div><div class="line">2017-01-04 19:20:24,853 [myid:] - INFO  [main:Environment@100] - Client environment:host.name=kafka_03</div><div class="line">2017-01-04 19:20:24,853 [myid:] - INFO  [main:Environment@100] - Client environment:java.version=1.8.0_66</div><div class="line">2017-01-04 19:20:24,856 [myid:] - INFO  [main:Environment@100] - Client environment:java.vendor=Oracle Corporation</div><div class="line">2017-01-04 19:20:24,856 [myid:] - INFO  [main:Environment@100] - Client environment:java.home=/srv/jdk1.8.0_66/jre</div><div class="line">2017-01-04 19:20:24,856 [myid:] - INFO  [main:Environment@100] - Client environment:java.class.path=/srv/zookeeper-3.4.6/bin/../build/classes:/srv/zookeeper-3.4.6/bin/../build/lib/*.jar:/srv/zookeeper-3.4.6/bin/../lib/slf4j-log4j12-1.6.1.jar:/srv/zookeeper-3.4.6/bin/../lib/slf4j-api-1.6.1.jar:/srv/zookeeper-3.4.6/bin/../lib/netty-3.7.0.Final.jar:/srv/zookeeper-3.4.6/bin/../lib/<span class="built_in">log</span>4j-1.2.16.jar:/srv/zookeeper-3.4.6/bin/../lib/jline-0.9.94.jar:/srv/zookeeper-3.4.6/bin/../zookeeper-3.4.6.jar:/srv/zookeeper-3.4.6/bin/../src/java/lib/*.jar:/srv/zookeeper-3.4.6/bin/../conf:</div><div class="line">2017-01-04 19:20:24,856 [myid:] - INFO  [main:Environment@100] - Client environment:java.library.path=/usr/java/packages/lib/amd64:/usr/lib64:/lib64:/lib:/usr/lib</div><div class="line"></div><div class="line">[zk: localhost:2181(CONNECTED) 0] ls /</div><div class="line">[controller_epoch, brokers, zookeeper, kafka, dubbo, admin, isr_change_notification, consumers, config, sthp]</div><div class="line">[zk: localhost:2181(CONNECTED) 5] ls /kafka/brokers/ids</div><div class="line">[0, 1, 2]</div><div class="line"></div><div class="line">æ˜¾ç¤º0 1 2 ä¸‰å°é›†ç¾¤æœºå™¨ã€‚</div></pre></td></tr></table></figure><p>kafka ä¸‰å°é›†ç¾¤è¿™é‡Œå¯ä»¥çœ‹åˆ°è·å–åˆ°idsã€‚</p><h3 id="Step9-ç›¸å…³æ–‡æ¡£"><a href="#Step9-ç›¸å…³æ–‡æ¡£" class="headerlink" title="Step9: ç›¸å…³æ–‡æ¡£"></a>Step9: ç›¸å…³æ–‡æ¡£</h3><p>ã€ŠHBase-0.98.0åˆ†å¸ƒå¼å®‰è£…æŒ‡å—ã€‹</p><p>ã€ŠHive 0.12.0å®‰è£…æŒ‡å—ã€‹</p><p>ã€ŠZooKeeper-3.4.6åˆ†å¸ƒå¼å®‰è£…æŒ‡å—ã€‹</p><p>ã€ŠHadoop 2.3.0æºç åå‘å·¥ç¨‹ã€‹</p><p>ã€Šåœ¨Linuxä¸Šç¼–è¯‘Hadoop-2.4.0ã€‹</p><p>ã€ŠAccumulo-1.5.1å®‰è£…æŒ‡å—ã€‹</p><p>ã€ŠDrill 1.0.0å®‰è£…æŒ‡å—ã€‹</p><p>ã€ŠShark 0.9.1å®‰è£…æŒ‡å—ã€‹</p><p>æ›´å¤šï¼Œæ•¬è¯·å…³æ³¨æŠ€æœ¯åšå®¢ï¼š<a href="http://blog.yancy.cc">http://blog.yancy.cc</a></p><h3 id="Step10-ç»“æŸè¯­"><a href="#Step10-ç»“æŸè¯­" class="headerlink" title="Step10:  ç»“æŸè¯­"></a>Step10:  ç»“æŸè¯­</h3><p>è‡³æ­¤ï¼ŒZooKeeperåˆ†å¸ƒå¼å®‰è£…å¤§å‘ŠæˆåŠŸï¼æ›´å¤šç»†èŠ‚ï¼Œè¯·æµè§ˆ<a href="http://zookeeper.apache.org/doc/trunk/zookeeperStarted.html" target="_blank" rel="external">å®˜æ–¹æ–‡æ¡£</a></p><h3 id="äº¤æµå­¦ä¹ ï¼š"><a href="#äº¤æµå­¦ä¹ ï¼š" class="headerlink" title="äº¤æµå­¦ä¹ ï¼š"></a>äº¤æµå­¦ä¹ ï¼š</h3><p>ğŸ§  Linux shell_é«˜çº§è¿ç»´æ´¾: <code>459096184</code>    åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)<br>ğŸ§  BigData-Exchange School : <code>521621407</code>  åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥</p><p>ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;ZooKeeperé›†ç¾¤å¿«é€Ÿæ­å»ºä¸ä¼˜åŒ–&quot;&gt;&lt;a href=&quot;#ZooKeeperé›†ç¾¤å¿«é€Ÿæ­å»ºä¸ä¼˜åŒ–&quot; class=&quot;headerlink&quot; title=&quot;ZooKeeperé›†ç¾¤å¿«é€Ÿæ­å»ºä¸ä¼˜åŒ–&quot;&gt;&lt;/a&gt;ZooKeeperé›†ç¾¤å¿«é€Ÿæ­å»ºä¸ä¼˜åŒ–&lt;/h3&gt;&lt;p&gt;ä¹‹å‰æè¿‡äº†hadoopå’Œsparkï¼Œhueï¼Œç°åœ¨åœ¨å¼„ä¸‹zookeeperé›†ç¾¤ï¼Œæ–‡æ¡£å°±æ•´ç†ä¸‹ã€‚&lt;br&gt;æœ¬æ–‡æ˜¯&lt;code&gt;ZooKeeper&lt;/code&gt;çš„å¿«é€Ÿæ­å»º,æ—¨åœ¨å¸®åŠ©å¤§å®¶ä»¥æœ€å¿«çš„é€Ÿåº¦å®Œæˆä¸€ä¸ª&lt;code&gt;ZK&lt;/code&gt;é›†ç¾¤çš„æ­å»º,ä»¥ä¾¿å¼€å±•å…¶å®ƒå·¥ä½œã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Bigdata Hadoop" scheme="http://blog.yancy.cc/categories/Bigdata-Hadoop/"/>
    
    
      <category term="ZooKeeper" scheme="http://blog.yancy.cc/tags/ZooKeeper/"/>
    
  </entry>
  
  <entry>
    <title>Bigdata-hadoopæ–°å¢èŠ‚ç‚¹é›†ç¾¤å¯åŠ¨è¯·æ±‚å¼‚å¸¸ï¼šLast contactï¼š200</title>
    <link href="http://blog.yancy.cc/2017/05/08/Bigdata-hadoop/%20hadoop%E6%96%B0%E5%A2%9E%E8%8A%82%E7%82%B9%E9%9B%86%E7%BE%A4%E5%90%AF%E5%8A%A8%E8%AF%B7%E6%B1%82%E5%BC%82%E5%B8%B8%EF%BC%9ALast%20contact%EF%BC%9A200/"/>
    <id>http://blog.yancy.cc/2017/05/08/Bigdata-hadoop/ hadoopæ–°å¢èŠ‚ç‚¹é›†ç¾¤å¯åŠ¨è¯·æ±‚å¼‚å¸¸ï¼šLast contactï¼š200/</id>
    <published>2017-05-08T09:56:03.000Z</published>
    <updated>2017-09-19T08:16:31.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å‰è¨€é—²è°ˆï¼š"><a href="#å‰è¨€é—²è°ˆï¼š" class="headerlink" title="å‰è¨€é—²è°ˆï¼š"></a>å‰è¨€é—²è°ˆï¼š</h3><p>ä¹‹å‰åšCDNäº‘è®¡ç®—å…¬å¸æ¥åˆ°ç¾å¹´å¤§å¥åº·ç°åœ¨åœ¨ä¸€å®¶åŒ»ç–—å¤§æ•°æ®å…¬å¸è´Ÿè´£è¿ç»´éƒ¨é—¨å¤§å¤§å°å°çš„æ´»ï¼Œæ—¢ç„¶æ˜¯åŒ»ç–—å¤§æ•°æ®å½“ç„¶ç¦»ä¸å¼€å¤§æ•°æ®å­˜å‚¨çš„ç»´æŠ¤ï¼Œç°åœ¨ä¹ŸåŒæ—¶ç»´æŠ¤å¤§æ•°æ®è¿ç»´ç›¸å…³å·¥ä½œ <code>hadoop,spark,sqoop,hue,hive,Hbase,zookeeper</code>ç­‰ç­‰ æµ‹è¯•å¼€å‘ç”Ÿäº§ä½¿ç”¨èµ·æ¥,ä»é›†ç¾¤ç¯å¢ƒç»´æŠ¤ æå‡æ•°æ®ç¨³å®šæ€§ é«˜å¯ç”¨ç»´æŠ¤ã€‚</p><p>å‰é¢è¯´äº†ä¸€å †è‡ªå·±é—²èŠï¼ŒçœŸæ­£è§£å†³è¿™æ¬¡é—®é¢˜æ˜¯hadoopæ–°å¢èŠ‚ç‚¹éœ€è¦æ³¨æ„å“ªå‡ ç‚¹ï¼š</p><p><code>æ–°å¢èŠ‚ç‚¹å¦‚ä½•æ–°å¢æˆ‘ä¼šåœ¨å¦å¤–ä¸€ç¯‡è¯¦ç»†è¯´çš„è¿™é‡Œæˆ‘è®²ä¸€äº›éœ€è¦æ³¨æ„æ‰çš„é—®é¢˜ã€‚</code></p><h3 id="éœ€è¦ä¿®æ”¹å‡ ä¸ªé…ç½®ï¼š"><a href="#éœ€è¦ä¿®æ”¹å‡ ä¸ªé…ç½®ï¼š" class="headerlink" title="éœ€è¦ä¿®æ”¹å‡ ä¸ªé…ç½®ï¼š"></a>éœ€è¦ä¿®æ”¹å‡ ä¸ªé…ç½®ï¼š</h3><p>ï¼ˆ1ï¼‰hadoop data æ•°æ®ç›®å½• VERSION é‡Œé¢çš„æ­å»ºé›†ç¾¤æ—¶ï¼Œç›´æ¥å…‹éš†ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ã€‚è§£å†³æ–¹æ³•åŒä¸Šä¸¤ç§ï¼Œæœ€å¥½ä¿®æ”¹${/hadoop/tmp/dir}/dfs/data/current/VERSIONä¸­çš„storageIDï¼Œä½¿å…¶ä¸åŒã€‚ç¬¬ä¸€ç§ä¼šå¯¼è‡´hdfsæ•°æ®ä¸¢å¤±ã€‚</p><p>è§£å†³æ–¹æ³•ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ï¼ˆ1ï¼‰ datanodeå¯åŠ¨æ˜¯ä¼šåŠ è½½DataStorageï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ä¼šformat</div><div class="line">ï¼ˆ2ï¼‰åˆæ¬¡å¯åŠ¨DataStorageçš„storageIDæ˜¯ç©ºçš„ï¼Œæ‰€ä»¥ä¼šç”Ÿæˆä¸€ä¸ªstorageID</div></pre></td></tr></table></figure><p>å‚è€ƒæˆ‘è§£å†³çš„ï¼š<code>è¿™é‡Œæˆ‘æ‹·è´è¿‡æ¥ ç›´æ¥åˆ é™¤ã€‚ç­‰é›†ç¾¤namenodeå¯åŠ¨ ä¼šè‡ªåŠ¨ç”Ÿæˆã€‚</code></p><p>è¿™ä¸ªè§£å†³ä»¥å æ–°å¢çš„æœºå™¨å¿…é¡»å…³é—­é˜²ç«å¢™ã€‚å› ä¸ºè¿™ä¸ªåŸå› ä¼šå¯¼è‡´æˆ‘ hadoopæ–°å¢èŠ‚ç‚¹é›†ç¾¤å¯åŠ¨è¯·æ±‚å¼‚å¸¸ï¼šLast contactï¼š200</p><p>ï¼ˆ2ï¼‰ é›†ç¾¤é‡å¯æ—¶é˜²ç«å¢™è‡ªåŠ¨å¼€å¯å¯¼è‡´ï¼š</p><p>è¿™é‡Œè´´å¼ å›¾ç‰‡ç»™å¤§å®¶çœ‹çœ‹ï¼š</p><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/hadoop1.png" alt=""></figure></p><p>é—®é¢˜ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">2017-07-04 18:43:30,475 INFO org.apache.hadoop.ipc.Client: Retrying connect to server: /192.168.18.218:9000. Already tried 8 time(s).</div><div class="line">2017-07-04 18:43:31,475 INFO org.apache.hadoop.ipc.Client: Retrying connect to server: /192.168.18.218:9000. Already tried 9 time(s).</div><div class="line">2017-07-04 18:43:31,479 ERROR org.apache.hadoop.hdfs.server.datanode.DataNode: java.io.IOException: Call to /192.168.18.218:9000 failed on <span class="built_in">local</span> exception: java.net.NoRouteToHostException: æ²¡æœ‰åˆ°ä¸»æœºçš„è·¯ç”±</div><div class="line">        at org.apache.hadoop.ipc.Client.wrapException(Client.java:775)</div><div class="line">        at org.apache.hadoop.ipc.Client.call(Client.java:743)</div><div class="line">è§£å†³æ–¹æ³•ï¼šåœ¨rootæƒé™ä¸‹å…³é—­é˜²ç«å¢™ï¼šservice iptables stop</div></pre></td></tr></table></figure><p>æœ€å¥½é…ç½®æˆæœºå™¨é‡å¯é»˜è®¤é˜²ç«å¢™å…³é—­ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@junlings ~]<span class="comment"># chkconfig iptables off   #å¼€æœºä¸å¯åŠ¨é˜²ç«å¢™æœåŠ¡</span></div><div class="line">[root@junlings ~]<span class="comment"># chkconfig iptables on   #å¼€æœºå¯åŠ¨é˜²ç«å¢™æœåŠ¡</span></div></pre></td></tr></table></figure><p>è§£å†³ä»¥åæœåŠ¡é‡æ–°è·‘ä¸€éå·²ç»æå®šã€‚</p><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/hadoop2.png" alt=""></figure><br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/hadoop3.png" alt=""></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;å‰è¨€é—²è°ˆï¼š&quot;&gt;&lt;a href=&quot;#å‰è¨€é—²è°ˆï¼š&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€é—²è°ˆï¼š&quot;&gt;&lt;/a&gt;å‰è¨€é—²è°ˆï¼š&lt;/h3&gt;&lt;p&gt;ä¹‹å‰åšCDNäº‘è®¡ç®—å…¬å¸æ¥åˆ°ç¾å¹´å¤§å¥åº·ç°åœ¨åœ¨ä¸€å®¶åŒ»ç–—å¤§æ•°æ®å…¬å¸è´Ÿè´£è¿ç»´éƒ¨é—¨å¤§å¤§å°å°çš„æ´»ï¼Œæ—¢ç„¶æ˜¯åŒ»ç–—å¤§æ•°æ®å½“ç„¶ç¦»ä¸å¼€å¤§æ•°
      
    
    </summary>
    
      <category term="å¤§æ•°æ®" scheme="http://blog.yancy.cc/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
    
      <category term="Big data Hadoop" scheme="http://blog.yancy.cc/tags/Big-data-Hadoop/"/>
    
  </entry>
  
  <entry>
    <title>HORTONW0RKSæ•°æ®å¹³å°å®ç°æ­å»ºAmbarié…ç½®å’Œéƒ¨ç½²HDPé›†ç¾¤ç›‘æ§Hadoopé›†ç¾¤</title>
    <link href="http://blog.yancy.cc/2017/05/08/Bigdata-hadoop/HORTONW0RKS%E6%95%B0%E6%8D%AE%E5%B9%B3%E5%8F%B0%E5%AE%9E%E7%8E%B0%E6%90%AD%E5%BB%BAAmbari%E9%85%8D%E7%BD%AE%E5%92%8C%E9%83%A8%E7%BD%B2HDP%E9%9B%86%E7%BE%A4%E7%9B%91%E6%8E%A7Hadoop%E9%9B%86%E7%BE%A4%20/"/>
    <id>http://blog.yancy.cc/2017/05/08/Bigdata-hadoop/HORTONW0RKSæ•°æ®å¹³å°å®ç°æ­å»ºAmbarié…ç½®å’Œéƒ¨ç½²HDPé›†ç¾¤ç›‘æ§Hadoopé›†ç¾¤ /</id>
    <published>2017-05-08T09:56:03.000Z</published>
    <updated>2017-09-19T08:16:14.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="HORTONW0RKSæ•°æ®å¹³å°æ­å»ºAmbariç®¡ç†ç›‘æ§Hadoopé›†ç¾¤"><a href="#HORTONW0RKSæ•°æ®å¹³å°æ­å»ºAmbariç®¡ç†ç›‘æ§Hadoopé›†ç¾¤" class="headerlink" title="HORTONW0RKSæ•°æ®å¹³å°æ­å»ºAmbariç®¡ç†ç›‘æ§Hadoopé›†ç¾¤"></a>HORTONW0RKSæ•°æ®å¹³å°æ­å»ºAmbariç®¡ç†ç›‘æ§Hadoopé›†ç¾¤</h2><p><strong> é¢˜å¤–è¯ </strong></p><p>æˆ‘ç°åœ¨åœ¨ä¸€å®¶ä¸Šå¸‚å…¬å¸æ——ä¸‹æ§è‚¡å­å…¬å¸è´Ÿè´£è¿ç»´éƒ¨é—¨ï¼Œè´Ÿè´£ITç½‘ç»œå®‰å…¨åŠå…¬ï¼šä¸»è¦åšçš„åº”ç”¨è¿ç»´å’Œç½‘ç»œè¿ç»´ï¼Œå…¼å¤§æ•°æ®è¿ç»´ã€‚<br>æœ€è¿‘è·Ÿæ–°æ¥çš„æ¶æ„å¸ˆèŠäº†ä¸‹Hadoopç›‘æ§æ–¹é¢ï¼šHORTONW0RKSæ•°æ®å¹³å°æ­å»ºAmbariç›‘æ§Hadoopé›†ç¾¤.</p><p><strong>HORTONW0RKSæ•°æ®å¹³å°ï¼ˆHDP Â®ï¼‰</strong><br>HDPæ˜¯ä¸šå†…å”¯ä¸€çœŸæ­£å®‰å…¨çš„ä¼ä¸šçº§å¼€æºçš„<code>Apacheçš„Hadoopâ„¢ Â®</code>åˆ†é…åŸºäºé›†ä¸­å¼æ¶æ„ã€‚HDPè§£å†³äº†é™æ€æ•°æ®çš„å®Œæ•´éœ€æ±‚ï¼Œä¸ºå®æ—¶å®¢æˆ·åº”ç”¨æä¾›æ”¯æŒï¼Œå¹¶æä¾›å¯åŠ é€Ÿå†³ç­–å’Œåˆ›æ–°çš„å¯é åˆ†æã€‚</p><p>ä½¿ç”¨Hortonworks Sandboxè¯•ç”¨æœ€æ–°çš„HDPåŠŸèƒ½ï¼Œæˆ–è€…ä¸ºç”Ÿäº§ç¯å¢ƒè®¾ç½®HDPï¼Œå®‰è£…å’Œé…ç½®ç¾¤é›†ã€‚<br>æŸ¥çœ‹å®˜ç½‘æ–‡æ¡£ï¼š<a href="https://hortonworks.com/downloads/#data-platform" target="_blank" rel="external">HORTONWORKS CONNECTED DATA PLATFORMS DOWNLOADS</a></p><h3 id="1-å°†AmbariæœåŠ¡å­˜å‚¨åº“æ–‡ä»¶ä¸‹è½½åˆ°å®‰è£…ä¸»æœºä¸Šçš„ç›®å½•ã€‚"><a href="#1-å°†AmbariæœåŠ¡å­˜å‚¨åº“æ–‡ä»¶ä¸‹è½½åˆ°å®‰è£…ä¸»æœºä¸Šçš„ç›®å½•ã€‚" class="headerlink" title="1. å°†AmbariæœåŠ¡å­˜å‚¨åº“æ–‡ä»¶ä¸‹è½½åˆ°å®‰è£…ä¸»æœºä¸Šçš„ç›®å½•ã€‚"></a>1. å°†AmbariæœåŠ¡å­˜å‚¨åº“æ–‡ä»¶ä¸‹è½½åˆ°å®‰è£…ä¸»æœºä¸Šçš„ç›®å½•ã€‚</h3><ul><li>Centos6.5 </li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wget -nv http://public-repo-1.hortonworks.com/ambari/centos6/2.x/updates/2.4.2.0/ambari.repo -O /etc/yum.repos.d/ambari.repo</div></pre></td></tr></table></figure><p>âš ï¸è­¦å‘Šï¼šä¸è¦ä¿®æ”¹<code>ambari.repo</code>æ–‡ä»¶åã€‚åœ¨ä»£ç†æ³¨å†ŒæœŸé—´ï¼Œæ­¤æ–‡ä»¶åº”åœ¨AmbariæœåŠ¡å™¨ä¸»æœºä¸Šå¯ç”¨ã€‚</p><ol><li>é€šè¿‡æ£€æŸ¥repoåˆ—è¡¨ç¡®è®¤å­˜å‚¨åº“å·²é…ç½®ã€‚</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum repolist</div></pre></td></tr></table></figure><p>æ‚¨åº”è¯¥åœ¨åˆ—è¡¨ä¸­çœ‹åˆ°ç±»ä¼¼äºä»¥ä¸‹Ambariå­˜å‚¨åº“çš„å€¼ã€‚</p><p>ç‰ˆæœ¬å€¼å› å®‰è£…è€Œå¼‚ã€‚</p><ol><li>å®‰è£…AmbariæœåŠ¡ã€‚è¿™ä¹Ÿå®‰è£…äº†é»˜è®¤çš„PostgreSQL Ambariæ•°æ®åº“ã€‚</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install ambari-server</div></pre></td></tr></table></figure><p>è¾“å…¥<code>y</code>æç¤ºï¼Œä»¥ç¡®è®¤äº¤æ˜“å’Œä¾èµ–æ€§æ£€æŸ¥æ—¶ã€‚</p><p>æˆåŠŸå®‰è£…å°†æ˜¾ç¤ºç±»ä¼¼äºä»¥ä¸‹å†…å®¹çš„è¾“å‡ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">å®‰è£…ï¼špostgresql-libs-8.4.20-3.el6_6.x86_64 1/4</div><div class="line">å®‰è£…ï¼špostgresql-8.4.20-3.el6_6.x86_64 2/4</div><div class="line">å®‰è£…ï¼špostgresql-server-8.4.20-3.el6_6.x86_64 3/4</div><div class="line">å®‰è£…ï¼šambari-server-2.4.2.0-1470.x86_64 4/4</div><div class="line">éªŒè¯ï¼šambari-server-2.4.2.0-1470.x86_64 1/4</div><div class="line">éªŒè¯ï¼špostgresql-8.4.20-3.el6_6.x86_64 2/4</div><div class="line">éªŒè¯ï¼špostgresql-server-8.4.20-3.el6_6.x86_64 3/4</div><div class="line">éªŒè¯ï¼špostgresql-libs-8.4.20-3.el6_6.x86_64 4/4</div><div class="line"></div><div class="line">å®‰è£…ï¼š</div><div class="line">  ambari-server.x86_64 0ï¼š2.4.2.0-1470  å®‰è£…è¿™é‡Œçš„æ—¶å€™ä¼šæœ‰ç‚¹æ…¢ï¼Œå› ä¸ºæ˜¯è®¿é—®å›½å¤–ç½‘ç«™ä¸‹è½½èµ„æºã€‚</div><div class="line"></div><div class="line">å·²å®‰è£…ä¾èµ–å…³ç³»ï¼š</div><div class="line"> postgresql.x86_64 0ï¼š8.4.20-3.el6_6           </div><div class="line"> postgresql-libs.x86_64 0ï¼š8.4.20-3.el6_6        </div><div class="line"> postgresql-server.x86_64 0ï¼š8.4.20-3.el6_6</div></pre></td></tr></table></figure><p>â—ï¸â—ï¸ã€æ³¨æ„ã€‘</p><p>æ¥å—æœ‰å…³ä¿¡ä»»<code>Hortonworks GPG</code>å¯†é’¥çš„è­¦å‘Šã€‚è¯¥é”®å°†è‡ªåŠ¨ä¸‹è½½å¹¶ç”¨äºéªŒè¯Hortonworksçš„è½¯â€‹â€‹ä»¶åŒ…ã€‚æ‚¨å°†çœ‹åˆ°ä»¥ä¸‹æ¶ˆæ¯ï¼š</p><p>Importing GPG key 0x07513CAD: Userid: â€œJenkins (HDP Builds) <a href="&#109;&#97;&#x69;&#108;&#x74;&#111;&#58;&#x6a;&#x65;&#110;&#x6b;&#x69;&#x6e;&#x40;&#x68;&#x6f;&#x72;&#116;&#x6f;&#110;&#x77;&#x6f;&#x72;&#107;&#x73;&#x2e;&#99;&#x6f;&#x6d;">&#x6a;&#x65;&#110;&#x6b;&#x69;&#x6e;&#x40;&#x68;&#x6f;&#x72;&#116;&#x6f;&#110;&#x77;&#x6f;&#x72;&#107;&#x73;&#x2e;&#99;&#x6f;&#x6d;</a>â€œ From :<code>http://s3.amazonaws.com/dev.hortonworks.com/ambari/centos6/RPM-GPG-KEY/RPM-GPG-KEY-Jenkins</code></p><p>â—ï¸â—ï¸ã€æ³¨æ„ã€‘</p><p>åœ¨å…·æœ‰æœ‰é™Internetè®¿é—®æˆ–æ²¡æœ‰Internetè®¿é—®çš„ç¾¤é›†ä¸Šéƒ¨ç½²HDPæ—¶ï¼Œåº”ä½¿ç”¨å…¶ä»–æ–¹æ³•æä¾›å¯¹ä½çš„è®¿é—®ã€‚<br>æœ‰å…³è®¾ç½®æœ¬åœ°å­˜å‚¨åº“çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…ä½¿ç”¨æœ¬åœ°å­˜å‚¨åº“ã€‚</p><p><code>Ambari</code>æœåŠ¡å™¨é»˜è®¤ä½¿ç”¨åµŒå…¥å¼<code>PostgreSQL</code>æ•°æ®åº“ã€‚å½“æ‚¨å®‰è£…<code>Ambari</code>æœåŠ¡å™¨æ—¶ï¼ŒPostgreSQLè½¯ä»¶åŒ…å’Œä¾èµ–å…³ç³»å¿…é¡»å¯ç”¨äºå®‰è£…ã€‚è¿™äº›åŒ…é€šå¸¸ä½œä¸ºæ“ä½œç³»ç»Ÿå­˜å‚¨åº“çš„ä¸€éƒ¨åˆ†æä¾›ã€‚è¯·ç¡®è®¤æ‚¨å…·æœ‰é€‚ç”¨äº<code>postgresql-server</code>è½¯ä»¶åŒ…çš„ç›¸åº”å­˜å‚¨åº“ã€‚</p><h3 id="2-è®¾ç½®AmbariæœåŠ¡å™¨"><a href="#2-è®¾ç½®AmbariæœåŠ¡å™¨" class="headerlink" title="2.è®¾ç½®AmbariæœåŠ¡å™¨"></a>2.è®¾ç½®AmbariæœåŠ¡å™¨</h3><p>åœ¨å¯åŠ¨<code>Ambari</code>æœåŠ¡å™¨ä¹‹å‰ï¼Œå¿…é¡»è®¾ç½®AmbariæœåŠ¡å™¨ã€‚å®‰è£…ç¨‹åºå°†Ambarié…ç½®ä¸ºä¸Ambariæ•°æ®åº“é€šä¿¡ï¼Œå®‰è£…JDKå¹¶å…è®¸æ‚¨è‡ªå®šä¹‰Ambari Serverå®ˆæŠ¤ç¨‹åºå°†ä½œä¸ºè¿è¡Œçš„ç”¨æˆ·å¸æˆ·ã€‚è¯¥ <code>ambari-server setup</code>å‘½ä»¤ç®¡ç†è®¾ç½®è¿‡ç¨‹ã€‚åœ¨AmbariæœåŠ¡å™¨ä¸»æœºä¸Šè¿è¡Œä»¥ä¸‹å‘½ä»¤ä»¥å¼€å§‹è®¾ç½®è¿‡ç¨‹ã€‚æ‚¨è¿˜å¯ä»¥å°†â€œ è®¾ç½®é€‰é¡¹â€é™„åŠ åˆ°å‘½ä»¤ã€‚</p><ul><li>å¯åŠ¨æœåŠ¡</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line">ambari-server setup</div><div class="line"></div><div class="line"><span class="comment">###è¿™é‡Œç”±äºä¸‹è½½jdk1.8å¤ªæ…¢é€Ÿåº¦è¿‡æ…¢ã€‚æˆ‘æå‰æŠŠjdkä¸‹è½½ä¸‹æ¥æ”¾åˆ°äº†/srv/jdk1.8.0_66 ç›®å½•</span></div><div class="line"></div><div class="line">[root@ambari-server_01 ~]<span class="comment"># ambari-server setup</span></div><div class="line">Using python  /usr/bin/python</div><div class="line">Setup ambari-server</div><div class="line">Checking SELinux...</div><div class="line">SELinux status is <span class="string">'enabled'</span></div><div class="line">SELinux mode is <span class="string">'permissive'</span></div><div class="line">WARNING: SELinux is <span class="built_in">set</span> to <span class="string">'permissive'</span> mode and temporarily disabled.</div><div class="line">OK to <span class="built_in">continue</span> [y/n] (y)? y</div><div class="line">Customize user account <span class="keyword">for</span> ambari-server daemon [y/n] (n)? y</div><div class="line">Enter user account <span class="keyword">for</span> ambari-server daemon (root):</div><div class="line">Adjusting ambari-server permissions and ownership...</div><div class="line">Checking firewall status...</div><div class="line">Checking JDK...</div><div class="line">[1] Oracle JDK 1.8 + Java Cryptography Extension (JCE) Policy Files 8</div><div class="line">[2] Oracle JDK 1.7 + Java Cryptography Extension (JCE) Policy Files 7</div><div class="line">[3] Custom JDK</div><div class="line">==============================================================================</div><div class="line">Enter choice (1): 3</div><div class="line">WARNING: JDK must be installed on all hosts and JAVA_HOME must be valid on all hosts.</div><div class="line">WARNING: JCE Policy files are required <span class="keyword">for</span> configuring Kerberos security. If you plan to use Kerberos,please make sure JCE Unlimited Strength Jurisdiction Policy Files are valid on all hosts.</div><div class="line">Path to JAVA_HOME: /srv/jdk1.8.0_66</div><div class="line">Validating JDK on Ambari Server...done.</div><div class="line">Completing setup...</div><div class="line">Configuring database...</div><div class="line">Enter advanced database configuration [y/n] (n)? y</div><div class="line">Configuring database...</div><div class="line">==============================================================================</div><div class="line">Choose one of the following options:</div><div class="line">[1] - PostgreSQL (Embedded)</div><div class="line">[2] - Oracle</div><div class="line">[3] - MySQL / MariaDB</div><div class="line">[4] - PostgreSQL</div><div class="line">[5] - Microsoft SQL Server (Tech Preview)</div><div class="line">[6] - SQL Anywhere</div><div class="line">[7] - BDB</div><div class="line">==============================================================================</div><div class="line">Enter choice (1):3</div><div class="line">Database name (ambari):</div><div class="line">Postgres schema (ambari):</div><div class="line">Username (ambari):</div><div class="line">Enter Database Password (bigdata):</div><div class="line">Default properties detected. Using built-in database.</div><div class="line">Configuring ambari database...</div><div class="line">Checking PostgreSQL...</div><div class="line">Running initdb: This may take up to a minute.</div><div class="line">æ­£åœ¨åˆå§‹åŒ–æ•°æ®åº“ï¼š[ç¡®å®š]</div><div class="line"></div><div class="line">About to start PostgreSQL</div><div class="line">Configuring <span class="built_in">local</span> database...</div><div class="line">Connecting to <span class="built_in">local</span> database...done.</div><div class="line">Configuring PostgreSQL...</div><div class="line">Restarting PostgreSQL</div><div class="line">Extracting system views...</div><div class="line">ambari-admin-2.4.2.0.136.jar</div><div class="line">............</div><div class="line">Adjusting ambari-server permissions and ownership...</div><div class="line">Ambari Server <span class="string">'setup'</span> completed successfully.</div><div class="line">You have mail <span class="keyword">in</span> /var/spool/mail/root</div></pre></td></tr></table></figure><h5 id="2-1-å“åº”å®‰è£…æç¤ºï¼š"><a href="#2-1-å“åº”å®‰è£…æç¤ºï¼š" class="headerlink" title="2.1 å“åº”å®‰è£…æç¤ºï¼š"></a>2.1 å“åº”å®‰è£…æç¤ºï¼š</h5><p>å¦‚æœæ‚¨æ²¡æœ‰æš‚æ—¶ç¦ç”¨<code>SELinux</code>ï¼Œæ‚¨å¯èƒ½ä¼šæ”¶åˆ°è­¦å‘Šã€‚æ¥å—é»˜è®¤å€¼<code>ï¼ˆyï¼‰</code>ï¼Œç„¶åç»§ç»­ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒAmbariæœåŠ¡å™¨è¿è¡Œåœ¨<code>root</code>ã€‚åœ¨<code>Customize user account for ambari-server daemon</code>æç¤ºç¬¦å¤„æ¥å—é»˜è®¤<code>ï¼ˆnï¼‰</code>ï¼Œä»¥ç»§ç»­rootã€‚</p><p>å¦‚æœè¦åˆ›å»ºå…¶ä»–ç”¨æˆ·ä»¥è¿è¡Œ<code>Ambari</code>æœåŠ¡å™¨æˆ–åˆ†é…ä»¥å‰åˆ›å»ºçš„ç”¨æˆ·ï¼Œè¯·<code>y</code>åœ¨ <code>Customize user account for ambari-server daemon</code>æç¤ºç¬¦å¤„é€‰æ‹©ï¼Œç„¶åæä¾›ç”¨æˆ·åã€‚<br>æœ‰å…³ä»¥érootç”¨æˆ·èº«ä»½è¿è¡ŒAmbariæœåŠ¡å™¨çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…Hortonworksæ•°æ®å¹³å°Apache Ambariå‚è€ƒ&gt; <a href="http://docs.hortonworks.com/HDPDocuments/Ambari-2.4.2.0/bk_ambari-security/content/configuring_ambari_for_non-root.html" target="_blank" rel="external">ä¸ºéæ ¹ç”¨æˆ·é…ç½®Ambari</a></p><p>å¦‚æœæ‚¨æ²¡æœ‰æš‚æ—¶åœç”¨<code>iptables</code>ï¼Œå¯èƒ½ä¼šæ”¶åˆ°è­¦å‘Šã€‚è¾“å…¥<code>y</code>ä»¥ç»§ç»­ã€‚</p><p>JDK<br>é€‰æ‹©è¦ä¸‹è½½çš„<code>JDK</code>ç‰ˆæœ¬ã€‚è¾“å…¥<code>1</code>ä»¥ä¸‹è½½<code>Oracle JDK 1.8</code>ã€‚æˆ–è€…ï¼Œæ‚¨å¯ä»¥é€‰æ‹©è¾“å…¥<code>è‡ªå®šä¹‰JDK</code>ã€‚å¦‚æœé€‰æ‹©â€œ<code>è‡ªå®šä¹‰JDK</code>â€ï¼Œåˆ™å¿…é¡»åœ¨æ‰€æœ‰ä¸»æœºä¸Šæ‰‹åŠ¨å®‰è£…JDKå¹¶æŒ‡å®š<code>Java Home</code>è·¯å¾„ã€‚</p><p>â—ï¸â—ï¸ã€æ³¨æ„ã€‘</p><p>JDKæ”¯æŒå®Œå…¨å–å†³äºæ‚¨é€‰æ‹©çš„<code>HDP Stack</code>ç‰ˆæœ¬ã€‚è¯·å‚é˜…<a href="http://docs.hortonworks.com/HDPDocuments/Ambari-2.4.2.0/bk_ambari-reference/content/ch_changing_the_jdk_version_on_an_existing_cluster.html" target="_blank" rel="external">Hortonworksæ•°æ®å¹³å°Apache Ambari</a>å‚è€ƒä»¥æŸ¥çœ‹è¦å®‰è£…çš„HDP Stackç‰ˆæœ¬æ”¯æŒçš„JDKç‰ˆæœ¬ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒAmbariæœåŠ¡å™¨è®¾ç½®ä¸‹è½½å¹¶å®‰è£…Oracle JDK 1.8å’Œéšé™„çš„Javaå¯†ç æœ¯æ‰©å±•ï¼ˆJCEï¼‰ç­–ç•¥æ–‡ä»¶ã€‚å¦‚æœè®¡åˆ’ä½¿ç”¨å…¶ä»–ç‰ˆæœ¬çš„JDKï¼Œè¯·å‚é˜… è®¾ç½®é€‰é¡¹ä»¥è·å–æ›´å¤šä¿¡æ¯ã€‚</p><p>å‡ºç°æç¤ºæ—¶æ¥å—<code>Oracle JDK</code>è®¸å¯è¯ã€‚æ‚¨å¿…é¡»æ¥å—æ­¤è®¸å¯è¯æ‰èƒ½ä»Oracleä¸‹è½½å¿…éœ€çš„JDKã€‚JDKåœ¨éƒ¨ç½²é˜¶æ®µå®‰è£…ã€‚</p><blockquote><p>æ•°æ®åº“é€‰æ‹©ï¼š</p></blockquote><p>é€‰æ‹©<code>n</code>ä¸ºï¼Œ<code>Enter advanced database configuration</code>ä»¥ä¾¿ä¸º<code>Ambari</code>ä½¿ç”¨é»˜è®¤çš„åµŒå…¥å¼<code>PostgreSQL</code>æ•°æ®åº“ã€‚é»˜è®¤çš„PostgreSQLæ•°æ®åº“åæ˜¯ambariã€‚é»˜è®¤ç”¨æˆ·åå’Œå¯†ç ä¸ºambari/bigdataã€‚å¦åˆ™ï¼Œè¦ä½¿ç”¨ç°æœ‰çš„PostgreSQLï¼ŒMySQL / MariaDBæˆ–Oracleæ•°æ®åº“ä¸Ambariï¼Œè¯·é€‰æ‹©yã€‚</p><p>å¦‚æœä½¿ç”¨ç°æœ‰çš„PostgreSQLï¼ŒMySQL / MariaDBæˆ–Oracleæ•°æ®åº“å®ä¾‹ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹æç¤ºä¹‹ä¸€ï¼š</p><p>â—ï¸â—ï¸[é‡è¦]<br>åœ¨è¿è¡Œå®‰è£…ç¨‹åºå’Œè¾“å…¥é«˜çº§æ•°æ®åº“é…ç½®ä¹‹å‰ï¼Œå¿…é¡»ä½¿ç”¨<code>â€œä½¿ç”¨éé»˜è®¤æ•°æ®åº“</code>- Ambariâ€ä¸­è¯¦è¿°çš„æ­¥éª¤å‡†å¤‡éé»˜è®¤æ•°æ®åº“å®ä¾‹ã€‚</p><p>â—ï¸â—ï¸[é‡è¦]</p><p>ä¸æ”¯æŒä½¿ç”¨Microsoft SQL Serveræˆ–SQL Anywhereæ•°æ®åº“é€‰é¡¹ã€‚</p><p>è¦ä½¿ç”¨ç°æœ‰çš„Oracleå®ä¾‹ï¼Œå¹¶ä¸ºè¯¥æ•°æ®åº“é€‰æ‹©è‡ªå·±çš„æ•°æ®åº“åç§°ï¼Œç”¨æˆ·åå’Œå¯†ç ï¼Œè¯·è¾“å…¥<code>2</code>ã€‚<br>é€‰æ‹©è¦ä½¿ç”¨çš„æ•°æ®åº“ï¼Œå¹¶æä¾›åœ¨æç¤ºä¸­è¯·æ±‚çš„ä»»ä½•ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä¸»æœºåï¼Œç«¯å£ï¼ŒæœåŠ¡åæˆ–SIDï¼Œç”¨æˆ·åå’Œå¯†ç ã€‚<br>è¦ä½¿ç”¨ç°æœ‰çš„MySQL / MariaDBæ•°æ®åº“ï¼Œå¹¶ä¸ºè¯¥æ•°æ®åº“é€‰æ‹©è‡ªå·±çš„æ•°æ®åº“åç§°ï¼Œç”¨æˆ·åå’Œå¯†ç ï¼Œè¯·è¾“å…¥3ã€‚<br>é€‰æ‹©è¦ä½¿ç”¨çš„æ•°æ®åº“ï¼Œå¹¶æä¾›åœ¨æç¤ºä¸­è¯·æ±‚çš„ä»»ä½•ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä¸»æœºåï¼Œç«¯å£ï¼Œæ•°æ®åº“åç§°ï¼Œç”¨æˆ·åå’Œå¯†ç ã€‚<br>è¦ä½¿ç”¨ç°æœ‰çš„PostgreSQLæ•°æ®åº“ï¼Œå¹¶ä¸ºè¯¥æ•°æ®åº“é€‰æ‹©è‡ªå·±çš„æ•°æ®åº“åç§°ï¼Œç”¨æˆ·åå’Œå¯†ç ï¼Œè¯·è¾“å…¥4ã€‚<br>é€‰æ‹©è¦ä½¿ç”¨çš„æ•°æ®åº“ï¼Œå¹¶æä¾›åœ¨æç¤ºä¸­è¯·æ±‚çš„ä»»ä½•ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä¸»æœºåï¼Œç«¯å£ï¼Œæ•°æ®åº“åç§°ï¼Œç”¨æˆ·åå’Œå¯†ç ã€‚<br>ç»§ç»­é…ç½®è¿œç¨‹æ•°æ®åº“è¿æ¥å±æ€§[y / n]é€‰æ‹©<code>y</code>ã€‚</p><blockquote><p>è¿™é‡Œæ•°æ®åº“ç”¨æˆ·åå’Œå¯†ç éƒ½æ˜¯é»˜è®¤å®‰è£…ï¼š</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Database name (ambari)</div><div class="line">Postgres schema (ambari)</div><div class="line">Username (ambari)</div><div class="line">Enter Database Password (bigdata)</div></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œæˆ‘åšäº†ä¸€å±‚Nginxä»£ç†ï¼šå°†AmbariæœåŠ¡å™¨é…ç½®ä¸ºä½¿ç”¨æ­¤ä»£ç†æœåŠ¡å™¨</p></blockquote><h3 id="3-å¯åŠ¨AmbariæœåŠ¡å™¨"><a href="#3-å¯åŠ¨AmbariæœåŠ¡å™¨" class="headerlink" title="3.å¯åŠ¨AmbariæœåŠ¡å™¨"></a>3.å¯åŠ¨AmbariæœåŠ¡å™¨</h3><p>åœ¨AmbariæœåŠ¡å™¨ä¸»æœºä¸Šè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><pre><code>ambari-server start</code></pre><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[root@ambari-server ~]<span class="comment"># ambari-server start</span></div><div class="line">Using python  /usr/bin/python</div><div class="line">Starting ambari-server</div><div class="line">Ambari Server running with administrator privileges.</div><div class="line">Organizing resource files at /var/lib/ambari-server/resources...</div><div class="line">Ambari database consistency check started...</div><div class="line">No errors were found.</div><div class="line">Ambari database consistency check finished</div><div class="line">Server PID at: /var/run/ambari-server/ambari-server.pid</div><div class="line">Server out at: /var/<span class="built_in">log</span>/ambari-server/ambari-server.out</div><div class="line">Server <span class="built_in">log</span> at: /var/<span class="built_in">log</span>/ambari-server/ambari-server.log</div><div class="line">Waiting <span class="keyword">for</span> server start....................</div><div class="line">Ambari Server <span class="string">'start'</span> completed successfully.</div><div class="line">You have mail <span class="keyword">in</span> /var/spool/mail/root</div></pre></td></tr></table></figure><p>è¦æ£€æŸ¥AmbariæœåŠ¡å™¨è¿›ç¨‹ï¼š</p><pre><code>ambari-server status</code></pre><p>åœæ­¢AmbariæœåŠ¡å™¨ï¼š</p><pre><code>ambari-server stop</code></pre><p>åœ¨AmbariæœåŠ¡å™¨å¯åŠ¨æ—¶ï¼Œ<code>Ambari</code>è¿è¡Œæ•°æ®åº“ä¸€è‡´æ€§æ£€æŸ¥ï¼ŒæŸ¥æ‰¾é—®é¢˜ã€‚å¦‚æœå‘ç°ä»»ä½•é—®é¢˜ï¼ŒAmbariæœåŠ¡å™¨å¯åŠ¨å°†ä¸­æ­¢ï¼Œå¹¶ä¸”ä¸€æ¡æ¶ˆæ¯å°†æ‰“å°åˆ°æ§åˆ¶å°â€œæ•°æ®åº“é…ç½®ä¸€è‡´æ€§æ£€æŸ¥å¤±è´¥â€ã€‚æ›´å¤šè¯¦ç»†ä¿¡æ¯å°†å†™å…¥ä»¥ä¸‹æ—¥å¿—æ–‡â€‹â€‹ä»¶ï¼š</p><pre><code>/var/log/ambari-server/ambari-server-check-database.log</code></pre><p>æ‚¨å¯ä»¥é€šè¿‡ä½¿ç”¨ä»¥ä¸‹é€‰é¡¹è·³è¿‡æ­¤æ£€æŸ¥æ¥å¼ºåˆ¶AmbariæœåŠ¡å™¨å¯åŠ¨ï¼š</p><pre><code>ambari-server start --skip-database-check</code></pre><p>å¦‚æœå­˜åœ¨æ•°æ®åº“é—®é¢˜ï¼Œè¯·é€‰æ‹©è·³è¿‡æ­¤æ£€æŸ¥ï¼Œåœ¨æ›´æ­£æ•°æ®åº“ä¸€è‡´æ€§é—®é¢˜ä¹‹å‰ï¼Œä¸è¦å¯¹é›†ç¾¤æ‹“æ‰‘è¿›è¡Œä»»ä½•æ›´æ”¹æˆ–æ‰§è¡Œé›†ç¾¤å‡çº§ã€‚æœ€å¥½æŸ¥çœ‹å®˜ç½‘æ“ä½œã€‚</p><h2 id="ç¬¬3ç« å®‰è£…ï¼Œé…ç½®å’Œéƒ¨ç½²HDPé›†ç¾¤"><a href="#ç¬¬3ç« å®‰è£…ï¼Œé…ç½®å’Œéƒ¨ç½²HDPé›†ç¾¤" class="headerlink" title="ç¬¬3ç« å®‰è£…ï¼Œé…ç½®å’Œéƒ¨ç½²HDPé›†ç¾¤"></a>ç¬¬3ç« å®‰è£…ï¼Œé…ç½®å’Œéƒ¨ç½²HDPé›†ç¾¤</h2><h3 id="1-ç™»å½•åˆ°Apache-Ambari"><a href="#1-ç™»å½•åˆ°Apache-Ambari" class="headerlink" title="1.ç™»å½•åˆ°Apache Ambari"></a>1.ç™»å½•åˆ°Apache Ambari</h3><ul><li><p>å°†æµè§ˆå™¨æŒ‡å‘ <code>http://&lt;your.ambari.server&gt; :8080</code>ï¼Œå…¶ä¸­<code>&lt;your.ambari.server&gt;</code>æ˜¯æ‚¨çš„ambariæœåŠ¡å™¨ä¸»æœºçš„åç§°ã€‚ä¾‹å¦‚ï¼Œé»˜è®¤AmbariæœåŠ¡å™¨ä¸»æœºä½äº<code>http://c6401.ambari.apache.org:8080</code>ã€‚</p></li><li><p>ä½¿ç”¨é»˜è®¤ç”¨æˆ·å/å¯†ç ç™»å½•AmbariæœåŠ¡å™¨ï¼š<code>admin / admin</code>ã€‚æ‚¨å¯ä»¥ç¨åæ›´æ”¹è¿™äº›å‡­æ®ã€‚</p></li></ul><h3 id="2-å¯åŠ¨Ambariå®‰è£…å‘å¯¼"><a href="#2-å¯åŠ¨Ambariå®‰è£…å‘å¯¼" class="headerlink" title="2.å¯åŠ¨Ambariå®‰è£…å‘å¯¼"></a>2.å¯åŠ¨Ambariå®‰è£…å‘å¯¼</h3><p>ä»<code>Ambari Welcome</code>é¡µé¢ï¼Œé€‰æ‹©å¯åŠ¨å®‰è£…å‘å¯¼ã€‚</p><p>æä¾›é›†ç¾¤ï¼Œç®¡ç†è°å¯ä»¥è®¿é—®ç¾¤é›†ï¼Œä»¥åŠè‡ªå®šä¹‰è§†å›¾ä¸ºAmbariç”¨æˆ·ã€‚</p><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/Ambariwelcome.png" alt=""></figure></p><p><figure class="figure"><img src="http://docs.hortonworks.com/HDPDocuments/Ambari-2.4.2.0/bk_ambari-installation/content/figures/2/figures/170AmbariWelcome.png" alt=""></figure></p><h3 id="3-å‘½åæ‚¨çš„ç¾¤é›†"><a href="#3-å‘½åæ‚¨çš„ç¾¤é›†" class="headerlink" title="3.å‘½åæ‚¨çš„ç¾¤é›†"></a>3.å‘½åæ‚¨çš„ç¾¤é›†</h3><p>åœ¨Name your clusterï¼Œé”®å…¥è¦åˆ›å»ºçš„é›†ç¾¤çš„åç§°ã€‚åç§°ä¸­ä¸è¦ä½¿ç”¨ç©ºæ ¼æˆ–ç‰¹æ®Šå­—ç¬¦ã€‚</p><p>é€‰æ‹©Nextã€‚</p><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/ambari_02.png" alt=""></figure></p><h3 id="4-é€‰æ‹©ç‰ˆæœ¬"><a href="#4-é€‰æ‹©ç‰ˆæœ¬" class="headerlink" title="4.é€‰æ‹©ç‰ˆæœ¬"></a>4.é€‰æ‹©ç‰ˆæœ¬</h3><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/ambari_03.png" alt=""></figure></p><p>è¿™é‡Œæˆ‘é€‰æ‹©<code>redhat6</code> å…¶ä»–çš„éƒ½<code>remove</code>æ‰ã€‚</p><p>åœ¨æ­¤æ­¥éª¤ä¸­ï¼Œæ‚¨å°†é€‰æ‹©ç¾¤é›†çš„è½¯ä»¶ç‰ˆæœ¬å’Œäº¤ä»˜æ–¹å¼ã€‚ä½¿ç”¨å…¬å…±å­˜å‚¨åº“éœ€è¦Internetè¿æ¥ã€‚ä½¿ç”¨æœ¬åœ°å­˜å‚¨åº“éœ€è¦æ‚¨åœ¨ç½‘ç»œä¸­å¯ç”¨çš„å­˜å‚¨åº“ä¸­é…ç½®è½¯ä»¶ã€‚</p><ul><li>é€‰æ‹©å †æ ˆ</li></ul><p>å¯ç”¨çš„HDPç‰ˆæœ¬æ˜¾ç¤ºåœ¨TABä¸­ã€‚å½“æ‚¨é€‰æ‹©TABæ—¶ï¼ŒAmbariä¼šå°è¯•å‘ç°è¯¥HDPå †æ ˆçš„ç‰¹å®šç‰ˆæœ¬å¯ç”¨ã€‚è¯¥åˆ—è¡¨æ˜¾ç¤ºåœ¨DROPDOWNä¸­ã€‚å¯¹äºè¯¥ç‰¹å®šç‰ˆæœ¬ï¼Œå°†æ˜¾ç¤ºå¯ç”¨çš„æœåŠ¡ï¼Œå…¶ä¸­çš„ç‰ˆæœ¬æ˜¾ç¤ºåœ¨TABLEä¸­ã€‚</p><ul><li>é€‰æ‹©ç‰ˆæœ¬</li></ul><p>å¦‚æœAmbariå¯ä»¥è®¿é—®Internetï¼Œåˆ™ç‰¹å®šç‰ˆæœ¬å°†ä½œä¸ºé€‰é¡¹åˆ—åœ¨DROPDOWNä¸­ã€‚å¦‚æœæ‚¨æœ‰æœªåˆ—å‡ºçš„ç‰ˆæœ¬çš„ç‰ˆæœ¬å®šä¹‰æ–‡ä»¶ï¼Œæ‚¨å¯ä»¥å•å‡»æ·»åŠ ç‰ˆæœ¬â€¦å¹¶ä¸Šè½½VDFæ–‡ä»¶ã€‚æ­¤å¤–ï¼Œå¦‚æœæ‚¨æ— æ³•è®¿é—®Internetæˆ–ä¸ç¡®å®šè¦å®‰è£…å“ªä¸ªç‰¹å®šç‰ˆæœ¬ï¼Œåˆ™ é»˜è®¤ç‰ˆæœ¬å®šä¹‰ä¹ŸåŒ…å«åœ¨åˆ—è¡¨ä¸­ã€‚</p><ul><li>é€‰æ‹©å­˜å‚¨åº“</li></ul><p>Ambariå…è®¸æ‚¨é€‰æ‹©ä»å…¬å…±å­˜å‚¨åº“ï¼ˆå¦‚æœæ‚¨æœ‰Internetè®¿é—®æƒé™ï¼‰æˆ–æœ¬åœ°å­˜å‚¨åº“å®‰è£…è½¯ä»¶ã€‚æ— è®ºæ‚¨çš„é€‰æ‹©å¦‚ä½•ï¼Œæ‚¨éƒ½å¯ä»¥ç¼–è¾‘å­˜å‚¨åº“çš„åŸºæœ¬URLã€‚å°†æ˜¾ç¤ºå¯ç”¨çš„æ“ä½œç³»ç»Ÿï¼Œæ‚¨å¯ä»¥ä»åˆ—è¡¨ä¸­æ·»åŠ /åˆ é™¤æ“ä½œç³»ç»Ÿä»¥é€‚åˆæ‚¨çš„ç¯å¢ƒ</p><p>â—ï¸â—ï¸æ³¨æ„<br>UIæ˜¾ç¤ºåŸºäºæ“ä½œç³»ç»Ÿç³»åˆ—ï¼ˆOSç³»åˆ—ï¼‰çš„å­˜å‚¨åº“åŸºæœ¬URLã€‚è¯·ç¡®ä¿åŸºäºæ­£åœ¨è¿è¡Œçš„æ“ä½œç³»ç»Ÿè®¾ç½®æ­£ç¡®çš„æ“ä½œç³»ç»Ÿç³»åˆ—ã€‚ä¸‹è¡¨å°†OSç³»åˆ—æ˜ å°„åˆ°æ“ä½œç³»ç»Ÿã€‚</p><ul><li><p><strong>é«˜çº§é€‰é¡¹</strong></p></li><li><p><strong>æœ‰é«˜çº§å­˜å‚¨åº“é€‰é¡¹å¯ç”¨ã€‚</strong></p></li></ul><p>è·³è¿‡å­˜å‚¨åº“åŸºæœ¬URLéªŒè¯ï¼ˆé«˜çº§ï¼‰ï¼š å½“æ‚¨å•å‡»ä¸‹ä¸€æ­¥æ—¶ï¼ŒAmbariå°†å°è¯•è¿æ¥åˆ°å­˜å‚¨åº“åŸºæœ¬URLï¼Œå¹¶éªŒè¯æ‚¨å·²è¾“å…¥éªŒè¯å­˜å‚¨åº“ã€‚å¦‚æœæ²¡æœ‰ï¼Œå°†æ˜¾ç¤ºä¸€ä¸ªé”™è¯¯ï¼Œæ‚¨å¿…é¡»åœ¨ç»§ç»­ä¹‹å‰çº æ­£ã€‚</p><p>ä½¿ç”¨<code>RedHat Satellite/Spacewalkï¼š</code>ä»…å½“è®¡åˆ’ä½¿ç”¨æœ¬åœ°å­˜å‚¨åº“æ—¶ï¼Œæ‰ä¼šå¯ç”¨æ­¤é€‰é¡¹ã€‚å½“æ‚¨ä¸ºè½¯ä»¶å­˜å‚¨åº“é€‰æ‹©æ­¤é€‰é¡¹æ—¶ï¼Œæ‚¨è´Ÿè´£é…ç½®<code>Satellite/Spacewalk</code>ä¸­çš„å­˜å‚¨åº“é€šé“ï¼Œå¹¶ç¡®è®¤æ‰€é€‰ç¾¤é›†ç‰ˆæœ¬çš„å­˜å‚¨åº“åœ¨ç¾¤é›†ä¸­çš„ä¸»æœºä¸Šå¯ç”¨ã€‚</p><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/ambari_04.png" alt=""></figure></p><h3 id="5-å®‰è£…é€‰é¡¹"><a href="#5-å®‰è£…é€‰é¡¹" class="headerlink" title="5.å®‰è£…é€‰é¡¹"></a>5.å®‰è£…é€‰é¡¹</h3><p>ä¸ºäº†æ„å»ºé›†ç¾¤ï¼Œå®‰è£…å‘å¯¼å°†æç¤ºæ‚¨æœ‰å…³å¦‚ä½•è®¾ç½®å®ƒçš„ä¸€èˆ¬ä¿¡æ¯ã€‚æ‚¨éœ€è¦æä¾›æ¯ä¸ªä¸»æœºçš„FQDNã€‚è¯¥å‘å¯¼è¿˜éœ€è¦è®¿é—®åœ¨è®¾ç½®æ— å¯†ç SSHä¸­åˆ›å»ºçš„ç§é’¥æ–‡ä»¶  ã€‚ä½¿ç”¨ä¸»æœºåå’Œå¯†é’¥æ–‡ä»¶ä¿¡æ¯ï¼Œå‘å¯¼å¯ä»¥å®šä½ï¼Œè®¿é—®å’Œä¸ç¾¤é›†ä¸­çš„æ‰€æœ‰ä¸»æœºå®‰å…¨äº¤äº’ã€‚</p><p>ä½¿ç”¨Target Hostsæ–‡æœ¬æ¡†è¾“å…¥ä¸»æœºååˆ—è¡¨ï¼Œæ¯è¡Œä¸€ä¸ªã€‚æ‚¨å¯ä»¥ä½¿ç”¨æ‹¬å·å†…çš„èŒƒå›´æ¥è¡¨ç¤ºè¾ƒå¤§çš„ä¸»æœºé›†ã€‚ä¾‹å¦‚ï¼Œå¯¹äºhost01.domainé€šè¿‡host10.domainä½¿ç”¨ host[01-10].domain</p><p>âš ï¸ <strong>å®‰è£…æœåŠ¡å™¨é›†ç¾¤æœºå™¨ä¸€å®šè¦ç³»ç»Ÿç‰ˆæœ¬è¦ä¸€è‡´ä¸ç„¶å®‰è£…ä¼šæç¤ºç‰ˆæœ¬ä¸å…¼å®¹ã€‚</strong></p><p>â—ï¸â—ï¸    æ³¨æ„<br>å¦‚æœè¦åœ¨EC2ä¸Šéƒ¨ç½²ï¼Œè¯·ä½¿ç”¨å†…éƒ¨ä¸“ç”¨<code>DNSä¸»æœºå</code>ã€‚</p><p>åœ¨ambariæœåŠ¡å™¨é…ç½®hosts</p><pre><code>vim /etc/hosts</code></pre><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">192<span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.151</span>    <span class="selector-tag">datanode151</span></div><div class="line">192<span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.173</span>    <span class="selector-tag">datanode_173</span> <span class="selector-tag">datanode-173</span><span class="selector-class">.hadoop</span></div></pre></td></tr></table></figure><p>å¦‚æœè¦è®©<code>Ambari</code>ä½¿ç”¨SSHåœ¨æ‰€æœ‰ä¸»æœºä¸Šè‡ªåŠ¨å®‰è£…Ambariä»£ç†ï¼Œè¯·é€‰æ‹©<code>Provide your SSH Private Key</code>å¹¶ä½¿ç”¨éƒ¨åˆ†ä¸­çš„ <code>Choose File</code>æŒ‰é’®<code>Host Registration Information</code>æŸ¥æ‰¾ä¸å…ˆå‰åœ¨æ‰€æœ‰ä¸»æœºä¸Šå®‰è£…çš„å…¬é’¥ç›¸åŒ¹é…çš„ç§é’¥æ–‡ä»¶ï¼Œæˆ–è€…å‰ªåˆ‡å¹¶ç²˜è´´é”®æ‰‹åŠ¨æ’å…¥æ–‡æœ¬æ¡†ã€‚</p><p>å¡«å†™æ‚¨é€‰æ‹©çš„SSHå¯†é’¥çš„ç”¨æˆ·åã€‚å¦‚æœä¸æƒ³ä½¿ç”¨rootç”¨æˆ·ï¼Œåˆ™å¿…é¡»ä¸ºå¯ä»¥åœ¨ä¸è¾“å…¥å¯†ç çš„æƒ…å†µä¸‹æ‰§è¡Œsudoçš„å¸æˆ·æä¾›ç”¨æˆ·åã€‚å¦‚æœæ‚¨çš„ç¯å¢ƒä¸­çš„ä¸»æœºä¸Šçš„SSHé…ç½®ä¸º22ä»¥å¤–çš„ç«¯å£ï¼Œæ‚¨ä¹Ÿå¯ä»¥æ›´æ”¹å®ƒã€‚</p><p>å¦‚æœæ‚¨ä¸å¸Œæœ›Ambariè‡ªåŠ¨å®‰è£…Ambariä»£ç†ï¼Œè¯·é€‰æ‹©<code>Perform manual registration</code>ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…æ‰‹åŠ¨å®‰è£…Ambariä»£ç†ã€‚</p><p>é€‰æ‹©<code>Register and Confirm</code>ç»§ç»­ã€‚</p><p>è¿™é‡Œæç¤ºï¼šThe following hostnames are not valid FQDNs: datanode_173.hadoop</p><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/ambari_06.png" alt=""></figure></p><p>è¿™é‡Œè·³è½¬åˆ°å®‰è£…é¡µé¢ï¼šå‘ç°æŠ¥é”™æç¤ºdatanode-173.hadoopä¸»æœºè®¿é—®Ambariæœºå™¨ä¸èƒ½è®¿é—®ã€‚<br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/ambari_07.png" alt=""></figure></p><h3 id="6-ç¡®è®¤ä¸»æœº"><a href="#6-ç¡®è®¤ä¸»æœº" class="headerlink" title="6.ç¡®è®¤ä¸»æœº"></a>6.ç¡®è®¤ä¸»æœº</h3><p><code>Confirm Hosts</code> æç¤ºæ‚¨ç¡®è®¤<code>Ambari</code>å·²ä¸ºæ‚¨çš„é›†ç¾¤æ‰¾åˆ°æ­£ç¡®çš„ä¸»æœºï¼Œå¹¶æ£€æŸ¥è¿™äº›ä¸»æœºä»¥ç¡®ä¿å®ƒä»¬å…·æœ‰ç»§ç»­å®‰è£…æ‰€éœ€çš„æ­£ç¡®ç›®å½•ï¼Œè½¯ä»¶åŒ…å’Œè¿›ç¨‹ã€‚</p><p>å¦‚æœé€‰æ‹©äº†é”™è¯¯çš„ä¸»æœºï¼Œæ‚¨å¯ä»¥é€šè¿‡é€‰æ‹©ç›¸åº”çš„å¤é€‰æ¡†å¹¶å•å‡»ç°è‰²<code>Remove Selected</code>æŒ‰é’®æ¥åˆ é™¤å®ƒä»¬ã€‚è¦åˆ é™¤å•ä¸ªä¸»æœºï¼Œè¯·å•å‡»Removeâ€œæ“ä½œâ€åˆ—ä¸­çš„å°ç™½è‰²æŒ‰é’®ã€‚</p><p>åœ¨å±å¹•åº•éƒ¨ï¼Œæ‚¨å¯èƒ½ä¼šæ³¨æ„åˆ°ä¸€ä¸ªé»„è‰²æ¡†ï¼Œè¡¨ç¤ºåœ¨æ£€æŸ¥è¿‡ç¨‹ä¸­é‡åˆ°äº†ä¸€äº›è­¦å‘Šã€‚ä¾‹å¦‚ï¼Œæ‚¨çš„ä¸»æœºå¯èƒ½å·²æœ‰<code>wget</code>æˆ–çš„å‰¯æœ¬ <code>curl</code>ã€‚é€‰æ‹©<code>Click here to see the warnings</code> æŸ¥çœ‹æ£€æŸ¥å†…å®¹å’Œå¯¼è‡´è­¦å‘Šçš„åŸå› çš„åˆ—è¡¨ã€‚è­¦å‘Šé¡µé¢è¿˜æä¾›å¯¹pythonè„šæœ¬çš„è®¿é—®ï¼Œå¯ä»¥å¸®åŠ©æ‚¨æ¸…é™¤å¯èƒ½é‡åˆ°çš„ä»»ä½•é—®é¢˜ï¼Œè®©æ‚¨è¿è¡Œ<code>Rerun Checks</code>ã€‚</p><p>åœ¨datanode_173æœåŠ¡å™¨é…ç½®hosts</p><pre><code>vim /etc/hosts</code></pre><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">192<span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.151</span>    <span class="selector-tag">datanode151</span></div><div class="line">192<span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.173</span>    <span class="selector-tag">datanode_173</span> <span class="selector-tag">datanode-173</span><span class="selector-class">.hadoop</span></div></pre></td></tr></table></figure><p>æ¯å°èŠ‚ç‚¹é‡Œé…ç½®FQDNï¼Œå¦‚ä¸‹ä»¥ä¸»èŠ‚ç‚¹ä¸ºä¾‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">vi /etc/sysconfig/network</div><div class="line">NETWORKING=yes</div><div class="line">HOSTNAME=SY-001.hadoop</div></pre></td></tr></table></figure><p>é…ç½®ä¸Šå°±å¯ä»¥äº†ã€‚ æŠŠdatanode151ä¹Ÿæ˜¯ambariæœºå™¨é…ç½®åœ¨hostså°±å¯ä»¥äº†ã€‚</p><p><strong>æœ€å¥½è®¾ç½®rootçš„æ— å¯†ç ç™»å½•ï¼Œå› ä¸ºæˆ‘ä»¬é…ç½®çš„é›†ç¾¤éƒ½æ˜¯å†…ç½‘çš„ï¼Œæ²¡ä»€ä¹ˆå®‰å…¨æ€§é—®é¢˜ï¼Œä½¿ç”¨rootæ“ä½œå¯ä»¥çœå»ä¸€äº›éº»çƒ¦ï¼Œérootç”¨æˆ·å¯èƒ½åœ¨å®‰è£…Hadoopç»„ä»¶æ—¶ä¸èƒ½æˆåŠŸ</strong></p><p>ä¸‹é¢æ˜¯æˆ‘å®‰è£…è¿™é‡Œæç¤ºæ²¡æœ‰æ‰¾åˆ°æ–‡ä»¶ç›®å½•æŸ¥çœ‹å®‰è£…æŠ¥é”™æ“ä½œï¼š</p><pre><code>mkdir /var/lib/ambari-agent/data</code></pre><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/Ambari_08.png" alt=""></figure><br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/ambari_09.png" alt=""></figure><br><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/ambari_10.png" alt=""></figure></p><h3 id="7-é€‰æ‹©æœåŠ¡"><a href="#7-é€‰æ‹©æœåŠ¡" class="headerlink" title="7.é€‰æ‹©æœåŠ¡"></a>7.é€‰æ‹©æœåŠ¡</h3><p>å°†çœ‹åˆ°é€‰æ‹©è¦å®‰è£…åˆ°ç¾¤é›†ä¸­çš„æœåŠ¡ã€‚HDPå †æ ˆåŒ…æ‹¬è®¸å¤šæœåŠ¡ã€‚æ‚¨å¯ä»¥é€‰æ‹©ç«‹å³å®‰è£…ä»»ä½•å…¶ä»–å¯ç”¨æœåŠ¡ï¼Œæˆ–ç¨åæ·»åŠ æœåŠ¡ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®‰è£…å‘å¯¼å°†é€‰æ‹©æ‰€æœ‰å¯ç”¨çš„æœåŠ¡è¿›è¡Œå®‰è£…ã€‚</p><p>é€‰æ‹©<code>none</code>æ¸…é™¤æ‰€æœ‰é€‰æ‹©ï¼Œæˆ–é€‰æ‹© <code>all</code>é€‰æ‹©æ‰€æœ‰åˆ—å‡ºçš„æœåŠ¡ã€‚</p><p>é€‰æ‹©æˆ–æ¸…é™¤å•ä¸ªå¤é€‰æ¡†ä»¥å®šä¹‰ä¸€ç»„è¦ç«‹å³å®‰è£…çš„æœåŠ¡ã€‚</p><p>é€‰æ‹©è¦ç«‹å³å®‰è£…çš„æœåŠ¡åï¼Œé€‰æ‹©Nextã€‚</p><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/ambari_11.png" alt=""></figure></p><h3 id="8-åˆ†é…ä¸»ç«™"><a href="#8-åˆ†é…ä¸»ç«™" class="headerlink" title="8.åˆ†é…ä¸»ç«™"></a>8.åˆ†é…ä¸»ç«™</h3><p>Ambariå®‰è£…å‘å¯¼ä¼šå°†æ‰€é€‰æœåŠ¡çš„ä¸»ç»„ä»¶åˆ†é…ç»™é›†ç¾¤ä¸­çš„ç›¸åº”ä¸»æœºï¼Œå¹¶åœ¨Assign Mastersä¸­æ˜¾ç¤ºåˆ†é…ã€‚å·¦åˆ—æ˜¾ç¤ºæœåŠ¡å’Œå½“å‰ä¸»æœºã€‚å³åˆ—æ˜¾ç¤ºä¸»æœºçš„å½“å‰ä¸»ç»„ä»¶åˆ†é…ï¼ŒæŒ‡ç¤ºæ¯ä¸ªä¸»æœºä¸Šå®‰è£…çš„CPUå†…æ ¸æ•°é‡å’ŒRAMæ•°é‡ã€‚</p><p>è¦æ›´æ”¹æœåŠ¡çš„ä¸»æœºåˆ†é…ï¼Œè¯·ä»è¯¥æœåŠ¡çš„ä¸‹æ‹‰èœå•ä¸­é€‰æ‹©ä¸»æœºåã€‚</p><p>è¦åˆ é™¤ZooKeeperå®ä¾‹ï¼Œè¯·å•å‡»è¦åˆ é™¤çš„ä¸»æœºåœ°å€æ—è¾¹çš„ç»¿è‰²å‡å·å›¾æ ‡ã€‚</p><p>å½“æ‚¨å¯¹ä½œä¸šæ„Ÿåˆ°æ»¡æ„æ—¶ï¼Œé€‰æ‹©Nextã€‚</p><p><figure class="figure"><img src="" alt=""></figure></p><h3 id="9-åˆ†é…ä»å±å’Œå®¢æˆ·ç«¯"><a href="#9-åˆ†é…ä»å±å’Œå®¢æˆ·ç«¯" class="headerlink" title="9.åˆ†é…ä»å±å’Œå®¢æˆ·ç«¯"></a>9.åˆ†é…ä»å±å’Œå®¢æˆ·ç«¯</h3><p>Ambariå®‰è£…å‘å¯¼å°†ä»å±ç»„ä»¶ï¼ˆDataNodesï¼ŒNodeManagerå’ŒRegionServersï¼‰åˆ†é…ç»™é›†ç¾¤ä¸­çš„ç›¸åº”ä¸»æœºã€‚å®ƒè¿˜ä¼šå°è¯•é€‰æ‹©ä¸»æœºä»¥å®‰è£…é€‚å½“çš„å®¢æˆ·ç«¯é›†ã€‚</p><p>ä½¿ç”¨<code>all</code>æˆ–<code>none</code>å¯åˆ†åˆ«é€‰æ‹©åˆ—ä¸­çš„æ‰€æœ‰ä¸»æœºæˆ–ä¸é€‰æ‹©ä»»ä½•ä¸»æœºã€‚</p><p>å¦‚æœä¸»æœºæ—è¾¹æœ‰æ˜Ÿå·ï¼Œåˆ™è¯¥ä¸»æœºä¹Ÿè¿è¡Œä¸€ä¸ªæˆ–å¤šä¸ªä¸»ç»„ä»¶ã€‚å°†é¼ æ ‡æ‚¬åœåœ¨æ˜Ÿå·ä¸Šï¼Œä»¥æŸ¥çœ‹è¯¥ä¸»æœºä¸Šçš„å“ªäº›ä¸»ç»„ä»¶ã€‚</p><p>é€šè¿‡ä½¿ç”¨ç‰¹å®šä¸»æœºæ—è¾¹çš„å¤é€‰æ¡†æ¥å¾®è°ƒæ‚¨çš„é€‰æ‹©ã€‚</p><p>å½“ä½ å¯¹ä½ çš„ä½œä¸šæ„Ÿåˆ°æ»¡æ„æ—¶ï¼Œé€‰æ‹©<code>Next</code>ã€‚</p><h3 id="10-è‡ªå®šä¹‰æœåŠ¡"><a href="#10-è‡ªå®šä¹‰æœåŠ¡" class="headerlink" title="10.è‡ªå®šä¹‰æœåŠ¡"></a>10.è‡ªå®šä¹‰æœåŠ¡</h3><p>è‡ªå®šä¹‰æœåŠ¡æ­¥éª¤ä¸ºæ‚¨æä¾›ä¸€ç»„é€‰é¡¹å¡ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹å’Œä¿®æ”¹HDPé›†ç¾¤è®¾ç½®ã€‚å‘å¯¼ä¼šå°è¯•ä¸ºæ¯ä¸ªé€‰é¡¹è®¾ç½®åˆç†çš„é»˜è®¤å€¼ã€‚ä½ æ˜¯å¼ºçƒˆå»ºè®®ï¼Œä»¥æ£€æŸ¥è¿™äº›è®¾ç½®ä¸ºæ‚¨çš„è¦æ±‚å¯èƒ½ç•¥æœ‰ä¸åŒã€‚</p><p>æµè§ˆæ¯ä¸ªæœåŠ¡æ ‡ç­¾ï¼Œç„¶åå°†å…‰æ ‡æ‚¬åœåœ¨æ¯ä¸ªå±æ€§ä¸Šï¼Œæ‚¨å¯ä»¥çœ‹åˆ°å±æ€§åšä»€ä¹ˆçš„ç®€è¦è¯´æ˜ã€‚æ˜¾ç¤ºçš„æœåŠ¡é€‰é¡¹å¡æ•°å–å†³äºæ‚¨å†³å®šåœ¨ç¾¤é›†ä¸­å®‰è£…çš„æœåŠ¡ã€‚ä»»ä½•éœ€è¦è¾“å…¥çš„é€‰é¡¹å¡éƒ½ä¼šæ˜¾ç¤ºä¸€ä¸ªçº¢è‰²å¾½ç« ï¼Œå…¶ä¸­åŒ…å«éœ€è¦æ³¨æ„çš„å±æ€§æ•°ã€‚é€‰æ‹©æ˜¾ç¤ºçº¢è‰²å¾½ç« ç¼–å·çš„æ¯ä¸ªæœåŠ¡é€‰é¡¹å¡ï¼Œç„¶åè¾“å…¥ç›¸åº”çš„ä¿¡æ¯ã€‚</p><ul><li>ç›®å½•</li></ul><p>HDPå°†å­˜å‚¨ä¿¡æ¯çš„ç›®å½•çš„é€‰æ‹©æ˜¯è‡³å…³é‡è¦çš„ã€‚Ambariå°†å°è¯•æ ¹æ®æ‚¨ç¯å¢ƒä¸­å¯ç”¨çš„å®‰è£…ç‚¹é€‰æ‹©åˆç†çš„é»˜è®¤å€¼ï¼Œä½†å¼ºçƒˆå»ºè®®æ‚¨æŸ¥çœ‹Ambariæ¨èçš„é»˜è®¤ç›®å½•è®¾ç½®ã€‚ç‰¹åˆ«æ˜¯ï¼Œç¡®è®¤ç›®å½•ï¼Œä¾‹å¦‚<code>/tmpå’Œ /var</code>è¢«ä¸è¢«ç”¨äºä¸‹<code>HDFSçš„NameNode</code>ç›®å½•å’Œæ•°æ®ç®¡ç†éƒ¨ç›®å½•HDFSæ ‡ç­¾ã€‚</p><ul><li>å¯†ç </li></ul><p>æ‚¨å¿…é¡»ä¸ºHiveå’ŒOozieæœåŠ¡ä»¥åŠKnoxçš„ä¸»å¯†é’¥æä¾›æ•°æ®åº“å¯†ç ã€‚ä½¿ç”¨Hiveä½œä¸ºç¤ºä¾‹ï¼Œé€‰æ‹©Hiveé€‰é¡¹å¡å¹¶å±•å¼€é«˜çº§éƒ¨åˆ†ã€‚åœ¨ä»¥çº¢è‰²æ ‡è®°çš„æ•°æ®åº“å¯†ç å­—æ®µä¸­ï¼Œæä¾›å¯†ç ï¼Œç„¶åé‡æ–°é”®å…¥ä»¥ç¡®è®¤ã€‚</p><p>å®‰è£…å„ä¸ªæœåŠ¡ï¼Œå¹¶ä¸”å®Œæˆå®‰è£…åä¼šå¯åŠ¨ç›¸å…³æœåŠ¡ï¼Œå®‰è£…è¿‡ç¨‹æ¯”è¾ƒé•¿ï¼Œå¦‚ä¸­ä¸­å‡ºç°é”™è¯¯ï¼Œæ ¹æ®å…·ä½“æä¾›æˆ–æ—¥å¿—è¿›è¡Œæ“ä½œã€‚ </p><p>è¿™é‡Œæˆ‘å°±ä¸è´´å‡ºæ¥äº†ï¼Œå› ä¸ºæµ‹è¯•ç¯å¢ƒæœºå™¨æˆ‘åšæµ‹è¯•ç”¨æœºå™¨é…ç½®ä¸å¤Ÿæ‰€æœ‰åé¢ç»“æœç»éªŒå†™å‡ºæ¥äº†ã€‚</p><p>å®‰è£…çš„è¿˜æ˜¯æç¤ºå¤±è´¥ï¼š<code>ImportError: No module named rpm</code></p><p>å‚è€ƒè¿™ç¯‡æ–‡ç« é‡æ–°å®‰è£…è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼š<a href="http://stackoverflow.com/questions/17490921/no-module-named-rpm-when-i-call-yum-on-shell" target="_blank" rel="external">ImportError: No module named rpm</a></p><h3 id="11-å®‰è£…ï¼Œå¯åŠ¨å’Œæµ‹è¯•"><a href="#11-å®‰è£…ï¼Œå¯åŠ¨å’Œæµ‹è¯•" class="headerlink" title="11.å®‰è£…ï¼Œå¯åŠ¨å’Œæµ‹è¯•"></a>11.å®‰è£…ï¼Œå¯åŠ¨å’Œæµ‹è¯•</h3><p>å®‰è£…çš„è¿›åº¦å°†æ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚Ambariå®‰è£…ï¼Œå¯åŠ¨ï¼Œå¹¶å¯¹æ¯ä¸ªç»„ä»¶è¿è¡Œä¸€ä¸ªç®€å•çš„æµ‹è¯•ã€‚è¿‡ç¨‹çš„æ€»ä½“çŠ¶æ€æ˜¾ç¤ºåœ¨å±å¹•é¡¶éƒ¨çš„è¿›åº¦æ ä¸­ï¼Œä¸»æœºçš„ä¸»æœºçŠ¶æ€æ˜¾ç¤ºåœ¨ä¸»è¦éƒ¨åˆ†ã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­ä¸è¦åˆ·æ–°æµè§ˆå™¨ã€‚åˆ·æ–°æµè§ˆå™¨å¯èƒ½ä¼šä¸­æ–­è¿›åº¦æŒ‡ç¤ºå™¨ã€‚</p><p>è¦æŸ¥çœ‹æ¯ä¸ªä¸»æœºå·²å®Œæˆçš„ä»»åŠ¡çš„å…·ä½“ä¿¡æ¯ï¼Œè¯·å•å‡»Messageç›¸åº”ä¸»æœºåˆ—ä¸­çš„é“¾æ¥ã€‚åœ¨ Taskså¼¹å‡ºçª—å£ä¸­ï¼Œå•å‡»å•ä¸ªä»»åŠ¡ä»¥æŸ¥çœ‹ç›¸å…³çš„æ—¥å¿—æ–‡ä»¶ã€‚æ‚¨å¯ä»¥ä½¿ç”¨Showä¸‹æ‹‰åˆ—è¡¨é€‰æ‹©è¿‡æ»¤æ¡ä»¶ã€‚è¦æŸ¥çœ‹æ›´å¤§ç‰ˆæœ¬çš„æ—¥å¿—å†…å®¹ï¼Œè¯·å•å‡»Openå›¾æ ‡æˆ–å°†å†…å®¹å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œä½¿ç”¨Copyå›¾æ ‡ã€‚</p><p><strong>å®‰è£…å®Œæˆæ•ˆæœå›¾:</strong></p><p><figure class="figure"><img src="http://hortonassets.s3.amazonaws.com/ambari1_7/ambari002.png" alt=""></figure></p><blockquote><p>è®©æˆ‘ä»¬ä»å·¦ä¾§æ æˆ–ä¸‹æ‹‰èœå•ä¸­é€‰æ‹©Yarnè¿›å…¥YARNä¿¡æ¯ä¸­å¿ƒã€‚</p></blockquote><p><figure class="figure"><img src="http://hortonassets.s3.amazonaws.com/ambari1_7/ambari004.png" alt=""></figure></p><blockquote><p>æˆ‘ä»¬å°†å¼€å§‹æ›´æ–°çº¿ç¨‹å®¹é‡è°ƒåº¦ç­–ç•¥çš„é…ç½®ã€‚</p></blockquote><p><figure class="figure"><img src="http://hortonassets.s3.amazonaws.com/ambari1_7/ambari005.png" alt=""></figure></p><p>å‘ä¸‹æ»šåŠ¨åˆ°<code>Scheduler</code>é¡µé¢çš„éƒ¨åˆ†ã€‚é»˜è®¤å®¹é‡è°ƒåº¦ç­–ç•¥åªæœ‰ä¸€ä¸ªé˜Ÿåˆ—ã€‚</p><p><figure class="figure"><img src="http://hortonassets.s3.amazonaws.com/ambari1_7/ambari006.png" alt=""></figure></p><p>è®©æˆ‘ä»¬çœ‹çœ‹è°ƒåº¦ç­–ç•¥ã€‚å‘ä¸Šæ»šåŠ¨åˆ°é¡µé¢é¡¶éƒ¨ï¼Œç„¶åç‚¹å‡»å¿«é€Ÿé“¾æ¥ã€‚ç„¶åä»ä¸‹æ‹‰åˆ—è¡¨ä¸­é€‰æ‹©<code>ResourceManager UI</code>ã€‚</p><p><figure class="figure"><img src="http://hortonassets.s3.amazonaws.com/ambari1_7/ambari007.png" alt=""></figure></p><blockquote><p>æ­£å¦‚ä½ å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬åªæœ‰é»˜è®¤ç­–ç•¥ã€‚</p></blockquote><p><figure class="figure"><img src="http://hortonassets.s3.amazonaws.com/ambari1_7/ambari008.png" alt=""></figure></p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p>å®‰è£…Ambariå®˜ç½‘åœ°å€<a href="https://docs.hortonworks.com/HDPDocuments/Ambari-2.4.2.0/bk_ambari-installation/content/download_the_ambari_repo_lnx6.html" target="_blank" rel="external">install Ambari</a><br><a href="https://cwiki.apache.org/confluence/display/AMBARI/Installation+Guide+for+Ambari+2.4.2" target="_blank" rel="external">ç¼–è¯‘å®‰è£…Ambari 2.4.2å®‰è£…æŒ‡å—</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;HORTONW0RKSæ•°æ®å¹³å°æ­å»ºAmbariç®¡ç†ç›‘æ§Hadoopé›†ç¾¤&quot;&gt;&lt;a href=&quot;#HORTONW0RKSæ•°æ®å¹³å°æ­å»ºAmbariç®¡ç†ç›‘æ§Hadoopé›†ç¾¤&quot; class=&quot;headerlink&quot; title=&quot;HORTONW0RKSæ•°æ®å¹³å°æ­å»ºAmbar
      
    
    </summary>
    
      <category term="å¤§æ•°æ®" scheme="http://blog.yancy.cc/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
    
      <category term="Big data Hadoop" scheme="http://blog.yancy.cc/tags/Big-data-Hadoop/"/>
    
      <category term="Ambari" scheme="http://blog.yancy.cc/tags/Ambari/"/>
    
  </entry>
  
  <entry>
    <title>Bigdata-Kafkaä¸‰æ¬¾ç›‘æ§å·¥å…·æ¯”è¾ƒ</title>
    <link href="http://blog.yancy.cc/2017/04/29/Bigdata-hadoop/Kafka/Bigdata-Kafka%E4%B8%89%E6%AC%BE%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7%E6%AF%94%E8%BE%83/"/>
    <id>http://blog.yancy.cc/2017/04/29/Bigdata-hadoop/Kafka/Bigdata-Kafkaä¸‰æ¬¾ç›‘æ§å·¥å…·æ¯”è¾ƒ/</id>
    <published>2017-04-29T06:46:00.000Z</published>
    <updated>2017-09-23T16:20:21.000Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨ä¹‹å‰çš„åšå®¢ä¸­ï¼Œä»‹ç»äº†<code>Kafka Web Console</code>è¿™ä¸ªç›‘æ§å·¥å…·ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œè¿è¡Œä¸€æ®µæ—¶é—´åï¼Œå‘ç°è¯¥å·¥å…·ä¼šå’ŒKafkaç”Ÿäº§è€…ã€æ¶ˆè´¹è€…ã€ZooKeeperå»ºç«‹å¤§é‡è¿æ¥ï¼Œä»è€Œå¯¼è‡´ç½‘ç»œé˜»å¡ã€‚å¹¶ä¸”è¿™ä¸ªBugä¹Ÿåœ¨å…¶ä»–ä½¿ç”¨è€…ä¸­å‡ºç°è¿‡ï¼Œçœ‹æ¥ä½¿ç”¨å¼€æºå·¥å…·è¦æ…é‡ï¼è¯¥Bugæš‚æœªå¾—åˆ°ä¿®å¤ï¼Œä¸å¾—å·²ï¼Œåªèƒ½ç ”ç©¶ä¸‹å…¶ä»–åŒç±»çš„Kafkaç›‘æ§è½¯ä»¶ã€‚</p><p>é€šè¿‡ç ”ç©¶ï¼Œå‘ç°ä¸»æµçš„ä¸‰ç§kafkaç›‘æ§ç¨‹åºåˆ†åˆ«ä¸ºï¼š</p><ul><li>1ã€Kafka Web Conslole</li><li>2ã€Kafka Manager</li><li>3ã€KafkaOffsetMonitor</li></ul><p>ç°åœ¨ä¾æ¬¡ä»‹ç»ä»¥ä¸Šä¸‰ç§å·¥å…·ï¼š</p><h2 id="1ã€Kafka-Web-Conslole"><a href="#1ã€Kafka-Web-Conslole" class="headerlink" title="1ã€Kafka Web Conslole"></a>1ã€Kafka Web Conslole</h2><p>ä½¿ç”¨Kafka Web Consoleï¼Œå¯ä»¥ç›‘æ§ï¼š</p><ul><li>Brokersåˆ—è¡¨</li><li>Kafka é›†ç¾¤ä¸­ Topicåˆ—è¡¨ï¼ŒåŠå¯¹åº”çš„Partitionã€LogSiz eç­‰ä¿¡æ¯</li><li>ç‚¹å‡»Topicï¼Œå¯ä»¥æµè§ˆå¯¹åº”çš„Consumer Groupsã€Offsetã€Lagç­‰ä¿¡æ¯</li><li>ç”Ÿäº§å’Œæ¶ˆè´¹æµé‡å›¾ã€æ¶ˆæ¯é¢„è§ˆâ€¦</li></ul><p>ç¨‹åºè¿è¡Œåï¼Œä¼šå®šæ—¶å»è¯»å–kafkaé›†ç¾¤åˆ†åŒºçš„æ—¥å¿—é•¿åº¦ï¼Œè¯»å–å®Œæ¯•åï¼Œè¿æ¥æ²¡æœ‰æ­£å¸¸é‡Šæ”¾ï¼Œä¸€æ®µæ—¶é—´åäº§ç”Ÿå¤§é‡çš„socketè¿æ¥ï¼Œå¯¼è‡´ç½‘ç»œå µå¡ã€‚</p><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/Kafka_web_console.png" alt=""></figure></p><h2 id="2ã€Kafka-Manager"><a href="#2ã€Kafka-Manager" class="headerlink" title="2ã€Kafka Manager"></a>2ã€Kafka Manager</h2><p>é›…è™å¼€æºçš„Kafkaé›†ç¾¤ç®¡ç†å·¥å…·:</p><ul><li>ç®¡ç†å‡ ä¸ªä¸åŒçš„é›†ç¾¤</li><li>ç›‘æ§é›†ç¾¤çš„çŠ¶æ€(topics, brokers, å‰¯æœ¬åˆ†å¸ƒ, åˆ†åŒºåˆ†å¸ƒ)</li><li>äº§ç”Ÿåˆ†åŒºåˆ†é…(Generate partition assignments)åŸºäºé›†ç¾¤çš„å½“å‰çŠ¶æ€</li><li>é‡æ–°åˆ†é…åˆ†åŒº</li></ul><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/kafka_manager.png" alt=""></figure></p><h2 id="3ã€KafkaOffsetMonitor"><a href="#3ã€KafkaOffsetMonitor" class="headerlink" title="3ã€KafkaOffsetMonitor"></a>3ã€KafkaOffsetMonitor</h2><ul><li>KafkaOffsetMonitorå¯ä»¥å®æ—¶ç›‘æ§ï¼š</li><li>Kafkaé›†ç¾¤çŠ¶æ€</li><li>Topicã€Consumer Groupåˆ—è¡¨</li><li>å›¾å½¢åŒ–å±•ç¤ºtopicå’Œconsumerä¹‹é—´çš„å…³ç³»</li><li>å›¾å½¢åŒ–å±•ç¤ºconsumerçš„Offsetã€Lagç­‰ä¿¡æ¯</li></ul><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/kafkaoffsetmonitor.png" alt=""></figure></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>é€šè¿‡ä½¿ç”¨ï¼Œä¸ªäººæ€»ç»“ä»¥ä¸Šä¸‰ç§ç›‘æ§ç¨‹åºçš„ä¼˜ç¼ºç‚¹ï¼š</p><p><a href="https://github.com/claudemamo/kafka-web-console" target="_blank" rel="external">Kafka Web Console</a>ï¼šç›‘æ§åŠŸèƒ½è¾ƒä¸ºå…¨é¢ï¼Œå¯ä»¥é¢„è§ˆæ¶ˆæ¯ï¼Œç›‘æ§Offsetã€Lagç­‰ä¿¡æ¯ï¼Œä½†å­˜åœ¨bugï¼Œä¸å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ã€‚</p><p><a href="https://github.com/yahoo/kafka-manager" target="_blank" rel="external">Kafka Manager</a>ï¼šåå‘Kafkaé›†ç¾¤ç®¡ç†ï¼Œè‹¥æ“ä½œä¸å½“ï¼Œå®¹æ˜“å¯¼è‡´é›†ç¾¤å‡ºç°æ•…éšœã€‚å¯¹Kafkaå®æ—¶ç”Ÿäº§å’Œæ¶ˆè´¹æ¶ˆæ¯æ˜¯é€šè¿‡JMXå®ç°çš„ã€‚æ²¡æœ‰è®°å½•Offsetã€Lagç­‰ä¿¡æ¯ã€‚</p><p><a href="https://github.com/quantifind/KafkaOffsetMonitor" target="_blank" rel="external">KafkaOffsetMonitor</a>ï¼šç¨‹åºä¸€ä¸ªjaråŒ…çš„å½¢å¼è¿è¡Œï¼Œéƒ¨ç½²è¾ƒä¸ºæ–¹ä¾¿ã€‚åªæœ‰ç›‘æ§åŠŸèƒ½ï¼Œä½¿ç”¨èµ·æ¥ä¹Ÿè¾ƒä¸ºå®‰å…¨ã€‚</p><p>è‹¥åªéœ€è¦ç›‘æ§åŠŸèƒ½ï¼Œæ¨èä½¿ç”¨KafkaOffsetMonitoï¼Œè‹¥åé‡Kafkaé›†ç¾¤ç®¡ç†ï¼Œæ¨èä½¿ç”¨Kafka Managerã€‚</p><p>å› ä¸ºéƒ½æ˜¯å¼€æºç¨‹åºï¼Œç¨³å®šæ€§æ¬ ç¼ºã€‚æ•…éœ€å…ˆäº†è§£æ¸…æ¥šç›®å‰å·²å­˜åœ¨å“ªäº›Bugï¼Œå¤šæµ‹è¯•ä¸€ä¸‹ï¼Œé¿å…å‡ºç°ç±»ä¼¼äºKafka Web Consoleçš„é—®é¢˜ã€‚</p><h3 id="äº¤æµå­¦ä¹ ï¼š"><a href="#äº¤æµå­¦ä¹ ï¼š" class="headerlink" title="äº¤æµå­¦ä¹ ï¼š"></a>äº¤æµå­¦ä¹ ï¼š</h3><p>ğŸ§  Linux shell_é«˜çº§è¿ç»´æ´¾: <code>459096184</code>    åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)<br>ğŸ§  BigData-Exchange School : <code>521621407</code>  åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥</p><p>ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;åœ¨ä¹‹å‰çš„åšå®¢ä¸­ï¼Œä»‹ç»äº†&lt;code&gt;Kafka Web Console&lt;/code&gt;è¿™ä¸ªç›‘æ§å·¥å…·ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œè¿è¡Œä¸€æ®µæ—¶é—´åï¼Œå‘ç°è¯¥å·¥å…·ä¼šå’ŒKafkaç”Ÿäº§è€…ã€æ¶ˆè´¹è€…ã€ZooKeeperå»ºç«‹å¤§é‡è¿æ¥ï¼Œä»è€Œå¯¼è‡´ç½‘ç»œé˜»å¡ã€‚å¹¶ä¸”è¿™ä¸ªBugä¹Ÿåœ¨å…¶ä»–ä½¿ç”¨è€…ä¸­å‡ºç°è¿‡ï¼Œçœ‹æ¥ä½¿ç”¨å¼€æºå·¥å…·
      
    
    </summary>
    
      <category term="å¤§æ•°æ®" scheme="http://blog.yancy.cc/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
    
      <category term="Kafka" scheme="http://blog.yancy.cc/tags/Kafka/"/>
    
      <category term="Bigdata Hadoop" scheme="http://blog.yancy.cc/tags/Bigdata-Hadoop/"/>
    
  </entry>
  
  <entry>
    <title>ç ”ç©¶å­¦ä¹  Elasticsearch 5.0.0 åŠŸèƒ½æå‡å“ªäº›,ESå¦‚ä½•å¼¹æ€§è¿ç§»æ—¥å¿—æ•°æ®ï¼Œå®‰è£…éœ€è¦ä»€ä¹ˆç¯å¢ƒï¼Ÿ</title>
    <link href="http://blog.yancy.cc/2017/03/30/%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%10%E5%B9%B3%E5%8F%B0/Elasticsearch/%E7%A0%94%E7%A9%B6%E5%AD%A6%E4%B9%A0%20Elasticsearch%205.0.0%20%E5%8A%9F%E8%83%BD%E6%8F%90%E5%8D%87%E5%93%AA%E4%BA%9B,ES%E5%A6%82%E4%BD%95%E5%BC%B9%E6%80%A7%E8%BF%81%E7%A7%BB%E6%97%A5%E5%BF%97%E6%95%B0%E6%8D%AE%EF%BC%8C%E5%AE%89%E8%A3%85%E9%9C%80%E8%A6%81%E4%BB%80%E4%B9%88%E7%8E%AF%E5%A2%83%EF%BC%9F/"/>
    <id>http://blog.yancy.cc/2017/03/30/æ—¥å¿—åˆ†æå¹³å°/Elasticsearch/ç ”ç©¶å­¦ä¹  Elasticsearch 5.0.0 åŠŸèƒ½æå‡å“ªäº›,ESå¦‚ä½•å¼¹æ€§è¿ç§»æ—¥å¿—æ•°æ®ï¼Œå®‰è£…éœ€è¦ä»€ä¹ˆç¯å¢ƒï¼Ÿ/</id>
    <published>2017-03-30T09:56:03.000Z</published>
    <updated>2017-09-23T16:21:04.000Z</updated>
    
    <content type="html"><![CDATA[<p><figure class="figure"><img src="http://img13.deviantart.net/1fb9/i/2013/051/6/1/ella_vs__elastic_yoko_by_gamepal-d5vmtjm.png" alt=""></figure></p><p>ES ç°åœ¨æ™®éå¤§å…¬å¸éƒ½å·²ç»åœ¨ä½¿ç”¨ï¼Œæœ‰çš„ç”¨æ¥åšæ•°æ®å­˜å‚¨ï¼Œä¹Ÿæœ‰åšæ€§èƒ½ç›‘æ§ï¼Œä¹Ÿæœ‰åšæ—¥å¿—æ”¶é›†ï¼Œè·Ÿå¤§æ•°æ®ç»“åˆåšæ—¥å¿—åˆ†æã€‚<br>ä»Šå¤©åœ¨å®¶æ— èŠç ”ç©¶å®˜ç½‘å­¦ä¹ äº†ä¸‹Elasticsearch5.0.0 åŠŸèƒ½æ–°å¢å“ªäº›ï¼Œä¸ªäººè§‰å¾—ESä¹Ÿæ˜¯ç°åœ¨å¼€æºæ—¥å¿—åˆ†æå¹³å°æ¯”è¾ƒç«çš„ï¼Œä»14å¹´å¼€å§‹é™†ç»­ä½¿ç”¨é¢‘ç‡ä¸æ–­æå‡ã€‚<br>ä¹‹å‰ä¹Ÿæœ‰äº†è§£è¿‡Graylog  ç°åœ¨æ¯”ES åšæ•°æ®å­˜å‚¨åˆ†æ ä¸é”™çš„æ˜¯Graylog æ¯”ESæ€§èƒ½å¥½ã€‚<br>åºŸè¯ä¸å¤šè¯´äº†å“ˆå“ˆ</p><a id="more"></a><h3 id="Elasticsearch-5-0-0å‘å¸ƒ"><a href="#Elasticsearch-5-0-0å‘å¸ƒ" class="headerlink" title="Elasticsearch 5.0.0å‘å¸ƒ"></a>Elasticsearch 5.0.0å‘å¸ƒ</h3><p>2016å¹´10æœˆ26æ—¥å‘å¸ƒ Elasticsearch 5.0.0 ä»Šå¤©å»ä¸‹è½½å§ï¼ä½ çŸ¥é“ä½ æƒ³ã€‚</p><p><a href="https://www.elastic.co/downloads/elasticsearch" target="_blank" rel="external">ä¸‹è½½Elasticsearch 5.0.0</a><br><a href="https://www.elastic.co/guide/en/elasticsearch/reference/5.0/release-notes-5.0.0.html" target="_blank" rel="external">Elasticsearch 5.0.0å‘è¡Œè¯´æ˜</a><br><a href="https://www.elastic.co/guide/en/elasticsearch/reference/5.0/release-notes-5.0.0.html" target="_blank" rel="external">å¼¹æ€§æœç´¢5.0çªç ´å˜åŒ–</a></p><p>Elasticsearch 5.0.0å¯¹å¤§å®¶æœ‰æ‰€å¸®åŠ© è¿™æ˜¯æœ‰å²ä»¥æ¥æœ€å¿«ï¼Œæœ€å®‰å…¨ï¼Œæœ€å…·å¼¹æ€§ï¼Œæœ€ç®€å•æ˜“ç”¨çš„Elasticsearchç‰ˆæœ¬ï¼Œå®ƒå…·æœ‰ä¸€ç³»åˆ—å¢å¼ºåŠŸèƒ½å’Œæ–°åŠŸèƒ½ã€‚</p><ul><li>ç´¢å¼•æ€§èƒ½</li><li>å–é£ŸèŠ‚ç‚¹</li><li>æ— ç—›è„šæœ¬</li><li>æ–°çš„æ•°æ®ç»“æ„</li><li>æœç´¢å’Œèšåˆ</li><li>ç”¨æˆ·å‹å¥½</li><li>å¼¹æ€§</li><li>Java RESTå®¢æˆ·ç«¯</li><li>è¿ç§»åŠ©æ‰‹</li></ul><blockquote><p>ä¸‹é¢ä»å®˜ç½‘ä¸Šé¢ç¿»è¯‘å¾—æ¥çš„ï¼š</p></blockquote><h3 id="ç´¢å¼•æ€§èƒ½"><a href="#ç´¢å¼•æ€§èƒ½" class="headerlink" title="ç´¢å¼•æ€§èƒ½"></a>ç´¢å¼•æ€§èƒ½</h3><p>ç”±äºåŒ…æ‹¬æ›´å¥½çš„æ•°å­—æ•°æ®ç»“æ„ï¼ˆå‚è§æ–°æ•°æ®ç»“æ„ï¼‰çš„ä¸€äº›æ›´æ”¹ï¼Œç´¢å¼•ååé‡åœ¨5.0.0ä¸­æœ‰äº†æ˜¾ç€æ”¹å–„ï¼Œé”ä¸­çš„äº‰ç”¨å‡å°‘ï¼Œé˜»æ­¢å¯¹åŒä¸€æ–‡æ¡£çš„å¹¶å‘æ›´æ–°ï¼Œä»¥åŠå‡å°‘äº‹åŠ¡æ—¥å¿—æ—¶çš„é”å®šéœ€æ±‚ã€‚å¼‚æ­¥translog fsyncingå°†ç‰¹åˆ«æœ‰åˆ©äºæ—‹è½¬ç£ç›˜çš„ç”¨æˆ·ï¼Œè€Œä¾èµ–Elasticsearchè‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£IDæ—¶ï¼Œä»…è¿½åŠ ç”¨ä¾‹ï¼ˆåŸºäºæ€è€ƒæ—¶é—´çš„äº‹ä»¶ï¼‰å…·æœ‰å¾ˆå¤§çš„ååé‡æé«˜ã€‚å¯¹å®æ—¶æ–‡æ¡£GETçš„æ”¯æŒçš„å†…éƒ¨å˜åŒ–æ„å‘³ç€ç´¢å¼•ç¼“å†²åŒºå¯ç”¨çš„å†…å­˜æ›´å¤šï¼Œåƒåœ¾æ”¶é›†æ—¶é—´å°‘å¾—å¤šã€‚</p><p>æ ¹æ®æ‚¨çš„ç”¨ä¾‹ï¼Œæ‚¨å¯èƒ½ä¼šçœ‹åˆ°åœ¨æé«˜ååé‡çš„25ï¼…è‡³80ï¼…ä¹‹é—´ã€‚</p><h3 id="IngestèŠ‚ç‚¹"><a href="#IngestèŠ‚ç‚¹" class="headerlink" title="IngestèŠ‚ç‚¹"></a>IngestèŠ‚ç‚¹</h3><p>ã€€ã€€å‘Elasticsearchæ·»åŠ æ•°æ®æ›´ç®€å•äº†ã€‚Logstashæ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œè€Œä¸€äº›è¾ƒå°çš„ç”¨æˆ·åªéœ€è¦è¿‡æ»¤å™¨ï¼Œä¸éœ€è¦å®ƒæ‰€æä¾›çš„ä¼—å¤šè·¯ç”±é€‰é¡¹ã€‚å› æ­¤ï¼ŒElasticå°†ä¸€äº›æœ€æµè¡Œçš„Logstashè¿‡æ»¤å™¨ï¼ˆå¦‚grokã€splitï¼‰ç›´æ¥åœ¨Elasticsearchä¸­å®ç°ä¸ºå¤„ç†å™¨ã€‚å¤šä¸ªå¤„ç†å™¨å¯ä»¥ç»„åˆæˆä¸€ä¸ªç®¡é“ï¼Œåœ¨ç´¢å¼•æ—¶åº”ç”¨åˆ°æ–‡æ¡£ä¸Šã€‚</p><h3 id="Painlessè„šæœ¬"><a href="#Painlessè„šæœ¬" class="headerlink" title="Painlessè„šæœ¬"></a>Painlessè„šæœ¬</h3><p>ã€€ã€€Elasticsearchä¸­å¾ˆå¤šåœ°æ–¹ç”¨åˆ°äº†è„šæœ¬ï¼Œè€Œå‡ºäºå®‰å…¨è€ƒè™‘ï¼Œè„šæœ¬åœ¨é»˜è®¤æƒ…å†µä¸‹æ˜¯ç¦ç”¨çš„ï¼Œè¿™ä»¤äººç›¸å½“å¤±æœ›ã€‚ä¸ºæ­¤ï¼ŒElasticå¼€å‘äº†ä¸€ç§æ–°çš„è„šæœ¬è¯­è¨€Painlessã€‚è¯¥è¯­è¨€æ›´å¿«ã€æ›´å®‰å…¨ï¼Œè€Œä¸”é»˜è®¤æ˜¯å¯ç”¨çš„ã€‚ä¸ä»…å¦‚æ­¤ï¼Œå®ƒçš„æ‰§è¡Œé€Ÿåº¦æ˜¯Groovyçš„4å€ï¼Œè€Œä¸”æ­£åœ¨å˜å¾—æ›´å¿«ã€‚Painlesså·²ç»æˆä¸ºé»˜è®¤è„šæœ¬è¯­è¨€ï¼Œè€ŒGroovyã€Javascriptå’ŒPythonéƒ½é­åˆ°å¼ƒç”¨ã€‚è¦äº†è§£æœ‰å…³è¿™é—¨æ–°è¯­è¨€çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·ç‚¹å‡»è¿™é‡Œã€‚</p><h3 id="æ–°æ•°æ®ç»“æ„"><a href="#æ–°æ•°æ®ç»“æ„" class="headerlink" title="æ–°æ•°æ®ç»“æ„"></a>æ–°æ•°æ®ç»“æ„</h3><p>ã€€ã€€Lucene 6å¸¦æ¥äº†ä¸€ä¸ªæ–°çš„Points æ•°æ®ç»“æ„K-Dæ ‘ï¼Œç”¨äºå­˜å‚¨æ•°å€¼å‹å’Œåœ°ç†ä½ç½®å­—æ®µï¼Œå½»åº•æ”¹å˜äº†æ•°å€¼å‹å€¼çš„ç´¢å¼•å’Œæœç´¢æ–¹å¼ã€‚åŸºå‡†æµ‹è¯•è¡¨æ˜ï¼ŒPointså°†æŸ¥è¯¢é€Ÿåº¦æå‡äº†36%ï¼Œå°†ç´¢å¼•é€Ÿåº¦æå‡äº†71%ï¼Œè€Œå ç”¨çš„ç£ç›˜å’Œå†…å­˜ç©ºé—´åˆ†åˆ«å‡å°‘äº†66%å’Œ85%ï¼ˆå‚è§â€œåœ¨5.0ä¸­æœç´¢æ•°å€¼â€ï¼‰ã€‚</p><h4 id="æœç´¢å’Œèšåˆ"><a href="#æœç´¢å’Œèšåˆ" class="headerlink" title="æœç´¢å’Œèšåˆ"></a>æœç´¢å’Œèšåˆ</h4><p>ã€€ã€€å€ŸåŠ©å³æ—¶èšåˆï¼ŒKibanaå›¾è¡¨ç”Ÿæˆé€Ÿåº¦æ˜¾è‘—æå‡ã€‚Elasticç”¨ä¸€å¹´çš„æ—¶é—´å¯¹æœç´¢APIè¿›è¡Œäº†é‡æ„ï¼ŒElasticsearchç°åœ¨å¯ä»¥æ›´å·§å¦™åœ°æ‰§è¡ŒèŒƒå›´æŸ¥è¯¢ï¼Œåªé’ˆå¯¹å·²ç»å‘ç”Ÿå˜åŒ–çš„ç´¢å¼•é‡æ–°è®¡ç®—èšåˆï¼Œè€Œä¸æ˜¯é’ˆå¯¹æ¯ä¸ªæŸ¥è¯¢ä»å¤´å¼€å§‹é‡æ–°è®¡ç®—ã€‚åœ¨æœç´¢æ–¹é¢ï¼Œé»˜è®¤çš„ç›¸å…³æ€§è®¡ç®—å·²ç»ç”±TF/IDFæ¢æˆäº†æ›´å…ˆè¿›çš„BM25ã€‚è¡¥å…¨å»ºè®®ç¨‹åºç»è¿‡äº†å®Œå…¨é‡å†™ï¼Œå°†å·²åˆ é™¤çš„æ–‡æ¡£ä¹Ÿè€ƒè™‘äº†è¿›æ¥ã€‚</p><h3 id="æ›´å‹å¥½"><a href="#æ›´å‹å¥½" class="headerlink" title="æ›´å‹å¥½"></a>æ›´å‹å¥½</h3><p>ã€€ã€€Elasticsearch 5.0æ›´å®‰å…¨ã€æ›´æ˜“ç”¨ã€‚ä»–ä»¬é‡‡ç”¨äº†â€œå°½æ—©æç¤ºâ€çš„æ–¹æ³•ã€‚å¦‚æœå‡ºç°äº†é—®é¢˜ï¼Œåˆ™æ–°ç‰ˆæœ¬ä¼šåŠæ—©ç»™å‡ºæç¤ºã€‚ä¾‹å¦‚ï¼ŒElasticsearch 5.0ä¼šä¸¥æ ¼éªŒè¯è®¾ç½®ã€‚å¦‚æœå®ƒä¸èƒ½è¯†åˆ«æŸé¡¹è®¾ç½®çš„å€¼ï¼Œå°±ä¼šç»™å‡ºæç¤ºå’Œå»ºè®®ã€‚ä¸ä»…å¦‚æ­¤ï¼Œé›†ç¾¤å’Œç´¢å¼•è®¾ç½®ç°åœ¨å¯ä»¥é€šè¿‡nullè¿›è¡Œè§£é™¤ã€‚æ­¤å¤–ï¼Œè¿˜æœ‰å…¶ä»–çš„ä¸€äº›æ”¹è¿›ï¼Œä¾‹å¦‚ï¼Œrolloverå’Œshrink APIå¯ç”¨äº†ä¸€ç§æ–°çš„æ¨¡å¼æ¥ç®¡ç†åŸºäºæ—¶é—´çš„ç´¢å¼•ï¼Œå¼•å…¥æ–°çš„cluster-allocation-explain APIï¼Œç®€åŒ–ç´¢å¼•åˆ›å»ºã€‚</p><h3 id="å¼¹æ€§"><a href="#å¼¹æ€§" class="headerlink" title="å¼¹æ€§"></a>å¼¹æ€§</h3><p>ã€€ã€€Elasticsearchåˆ†å¸ƒå¼æ¨¡å‹çš„æ¯ä¸€éƒ¨åˆ†éƒ½è¢«åˆ†è§£ã€é‡æ„å’Œç®€åŒ–ï¼Œæå‡äº†å¯é æ€§ã€‚é›†ç¾¤çŠ¶æ€æ›´æ–°ç°åœ¨ä¼šç­‰å¾…é›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ç¡®è®¤ã€‚å¦‚æœä¸€ä¸ªâ€œå¤åˆ¶ç‰‡ï¼ˆreplica shardï¼‰â€è¢«â€œä¸»ç‰‡ï¼ˆprimaryï¼‰â€æ ‡è®°ä¸ºå¤±è´¥ï¼Œåˆ™ä¸»ç‰‡ä¼šç­‰å¾…â€œä¸»èŠ‚ç‚¹ï¼ˆmasterï¼‰â€çš„å“åº”ã€‚ç´¢å¼•ç°åœ¨ä½¿ç”¨æ•°æ®è·¯å¾„ä¸­çš„UUIDï¼Œè€Œä¸æ˜¯ç´¢å¼•åï¼Œé¿å…äº†å‘½åå†²çªã€‚å¦å¤–ï¼ŒElasticsearchç°åœ¨è¿›è¡Œå¯åŠ¨æ£€æŸ¥ï¼Œç¡®ä¿ç³»ç»Ÿé…ç½®æ²¡æœ‰é—®é¢˜ã€‚é…ç½®æ¯”è¾ƒéº»çƒ¦ï¼Œä½†å¦‚æœåªæ˜¯è¯•ç”¨ï¼Œå¼€å‘äººå‘˜ä¹Ÿå¯ä»¥é€‰æ‹©localhost-onlyæ¨¡å¼ï¼Œé¿å…ç¹ççš„é…ç½®ã€‚å¦å¤–ï¼Œæ–°ç‰ˆæœ¬è¿˜å¢åŠ äº†æ–­è·¯å™¨åŠå…¶ä»–ä¸€äº›è½¯é™åˆ¶ï¼Œé™åˆ¶è¯·æ±‚ä½¿ç”¨çš„å†…å­˜å¤§å°ï¼Œä¿æŠ¤é›†ç¾¤å…å—æ¶æ„ç”¨æˆ·æ”»å‡»ã€‚<br>ã€€ã€€æ­¤å¤–ï¼Œè¯¥ç‰ˆæœ¬è¿˜æä¾›äº†ä¸€ä¸ªåº•å±‚çš„Java REST/HTTPå®¢æˆ·ç«¯ï¼Œå¯ä»¥ç”¨äºç›‘å¬ã€æ—¥å¿—è®°å½•ã€è¯·æ±‚è½®è¯¢ã€æ•…éšœèŠ‚ç‚¹é‡è¯•ç­‰ã€‚å®ƒä½¿ç”¨Java 7ï¼Œå°†ä¾èµ–é™åˆ°äº†æœ€ä½ï¼Œæ¯”Transportå®¢æˆ·ç«¯çš„ä¾èµ–å†²çªå°‘ã€‚è€Œåœ¨åŸºå‡†æµ‹è¯•ä¸­ï¼Œå®ƒçš„æ€§èƒ½å¹¶ä¸è¾“äºTransportå®¢æˆ·ç«¯ã€‚ä¸è¿‡ï¼Œè¿™æ˜¯ä¸€ä¸ªåº•å±‚å®¢æˆ·ç«¯ï¼Œç›®å‰è¿˜æ²¡æœ‰æä¾›ä»»ä½•æŸ¥è¯¢æ„å»ºå™¨æˆ–è¾…åŠ©å™¨ã€‚å®ƒçš„è¾“å…¥å‚æ•°å’Œè¾“å‡ºç»“æœéƒ½æ˜¯JSONã€‚<br>ã€€ã€€éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¯¥ç‰ˆæœ¬å¼•å…¥äº†è®¸å¤šç ´åæ€§æ›´æ”¹ï¼Œå¥½åœ¨ä»–ä»¬æä¾›äº†ä¸€ä¸ªè¿ç§»è¾…åŠ©æ’ä»¶ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜ä»Elasticsearch 2.3.x/2.4.xè¿ç§»åˆ°Elasticsearch 5.0ã€‚å¦‚æœæ˜¯ä»æ›´æ—©çš„Elasticsearchç‰ˆæœ¬å‘æœ€æ–°çš„5.0ç‰ˆæœ¬è¿ç§»ï¼Œåˆ™è¯·æŸ¥é˜…å‡çº§æ–‡æ¡£ã€‚</p><h3 id="Java-RESTå®¢æˆ·ç«¯"><a href="#Java-RESTå®¢æˆ·ç«¯" class="headerlink" title="Java RESTå®¢æˆ·ç«¯"></a>Java RESTå®¢æˆ·ç«¯</h3><p>ç»è¿‡å¤šå¹´çš„ç­‰å¾…ï¼Œæˆ‘ä»¬ç»ˆäºå‘å¸ƒäº†ä¸€ä¸ªä½çº§çš„Java HTTP / RESTå®¢æˆ·ç«¯ã€‚å®ƒæä¾›äº†ä¸€ä¸ªç®€å•çš„HTTPå®¢æˆ·ç«¯ï¼Œå…·æœ‰æœ€å°‘çš„ä¾èµ–å…³ç³»ï¼Œå¯ä»¥å¤„ç†å—…æ¢ï¼Œè®°å½•ï¼Œå¾ªç¯è¯·æ±‚ï¼Œå¹¶é‡è¯•èŠ‚ç‚¹æ•…éšœã€‚å®ƒä½¿ç”¨çš„RESTå±‚å†å²ä¸Šæ¯”Java APIæ›´ç¨³å®šï¼Œè¿™æ„å‘³ç€å®ƒå¯ä»¥è·¨è¶Šå‡çº§ä½¿ç”¨ï¼Œç”šè‡³å¯èƒ½åœ¨ä¸»è¦ç‰ˆæœ¬ä¹‹é—´è¿›è¡Œå‡çº§ã€‚å®ƒä¸Java 7ä¸€èµ·å·¥ä½œï¼Œå¹¶ä¸”å…·æœ‰æœ€å°çš„ä¾èµ–æ€§ï¼Œå¯¼è‡´æ¯”ä¼ è¾“å®¢æˆ·ç«¯æ›´å°‘çš„ä¾èµ–å†²çªã€‚å®ƒåªæ˜¯HTTPï¼Œå› æ­¤å¯ä»¥åƒæ‰€æœ‰å…¶ä»–HTTPå®¢æˆ·ç«¯ä¸€æ ·è¿›è¡Œé˜²ç«å¢™/ä»£ç†ã€‚åœ¨æˆ‘ä»¬çš„åŸºå‡†æµ‹è¯•ä¸­ï¼ŒJava RESTå®¢æˆ·ç«¯ ä¸Transportå®¢æˆ·ç«¯çš„åŠŸèƒ½ç±»ä¼¼ã€‚</p><p>è¯·æ³¨æ„ï¼Œè¿™æ˜¯ä¸€ä¸ªä½çº§å®¢æˆ·ç«¯ã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬ä¸æä¾›ä»»ä½•å¯ä»¥åœ¨IDEä¸­è‡ªåŠ¨å®Œæˆçš„æŸ¥è¯¢æ„å»ºå™¨æˆ–å¸®åŠ©å™¨ã€‚å®ƒæ˜¯JSON-inï¼ŒJSON-outï¼Œç”±ä½ æ¥æ„å»ºJSONã€‚å¼€å‘ä¸ä¼šåœæ­¢åœ¨è¿™é‡Œ - æˆ‘ä»¬å°†æ·»åŠ ä¸€ä¸ªAPIï¼Œå®ƒå°†å¸®åŠ©æ‚¨æ„å»ºæŸ¥è¯¢å¹¶è§£æå“åº”ã€‚æ‚¨å¯ä»¥æŒ‰ç…§é—®é¢˜ï¼ƒ19055ä¸­çš„æ›´æ”¹è¿›è¡Œæ“ä½œã€‚</p><h3 id="è¿ç§»åŠ©æ‰‹"><a href="#è¿ç§»åŠ©æ‰‹" class="headerlink" title="è¿ç§»åŠ©æ‰‹"></a>è¿ç§»åŠ©æ‰‹</h3><p>Elasticsearch Migration Helperæ˜¯ä¸€ä¸ªç½‘ç«™æ’ä»¶ï¼Œå¯ä»¥å¸®åŠ©ä»<code>Elasticsearch 2.3.x / 2.4.x</code>è¿ç§»åˆ°Elasticsearch 5.0ã€‚å®ƒæœ‰ä¸‰ä¸ªå·¥å…·ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">é›†ç¾¤æ£€æŸ¥</div><div class="line">å¯¹é›†ç¾¤ï¼ŒèŠ‚ç‚¹å’Œç´¢å¼•æ‰§è¡Œä¸€ç³»åˆ—æ£€æŸ¥ï¼Œå¹¶æé†’æ‚¨å‡çº§ä¹‹å‰éœ€è¦è§£å†³çš„ä»»ä½•å·²çŸ¥é—®é¢˜ã€‚</div><div class="line"><span class="selector-tag">Reindex</span>åŠ©æ‰‹</div><div class="line">åœ¨<span class="selector-tag">v2</span><span class="selector-class">.0</span><span class="selector-class">.0</span>ä¹‹å‰åˆ›å»ºçš„ç´¢å¼•éœ€è¦é‡æ–°ç¼–å·ï¼Œæ‰èƒ½åœ¨<span class="selector-tag">Elasticsearch</span> 5<span class="selector-class">.x</span>ä¸­ä½¿ç”¨ã€‚<span class="selector-tag">reindex</span>å¸®åŠ©å™¨ç‚¹å‡»ä¸€ä¸ªæŒ‰é’®å‡çº§æ—§ç´¢å¼•ã€‚</div><div class="line">å¼ƒç”¨æ—¥å¿—</div><div class="line"><span class="selector-tag">Elasticsearch</span>é™„å¸¦äº†ä¸€ä¸ªå¼ƒç”¨è®°å½•å™¨ï¼Œæ¯å½“ä½¿ç”¨ä¸æ¨èä½¿ç”¨çš„åŠŸèƒ½æ—¶ï¼Œå®ƒå°†è®°å½•æ¶ˆæ¯ã€‚æ­¤å·¥å…·å¯å¯ç”¨æˆ–ç¦ç”¨ç¾¤é›†ä¸Šçš„å¼ƒç”¨æ—¥å¿—è®°å½•ã€‚</div></pre></td></tr></table></figure><p>å®˜ç½‘æ¨èè¿ç§»æ–‡æ¡£ï¼šInstruction for <a href="(https://github.com/elastic/elasticsearch-migration/blob/2.x/README.asciidoc">install the Elasticsearch migration helper. </a>)</p><h3 id="Elasticsearch-5-0-0-å®‰è£…éœ€è¦å“ªäº›è¦æ±‚ã€‚"><a href="#Elasticsearch-5-0-0-å®‰è£…éœ€è¦å“ªäº›è¦æ±‚ã€‚" class="headerlink" title="Elasticsearch 5.0.0 å®‰è£…éœ€è¦å“ªäº›è¦æ±‚ã€‚"></a>Elasticsearch 5.0.0 å®‰è£…éœ€è¦å“ªäº›è¦æ±‚ã€‚</h3><p>Elasticsearchéœ€è¦ä¾èµ–Java JDK1.8</p><h3 id="äº¤æµå­¦ä¹ ï¼š"><a href="#äº¤æµå­¦ä¹ ï¼š" class="headerlink" title="äº¤æµå­¦ä¹ ï¼š"></a>äº¤æµå­¦ä¹ ï¼š</h3><p>ğŸ§  Linux shell_é«˜çº§è¿ç»´æ´¾: <code>459096184</code>    åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)<br>ğŸ§  BigData-Exchange School : <code>521621407</code>  åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥</p><p>ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://img13.deviantart.net/1fb9/i/2013/051/6/1/ella_vs__elastic_yoko_by_gamepal-d5vmtjm.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;ES ç°åœ¨æ™®éå¤§å…¬å¸éƒ½å·²ç»åœ¨ä½¿ç”¨ï¼Œæœ‰çš„ç”¨æ¥åšæ•°æ®å­˜å‚¨ï¼Œä¹Ÿæœ‰åšæ€§èƒ½ç›‘æ§ï¼Œä¹Ÿæœ‰åšæ—¥å¿—æ”¶é›†ï¼Œè·Ÿå¤§æ•°æ®ç»“åˆåšæ—¥å¿—åˆ†æã€‚&lt;br&gt;ä»Šå¤©åœ¨å®¶æ— èŠç ”ç©¶å®˜ç½‘å­¦ä¹ äº†ä¸‹Elasticsearch5.0.0 åŠŸèƒ½æ–°å¢å“ªäº›ï¼Œä¸ªäººè§‰å¾—ESä¹Ÿæ˜¯ç°åœ¨å¼€æºæ—¥å¿—åˆ†æå¹³å°æ¯”è¾ƒç«çš„ï¼Œä»14å¹´å¼€å§‹é™†ç»­ä½¿ç”¨é¢‘ç‡ä¸æ–­æå‡ã€‚&lt;br&gt;ä¹‹å‰ä¹Ÿæœ‰äº†è§£è¿‡Graylog  ç°åœ¨æ¯”ES åšæ•°æ®å­˜å‚¨åˆ†æ ä¸é”™çš„æ˜¯Graylog æ¯”ESæ€§èƒ½å¥½ã€‚&lt;br&gt;åºŸè¯ä¸å¤šè¯´äº†å“ˆå“ˆ&lt;/p&gt;
    
    </summary>
    
      <category term="Log Analysis Platform" scheme="http://blog.yancy.cc/categories/Log-Analysis-Platform/"/>
    
    
      <category term="Elasticsearch" scheme="http://blog.yancy.cc/tags/Elasticsearch/"/>
    
  </entry>
  
  <entry>
    <title>Bigdata-countlyéœ€è¦è¿ç§»</title>
    <link href="http://blog.yancy.cc/2017/03/29/Bigdata-hadoop/countly/Bigdata-countly%E9%9C%80%E8%A6%81%E8%BF%81%E7%A7%BB/"/>
    <id>http://blog.yancy.cc/2017/03/29/Bigdata-hadoop/countly/Bigdata-countlyéœ€è¦è¿ç§»/</id>
    <published>2017-03-29T06:46:00.000Z</published>
    <updated>2017-09-23T16:20:44.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="å®˜æ–¹å®‰è£…æ–‡æ¡£ï¼šhttp-resources-count-ly-docs-installing-countly-server"><a href="#å®˜æ–¹å®‰è£…æ–‡æ¡£ï¼šhttp-resources-count-ly-docs-installing-countly-server" class="headerlink" title="å®˜æ–¹å®‰è£…æ–‡æ¡£ï¼šhttp://resources.count.ly/docs/installing-countly-server"></a>å®˜æ–¹å®‰è£…æ–‡æ¡£ï¼š<a href="http://resources.count.ly/docs/installing-countly-server" target="_blank" rel="external">http://resources.count.ly/docs/installing-countly-server</a></h4><p>ç›®å‰<code>countly</code>éœ€è¦è¿ç§»ï¼Œæ‰€éœ€<code>countly</code>ç‰ˆæœ¬äºå®˜æ–¹æä¾›çš„å®‰è£…æ–¹æ¡ˆæœ‰å†²çªï¼Œæ‰€ä»¥å¦‚ä¸‹å®‰è£…ï¼š</p><p>å®‰è£…å®˜æ–¹<code>countly</code>è®©å…¶è®¾ç½®æ‰€éœ€ç¯å¢ƒå˜é‡åŠå…¶å¯åŠ¨è„šæœ¬ï¼Œæ‰‹åŠ¨æŒ‡å®šå®‰è£…nojsç‰ˆæœ¬ï¼Œæ‹·è´åŸcountlyæ–‡ä»¶ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">1ã€<span class="built_in">cd</span> /data <span class="comment">#countlyå®‰è£…åœ¨dataç›®å½• æˆ‘çœ‹äº†å®‰è£…è„šæœ¬ï¼Œæ˜¯å½“å‰åœ¨å“ªä¸ªç›®å½•ï¼Œå®‰è£…æ–‡ä»¶å°±åœ¨å“ªä¸ªç›®å½•</span></div><div class="line">wget -qO- http://c.ly/install | bash</div></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">2ã€rpm -qa | grep -i nodejs | xargs -I&#123;&#125;  yum remove &#123;&#125; -y</div><div class="line">å¸è½½æ‰å®˜ç½‘å®‰è£…çš„æœ€æ–°nodejs ç„¶åæ–°å»ºå¦‚ä¸‹yumæºï¼Œç”¨äºå®‰è£…æ—§ç‰ˆæ‰€éœ€nodejsï¼Œä¹Ÿå¯ä»¥åˆ°nodejså®˜ç½‘ä¸‹è½½æ‰€éœ€nodejs</div><div class="line">cat /etc/yum.repos.d/nodesource-el.repo </div><div class="line">[nodesource]</div><div class="line">name=Node.js Packages <span class="keyword">for</span> Enterprise Linux 7 - <span class="variable">$basearch</span></div><div class="line">baseurl=https://rpm.nodesource.com/pub_5.x/el/7/<span class="variable">$basearch</span></div><div class="line">failovermethod=priority</div><div class="line">enabled=1</div><div class="line">gpgcheck=1</div><div class="line">gpgkey=file:///etc/pki/rpm-gpg/NODESOURCE-GPG-SIGNING-KEY-EL</div><div class="line">[nodesource-source]</div><div class="line">name=Node.js <span class="keyword">for</span> Enterprise Linux 7 - <span class="variable">$basearch</span> - Source</div><div class="line">baseurl=https://rpm.nodesource.com/pub_5.x/el/7/SRPMS</div><div class="line">failovermethod=priority</div><div class="line">enabled=0</div><div class="line">gpgkey=file:///etc/pki/rpm-gpg/NODESOURCE-GPG-SIGNING-KEY-EL</div><div class="line">gpgcheck=1</div></pre></td></tr></table></figure><h3 id="å®‰è£…è€ç‰ˆæœ¬æ‰€éœ€nodejs"><a href="#å®‰è£…è€ç‰ˆæœ¬æ‰€éœ€nodejs" class="headerlink" title="å®‰è£…è€ç‰ˆæœ¬æ‰€éœ€nodejs"></a>å®‰è£…è€ç‰ˆæœ¬æ‰€éœ€nodejs</h3><figure class="highlight cmake"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum <span class="keyword">install</span> nodejs</div></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">3ã€æ‹·è´æºcountlyæ–‡ä»¶åˆ°/data/countlyç›®å½•</div><div class="line">ä¿®æ”¹ /data/countly/api/config.js å’Œ /data/countly/frontend/express/config.js      </div><div class="line">3001ç«¯å£å’Œ 6001ç«¯å£ç›‘å¬åœ°å€æ¢æˆ æœ¬åœ°ç§æœ‰åœ°å€   <span class="comment">#æºæ–‡ä»¶æ˜¯ç›‘å¬çš„åŸæ¥æœºå™¨çš„å†…ç½‘åœ°å€ï¼Œä¸ä¿®æ”¹çš„è¯ï¼ŒæœåŠ¡å¯åŠ¨ä¸äº†ã€‚</span></div></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="number">4</span><span class="string">ã€æ‹·è´mongoæ•°æ®ç›®å½•åˆ°/data/mongoç›®å½•ï¼Œä¿®æ”¹mongoé…ç½®æ–‡ä»¶.</span></div><div class="line"></div><div class="line"><span class="string">cat</span> <span class="string">/etc/mongod.conf</span></div><div class="line"><span class="attr">systemLog:</span></div><div class="line"><span class="attr">       destination:</span> <span class="string">file</span></div><div class="line"><span class="attr">       logAppend:</span> <span class="literal">true</span></div><div class="line"><span class="attr">       path:</span> <span class="string">/data/mongodb/mongod.log</span></div><div class="line"><span class="attr">storage:</span></div><div class="line"><span class="attr">       dbPath:</span> <span class="string">/data/mongo</span></div><div class="line"><span class="attr">       journal:</span></div><div class="line"><span class="attr">             enabled:</span> <span class="literal">true</span></div><div class="line"><span class="attr">       engine:</span> <span class="string">mmapv1</span></div><div class="line"><span class="attr">processManagement:</span></div><div class="line"><span class="attr">       fork:</span> <span class="literal">true</span></div><div class="line"><span class="attr">       pidFilePath:</span> <span class="string">/data/mongodb/mongod.pid</span></div><div class="line"><span class="attr">net:</span></div><div class="line"><span class="attr">       port:</span> <span class="number">27017</span></div><div class="line"><span class="attr">       bindIp:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></div><div class="line"><span class="attr">security:</span></div><div class="line"><span class="attr">       authorization:</span> <span class="string">enabled</span></div><div class="line"><span class="attr">operationProfiling:</span></div><div class="line"><span class="attr">       slowOpThresholdMs:</span> <span class="number">40960</span></div></pre></td></tr></table></figure><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/Bigdatacountly01.jpeg" alt=""></figure></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">5ã€ä¿®æ”¹ç¡¬ç›˜blockï¼š</div><div class="line">     blockdev --setra 256 /dev/mapper/xvdc--vg-xvdcâ€“lv    <span class="comment">##æŒ‰ç…§mongoæç¤ºæ“ä½œ</span></div></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">6ã€ä¿®æ”¹nginxé…ç½®æ–‡ä»¶  conf.d/default.conf</div><div class="line">      å°†127.0.0.1ä¿®æ”¹ä¸ºæœ¬åœ°ç§æœ‰åœ°å€</div></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">7ã€é‡å¯countly   mongodb  nginx</div><div class="line"></div><div class="line">countly restart</div><div class="line"></div><div class="line">/etc/init.d/mongod restart</div><div class="line"></div><div class="line">service nginx restart</div><div class="line">è¿ç§»å®Œæ¯•</div></pre></td></tr></table></figure><h3 id="äº¤æµå­¦ä¹ ï¼š"><a href="#äº¤æµå­¦ä¹ ï¼š" class="headerlink" title="äº¤æµå­¦ä¹ ï¼š"></a>äº¤æµå­¦ä¹ ï¼š</h3><p>ğŸ§  Linux shell_é«˜çº§è¿ç»´æ´¾: <code>459096184</code>    åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)<br>ğŸ§  BigData-Exchange School : <code>521621407</code>  åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥</p><p>ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;å®˜æ–¹å®‰è£…æ–‡æ¡£ï¼šhttp-resources-count-ly-docs-installing-countly-server&quot;&gt;&lt;a href=&quot;#å®˜æ–¹å®‰è£…æ–‡æ¡£ï¼šhttp-resources-count-ly-docs-installing-countly-serv
      
    
    </summary>
    
      <category term="Bigdata Hadoop" scheme="http://blog.yancy.cc/categories/Bigdata-Hadoop/"/>
    
    
      <category term="Bigdata Hadoop" scheme="http://blog.yancy.cc/tags/Bigdata-Hadoop/"/>
    
      <category term="Countly" scheme="http://blog.yancy.cc/tags/Countly/"/>
    
  </entry>
  
  <entry>
    <title>æ­å»º(ElasticSearch-2.x Logstash-2.x Kibana-4.5.x zookeeper3.4.6) Kafkaä¸ºæ¶ˆæ¯ä¸­å¿ƒçš„ELKæ—¥å¿—å¹³å°</title>
    <link href="http://blog.yancy.cc/2016/12/29/%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%10%E5%B9%B3%E5%8F%B0/Elasticsearch/%E6%90%AD%E5%BB%BA(ElasticSearch-2.x%20Logstash-2.x%20Kibana-4.5.x%20zookeeper3.4.6)%20Kafka%E4%B8%BA%E6%B6%88%E6%81%AF%E4%B8%AD%E5%BF%83%E7%9A%84ELK%E6%97%A5%E5%BF%97%E5%B9%B3%E5%8F%B0/"/>
    <id>http://blog.yancy.cc/2016/12/29/æ—¥å¿—åˆ†æå¹³å°/Elasticsearch/æ­å»º(ElasticSearch-2.x Logstash-2.x Kibana-4.5.x zookeeper3.4.6) Kafkaä¸ºæ¶ˆæ¯ä¸­å¿ƒçš„ELKæ—¥å¿—å¹³å°/</id>
    <published>2016-12-29T09:56:03.000Z</published>
    <updated>2017-09-23T16:21:14.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="æ­å»º-ElasticSearch-2-x-Logstash-2-x-Kibana-4-5-x-zookeeper3-4-6-Kafkaä¸ºæ¶ˆæ¯ä¸­å¿ƒçš„ELKæ—¥å¿—å¹³å°"><a href="#æ­å»º-ElasticSearch-2-x-Logstash-2-x-Kibana-4-5-x-zookeeper3-4-6-Kafkaä¸ºæ¶ˆæ¯ä¸­å¿ƒçš„ELKæ—¥å¿—å¹³å°" class="headerlink" title="æ­å»º(ElasticSearch-2.x Logstash-2.x Kibana-4.5.x zookeeper3.4.6) Kafkaä¸ºæ¶ˆæ¯ä¸­å¿ƒçš„ELKæ—¥å¿—å¹³å°"></a>æ­å»º(ElasticSearch-2.x Logstash-2.x Kibana-4.5.x zookeeper3.4.6) Kafkaä¸ºæ¶ˆæ¯ä¸­å¿ƒçš„ELKæ—¥å¿—å¹³å°</h3><h3 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><p>ELKæ˜¯ä¸šç•Œæ ‡å‡†çš„æ—¥å¿—é‡‡é›†,å­˜å‚¨ç´¢å¼•,å±•ç¤ºåˆ†æç³»ç»Ÿè§£å†³æ–¹æ¡ˆ</p><p>logstashæä¾›äº†çµæ´»å¤šæ ·çš„æ’ä»¶æ”¯æŒä¸åŒçš„input/output</p><p>ä¸»æµä½¿ç”¨redis/kafkaä½œä¸ºæ—¥å¿—/æ¶ˆæ¯çš„ä¸­é—´ç¯èŠ‚</p><p>å¦‚æœå·²æœ‰kafkaçš„ç¯å¢ƒäº†,ä½¿ç”¨kafkaæ¯”ä½¿ç”¨redisæ›´ä½³</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªæœ€ç®€åŒ–çš„é…ç½®åšä¸ªç¬”è®°,elasticå®˜ç½‘æä¾›äº†éå¸¸ä¸°å¯Œçš„æ–‡æ¡£</p><p>ä¸è¦ç”¨æœç´¢å¼•æ“å»æœç´¢,æ²¡å¤šå°‘ç»“æœçš„,è¯·ç›´æ¥çœ‹å®˜ç½‘æ–‡æ¡£</p><h3 id="ç‰ˆæœ¬åŠè¿æ¥"><a href="#ç‰ˆæœ¬åŠè¿æ¥" class="headerlink" title="ç‰ˆæœ¬åŠè¿æ¥"></a>ç‰ˆæœ¬åŠè¿æ¥</h3><p>elasticseearchç‰ˆæœ¬: 2.4.3</p><h3 id="ç³»ç»Ÿè¦æ±‚"><a href="#ç³»ç»Ÿè¦æ±‚" class="headerlink" title="ç³»ç»Ÿè¦æ±‚"></a>ç³»ç»Ÿè¦æ±‚</h3><p>å¦‚æœä»…ä½œæµ‹è¯•ç”¨, ä¸éœ€è¦ä¸¤å¤©æœºå™¨, å¯ä»¥å°†ä¸¤ä¸ªèŠ‚ç‚¹éƒ¨ç½²åœ¨åŒä¸€å°æœºå™¨ä¸Š, å¯¹ç£ç›˜/cpuè¦æ±‚ä¸é«˜, å†…å­˜å¤§äº2gåŸºæœ¬è¶³å¤Ÿäº†</p><p>å¦‚æœæ˜¯æ­£å¼ç¯å¢ƒ, éœ€è¦æ ¹æ®æ—¥å¿—é‡è¿›è¡Œè¯„ä¼°, ä¾‹å¦‚, æ¯å¤©æ—¥å¿—é‡å ç¡¬ç›˜çº¦çº¦10G, ä¸”ä¿ç•™30å¤©æ—¥å¿—, åˆ™ç£ç›˜ä¼šå ç”¨çº¦300g, esè®¾å®šçš„é˜ˆå€¼æ˜¯ç£ç›˜ç©ºé—´å æ»¡85%åˆ™æ—¥å¿—å¼€å§‹å‘Šè­¦. æ‰€ä»¥, éœ€è¦è‡³å°‘ 300/0.85=354g.</p><p>å‡†å¤‡4å°æœºå™¨, åœ¨åŒä¸€ä¸ªå±€åŸŸç½‘å†…(å¯pingé€š), åˆ†åˆ«åœ¨æ¯å°æœºå™¨ä¸Šéƒ¨ç½²ç›¸åº”esèŠ‚ç‚¹, æ­å»ºä¸€å¥—æ—¥å¿—é›†ç¾¤.</p><p>4å°æœºå™¨, æœ€å°‘çš„èµ„æºäº†, ä½†æ˜¯æ²¡æ³•åšåˆ°é«˜å¯ç”¨, æ‰€ä»¥, è¿˜éœ€è¦å†åŠ ä¸€å°æœºå™¨, é˜²æ­¢è„‘è£‚, å…·ä½“è§æœ€å(ä¸¤å°ä¸»åŠ›æœºå™¨+ä¸€å°ç¨³å®šçš„æœºå™¨å°±è¡Œ)</p><p>é›†ç¾¤èŠ‚ç‚¹: æœ€å°‘4å°æœºå™¨<br>å†…å­˜: 8GåŠä»¥ä¸Š<br>cpu: 4æ ¸åŠä»¥ä¸Š<br>ç¡¬ç›˜: 800GåŠä»¥ä¸Š, å»ºè®®1T, é›†ç¾¤å®¹é‡çº¦10äº¿çº§(å–å†³äºå¯¹åº”æ—¥å¿—å¤§å°)<br>æ“ä½œç³»ç»Ÿ: centos</p><h3 id="å‡†å¤‡å·¥ä½œ-åº”ç”¨-ç½‘ç»œ-ç¯å¢ƒ"><a href="#å‡†å¤‡å·¥ä½œ-åº”ç”¨-ç½‘ç»œ-ç¯å¢ƒ" class="headerlink" title="å‡†å¤‡å·¥ä½œ: åº”ç”¨/ç½‘ç»œ ç¯å¢ƒ"></a>å‡†å¤‡å·¥ä½œ: åº”ç”¨/ç½‘ç»œ ç¯å¢ƒ</h3><p>SLBï¼š é˜¿é‡Œäº‘åšè´Ÿè½½å‡è¡¡&amp; æˆ–è€…è‡ªå·±æ­å»ºnginx</p><blockquote><p>ELKæœåŠ¡ç«¯é›†ç¾¤ï¼š</p></blockquote><p>ç³»ç»Ÿcentos 6.7  JDK1.8  ç‰ˆæœ¬ï¼šElasticsearch-2.4.0</p><p>es_01 10.47.88.206<br>es_02 10.47.88.188</p><blockquote><p>KibanaæœåŠ¡ç«¯é›†ç¾¤ï¼š</p></blockquote><p>ç³»ç»Ÿcentos 6.7  JDK1.8  ç‰ˆæœ¬ï¼škibana-4.5.1</p><p>es_01 10.47.88.206<br>es_02 10.47.88.188</p><blockquote><p>KafKaé›†ç¾¤</p></blockquote><p>ç³»ç»Ÿcentos 6.7  JDK1.8  ç‰ˆæœ¬ï¼škafka_2.10-0.9</p><p>kafka_01 10.46.72.172<br>kafka_02 10.47.88.103<br>kafka_03 10.47.102.137</p><blockquote><p>zookeeperé›†ç¾¤</p></blockquote><p>ç³»ç»Ÿcentos 6.7  JDK1.8  ç‰ˆæœ¬ï¼šzookeeper-3.4.6</p><p>kafka_01 10.46.72.172<br>kafka_02 10.47.88.103<br>kafka_03 10.47.102.137</p><blockquote><p>logstash-2.4</p></blockquote><p>å®¢æˆ·ç«¯ï¼šç³»ç»Ÿcentos 6.7  JDK1.8  ç‰ˆæœ¬ï¼š logstash-2.4</p><p>tomcat-account_01: 10.27.232.85</p><p>éƒ½è¦jdk1.8æ”¯æŒã€‚</p><h3 id="æ•´ä½“è¯´æ˜"><a href="#æ•´ä½“è¯´æ˜" class="headerlink" title="æ•´ä½“è¯´æ˜"></a>æ•´ä½“è¯´æ˜</h3><h4 id="æ•°æ®æµå‘-gt-æ—¥å¿—-æ¶ˆæ¯æ•´ä½“æµå‘"><a href="#æ•°æ®æµå‘-gt-æ—¥å¿—-æ¶ˆæ¯æ•´ä½“æµå‘" class="headerlink" title="æ•°æ®æµå‘=&gt;æ—¥å¿—/æ¶ˆæ¯æ•´ä½“æµå‘"></a>æ•°æ®æµå‘=&gt;æ—¥å¿—/æ¶ˆæ¯æ•´ä½“æµå‘</h4><p>logstash =&gt; kafka =&gt; logstash =&gt; elasticsearch =&gt; kibana</p><h3 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h3><h4 id="1-ç¡®è®¤JDKç‰ˆæœ¬åŠå®‰è£…"><a href="#1-ç¡®è®¤JDKç‰ˆæœ¬åŠå®‰è£…" class="headerlink" title="1. ç¡®è®¤JDKç‰ˆæœ¬åŠå®‰è£…"></a>1. ç¡®è®¤JDKç‰ˆæœ¬åŠå®‰è£…</h4><p>esä¾èµ–javaçš„ç‰ˆæœ¬æœ€å°ä¸º1.7</p><p>å¦‚æœç³»ç»Ÿä¸­æœªå®‰è£…JDK<br>åˆ™å‘½ä»¤è¿”å›<code>bash: java: command not found,</code> éœ€è¦å®‰è£…<code>JDK</code></p><p>å¦‚æœç³»ç»Ÿä¸­å®‰è£…äº†JDK, éœ€ç¡®è®¤ç‰ˆæœ¬æ˜¯å¦å¤§äºjava 1.7, å¦åˆ™éœ€è¦å‡çº§</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">java -version</div><div class="line">java version <span class="string">"1.7.0_51"</span> Java(TM) SE Runtime Environment (build 1.7.0_51-b13) Java HotSpot(TM) Server VM (build 24.51-b03, mixed mode)</div><div class="line"></div><div class="line">å®‰è£…åŠå‡çº§java(æ³¨æ„æ ¹æ®ç³»ç»Ÿä¸åŒè¿è¡Œå¯¹åº”å®‰è£…å‘½ä»¤)</div><div class="line"></div><div class="line"><span class="comment"># Redhat/Centos/Fedora</span></div><div class="line">sudo yum install java-1.7.0-openjdk</div><div class="line"></div><div class="line">æˆ–è€…åˆ°å®˜ç½‘, ä¸‹è½½æœ€æ–°çš„jdkçš„rpmåŒ…, ç„¶åå®‰è£…</div><div class="line"></div><div class="line">wget http://download.oracle.com/otn-pub/java/jdk/8u91-b14/jdk-8u91-linux-x64.rpm</div><div class="line">rpm -Uvh jdk-8u91-linux-x64.rpm</div></pre></td></tr></table></figure><p>å†æ¬¡ç¡®è®¤å®‰è£…æˆåŠŸ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">java -version</div></pre></td></tr></table></figure><h4 id="åŸºæœ¬é…ç½®è®¾ç½®FQDNï¼š"><a href="#åŸºæœ¬é…ç½®è®¾ç½®FQDNï¼š" class="headerlink" title="åŸºæœ¬é…ç½®è®¾ç½®FQDNï¼š"></a>åŸºæœ¬é…ç½®è®¾ç½®FQDNï¼š</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#ä¿®æ”¹hostname</span></div><div class="line">cat /etc/hostname</div><div class="line">es_01</div><div class="line"></div><div class="line"><span class="comment">#ä¿®æ”¹hosts</span></div><div class="line">cat /etc/hosts</div><div class="line">127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4</div><div class="line">::1 localhost localhost.localdomain localhost6 localhost6.localdomain6</div><div class="line">10.47.88.206 es.ihaozhuo.com es_01</div><div class="line"></div><div class="line"><span class="comment">#åˆ·æ–°ç¯å¢ƒ</span></div><div class="line">hostname -F /etc/hostname</div><div class="line"></div><div class="line"><span class="comment">#å¤æŸ¥ç»“æœ</span></div><div class="line">hostname <span class="_">-f</span></div><div class="line">es.ihaozhuo.com</div><div class="line"></div><div class="line">hostname</div><div class="line">es_01</div></pre></td></tr></table></figure><h3 id="é˜²ç«å¢™é…ç½®"><a href="#é˜²ç«å¢™é…ç½®" class="headerlink" title="é˜²ç«å¢™é…ç½®"></a>é˜²ç«å¢™é…ç½®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#service iptables stop</span></div><div class="line"><span class="comment">#setenforce 0</span></div><div class="line"></div><div class="line">ä¸è¿‡è¿™é‡Œæˆ‘é˜²ç«å¢™æ˜¯å¼€å¯çš„ï¼ŒåæœŸæ·»åŠ å‡ºå»ç«¯å£å³å¯ã€‚</div><div class="line">æˆ–è€…å¯ä»¥ä¸å…³é—­é˜²ç«å¢™ï¼Œä½†æ˜¯è¦åœ¨iptablesä¸­æ‰“å¼€ç›¸å…³çš„ç«¯å£ï¼š</div><div class="line"></div><div class="line"><span class="comment"># vim /etc/sysconfig/iptables</span></div><div class="line">-A INPUT -m state --state NEW -m tcp -p tcp --dport 80 -j ACCEPT</div><div class="line">-A INPUT -m state --state NEW -m tcp -p tcp --dport 9200 -j ACCEPT</div><div class="line">-A INPUT -m state --state NEW -m tcp -p tcp --dport 9292 -j ACCEPT</div><div class="line"><span class="comment"># service iptables restart</span></div></pre></td></tr></table></figure><h4 id="RPMå¿«é€Ÿå®‰è£…"><a href="#RPMå¿«é€Ÿå®‰è£…" class="headerlink" title="RPMå¿«é€Ÿå®‰è£…"></a>RPMå¿«é€Ÿå®‰è£…</h4><p>elkæ‰€æœ‰å®‰è£…éƒ½å¯ä»¥ä½¿ç”¨rpmäºŒè¿›åˆ¶åŒ…çš„æ–¹å¼,å¢åŠ <code>elasticå®˜ç½‘</code>çš„ä»“åº“repoå°±å¯ä»¥ç”¨yumå®‰è£…äº†</p><p>elasticsearchçœ‹è¿™é‡Œ â€”â€“ <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/setup-repositories.html" target="_blank" rel="external">elasticsearch-rpmå®˜æ–¹æ–‡æ¡£</a></p><p>logstashçœ‹è¿™é‡Œ â€”-<a href="https://www.elastic.co/guide/en/logstash/current/installing-logstash.html" target="_blank" rel="external">logstash-rpmå®˜ç½‘æ–‡æ¡£</a></p><p>kibanaçœ‹è¿™é‡Œ â€”<a href="https://www.elastic.co/guide/en/kibana/current/setup.html" target="_blank" rel="external">kibana-rpmå®˜ç½‘æ–‡æ¡£</a></p><h3 id="es-01æœåŠ¡ç«¯æºç å®‰è£…"><a href="#es-01æœåŠ¡ç«¯æºç å®‰è£…" class="headerlink" title="es_01æœåŠ¡ç«¯æºç å®‰è£…"></a>es_01æœåŠ¡ç«¯æºç å®‰è£…</h3><p>è¿™é‡Œæˆ‘æ˜¯æºç å®‰è£…çš„<br>ä¸‹è½½ElasticSearch ElasticSearché»˜è®¤çš„å¯¹å¤–æœåŠ¡çš„HTTPç«¯å£æ˜¯9200ï¼ŒèŠ‚ç‚¹é—´äº¤äº’çš„TCPç«¯å£æ˜¯9300ã€‚</p><p>ä¸‹è½½åœ°å€ï¼š<a href="https://www.elastic.co/downloads/elasticsearch" target="_blank" rel="external">Elasticsearch</a></p><p>2.4ç‰ˆæœ¬ï¼š<br><a href="https://www.elastic.co/downloads/past-releases/elasticsearch-2-4-3" target="_blank" rel="external">Elasticsearch2.4.3</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">è§£å‹æºç åŒ…ï¼š</div><div class="line">[root@es_01 ~]<span class="comment"># tar -zxvf elasticsearch-2.4.3.tar.gz -C /usr/local/</span></div><div class="line">ç„¶åç»™ç›®å½•åšä¸ªè½¯é“¾æ¥ï¼š</div><div class="line">[root@es_01 <span class="built_in">local</span>]<span class="comment"># ln -s  /usr/local/elasticsearch-2.4.3/ /usr/local/elasticsearch</span></div><div class="line"></div><div class="line">è¿™é‡Œéœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š</div><div class="line">é…ç½®å‰å…ˆåˆ›å»ºå‡ ä¸ªç›®å½•æ–‡ä»¶</div><div class="line">æ–°å»ºç›®å½•, å‡è®¾/data/ç›®å½•æŒ‚è½½çš„ç¡¬ç›˜æœ€å¤§(500Gä»¥ä¸Š)</div><div class="line">[root@es_01 srv]]<span class="comment"># mkdir /srv/data/es-data -p</span></div><div class="line">[root@es_01 srv]<span class="comment"># mkdir /srv/data/es-work </span></div><div class="line"></div><div class="line">[root@es_01 <span class="built_in">local</span>]<span class="comment"># mkdir /usr/local/elasticsearch/logs</span></div><div class="line">[root@es_01 <span class="built_in">local</span>]<span class="comment"># mkdir /usr/local/elasticsearch/config/plugins</span></div><div class="line"></div><div class="line">æ–°å»ºç”¨æˆ·</div><div class="line">ä¿®æ”¹æºç ç›®å½•å±æ€§å±ç»„ï¼š</div><div class="line">[root@es_01 elasticsearch]<span class="comment"># useradd  -s /sbin/nologin elasticsearch</span></div><div class="line">[root@es_01 elasticsearch]<span class="comment"># chown -R elasticsearch:elasticsearch /usr/local/elasticsearch</span></div><div class="line">[root@es_01 elasticsearch]<span class="comment"># chown -R elasticsearch:elasticsearch /srv/data/</span></div><div class="line"></div><div class="line"></div><div class="line">åˆ‡æ¢ç”¨æˆ·</div><div class="line">åˆ‡æ¢åˆ°elasticsearchç”¨æˆ·, å¹¶è¿›å…¥elasticsearchç›®å½•</div><div class="line"></div><div class="line">su elasticsearch</div><div class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/elasticsearch/</div></pre></td></tr></table></figure><h3 id="é…ç½®Elasticsearchï¼š"><a href="#é…ç½®Elasticsearchï¼š" class="headerlink" title="é…ç½®Elasticsearchï¼š"></a>é…ç½®Elasticsearchï¼š</h3><p>ä»¥ç”¨æˆ·esçš„èº«ä»½è¿›è¡Œæ“ä½œ</p><p>æ–‡ä»¶è·¯å¾„: <code>config/elasticsearch.yml</code><br>ä¿®æ”¹è¯¥æ–‡ä»¶ä¸­é…ç½®é¡¹: (æ³¨æ„, åŸå§‹æ–‡ä»¶ä¸­éƒ½æ˜¯è¢«#å·æ³¨é‡Šæ‰äº†, éœ€è¦å»æ‰å¯¹åº”æ³¨é‡Šå¹¶ä¿®æ”¹é…ç½®å€¼)</p><ul><li>é›†ç¾¤å: cluster.name, æ³¨æ„: ä¸¤å°æœºå™¨é…ç½®ä¸€è‡´</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cluster.name: elk_cluster</div></pre></td></tr></table></figure><ul><li>èŠ‚ç‚¹å: node.name, æ³¨æ„: ä¸¤å°æœºå™¨é…ç½®ä¸åŒ, ä¸€å°ä¸º01, å¦ä¸€å°ä¸º02</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"> <span class="comment"># ç¬¬ä¸€å°æœºå™¨</span></div><div class="line"> </div><div class="line">node.name: inner_es_node_01</div><div class="line"></div><div class="line"><span class="comment"># ç¬¬äºŒå°æœºå™¨</span></div><div class="line">node.name: inner_es_node_02</div></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">[root@es_01 config]<span class="comment"># vim elasticsearch.yml</span></div><div class="line"></div><div class="line"><span class="comment"># Use a descriptive name for your cluster:</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#</span></div><div class="line">cluster.name: elk_cluster</div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># ------------------------------------ Node ------------------------------------</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Use a descriptive name for the node:</span></div><div class="line"><span class="comment">#</span></div><div class="line">node.name: es_01</div><div class="line"></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Add custom attributes to the node:</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># node.rack: r1</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># ----------------------------------- Paths ------------------------------------</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Path to directory where to store the data (separate multiple locations by comma):</span></div><div class="line"><span class="comment">#</span></div><div class="line">path.data: /srv/data/es-data</div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Path to log files:</span></div><div class="line"><span class="comment">#</span></div><div class="line">path.logs: /usr/<span class="built_in">local</span>/elasticsearch/logs</div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># ----------------------------------- Memory -----------------------------------</span></div><div class="line"><span class="comment">#</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># Lock the memory on startup:</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># bootstrap.memory_lock: true</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Make sure that the `ES_HEAP_SIZE` environment variable is set to about half the memory</span></div><div class="line"><span class="comment"># available on the system and that the owner of the process is allowed to use this limit.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Elasticsearch performs poorly when the system is swapping the memory.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># ---------------------------------- Network -----------------------------------</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Set the bind address to a specific IP (IPv4 or IPv6):</span></div><div class="line"><span class="comment">#</span></div><div class="line">network.host: 10.47.88.206</div></pre></td></tr></table></figure><p>åˆ‡æ¢åˆ°elasticsearchç”¨æˆ·å¯åŠ¨æœåŠ¡ã€‚</p><p>æºç å®‰è£…å¯åŠ¨éœ€è¦æ‰§è¡Œ ï¼š<code>/usr/local/elasticsearch/bin/elasticsearch &amp;</code><br>æ‰èƒ½å¯åŠ¨ï¼›</p><h3 id="æµ‹è¯•è®¿é—®æœåŠ¡æ­£å¸¸ï¼š"><a href="#æµ‹è¯•è®¿é—®æœåŠ¡æ­£å¸¸ï¼š" class="headerlink" title="æµ‹è¯•è®¿é—®æœåŠ¡æ­£å¸¸ï¼š"></a>æµ‹è¯•è®¿é—®æœåŠ¡æ­£å¸¸ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[elasticsearch@es_01 elasticsearch]$  curl http://10.47.88.206:9200</div><div class="line">&#123;</div><div class="line">  <span class="string">"name"</span> : <span class="string">"es_01"</span>,</div><div class="line">  <span class="string">"cluster_name"</span> : <span class="string">"elk_cluster"</span>,</div><div class="line">  <span class="string">"cluster_uuid"</span> : <span class="string">"mspLZT5nTL-d124suNbBBQ"</span>,</div><div class="line">  <span class="string">"version"</span> : &#123;</div><div class="line">    <span class="string">"number"</span> : <span class="string">"2.4.3"</span>,</div><div class="line">    <span class="string">"build_hash"</span> : <span class="string">"d38a34e7b75af4e17ead16f156feffa432b22be3"</span>,</div><div class="line">    <span class="string">"build_timestamp"</span> : <span class="string">"2016-12-07T16:28:56Z"</span>,</div><div class="line">    <span class="string">"build_snapshot"</span> : <span class="literal">false</span>,</div><div class="line">    <span class="string">"lucene_version"</span> : <span class="string">"5.5.2"</span></div><div class="line">  &#125;,</div><div class="line">  <span class="string">"tagline"</span> : <span class="string">"You Know, for Search"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯å†™å¼€æœºå¯åŠ¨è„šæœ¬ï¼Œä¸å†™çš„ç›´æ¥åˆ‡æ¢esç”¨æˆ·åˆ°ç›®å½•å¯åŠ¨ -dåå°å¯åŠ¨ã€‚<br>è¿™é‡Œéœ€è¦/etc/init.d/åˆ›å»ºå¯åŠ¨è„šæœ¬ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">[root@ELK ~]<span class="comment"># git clone https://github.com/elastic/elasticsearch-servicewrapper.git</span></div><div class="line">Initialized empty Git repository <span class="keyword">in</span> /root/elasticsearch-servicewrapper/.git/</div><div class="line">remote: Counting objects: 184, done.</div><div class="line">remote: Total 184 (delta 0), reused 0 (delta 0), pack-reused 184</div><div class="line">Receiving objects: 100% (184/184), 4.55 MiB | 511 KiB/s, done.</div><div class="line">Resolving deltas: 100% (53/53), done.</div><div class="line">[root@ELK elasticsearch-servicewrapper]<span class="comment"># mv service/ /usr/local/elasticsearch/bin/</span></div><div class="line">[root@ELK elasticsearch-servicewrapper]<span class="comment"># cd /usr/local/elasticsearch</span></div><div class="line">[root@ELK elasticsearch]<span class="comment"># /usr/local/elasticsearch/bin/service/elasticsearch install    è¿™é‡Œæ˜¯å®‰è£…es</span></div><div class="line">Detected RHEL or Fedora:</div><div class="line">Installing the Elasticsearch daemon..</div><div class="line">[root@ELK elasticsearch]<span class="comment"># vim /etc/init.d/elasticsearch   æŸ¥çœ‹å®‰è£…eså¯åŠ¨é…ç½®æ–‡ä»¶</span></div><div class="line">[root@ELK elasticsearch]<span class="comment"># service elastic search start  å¯åŠ¨es </span></div><div class="line">Starting Elasticsearch...</div><div class="line">Waiting <span class="keyword">for</span> Elasticsearch......</div><div class="line">running: PID:31360   æœåŠ¡å·²å¯åŠ¨äº†ã€‚</div><div class="line"></div><div class="line">å¯åŠ¨ç›¸å…³æœåŠ¡</div><div class="line">service elasticsearch start</div><div class="line">service elasticsearch status</div><div class="line"></div><div class="line">é…ç½® elasticsearch æœåŠ¡éšç³»ç»Ÿè‡ªåŠ¨å¯åŠ¨</div><div class="line"><span class="comment"># chkconfig --add elasticsearch</span></div><div class="line"></div><div class="line">æµ‹è¯•ElasticSearchæœåŠ¡æ˜¯å¦æ­£å¸¸ï¼Œé¢„æœŸè¿”å›200çš„çŠ¶æ€ç </div><div class="line"><span class="comment"># curl -X GET http://localhost:9200</span></div></pre></td></tr></table></figure><h3 id="es-02æœåŠ¡ç«¯èŠ‚ç‚¹ï¼š"><a href="#es-02æœåŠ¡ç«¯èŠ‚ç‚¹ï¼š" class="headerlink" title="es_02æœåŠ¡ç«¯èŠ‚ç‚¹ï¼š"></a>es_02æœåŠ¡ç«¯èŠ‚ç‚¹ï¼š</h3><p>ç¬¬ä¸€æ­¥åŸºç¡€é…ç½®éƒ½æ˜¯ä¸€æ ·çš„ï¼Œè·Ÿes_01èŠ‚ç‚¹ä¸€æ ·ã€‚  å…¶ä»–åªéœ€è¦åˆ°es_01æ‹·è´è¿‡æ¥,ç„¶ååˆ›å»ºä¸‹esç”¨æˆ·ï¼Œä¿®æ”¹ä¸‹é…ç½®ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">/usr/<span class="built_in">local</span>/elasticsearch  ç›®å½•æ‹·è´åˆ°es_02æœºå™¨ã€‚</div><div class="line">è¿™é‡Œéœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š</div><div class="line">é…ç½®å‰å…ˆåˆ›å»ºå‡ ä¸ªç›®å½•æ–‡ä»¶</div><div class="line">[root@es_01 srv]]<span class="comment"># mkdir /srv/data/es-data -p</span></div><div class="line">[root@es_01 srv]<span class="comment"># mkdir /srv/data/es-work </span></div><div class="line">ä¿®æ”¹æºç ç›®å½•å±æ€§å±ç»„ï¼š</div><div class="line">[root@es_01 elasticsearch]<span class="comment"># useradd  -s /sbin/nologin elasticsearch</span></div><div class="line">[root@es_01 elasticsearch]<span class="comment"># chown -R elasticsearch:elasticsearch /usr/local/elasticsearch/*</span></div><div class="line">[root@es_01 elasticsearch]<span class="comment"># chown -R elasticsearch:elasticsearch /srv/data/</span></div><div class="line"></div><div class="line">ä¿®æ”¹é…ç½®æ–‡ä»¶</div><div class="line">vim elasticsearch.yml</div><div class="line">node.name: es_02</div><div class="line">network.host: 10.47.88.188</div><div class="line"></div><div class="line">å…¶ä»–ä¸éœ€è¦ä¿®æ”¹</div></pre></td></tr></table></figure><h3 id="é›†ç¾¤èŠ‚ç‚¹es-02æµ‹è¯•ï¼š"><a href="#é›†ç¾¤èŠ‚ç‚¹es-02æµ‹è¯•ï¼š" class="headerlink" title="é›†ç¾¤èŠ‚ç‚¹es_02æµ‹è¯•ï¼š"></a>é›†ç¾¤èŠ‚ç‚¹es_02æµ‹è¯•ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[root@es_02 home]<span class="comment"># curl http://10.47.88.188:9200</span></div><div class="line">&#123;</div><div class="line">  <span class="string">"name"</span> : <span class="string">"es_02"</span>,</div><div class="line">  <span class="string">"cluster_name"</span> : <span class="string">"elk_cluster"</span>,</div><div class="line">  <span class="string">"cluster_uuid"</span> : <span class="string">"-4Rqn4IzS1GfnsodqZD8Tg"</span>,</div><div class="line">  <span class="string">"version"</span> : &#123;</div><div class="line">    <span class="string">"number"</span> : <span class="string">"2.4.3"</span>,</div><div class="line">    <span class="string">"build_hash"</span> : <span class="string">"d38a34e7b75af4e17ead16f156feffa432b22be3"</span>,</div><div class="line">    <span class="string">"build_timestamp"</span> : <span class="string">"2016-12-07T16:28:56Z"</span>,</div><div class="line">    <span class="string">"build_snapshot"</span> : <span class="literal">false</span>,</div><div class="line">    <span class="string">"lucene_version"</span> : <span class="string">"5.5.2"</span></div><div class="line">  &#125;,</div><div class="line">  <span class="string">"tagline"</span> : <span class="string">"You Know, for Search"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure><p>elké›†ç¾¤å·²å®‰è£…é…ç½®å®Œæ¯•ï¼Œæˆ‘è¿™é‡Œé…ç½®äº†nginxåšä¸‹åå‘ä»£ç†ï¼Œèµ°80ç«¯å£å‡ºå»ã€‚ç„¶ååœ¨nginxè®¾ç½®ä¸‹å†…éƒ¨å…¬å¸è®¿é—®ä¸å¯¹å¤–å¼€æ”¾ã€‚</p><h3 id="å®‰è£…-headã€marvelã€bigdeskæ’ä»¶"><a href="#å®‰è£…-headã€marvelã€bigdeskæ’ä»¶" class="headerlink" title="å®‰è£… headã€marvelã€bigdeskæ’ä»¶:"></a>å®‰è£… headã€marvelã€bigdeskæ’ä»¶:</h3><p>es1.5æ’ä»¶å®‰è£…æ˜¯<code>./plugin -install xxx</code>,è€Œes2.4æ’ä»¶å®‰è£…æ²¡æœ‰å‡å·<code>./plugin install xxx</code></p><p>1.5ç‰ˆæœ¬æ–¹æ³•ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">* headæ’ä»¶</div><div class="line"></div><div class="line">æ’ä»¶å®‰è£…æ–¹æ³•1ï¼š</div><div class="line">/usr/<span class="built_in">local</span>/elasticsearch/bin/plugin -install mobz/elasticsearch-head</div><div class="line">é‡å¯es å³å¯ã€‚</div><div class="line">æ‰“å¼€http://localhost:9200/_plugin/head/</div><div class="line"></div><div class="line">æ’ä»¶å®‰è£…æ–¹æ³•2ï¼š</div><div class="line">1.https://github.com/mobz/elasticsearch-headä¸‹è½½zip è§£å‹</div><div class="line">2.å»ºç«‹/usr/<span class="built_in">local</span>/elasticsearch/plugins/head/æ–‡ä»¶</div><div class="line">3.å°†è§£å‹åçš„elasticsearch-head-masteræ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶copyåˆ°/usr/<span class="built_in">local</span>/elasticsearch/plugins/head/</div><div class="line">é‡å¯es å³å¯ã€‚</div><div class="line"></div><div class="line">æ‰“å¼€http://localhost:9200/_plugin/head/</div></pre></td></tr></table></figure><p>2.4ç‰ˆæœ¬ä»¥ä¸Šå®‰è£…ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">* headæ’ä»¶</div><div class="line"></div><div class="line">æ’ä»¶å®‰è£…æ–¹æ³•1ï¼š</div><div class="line">/usr/<span class="built_in">local</span>/elasticsearch/bin/plugin install mobz/elasticsearch-head</div><div class="line">é‡å¯es å³å¯ã€‚</div><div class="line">æ‰“å¼€http://localhost:9200/_plugin/head/</div><div class="line"></div><div class="line">æ’ä»¶å®‰è£…æ–¹æ³•2ï¼š</div><div class="line">1.https://github.com/mobz/elasticsearch-headä¸‹è½½zip è§£å‹</div><div class="line">2.å»ºç«‹elasticsearch-1.0.0\plugins\head\_siteæ–‡ä»¶</div><div class="line">3.å°†è§£å‹åçš„elasticsearch-head-masteræ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶copyåˆ°_site</div><div class="line">é‡å¯es å³å¯ã€‚</div><div class="line"></div><div class="line">æ‰“å¼€http://localhost:9200/_plugin/head/</div></pre></td></tr></table></figure><p>ä¸ºäº†ä¿éšœæœç´¢æœåŠ¡çš„ç¨³å®šæ€§ï¼Œå¢åŠ äº†ä¸€å°æœºå™¨ï¼Œå°†Elasticsearchéƒ¨ç½²æˆäº†é›†ç¾¤æ¨¡å¼ï¼Œ éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒæ—¶å‘ç°ï¼Œæ–°çš„èŠ‚ç‚¹å¹¶ä¸èƒ½è¢«å‘ç°ï¼Œåå°å‘ç°é˜¿é‡Œäº‘å¹¶ä¸æ”¯æŒå¤šæ’­ï¼Œæœ€ååªèƒ½æ”¹ä¸ºå•æ’­çš„æ–¹å¼é…ç½®äº†ï¼Œå¥½åœ¨ä¹‹åä¸€åˆ‡é¡ºåˆ©ã€‚</p><p>ä¸‹é¢é™„ä¸Šæµ‹è¯•ç¯å¢ƒé…ç½®ç¤ºä¾‹ï¼šæ·»åŠ ä¸‹ä¸‹é¢ç›‘å¬é›†ç¾¤IPå’Œç«¯å£ã€‚</p><ul><li>es_01</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@es_01 config]<span class="comment"># vim elasticsearch.yml</span></div><div class="line"></div><div class="line">discovery.zen.ping.multicast.enabled: <span class="literal">false</span></div><div class="line">discovery.zen.ping.unicast.hosts: [<span class="string">"10.47.88.206:9300"</span>,<span class="string">"10.47.88.188:9300"</span>]</div></pre></td></tr></table></figure><ul><li>es_02</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@es_02 config]<span class="comment"># vim elasticsearch.yml</span></div><div class="line"></div><div class="line">discovery.zen.ping.multicast.enabled: <span class="literal">false</span></div><div class="line">discovery.zen.ping.unicast.hosts: [<span class="string">"10.47.88.206:9300"</span>,<span class="string">"10.47.88.188:9300"</span>]</div></pre></td></tr></table></figure><p>ç„¶åé‡å¯æœåŠ¡ï¼ŒæŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹ã€‚</p><h3 id="es-02å®‰è£…Kibana"><a href="#es-02å®‰è£…Kibana" class="headerlink" title="es_02å®‰è£…Kibana:"></a>es_02å®‰è£…Kibana:</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div></pre></td><td class="code"><pre><div class="line">åˆ°https://www.elastic.co/downloads/kibana  æ‰¾åˆé€‚çš„ç‰ˆæœ¬ã€‚</div><div class="line"></div><div class="line">wget https://download.elastic.co/kibana/kibana/kibana-4.5.1-linux-x64.tar.gz</div><div class="line"></div><div class="line"><span class="comment">#è§£å‹</span></div><div class="line"></div><div class="line">ï¼ƒtar zxvf kibana-4.1.2-linux-x64.tar.gz -C /usr/<span class="built_in">local</span> </div><div class="line">ï¼ƒ<span class="built_in">cd</span>  /usr/<span class="built_in">local</span>/ &amp;&amp; mv kibana-4.1.2-linux-x64 kibana</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#åˆ›å»ºkibanaå¯åŠ¨è„šæœ¬æœåŠ¡</span></div><div class="line">vi /etc/rc.d/init.d/kibana</div><div class="line"></div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment">### BEGIN INIT INFO</span></div><div class="line"><span class="comment"># Provides:          kibana</span></div><div class="line"><span class="comment"># Default-Start:     2 3 4 5</span></div><div class="line"><span class="comment"># Default-Stop:      0 1 6</span></div><div class="line"><span class="comment"># Short-Description: Runs kibana daemon</span></div><div class="line"><span class="comment"># Description: Runs the kibana daemon as a non-root user</span></div><div class="line"><span class="comment">### END INIT INFO</span></div><div class="line"></div><div class="line"><span class="comment"># Process name</span></div><div class="line">NAME=kibana</div><div class="line">DESC=<span class="string">"Kibana4"</span></div><div class="line">PROG=<span class="string">"/etc/init.d/kibana"</span></div><div class="line"></div><div class="line"><span class="comment"># Configure location of Kibana bin</span></div><div class="line">KIBANA_BIN=/usr/<span class="built_in">local</span>/kibana/bin</div><div class="line"></div><div class="line"><span class="comment"># PID Info</span></div><div class="line">PID_FOLDER=/var/run/kibana/</div><div class="line">PID_FILE=/var/run/kibana/<span class="variable">$NAME</span>.pid</div><div class="line">LOCK_FILE=/var/lock/subsys/<span class="variable">$NAME</span></div><div class="line">PATH=/bin:/usr/bin:/sbin:/usr/sbin:<span class="variable">$KIBANA_BIN</span></div><div class="line">DAEMON=<span class="variable">$KIBANA_BIN</span>/<span class="variable">$NAME</span></div><div class="line"></div><div class="line"><span class="comment"># Configure User to run daemon process</span></div><div class="line">DAEMON_USER=root</div><div class="line"><span class="comment"># Configure logging location</span></div><div class="line">KIBANA_LOG=/var/<span class="built_in">log</span>/kibana.log</div><div class="line"></div><div class="line"><span class="comment"># Begin Script</span></div><div class="line">RETVAL=0</div><div class="line"></div><div class="line"><span class="keyword">if</span> [ `id -u` <span class="_">-ne</span> 0 ]; <span class="keyword">then</span></div><div class="line">        <span class="built_in">echo</span> <span class="string">"You need root privileges to run this script"</span></div><div class="line">        <span class="built_in">exit</span> 1</div><div class="line"><span class="keyword">fi</span></div><div class="line"></div><div class="line"><span class="comment"># Function library</span></div><div class="line">. /etc/init.d/<span class="built_in">functions</span></div><div class="line"> </div><div class="line"><span class="function"><span class="title">start</span></span>() &#123;</div><div class="line">        <span class="built_in">echo</span> -n <span class="string">"Starting <span class="variable">$DESC</span> : "</span></div><div class="line"></div><div class="line">pid=`pidofproc -p <span class="variable">$PID_FILE</span> kibana`</div><div class="line">        <span class="keyword">if</span> [ -n <span class="string">"<span class="variable">$pid</span>"</span> ] ; <span class="keyword">then</span></div><div class="line">                <span class="built_in">echo</span> <span class="string">"Already running."</span></div><div class="line">                <span class="built_in">exit</span> 0</div><div class="line">        <span class="keyword">else</span></div><div class="line">        <span class="comment"># Start Daemon</span></div><div class="line"><span class="keyword">if</span> [ ! <span class="_">-d</span> <span class="string">"<span class="variable">$PID_FOLDER</span>"</span> ] ; <span class="keyword">then</span></div><div class="line">                        mkdir <span class="variable">$PID_FOLDER</span></div><div class="line">                <span class="keyword">fi</span></div><div class="line">daemon --user=<span class="variable">$DAEMON_USER</span> --pidfile=<span class="variable">$PID_FILE</span> <span class="variable">$DAEMON</span> 1&gt;<span class="string">"<span class="variable">$KIBANA_LOG</span>"</span> 2&gt;&amp;1 &amp;</div><div class="line">                sleep 2</div><div class="line">                pidofproc node &gt; <span class="variable">$PID_FILE</span></div><div class="line">                RETVAL=$?</div><div class="line">                [[ $? <span class="_">-eq</span> 0 ]] &amp;&amp; success || failure</div><div class="line"><span class="built_in">echo</span></div><div class="line">                [ <span class="variable">$RETVAL</span> = 0 ] &amp;&amp; touch <span class="variable">$LOCK_FILE</span></div><div class="line">                <span class="built_in">return</span> <span class="variable">$RETVAL</span></div><div class="line">        <span class="keyword">fi</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="title">reload</span></span>()</div><div class="line">&#123;</div><div class="line">    <span class="built_in">echo</span> <span class="string">"Reload command is not implemented for this service."</span></div><div class="line">    <span class="built_in">return</span> <span class="variable">$RETVAL</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="title">stop</span></span>() &#123;</div><div class="line">        <span class="built_in">echo</span> -n <span class="string">"Stopping <span class="variable">$DESC</span> : "</span></div><div class="line">        killproc -p <span class="variable">$PID_FILE</span> <span class="variable">$DAEMON</span></div><div class="line">        RETVAL=$?</div><div class="line"><span class="built_in">echo</span></div><div class="line">        [ <span class="variable">$RETVAL</span> = 0 ] &amp;&amp; rm <span class="_">-f</span> <span class="variable">$PID_FILE</span> <span class="variable">$LOCK_FILE</span></div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$1</span>"</span> <span class="keyword">in</span></div><div class="line">  start)</div><div class="line">        start</div><div class="line">;;</div><div class="line">  stop)</div><div class="line">        stop</div><div class="line">        ;;</div><div class="line">  status)</div><div class="line">        status -p <span class="variable">$PID_FILE</span> <span class="variable">$DAEMON</span></div><div class="line">        RETVAL=$?</div><div class="line">        ;;</div><div class="line">  restart)</div><div class="line">        stop</div><div class="line">        start</div><div class="line">        ;;</div><div class="line">  reload)</div><div class="line">reload</div><div class="line">;;</div><div class="line">  *)</div><div class="line"><span class="comment"># Invalid Arguments, print the following message.</span></div><div class="line">        <span class="built_in">echo</span> <span class="string">"Usage: <span class="variable">$0</span> &#123;start|stop|status|restart&#125;"</span> &gt;&amp;2</div><div class="line"><span class="built_in">exit</span> 2</div><div class="line">        ;;</div><div class="line"><span class="keyword">esac</span></div><div class="line"></div><div class="line"></div><div class="line">ä¿®æ”¹å¯åŠ¨æƒé™</div><div class="line">chmod +x /etc/rc.d/init.d/kibana</div></pre></td></tr></table></figure><p>é…ç½®Kibanaï¼š</p><h3 id="ç¼–è¾‘kibana-yaml-ä¿®æ”¹ç«¯å£ï¼Œè®¾ç½®host-å¯ä»¥è®¾ç½®æœ¬åœ°æœåŠ¡å™¨IP"><a href="#ç¼–è¾‘kibana-yaml-ä¿®æ”¹ç«¯å£ï¼Œè®¾ç½®host-å¯ä»¥è®¾ç½®æœ¬åœ°æœåŠ¡å™¨IP" class="headerlink" title="ç¼–è¾‘kibana.yaml  ä¿®æ”¹ç«¯å£ï¼Œè®¾ç½®host å¯ä»¥è®¾ç½®æœ¬åœ°æœåŠ¡å™¨IP"></a>ç¼–è¾‘kibana.yaml  ä¿®æ”¹ç«¯å£ï¼Œè®¾ç½®host å¯ä»¥è®¾ç½®æœ¬åœ°æœåŠ¡å™¨IP</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line">vim /usr/<span class="built_in">local</span>/kibana/config/kibana.yml</div><div class="line"></div><div class="line"><span class="comment"># Kibana is served by a back end server. This controls which port to use.</span></div><div class="line">server.port: 5601</div><div class="line"></div><div class="line"><span class="comment"># The host to bind the server to.</span></div><div class="line">server.host: <span class="string">"10.47.88.188"</span></div><div class="line"></div><div class="line"><span class="comment"># If you are running kibana behind a proxy, and want to mount it at a path,</span></div><div class="line"><span class="comment"># specify that path here. The basePath can't end in a slash.</span></div><div class="line"><span class="comment"># server.basePath: ""</span></div><div class="line"></div><div class="line"><span class="comment"># The maximum payload size in bytes on incoming server requests.</span></div><div class="line"><span class="comment"># server.maxPayloadBytes: 1048576</span></div><div class="line"></div><div class="line"><span class="comment"># The Elasticsearch instance to use for all your queries.</span></div><div class="line">elasticsearch.url: <span class="string">"http://10.47.88.188:9200"</span></div><div class="line"></div><div class="line"><span class="comment"># preserve_elasticsearch_host true will send the hostname specified in `elasticsearch`. If you set it to false,</span></div><div class="line"><span class="comment"># then the host you use to connect to *this* Kibana instance will be sent.</span></div><div class="line"></div><div class="line">elasticsearch.preserveHost: <span class="literal">true</span></div><div class="line"></div><div class="line"><span class="comment"># Kibana uses an index in Elasticsearch to store saved searches, visualizations</span></div><div class="line"><span class="comment"># and dashboards. It will create a new index if it doesn't already exist.</span></div><div class="line"><span class="comment"># kibana.index: ".kibana"</span></div><div class="line"></div><div class="line"><span class="comment"># The default application to load.</span></div><div class="line">kibana.defaultAppId: <span class="string">"discover"</span></div><div class="line"></div><div class="line"><span class="comment"># If your Elasticsearch is protected with basic auth, these are the user credentials</span></div><div class="line"><span class="comment"># used by the Kibana server to perform maintenance on the kibana_index at startup. Your Kibana</span></div><div class="line"><span class="comment"># users will still need to authenticate with Elasticsearch (which is proxied through</span></div><div class="line"><span class="comment"># the Kibana server)</span></div><div class="line"></div><div class="line"><span class="comment"># elasticsearch.ssl.key: /path/to/your/client.key</span></div><div class="line"></div><div class="line"><span class="comment"># If you need to provide a CA certificate for your Elasticsearch instance, put</span></div><div class="line"><span class="comment"># the path of the pem file here.</span></div><div class="line"><span class="comment"># elasticsearch.ssl.ca: /path/to/your/CA.pem</span></div><div class="line"></div><div class="line"><span class="comment"># Set to false to have a complete disregard for the validity of the SSL</span></div><div class="line"><span class="comment"># certificate.</span></div><div class="line"><span class="comment"># elasticsearch.ssl.verify: true</span></div><div class="line"></div><div class="line"><span class="comment"># Time in milliseconds to wait for elasticsearch to respond to pings, defaults to</span></div><div class="line"><span class="comment"># request_timeout setting</span></div><div class="line"><span class="comment"># elasticsearch.pingTimeout: 1500</span></div><div class="line"></div><div class="line"><span class="comment"># Time in milliseconds to wait for responses from the back end or elasticsearch.</span></div><div class="line"><span class="comment"># This must be &gt; 0</span></div><div class="line"></div><div class="line">elasticsearch.requestTimeout: 30000</div><div class="line"></div><div class="line"><span class="comment"># Time in milliseconds for Elasticsearch to wait for responses from shards.</span></div><div class="line"><span class="comment"># Set to 0 to disable.</span></div><div class="line"><span class="comment"># elasticsearch.shardTimeout: 0</span></div></pre></td></tr></table></figure><h3 id="å¯åŠ¨kibanaæœåŠ¡"><a href="#å¯åŠ¨kibanaæœåŠ¡" class="headerlink" title="å¯åŠ¨kibanaæœåŠ¡"></a>å¯åŠ¨kibanaæœåŠ¡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">service kibana start</div><div class="line">service kibana status</div></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹ç«¯å£"><a href="#æŸ¥çœ‹ç«¯å£" class="headerlink" title="æŸ¥çœ‹ç«¯å£"></a>æŸ¥çœ‹ç«¯å£</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">netstat -nltp</div><div class="line">[root@es_02 config]<span class="comment"># netstat -nltp</span></div><div class="line">Active Internet connections (only servers)</div><div class="line">Proto Recv-Q Send-Q Local Address               Foreign Address             State       PID/Program name</div><div class="line">tcp        0      0 127.0.0.1:32000             0.0.0.0:*                   LISTEN      2517/java</div><div class="line">tcp        0      0 10.47.88.188:5601           0.0.0.0:*                   LISTEN      6474/node</div><div class="line">tcp        0      0 10.47.88.188:10050          0.0.0.0:*                   LISTEN      305/zabbix_agentd</div><div class="line">tcp        0      0 10.47.88.188:9200           0.0.0.0:*                   LISTEN      5198/java</div><div class="line">tcp        0      0 10.47.88.188:9300           0.0.0.0:*                   LISTEN      5198/java</div><div class="line">tcp        0      0 0.0.0.0:22                  0.0.0.0:*                   LISTEN      25265/sshd</div></pre></td></tr></table></figure><p>åˆ°æˆ‘Githubä¸Šé¢ä¸‹è½½kabanaå¯åŠ¨è„šæœ¬ã€‚</p><p>es_01æœºå™¨ä»es_02æœºå™¨æ‹·è´è¿‡å»ä¿®æ”¹ä¸‹é…ç½®å°±å¯ä»¥ã€‚ </p><h3 id="kibanaå®‰è£…æ’ä»¶å‚è€ƒï¼š"><a href="#kibanaå®‰è£…æ’ä»¶å‚è€ƒï¼š" class="headerlink" title="kibanaå®‰è£…æ’ä»¶å‚è€ƒï¼š"></a>kibanaå®‰è£…æ’ä»¶å‚è€ƒï¼š</h3><p><a href="https://www.elastic.co/guide/en/marvel/current/installing-marvel.html#installing-marvel" target="_blank" rel="external">Installing Marvel</a></p><p>è¿™é‡Œkibanaæˆ‘åšäº†nginxåå‘ä»£ç†ï¼Œé›†ç¾¤ä»£ç†ã€‚</p><h3 id="nginxé…ç½®kibanaåå‘ä»£ç†ï¼š"><a href="#nginxé…ç½®kibanaåå‘ä»£ç†ï¼š" class="headerlink" title="nginxé…ç½®kibanaåå‘ä»£ç†ï¼š"></a>nginxé…ç½®kibanaåå‘ä»£ç†ï¼š</h3><p>è¿™é‡Œæˆ‘åªå…è®¸æˆ‘å…¬å¸IPè®¿é—®ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">  upstream kibana.ihaozhuo.com &#123;</div><div class="line">        server 10.47.88.206:5601 weight=1;</div><div class="line">        server 10.47.88.188:5601 weight=1;</div><div class="line">&#125;</div><div class="line">  server &#123;</div><div class="line">        listen       80;</div><div class="line">        server_name  kibana.ihaozhuo.com;</div><div class="line">        location / &#123;</div><div class="line">             index        index.html index.php index.jsp index.htm;</div><div class="line">             allow 202.107.202.82/32;</div><div class="line">             deny all;</div><div class="line">             proxy_pass           http://kibana.ihaozhuo.com;</div><div class="line">             proxy_ignore_client_abort on;</div><div class="line">             proxy_redirect               off;</div><div class="line">             proxy_set_header     Host    <span class="variable">$host</span>;</div><div class="line">             proxy_set_header     X-Real-IP       <span class="variable">$remote_addr</span>;</div><div class="line">             proxy_set_header     X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</div><div class="line">             &#125;</div><div class="line">      &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h3 id="KafKaé›†ç¾¤æ­å»º"><a href="#KafKaé›†ç¾¤æ­å»º" class="headerlink" title="KafKaé›†ç¾¤æ­å»º"></a>KafKaé›†ç¾¤æ­å»º</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ä¸‹è½½åœ°å€ï¼šhttp://mirrors.hust.edu.cn/apache/kafka/0.9.0.0/kafka_2.10-0.9.0.0.tgz</div><div class="line">[root@kafka_01 srv]<span class="comment"># tar -xvf kafka_2.10-0.9.0.0.tgz</span></div><div class="line">[root@kafka_01 srv]<span class="comment"># mv kafka_2.10-0.9.0.0 kafka</span></div></pre></td></tr></table></figure><p><em>ä¿®æ”¹kafkaé…ç½®æ–‡ä»¶</em> </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">[root@kafka_01 config]<span class="comment"># vim /srv/kafka/config/server.properties</span></div><div class="line"></div><div class="line"><span class="comment">#è®¾ç½®brokeridï¼ˆä»0å¼€å§‹ï¼Œ3ä¸ªèŠ‚ç‚¹åˆ†åˆ«è®¾ä¸º0,1,2ï¼Œä¸èƒ½é‡å¤ï¼‰åœ¨è¿™é‡Œid=0è·Ÿzookeeper idè®¾ç½®ä¸€æ ·å°±è¡Œã€‚ é›†ç¾¤æœºå™¨ï¼šæŒ‰é¡ºåºå†™1</span></div><div class="line">broker.id=0  </div><div class="line"></div><div class="line"><span class="comment">#è®¾ç½®dataç›®å½•ï¼Œæœ€å¥½ä¸è¦ç”¨é»˜è®¤çš„/tmp/kafka-logs</span></div><div class="line">mkdir -p /srv/kafka/data/kafka-logs</div><div class="line"> </div><div class="line"></div><div class="line"><span class="comment">#ä¿®æ”¹æœ¬åœ°IPåœ°å€ï¼š</span></div><div class="line">listeners=PLAINTEXT://10.46.72.172:9092</div><div class="line"> </div><div class="line">log.dirs=/srv/kafka/data/kafka-logs</div><div class="line"><span class="comment">#è®¾ç½®æ³¨å†Œåœ°å€ï¼ˆé‡è¦ï¼Œé»˜è®¤ä¼šæŠŠæœ¬æœºçš„hostanmeæ³¨å†Œåˆ°zkä¸­ï¼Œå®¢æˆ·ç«¯è¿æ¥æ—¶éœ€è¦è§£æè¯¥hostanmeï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥æ³¨å†Œæœ¬æœºçš„IPåœ°å€ï¼Œé¿å…hostnameè§£æå¤±è´¥ï¼ŒæŠ¥é”™java.nio.channels.UnresolvedAddressExceptionæˆ–java.io.IOException: Can not resolve addressï¼‰</span></div><div class="line"><span class="comment">#è®¾ç½®zookeeperåœ°å€</span></div><div class="line">zookeeper.connect=10.46.72.172:2181,10.47.88.103:2181,10.47.102.137:2181</div></pre></td></tr></table></figure><p><em>é…ç½®zookeeperåœ°å€</em></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">vim zookeeper.properties </div><div class="line">dataDir=/home/jollybi/tools/zookeeper-3.4.5/tmp</div><div class="line"><span class="comment"># the port at which the clients will connect</span></div><div class="line">clientPort=2281</div><div class="line"><span class="comment"># disable the per-ip limit on the number of connections since this is a non-production config</span></div><div class="line">maxClientCnxns=0</div><div class="line">~</div></pre></td></tr></table></figure><p><em>é…ç½®kafkaè®¿é—®åœ°å€</em></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">vim producer.properties </div><div class="line">metadata.broker.list=169.44.62.139:9292,169.44.59.138:9292,169.44.62.137:9292   </div><div class="line"><span class="comment"># name of the partitioner class for partitioning events; default partition spreads data randomly</span></div><div class="line"><span class="comment">#partitioner.class=</span></div><div class="line"></div><div class="line"><span class="comment"># specifies whether the messages are sent asynchronously (async) or synchronously (sync)</span></div><div class="line">producer.type=sync</div><div class="line"></div><div class="line"><span class="comment"># specify the compression codec for all data generated: none, gzip, snappy, lz4.</span></div><div class="line"><span class="comment"># the old config values work as well: 0, 1, 2, 3 for none, gzip, snappy, lz4, respectively</span></div><div class="line">compression.codec=none</div><div class="line"></div><div class="line"><span class="comment"># message encoder</span></div><div class="line">serializer.class=kafka.serializer.DefaultEncoder</div></pre></td></tr></table></figure><h3 id="Kafkaå¸¸ç”¨å‘½ä»¤-æ™®åŠ"><a href="#Kafkaå¸¸ç”¨å‘½ä»¤-æ™®åŠ" class="headerlink" title="Kafkaå¸¸ç”¨å‘½ä»¤(æ™®åŠ)"></a>Kafkaå¸¸ç”¨å‘½ä»¤(æ™®åŠ)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">Kafkaå¸¸ç”¨å‘½ä»¤</div><div class="line">ä»¥ä¸‹æ˜¯kafkaå¸¸ç”¨å‘½ä»¤è¡Œæ€»ç»“ï¼š  </div><div class="line">1.æŸ¥çœ‹topicçš„è¯¦ç»†ä¿¡æ¯  </div><div class="line">./kafka-topics.sh -zookeeper 127.0.0.1:2181 -describe -topic <span class="built_in">test</span>KJ1  </div><div class="line">2ã€ä¸ºtopicå¢åŠ å‰¯æœ¬  </div><div class="line">./kafka-reassign-partitions.sh -zookeeper 127.0.0.1:2181 -reassignment-json-file json/partitions-to-move.json -execute  </div><div class="line">3ã€åˆ›å»ºtopic </div><div class="line">./kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic <span class="built_in">test</span>KJ1  </div><div class="line">4ã€ä¸ºtopicå¢åŠ partition  </div><div class="line">./bin/kafka-topics.sh â€“zookeeper 127.0.0.1:2181 â€“alter â€“partitions 20 â€“topic <span class="built_in">test</span>KJ1  </div><div class="line">5ã€kafkaç”Ÿäº§è€…å®¢æˆ·ç«¯å‘½ä»¤  </div><div class="line">./kafka-console-producer.sh --broker-list localhost:9092 --topic <span class="built_in">test</span>KJ1  </div><div class="line">6ã€kafkaæ¶ˆè´¹è€…å®¢æˆ·ç«¯å‘½ä»¤  </div><div class="line">./kafka-console-consumer.sh -zookeeper localhost:2181 --from-beginning --topic <span class="built_in">test</span>KJ1  </div><div class="line">7ã€kafkaæœåŠ¡å¯åŠ¨  </div><div class="line">./kafka-server-start.sh -daemon ../config/server.properties   </div><div class="line">8ã€ä¸‹çº¿broker  </div><div class="line">./kafka-run-class.sh kafka.admin.ShutdownBroker --zookeeper 127.0.0.1:2181 --broker <span class="comment">#brokerId# --num.retries 3 --retry.interval.ms 60  </span></div><div class="line">shutdown broker  </div><div class="line">9ã€åˆ é™¤topic  </div><div class="line">./kafka-run-class.sh kafka.admin.DeleteTopicCommand --topic <span class="built_in">test</span>KJ1 --zookeeper 127.0.0.1:2181  </div><div class="line">./kafka-topics.sh --zookeeper localhost:2181 --delete --topic <span class="built_in">test</span>KJ1  </div><div class="line">10ã€æŸ¥çœ‹consumerç»„å†…æ¶ˆè´¹çš„offset  </div><div class="line">./kafka-run-class.sh kafka.tools.ConsumerOffsetChecker --zookeeper localhost:2181 --group <span class="built_in">test</span> --topic <span class="built_in">test</span>KJ1</div></pre></td></tr></table></figure><h3 id="Kafkaç¾¤é›†æ–°å»ºä¸€ä¸ªTopic"><a href="#Kafkaç¾¤é›†æ–°å»ºä¸€ä¸ªTopic" class="headerlink" title="Kafkaç¾¤é›†æ–°å»ºä¸€ä¸ªTopic"></a>Kafkaç¾¤é›†æ–°å»ºä¸€ä¸ªTopic</h3><p>å«åšlogstash  Topic</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#æŸ¥çœ‹tocpicåˆ—è¡¨ï¼ˆ--zookeeperæŒ‡å®šä»»æ„ä¸€ä¸ªzkèŠ‚ç‚¹å³å¯ï¼Œç”¨äºè·å–é›†ç¾¤ä¿¡æ¯ï¼‰</span></div><div class="line">/usr/<span class="built_in">local</span>/kafka/bin/kafka-topics.sh --zookeeper zk1.yazuoyw.com:2181 --describe</div><div class="line"> </div><div class="line"><span class="comment">#åˆ›å»ºtopicï¼ˆ--replication-factorè¡¨ç¤ºå¤åˆ¶åˆ°å¤šå°‘ä¸ªèŠ‚ç‚¹ï¼Œ--partitionsè¡¨ç¤ºåˆ†åŒºæ•°ï¼Œä¸€èˆ¬éƒ½è®¾ç½®ä¸º2æˆ–ä¸èŠ‚ç‚¹æ•°ç›¸ç­‰ï¼Œä¸èƒ½å¤§äºæ€»èŠ‚ç‚¹æ•°ï¼‰</span></div><div class="line">/usr/<span class="built_in">local</span>/kafka/bin/kafka-topics.sh --zookeeper zk1.yazuoyw.com:2181 --create --topic topic1 --replication-factor 2 --partitions 2</div><div class="line"> </div><div class="line"><span class="comment">#å‘é€æ¶ˆæ¯ï¼ˆ--topic æŒ‡å®štopicï¼‰</span></div><div class="line">/usr/<span class="built_in">local</span>/kafka/bin/kafka-console-producer.sh --broker-list kafka1.yazuoyw.com:9092,kafka2.yazuoyw.com:9092,kafka3.yazuoyw.com:9092 --topic topic1</div><div class="line">message1</div><div class="line">message2</div><div class="line"> </div><div class="line"><span class="comment">#æ¶ˆè´¹æ¶ˆæ¯</span></div><div class="line">/usr/<span class="built_in">local</span>/kafka/bin/kafka-console-consumer.sh --zookeeper zk1.yazuoyw.com:2181 --topic topic1</div><div class="line"></div><div class="line"><span class="comment">#replicaæ£€æŸ¥</span></div><div class="line">/usr/<span class="built_in">local</span>/kafka/bin/kafka-replica-verification.sh --broker-list kafka1.yazuoyw.com:9092,kafka2.yazuoyw.com:9092,kafka3.yazuoyw.com:9092</div></pre></td></tr></table></figure><p>æ¯æ¡å‘å¸ƒåˆ°Kafkaé›†ç¾¤çš„æ¶ˆæ¯éƒ½æœ‰ä¸€ä¸ªç±»åˆ«ï¼Œè¿™ä¸ªç±»åˆ«è¢«ç§°ä¸ºtopicã€‚ï¼ˆç‰©ç†ä¸Šä¸åŒtopicçš„æ¶ˆæ¯åˆ†å¼€å­˜å‚¨ï¼Œé€»è¾‘ä¸Šä¸€ä¸ªtopicçš„æ¶ˆæ¯è™½ç„¶ä¿å­˜äºä¸€ä¸ªæˆ–å¤šä¸ªbrokerä¸Šä½†ç”¨æˆ·åªéœ€æŒ‡å®šæ¶ˆæ¯çš„topicå³å¯ç”Ÿäº§æˆ–æ¶ˆè´¹æ•°æ®è€Œä¸å¿…å…³å¿ƒæ•°æ®å­˜äºä½•å¤„ï¼‰</p><p><code>ElasticSearch</code>æœºå™¨<code>logstash</code>æŠŠæ•°æ®ä»<code>kafka</code>å­˜åˆ°<code>elasticsearch</code>çš„é…ç½®</p><p>å…¶ä¸­é€‰å–kafkaç¾¤é›†ä»»æ„ä¸€ä¸ªæœ‰zkçš„ipåšè¿æ¥ä½¿ç”¨</p><p><code>topic_id</code>å°±æ˜¯kafkaä¸­è®¾ç½®çš„<code>topic logstash</code></p><p>åœ¨esä¸Šé¢å®‰è£…logstashé…ç½®<br>/usr/local/logstash/config/kafka_to_es.conf</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"> input &#123;</div><div class="line">    kafka &#123;</div><div class="line">                zk_connect =&gt; <span class="string">"10.46.72.172:2181,10.47.88.103:2181,10.47.102.137:2181/kafka"</span></div><div class="line">                group_id =&gt; <span class="string">"logstash"</span></div><div class="line">                topic_id =&gt; <span class="string">"logstash"</span></div><div class="line">                reset_beginning =&gt; <span class="literal">false</span> <span class="comment"># boolean (optional)ï¼Œ default: false</span></div><div class="line">                consumer_threads =&gt; 2  <span class="comment"># number (optional)ï¼Œ default: 1</span></div><div class="line">                decorate_events =&gt; <span class="literal">false</span> <span class="comment"># boolean (optional)ï¼Œ default: false</span></div><div class="line">        &#125;</div><div class="line">  &#125;</div><div class="line">  output &#123;</div><div class="line">    elasticsearch &#123;</div><div class="line">      hosts =&gt; [<span class="string">"10.47.88.206:9200"</span>,<span class="string">"10.47.88.188:9200"</span>]</div><div class="line">      index =&gt; <span class="string">"%&#123;host&#125;-%&#123;+YYYY.MM.dd&#125;"</span></div><div class="line">&#125;</div><div class="line">   <span class="comment"># stdout &#123; codec =&gt; rubydebug &#125;</span></div><div class="line">  &#125;</div></pre></td></tr></table></figure><p>æ–°å»ºäº†ä¸ªæµ‹è¯•çš„ï¼Œæµ‹è¯•ä¸‹å‘é€æ˜¯å¦æˆåŠŸï¼š/usr/local/logstash/config/stdin_to_es.conf </p><figure class="highlight puppet"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">input</span> &#123;</div><div class="line"> stdin &#123;&#125;</div><div class="line">&#125;</div><div class="line">  <span class="keyword">output</span> &#123;</div><div class="line">    elasticsearch &#123;</div><div class="line">      <span class="attr">hosts</span> =&gt; <span class="string">"10.47.88.206"</span>&#125;</div><div class="line">    <span class="keyword">stdout</span> &#123;</div><div class="line">      <span class="attr">codec</span> =&gt; rubydebug &#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure><h3 id="Step-2-å¯åŠ¨æœåŠ¡"><a href="#Step-2-å¯åŠ¨æœåŠ¡" class="headerlink" title="Step 2: å¯åŠ¨æœåŠ¡"></a>Step 2: å¯åŠ¨æœåŠ¡</h3><figure class="highlight dts"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">Kafkaç”¨åˆ°äº†Zookeeperï¼Œæ‰€æœ‰é¦–å…ˆå¯åŠ¨Zookperï¼Œä¸‹é¢ç®€å•çš„å¯ç”¨ä¸€ä¸ªå•å®ä¾‹çš„ZookkeeperæœåŠ¡ã€‚å¯ä»¥åœ¨å‘½ä»¤çš„ç»“å°¾åŠ ä¸ª&amp;ç¬¦å·ï¼Œè¿™æ ·å°±å¯ä»¥å¯åŠ¨åç¦»å¼€æ§åˆ¶å°ã€‚</div><div class="line"></div><div class="line"><span class="meta">#ç°åœ¨å¯åŠ¨Kafka:</span></div><div class="line"></div><div class="line"><span class="meta-keyword">/srv/</span>kafka<span class="meta-keyword">/bin/</span>kafka-server-start.sh -daemon config/server.properties</div><div class="line"></div><div class="line"><span class="meta">#æ·»åŠ å¼€æœºå¯åŠ¨</span></div><div class="line">echo â€˜</div><div class="line"><span class="meta"># start kafka</span></div><div class="line"><span class="meta-keyword">/usr/</span>local<span class="meta-keyword">/kafka/</span>bin/kafka-server-start.sh -daemon <span class="meta-keyword">/usr/</span>local<span class="meta-keyword">/kafka/</span>config/server.properties</div><div class="line">â€˜ &gt;&gt; <span class="meta-keyword">/etc/</span>rc.local</div><div class="line"> </div><div class="line"><span class="meta">#å…³é—­</span></div><div class="line"><span class="meta-keyword">/usr/</span>local<span class="meta-keyword">/kafka/</span>bin/kafka-server-stop.sh</div></pre></td></tr></table></figure><h3 id="kafkaé…ç½®é˜²ç«å¢™ï¼š"><a href="#kafkaé…ç½®é˜²ç«å¢™ï¼š" class="headerlink" title="kafkaé…ç½®é˜²ç«å¢™ï¼š"></a>kafkaé…ç½®é˜²ç«å¢™ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">-A INPUT -i eth0 -p tcp -m state --state NEW -m tcp --dport 4888 -j ACCEPT</div></pre></td></tr></table></figure><h3 id="zookeeperé›†ç¾¤"><a href="#zookeeperé›†ç¾¤" class="headerlink" title="zookeeperé›†ç¾¤"></a>zookeeperé›†ç¾¤</h3><p>æŸ¥çœ‹æˆ‘ä¹‹å‰å†™çš„è¿™ç¯‡æ–‡æ¡£ <a href="http://blog.yangcvo.me/2016/05/28/%E5%A4%A7%E6%95%B0%E6%8D%AEhadoop/zookeeper/ZooKeeper%E9%9B%86%E7%BE%A4%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E4%B8%8E%E4%BC%98%E5%8C%96/" target="_blank" rel="external">ZooKeeperçš„é›†ç¾¤å¿«é€Ÿæ­å»ºä¸ä¼˜åŒ–</a> </p><h3 id="èµ°kafkaæŸ¥çœ‹æ˜¯å¦æ‰€æœ‰èŠ‚ç‚¹éƒ½å¯åŠ¨ï¼š"><a href="#èµ°kafkaæŸ¥çœ‹æ˜¯å¦æ‰€æœ‰èŠ‚ç‚¹éƒ½å¯åŠ¨ï¼š" class="headerlink" title="èµ°kafkaæŸ¥çœ‹æ˜¯å¦æ‰€æœ‰èŠ‚ç‚¹éƒ½å¯åŠ¨ï¼š"></a>èµ°kafkaæŸ¥çœ‹æ˜¯å¦æ‰€æœ‰èŠ‚ç‚¹éƒ½å¯åŠ¨ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[root@kafka_03 bin]<span class="comment"># sh zkCli.sh</span></div><div class="line">Connecting to localhost:2181</div><div class="line">2017-01-04 19:20:24,849 [myid:] - INFO  [main:Environment@100] - Client environment:zookeeper.version=3.4.6-1569965, built on 02/20/2014 09:09 GMT</div><div class="line">2017-01-04 19:20:24,853 [myid:] - INFO  [main:Environment@100] - Client environment:host.name=kafka_03</div><div class="line">2017-01-04 19:20:24,853 [myid:] - INFO  [main:Environment@100] - Client environment:java.version=1.8.0_66</div><div class="line">2017-01-04 19:20:24,856 [myid:] - INFO  [main:Environment@100] - Client environment:java.vendor=Oracle Corporation</div><div class="line">2017-01-04 19:20:24,856 [myid:] - INFO  [main:Environment@100] - Client environment:java.home=/srv/jdk1.8.0_66/jre</div><div class="line">2017-01-04 19:20:24,856 [myid:] - INFO  [main:Environment@100] - Client environment:java.class.path=/srv/zookeeper-3.4.6/bin/../build/classes:/srv/zookeeper-3.4.6/bin/../build/lib/*.jar:/srv/zookeeper-3.4.6/bin/../lib/slf4j-log4j12-1.6.1.jar:/srv/zookeeper-3.4.6/bin/../lib/slf4j-api-1.6.1.jar:/srv/zookeeper-3.4.6/bin/../lib/netty-3.7.0.Final.jar:/srv/zookeeper-3.4.6/bin/../lib/<span class="built_in">log</span>4j-1.2.16.jar:/srv/zookeeper-3.4.6/bin/../lib/jline-0.9.94.jar:/srv/zookeeper-3.4.6/bin/../zookeeper-3.4.6.jar:/srv/zookeeper-3.4.6/bin/../src/java/lib/*.jar:/srv/zookeeper-3.4.6/bin/../conf:</div><div class="line">2017-01-04 19:20:24,856 [myid:] - INFO  [main:Environment@100] - Client environment:java.library.path=/usr/java/packages/lib/amd64:/usr/lib64:/lib64:/lib:/usr/lib</div><div class="line"></div><div class="line">[zk: localhost:2181(CONNECTED) 0] ls /</div><div class="line">[controller_epoch, brokers, zookeeper, kafka, dubbo, admin, isr_change_notification, consumers, config, sthp]</div><div class="line">[zk: localhost:2181(CONNECTED) 5] ls /kafka/brokers/ids</div><div class="line">[0, 1, 2]</div></pre></td></tr></table></figure><p>kafka ä¸‰å°é›†ç¾¤è¿™é‡Œå¯ä»¥çœ‹åˆ°è·å–åˆ°idsã€‚</p><h4 id="å®‰å…¨é—®é¢˜"><a href="#å®‰å…¨é—®é¢˜" class="headerlink" title="å®‰å…¨é—®é¢˜"></a>å®‰å…¨é—®é¢˜</h4><p>ç‰¹åˆ«è¦æ³¨æ„elkæ‰€æœ‰è½¯ä»¶çš„ç«¯å£ç›‘å¬,åˆ‡å‹¿æš´éœ²ç›‘å¬åˆ°å…¬ç½‘ä¸Šå»,å¦å¤–å³ä¾¿æ˜¯å†…ç½‘ä½ ä¹Ÿå¾—æ³¨æ„é…ç½®å†…ç½‘çš„è®¿é—®é™åˆ¶ã€‚</p><h3 id="logstash-å®¢æˆ·ç«¯å®‰è£…ï¼š"><a href="#logstash-å®¢æˆ·ç«¯å®‰è£…ï¼š" class="headerlink" title="logstash å®¢æˆ·ç«¯å®‰è£…ï¼š"></a>logstash å®¢æˆ·ç«¯å®‰è£…ï¼š</h3><h5 id="æºç å®‰è£…"><a href="#æºç å®‰è£…" class="headerlink" title="æºç å®‰è£…"></a>æºç å®‰è£…</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line">æˆ‘è¿™é‡Œæºç åŒ…å®‰è£…</div><div class="line"><span class="comment"># wget https://download.elasticsearch.org/logstash/logstash/logstash-2.4.0.tar.gz</span></div><div class="line"><span class="comment">#curl -O https://download.elastic.co/logstash/logstash/logstash-2.4.0.tar.gz</span></div><div class="line"><span class="comment">#tar -zxvf logstash-2.4.0.tar.gz</span></div><div class="line"><span class="comment">#mv logstash-2.4.0 /usr/local/</span></div><div class="line"><span class="comment">#ln -s /usr/local/logstash-2.4.0/ /usr/local/logstash</span></div><div class="line"></div><div class="line">ä¸‹è½½å¯åŠ¨è„šæœ¬</div><div class="line">ç”Ÿäº§éƒ½æ˜¯è¿è¡Œåœ¨åå°çš„ï¼Œæˆ‘è¿™é‡Œæºç å®‰è£…æ²¡æœ‰initè„šæœ¬å¯åŠ¨ã€‚ å»Githubä¸‹è½½  https://github.com/benet1006/ELK_config.git</div><div class="line"><span class="comment">#cp logstash.init /etc/init.d/logstash</span></div><div class="line"><span class="comment">#chmod +x /etc/init.d/logstash</span></div><div class="line">è¿™ä¸ªè„šæœ¬æˆ‘åšè¿‡ä¿®æ”¹ã€‚</div><div class="line"></div><div class="line"><span class="comment">#å¯åŠ¨logstashæœåŠ¡</span></div><div class="line">service logstash start</div><div class="line">service logstash status</div><div class="line"></div><div class="line"><span class="comment">#æŸ¥çœ‹5000ç«¯å£</span></div><div class="line">netstat -nltp</div><div class="line"></div><div class="line">Active Internet connections (only servers)</div><div class="line">Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name</div><div class="line">tcp 0 0 0.0.0.0:9200 0.0.0.0:* LISTEN 1765/java</div><div class="line">tcp 0 0 0.0.0.0:9300 0.0.0.0:* LISTEN 1765/java</div><div class="line">tcp 0 0 0.0.0.0:9301 0.0.0.0:* LISTEN 2309/java</div><div class="line">tcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN 1509/sshd</div><div class="line">tcp 0 0 0.0.0.0:5601 0.0.0.0:* LISTEN 1876/node</div><div class="line">tcp 0 0 0.0.0.0:5000 0.0.0.0:* LISTEN 2309/java</div><div class="line">tcp 0 0 :::22 :::* LISTEN 1509/sshd</div><div class="line"></div><div class="line"></div><div class="line">ä¿®æ”¹å¯åŠ¨è„šæœ¬</div><div class="line">vim /etc/init.d/logstash </div><div class="line">æŒ‡å®šçš„ç›®å½•è‡ªå·±æºç å®‰è£…çš„è·¯å¾„ã€‚</div><div class="line"></div><div class="line">name=logstash</div><div class="line">pidfile=<span class="string">"/var/run/<span class="variable">$name</span>.pid"</span></div><div class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$JAVA_HOME</span>/jre/lib/rt.jar:<span class="variable">$JAVA_HOME</span>/lib/dt.jar:<span class="variable">$JAVA_HOME</span>/lib/tools.jar</div><div class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin</div><div class="line">LS_USER=logstash</div><div class="line">LS_GROUP=logstash</div><div class="line">LS_HOME=/usr/<span class="built_in">local</span>/logstash å®‰è£…è·¯å¾„</div><div class="line">LS_HEAP_SIZE=<span class="string">"1000m"</span></div><div class="line">LS_JAVA_OPTS=<span class="string">"-Djava.io.tmpdir=<span class="variable">$&#123;LS_HOME&#125;</span>"</span></div><div class="line">LS_LOG_DIR=/usr/<span class="built_in">local</span>/logstash</div><div class="line">LS_LOG_FILE=<span class="string">"<span class="variable">$&#123;LS_LOG_DIR&#125;</span>/<span class="variable">$name</span>.log"</span></div><div class="line">LS_CONF_FILE=/etc/logstash.conf     æ”¶é›†æ—¥å¿—çš„è§„åˆ™conf</div><div class="line">LS_OPEN_FILES=16384</div><div class="line">LS_NICE=19</div><div class="line">LS_OPTS=<span class="string">""</span></div><div class="line"></div><div class="line">https://www.elastic.co/guide/en/logstash/current/plugins-inputs-file.html</div><div class="line">è¿™ä¸ªæ˜¯<span class="built_in">log</span> stashçš„å®˜æ–¹æ–‡æ¡£çš„é…ç½®è¯´æ˜ã€‚</div><div class="line">è¿™ä¸ªé…ç½®è¯´æ˜ä¸Šé¢æˆ‘å…ˆä¿®æ”¹ä¸‹æˆ‘ä¹‹å‰çš„é…ç½®æ–‡ä»¶ã€‚</div></pre></td></tr></table></figure><h4 id="logstash-agenté…ç½®ï¼š"><a href="#logstash-agenté…ç½®ï¼š" class="headerlink" title="logstash agenté…ç½®ï¼š"></a>logstash agenté…ç½®ï¼š</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">é…ç½®<span class="built_in">log</span> stashï¼å®ç°ç³»ç»Ÿæ—¥å¿—æ”¶é›†input</div><div class="line">file_to_kafka.conf æ—¥å¿—æ–‡ä»¶è¯»å‡ºå†™å…¥åˆ°kafka</div><div class="line">input &#123;</div><div class="line">file &#123;</div><div class="line">path =&gt; <span class="string">"/srv/tomcat/logs/account/logFile.*.log"</span></div><div class="line"><span class="built_in">type</span> =&gt; <span class="string">"tomcat"</span></div><div class="line">discover_interval =&gt; 15 <span class="comment">#logstash</span></div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">output &#123;</div><div class="line"><span class="comment">#stdout &#123; codec =&gt; rubydebug &#125;</span></div><div class="line">kafka&#123;</div><div class="line">bootstrap_servers =&gt; <span class="string">"10.46.72.172:9092,10.47.88.103:9092,10.47.102.137:9092"</span></div><div class="line"><span class="comment">#group_id =&gt; "logstash"</span></div><div class="line">topic_id =&gt; <span class="string">"logstash"</span></div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">2.2 logstash indexer é…ç½®</div><div class="line">kafka_to_es.conf</div><div class="line">input &#123;</div><div class="line">kafka &#123;</div><div class="line">zk_connect =&gt; <span class="string">"10.46.72.172:2181,10.47.88.103:2181,10.47.102.137:2181kafka"</span></div><div class="line">group_id =&gt; <span class="string">"logstash"</span></div><div class="line">topic_id =&gt; <span class="string">"logstash"</span></div><div class="line">reset_beginning =&gt; <span class="literal">false</span> <span class="comment"># boolean (optional)ï¼Œ default: false</span></div><div class="line">consumer_threads =&gt; 2 <span class="comment"># number (optional)ï¼Œ default: 1</span></div><div class="line">decorate_events =&gt; <span class="literal">false</span> <span class="comment"># boolean (optional)ï¼Œ default: false</span></div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">output &#123;</div><div class="line">elasticsearch &#123;</div><div class="line">hosts =&gt; [<span class="string">"10.47.88.206:9200"</span>,<span class="string">"10.47.88.188:9200"</span>]</div><div class="line">index =&gt; <span class="string">"%&#123;host&#125;-%&#123;+YYYY.MM.dd&#125;"</span></div><div class="line">&#125;</div><div class="line"><span class="comment"># stdout &#123; codec =&gt; rubydebug &#125;</span></div><div class="line">&#125;</div></pre></td></tr></table></figure><h4 id="eså®‰è£…æ’ä»¶headæŸ¥çœ‹ä¸‹æ•ˆæœï¼š"><a href="#eså®‰è£…æ’ä»¶headæŸ¥çœ‹ä¸‹æ•ˆæœï¼š" class="headerlink" title="eså®‰è£…æ’ä»¶headæŸ¥çœ‹ä¸‹æ•ˆæœï¼š"></a>eså®‰è£…æ’ä»¶headæŸ¥çœ‹ä¸‹æ•ˆæœï¼š</h4><p>ç„¶åæ‰“å¼€ç½‘ç«™ï¼š<a href="http://elk.ihaozhuo.com/_plugin/head/" target="_blank" rel="external">http://elk.ihaozhuo.com/_plugin/head/</a></p><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/es_head.png" alt=""></figure></p><p>####kibanaç½‘ç«™æ•ˆæœï¼š</p><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/es_kibana.png" alt=""></figure></p><h3 id="äº¤æµå­¦ä¹ ï¼š"><a href="#äº¤æµå­¦ä¹ ï¼š" class="headerlink" title="äº¤æµå­¦ä¹ ï¼š"></a>äº¤æµå­¦ä¹ ï¼š</h3><p>ğŸ§  Linux shell_é«˜çº§è¿ç»´æ´¾: <code>459096184</code>    åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)<br>ğŸ§  BigData-Exchange School : <code>521621407</code>  åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥</p><p>ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;æ­å»º-ElasticSearch-2-x-Logstash-2-x-Kibana-4-5-x-zookeeper3-4-6-Kafkaä¸ºæ¶ˆæ¯ä¸­å¿ƒçš„ELKæ—¥å¿—å¹³å°&quot;&gt;&lt;a href=&quot;#æ­å»º-ElasticSearch-2-x-Logstash-2-x-Kibana
      
    
    </summary>
    
      <category term="Log Analysis Platform" scheme="http://blog.yancy.cc/categories/Log-Analysis-Platform/"/>
    
    
      <category term="Elasticsearch" scheme="http://blog.yancy.cc/tags/Elasticsearch/"/>
    
  </entry>
  
  <entry>
    <title>graylog å‡çº§2.1 é›†ä¸­æ—¥å¿—è§£å†³æ–¹æ¡ˆ</title>
    <link href="http://blog.yancy.cc/2016/11/14/%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%10%E5%B9%B3%E5%8F%B0/Graylog/graylog%20%E5%8D%87%E7%BA%A72.1%20%E9%9B%86%E4%B8%AD%E6%97%A5%E5%BF%97%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"/>
    <id>http://blog.yancy.cc/2016/11/14/æ—¥å¿—åˆ†æå¹³å°/Graylog/graylog å‡çº§2.1 é›†ä¸­æ—¥å¿—è§£å†³æ–¹æ¡ˆ/</id>
    <published>2016-11-14T09:56:03.000Z</published>
    <updated>2017-09-21T14:48:13.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="graylog-å‡çº§2-1-é›†ä¸­æ—¥å¿—è§£å†³æ–¹æ¡ˆ"><a href="#graylog-å‡çº§2-1-é›†ä¸­æ—¥å¿—è§£å†³æ–¹æ¡ˆ" class="headerlink" title="graylog å‡çº§2.1 é›†ä¸­æ—¥å¿—è§£å†³æ–¹æ¡ˆ"></a>graylog å‡çº§2.1 é›†ä¸­æ—¥å¿—è§£å†³æ–¹æ¡ˆ</h1><p>å‚è€ƒå®˜ç½‘ï¼š<a href="http://docs.graylog.org/en/2.1/pages/upgrade/graylog-2.1.html" target="_blank" rel="external">å‡çº§åˆ°Graylogçš„2.1.x</a></p><h3 id="ä¸€ï¼šä¸ºä»€ä¹ˆéœ€è¦é›†ä¸­æ—¥å¿—è§£å†³æ–¹æ¡ˆï¼Ÿ"><a href="#ä¸€ï¼šä¸ºä»€ä¹ˆéœ€è¦é›†ä¸­æ—¥å¿—è§£å†³æ–¹æ¡ˆï¼Ÿ" class="headerlink" title="ä¸€ï¼šä¸ºä»€ä¹ˆéœ€è¦é›†ä¸­æ—¥å¿—è§£å†³æ–¹æ¡ˆï¼Ÿ"></a>ä¸€ï¼šä¸ºä»€ä¹ˆéœ€è¦é›†ä¸­æ—¥å¿—è§£å†³æ–¹æ¡ˆï¼Ÿ</h3><p>åœ¨å…¬å¸æœåŠ¡æœºå­éƒ¨ç½²è¶Šæ¥è¶Šå¤šçš„æƒ…å†µä¸‹ï¼Œè®©æˆ‘ä»¬æ¥æƒ³æƒ³ä¼šé‡åˆ°çš„é—®é¢˜ï¼š</p><ul><li>å¼€å‘äººå‘˜ä¸èƒ½ç™»å½•çº¿ä¸ŠæœåŠ¡å™¨æŸ¥çœ‹è¯¦ç»†æ—¥å¿—ï¼Œç»è¿‡è¿ç»´å‘¨è½¬è´¹æ—¶è´¹åŠ›</li><li>æ—¥å¿—æ•°æ®åˆ†æ•£åœ¨å¤šä¸ªç³»ç»Ÿï¼Œéš¾ä»¥æŸ¥æ‰¾</li><li>æ—¥å¿—æ•°æ®é‡å¤§ï¼ŒæŸ¥è¯¢é€Ÿåº¦æ…¢</li><li>ä¸€ä¸ªè°ƒç”¨ä¼šæ¶‰åŠå¤šä¸ªç³»ç»Ÿï¼Œéš¾ä»¥åœ¨è¿™äº›ç³»ç»Ÿçš„æ—¥å¿—ä¸­å¿«é€Ÿå®šä½æ•°æ®</li><li>æ•°æ®ä¸å¤Ÿå®æ—¶</li><li>å¾ˆéš¾å¯¹æ•°æ®è¿›è¡ŒæŒ–æ˜ï¼Œåˆ†æï¼Œä¸šåŠ¡å‘Šè­¦ï¼Œå®¡è®¡</li><li>è¿™äº›é—®é¢˜çš„å­˜åœ¨è®©å¼€å‘ä»¥åŠè¿ç»´äººå‘˜å¾ˆæ˜¯å¤´ç—›ï¼Œä¸¥é‡å½±å“æ•ˆç‡ï¼</li></ul><h3 id="äºŒï¼šä»€ä¹ˆæ˜¯graylogæŠ€æœ¯æ ˆï¼Ÿ"><a href="#äºŒï¼šä»€ä¹ˆæ˜¯graylogæŠ€æœ¯æ ˆï¼Ÿ" class="headerlink" title="äºŒï¼šä»€ä¹ˆæ˜¯graylogæŠ€æœ¯æ ˆï¼Ÿ"></a>äºŒï¼šä»€ä¹ˆæ˜¯graylogæŠ€æœ¯æ ˆï¼Ÿ</h3><p>ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ—¥å¿—çš„é›†ä¸­ç®¡ç†æ–¹æ¡ˆï¼ŒgraylogæŠ€æœ¯æ ˆï¼š</p><ul><li>java ï¼ˆjdk1.8.0_66/ï¼‰ç¯å¢ƒ</li><li>Collector-sidecarï¼ˆæ”¶é›†æ—¥å¿—ï¼‰æˆ–è€…syslog</li><li>Mongodbï¼ˆå­˜å‚¨æ—¥å¿—æºæ–‡ä»¶ï¼‰</li><li>Elasticsearchï¼ˆæä¾›æœç´¢æ—¥å¿—ï¼‰</li><li>Graylog2.1.1ï¼ˆæœç´¢å’Œè§†å›¾å±•ç¤ºæ—¥å¿—ï¼Œå‘Šè­¦å’Œæƒé™ï¼‰</li></ul><p>æœ‰äº†è¿™äº›ï¼Œæˆ‘ä»¬å°±èƒ½æŠŠæ—¥å¿—å…ˆæ”¶é›†èµ·æ¥ï¼Œè¿›è¡Œæˆ‘ä»¬æƒ³è¦çš„åˆ†æä¹‹åï¼Œwebçš„å½¢å¼å±•ç¤ºå‡ºæ¥ï¼Œæä¾›æŸ¥è¯¢ï¼</p><h3 id="ä¸‰ï¼šgraylogçš„å®‰è£…éƒ¨ç½²"><a href="#ä¸‰ï¼šgraylogçš„å®‰è£…éƒ¨ç½²" class="headerlink" title="ä¸‰ï¼šgraylogçš„å®‰è£…éƒ¨ç½²"></a>ä¸‰ï¼šgraylogçš„å®‰è£…éƒ¨ç½²</h3><p>å®‰è£…ç¯å¢ƒï¼šlinux centOSç³»ç»Ÿå®‰è£…ï¼Œå·²å®‰è£…JDK1.8ç‰ˆæœ¬ï¼Œå®‰è£…å¯åŠ¨é¡ºåº</p><p>1.å®‰è£…éƒ¨ç½²mongodb<br>2.å®‰è£…éƒ¨ç½²elasticsearch<br>3.å®‰è£…éƒ¨ç½²graylog<br>4.å®‰è£…éƒ¨ç½²Graylog Collector Sidecar</p><hr><p> <strong>1ï¼šå®‰è£…éƒ¨ç½²mongodb</strong> <strong>Javaä¹Ÿå®‰è£…</strong>  å‚è€ƒæˆ‘åšæ–‡æœ‰ä»‹ç»ã€‚ </p><p> <strong>2ï¼šå®‰è£…éƒ¨ç½²elasticsearch</strong></p><p><strong>(1)ä¸‹è½½jaråŒ…</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">wget https://download.elastic.co/elasticsearch/release/org/elasticsearch/distribution/tar/elasticsearch/2.3.5/elasticsearch-2.3.5.tar.gz</div><div class="line"></div><div class="line">å¦‚æœæŠ¥é”™</div><div class="line">æ‰§è¡Œ</div><div class="line"></div><div class="line">wget --no-check-certificate</div><div class="line"></div><div class="line">https://download.elastic.co/elasticsearch/release/org/elasticsearch/distribution/tar/elasticsearch/2.3.5/elasticsearch-2.3.5.tar.gz</div></pre></td></tr></table></figure><p><strong>(2)è§£å‹jaråŒ…</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tar -zxvf elasticsearch-2.3.5.tar.gz -C /opt/</div></pre></td></tr></table></figure><p><strong>(3)ä¿®æ”¹elasticsearch.ymlé…ç½®æ–‡ä»¶</strong></p><p> è¿™é‡Œéœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼šé…ç½®å‰å…ˆåˆ›å»ºå‡ ä¸ªç›®å½•æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mkdir /home/data/es-data -p</div><div class="line">mkdir /home/data/es-work -p</div></pre></td></tr></table></figure><p>elasticsearch-2.3.5å®‰è£…ç›®å½•confä¸‹æ‰§è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">vim elasticsearch-2.3.5/config/elasticsearch.yml</div><div class="line"> </div><div class="line">cluster.name: graylog              <span class="comment">#é›†ç¾¤åç§°å»ºè®®å‘½ågraylogï¼Œä¾¿äºè¯†åˆ«åŒºåˆ†</span></div><div class="line">node.name: elasticsearch-node-1     <span class="comment"># elasticsearché›†ç¾¤èŠ‚ç‚¹åç§°</span></div><div class="line">network.host: 192.168.1.234    <span class="comment"># ç»‘å®šèŠ‚ç‚¹IP</span></div><div class="line">http.port: 9200         <span class="comment"># å¤–éƒ¨è®¿é—®ç«¯å£ï¼Œé»˜è®¤ï¼Œä¹Ÿå¯ä»¥å®‰å…¨è€ƒè™‘ä¿®æ”¹</span></div><div class="line">path.logs: /home/data/logs</div><div class="line">path.data: /home/data/es-data</div><div class="line">discovery.zen.ping.multicast.enabled: <span class="literal">false</span>   <span class="comment">#å¤šæ’­å‘ç°æ–¹å¼å…³é—­ï¼Œå› ä¸ºgraylogé‡‡ç”¨å•æ’­æ–¹å¼å‘ç°elasticsearché›†ç¾¤æ–¹å¼</span></div><div class="line">discovery.zen.ping.unicast.hosts                   <span class="comment">#å¤šä¸ªèŠ‚ç‚¹ç”¨é€—å·éš”å¼€</span></div><div class="line">discovery.zen.minimum_master_nodes: 3    <span class="comment"># elasticsearché›†ç¾¤èŠ‚ç‚¹ï¼Œæœ€å°‘é€‰ä¸¾æ•°ï¼Œè¿™ä¸ªæ•°ä¸€å®šè¦è®¾ç½®ä¸ºæ•´ä¸ªé›†ç¾¤èŠ‚ç‚¹ä¸ªæ•°çš„ä¸€åŠåŠ 1ï¼Œå³N/2+1ï¼Œå¿…é¡»ä¸ºå¥‡æ•°</span></div></pre></td></tr></table></figure><p><strong>(4)å¯åŠ¨elasticsearchæœåŠ¡</strong></p><p>æ–°å»ºä¸€ä¸ªelasticsearchç”¨æˆ·ï¼Œå‡ºäºå®‰å…¨è€ƒè™‘ï¼ŒelasticsearchæœåŠ¡ä¸èƒ½ä½¿ç”¨rootç”¨æˆ·å¯åŠ¨</p><p>åˆ›å»ºelasticsearchç”¨æˆ·ç»„åŠelasticsearchç”¨æˆ·ï¼Œæ‰§è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">groupadd elasticsearch</div><div class="line">useradd elasticsearch -g elasticsearch -p elasticsearch</div></pre></td></tr></table></figure><p>å…¶ä¸­-gä½¿ç”¨æˆ·å±äºæŸä¸ªç»„ï¼Œ-pä¸ºæ–°ç”¨æˆ·ä½¿ç”¨åŠ å¯†å¯†ç ï¼‰<br>æ›´æ”¹elasticsearch-2.3.5æ–‡ä»¶å¤¹åŠå†…éƒ¨æ–‡ä»¶çš„æ‰€å±ç”¨æˆ·åŠç»„ä¸ºelasticsearch:elasticsearch</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">chown -R elasticsearch:elasticsearch  /home/data/</div><div class="line">chown -R elasticsearch:elasticsearch  elasticsearch-2.3.5</div></pre></td></tr></table></figure><p>åˆ‡æ¢ç”¨æˆ·</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">su elasticsearch</div></pre></td></tr></table></figure><p>åœ¨elasticsearch-2.3.5/binç›®å½•ä¸‹æ‰§è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[elasticsearch@graylog bin]$ ps -ef | grep elasticsearch</div><div class="line">root     18265 16004  0 14:27 pts/1    00:00:00 su elasticsearch</div><div class="line">502      18405     1 62 14:27 pts/1    00:00:13 /srv/jdk1.8.0_66/bin/java -Xms256m -Xmx1g -Djava.awt.headless=<span class="literal">true</span> -XX:+UseParNewGC -XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFraction=75 -XX:+UseCMSInitiatingOccupancyOnly -XX:+HeapDumpOnOutOfMemoryError -XX:+DisableExplicitGC -Dfile.encoding=UTF-8 -Djna.nosys=<span class="literal">true</span> -Des.path.home=/opt/elasticsearch-2.3.5 -cp /opt/elasticsearch-2.3.5/lib/elasticsearch-2.3.5.jar:/opt/elasticsearch-2.3.5/lib/* org.elasticsearch.bootstrap.Elasticsearch start <span class="_">-d</span></div><div class="line">502      18530 18266  0 14:27 pts/1    00:00:00 grep --color=auto ela</div></pre></td></tr></table></figure><p><strong>(5)æ£€æŸ¥elasticsearchæœåŠ¡çŠ¶æ€</strong></p><p>æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤æµ‹è¯•Elasticsearchæ˜¯å¦æ­£å¸¸è¿è¡Œï¼š</p><p>$ curl -XGET â€˜<a href="http://localhost:9200/_cluster/health?pretty=true" target="_blank" rel="external">http://localhost:9200/_cluster/health?pretty=true</a>â€˜</p><p>è¾“å‡ºçš„ä¿¡æ¯å¦‚ä¸‹è¡¨ç¤ºElasticsearchå®‰è£…æˆåŠŸï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">[elasticsearch@graylog bin]$ curl -XGET <span class="string">'http://192.168.1.234:9200/_cluster/health?pretty=true'</span></div><div class="line">&#123;</div><div class="line">  <span class="string">"cluster_name"</span> : <span class="string">"graylog"</span>,</div><div class="line">  <span class="string">"status"</span> : <span class="string">"yellow"</span>,</div><div class="line">  <span class="string">"timed_out"</span> : <span class="literal">false</span>,</div><div class="line">  <span class="string">"number_of_nodes"</span> : 1,</div><div class="line">  <span class="string">"number_of_data_nodes"</span> : 1,</div><div class="line">  <span class="string">"active_primary_shards"</span> : 30,</div><div class="line">  <span class="string">"active_shards"</span> : 30,</div><div class="line">  <span class="string">"relocating_shards"</span> : 0,</div><div class="line">  <span class="string">"initializing_shards"</span> : 0,</div><div class="line">  <span class="string">"unassigned_shards"</span> : 30,</div><div class="line">  <span class="string">"delayed_unassigned_shards"</span> : 0,</div><div class="line">  <span class="string">"number_of_pending_tasks"</span> : 0,</div><div class="line">  <span class="string">"number_of_in_flight_fetch"</span> : 0,</div><div class="line">  <span class="string">"task_max_waiting_in_queue_millis"</span> : 0,</div><div class="line">  <span class="string">"active_shards_percent_as_number"</span> : 50.0</div><div class="line">&#125;</div></pre></td></tr></table></figure><h3 id="3ï¼šå®‰è£…éƒ¨ç½²graylog-2-1ç‰ˆæœ¬"><a href="#3ï¼šå®‰è£…éƒ¨ç½²graylog-2-1ç‰ˆæœ¬" class="headerlink" title="3ï¼šå®‰è£…éƒ¨ç½²graylog-2.1ç‰ˆæœ¬"></a>3ï¼šå®‰è£…éƒ¨ç½²graylog-2.1ç‰ˆæœ¬</h3><p><strong>(1)ä¸‹è½½å®‰è£…åŒ…</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wget https://packages.graylog2.org/releases/graylog/graylog-2.1.1.tgz</div></pre></td></tr></table></figure><p><strong>(2)è§£å‹å®‰è£…åŒ…</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tar -zxvf graylog-2.1.1.tgz -C /opt/.</div></pre></td></tr></table></figure><p><strong>(3)ä¿®æ”¹é…ç½®æ–‡ä»¶</strong></p><p>ä¿®æ”¹å®‰è£…ç›®å½•ä¸‹ graylog.conf.example æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vim graylog.conf.example</div></pre></td></tr></table></figure><p>web_listen_uri å€¼æ˜¯graylogå¯åŠ¨æˆåŠŸåï¼ŒwebæœåŠ¡è®¿é—®åœ°å€</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">web_listen_uri = http://192.168.1.234:9000/</div></pre></td></tr></table></figure><p>rest_listen_uri çš„å€¼ï¼Œæ˜¯graylogå¯åŠ¨æˆåŠŸåï¼Œapiè®¿é—®åœ°å€</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rest_listen_uri = http://192.168.1.234:9000/api/</div></pre></td></tr></table></figure><p>root_timezone = UTC  #è®¾ç½®æ—¶åŒºï¼Œå¦åˆ™é»˜è®¤ä½¿ç”¨çš„æ˜¯UTCæ—¶é—´ä¹Ÿå°±æ˜¯ä¸–ç•Œæ—¶é—´ è¿™é‡Œæ˜¯å¿…é¡»æ”¹ä¸‹çš„ï¼Œå› ä¸ºåæœŸæ”¶é›†æ—¥å¿—æ˜¾ç¤ºæ—¶é—´æ˜¯æœ‰å˜åŒ–çš„ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">root_timezone = Asia/Shanghai</div></pre></td></tr></table></figure><p>å…¶ä¸­ password_secret çš„å€¼ç”¨å‘½ä»¤ç”Ÿæˆ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">yum install -y pwgen</div><div class="line">pwgen -N 1 <span class="_">-s</span> 96       H1R5v17kWtyDxj2PzxLMxu41D6HDt9JzhfZcj6QlCURVddgkLAdnUmpkdIscmmu4ELKsTrHwKvPmxFKSYyTn0YlqebbpQqyr</div><div class="line"></div><div class="line">    password_secret = H1R5v17kWtyDxj2PzxLMxu41D6HDt9JzhfZcj6QlCURVddgkLAdnUmpkdIscmmu4ELKsTrHwKvPmxFKSYyTn0YlqebbpQqyr</div></pre></td></tr></table></figure><p>å…¶ä¸­root_password_sha2 çš„å€¼ä½¿ç”¨å‘½ä»¤ç”Ÿæˆ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="built_in">echo</span> -n Ihaozhuo_b313 | sha256sum  (è¿™é‡Œå¯¹å¯†ç 123456å“ˆå¸ŒåŠ å¯†)</div><div class="line"></div><div class="line"><span class="built_in">fc</span>88c28d48b0cb97f3fb5286cc35c520409ef037acd30ec687f0c0bd3d5a5115 </div><div class="line">   </div><div class="line">root_password_sha2 = <span class="built_in">fc</span>88c28d48b0cb97f3fb5286cc35c520409ef037acd30ec687f0c0bd3d5a5115</div></pre></td></tr></table></figure><p>elasticsearch_cluster_name å€¼å¿…é¡»æ˜¯elasticsearché…ç½®æ–‡ä»¶ä¸­çš„cluster_name</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">elasticsearch_cluster_name = graylog</div></pre></td></tr></table></figure><p>elasticsearch_discovery_zen_ping_unicast_hosts å¡«å†™elasticsearchåœ°å€ï¼Œå¦‚æœæ˜¯å¤šä¸ªï¼Œç”¨é€—å·éš”å¼€</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">elasticsearch_discovery_zen_ping_unicast_hosts = 192.168.1.234:9300</div></pre></td></tr></table></figure><p>elasticsearch_discovery_zen_ping_multicast_enabled = false å¤šæ’­æ¨¡å¼å…³é—­</p><p>ç”±äºæˆ‘ä»¬åªæœ‰ä¸€ä¸ªElasticsearch shardï¼Œéœ€è¦æŠŠelasticsearch_shardså‚æ•°è®¾ç½®ä¸º1ï¼š<br>elasticsearché›†ç¾¤åˆ†ç‰‡æ•°é‡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">elasticsearch_shards = 1</div></pre></td></tr></table></figure><p>elasticsearchç»‘å®šçš„èŠ‚ç‚¹IP</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">299 elasticsearch_network_host = 192.168.1.234</div><div class="line">300 elasticsearch_network_bind_host = 192.168.1.234</div><div class="line">301 elasticsearch_network_publish_host = 192.168.1.234</div></pre></td></tr></table></figure><p>mongodbå®‰è£…æœåŠ¡çš„ipåœ°å€</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mongodb_uri = mongodb://192.168.1.234/graylog</div></pre></td></tr></table></figure><p>è¿™é‡Œmongodbæ˜¯å®‰è£…åœ¨æˆ‘åŒä¸€å°æœåŠ¡å™¨ä¸Šé¢çš„ã€‚å¦‚æœè¦æŠŠmongodbå•ç‹¬æœåŠ¡å™¨è·‘è¿æ¥æ–¹å¼é…ç½®æ–‡ä»¶é‡Œé¢ä¹Ÿæœ‰ä¾‹å­è¯´æ˜ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mongodb_uri =mongodb://graylog:123456@160.17.2.251:27017/graylog2             <span class="comment">#è¿æ¥åˆ°mongodbçš„æœåŠ¡å™¨åœ°å€ä¸º160.17.2.251:27017ï¼Œè´¦å·ä¸ºgraylogï¼Œå¯†ç ä¸º123456 æ•°æ®åº“ä¸ºgraylog2</span></div></pre></td></tr></table></figure><p> è®¾ç½®å‘Šè­¦é‚®ä»¶å‘é€è€…ä¿¡æ¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"> <span class="comment"># Email transport</span></div><div class="line">transport_email_enabled = <span class="literal">false</span></div><div class="line">transport_email_hostname = smtp.exmail.qq.com</div><div class="line">transport_email_port = 465</div><div class="line">transport_email_use_auth = <span class="literal">true</span></div><div class="line">transport_email_use_tls = <span class="literal">true</span></div><div class="line">transport_email_use_ssl = <span class="literal">true</span></div><div class="line">transport_email_auth_username = chengyangyang@qq.cn</div><div class="line">transport_email_auth_password = beneTqq</div><div class="line">transport_email_subject_prefix = [graylog]</div><div class="line">transport_email_from_email = chengyangyang@qq.cn</div></pre></td></tr></table></figure><p><strong>(4)å¤åˆ¶é…ç½®æ–‡ä»¶</strong></p><p> å› ä¸ºgraylogå®‰è£…binç›®å½•ä¸‹ï¼Œé»˜è®¤å¯åŠ¨é…ç½®æ–‡ä»¶</p><p>é…ç½®æ–‡ä»¶è·¯å¾„ï¼š<code>/etc/graylog/server/server.conf</code></p><p>æ‰€ä»¥éœ€è¦å°†<code>graylog.conf.example</code> å¤åˆ¶åˆ°<code>/etc/graylog/server/</code>ç›®å½•ä¸‹ï¼Œå¹¶ä¸”æ”¹å <code>server.conf</code></p><p>æ‰§è¡Œå‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mkdir -p /etc/graylog/server/ </div><div class="line">cp graylog.conf.example /etc/graylog/server/server.conf</div></pre></td></tr></table></figure><p><strong>(5)å¯åŠ¨graylog</strong></p><p>åœ¨graylogå®‰è£…binç›®å½•ä¸‹æ‰§è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./graylogctl start</div></pre></td></tr></table></figure><p>æŸ¥çœ‹æ—¥å¿—ï¼Œåœ¨graylogå®‰è£…ç›®å½•ä¸‹æ‰§è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tail -200f /<span class="built_in">log</span>/graylog-server.log</div></pre></td></tr></table></figure><p>å¦‚æœæŠ¥é”™ï¼š</p><p>åŸå› ï¼š</p><p>åœ¨mongodbç‰ˆæœ¬2.6ä¹‹åï¼Œæ˜¯éœ€è¦æ—¥å¿—journalingè®¾ç½®çš„ï¼Œè€Œé»˜è®¤æƒ…å†µä¸‹æ˜¯å…³é—­çš„</p><p>è§£å†³åŠæ³•ï¼š</p><p>åœ¨mongodbå¯åŠ¨å‘½ä»¤åŠ ä¸Š â€“journal</p><p>æœ€åå¯åŠ¨å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./mongod --dbpath=/usr/<span class="built_in">local</span>/mongodb/data/ --fork --logpath=/usr/<span class="built_in">local</span>/mongodb/logs --storageEngine=mmapv1 --journal</div></pre></td></tr></table></figure><p>é‡å¯mongodbåï¼Œé‡å¯graylogæœåŠ¡å³å¯ï¼</p><p><strong>(6)å¯åŠ¨graylog(æŠ¥é”™äºŒ)</strong></p><p>æŸ¥çœ‹æ—¥å¿—ï¼Œåœ¨graylogå®‰è£…ç›®å½•ä¸‹æ‰§è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">tail -200f /<span class="built_in">log</span>/graylog-server.log</div></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&#123;com.mongodb.MongoSocketOpenException: Exception opening socket&#125;, caused by &#123;java.net.ConnectException: æ‹’ç»è¿æ¥&#125;&#125;]&#125;. Waiting <span class="keyword">for</span> 30000 ms before timing out</div><div class="line">2016-11-22 15:10:29,355 INFO : org.graylog2.bootstrap.CmdLineTool - Loaded plugin: Elastic Beats Input 1.1.1 [org.graylog.plugins.beats.BeatsInputPlugin]</div><div class="line">2016-11-22 15:10:29,357 INFO : org.graylog2.bootstrap.CmdLineTool - Loaded plugin: Collector 1.1.1 [org.graylog.plugins.collector.CollectorPlugin]</div><div class="line">2016-11-22 15:10:29,357 INFO : org.graylog2.bootstrap.CmdLineTool - Loaded plugin: Enterprise Integration Plugin 1.1.1 [org.graylog.plugins.enterprise_integration.EnterpriseIntegrationPlugin]</div><div class="line">2016-11-22 15:10:29,358 INFO : org.graylog2.bootstrap.CmdLineTool - Loaded plugin: MapWidgetPlugin 1.1.1 [org.graylog.plugins.map.MapWidgetPlugin]</div><div class="line">2016-11-22 15:10:29,359 INFO : org.graylog2.bootstrap.CmdLineTool - Loaded plugin: Pipeline Processor Plugin 1.1.1 [org.graylog.plugins.pipelineprocessor.ProcessorPlugin]</div><div class="line">2016-11-22 15:10:29,359 INFO : org.graylog2.bootstrap.CmdLineTool - Loaded plugin: Anonymous Usage Statistics 2.1.1 [org.graylog.plugins.usagestatistics.UsageStatsPlugin]</div><div class="line">2016-11-22 15:10:29,487 INFO : org.graylog2.bootstrap.CmdLineTool - Running with JVM arguments: -Djava.library.path=./../lib/sigar -Xms1g -Xmx1g -XX:NewRatio=1 -XX:+ResizeTLAB -XX:+UseConcMarkSweepGC -XX:+CMSConcurrentMTEnabled -XX:+CMSClassUnloadingEnabled -XX:+UseParNewGC -XX:-OmitStackTraceInFastThrow</div></pre></td></tr></table></figure><p>æç¤ºmongodb æ‹’ç»è¿æ¥ã€‚ è¿™ä¸ªæ—¶å€™éœ€è¦çœ‹ä¸‹ç«¯å£åœ°å€æ˜¯å¦æ˜¯IPåœ°å€è¿˜æ˜¯127.0.0.1 å¦‚æœä¸æ˜¯éœ€è¦ä¿®æ”¹ä¸‹åœ¨é‡å¯æœåŠ¡å°±å¯ä»¥äº†ã€‚</p><p><strong>æŸ¥çœ‹å¯åŠ¨æœåŠ¡ç«¯å£ï¼š</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">[root@graylog graylog-2.1.1]<span class="comment"># netstat -ntulp</span></div><div class="line">Active Internet connections (only servers)</div><div class="line">Proto Recv-Q Send-Q Local Address               Foreign Address             State       PID/Program name</div><div class="line">tcp        0      0 127.0.0.1:27017             0.0.0.0:*                   LISTEN      22308/mongod</div><div class="line">tcp        0      0 0.0.0.0:22                  0.0.0.0:*                   LISTEN      1974/sshd</div><div class="line">tcp        0      0 127.0.0.1:25                0.0.0.0:*                   LISTEN      1287/master</div><div class="line">tcp        0      0 ::ffff:192.168.1.234:9350   :::*                        LISTEN      23642/java</div><div class="line">tcp        0      0 ::ffff:192.168.1.234:9000   :::*                        LISTEN      23642/java</div><div class="line">tcp        0      0 ::ffff:192.168.1.234:9200   :::*                        LISTEN      18405/java</div><div class="line">tcp        0      0 ::ffff:192.168.1.234:9300   :::*                        LISTEN      18405/java</div><div class="line">tcp        0      0 :::22                       :::*                        LISTEN      1974/sshd</div><div class="line">tcp        0      0 ::1:25                      :::*                        LISTEN      1287/master</div></pre></td></tr></table></figure><p><strong>(6)è®¿é—®graylog</strong></p><p>graylogå¯åŠ¨æˆåŠŸåï¼Œæµè§ˆå™¨è®¿é—®ï¼š<strong>graylogå®‰è£…IP:9000</strong></p><p><figure class="figure"><img src="http://7xrthw.com1.z0.glb.clouddn.com/graylog10.png" alt=""></figure></p><h3 id="å››ï¼šæ€»ç»“"><a href="#å››ï¼šæ€»ç»“" class="headerlink" title="å››ï¼šæ€»ç»“"></a>å››ï¼šæ€»ç»“</h3><p>åˆ°æ­¤ï¼ŒåŸºç¡€çš„é›†ä¸­æ—¥å¿—ç®¡ç†graylogå®‰è£…å®Œæ¯•ï¼ï¼Œåç»­å°†ç»§ç»­ä»‹ç»ï¼š</p><p>å®‰è£…éƒ¨ç½²Graylog Collector Sidecar æ”¶é›†åº”ç”¨æ—¥å¿—</p><p>é‡‡ç”¨syslogæ”¶é›†æ—¥å¿—æ–¹å¼</p><p>graylogä¸€äº›ä½¿ç”¨ï¼ŒåŒ…æ‹¬æ—¥å¿—æˆªå–ï¼Œå‘Šè­¦ç­‰ã€‚</p><p>ä¹‹å‰ä¹Ÿå®è·µè¿‡ELKæŠ€æœ¯æ ˆï¼Œåæ¥é€‰å‹graylogï¼Œæ˜¯åŸºäºgraylogå¸¦æœ‰çš„æƒé™ç®¡ç†ï¼Œå’Œå‘Šè­¦åŠŸèƒ½æ¯”è¾ƒå®Œå–„ï¼</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;graylog-å‡çº§2-1-é›†ä¸­æ—¥å¿—è§£å†³æ–¹æ¡ˆ&quot;&gt;&lt;a href=&quot;#graylog-å‡çº§2-1-é›†ä¸­æ—¥å¿—è§£å†³æ–¹æ¡ˆ&quot; class=&quot;headerlink&quot; title=&quot;graylog å‡çº§2.1 é›†ä¸­æ—¥å¿—è§£å†³æ–¹æ¡ˆ&quot;&gt;&lt;/a&gt;graylog å‡çº§2.1 é›†ä¸­æ—¥å¿—è§£å†³
      
    
    </summary>
    
      <category term="Log Analysis Platform" scheme="http://blog.yancy.cc/categories/Log-Analysis-Platform/"/>
    
    
      <category term="Log analysis platform" scheme="http://blog.yancy.cc/tags/Log-analysis-platform/"/>
    
  </entry>
  
</feed>
