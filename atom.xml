<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Yancy&#39;s blog</title>
  <icon>https://www.gravatar.com/avatar/4bb94619692fa63fbfa18343b7c7965c</icon>
  <subtitle>SIMPLICITY IS PREREQUISITE FOR  RELIABILITY</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://blog.yancy.cc/"/>
  <updated>2018-05-11T10:12:38.000Z</updated>
  <id>http://blog.yancy.cc/</id>
  
  <author>
    <name>Yancy</name>
    <email>yangcvo@gmail.com</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Logstashåˆ†äº«,onlineç”Ÿäº§ç¯å¢ƒçš„ä½¿ç”¨,onlineæ—¥å¿—è§„èŒƒã€‚</title>
    <link href="http://blog.yancy.cc/2017/11/13/%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%10%E5%B9%B3%E5%8F%B0/Elasticsearch/Logstash%E5%88%86%E4%BA%AB,online%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E7%9A%84%E4%BD%BF%E7%94%A8,online%E6%97%A5%E5%BF%97%E8%A7%84%E8%8C%83%E3%80%82/"/>
    <id>http://blog.yancy.cc/2017/11/13/æ—¥å¿—åˆ†æå¹³å°/Elasticsearch/Logstashåˆ†äº«,onlineç”Ÿäº§ç¯å¢ƒçš„ä½¿ç”¨,onlineæ—¥å¿—è§„èŒƒã€‚/</id>
    <published>2017-11-13T09:56:03.000Z</published>
    <updated>2018-05-11T10:12:38.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Logstashåˆ†äº«-onlineç”Ÿäº§ç¯å¢ƒçš„ä½¿ç”¨-onlineæ—¥å¿—è§„èŒƒã€‚"><a href="#Logstashåˆ†äº«-onlineç”Ÿäº§ç¯å¢ƒçš„ä½¿ç”¨-onlineæ—¥å¿—è§„èŒƒã€‚" class="headerlink" title="Logstashåˆ†äº«,onlineç”Ÿäº§ç¯å¢ƒçš„ä½¿ç”¨,onlineæ—¥å¿—è§„èŒƒã€‚"></a>Logstashåˆ†äº«,onlineç”Ÿäº§ç¯å¢ƒçš„ä½¿ç”¨,onlineæ—¥å¿—è§„èŒƒã€‚</h3><p>å†™è¿™ç¯‡æ–‡ç« ï¼Œä¸»è¦åˆ†äº«å‡ ç‚¹: å› ä¸ºå­¦æ‰€æœ‰å­¦ï¼Œæ—¢ç„¶å­¦ä½•ä¸æ·±åº¦å»äº†è§£~</p><ol><li>ä»€ä¹ˆæ˜¯Logstashï¼Ÿ</li><li>logstashè¿è¡Œåœ¨ä»€ä¹ˆç¯å¢ƒä¸‹å¯¹åº”çš„ç‰ˆæœ¬æ˜¯å¤šå°‘ï¼Ÿ</li><li>logstashå·¥ä½œåŸç†ï¼Ÿ</li><li>onlineæ—¥å¿—ç°åœ¨æ˜¯å¦‚ä½•è§„èŒƒï¼Ÿ</li><li>å¦‚ä½•å†™logstashæ”¶é›†confæ–‡ä»¶ï¼Ÿ </li></ol><p><img src="https://community-cdn-digitalocean-com.global.ssl.fastly.net/assets/tutorials/images/large/elk---twitter.png?1428343890" alt=""></p><a id="more"></a><h4 id="1-ä»€ä¹ˆæ˜¯Logstashï¼Ÿ"><a href="#1-ä»€ä¹ˆæ˜¯Logstashï¼Ÿ" class="headerlink" title="1. ä»€ä¹ˆæ˜¯Logstashï¼Ÿ"></a>1. ä»€ä¹ˆæ˜¯Logstashï¼Ÿ</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Logstash æ˜¯æœ‰ç®¡é“è¾“é€èƒ½åŠ›çš„å¼€æºæ•°æ®æ”¶é›†å¼•æ“ã€‚å®ƒå¯ä»¥åŠ¨æ€åœ°ä»åˆ†æ•£çš„æ•°æ®æºæ”¶é›†æ•°æ®ï¼Œå¹¶ä¸”æ ‡å‡†åŒ–æ•°æ®è¾“é€åˆ°ä½ é€‰æ‹©çš„ç›®çš„åœ°ã€‚å®ƒæ˜¯ä¸€æ¬¾æ—¥å¿—è€Œä¸ä»…é™äºæ—¥å¿—çš„æœé›†å¤„ç†æ¡†æ¶ï¼Œå°†åˆ†æ•£å¤šæ ·çš„æ•°æ®æœé›†è‡ªå®šä¹‰å¤„ç†å¹¶è¾“å‡ºåˆ°æŒ‡å®šä½ç½®ã€‚</div></pre></td></tr></table></figure><h4 id="2-logstashè¿è¡Œåœ¨ä»€ä¹ˆç¯å¢ƒä¸‹å¯¹åº”çš„ç‰ˆæœ¬æ˜¯å¤šå°‘ï¼Ÿ"><a href="#2-logstashè¿è¡Œåœ¨ä»€ä¹ˆç¯å¢ƒä¸‹å¯¹åº”çš„ç‰ˆæœ¬æ˜¯å¤šå°‘ï¼Ÿ" class="headerlink" title="2. logstashè¿è¡Œåœ¨ä»€ä¹ˆç¯å¢ƒä¸‹å¯¹åº”çš„ç‰ˆæœ¬æ˜¯å¤šå°‘ï¼Ÿ"></a>2. logstashè¿è¡Œåœ¨ä»€ä¹ˆç¯å¢ƒä¸‹å¯¹åº”çš„ç‰ˆæœ¬æ˜¯å¤šå°‘ï¼Ÿ</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">logstashæ›´æ–°æ¯”è¾ƒå¿«ï¼Œè·Ÿesä¸€æ ·ï¼Œ2.4ä»¥ä¸Šç›´æ¥å‡çº§åˆ°5.0 </div><div class="line"></div><div class="line">5.0xä»¥ä¸‹ç‰ˆæœ¬è¿è¡Œç¯å¢ƒ éœ€è¦JDK1.7ä»¥ä¸Šç‰ˆæœ¬.</div><div class="line">5.0xç‰ˆæœ¬è¿è¡Œç¯å¢ƒ éœ€è¦JDK1.8ä»¥ä¸Šç‰ˆæœ¬ã€‚</div><div class="line"></div><div class="line">å®‰è£…æ–¹æ³•å¾ˆå¤šï¼šyum,rpm,tar.gzæºç ï¼Œ æ”¯æŒDockeré•œåƒè¿è¡Œã€‚</div></pre></td></tr></table></figure><h4 id="3-logstashå·¥ä½œåŸç†ï¼Ÿ"><a href="#3-logstashå·¥ä½œåŸç†ï¼Ÿ" class="headerlink" title="3. logstashå·¥ä½œåŸç†ï¼Ÿ"></a>3. logstashå·¥ä½œåŸç†ï¼Ÿ</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">Logstashä½¿ç”¨ç®¡é“æ–¹å¼è¿›è¡Œæ—¥å¿—çš„æœé›†å¤„ç†å’Œè¾“å‡ºã€‚æœ‰ç‚¹ç±»ä¼¼linuxç³»ç»Ÿçš„ç®¡é“å‘½ä»¤ xxx | ccc | dddï¼Œxxxæ‰§è¡Œå®Œäº†ä¼šæ‰§è¡Œcccï¼Œç„¶åæ‰§è¡Œdddã€‚</div><div class="line"></div><div class="line">logstashæ”¶é›†æ—¥å¿—åŸºæœ¬æµç¨‹: input--&gt;codec--&gt;filter--&gt;codec--&gt;output </div><div class="line">1.input:ä»å“ªé‡Œæ”¶é›†æ—¥å¿—ã€‚ </div><div class="line">2.filter:å‘å‡ºå»å‰è¿›è¡Œè¿‡æ»¤  ï¼ˆä¸æ˜¯å¿…é¡»çš„ï¼‰</div><div class="line">3.output:è¾“å‡ºè‡³Elasticsearchæˆ–Redisæ¶ˆæ¯é˜Ÿåˆ— </div><div class="line">4.codec:è¾“å‡ºè‡³å‰å°ï¼Œæ–¹ä¾¿è¾¹å®è·µè¾¹æµ‹è¯• </div><div class="line">5.æ•°æ®é‡ä¸å¤§æ—¥å¿—æŒ‰ç…§æœˆæ¥è¿›è¡Œæ”¶é›†</div></pre></td></tr></table></figure><p><img src="https://www.elastic.co/guide/en/logstash/current/static/images/basic_logstash_pipeline.png" alt=""></p><h4 id="4-æ—¥å¿—ç°åœ¨æ”¶é›†è§„èŒƒï¼š"><a href="#4-æ—¥å¿—ç°åœ¨æ”¶é›†è§„èŒƒï¼š" class="headerlink" title="4.æ—¥å¿—ç°åœ¨æ”¶é›†è§„èŒƒï¼š"></a>4.æ—¥å¿—ç°åœ¨æ”¶é›†è§„èŒƒï¼š</h4><p>æ˜¯è®°å½•ç”¨æˆ·è®¿é—®è¡Œä¸ºå’ŒæœåŠ¡è¿è¡ŒçŠ¶æ€çš„ä¿¡æ¯ï¼Œæ˜¯åº”ç”¨è½¯ä»¶åŸºæœ¬çš„è¾“å‡ºå•å…ƒï¼Œåšåˆ°æ—¥å¿—è¾“å‡ºä½ç½®ã€å‘½åã€æ ¼å¼è§„èŒƒï¼Œå¯ä»¥å¤§å¤§æ–¹ä¾¿åç»­åº”ç”¨æœåŠ¡ç›‘æ§å’Œæ•°æ®åˆ†æã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">1. æ—¥å¿—ç›®å½•ç»“æ„</div><div class="line">2. æ—¥å¿—ç±»å‹</div><div class="line">3. æ—¥å¿—è¦æ±‚é…ç½®</div><div class="line">4. æ—¥å¿—çº§åˆ«</div><div class="line">5. æ—¥å¿—åˆ†å‰²ä¸å‘¨æœŸ</div><div class="line">6. æ—¥å¿—ä¿ç•™è¦æ±‚</div><div class="line"></div><div class="line">ç°åœ¨æˆ‘ä»¬online æ—¥å¿—è§„èŒƒæ¶æ„ï¼š</div><div class="line"></div><div class="line"><span class="comment">###ä¹‹å‰åº”ç”¨æ—¥å¿—è§„èŒƒï¼š</span></div><div class="line"></div><div class="line">ä¸€ä¸ªTomcatæœåŠ¡logsç›®å½•ä¸‹é¢çš„æ—¥å¿—ï¼šå®šæœŸå¯¹catalina.outå‡ ä¸ªGæŒ‰ä¸¤ä¸ªå°æ—¶è¿›è¡Œå‹ç¼©ä¸€æ¬¡ï¼Œä¿ç•™7å¤©ï¼Œæ¯å¤©å¤‡ä»½åˆ°<span class="built_in">log</span>-serveræœåŠ¡å™¨ã€‚</div><div class="line"></div><div class="line">logstashæ”¶é›†catalina.outæ‰€æœ‰æ—¥å¿—ã€‚</div><div class="line"></div><div class="line"><span class="comment">###ç°åœ¨åº”ç”¨æ—¥å¿—è§„èŒƒ:</span></div><div class="line"></div><div class="line">ä¸€ä¸ªTomcatæœåŠ¡logsç›®å½•ä¸‹é¢çš„æ—¥å¿—ï¼šå®šæœŸå¯¹catalina.outæ¯å¤©1Må¤šæ—¥å¿—è¿›è¡Œå‹ç¼©ä¸€æ¬¡ï¼Œä¿ç•™7å¤©ï¼Œæ¯å¤©å¤‡ä»½åˆ°<span class="built_in">log</span>-serveræœåŠ¡å™¨ã€‚</div><div class="line"></div><div class="line">logstashæ”¶é›†æ¯å°åº”ç”¨è¾“å‡ºåº”ç”¨æ—¥å¿—ï¼šerror.log &amp; info.log</div><div class="line"></div><div class="line">å¥½å¤„åˆ†åˆ«ä¸ºå››ä¸ªï¼š </div><div class="line">1.å¯¹ç´¢å¼•çš„è¦æ±‚ç»†åˆ†å’ŒkibanaæŸ¥è¯¢æ—¥å¿—é€Ÿåº¦æ— ç–‘ä¼šå˜æ›´å¿«ã€‚</div><div class="line">2.æŸ¥è¯¢æ—¥å¿—å¿«é€Ÿå®šä½ã€‚</div><div class="line">3.ä¸ä¼šå¯¹catalina.outæ—¥å¿—è¿›è¡Œå¤§çº§åˆ«æ—¥å¿—å†™å…¥ï¼Œé‚£é‡Œåªå­˜æ”¾ç³»ç»Ÿæ—¥å¿—ï¼Œä¾‹å¦‚ï¼šå‘å¸ƒæ—¥å¿—ï¼Œè¯·æ±‚ç¬¬ä¸‰æ–¹åœ°å€æ—¥å¿—ã€‚</div><div class="line">4.æ—¥å¿—å¼€å‘å¯ä»¥åœ¨Javaä»£ç <span class="built_in">log</span>4jæ–‡ä»¶å¤§å°æŒ‡å®šå‹ç¼©ï¼Œæ¯å¤©å®šæ—¶æ¸…ç©ºï¼Œä¸éœ€è¦æˆ‘ä»¬å†™è„šæœ¬å¤„ç†ã€‚å¤šä¸ªè„šæœ¬å®šæ—¶åœ¨è¿è¡Œï¼Œç‰¹åˆ«ä¹±ã€‚</div></pre></td></tr></table></figure><h4 id="5-å¦‚ä½•å†™logstashæ”¶é›†confæ–‡ä»¶ï¼Ÿ"><a href="#5-å¦‚ä½•å†™logstashæ”¶é›†confæ–‡ä»¶ï¼Ÿ" class="headerlink" title="5.å¦‚ä½•å†™logstashæ”¶é›†confæ–‡ä»¶ï¼Ÿ"></a>5.å¦‚ä½•å†™logstashæ”¶é›†confæ–‡ä»¶ï¼Ÿ</h4><p>ä¸‹é¢æ˜¯æˆ‘å†™å¥½çš„online logstashæ”¶é›†ä»£ç ï¼Œæ ¹æ®ä¹‹å‰æ—¥å¿—æ”¶é›†æ–¹å¼ï¼Œç°åœ¨ä¿®è¿‡å‡ ä¸ªåœ°æ–¹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"> input &#123;</div><div class="line">       stdin&#123;&#125;  <span class="comment">#å¯ä»¥æ ‡å‡†è¾“å…¥è¯»æ•°æ® ï¼ˆå¯ä»¥æ”¾å¯ä»¥ä¸æ”¾ï¼‰</span></div><div class="line">file &#123;</div><div class="line">  <span class="built_in">type</span> =&gt; <span class="string">"tms-task-info"</span></div><div class="line">  path =&gt; [<span class="string">"/data/tms-task_new/logs/info.log"</span>]</div><div class="line">  start_position =&gt; <span class="string">"beginning"</span> <span class="comment">#ä»æ–‡ä»¶å¼€å§‹å¤„è¯»å†™</span></div><div class="line">     &#125;</div><div class="line">file &#123;</div><div class="line">  <span class="built_in">type</span> =&gt; <span class="string">"tms-task-error"</span></div><div class="line">  path =&gt; [<span class="string">"/data/tms-task_new/logs/error.log"</span>]</div><div class="line">  start_position =&gt; <span class="string">"beginning"</span> <span class="comment">#ä»æ–‡ä»¶å¼€å§‹å¤„è¯»å†™</span></div><div class="line">     &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">filter &#123; <span class="comment">#è¿‡æ»¤æ–¹å¼</span></div><div class="line"></div><div class="line">        multiline &#123;</div><div class="line">                        pattern =&gt; <span class="string">"^\d+-\d+-\d+"</span></div><div class="line">                        negate =&gt; <span class="literal">true</span></div><div class="line">                        what =&gt; <span class="string">"previous"</span></div><div class="line">                &#125;</div><div class="line"></div><div class="line">       &#125;</div><div class="line">output &#123;</div><div class="line"><span class="keyword">if</span> [<span class="built_in">type</span>] == <span class="string">"tms-task-info"</span> &#123;</div><div class="line">  elasticsearch &#123;</div><div class="line">          hosts =&gt; [<span class="string">"10.155.90.141:9200"</span>,<span class="string">"10.155.90.176:9200"</span>]</div><div class="line">     index =&gt; <span class="string">"log-tms-task-info-%&#123;+YYYY.MM.dd&#125;"</span></div><div class="line">   document_type =&gt; <span class="string">"log"</span></div><div class="line">      template_overwrite =&gt; <span class="literal">true</span></div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"> <span class="keyword">if</span> [<span class="built_in">type</span>] == <span class="string">"tms-task-error"</span> &#123;</div><div class="line">          elasticsearch &#123;</div><div class="line">          hosts =&gt; [<span class="string">"10.155.90.141:9200"</span>,<span class="string">"10.155.90.176:9200"</span>]</div><div class="line">          index =&gt; <span class="string">"log-tms-task-error-%&#123;+YYYY.MM.dd&#125;"</span></div><div class="line">          document_type =&gt; <span class="string">"log"</span></div><div class="line">          template_overwrite =&gt; <span class="literal">true</span></div><div class="line">        &#125;</div><div class="line">&#125;</div><div class="line">stdout&#123;</div><div class="line">    codec=&gt;rubydebug  <span class="comment">#æ§åˆ¶å°è¾“å‡º (ä¸å»ºè®®é…ç½®ï¼Œæµ‹è¯•é˜¶æ®µå¯ä»¥è°ƒè¯•ä½¿ç”¨)</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h4 id="è§£é‡Š"><a href="#è§£é‡Š" class="headerlink" title="è§£é‡Š"></a>è§£é‡Š</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">æœ‰ä¸€äº›æ¯”è¾ƒæœ‰ç”¨çš„é…ç½®é¡¹ï¼Œå¯ä»¥ç”¨æ¥æŒ‡å®š FileWatch åº“çš„è¡Œä¸ºï¼š</div><div class="line"></div><div class="line">discover_interval</div><div class="line">logstash æ¯éš”å¤šä¹…å»æ£€æŸ¥ä¸€æ¬¡è¢«ç›‘å¬çš„ path ä¸‹æ˜¯å¦æœ‰æ–°æ–‡ä»¶ã€‚é»˜è®¤å€¼æ˜¯ 15 ç§’ã€‚</div><div class="line"></div><div class="line">exclude</div><div class="line">ä¸æƒ³è¢«ç›‘å¬çš„æ–‡ä»¶å¯ä»¥æ’é™¤å‡ºå»ï¼Œè¿™é‡Œè·Ÿ path ä¸€æ ·æ”¯æŒ glob å±•å¼€ã€‚</div><div class="line"></div><div class="line">sincedb_path</div><div class="line">å¦‚æœä½ ä¸æƒ³ç”¨é»˜è®¤çš„ <span class="variable">$HOME</span>/.sincedb(Windows å¹³å°ä¸Šåœ¨ C:\Windows\System32\config\systemprofile\.sincedb)ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªé…ç½®å®šä¹‰ sincedb æ–‡ä»¶åˆ°å…¶ä»–ä½ç½®ã€‚</div><div class="line"></div><div class="line">sincedb_write_interval</div><div class="line">logstash æ¯éš”å¤šä¹…å†™ä¸€æ¬¡ sincedb æ–‡ä»¶ï¼Œé»˜è®¤æ˜¯ 15 ç§’ã€‚</div><div class="line"></div><div class="line">stat_interval</div><div class="line">logstash æ¯éš”å¤šä¹…æ£€æŸ¥ä¸€æ¬¡è¢«ç›‘å¬æ–‡ä»¶çŠ¶æ€ï¼ˆæ˜¯å¦æœ‰æ›´æ–°ï¼‰ï¼Œé»˜è®¤æ˜¯ 1 ç§’ã€‚</div><div class="line"></div><div class="line">start_position</div><div class="line">logstash ä»ä»€ä¹ˆä½ç½®å¼€å§‹è¯»å–æ–‡ä»¶æ•°æ®ï¼Œé»˜è®¤æ˜¯ç»“æŸä½ç½®ï¼Œä¹Ÿå°±æ˜¯è¯´ logstash è¿›ç¨‹ä¼šä»¥ç±»ä¼¼ tail -F çš„å½¢å¼è¿è¡Œã€‚å¦‚æœä½ æ˜¯è¦å¯¼å…¥åŸæœ‰æ•°æ®ï¼ŒæŠŠè¿™ä¸ªè®¾å®šæ”¹æˆ <span class="string">"beginning"</span>ï¼Œlogstash è¿›ç¨‹å°±ä»å¤´å¼€å§‹è¯»å–ï¼Œæœ‰ç‚¹ç±»ä¼¼ catï¼Œä½†æ˜¯è¯»åˆ°æœ€åä¸€è¡Œä¸ä¼šç»ˆæ­¢ï¼Œè€Œæ˜¯ç»§ç»­å˜æˆ tail -Fã€‚</div></pre></td></tr></table></figure><p>é…ç½®è¯¦è§£ï¼šå‚è€ƒä¸­æ–‡æ–‡æ¡£<a href="https://doc.yonyoucloud.com/doc/logstash-best-practice-cn/input/file.html" target="_blank" rel="external">logstash-best-practice-cn</a><br>å®˜ç½‘è¯¦ç»†è¯´æ˜ï¼š<a href="https://www.elastic.co/guide/en/logstash/current/multiple-input-output-plugins.html" target="_blank" rel="external">multiple-input-output-plugins</a></p><h3 id="Communicative-learning"><a href="#Communicative-learning" class="headerlink" title="Communicative learning:"></a>Communicative learning:</h3><p>ğŸ§  Linux shell_ senior operation and maintenance faction: QQ group <code>459096184</code> circle (system operation and maintenance - application operation and maintenance - automation operation and maintenance - virtualization technology research, welcome to join)<br>ğŸ§  BigData-Exchange School:QQ group <code>521621407</code> circles (big data Yun Wei) (Hadoop developer) (big data research enthusiasts) welcome to join</p><p>Bidata have internal WeChat exchange group, learn from each other, join QQ group has links.</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;Logstashåˆ†äº«-onlineç”Ÿäº§ç¯å¢ƒçš„ä½¿ç”¨-onlineæ—¥å¿—è§„èŒƒã€‚&quot;&gt;&lt;a href=&quot;#Logstashåˆ†äº«-onlineç”Ÿäº§ç¯å¢ƒçš„ä½¿ç”¨-onlineæ—¥å¿—è§„èŒƒã€‚&quot; class=&quot;headerlink&quot; title=&quot;Logstashåˆ†äº«,onlineç”Ÿäº§ç¯å¢ƒçš„ä½¿ç”¨,onlineæ—¥å¿—è§„èŒƒã€‚&quot;&gt;&lt;/a&gt;Logstashåˆ†äº«,onlineç”Ÿäº§ç¯å¢ƒçš„ä½¿ç”¨,onlineæ—¥å¿—è§„èŒƒã€‚&lt;/h3&gt;&lt;p&gt;å†™è¿™ç¯‡æ–‡ç« ï¼Œä¸»è¦åˆ†äº«å‡ ç‚¹: å› ä¸ºå­¦æ‰€æœ‰å­¦ï¼Œæ—¢ç„¶å­¦ä½•ä¸æ·±åº¦å»äº†è§£~&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä»€ä¹ˆæ˜¯Logstashï¼Ÿ&lt;/li&gt;
&lt;li&gt;logstashè¿è¡Œåœ¨ä»€ä¹ˆç¯å¢ƒä¸‹å¯¹åº”çš„ç‰ˆæœ¬æ˜¯å¤šå°‘ï¼Ÿ&lt;/li&gt;
&lt;li&gt;logstashå·¥ä½œåŸç†ï¼Ÿ&lt;/li&gt;
&lt;li&gt;onlineæ—¥å¿—ç°åœ¨æ˜¯å¦‚ä½•è§„èŒƒï¼Ÿ&lt;/li&gt;
&lt;li&gt;å¦‚ä½•å†™logstashæ”¶é›†confæ–‡ä»¶ï¼Ÿ &lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&quot;https://community-cdn-digitalocean-com.global.ssl.fastly.net/assets/tutorials/images/large/elk---twitter.png?1428343890&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Log Analysis Platform" scheme="http://blog.yancy.cc/categories/Log-Analysis-Platform/"/>
    
    
      <category term="logstash" scheme="http://blog.yancy.cc/tags/logstash/"/>
    
  </entry>
  
  <entry>
    <title>KafKaä»0.8.2.1å‡çº§åˆ°0.9.0.1å˜åŒ–æ–¹æ¡ˆä¸æ­¥éª¤</title>
    <link href="http://blog.yancy.cc/2017/11/04/Bigdata-hadoop/Kafka/KafKa%E4%BB%8E0.8.2.1%E5%8D%87%E7%BA%A7%E5%88%B00.9.0.1%E5%8F%98%E5%8C%96%E6%96%B9%E6%A1%88%E4%B8%8E%E6%AD%A5%E9%AA%A4/"/>
    <id>http://blog.yancy.cc/2017/11/04/Bigdata-hadoop/Kafka/KafKaä»0.8.2.1å‡çº§åˆ°0.9.0.1å˜åŒ–æ–¹æ¡ˆä¸æ­¥éª¤/</id>
    <published>2017-11-04T03:22:00.000Z</published>
    <updated>2017-12-03T06:29:16.000Z</updated>
    
    <content type="html"><![CDATA[<p>ğŸŠæˆ‘è¿™é‡Œæ˜¯é‡‡ç”¨,ç¾¤é›†å‡çº§,å…¨éƒ¨æ›´æ–°åœæ­¢è€ç‰ˆæœ¬zkå’Œkafkaæ›´æ–°æœåŠ¡ã€‚</p><p>9.0.0æœ‰æ½œåœ¨çš„ä¸­æ–­æ›´æ”¹é£é™©ï¼ˆåœ¨å‡çº§ä¹‹å‰éœ€è¦çŸ¥é“ï¼‰ï¼Œå¹¶ä¸”ä¸ä¹‹å‰ç‰ˆæœ¬çš„brokerä¹‹é—´çš„åè®®æ”¹å˜ã€‚è¿™æ„å‘³ç€æ­¤æ¬¡å‡çº§å¯èƒ½å’Œå®¢æˆ·ç«¯æ—§ç‰ˆæœ¬ä¸å…¼å®¹ã€‚å› æ­¤åœ¨å‡çº§å®¢æˆ·ç«¯ä¹‹å‰ï¼Œå…ˆå‡çº§kafkaé›†ç¾¤ã€‚å¦‚æœä½ ä½¿ç”¨MirrorMakerä¸‹æ¸¸é›†ç¾¤ï¼Œåˆ™åŒæ ·åº”é¦–å…ˆå‡çº§ã€‚</p><p><img src="https://blogs.apache.org/hbase/mediaresource/0b77f435-da5c-4696-a1b5-f35bc4139b7b" alt=""></p><a id="more"></a><h3 id="æ»šåŠ¨å‡çº§"><a href="#æ»šåŠ¨å‡çº§" class="headerlink" title="æ»šåŠ¨å‡çº§"></a>æ»šåŠ¨å‡çº§</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">å‡çº§æ‰€æœ‰brokerçš„server<span class="selector-class">.properties</span>,å¹¶åœ¨å…¶ä¸­æ·»åŠ </div><div class="line">inter<span class="selector-class">.broker</span><span class="selector-class">.protocol</span><span class="selector-class">.version</span> = <span class="number">0.8</span>.<span class="number">2</span><span class="selector-class">.X</span></div><div class="line">æ¯æ¬¡å‡çº§ä¸€ä¸ªbrokerï¼šå…³é—­brokerï¼Œæ›¿æ¢æ–°ç‰ˆæœ¬ï¼Œç„¶åé‡æ–°å¯åŠ¨ã€‚</div></pre></td></tr></table></figure><h3 id="ç¾¤é›†å‡çº§"><a href="#ç¾¤é›†å‡çº§" class="headerlink" title="ç¾¤é›†å‡çº§"></a>ç¾¤é›†å‡çº§</h3><p>ä¸€æ—¦æ•´ä¸ªç¾¤é›†å‡çº§ï¼Œé€šè¿‡ç¼–è¾‘inter.broker.protocol.versionå¹¶å°†å…¶è®¾ç½®ä¸º0.9.0.0æ¥è½¬æ¢æ‰€æœ‰åè®®ã€‚<br>é€ä¸ªé‡æ–°å¯åŠ¨brokerï¼Œä½¿æ–°åè®®ç‰ˆæœ¬ç”Ÿæ•ˆã€‚<br>æ³¨æ„ ï¼šå¦‚æœä½ å¯æ¥å—åœæœºï¼Œä½ å¯ä»¥ç®€å•åœ°å°†æ‰€æœ‰brokerå…³é—­ï¼Œæ›´æ–°ç‰ˆæœ¬å¹¶é‡å¯å¯åŠ¨ï¼Œåè®®å°†é»˜è®¤ä»æ–°ç‰ˆæœ¬å¼€å§‹ã€‚<br>æ³¨æ„ ï¼šå˜æ¢åè®®ç‰ˆæœ¬å’Œé‡å¯å¯åŠ¨å¯ä»¥åœ¨brokerå‡çº§å®Œæˆåçš„ä»»ä½•æ—¶é—´å»åšï¼Œä¸å¿…é©¬ä¸Šåšã€‚</p><h4 id="0-9-0-0æ½œåœ¨çš„ä¸­æ–­å˜åŒ–"><a href="#0-9-0-0æ½œåœ¨çš„ä¸­æ–­å˜åŒ–" class="headerlink" title="0.9.0.0æ½œåœ¨çš„ä¸­æ–­å˜åŒ–"></a>0.9.0.0æ½œåœ¨çš„ä¸­æ–­å˜åŒ–</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">Java 1.6ä¸å†æ”¯æŒï¼Œéœ€è¦Jdk1.7ç‰ˆæœ¬ä»¥ä¸Šã€‚</div><div class="line">Scala 2.9ä¸å†æ”¯æŒã€‚</div><div class="line"></div><div class="line">é»˜è®¤æƒ…å†µä¸‹ï¼Œ1000ä»¥ä¸Šçš„Broker IDä¸ºè‡ªåŠ¨åˆ†é…ã€‚å¦‚æœä½ çš„é›†ç¾¤é«˜äºè¯¥é˜ˆå€¼ï¼Œéœ€ç›¸åº”åœ°å¢åŠ </div><div class="line">reserved.broker.max.idé…ç½®ã€‚</div><div class="line"></div><div class="line">replica.lag.max.messagesé…ç½®å·²ç»ç§»é™¤ã€‚åˆ†åŒºleaderåœ¨å†³å®šå“ªäº›å‰¯æœ¬å¤„äºåŒæ­¥æ—¶å°†ä¸å†è€ƒè™‘è½åçš„æ¶ˆæ¯çš„æ•°ã€‚</div><div class="line"></div><div class="line">é…ç½®å‚æ•°replica.lag.time.max.msç°åœ¨ä¸ä»…æŒ‡è‡ªä¸Šæ¬¡ä»å‰¯æœ¬è·å–è¯·æ±‚åç»è¿‡çš„æ—¶é—´ï¼Œè¿˜æŒ‡è‡ªå‰¯æœ¬ä¸Šæ¬¡è¢«æ•è·ä»¥æ¥çš„æ—¶é—´ã€‚ å‰¯æœ¬ä»ç„¶ä»leaderè·å–æ¶ˆæ¯ï¼Œä½†è¶…è¿‡replica.lag.time.max.msé…ç½®çš„æœ€æ–°æ¶ˆæ¯å°†è¢«è®¤ä¸ºä¸åŒæ­¥çš„ã€‚</div><div class="line"></div><div class="line">å‹ç¼©çš„topicä¸å†æ¥å—æ²¡æœ‰keyçš„æ¶ˆæ¯ï¼Œå¦‚æœå‡ºç°ï¼Œç”Ÿäº§è€…å°†æŠ›å‡ºå¼‚å¸¸ã€‚ åœ¨0.8.xä¸­ï¼Œæ²¡æœ‰keyçš„æ¶ˆæ¯å°†å¯¼è‡´æ—¥å¿—å‹ç¼©çº¿ç¨‹é€€å‡ºï¼ˆå¹¶åœæ­¢æ‰€æœ‰å‹ç¼©çš„topicï¼‰ã€‚</div><div class="line"></div><div class="line">MirrorMakerä¸å†æ”¯æŒå¤šä¸ªç›®æ ‡é›†ç¾¤ã€‚ å®ƒåªæ¥å—ä¸€ä¸ª--consumer.configã€‚ è¦é•œåƒå¤šä¸ªæºé›†ç¾¤ï¼Œæ¯ä¸ªæºé›†ç¾¤è‡³å°‘éœ€è¦ä¸€ä¸ªMirrorMakerå®ä¾‹ï¼Œæ¯ä¸ªæºé›†ç¾¤éƒ½æœ‰è‡ªå·±çš„æ¶ˆè´¹è€…é…ç½®ã€‚</div><div class="line"></div><div class="line">åœ¨org.apache.kafka.clients.toolsã€‚åŒ…ä¸‹çš„Toolså·²ç§»è‡³org.apache.kafka.toolsã€‚ã€‚ æ‰€æœ‰åŒ…å«çš„è„šæœ¬ä»å°†ç…§å¸¸å·¥ä½œï¼Œåªæœ‰ç›´æ¥å¯¼å…¥è¿™äº›ç±»çš„è‡ªå®šä¹‰ä»£ç å°†å—åˆ°å½±å“ã€‚</div><div class="line"></div><div class="line">åœ¨kafka-run-class.shä¸­æ›´æ”¹äº†é»˜è®¤çš„Kafka JVMæ€§èƒ½é€‰é¡¹ï¼ˆKAFKA_JVM_PERFORMANCE_OPTSï¼‰ã€‚</div><div class="line"></div><div class="line">kafka-topics.shè„šæœ¬ï¼ˆkafka.admin.TopicCommandï¼‰ç°åœ¨é€€å‡ºï¼Œå¤±è´¥æ—¶å‡ºç°éé›¶é€€å‡ºä»£ç ã€‚</div><div class="line"></div><div class="line">kafka-topics.shè„šæœ¬ï¼ˆkafka.admin.TopicCommandï¼‰ç°åœ¨å°†åœ¨topicåç§°ç”±äºä½¿ç”¨â€œ.â€æˆ–â€œ_â€è€Œå¯¼è‡´é£é™©åº¦é‡æ ‡å‡†å†²çªæ—¶æ‰“å°è­¦å‘Šã€‚ä»¥åŠå†²çªçš„æƒ…å†µä¸‹çš„é”™è¯¯ã€‚</div><div class="line"></div><div class="line">kafka-console-producer.shè„šæœ¬ï¼ˆkafka.tools.ConsoleProducerï¼‰å°†é»˜è®¤ä½¿ç”¨æ–°çš„Java Producerï¼Œç”¨æˆ·å¿…é¡»æŒ‡å®šâ€œold-producerâ€æ‰èƒ½ä½¿ç”¨æ—§ç”Ÿäº§è€…ã€‚</div><div class="line">é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰å‘½ä»¤è¡Œå·¥å…·éƒ½ä¼šå°†æ‰€æœ‰æ—¥å¿—æ¶ˆæ¯æ‰“å°åˆ°stderrè€Œä¸æ˜¯stdoutã€‚</div></pre></td></tr></table></figure><h4 id="0-9-0-1ä¸­çš„æ˜¾è‘—å˜åŒ–"><a href="#0-9-0-1ä¸­çš„æ˜¾è‘—å˜åŒ–" class="headerlink" title="0.9.0.1ä¸­çš„æ˜¾è‘—å˜åŒ–"></a>0.9.0.1ä¸­çš„æ˜¾è‘—å˜åŒ–</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">å¯ä»¥é€šè¿‡å°†broker.id.generation.enableè®¾ç½®ä¸º<span class="literal">false</span>æ¥ç¦ç”¨æ–°çš„broker IDç”ŸæˆåŠŸèƒ½ã€‚</div><div class="line"></div><div class="line">é»˜è®¤æƒ…å†µä¸‹ï¼Œé…ç½®å‚æ•°log.cleaner.enableä¸º<span class="literal">true</span>ã€‚ è¿™æ„å‘³ç€topicä¼šæ¸…ç†ã€‚</div><div class="line">policy = compactç°åœ¨å°†è¢«é»˜è®¤å‹ç¼©ï¼Œå¹¶ä¸”128MBçš„å †ï¼ˆé€šè¿‡log.cleaner.dedupe.buffer.sizeï¼‰åˆ†é…ç»™æ¸…æ´—è¿›ç¨‹ã€‚ä½ å¯èƒ½éœ€è¦æ ¹æ®ä½ å¯¹å‹ç¼©topicçš„ä½¿ç”¨æƒ…å†µï¼ŒæŸ¥çœ‹log.cleaner.dedupe.buffer.sizeå’Œå…¶ä»–log.cleaneré…ç½®å€¼ã€‚</div><div class="line"></div><div class="line">é»˜è®¤æƒ…å†µä¸‹ï¼Œæ–°æ¶ˆè´¹è€…çš„é…ç½®å‚æ•°fetch.min.bytesçš„é»˜è®¤å€¼ä¸º1ã€‚</div></pre></td></tr></table></figure><h4 id="0-9-0-0å¼ƒç”¨çš„"><a href="#0-9-0-0å¼ƒç”¨çš„" class="headerlink" title="0.9.0.0å¼ƒç”¨çš„"></a>0.9.0.0å¼ƒç”¨çš„</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">kafka-topics.shè„šæœ¬çš„å˜æ›´topicé…ç½®å·²å¼ƒç”¨ï¼ˆkafka.admin.ConfigCommandï¼‰ï¼Œä»¥åå°†ä½¿ç”¨kafka-configs.sh(kafka.admin.ConfigCommand) ã€‚</div><div class="line"></div><div class="line">kafka-consumer-offset-checker.sh(kafka.tools.ConsumerOffsetChecker)å·²å¼ƒç”¨ï¼Œä»¥åå°†ä½¿ç”¨kafka-consumer-groups.sh (kafka.admin.ConsumerGroupCommand)</div><div class="line"></div><div class="line">kafka.tools.ProducerPerformanceå·²å¼ƒç”¨ã€‚ä»¥åå°†ä½¿ç”¨org.apache.kafka.tools.ProducerPerformanceï¼ˆkafka-producer-perf-test.shä¹Ÿå°†ä½¿ç”¨æ–°ç±»ï¼‰</div><div class="line"></div><div class="line">ç”Ÿäº§è€…çš„block.on.buffer.fullå·²å¼ƒç”¨ï¼Œå¹¶å°†åœ¨ä»¥åçš„ç‰ˆæœ¬ä¸­ç§»é™¤ã€‚ç›®å‰å…¶é»˜è®¤å·²ç»æ›´ä¸º<span class="literal">false</span>ã€‚KafkaProducerå°†ä¸å†æŠ›å‡ºBufferExhaustedExceptionï¼Œè€Œæ˜¯ä½¿ç”¨max.block.msæ¥ä¸­æ­¢ï¼Œä¹‹åå°†æŠ›å‡ºTimeoutExceptionã€‚å¦‚æœblock.on.buffer.fullå±æ€§æ˜ç¡®åœ°è®¾ç½®ä¸º<span class="literal">true</span>ï¼Œå®ƒå°†è®¾ç½®max.block.msä¸ºLong.MAX_VALUEå’Œmetadata.fetch.timeout.mså°†ä¸æ‰§è¡Œã€‚</div></pre></td></tr></table></figure><h4 id="å‡çº§å‡†å¤‡æ­¥éª¤ï¼š"><a href="#å‡çº§å‡†å¤‡æ­¥éª¤ï¼š" class="headerlink" title="å‡çº§å‡†å¤‡æ­¥éª¤ï¼š"></a>å‡çº§å‡†å¤‡æ­¥éª¤ï¼š</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div></pre></td><td class="code"><pre><div class="line">ï¼ˆ0ï¼‰</div><div class="line">wget http://mirror.bit.edu.cn/apache/kafka/0.9.0.1/kafka_2.10-0.9.0.1.tgz</div><div class="line">tar -xvf kafka_2.10-0.9.0.1.tgz</div><div class="line"></div><div class="line">[jollybi@kafka1 tools]$ ll</div><div class="line">total 88100</div><div class="line">drwxr-xr-x  7 jollybi jollybi     4096 Jul 14 13:07 kafka_2.10-0.8.2.1</div><div class="line">-rw-rw-r--  1 jollybi jollybi 16162559 Jul 14 11:40 kafka_2.10-0.8.2.1.tgz</div><div class="line">drwxr-xr-x  6 jollybi jollybi     4096 Feb 12  2016 kafka_2.10-0.9.0.1</div><div class="line">-rw-rw-r--  1 jollybi jollybi 35725063 Jun 20 20:11 kafka_2.10-0.9.0.1.tgz</div><div class="line">drwxr-xr-x 12 jollybi jollybi     4096 Sep 25 16:41 zookeeper-3.4.5</div><div class="line">-rw-rw-r--  1 jollybi jollybi 38307840 Jul 14 11:40 zookeeper-3.4.5.tar</div><div class="line"></div><div class="line">[jollybi@kafka1 tools]$ mkdir -p /data/tools/kafka_2.10-0.9.0.1/kafka-logs</div><div class="line">[jollybi@kafka1 tools]$ mkdir -p /data/tools/kafka_2.10-0.9.0.1/logs</div><div class="line"></div><div class="line"><span class="comment">###ä¿®æ”¹é…ç½®ï¼š</span></div><div class="line"></div><div class="line">(1)</div><div class="line">[jollybi@kafka1 tools]$ vim kafka_2.10-0.9.0.1/config/zookeeper.properties</div><div class="line">ç¬¬ä¸€æ­¥ä¿®æ”¹:</div><div class="line"><span class="comment"># the directory where the snapshot is stored.</span></div><div class="line">dataDir=dataDir=/data/jollybi/tools/zookeeper-3.4.5/tmp</div><div class="line"><span class="comment"># the port at which the clients will connect</span></div><div class="line">clientPort=2281</div><div class="line"><span class="comment"># disable the per-ip limit on the number of connections since this is a non-production config</span></div><div class="line">maxClientCnxns=0</div><div class="line">dataDir,clientPortçš„æ„ä¹‰ä¸éœ€è¦è¯´æ˜äº†ï¼Œå¯¹äºmaxClientCnxnsé€‰é¡¹ï¼Œå¦‚æœä¸è®¾ç½®æˆ–è€…è®¾ç½®ä¸º0ï¼Œåˆ™æ¯ä¸ªipè¿æ¥zookeeperæ—¶çš„è¿æ¥æ•°æ²¡æœ‰é™åˆ¶ã€‚</div><div class="line">éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè®¾ç½®maxClientCnxnsçš„å€¼æ—¶éœ€è¦æŠŠkafka serverçš„è¿æ¥æ•°è€ƒè™‘è¿›å»ï¼Œå› ä¸ºå¯åŠ¨kafka serveræ—¶ï¼Œkafka serverä¹Ÿä¼šè¿æ¥zookeeperçš„ã€‚</div><div class="line"></div><div class="line">(2)</div><div class="line">[jollybi@kafka1 tools]$ vim kafka_2.10-0.9.0.1/config/consumer.properties</div><div class="line">zookeeper.connect=10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281</div><div class="line">å…¶ä»–å‚æ•°æ ¹æ®ä¸åŒé›†ç¾¤ç¯å¢ƒè°ƒæ•´</div><div class="line"></div><div class="line">(3)</div><div class="line">[jollybi@kafka1 tools]$ vim kafka_2.10-0.9.0.1/config/producer.properties (ä¿®æ”¹å†…ç½‘IP)</div><div class="line">metadata.broker.list=10.155.90.153:9292,10.155.90.155:9292,10.155.90.138:9292</div><div class="line">producer.type=sync</div><div class="line">compression.codec=none</div><div class="line">serializer.class=kafka.serializer.DefaultEncoder</div><div class="line">å…¶ä»–å‚æ•°æ ¹æ®ä¸åŒé›†ç¾¤ç¯å¢ƒè°ƒæ•´</div><div class="line"></div><div class="line">(4) </div><div class="line">[jollybi@kafka1 config]$ cat server.properties | grep -Pv <span class="string">"^#|^$"</span></div><div class="line">broker.id=1</div><div class="line">auto.leader.rebalance.enable = <span class="literal">true</span></div><div class="line">listeners=PLAINTEXT://10.155.90.153:9292</div><div class="line">port=9292</div><div class="line">host.name=10.155.90.153</div><div class="line">zookeeper.connect=10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281</div><div class="line">zookeeper.connection.timeout.ms=6000</div><div class="line">num.network.threads=3</div><div class="line">num.io.threads=8</div><div class="line">socket.send.buffer.bytes=102400</div><div class="line">socket.receive.buffer.bytes=102400</div><div class="line">socket.request.max.bytes=104857600</div><div class="line">log.dirs=/data/tools/kafka_2.10-0.9.0.1/kafka-logs</div><div class="line">log.cleaner.enable=<span class="literal">true</span></div><div class="line">delete.topic.enable=<span class="literal">true</span></div><div class="line">num.partitions=1</div><div class="line">num.recovery.threads.per.data.dir=1</div><div class="line">log.retention.hours=96</div><div class="line">log.segment.bytes=1073741824</div><div class="line">log.retention.check.interval.ms=300000</div><div class="line"></div><div class="line">å¤‡æ³¨ï¼šlistenersä¸€å®šè¦é…ç½®æˆä¸ºIPåœ°å€ï¼›å¦‚æœé…ç½®ä¸ºlocalhostæˆ–æœåŠ¡å™¨çš„hostname,åœ¨ä½¿ç”¨javaå‘é€æ•°æ®æ—¶å°±ä¼šæŠ›å‡ºå¼‚ å¸¸ï¼šorg.apache.kafka.common.errors.TimeoutException: Batch Expired ã€‚å› ä¸ºåœ¨æ²¡æœ‰é…ç½®advertised.host.name çš„æƒ…å†µä¸‹ï¼ŒKafkaå¹¶æ²¡æœ‰åƒå®˜æ–¹æ–‡æ¡£å®£ç§°çš„é‚£æ ·æ”¹ä¸ºå¹¿æ’­æˆ‘ä»¬é…ç½®çš„hostnameï¼Œè€Œæ˜¯å¹¿æ’­äº†ä¸»æœºé…ç½®çš„hostnameã€‚è¿œç«¯çš„å®¢æˆ·ç«¯å¹¶æ²¡æœ‰é…ç½® hostsï¼Œæ‰€ä»¥è‡ªç„¶æ˜¯è¿æ¥ä¸ä¸Šè¿™ä¸ªhostnameçš„</div></pre></td></tr></table></figure><h4 id="kafkaä¸zkå†…å­˜æ—¥å¿—ä¼˜åŒ–"><a href="#kafkaä¸zkå†…å­˜æ—¥å¿—ä¼˜åŒ–" class="headerlink" title="kafkaä¸zkå†…å­˜æ—¥å¿—ä¼˜åŒ–"></a>kafkaä¸zkå†…å­˜æ—¥å¿—ä¼˜åŒ–</h4><p>æˆ‘ä¸ªäººåšå®¢æœ‰å†™ä¼˜åŒ–æ–‡æ¡£<br><a href="http://blog.yancy.cc/2017/08/27/Bigdata-hadoop/zookeeper/Bigdata-Zookeeper%E9%9B%86%E7%BE%A4%E6%97%A5%E5%BF%97%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3%E5%92%8C%E6%B8%85%E7%90%86%E8%87%AA%E5%AE%9A%E4%B9%89%E5%90%AF%E5%8A%A8%E5%86%85%E5%AD%98%20/">Bigdata-Zookeeperé›†ç¾¤æ—¥å¿—é…ç½®è¯¦è§£å’Œæ¸…ç†è‡ªå®šä¹‰å¯åŠ¨å†…å­˜</a><br><a href="http://blog.yancy.cc/2017/07/04/Bigdata-hadoop/Kafka/kafka%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E2%80%93JVM%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE%E4%BC%98%E5%8C%96/">Kafkaæ€§èƒ½ä¼˜åŒ–â€“JVMå‚æ•°é…ç½®ä¼˜åŒ–</a><br><a href="http://blog.yancy.cc/2017/03/30/Bigdata-hadoop/Kafka/Kafka%E6%97%A5%E5%BF%97%E5%AD%98%E5%82%A8%E8%A7%A3%E6%9E%90%E4%B8%8E%E5%AE%9E%E8%B7%B5%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E4%BC%98%E5%8C%96/">Kafkaæ—¥å¿—å­˜å‚¨è§£æä¸å®è·µæ•°æ®å­˜å‚¨ä¼˜åŒ–</a></p><h4 id="å‡çº§æ­¥éª¤æ–¹æ¡ˆï¼š"><a href="#å‡çº§æ­¥éª¤æ–¹æ¡ˆï¼š" class="headerlink" title="å‡çº§æ­¥éª¤æ–¹æ¡ˆï¼š"></a>å‡çº§æ­¥éª¤æ–¹æ¡ˆï¼š</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">(0) mongodb èƒ½å­˜å‚¨æ—¶é—´æˆ³4ä¸ªå°æ—¶çš„æ•°æ®ï¼Œåœ¨4ä¸ªå°æ—¶ä¹‹å†…å‡çº§ä¸ä¼šæœ‰é£é™©ã€‚</div><div class="line">(1) mongotail å…ˆåœæ­¢ç”Ÿäº§å†™å…¥æ•°æ®åˆ°kafka</div><div class="line">(2) kafka æ¶ˆè´¹ç»„ç»§ç»­æ¶ˆè´¹ topicåˆ†åŒºæŸ¥çœ‹æ¶ˆè´¹ä¸ºé›¶ã€‚</div><div class="line">(3) zkéœ€è¦å‡çº§3.4.6ç‰ˆæœ¬å¯¹åº”kafka0.9.1ç‰ˆæœ¬ï¼Œå¦‚æœzkä¸éœ€è¦å‡çº§ï¼Œå‡çº§ä¹‹å‰è¦å…ˆå°†ZooKeeperä¸­åŸç‰ˆæœ¬çš„kafkaç”Ÿæˆçš„znodeåˆ é™¤ï¼ŒåŒ…æ‹¬ï¼šconsumers, controller, brokers, controller_epochç­‰ã€‚å¦åˆ™å¯åŠ¨kafkaä¼šæŠ¥é”™ã€‚</div><div class="line">(4) é‡å¯æ–°ç‰ˆæœ¬zké›†ç¾¤ï¼ŒæŸ¥çœ‹é›†ç¾¤æœåŠ¡é€‰ä¸¾æ˜¯å¦æ­£å¸¸ã€‚</div><div class="line">(5) é‡å¯æ–°ç‰ˆæœ¬kafkaé›†ç¾¤ï¼Œé‡å¯æ²¡æœ‰æŠ¥é”™ï¼ŒæŸ¥çœ‹ç‰ˆæœ¬æ²¡é—®é¢˜å°±è¡Œã€‚</div><div class="line">(6) zkä¸Šé¢æŸ¥çœ‹å‘½ä»¤</div><div class="line"> ./zkCli.sh -server 10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281</div><div class="line">[zk: 10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281(CONNECTED) 0] ls /</div><div class="line"></div><div class="line">controller_epoch          controller                brokers                   zookeeper                 kafka-manager             admin                     isr_change_notification   consumers                 config</div><div class="line">[zk: 10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281(CONNECTED) 0] ls /brokers/ids</div><div class="line">[1, 2, 3]  </div><div class="line">é›†ç¾¤ä¸‰ä¸ªbrokers idæ­£å¸¸</div><div class="line">(7)ä¿®æ”¹ç›‘æ§æŒ‡æ ‡ã€‚ å®Œæˆå‡çº§</div><div class="line"></div><div class="line">(8) å¦å¤–ï¼Œæ–°ç‰ˆæœ¬çš„ä¸€äº›å‘½ä»¤ä¸åŸç‰ˆæœ¬çš„æœ‰äº›ç›¸åŒ,å¢åˆ æ”¹æŸ¥å‘½ä»¤ã€‚</div></pre></td></tr></table></figure><h4 id="å¼€å§‹å‡çº§æ­¥éª¤æ“ä½œï¼š"><a href="#å¼€å§‹å‡çº§æ­¥éª¤æ“ä½œï¼š" class="headerlink" title="å¼€å§‹å‡çº§æ­¥éª¤æ“ä½œï¼š"></a>å¼€å§‹å‡çº§æ­¥éª¤æ“ä½œï¼š</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">ï¼ˆ1)å¯åŠ¨zkä¸kafka</div><div class="line"><span class="comment"># /data/tools/zookeeper-3.4.6/bin/zkServer.sh start</span></div><div class="line"><span class="comment"># /data/tools/kafka_2.10-0.9.0.1/bin/kafka-server-start.sh /data/tools/ kafka_2.10-0.9.0.1/config/server.properties &amp;</span></div><div class="line"></div><div class="line">ï¼ˆ2ï¼‰æ–°å»ºtopic</div><div class="line"><span class="comment">#./bin/kafka-topics.sh --create --zookeeper 10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281 --replication-factor 3 --partitions 12  --topic mongotail_lz4_imp </span></div><div class="line"><span class="comment">#./bin/kafka-topics.sh --create --zookeeper 10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281 --replication-factor 3 --partitions 12  --topic mongotail_lz4</span></div><div class="line"></div><div class="line">(3) æŸ¥çœ‹é›†ç¾¤topicåˆ†åŒºæƒ…å†µ</div><div class="line"><span class="comment">#./bin/kafka-topics.sh  --describe --zookeeper 10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281 --topic mongotail_lz4</span></div><div class="line"></div><div class="line">(4) æ›´æ–°æ‰€æœ‰å¼€æºç›‘æ§ï¼ˆKafkaOffsetMonitorï¼‰</div><div class="line">vim /home/jollybi/./monitor/monitor.sh</div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line">java -Xms512M -Xmx512M -Xss1024K -XX:PermSize=256m -XX:MaxPermSize=512m -cp KafkaOffsetMonitor-assembly-0.2.0_modify.jar com.quantifind.kafka.offsetapp.OffsetGetterWeb --zk 10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281 --port 8086  --refresh 10.seconds  --retain 7.days &gt;/tmp/stdout.log 2&gt;&amp;1 &amp;</div><div class="line"></div><div class="line">zkåœ°å€ä¿®æ”¹æˆå†…ç½‘åœ°å€ è¿™é‡Œçš„æ•°æ®å­˜å‚¨7å¤©ã€‚</div><div class="line">é‡å¯æœåŠ¡ï¼š</div><div class="line">./monitor/monitor.sh &amp;</div><div class="line"></div><div class="line">ï¼ˆ5ï¼‰æ›´æ–°å¼€æºç›‘æ§ï¼ˆkafka-managerï¼‰</div><div class="line">vim kafka-manager-1.3.3.8/conf/application.conf</div><div class="line">kafka-manager.zkhosts=<span class="string">"10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281"</span></div><div class="line">zkåœ°å€ä¿®æ”¹æˆå†…ç½‘åœ°å€.</div><div class="line"></div><div class="line">é‡å¯æœåŠ¡ï¼š</div><div class="line">./kafka-manager-1.3.3.8/bin/kafka-manager -Dconfig.file=kafka-manager-1.3.3.8/conf/application.conf -Dhttp.port=8080 &amp;</div><div class="line"></div><div class="line">ï¼ˆ6ï¼‰æ›´æ–°å¼€æºç›‘æ§ï¼ˆzabbixï¼‰è‡ªå·±å†™çš„ç›‘æ§è„šæœ¬</div><div class="line"></div><div class="line">[jollybi@kafka1 ~]$ /data/tools/kafka_2.10-0.9.0.1/bin/kafka-run-class.sh kafka.tools.ConsumerOffsetChecker --zookeepe 10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281 --group group_ml --topic mongotail_lz4</div><div class="line">[2017-10-31 14:05:24,390] WARN WARNING: ConsumerOffsetChecker is deprecated and will be dropped <span class="keyword">in</span> releases following 0.9.0. Use ConsumerGroupCommand instead. (kafka.tools.ConsumerOffsetChecker$)</div><div class="line">Group           Topic                          Pid Offset          <span class="built_in">log</span>Size         Lag             Owner</div><div class="line">group_ml        mongotail_lz4                  0   1205186         1205257         71              group_ml_Graphsql-test.jollychic.com-1509421110787-1daec53a-0</div><div class="line">group_ml        mongotail_lz4                  1   1206860         1206915         55              group_ml_Graphsql-test.jollychic.com-1509421110787-1daec53a-0</div><div class="line">....</div><div class="line">è¿è¡Œä¼šå‡ºç°WARNè­¦å‘Šï¼Œ0.9ç‰ˆæœ¬æ›´æ–°è¿‡äº†ï¼Œ</div><div class="line"></div><div class="line">æ³¨æ„ï¼šåœ¨0.9.0.0ï¼Œkafka.tools.ConsumerOffsetCheckerå·²ç»ä¸æ”¯æŒäº†ã€‚ä½ åº”è¯¥ä½¿ç”¨kafka.admin.ConsumerGroupCommand(æˆ–bin/kafka-consumer-groups.shè„šæœ¬)æ¥ç®¡ç†æ¶ˆè´¹è€…ç»„ï¼ŒåŒ…æ‹¬ç”¨æ–°æ¶ˆè´¹è€…APIåˆ›å»ºçš„æ¶ˆè´¹è€…ã€‚</div><div class="line"></div><div class="line">è¿™é‡Œä½¿ç”¨kafka.admin.ConsumerGroupCommand æç¤ºå‘½ä»¤ä¸å¯¹ï¼Œç°åœ¨åœ¨ç ”ç©¶ä½¿ç”¨ã€‚ </div><div class="line">ç›‘æ§è„šæœ¬ è¾“å‡ºä¼šæœ‰æç¤ºç›´æ¥è¿‡æ»¤æ‰å³å¯ã€‚</div><div class="line"><span class="keyword">function</span> wlj_event_lag &#123;</div><div class="line"><span class="built_in">echo</span> <span class="string">"`sh /etc/zabbix/kafka_topic_monitor.sh 2&gt;/dev/null |  sed -n  '3p'`"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure><p>ğŸ‰ kafkaå‡çº§ï¼Œè°ƒé…å†…ç½‘è®¿é—®åœ°å€ï¼Œå†…å­˜ï¼Œæ—¥å¿—è¾“å‡ºç±»å‹è°ƒä¼˜ï¼Œç›‘æ§æ›´æ–°é…ç½®ã€‚<br>ğŸ‰ å‚è€ƒå®˜ç½‘æ–‡æ¡£ <a href="https://kafka.apache.org/0101/documentation.html#upgrade_9" target="_blank" rel="external">Apache Kafka ä» 0.8.0, 0.8.1.X æˆ– 0.8.2.X å‡çº§åˆ° 0.9.0.0</a></p><h3 id="Communicative-learning"><a href="#Communicative-learning" class="headerlink" title="Communicative learning:"></a>Communicative learning:</h3><p>ğŸ§  Linux shell_ senior operation and maintenance faction: QQ group <code>459096184</code> circle (system operation and maintenance - application operation and maintenance - automation operation and maintenance - virtualization technology research, welcome to join)<br>ğŸ§  BigData-Exchange School:QQ group <code>521621407</code> circles (big data Yun Wei) (Hadoop developer) (big data research enthusiasts) welcome to join</p><p>Bidata have internal WeChat exchange group, learn from each other, join QQ group has links.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ğŸŠæˆ‘è¿™é‡Œæ˜¯é‡‡ç”¨,ç¾¤é›†å‡çº§,å…¨éƒ¨æ›´æ–°åœæ­¢è€ç‰ˆæœ¬zkå’Œkafkaæ›´æ–°æœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;9.0.0æœ‰æ½œåœ¨çš„ä¸­æ–­æ›´æ”¹é£é™©ï¼ˆåœ¨å‡çº§ä¹‹å‰éœ€è¦çŸ¥é“ï¼‰ï¼Œå¹¶ä¸”ä¸ä¹‹å‰ç‰ˆæœ¬çš„brokerä¹‹é—´çš„åè®®æ”¹å˜ã€‚è¿™æ„å‘³ç€æ­¤æ¬¡å‡çº§å¯èƒ½å’Œå®¢æˆ·ç«¯æ—§ç‰ˆæœ¬ä¸å…¼å®¹ã€‚å› æ­¤åœ¨å‡çº§å®¢æˆ·ç«¯ä¹‹å‰ï¼Œå…ˆå‡çº§kafkaé›†ç¾¤ã€‚å¦‚æœä½ ä½¿ç”¨MirrorMakerä¸‹æ¸¸é›†ç¾¤ï¼Œåˆ™åŒæ ·åº”é¦–å…ˆå‡çº§ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://blogs.apache.org/hbase/mediaresource/0b77f435-da5c-4696-a1b5-f35bc4139b7b&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Bigdata Hadoop" scheme="http://blog.yancy.cc/categories/Bigdata-Hadoop/"/>
    
    
      <category term="Kafka" scheme="http://blog.yancy.cc/tags/Kafka/"/>
    
  </entry>
  
  <entry>
    <title>ZABBIX monitoring Flume</title>
    <link href="http://blog.yancy.cc/2017/09/21/%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7/Zabbix/ZABBIX%20monitoring%20Flume/"/>
    <id>http://blog.yancy.cc/2017/09/21/æ€§èƒ½ç›‘æ§/Zabbix/ZABBIX monitoring Flume/</id>
    <published>2017-09-21T10:42:58.000Z</published>
    <updated>2018-04-11T12:02:49.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="ZABBIX-monitoring-Flume"><a href="#ZABBIX-monitoring-Flume" class="headerlink" title="ZABBIX monitoring Flume"></a>ZABBIX monitoring Flume</h4><p>Flumeæœ¬èº«æä¾›äº†http, gangliaçš„ç›‘æ§æœåŠ¡ï¼Œè€Œæˆ‘ä»¬ç›®å‰ä¸»è¦ä½¿ç”¨zabbixåšç›‘æ§ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¸ºFlumeæ·»åŠ äº†zabbixç›‘æ§æ¨¡å—ï¼Œå’Œsaçš„ç›‘æ§æœåŠ¡æ— ç¼èåˆã€‚<br>å¦ä¸€æ–¹é¢ï¼Œå‡€åŒ–Flumeçš„metricsã€‚åªå°†æˆ‘ä»¬éœ€è¦çš„metricså‘é€ç»™zabbixï¼Œé¿å… zabbix serveré€ æˆå‹åŠ›ã€‚ç›®å‰æˆ‘ä»¬æœ€ä¸ºå…³å¿ƒçš„æ˜¯Flumeèƒ½å¦åŠæ—¶æŠŠåº”ç”¨ç«¯å‘é€è¿‡æ¥çš„æ—¥å¿—å†™åˆ°Hdfsä¸Šï¼Œ å¯¹åº”å…³æ³¨çš„metricsä¸ºï¼š</p><p>Source : æ¥æ”¶çš„eventæ•°å’Œå¤„ç†çš„eventæ•°<br>Channel : Channelä¸­æ‹¥å µçš„eventæ•°<br>Sink : å·²ç»å¤„ç†çš„eventæ•°</p><p><img src="https://cdn.itzgeek.com/wp-content/uploads/2014/07/Zabbix.jpg" alt=""></p><a id="more"></a><h4 id="zabbixå®‰è£…-amp-JVMæ€§èƒ½ç›‘æ§"><a href="#zabbixå®‰è£…-amp-JVMæ€§èƒ½ç›‘æ§" class="headerlink" title="zabbixå®‰è£…&amp;JVMæ€§èƒ½ç›‘æ§"></a>zabbixå®‰è£…&amp;JVMæ€§èƒ½ç›‘æ§</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">zabbixå®‰è£…</div><div class="line">http://my.oschina.net/yunnet/blog/173161</div><div class="line"></div><div class="line">JDK1.8</div><div class="line">[jollybi@countly1 conf]$ java -version</div><div class="line">java version <span class="string">"1.8.0_65"</span></div><div class="line">Java(TM) SE Runtime Environment (build 1.8.0_65-b17)</div><div class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.65-b01, mixed mode)</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#JVMæ€§èƒ½ç›‘æ§</span></div><div class="line">Young GC  counts</div><div class="line"></div><div class="line">/usr/<span class="built_in">local</span>/jdk/bin/jstat  -gcutil 87007 | tail -1 | awk <span class="string">'&#123;print  $6&#125;'</span></div><div class="line">95.16</div><div class="line"></div><div class="line">Full GC counts</div><div class="line">/usr/<span class="built_in">local</span>/jdk/bin/jstat  -gcutil 87007 | tail -1 | awk <span class="string">'&#123;print  $8&#125;'</span></div><div class="line">436.252</div><div class="line"></div><div class="line">JVM total  memory usage</div><div class="line">/usr/<span class="built_in">local</span>/jdk/bin/jmap -histo $(pgrep java)|grep Total | sed -n <span class="string">'$p'</span> | awk <span class="string">'&#123;print  $3&#125;'</span></div><div class="line"></div><div class="line"></div><div class="line">JVM total  instances usage</div><div class="line"> /usr/<span class="built_in">local</span>/jdk/bin/jmap -histo $(pgrep java)|grep Total | sed -n <span class="string">'$p'</span> | awk <span class="string">'&#123;print  $2&#125;'</span></div></pre></td></tr></table></figure><h4 id="flumeåº”ç”¨å‚æ•°ç›‘æ§"><a href="#flumeåº”ç”¨å‚æ•°ç›‘æ§" class="headerlink" title="flumeåº”ç”¨å‚æ•°ç›‘æ§"></a>flumeåº”ç”¨å‚æ•°ç›‘æ§</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line">å¯åŠ¨æ—¶åŠ ä¸ŠJSON repotingå‚æ•°,è¿™æ ·å°±å¯ä»¥é€šè¿‡http://localhost:34545/metricsè®¿é—®</div><div class="line">bin/flume-ng agent --conf conf --conf-file conf/flume-conf-test.properties --name agent -Dflume.root.logger=INFO,console -Dflume.monitoring.type=http -Dflume.monitoring.port=34545 &amp;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">[root@localhost apache-flume-1.8.0-bin]<span class="comment"># curl http://localhost:34545/metrics 2&gt;/dev/null|sed -e  's/\([,]\)\s*/\1\n/g' -e 's/[&#123;&#125;]/\n/g' -e 's/[",]//g'</span></div><div class="line"></div><div class="line">SOURCE.source1:</div><div class="line">EventReceivedCount:4871</div><div class="line">AppendBatchAcceptedCount:52</div><div class="line">Type:SOURCE</div><div class="line">EventAcceptedCount:4871</div><div class="line">AppendReceivedCount:0</div><div class="line">StartTime:1511251310062</div><div class="line">OpenConnectionCount:0</div><div class="line">AppendAcceptedCount:0</div><div class="line">AppendBatchReceivedCount:52</div><div class="line">StopTime:0</div><div class="line"></div><div class="line">SINK.sink1:</div><div class="line">ConnectionCreatedCount:0</div><div class="line">BatchCompleteCount:0</div><div class="line">BatchEmptyCount:43</div><div class="line">EventDrainAttemptCount:0</div><div class="line">StartTime:1511251311047</div><div class="line">BatchUnderflowCount:1</div><div class="line">ConnectionFailedCount:0</div><div class="line">ConnectionClosedCount:0</div><div class="line">Type:SINK</div><div class="line">RollbackCount:0</div><div class="line">EventDrainSuccessCount:4871</div><div class="line">KafkaEventSendTimer:24748</div><div class="line">StopTime:0</div><div class="line"></div><div class="line">CHANNEL.channel1:</div><div class="line">ChannelCapacity:1000</div><div class="line">ChannelFillPercentage:0.0</div><div class="line">Type:CHANNEL</div><div class="line">ChannelSize:0</div><div class="line">EventTakeSuccessCount:4871</div><div class="line">EventTakeAttemptCount:4915</div><div class="line">StartTime:1511251309391</div><div class="line">EventPutAttemptCount:4871</div><div class="line">EventPutSuccessCount:4871</div><div class="line">StopTime:0</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">/opt/jdk1.8.0_101/bin/jstat</div></pre></td></tr></table></figure><h4 id="é…ç½®ç›‘æ§flumeçš„è„šæœ¬æ–‡ä»¶"><a href="#é…ç½®ç›‘æ§flumeçš„è„šæœ¬æ–‡ä»¶" class="headerlink" title="é…ç½®ç›‘æ§flumeçš„è„šæœ¬æ–‡ä»¶"></a>é…ç½®ç›‘æ§flumeçš„è„šæœ¬æ–‡ä»¶</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">vim /etc/zabbix/monitor_flume.sh</div><div class="line">event=EventDrainSuccessCount</div><div class="line"><span class="comment">#curl  http://localhost:34545/metrics 2&gt;/dev/null|sed -e 's/\([,]\)\s*/\1\n/g' -e  's/[&#123;&#125;]/\n/g' -e 's/[",]//g' |grep $1|awk -F: '&#123;print $2&#125;'</span></div><div class="line"><span class="keyword">function</span> EventDrainSuccessCount  &#123;</div><div class="line">curl  http://localhost:34545/metrics 2&gt;/dev/null|sed <span class="_">-e</span> <span class="string">'s/\([,]\)\s*/\1\n/g'</span> <span class="_">-e</span>  <span class="string">'s/[&#123;&#125;]/\n/g'</span> <span class="_">-e</span> <span class="string">'s/[",]//g'</span> |grep <span class="variable">$event</span>|awk -F: <span class="string">'&#123;print $2&#125;'</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">function</span> StartTime  &#123;</div><div class="line">curl  http://localhost:34545/metrics 2&gt;/dev/null|sed <span class="_">-e</span> <span class="string">'s/\([,]\)\s*/\1\n/g'</span> <span class="_">-e</span>  <span class="string">'s/[&#123;&#125;]/\n/g'</span> <span class="_">-e</span> <span class="string">'s/[",]//g'</span> |grep StartTim |awk -F: <span class="string">'&#123;print $2&#125;'</span> |sed -n <span class="string">"2p"</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">function</span> Total &#123;</div><div class="line">curl  http://localhost:34545/metrics 2&gt;/dev/null|sed <span class="_">-e</span> <span class="string">'s/\([,]\)\s*/\1\n/g'</span> <span class="_">-e</span>  <span class="string">'s/[&#123;&#125;]/\n/g'</span> <span class="_">-e</span> <span class="string">'s/[",]//g'</span> |grep Total|awk -F: <span class="string">'&#123;print $2&#125;'</span></div><div class="line">&#125;</div><div class="line"><span class="comment">#Run the requested function</span></div><div class="line"><span class="variable">$1</span></div></pre></td></tr></table></figure><h4 id="åœ¨zabbix-agenté…ç½®æ–‡ä»¶è¿›è¡Œéƒ¨ç½²"><a href="#åœ¨zabbix-agenté…ç½®æ–‡ä»¶è¿›è¡Œéƒ¨ç½²" class="headerlink" title="åœ¨zabbix agenté…ç½®æ–‡ä»¶è¿›è¡Œéƒ¨ç½²"></a>åœ¨zabbix agenté…ç½®æ–‡ä»¶è¿›è¡Œéƒ¨ç½²</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">vim zabbix_flume_jdk.conf</div><div class="line">UserParameter=ygc.counts,sudo /opt/jdk1.8.0_101/bin/jstat -gcutil $(pgrep java|head -1)|tail -1|awk  <span class="string">'&#123;print $6&#125;'</span></div><div class="line">UserParameter=fgc.counts,sudo /opt/jdk1.8.0_101/bin/jstat  -gcutil $(pgrep java|head -1)|tail -1|awk  <span class="string">'&#123;print $8&#125;'</span></div><div class="line">UserParameter=jvm.memory.usage,sudo /opt/jdk1.8.0_101/bin/jmap -histo $(pgrep java|sed -n <span class="string">'$p'</span>)|grep Total | sed -n <span class="string">'$p'</span> |awk  <span class="string">'&#123;print $3&#125;'</span></div><div class="line">UserParameter=jvm.instances.usage,sudo /opt/jdk1.8.0_101/bin/jmap -histo $(pgrep java|sed -n <span class="string">'$p'</span>)|grep Total | sed -n <span class="string">'$p'</span> |awk  <span class="string">'&#123;print $2&#125;'</span></div><div class="line">UserParameter=flume.monitor[*],sudo /bin/bash /etc/zabbix/monitor_flume.sh <span class="variable">$1</span></div></pre></td></tr></table></figure><p><img src="http://7xrthw.com1.z0.glb.clouddn.com/ZABBIX-monitoring-Flume.png" alt=""><br><img src="http://7xrthw.com1.z0.glb.clouddn.com/ZABBIX-monitoring-Flume1.png" alt=""></p>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;ZABBIX-monitoring-Flume&quot;&gt;&lt;a href=&quot;#ZABBIX-monitoring-Flume&quot; class=&quot;headerlink&quot; title=&quot;ZABBIX monitoring Flume&quot;&gt;&lt;/a&gt;ZABBIX monitoring Flume&lt;/h4&gt;&lt;p&gt;Flumeæœ¬èº«æä¾›äº†http, gangliaçš„ç›‘æ§æœåŠ¡ï¼Œè€Œæˆ‘ä»¬ç›®å‰ä¸»è¦ä½¿ç”¨zabbixåšç›‘æ§ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¸ºFlumeæ·»åŠ äº†zabbixç›‘æ§æ¨¡å—ï¼Œå’Œsaçš„ç›‘æ§æœåŠ¡æ— ç¼èåˆã€‚&lt;br&gt;å¦ä¸€æ–¹é¢ï¼Œå‡€åŒ–Flumeçš„metricsã€‚åªå°†æˆ‘ä»¬éœ€è¦çš„metricså‘é€ç»™zabbixï¼Œé¿å… zabbix serveré€ æˆå‹åŠ›ã€‚ç›®å‰æˆ‘ä»¬æœ€ä¸ºå…³å¿ƒçš„æ˜¯Flumeèƒ½å¦åŠæ—¶æŠŠåº”ç”¨ç«¯å‘é€è¿‡æ¥çš„æ—¥å¿—å†™åˆ°Hdfsä¸Šï¼Œ å¯¹åº”å…³æ³¨çš„metricsä¸ºï¼š&lt;/p&gt;
&lt;p&gt;Source : æ¥æ”¶çš„eventæ•°å’Œå¤„ç†çš„eventæ•°&lt;br&gt;Channel : Channelä¸­æ‹¥å µçš„eventæ•°&lt;br&gt;Sink : å·²ç»å¤„ç†çš„eventæ•°&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://cdn.itzgeek.com/wp-content/uploads/2014/07/Zabbix.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="monitoring" scheme="http://blog.yancy.cc/categories/monitoring/"/>
    
    
      <category term="Zabbix monitoring" scheme="http://blog.yancy.cc/tags/Zabbix-monitoring/"/>
    
  </entry>
  
  <entry>
    <title>ELKæ¶æ„æ¢³ç†-ä¹‹ES2.4åŒå®ä¾‹å¹³æ»‘å‡çº§è‡³5.2.1è¸©å‘å¹¶supervisorç®¡ç†ç¬”è®°</title>
    <link href="http://blog.yancy.cc/2017/09/14/%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%10%E5%B9%B3%E5%8F%B0/Elasticsearch/ELK%E6%9E%B6%E6%9E%84%E6%A2%B3%E7%90%86-%E4%B9%8BES%202.4%E5%8F%8C%E5%AE%9E%E4%BE%8B%E5%B9%B3%E6%BB%91%E5%8D%87%E7%BA%A7%E8%87%B35.2.1%E8%B8%A9%E5%9D%91%E5%B9%B6supervisor%E7%AE%A1%E7%90%86%E7%AC%94%E8%AE%B0/"/>
    <id>http://blog.yancy.cc/2017/09/14/æ—¥å¿—åˆ†æå¹³å°/Elasticsearch/ELKæ¶æ„æ¢³ç†-ä¹‹ES 2.4åŒå®ä¾‹å¹³æ»‘å‡çº§è‡³5.2.1è¸©å‘å¹¶supervisorç®¡ç†ç¬”è®°/</id>
    <published>2017-09-14T09:56:03.000Z</published>
    <updated>2018-04-21T12:18:32.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="ELKæ¶æ„æ¢³ç†ï¼š"><a href="#ELKæ¶æ„æ¢³ç†ï¼š" class="headerlink" title="ELKæ¶æ„æ¢³ç†ï¼š"></a>ELKæ¶æ„æ¢³ç†ï¼š</h4><p>å®æ—¶æ—¥å¿—åˆ†æä½œä¸ºæŒæ¡ä¸šåŠ¡æƒ…å†µã€æ•…éšœåˆ†ææ’æŸ¥çš„ä¸€ä¸ªé‡è¦æ‰‹æ®µï¼Œç›®å‰ä½¿ç”¨æœ€å¤šæœ€æˆç†Ÿçš„è«è¿‡äºELKæ–¹æ¡ˆï¼Œæ•´ä½“æ–¹æ¡ˆä¹Ÿæœ‰å„ç§æ¶æ„ç»„åˆï¼Œåƒ<code>rsyslog-&gt;ES-&gt;kibanaã€rsyslog-&gt;Redis-&gt;Logstash-&gt;ES-&gt;kibanaã€rsyslog-&gt;kafka-&gt;Logstash-&gt;ES-&gt;kibana</code>ç­‰ç­‰ï¼Œå¤æ‚ç‚¹çš„æœ‰sparkçš„å¼•ç”¨ã€‚</p><p><img src="https://pbs.twimg.com/media/CSqjJGgUwAAJdeW.png" alt=""></p><a id="more"></a><p>æ¯ç§æ–¹æ¡ˆé€‚åˆä¸åŒçš„åº”ç”¨åœºæ™¯ï¼Œæ²¡æœ‰ä¼˜åŠ£ä¹‹åˆ†ï¼Œæˆ‘ç›®å‰ç”¨çš„æ˜¯<code>rsyslog-&gt;kafka-&gt;Logstash-&gt;ES-&gt;kibanaå’Œrsyslog-&gt;rsyslogä¸­ç»§-&gt;kafka-&gt;Logstash-&gt;ES-&gt;kibana</code>æ–¹æ¡ˆï¼Œå…±5å°ESï¼ˆ12æ ¸ã€64Gã€æœºæ¢°ç›˜ï¼‰æ¯å¤©ç´¢å¼•10å¤šäº¿æ¡æ—¥å¿—ï¼ŒåŒ…å«<code>nginxã€uwsgiã€redisã€php</code>å¼€å‘æ—¥å¿—ç­‰ï¼Œè¿è¡Œæ¯”è¾ƒå¥å£®ï¼Œæ¯æ¡ç´¢å¼•æ—¥å¿—ç²¾ç®€ååœ¨10ä¸ªå­—æ®µå·¦å³ï¼Œæ¯å¤©Primary Shardçš„ç´¢å¼•é‡å¤§æ¦‚åœ¨600ä¸ªGï¼Œè€ƒè™‘åˆ°æ€§èƒ½é—®é¢˜ï¼Œæˆ‘ä»¬æ²¡è¦å¤åˆ¶åˆ†ç‰‡ï¼ŒåŒæ—¶ç€é‡åšäº†ESé›†ç¾¤çš„è°ƒä¼˜ï¼Œæ—¥å¿—ä¿ç•™7å¤©ã€‚</p><p>ä»æ•´ä½“æ¶æ„è¿›è¡ŒæŠ½è±¡æ€»ç»“ï¼Œå…¶å®å°±æ˜¯é‡‡é›†-&gt;æ¸…æ´—-&gt;ç´¢å¼•-&gt;å±•ç°å››ä¸ªç¯èŠ‚ï¼Œå†å»è€ƒè™‘å„ç¯èŠ‚ä¸­ç¼“å­˜ã€é˜Ÿåˆ—çš„ä½¿ç”¨ï¼Œæ¯ä¸ªç¯èŠ‚ç‚¹ç”¨ä¸åŒçš„è½¯ä»¶æ¥å®ç°ã€‚ä¸‹é¢ä»‹ç»ä¸€ä¸‹æˆ‘ç›®å‰æ–¹æ¡ˆé›†ç¾¤çš„æ­å»ºå’Œé…ç½®ã€‚</p><h4 id="ESé›†ç¾¤æ–¹æ¡ˆå¹³æ»‘ï¼š"><a href="#ESé›†ç¾¤æ–¹æ¡ˆå¹³æ»‘ï¼š" class="headerlink" title="ESé›†ç¾¤æ–¹æ¡ˆå¹³æ»‘ï¼š"></a>ESé›†ç¾¤æ–¹æ¡ˆå¹³æ»‘ï¼š</h4><p>ESè€é›†ç¾¤ç”¨çš„2.4.1ç‰ˆæœ¬ï¼Œè·‘çš„æ¯”è¾ƒå¥½å°±ä¸€ç›´æ²¡åŠ¨ï¼Œæœ€è¿‘çœ‹èµ„æ–™ES5.Xå·²ç»ç¨³å®šï¼Œå¹¶ä¸”æ€§èƒ½æœ‰è¾ƒå¤§æå‡ï¼Œå¿ƒé‡Œå°±å‘ç—’äº†ï¼Œä½†ç”±äºä¸šåŠ¡è¦ä¿æŒé«˜å¯ç”¨çš„å±æ€§ï¼Œå°±å¾—æƒ³ä¸€ä¸ªå¹³æ»‘å‡çº§çš„æ–¹æ¡ˆï¼Œæœ€åæƒ³åˆ°äº†å¤šå®ä¾‹è¿‡åº¦çš„åŠæ³•ï¼Œ5.Xç‰ˆæœ¬ç½‘ä¸Šä»‹ç»é…ç½®å˜åŒ–è¾ƒå¤§ï¼Œä¹Ÿåšå¥½äº†è¸©å‘å‡†å¤‡ï¼Œç¡®å®šå¥½è¦å‡çº§åï¼Œç«‹åˆ»åŠ¨æ‰‹ã€‚</p><p>ä¸€ã€å¯¹åº”å‡çº§æ”¹é€ æ–¹æ¡ˆ</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="number">1</span>. ä½¿ç”¨ç«¯å£<span class="number">9220</span>å’Œ<span class="number">9330</span> å®‰è£…å¹¶é…ç½®å¥½æ–°çš„ES5<span class="meta">.2</span><span class="meta">.1</span>å®ä¾‹</div><div class="line"><span class="number">2</span>. å…³æ‰logstashå¹¶å°†ES2<span class="meta">.4</span><span class="meta">.1</span>å®ä¾‹å †æ ˆè°ƒå°é‡å¯ï¼ˆkafkaä¿ç•™<span class="number">3</span>ä¸ªå°æ—¶æ—¥å¿—æ‰€ä»¥ä¸ä¼šä¸¢å¤±</div><div class="line"><span class="number">3</span>. å¯åŠ¨ES5<span class="meta">.2</span><span class="meta">.1</span>å¹¶å°†logstashå¼€å¯æŒ‡å‘ES5<span class="meta">.2</span><span class="meta">.1</span></div><div class="line"><span class="number">4</span>. å®‰è£…æ–°ç‰ˆkibanaå®ä¾‹åšå¥½æŒ‡å‘ï¼Œè€æ•°æ®ç”¨http://host/oldè®¿é—®â€”â€”&gt;ES5<span class="meta">.2</span><span class="meta">.1</span>é…ç½®è°ƒä¼˜ã€‚</div></pre></td></tr></table></figure><p>äºŒã€å‡çº§åç»Ÿä¸€ç”¨<a href="githubï¼šhttps://github.com/mlazarov/supervisord-monitor">supervisord-monitorç®¡ç†</a><br>ä¸‰ã€å‘¨æœ«è·‘äº†ä¸€å¤©ESçš„cpuã€IOã€heapå†…å­˜ä½¿ç”¨ç‡ï¼Œesç£ç›˜æƒ…å†µï¼Œé›†ç¾¤å¥åº·ç›‘æµ‹å’Œthread_poolçš„ç›‘æ§æ•°æ®ï¼ˆéœ€è¦äº†è§£çš„æ·»åŠ QQç¾¤ï¼‰<br>å››ã€å‡çº§è¿‡ç¨‹â€”â€”ç¼–å†™äº†ES5.2.1çš„å®‰è£…è„šæœ¬å¦‚ä¸‹</p><h4 id="é›†ç¾¤è„šæœ¬åŒ–éƒ¨ç½²ï¼š"><a href="#é›†ç¾¤è„šæœ¬åŒ–éƒ¨ç½²ï¼š" class="headerlink" title="é›†ç¾¤è„šæœ¬åŒ–éƒ¨ç½²ï¼š"></a>é›†ç¾¤è„šæœ¬åŒ–éƒ¨ç½²ï¼š</h4><p>ä¹‹å‰ç”¨çš„rpmåŒ…ï¼Œåè€ƒè™‘ç›´æ¥ä½¿ç”¨taråŒ…å®‰è£…ï¼Œå¯¹äºéœ€è¦ç³»ç»Ÿåšçš„è°ƒä¼˜æ“ä½œï¼Œç›´æ¥ç¼–å†™è‡ªåŠ¨åŒ–å®‰è£…è„šæœ¬ï¼Œä¸€é”®å°†æ‰€æœ‰ç³»ç»Ÿå‚æ•°é…ç½®åï¼Œå°†ç¯å¢ƒæ­å»ºå¥½ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#/bin/sh</span></div><div class="line">id elasticsearch || useradd elasticsearch <span class="_">-s</span> /sbin/nologin   <span class="comment">#æ·»åŠ ç”¨æˆ·</span></div><div class="line">grep <span class="string">"* - nofile 512000"</span> /etc/security/limits.conf || <span class="built_in">echo</span>  <span class="string">"* - nofile 512000"</span>  &gt;&gt; /etc/security/limits.conf  <span class="comment">#ä¿®æ”¹æ–‡ä»¶æè¿°ç¬¦æ•°é‡</span></div><div class="line">grep <span class="string">"elasticsearch - nproc unlimited"</span> /etc/security/limits.conf || <span class="built_in">echo</span> <span class="string">"elasticsearch - nproc unlimited"</span>   &gt;&gt; /etc/security/limits.conf  <span class="comment">#ä¿®æ”¹æœ€å¤§æ‰“å¼€è¿›ç¨‹æ•°æ•°é‡</span></div><div class="line">grep <span class="string">"fs.file-max = 1024000"</span> /etc/sysctl.conf || <span class="built_in">echo</span> <span class="string">"fs.file-max = 1024000"</span>  &gt;&gt; /etc/sysctl.conf  <span class="comment">#ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶æè¿°ç¬¦</span></div><div class="line">grep <span class="string">"vm.max_map_count = 262144"</span> /etc/sysctl.conf || <span class="built_in">echo</span> <span class="string">"vm.max_map_count = 262144"</span>  &gt;&gt;  /etc/sysctl.conf  <span class="comment">#ä¿®æ”¹ç¨‹åºæœ€å¤§ç®¡ç†çš„vm</span></div><div class="line">sysctl -p</div><div class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/src</div><div class="line">[ ! <span class="_">-f</span> /usr/<span class="built_in">local</span>/src/elasticsearch-5.2.1.zip ] &amp;&amp; wget </div><div class="line">https://artifacts.elastic.co/dow ... ticsearch-5.2.1.zip</div><div class="line">[ ! <span class="_">-d</span> /usr/<span class="built_in">local</span>/src/elasticsearch-5.2.1 ] &amp;&amp; unzip elasticsearch-5.2.1.zip</div><div class="line">mv elasticsearch-5.2.1 /usr/<span class="built_in">local</span>/</div><div class="line">chown -R elasticsearch:elasticsearch /usr/<span class="built_in">local</span>/elasticsearch-5.2.1  <span class="comment">#ä¿®æ”¹æ‹¥æœ‰è€…æ‰€æœ‰ç»„</span></div><div class="line">sed -i <span class="string">'s/-XX:+UseConcMarkSweepGC/-XX:+UseG1GC/'</span> /usr/<span class="built_in">local</span>/elasticsearch-5.2.1/config/jvm.options    <span class="comment">#GCæ–¹å¼ä¿®æ”¹ä¸ºG1</span></div><div class="line">sed -i <span class="string">'s/-XX:CMSInitiatingOccupancyFraction=75/-XX:MaxGCPauseMillis=200/'</span> /usr/<span class="built_in">local</span>/elasticsearch-5.2.1/config/jvm.options</div><div class="line">sed -i <span class="string">'s/-XX:+UseCMSInitiatingOccupancyOnly/#-XX:+UseCMSInitiatingOccupancyOnly/'</span> /usr/<span class="built_in">local</span>/elasticsearch-5.2.1/config/jvm.options</div></pre></td></tr></table></figure><h4 id="äº”ã€å‡çº§è¿‡ç¨‹â€”â€”é…ç½®æ–‡ä»¶ã€ç´¢å¼•ç›¸å…³çš„æ›´æ–°è°ƒä¼˜"><a href="#äº”ã€å‡çº§è¿‡ç¨‹â€”â€”é…ç½®æ–‡ä»¶ã€ç´¢å¼•ç›¸å…³çš„æ›´æ–°è°ƒä¼˜" class="headerlink" title="äº”ã€å‡çº§è¿‡ç¨‹â€”â€”é…ç½®æ–‡ä»¶ã€ç´¢å¼•ç›¸å…³çš„æ›´æ–°è°ƒä¼˜"></a>äº”ã€å‡çº§è¿‡ç¨‹â€”â€”é…ç½®æ–‡ä»¶ã€ç´¢å¼•ç›¸å…³çš„æ›´æ–°è°ƒä¼˜</h4><p>   å‡çº§æœŸé—´ç€å®è¸©äº†ä¸å°‘å‘ï¼Œè€ç‰ˆESç´¢å¼•é…ç½®å¯ä»¥ç›´æ¥å†™åˆ°é…ç½®æ–‡ä»¶é‡Œï¼Œæ–°ç‰ˆæ˜¯ä¸è¡Œçš„ï¼Œå¿…é¡»ä½¿ç”¨apiå»è®¾ç½®ï¼Œå¦å¤–ES2.Xç‰ˆæœ¬çš„è¿›ç¨‹æ•°è°ƒä¼˜ï¼Œåœ¨ES5.Xæˆ‘å‘ç°è°ƒæ•´ä¸å¦æ²¡æœ‰å½±å“ã€‚é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">cluster.name: yz-5search</div><div class="line">path.data:  /data1/LogData5/</div><div class="line">path.logs:  /data1/LogData5/logs</div><div class="line">bootstrap.memory_lock: <span class="literal">false</span>   <span class="comment">#centos6å†…æ ¸ä¸æ”¯æŒï¼Œå¿…é¡»è¦å…³é—­</span></div><div class="line">bootstrap.system_call_filter: <span class="literal">false</span></div><div class="line">network.host: 10.39.40.94</div><div class="line">http.port: 9220</div><div class="line">transport.tcp.port: 9330</div><div class="line">discovery.zen.ping.unicast.hosts: [<span class="string">"10.39.40.94:9330"</span>,<span class="string">"10.39.40.95:9330"</span>,<span class="string">"10.39.40.96:9330"</span>,<span class="string">"10.39.40.97:9330"</span>]</div><div class="line">discovery.zen.minimum_master_nodes: 2</div><div class="line">http.cors.enabled: <span class="literal">true</span></div><div class="line">http.cors.allow-origin: <span class="string">"*"</span></div></pre></td></tr></table></figure><p>ä¸ºäº†åŠ å¿«ç´¢å¼•æ•ˆç‡ï¼Œç¼–å†™indexçš„æ¨¡æ¿é…ç½®ï¼ˆindexé…ç½®ä¸å…è®¸å†™åˆ°é…ç½®æ–‡ä»¶äº†ï¼‰ï¼Œå°†å‚æ•°putåˆ°esçš„é‡Œï¼Œå½“ç„¶æ¨¡æ¿ä¹Ÿå¯ä»¥é€šè¿‡å‰ç«¯logstashæŒ‡å®šï¼ˆè¦æ”¹logtashè§‰å¾—éº»çƒ¦ï¼‰ï¼Œtemplateè„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#/bin/sh</span></div><div class="line"><span class="comment">#index template</span></div><div class="line">curl -XPUT <span class="string">'http://10.39.40.94:9220/_template/cms_logs?pretty'</span> <span class="_">-d</span> <span class="string">'&#123;</span></div><div class="line">     "order": 6,                                    #ä¼˜å…ˆçº§</div><div class="line">      "template": "logstash-cms*",                  #æ­£åˆ™åŒ¹é…ç´¢å¼•</div><div class="line">      "settings": &#123;</div><div class="line">             "index.refresh_interval" : "60s",  #ç´¢å¼•åˆ·æ–°æ—¶é—´</div><div class="line">             "index.number_of_replicas" : "0",  #å‰¯æœ¬æ•°è®¾ç½®ä¸º0</div><div class="line">             "index.number_of_shards" : "8",    #åˆ†ç‰‡æ•°è®¾ç½®ä¸º8ï¼Œå…±4å°æœåŠ¡å™¨</div><div class="line">             "index.translog.flush_threshold_size" : "768m",  #translogè§¦å‘flushçš„é˜€å€¼</div><div class="line">             "index.store.throttle.max_bytes_per_sec" : "500m", #å­˜å‚¨çš„é˜€å€¼</div><div class="line">             "index.translog.durability": "async",              #è®¾ç½®translogå¼‚æ­¥åˆ·æ–°åˆ°ç¡¬ç›˜ï¼Œæ›´æ³¨é‡æ€§èƒ½</div><div class="line">             "index.merge.scheduler.max_thread_count": "1",     #æœºæ¢°ç›˜è®¾ç½®ä¸º1</div><div class="line">             "index.routing.allocation.total_shards_per_node": "2"  #æ¯ä¸ªèŠ‚ç‚¹ä¸Šä¸¤ä¸ªåˆ†ç‰‡</div><div class="line">      &#125;</div><div class="line">&#125;'</div></pre></td></tr></table></figure><p>å¤‡ï¼šå¦‚æœæ˜¯æ›´æ”¹ï¼Œå°†PUTæ”¹ä¸ºPOST</p><p>æ—¥å¿—ä¿ç•™7å¤©ï¼Œæ¸…é™¤çš„è„šæœ¬å¦‚ä¸‹ï¼Œå†™å…¥è®¡åˆ’ä»»åŠ¡ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line">DATE=`date +%Y.%m.%d.%I`</div><div class="line">DATA2=`date +%Y.%m.%d <span class="_">-d</span><span class="string">'-7 day'</span>`</div><div class="line">curl -XDELETE <span class="string">"http://10.39.40.97:9220/logstash-*-<span class="variable">$&#123;DATA2&#125;</span>*?pretty"</span></div></pre></td></tr></table></figure><p>   ç”±äºå•ä¸ªç´¢å¼•è¾¾åˆ°äº†35Gç”šè‡³40Gä»¥ä¸Šï¼Œäºæ˜¯åœ¨logstashå±‚é¢å¯¹å»ºç´¢å¼•æ•°é‡è¿›è¡Œä¿®æ”¹ï¼ŒæŠŠæ¯å¤©12ä¸ªç´¢å¼•ä¿®æ”¹ä¸ºæ¯å¤©24ä¸ªç´¢å¼•ï¼š</p><p>logstashçš„ä¿®æ”¹å¦‚ä¸‹ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="attr">index</span> =&gt; <span class="string">"logstash-cms-front-nginx-%&#123;+YYYY.MM.dd.hh&#125;"</span>  ä¿®æ”¹ä¸º</div><div class="line"><span class="attr">index</span> =&gt; <span class="string">"logstash-cms-front-nginx-%&#123;+YYYY.MM.dd.HH&#125;"</span></div></pre></td></tr></table></figure><p><em>*æ›´æ–°è‡ªåŠ¨åŒ–æ­å»ºesé›†ç¾¤ï¼Œæ¶æ„æ¢³ç†è¯¦è§£-ä¸å®ç°esç›‘æ§æœåŠ¡</em></p><p>å‚è€ƒï¼š Logstashåˆ†äº«,onlineç”Ÿäº§ç¯å¢ƒçš„ä½¿ç”¨,onlineæ—¥å¿—è§„èŒƒã€‚</p><p><strong>â˜ºå¾…æ•´ç†ç»­å†™~~</strong> </p><h3 id="Communicative-learning"><a href="#Communicative-learning" class="headerlink" title="Communicative learning:"></a>Communicative learning:</h3><p>ğŸ§  Linux shell_ senior operation and maintenance faction: QQ group <code>459096184</code> circle (system operation and maintenance - application operation and maintenance - automation operation and maintenance - virtualization technology research, welcome to join)<br>ğŸ§  BigData-Exchange School:QQ group <code>521621407</code> circles (big data Yun Wei) (Hadoop developer) (big data research enthusiasts) welcome to join</p><p>Bidata have internal WeChat exchange group, learn from each other, join QQ group has links.</p>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;ELKæ¶æ„æ¢³ç†ï¼š&quot;&gt;&lt;a href=&quot;#ELKæ¶æ„æ¢³ç†ï¼š&quot; class=&quot;headerlink&quot; title=&quot;ELKæ¶æ„æ¢³ç†ï¼š&quot;&gt;&lt;/a&gt;ELKæ¶æ„æ¢³ç†ï¼š&lt;/h4&gt;&lt;p&gt;å®æ—¶æ—¥å¿—åˆ†æä½œä¸ºæŒæ¡ä¸šåŠ¡æƒ…å†µã€æ•…éšœåˆ†ææ’æŸ¥çš„ä¸€ä¸ªé‡è¦æ‰‹æ®µï¼Œç›®å‰ä½¿ç”¨æœ€å¤šæœ€æˆç†Ÿçš„è«è¿‡äºELKæ–¹æ¡ˆï¼Œæ•´ä½“æ–¹æ¡ˆä¹Ÿæœ‰å„ç§æ¶æ„ç»„åˆï¼Œåƒ&lt;code&gt;rsyslog-&amp;gt;ES-&amp;gt;kibanaã€rsyslog-&amp;gt;Redis-&amp;gt;Logstash-&amp;gt;ES-&amp;gt;kibanaã€rsyslog-&amp;gt;kafka-&amp;gt;Logstash-&amp;gt;ES-&amp;gt;kibana&lt;/code&gt;ç­‰ç­‰ï¼Œå¤æ‚ç‚¹çš„æœ‰sparkçš„å¼•ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://pbs.twimg.com/media/CSqjJGgUwAAJdeW.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Log Analysis Platform" scheme="http://blog.yancy.cc/categories/Log-Analysis-Platform/"/>
    
    
      <category term="logstash" scheme="http://blog.yancy.cc/tags/logstash/"/>
    
  </entry>
  
  <entry>
    <title>KafKaä¸æ‡‚å°±å­¦å°±é—®å°±è§£ç­”ç¬”è®°</title>
    <link href="http://blog.yancy.cc/2017/09/11/Bigdata-hadoop/Kafka/KafKa%E4%B8%8D%E6%87%82%E5%B0%B1%E5%AD%A6%E5%B0%B1%E9%97%AE%E5%B0%B1%E8%A7%A3%E7%AD%94%E7%AC%94%E8%AE%B0/"/>
    <id>http://blog.yancy.cc/2017/09/11/Bigdata-hadoop/Kafka/KafKaä¸æ‡‚å°±å­¦å°±é—®å°±è§£ç­”ç¬”è®°/</id>
    <published>2017-09-11T03:22:00.000Z</published>
    <updated>2017-12-03T06:44:53.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="1-éƒ¨ç½²ç”Ÿäº§ç¯å¢ƒï¼Œæ‰“ç®—éƒ¨ç½²ä¸‰ä¸ªbrokerå®ä¾‹ï¼Œä½†zookeeperéƒ¨ç½²ä¸€ä¸ªå¯ä»¥å—"><a href="#1-éƒ¨ç½²ç”Ÿäº§ç¯å¢ƒï¼Œæ‰“ç®—éƒ¨ç½²ä¸‰ä¸ªbrokerå®ä¾‹ï¼Œä½†zookeeperéƒ¨ç½²ä¸€ä¸ªå¯ä»¥å—" class="headerlink" title="1. éƒ¨ç½²ç”Ÿäº§ç¯å¢ƒï¼Œæ‰“ç®—éƒ¨ç½²ä¸‰ä¸ªbrokerå®ä¾‹ï¼Œä½†zookeeperéƒ¨ç½²ä¸€ä¸ªå¯ä»¥å—?"></a>1. éƒ¨ç½²ç”Ÿäº§ç¯å¢ƒï¼Œæ‰“ç®—éƒ¨ç½²ä¸‰ä¸ªbrokerå®ä¾‹ï¼Œä½†zookeeperéƒ¨ç½²ä¸€ä¸ªå¯ä»¥å—?</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ç­”æ¡ˆï¼šå¯ä»¥æ˜¯å¯ä»¥ï¼Œä½†ä¸ºäº†å®¹é”™è¿˜æ˜¯éƒ¨ç½²zookeeperé›†ç¾¤æ¯”è¾ƒå¥½ã€‚brokerå’Œzookeeperçš„å¯¹åº”æ¯”ä¾‹å€’æ˜¯æ²¡ä»€ä¹ˆï¼Œéƒ½æ˜¯ç‹¬ç«‹é›†ç¾¤ã€‚</div></pre></td></tr></table></figure><p><img src="https://www.confluent.io/wp-content/uploads/2016/09/Event-sourced-based-architecture.jpeg" alt=""></p><a id="more"></a><h5 id="2-kafkaé›†ç¾¤ä¸ºä»€ä¹ˆéœ€è¦zookeeperæ¥é…åˆï¼Ÿ"><a href="#2-kafkaé›†ç¾¤ä¸ºä»€ä¹ˆéœ€è¦zookeeperæ¥é…åˆï¼Ÿ" class="headerlink" title="2. kafkaé›†ç¾¤ä¸ºä»€ä¹ˆéœ€è¦zookeeperæ¥é…åˆï¼Ÿ"></a>2. kafkaé›†ç¾¤ä¸ºä»€ä¹ˆéœ€è¦zookeeperæ¥é…åˆï¼Ÿ</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ç­”æ¡ˆï¼šzookeeper æ˜¯ä½œä¸ºæ€§èƒ½åè°ƒå·¥å…·çš„è§’è‰²å­˜åœ¨ã€‚å­˜å‚¨ç€ä½ KafkaæœåŠ¡çš„ä¸€äº›äº›å…ƒæ•°æ®ï¼ˆpartitionsã€offsetç­‰ç­‰ï¼‰ã€‚zookeeperé›†ç¾¤çš„ä½œç”¨åœ¨äºä¿è¯ZookeeperæœåŠ¡çš„é«˜å¯ç”¨ã€‚å› æ­¤ä½ å¯ä»¥æ ¹æ®ä½ çš„éœ€è¦æ¥é€‰æ‹©æ˜¯å¦æ„å»ºzookeeperé›†ç¾¤ã€‚</div></pre></td></tr></table></figure><h5 id="3-æŸ¥çœ‹kafka-topic-æ¶ˆè´¹è®°å½•æŠ¥é”™WARN-Session-0x0-for-server-null-unexpected-error-closing-socket-connection-and-attempting-reconnect-org-apache-zookeeper-ClientCnxn"><a href="#3-æŸ¥çœ‹kafka-topic-æ¶ˆè´¹è®°å½•æŠ¥é”™WARN-Session-0x0-for-server-null-unexpected-error-closing-socket-connection-and-attempting-reconnect-org-apache-zookeeper-ClientCnxn" class="headerlink" title="3. æŸ¥çœ‹kafka topic æ¶ˆè´¹è®°å½•æŠ¥é”™WARN Session 0x0 for server null, unexpected error, closing socket connection and attempting reconnect (org.apache.zookeeper.ClientCnxn)"></a>3. æŸ¥çœ‹kafka topic æ¶ˆè´¹è®°å½•æŠ¥é”™WARN Session 0x0 for server null, unexpected error, closing socket connection and attempting reconnect (org.apache.zookeeper.ClientCnxn)</h5><p>java.net.ConnectException: Connection timed out</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">é—®é¢˜ï¼š</div><div class="line">1.æ˜¯kafkaè¿ä¸ä¸Šzookeeperäº†ã€‚è¯·æ£€æŸ¥ zk é›†ç¾¤æ˜¯å¦æ­£å¸¸èƒ½Telnetï¼Œkafkaé›†ç¾¤æ˜¯å¦æ­£å¸¸ã€‚</div><div class="line">2.æ£€æŸ¥server.properties ä¸­zookeeper.connectæ˜¯å¦é…ç½®æ­£ç¡®ï¼Œå¦‚æœéƒ½æ²¡æœ‰é—®é¢˜ï¼Œé‡æ–°å¯åŠ¨æœåŠ¡ã€‚</div></pre></td></tr></table></figure><h5 id="4-kafka-æ”¯æŒå‹ç¼©ä¼ è¾“å—ï¼Ÿ"><a href="#4-kafka-æ”¯æŒå‹ç¼©ä¼ è¾“å—ï¼Ÿ" class="headerlink" title="4. kafka æ”¯æŒå‹ç¼©ä¼ è¾“å—ï¼Ÿ"></a>4. kafka æ”¯æŒå‹ç¼©ä¼ è¾“å—ï¼Ÿ</h5><h5 id="5-Kafka-å¦‚ä½•åœ¨å¼€å¯æ•°æ®å‹ç¼©çš„æƒ…å†µä¸‹-consumerç»´æŠ¤è‡ªå·±çš„offset"><a href="#5-Kafka-å¦‚ä½•åœ¨å¼€å¯æ•°æ®å‹ç¼©çš„æƒ…å†µä¸‹-consumerç»´æŠ¤è‡ªå·±çš„offset" class="headerlink" title="5. Kafka å¦‚ä½•åœ¨å¼€å¯æ•°æ®å‹ç¼©çš„æƒ…å†µä¸‹, consumerç»´æŠ¤è‡ªå·±çš„offset?"></a>5. Kafka å¦‚ä½•åœ¨å¼€å¯æ•°æ®å‹ç¼©çš„æƒ…å†µä¸‹, consumerç»´æŠ¤è‡ªå·±çš„offset?</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">é—®é¢˜ï¼š</div><div class="line">kafkaè¿™è¾¹æ•°æ®ä¼ è¾“æ¶ˆè´¹è·¨awsæœºæˆ¿è¾ƒæ…¢ã€‚ä¼šæœ‰ç½‘ç»œç“¶é¢ˆ,æˆ‘ä»¬kafkaåœ¨å›½å¤–çš„ä¸€dalasiæœºæˆ¿ï¼Œæ¶ˆè´¹ç«¯åœ¨dalasiã€‚</div><div class="line"></div><div class="line">å®˜ç½‘è§£ç­”ï¼š</div><div class="line">Offset management on the consumer</div><div class="line"></div><div class="line">The data received by a consumer <span class="keyword">for</span> a topic might contain both compressed as well as uncompressed messages. The consumer iterator transparently decompresses compressed data and only returns an uncompressed message. The offset maintenance <span class="keyword">in</span> the consumer gets a little tricky. In the zookeeper consumer, the consumed offset is updated each time a message is returned. This consumed offset should be a valid fetch offset <span class="keyword">for</span> correct failure recovery. Since data is stored <span class="keyword">in</span> compressed format on the broker, valid fetch offsets are the compressed message boundaries. Hence, <span class="keyword">for</span> compressed data, the consumed offset will be advanced one compressed message at a time. This has the side effect of possible duplicates <span class="keyword">in</span> the event of a consumer failure. For uncompressed data, consumed offset will be advanced one message at a time.</div><div class="line"></div><div class="line">è¿™æ®µè¯ä¸æ˜¯å¾ˆç†è§£: producerå°†100æ¡messageå‹ç¼©æˆ1æ¡å‘ç»™brokerå, brokeræ˜¯å¦‚ä½•å­˜å‚¨çš„ï¼Œå¹¶ä¸”consumeræ˜¯å¦‚ä½•å–å‡ºè¿™å‹ç¼©åçš„æ•°æ®, å¹¶ç»´æŠ¤offsetçš„?</div><div class="line"></div><div class="line"><span class="comment">### æ¶ˆæ¯å‹ç¼©ï¼ˆmessage compressionï¼‰</span></div><div class="line"></div><div class="line">è€ƒè™‘åˆ°ç½‘ç»œå¸¦å®½çš„ç“¶é¢ˆï¼ŒKafkaæä¾›äº†æ¶ˆæ¯ç»„å‹ç¼©ç‰¹æ€§ã€‚Kafkaé€šè¿‡é€’å½’æ¶ˆæ¯é›†æ¥æ”¯æŒé«˜æ•ˆå‹ç¼©ã€‚é«˜æ•ˆå‹ç¼©éœ€è¦å¤šä¸ªæ¶ˆæ¯åŒæ—¶å‹ç¼©ï¼Œè€Œä¸æ˜¯å¯¹æ¯ä¸ªæ¶ˆæ¯å•ç‹¬å‹ç¼©ã€‚ä¸€æ‰¹æ¶ˆæ¯å‹ç¼©åœ¨ä¸€èµ·å‘é€ç»™brokerã€‚å‹ç¼©æ¶ˆæ¯é›†é™ä½äº†ç½‘ç»œçš„è´Ÿè½½ï¼Œä½†æ˜¯è§£å‹ç¼©ä¹Ÿå¸¦æ¥äº†ä¸€äº›é¢å¤–çš„å¼€é”€ã€‚æ¶ˆæ¯é›†çš„è§£å‹ç¼©æ˜¯ç”±brokerå¤„ç†æ¶ˆæ¯offsetæ—¶å®Œæˆçš„ã€‚</div><div class="line"></div><div class="line">æ¯ä¸ªæ¶ˆæ¯å¯é€šè¿‡ä¸€ä¸ªä¸å¯æ¯”è¾ƒçš„ã€é€’å¢çš„é€»è¾‘offsetè®¿é—®ï¼Œè¿™ä¸ªé€»è¾‘offsetåœ¨æ¯ä¸ªåˆ†åŒºå†…æ˜¯å”¯ä¸€çš„ã€‚æ¥æ”¶åˆ°å‹ç¼©æ•°æ®åï¼Œlead brokerå°†æ¶ˆæ¯é›†è§£å‹ç¼©ï¼Œä¸ºæ¯ä¸ªæ¶ˆæ¯åˆ†é…offsetã€‚offsetåˆ†é…å®Œæˆåï¼Œleaderå†æ¬¡å°†æ¶ˆæ¯é›†å‹ç¼©å¹¶å†™å…¥ç£ç›˜ã€‚</div><div class="line"></div><div class="line">åœ¨Kafkaä¸­ï¼Œæ•°æ®çš„å‹ç¼©ç”±producerå®Œæˆï¼Œå¯ä½¿ç”¨GZIPæˆ–Snappyå‹ç¼©åè®®ã€‚åŒæ—¶éœ€è¦åœ¨producerç«¯é…ç½®ç›¸å…³çš„å‚æ•°ï¼š</div><div class="line"></div><div class="line">compression.codecï¼šæŒ‡å®šå‹ç¼©æ ¼å¼ï¼Œé»˜è®¤ä¸ºnoneï¼Œå¯é€‰çš„å€¼è¿˜æœ‰gzipå’Œsnappyã€‚</div><div class="line">compressed.topicsï¼šè®¾ç½®å¯¹æŒ‡å®šçš„topicå¼€å¯å‹ç¼©ï¼Œé»˜è®¤ä¸ºnullã€‚å½“compression.codecä¸ä¸ºnoneæ—¶ï¼Œå¯¹æŒ‡å®šçš„topicå¼€å¯å‹ç¼©ï¼›å¦‚æœcompressed.topicsä¸ºnullåˆ™å¯¹æ‰€æœ‰topicå¼€å¯å‹ç¼©ã€‚</div><div class="line">æ¶ˆæ¯é›†ByteBufferMessageSetå¯èƒ½æ—¢åŒ…å«å‹ç¼©æ•°æ®ä¹ŸåŒ…å«éå‹ç¼©æ•°æ®ï¼Œä¸ºäº†åŒºåˆ†å¼€æ¥ï¼Œæ¶ˆæ¯å¤´ä¸­æ·»åŠ äº†å‹ç¼©å±æ€§å­—èŠ‚ã€‚åœ¨è¯¥å­—èŠ‚ä¸­ï¼Œæœ€ä½ä½çš„ä¸¤ä½è¡¨ç¤ºå‹ç¼©æ ¼å¼ï¼Œå¦‚æœéƒ½æ˜¯0è¡¨ç¤ºéå‹ç¼©æ•°æ®ã€‚</div></pre></td></tr></table></figure><h3 id="Communicative-learning"><a href="#Communicative-learning" class="headerlink" title="Communicative learning:"></a>Communicative learning:</h3><p>ğŸ§  Linux shell_ senior operation and maintenance faction: QQ group <code>459096184</code> circle (system operation and maintenance - application operation and maintenance - automation operation and maintenance - virtualization technology research, welcome to join)<br>ğŸ§  BigData-Exchange School:QQ group <code>521621407</code> circles (big data Yun Wei) (Hadoop developer) (big data research enthusiasts) welcome to join</p><p>Bidata have internal WeChat exchange group, learn from each other, join QQ group has links.</p>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;1-éƒ¨ç½²ç”Ÿäº§ç¯å¢ƒï¼Œæ‰“ç®—éƒ¨ç½²ä¸‰ä¸ªbrokerå®ä¾‹ï¼Œä½†zookeeperéƒ¨ç½²ä¸€ä¸ªå¯ä»¥å—&quot;&gt;&lt;a href=&quot;#1-éƒ¨ç½²ç”Ÿäº§ç¯å¢ƒï¼Œæ‰“ç®—éƒ¨ç½²ä¸‰ä¸ªbrokerå®ä¾‹ï¼Œä½†zookeeperéƒ¨ç½²ä¸€ä¸ªå¯ä»¥å—&quot; class=&quot;headerlink&quot; title=&quot;1. éƒ¨ç½²ç”Ÿäº§ç¯å¢ƒï¼Œæ‰“ç®—éƒ¨ç½²ä¸‰ä¸ªbrokerå®ä¾‹ï¼Œä½†zookeeperéƒ¨ç½²ä¸€ä¸ªå¯ä»¥å—?&quot;&gt;&lt;/a&gt;1. éƒ¨ç½²ç”Ÿäº§ç¯å¢ƒï¼Œæ‰“ç®—éƒ¨ç½²ä¸‰ä¸ªbrokerå®ä¾‹ï¼Œä½†zookeeperéƒ¨ç½²ä¸€ä¸ªå¯ä»¥å—?&lt;/h4&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;ç­”æ¡ˆï¼šå¯ä»¥æ˜¯å¯ä»¥ï¼Œä½†ä¸ºäº†å®¹é”™è¿˜æ˜¯éƒ¨ç½²zookeeperé›†ç¾¤æ¯”è¾ƒå¥½ã€‚brokerå’Œzookeeperçš„å¯¹åº”æ¯”ä¾‹å€’æ˜¯æ²¡ä»€ä¹ˆï¼Œéƒ½æ˜¯ç‹¬ç«‹é›†ç¾¤ã€‚&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&quot;https://www.confluent.io/wp-content/uploads/2016/09/Event-sourced-based-architecture.jpeg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Bigdata Hadoop" scheme="http://blog.yancy.cc/categories/Bigdata-Hadoop/"/>
    
    
      <category term="Kafka" scheme="http://blog.yancy.cc/tags/Kafka/"/>
    
  </entry>
  
  <entry>
    <title>Bigdata-Zookeeperé›†ç¾¤æ—¥å¿—é…ç½®è¯¦è§£å’Œæ¸…ç†è‡ªå®šä¹‰å¯åŠ¨å†…å­˜</title>
    <link href="http://blog.yancy.cc/2017/08/27/Bigdata-hadoop/zookeeper/Bigdata-Zookeeper%E9%9B%86%E7%BE%A4%E6%97%A5%E5%BF%97%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3%E5%92%8C%E6%B8%85%E7%90%86%E8%87%AA%E5%AE%9A%E4%B9%89%E5%90%AF%E5%8A%A8%E5%86%85%E5%AD%98%20/"/>
    <id>http://blog.yancy.cc/2017/08/27/Bigdata-hadoop/zookeeper/Bigdata-Zookeeperé›†ç¾¤æ—¥å¿—é…ç½®è¯¦è§£å’Œæ¸…ç†è‡ªå®šä¹‰å¯åŠ¨å†…å­˜ /</id>
    <published>2017-08-27T06:46:00.000Z</published>
    <updated>2017-09-26T09:41:46.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="Zookeeperé›†ç¾¤æ—¥å¿—é…ç½®è¯¦è§£å’Œæ¸…ç†è‡ªå®šä¹‰å¯åŠ¨å†…å­˜"><a href="#Zookeeperé›†ç¾¤æ—¥å¿—é…ç½®è¯¦è§£å’Œæ¸…ç†è‡ªå®šä¹‰å¯åŠ¨å†…å­˜" class="headerlink" title="Zookeeperé›†ç¾¤æ—¥å¿—é…ç½®è¯¦è§£å’Œæ¸…ç†è‡ªå®šä¹‰å¯åŠ¨å†…å­˜"></a>Zookeeperé›†ç¾¤æ—¥å¿—é…ç½®è¯¦è§£å’Œæ¸…ç†è‡ªå®šä¹‰å¯åŠ¨å†…å­˜</h4><h3 id="é—®é¢˜ï¼š"><a href="#é—®é¢˜ï¼š" class="headerlink" title="é—®é¢˜ï¼š"></a>é—®é¢˜ï¼š</h3><p>æ­å»ºzookeeperå’Œkafkaé›†ç¾¤è¿è¡Œå¤§æ•°æ®å¤„ç†æ•°æ®æ¶ˆè´¹ï¼Œå…¬å¸dubboä½¿ç”¨zookeeperåšæœåŠ¡ç«¯çš„æœåŠ¡å‘ç°ç®¡ç†åŠé…ç½®ä¸­å¿ƒï¼Œåœ¨ä½¿ç”¨æ—¶éƒ½å‡ºç°è¿‡ç”±äºzkçš„æ—¥å¿—å¤§å°è¿‡å¤§å¡æ»¡ç£ç›˜çš„æƒ…å†µ ï¼Œé‡åˆ°äº†Zookeeperæ—¥å¿—é—®é¢˜è¾“å‡ºè·¯å¾„çš„é—®é¢˜, å‘ç°zookeeperè®¾ç½®log4j.propertiesä¸èƒ½è§£å†³æ—¥å¿—è·¯å¾„é—®é¢˜, å‘ç°è§£å†³æ–¹æ¡ˆå¦‚ä¸‹ã€‚</p><p><img src="http://7xrthw.com1.z0.glb.clouddn.com/zookeeper_cartoon.jpg" alt=""></p><h3 id="zookeeperæ—¥å¿—è¯´æ˜"><a href="#zookeeperæ—¥å¿—è¯´æ˜" class="headerlink" title="zookeeperæ—¥å¿—è¯´æ˜"></a>zookeeperæ—¥å¿—è¯´æ˜</h3><p>ZooKeeperä½¿ç”¨<code>SLF4J(the Simple Logging Facade for Java)</code>ä½œä¸ºæ—¥å¿—çš„æŠ½è±¡å±‚ï¼Œé»˜è®¤ä½¿ç”¨<code>Log4J</code>æ¥åšå®é™…çš„æ—¥å¿—å·¥ä½œã€‚ä½¿ç”¨2å±‚æ—¥å¿—æŠ½è±¡çœ‹èµ·æ¥çœŸæ˜¯å¤Ÿå‘›ï¼Œè¿™é‡Œç®€è¦çš„è¯´æ˜å¦‚ä½•æ¥é…ç½®<code>Log4J</code>ã€‚å°½ç®¡Log4Jéå¸¸çµæ´»ä¸”å¼ºå¤§ï¼Œä½†å®ƒä¹Ÿæœ‰ä¸€äº›å¤æ‚ï¼Œå¯ä»¥ç”¨ä¸€æ•´æœ¬ä¹¦æ¥æè¿°å®ƒï¼Œè¿™é‡Œåªæ˜¯ç®€è¦çš„ä»‹ç»ä¸€ä¸‹åŸºæœ¬çš„ç”¨æ³•ã€‚</p><a id="more"></a><p>Log4Jçš„é…ç½®æ–‡ä»¶åä¸º<code>log4j.properties</code>ï¼Œä»classpathä¸­æŸ¥æ‰¾ã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°log4j.propertiesæ–‡ä»¶ï¼Œä¼šè¾“å‡ºå¦‚ä¸‹è­¦å‘Šä¿¡æ¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">log</span>4j:WARN No appenders could be found <span class="keyword">for</span> logger (org.apache.zookeeper.serv ...  </div><div class="line"><span class="built_in">log</span>4j:WARN Please initialize the <span class="built_in">log</span>4j system properly.</div></pre></td></tr></table></figure><p>å®ƒè¯´çš„æ˜¯æ‰€æœ‰åç»­çš„æ—¥å¿—æ¶ˆæ¯ä¼šè¢«ä¸¢å¼ƒï¼Œé€šå¸¸<code>log4j.properties</code>æ–‡ä»¶ä¼šæ”¾åœ¨<code>conf</code>æ–‡ä»¶å¤¹ï¼Œå¹¶æ”¾åœ¨<code>classpath</code>ä¸‹ã€‚<br>æ¥çœ‹çœ‹<code>ZooKeeper</code>ä½¿ç”¨çš„<code>log4j.properties</code>çš„ä¸»è¦éƒ¨åˆ†ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">[jollybi@kafka2 conf]$ cat <span class="built_in">log</span>4j.properties | grep -Pv <span class="string">"^$|^#"</span></div><div class="line">zookeeper.root.logger=INFO, CONSOLE  <span class="comment">#ï¼ˆ1ï¼‰</span></div><div class="line">zookeeper.console.threshold=INFO</div><div class="line">zookeeper.log.dir=.</div><div class="line">zookeeper.log.file=zookeeper.log</div><div class="line">zookeeper.log.threshold=DEBUG</div><div class="line">zookeeper.tracelog.dir=.                                                                     </div><div class="line">zookeeper.tracelog.file=zookeeper_trace.log</div><div class="line"><span class="built_in">log</span>4j.rootLogger=<span class="variable">$&#123;zookeeper.root.logger&#125;</span> <span class="comment">#ï¼ˆ2ï¼‰</span></div><div class="line"><span class="built_in">log</span>4j.appender.CONSOLE=org.apache.log4j.ConsoleAppender  <span class="comment">#ï¼ˆ3ï¼‰</span></div><div class="line"><span class="built_in">log</span>4j.appender.CONSOLE.Threshold=<span class="variable">$&#123;zookeeper.console.threshold&#125;</span> <span class="comment">#ï¼ˆ4ï¼‰</span></div><div class="line"><span class="built_in">log</span>4j.appender.CONSOLE.layout=org.apache.log4j.PatternLayout <span class="comment">#ï¼ˆ5ï¼‰</span></div><div class="line"><span class="built_in">log</span>4j.appender.CONSOLE.layout.ConversionPattern=%d&#123;ISO8601&#125; [myid:%X&#123;myid&#125;] - %-5p [%t:%C&#123;1&#125;@%L] - %m%n</div><div class="line"><span class="built_in">log</span>4j.appender.ROLLINGFILE=org.apache.log4j.RollingFileAppender <span class="comment">#ï¼ˆ6ï¼‰</span></div><div class="line"><span class="built_in">log</span>4j.appender.ROLLINGFILE.Threshold=<span class="variable">$&#123;zookeeper.log.threshold&#125;</span> <span class="comment">#ï¼ˆ7ï¼‰</span></div><div class="line"><span class="built_in">log</span>4j.appender.ROLLINGFILE.File=<span class="variable">$&#123;zookeeper.log.dir&#125;</span>/<span class="variable">$&#123;zookeeper.log.file&#125;</span></div><div class="line"><span class="built_in">log</span>4j.appender.ROLLINGFILE.MaxFileSize=10MB</div><div class="line"><span class="built_in">log</span>4j.appender.ROLLINGFILE.layout=org.apache.log4j.PatternLayout</div><div class="line"><span class="built_in">log</span>4j.appender.ROLLINGFILE.layout.ConversionPattern=%d&#123;ISO8601&#125; [myid:%X&#123;myid&#125;] - %-5p [%t:%C&#123;1&#125;@%L] - %m%n</div><div class="line"><span class="built_in">log</span>4j.appender.TRACEFILE=org.apache.log4j.FileAppender</div><div class="line"><span class="built_in">log</span>4j.appender.TRACEFILE.Threshold=TRACE</div><div class="line"><span class="built_in">log</span>4j.appender.TRACEFILE.File=<span class="variable">$&#123;zookeeper.tracelog.dir&#125;</span>/<span class="variable">$&#123;zookeeper.tracelog.file&#125;</span></div><div class="line"><span class="built_in">log</span>4j.appender.TRACEFILE.layout=org.apache.log4j.PatternLayout</div><div class="line"><span class="built_in">log</span>4j.appender.TRACEFILE.layout.ConversionPattern=%d&#123;ISO8601&#125; [myid:%X&#123;myid&#125;] - %-5p [%t:%C&#123;1&#125;@%L][%x] - %m%n</div></pre></td></tr></table></figure><ul><li><p>(1) <code>zookeeper.root.logger=INFO, CONSOLE</code><br>ç¬¬ä¸€ç»„è®¾ç½®ä»¥<code>zookeeper</code>å¼€å¤´ï¼Œå®ƒä»¬å®é™…ä¸Šæ˜¯<code>Java system property</code>ï¼Œå¯ä»¥è¢«<code>-D</code>å½¢å¼çš„å‘½ä»¤è¡Œå‚æ•°è¦†ç›–ã€‚<br>ç¬¬ä¸€è¡Œé…ç½®äº†æ—¥å¿—çº§åˆ«ï¼Œé»˜è®¤çš„è®¾ç½®æ˜¯è¯´åœ¨INFOçº§åˆ«ä»¥ä¸‹çš„æ—¥å¿—ä¼šè¢«ä¸¢å¼ƒï¼Œå¹¶ä¸”æ—¥å¿—ä¼šä½¿ç”¨<code>CONSOLE appender</code>è¾“å‡ºã€‚ä½ å¯ä»¥æŒ‡å®šå¤šä¸ª<code>appender</code>ï¼Œä¾‹å¦‚å¦‚æœä½ æƒ³ä½¿ç”¨<code>CONSOLE appender</code>å’Œ<code>ROLLINGFILE appender</code>è¾“å‡ºæ—¥å¿—ï¼Œé‚£ä¹ˆå¯ä»¥é…ç½®<code>zookeeper.logger</code>ä¸º<code>INFO,CONSOLE,ROLLINGFILE</code>ã€‚</p></li><li><p>(2) <code>rootLogger</code>å¤„ç†æ‰€æœ‰æ—¥å¿—çš„<code>logger</code>ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰å®šä¹‰å…¶ä»–<code>logger</code>ã€‚</p></li><li><p>(3) <code>log4j.appender.CONSOLE=org.apache.log4j.ConsoleAppender</code>è¿™ä¸€è¡ŒæŠŠCONSOLE appenderå’Œå®é™…ä¸Šå¤„ç†æ—¥å¿—è¾“å‡ºçš„ç±»ç»‘å®šåœ¨ä¸€èµ·ï¼Œè¿™é‡Œæ˜¯ConsoleAppenderç±»ã€‚</p></li><li><p>(4) <code>appender</code>ä¹Ÿå¯ä»¥è¿‡æ»¤æ—¥å¿—ã€‚è¿™ä¸€è¡Œå°†è¿‡æ»¤ä»»ä½•åœ¨INFOçº§åˆ«ä¹‹ä¸‹çš„æ—¥å¿—ï¼Œå› ä¸ºè¿™æ˜¯åœ¨<code>zookeeper.root.loggerè®¾ç½®çš„threshold</code>ã€‚</p></li><li><p>(5) <code>appender</code>ä½¿ç”¨ä¸€ä¸ªå¸ƒå±€(layout)ç±»åœ¨è¾“å‡ºå‰å¯¹æ—¥å¿—è¿›è¡Œæ ¼å¼åŒ–ã€‚æˆ‘ä»¬ä½¿ç”¨pattern layoutæ¥è®°å½•æ—¥å¿—çš„çº§åˆ«ï¼Œæ—¥æœŸï¼Œçº¿ç¨‹ä¿¡æ¯å’Œè°ƒç”¨ä½ç½®ä¿¡æ¯ä»¥åŠæ¶ˆæ¯æœ¬èº«ã€‚</p></li><li><p>(6) RollingFileAppenderå®ç°äº†rollingæ—¥å¿—æ–‡ä»¶çš„åŠŸèƒ½ï¼Œè€Œä¸æ˜¯æŒç»­çš„å†™åˆ°ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶æˆ–è€…æ§åˆ¶å°ã€‚å¦‚æœrootLoggeræ²¡æœ‰å…³è”ROLLINGFILEï¼Œåˆ™æ­¤appenderä¼šè¢«å¿½ç•¥ã€‚</p></li><li><p>(7) <code>ROLLINGFILE</code>çš„thresholdè®¾ç½®æˆ<code>DEBUG</code>ã€‚å› ä¸º<code>rootLogger</code>è¿‡æ»¤äº†æ‰€æœ‰åœ¨<code>INFO</code>çº§åˆ«ä¹‹ä¸‹çš„æ—¥å¿—ï¼Œæ²¡æœ‰DEBUGæ—¥å¿—ä¼šè¾“å‡ºåˆ°<code>ROLLINGFILE</code>ã€‚å¦‚æœä½ æƒ³è¦çœ‹åˆ°<code>DEBUG</code>æ—¥å¿—ï¼Œä½ å¿…é¡»æŠŠ<code>zookeeper.root.logger</code>ä»<code>INFOæ”¹æˆDEBUG</code>ã€‚</p></li></ul><p>æ‰“æ—¥å¿—ä¼šå½±å“åˆ°è¿›ç¨‹çš„æ€§èƒ½ï¼Œå°¤å…¶æ˜¯åœ¨DEBUGçº§åˆ«ä¸‹ã€‚åŒæ—¶æ—¥å¿—ä¼šæä¾›æœ‰ä»·å€¼çš„ä¿¡æ¯ä¸ºè¯Šæ–­é”™è¯¯æä¾›çº¿ç´¢ã€‚ä¸€ä¸ªå¹³è¡¡æ€§èƒ½å¼€é”€çš„æœ‰æ•ˆæ–¹å¼æ˜¯æŠŠappenderçš„thresholdè®¾æˆDEBUGï¼Œå¹¶æŠŠrootLoggerè®¾æˆWARNçº§åˆ«ï¼Œè¿™åœ¨ä¸€èˆ¬çš„æƒ…å†µéƒ½é€‚ç”¨ï¼Œä¸€èˆ¬åªéœ€è¦å…³æ³¨WARNINGå’Œå®ƒä¹‹ä¸Šçš„æ—¥å¿—ã€‚å½“ä½ éœ€è¦è¯Šæ–­é—®é¢˜æ—¶å¯ä»¥ä½¿ç”¨JMXåŠ¨æ€è®¾ç½®ä¸ºINFOæˆ–DEBUGçº§åˆ«ï¼Œè¿™æ ·å¯ä»¥æ›´æ–¹ä¾¿å®šä½é—®é¢˜ã€‚</p><h3 id="å¿«ç…§äº‹ç‰©æ—¥å¿—-ä¿®æ”¹æ—¥å¿—è¾“å‡ºç›®å½•"><a href="#å¿«ç…§äº‹ç‰©æ—¥å¿—-ä¿®æ”¹æ—¥å¿—è¾“å‡ºç›®å½•" class="headerlink" title="å¿«ç…§äº‹ç‰©æ—¥å¿—,ä¿®æ”¹æ—¥å¿—è¾“å‡ºç›®å½•"></a>å¿«ç…§äº‹ç‰©æ—¥å¿—,ä¿®æ”¹æ—¥å¿—è¾“å‡ºç›®å½•</h3><p>ä¹‹å‰å‡ºç°<code>zookeeper</code>åœ¨binç›®å½•ä¸‹å‡ºç°äº†<code>zookeeper.out</code>çš„æ—¥å¿—æ–‡ä»¶ï¼Œç»åˆ†æå‘ç°æ­¤æ–‡ä»¶æ˜¯ç”±äº<code>nohup</code>å‘½ä»¤æ‰“å°çš„æ§åˆ¶å°æ—¥å¿—ã€‚</p><p>ä½†æ˜¯ï¼Œæˆ‘ä»¬åœ¨<code>zoo.cfg</code>é…ç½®æ–‡ä»¶ä¸­ï¼Œå¯¹æ—¥å¿—æ–‡ä»¶è¿›è¡Œäº†é…ç½®ï¼ˆæˆªå–éƒ¨åˆ†ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">dataDir=/data/tools/zookeeper-3.4.5/tmp</div><div class="line">dataLogDir=/data/tools/zookeeper-3.4.5/tmp/logs</div></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œ<code>dataDirå’ŒdataLogDir</code>æ˜¯é’ˆå¯¹æ•°æ®ä¿¡æ¯åŠæ•°æ®ä¿¡æ¯æ—¥å¿—çš„ä½ç½®é…ç½®ã€‚ä½†æ˜¯åœ¨zookeeperå†…éƒ¨é›†æˆäº†<code>log4j.properties</code>ï¼ˆå¯¹åº”é…ç½®æ–‡ä»¶åœ¨confè·¯å¾„ä¸‹ï¼‰ã€‚</p><h3 id="å‚è€ƒlog4jé…ç½®è¯´æ˜"><a href="#å‚è€ƒlog4jé…ç½®è¯´æ˜" class="headerlink" title="å‚è€ƒlog4jé…ç½®è¯´æ˜"></a>å‚è€ƒlog4jé…ç½®è¯´æ˜</h3><p>æ‰“å¼€<code>log4j.properties</code>æ–‡ä»¶ï¼Œæˆ‘ä»¬ä¼šå‘ç°æœ‰è¿™æ ·çš„é…ç½®ï¼Œå®ƒåœ¨è¯´æ˜å…³äº<code>zookeeper</code>æœ¬èº«çš„ä¸€äº›é»˜è®¤è®¾ç½®ï¼Œä½†æ˜¯å¯ä»¥è¢«ç³»ç»Ÿé…ç½®æ–‡ä»¶æ‰€è¦†ç›–ã€‚é‚£ä¹ˆï¼Œåœ¨<code>log4j</code>ä¸­ï¼Œ<code>rootæ˜¯log4j</code>è®°å½•çš„åŸå§‹èµ·ç‚¹ï¼Œè€Œè¿™éƒ¨åˆ†å‚æ•°åˆå¯ä»¥è¢«ç³»ç»Ÿä¿®æ”¹ï¼Œé‚£ä¹ˆç³»ç»Ÿé…ç½®åœ¨ä»€ä¹ˆåœ°æ–¹å‘¢ï¼Ÿ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Define some default values that can be overridden by system properties</span></div><div class="line">zookeeper.root.logger=INFO, CONSOLE</div><div class="line">zookeeper.console.threshold=INFO</div><div class="line">zookeeper.log.dir=.</div><div class="line">zookeeper.log.file=zookeeper.log</div><div class="line">zookeeper.log.threshold=DEBUG</div><div class="line">zookeeper.tracelog.dir=.</div><div class="line">zookeeper.tracelog.file=zookeeper_trace.log</div></pre></td></tr></table></figure><p>zkæ—¥å¿—.outåŠlog4jæ—¥å¿—è·¯å¾„é…ç½® ï¼šé¦–å…ˆä¿®æ”¹<code>bin/zkEnv.sh</code>ï¼Œé…ç½®<code>ZOO_LOG_DIR</code>çš„ç¯å¢ƒå˜é‡ï¼Œ<code>ZOO_LOG_DIR</code>æ˜¯zookeeperæ—¥å¿—è¾“å‡ºç›®å½•ï¼Œ<code>ZOO_LOG4J_PROP</code>æ˜¯log4jæ—¥å¿—è¾“å‡ºçš„é…ç½®ï¼š</p><ul><li>é»˜è®¤é…ç½®ï¼š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> [ <span class="string">"x<span class="variable">$&#123;ZOO_LOG_DIR&#125;</span>"</span> = <span class="string">"x"</span> ]</div><div class="line"><span class="keyword">then</span></div><div class="line">    ZOO_LOG_DIR=<span class="string">"."</span></div><div class="line"><span class="keyword">fi</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> [ <span class="string">"x<span class="variable">$&#123;ZOO_LOG4J_PROP&#125;</span>"</span> = <span class="string">"x"</span> ]</div><div class="line"><span class="keyword">then</span></div><div class="line">    ZOO_LOG4J_PROP=<span class="string">"INFO,CONSOLE"</span></div><div class="line"><span class="keyword">fi</span></div></pre></td></tr></table></figure><ul><li>ç”Ÿäº§ç¯å¢ƒä¿®æ”¹ï¼š</li></ul><p>åœ¨zkç›®å½•ä¸‹é¢åˆ›å»ºlogsç›®å½• ç»™äºˆbiç»„æ“ä½œæƒé™ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo mkdir /data/tools/zookeeper-3.4.5/logs/</div><div class="line">sudo chown -R jollybi:jollybi /data/tools/zookeeper-3.4.5/logs/</div></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> [ <span class="string">"x<span class="variable">$&#123;ZOO_LOG_DIR&#125;</span>"</span> = <span class="string">"x"</span> ]</div><div class="line"><span class="keyword">then</span></div><div class="line">    ZOO_LOG_DIR=<span class="string">"<span class="variable">$ZOOBINDIR</span>/../logs"</span></div><div class="line"><span class="keyword">fi</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> [ <span class="string">"x<span class="variable">$&#123;ZOO_LOG4J_PROP&#125;</span>"</span> = <span class="string">"x"</span> ]</div><div class="line"><span class="keyword">then</span></div><div class="line">    ZOO_LOG4J_PROP=<span class="string">"INFO,ROLLINGFILE"</span>  //ROLLINGFILE â€”â€” æ—¥å¿—è½®è½¬ï¼Œé¿å…å•ä¸€æ–‡ä»¶è¿‡å¤§</div><div class="line"><span class="keyword">fi</span></div></pre></td></tr></table></figure><h3 id="Zkè®¾ç½®å®šæœŸè‡ªåŠ¨æ¸…ç†æ—¥å¿—"><a href="#Zkè®¾ç½®å®šæœŸè‡ªåŠ¨æ¸…ç†æ—¥å¿—" class="headerlink" title="Zkè®¾ç½®å®šæœŸè‡ªåŠ¨æ¸…ç†æ—¥å¿—."></a>Zkè®¾ç½®å®šæœŸè‡ªåŠ¨æ¸…ç†æ—¥å¿—.</h3><p>ä»<code>3.4.0</code>å¼€å§‹ï¼Œzookeeperæä¾›äº†è‡ªåŠ¨æ¸…ç†<code>snapshot</code>å’Œäº‹åŠ¡æ—¥å¿—çš„åŠŸèƒ½ï¼Œé€šè¿‡é…ç½® <code>autopurge.snapRetainCount</code> å’Œ <code>autopurge.purgeInterval</code> è¿™ä¸¤ä¸ªå‚æ•°èƒ½å¤Ÿå®ç°å®šæ—¶æ¸…ç†äº†ã€‚è¿™ä¸¤ä¸ªå‚æ•°éƒ½æ˜¯åœ¨zoo.cfgä¸­é…ç½®çš„ï¼š</p><ul><li>åœ¨zoo.cfgä¸­é…ç½®ï¼š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">autopurge.purgeInterval: 24*2     </div><div class="line"><span class="comment">##è¿™ä¸ªå‚æ•°æŒ‡å®šäº†æ¸…ç†é¢‘ç‡ï¼Œå•ä½æ˜¯å°æ—¶ã€‚é»˜è®¤æ˜¯0ï¼Œè¡¨ç¤ºä¸å¼€å¯è‡ªå·±æ¸…ç†åŠŸèƒ½ã€‚</span></div><div class="line">autopurge.snapRetainCount:  2</div><div class="line"><span class="comment">##è¿™ä¸ªå‚æ•°å’Œä¸Šé¢çš„å‚æ•°æ­é…ä½¿ç”¨ï¼Œè¿™ä¸ªå‚æ•°æŒ‡å®šäº†éœ€è¦ä¿ç•™çš„æ–‡ä»¶æ•°ç›®ã€‚é»˜è®¤æ˜¯ä¿ç•™3ä¸ªã€‚</span></div></pre></td></tr></table></figure><h3 id="é…ç½®zookeeper-outçš„ä½ç½®åŠlog4jæ—¥å¿—è¾“å‡º"><a href="#é…ç½®zookeeper-outçš„ä½ç½®åŠlog4jæ—¥å¿—è¾“å‡º" class="headerlink" title="é…ç½®zookeeper.outçš„ä½ç½®åŠlog4jæ—¥å¿—è¾“å‡º"></a>é…ç½®zookeeper.outçš„ä½ç½®åŠlog4jæ—¥å¿—è¾“å‡º</h3><h6 id="1-zookeeper-outç”±nohupçš„è¾“å‡ºï¼Œä¹Ÿå°±æ˜¯zookeeperçš„stdoutå’Œstdeerè¾“å‡ºã€‚"><a href="#1-zookeeper-outç”±nohupçš„è¾“å‡ºï¼Œä¹Ÿå°±æ˜¯zookeeperçš„stdoutå’Œstdeerè¾“å‡ºã€‚" class="headerlink" title="1. zookeeper.outç”±nohupçš„è¾“å‡ºï¼Œä¹Ÿå°±æ˜¯zookeeperçš„stdoutå’Œstdeerè¾“å‡ºã€‚"></a>1. <code>zookeeper.out</code>ç”±nohupçš„è¾“å‡ºï¼Œä¹Ÿå°±æ˜¯<code>zookeeper</code>çš„<code>stdoutå’Œstdeer</code>è¾“å‡ºã€‚</h6><p>åœ¨zkServer.shä¸­ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> [ ! -w <span class="string">"<span class="variable">$ZOO_LOG_DIR</span>"</span> ] ; <span class="keyword">then</span>  </div><div class="line">mkdir -p <span class="string">"<span class="variable">$ZOO_LOG_DIR</span>"</span>  </div><div class="line"><span class="keyword">fi</span>  </div><div class="line">  </div><div class="line">_ZOO_DAEMON_OUT=<span class="string">"<span class="variable">$ZOO_LOG_DIR</span>/zookeeper.out"</span>  <span class="comment">#æ—¥å¿—è¾“å‡ºæ–‡ä»¶è·¯å¾„</span></div><div class="line"></div><div class="line"><span class="comment">#nohupæ—¥å¿—è¾“å‡º</span></div><div class="line">nohup <span class="variable">$JAVA</span> <span class="string">"-Dzookeeper.log.dir=<span class="variable">$&#123;ZOO_LOG_DIR&#125;</span>"</span> <span class="string">"-Dzookeeper.root.logger=<span class="variable">$&#123;ZOO_LOG4J_PROP&#125;</span>"</span> \  </div><div class="line">-cp <span class="string">"<span class="variable">$CLASSPATH</span>"</span> <span class="variable">$JVMFLAGS</span> <span class="variable">$ZOOMAIN</span> <span class="string">"<span class="variable">$ZOOCFG</span>"</span> &gt; <span class="string">"<span class="variable">$_ZOO_DAEMON_OUT</span>"</span> 2&gt;&amp;1 &lt; /dev/null &amp;</div></pre></td></tr></table></figure><h6 id="2-log4jæ—¥å¿—è¾“å‡ºé…ç½®-conf-log4j-propertiesä¸­ï¼š"><a href="#2-log4jæ—¥å¿—è¾“å‡ºé…ç½®-conf-log4j-propertiesä¸­ï¼š" class="headerlink" title="2.log4jæ—¥å¿—è¾“å‡ºé…ç½® conf/log4j.propertiesä¸­ï¼š"></a>2.log4jæ—¥å¿—è¾“å‡ºé…ç½® conf/log4j.propertiesä¸­ï¼š</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Add ROLLINGFILE to rootLogger to get log file output  </span></div><div class="line"><span class="comment">#    Log DEBUG level and above messages to a log file  </span></div><div class="line"></div><div class="line"><span class="built_in">log</span>4j.appender.ROLLINGFILE=org.apache.log4j.RollingFileAppender  //æ—¥å¿—è½®è½¬ï¼ŒDaliyRollingFileAppender â€”â€” æŒ‰å¤©è½®è½¬</div><div class="line"><span class="built_in">log</span>4j.appender.ROLLINGFILE.Threshold=<span class="variable">$&#123;zookeeper.log.threshold&#125;</span>  </div><div class="line"><span class="built_in">log</span>4j.appender.ROLLINGFILE.File=<span class="variable">$&#123;zookeeper.log.dir&#125;</span>/<span class="variable">$&#123;zookeeper.log.file&#125;</span></div></pre></td></tr></table></figure><p>è½®è½¬å‰æéœ€è¦å°†(1)é‡Œbin/zkEnv.shä¸­çš„è½®è½¬é…ç½®å¥½</p><p>4.zkäº‹åŠ¡æ—¥å¿—æŸ¥çœ‹</p><p>zookeeperçš„äº‹åŠ¡æ—¥å¿—é€šè¿‡zoo.cfgæ–‡ä»¶ä¸­çš„dataLogDiré…ç½®é¡¹é…ç½®ï¼š</p><pre><code># the directory where the snapshot is stored.# do not use /tmp for storage, /tmp here is just# example sakes.dataDir=/tmp/zookeeper    </code></pre><p>æŸ¥çœ‹äº‹åŠ¡æ—¥å¿—æ–¹æ³•ï¼š<br>(éœ€è¦ä¸‹è½½slf4j-api-1.6.1.jaråŒ…) </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">java -classpath .:slf4j-api-1.6.1.jar:zookeeper-3.4.5.jar org.apache.zookeeper.server.LogFormatter /tmp/zookeeper/version-2/xxx.xxx</div></pre></td></tr></table></figure><h3 id="æ€ä¹ˆè‡ªå®šä¹‰zookeeperçš„å¯åŠ¨å†…å­˜"><a href="#æ€ä¹ˆè‡ªå®šä¹‰zookeeperçš„å¯åŠ¨å†…å­˜" class="headerlink" title="æ€ä¹ˆè‡ªå®šä¹‰zookeeperçš„å¯åŠ¨å†…å­˜"></a>æ€ä¹ˆè‡ªå®šä¹‰zookeeperçš„å¯åŠ¨å†…å­˜</h3><p>è¿è¡Œzookeeperæ—¶ï¼Œä½¿ç”¨jmap -heap <pid> å‘½ä»¤æŸ¥çœ‹å†…å­˜æƒ…å†µå¦‚ä¸‹:</pid></p><p><img src="http://7xrthw.com1.z0.glb.clouddn.com/zookeeper_01.png" alt=""></p><p>è§£å†³ï¼šåˆ†é…å†…å­˜æ–‡ä»¶è·¯å¾„ï¼š<code>zookeeper/bin/zkEnv.sh</code></p><p>è¯¥æ–‡ä»¶å·²ç»æ˜ç¡®è¯´æ˜æœ‰ç‹¬ç«‹JVMå†…å­˜çš„è®¾ç½®æ–‡ä»¶ï¼Œè·¯å¾„æ˜¯<code>zookeeper/conf/java.env</code><br>å®‰è£…çš„æ—¶å€™è¿™ä¸ªè·¯å¾„ä¸‹æ²¡æœ‰æœ‰<code>java.env</code>æ–‡ä»¶ï¼Œéœ€è¦è‡ªå·±æ–°å»ºä¸€ä¸ªï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># vim java.env</span></div><div class="line"></div><div class="line"><span class="meta">#!/bin/sh</span></div><div class="line"><span class="built_in">export</span> JAVA_HOME=/usr/java/jdk</div><div class="line"><span class="comment"># heap size MUST be modified according to cluster environment</span></div><div class="line"><span class="built_in">export</span> JVMFLAGS=<span class="string">"-Xms4g -Xmx4g <span class="variable">$JVMFLAGS</span>"</span></div><div class="line"></div><div class="line">å¯¹äºå†…å­˜çš„åˆ†é…ï¼Œè¿˜æ˜¯æ ¹æ®é¡¹ç›®å’Œæœºå™¨æƒ…å†µè€Œå®šã€‚å¦‚æœå†…å­˜å¤Ÿç”¨ï¼Œé€‚å½“çš„å¤§ç‚¹å¯ä»¥æå‡zkæ€§èƒ½ã€‚</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;Zookeeperé›†ç¾¤æ—¥å¿—é…ç½®è¯¦è§£å’Œæ¸…ç†è‡ªå®šä¹‰å¯åŠ¨å†…å­˜&quot;&gt;&lt;a href=&quot;#Zookeeperé›†ç¾¤æ—¥å¿—é…ç½®è¯¦è§£å’Œæ¸…ç†è‡ªå®šä¹‰å¯åŠ¨å†…å­˜&quot; class=&quot;headerlink&quot; title=&quot;Zookeeperé›†ç¾¤æ—¥å¿—é…ç½®è¯¦è§£å’Œæ¸…ç†è‡ªå®šä¹‰å¯åŠ¨å†…å­˜&quot;&gt;&lt;/a&gt;Zookeeperé›†ç¾¤æ—¥å¿—é…ç½®è¯¦è§£å’Œæ¸…ç†è‡ªå®šä¹‰å¯åŠ¨å†…å­˜&lt;/h4&gt;&lt;h3 id=&quot;é—®é¢˜ï¼š&quot;&gt;&lt;a href=&quot;#é—®é¢˜ï¼š&quot; class=&quot;headerlink&quot; title=&quot;é—®é¢˜ï¼š&quot;&gt;&lt;/a&gt;é—®é¢˜ï¼š&lt;/h3&gt;&lt;p&gt;æ­å»ºzookeeperå’Œkafkaé›†ç¾¤è¿è¡Œå¤§æ•°æ®å¤„ç†æ•°æ®æ¶ˆè´¹ï¼Œå…¬å¸dubboä½¿ç”¨zookeeperåšæœåŠ¡ç«¯çš„æœåŠ¡å‘ç°ç®¡ç†åŠé…ç½®ä¸­å¿ƒï¼Œåœ¨ä½¿ç”¨æ—¶éƒ½å‡ºç°è¿‡ç”±äºzkçš„æ—¥å¿—å¤§å°è¿‡å¤§å¡æ»¡ç£ç›˜çš„æƒ…å†µ ï¼Œé‡åˆ°äº†Zookeeperæ—¥å¿—é—®é¢˜è¾“å‡ºè·¯å¾„çš„é—®é¢˜, å‘ç°zookeeperè®¾ç½®log4j.propertiesä¸èƒ½è§£å†³æ—¥å¿—è·¯å¾„é—®é¢˜, å‘ç°è§£å†³æ–¹æ¡ˆå¦‚ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/zookeeper_cartoon.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;zookeeperæ—¥å¿—è¯´æ˜&quot;&gt;&lt;a href=&quot;#zookeeperæ—¥å¿—è¯´æ˜&quot; class=&quot;headerlink&quot; title=&quot;zookeeperæ—¥å¿—è¯´æ˜&quot;&gt;&lt;/a&gt;zookeeperæ—¥å¿—è¯´æ˜&lt;/h3&gt;&lt;p&gt;ZooKeeperä½¿ç”¨&lt;code&gt;SLF4J(the Simple Logging Facade for Java)&lt;/code&gt;ä½œä¸ºæ—¥å¿—çš„æŠ½è±¡å±‚ï¼Œé»˜è®¤ä½¿ç”¨&lt;code&gt;Log4J&lt;/code&gt;æ¥åšå®é™…çš„æ—¥å¿—å·¥ä½œã€‚ä½¿ç”¨2å±‚æ—¥å¿—æŠ½è±¡çœ‹èµ·æ¥çœŸæ˜¯å¤Ÿå‘›ï¼Œè¿™é‡Œç®€è¦çš„è¯´æ˜å¦‚ä½•æ¥é…ç½®&lt;code&gt;Log4J&lt;/code&gt;ã€‚å°½ç®¡Log4Jéå¸¸çµæ´»ä¸”å¼ºå¤§ï¼Œä½†å®ƒä¹Ÿæœ‰ä¸€äº›å¤æ‚ï¼Œå¯ä»¥ç”¨ä¸€æ•´æœ¬ä¹¦æ¥æè¿°å®ƒï¼Œè¿™é‡Œåªæ˜¯ç®€è¦çš„ä»‹ç»ä¸€ä¸‹åŸºæœ¬çš„ç”¨æ³•ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Bigdata" scheme="http://blog.yancy.cc/categories/Bigdata/"/>
    
    
      <category term="ZooKeeper" scheme="http://blog.yancy.cc/tags/ZooKeeper/"/>
    
  </entry>
  
  <entry>
    <title>tomcat Java heap space å†…å­˜æº¢å‡º</title>
    <link href="http://blog.yancy.cc/2017/08/18/Web%E6%9C%8D%E5%8A%A1%E6%8A%80%E6%9C%AF/tomcat/tomcat%20Java%20heap%20space%20%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA/"/>
    <id>http://blog.yancy.cc/2017/08/18/WebæœåŠ¡æŠ€æœ¯/tomcat/tomcat Java heap space å†…å­˜æº¢å‡º/</id>
    <published>2017-08-18T09:44:04.000Z</published>
    <updated>2017-08-21T02:34:07.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="tomcat-Java-heap-space-å†…å­˜æº¢å‡º"><a href="#tomcat-Java-heap-space-å†…å­˜æº¢å‡º" class="headerlink" title="tomcat Java heap space å†…å­˜æº¢å‡º"></a>tomcat Java heap space å†…å­˜æº¢å‡º</h3><p>confluenceæœåŠ¡å™¨æ—©ä¸ŠBIé‚£è¾¹ååº”è®¿é—®wikiå‡ºç°504 Gateway time-out ä¹‹å‰å®šä½åˆ°é—®é¢˜æ˜¯æœåŠ¡å™¨CPUè´Ÿè½½è¿‡é«˜ ä¹‹å‰æœåŠ¡å™¨é…ç½®1æ ¸1Gçš„é…ç½® å¯¼è‡´ç”¨æˆ·è¯·æ±‚è¶…æ—¶ï¼Œåé¢æœåŠ¡å™¨å‡çº§åˆ°2æ ¸4Gå†…å­˜ï¼Œé»˜è®¤wikiæ²¡æœ‰å†…å­˜ä¼˜åŒ–ï¼Œå¯¼è‡´è¿™æ¬¡è®¿é—®å‡ºç°å†…å­˜æº¢å‡ºçš„æŠ¥é”™ã€‚</p><p>å†…å­˜æº¢å‡ºæ—¥å¿—æŠ¥é”™ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">2017-08-18 16:30:07,181 INFO [main] [com.atlassian.confluence.lifecycle] contextInitialized Starting Confluence 3.4.5 (build <span class="comment">#2035)</span></div><div class="line">2017-08-18 16:30:10,297 INFO [main] [atlassian.plugin.manager.DefaultPluginManager] init Initialising the plugin system</div><div class="line">2017-08-18 16:30:10,519 INFO [main] [atlassian.plugin.manager.DefaultPluginManager] init Plugin system started <span class="keyword">in</span> 0:00:00.219</div><div class="line">Aug 18, 2017 4:30:51 PM org.apache.coyote.http11.Http11Protocol start</div><div class="line">INFO: Starting Coyote HTTP/1.1 on http-8080</div><div class="line">Aug 18, 2017 4:30:51 PM org.apache.catalina.startup.Catalina start</div><div class="line">INFO: Server startup <span class="keyword">in</span> 48320 ms</div><div class="line"></div><div class="line">Exception: java.lang.OutOfMemoryError thrown from the UncaughtExceptionHandler <span class="keyword">in</span> thread <span class="string">"Timer-0"</span></div><div class="line">Exception <span class="keyword">in</span> thread <span class="string">"DefaultQuartzScheduler_QuartzSchedulerThread"</span> java.lang.OutOfMemoryError: Java heap space</div><div class="line">Exception <span class="keyword">in</span> thread <span class="string">"com.mchange.v2.async.ThreadPoolAsynchronousRunner<span class="variable">$PoolThread</span>-#2"</span> java.lang.OutOfMemoryError: Java heap space</div><div class="line"></div><div class="line">Exception: java.lang.OutOfMemoryError thrown from the UncaughtExceptionHandler <span class="keyword">in</span> thread <span class="string">"ContainerBackgroundProcessor[StandardEngine[Standalone]]"</span></div><div class="line"></div><div class="line">Exception: java.lang.OutOfMemoryError thrown from the UncaughtExceptionHandler <span class="keyword">in</span> thread <span class="string">"com.mchange.v2.async.ThreadPoolAsynchronousRunner<span class="variable">$PoolThread</span>-#1"</span></div><div class="line">Exception <span class="keyword">in</span> thread <span class="string">"com.mchange.v2.async.ThreadPoolAsynchronousRunner<span class="variable">$PoolThread</span>-#0"</span> java.lang.OutOfMemoryError: Java heap space</div><div class="line">Exception <span class="keyword">in</span> thread <span class="string">"DefaultQuartzScheduler_Worker-1"</span> java.lang.OutOfMemoryError: Java heap space</div><div class="line">Exception <span class="keyword">in</span> thread <span class="string">"DefaultQuartzScheduler_Worker-3"</span> java.lang.OutOfMemoryError: Java heap space</div><div class="line">Exception <span class="keyword">in</span> thread <span class="string">"DefaultQuartzScheduler_Worker-2"</span> java.lang.OutOfMemoryError: Java heap space</div><div class="line">Exception <span class="keyword">in</span> thread <span class="string">"http-8080-2"</span> java.lang.OutOfMemoryError: Java heap space</div></pre></td></tr></table></figure><p>ç¬¬ä¸€æŸ¥çœ‹ç°åœ¨Javaåº”ç”¨è¿›ç¨‹è¿è¡ŒçŠ¶æ€æ˜¯å¦ä¼˜åŒ–è¿‡ï¼Œè¿è¡Œçš„å†…å­˜å¤§å°å¤šå°‘ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line">[root@wiki-bi logs]<span class="comment"># jmap -heap 4299</span></div><div class="line">Attaching to process ID 4299, please wait...</div><div class="line">Debugger attached successfully.</div><div class="line">Server compiler detected.</div><div class="line">JVM version is 23.25-b01</div><div class="line"></div><div class="line">using thread-local object allocation.</div><div class="line">Parallel GC with 4 thread(s)</div><div class="line"></div><div class="line">Heap Configuration:</div><div class="line">   M<span class="keyword">in</span>HeapFreeRatio = 40</div><div class="line">   MaxHeapFreeRatio = 70</div><div class="line">   MaxHeapSize      = 536870912 (512.0MB)</div><div class="line">   NewSize          = 1310720 (1.25MB)</div><div class="line">   MaxNewSize       = 17592186044415 MB</div><div class="line">   OldSize          = 5439488 (5.1875MB)</div><div class="line">   NewRatio         = 2</div><div class="line">   SurvivorRatio    = 8</div><div class="line">   PermSize         = 21757952 (20.75MB)</div><div class="line">   MaxPermSize      = 268435456 (256.0MB)</div><div class="line">   G1HeapRegionSize = 0 (0.0MB)</div><div class="line"></div><div class="line">Heap Usage:</div><div class="line">PS Young Generation</div><div class="line">Eden Space:</div><div class="line">   capacity = 71958528 (68.625MB)</div><div class="line">   used     = 71943440 (68.61061096191406MB)</div><div class="line">   free     = 15088 (0.0143890380859375MB)</div><div class="line">   99.97903236708788% used</div><div class="line">From Space:</div><div class="line">   capacity = 52166656 (49.75MB)</div><div class="line">   used     = 0 (0.0MB)</div><div class="line">   free     = 52166656 (49.75MB)</div><div class="line">   0.0% used</div><div class="line">To Space:</div><div class="line">   capacity = 53477376 (51.0MB)</div><div class="line">   used     = 0 (0.0MB)</div><div class="line">   free     = 53477376 (51.0MB)</div><div class="line">   0.0% used</div><div class="line">PS Old Generation</div><div class="line">   capacity = 357957632 (341.375MB)</div><div class="line">   used     = 357957344 (341.3747253417969MB)</div><div class="line">   free     = 288 (2.74658203125E-4MB)</div><div class="line">   99.9999195435509% used</div><div class="line">PS Perm Generation</div><div class="line">   capacity = 90898432 (86.6875MB)</div><div class="line">   used     = 90605744 (86.40837097167969MB)</div><div class="line">   free     = 292688 (0.2791290283203125MB)</div><div class="line">   99.67800544678262% used</div><div class="line"></div><div class="line">43519 interned Strings occupying 4740128 bytes.</div></pre></td></tr></table></figure><p>è¿™é‡Œå¯ä»¥çœ‹åˆ°MaxHeapSize ç­‰å‚æ•°é»˜è®¤512MBï¼Œè¿™é‡Œä¼˜åŒ–å†…å­˜é…ç½®å</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">vim /data/wiki-bi/bin/setenv.sh</div><div class="line"></div><div class="line">JAVA_OPTS=<span class="string">"-Xms2g -Xmx2g  -Xss256k  -XX:PermSize=256M -XX:MaxPermSize=256m -Duser.timezone=Asia/Shanghai <span class="variable">$JAVA_OPTS</span> -Djava.awt.headless=true "</span></div><div class="line"><span class="built_in">export</span> JAVA_OPTS</div></pre></td></tr></table></figure><p><img src="http://7xrthw.com1.z0.glb.clouddn.com/tomcat-heap-space.png" alt=""></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line">[root@wiki-bi bin]<span class="comment"># jmap -heap 25727</span></div><div class="line">Attaching to process ID 25727, please wait...</div><div class="line">Debugger attached successfully.</div><div class="line">Server compiler detected.</div><div class="line">JVM version is 23.25-b01</div><div class="line"></div><div class="line">using thread-local object allocation.</div><div class="line">Parallel GC with 4 thread(s)</div><div class="line"></div><div class="line">Heap Configuration:</div><div class="line">   M<span class="keyword">in</span>HeapFreeRatio = 40</div><div class="line">   MaxHeapFreeRatio = 70</div><div class="line">   MaxHeapSize      = 2147483648 (2048.0MB)</div><div class="line">   NewSize          = 1310720 (1.25MB)</div><div class="line">   MaxNewSize       = 17592186044415 MB</div><div class="line">   OldSize          = 5439488 (5.1875MB)</div><div class="line">   NewRatio         = 2</div><div class="line">   SurvivorRatio    = 8</div><div class="line">   PermSize         = 268435456 (256.0MB)</div><div class="line">   MaxPermSize      = 268435456 (256.0MB)</div><div class="line">   G1HeapRegionSize = 0 (0.0MB)</div><div class="line"></div><div class="line">Heap Usage:</div><div class="line">PS Young Generation</div><div class="line">Eden Space:</div><div class="line">   capacity = 536870912 (512.0MB)</div><div class="line">   used     = 448110856 (427.35181427001953MB)</div><div class="line">   free     = 88760056 (84.64818572998047MB)</div><div class="line">   83.46715122461319% used</div><div class="line">From Space:</div><div class="line">   capacity = 89456640 (85.3125MB)</div><div class="line">   used     = 0 (0.0MB)</div><div class="line">   free     = 89456640 (85.3125MB)</div><div class="line">   0.0% used</div><div class="line">To Space:</div><div class="line">   capacity = 89456640 (85.3125MB)</div><div class="line">   used     = 0 (0.0MB)</div><div class="line">   free     = 89456640 (85.3125MB)</div><div class="line">   0.0% used</div><div class="line">PS Old Generation</div><div class="line">   capacity = 1431699456 (1365.375MB)</div><div class="line">   used     = 0 (0.0MB)</div><div class="line">   free     = 1431699456 (1365.375MB)</div><div class="line">   0.0% used</div><div class="line">PS Perm Generation</div><div class="line">   capacity = 268435456 (256.0MB)</div><div class="line">   used     = 35112728 (33.486106872558594MB)</div><div class="line">   free     = 233322728 (222.5138931274414MB)</div><div class="line">   13.0805104970932% used</div><div class="line"></div><div class="line">15180 interned Strings occupying 1629600 bytes.</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;tomcat-Java-heap-space-å†…å­˜æº¢å‡º&quot;&gt;&lt;a href=&quot;#tomcat-Java-heap-space-å†…å­˜æº¢å‡º&quot; class=&quot;headerlink&quot; title=&quot;tomcat Java heap space å†…å­˜æº¢å‡º&quot;&gt;&lt;/a&gt;tomca
      
    
    </summary>
    
      <category term="tomcat" scheme="http://blog.yancy.cc/categories/tomcat/"/>
    
    
      <category term="Java+Tomcat notes" scheme="http://blog.yancy.cc/tags/Java-Tomcat-notes/"/>
    
  </entry>
  
  <entry>
    <title>Monitor Kafka with Prometheus +Grafana</title>
    <link href="http://blog.yancy.cc/2017/08/04/Bigdata-hadoop/Kafka/Monitor%20Kafka%20with%20Prometheus%20+Grafana/"/>
    <id>http://blog.yancy.cc/2017/08/04/Bigdata-hadoop/Kafka/Monitor Kafka with Prometheus +Grafana/</id>
    <published>2017-08-04T03:22:00.000Z</published>
    <updated>2017-10-20T06:02:32.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Monitoring-Kafka-with-Prometheus"><a href="#Monitoring-Kafka-with-Prometheus" class="headerlink" title="Monitoring Kafka with Prometheus"></a>Monitoring Kafka with Prometheus</h3><p>Weâ€™ve previously looked at how to monitor Cassandra with <a href="https://www.robustperception.io/monitoring-cassandra-with-prometheus/" target="_blank" rel="external">Prometheus</a>. Letâ€™s see the process for getting metrics from another popular Java application, <a href="https://kafka.apache.org/" target="_blank" rel="external">Kafka.</a></p><p><img src="http://7xrthw.com1.z0.glb.clouddn.com/kafka-overview.png" alt=""></p><a id="more"></a><p>we download Kafka, the JMX exporter and the config file:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">wget http://ftp.heanet.ie/mirrors/www.apache.org/dist/kafka/0.10.1.0/kafka_2.11-0.10.1.0.tgz</div><div class="line">tar -xzf kafka _ *ã€‚tgz</div><div class="line"><span class="built_in">cd</span> kafka_ *</div><div class="line"></div><div class="line">wget https://repo1.maven.org/maven2/io/prometheus/jmx/jmx_prometheus_javaagent/0.6/jmx_prometheus_javaagent-0.6.jar</div><div class="line">wget https://raw.githubusercontent.com/prometheus/jmx_exporter/master/example_configs/kafka-0-8-2.yml</div><div class="line"></div><div class="line">Download the good files and put them under the Kafka directory:</div><div class="line">[hadoop@hadoop6 kafka_2.10-0.9.0.1]$ ll</div><div class="line">drwxr-xr-x 3 hadoop hadoop    4096 9æœˆ  27 13:34 bin</div><div class="line">drwxr-xr-x 2 hadoop hadoop    4096 9æœˆ  27 21:18 config</div><div class="line">-rw-rw-r-- 1 hadoop hadoop 1225418 2æœˆ   5 2016 jmx_prometheus_javaagent-0.6.jar</div><div class="line">-rw-rw-r-- 1 hadoop hadoop    2824 9æœˆ  26 17:48 kafka-0-8-2.yml</div><div class="line">drwxr-xr-x 2 hadoop hadoop    4096 9æœˆ  27 13:31 libs</div><div class="line">-rw-r--r-- 1 hadoop hadoop   11358 2æœˆ  12 2016 LICENSE</div><div class="line">drwxrwxr-x 2 hadoop hadoop  266240 9æœˆ  27 21:19 logs</div><div class="line">-rw-r--r-- 1 hadoop hadoop     162 2æœˆ  12 2016 NOTICE</div><div class="line">drwxrwxr-x 5 hadoop hadoop    4096 9æœˆ  27 15:56 prometheus-1.2.1.linux-amd64</div><div class="line">drwxr-xr-x 2 hadoop hadoop    4096 2æœˆ  12 2016 site-docs</div></pre></td></tr></table></figure><p>We start a Zookeeper (a Kafka dependency) and Kafka with the JMX exporter running as a Java agent:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">First step:</div><div class="line">Configure the zookeeper zoo.zoo.cfg port: 2181</div><div class="line">Start zookeeper:</div><div class="line">./zookeeper-3.4.6/bin/zkServer.sh start</div><div class="line"></div><div class="line">Second steps:</div><div class="line">Configuration modification: kafka_2.10-0.9.0.1/config/zookeeper.properties</div><div class="line">Port modification: 2182 <span class="keyword">do</span> not conflict with the zookeeper service port</div><div class="line"></div><div class="line"></div><div class="line">dataDir=/data2/zookeeper-3.4.6/zookeeper-data</div><div class="line"><span class="comment"># the port at which the clients will connect</span></div><div class="line">clientPort=2181</div><div class="line"><span class="comment"># disable the per-ip limit on the number of connections since this is a non-production config</span></div><div class="line">maxClientCnxns=0</div><div class="line"></div><div class="line">./bin/zookeeper-server-start.sh config/zookeeper.properties &amp;</div><div class="line"></div><div class="line">KAFKA_OPTS=<span class="string">"<span class="variable">$KAFKA_OPTS</span> -javaagent:<span class="variable">$PWD</span>/jmx_prometheus_javaagent-0.6.jar=7071:<span class="variable">$PWD</span>/kafka-0-8-2.yml"</span> \</div><div class="line">./bin/kafka-server-start.sh config/server.properties &amp;</div></pre></td></tr></table></figure><h4 id="If-you-visit-http-localhost-7071-metrics-youâ€™ll-see-the-metrics"><a href="#If-you-visit-http-localhost-7071-metrics-youâ€™ll-see-the-metrics" class="headerlink" title="If you visit http://localhost:7071/metrics youâ€™ll see the metrics."></a>If you visit <a href="http://localhost:7071/metrics" target="_blank" rel="external">http://localhost:7071/metrics</a> youâ€™ll see the metrics.</h4><p>Letâ€™s setup a quick Prometheus server:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">wget https://github.com/prometheus/prometheus/releases/download/v1.2.1/prometheus-1.2.1.linux-amd64.tar.gz</div><div class="line">tar -xzf prometheus-*.tar.gz</div><div class="line"><span class="built_in">cd</span> prometheus-*</div><div class="line">cat &lt;&lt;<span class="string">'EOF'</span> &gt; prometheus.yml</div><div class="line">global:</div><div class="line"> scrape_interval: 10s</div><div class="line"> evaluation_interval: 10s</div><div class="line">scrape_configs:</div><div class="line"> - job_name: <span class="string">'kafka'</span></div><div class="line">   static_configs:</div><div class="line">    - targets:</div><div class="line">      - localhost:7071</div><div class="line">EOF</div><div class="line">./prometheus</div></pre></td></tr></table></figure><p>Following run access: <a href="http://localhost:9090/graph" target="_blank" rel="external">http://localhost:9090/graph</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[hadoop@hadoop8 prometheus-1.2.1.linux-amd64]$ ./prometheus</div><div class="line">INFO[0000] Starting prometheus (version=1.2.1, branch=master, revision=dd66f2e94b2b662804b9aa1b6a50587b990ba8b7)  <span class="built_in">source</span>=main.go:75</div><div class="line">INFO[0000] Build context (go=go1.7.1, user=root@fd9b0daff6bd, date=20161010-15:58:23)  <span class="built_in">source</span>=main.go:76</div><div class="line">INFO[0000] Loading configuration file prometheus.yml     <span class="built_in">source</span>=main.go:247</div><div class="line">INFO[0000] Loading series map and head chunks...         <span class="built_in">source</span>=storage.go:354</div><div class="line">INFO[0000] 49 series loaded.                             <span class="built_in">source</span>=storage.go:359</div><div class="line">WARN[0000] No AlertManagers configured, not dispatching any alerts  <span class="built_in">source</span>=notifier.go:176</div><div class="line">INFO[0000] Listening on :9090                            <span class="built_in">source</span>=web.go:240</div><div class="line">INFO[0000] Starting target manager...                    <span class="built_in">source</span>=targetmanager.go:76</div></pre></td></tr></table></figure><p>The Prometheus platform monitors all data from the Kafka index:<br>This function is very powerful, late will explain what each representative means:</p><p><img src="http://7xrthw.com1.z0.glb.clouddn.com/kafka-monitor02.png" alt=""></p><p><img src="http://7xrthw.com1.z0.glb.clouddn.com/kafka-monitor03.png" alt=""></p><p>Install <a href="http://docs.grafana.org/installation/rpm/#install-stable" target="_blank" rel="external">open source Grafana monitoring</a>, combine <a href="https://prometheus.io/docs/visualization/grafana/" target="_blank" rel="external">prometheus.io</a> to obtain Prometheus platform data.</p><h3 id="Installing-Grafana"><a href="#Installing-Grafana" class="headerlink" title="Installing Grafana"></a>Installing Grafana</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Download and unpack Grafana from binary tar (adjust version as appropriate).</span></div><div class="line">curl -L -O https://grafanarel.s3.amazonaws.com/builds/grafana-2.5.0.linux-x64.tar.gz</div><div class="line">tar zxf grafana-2.5.0.linux-x64.tar.gz</div><div class="line"></div><div class="line"><span class="comment"># Start Grafana.</span></div><div class="line"><span class="built_in">cd</span> grafana-2.5.0/</div><div class="line">./bin/grafana-server web</div></pre></td></tr></table></figure><h3 id="Using"><a href="#Using" class="headerlink" title="Using"></a>Using</h3><p>By default, Grafana will be listening on <a href="http://localhost:3000" target="_blank" rel="external">http://localhost:3000</a>. The default login is â€œadminâ€ / â€œadminâ€.</p><h4 id="Creating-a-Prometheus-data-source"><a href="#Creating-a-Prometheus-data-source" class="headerlink" title="Creating a Prometheus data source"></a>Creating a Prometheus data source</h4><p>To create a Prometheus data source:</p><ol><li>Click on the Grafana logo to open the sidebar menu.</li><li>Click on â€œData Sourcesâ€ in the sidebar.</li><li>Click on â€œAdd Newâ€.</li><li>Select â€œPrometheusâ€ as the type.</li><li>Set the appropriate Prometheus server URL (for example, <a href="http://localhost:9090/" target="_blank" rel="external">http://localhost:9090/</a>)</li><li>Adjust other data source settings as desired (for example, turning the proxy access off).</li><li>Click â€œAddâ€ to save the new data source.</li><li>The following shows an example data source configuration:</li></ol><p>Reference address: <a href="https://prometheus.io/docs/visualization/grafana/" target="_blank" rel="external">GRAFANA SUPPORT FOR PROMETHEUS</a></p><p><img src="https://prometheus.io/assets/grafana_configuring_datasource-cb0e78b7cfa.png" alt=""></p><p>Finally load the <a href="https://grafana.com/dashboards/721" target="_blank" rel="external">Kafka Overview</a> dashboard from grafana.net into your Grafana to get the above console!</p><p>If you want to run Kafka inside docker, thereâ€™s <a href="https://www.robustperception.io/monitoring-kafka-in-a-docker-container-using-prometheus/" target="_blank" rel="external">another blog post</a> covering that.</p><p>Reference address: <a href="https://www.robustperception.io/monitoring-kafka-with-prometheus/" target="_blank" rel="external">monitoring-kafka-with-prometheus</a></p><h3 id="Communicative-learning"><a href="#Communicative-learning" class="headerlink" title="Communicative learning:"></a>Communicative learning:</h3><p>ğŸ§  Linux shell_ senior operation and maintenance faction: QQ group <code>459096184</code> circle (system operation and maintenance - application operation and maintenance - automation operation and maintenance - virtualization technology research, welcome to join)<br>ğŸ§  BigData-Exchange School:QQ group <code>521621407</code> circles (big data Yun Wei) (Hadoop developer) (big data research enthusiasts) welcome to join</p><p>Bidata have internal WeChat exchange group, learn from each other, join QQ group has links.</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;Monitoring-Kafka-with-Prometheus&quot;&gt;&lt;a href=&quot;#Monitoring-Kafka-with-Prometheus&quot; class=&quot;headerlink&quot; title=&quot;Monitoring Kafka with Prometheus&quot;&gt;&lt;/a&gt;Monitoring Kafka with Prometheus&lt;/h3&gt;&lt;p&gt;Weâ€™ve previously looked at how to monitor Cassandra with &lt;a href=&quot;https://www.robustperception.io/monitoring-cassandra-with-prometheus/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Prometheus&lt;/a&gt;. Letâ€™s see the process for getting metrics from another popular Java application, &lt;a href=&quot;https://kafka.apache.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Kafka.&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/kafka-overview.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Bigdata Hadoop" scheme="http://blog.yancy.cc/categories/Bigdata-Hadoop/"/>
    
    
      <category term="Kafka" scheme="http://blog.yancy.cc/tags/Kafka/"/>
    
      <category term="Prometheus" scheme="http://blog.yancy.cc/tags/Prometheus/"/>
    
      <category term="Grafana" scheme="http://blog.yancy.cc/tags/Grafana/"/>
    
  </entry>
  
  <entry>
    <title>Bigdata-Kafka-nodeæ¨¡å—å®ç°è°ƒç”¨jså‘é€æ•°æ®</title>
    <link href="http://blog.yancy.cc/2017/08/01/Bigdata-hadoop/Kafka/Kafka-node%E6%A8%A1%E5%9D%97%E5%AE%9E%E7%8E%B0%E8%B0%83%E7%94%A8js%E5%8F%91%E9%80%81%E6%95%B0%E6%8D%AE/"/>
    <id>http://blog.yancy.cc/2017/08/01/Bigdata-hadoop/Kafka/Kafka-nodeæ¨¡å—å®ç°è°ƒç”¨jså‘é€æ•°æ®/</id>
    <published>2017-08-01T06:46:00.000Z</published>
    <updated>2017-11-21T02:04:41.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://7xrthw.com1.z0.glb.clouddn.com/streams-interactive-queries-02.png" alt=""></p><p>mongodbå†™åˆ°kafka æŒ‡å®štopicæ¶ˆè´¹ã€‚ä¸ºäº†ä¿è¯æ•°æ®ç¨³å®šå¯é æ€§ã€‚<br>é…åˆå¤§æ•°æ®åœ¨countly ä½¿ç”¨å¼€æº<code>Kafka-node</code>æ˜¯ä¸€ä¸ªNode.jså®¢æˆ·ç«¯ å†™jsç¨‹åºè®©countlyä¸‰å°é›†ç¾¤åˆ†åˆ«æ•°æ®åˆ°kafka åšæ–°çš„topicä¸»é¢˜å¤‡ä»½ã€‚</p><a id="more"></a><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install kafka-node</div></pre></td></tr></table></figure><p>è¿›å…¥kafka-nodeç›®å½•: vim kafka_test.js</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">var kafka = require(<span class="string">'kafka-node'</span>),</div><div class="line">HighLevelProducer = kafka.HighLevelProducer,</div><div class="line">    //Producer = kafka.Producer,</div><div class="line">    client = new kafka.Client(<span class="string">'169.44.62.139:2281,169.44.59.138:2281,169.44.62.137:2281'</span>),</div><div class="line">    //producer = new Producer(client);</div><div class="line">producer = new HighLevelProducer(client);</div><div class="line"></div><div class="line">console.log(<span class="string">'è¿æ¥kafkaä¸­'</span>);</div><div class="line"></div><div class="line">var argv = &#123;</div><div class="line">    topic: <span class="string">"test1"</span></div><div class="line">&#125;;</div><div class="line">var topic = argv.topic || <span class="string">'test1'</span>;</div><div class="line">var p = argv.p || 0;</div><div class="line">var a = argv.a || 0;</div><div class="line">var producer = new HighLevelProducer(client, &#123;</div><div class="line">    requireAcks: 1,</div><div class="line">    partitionerType: 3</div><div class="line">&#125;);</div><div class="line"></div><div class="line">console.log(producer);</div><div class="line"></div><div class="line">producer.on(<span class="string">'ready'</span>, <span class="function"><span class="title">function</span></span>() &#123;</div><div class="line">    var args = &#123;</div><div class="line">        appid: <span class="string">'222-wx238c28839a133d0e'</span>,</div><div class="line">        createTime: <span class="string">'222-ddd'</span>,</div><div class="line">        toUserName: <span class="string">'222-wx238c28839a133d0e'</span>,</div><div class="line">        fromUserName: <span class="string">'222-wx238c28839a133d0e'</span></div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    producer.send([&#123;</div><div class="line">        topic: topic,</div><div class="line">        partition: p,</div><div class="line">        messages: [JSON.stringify(args)],</div><div class="line">        attributes: a</div><div class="line">    &#125;], <span class="keyword">function</span>(err, result) &#123;</div><div class="line">        console.log(err || result);</div><div class="line">        process.exit();</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    console.log(args);</div><div class="line">&#125;);</div></pre></td></tr></table></figure><h4 id="å®˜ç½‘åœ°å€ï¼šhttps-www-npmjs-com-package-kafka-node-install-kafka"><a href="#å®˜ç½‘åœ°å€ï¼šhttps-www-npmjs-com-package-kafka-node-install-kafka" class="headerlink" title="å®˜ç½‘åœ°å€ï¼šhttps://www.npmjs.com/package/kafka-node#install-kafka"></a>å®˜ç½‘åœ°å€ï¼š<a href="https://www.npmjs.com/package/kafka-node#install-kafka" target="_blank" rel="external">https://www.npmjs.com/package/kafka-node#install-kafka</a></h4><h3 id="äº¤æµå­¦ä¹ ï¼š"><a href="#äº¤æµå­¦ä¹ ï¼š" class="headerlink" title="äº¤æµå­¦ä¹ ï¼š"></a>äº¤æµå­¦ä¹ ï¼š</h3><p>ğŸ§  Linux shell_é«˜çº§è¿ç»´æ´¾: <code>459096184</code>    åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)<br>ğŸ§  BigData-Exchange School : <code>521621407</code>  åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥</p><p>ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/streams-interactive-queries-02.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;mongodbå†™åˆ°kafka æŒ‡å®štopicæ¶ˆè´¹ã€‚ä¸ºäº†ä¿è¯æ•°æ®ç¨³å®šå¯é æ€§ã€‚&lt;br&gt;é…åˆå¤§æ•°æ®åœ¨countly ä½¿ç”¨å¼€æº&lt;code&gt;Kafka-node&lt;/code&gt;æ˜¯ä¸€ä¸ªNode.jså®¢æˆ·ç«¯ å†™jsç¨‹åºè®©countlyä¸‰å°é›†ç¾¤åˆ†åˆ«æ•°æ®åˆ°kafka åšæ–°çš„topicä¸»é¢˜å¤‡ä»½ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="å¤§æ•°æ®" scheme="http://blog.yancy.cc/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
    
      <category term="Kafka" scheme="http://blog.yancy.cc/tags/Kafka/"/>
    
  </entry>
  
  <entry>
    <title>Zabbix 3.0 ç›‘æ§æ¨é€rabbitmqé˜Ÿåˆ—-æ¶ˆæ¯å †ç§¯</title>
    <link href="http://blog.yancy.cc/2017/07/29/Bigdata-hadoop/RabbitMQ/Zabbix%203.0%20%E7%9B%91%E6%8E%A7%E6%8E%A8%E9%80%81rabbitmq%E9%98%9F%E5%88%97/"/>
    <id>http://blog.yancy.cc/2017/07/29/Bigdata-hadoop/RabbitMQ/Zabbix 3.0 ç›‘æ§æ¨é€rabbitmqé˜Ÿåˆ—/</id>
    <published>2017-07-29T06:46:00.000Z</published>
    <updated>2018-01-13T06:20:32.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="Zabbix-3-0-ç›‘æ§æ¨é€rabbitmqé˜Ÿåˆ—"><a href="#Zabbix-3-0-ç›‘æ§æ¨é€rabbitmqé˜Ÿåˆ—" class="headerlink" title="Zabbix 3.0 ç›‘æ§æ¨é€rabbitmqé˜Ÿåˆ—"></a>Zabbix 3.0 ç›‘æ§æ¨é€rabbitmqé˜Ÿåˆ—</h4><p>å¯¹äºRabbitMQçš„ç›‘æ§ï¼Œé™¤äº†æœåŠ¡å™¨åŸºæœ¬ä¿¡æ¯<code>ï¼ˆç¡¬ç›˜ã€CPUã€å†…å­˜ã€IOç­‰ï¼‰</code>ä»¥åŠMQçš„è¿›ç¨‹å’Œç«¯å£ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡è¯·æ±‚urlè®¿é—®ç®¡ç†APIç›‘æ§å…¶é›†ç¾¤å’Œé˜Ÿåˆ—çš„æƒ…å†µã€‚åœ¨java api 3.6.0ä»¥åï¼Œchannelæ¥å£ä¸ºæˆ‘ä»¬æä¾›äº†å¦‚ä¸‹æ¥å£ï¼š</p><ul><li>messageCountï¼šæŸ¥è¯¢é˜Ÿåˆ—æœªæ¶ˆè´¹çš„æ¶ˆæ¯æ•°ï¼Œå¯ä»¥ç›‘æ§æ¶ˆæ¯å †ç§¯çš„æƒ…å†µã€‚ </li><li>consumerCountï¼šé˜Ÿåˆ—çš„æ¶ˆè´¹è€…ä¸ªæ•°ï¼Œå¯ä»¥å¯¹æ¶ˆè´¹è€…è¿›è¡Œç›‘æ§ </li></ul><p>1.ç›‘æ§å‘Šè­¦éœ€æ±‚é—®é¢˜ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">message.bié˜Ÿåˆ—  ç§¯å‹&gt; 300 æˆ–è€… æ¶ˆè´¹è€…æ•°&lt;=2</div><div class="line">message.push.carté˜Ÿåˆ—  ç§¯å‹ &gt;10000 æˆ–è€…æ¶ˆè´¹è€…æ•°&lt;5</div><div class="line">message.user.relatedé˜Ÿåˆ— ç§¯å‹&gt;2000 æˆ–è€… æ¶ˆè´¹è€…æ•°&lt;=2</div><div class="line">message.carté˜Ÿåˆ— ç§¯å‹&gt;10000 æˆ–è€… æ¶ˆè´¹è€…æ•°&lt;=2</div></pre></td></tr></table></figure><p>2.ç¼–å†™Pythonè„šæœ¬ç›‘æ§è·å–æ¶ˆè´¹è€…æ•°ç›‘æ§ï¼Œé˜Ÿåˆ—ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">vim rabbitmq-monitor.py</div><div class="line"><span class="comment">#!/bin/env python</span></div><div class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></div><div class="line">import sys, urllib2, base64, json, re,time</div><div class="line">ip = <span class="string">"169.23.73.22"</span></div><div class="line">keys = (<span class="string">'messages_ready'</span>,)</div><div class="line">def GetRabbitmqData():</div><div class="line">        request = urllib2.Request(<span class="string">"http://%s:15672/api/queues"</span> % ip)</div><div class="line">        base64string = base64.b64encode(<span class="string">'guest:guest'</span>)</div><div class="line">        request.add_header(<span class="string">"Authorization"</span>, <span class="string">"Basic %s"</span> % base64string)</div><div class="line">        result = urllib2.urlopen(request)</div><div class="line">        data = json.loads(result.read())</div><div class="line">        <span class="built_in">return</span> data</div><div class="line"></div><div class="line"></div><div class="line">data=GetRabbitmqData()</div><div class="line"><span class="comment">#print data</span></div><div class="line"><span class="keyword">for</span> queue <span class="keyword">in</span> data:</div><div class="line">    try:</div><div class="line">        <span class="built_in">print</span> <span class="string">"æ¶ˆè´¹è€…æ•°é‡:"</span>,queue[<span class="string">'consumers'</span>],<span class="string">"é˜Ÿåˆ—:"</span>,queue[<span class="string">'name'</span>],<span class="string">"æ¶ˆæ¯ç§¯å‹æ•°:"</span>,int(queue[keys[0]])</div><div class="line">    except:</div><div class="line">        pass</div></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">[root@message-center-mq zabbix]<span class="comment"># python rabbitmq-monitor.py</span></div><div class="line">æ¶ˆè´¹è€…æ•°é‡: 0 é˜Ÿåˆ—: 79d02dde-2007-4a49-b94b-0d4bee67b19c æ¶ˆæ¯ç§¯å‹æ•°: 0</div><div class="line">æ¶ˆè´¹è€…æ•°é‡: 0 é˜Ÿåˆ—: aliveness-test æ¶ˆæ¯ç§¯å‹æ•°: 0</div><div class="line">æ¶ˆè´¹è€…æ•°é‡: 0 é˜Ÿåˆ—: cartService.orderCancel.update æ¶ˆæ¯ç§¯å‹æ•°: 0</div><div class="line">æ¶ˆè´¹è€…æ•°é‡: 0 é˜Ÿåˆ—: cartService.virtualOrderCancel.update æ¶ˆæ¯ç§¯å‹æ•°: 0</div><div class="line">æ¶ˆè´¹è€…æ•°é‡: 0 é˜Ÿåˆ—: e9de65bd-be59-4c1c-b4a8-7312f382ac59 æ¶ˆæ¯ç§¯å‹æ•°: 0</div><div class="line">æ¶ˆè´¹è€…æ•°é‡: 3 é˜Ÿåˆ—: message.bi æ¶ˆæ¯ç§¯å‹æ•°: 0</div><div class="line">æ¶ˆè´¹è€…æ•°é‡: 3 é˜Ÿåˆ—: message.cart æ¶ˆæ¯ç§¯å‹æ•°: 0</div><div class="line">æ¶ˆè´¹è€…æ•°é‡: 3 é˜Ÿåˆ—: message.console æ¶ˆæ¯ç§¯å‹æ•°: 0</div><div class="line">æ¶ˆè´¹è€…æ•°é‡: 3 é˜Ÿåˆ—: message.logistics æ¶ˆæ¯ç§¯å‹æ•°: 0</div><div class="line">æ¶ˆè´¹è€…æ•°é‡: 3 é˜Ÿåˆ—: message.order.info æ¶ˆæ¯ç§¯å‹æ•°: 0</div><div class="line">æ¶ˆè´¹è€…æ•°é‡: 30 é˜Ÿåˆ—: message.push.cart æ¶ˆæ¯ç§¯å‹æ•°: 0</div><div class="line">æ¶ˆè´¹è€…æ•°é‡: 3 é˜Ÿåˆ—: message.style æ¶ˆæ¯ç§¯å‹æ•°: 0</div><div class="line">æ¶ˆè´¹è€…æ•°é‡: 3 é˜Ÿåˆ—: message.user.related æ¶ˆæ¯ç§¯å‹æ•°: 0</div><div class="line">æ¶ˆè´¹è€…æ•°é‡: 0 é˜Ÿåˆ—: payment.virtual.notify.success æ¶ˆæ¯ç§¯å‹æ•°: 0</div><div class="line">æ¶ˆè´¹è€…æ•°é‡: 1 é˜Ÿåˆ—: 61b73745-4c74-475b-803e-bf2d48d2fa50 æ¶ˆæ¯ç§¯å‹æ•°: 0</div><div class="line">æ¶ˆè´¹è€…æ•°é‡: 1 é˜Ÿåˆ—: a984d00a-8bbe-43c1-aa20-c1dc788ddd97 æ¶ˆæ¯ç§¯å‹æ•°: 0</div><div class="line">æ¶ˆè´¹è€…æ•°é‡: 1 é˜Ÿåˆ—: e569e8a1-b7c9-4736-8bf8-13d76ecf7577 æ¶ˆæ¯ç§¯å‹æ•°: 0</div><div class="line">æ¶ˆè´¹è€…æ•°é‡: 3 é˜Ÿåˆ—: push.station.task.status æ¶ˆæ¯ç§¯å‹æ•°: 0</div></pre></td></tr></table></figure><p>ç¼–å†™zabbix-agentd ç›‘æ§ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[root@message-center-mq zabbix]<span class="comment"># vim zabbix_agentd.conf</span></div><div class="line">UserParameter=rabbitmq.consumer.bi,python /etc/zabbix/rabbitmq-monitor.py | grep message.bi |awk -F<span class="string">'[ :]'</span> <span class="string">'&#123;print $3&#125;'</span></div><div class="line">UserParameter=rabbitmq.overstock.bi,python /etc/zabbix/rabbitmq-monitor.py | grep message.bi |awk -F<span class="string">'[ :]'</span> <span class="string">'&#123;print $NF&#125;'</span></div><div class="line">UserParameter=rabbitmq.consumer.push.cart,python /etc/zabbix/rabbitmq-monitor.py | grep message.push.cart |awk -F<span class="string">'[ :]'</span> <span class="string">'&#123;print $3&#125;'</span></div><div class="line">UserParameter=rabbitmq.overstock.push.cart,python /etc/zabbix/rabbitmq-monitor.py | grep message.push.cart |awk -F<span class="string">'[ :]'</span> <span class="string">'&#123;print $NF&#125;'</span></div><div class="line">UserParameter=rabbitmq.consumer.user.related,python /etc/zabbix/rabbitmq-monitor.py | grep message.user.related |awk -F<span class="string">'[ :]'</span> <span class="string">'&#123;print $3&#125;'</span></div><div class="line">UserParameter=rabbitmq.overstock.user.related,python /etc/zabbix/rabbitmq-monitor.py | grep message.user.related |awk -F<span class="string">'[ :]'</span> <span class="string">'&#123;print $NF&#125;'</span></div><div class="line">UserParameter=rabbitmq.consumer.cart,python /etc/zabbix/rabbitmq-monitor.py | grep message.cart |awk -F<span class="string">'[ :]'</span> <span class="string">'&#123;print $3&#125;'</span></div><div class="line">UserParameter=rabbitmq.overstock.cart,python /etc/zabbix/rabbitmq-monitor.py | grep message.cart |awk -F<span class="string">'[ :]'</span> <span class="string">'&#123;print $NF&#125;'</span></div></pre></td></tr></table></figure><p>ç›‘æ§æ¨¡æ¿ä¸‹è½½ï¼šåœ¨æˆ‘githubä¸Šé¢.</p><p>weixinç›‘æ§æ•ˆæœå›¾ï¼š</p><p><img src="http://7xrthw.com1.z0.glb.clouddn.com/rabbitmq.png" alt=""></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;Zabbix-3-0-ç›‘æ§æ¨é€rabbitmqé˜Ÿåˆ—&quot;&gt;&lt;a href=&quot;#Zabbix-3-0-ç›‘æ§æ¨é€rabbitmqé˜Ÿåˆ—&quot; class=&quot;headerlink&quot; title=&quot;Zabbix 3.0 ç›‘æ§æ¨é€rabbitmqé˜Ÿåˆ—&quot;&gt;&lt;/a&gt;Zabbix 3.0 
      
    
    </summary>
    
      <category term="Bigdata Hadoop" scheme="http://blog.yancy.cc/categories/Bigdata-Hadoop/"/>
    
    
      <category term="Bigdata Hadoop" scheme="http://blog.yancy.cc/tags/Bigdata-Hadoop/"/>
    
      <category term="Rabbitmq" scheme="http://blog.yancy.cc/tags/Rabbitmq/"/>
    
  </entry>
  
  <entry>
    <title>Bigdata-Cloudera Manager5åŠCDH5å®‰è£…æŒ‡å¯¼</title>
    <link href="http://blog.yancy.cc/2017/07/29/Bigdata-hadoop/countly/Cloudera%20Manager5%E5%8F%8ACDH5%E5%AE%89%E8%A3%85%E6%8C%87%E5%AF%BC/"/>
    <id>http://blog.yancy.cc/2017/07/29/Bigdata-hadoop/countly/Cloudera Manager5åŠCDH5å®‰è£…æŒ‡å¯¼/</id>
    <published>2017-07-29T06:46:00.000Z</published>
    <updated>2017-09-27T17:09:29.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://7xrthw.com1.z0.glb.clouddn.com/Bigdata-Cloudera-Manager.png" alt=""></p><h3 id="é—®é¢˜å¯¼è¯»ï¼š"><a href="#é—®é¢˜å¯¼è¯»ï¼š" class="headerlink" title="é—®é¢˜å¯¼è¯»ï¼š"></a>é—®é¢˜å¯¼è¯»ï¼š</h3><p>1.ä»€ä¹ˆæ˜¯cloudera CM ã€CDH?<br>2.CDHã€CMæœ‰å“ªäº›ç‰ˆæœ¬ï¼Ÿ<br>3.CDHã€CMæœ‰å“ªäº›å®‰è£…æ–¹å¼ï¼Ÿ<br>4.CDHå¦‚ä½•å¼€å‘ï¼Ÿ</p><a id="more"></a><h3 id="ä»€ä¹ˆæ˜¯CDH"><a href="#ä»€ä¹ˆæ˜¯CDH" class="headerlink" title="ä»€ä¹ˆæ˜¯CDH"></a>ä»€ä¹ˆæ˜¯CDH</h3><p>hadoopæ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œæ‰€ä»¥å¾ˆå¤šå…¬å¸åœ¨è¿™ä¸ªåŸºç¡€è¿›è¡Œå•†ä¸šåŒ–ï¼ŒClouderaå¯¹hadoopåšäº†ç›¸åº”çš„æ”¹å˜ã€‚<br>Clouderaå…¬å¸çš„å‘è¡Œç‰ˆï¼Œæˆ‘ä»¬å°†è¯¥ç‰ˆæœ¬ç§°ä¸ºCDHã€‚</p><p>å¾ˆå¤šæ–°æ‰‹é—®çš„æœ€å¤šçš„é—®é¢˜æ˜¯ï¼Œå“ªä¸ªæ˜¯æ”¶è´¹çš„ï¼Œé‚£ä¸ªæ˜¯å…è´¹çš„ã€‚<br>Cloudera Expressç‰ˆæœ¬æ˜¯å…è´¹çš„<br>Cloudera Enterpriseæ˜¯éœ€è¦è´­ä¹°æ³¨å†Œç çš„</p><p>æ›´å¤šå†…å®¹ï¼š<br>Cloudera Hadoopä»€ä¹ˆæ˜¯CDHåŠCDHç‰ˆæœ¬ä»‹ç» :<a href="http://www.aboutyun.com/thread-6788-1-1.html" target="_blank" rel="external">http://www.aboutyun.com/thread-6788-1-1.html</a> </p><p>CDHï¼ˆClouderaï¼‰ä¸hadoopï¼ˆapacheï¼‰å¯¹æ¯” : <a href="http://www.aboutyun.com/thread-9225-1-1.html" target="_blank" rel="external">http://www.aboutyun.com/thread-9225-1-1.html</a></p><p>å¤§æ•°æ®æ¶æ„å¸ˆåŸºç¡€ï¼šhadoopå®¶æ—ï¼ŒClouderaäº§å“ç³»åˆ—ç­‰å„ç§æŠ€æœ¯ : <a href="http://www.aboutyun.com/thread-6842-1-1.html" target="_blank" rel="external">http://www.aboutyun.com/thread-6842-1-1.html</a> </p><h3 id="å®˜ç½‘ä»‹ç»"><a href="#å®˜ç½‘ä»‹ç»" class="headerlink" title="å®˜ç½‘ä»‹ç»"></a>å®˜ç½‘ä»‹ç»</h3><p><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera1.png" alt=""></p><p><strong>ä¸»é¡µï¼š</strong><br><a href="https://www.cloudera.com/downloads/manager/5-12-0.html" target="_blank" rel="external">https://www.cloudera.com/downloads/manager/5-12-0.html</a></p><h3 id="CM-Cloudera-Manager-æœ‰ä¸‰ç§å®‰è£…æ–¹å¼ï¼š"><a href="#CM-Cloudera-Manager-æœ‰ä¸‰ç§å®‰è£…æ–¹å¼ï¼š" class="headerlink" title="CM(Cloudera Manager)æœ‰ä¸‰ç§å®‰è£…æ–¹å¼ï¼š"></a>CM(Cloudera Manager)æœ‰ä¸‰ç§å®‰è£…æ–¹å¼ï¼š</h3><p><strong>1.ç¬¬ä¸€ç§ä½¿ç”¨cloudera-manager-installer.binå®‰è£…</strong></p><p>è¿™ç§å®‰è£…æ–¹å¼ï¼Œåªè¦ä»å®˜ç½‘ä¸‹è½½<code>cloudera-manager-installer.bin</code> ç„¶åæ‰§è¡Œè¿™ä¸ª<code>bin</code>æ–‡ä»¶ï¼Œå‰©ä¸‹çš„å°±æ˜¯ç­‰å¾…ä¸‹è½½å’Œå®‰è£…ã€‚ä½†æ˜¯è¿™ä¸ªæ—¶é—´ä¸æ˜¯ä¸€èˆ¬çš„é•¿ï¼Œæœ€å¥½åƒä¸ªé¥­ï¼Œç¡ä¸ªè§‰ï¼Œæœ€åçœ‹åˆ°è¿˜åœ¨å®‰è£…è¿‡ç¨‹ä¸­ã€‚æ­¤å¸–å®‰è£…æ­¥éª¤åŠé‡åˆ°é—®é¢˜è®°å½•å¾ˆè¯¦ç»†ï¼Œå¯å‚è€ƒ<br><a href="http://www.aboutyun.com/thread-9303-1-1.html" target="_blank" rel="external">Cloudera Manager5åŠCDH5åœ¨çº¿ï¼ˆcloudera-manager-installer.binï¼‰å®‰è£…è¯¦ç»†æ–‡æ¡£</a><br><a href="http://www.aboutyun.com/thread-9075-1-1.html" target="_blank" rel="external">Cloudera Manager5åŠCDH5å®‰è£…æŒ‡å¯¼ï¼ˆç»ˆæåœ¨çº¿å®‰è£…ï¼‰</a></p><h3 id="é—®é¢˜å¯¼è¯»ï¼š-1"><a href="#é—®é¢˜å¯¼è¯»ï¼š-1" class="headerlink" title="é—®é¢˜å¯¼è¯»ï¼š"></a>é—®é¢˜å¯¼è¯»ï¼š</h3><p>1.Cloudera Manager5å®‰è£…éœ€è¦å“ªäº›ç¯å¢ƒè¦æ±‚ï¼Ÿ<br>2.å“ªäº›Linuxç³»ç»Ÿä¸Šï¼Œå¯ä»¥å®‰è£…Cloudera Manager5ï¼Ÿ<br>3.åœ¨å®‰è£…cdhçš„è¿‡ç¨‹ä¸­ï¼Œè¯¥å¦‚ä½•é€‰æ‹©ç‰ˆæœ¬ï¼Ÿ</p><p><strong>å®‰è£…ç¯å¢ƒè¦æ±‚</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">é›†ç¾¤ä¸­çš„å››å°ä¸»æœºå¿…é¡»æ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼š</div><div class="line">ä¸»æœºå¿…é¡»è‡³å°‘æœ‰16 GBçš„RAM</div><div class="line">å¯¹äºRAMï¼Œæˆ‘ä»¬æˆ–è®¸æ²¡æœ‰å¤ªå¤šçš„æ¦‚å¿µï¼Œä¸‹é¢å¯ä»¥å‚è€ƒ</div><div class="line">RAMå®¹é‡æ˜¯è¿è¡Œä¸­çš„ç¨‹åºæ‰€å ç”¨çš„ç©ºé—´ï¼Œä»–è¿è¡Œéœ€è¦çš„ç©ºé—´ã€</div><div class="line">ROMå®¹é‡æ˜¯ä½ çš„ç³»ç»Ÿå¯ä»¥å­˜æ”¾ï¼Œå ç”¨çš„ç©ºé—´ï¼Œä½ çš„æ‰€æœ‰ç³»ç»Ÿæ–‡ä»¶ï¼Œç¨‹åºéƒ½åœ¨è¿™é‡Œå­˜æ”¾ã€‚</div><div class="line"></div><div class="line">å¿…é¡»ä½¿ç”¨rootç”¨æˆ·ï¼Œæˆ–åˆ™ä½¿ç”¨sudoæ— å¯†ç è®¿é—®</div><div class="line">ï¼ˆä¹Ÿå°±æ˜¯è¯´å½“ä½ ä½¿ç”¨å…¶å®ƒç”¨æˆ·ï¼Œä½¿ç”¨sudoçš„æ—¶å€™ï¼Œä¸èƒ½è¾“å…¥å¯†ç ï¼‰</div><div class="line"></div><div class="line">å¦‚æœä½¿ç”¨rootç”¨æˆ·ï¼Œå¿…é¡»ä½¿ç”¨ç›¸åŒçš„å¯†ç </div><div class="line">ä¸»æœºå¿…é¡»èƒ½ä¸Šç½‘ï¼Œå…è®¸å®‰è£…å‘å¯¼è®¿é—®cdm.jollychic.com</div><div class="line">å¯ä»¥ä»ä¸‹é¢é€‰æ‹©ä¸€ä¸ªç³»ç»Ÿ</div><div class="line"></div><div class="line">RHEL-å…¼å®¹ç³»ç»Ÿ</div><div class="line">Red Hat Enterprise Linux and CentOS 5, 64-bit</div><div class="line">Red Hat Enterprise Linux and CentOS 6, 64-bit</div><div class="line">Red Hat Enterprise Linux and CentOS 7 <span class="keyword">in</span> SE Linux Mode</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">SLES - SUSE Linux Enterprise Server 11, 64-bit. Service Pack 2æˆ–åˆ™æ›´é«˜ç‰ˆæœ¬. æ›´æ–°å­˜å‚¨åº“å¿…é¡»æ˜¯æ¿€æ´»çš„å’Œ SUSE Linux Enterprise è½¯ä»¶å¼€å‘åŒ…11 SP1 .</div><div class="line">Debian - Debian 7.0 and 7.1, 64-bit</div><div class="line">Ubuntu - Ubuntu 12.04, 64-bit</div><div class="line"></div><div class="line">å¦‚æœè¦æ±‚ä¸èƒ½ä¸Šé¢æ»¡è¶³ï¼Œå®‰è£…ä¼šä¸æˆåŠŸã€‚å…³äºCloudera Managerå®‰è£…é€‰é¡¹å’Œå®‰è£…è¦æ±‚çš„è¯¦ç»†ä¿¡æ¯å¯ä»¥æŸ¥çœ‹Cloudera Managerå®‰è£…å‘å¯¼ï¼ˆè‹±æ–‡ç‰ˆï¼‰</div><div class="line">è¡¥å……å’Œå¼ºè°ƒä¸€äº›å†…å®¹</div><div class="line">1.å…³é—­é˜²ç«å¢™</div><div class="line">2.é…ç½®hostï¼Œå¦‚ä¸‹å½¢å¼</div><div class="line">3.swapoff <span class="_">-a</span> å…³é—­swapåˆ†åŒº</div><div class="line">æ·»åŠ å¼€æœºå¯åŠ¨ç”Ÿæ•ˆï¼š</div><div class="line"><span class="built_in">echo</span> never &gt; /sys/kernel/mm/transparent_hugepage/defrag</div><div class="line"><span class="built_in">echo</span> never &gt; /sys/kernel/mm/transparent_hugepage/enabled</div></pre></td></tr></table></figure><h3 id="ç¯å¢ƒï¼š"><a href="#ç¯å¢ƒï¼š" class="headerlink" title="ç¯å¢ƒï¼š"></a>ç¯å¢ƒï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">ç³»ç»Ÿï¼š CentOS Linux release 7.3.1611 (Core)  </div><div class="line">2å°Namenode</div><div class="line">10å°DataNode</div><div class="line">1å°cdm å®‰è£…Cloudera Manager</div><div class="line">1å°gateway</div></pre></td></tr></table></figure><h3 id="å®‰è£…æ­¥éª¤ï¼š"><a href="#å®‰è£…æ­¥éª¤ï¼š" class="headerlink" title="å®‰è£…æ­¥éª¤ï¼š"></a>å®‰è£…æ­¥éª¤ï¼š</h3><ul><li>å‡†å¤‡å·¥ä½œ</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">é…ç½®hosts</div><div class="line"></div><div class="line">14å°æœåŠ¡å™¨éœ€è¦é…ç½®hostnameåŠhostså¦‚ä¸‹</div><div class="line">ï¼ˆè¿™é‡Œä¸€å®šè¦é…ç½®æ­£ç¡®å¦åˆ™ï¼Œä¼šé¢ä¼šå‡ºé€šä¿¡é—®é¢˜ï¼‰</div><div class="line"></div><div class="line">vim /etc/hosts</div><div class="line">127.0.0.1 localhost.localdomain localhost</div><div class="line">10.155.90.132  cdm  cdm.jollychic.com</div><div class="line">10.155.90.134  gateway gateway.jollychic.com</div><div class="line">10.155.90.165  namenode1  namenode1.jollychic.com</div><div class="line">10.155.90.146  namenode2  namenode2.jollychic.com</div><div class="line">10.155.90.177  datanode1  datanode1.jollychic.com</div><div class="line">10.155.90.184  datanode2  datanode2.jollychic.com</div><div class="line">10.155.90.166  datanode3  datanode3.jollychic.com</div><div class="line">10.155.90.188  datanode4  datanode4.jollychic.com</div><div class="line">10.155.90.156  datanode5  datanode5.jollychic.com</div><div class="line">10.155.90.172  datanode6  datanode6.jollychic.com</div><div class="line">10.155.90.182  datanode7  datanode7.jollychic.com</div><div class="line">10.155.90.142  datanode8  datanode8.jollychic.com</div><div class="line">10.155.90.151  datanode9  datanode9.jollychic.com</div><div class="line">10.155.90.159  datanode10  datanode10.jollychic.com</div><div class="line"></div><div class="line">å…³é—­SELinux</div><div class="line">[root@cdm ~]<span class="comment"># setenforce 0</span></div><div class="line">[root@cdm ~]<span class="comment"># getenforce</span></div><div class="line">Disabled</div></pre></td></tr></table></figure><ul><li>ä¸‹è½½å®‰è£…ï¼š</li></ul><figure class="highlight armasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">å•å‡»ä¸‹è½½ Cloudera Express æˆ–åˆ™ Download Cloudera Enterprise. æŸ¥çœ‹ Cloudera Express <span class="keyword">and </span>Cloudera Enterprise Features.</div><div class="line">é€‰æ‹©æ³¨å†Œå’Œå•å‡»<span class="keyword">Submit </span>æˆ–åˆ™ç›´æ¥å•å‡»ä¸‹è½½é¡µé“¾æ¥ï¼ˆ download pageï¼‰ï¼Œä¸‹è½½ cloudera-manager-installer.<span class="keyword">binæ–‡ä»¶</span></div><div class="line"></div><div class="line"><span class="symbol">Pre</span>-requisites: <span class="keyword">multiple, </span>Internet-connected Linux machines, with SSH access, <span class="keyword">and </span>significant free <span class="meta">space</span> in /var <span class="keyword">and </span>/<span class="meta">opt</span>.</div><div class="line"></div><div class="line"><span class="number">1</span>. ä¸‹è½½cloudera-manager-installer.<span class="keyword">bin</span></div><div class="line">$ wget http://archive.cloudera.com/cm5/installer/latest/cloudera-manager-installer.<span class="keyword">bin</span></div><div class="line"></div><div class="line"><span class="number">2</span>.æ”¹å˜ cloudera-manager-installer.<span class="keyword">bin </span>çš„æ‰§è¡Œæƒé™</div><div class="line"></div><div class="line">$ chmod u+x cloudera-manager-installer.<span class="keyword">bin</span></div><div class="line">å¤åˆ¶ä»£ç </div><div class="line"></div><div class="line"><span class="number">3</span>.æ‰§è¡Œ cloudera-manager-installer.<span class="keyword">bin</span></div><div class="line"></div><div class="line">$ sudo ./cloudera-manager-installer.<span class="keyword">bin</span></div><div class="line">å¤åˆ¶ä»£ç </div><div class="line"></div><div class="line"><span class="number">4</span>.æŒ‰ç…§cloudera-managerçš„README æ¥å®‰è£…</div><div class="line"><span class="number">5</span>.é˜…è¯»Cloudera Manager Express Licenseï¼Œç„¶åæŒ‰ç…§æç¤ºé€‰æ‹©YESæ¥ç¡®å®šæ¥å—æˆæƒï¼ˆlicenseï¼‰</div><div class="line"><span class="number">6</span>.è¯»å– Oracle äºŒè¿›åˆ¶ <span class="meta">Code</span> æˆæƒè®¸å¯åè®®ï¼Œç„¶åå®‰è£… </div><div class="line"><span class="number">7</span>.å½“å®‰è£…å®Œæˆï¼ŒCloudera Manager ç®¡ç†æ§åˆ¶å°ä¼šæä¾›ä¸€ä¸ªå®Œæˆçš„urlåŒ…æ‹¬é»˜è®¤ç«¯å£<span class="number">7180</span></div><div class="line"></div><div class="line">æˆ‘è¿™ç§æ–¹æ³•æ˜¯åœ¨çº¿å®‰è£…æ–¹å¼ï¼Œå°±è¯´ç›´æ¥ç”¨.<span class="keyword">binè®©ç³»ç»Ÿè‡ªåŠ¨ä¸‹è½½éœ€è¦çš„jdkå’Œcmç®¡ç†åŒ…ã€‚ </span></div><div class="line">å¦‚æœç½‘ç»œå·®å»ºè®®ç”¨ç¦»çº¿å®‰è£…æ–¹å¼ã€‚</div></pre></td></tr></table></figure><p>å…ˆåœ¨æœ¬åœ°æ­å»ºä¸€ä¸ª<a href="https://www.cloudera.com/documentation/enterprise/latest/topics/cdh_ig_yumrepo_local_create.html" target="_blank" rel="external">Creating a Local Yum Repository:</a><br>ä¸‹è½½ç‹¬ç«‹çš„åŒ…è·¯å¾„ï¼š<a href="http://archive.cloudera.com/cm5/redhat/6/x86_64/cm/5/RPMS/x86_64/" target="_blank" rel="external">cm need package</a></p><p>å®‰è£…å®Œæˆä»¥åæœåŠ¡ä¹Ÿå¯åŠ¨ã€‚</p><p><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera2.png" alt=""></p><p>è¿™é‡Œæ˜¾ç¤ºå®‰è£…æˆåŠŸï¼Œè®¿é—®åœ°å€ï¼Œå¦‚æœç¦»çº¿å®‰è£…ä¸åˆ°è¿™ä¸€æ­¥ä¸èƒ½æ“ä½œï¼Œä¼šæç¤ºæŠ¥é”™æŒ‡ç¤ºã€‚å…ˆæ‰‹åŠ¨ä¸‹è½½å¥½åŒ…rpmå®‰è£…ä¸Šå³å¯ã€‚</p><h4 id="å®‰è£…ç›®å½•è¯¦æƒ…ï¼š"><a href="#å®‰è£…ç›®å½•è¯¦æƒ…ï¼š" class="headerlink" title="å®‰è£…ç›®å½•è¯¦æƒ…ï¼š"></a>å®‰è£…ç›®å½•è¯¦æƒ…ï¼š</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">é»˜è®¤å®‰è£…ç›®å½•ï¼š/opt/cloudera</div><div class="line">æ—¥å¿—ç›®å½•ï¼š/var/<span class="built_in">log</span>/cloudera-scm-server</div><div class="line">å¯åŠ¨æœåŠ¡ï¼š[root@yancy cloudera-scm-server]<span class="comment"># /etc/init.d/cloudera-scm-server status</span></div><div class="line">cloudera-scm-server (pid  2723) æ­£åœ¨è¿è¡Œ...</div></pre></td></tr></table></figure><h4 id="æŸ¥çœ‹å¯åŠ¨è¿›ç¨‹ç«¯å£ï¼š"><a href="#æŸ¥çœ‹å¯åŠ¨è¿›ç¨‹ç«¯å£ï¼š" class="headerlink" title="æŸ¥çœ‹å¯åŠ¨è¿›ç¨‹ç«¯å£ï¼š"></a>æŸ¥çœ‹å¯åŠ¨è¿›ç¨‹ç«¯å£ï¼š</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@cdm opt]<span class="comment"># netstat -ntulp | grep java</span></div><div class="line">tcp        0      0 0.0.0.0:7180            0.0.0.0:*               LISTEN      25780/java</div><div class="line">tcp        0      0 0.0.0.0:7182            0.0.0.0:*               LISTEN      25780/java   </div><div class="line"></div><div class="line">è®¿é—®åœ°å€ï¼šhttp://cdm.jollychic.com:7180 </div><div class="line">ç™»å½•Cloudera Manager Admin æ§åˆ¶</div><div class="line">Username: admin </div><div class="line">Password: admin.</div></pre></td></tr></table></figure><h3 id="ä½¿ç”¨Cloudera-Manager-å‘å¯¼å®‰è£…å’Œé…ç½®è½¯ä»¶"><a href="#ä½¿ç”¨Cloudera-Manager-å‘å¯¼å®‰è£…å’Œé…ç½®è½¯ä»¶" class="headerlink" title="ä½¿ç”¨Cloudera Manager å‘å¯¼å®‰è£…å’Œé…ç½®è½¯ä»¶"></a>ä½¿ç”¨Cloudera Manager å‘å¯¼å®‰è£…å’Œé…ç½®è½¯ä»¶</h3><h4 id="clouderaé¦–é¡µï¼š"><a href="#clouderaé¦–é¡µï¼š" class="headerlink" title="clouderaé¦–é¡µï¼š"></a>clouderaé¦–é¡µï¼š</h4><p><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera3.png" alt=""></p><h5 id="1-æ·»åŠ æœåŠ¡å™¨é›†ç¾¤ï¼š"><a href="#1-æ·»åŠ æœåŠ¡å™¨é›†ç¾¤ï¼š" class="headerlink" title="1. æ·»åŠ æœåŠ¡å™¨é›†ç¾¤ï¼š"></a>1. æ·»åŠ æœåŠ¡å™¨é›†ç¾¤ï¼š</h5><p>åœ¨é›†ç¾¤ä¸»æœºä¸Šå®‰è£…å’Œé…ç½®Cloudera Manager ï¼ŒCDHï¼Œå’Œç®¡ç†æœåŠ¡è½¯ä»¶åŒ…æ‹¬ä»¥ä¸‹ä¸‰ä¸ªä¸»è¦æ­¥éª¤<br>é€‰æ‹© Cloudera Manager ç‰ˆæœ¬ å’ŒæŒ‡å®šä¸»æœº</p><p><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera5.png" alt=""></p><h5 id="2-é€‰æ‹©å…è´¹ç‰ˆï¼Œaddç»§ç»­"><a href="#2-é€‰æ‹©å…è´¹ç‰ˆï¼Œaddç»§ç»­" class="headerlink" title="2. é€‰æ‹©å…è´¹ç‰ˆï¼Œaddç»§ç»­"></a>2. é€‰æ‹©å…è´¹ç‰ˆï¼Œaddç»§ç»­</h5><p><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera6.png" alt=""></p><h5 id="3-æ˜¾ç¤ºçš„æ˜¯å®‰è£…Cloudera-Manageråé¢å¯ä»¥å®‰è£…çš„æœåŠ¡çš„è½¯ä»¶åŒ…"><a href="#3-æ˜¾ç¤ºçš„æ˜¯å®‰è£…Cloudera-Manageråé¢å¯ä»¥å®‰è£…çš„æœåŠ¡çš„è½¯ä»¶åŒ…" class="headerlink" title="3. æ˜¾ç¤ºçš„æ˜¯å®‰è£…Cloudera Manageråé¢å¯ä»¥å®‰è£…çš„æœåŠ¡çš„è½¯ä»¶åŒ…"></a>3. æ˜¾ç¤ºçš„æ˜¯å®‰è£…Cloudera Manageråé¢å¯ä»¥å®‰è£…çš„æœåŠ¡çš„è½¯ä»¶åŒ…</h5><p><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera7.png" alt=""></p><h5 id="4-è¿™é‡Œéœ€è¦è¯´æ˜çš„æ˜¯æŒ‡å®šä¸»æœºå®‰è£…æœ‰å¤šç§æ–¹å¼ï¼š"><a href="#4-è¿™é‡Œéœ€è¦è¯´æ˜çš„æ˜¯æŒ‡å®šä¸»æœºå®‰è£…æœ‰å¤šç§æ–¹å¼ï¼š" class="headerlink" title="4. è¿™é‡Œéœ€è¦è¯´æ˜çš„æ˜¯æŒ‡å®šä¸»æœºå®‰è£…æœ‰å¤šç§æ–¹å¼ï¼š"></a>4. è¿™é‡Œéœ€è¦è¯´æ˜çš„æ˜¯æŒ‡å®šä¸»æœºå®‰è£…æœ‰å¤šç§æ–¹å¼ï¼š</h5><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="number">1.</span>ç›´æ¥åˆ—å‡ºipæˆ–åˆ™hostï¼Œå¤šå°ä»¥é€—å·ã€åˆ†å·ã€åˆ¶è¡¨ç¬¦ã€ç©ºæ ¼æˆ–æ”¾ç½®åœ¨å•ç‹¬çš„è¡Œã€‚</div><div class="line"><span class="number">2.</span>æŒ‡å®šipçš„åœ°å€èŒƒå›´ä¾‹å¦‚ï¼š<span class="number">10.1</span><span class="number">.1</span>.[<span class="number">1</span><span class="number">-4</span>] æˆ–åˆ™ host[<span class="number">1</span><span class="number">-3</span>].hadoop.com<span class="number">.3</span>.è®°å¾—æŒ‡å®šçš„ä¸»æœºéœ€è¦å…³é—­é˜²ç«å¢™ï¼Œï¼ˆå¦‚æœé‡åˆ°ä¸èƒ½å®‰è£…ï¼Œæœ€å¥½ä½¿ç”¨å®‰è£…cloudera managerè™šæ‹Ÿæœºè¿›è¡Œå¤åˆ¶ï¼‰</div><div class="line">é€‰æ‹©éœ€è¦å®‰è£…çš„Hadoop datanodeæœåŠ¡å™¨ï¼šè¿™é‡Œæˆ‘ä»¬çº¿ä¸Šè®¿é—®ç«¯å£ä¸æ˜¯<span class="number">22</span>æ˜¯<span class="number">58958</span></div></pre></td></tr></table></figure><p>æ˜¾ç¤ºå¦‚ä¸‹å›¾è¯´æ˜æœºå™¨é€šä¿¡æ²¡é—®é¢˜ã€‚</p><p><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera8.png" alt=""></p><h5 id="5-å®‰è£…CDH"><a href="#5-å®‰è£…CDH" class="headerlink" title="5. å®‰è£…CDH"></a>5. å®‰è£…CDH</h5><p>é€‰æ‹©å®‰è£…æ–¹å¼<br>å½“æˆ‘ä»¬é€‰æ‹©å®‰è£…çš„hostä¹‹åï¼Œæˆ‘ä»¬éœ€è¦é€‰æ‹©CDHçš„å®‰è£…æ–¹å¼ï¼ˆæ–¹æ³•ï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</p><p><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera9.png" alt=""><br><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera10.png" alt=""></p><h5 id="6-è¿™é‡Œç‚¹å‡»å®‰è£…Javaå·¥å…·åŒ…"><a href="#6-è¿™é‡Œç‚¹å‡»å®‰è£…Javaå·¥å…·åŒ…" class="headerlink" title="6. è¿™é‡Œç‚¹å‡»å®‰è£…Javaå·¥å…·åŒ…"></a>6. è¿™é‡Œç‚¹å‡»å®‰è£…Javaå·¥å…·åŒ…</h5><p><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera11.png" alt=""></p><h5 id="7-è¿™é‡ŒæŠŠéœ€è¦å®‰è£…çš„HadoopæœåŠ¡å™¨rootå¯†ç è®¾ç½®ä¸€æ ·ï¼Œæˆ–è€…ä½¿ç”¨å…¶ä»–ç”¨æˆ·ä¹Ÿå¯ä»¥ï¼Œåªè¦æœ‰sudoæƒé™éƒ½å¯ä»¥ã€‚"><a href="#7-è¿™é‡ŒæŠŠéœ€è¦å®‰è£…çš„HadoopæœåŠ¡å™¨rootå¯†ç è®¾ç½®ä¸€æ ·ï¼Œæˆ–è€…ä½¿ç”¨å…¶ä»–ç”¨æˆ·ä¹Ÿå¯ä»¥ï¼Œåªè¦æœ‰sudoæƒé™éƒ½å¯ä»¥ã€‚" class="headerlink" title="7. è¿™é‡ŒæŠŠéœ€è¦å®‰è£…çš„HadoopæœåŠ¡å™¨rootå¯†ç è®¾ç½®ä¸€æ ·ï¼Œæˆ–è€…ä½¿ç”¨å…¶ä»–ç”¨æˆ·ä¹Ÿå¯ä»¥ï¼Œåªè¦æœ‰sudoæƒé™éƒ½å¯ä»¥ã€‚"></a>7. è¿™é‡ŒæŠŠéœ€è¦å®‰è£…çš„HadoopæœåŠ¡å™¨rootå¯†ç è®¾ç½®ä¸€æ ·ï¼Œæˆ–è€…ä½¿ç”¨å…¶ä»–ç”¨æˆ·ä¹Ÿå¯ä»¥ï¼Œåªè¦æœ‰sudoæƒé™éƒ½å¯ä»¥ã€‚</h5><p><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera12.png" alt=""><br><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera13.png" alt=""></p><h5 id="8-å®‰è£…è¿™é‡Œå¦‚æœæç¤ºå‡ºç°æŠ¥é”™ï¼šæŸ¥çœ‹å¥½æ–‡-Cloudera-Manager5-åœ¨çº¿binå®‰è£…é‡åˆ°-æ— æ³•æ£€æµ‹åˆ°-Agent-å‘å‡ºçš„æ£€æµ‹ä¿¡å·-æ€»ç»“"><a href="#8-å®‰è£…è¿™é‡Œå¦‚æœæç¤ºå‡ºç°æŠ¥é”™ï¼šæŸ¥çœ‹å¥½æ–‡-Cloudera-Manager5-åœ¨çº¿binå®‰è£…é‡åˆ°-æ— æ³•æ£€æµ‹åˆ°-Agent-å‘å‡ºçš„æ£€æµ‹ä¿¡å·-æ€»ç»“" class="headerlink" title="8.å®‰è£…è¿™é‡Œå¦‚æœæç¤ºå‡ºç°æŠ¥é”™ï¼šæŸ¥çœ‹å¥½æ–‡ Cloudera Manager5 åœ¨çº¿binå®‰è£…é‡åˆ° æ— æ³•æ£€æµ‹åˆ° Agent å‘å‡ºçš„æ£€æµ‹ä¿¡å· æ€»ç»“"></a>8.å®‰è£…è¿™é‡Œå¦‚æœæç¤ºå‡ºç°æŠ¥é”™ï¼šæŸ¥çœ‹å¥½æ–‡ <a href="http://www.aboutyun.com/thread-9293-1-1.html" target="_blank" rel="external">Cloudera Manager5 åœ¨çº¿binå®‰è£…é‡åˆ° æ— æ³•æ£€æµ‹åˆ° Agent å‘å‡ºçš„æ£€æµ‹ä¿¡å· æ€»ç»“</a></h5><p><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera14.png" alt=""><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">è¿™é‡Œåªéœ€è¦å¸è½½ï¼š</div><div class="line">yum remove cloudera-manager-agent </div><div class="line"></div><div class="line">å¦‚æœæƒ³é‡æ–°å®‰è£…å¯ä»¥å¸è½½æ‰€æœ‰ï¼š</div><div class="line">yum remove cloudera-manager-repository cloudera-manager-agent cloudera-manager-daemons cloudera-manager-server-db cloudera-manager-server -y</div></pre></td></tr></table></figure></p><p><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera15.png" alt=""></p><h5 id="9-é›†ç¾¤å®‰è£…"><a href="#9-é›†ç¾¤å®‰è£…" class="headerlink" title="9.é›†ç¾¤å®‰è£…"></a>9.é›†ç¾¤å®‰è£…</h5><p><strong>å›¾1</strong></p><p><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera16.png" alt=""><br><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera17.png" alt=""><br><strong>è¿™æ˜¯ä¸€ä¸ªå¾ˆæ¼«é•¿çš„è¿‡ç¨‹ï¼Œä¸å¹¸çš„æ˜¯åœ¨ä¸‹è½½å®Œæ¯•ï¼Œæ‰§è¡Œåˆ†å‘çš„æ—¶å€™ï¼Œè¿™ä¸ªè¿‡ç¨‹è¢«æ‰“æ–­ï¼Œå®‰è£…è¢«ç»ˆæ­¢ã€‚å¯¼è‡´å›ä¸åˆ°å›¾2ï¼Œè¿™ä¸ªè¯¥å¦‚ä½•è§£å†³ï¼Ÿ</strong><br><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera18.png" alt=""></p><p>éš¾é“çœŸçš„è¦é‡è£…å—ï¼ŸèŠ±è´¹äº†å¤§åŠå¤©åŠŸå¤«ï¼Œåˆä¸å¾—ä¸é‡æ¥ã€‚<br>è¿™é‡Œé¢çš„é—®é¢˜æ˜¯æ‰¾ä¸åˆ°cloudera manager5æ‰€ç®¡ç†çš„èŠ‚ç‚¹äº†ï¼Ÿ</p><p>è®°å¾—aboutäº‘æœ‰è¿™ç¯‡æ–‡ç« <a href="http://www.aboutyun.com/thread-8992-1-1.html" target="_blank" rel="external">å¸è½½ Cloudera Manager 5.1.x.å’Œ ç›¸å…³è½¯ä»¶</a>ã€å®˜ç½‘ç¿»è¯‘ï¼šé«˜å¯ç”¨ã€‘<br>ä½†æ˜¯è¿™ç¯‡æ–‡ç« æ˜¯å¸è½½Cloudera Managerä»¥åŠCDHçš„ï¼Œç”±äºcloudera-scm-serverå’Œcloudera-scm-agentæŸ¥çœ‹éƒ½æ˜¯è¿è¡Œæ­£å¸¸çš„ï¼Œå¦‚ä½•æŸ¥çœ‹çŠ¶æ€ï¼Œå¯ä»¥å‚è€ƒï¼š</p><p><a href="http://www.aboutyun.com/thread-9096-1-1.html" target="_blank" rel="external">Cloudera Manager Server5åŠCloudera Manager Agents5å‘½ä»¤æ•´ç†ï¼ˆaboutäº‘ï¼‰</a>ï¼Œæ‰€ä»¥cloudera managerä¸éœ€è¦å¸è½½ï¼Œå¸è½½çš„æ˜¯CDHçš„ç›¸å…³å†…å®¹ã€‚<br>äºæ˜¯æ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼š</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">sudo apt-<span class="keyword">update</span> remove avro-tools crunch flume-ng hadoop-hdfs-fuse hadoop-hdfs-nfs3 hadoop-httpfs hbase-solr hive-hbase hive-webhcat hue-beeswax hue-hbase hue-impala hue-pig hue-plugins hue-rdbms hue-<span class="keyword">search</span> hue-spark hue-sqoop hue-zookeeper impala impala-<span class="keyword">shell</span> kite llama mahout oozie pig pig-udf-datafu <span class="keyword">search</span> sentry solr-mapreduce spark-python sqoop sqoop2 whirr</div><div class="line">å¤åˆ¶ä»£ç </div><div class="line">sudo apt-get clean</div><div class="line">å¤åˆ¶ä»£ç </div><div class="line">sudo <span class="keyword">rm</span> -Rf /<span class="keyword">var</span>/lib/flume-ng /<span class="keyword">var</span>/lib/hadoop* /<span class="keyword">var</span>/lib/hue /<span class="keyword">var</span>/lib/navigator /<span class="keyword">var</span>/lib/oozie /<span class="keyword">var</span>/lib/solr /<span class="keyword">var</span>/lib/sqoop* /<span class="keyword">var</span>/lib/zookeeper</div><div class="line">å¤åˆ¶ä»£ç </div><div class="line">sudo <span class="keyword">rm</span> -Rf /dfs /mapred /yarn</div><div class="line">å¤åˆ¶ä»£ç </div><div class="line">é€šè¿‡ä¸Šé¢ç»ˆäºæ‰¾åˆ°æ‰€ç®¡ç†çš„ä¸‰ä¸ªèŠ‚ç‚¹ã€‚ç„¶åä»æ–°ç™»å½•ï¼Œé€‰æ‹©ä¸‰ä¸ªä¸»æœºï¼Œç„¶åç»§ç»­ç»§ç»­ï¼Œæœ€åç»ˆäºè¿›å…¥äº†è¿™ä¸ªç•Œé¢ã€‚ä½†æ˜¯ç»†å¿ƒçš„åŒå­¦ä¼šå‘ç°è¿™é‡Œå·²ç»æ›´æ¢ä¸ºä¸­æ–‡ç‰ˆæœ¬ã€‚å› ä¸ºè¿™æ˜¯é€šè¿‡å®¿ä¸»ä¸»æœºè®¿é—®çš„ã€‚è€Œå‰é¢æ˜¯åœ¨è™šæ‹Ÿæœºé‡Œä½¿ç”¨firefoxè®¿é—®çš„ã€‚</div></pre></td></tr></table></figure><h4 id="æˆåŠŸåˆ°è¿™ä¸€æ­¥ï¼šé›†ç¾¤å®‰è£…"><a href="#æˆåŠŸåˆ°è¿™ä¸€æ­¥ï¼šé›†ç¾¤å®‰è£…" class="headerlink" title="æˆåŠŸåˆ°è¿™ä¸€æ­¥ï¼šé›†ç¾¤å®‰è£…"></a>æˆåŠŸåˆ°è¿™ä¸€æ­¥ï¼šé›†ç¾¤å®‰è£…</h4><p><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera19.png" alt=""><br><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera20.png" alt=""></p><h5 id="10-é€‰æ‹©é›†ç¾¤è®¾ç½®"><a href="#10-é€‰æ‹©é›†ç¾¤è®¾ç½®" class="headerlink" title="10.é€‰æ‹©é›†ç¾¤è®¾ç½®"></a>10.é€‰æ‹©é›†ç¾¤è®¾ç½®</h5><p><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera21.png" alt=""></p><h5 id="10-1-é›†ç¾¤è®¾ç½®ï¼šè‡ªå®šä¹‰è§’è‰²åˆ†é…"><a href="#10-1-é›†ç¾¤è®¾ç½®ï¼šè‡ªå®šä¹‰è§’è‰²åˆ†é…" class="headerlink" title="10.1 é›†ç¾¤è®¾ç½®ï¼šè‡ªå®šä¹‰è§’è‰²åˆ†é…"></a>10.1 é›†ç¾¤è®¾ç½®ï¼šè‡ªå®šä¹‰è§’è‰²åˆ†é…</h5><p><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera22.png" alt=""><br>è®¾ç½®å¥½è§’è‰²åˆ†é…æŸ¥çœ‹ä¸»æœºï¼š</p><p><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera23.png" alt=""></p><h5 id="11-æ•°æ®åº“è®¾ç½®"><a href="#11-æ•°æ®åº“è®¾ç½®" class="headerlink" title="11. æ•°æ®åº“è®¾ç½®"></a>11. æ•°æ®åº“è®¾ç½®</h5><p><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera24.png" alt=""></p><p>âœ¨âœ¨ <strong>è¿™é‡Œä½¿ç”¨é»˜è®¤è®¾ç½®ï¼Œå¡«å†™MySQLæœåŠ¡å™¨IPï¼Œç»™äºˆMySQL ç”¨æˆ·åå’Œå¯†ç allæƒé™ï¼Œä¸ç„¶ä¼šæç¤ºæƒé™ä¸è¶³ã€‚</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">Create the Oozie Database and Oozie MySQL User</div><div class="line">For example, using the MySQL mysql <span class="built_in">command</span>-line tool:</div><div class="line"></div><div class="line">$ mysql -u root -p</div><div class="line">Enter password:</div><div class="line"></div><div class="line">mysql&gt; create database oozie default character <span class="built_in">set</span> utf8;</div><div class="line">Query OK, 1 row affected (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt;  grant all privileges on oozie.* to <span class="string">'oozie'</span>@<span class="string">'localhost'</span> identified by <span class="string">'oozie'</span>;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt;  grant all privileges on oozie.* to <span class="string">'oozie'</span>@<span class="string">'%'</span> identified by <span class="string">'oozie'</span>;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; <span class="built_in">exit</span></div><div class="line">Bye</div></pre></td></tr></table></figure><p>é€‰æ‹©ç„¶åå•å‡»æµ‹è¯•è¿æ¥å³å¯ã€‚</p><p><strong>æµ‹è¯• Activity Monitor çš„æ•°æ®åº“è¿æ¥</strong><br><strong>JDBC driver cannot be found. Unable to find the JDBC database jar on host : wlj-cdm.</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">å¦‚æœå‡ºç°éœ€è¦MySQLé©±åŠ¨,ä¸‹è½½å¯¹åº”ç‰ˆæœ¬é©±åŠ¨ï¼Œcopyåˆ°ç›¸åº”ç›®å½•/usr/share/java/ ç»Ÿä¸€å»æ‰ç‰ˆæœ¬å·.</div><div class="line">å‚è€ƒInstalling the MySQL JDBC Driverå®˜ç½‘æ–‡æ¡£ï¼šhttps://www.cloudera.com/documentation/enterprise/latest/topics/cm_ig_mysql.html</div><div class="line"></div><div class="line"><span class="comment">#### Installing the MySQL JDBC Driver </span></div><div class="line"></div><div class="line"></div><div class="line">Download the MySQL JDBC driver from http://www.mysql.com/downloads/connector/j/5.1.html.</div><div class="line">Extract the JDBC driver JAR file from the downloaded file. For example:</div><div class="line"></div><div class="line"><span class="comment">### $ wget https://dev.mysql.com/get/Downloads/Connector-J/mysql-connector-java-5.1.44.tar.gz</span></div><div class="line"><span class="comment">### $ tar zxvf mysql-connector-java-5.1.31.tar.gz</span></div><div class="line">Copy the JDBC driver, renamed, to the relevant host. For example:</div><div class="line"><span class="comment">### $ sudo cp mysql-connector-java-5.1.31/mysql-connector-java-5.1.31-bin.jar /usr/share/java/mysql-connector-java.jar</span></div><div class="line">If the target directory does not yet exist on this host, you can create it before copying the JAR file. For example:</div><div class="line"></div><div class="line"><span class="comment">### $ sudo mkdir -p /usr/share/java/</span></div><div class="line"><span class="comment">### $ sudo cp mysql-connector-java-5.1.31/mysql-connector-java-5.1.31-bin.jar /usr/share/java/mysql-connector-java.jar</span></div></pre></td></tr></table></figure><h5 id="12-å®¡æ ¸æ›´æ”¹-è¿™é‡Œé€‰æ‹©é»˜è®¤è·¯å¾„"><a href="#12-å®¡æ ¸æ›´æ”¹-è¿™é‡Œé€‰æ‹©é»˜è®¤è·¯å¾„" class="headerlink" title="12. å®¡æ ¸æ›´æ”¹(è¿™é‡Œé€‰æ‹©é»˜è®¤è·¯å¾„)"></a>12. å®¡æ ¸æ›´æ”¹(è¿™é‡Œé€‰æ‹©é»˜è®¤è·¯å¾„)</h5><p>ç­‰å¾…å®‰è£…ï¼š<br><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera25.png" alt=""></p><h5 id="13-å®‰è£…æˆåŠŸ"><a href="#13-å®‰è£…æˆåŠŸ" class="headerlink" title="13. å®‰è£…æˆåŠŸ"></a>13. å®‰è£…æˆåŠŸ</h5><p><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera25.png" alt=""></p><p><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera26.png" alt=""></p><p><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera27.png" alt=""></p><p><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera28.png" alt=""></p><p><img src="http://7xrthw.com1.z0.glb.clouddn.com/bidata-cloudera29.png" alt=""></p><h3 id="äº¤æµå­¦ä¹ ï¼š"><a href="#äº¤æµå­¦ä¹ ï¼š" class="headerlink" title="äº¤æµå­¦ä¹ ï¼š"></a>äº¤æµå­¦ä¹ ï¼š</h3><p>ğŸ§  Linux shell_é«˜çº§è¿ç»´æ´¾: <code>459096184</code>    åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)<br>ğŸ§  BigData-Exchange School : <code>521621407</code>  åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥</p><p>ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/Bigdata-Cloudera-Manager.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;é—®é¢˜å¯¼è¯»ï¼š&quot;&gt;&lt;a href=&quot;#é—®é¢˜å¯¼è¯»ï¼š&quot; class=&quot;headerlink&quot; title=&quot;é—®é¢˜å¯¼è¯»ï¼š&quot;&gt;&lt;/a&gt;é—®é¢˜å¯¼è¯»ï¼š&lt;/h3&gt;&lt;p&gt;1.ä»€ä¹ˆæ˜¯cloudera CM ã€CDH?&lt;br&gt;2.CDHã€CMæœ‰å“ªäº›ç‰ˆæœ¬ï¼Ÿ&lt;br&gt;3.CDHã€CMæœ‰å“ªäº›å®‰è£…æ–¹å¼ï¼Ÿ&lt;br&gt;4.CDHå¦‚ä½•å¼€å‘ï¼Ÿ&lt;/p&gt;
    
    </summary>
    
      <category term="Bigdata Hadoop" scheme="http://blog.yancy.cc/categories/Bigdata-Hadoop/"/>
    
    
      <category term="Bigdata Hadoop" scheme="http://blog.yancy.cc/tags/Bigdata-Hadoop/"/>
    
      <category term="Countly" scheme="http://blog.yancy.cc/tags/Countly/"/>
    
  </entry>
  
  <entry>
    <title>KafkaåŠ¨æ€å¢åŠ Topicçš„å‰¯æœ¬(Replication)</title>
    <link href="http://blog.yancy.cc/2017/07/21/Bigdata-hadoop/Kafka/Kafka%E5%8A%A8%E6%80%81%E5%A2%9E%E5%8A%A0Topic%E7%9A%84%E5%89%AF%E6%9C%AC(Replication)/"/>
    <id>http://blog.yancy.cc/2017/07/21/Bigdata-hadoop/Kafka/KafkaåŠ¨æ€å¢åŠ Topicçš„å‰¯æœ¬(Replication)/</id>
    <published>2017-07-21T03:22:00.000Z</published>
    <updated>2018-04-11T06:29:09.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="KafkaåŠ¨æ€å¢åŠ Topicçš„å‰¯æœ¬-Replication"><a href="#KafkaåŠ¨æ€å¢åŠ Topicçš„å‰¯æœ¬-Replication" class="headerlink" title="KafkaåŠ¨æ€å¢åŠ Topicçš„å‰¯æœ¬(Replication)"></a>KafkaåŠ¨æ€å¢åŠ Topicçš„å‰¯æœ¬(Replication)</h2><p>å½“å‰æˆ‘çš„topic ï¼šcountly_event åªæœ‰1ä¸ªå‰¯æœ¬ï¼Œå¦‚æœé›†ç¾¤å…¶ä¸­ä¸€å°æœºå™¨å‡ºç°é—®é¢˜ï¼Œå°±ä¼šä¸¢å¤±æ•°æ®ã€‚æ‰€ä»¥è¿™é‡Œä»¥åæ–°å»ºæ–°çš„topic æœ€å°‘2ä¸ªå‰¯æœ¬ï¼Œå¦‚æœèµ„æºéå¸¸å……è¶³å¯ä»¥è€ƒè™‘å‰¯æœ¬3ä¸ªã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[jollybi@kafka1 kafka_2.10-0.9.0.1]$ ./bin/kafka-topics.sh --zookeeper 172.31.2.6:2182,172.31.2.7:2182,172.31.2.8:2182  -describe -topic countly_event</div><div class="line">Topic:countly_eventPartitionCount:12ReplicationFactor:1Configs:</div><div class="line">Topic: countly_eventPartition: 0Leader: 1Replicas: 1Isr: 1</div><div class="line">Topic: countly_eventPartition: 1Leader: 2Replicas: 2Isr: 2</div><div class="line">Topic: countly_eventPartition: 2Leader: 3Replicas: 3Isr: 3</div><div class="line">Topic: countly_eventPartition: 3Leader: 4Replicas: 4Isr: 4</div><div class="line">Topic: countly_eventPartition: 4Leader: 1Replicas: 1Isr: 1</div><div class="line">Topic: countly_eventPartition: 5Leader: 2Replicas: 2Isr: 2</div><div class="line">Topic: countly_eventPartition: 6Leader: 3Replicas: 3Isr: 3</div><div class="line">Topic: countly_eventPartition: 7Leader: 4Replicas: 4Isr: 4</div><div class="line">Topic: countly_eventPartition: 8Leader: 1Replicas: 1Isr: 1</div><div class="line">Topic: countly_eventPartition: 9Leader: 2Replicas: 2Isr: 2</div><div class="line">Topic: countly_eventPartition: 10Leader: 3Replicas: 3Isr: 3</div><div class="line">Topic: countly_eventPartition: 11Leader: 4Replicas: 4Isr: 4</div></pre></td></tr></table></figure><p>å¢åŠ ç°æœ‰åˆ†åŒºçš„å¤åˆ¶å› å­å¾ˆå®¹æ˜“ã€‚åªéœ€åœ¨è‡ªå®šä¹‰é‡æ–°åˆ†é…jsonæ–‡ä»¶ä¸­æŒ‡å®šé¢å¤–å‰¯æœ¬ï¼Œå¹¶å°†å…¶ä¸â€“executeé€‰é¡¹ä¸€èµ·ä½¿ç”¨å³å¯å¢åŠ æŒ‡å®šåˆ†åŒºçš„å¤åˆ¶å› å­ã€‚</p><p>ä¾‹å¦‚ï¼Œä»¥ä¸‹ç¤ºä¾‹å°†ä¸»é¢˜countly_eventçš„åˆ†åŒº0çš„å¤åˆ¶å› å­ä»1å¢åŠ åˆ°3.åœ¨å¢åŠ å¤åˆ¶å› å­ä¹‹å‰ï¼Œè¯¥åˆ†åŒºçš„å”¯ä¸€å‰¯æœ¬å­˜åœ¨äºä»£ç†1ä¸Šã€‚ä½œä¸ºå¢åŠ å¤åˆ¶å› å­çš„ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†æ·»åŠ æ›´å¤šå‰¯æœ¬ç»çºªäºº2å’Œ3å’Œ4ã€‚</p><p>ç¬¬ä¸€æ­¥æ˜¯åœ¨jsonæ–‡ä»¶ä¸­æ‰‹å·¥åˆ¶ä½œè‡ªå®šä¹‰é‡æ–°åˆ†é…è®¡åˆ’ - è¿™ä¸ªè‡ªå·±å®šä¹‰æ¯ä¸ªåˆ†åŒºè®¾ç½®å‰¯æœ¬ï¼Œä¾‹å¦‚ï¼š0åˆ†åŒºè®¾ç½®åœ¨3å’Œ2å’Œ4. </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&#123;<span class="string">"version"</span>:1,</div><div class="line"> <span class="string">"partitions"</span>:</div><div class="line"> [&#123;<span class="string">"topic"</span>:<span class="string">"countly_event"</span>,<span class="string">"partition"</span>:0,<span class="string">"replicas"</span>:[3,2,4]&#125;,</div><div class="line"> &#123;<span class="string">"topic"</span>:<span class="string">"countly_event"</span>,<span class="string">"partition"</span>:1,<span class="string">"replicas"</span>:[3,2,4]&#125;,</div><div class="line"> &#123;<span class="string">"topic"</span>:<span class="string">"countly_event"</span>,<span class="string">"partition"</span>:2,<span class="string">"replicas"</span>:[4,3,1]&#125;,</div><div class="line"> &#123;<span class="string">"topic"</span>:<span class="string">"countly_event"</span>,<span class="string">"partition"</span>:3,<span class="string">"replicas"</span>:[2,1,3]&#125;,</div><div class="line"> &#123;<span class="string">"topic"</span>:<span class="string">"countly_event"</span>,<span class="string">"partition"</span>:4,<span class="string">"replicas"</span>:[3,4,1]&#125;,</div><div class="line"> &#123;<span class="string">"topic"</span>:<span class="string">"countly_event"</span>,<span class="string">"partition"</span>:5,<span class="string">"replicas"</span>:[4,1,2]&#125;,</div><div class="line"> &#123;<span class="string">"topic"</span>:<span class="string">"countly_event"</span>,<span class="string">"partition"</span>:6,<span class="string">"replicas"</span>:[1,2,3]&#125;,</div><div class="line"> &#123;<span class="string">"topic"</span>:<span class="string">"countly_event"</span>,<span class="string">"partition"</span>:7,<span class="string">"replicas"</span>:[2,3,4]&#125;,</div><div class="line"> &#123;<span class="string">"topic"</span>:<span class="string">"countly_event"</span>,<span class="string">"partition"</span>:8,<span class="string">"replicas"</span>:[3,1,2]&#125;,</div><div class="line"> &#123;<span class="string">"topic"</span>:<span class="string">"countly_event"</span>,<span class="string">"partition"</span>:9,<span class="string">"replicas"</span>:[4,2,3]&#125;,</div><div class="line"> &#123;<span class="string">"topic"</span>:<span class="string">"countly_event"</span>,<span class="string">"partition"</span>:10,<span class="string">"replicas"</span>:[1,3,4]&#125;,</div><div class="line"> &#123;<span class="string">"topic"</span>:<span class="string">"countly_event"</span>,<span class="string">"partition"</span>:11,<span class="string">"replicas"</span>:[2,4,1]&#125;]</div><div class="line"> &#125;</div></pre></td></tr></table></figure><p>ç„¶åï¼Œä½¿ç”¨å¸¦æœ‰â€“executeé€‰é¡¹çš„jsonæ–‡ä»¶å¯åŠ¨é‡æ–°åˆ†é…è¿‡ç¨‹ </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"> ./bin/kafka-reassign-partitions.sh --zookeeper 10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281  --reassignment-json-file increase-replication-factor.json --execute</div><div class="line"></div><div class="line"></div><div class="line">[jollybi@kafka1 kafka_2.10-0.9.0.1]$ ./bin/kafka-reassign-partitions.sh --zookeeper 10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281  --reassignment-json-file increase-replication-factor.json --execute</div><div class="line">Current partition replica assignment</div><div class="line"></div><div class="line">&#123;<span class="string">"version"</span>:1,<span class="string">"partitions"</span>:[&#123;<span class="string">"topic"</span>:<span class="string">"countly_event"</span>,<span class="string">"partition"</span>:6,<span class="string">"replicas"</span>:[4]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"countly_event"</span>,<span class="string">"partition"</span>:4,<span class="string">"replicas"</span>:[2]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"countly_event"</span>,<span class="string">"partition"</span>:5,<span class="string">"replicas"</span>:[3]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"countly_event"</span>,<span class="string">"partition"</span>:7,<span class="string">"replicas"</span>:[1]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"countly_event"</span>,<span class="string">"partition"</span>:3,<span class="string">"replicas"</span>:[1]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"countly_event"</span>,<span class="string">"partition"</span>:9,<span class="string">"replicas"</span>:[3]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"countly_event"</span>,<span class="string">"partition"</span>:11,<span class="string">"replicas"</span>:[1]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"countly_event"</span>,<span class="string">"partition"</span>:0,<span class="string">"replicas"</span>:[2]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"countly_event"</span>,<span class="string">"partition"</span>:10,<span class="string">"replicas"</span>:[4]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"countly_event"</span>,<span class="string">"partition"</span>:2,<span class="string">"replicas"</span>:[4]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"countly_event"</span>,<span class="string">"partition"</span>:1,<span class="string">"replicas"</span>:[3]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"countly_event"</span>,<span class="string">"partition"</span>:8,<span class="string">"replicas"</span>:[2]&#125;]&#125;</div><div class="line"></div><div class="line">Save this to use as the --reassignment-json-file option during rollback</div><div class="line">Successfully started reassignment of partitions &#123;<span class="string">"version"</span>:1,<span class="string">"partitions"</span>:[&#123;<span class="string">"topic"</span>:<span class="string">"countly_event"</span>,<span class="string">"partition"</span>:0,<span class="string">"replicas"</span>:[1,2,3,4]&#125;]&#125;</div></pre></td></tr></table></figure><p>â€“verifyé€‰é¡¹å¯ä¸è¯¥å·¥å…·ä¸€èµ·ä½¿ç”¨ï¼Œä»¥æ£€æŸ¥åˆ†åŒºé‡æ–°åˆ†é…çš„çŠ¶æ€ã€‚è¯·æ³¨æ„ï¼Œä¸â€“verifyé€‰é¡¹ä¸€èµ·ä½¿ç”¨ç›¸åŒçš„increase-replication-factor.jsonï¼ˆä¸â€“executeé€‰é¡¹ä¸€èµ·ä½¿ç”¨ï¼‰</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="string">[jollybi@kafka1</span> <span class="string">kafka_2.10-0.9.0.1]$</span> <span class="string">./bin/kafka-reassign-partitions.sh</span> <span class="bullet">--zookeeper</span> <span class="number">10.155</span><span class="number">.90</span><span class="number">.153</span><span class="string">:2281,10.155.90.155:2281,10.155.90.138:2281</span>  <span class="bullet">--reassignment-json-file</span> <span class="string">increase-replication-factor.json</span> <span class="bullet">--verify</span></div><div class="line"><span class="string">Status</span> <span class="string">of</span> <span class="string">partition</span> <span class="attr">reassignment:</span></div><div class="line"><span class="string">Reassignment</span> <span class="string">of</span> <span class="string">partition</span> <span class="string">[countly_event,0]</span> <span class="string">is</span> <span class="string">still</span> <span class="string">in</span> <span class="string">progress</span></div><div class="line"><span class="string">Reassignment</span> <span class="string">of</span> <span class="string">partition</span> <span class="string">[countly_event,1]</span> <span class="string">is</span> <span class="string">still</span> <span class="string">in</span> <span class="string">progress</span></div><div class="line"><span class="string">Reassignment</span> <span class="string">of</span> <span class="string">partition</span> <span class="string">[countly_event,2]</span> <span class="string">is</span> <span class="string">still</span> <span class="string">in</span> <span class="string">progress</span></div><div class="line"><span class="string">Reassignment</span> <span class="string">of</span> <span class="string">partition</span> <span class="string">[countly_event,3]</span> <span class="string">is</span> <span class="string">still</span> <span class="string">in</span> <span class="string">progress</span></div><div class="line"><span class="string">Reassignment</span> <span class="string">of</span> <span class="string">partition</span> <span class="string">[countly_event,4]</span> <span class="string">is</span> <span class="string">still</span> <span class="string">in</span> <span class="string">progress</span></div><div class="line"><span class="string">Reassignment</span> <span class="string">of</span> <span class="string">partition</span> <span class="string">[countly_event,5]</span> <span class="string">is</span> <span class="string">still</span> <span class="string">in</span> <span class="string">progress</span></div><div class="line"><span class="string">Reassignment</span> <span class="string">of</span> <span class="string">partition</span> <span class="string">[countly_event,6]</span> <span class="string">is</span> <span class="string">still</span> <span class="string">in</span> <span class="string">progress</span></div><div class="line"><span class="string">Reassignment</span> <span class="string">of</span> <span class="string">partition</span> <span class="string">[countly_event,7]</span> <span class="string">is</span> <span class="string">still</span> <span class="string">in</span> <span class="string">progress</span></div><div class="line"><span class="string">Reassignment</span> <span class="string">of</span> <span class="string">partition</span> <span class="string">[countly_event,8]</span> <span class="string">is</span> <span class="string">still</span> <span class="string">in</span> <span class="string">progress</span></div><div class="line"><span class="string">Reassignment</span> <span class="string">of</span> <span class="string">partition</span> <span class="string">[countly_event,9]</span> <span class="string">is</span> <span class="string">still</span> <span class="string">in</span> <span class="string">progress</span></div><div class="line"><span class="string">Reassignment</span> <span class="string">of</span> <span class="string">partition</span> <span class="string">[countly_event,10]</span> <span class="string">is</span> <span class="string">still</span> <span class="string">in</span> <span class="string">progress</span></div><div class="line"><span class="string">Reassignment</span> <span class="string">of</span> <span class="string">partition</span> <span class="string">[countly_event,11]</span> <span class="string">is</span> <span class="string">still</span> <span class="string">in</span> <span class="string">progress</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="string">æ‚¨è¿˜å¯ä»¥ä½¿ç”¨kafka-topicså·¥å…·éªŒè¯å¤åˆ¶å› å­çš„å¢åŠ æƒ…å†µ</span> </div><div class="line"></div><div class="line"><span class="string">[root@kafka1</span> <span class="string">kafka_2.10-0.9.0.1]#</span> <span class="string">./bin/kafka-topics.sh</span> <span class="bullet">--zookeeper</span> <span class="number">10.155</span><span class="number">.90</span><span class="number">.153</span><span class="string">:2281,10.155.90.155:2281,10.155.90.138:2281</span> <span class="bullet">-describe</span> <span class="bullet">-topic</span> <span class="string">countly_event</span></div><div class="line"><span class="attr">Topic:</span><span class="string">countly_event</span><span class="attr">PartitionCount:12</span><span class="attr">ReplicationFactor:3</span><span class="attr">Configs:</span></div><div class="line"><span class="attr">Topic:</span> <span class="string">countly_event</span><span class="attr">Partition:</span> <span class="number">0</span><span class="attr">Leader:</span> <span class="number">2</span><span class="attr">Replicas:</span> <span class="number">3</span><span class="string">,2,4</span><span class="attr">Isr:</span> <span class="number">2</span><span class="string">,3,4</span></div><div class="line"><span class="attr">Topic:</span> <span class="string">countly_event</span><span class="attr">Partition:</span> <span class="number">1</span><span class="attr">Leader:</span> <span class="number">3</span><span class="attr">Replicas:</span> <span class="number">3</span><span class="string">,2,4</span><span class="attr">Isr:</span> <span class="number">3</span><span class="string">,2,4</span></div><div class="line"><span class="attr">Topic:</span> <span class="string">countly_event</span><span class="attr">Partition:</span> <span class="number">2</span><span class="attr">Leader:</span> <span class="number">4</span><span class="attr">Replicas:</span> <span class="number">4</span><span class="string">,3,1</span><span class="attr">Isr:</span> <span class="number">4</span><span class="string">,1,3</span></div><div class="line"><span class="attr">Topic:</span> <span class="string">countly_event</span><span class="attr">Partition:</span> <span class="number">3</span><span class="attr">Leader:</span> <span class="number">1</span><span class="attr">Replicas:</span> <span class="number">2</span><span class="string">,1,3</span><span class="attr">Isr:</span> <span class="number">1</span><span class="string">,2,3</span></div><div class="line"><span class="attr">Topic:</span> <span class="string">countly_event</span><span class="attr">Partition:</span> <span class="number">4</span><span class="attr">Leader:</span> <span class="number">3</span><span class="attr">Replicas:</span> <span class="number">3</span><span class="string">,4,1</span><span class="attr">Isr:</span> <span class="number">4</span><span class="string">,1,3</span></div><div class="line"><span class="attr">Topic:</span> <span class="string">countly_event</span><span class="attr">Partition:</span> <span class="number">5</span><span class="attr">Leader:</span> <span class="number">4</span><span class="attr">Replicas:</span> <span class="number">4</span><span class="string">,1,2</span><span class="attr">Isr:</span> <span class="number">1</span><span class="string">,4,2</span></div><div class="line"><span class="attr">Topic:</span> <span class="string">countly_event</span><span class="attr">Partition:</span> <span class="number">6</span><span class="attr">Leader:</span> <span class="number">1</span><span class="attr">Replicas:</span> <span class="number">1</span><span class="string">,2,3</span><span class="attr">Isr:</span> <span class="number">2</span><span class="string">,1,3</span></div><div class="line"><span class="attr">Topic:</span> <span class="string">countly_event</span><span class="attr">Partition:</span> <span class="number">7</span><span class="attr">Leader:</span> <span class="number">2</span><span class="attr">Replicas:</span> <span class="number">2</span><span class="string">,3,4</span><span class="attr">Isr:</span> <span class="number">4</span><span class="string">,2,3</span></div><div class="line"><span class="attr">Topic:</span> <span class="string">countly_event</span><span class="attr">Partition:</span> <span class="number">8</span><span class="attr">Leader:</span> <span class="number">2</span><span class="attr">Replicas:</span> <span class="number">3</span><span class="string">,1,2</span><span class="attr">Isr:</span> <span class="number">2</span><span class="string">,1,3</span></div><div class="line"><span class="attr">Topic:</span> <span class="string">countly_event</span><span class="attr">Partition:</span> <span class="number">9</span><span class="attr">Leader:</span> <span class="number">3</span><span class="attr">Replicas:</span> <span class="number">4</span><span class="string">,2,3</span><span class="attr">Isr:</span> <span class="number">3</span><span class="string">,2,4</span></div><div class="line"><span class="attr">Topic:</span> <span class="string">countly_event</span><span class="attr">Partition:</span> <span class="number">10</span><span class="attr">Leader:</span> <span class="number">4</span><span class="attr">Replicas:</span> <span class="number">1</span><span class="string">,3,4</span><span class="attr">Isr:</span> <span class="number">4</span><span class="string">,1,3</span></div><div class="line"><span class="attr">Topic:</span> <span class="string">countly_event</span><span class="attr">Partition:</span> <span class="number">11</span><span class="attr">Leader:</span> <span class="number">1</span><span class="attr">Replicas:</span> <span class="number">2</span><span class="string">,4,1</span><span class="attr">Isr:</span> <span class="number">1</span><span class="string">,4,2</span></div></pre></td></tr></table></figure><p>å‚è€ƒåœ°å€ï¼š<a href="http://kafka.apache.org/documentation/" target="_blank" rel="external">http://kafka.apache.org/documentation/</a></p><p>Communicative learning:<br>ğŸ§ Linux shell_ senior operation and maintenance faction: QQ group 459096184 circle (system operation and maintenance - application operation and maintenance - automation operation and maintenance - virtualization technology research, welcome to join)<br>ğŸ§ BigData-Exchange School:QQ group 521621407 circles (big data Yun Wei) (Hadoop developer) (big data research enthusiasts) welcome to join</p><p>Bidata have internal WeChat exchange group, learn from each other, join QQ group has links.</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;KafkaåŠ¨æ€å¢åŠ Topicçš„å‰¯æœ¬-Replication&quot;&gt;&lt;a href=&quot;#KafkaåŠ¨æ€å¢åŠ Topicçš„å‰¯æœ¬-Replication&quot; class=&quot;headerlink&quot; title=&quot;KafkaåŠ¨æ€å¢åŠ Topicçš„å‰¯æœ¬(Replication)&quot;&gt;&lt;/
      
    
    </summary>
    
      <category term="Bigdata Hadoop" scheme="http://blog.yancy.cc/categories/Bigdata-Hadoop/"/>
    
    
      <category term="Kafka" scheme="http://blog.yancy.cc/tags/Kafka/"/>
    
  </entry>
  
  <entry>
    <title>KafKaåŠ¨æ€æ‰©å®¹ç¾¤é›†-(Topic.partitionsè¿ç§»)</title>
    <link href="http://blog.yancy.cc/2017/07/11/Bigdata-hadoop/Kafka/KafKa%E6%89%A9%E5%AE%B9%E7%BE%A4%E9%9B%86(Topic.partitions%E8%BF%81%E7%A7%BB)/"/>
    <id>http://blog.yancy.cc/2017/07/11/Bigdata-hadoop/Kafka/KafKaæ‰©å®¹ç¾¤é›†(Topic.partitionsè¿ç§»)/</id>
    <published>2017-07-11T03:22:00.000Z</published>
    <updated>2018-04-17T07:08:36.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="kafkaçš„æ‰©å®¹éš¾ç‚¹ï¼š"><a href="#kafkaçš„æ‰©å®¹éš¾ç‚¹ï¼š" class="headerlink" title="kafkaçš„æ‰©å®¹éš¾ç‚¹ï¼š"></a>kafkaçš„æ‰©å®¹éš¾ç‚¹ï¼š</h4><p>1ï¼‰ä¸»è¦åœ¨äºå¢åŠ æœºå™¨ä¹‹åï¼Œæ•°æ®éœ€è¦rebalanceåˆ°æ–°å¢çš„ç©ºé—²èŠ‚ç‚¹ï¼Œå³æŠŠpartitionsè¿ç§»åˆ°ç©ºé—²æœºå™¨ä¸Šã€‚<br>kafkaæä¾›<code>bin/kafka-reassign-partitions.sh</code>å·¥å…·ï¼Œå®Œæˆparttitionçš„è¿ç§»ã€‚</p><p>2ï¼‰kafkaçš„é›†ç¾¤çš„æ•°æ®é‡åŠ å¤§ï¼Œæ•°æ®rebalanceçš„æ—¶é—´è¾ƒé•¿ã€‚è§£å†³åŠæ³•æ˜¯æŠŠ<code>log.retention.hours=1</code>è®¾ç½®ä¸€å°æ—¶ï¼ˆç”Ÿäº§å‚æ•°24å°æ—¶ï¼‰ã€‚<br>ä¿®æ”¹å‚æ•°ä¹‹åï¼Œé‡å¯kakfaèŠ‚ç‚¹ï¼Œkafkaä¼šä¸»åŠ¨purge 1å°æ—¶ä¹‹å‰çš„logæ•°æ®ã€‚<br>ä»¥ä¸‹æ˜¯kafka_0.8.1.1ç‰ˆæœ¬kafkkaé›†ç¾¤æ‰©å®¹æ“ä½œè®°å½•ï¼Œä»3å°ç‰©ç†æœºæ‰©å®¹åˆ°4å°ç‰©ç†ï¼Œpartitionæ•°é‡ç”±24ä¸ªå¢åŠ åˆ°28ä¸ªã€‚</p><a id="more"></a><p>å‚è€ƒï¼š<a href="http://kafka.apache.org/081/documentation.html#basic_ops_modify_topic" target="_blank" rel="external">http://kafka.apache.org/081/documentation.html#basic_ops_modify_topic</a></p><h4 id="kafkaçš„å¤åˆ¶å‰¯æœ¬ï¼š"><a href="#kafkaçš„å¤åˆ¶å‰¯æœ¬ï¼š" class="headerlink" title="kafkaçš„å¤åˆ¶å‰¯æœ¬ï¼š"></a>kafkaçš„å¤åˆ¶å‰¯æœ¬ï¼š</h4><p>å°†æœåŠ¡å™¨æ·»åŠ åˆ°Kafkaé›†ç¾¤éå¸¸ç®€å•ï¼Œåªéœ€ä¸ºå…¶åˆ†é…å”¯ä¸€çš„ä»£ç†IDï¼Œç„¶ååœ¨æ–°æœåŠ¡å™¨ä¸Šå¯åŠ¨Kafkaã€‚ä½†æ˜¯ï¼Œè¿™äº›æ–°çš„æœåŠ¡å™¨ä¸ä¼šè‡ªåŠ¨åˆ†é…ä»»ä½•æ•°æ®åˆ†åŒºï¼Œé™¤éå°†åˆ†åŒºç§»åŠ¨åˆ°è¿™äº›åˆ†åŒºï¼Œå¦åˆ™ç›´åˆ°åˆ›å»ºæ–°ä¸»é¢˜æ—¶æ‰ä¼šæ‰§è¡Œä»»ä½•å·¥ä½œã€‚æ‰€ä»¥é€šå¸¸å½“ä½ å°†æœºå™¨æ·»åŠ åˆ°ä½ çš„ç¾¤é›†ä¸­æ—¶ï¼Œä½ ä¼šæƒ³æŠŠä¸€äº›ç°æœ‰çš„æ•°æ®è¿ç§»åˆ°è¿™äº›æœºå™¨ä¸Šã€‚<br>æ•°æ®è¿ç§»è¿‡ç¨‹æ˜¯æ‰‹åŠ¨å¯åŠ¨çš„ï¼Œä½†æ˜¯å®Œå…¨è‡ªåŠ¨åŒ–ã€‚ä¸‹é¢ä»‹ç»çš„æ˜¯ï¼ŒKafkaä¼šå°†æ–°æœåŠ¡å™¨æ·»åŠ ä¸ºæ­£åœ¨è¿ç§»çš„åˆ†åŒºçš„è·Ÿéšè€…ï¼Œå¹¶å…è®¸å…¶å®Œå…¨å¤åˆ¶è¯¥åˆ†åŒºä¸­çš„ç°æœ‰æ•°æ®ã€‚å½“æ–°æœåŠ¡å™¨å®Œå…¨å¤åˆ¶äº†æ­¤åˆ†åŒºçš„å†…å®¹å¹¶åŠ å…¥äº†åŒæ­¥å‰¯æœ¬æ—¶ï¼Œå…¶ä¸­ä¸€ä¸ªç°æœ‰å‰¯æœ¬å°†åˆ é™¤å…¶åˆ†åŒºçš„æ•°æ®ã€‚</p><p>åˆ†åŒºé‡æ–°åˆ†é…å·¥å…·å¯ç”¨äºè·¨ä»£ç†ç§»åŠ¨åˆ†åŒºã€‚ç†æƒ³çš„åˆ†åŒºåˆ†å¸ƒå°†ç¡®ä¿æ‰€æœ‰ä»£ç†çš„æ•°æ®åŠ è½½å’Œåˆ†åŒºå¤§å°ã€‚åˆ†åŒºé‡æ–°åˆ†é…å·¥å…·ä¸å…·å¤‡è‡ªåŠ¨ç ”ç©¶Kafkaé›†ç¾¤ä¸­çš„æ•°æ®åˆ†å¸ƒå¹¶ç§»åŠ¨åˆ†åŒºä»¥å®ç°å‡åŒ€è´Ÿè½½åˆ†é…çš„åŠŸèƒ½ã€‚å› æ­¤ï¼Œç®¡ç†å‘˜å¿…é¡»æ‰¾å‡ºå“ªäº›ä¸»é¢˜æˆ–åˆ†åŒºåº”è¯¥ç§»åŠ¨ã€‚</p><p>åˆ†åŒºé‡æ–°åˆ†é…å·¥å…·å¯ä»¥è¿è¡Œåœ¨3ä¸ªäº’æ–¥çš„æ¨¡å¼ä¸­ï¼š</p><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="literal">-</span><span class="literal">-</span><span class="comment">ç”Ÿæˆï¼šåœ¨æ­¤æ¨¡å¼ä¸‹ï¼Œç»™å®šä¸»é¢˜åˆ—è¡¨å’Œç»çºªäººåˆ—è¡¨ï¼Œè¯¥å·¥å…·ä¼šç”Ÿæˆå€™é€‰é‡æ–°â€‹â€‹åˆ†é…ï¼Œä»¥å°†æŒ‡å®šä¸»é¢˜çš„æ‰€æœ‰åˆ†åŒºç§»è‡³æ–°ç»çºªäººã€‚æ­¤é€‰é¡¹ä»…æä¾›äº†ä¸€ç§ä¾¿æ·çš„æ–¹å¼ï¼Œå¯ä»¥æ ¹æ®ä¸»é¢˜å’Œç›®æ ‡ä»£ç†åˆ—è¡¨ç”Ÿæˆåˆ†åŒºé‡æ–°åˆ†é…è®¡åˆ’ã€‚</span></div><div class="line"></div><div class="line"><span class="literal">-</span><span class="literal">-</span><span class="comment">executeï¼šåœ¨æ­¤æ¨¡å¼ä¸‹ï¼Œè¯¥å·¥å…·æ ¹æ®ç”¨æˆ·æä¾›çš„é‡æ–°åˆ†é…è®¡åˆ’å¯åŠ¨åˆ†åŒºé‡æ–°åˆ†é…ã€‚ï¼ˆä½¿ç”¨</span><span class="literal">-</span><span class="literal">-</span><span class="comment">reassignment</span><span class="literal">-</span><span class="comment">json</span><span class="literal">-</span><span class="comment">fileé€‰é¡¹ï¼‰ã€‚è¿™å¯ä»¥æ˜¯ç”±ç®¡ç†å‘˜åˆ¶ä½œçš„è‡ªå®šä¹‰é‡æ–°åˆ†é…è®¡åˆ’ï¼Œä¹Ÿå¯ä»¥æ˜¯ä½¿ç”¨</span><span class="literal">-</span><span class="literal">-</span><span class="comment">generateé€‰é¡¹æä¾›çš„è‡ªå®šä¹‰é‡æ–°åˆ†é…è®¡åˆ’ã€‚</span></div><div class="line"></div><div class="line"><span class="literal">-</span><span class="literal">-</span><span class="comment">verifyï¼šåœ¨æ­¤æ¨¡å¼ä¸‹ï¼Œè¯¥å·¥å…·ä¼šéªŒè¯ä¸Šæ¬¡æ‰§è¡Œè¿‡ç¨‹ä¸­åˆ—å‡ºçš„æ‰€æœ‰åˆ†åŒºçš„é‡æ–°åˆ†é…çŠ¶æ€ã€‚çŠ¶æ€å¯ä»¥æ˜¯æˆåŠŸå®Œæˆï¼Œå¤±è´¥æˆ–æ­£åœ¨è¿›è¡Œ</span></div></pre></td></tr></table></figure><p>è‡ªåŠ¨å°†æ•°æ®è¿ç§»åˆ°æ–°æœºå™¨</p><p>åˆ†åŒºé‡æ–°åˆ†é…å·¥å…·å¯ç”¨äºå°†å½“å‰ä¸€ç»„ç»çºªäººçš„ä¸€äº›ä¸»é¢˜ç§»åˆ°æ–°å¢çš„ç»çºªäººã€‚è¿™åœ¨æ‰©å±•ç°æœ‰é›†ç¾¤æ—¶é€šå¸¸å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºå°†æ•´ä¸ªä¸»é¢˜ç§»åŠ¨åˆ°æ–°çš„ä»£ç†é›†æ¯”ç§»åŠ¨ä¸€ä¸ªåˆ†åŒºæ›´å®¹æ˜“ã€‚ç”¨äºè¿™æ ·åšæ—¶ï¼Œç”¨æˆ·åº”è¯¥æä¾›åº”è¯¥ç§»åŠ¨åˆ°æ–°çš„ç»çºªäººé›†åˆå’Œæ–°çš„ç»çºªäººçš„ç›®æ ‡åˆ—è¡¨çš„ä¸»é¢˜åˆ—è¡¨ã€‚ç„¶åï¼Œè¯¥å·¥å…·åœ¨æ–°çš„ä»£ç†é›†åˆä¸Šå‡åŒ€åˆ†é…ç»™å®šä¸»é¢˜åˆ—è¡¨çš„æ‰€æœ‰åˆ†åŒºã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œä¸»é¢˜çš„å¤åˆ¶å› å­ä¿æŒä¸å˜ã€‚æœ‰æ•ˆåœ°ï¼Œä¸»é¢˜è¾“å…¥åˆ—è¡¨çš„æ‰€æœ‰åˆ†åŒºå‰¯æœ¬éƒ½ä»æ—§çš„ä»£ç†é›†åˆç§»åŠ¨åˆ°æ–°æ·»åŠ çš„ä»£ç†ã€‚<br>ä¾‹å¦‚ï¼Œä»¥ä¸‹ç¤ºä¾‹å°†æŠŠä¸»é¢˜<code>countly_apppushï¼Œcountly_event...</code>çš„æ‰€æœ‰åˆ†åŒºç§»åŠ¨åˆ°æ–°çš„ä»£ç†é›†4 ã€‚åœ¨æœ¬æ¬¡ç§»åŠ¨ç»“æŸæ—¶ï¼Œä¸»é¢˜<code>countly_apppushï¼Œcountly_event...</code>çš„æ‰€æœ‰åˆ†åŒºå°†ä»…å­˜åœ¨äºä»£ç†4ä¸Šã€‚</p><h3 id="1-kafka-æ‰©å®¹"><a href="#1-kafka-æ‰©å®¹" class="headerlink" title="1.kafka æ‰©å®¹"></a>1.kafka æ‰©å®¹</h3><p>é¦–å…ˆæŒ‰ç…§æ­å»ºæ­¥éª¤ï¼Œåœ¨å…¶ä»–æœºå™¨ä¸Šæ­å»ºé›†ç¾¤ï¼Œkafkaçš„é…ç½®æ–‡ä»¶ä¸­ zkconnect è¦ä¿æŒä¸åŸkafkaä¸€è‡´<br>kafkaç‰ˆæœ¬ä¸€è‡´ï¼Œé…ç½®è·Ÿä¹‹å‰kafkaé›†ç¾¤ä¸€è‡´ï¼Œåªéœ€è¦ä¿®æ”¹æœ¬åœ°kafkaçš„åœ°å€.</p><h3 id="2-éªŒè¯kafkaæ–°èŠ‚ç‚¹æ˜¯å¦åŠ å…¥é›†ç¾¤æˆåŠŸï¼Œè¿™ä¸ªåº”è¯¥å»zookeeperçš„zkCli-sh-å»æŸ¥çœ‹"><a href="#2-éªŒè¯kafkaæ–°èŠ‚ç‚¹æ˜¯å¦åŠ å…¥é›†ç¾¤æˆåŠŸï¼Œè¿™ä¸ªåº”è¯¥å»zookeeperçš„zkCli-sh-å»æŸ¥çœ‹" class="headerlink" title="2.éªŒè¯kafkaæ–°èŠ‚ç‚¹æ˜¯å¦åŠ å…¥é›†ç¾¤æˆåŠŸï¼Œè¿™ä¸ªåº”è¯¥å»zookeeperçš„zkCli.sh å»æŸ¥çœ‹"></a>2.éªŒè¯kafkaæ–°èŠ‚ç‚¹æ˜¯å¦åŠ å…¥é›†ç¾¤æˆåŠŸï¼Œè¿™ä¸ªåº”è¯¥å»zookeeperçš„zkCli.sh å»æŸ¥çœ‹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@kafka1 bin]<span class="comment"># ./zkCli.sh -server  10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281</span></div><div class="line">[zk: 10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281(CONNECTED) 0] ls /brokers/ids/</div><div class="line">1,2,3,4</div></pre></td></tr></table></figure><h5 id="3-ç”±äºè¯¥å·¥å…·æ¥å—ä¸»é¢˜çš„è¾“å…¥åˆ—è¡¨ä½œä¸ºjsonæ–‡ä»¶ï¼Œå› æ­¤é¦–å…ˆéœ€è¦ç¡®å®šè¦ç§»åŠ¨çš„ä¸»é¢˜å¹¶åˆ›å»ºjsonæ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š"><a href="#3-ç”±äºè¯¥å·¥å…·æ¥å—ä¸»é¢˜çš„è¾“å…¥åˆ—è¡¨ä½œä¸ºjsonæ–‡ä»¶ï¼Œå› æ­¤é¦–å…ˆéœ€è¦ç¡®å®šè¦ç§»åŠ¨çš„ä¸»é¢˜å¹¶åˆ›å»ºjsonæ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š" class="headerlink" title="3.ç”±äºè¯¥å·¥å…·æ¥å—ä¸»é¢˜çš„è¾“å…¥åˆ—è¡¨ä½œä¸ºjsonæ–‡ä»¶ï¼Œå› æ­¤é¦–å…ˆéœ€è¦ç¡®å®šè¦ç§»åŠ¨çš„ä¸»é¢˜å¹¶åˆ›å»ºjsonæ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š"></a>3.ç”±äºè¯¥å·¥å…·æ¥å—ä¸»é¢˜çš„è¾“å…¥åˆ—è¡¨ä½œä¸ºjsonæ–‡ä»¶ï¼Œå› æ­¤é¦–å…ˆéœ€è¦ç¡®å®šè¦ç§»åŠ¨çš„ä¸»é¢˜å¹¶åˆ›å»ºjsonæ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&#123;<span class="string">"topics"</span>: [&#123;<span class="string">"topic"</span>: <span class="string">"countly_apppush"</span>&#125;,</div><div class="line">            &#123;<span class="string">"topic"</span>: <span class="string">"countly_event"</span>&#125;,</div><div class="line">            &#123;<span class="string">"topic"</span>: <span class="string">"countly_imp"</span>&#125;,</div><div class="line">            &#123;<span class="string">"topic"</span>: <span class="string">"countly_metrics"</span>&#125;,</div><div class="line">            &#123;<span class="string">"topic"</span>: <span class="string">"countly_pv"</span>&#125;,</div><div class="line">            &#123;<span class="string">"topic"</span>: <span class="string">"countly_session"</span>&#125;,</div><div class="line">            &#123;<span class="string">"topic"</span>: <span class="string">"mongotail_lz4"</span>&#125;,</div><div class="line">            &#123;<span class="string">"topic"</span>: <span class="string">"mongotail_lz4_imp"</span>&#125;</div><div class="line">            ],</div><div class="line"> <span class="string">"version"</span>:1</div><div class="line">&#125;</div></pre></td></tr></table></figure><h5 id="4-ä¸€æ—¦jsonæ–‡ä»¶å‡†å¤‡å°±ç»ªï¼Œä½¿ç”¨åˆ†åŒºé‡æ–°åˆ†é…å·¥å…·æ¥ç”Ÿæˆå€™é€‰åˆ†é…ï¼š"><a href="#4-ä¸€æ—¦jsonæ–‡ä»¶å‡†å¤‡å°±ç»ªï¼Œä½¿ç”¨åˆ†åŒºé‡æ–°åˆ†é…å·¥å…·æ¥ç”Ÿæˆå€™é€‰åˆ†é…ï¼š" class="headerlink" title="4.ä¸€æ—¦jsonæ–‡ä»¶å‡†å¤‡å°±ç»ªï¼Œä½¿ç”¨åˆ†åŒºé‡æ–°åˆ†é…å·¥å…·æ¥ç”Ÿæˆå€™é€‰åˆ†é…ï¼š"></a>4.ä¸€æ—¦jsonæ–‡ä»¶å‡†å¤‡å°±ç»ªï¼Œä½¿ç”¨åˆ†åŒºé‡æ–°åˆ†é…å·¥å…·æ¥ç”Ÿæˆå€™é€‰åˆ†é…ï¼š</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">bin/kafka-reassign-partitions.sh --zookeeper 10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281 --topics-to-move-json-file topics-to-move.json --broker-list <span class="string">"1,2,3,4"</span> --generate</div><div class="line"></div><div class="line"></div><div class="line">[jollybi@kafka3 kafka_2.10-0.9.0.1]$ bin/kafka-reassign-partitions.sh --zookeeper 10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281 --topics-to-move-json-file topics-to-move.json --broker-list <span class="string">"1,2,3,4"</span> --generate</div><div class="line">Current partition replica assignment</div><div class="line"></div><div class="line">&#123;<span class="string">"version"</span>:1,<span class="string">"partitions"</span>:[&#123;<span class="string">"topic"</span>:<span class="string">"countly_metrics"</span>,<span class="string">"partition"</span>:7,<span class="string">"replicas"</span>:[1,3,2]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"countly_event"</span>,<span class="string">"partition"</span>:6,<span class="string">"replicas"</span>:[1]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"countly_pv"</span>,<span class="string">"partition"</span>:8,<span class="string">"replicas"</span>:[3,2,1]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"countly_pv"</span>,<span class="string">"partition"</span>:0,<span class="string">"replicas"</span>:[1,3,2]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"countly_imp"</span>,<span class="string">"partition"</span>:5,<span class="string">"replicas"</span>:[1,3,2]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"countly_imp"</span>,<span class="string">"partition"</span>:8,<span class="string">"replicas"</span>:[1,2,3]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"countly_apppush"</span>,<span class="string">"partition"</span>:0,<span class="string">"replicas"</span>:[2,3,1]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"countly_session"</span>,<span class="string">"partition"</span>:8,<span class="string">"replicas"</span>:[1,3,2]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"countly_imp"</span>,<span class="string">"partition"</span>:9,<span class="string">"replicas"</span>:[2,1,3]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"countly_metrics"</span>,<span class="string">"partition"</span>:2,<span class="string">"replicas"</span>:[2,1,3]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"countly_session"</span>,<span class="string">"partition"</span>:4,<span class="string">"replicas"</span>:[3,1,2]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"countly_pv"</span>,<span class="string">"partition"</span>:4,<span class="string">"replicas"</span>:[2,3,1]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"countly_apppush"</span>,<span class="string">"partition"</span>:6,<span class="string">"replicas"</span>:[2,3,1]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"countly_imp"</span>,<span class="string">"partition"</span>:11,<span class="string">"replicas"</span>:[1,3,2]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"countly_pv"</span>,<span class="string">"partition"</span>:3,<span class="string">"replicas"</span>:[1,2,3]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"countly_metrics"</span>,<span class="string">"partition"</span>:4,<span class="string">"replicas"</span>:[1,2,3]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"countly_metrics"</span>,<span class="string">"partition"</span>:8,<span class="string">"replicas"</span>:[2,1,3]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"countly_imp"</span>,<span class="string">"partition"</span>:10,<span class="string">"replicas"</span>:[3,2,1]&#125;,</div><div class="line">.....</div><div class="line"></div><div class="line">Proposed partition reassignment configuration</div><div class="line"></div><div class="line">&#123;<span class="string">"version"</span>:1,<span class="string">"partitions"</span>:[&#123;<span class="string">"topic"</span>:<span class="string">"countly_event"</span>,<span class="string">"partition"</span>:6,<span class="string">"replicas"</span>:[3]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"countly_metrics"</span>,<span class="string">"partition"</span>:7,<span class="string">"replicas"</span>:[4,2,3]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"countly_pv"</span>,<span class="string">"partition"</span>:8,<span class="string">"replicas"</span>:[2,1,3]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"countly_pv"</span>,<span class="string">"partition"</span>:0,<span class="string">"replicas"</span>:[2,3,4]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"countly_imp"</span>,<span class="string">"partition"</span>:5,<span class="string">"replicas"</span>:[3,4,1]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"countly_imp"</span>,<span class="string">"partition"</span>:8,<span class="string">"replicas"</span>:[2,4,1]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"countly_apppush"</span>,<span class="string">"partition"</span>:0,<span class="string">"replicas"</span>:[1,2,3]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"countly_imp"</span>,<span class="string">"partition"</span>:9,<span class="string">"replicas"</span>:[3,1,2]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"countly_session"</span>,<span class="string">"partition"</span>:8,<span class="string">"replicas"</span>:[1,2,3]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"countly_metrics"</span>,<span class="string">"partition"</span>:2,<span class="string">"replicas"</span>:[3,4,1]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"countly_session"</span>,<span class="string">"partition"</span>:4,<span class="string">"replicas"</span>:[1,4,2]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"countly_pv"</span>,<span class="string">"partition"</span>:4,<span class="string">"replicas"</span>:[2,4,1]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"countly_apppush"</span>,<span class="string">"partition"</span>:6,<span class="string">"replicas"</span>:[3,1,2]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"countly_imp"</span>,<span class="string">"partition"</span>:11,<span class="string">"replicas"</span>:[1,3,4]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"countly_pv"</span>,<span class="string">"partition"</span>:3,<span class="string">"replicas"</span>:[1,2,3]&#125;</div><div class="line">......</div></pre></td></tr></table></figure><p>å…¶ä¸­çš„<code>Current partition replica assignment</code>æŒ‡çš„æ˜¯è¿ç§»å‰çš„partition replicaï¼›Proposed partition reassignment configuration æŒ‡çš„å°±æ˜¯è¿ç§»åˆ†é…è§„åˆ™jsonã€‚éœ€è¦å°†è¯¥<code>[Proposed partition reassignment configuration]</code>jsonæ–‡ä»¶ä¿å­˜åˆ°jsonæ–‡ä»¶ä¸­(å¦‚expand-cluster-reassignment.json)</p><p>è¯¥å·¥å…·ä¼šç”Ÿæˆä¸€ä¸ªå€™é€‰åˆ†é…ï¼Œå°†æ‰€æœ‰åˆ†åŒºä»ä¸»é¢˜<code>countly_apppushï¼Œcountly_event...</code>ç§»åŠ¨åˆ°<code>brokers 1,2,3,4</code>ä½†æ˜¯ï¼Œè¯·æ³¨æ„ï¼Œåœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œåˆ†åŒºè¿åŠ¨è¿˜æ²¡æœ‰å¼€å§‹ï¼Œå®ƒåªæ˜¯å‘Šè¯‰ä½ å½“å‰çš„ä»»åŠ¡å’Œå»ºè®®çš„æ–°ä»»åŠ¡ã€‚åº”è¯¥ä¿å­˜å½“å‰çš„åˆ†é…ï¼Œä»¥é˜²ä½ æƒ³è¦å›æ»šåˆ°å®ƒã€‚æ–°çš„ä»»åŠ¡åº”è¯¥ä¿å­˜åœ¨ä¸€ä¸ªjsonæ–‡ä»¶ä¸­<code>ï¼ˆä¾‹å¦‚expand-cluster-reassignment.jsonï¼‰</code>ï¼Œå¹¶ç”¨<code>--execute</code>é€‰é¡¹è¾“å…¥åˆ°å·¥å…·ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">./bin/kafka-reassign-partitions.sh --zookeeper 10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281  --reassignment-json-file expand-cluster-reassignment.json --execute</div><div class="line">Current partition replica assignment</div><div class="line"></div><div class="line">&#123;<span class="string">"version"</span>:1,<span class="string">"partitions"</span>:[&#123;<span class="string">"topic"</span>:<span class="string">"mongotail_lz4_imp"</span>,<span class="string">"partition"</span>:9,<span class="string">"replicas"</span>:[2,3,1]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"mongotail_lz4_imp"</span>,<span class="string">"partition"</span>:7,<span class="string">"replicas"</span>:[3,2,1]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"mongotail_lz4_imp"</span>,<span class="string">"partition"</span>:6,<span class="string">"replicas"</span>:[2,1,3]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"mongotail_lz4_imp"</span>,<span class="string">"partition"</span>:5,<span class="string">"replicas"</span>:[1,2,3]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"mongotail_lz4_imp"</span>,<span class="string">"partition"</span>:8,<span class="string">"replicas"</span>:[1,3,2]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"mongotail_lz4_imp"</span>,<span class="string">"partition"</span>:2,<span class="string">"replicas"</span>:[1,3,2]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"mongotail_lz4_imp"</span>,<span class="string">"partition"</span>:1,<span class="string">"replicas"</span>:[3,2,1]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"mongotail_lz4_imp"</span>,<span class="string">"partition"</span>:4,<span class="string">"replicas"</span>:[3,1,2]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"mongotail_lz4_imp"</span>,<span class="string">"partition"</span>:0,<span class="string">"replicas"</span>:[2,1,3]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"mongotail_lz4_imp"</span>,<span class="string">"partition"</span>:10,<span class="string">"replicas"</span>:[3,1,2]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"mongotail_lz4_imp"</span>,<span class="string">"partition"</span>:3,<span class="string">"replicas"</span>:[2,3,1]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"mongotail_lz4_imp"</span>,<span class="string">"partition"</span>:11,<span class="string">"replicas"</span>:[1,2,3]&#125;]&#125;</div><div class="line"></div><div class="line">Save this to use as the --reassignment-json-file option during rollback</div><div class="line">Successfully started reassignment of partitions &#123;<span class="string">"version"</span>:1,<span class="string">"partitions"</span>:[&#123;<span class="string">"topic"</span>:<span class="string">"mongotail_lz4_imp"</span>,<span class="string">"partition"</span>:3,<span class="string">"replicas"</span>:[3,4,1]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"mongotail_lz4_imp"</span>,<span class="string">"partition"</span>:8,<span class="string">"replicas"</span>:[4,3,1]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"mongotail_lz4_imp"</span>,<span class="string">"partition"</span>:0,<span class="string">"replicas"</span>:[4,1,2]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"mongotail_lz4_imp"</span>,<span class="string">"partition"</span>:6,<span class="string">"replicas"</span>:[2,4,1]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"mongotail_lz4_imp"</span>,<span class="string">"partition"</span>:11,<span class="string">"replicas"</span>:[3,2,4]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"mongotail_lz4_imp"</span>,<span class="string">"partition"</span>:1,<span class="string">"replicas"</span>:[1,2,3]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"mongotail_lz4_imp"</span>,<span class="string">"partition"</span>:10,<span class="string">"replicas"</span>:[2,1,3]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"mongotail_lz4_imp"</span>,<span class="string">"partition"</span>:4,<span class="string">"replicas"</span>:[4,2,3]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"mongotail_lz4_imp"</span>,<span class="string">"partition"</span>:9,<span class="string">"replicas"</span>:[1,4,2]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"mongotail_lz4_imp"</span>,<span class="string">"partition"</span>:2,<span class="string">"replicas"</span>:[2,3,4]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"mongotail_lz4_imp"</span>,<span class="string">"partition"</span>:5,<span class="string">"replicas"</span>:[1,3,4]&#125;,&#123;<span class="string">"topic"</span>:<span class="string">"mongotail_lz4_imp"</span>,<span class="string">"partition"</span>:7,<span class="string">"replicas"</span>:[3,1,2]&#125;]&#125;</div><div class="line">``` </div><div class="line"></div><div class="line"></div><div class="line">æœ€åï¼Œå¯ä»¥ä½¿ç”¨`--verify`é€‰é¡¹æ¥æ£€æŸ¥åˆ†åŒºé‡æ–°åˆ†é…çš„çŠ¶æ€ã€‚</div><div class="line">è¯·æ³¨æ„ï¼Œç›¸åŒçš„`expand-cluster-reassignment.json`ï¼ˆä¸`--execute`é€‰é¡¹ä¸€èµ·ä½¿ç”¨ï¼‰åº”è¯¥ä¸--verifyé€‰é¡¹ä¸€èµ·ä½¿ç”¨</div><div class="line"></div><div class="line">```BASH</div><div class="line">/bin/kafka-reassign-partitions.sh --zookeeper 10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281  --reassignment-json-file expand-cluster-reassignment.json  --verify</div><div class="line"></div><div class="line">[jollybi@kafka4 kafka_2.10-0.9.0.1]$ ./bin/kafka-reassign-partitions.sh --zookeeper 10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281  --reassignment-json-file expand-cluster-reassignment.json  --verify</div><div class="line">Status of partition reassignment:</div><div class="line">Reassignment of partition [countly_event,2] completed successfully</div><div class="line">Reassignment of partition [countly_session,7] completed successfully</div><div class="line">Reassignment of partition [countly_pv,5] completed successfully</div><div class="line">Reassignment of partition [countly_apppush,1] completed successfully</div><div class="line">Reassignment of partition [countly_event,0] completed successfully</div><div class="line">Reassignment of partition [countly_session,10] completed successfully</div><div class="line">Reassignment of partition [countly_apppush,4] completed successfully</div><div class="line">Reassignment of partition [countly_event,7] is still <span class="keyword">in</span> progress</div><div class="line">Reassignment of partition [countly_metrics,7] completed successfully</div><div class="line">Reassignment of partition [countly_imp,4] is still <span class="keyword">in</span> progress</div><div class="line">Reassignment of partition [countly_apppush,10] completed successfully</div><div class="line">Reassignment of partition [countly_imp,5] is still <span class="keyword">in</span> progress</div><div class="line">.....</div></pre></td></tr></table></figure><p>æ³¨æ„ï¼šåœ¨è¿ç§»è¿‡ç¨‹ä¸­ä¸èƒ½äººä¸ºçš„ç»“æŸæˆ–åœæ­¢kafkaæœåŠ¡ï¼Œä¸ç„¶ä¼šæœ‰æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜.</p><h3 id="Communicative-learning"><a href="#Communicative-learning" class="headerlink" title="Communicative learning:"></a>Communicative learning:</h3><p>ğŸ§  Linux shell_ senior operation and maintenance faction: QQ group <code>459096184</code> circle (system operation and maintenance - application operation and maintenance - automation operation and maintenance - virtualization technology research, welcome to join)<br>ğŸ§  BigData-Exchange School:QQ group <code>521621407</code> circles (big data Yun Wei) (Hadoop developer) (big data research enthusiasts) welcome to join</p><p>Bidata have internal WeChat exchange group, learn from each other, join QQ group has links.</p>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;kafkaçš„æ‰©å®¹éš¾ç‚¹ï¼š&quot;&gt;&lt;a href=&quot;#kafkaçš„æ‰©å®¹éš¾ç‚¹ï¼š&quot; class=&quot;headerlink&quot; title=&quot;kafkaçš„æ‰©å®¹éš¾ç‚¹ï¼š&quot;&gt;&lt;/a&gt;kafkaçš„æ‰©å®¹éš¾ç‚¹ï¼š&lt;/h4&gt;&lt;p&gt;1ï¼‰ä¸»è¦åœ¨äºå¢åŠ æœºå™¨ä¹‹åï¼Œæ•°æ®éœ€è¦rebalanceåˆ°æ–°å¢çš„ç©ºé—²èŠ‚ç‚¹ï¼Œå³æŠŠpartitionsè¿ç§»åˆ°ç©ºé—²æœºå™¨ä¸Šã€‚&lt;br&gt;kafkaæä¾›&lt;code&gt;bin/kafka-reassign-partitions.sh&lt;/code&gt;å·¥å…·ï¼Œå®Œæˆparttitionçš„è¿ç§»ã€‚&lt;/p&gt;
&lt;p&gt;2ï¼‰kafkaçš„é›†ç¾¤çš„æ•°æ®é‡åŠ å¤§ï¼Œæ•°æ®rebalanceçš„æ—¶é—´è¾ƒé•¿ã€‚è§£å†³åŠæ³•æ˜¯æŠŠ&lt;code&gt;log.retention.hours=1&lt;/code&gt;è®¾ç½®ä¸€å°æ—¶ï¼ˆç”Ÿäº§å‚æ•°24å°æ—¶ï¼‰ã€‚&lt;br&gt;ä¿®æ”¹å‚æ•°ä¹‹åï¼Œé‡å¯kakfaèŠ‚ç‚¹ï¼Œkafkaä¼šä¸»åŠ¨purge 1å°æ—¶ä¹‹å‰çš„logæ•°æ®ã€‚&lt;br&gt;ä»¥ä¸‹æ˜¯kafka_0.8.1.1ç‰ˆæœ¬kafkkaé›†ç¾¤æ‰©å®¹æ“ä½œè®°å½•ï¼Œä»3å°ç‰©ç†æœºæ‰©å®¹åˆ°4å°ç‰©ç†ï¼Œpartitionæ•°é‡ç”±24ä¸ªå¢åŠ åˆ°28ä¸ªã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Bigdata Hadoop" scheme="http://blog.yancy.cc/categories/Bigdata-Hadoop/"/>
    
    
      <category term="Kafka" scheme="http://blog.yancy.cc/tags/Kafka/"/>
    
  </entry>
  
  <entry>
    <title>Kafkaæ€§èƒ½ä¼˜åŒ–â€“JVMå‚æ•°é…ç½®ä¼˜åŒ–</title>
    <link href="http://blog.yancy.cc/2017/07/04/Bigdata-hadoop/Kafka/kafka%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E2%80%93JVM%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE%E4%BC%98%E5%8C%96/"/>
    <id>http://blog.yancy.cc/2017/07/04/Bigdata-hadoop/Kafka/kafkaæ€§èƒ½ä¼˜åŒ–â€“JVMå‚æ•°é…ç½®ä¼˜åŒ–/</id>
    <published>2017-07-04T03:22:00.000Z</published>
    <updated>2017-11-30T13:55:40.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://cdn2.hubspot.net/hubfs/540072/Kafka_Connect_graphic.png" alt="img-w650"></p><h3 id="Kafkaé›†ç¾¤ç¨³å®š"><a href="#Kafkaé›†ç¾¤ç¨³å®š" class="headerlink" title="Kafkaé›†ç¾¤ç¨³å®š"></a>Kafkaé›†ç¾¤ç¨³å®š</h3><p>GCè°ƒä¼˜<br>ã€€ã€€è°ƒGCæ˜¯é—¨æ‰‹è‰ºæ´»ï¼Œå¹¸äºJava 7å¼•è¿›äº†G1 åƒåœ¾å›æ”¶ï¼Œä½¿å¾—GCè°ƒä¼˜å˜çš„æ²¡é‚£ä¹ˆéš¾ã€‚G1ä¸»è¦æœ‰ä¸¤ä¸ªé…ç½®é€‰é¡¹æ¥è°ƒä¼˜ï¼šMaxGCPauseMillis å’Œ InitiatingHeapOccupancyPercentï¼Œå…·ä½“å‚æ•°è®¾ç½®å¯ä»¥å‚è€ƒGoogleï¼Œè¿™é‡Œä¸èµ˜è¿°ã€‚</p><p>ã€€ã€€Kafka brokerèƒ½å¤Ÿæœ‰æ•ˆçš„åˆ©ç”¨å †å†…å­˜å’Œå¯¹è±¡å›æ”¶ï¼Œæ‰€ä»¥è¿™äº›å€¼å¯ä»¥è°ƒå°ç‚¹ã€‚å¯¹äº 64Gbå†…å­˜ï¼ŒKafkaè¿è¡Œå †å†…å­˜5Gbï¼ŒMaxGCPauseMillis å’Œ InitiatingHeapOccupancyPercent åˆ†åˆ«è®¾ç½®ä¸º 20æ¯«ç§’å’Œ 35ã€‚Kafkaçš„å¯åŠ¨è„šæœ¬ä½¿ç”¨çš„ä¸æ˜¯ G1å›æ”¶ï¼Œéœ€è¦åœ¨ç¯å¢ƒå˜é‡ä¸­åŠ å…¥ã€‚<br><a id="more"></a></p><h3 id="Kafka-Brokerä¸ªæ•°å†³å®šå› ç´ "><a href="#Kafka-Brokerä¸ªæ•°å†³å®šå› ç´ " class="headerlink" title="Kafka Brokerä¸ªæ•°å†³å®šå› ç´ "></a>Kafka Brokerä¸ªæ•°å†³å®šå› ç´ </h3><p>ã€€ã€€ç£ç›˜å®¹é‡ï¼šé¦–å…ˆè€ƒè™‘çš„æ˜¯æ‰€éœ€ä¿å­˜çš„æ¶ˆæ¯æ‰€å ç”¨çš„æ€»ç£ç›˜å®¹é‡å’Œæ¯ä¸ªbrokeræ‰€èƒ½æä¾›çš„ç£ç›˜ç©ºé—´ã€‚å¦‚æœKafkaé›†ç¾¤éœ€è¦ä¿ç•™ 10 TBæ•°æ®ï¼Œå•ä¸ªbrokerèƒ½å­˜å‚¨ 2 TBï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦çš„æœ€å°Kafkaé›†ç¾¤å¤§å°5ä¸ªbrokerã€‚æ­¤å¤–ï¼Œå¦‚æœå¯ç”¨å‰¯æœ¬å‚æ•°ï¼Œåˆ™å¯¹åº”çš„å­˜å‚¨ç©ºé—´éœ€è‡³å°‘å¢åŠ ä¸€å€ï¼ˆå–å†³äºå‰¯æœ¬å‚æ•°ï¼‰ã€‚è¿™æ„å‘³ç€å¯¹åº”çš„Kafkaé›†ç¾¤è‡³å°‘éœ€è¦ 10 ä¸ªbrokerã€‚</p><p>ã€€ã€€è¯·æ±‚é‡ï¼šå¦å¤–ä¸€ä¸ªè¦è€ƒè™‘çš„æ˜¯Kafkaé›†ç¾¤å¤„ç†è¯·æ±‚çš„èƒ½åŠ›ã€‚è¿™ä¸»è¦å–å†³äºå¯¹Kafka clientè¯·æ±‚çš„ç½‘ç»œå¤„ç†èƒ½åŠ›ï¼Œç‰¹åˆ«æ˜¯ï¼Œæœ‰å¤šä¸ªconsumeræˆ–è€…ç½‘è·¯æµé‡ä¸ç¨³å®šã€‚å¦‚æœï¼Œé«˜å³°æ—¶åˆ»ï¼Œå•ä¸ªbrokerçš„ç½‘ç»œæµé‡è¾¾åˆ°80%ï¼Œè¿™æ—¶æ˜¯æ’‘ä¸ä½ä¸¤ä¸ªconsumerçš„ï¼Œé™¤éæœ‰ä¸¤ä¸ªbrokerã€‚å†è€…ï¼Œå¦‚æœå¯ç”¨äº†å‰¯æœ¬å‚æ•°ï¼Œåˆ™éœ€è¦è€ƒè™‘å‰¯æœ¬è¿™ä¸ªé¢å¤–çš„consumerã€‚ä¹Ÿå¯ä»¥æ‰©å±•å¤šä¸ªbrokeræ¥å‡å°‘ç£ç›˜çš„ååé‡å’Œç³»ç»Ÿå†…å­˜ã€‚</p><h3 id="ä¸»è¦æ˜¯å¯åŠ¨è„šæœ¬å’Œlog4jåŸºæœ¬å‚æ•°çš„è®¾ç½®å’Œä¼˜åŒ–ï¼Œè¿™äº›å‚æ•°è—çš„æ¯”è¾ƒæ·±ã€‚"><a href="#ä¸»è¦æ˜¯å¯åŠ¨è„šæœ¬å’Œlog4jåŸºæœ¬å‚æ•°çš„è®¾ç½®å’Œä¼˜åŒ–ï¼Œè¿™äº›å‚æ•°è—çš„æ¯”è¾ƒæ·±ã€‚" class="headerlink" title="ä¸»è¦æ˜¯å¯åŠ¨è„šæœ¬å’Œlog4jåŸºæœ¬å‚æ•°çš„è®¾ç½®å’Œä¼˜åŒ–ï¼Œè¿™äº›å‚æ•°è—çš„æ¯”è¾ƒæ·±ã€‚"></a>ä¸»è¦æ˜¯å¯åŠ¨è„šæœ¬å’Œlog4jåŸºæœ¬å‚æ•°çš„è®¾ç½®å’Œä¼˜åŒ–ï¼Œè¿™äº›å‚æ•°è—çš„æ¯”è¾ƒæ·±ã€‚</h3><h3 id="1ã€JVMå‚æ•°é…ç½®ä¼˜åŒ–"><a href="#1ã€JVMå‚æ•°é…ç½®ä¼˜åŒ–" class="headerlink" title="1ã€JVMå‚æ•°é…ç½®ä¼˜åŒ–"></a>1ã€JVMå‚æ•°é…ç½®ä¼˜åŒ–</h3><p>å¦‚æœä½¿ç”¨çš„CMS GCç®—æ³•ï¼Œå»ºè®®JVM Heapä¸è¦å¤ªå¤§ï¼Œåœ¨4GBä»¥å†…å°±å¯ä»¥ã€‚JVMå¤ªå¤§ï¼Œå¯¼è‡´Major GCæˆ–è€…Full GCäº§ç”Ÿçš„â€œstop the worldâ€æ—¶é—´è¿‡é•¿ï¼Œå¯¼è‡´brokerå’Œzkä¹‹é—´çš„sessionè¶…æ—¶ï¼Œæ¯”å¦‚é‡æ–°é€‰ä¸¾controllerèŠ‚ç‚¹å’Œæå‡follow replicaä¸ºleader replicaã€‚<br>JVMä¹Ÿä¸èƒ½è¿‡å°ï¼Œå¦åˆ™ä¼šå¯¼è‡´é¢‘ç¹åœ°è§¦å‘gcæ“ä½œï¼Œä¹Ÿå½±å“Kafkaçš„ååé‡ã€‚å¦å¤–ï¼Œéœ€è¦é¿å…CMS GCè¿‡ç¨‹ä¸­çš„å‘ç”Ÿpromotion failureå’Œconcurrent failureé—®é¢˜ã€‚CMSInitiatingOccupancyFraction=70å¯ä»¥é¢„é˜²concurrent failureé—®é¢˜ï¼Œæå‰å‡ºå‘Major GCã€‚<br>Kafka JVMå‚æ•°å¯ä»¥ç›´æ¥ä¿®æ”¹å¯åŠ¨è„šæœ¬<code>bin/kafka-server-start.sh</code><br>ä¸­çš„å˜é‡å€¼ã€‚ä¸‹é¢æ˜¯ä¸€äº›åŸºæœ¬å‚æ•°ï¼Œä¹Ÿå¯ä»¥æ ¹æ®å®é™…çš„gcçŠ¶å†µå’Œè°ƒè¯•GCéœ€è¦å¢åŠ ä¸€äº›ç›¸å…³çš„å‚æ•°ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">export</span> KAFKA_HEAP_OPTS=<span class="string">"-Xmx8G -Xms8G -Xmn4G -XX:PermSize=64m -XX:MaxPermSize=128m  -XX:SurvivorRatio=6  -XX:CMSInitiatingOccupancyFraction=70 -XX:+UseCMSInitiatingOccupancyOnly"</span></div></pre></td></tr></table></figure><p>éœ€è¦å…³æ³¨gcæ—¥å¿—ä¸­çš„YGCæ—¶é—´ä»¥åŠCMS GCé‡Œé¢çš„CMS-initial-markå’ŒCMS-remarkä¸¤ä¸ªé˜¶æ®µçš„æ—¶é—´ï¼Œè¿™äº›GCè¿‡ç¨‹æ˜¯â€œstop the worldâ€æ–¹å¼å®Œæˆçš„ã€‚</p><blockquote><p>jdk1.8 ä¼˜åŒ–çš„è¯ä¼šæç¤ºMaxPermSize=128m,PermSize=64m å­—é¢æ„æ€æ˜¯MaxPermSizeä¸éœ€è¦æˆ‘ä»¬é…ç½®äº†,jdk1.8 ç‰ˆæœ¬åŠŸèƒ½å…¶å®å·²ä¸éœ€è¦è¿™ä¸ªä¼˜åŒ–å‚æ•°ï¼š</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[jollybi@kafka3 kafka_2.10-0.8.2.1]$ /data/tools/kafka_2.10-0.8.2.1/bin/kafka-server-start.sh /data/tools/kafka_2.10-0.8.2.1/config/server.properties &amp;</div><div class="line">[1] 10312</div><div class="line">[jollybi@kafka3 kafka_2.10-0.8.2.1]$ Java HotSpot(TM) 64-Bit Server VM warning: ignoring option PermSize=64m; support was removed <span class="keyword">in</span> 8.0</div><div class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize=128m; support was removed <span class="keyword">in</span> 8.0</div><div class="line"></div><div class="line">ä¼˜åŒ–å‚æ•°ï¼š</div><div class="line"><span class="built_in">export</span> KAFKA_HEAP_OPTS=<span class="string">"-Xmx4G -Xms4G -Xmn2G  -XX:SurvivorRatio=6  -XX:CMSInitiatingOccupancyFraction=70 -XX:+UseCMSInitiatingOccupancyOnly"</span></div><div class="line"><span class="built_in">export</span> JMX_PORT=<span class="string">"9999"</span>  <span class="comment">### Kafka Managerç›‘æ§ç›‘å¬jmxç«¯å£,å¦‚æœæ²¡æœ‰å¯ä¸è®¾ç½®ã€‚</span></div></pre></td></tr></table></figure><h3 id="2ã€æ‰“å¼€JMXç«¯å£"><a href="#2ã€æ‰“å¼€JMXç«¯å£" class="headerlink" title="2ã€æ‰“å¼€JMXç«¯å£"></a>2ã€æ‰“å¼€JMXç«¯å£</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ä¸»è¦æ˜¯ä¸ºäº†é€šè¿‡JMXç«¯å£ç›‘æ§Kafka Brokerä¿¡æ¯ã€‚å¯ä»¥åœ¨bin/kafka-server-start.shä¸­æ‰“å¼€JMXç«¯å£å˜é‡ã€‚</div><div class="line"><span class="built_in">export</span> JMX_PORT=9999</div></pre></td></tr></table></figure><h3 id="3ã€è°ƒæ•´log4jçš„æ—¥å¿—çº§åˆ«"><a href="#3ã€è°ƒæ•´log4jçš„æ—¥å¿—çº§åˆ«" class="headerlink" title="3ã€è°ƒæ•´log4jçš„æ—¥å¿—çº§åˆ«"></a>3ã€è°ƒæ•´log4jçš„æ—¥å¿—çº§åˆ«</h3><p>å¦‚æœé›†ç¾¤ä¸­topicå’Œpartitionæ•°é‡è¾ƒå¤§æ—¶ï¼Œå› ä¸ºlog4jçš„æ—¥å¿—çº§åˆ«å¤ªä½ï¼Œå¯¼è‡´è¿›ç¨‹æŒç»­å¾ˆé•¿çš„æ—¶é—´åœ¨æ‰“å°æ—¥å¿—ã€‚æ—¥å¿—é‡å·¨å¤§ï¼Œå¯¼è‡´å¾ˆå¤šé¢å¤–çš„æ€§èƒ½å¼€é”€ã€‚ç‰¹åˆ«æ˜¯contolleræ—¥å¿—çº§åˆ«ä¸ºtraceçº§åˆ«ï¼Œè¿™ç‚¹æ¯”è¾ƒå‘ã€‚<br>Tips é€šè¿‡JMXç«¯å£è®¾ç½®log4jæ—¥å¿—çº§åˆ«ï¼Œä¸ç”¨é‡å¯brokerèŠ‚ç‚¹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">è®¾ç½®æ—¥å¿—çº§åˆ«ï¼š</div><div class="line">java -jar cmdline-jmxclient-0.10.3.jar - localhost:9999 kafka:<span class="built_in">type</span>=kafka.Log4jController <span class="built_in">set</span>LogLevel=kafka.controller,INFO</div><div class="line">java -jar cmdline-jmxclient-0.10.3.jar - localhost:9999 kafka:<span class="built_in">type</span>=kafka.Log4jController <span class="built_in">set</span>LogLevel=state.change.logger,INFO</div><div class="line"> </div><div class="line">æ£€æŸ¥æ—¥å¿—çº§åˆ«ï¼š</div><div class="line">java -jar cmdline-jmxclient-0.10.3.jar - localhost:9999 kafka:<span class="built_in">type</span>=kafka.Log4jController getLogLevel=kafka.controller</div><div class="line">java -jar cmdline-jmxclient-0.10.3.jar - localhost:9999 kafka:<span class="built_in">type</span>=kafka.Log4jController getLogLevel=state.change.logger</div></pre></td></tr></table></figure><h3 id="4ã€æ€§èƒ½ä¼˜åŒ–æŠ€å·§"><a href="#4ã€æ€§èƒ½ä¼˜åŒ–æŠ€å·§" class="headerlink" title="4ã€æ€§èƒ½ä¼˜åŒ–æŠ€å·§"></a>4ã€æ€§èƒ½ä¼˜åŒ–æŠ€å·§</h3><p>4.1ã€é…ç½®åˆé€‚çš„partitonsæ•°é‡ã€‚</p><p>è¿™ä¼¼ä¹æ˜¯kafkaæ–°æ‰‹å¿…é—®å¾—é—®é¢˜ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å¿…é¡»ç†è§£ï¼Œpartitonæ˜¯kafkaçš„å¹¶è¡Œå•å…ƒã€‚ä»producerå’Œbrokerçš„è§†è§’çœ‹ï¼Œå‘ä¸åŒçš„partitionå†™å…¥æ˜¯å®Œå…¨å¹¶è¡Œçš„ï¼›è€Œå¯¹äºconsumerï¼Œå¹¶å‘æ•°å®Œå…¨å–å†³äºpartitionçš„æ•°é‡ï¼Œå³ï¼Œå¦‚æœconsumeræ•°é‡å¤§äºpartitionæ•°é‡ï¼Œåˆ™å¿…æœ‰consumeré—²ç½®ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºkafkaçš„ååä¸partitionæ—¶çº¿æ€§å…³ç³»ã€‚partitionçš„æ•°é‡è¦æ ¹æ®ååæ¥æ¨æ–­ï¼Œå‡å®špä»£è¡¨ç”Ÿäº§è€…å†™å…¥å•ä¸ªpartitionçš„æœ€å¤§ååï¼Œcä»£è¡¨æ¶ˆè´¹è€…ä»å•ä¸ªpartitionæ¶ˆè´¹çš„æœ€å¤§ååï¼Œæˆ‘ä»¬çš„ç›®æ ‡ååæ˜¯tï¼Œé‚£ä¹ˆpartitionçš„æ•°é‡åº”è¯¥æ˜¯t/på’Œt/cä¸­è¾ƒå¤§çš„é‚£ä¸€ä¸ªã€‚å®é™…æƒ…å†µä¸­ï¼Œpçš„å½±å“å› ç´ æœ‰æ‰¹å¤„ç†çš„è§„æ¨¡ï¼Œå‹ç¼©ç®—æ³•ï¼Œç¡®è®¤æœºåˆ¶å’Œå‰¯æœ¬æ•°ç­‰ï¼Œç„¶è€Œï¼Œå¤šæ¬¡benchmarkçš„ç»“æœè¡¨æ˜ï¼Œå•ä¸ªpartitionçš„æœ€å¤§å†™å…¥åååœ¨10MB/secå·¦å³ï¼›cçš„å½±å“å› ç´ æ˜¯é€»è¾‘ç®—æ³•ï¼Œéœ€è¦åœ¨ä¸åŒåœºæ™¯ä¸‹å®æµ‹å¾—å‡ºã€‚</p><p>è¿™ä¸ªç»“è®ºä¼¼ä¹å¤ªä¹¦ç”Ÿæ°”å’Œä¸å®ç”¨ã€‚æˆ‘ä»¬é€šå¸¸å»ºè®®partitionçš„æ•°é‡ä¸€å®šè¦å¤§äºç­‰äºæ¶ˆè´¹è€…çš„æ•°é‡æ¥å®ç°æœ€å¤§å¹¶å‘ã€‚å®˜æ–¹æ›¾æµ‹è¯•è¿‡1ä¸‡ä¸ªpartitionçš„æƒ…å†µï¼Œæ‰€ä»¥ä¸éœ€è¦å¤ªæ‹…å¿ƒpartitionè¿‡å¤šçš„é—®é¢˜ã€‚ä¸‹é¢çš„çŸ¥è¯†ä¼šæœ‰åŠ©äºè¯»è€…åœ¨ç”Ÿäº§ç¯å¢ƒåšå‡ºæœ€ä½³çš„é€‰æ‹©ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">aã€ä¸€ä¸ªpartitionå°±æ˜¯ä¸€ä¸ªå­˜å‚¨kafka-logçš„ç›®å½•ã€‚</div><div class="line">bã€ä¸€ä¸ªpartitionåªèƒ½å¯„å®¿åœ¨ä¸€ä¸ªbrokerä¸Šã€‚</div><div class="line">cã€å•ä¸ªpartitionæ˜¯å¯ä»¥å®ç°æ¶ˆæ¯çš„é¡ºåºå†™å…¥çš„ã€‚</div><div class="line">dã€å•ä¸ªpartitionåªèƒ½è¢«å•ä¸ªæ¶ˆè´¹è€…è¿›ç¨‹æ¶ˆè´¹ï¼Œä¸è¯¥æ¶ˆè´¹è€…æ‰€å±äºçš„æ¶ˆè´¹ç»„æ— å…³ã€‚è¿™æ ·åšï¼Œæœ‰åŠ©äºå®ç°é¡ºåºæ¶ˆè´¹ã€‚</div><div class="line">eã€å•ä¸ªæ¶ˆè´¹è€…è¿›ç¨‹å¯åŒæ—¶æ¶ˆè´¹å¤šä¸ªpartitionï¼Œå³partitioné™åˆ¶äº†æ¶ˆè´¹ç«¯çš„å¹¶å‘èƒ½åŠ›ã€‚</div><div class="line">fã€partitionè¶Šå¤šåˆ™fileå’Œmemoryæ¶ˆè€—è¶Šå¤§ï¼Œè¦åœ¨æœåŠ¡å™¨æ‰¿å—æœåŠ¡å™¨è®¾ç½®ã€‚</div><div class="line">gã€æ¯ä¸ªpartitionä¿¡æ¯éƒ½å­˜åœ¨æ‰€æœ‰çš„zkèŠ‚ç‚¹ä¸­ã€‚</div><div class="line">hã€partitionè¶Šå¤šåˆ™å¤±è´¥é€‰ä¸¾è€—æ—¶è¶Šé•¿ã€‚</div><div class="line">kã€offsetæ˜¯å¯¹æ¯ä¸ªpartitionè€Œè¨€çš„ï¼Œpartitionè¶Šå¤šï¼ŒæŸ¥è¯¢offsetå°±è¶Šè€—æ—¶ã€‚</div><div class="line">iã€partitionçš„æ•°é‡æ˜¯å¯ä»¥åŠ¨æ€å¢åŠ çš„ï¼ˆåªèƒ½åŠ ä¸èƒ½å‡ï¼‰ã€‚</div></pre></td></tr></table></figure><p>æˆ‘ä»¬å»ºè®®çš„åšæ³•æ˜¯ï¼Œå¦‚æœæ˜¯3ä¸ªbrokerçš„é›†ç¾¤ï¼Œæœ‰5ä¸ªæ¶ˆè´¹è€…ï¼Œé‚£ä¹ˆå»ºè®®partitionçš„æ•°é‡æ˜¯15ï¼Œä¹Ÿå°±æ˜¯brokerå’Œconsumeræ•°é‡çš„æœ€å°å…¬å€æ•°ã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå¤§äºæ¶ˆè´¹è€…çš„brokeræ•°é‡çš„å€æ•°ï¼Œæ¯”å¦‚6æˆ–è€…9ï¼Œè¿˜è¯·è¯»è€…è‡ªè¡Œæ ¹æ®å®é™…ç¯å¢ƒè£å®šã€‚</p><h3 id="Communicative-learning"><a href="#Communicative-learning" class="headerlink" title="Communicative learning:"></a>Communicative learning:</h3><p>ğŸ§  Linux shell_ senior operation and maintenance faction: QQ group <code>459096184</code> circle (system operation and maintenance - application operation and maintenance - automation operation and maintenance - virtualization technology research, welcome to join)<br>ğŸ§  BigData-Exchange School:QQ group <code>521621407</code> circles (big data Yun Wei) (Hadoop developer) (big data research enthusiasts) welcome to join</p><p>Bidata have internal WeChat exchange group, learn from each other, join QQ group has links.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;https://cdn2.hubspot.net/hubfs/540072/Kafka_Connect_graphic.png&quot; alt=&quot;img-w650&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;Kafkaé›†ç¾¤ç¨³å®š&quot;&gt;&lt;a href=&quot;#Kafkaé›†ç¾¤ç¨³å®š&quot; class=&quot;headerlink&quot; title=&quot;Kafkaé›†ç¾¤ç¨³å®š&quot;&gt;&lt;/a&gt;Kafkaé›†ç¾¤ç¨³å®š&lt;/h3&gt;&lt;p&gt;GCè°ƒä¼˜&lt;br&gt;ã€€ã€€è°ƒGCæ˜¯é—¨æ‰‹è‰ºæ´»ï¼Œå¹¸äºJava 7å¼•è¿›äº†G1 åƒåœ¾å›æ”¶ï¼Œä½¿å¾—GCè°ƒä¼˜å˜çš„æ²¡é‚£ä¹ˆéš¾ã€‚G1ä¸»è¦æœ‰ä¸¤ä¸ªé…ç½®é€‰é¡¹æ¥è°ƒä¼˜ï¼šMaxGCPauseMillis å’Œ InitiatingHeapOccupancyPercentï¼Œå…·ä½“å‚æ•°è®¾ç½®å¯ä»¥å‚è€ƒGoogleï¼Œè¿™é‡Œä¸èµ˜è¿°ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€Kafka brokerèƒ½å¤Ÿæœ‰æ•ˆçš„åˆ©ç”¨å †å†…å­˜å’Œå¯¹è±¡å›æ”¶ï¼Œæ‰€ä»¥è¿™äº›å€¼å¯ä»¥è°ƒå°ç‚¹ã€‚å¯¹äº 64Gbå†…å­˜ï¼ŒKafkaè¿è¡Œå †å†…å­˜5Gbï¼ŒMaxGCPauseMillis å’Œ InitiatingHeapOccupancyPercent åˆ†åˆ«è®¾ç½®ä¸º 20æ¯«ç§’å’Œ 35ã€‚Kafkaçš„å¯åŠ¨è„šæœ¬ä½¿ç”¨çš„ä¸æ˜¯ G1å›æ”¶ï¼Œéœ€è¦åœ¨ç¯å¢ƒå˜é‡ä¸­åŠ å…¥ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="Bigdata Hadoop" scheme="http://blog.yancy.cc/categories/Bigdata-Hadoop/"/>
    
    
      <category term="Kafka" scheme="http://blog.yancy.cc/tags/Kafka/"/>
    
  </entry>
  
  <entry>
    <title>Bigdata-å¦‚ä½•æ‰‹åŠ¨æ›´æ–°Kafkaä¸­æŸä¸ªTopicçš„åç§»é‡</title>
    <link href="http://blog.yancy.cc/2017/06/29/Bigdata-hadoop/Kafka/%E5%A6%82%E4%BD%95%E6%89%8B%E5%8A%A8%E6%9B%B4%E6%96%B0Kafka%E4%B8%AD%E6%9F%90%E4%B8%AATopic%E7%9A%84%E5%81%8F%E7%A7%BB%E9%87%8F/"/>
    <id>http://blog.yancy.cc/2017/06/29/Bigdata-hadoop/Kafka/å¦‚ä½•æ‰‹åŠ¨æ›´æ–°Kafkaä¸­æŸä¸ªTopicçš„åç§»é‡/</id>
    <published>2017-06-29T06:46:00.000Z</published>
    <updated>2017-10-30T10:31:35.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å¦‚ä½•æ‰‹åŠ¨æ›´æ–°Kafkaä¸­æŸä¸ªTopicçš„åç§»é‡"><a href="#å¦‚ä½•æ‰‹åŠ¨æ›´æ–°Kafkaä¸­æŸä¸ªTopicçš„åç§»é‡" class="headerlink" title="å¦‚ä½•æ‰‹åŠ¨æ›´æ–°Kafkaä¸­æŸä¸ªTopicçš„åç§»é‡"></a>å¦‚ä½•æ‰‹åŠ¨æ›´æ–°Kafkaä¸­æŸä¸ªTopicçš„åç§»é‡</h3><p><img src="http://7xrthw.com1.z0.glb.clouddn.com/kafka-streams-poc-old-solution.jpg" alt=""></p><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒKafka topicçš„åç§»é‡ä¸€èˆ¬éƒ½æ˜¯å­˜å‚¨åœ¨Zookeeperä¸­ï¼Œå…·ä½“çš„è·¯å¾„ä¸º<code>/consumers/[groupId]/offsets/[topic]/[partitionId]</code>ï¼Œæ¯”å¦‚iteblogä¸»é¢˜åˆ†åŒº10çš„åç§»é‡è·å–å¦‚ä¸‹ï¼š<br>åœ¨æœ‰äº›åœºæ™¯ä¸‹ï¼Œè¿™ä¸ªå·¥å…·ä¸æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯èƒ½å¤Ÿæ‰‹åŠ¨è®¾ç½®åˆ†åŒºçš„åç§»é‡ä¸ºä»»ä½•æœ‰æ„ä¹‰çš„å€¼ï¼Œè€Œä¸ä»…ä»…æ˜¯earliestæˆ–è€…latestã€‚é‚£å’‹åŠï¼Ÿ</p><a id="more"></a><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒKafka topicçš„åç§»é‡ä¸€èˆ¬éƒ½æ˜¯å­˜å‚¨åœ¨Zookeeperä¸­ï¼Œå…·ä½“çš„è·¯å¾„ä¸º<code>/consumers/[groupId]/offsets/[topic]/[partitionId]</code>ï¼Œæ¯”å¦‚<code>mongotail_lz4</code>ä¸»é¢˜åˆ†åŒº10çš„åç§»é‡è·å–å¦‚ä¸‹ï¼šã€€ã€€</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">[zk: 127.0.0.1:2281(CONNECTED) 2]  get /consumers/ibm_event/offsets/mongotail_lz4/10</div><div class="line">293894</div><div class="line">cZxid = 0x6000011f3</div><div class="line">ctime = Wed Jul 26 17:57:27 CST 2017</div><div class="line">mZxid = 0x6000018c9</div><div class="line">mtime = Wed Jul 26 18:18:27 CST 2017</div><div class="line">pZxid = 0x6000011f3</div><div class="line">cversion = 0</div><div class="line">dataVersion = 20</div><div class="line">aclVersion = 0</div><div class="line">ephemeralOwner = 0x0</div><div class="line">dataLength = 6</div><div class="line">numChildren = 0</div></pre></td></tr></table></figure><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡setå‘½ä»¤æ¥è®¾ç½®æŸä¸ªåˆ†åŒºçš„åç§»é‡ï¼Œå¦‚ä¸‹ï¼›</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">[zk: 127.0.0.1:2281(CONNECT get /consumers/ibm_event/offsets/mongotail_lz4/10 0 </div><div class="line">0</div><div class="line">cZxid = 0x6000011f3</div><div class="line">ctime = Wed Jul 26 17:57:27 CST 2017</div><div class="line">mZxid = 0x60000204c</div><div class="line">mtime = Wed Jul 26 18:37:21 CST 2017</div><div class="line">pZxid = 0x6000011f3</div><div class="line">cversion = 0</div><div class="line">dataVersion = 21</div><div class="line">aclVersion = 0</div><div class="line">ephemeralOwner = 0x0</div><div class="line">dataLength = 1</div><div class="line">numChildren = 0</div></pre></td></tr></table></figure><p>12ä¸ªåˆ†åŒºåˆ†åˆ«æ›´æ–°è¿‡å»ã€‚</p><h3 id="äº¤æµå­¦ä¹ ï¼š"><a href="#äº¤æµå­¦ä¹ ï¼š" class="headerlink" title="äº¤æµå­¦ä¹ ï¼š"></a>äº¤æµå­¦ä¹ ï¼š</h3><p>ğŸ§  Linux shell_é«˜çº§è¿ç»´æ´¾: <code>459096184</code>    åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)<br>ğŸ§  BigData-Exchange School : <code>521621407</code>  åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥</p><p>ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;å¦‚ä½•æ‰‹åŠ¨æ›´æ–°Kafkaä¸­æŸä¸ªTopicçš„åç§»é‡&quot;&gt;&lt;a href=&quot;#å¦‚ä½•æ‰‹åŠ¨æ›´æ–°Kafkaä¸­æŸä¸ªTopicçš„åç§»é‡&quot; class=&quot;headerlink&quot; title=&quot;å¦‚ä½•æ‰‹åŠ¨æ›´æ–°Kafkaä¸­æŸä¸ªTopicçš„åç§»é‡&quot;&gt;&lt;/a&gt;å¦‚ä½•æ‰‹åŠ¨æ›´æ–°Kafkaä¸­æŸä¸ªTopicçš„åç§»é‡&lt;/h3&gt;&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/kafka-streams-poc-old-solution.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒKafka topicçš„åç§»é‡ä¸€èˆ¬éƒ½æ˜¯å­˜å‚¨åœ¨Zookeeperä¸­ï¼Œå…·ä½“çš„è·¯å¾„ä¸º&lt;code&gt;/consumers/[groupId]/offsets/[topic]/[partitionId]&lt;/code&gt;ï¼Œæ¯”å¦‚iteblogä¸»é¢˜åˆ†åŒº10çš„åç§»é‡è·å–å¦‚ä¸‹ï¼š&lt;br&gt;åœ¨æœ‰äº›åœºæ™¯ä¸‹ï¼Œè¿™ä¸ªå·¥å…·ä¸æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯èƒ½å¤Ÿæ‰‹åŠ¨è®¾ç½®åˆ†åŒºçš„åç§»é‡ä¸ºä»»ä½•æœ‰æ„ä¹‰çš„å€¼ï¼Œè€Œä¸ä»…ä»…æ˜¯earliestæˆ–è€…latestã€‚é‚£å’‹åŠï¼Ÿ&lt;/p&gt;
    
    </summary>
    
      <category term="å¤§æ•°æ®" scheme="http://blog.yancy.cc/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
    
      <category term="Kafka" scheme="http://blog.yancy.cc/tags/Kafka/"/>
    
  </entry>
  
  <entry>
    <title>OpenLDAPä¸€ä¸»å¤šä»å¤åˆ¶èŠ‚ç‚¹æœåŠ¡çš„é…ç½®-phpldapadminç®¡ç†è®¤è¯</title>
    <link href="http://blog.yancy.cc/2017/06/08/OpenLDAP/OpenLDAP%E4%B8%80%E4%B8%BB%E5%A4%9A%E4%BB%8E%E5%A4%8D%E5%88%B6%E8%8A%82%E7%82%B9%E6%9C%8D%E5%8A%A1%E7%9A%84%E9%85%8D%E7%BD%AE-phpldapadmin%E7%AE%A1%E7%90%86%E8%AE%A4%E8%AF%81/"/>
    <id>http://blog.yancy.cc/2017/06/08/OpenLDAP/OpenLDAPä¸€ä¸»å¤šä»å¤åˆ¶èŠ‚ç‚¹æœåŠ¡çš„é…ç½®-phpldapadminç®¡ç†è®¤è¯/</id>
    <published>2017-06-08T03:36:00.000Z</published>
    <updated>2018-09-21T08:54:11.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="OpenLDAPä¸»ä»å¤åˆ¶èŠ‚ç‚¹é…ç½®çº¿ä¸Šç‰ˆæœ¬"><a href="#OpenLDAPä¸»ä»å¤åˆ¶èŠ‚ç‚¹é…ç½®çº¿ä¸Šç‰ˆæœ¬" class="headerlink" title="OpenLDAPä¸»ä»å¤åˆ¶èŠ‚ç‚¹é…ç½®çº¿ä¸Šç‰ˆæœ¬"></a>OpenLDAPä¸»ä»å¤åˆ¶èŠ‚ç‚¹é…ç½®çº¿ä¸Šç‰ˆæœ¬</h4><p>å…¬å¸æœåŠ¡å™¨ä¸Šæ­å»ºäº†ä¸€ä¸ªOpenLDAPæœåŠ¡ï¼Œä¸ºäº†é¿å…å‡ºç°å•ç‚¹ï¼Œéœ€è¦ç»™LDAPåšä¸»ä»è¦ä»å›½å¤–ä»æœåŠ¡å™¨å®æ—¶åŒæ­¥ã€‚è¿™é‡Œæˆ‘ä¹Ÿå‡çº§äº†Openldap é…ç½®ä¸€ä¸»å¤šä»æ–¹æ³•ã€‚<br>äºæ˜¯ä¸Šopenldapå®˜ç½‘ä¸ŠæŸ¥äº†ä¸€ä¸‹openldapçš„å¤åˆ¶åŠŸèƒ½ã€‚</p><p><img src="https://devopsideas.com/wp-content/uploads/2017/09/Openldap-7-800x445.jpg" alt=""></p><a id="more"></a><h4 id="OpenLDAPè½¯ä»¶2-3ç®¡ç†å‘˜æŒ‡å—"><a href="#OpenLDAPè½¯ä»¶2-3ç®¡ç†å‘˜æŒ‡å—" class="headerlink" title="OpenLDAPè½¯ä»¶2.3ç®¡ç†å‘˜æŒ‡å—"></a><a href="http://www.openldap.org/doc/admin23/" target="_blank" rel="external">OpenLDAPè½¯ä»¶2.3ç®¡ç†å‘˜æŒ‡å—</a></h4><p><a href=""></a></p><ul><li>OpenLDAPå‰æœŸé…ç½®å‡†å¤‡ï¼š</li><li>OpenLDAPåŒæ­¥æ¡ä»¶ï¼š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">ä¸€ä¸»å¤šä»OpenLDAPé›†ç¾¤æœåŠ¡å™¨ï¼šç‰¹æ„å£°æ˜ä¸‹ï¼š2.3ç‰ˆæœ¬å®ç°ä¸äº†1ä¸»å¤šä»ï¼Œåªèƒ½å®ç°1ä¸»1ä»ã€‚</div><div class="line"></div><div class="line">1.Linuxç³»ç»Ÿæœ€å¥½ä¿æŒä¸€è‡´ï¼šCentOS release 6.7 </div><div class="line">2.LDAPæœåŠ¡å™¨ä¹‹é—´éœ€è¦ä¿æŒæ—¶é—´åŒæ­¥  /usr/sbin/ntpdate ntp.api.bz</div><div class="line">3.LDAPè½¯ä»¶åŒ…ç‰ˆæœ¬ä¿æŒä¸€è‡´     openldap-2.4.40</div><div class="line">4.èŠ‚ç‚¹ä¹‹é—´çš„åŸŸåå¯ä»¥äº’ç›¸è§£æ  </div><div class="line">5.é…ç½®LDAPåŒæ­¥å¤åˆ¶ï¼Œéœ€è¦æä¾›å®Œå…¨ä¸€è‡´çš„é…ç½®åŠç›®å½•æ ‘ä¿¡æ¯ ï¼ˆè¿™é‡Œæˆ‘ä¼šé‡ç‚¹è®²å¦‚ä½•åˆå§‹åŒ–æ•°æ®ï¼‰</div><div class="line">6.æ•°æ®æ¡ç›®ä¿æŒä¸€è‡´  ï¼ˆæ•°æ®å’Œç»“æ„ç›®å½•ç»Ÿä¸€åŒ–ï¼‰</div><div class="line">7.é¢å¤–çš„schemaæ–‡ä»¶ä¿æŒä¸€è‡´</div></pre></td></tr></table></figure><h4 id="openldapæ”¯æŒ5ç§å¤åˆ¶æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯"><a href="#openldapæ”¯æŒ5ç§å¤åˆ¶æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯" class="headerlink" title="openldapæ”¯æŒ5ç§å¤åˆ¶æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯:"></a>openldapæ”¯æŒ5ç§å¤åˆ¶æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯:</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Syncreplï¼šslaveæœåŠ¡å™¨ä»masterä¸Šæ‹‰å–æ•°æ®ï¼Œç¼ºç‚¹æ˜¯æ‹‰å–çš„æœ€å°ç²’åº¦æ˜¯å•æ¡è®°å½•</div><div class="line">Delta-syncreplï¼šä¸ä¸Šä¸€æ¡ç›¸ä¼¼ï¼Œä½†æ‹‰å–çš„æœ€å°ç²’åº¦æ˜¯å±æ€§</div><div class="line">N-Way Multi-Masterï¼šå¤šä¸»ï¼Œæ”¯æŒ2ä¸ªåŠä»¥ä¸Šçš„master</div><div class="line">MirrorModeï¼šåŒä¸»é•œåƒï¼Œä¸æ”¯æŒ3ä¸ªåŠä»¥ä¸Šçš„masterï¼Œä½†å¯ä»¥æœ‰slave</div><div class="line">Syncrepl Proxyï¼šä»£ç†æ¨¡å¼</div></pre></td></tr></table></figure><ul><li>åŒæ­¥éœ€è¦å¼€å¯syncreplæ¨¡å¼ï¼š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">slaveæœåŠ¡å™¨åˆ°masteræœåŠ¡å™¨ä»¥æ‹‰çš„æ¨¡å¼åŒæ­¥ç›®å½•æ ‘ã€‚å½“ä¸»æœåŠ¡å™¨å¯¹æŸä¸ªæ¡ç›®æˆ–æ›´å¤šæ¡ç›®</div><div class="line">ä¿®æ”¹æ¡ç›®å±æ€§æ—¶ï¼ŒslaveæœåŠ¡å™¨ä¼šæŠŠä¿®æ”¹çš„æ•´ä¸ªæ¡ç›®è¿›è¡ŒåŒæ­¥ï¼Œè€Œä¸æ˜¯å•ç‹¬çš„åŒæ­¥ä¿®æ”¹çš„å±</div><div class="line">æ€§å€¼ã€‚</div></pre></td></tr></table></figure><p>æŒ‰ç›®å‰çš„éœ€æ±‚åªè¦é…ç½®æˆMirrorModeå³å¯ï¼Œç¼–è¾‘<code>/etc/openldap/sldap.conf</code><br>æ‰¾åˆ°<code>â€œmoduleload syncprov.laâ€</code>ï¼Œå°†å‰é¢çš„#å·å»æ‰ã€‚</p><p>æ“ä½œç³»ç»Ÿä¿¡æ¯ï¼šCentOS_6.x_64   <code>å¤‡æ³¨ï¼š6.0ä»¥ä¸‹ç³»ç»Ÿå®‰è£…ç‰ˆæœ¬ä¼šè¿‡ä½ï¼Œä¸æ”¯æŒä¸€ä¸»å¤šä»é…ç½®ã€‚</code></p><table><thead><tr><th>è§’è‰²</th><th>ä¸»æœºå</th><th>IP åœ°å€</th></tr></thead><tbody><tr><td>OpenLDAP MAsteræœåŠ¡å™¨</td><td>openldap-master</td><td>192.168.17.145</td></tr><tr><td>OpenLDAP slave1æœåŠ¡å™¨</td><td>openldap-slave1</td><td>192.168.3.15</td></tr><tr><td>OpenLDAP slave2æœåŠ¡å™¨</td><td>openldap-slave2</td><td>192.168.3.82</td></tr></tbody></table><p>å®‰è£…æ–¹æ³•æˆ‘åœ¨å¦å¤–ä¸€ç¯‡å®‰è£…é…ç½®æ–‡æ¡£å¾ˆè¯¦ç»†çš„å†™å‡ºã€‚ è¿™é‡Œæˆ‘å¿«é€Ÿå‘½ä»¤æ“ä½œ ä¸åšå¤ªå¤šçš„å‘½ä»¤æè¿°äº†ã€‚</p><h3 id="åˆå§‹åŒ–æ•°æ®ç»“æ„"><a href="#åˆå§‹åŒ–æ•°æ®ç»“æ„" class="headerlink" title="åˆå§‹åŒ–æ•°æ®ç»“æ„"></a>åˆå§‹åŒ–æ•°æ®ç»“æ„</h3><p>åˆå§‹åŒ–å‘½ä»¤ï¼š</p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">cp -a /var/<span class="class"><span class="keyword">lib</span>/<span class="title">ldap</span> /<span class="title">var</span>/<span class="title">lib</span>/<span class="title">ldap</span>.<span class="title">backup</span></span></div><div class="line">rm -f /var/<span class="class"><span class="keyword">lib</span>/<span class="title">ldap</span>/*</span></div><div class="line">cp /usr/share/openldap-servers/DB_CONFIG.example /var/<span class="class"><span class="keyword">lib</span>/<span class="title">ldap</span>/<span class="title">DB_CONFIG</span></span></div><div class="line">cp -a /etc/openldap/slapd.d/ <span class="regexp">/etc/openldap</span><span class="regexp">/slapd.dbakup</span></div><div class="line">rm -rf /etc<span class="regexp">/openldap/slapd</span>.d/*</div><div class="line">chown ldap.ldap /var/<span class="class"><span class="keyword">lib</span>/<span class="title">ldap</span>/*</span></div><div class="line">chmod -R <span class="number">600</span> /var/<span class="class"><span class="keyword">lib</span>/<span class="title">ldap</span>/*</span></div><div class="line">chown -R <span class="symbol">ldap:</span>ldap /etc/openldap/slapd.d</div><div class="line">cd /var/<span class="class"><span class="keyword">lib</span>/<span class="title">ldap</span>/ &amp;&amp; <span class="title">slapd</span></span></div><div class="line">slaptest -f /etc/openldap/slapd.conf -F /etc/openldap/slapd.d</div><div class="line">chown -R <span class="symbol">ldap:</span>ldap /etc/openldap/slapd.d</div><div class="line">chown ldap.ldap /var/<span class="class"><span class="keyword">lib</span>/<span class="title">ldap</span>/*</span></div><div class="line">service slapd restart</div></pre></td></tr></table></figure><h3 id="ä¸»æœåŠ¡å™¨-Master-Centos6-6å®‰è£…OpenLDAP"><a href="#ä¸»æœåŠ¡å™¨-Master-Centos6-6å®‰è£…OpenLDAP" class="headerlink" title="ä¸»æœåŠ¡å™¨ Master | Centos6.6å®‰è£…OpenLDAP"></a>ä¸»æœåŠ¡å™¨ Master | Centos6.6å®‰è£…OpenLDAP</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">æ·»åŠ hosté…ç½®ï¼š</div><div class="line"></div><div class="line">1.æ—¶é—´åŒæ­¥ï¼š</div><div class="line">å› ä¸ºä½¿ç”¨çš„æ˜¯xxäº‘ä¸»æœºï¼Œé»˜è®¤æ·»åŠ çš„æœ‰æ—¶é—´åŒæ­¥ï¼Œè¿™é‡Œå°±ä¸åœ¨æè¿°ã€‚</div><div class="line"></div><div class="line"></div><div class="line">yumå¿«é€Ÿå®‰è£…openldap</div><div class="line"></div><div class="line"><span class="comment"># yum install -y vim automake autoconf gcc xz ncurses-devel \ patch python-devel git python-pip gcc-c++  # å®‰è£…åŸºæœ¬ç¯å¢ƒï¼Œåé¢ä¾èµ–</span></div><div class="line"><span class="comment"># yum install -y openldap openldap-servers openldap-clients openldap-devel</span></div><div class="line"></div><div class="line">é…ç½® OpenLDAP æœåŠ¡å™¨</div><div class="line"></div><div class="line"><span class="comment">#æ‹·è´LDAPé…ç½®æ–‡ä»¶åˆ°LDAPç›®å½•</span></div><div class="line"></div><div class="line"><span class="comment"># cp /usr/share/openldap-servers/slapd.conf.obsolete /etc/openldap/slapd.conf  ## è¯¥æ–‡ä»¶æ˜¯slapdçš„é…ç½®æ–‡ä»¶</span></div><div class="line"><span class="comment"># cp /usr/share/openldap-servers/DB_CONFIG.example /var/lib/ldap/DB_CONFIG    ## æ•°æ®åº“çš„é…ç½®æ–‡ä»¶</span></div><div class="line"></div><div class="line"><span class="comment"># cd /etc/openldap/</span></div><div class="line"><span class="comment"># cp slapd.conf slapd.conf.bak</span></div></pre></td></tr></table></figure><h4 id="ç¼–è¾‘LDAPä¸»é…ç½®æ–‡ä»¶-slapd-conf-æ–‡ä»¶å¦‚ä¸‹"><a href="#ç¼–è¾‘LDAPä¸»é…ç½®æ–‡ä»¶-slapd-conf-æ–‡ä»¶å¦‚ä¸‹" class="headerlink" title="ç¼–è¾‘LDAPä¸»é…ç½®æ–‡ä»¶ slapd.conf æ–‡ä»¶å¦‚ä¸‹:"></a>ç¼–è¾‘LDAPä¸»é…ç½®æ–‡ä»¶ slapd.conf æ–‡ä»¶å¦‚ä¸‹:</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div></pre></td><td class="code"><pre><div class="line">include         /etc/openldap/schema/corba.schema</div><div class="line">include         /etc/openldap/schema/core.schema</div><div class="line">include         /etc/openldap/schema/cosine.schema</div><div class="line">include         /etc/openldap/schema/duaconf.schema</div><div class="line">include         /etc/openldap/schema/dyngroup.schema</div><div class="line">include         /etc/openldap/schema/inetorgperson.schema</div><div class="line">include         /etc/openldap/schema/java.schema</div><div class="line">include         /etc/openldap/schema/misc.schema</div><div class="line">include         /etc/openldap/schema/nis.schema</div><div class="line">include         /etc/openldap/schema/openldap.schema</div><div class="line">include         /etc/openldap/schema/ppolicy.schema</div><div class="line">include         /etc/openldap/schema/collective.schema</div><div class="line"></div><div class="line"><span class="comment"># Allow LDAPv2 client connections.  This is NOT the default.</span></div><div class="line">allow bind_v2</div><div class="line">disallow bind_anon                   <span class="comment">#é˜»æ­¢åŒ¿åç™»é™†</span></div><div class="line"><span class="comment"># Do not enable referrals until AFTER you have a working directory</span></div><div class="line"><span class="comment"># service AND an understanding of referrals.</span></div><div class="line"><span class="comment">#referral       ldap://root.openldap.org</span></div><div class="line"></div><div class="line">pidfile         /var/run/openldap/slapd.pid</div><div class="line">argsfile        /var/run/openldap/slapd.args</div><div class="line"></div><div class="line"><span class="comment"># Load dynamic backend modules</span></div><div class="line"><span class="comment"># - modulepath is architecture dependent value (32/64-bit system)</span></div><div class="line"><span class="comment"># - back_sql.la overlay requires openldap-server-sql package</span></div><div class="line"><span class="comment"># - dyngroup.la and dynlist.la cannot be used at the same time</span></div><div class="line"></div><div class="line">modulepath /usr/lib/openldap</div><div class="line">modulepath /usr/lib64/openldap</div><div class="line"></div><div class="line"><span class="comment"># moduleload accesslog.la</span></div><div class="line"><span class="comment"># moduleload auditlog.la</span></div><div class="line"><span class="comment"># moduleload back_sql.la</span></div><div class="line"><span class="comment"># moduleload chain.la</span></div><div class="line"><span class="comment"># moduleload collect.la</span></div><div class="line"><span class="comment"># moduleload constraint.la</span></div><div class="line"><span class="comment"># moduleload dds.la</span></div><div class="line"><span class="comment"># moduleload deref.la</span></div><div class="line"><span class="comment"># moduleload dyngroup.la</span></div><div class="line"><span class="comment"># moduleload dynlist.la</span></div><div class="line"><span class="comment"># moduleload memberof.la</span></div><div class="line"><span class="comment"># moduleload pbind.la</span></div><div class="line"><span class="comment"># moduleload pcache.la</span></div><div class="line"><span class="comment"># moduleload ppolicy.la</span></div><div class="line"><span class="comment"># moduleload refint.la</span></div><div class="line"><span class="comment"># moduleload retcode.la</span></div><div class="line"><span class="comment"># moduleload rwm.la</span></div><div class="line"><span class="comment"># moduleload seqmod.la</span></div><div class="line"><span class="comment"># moduleload seqmod.la</span></div><div class="line"><span class="comment"># moduleload smbk5pwd.la</span></div><div class="line"><span class="comment"># moduleload sssvlv.la</span></div><div class="line">moduleload syncprov.la</div><div class="line"><span class="comment"># moduleload translucent.la</span></div><div class="line"><span class="comment"># moduleload unique.la</span></div><div class="line"><span class="comment"># moduleload valsort.la</span></div><div class="line"></div><div class="line"><span class="comment"># The next three lines allow use of TLS for encrypting connections using a</span></div><div class="line"><span class="comment"># dummy test certificate which you can generate by running</span></div><div class="line"><span class="comment"># /usr/libexec/openldap/generate-server-cert.sh. Your client software may balk</span></div><div class="line"><span class="comment"># at self-signed certificates, however.</span></div><div class="line">TLSCACertificatePath /etc/openldap/certs</div><div class="line">TLSCertificateFile <span class="string">"\"OpenLDAP Server\""</span></div><div class="line">TLSCertificateKeyFile /etc/openldap/certs/password</div><div class="line"></div><div class="line"><span class="comment"># Sample security restrictions</span></div><div class="line"><span class="comment">#       Require integrity protection (prevent hijacking)</span></div><div class="line"><span class="comment">#       Require 112-bit (3DES or better) encryption for updates</span></div><div class="line"><span class="comment">#       Require 63-bit encryption for simple bind</span></div><div class="line"><span class="comment"># security ssf=1 update_ssf=112 simple_bind=64</span></div><div class="line"></div><div class="line"><span class="comment"># Sample access control policy:</span></div><div class="line"><span class="comment">#       Root DSE: allow anyone to read it</span></div><div class="line"><span class="comment">#       Subschema (sub)entry DSE: allow anyone to read it</span></div><div class="line"><span class="comment">#       Other DSEs:</span></div><div class="line"><span class="comment">#               Allow self write access</span></div><div class="line"><span class="comment">#               Allow authenticated users read access</span></div><div class="line"><span class="comment">#               Allow anonymous users to authenticate</span></div><div class="line"><span class="comment">#       Directives needed to implement policy:</span></div><div class="line"><span class="comment"># access to dn.base="" by * read</span></div><div class="line"><span class="comment"># access to dn.base="cn=Subschema" by * read</span></div><div class="line"><span class="comment"># access to *</span></div><div class="line"><span class="comment">#       by self write</span></div><div class="line"><span class="comment">#       by users read</span></div><div class="line"><span class="comment">#       by anonymous auth</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># if no access controls are present, the default policy</span></div><div class="line"><span class="comment"># allows anyone and everyone to read anything but restricts</span></div><div class="line"><span class="comment"># updates to rootdn.  (e.g., "access to * by * read")</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># rootdn can always read and write EVERYTHING!</span></div><div class="line"></div><div class="line">access to dn.subtree=<span class="string">"ou=users,dc=jollychic,dc=com"</span></div><div class="line">       by self write</div><div class="line">       by dn=<span class="string">"cn=Manager,dc=jollychic,dc=com"</span> write</div><div class="line">       by dn=<span class="string">"cn=repl,ou=manager,dc=jollychic,dc=com"</span> write</div><div class="line">       by dn.exact=<span class="string">"cn=zabbix,ou=manager,dc=jollychic,dc=com"</span> <span class="built_in">read</span></div><div class="line">       by users <span class="built_in">read</span></div><div class="line">       by anonymous auth</div><div class="line"></div><div class="line"> access to *</div><div class="line">        by self write</div><div class="line">        by users <span class="built_in">read</span></div><div class="line">        by anonymous auth</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># enable on-the-fly configuration (cn=config)</span></div><div class="line">database config</div><div class="line">access to *</div><div class="line">        by dn.exact=<span class="string">"gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth"</span> manage</div><div class="line">        by * none</div><div class="line"></div><div class="line"><span class="comment"># enable server status monitoring (cn=monitor)</span></div><div class="line">database monitor</div><div class="line">access to *</div><div class="line">        by dn.exact=<span class="string">"gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth"</span> <span class="built_in">read</span></div><div class="line">        by dn.exact=<span class="string">"cn=Manager,dc=my-domain,dc=com"</span> <span class="built_in">read</span></div><div class="line">        by * none</div><div class="line"></div><div class="line"><span class="comment">#######################################################################</span></div><div class="line"><span class="comment"># database definitions</span></div><div class="line"><span class="comment">#######################################################################</span></div><div class="line"></div><div class="line">database        bdb</div><div class="line">suffix          <span class="string">"dc=jollychic,dc=com"</span> </div><div class="line">checkpoint      1024 15</div><div class="line">rootdn          <span class="string">"cn=Manager,dc=jollychic,dc=com"</span></div><div class="line"><span class="comment"># Cleartext passwords, especially for the rootdn, should</span></div><div class="line"><span class="comment"># be avoided.  See slappasswd(8) and slapd.conf(5) for details.</span></div><div class="line"><span class="comment"># Use of strong authentication encouraged.</span></div><div class="line"><span class="comment"># rootpw                secret</span></div><div class="line"><span class="comment"># rootpw                &#123;crypt&#125;ijFYNcSNctBYg</span></div><div class="line">rootpw          se12pa  <span class="comment">#ç®¡ç†å‘˜å¯†ç </span></div><div class="line"><span class="comment"># The database directory MUST exist prior to running slapd AND</span></div><div class="line"><span class="comment"># should only be accessible by the slapd and slap tools.</span></div><div class="line"><span class="comment"># Mode 700 recommended.</span></div><div class="line">directory       /var/lib/ldap <span class="comment">#å­˜å‚¨ç›®å½•</span></div><div class="line"></div><div class="line"><span class="comment"># Indices to maintain for this database</span></div><div class="line">index objectClass                       eq,pres</div><div class="line">index ou,cn,mail,surname,givenname      eq,pres,sub</div><div class="line">index uidNumber,gidNumber,loginShell    eq,pres</div><div class="line">index uid,memberUid                     eq,pres,sub</div><div class="line">index nisMapName,nisMapEntry            eq,pres,sub</div><div class="line">index entryCSN,entryUUID eq</div><div class="line"></div><div class="line"><span class="comment"># syncprové…ç½®</span></div><div class="line"><span class="comment">#é…ç½®æœ«å°¾æ·»åŠ å¦‚ä¸‹3è¡Œ</span></div><div class="line"><span class="comment"># #######################################################################</span></div><div class="line"><span class="comment">#åç«¯å·¥ä½œåœ¨overlayæ¨¡å¼</span></div><div class="line">overlay syncprov</div><div class="line"><span class="comment">#å½“æ»¡è¶³éœ€æ”¹100ä¸ªentryæˆ–è€…10åˆ†é’Ÿçš„æ¡ä»¶æ—¶ä¸»åŠ¨ä»¥æ¨çš„æ–¹å¼æ‰§è¡Œ</span></div><div class="line">syncprov-checkpoint 100 10</div><div class="line"><span class="comment">#ä¼šè¯æ—¥å¿—æ¡ç›®çš„æœ€å¤§æ•°é‡</span></div><div class="line">syncprov-sessionlog 100</div></pre></td></tr></table></figure><h4 id="ä¿®æ”¹ç³»ç»Ÿæ—¥å¿—é…ç½®æ–‡ä»¶"><a href="#ä¿®æ”¹ç³»ç»Ÿæ—¥å¿—é…ç½®æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹ç³»ç»Ÿæ—¥å¿—é…ç½®æ–‡ä»¶"></a>ä¿®æ”¹ç³»ç»Ÿæ—¥å¿—é…ç½®æ–‡ä»¶</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># vim /etc/rsyslog.conf</span></div><div class="line"> <span class="built_in">local</span>4.*        /var/<span class="built_in">log</span>/ldap.log</div><div class="line"><span class="comment"># local7.*ä¸‹æ·»åŠ ä¸€è¡Œ</span></div><div class="line"></div><div class="line">åœ¨å¯åŠ¨æœåŠ¡ã€‚</div><div class="line"><span class="comment"># service rsyslog restart</span></div></pre></td></tr></table></figure><h4 id="æµ‹è¯•-slapd-conf-è®¾ç½®-slaptestæ£€æµ‹ã€ç”Ÿæˆæ•°æ®åº“"><a href="#æµ‹è¯•-slapd-conf-è®¾ç½®-slaptestæ£€æµ‹ã€ç”Ÿæˆæ•°æ®åº“" class="headerlink" title="æµ‹è¯• slapd.conf è®¾ç½® slaptestæ£€æµ‹ã€ç”Ÿæˆæ•°æ®åº“"></a>æµ‹è¯• slapd.conf è®¾ç½® slaptestæ£€æµ‹ã€ç”Ÿæˆæ•°æ®åº“</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@openldap-master openldap]<span class="comment"># slaptest -u</span></div><div class="line">config file testing succeeded</div></pre></td></tr></table></figure><h4 id="OpenLDAP-çš„å¯åŠ¨ä¸åœæ­¢"><a href="#OpenLDAP-çš„å¯åŠ¨ä¸åœæ­¢" class="headerlink" title="OpenLDAP çš„å¯åŠ¨ä¸åœæ­¢"></a>OpenLDAP çš„å¯åŠ¨ä¸åœæ­¢</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># service slapd stop</span></div><div class="line"><span class="comment"># rm -rf /etc/openldap/slapd.d/*</span></div><div class="line"><span class="comment">#chown ldap.ldap /var/lib/ldap/*</span></div><div class="line"><span class="comment"># slaptest  -f /etc/openldap/slapd.conf -F /etc/openldap/slapd.d</span></div><div class="line"><span class="comment"># chown -R ldap:ldap /etc/openldap/slapd.d</span></div><div class="line"><span class="comment"># service slapd restart</span></div></pre></td></tr></table></figure><p>é…ç½®ç®¡ç†è„šæœ¬ï¼šå¯ä»¥å†™æˆè„šæœ¬</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#----------------------------------------------------</span></div><div class="line">vim ldap.sh</div><div class="line"><span class="comment">#----------------------------------------------------</span></div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line">/etc/init.d/slapd stop</div><div class="line">rm -rf /etc/openldap/slapd.d/*</div><div class="line">slaptest <span class="_">-f</span> /etc/openldap/slapd.conf -F /etc/openldap/slapd.d</div><div class="line">chown -R ldap.ldap /etc/openldap/slapd.d</div><div class="line">/etc/init.d/slapd start</div><div class="line"><span class="comment">#----------------------------------------------------</span></div></pre></td></tr></table></figure><p>è®¾ç½®å¼€æœºå¯åŠ¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@Ldap-Server ldap]<span class="comment"># chkconfig slapd on</span></div><div class="line">[root@Ldap-Server ldap]<span class="comment"># chkconfig rsyslog on</span></div></pre></td></tr></table></figure><p>é»˜è®¤ä½¿ç”¨ç«¯å£ä¸º389 é€šè¿‡sslåè®®åŠ å¯†åslapdè¿›ç¨‹ä½¿ç”¨663ç«¯å£å·</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@Ldap-Server ldap]<span class="comment"># netstat -lntup|grep 389</span></div><div class="line">tcp        0      0 0.0.0.0:389                 0.0.0.0:*                   LISTEN      25358/slapd</div><div class="line">tcp        0      0 :::389                      :::*                        LISTEN      25358/slapd</div></pre></td></tr></table></figure><p>è¿™é‡Œåˆ›å»ºå¥½ä»¥åå†å‚è€ƒç¬¬ä¸€ç¯‡åˆ›å»ºå¯¼å…¥ç‚¹æ•°æ®ï¼Œä½œä¸ºè®¾ç½®åŒæ­¥æŸ¥çœ‹æ•ˆæœã€‚</p><h3 id="ä½¿ç”¨-phpLDAPadmin"><a href="#ä½¿ç”¨-phpLDAPadmin" class="headerlink" title="ä½¿ç”¨ phpLDAPadmin"></a>ä½¿ç”¨ phpLDAPadmin</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#å®‰è£…PHP</span></div><div class="line">yum -y install php-gd php-xml php-mbstring php-ldap php-pear php-xmlrpc  php éœ€è¦PHPæ¨¡å—æ”¯æŒ</div><div class="line"></div><div class="line"><span class="comment">#å®‰è£…Apache</span></div><div class="line">yum install httpd -y</div><div class="line">vi /etc/httpd/conf/httpd.conf</div><div class="line"></div><div class="line">æ·»åŠ ï¼š</div><div class="line">....</div><div class="line">ServerName 192.168.17.145:80</div><div class="line">Listen 80</div><div class="line">.....</div><div class="line"></div><div class="line">service httpd start</div></pre></td></tr></table></figure><p>å…ˆé€šè¿‡scpä¸Šä¼ phpldapadmin-1.2.3.zipåˆ°apacheç½‘é¡µç›®å½•</p><p>ä¸‹è½½ï¼š<a href="https://sourceforge.net/projects/phpldapadmin/files/phpldapadmin-php5/1.2.3/phpldapadmin-1.2.3.tgz" target="_blank" rel="external">phpldapadmin</a></p><p>æˆ–è€…è¿™é‡Œç”¨æˆ‘ä¸‹è½½å¥½çš„é“¾æ¥wget.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#1. ä¸‹è½½å®‰è£…</span></div><div class="line">    <span class="built_in">cd</span> /var/www/html/</div><div class="line">    wget http://oak0aohum.bkt.clouddn.com/phpldapadmin-1.2.3.tgz</div><div class="line">    tar -zxvf phpldapadmin-1.2.3.tgz</div><div class="line">    mv phpldapadmin-1.2.3 phpldapadmin</div><div class="line">    <span class="built_in">cd</span> phpldapadmin/config/</div><div class="line">    cp config.php.example config.php</div><div class="line">    vim config.php</div><div class="line"></div><div class="line"><span class="comment">#2. ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼švim /var/www/html/phpldapadmin/config/config.php</span></div><div class="line">/*</div><div class="line"><span class="variable">$servers</span>-&gt;newServer(<span class="string">'ldap_pla'</span>);</div><div class="line"><span class="variable">$servers</span>-&gt;<span class="built_in">set</span>Value(<span class="string">'server'</span>,<span class="string">'name'</span>,<span class="string">'LDAP Server'</span>);</div><div class="line"><span class="variable">$servers</span>-&gt;<span class="built_in">set</span>Value(<span class="string">'server'</span>,<span class="string">'host'</span>,<span class="string">'192.168.17.145'</span>);</div><div class="line"><span class="variable">$servers</span>-&gt;<span class="built_in">set</span>Value(<span class="string">'server'</span>,<span class="string">'port'</span>,389);</div><div class="line"><span class="variable">$servers</span>-&gt;<span class="built_in">set</span>Value(<span class="string">'server'</span>,<span class="string">'base'</span>,array(<span class="string">'dc=jollychic,dc=com'</span>));</div><div class="line"><span class="variable">$servers</span>-&gt;<span class="built_in">set</span>Value(<span class="string">'login'</span>,<span class="string">'auth_type'</span>,<span class="string">'cookie'</span>);</div><div class="line"><span class="variable">$servers</span>-&gt;<span class="built_in">set</span>Value(<span class="string">'login'</span>,<span class="string">'bind_id'</span>,<span class="string">'cn=Manager,dc=jollychic,dc=com'</span>);</div><div class="line"><span class="variable">$servers</span>-&gt;<span class="built_in">set</span>Value(<span class="string">'login'</span>,<span class="string">'bind_pass'</span>,<span class="string">'&#123;SSHA&#125;SlPVguw1zrxCkTnGXLM2jZpDZio9Btyt'</span>);</div><div class="line"><span class="variable">$servers</span>-&gt;<span class="built_in">set</span>Value(<span class="string">'server'</span>,<span class="string">'tls'</span>,<span class="literal">false</span>);</div><div class="line"></div><div class="line"><span class="comment">#apache-httpä¿®æ”¹</span></div><div class="line"></div><div class="line">    vim /etc/httpd/conf/httpd.conf</div><div class="line">    &lt;Directory <span class="string">"/var/www/html/phpldapadmin"</span>&gt;</div><div class="line">    DirectoryIndex index.html index.html.var index.php</div><div class="line"><span class="comment">#é‡å¯æœåŠ¡ã€‚</span></div><div class="line"> service httpd restart</div><div class="line"></div><div class="line"><span class="comment">#é˜²ç«å¢™ç«¯å£å¼€å¯</span></div><div class="line"> -A INPUT -p tcp -m state --state NEW -m tcp --dport 80 -j ACCEPT</div><div class="line"></div><div class="line"><span class="comment">#é‡å¯iptables </span></div><div class="line">service iptables restart</div></pre></td></tr></table></figure><h4 id="ç™»å½•PHPldapadmin"><a href="#ç™»å½•PHPldapadmin" class="headerlink" title="ç™»å½•PHPldapadmin"></a>ç™»å½•PHPldapadmin</h4><p><img src="http://7xrthw.com1.z0.glb.clouddn.com/openldapsalve1.png" alt=""><br><img src="http://7xrthw.com1.z0.glb.clouddn.com/openldapsalve2.png" alt=""></p><h3 id="slave1-Centos6-6å®‰è£…OpenLDAP"><a href="#slave1-Centos6-6å®‰è£…OpenLDAP" class="headerlink" title="slave1 | Centos6.6å®‰è£…OpenLDAP"></a>slave1 | Centos6.6å®‰è£…OpenLDAP</h3><p><code>OpenLDAP slave1æœåŠ¡å™¨|  openldap-slave1 | 192.168.3.15</code></p><p>å‰é¢å®‰è£…å…¨éƒ¨ä¸€æ ·ï¼Œåªéœ€è¦åœ¨slaveé…ç½®ä¸Šé¢åšä¸‹ä¿®æ”¹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># syncprové…ç½®</span></div><div class="line"><span class="comment"># #######################################################################</span></div><div class="line">overlay syncprov</div><div class="line">syncprov-checkpoint 100 10</div><div class="line">syncprov-sessionlog 100</div><div class="line"></div><div class="line">syncrepl rid=123</div><div class="line">    provider=ldap://192.168.17.145:389</div><div class="line">    <span class="built_in">type</span>=refreshAndPersist</div><div class="line">    searchbase=<span class="string">"dc=jollychic,dc=com"</span></div><div class="line">    interval=00:00:00:10</div><div class="line">    schemachecking=off</div><div class="line">    searchbase=<span class="string">"dc=jollychic,dc=com"</span></div><div class="line">    bindmethod=simple</div><div class="line">    scope=sub</div><div class="line">    binddn=<span class="string">"cn=Manager,dc=jollychic,dc=com"</span></div><div class="line">    retry=<span class="string">"60 +"</span></div><div class="line">    attrs=<span class="string">"*,+"</span></div><div class="line">    credentials=se12pa</div><div class="line">    </div><div class="line">mirrormode on</div></pre></td></tr></table></figure><h3 id="slave2-Centos6-6å®‰è£…OpenLDAP"><a href="#slave2-Centos6-6å®‰è£…OpenLDAP" class="headerlink" title="slave2 | Centos6.6å®‰è£…OpenLDAP"></a>slave2 | Centos6.6å®‰è£…OpenLDAP</h3><p><code>OpenLDAP slave2æœåŠ¡å™¨|  openldap-slave2 | 192.168.3.82</code></p><p>åªéœ€è¦ä¿®æ”¹<code>rid=124</code> å¯ä»¥å¾€åæ·»åŠ IDæ•°å­—åŠ 1</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">syncrepl rid=124</div><div class="line">    provider=ldap://192.168.17.145:389</div><div class="line">    <span class="built_in">type</span>=refreshAndPersist</div><div class="line">    searchbase=<span class="string">"dc=jollychic,dc=com"</span></div><div class="line">    interval=00:00:00:00</div><div class="line">    schemachecking=off</div><div class="line">    searchbase=<span class="string">"dc=jollychic,dc=com"</span></div><div class="line">    bindmethod=simple</div><div class="line">    scope=sub</div><div class="line">    binddn=<span class="string">"cn=Manager,dc=jollychic,dc=com"</span></div><div class="line">    retry=<span class="string">"60 +"</span></div><div class="line">    attrs=<span class="string">"*,+"</span></div><div class="line">    credentials=se12pa</div><div class="line">    </div><div class="line">mirrormode on</div></pre></td></tr></table></figure><p>è§£é‡Šè¯´æ˜ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># syncreplç‰¹æœ‰çš„ç´¢å¼•  </span></div><div class="line">index entryCSN eq  </div><div class="line">index entryUUID eq  </div><div class="line">   </div><div class="line"><span class="comment"># syncreplå‚æ•°  </span></div><div class="line">syncrepl rid=203  </div><div class="line">provider=ldap://IPåœ°å€:ç«¯å£ <span class="comment">#æä¾›è€…çš„IPå’Œç«¯å£å·  provideré¡¹å¡«å†™ä¸»æœåŠ¡å™¨çš„ldapåœ°å€</span></div><div class="line">bindmethod=simple <span class="comment">#è®¤è¯æ–¹å¼ï¼Œé»˜è®¤é€‰æ‹©ç®€å•è®¤è¯  </span></div><div class="line">interval=00:00:00:00 <span class="comment">#åŒæ­¥æ—¶é—´é—´éš” å¤©ï¼šå°æ—¶ï¼šåˆ†é’Ÿï¼šç§’  intervalè¡¨ç¤ºä»æœåŠ¡å™¨å¤šä¹…è·Ÿä¸»æœåŠ¡å™¨è¿›è¡Œä¸€æ¬¡æ•°æ®åŒæ­¥</span></div><div class="line">binddn=<span class="string">"cn=Manager,dc=jollychic,dc=com"</span> <span class="comment">#ç™»é™†çš„ldapè´¦å·  </span></div><div class="line">credentials=ç™»é™†å¯†ç   </div><div class="line">searchbase=<span class="string">"dc=jollychic,dc=com"</span> <span class="comment">#åŒæ­¥çš„æ ¹è·¯å¾„  </span></div><div class="line">filter=<span class="string">"(objectClass=*)"</span>  </div><div class="line">scope=sub  </div><div class="line">attrs=<span class="string">"*,+"</span>  </div><div class="line"><span class="built_in">type</span>=refreshAndPersist <span class="comment">#åŒæ­¥æ–¹å¼ï¼šæœ‰refreshAndPersistå’Œ  </span></div><div class="line">retry=<span class="string">"60 10 600 +"</span>  <span class="comment"># retryè¡¨ç¤ºå¤±è´¥é‡è¯•ç­–ç•¥</span></div></pre></td></tr></table></figure><h3 id="PS-åœ¨phpldapadminæ·»åŠ ä»LDAPæœåŠ¡å™¨ã€ä¾¿äºç®¡ç†"><a href="#PS-åœ¨phpldapadminæ·»åŠ ä»LDAPæœåŠ¡å™¨ã€ä¾¿äºç®¡ç†" class="headerlink" title="PS:åœ¨phpldapadminæ·»åŠ ä»LDAPæœåŠ¡å™¨ã€ä¾¿äºç®¡ç†"></a>PS:åœ¨phpldapadminæ·»åŠ ä»LDAPæœåŠ¡å™¨ã€ä¾¿äºç®¡ç†</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">/* A convenient name that will appear <span class="keyword">in</span> the tree viewer and throughout</div><div class="line">   phpLDAPadmin to identify this LDAP server to users. */</div><div class="line"><span class="variable">$servers</span>-&gt;<span class="built_in">set</span>Value(<span class="string">'server'</span>,<span class="string">'name'</span>,<span class="string">'My LDAP Server'</span>);</div><div class="line"></div><div class="line"><span class="variable">$servers</span>-&gt;newServer(<span class="string">'ldap_pla'</span>);</div><div class="line"><span class="variable">$servers</span>-&gt;<span class="built_in">set</span>Value(<span class="string">'server'</span>,<span class="string">'name'</span>,<span class="string">'192.168.3.15:389'</span>);</div><div class="line"><span class="variable">$servers</span>-&gt;<span class="built_in">set</span>Value(<span class="string">'server'</span>,<span class="string">'host'</span>,<span class="string">'192.168.3.15'</span>);</div><div class="line"><span class="variable">$servers</span>-&gt;<span class="built_in">set</span>Value(<span class="string">'server'</span>,<span class="string">'port'</span>,<span class="string">'389'</span>);</div><div class="line"></div><div class="line"><span class="variable">$servers</span>-&gt;newServer(<span class="string">'ldap_pla'</span>);</div><div class="line"><span class="variable">$servers</span>-&gt;<span class="built_in">set</span>Value(<span class="string">'server'</span>,<span class="string">'name'</span>,<span class="string">'192.168.3.82:389'</span>);</div><div class="line"><span class="variable">$servers</span>-&gt;<span class="built_in">set</span>Value(<span class="string">'server'</span>,<span class="string">'host'</span>,<span class="string">'192.168.3.82'</span>);</div><div class="line"><span class="variable">$servers</span>-&gt;<span class="built_in">set</span>Value(<span class="string">'server'</span>,<span class="string">'port'</span>,<span class="string">'389'</span>);</div></pre></td></tr></table></figure><h3 id="ç™»å½•æµ‹è¯•æ•°æ®æ˜¯å¦åŒæ­¥ï¼š"><a href="#ç™»å½•æµ‹è¯•æ•°æ®æ˜¯å¦åŒæ­¥ï¼š" class="headerlink" title="ç™»å½•æµ‹è¯•æ•°æ®æ˜¯å¦åŒæ­¥ï¼š"></a>ç™»å½•æµ‹è¯•æ•°æ®æ˜¯å¦åŒæ­¥ï¼š</h3><p><img src="http://7xrthw.com1.z0.glb.clouddn.com/openldapsalve3.png" alt=""></p><h3 id="slave1-æ•°æ®åŒæ­¥æˆåŠŸå›¾ï¼š"><a href="#slave1-æ•°æ®åŒæ­¥æˆåŠŸå›¾ï¼š" class="headerlink" title="slave1 æ•°æ®åŒæ­¥æˆåŠŸå›¾ï¼š"></a>slave1 æ•°æ®åŒæ­¥æˆåŠŸå›¾ï¼š</h3><p><img src="http://7xrthw.com1.z0.glb.clouddn.com/openldapsalve4.png" alt=""></p><h3 id="slave2-æ•°æ®åŒæ­¥æˆåŠŸå›¾ï¼š"><a href="#slave2-æ•°æ®åŒæ­¥æˆåŠŸå›¾ï¼š" class="headerlink" title="slave2 æ•°æ®åŒæ­¥æˆåŠŸå›¾ï¼š"></a>slave2 æ•°æ®åŒæ­¥æˆåŠŸå›¾ï¼š</h3><p><img src="http://7xrthw.com1.z0.glb.clouddn.com/openldapsalve5.png" alt=""></p><p>é‡åˆ°æ•…éšœé—®é¢˜ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[root@ldap-master ~]<span class="comment"># ldapsearch -x -LLL</span></div><div class="line">No such object (32)</div><div class="line"></div><div class="line">æ‰“å¼€å¹¶ä¿®æ”¹ä¸ºå¦‚ä¸‹ä¸¤è¡Œå³å¯</div><div class="line">vim /etc/openldap/ldap.conf</div><div class="line"><span class="comment">#-----------------------------------------------------------------</span></div><div class="line">BASE dc=jollychic,dc=com</div><div class="line">URI ldap://192.168.17.145</div><div class="line"><span class="comment">#-----------------------------------------------------------------</span></div></pre></td></tr></table></figure><p>æµ‹è¯•ç»“æœï¼Œä¸»ä»é…ç½®æˆåŠŸã€‚</p><p>è¡¥å……ï¼šç”±äºåœ¨syncreplä¸­slaveæ˜¯refreshOnlyï¼Œç›¸å½“äºä»èŠ‚ç‚¹æ˜¯åªè¯»çš„ï¼Œè¿™æ—¶ä¸å…è®¸åœ¨ä»èŠ‚ç‚¹å¯¼å…¥æˆ–è€…åˆ é™¤ç”¨æˆ·ï¼Œå¦åˆ™ä¼šå‡ºç°é”™è¯¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@LDAP openldap]<span class="comment"># ldapadd -x -D "cn=Manager,dc=jollychic,dc=com" -W -f /tmp/jolly.ldif</span></div><div class="line">Enter LDAP Password:</div><div class="line">adding new entry <span class="string">"dc=jollychic,dc=com"</span></div><div class="line">ldap_add: Server is unwilling to perform (53)</div><div class="line">additional info: shadow context; no update referral</div></pre></td></tr></table></figure><p>å‚è€ƒï¼š<a href="https://itsecureadmin.com/2013/01/ldapmodify-fails-with-server-is-unwilling-to-perform-53/" target="_blank" rel="external">https://itsecureadmin.com/2013/01/ldapmodify-fails-with-server-is-unwilling-to-perform-53/</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;OpenLDAPä¸»ä»å¤åˆ¶èŠ‚ç‚¹é…ç½®çº¿ä¸Šç‰ˆæœ¬&quot;&gt;&lt;a href=&quot;#OpenLDAPä¸»ä»å¤åˆ¶èŠ‚ç‚¹é…ç½®çº¿ä¸Šç‰ˆæœ¬&quot; class=&quot;headerlink&quot; title=&quot;OpenLDAPä¸»ä»å¤åˆ¶èŠ‚ç‚¹é…ç½®çº¿ä¸Šç‰ˆæœ¬&quot;&gt;&lt;/a&gt;OpenLDAPä¸»ä»å¤åˆ¶èŠ‚ç‚¹é…ç½®çº¿ä¸Šç‰ˆæœ¬&lt;/h4&gt;&lt;p&gt;å…¬å¸æœåŠ¡å™¨ä¸Šæ­å»ºäº†ä¸€ä¸ªOpenLDAPæœåŠ¡ï¼Œä¸ºäº†é¿å…å‡ºç°å•ç‚¹ï¼Œéœ€è¦ç»™LDAPåšä¸»ä»è¦ä»å›½å¤–ä»æœåŠ¡å™¨å®æ—¶åŒæ­¥ã€‚è¿™é‡Œæˆ‘ä¹Ÿå‡çº§äº†Openldap é…ç½®ä¸€ä¸»å¤šä»æ–¹æ³•ã€‚&lt;br&gt;äºæ˜¯ä¸Šopenldapå®˜ç½‘ä¸ŠæŸ¥äº†ä¸€ä¸‹openldapçš„å¤åˆ¶åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://devopsideas.com/wp-content/uploads/2017/09/Openldap-7-800x445.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="OpenLDAP" scheme="http://blog.yancy.cc/categories/OpenLDAP/"/>
    
    
      <category term="OpenLDAP" scheme="http://blog.yancy.cc/tags/OpenLDAP/"/>
    
  </entry>
  
  <entry>
    <title>Zabbix-Monitoring Kafkaé›†ç¾¤ Consumer | kafkaçš„ç›‘æ§å’Œå‘Šè­¦</title>
    <link href="http://blog.yancy.cc/2017/06/05/Bigdata-hadoop/Kafka/Zabbix-Monitoring%20Kafka%20Consumer%20%7C%20kafka%E7%9A%84%E7%9B%91%E6%8E%A7%E5%92%8C%E5%91%8A%E8%AD%A6/"/>
    <id>http://blog.yancy.cc/2017/06/05/Bigdata-hadoop/Kafka/Zabbix-Monitoring Kafka Consumer | kafkaçš„ç›‘æ§å’Œå‘Šè­¦/</id>
    <published>2017-06-05T09:56:03.000Z</published>
    <updated>2017-09-23T17:03:04.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://7xrthw.com1.z0.glb.clouddn.com/Zabbix-Monitoring-Kafka.png" alt=""></p><h3 id="Zabbix-Monitoring-Kafkaé›†ç¾¤-Consumer-kafkaçš„ç›‘æ§å’Œå‘Šè­¦"><a href="#Zabbix-Monitoring-Kafkaé›†ç¾¤-Consumer-kafkaçš„ç›‘æ§å’Œå‘Šè­¦" class="headerlink" title="Zabbix-Monitoring Kafkaé›†ç¾¤ Consumer | kafkaçš„ç›‘æ§å’Œå‘Šè­¦"></a>Zabbix-Monitoring Kafkaé›†ç¾¤ Consumer | kafkaçš„ç›‘æ§å’Œå‘Šè­¦</h3><p>å‰é¢ä¸€ç¯‡è®²äº†æˆ‘ä»¬ç›‘æ§kafkaé›†ç¾¤BrokersæœåŠ¡çŠ¶æ€ç›‘æ§ã€‚ç”Ÿäº§ç¯å¢ƒç›‘æ§ï¼Œå¯ä»¥åœ¨Zabbixä¸­å¯¹Kafkaè¿›è¡Œç›‘æ§ï¼Œä¸€ç§æ˜¯ç›‘æ§JMXç«¯å£ï¼Œå¦å¤–ä¸€ç§æ˜¯ç›´æ¥å†™è„šæœ¬ï¼Œä½¿ç”¨bin/kafka-run-class.shé‡Œæä¾›çš„ç›¸å…³æ–¹æ³•ç±»ã€‚</p><p>æ ¹æ®æˆ‘ä»¬çš„ä¸šåŠ¡åœºæ™¯ï¼Œæœ€ä¸ºä¸»è¦çš„çš„æ˜¯ç›‘æ§æ¶ˆè´¹è€…Lagçš„æƒ…å†µã€‚æ‰€æœ‰æˆ‘ç›´æ¥å†™è„šæœ¬äº†ã€‚<br>æˆ‘ä»¬å¯¹æŸä¸€ä¸ªTopicçš„30ä¸ªåˆ†åŒºï¼Œæ¯ä¸ªåˆ†åŒºï¼Œå½“å‰Consumerçš„Lagæƒ…å†µã€‚<br>å½“ç„¶è¿˜å¯ä»¥ç”Ÿæˆæ±‡æ€»å›¾ï¼Œåœ¨æ­¤ä¸åšå¤šå±•ç¤ºã€‚åœ¨Zabbixä¸­é…ç½®å¯¹åº”çš„Triggersï¼Œå½“Lagè¶…è¿‡é˜€å€¼ï¼Œå®ç°æŠ¥è­¦ã€‚</p><a id="more"></a><p>è¿™é‡Œæˆ‘ç”¨å‘½ä»¤åœ¨kafkaå½“ä¸­ä¸€å°æœåŠ¡å™¨è·å–äº†å…¶ä¸­ä¸€ä¸ªTopic groupçš„Lagã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">[jollybi@countly2 kafka_2.10]$ </div><div class="line">bin/kafka-run-class.sh kafka.tools.ConsumerOffsetChecker --zookeeper 75.126.39.4:2281,75.126.5.2:2281,75.126.5.1:2281 --group group_zybi --topic mongotail_lz4  </div><div class="line">æ¶ˆè´¹ç»„           è¯é¢˜id                        åˆ†åŒºID å½“å‰å·²æ¶ˆè´¹çš„æ¡æ•°   æ€»æ¡æ•°         æœªæ¶ˆè´¹çš„            </div><div class="line">Group           Topic                          Pid Offset          <span class="built_in">log</span>Size         Lag             Owner</div><div class="line">group_zybi      mongotail_lz4                  0   1092163900      2253744158      1161580258      none</div><div class="line">group_zybi      mongotail_lz4                  1   1092281117      2253795899      1161514782      none</div><div class="line">group_zybi      mongotail_lz4                  2   1092834883      2253771036      1160936153      none</div><div class="line">group_zybi      mongotail_lz4                  3   1092822121      2253772916      1160950795      none</div><div class="line">group_zybi      mongotail_lz4                  4   1092040532      2253775432      1161734900      none</div><div class="line">group_zybi      mongotail_lz4                  5   1095163824      2253744329      1158580505      none</div><div class="line">group_zybi      mongotail_lz4                  6   1097623779      2253781500      1156157721      none</div><div class="line">group_zybi      mongotail_lz4                  7   1097459357      2253782032      1156322675      none</div><div class="line">group_zybi      mongotail_lz4                  8   1099080546      2253741287      1154660741      none</div><div class="line">group_zybi      mongotail_lz4                  9   1099028190      2253785053      1154756863      none</div><div class="line">group_zybi      mongotail_lz4                  10  1099535928      2253795680      1154259752      none</div><div class="line">group_zybi      mongotail_lz4                  11  1099701993      2253742880      1154040887      none</div></pre></td></tr></table></figure><p>å…¶å®å‘½ä»¤å¤§ä½“çš„é€»è¾‘å°±æ˜¯é€šè¿‡Consumerè·å–åˆ°å½“å‰çš„offsetï¼Œå°±èƒ½æœ‰lagä¿¡æ¯äº†ï¼Œå¦‚ä½•å†™æˆè„šæœ¬è·å–æˆ‘ä»¬æƒ³è¦çš„æ¶ˆè´¹å’Œæœªæ¶ˆè´¹ä¸æ€»æ¶ˆæ¯æ¡æ•°å‘¢ã€‚</p><p>è„šæœ¬è´´å‡ºæ¥äº†ï¼Œå¾ˆç®€å•ç†è§£ï¼ŒæŠŠè‡ªå·±è·å–åˆ°topicçš„æ¶ˆè´¹æ¡æ•°è¿‡æ»¤ã€‚æˆ‘å…¬å¸æœ‰ä¸¤ä¸ªä¸»é¢˜topicåˆ†åˆ«å¯¹ä¸åŒç»„è·å–lag.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line">[root@countly2 zabbix]<span class="comment"># vim monitor_kafka.sh</span></div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"></div><div class="line"><span class="built_in">export</span> JAVA_HOME=/home/jollybi/tools/java-7-sun</div><div class="line"><span class="built_in">export</span> CLASSPATH=<span class="variable">$CLASSPATH</span>:.:<span class="variable">$JAVA_HOME</span>/lib:<span class="variable">$JAVA_HOME</span>/jre/lib</div><div class="line"><span class="built_in">export</span> PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$JAVA_HOME</span>/jre/bin:<span class="variable">$PATH</span></div><div class="line">topic=mongotail_lz4_imp</div><div class="line">group=group_imp</div><div class="line"></div><div class="line"><span class="comment">#topic2</span></div><div class="line"></div><div class="line">topic2=mongotail_lz4</div><div class="line">group2=group_event</div><div class="line">group3=group_event_spm</div><div class="line"></div><div class="line"><span class="comment">#å¯åŠ¨ç›®å½•</span></div><div class="line">kafkaserver=/home/jollybi/tools/kafka_2.10-0.8.2.1/bin/kafka-run-class.sh</div><div class="line">zk=75.126.39.4:2281,75.126.5.2:2281,75.126.5.8:2281</div><div class="line"></div><div class="line"><span class="keyword">function</span> imp_lag &#123;</div><div class="line"><span class="built_in">echo</span> <span class="string">"`<span class="variable">$kafkaserver</span> kafka.tools.ConsumerOffsetChecker --zookeeper <span class="variable">$zk</span> --group <span class="variable">$group</span>  --topic <span class="variable">$topic</span>  | sed -n 2p | awk '&#123;print <span class="variable">$6</span>&#125;'`"</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">function</span> imp_logsize &#123;</div><div class="line"><span class="built_in">echo</span> <span class="string">"`<span class="variable">$kafkaserver</span> kafka.tools.ConsumerOffsetChecker --zookeeper <span class="variable">$zk</span> --group <span class="variable">$group</span>  --topic <span class="variable">$topic</span>  | sed -n 2p | awk '&#123;print <span class="variable">$5</span>&#125;'`"</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">function</span> imp_offset &#123;</div><div class="line"><span class="built_in">echo</span> <span class="string">"`<span class="variable">$kafkaserver</span> kafka.tools.ConsumerOffsetChecker --zookeeper <span class="variable">$zk</span> --group <span class="variable">$group</span>  --topic <span class="variable">$topic</span>  | sed -n 2p | awk '&#123;print <span class="variable">$4</span>&#125;'`"</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">function</span> event_spm_lag &#123;</div><div class="line"><span class="built_in">echo</span> <span class="string">"`<span class="variable">$kafkaserver</span> kafka.tools.ConsumerOffsetChecker --zookeeper <span class="variable">$zk</span> --group <span class="variable">$group2</span>  --topic <span class="variable">$topic2</span>  | sed -n 2p | awk '&#123;print <span class="variable">$6</span>&#125;'`"</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">function</span> event_spm_logsize &#123;</div><div class="line"><span class="built_in">echo</span> <span class="string">"`<span class="variable">$kafkaserver</span> kafka.tools.ConsumerOffsetChecker --zookeeper <span class="variable">$zk</span> --group <span class="variable">$group2</span>  --topic <span class="variable">$topic2</span>  | sed -n 2p | awk '&#123;print <span class="variable">$5</span>&#125;'`"</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">function</span> event_spm_offset &#123;</div><div class="line"><span class="built_in">echo</span> <span class="string">"`<span class="variable">$kafkaserver</span> kafka.tools.ConsumerOffsetChecker --zookeeper <span class="variable">$zk</span> --group <span class="variable">$group2</span>  --topic <span class="variable">$topic2</span>  | sed -n 2p | awk '&#123;print <span class="variable">$4</span>&#125;'`"</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">function</span> event_lag &#123;</div><div class="line"><span class="built_in">echo</span> <span class="string">"`<span class="variable">$kafkaserver</span> kafka.tools.ConsumerOffsetChecker --zookeeper <span class="variable">$zk</span> --group <span class="variable">$group3</span>  --topic <span class="variable">$topic2</span>  | sed -n 2p | awk '&#123;print <span class="variable">$6</span>&#125;'`"</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">function</span> event_logsize &#123;</div><div class="line"><span class="built_in">echo</span> <span class="string">"`<span class="variable">$kafkaserver</span> kafka.tools.ConsumerOffsetChecker --zookeeper <span class="variable">$zk</span> --group <span class="variable">$group3</span>  --topic <span class="variable">$topic2</span>  | sed -n 2p | awk '&#123;print <span class="variable">$5</span>&#125;'`"</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">function</span> event_offset &#123;</div><div class="line"><span class="built_in">echo</span> <span class="string">"`<span class="variable">$kafkaserver</span> kafka.tools.ConsumerOffsetChecker --zookeeper <span class="variable">$zk</span> --group <span class="variable">$group3</span>  --topic <span class="variable">$topic2</span>  | sed -n 2p | awk '&#123;print <span class="variable">$4</span>&#125;'`"</span></div><div class="line">&#125;</div><div class="line"><span class="comment"># Run the requested function</span></div><div class="line"><span class="variable">$1</span></div></pre></td></tr></table></figure><p>â° <strong>è¿™é‡Œè„šæœ¬æˆ‘æ›´æ–°è¿‡äº†ï¼Œè¿™ä¸ªè„šæœ¬å®ç°æ˜¯å½“ä¸ªåˆ†ç‰‡çš„æ¶ˆè´¹æƒ…å†µã€‚ ä¸æ˜¯æ€»çš„æ¶ˆè´¹å’Œæœªæ¶ˆè´¹çš„å–åˆ°çš„å€¼ã€‚</strong><br>ğŸ‹ éœ€è¦åŸè„šæœ¬çš„ç•™è¨€å–”ï¼Œä¸‹é¢æ­¥éª¤éƒ½æ˜¯ä¸€æ ·çš„æ•ˆæœã€‚</p><h4 id="è„šæœ¬æ”¾åˆ°kafkaæœåŠ¡å™¨-etc-zabbix-ä¸‹é¢ï¼Œå¹¶é…åˆzabbixç›‘æ§ã€‚"><a href="#è„šæœ¬æ”¾åˆ°kafkaæœåŠ¡å™¨-etc-zabbix-ä¸‹é¢ï¼Œå¹¶é…åˆzabbixç›‘æ§ã€‚" class="headerlink" title="è„šæœ¬æ”¾åˆ°kafkaæœåŠ¡å™¨/etc/zabbix/ä¸‹é¢ï¼Œå¹¶é…åˆzabbixç›‘æ§ã€‚"></a>è„šæœ¬æ”¾åˆ°kafkaæœåŠ¡å™¨/etc/zabbix/ä¸‹é¢ï¼Œå¹¶é…åˆzabbixç›‘æ§ã€‚</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@countly2 zabbix]<span class="comment"># ll</span></div><div class="line">total 8</div><div class="line">-rwxrwxr-x 1 jollybi jollybi 1932 Jun  7 10:40 monitor_kafka.sh</div><div class="line">-rw-r--r-- 1 root    root     218 Jun  7 14:19 zabbix_agentd.conf</div><div class="line">drwxr-xr-x 2 root    root      45 Sep 20  2016 zabbix_agentd.d</div></pre></td></tr></table></figure><h4 id="ç„¶åzabbix-agentd-confæ‰©å±•é…ç½®"><a href="#ç„¶åzabbix-agentd-confæ‰©å±•é…ç½®" class="headerlink" title="ç„¶åzabbix_agentd.confæ‰©å±•é…ç½®"></a>ç„¶åzabbix_agentd.confæ‰©å±•é…ç½®</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">UserParameter=kafka.[*],/etc/zabbix/monitor_kafka.sh <span class="variable">$1</span></div></pre></td></tr></table></figure><blockquote><p>ä¹Ÿå¯ä»¥è¿™ä¹ˆå†™ï¼š</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">UserParameter=kafka.imp_lag,/etc/zabbix/monitor_kafka.sh imp_lag</div><div class="line">UserParameter=kafka.imp_offset,/etc/zabbix/monitor_kafka.sh imp_offset</div><div class="line">UserParameter=kafka.imp_logsize,/etc/zabbix/monitor_kafka.sh imp_logsize</div><div class="line">UserParameter=kafka.event_spm_lag,/etc/zabbix/monitor_kafka.sh event_spm_lag</div><div class="line">UserParameter=kafka.event_spm_logsize,/etc/zabbix/monitor_kafka.sh event_spm_logsize</div><div class="line">UserParameter=kafka.event_spm_offset,/etc/zabbix/monitor_kafka.sh event_spm_offset </div><div class="line">UserParameter=kafka.event_lag,/etc/zabbix/monitor_kafka.sh event_lag</div><div class="line">UserParameter=kafka.event_offset,/etc/zabbix/monitor_kafka.sh event_offset</div><div class="line">UserParameter=kafka.event_logsize,/etc/zabbix/monitor_kafka.sh event_logsize</div></pre></td></tr></table></figure><p>è¿™é‡Œå†™é”®å€¼å°±ä¸éœ€è¦åŠ []</p><p>ç„¶åé…ç½®å®Œæˆé‡å¯zabbix-agentæœåŠ¡ã€‚</p><h4 id="zabbixè®¾ç½®Key"><a href="#zabbixè®¾ç½®Key" class="headerlink" title="zabbixè®¾ç½®Key"></a>zabbixè®¾ç½®Key</h4><p>zabbix-ç»„æ€-æ¨¡æ¿-åˆ›å»ºæ¨¡æ¿ã€‚</p><p>åˆ›å»ºï¼šKafkaConsumersæ¨¡æ¿<br>ç„¶åç‚¹å‡»KafkaConsumersæ¨¡æ¿ï¼Œåˆ›å»ºç›¸åº”çš„é¡¹ç›®:kafka.event_lag æœªæ¶ˆè´¹çš„æ¡æ•° </p><p>è®¾ç½®zabbixä»£ç†ã€‚é»˜è®¤çš„ä»£ç†æ–¹å¼ã€‚</p><p>zabbix,key é”®å€¼</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kafka.[event_lag]</div></pre></td></tr></table></figure><p>æ•°æ®ç±»å‹é»˜è®¤æµ®ç‚¹å°±å¯ä»¥äº†ã€‚ åé¢åº”ç”¨é›†é€‰æ‹©ä¸‹KafkaConsumers å³å¯ã€‚</p><p><img src="http://7xrthw.com1.z0.glb.clouddn.com/kafka-Consumer.01.png" alt=""><br>é™†é™†ç»­ç»­é…ç½®å®Œæ‰€æœ‰é¡¹ç›®ã€‚</p><h3 id="ç„¶åé…ç½®å›¾å½¢ã€‚"><a href="#ç„¶åé…ç½®å›¾å½¢ã€‚" class="headerlink" title="ç„¶åé…ç½®å›¾å½¢ã€‚"></a>ç„¶åé…ç½®å›¾å½¢ã€‚</h3><p><img src="http://7xrthw.com1.z0.glb.clouddn.com/kafka-Consumer.02.png" alt=""></p><p><img src="http://7xrthw.com1.z0.glb.clouddn.com/kafka-Consumer.04.png" alt=""></p><p><img src="http://7xrthw.com1.z0.glb.clouddn.com/kafka-Consumer.05.png" alt=""></p><h3 id="æŸ¥çœ‹æœ€æ–°æ•°æ®å›¾ï¼š"><a href="#æŸ¥çœ‹æœ€æ–°æ•°æ®å›¾ï¼š" class="headerlink" title="æŸ¥çœ‹æœ€æ–°æ•°æ®å›¾ï¼š"></a>æŸ¥çœ‹æœ€æ–°æ•°æ®å›¾ï¼š</h3><p><img src="http://7xrthw.com1.z0.glb.clouddn.com/kafka-Consumer.06.png" alt=""><br><img src="http://7xrthw.com1.z0.glb.clouddn.com/kafka-Consumer.07.png" alt=""></p><p>å‡ºç°é—®é¢˜ç¬¬ä¸€æ—¶é—´å‘é€æŠ¥è­¦æ¶ˆæ¯ã€‚<br>æŠ¥è­¦çš„Triggerè§¦å‘è§„åˆ™ä¹Ÿæ˜¯å¯¹lagçš„å€¼åšæŠ¥è­¦ï¼Œå…·ä½“é˜€å€¼è®¾ç½®ä¸ºå¤šå°‘ï¼Œè¿˜æ˜¯çœ‹å¤§å®¶å„è‡ªä¸šåŠ¡éœ€æ±‚äº†ã€‚</p><h3 id="è¿™é‡Œæˆ‘å¯¹æœªæ¶ˆè´¹å‘Šè­¦å®šæ—¶60åˆ†é’Ÿè§¦å‘ä¸€æ¬¡ã€‚"><a href="#è¿™é‡Œæˆ‘å¯¹æœªæ¶ˆè´¹å‘Šè­¦å®šæ—¶60åˆ†é’Ÿè§¦å‘ä¸€æ¬¡ã€‚" class="headerlink" title="è¿™é‡Œæˆ‘å¯¹æœªæ¶ˆè´¹å‘Šè­¦å®šæ—¶60åˆ†é’Ÿè§¦å‘ä¸€æ¬¡ã€‚"></a>è¿™é‡Œæˆ‘å¯¹æœªæ¶ˆè´¹å‘Šè­¦å®šæ—¶60åˆ†é’Ÿè§¦å‘ä¸€æ¬¡ã€‚</h3><p>âš ï¸æ³¨é‡Šï¼šè®¾ç½®group_event_lagæœ€è¿‘æ¶ˆæ¯æ¡æ•°çš„60åˆ†é’Ÿæ—¶é—´ä¹‹å†…ä¸€ç›´è¶…è¿‡200ä¸‡æ¶ˆè´¹åˆ™æŠ¥è­¦</p><p><img src="http://7xrthw.com1.z0.glb.clouddn.com/kafka-Consumer.08.png" alt=""><br><img src="http://7xrthw.com1.z0.glb.clouddn.com/kafka-Consumer.09.png" alt=""></p><p><img src="http://7xrthw.com1.z0.glb.clouddn.com/kafka-Consumer.10.png" alt=""></p><h3 id="äº¤æµå­¦ä¹ ï¼š"><a href="#äº¤æµå­¦ä¹ ï¼š" class="headerlink" title="äº¤æµå­¦ä¹ ï¼š"></a>äº¤æµå­¦ä¹ ï¼š</h3><p>ğŸ§  Linux shell_é«˜çº§è¿ç»´æ´¾: <code>459096184</code>    åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)<br>ğŸ§  BigData-Exchange School : <code>521621407</code>  åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥</p><p>ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/Zabbix-Monitoring-Kafka.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;Zabbix-Monitoring-Kafkaé›†ç¾¤-Consumer-kafkaçš„ç›‘æ§å’Œå‘Šè­¦&quot;&gt;&lt;a href=&quot;#Zabbix-Monitoring-Kafkaé›†ç¾¤-Consumer-kafkaçš„ç›‘æ§å’Œå‘Šè­¦&quot; class=&quot;headerlink&quot; title=&quot;Zabbix-Monitoring Kafkaé›†ç¾¤ Consumer | kafkaçš„ç›‘æ§å’Œå‘Šè­¦&quot;&gt;&lt;/a&gt;Zabbix-Monitoring Kafkaé›†ç¾¤ Consumer | kafkaçš„ç›‘æ§å’Œå‘Šè­¦&lt;/h3&gt;&lt;p&gt;å‰é¢ä¸€ç¯‡è®²äº†æˆ‘ä»¬ç›‘æ§kafkaé›†ç¾¤BrokersæœåŠ¡çŠ¶æ€ç›‘æ§ã€‚ç”Ÿäº§ç¯å¢ƒç›‘æ§ï¼Œå¯ä»¥åœ¨Zabbixä¸­å¯¹Kafkaè¿›è¡Œç›‘æ§ï¼Œä¸€ç§æ˜¯ç›‘æ§JMXç«¯å£ï¼Œå¦å¤–ä¸€ç§æ˜¯ç›´æ¥å†™è„šæœ¬ï¼Œä½¿ç”¨bin/kafka-run-class.shé‡Œæä¾›çš„ç›¸å…³æ–¹æ³•ç±»ã€‚&lt;/p&gt;
&lt;p&gt;æ ¹æ®æˆ‘ä»¬çš„ä¸šåŠ¡åœºæ™¯ï¼Œæœ€ä¸ºä¸»è¦çš„çš„æ˜¯ç›‘æ§æ¶ˆè´¹è€…Lagçš„æƒ…å†µã€‚æ‰€æœ‰æˆ‘ç›´æ¥å†™è„šæœ¬äº†ã€‚&lt;br&gt;æˆ‘ä»¬å¯¹æŸä¸€ä¸ªTopicçš„30ä¸ªåˆ†åŒºï¼Œæ¯ä¸ªåˆ†åŒºï¼Œå½“å‰Consumerçš„Lagæƒ…å†µã€‚&lt;br&gt;å½“ç„¶è¿˜å¯ä»¥ç”Ÿæˆæ±‡æ€»å›¾ï¼Œåœ¨æ­¤ä¸åšå¤šå±•ç¤ºã€‚åœ¨Zabbixä¸­é…ç½®å¯¹åº”çš„Triggersï¼Œå½“Lagè¶…è¿‡é˜€å€¼ï¼Œå®ç°æŠ¥è­¦ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Kafka" scheme="http://blog.yancy.cc/categories/Kafka/"/>
    
    
      <category term="Kafka" scheme="http://blog.yancy.cc/tags/Kafka/"/>
    
      <category term="Zabbix" scheme="http://blog.yancy.cc/tags/Zabbix/"/>
    
  </entry>
  
  <entry>
    <title>Zabbixç›‘æ§Kafkaé›†ç¾¤ BrokersæœåŠ¡</title>
    <link href="http://blog.yancy.cc/2017/06/01/Bigdata-hadoop/Kafka/Zabbix%E7%9B%91%E6%8E%A7Kafka%E9%9B%86%E7%BE%A4%20Brokers%E6%9C%8D%E5%8A%A1/"/>
    <id>http://blog.yancy.cc/2017/06/01/Bigdata-hadoop/Kafka/Zabbixç›‘æ§Kafkaé›†ç¾¤ BrokersæœåŠ¡/</id>
    <published>2017-06-01T09:56:03.000Z</published>
    <updated>2017-10-15T13:34:04.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Zabbixç›‘æ§Kafkaé›†ç¾¤-BrokersæœåŠ¡"><a href="#Zabbixç›‘æ§Kafkaé›†ç¾¤-BrokersæœåŠ¡" class="headerlink" title="Zabbixç›‘æ§Kafkaé›†ç¾¤ BrokersæœåŠ¡"></a>Zabbixç›‘æ§Kafkaé›†ç¾¤ BrokersæœåŠ¡</h3><p><img src="http://7xrthw.com1.z0.glb.clouddn.com/kafka-datadog.png" alt=""></p><h4 id="å‰è¨€ï¼š"><a href="#å‰è¨€ï¼š" class="headerlink" title="å‰è¨€ï¼š"></a>å‰è¨€ï¼š</h4><p>Monitoring Kafka with Datadog</p><p>This post is the final part of a 3-part series on how to monitor Kafka. Part 1 explores the key metrics available from Kafka, and Part 2 is about collecting those metrics on an ad hoc basis.</p><p>To implement ongoing, meaningful monitoring, you will need a dedicated system that allows you to store, visualize, and correlate your Kafka metrics with the rest of your infrastructure.</p><p>Kafka deployments often rely on additional software packages not included in the Kafka codebase itself, in particular Apache ZooKeeper. A comprehensive monitoring implementation includes all the layers of your deployment, including host-level metrics when appropriate, and not just the metrics emitted by Kafka itself.</p><a id="more"></a><p>æˆ‘åœ¨å¤„ç†HadoopåŠç›¸å…³æœåŠ¡ç›‘æ§ã€æŠ¥è­¦è¿™é‡Œä¸»è¦è®²kafkaé›†ç¾¤æœåŠ¡ã€‚è¿™é‡Œæˆ‘ä¹Ÿçœ‹äº†å‡ ç¯‡kafkaç›¸å…³æ–‡ç« ï¼Œå¥½æ–‡è´´å‡ºæ¥ï¼š</p><ul><li><a href="http://www.infoq.com/cn/articles/kafka-analysis-part-1" target="_blank" rel="external">infoq kafka å…¥é—¨äº†è§£</a></li><li><a href="https://www.ibm.com/developerworks/cn/opensource/os-cn-kafka/index.html" target="_blank" rel="external">kafka å·¥ä½œåŸç†ä»‹ç»</a></li></ul><p>åœ¨æˆ‘ä»¬å…¬å¸ä¸»è¦Kafka çš„å‡ ä¸ªç‰¹æ€§éå¸¸æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼šå¯æ‰©å±•æ€§ã€æ•°æ®åˆ†åŒºã€ä½å»¶è¿Ÿã€å¤„ç†å¤§é‡ä¸åŒæ¶ˆè´¹è€…çš„èƒ½åŠ›ã€‚</p><p>è€Œè¿™é‡Œæˆ‘æƒ³å¸®å¿™BIå›¢é˜Ÿå®ç°Kafkaå…¨é¢ç›‘æ§ã€‚åˆ†ä¸¤ç‚¹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">1. ç›‘æ§Kafka BrokersæœåŠ¡</div><div class="line">2. ç›‘æ§Kafka Lagå †ç§¯æ•°</div></pre></td></tr></table></figure><p>å¯¹äºKafkaçš„ç›‘æ§ï¼Œå·²ç»æœ‰ç°æˆçš„å¼€æºè½¯ä»¶äº†ï¼Œåœ¨æˆ‘ä»¬å…¬å¸å†…éƒ¨ä¹Ÿä½¿ç”¨äº†ä¸€æ®µæ—¶é—´ï¼Œæœ‰ä¸¤ç§æ–¹æ¡ˆã€‚æˆ‘ä»¬å…¬å¸ç”¨ç¬¬ä¸‰ç§æ–¹æ¡ˆã€‚<br>ä¸€èˆ¬éƒ½ä¼šé€‰æ‹©ä¸¤ä¸ªå¼€æºçš„å·¥å…·ï¼šKafkaOffsetMonitorå’Œkafka-web-consoleï¼Œè¿™ä¸¤æ¬¾æˆ‘éƒ½æœ‰ç”¨è¿‡.</p><ul><li>Kafkaä¸‰æ¬¾ç›‘æ§å·¥å…·æ¯”è¾ƒ</li></ul><p>ç›®å½•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">1ã€Kafka Web Conslole</div><div class="line">2ã€Kafka Manager</div><div class="line">3ã€KafkaOffsetMonitor</div></pre></td></tr></table></figure><p><a href="https://github.com/quantifind/KafkaOffsetMonitor" target="_blank" rel="external">KafkaOffsetMonitor</a>ï¼šæœ€å¤§çš„å¥½å¤„å°±æ˜¯é…ç½®ç®€å•ï¼Œåªéœ€è¦é…ä¸ªzookeeperçš„åœ°å€å°±èƒ½ç”¨äº†ï¼Œå‘çˆ¹çš„åœ°æ–¹å°±æ˜¯ä¸èƒ½è‡ªåŠ¨åˆ·æ–°ï¼Œæ‰‹åŠ¨åˆ·æ–°æ—¶è€—æ—¶è¾ƒé•¿ï¼Œè€Œä¸”æœ‰æ—¶å€™éƒ½åˆ·ä¸å‡ºæ¥ï¼Œå¦å¤–å°±æ˜¯å›¾åƒç”¨äº†ä¸€æ®µæ—¶é—´å°±å®Œå…¨æ˜¾ç¤ºä¸äº†äº†ï¼Œä¸çŸ¥é“å¤§å®¶æ˜¯ä¸æ˜¯è¿™æ ·ã€‚</p><p><a href="https://github.com/claudemamo/kafka-web-console" target="_blank" rel="external">kafka-web-console</a>ï¼šç›¸æ¯”ä¸å‰è€…ï¼Œæ•°æ®æ˜¯è½åœ°çš„ï¼Œå› æ­¤åˆ·æ–°è¾ƒå¿«ï¼Œè€Œä¸”æ”¯æŒåœ¨å‰ç«¯è‡ªå®šä¹‰zookeeperçš„åœ°å€ï¼Œè¿˜èƒ½åˆ—å‡ºå®æ—¶çš„topicé‡Œçš„å…·ä½“å†…å®¹ã€‚ä½†æ˜¯æ­å»ºæ¯”è¾ƒå¤æ‚ï¼Œè€Œä¸”githubä¸Šçš„é»˜è®¤æ•°æ®åº“æ˜¯H2çš„ï¼Œåƒæˆ‘ä»¬ä¸€èˆ¬ç”¨mysqlçš„ï¼Œè¿˜å¾—è‡ªå·±è½¬åŒ–ã€‚å¦å¤–åœ¨ç”¨çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨è¿æ¥kafkaçš„leaderå¤±è´¥çš„æ—¶å€™ï¼Œä¼šä¸€ç›´é‡è¯•ï¼Œå…¶ç»“æœå°±æ˜¯å¯¼è‡´æˆ‘kafkaçš„é‚£å°æœºå­è¿æ¥æ•°è¿‡é«˜ï¼Œéƒ½åˆ°2wäº†ï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯å®ƒçš„ä¸€ä¸ªbugã€‚</p><p>å…·ä½“ä»‹ç»ä»¥åŠå®‰è£…åœ¨æˆ‘å¦å¤–ç¯‡åšæ–‡ã€‚è¿™é‡Œä¸è¯¦ç»†è®²è§£å¼€æºè½¯ä»¶ï¼Œè¿™é‡Œç”¨zabbixç›‘æ§Kafka BrokersæœåŠ¡ã€‚</p><h4 id="kafka-monitoring-BrokersæœåŠ¡"><a href="#kafka-monitoring-BrokersæœåŠ¡" class="headerlink" title="kafka-monitoring BrokersæœåŠ¡"></a>kafka-monitoring BrokersæœåŠ¡</h4><p>æ“ä½œç³»ç»Ÿç¯å¢ƒï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Centos 7.1 </div><div class="line">64Gå†…å­˜</div><div class="line">2Tç£ç›˜ç©ºé—´ï¼ŒæŒ‡å®škafkaå†™å…¥æ•°æ®ç›®å½•ã€‚</div></pre></td></tr></table></figure><p>è¯´æ˜ä¸‹:</p><p>ç›‘æ§Brokersæ˜¯åˆ©ç”¨Zabbix JMXç›‘æ§è·å–æ•°æ®ã€‚</p><p>â˜ï¸ç¬¬ä¸€æ­¥ï¼šä¸ç”¨è§£é‡Šå‰æä½ åœ¨zabbix-serverç«¯å·²ç»å®‰è£…è¿‡abbix-java-gataway å¦‚æœæ²¡æœ‰å®‰è£…å¯ä»¥çœ‹ä¸‹é¢ï¼Œå®‰è£…è¿‡å¯ä»¥ç•¥è¿‡ç¬¬ä¸€æ­¥ã€‚</p><p>1.0 å®‰è£…é…ç½®zabbix-java-gataway</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">yum install -y zabbix-java-gataway</div><div class="line">vi /etc/zabbix/zabbix_java_gateway.conf</div><div class="line">START_POLLERS=10 </div><div class="line">Uncomentå¹¶è®¾ç½®ä¸ºStartJavaPollers = 5 æ›´æ”¹JavaGatewayçš„ IP = IP_address_java_gateway</div><div class="line">``` </div><div class="line">1.1 é‡æ–°å¯åŠ¨zabbix-server</div><div class="line"></div><div class="line">```bash</div><div class="line">/etc/init.d/zabbix-java-gataway restart</div><div class="line">chkconfig --level 345 zabbix-java-gataway on</div><div class="line">/etc/init.d/zabbix-java-gataway start</div></pre></td></tr></table></figure><p>â˜ï¸ç¬¬äºŒæ­¥ï¼šKafkaé…ç½®</p><p>è¿™é‡Œæˆ‘ä»¬æœåŠ¡å™¨ç»™å¤§æ•°æ®é‚£è¾¹å®‰è£…åœ¨æŒ‡å®šç”¨æˆ·ç›®å½•ä¸‹é¢ï¼š/home/jollybi/tools/kafka_2.10-0.8.2.1</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">su - jollybi è¿›å…¥ç›¸åº”ç”¨æˆ·</div><div class="line">vim /home/jollybi/tools/kafka_2.10-0.8.2.1/kafka-run-class.sh</div><div class="line"></div><div class="line">ä»</div><div class="line"></div><div class="line"><span class="comment"># JMX settings</span></div><div class="line"><span class="keyword">if</span> [ -z <span class="string">"<span class="variable">$KAFKA_JMX_OPTS</span>"</span> ]; <span class="keyword">then</span></div><div class="line">KAFKA_JMX_OPTS=<span class="string">"-Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.authenticate=false -   Dcom.sun.management.jmxremote.ssl=false "</span></div><div class="line"><span class="keyword">fi</span></div><div class="line">è‡³</div><div class="line"></div><div class="line"><span class="comment"># JMX settings</span></div><div class="line"><span class="keyword">if</span> [ -z <span class="string">"<span class="variable">$KAFKA_JMX_OPTS</span>"</span> ]; <span class="keyword">then</span></div><div class="line">KAFKA_JMX_OPTS=<span class="string">"-Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.port=12345 -    Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false "</span></div><div class="line"><span class="keyword">fi</span></div></pre></td></tr></table></figure><p>é‡å¯æœåŠ¡ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">/home/jollybi/tools/kafka_2.10-0.8.2.1/bin/kafka-server-stop.sh</div><div class="line">/home/jollybi/tools/kafka_2.10-0.8.2.1/bin/kafka-server-start.sh</div></pre></td></tr></table></figure><p>â˜ï¸ç¬¬ä¸‰æ­¥ï¼šå¯¼å…¥æ¨¡æ¿ç™»å½•åˆ°æ‚¨çš„zabbixç½‘é¡µ.</p><p>å¯¼å…¥æ¨¡æ¿ç™»å½•åˆ°æ‚¨çš„zabbixç½‘é¡µ</p><p>å•å‡»é…ç½® - &gt;æ¨¡æ¿ - &gt;å¯¼å…¥</p><p>ä¸‹è½½æ¨¡æ¿ <a href="https://github.com/yangcvo/Zabbix-Monitoring-Kafka" target="_blank" rel="external">zbx_kafka_templates.xml</a> å¹¶ä¸Šä¼ åˆ°zabbixç„¶åå°†æ­¤æ¨¡æ¿æ·»åŠ åˆ°Kafkaå¹¶åœ¨zabbixä¸Šé…ç½®JMXæ¥å£</p><p>è¾“å…¥Kafka IPåœ°å€å’ŒJMXç«¯å£å¦‚æœçœ‹åˆ°jmxå›¾æ ‡ï¼Œæ‚¨é…ç½®äº†JMXç›‘æ§å¥½ï¼</p><ul><li>æŸ¥çœ‹æ•°æ®ï¼š</li></ul><p><img src="http://7xrthw.com1.z0.glb.clouddn.com/kafka-Brokers_01.png" alt=""><br><img src="http://7xrthw.com1.z0.glb.clouddn.com/kafka-Brokers_02.png" alt=""></p><ul><li>æŸ¥çœ‹æ•ˆæœå›¾ï¼š</li></ul><p><img src="http://7xrthw.com1.z0.glb.clouddn.com/kafka-Brokers_03.png" alt=""></p><p>å‚è€ƒå®˜ç½‘ç›‘æ§æŒ‡æ ‡çš„å«ä¹‰;</p><p><a href="http://docs.confluent.io/current/kafka/monitoring.html" target="_blank" rel="external">Servilo Metrics broker Metrics</a><br><a href="http://docs.confluent.io/current/kafka/monitoring.html" target="_blank" rel="external">Producer Metrics Global Request Metrics</a><br><a href="http://docs.confluent.io/current/kafka/monitoring.html" target="_blank" rel="external">Global Connection Metrics</a></p><h3 id="äº¤æµå­¦ä¹ ï¼š"><a href="#äº¤æµå­¦ä¹ ï¼š" class="headerlink" title="äº¤æµå­¦ä¹ ï¼š"></a>äº¤æµå­¦ä¹ ï¼š</h3><p>ğŸ§  Linux shell_é«˜çº§è¿ç»´æ´¾: <code>459096184</code>    åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)<br>ğŸ§  BigData-Exchange School : <code>521621407</code>  åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥</p><p>ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;Zabbixç›‘æ§Kafkaé›†ç¾¤-BrokersæœåŠ¡&quot;&gt;&lt;a href=&quot;#Zabbixç›‘æ§Kafkaé›†ç¾¤-BrokersæœåŠ¡&quot; class=&quot;headerlink&quot; title=&quot;Zabbixç›‘æ§Kafkaé›†ç¾¤ BrokersæœåŠ¡&quot;&gt;&lt;/a&gt;Zabbixç›‘æ§Kafkaé›†ç¾¤ BrokersæœåŠ¡&lt;/h3&gt;&lt;p&gt;&lt;img src=&quot;http://7xrthw.com1.z0.glb.clouddn.com/kafka-datadog.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h4 id=&quot;å‰è¨€ï¼š&quot;&gt;&lt;a href=&quot;#å‰è¨€ï¼š&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€ï¼š&quot;&gt;&lt;/a&gt;å‰è¨€ï¼š&lt;/h4&gt;&lt;p&gt;Monitoring Kafka with Datadog&lt;/p&gt;
&lt;p&gt;This post is the final part of a 3-part series on how to monitor Kafka. Part 1 explores the key metrics available from Kafka, and Part 2 is about collecting those metrics on an ad hoc basis.&lt;/p&gt;
&lt;p&gt;To implement ongoing, meaningful monitoring, you will need a dedicated system that allows you to store, visualize, and correlate your Kafka metrics with the rest of your infrastructure.&lt;/p&gt;
&lt;p&gt;Kafka deployments often rely on additional software packages not included in the Kafka codebase itself, in particular Apache ZooKeeper. A comprehensive monitoring implementation includes all the layers of your deployment, including host-level metrics when appropriate, and not just the metrics emitted by Kafka itself.&lt;/p&gt;
    
    </summary>
    
      <category term="Kafka" scheme="http://blog.yancy.cc/categories/Kafka/"/>
    
    
      <category term="Kafka" scheme="http://blog.yancy.cc/tags/Kafka/"/>
    
      <category term="Zabbix" scheme="http://blog.yancy.cc/tags/Zabbix/"/>
    
  </entry>
  
  <entry>
    <title>Bigdata-å¼€æºçš„Kafkaé›†ç¾¤ç®¡ç†å™¨(Kafka Manager)</title>
    <link href="http://blog.yancy.cc/2017/05/28/Bigdata-hadoop/Kafka/%E5%BC%80%E6%BA%90%E7%9A%84Kafka%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E5%99%A8(Kafka%20Manager)/"/>
    <id>http://blog.yancy.cc/2017/05/28/Bigdata-hadoop/Kafka/å¼€æºçš„Kafkaé›†ç¾¤ç®¡ç†å™¨(Kafka Manager)/</id>
    <published>2017-05-28T06:46:00.000Z</published>
    <updated>2017-11-21T02:04:28.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Kafka-Manager"><a href="#Kafka-Manager" class="headerlink" title="Kafka Manager"></a>Kafka Manager</h2><p>A tool for managing <a href="http://kafka.apache.org/" target="_blank" rel="external">Apache Kafka.</a></p><h4 id="It-supports-the-following"><a href="#It-supports-the-following" class="headerlink" title="It supports the following:"></a>It supports the following:</h4><ul><li>ç®¡ç†å¤šä¸ªç¾¤é›†</li><li>å®¹æ˜“æ£€æŸ¥é›†ç¾¤çŠ¶æ€ï¼ˆä¸»é¢˜ï¼Œæ¶ˆè´¹è€…ï¼Œåç§»é‡ï¼Œç»çºªäººï¼Œå‰¯æœ¬åˆ†å‘ï¼Œåˆ†åŒºåˆ†é…ï¼‰</li><li>è¿è¡Œé¦–é€‰å‰¯æœ¬é€‰ä¸¾</li><li>ä½¿ç”¨é€‰é¡¹ç”Ÿæˆåˆ†åŒºåˆ†é…ï¼Œä»¥é€‰æ‹©è¦ä½¿ç”¨çš„ä»£ç†</li><li>è¿è¡Œåˆ†åŒºçš„é‡æ–°åˆ†é…ï¼ˆåŸºäºç”Ÿæˆçš„åˆ†é…ï¼‰</li><li>åˆ›å»ºå¯é€‰ä¸»é¢˜é…ç½®çš„ä¸»é¢˜ï¼ˆ0.8.1.1å…·æœ‰ä¸åŒäº0.8.2+çš„é…ç½®ï¼‰</li><li>åˆ é™¤ä¸»é¢˜ï¼ˆä»…æ”¯æŒ0.8.2+ï¼Œå¹¶è®°ä½åœ¨ä»£ç†é… ç½®ä¸­è®¾ç½®delete.topic.enable = trueï¼‰</li><li>ä¸»é¢˜åˆ—è¡¨ç°åœ¨è¡¨ç¤ºæ ‡è®°ä¸ºåˆ é™¤çš„ä¸»é¢˜ï¼ˆä»…æ”¯æŒ0.8.2+ï¼‰</li><li>æ‰¹é‡ç”Ÿæˆå¤šä¸ªä¸»é¢˜çš„åˆ†åŒºåˆ†é…ï¼Œå¹¶é€‰æ‹©è¦ä½¿ç”¨çš„ä»£ç†</li><li>æ‰¹é‡è¿è¡Œå¤šä¸ªä¸»é¢˜çš„åˆ†åŒºé‡æ–°åˆ†é…</li><li>å°†åˆ†åŒºæ·»åŠ åˆ°ç°æœ‰ä¸»é¢˜</li><li>æ›´æ–°ç°æœ‰ä¸»é¢˜çš„é…ç½®</li><li>å¯é€‰åœ°ï¼Œå¯ç”¨JMXè½®è¯¢ä»£ç†çº§å’Œä¸»é¢˜çº§åº¦é‡ã€‚</li><li>å¯é€‰åœ°ç­›é€‰å‡ºåœ¨zookeeperä¸­æ²¡æœ‰ids / owner /ï¼†offset /ç›®å½•çš„æ¶ˆè´¹è€…ã€‚</li></ul><a id="more"></a><p>å‚è€ƒå¼€æºåœ°å€ï¼š<a href="https://github.com/yahoo/kafka-manager" target="_blank" rel="external">https://github.com/yahoo/kafka-manager</a></p><h4 id="Requirements"><a href="#Requirements" class="headerlink" title="Requirements"></a>Requirements</h4><p>Kafka 0.8.1.1 or 0.8.2.<em> or 0.9.0.</em> or 0.10.0.*<br>Java 8+</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">sudo wget --header <span class="string">"Cookie: oraclelicense=accept-securebackup-cookieâ€   http://download.oracle.com/otn-pub/java/jdk/8u144-b01/090f390dda5b47b9b721c7dfaa008135/jdk-8u144-linux-x64.tar.gz</span></div><div class="line"></div><div class="line">sudo vim /etc/profile</div><div class="line">export JAVA_HOME=/home/jollybi/tools/jdk1.8.0_144</div><div class="line">export LASSPATH=.:<span class="variable">$JAVA_HOME</span>/lib/tools.jar:<span class="variable">$JAVA_HOME</span>/lib/dt.jar:<span class="variable">$JAVA_HOME</span>/lib:<span class="variable">$JAVA_HOME</span>/jre/lib:<span class="variable">$JAVA_HOME</span>/bin</div><div class="line">export PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$JAVA_HOME</span>/jre/bin:<span class="variable">$TOMCAT_HOME</span>/bin:<span class="variable">$PATH</span></div></pre></td></tr></table></figure><h4 id="Deployment"><a href="#Deployment" class="headerlink" title="Deployment"></a>Deployment</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">git <span class="built_in">clone</span> https://github.com/yahoo/kafka-manager.git</div><div class="line">./sbt clean dist</div><div class="line"></div><div class="line">[info]   Compilation completed <span class="keyword">in</span> 13.366 s</div><div class="line">model contains 672 documentable templates</div><div class="line">[info] Main Scala API documentation successful.</div><div class="line">[info] Packaging /home/jollybi/kafka-manager/target/scala-2.11/kafka-manager_2.11-1.3.3.8-javadoc.jar ...</div><div class="line">[info] Done packaging.</div><div class="line">[info] Packaging /home/jollybi/kafka-manager/target/scala-2.11/kafka-manager_2.11-1.3.3.8.jar ...</div><div class="line">[info] Done packaging.</div><div class="line">[info] Packaging /home/jollybi/kafka-manager/target/scala-2.11/kafka-manager_2.11-1.3.3.8-sans-externalized.jar ...</div><div class="line">[info] Done packaging.</div><div class="line">[info]</div><div class="line">[info] Your package is ready <span class="keyword">in</span> /home/jollybi/kafka-manager/target/universal/kafka-manager-1.3.3.8.zip</div><div class="line">[info]</div><div class="line">[success] Total time: 142 s, completed Jul 27, 2017 3:48:35 PM</div><div class="line">å®Œæˆ</div></pre></td></tr></table></figure><h4 id="Starting-the-service"><a href="#Starting-the-service" class="headerlink" title="Starting the service"></a>Starting the service</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">è§£å‹ç¼©ç”Ÿæˆçš„zipæ–‡ä»¶åï¼Œå°†å·¥ä½œç›®å½•æ›´æ”¹ä¸ºå¯ä»¥è¿è¡Œçš„æœåŠ¡ï¼š</div><div class="line"></div><div class="line">unzip /home/jollybi/kafka-manager/target/universal/kafka-manager-1.3.3.8.zip</div><div class="line"></div><div class="line"></div><div class="line">ä¿®æ”¹zkåœ°å€å’Œç®¡ç†å‘˜è´¦å·å’Œå¯†ç ï¼š</div><div class="line"></div><div class="line">vim kafka-manager-1.3.3.8/conf/application.conf</div><div class="line"></div><div class="line"><span class="comment">#kafka-manager.zkhosts="kafka-manager-zookeeper:2181"</span></div><div class="line"><span class="comment">#zké›†ç¾¤å¯ä»¥è¿™ä¹ˆé…ç½®ï¼š</span></div><div class="line">kafka-manager.zkhosts=<span class="string">"kafka1.jollychic.com:2281,kafka2.jollychic.com:2281,kafka3.jollychic.com:2281"</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#æ ¹æ®ä¸ªäººå…¬å¸è¿™é‡Œå¯ä»¥å¼€å¯true è®¾ç½®è´¦å·å’Œå¯†ç </span></div><div class="line">basicAuthentication.enabled=<span class="literal">true</span></div><div class="line">basicAuthentication.username=<span class="string">"admin"</span></div><div class="line">basicAuthentication.password=<span class="string">"admin"</span></div><div class="line"></div><div class="line"></div><div class="line">é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒå°†é€‰æ‹©ç«¯å£9000.è¿™æ˜¯å¯ä»¥è¦†ç›–çš„ï¼Œé…ç½®æ–‡ä»¶çš„ä½ç½®ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ä¾‹å¦‚ï¼š</div><div class="line"></div><div class="line">$ ./bin/kafka-manager -Dconfig.file=conf/application.conf -Dhttp.port=8080</div><div class="line"></div><div class="line">åå°ç”Ÿæ•ˆï¼š</div><div class="line"></div><div class="line">$ ./bin/kafka-manager -Dconfig.file=conf/application.conf -Dhttp.port=8080 &amp;</div><div class="line"></div><div class="line">å†æ¬¡ï¼Œå¦‚æœjavaä¸åœ¨æ‚¨çš„è·¯å¾„ä¸­ï¼Œæˆ–è€…æ‚¨éœ€è¦é’ˆå¯¹ä¸åŒç‰ˆæœ¬çš„Javaè¿è¡Œï¼Œè¯·æŒ‰å¦‚ä¸‹æ‰€ç¤ºæ·»åŠ -java-homeé€‰é¡¹ï¼š</div><div class="line"></div><div class="line">$ bin/kafka-manager -java-home /usr/<span class="built_in">local</span>/oracle-java-8</div></pre></td></tr></table></figure><h4 id="Packaging"><a href="#Packaging" class="headerlink" title="Packaging"></a>Packaging</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">If you<span class="string">'d like to create a Debian or RPM package instead, you can run one of:</span></div><div class="line"></div><div class="line">sbt debian:packageBin</div><div class="line"></div><div class="line">sbt rpm:packageBin</div></pre></td></tr></table></figure><h4 id="æŸ¥çœ‹ç«¯å£ï¼š"><a href="#æŸ¥çœ‹ç«¯å£ï¼š" class="headerlink" title="æŸ¥çœ‹ç«¯å£ï¼š"></a>æŸ¥çœ‹ç«¯å£ï¼š</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">[jollybi@kafka1 conf]$ netstat -ntulp | grep 8080</div><div class="line">(Not all processes could be identified, non-owned process info</div><div class="line"> will not be shown, you would have to be root to see it all.)</div><div class="line">tcp6       0      0 :::8080                 :::*                    LISTEN      70517/java</div></pre></td></tr></table></figure><p>å››ã€å®‰è£…é…ç½®ä¸­çš„ä¸¤ä¸ªå°å‘</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="number">1</span>ã€å®‰è£…é…ç½®ä¸Šé¢å·²ç»æœ‰è¯´æ˜ä»‹ç»æ­¥éª¤ã€‚</div><div class="line"><span class="number">2</span>ã€kafkaçš„æœåŠ¡å™¨å¿…é¡»æ·»åŠ hostnameå¯¹åº”çš„hoståŸŸåè§£æï¼Œå¹¶é‡å¯kafka</div><div class="line">è¿™ä¸ªæ˜¯javaæœ¬èº«å¤„ç†çš„ä¸€ä¸ªæœºåˆ¶é—®é¢˜ï¼Œé€šè¿‡ä»£ç ä¿®æ”¹å’Œç»‘å®šhostéƒ½å¯ä»¥è§£å†³ï¼Œå¦‚æœä¸å¤„ç†ï¼ŒæŠ¥å‡ºæ¥çš„é”™è¯¯å¦‚ä¸‹ï¼š</div><div class="line"><span class="meta">at</span> org.apache.kafka.clients.consumer.KafkaConsumer.pollOnce(KafkaConsumer.java:<span class="number">974</span>) ~[org.apache.kafka.kafka-clients-<span class="number">0.10</span><span class="meta">.0</span><span class="meta">.1</span>.jar:na]</div><div class="line">[error] k.m.j.KafkaJMX$ - Failed to connect to service:jmx:rmi:///jndi/rmi://<span class="number">10.143</span><span class="meta">.40</span><span class="meta">.239</span>:<span class="number">9999</span>/jmxrmi</div><div class="line"><span class="symbol">java.rmi.ConnectException:</span> Connection refused to host: <span class="number">127.0</span><span class="meta">.0</span><span class="meta">.1</span><span class="comment">; nested exception is:</span></div><div class="line"><span class="symbol">java.net.ConnectException:</span> Connection refused</div><div class="line">ä»ä¸€ä¸ªè¿ç»´äººå‘˜çš„è§’åº¦å‡ºå‘ï¼Œæ”¹hostè§£ææ˜¯æœ€å¾—å¿ƒåº”æ‰‹çš„ï¼Œç™»å½•kafkaçš„æœåŠ¡å™¨ï¼Œæ‰“å¼€/etc/hostsæ–‡ä»¶ï¼Œå°†ä¸»æœºåå¯¹åº”çš„è§£æè®°å½•ä¿®æ”¹ä¸ºæœ¬æœºå¯¹å¤–é€šä¿¡çš„<span class="built_in">ip</span>åœ°å€ï¼Œå¦å¤–å°†<span class="number">127.0</span><span class="meta">.0</span><span class="meta">.1</span>å’Œ::<span class="number">1</span>å¯¹åº”çš„ä¸»æœºååˆ æ‰ï¼Œä¿®æ”¹å¦‚ä¸‹ï¼Œä¿®æ”¹åå¿…é¡»é‡å¯kafkaæ‰èƒ½ç”Ÿæ•ˆã€‚</div><div class="line"></div><div class="line"></div><div class="line"><span class="number">127.0</span><span class="meta">.0</span><span class="meta">.1</span> localhost.localdomain localhost</div><div class="line"><span class="number">169.44</span><span class="meta">.62</span><span class="meta">.19</span> kafka1.jollychic.com kafka1</div><div class="line"><span class="number">169.44</span><span class="meta">.59</span><span class="meta">.18</span> kafka2.jollychic.com kafka2</div><div class="line"><span class="number">169.44</span><span class="meta">.62</span><span class="meta">.17</span> kafka3.jollychic.com kafka3</div><div class="line"><span class="number">169.55</span><span class="meta">.32</span><span class="meta">.22</span> kafka4.jollychic.com kafka4</div><div class="line"><span class="number">10.155</span><span class="meta">.90</span><span class="meta">.13</span> zk1.jollychic.com</div><div class="line"><span class="number">10.155</span><span class="meta">.90</span><span class="meta">.15</span> zk2.jollychic.com</div><div class="line"><span class="number">10.155</span><span class="meta">.90</span><span class="meta">.18</span> zk3.jollychic.com</div></pre></td></tr></table></figure><h3 id="ç½‘ç«™è®¿é—®kafka-Manger"><a href="#ç½‘ç«™è®¿é—®kafka-Manger" class="headerlink" title="ç½‘ç«™è®¿é—®kafka Manger"></a>ç½‘ç«™è®¿é—®kafka Manger</h3><p>è¿™é‡Œæˆ‘è®¾ç½®äº†ç™»å½•è´¦å·å’Œå¯†ç ï¼š admin admin</p><p><img src="media/15014722977191.jpg" alt=""></p><p>åˆ›å»ºkafkaåå­—;<br>é€‰æ‹©kafkaç‰ˆæœ¬å·;<br>JMXè¿™ä¸ªä¸éœ€è¦;<br>ä¸‹é¢é€‰æ‹©é»˜è®¤ç‚¹å‡»ç¡®è®¤å³å¯.</p><p><img src="media/15014724051756.jpg" alt=""></p><blockquote><p>(2)kafka å¯ç”¨ JMXç«¯å£</p></blockquote><p><img src="media/15020729297106.jpg" alt=""></p><figure class="highlight vbscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">ä»¥å¦‚ä¸‹å‘½ä»¤é‡æ–°å¯åŠ¨kafka</div><div class="line"></div><div class="line">JMX_PORT=<span class="number">9999</span> bin/kafka-<span class="built_in">server</span>-start.sh config/<span class="built_in">server</span>.properties</div><div class="line">æˆ–è€…ä¿®æ”¹kafka-<span class="built_in">server</span>-start.sh æ–‡ä»¶ï¼Œè¿½åŠ JMX_PORT=<span class="string">"9999"</span></div><div class="line"></div><div class="line"> <span class="keyword">if</span> [ <span class="string">"x$KAFKA_HEAP_OPTS"</span> = <span class="string">"x"</span> ]; <span class="keyword">then</span></div><div class="line">    export KAFKA_HEAP_OPTS=<span class="string">"-Xmx1G -Xms1G"</span></div><div class="line">    export JMX_PORT=<span class="string">"9999"</span></div><div class="line">fi</div><div class="line">ç„¶åé‡æ–°å¯åŠ¨kafka</div><div class="line">bin/kafka-<span class="built_in">server</span>-start.sh config/<span class="built_in">server</span>.properties</div><div class="line"></div><div class="line">ä½†æ˜¯Metricsä¸­æ•°æ®éƒ½æ˜¯é›¶</div><div class="line">æŸ¥çœ‹ kafka manager æŠ¥é”™ï¼Œæ— æ³•è¿æ¥jxm</div></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">è§£å†³æ–¹æ³• ä¿®æ”¹æ¯ä¸ªkafka brokerçš„ kafka_2.11-0.10.1.0/bin/kafka-run-class.shæ–‡ä»¶</div><div class="line">â€‹</div><div class="line"><span class="comment"># JMX settings</span></div><div class="line"><span class="keyword">if</span> [ -z <span class="string">"<span class="variable">$KAFKA_JMX_OPTS</span>"</span> ]; <span class="keyword">then</span></div><div class="line">  KAFKA_JMX_OPTS=<span class="string">"-Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.authenticate=false  -Dcom.sun.management.jmxremote.ssl=false -Djava.rmi.server.hostname=75.126.5.162"</span></div><div class="line"><span class="keyword">fi</span></div><div class="line"></div><div class="line"></div><div class="line">-Djava.rmi.server.hostname çš„å€¼ä¸ºå½“å‰kafkaæœåŠ¡å™¨ip</div><div class="line"></div><div class="line">è¿™é‡Œè¯´æ˜ä¸‹é›†ç¾¤kafkaéƒ½éœ€è¦ä¿®æ”¹</div></pre></td></tr></table></figure><p><img src="media/15020745879851.jpg" alt=""></p><p><img src="media/15014725443386.jpg" alt=""></p><p><img src="media/15014725288425.jpg" alt=""></p><p><img src="media/15014725659340.jpg" alt=""></p><p><img src="media/15014725864134.jpg" alt=""></p><p><img src="media/15014726361909.jpg" alt=""></p><p><img src="media/15014727525618.jpg" alt=""></p><p><img src="media/15014727932029.jpg" alt=""></p><h3 id="äº¤æµå­¦ä¹ ï¼š"><a href="#äº¤æµå­¦ä¹ ï¼š" class="headerlink" title="äº¤æµå­¦ä¹ ï¼š"></a>äº¤æµå­¦ä¹ ï¼š</h3><p>ğŸ§  Linux shell_é«˜çº§è¿ç»´æ´¾: <code>459096184</code>    åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)<br>ğŸ§  BigData-Exchange School : <code>521621407</code>  åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥</p><p>ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Kafka-Manager&quot;&gt;&lt;a href=&quot;#Kafka-Manager&quot; class=&quot;headerlink&quot; title=&quot;Kafka Manager&quot;&gt;&lt;/a&gt;Kafka Manager&lt;/h2&gt;&lt;p&gt;A tool for managing &lt;a href=&quot;http://kafka.apache.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Apache Kafka.&lt;/a&gt;&lt;/p&gt;
&lt;h4 id=&quot;It-supports-the-following&quot;&gt;&lt;a href=&quot;#It-supports-the-following&quot; class=&quot;headerlink&quot; title=&quot;It supports the following:&quot;&gt;&lt;/a&gt;It supports the following:&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;ç®¡ç†å¤šä¸ªç¾¤é›†&lt;/li&gt;
&lt;li&gt;å®¹æ˜“æ£€æŸ¥é›†ç¾¤çŠ¶æ€ï¼ˆä¸»é¢˜ï¼Œæ¶ˆè´¹è€…ï¼Œåç§»é‡ï¼Œç»çºªäººï¼Œå‰¯æœ¬åˆ†å‘ï¼Œåˆ†åŒºåˆ†é…ï¼‰&lt;/li&gt;
&lt;li&gt;è¿è¡Œé¦–é€‰å‰¯æœ¬é€‰ä¸¾&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨é€‰é¡¹ç”Ÿæˆåˆ†åŒºåˆ†é…ï¼Œä»¥é€‰æ‹©è¦ä½¿ç”¨çš„ä»£ç†&lt;/li&gt;
&lt;li&gt;è¿è¡Œåˆ†åŒºçš„é‡æ–°åˆ†é…ï¼ˆåŸºäºç”Ÿæˆçš„åˆ†é…ï¼‰&lt;/li&gt;
&lt;li&gt;åˆ›å»ºå¯é€‰ä¸»é¢˜é…ç½®çš„ä¸»é¢˜ï¼ˆ0.8.1.1å…·æœ‰ä¸åŒäº0.8.2+çš„é…ç½®ï¼‰&lt;/li&gt;
&lt;li&gt;åˆ é™¤ä¸»é¢˜ï¼ˆä»…æ”¯æŒ0.8.2+ï¼Œå¹¶è®°ä½åœ¨ä»£ç†é… ç½®ä¸­è®¾ç½®delete.topic.enable = trueï¼‰&lt;/li&gt;
&lt;li&gt;ä¸»é¢˜åˆ—è¡¨ç°åœ¨è¡¨ç¤ºæ ‡è®°ä¸ºåˆ é™¤çš„ä¸»é¢˜ï¼ˆä»…æ”¯æŒ0.8.2+ï¼‰&lt;/li&gt;
&lt;li&gt;æ‰¹é‡ç”Ÿæˆå¤šä¸ªä¸»é¢˜çš„åˆ†åŒºåˆ†é…ï¼Œå¹¶é€‰æ‹©è¦ä½¿ç”¨çš„ä»£ç†&lt;/li&gt;
&lt;li&gt;æ‰¹é‡è¿è¡Œå¤šä¸ªä¸»é¢˜çš„åˆ†åŒºé‡æ–°åˆ†é…&lt;/li&gt;
&lt;li&gt;å°†åˆ†åŒºæ·»åŠ åˆ°ç°æœ‰ä¸»é¢˜&lt;/li&gt;
&lt;li&gt;æ›´æ–°ç°æœ‰ä¸»é¢˜çš„é…ç½®&lt;/li&gt;
&lt;li&gt;å¯é€‰åœ°ï¼Œå¯ç”¨JMXè½®è¯¢ä»£ç†çº§å’Œä¸»é¢˜çº§åº¦é‡ã€‚&lt;/li&gt;
&lt;li&gt;å¯é€‰åœ°ç­›é€‰å‡ºåœ¨zookeeperä¸­æ²¡æœ‰ids / owner /ï¼†offset /ç›®å½•çš„æ¶ˆè´¹è€…ã€‚&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="å¤§æ•°æ®" scheme="http://blog.yancy.cc/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
    
      <category term="Kafka" scheme="http://blog.yancy.cc/tags/Kafka/"/>
    
  </entry>
  
  <entry>
    <title>Bigdata-ZooKeeperçš„é…ç½®è¯¦è§£ä¼˜åŒ–</title>
    <link href="http://blog.yancy.cc/2017/05/27/Bigdata-hadoop/zookeeper/Bigdata-ZooKeeper%E7%9A%84%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3%E4%BC%98%E5%8C%96/"/>
    <id>http://blog.yancy.cc/2017/05/27/Bigdata-hadoop/zookeeper/Bigdata-ZooKeeperçš„é…ç½®è¯¦è§£ä¼˜åŒ–/</id>
    <published>2017-05-27T06:46:00.000Z</published>
    <updated>2017-09-26T07:31:33.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p><code>ZooKeeper</code>çš„åŠŸèƒ½ç‰¹æ€§é€šè¿‡ <code>ZooKeeper</code> é…ç½®æ–‡ä»¶æ¥è¿›è¡Œæ§åˆ¶ç®¡ç†ï¼ˆ <code>zoo.cfg</code> é…ç½®æ–‡ä»¶ï¼‰ã€‚ ZooKeeper è¿™æ ·çš„è®¾è®¡å…¶å®æ˜¯æœ‰å®ƒè‡ªèº«çš„åŸå› çš„ã€‚é€šè¿‡å‰é¢å¯¹ <code>ZooKeeper</code> çš„é…ç½®å¯ä»¥çœ‹å‡ºï¼Œå¯¹ <code>ZooKeeper</code>é›†ç¾¤è¿›è¡Œé…ç½®çš„æ—¶å€™ï¼Œå®ƒçš„é…ç½®æ–‡æ¡£æ˜¯å®Œå…¨ç›¸åŒçš„ï¼ˆå¯¹äºé›†ç¾¤ä¼ªåˆ†å¸ƒæ¨¡å¼æ¥è¯´ï¼Œåªæœ‰å¾ˆå°‘çš„éƒ¨åˆ†æ˜¯ä¸åŒçš„ï¼‰ã€‚è¿™æ ·çš„é…ç½®æ–¹ä½¿å¾—åœ¨éƒ¨ç½² <code>ZooKeeper</code> æœåŠ¡çš„æ—¶å€™éå¸¸åœ°æ–¹ä¾¿ã€‚å¦å¤–ï¼Œå¦‚æœæœåŠ¡å™¨ä½¿ç”¨ä¸åŒçš„é…ç½®æ–‡ä»¶ï¼Œå¿…é¡»è¦ç¡®ä¿ä¸åŒé…ç½®æ–‡ä»¶ä¸­çš„æœåŠ¡å™¨åˆ—è¡¨ç›¸åŒ¹é…ã€‚</p><p>åœ¨è®¾ç½® <code>ZooKeeper</code> é…ç½®æ–‡æ¡£çš„æ—¶å€™ï¼ŒæŸäº›å‚æ•°æ˜¯å¯é€‰çš„ï¼Œä½†æ˜¯æŸäº›å‚æ•°æ˜¯å¿…é¡»çš„ã€‚è¿™äº›å¿…é¡»çš„å‚æ•°å°±æ„æˆäº†<code>ZooKeeper</code> é…ç½®æ–‡æ¡£çš„æœ€ä½é…ç½®è¦æ±‚ã€‚</p><a id="more"></a><h5 id="æœ€è¿‘å‘ç°åœ¨ç”¨zookeeperå‡ºç°ç»å¸¸å‡ºç°è¿æ¥è¶…æ—¶ï¼Œå‡ºç°è¿æ¥ä¸­æ–­ï¼Œæ•°æ®ä¸¢å¤±ç­‰åŸå› ã€‚åé¢çœ‹äº†å®˜ç½‘é…ç½®è‡ªå·±æ•´ç†ä¼˜åŒ–å‡ ç‚¹ï¼š"><a href="#æœ€è¿‘å‘ç°åœ¨ç”¨zookeeperå‡ºç°ç»å¸¸å‡ºç°è¿æ¥è¶…æ—¶ï¼Œå‡ºç°è¿æ¥ä¸­æ–­ï¼Œæ•°æ®ä¸¢å¤±ç­‰åŸå› ã€‚åé¢çœ‹äº†å®˜ç½‘é…ç½®è‡ªå·±æ•´ç†ä¼˜åŒ–å‡ ç‚¹ï¼š" class="headerlink" title="æœ€è¿‘å‘ç°åœ¨ç”¨zookeeperå‡ºç°ç»å¸¸å‡ºç°è¿æ¥è¶…æ—¶ï¼Œå‡ºç°è¿æ¥ä¸­æ–­ï¼Œæ•°æ®ä¸¢å¤±ç­‰åŸå› ã€‚åé¢çœ‹äº†å®˜ç½‘é…ç½®è‡ªå·±æ•´ç†ä¼˜åŒ–å‡ ç‚¹ï¼š"></a>æœ€è¿‘å‘ç°åœ¨ç”¨zookeeperå‡ºç°ç»å¸¸å‡ºç°è¿æ¥è¶…æ—¶ï¼Œå‡ºç°è¿æ¥ä¸­æ–­ï¼Œæ•°æ®ä¸¢å¤±ç­‰åŸå› ã€‚åé¢çœ‹äº†å®˜ç½‘é…ç½®è‡ªå·±æ•´ç†ä¼˜åŒ–å‡ ç‚¹ï¼š</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">2.1é”™è¯¯æ—¥å¿—ï¼š</div><div class="line"></div><div class="line">2016-04-11 15:00:58,981 [myid:] - WARN  [SyncThread:0:FileTxnLog@334] - fsync-ing the write ahead <span class="built_in">log</span> <span class="keyword">in</span> SyncThread:0 took 13973ms <span class="built_in">which</span> will adversely effect operation latency. See the ZooKeeper troubleshooting guide</div><div class="line"></div><div class="line">&gt;2.2ï¼Œé”™è¯¯åŸå› åˆ†æ</div><div class="line">â€œFOLLOWERâ€åœ¨è·Ÿâ€œLEADERâ€åŒæ­¥æ—¶ï¼Œfsyncæ“ä½œæ—¶é—´è¿‡é•¿ï¼Œå¯¼è‡´è¶…æ—¶ã€‚</div><div class="line"></div><div class="line"></div><div class="line">ç¬¬ä¸€æ­¥ï¼šåˆ†ææœåŠ¡å™¨é—®é¢˜ï¼š</div><div class="line">æˆ‘æŸ¥çœ‹äº†æœåŠ¡å™¨ioå’Œè´Ÿè½½éƒ½ä¸é«˜ã€‚å†…å­˜ç©ºé—´å®é™…ä½¿ç”¨ç‡ä¸é«˜ã€‚å¯æ˜¯ç¼–è¾‘æ–‡ä»¶å‡ºç°äº†å¡é¡¿.</div><div class="line"></div><div class="line">å¯ä»¥å‘ç°ï¼š</div><div class="line">æœåŠ¡å™¨å¹¶æ²¡æœ‰å ç”¨å¾ˆå¤šå†…å­˜çš„è¿›ç¨‹ï¼›</div><div class="line">æœåŠ¡å™¨ä¹Ÿæ²¡æœ‰å­˜åœ¨å¾ˆå¤šçš„è¿›ç¨‹ï¼›</div><div class="line">cat /var/<span class="built_in">log</span>/messageæŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—å¹¶æ²¡æœ‰å‘ç°ä»€ä¹ˆå¼‚å¸¸ï¼›</div><div class="line">å¦å¤–pingæœåŠ¡å™¨åªæœ‰0.1mså¤šçš„å»¶è¿Ÿï¼Œå› æ­¤ä¸æ˜¯ç½‘ç»œé—®é¢˜ã€‚</div><div class="line">åé¢å‘ç°ç¡¬ç›˜æœ‰æ•…éšœé‡æ–°æ›´æ¢äº†ä¸€å—ç¡¬ç›˜ã€‚æˆ–è€…æ›´æ¢æœåŠ¡å™¨ã€‚</div><div class="line"></div><div class="line"></div><div class="line">&gt;2.3ï¼Œé”™è¯¯è§£å†³</div><div class="line">å¢åŠ â€œtickTimeâ€æˆ–è€…â€œinitLimitå’ŒsyncLimitâ€çš„å€¼ï¼Œæˆ–è€…ä¸¤è€…éƒ½å¢å¤§ã€‚</div><div class="line"></div><div class="line"></div><div class="line">&gt;2.4ï¼Œå…¶ä»–</div><div class="line">è¿™ä¸ªé”™è¯¯åœ¨ä¸Šçº¿â€œä½¿ç”¨ZooKeeperè·å–åœ°å€æ–¹æ¡ˆâ€ä¹‹å‰ä¹Ÿå­˜åœ¨ï¼Œåªä¸è¿‡è¿‡æ²¡æœ‰è¿™ä¹ˆé«˜é¢‘ç‡ï¼Œè€Œä¸Šçº¿äº†â€œZooKeeperè·å–åœ°å€æ–¹æ¡ˆâ€ä¹‹åï¼ŒZooKeeper Serverä¹‹é—´çš„åŒæ­¥æ•°æ®é‡å¢å¤§ï¼ŒZooKeeper Serverçš„è´Ÿè½½åŠ é‡ï¼Œå› è€Œæœ€ç»ˆå¯¼è‡´é«˜é¢‘ç‡å‡ºç°ä¸Šè¿°é”™è¯¯ã€‚</div></pre></td></tr></table></figure><h3 id="ä¸‹é¢æ˜¯åœ¨æœ€ä½é…ç½®è¦æ±‚ä¸­å¿…é¡»é…ç½®çš„å‚æ•°ï¼š"><a href="#ä¸‹é¢æ˜¯åœ¨æœ€ä½é…ç½®è¦æ±‚ä¸­å¿…é¡»é…ç½®çš„å‚æ•°ï¼š" class="headerlink" title="ä¸‹é¢æ˜¯åœ¨æœ€ä½é…ç½®è¦æ±‚ä¸­å¿…é¡»é…ç½®çš„å‚æ•°ï¼š"></a>ä¸‹é¢æ˜¯åœ¨æœ€ä½é…ç½®è¦æ±‚ä¸­å¿…é¡»é…ç½®çš„å‚æ•°ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">### æœ€å°é…ç½®</span></div><div class="line"></div><div class="line">æœ€å°é…ç½®æ„å‘³ç€æ‰€æœ‰çš„é…ç½®æ–‡ä»¶ä¸­å¿…é¡»è¦åŒ…å«è¿™äº›é…ç½®é€‰é¡¹ã€‚</div><div class="line"></div><div class="line"><span class="comment">#### clientPort</span></div><div class="line"></div><div class="line">æœåŠ¡å™¨ç›‘å¬å®¢æˆ·ç«¯è¿æ¥çš„ç«¯å£, äº¦å³å®¢æˆ·ç«¯å°è¯•è¿æ¥åˆ°æœåŠ¡å™¨ä¸Šçš„æŒ‡å®šç«¯å£ã€‚</div><div class="line"></div><div class="line"><span class="comment">##### dataDir</span></div><div class="line"></div><div class="line">ZooKeeper å­˜å‚¨å†…å­˜æ•°æ®åº“å¿«ç…§æ–‡ä»¶çš„è·¯å¾„, å¹¶ä¸”å¦‚æœæ²¡æœ‰æŒ‡å®šå…¶å®ƒè·¯å¾„çš„è¯, æ•°æ®åº“æ›´æ–°çš„äº‹åŠ¡æ—¥å¿—ä¹Ÿå°†å­˜å‚¨åˆ°è¯¥è·¯å¾„ä¸‹ã€‚</div><div class="line"></div><div class="line">æ³¨æ„: äº‹åŠ¡æ—¥å¿—ä¼šå½±å“ ZooKeeper æœåŠ¡å™¨çš„æ•´ä½“æ€§èƒ½, æ‰€ä»¥å»ºè®®å°†äº‹åŠ¡æ—¥å¿—æ”¾ç½®åˆ°ç”± dataLogDir å‚æ•°æŒ‡å®šçš„è·¯å¾„ä¸‹ã€‚</div><div class="line"></div><div class="line"><span class="comment">##### tickTime</span></div><div class="line"></div><div class="line">å•ä¸ª tick çš„æ—¶é—´é•¿åº¦, å®ƒæ˜¯ ZooKeeper ä¸­ä½¿ç”¨çš„åŸºæœ¬æ—¶é—´å•å…ƒ, ä»¥æ¯«ç§’ä¸ºå•ä½ã€‚å®ƒç”¨æ¥è°ƒèŠ‚å¿ƒè·³å’Œè¶…æ—¶æ—¶é—´ã€‚ä¾‹å¦‚, æœ€å°ä¼šè¯è¶…æ—¶æ—¶é—´æ˜¯ 2 ä¸ª tickã€‚</div></pre></td></tr></table></figure><h3 id="ç”Ÿäº§ç¯å¢ƒé…ç½®ä¾‹å­ï¼š"><a href="#ç”Ÿäº§ç¯å¢ƒé…ç½®ä¾‹å­ï¼š" class="headerlink" title="ç”Ÿäº§ç¯å¢ƒé…ç½®ä¾‹å­ï¼š"></a>ç”Ÿäº§ç¯å¢ƒé…ç½®ä¾‹å­ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line">1.tickTimeï¼šCSé€šä¿¡å¿ƒè·³æ•°</div><div class="line"></div><div class="line">Zookeeper æœåŠ¡å™¨ä¹‹é—´æˆ–å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´ç»´æŒå¿ƒè·³çš„æ—¶é—´é—´éš”ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ª tickTime æ—¶é—´å°±ä¼šå‘é€ä¸€ä¸ªå¿ƒè·³ã€‚tickTimeä»¥æ¯«ç§’ä¸ºå•ä½ã€‚</div><div class="line"></div><div class="line">tickTime=2000  </div><div class="line"></div><div class="line">2.initLimitï¼šLFåˆå§‹é€šä¿¡æ—¶é™</div><div class="line">é›†ç¾¤ä¸­çš„followeræœåŠ¡å™¨(F)ä¸leaderæœåŠ¡å™¨(L)ä¹‹é—´åˆå§‹è¿æ¥æ—¶èƒ½å®¹å¿çš„æœ€å¤šå¿ƒè·³æ•°ï¼ˆtickTimeçš„æ•°é‡ï¼‰ã€‚</div><div class="line"></div><div class="line">initLimit=5  </div><div class="line"></div><div class="line">3.syncLimitï¼šLFåŒæ­¥é€šä¿¡æ—¶é™</div><div class="line">é›†ç¾¤ä¸­çš„followeræœåŠ¡å™¨ä¸leaderæœåŠ¡å™¨ä¹‹é—´è¯·æ±‚å’Œåº”ç­”ä¹‹é—´èƒ½å®¹å¿çš„æœ€å¤šå¿ƒè·³æ•°ï¼ˆtickTimeçš„æ•°é‡ï¼‰ã€‚</div><div class="line"></div><div class="line">syncLimit=2  </div><div class="line"> </div><div class="line">4.dataDirï¼šæ•°æ®æ–‡ä»¶ç›®å½•</div><div class="line">Zookeeperä¿å­˜æ•°æ®çš„ç›®å½•ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒZookeeperå°†å†™æ•°æ®çš„æ—¥å¿—æ–‡ä»¶ä¹Ÿä¿å­˜åœ¨è¿™ä¸ªç›®å½•é‡Œã€‚</div><div class="line"></div><div class="line">dataDir=/data/tools/zookeeper/data</div><div class="line"></div><div class="line">5.dataLogDirï¼šæ—¥å¿—æ–‡ä»¶ç›®å½•</div><div class="line">Zookeeperä¿å­˜æ—¥å¿—æ–‡ä»¶çš„ç›®å½•ã€‚</div><div class="line"></div><div class="line">dataLogDir=/data/tools/zookeeper/<span class="built_in">log</span>  </div><div class="line"></div><div class="line">6.clientPortï¼šå®¢æˆ·ç«¯è¿æ¥ç«¯å£</div><div class="line">å®¢æˆ·ç«¯è¿æ¥ Zookeeper æœåŠ¡å™¨çš„ç«¯å£ï¼ŒZookeeper ä¼šç›‘å¬è¿™ä¸ªç«¯å£ï¼Œæ¥å—å®¢æˆ·ç«¯çš„è®¿é—®è¯·æ±‚ã€‚</div><div class="line"></div><div class="line">clientPort=2333  </div><div class="line"></div><div class="line">7.æœåŠ¡å™¨åç§°ä¸åœ°å€ï¼šé›†ç¾¤ä¿¡æ¯ï¼ˆæœåŠ¡å™¨ç¼–å·ï¼ŒæœåŠ¡å™¨åœ°å€ï¼ŒLFé€šä¿¡ç«¯å£ï¼Œé€‰ä¸¾ç«¯å£ï¼‰</div><div class="line">è¿™ä¸ªé…ç½®é¡¹çš„ä¹¦å†™æ ¼å¼æ¯”è¾ƒç‰¹æ®Šï¼Œè§„åˆ™å¦‚ä¸‹ï¼š</div><div class="line"></div><div class="line">server.N=YYY:A:B  </div><div class="line"></div><div class="line">å…¶ä¸­Nè¡¨ç¤ºæœåŠ¡å™¨ç¼–å·ï¼ŒYYYè¡¨ç¤ºæœåŠ¡å™¨çš„IPåœ°å€ï¼ŒAä¸ºLFé€šä¿¡ç«¯å£ï¼Œè¡¨ç¤ºè¯¥æœåŠ¡å™¨ä¸é›†ç¾¤ä¸­çš„leaderäº¤æ¢çš„ä¿¡æ¯çš„ç«¯å£ã€‚Bä¸ºé€‰ä¸¾ç«¯å£ï¼Œè¡¨ç¤ºé€‰ä¸¾æ–°leaderæ—¶æœåŠ¡å™¨é—´ç›¸äº’é€šä¿¡çš„ç«¯å£ï¼ˆå½“leaderæŒ‚æ‰æ—¶ï¼Œå…¶ä½™æœåŠ¡å™¨ä¼šç›¸äº’é€šä¿¡ï¼Œé€‰æ‹©å‡ºæ–°çš„leaderï¼‰ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œé›†ç¾¤ä¸­æ¯ä¸ªæœåŠ¡å™¨çš„Aç«¯å£éƒ½æ˜¯ä¸€æ ·ï¼Œæ¯ä¸ªæœåŠ¡å™¨çš„Bç«¯å£ä¹Ÿæ˜¯ä¸€æ ·ã€‚ä½†æ˜¯å½“æ‰€é‡‡ç”¨çš„ä¸ºä¼ªé›†ç¾¤æ—¶ï¼ŒIPåœ°å€éƒ½ä¸€æ ·ï¼Œåªèƒ½æ—¶Aç«¯å£å’ŒBç«¯å£ä¸ä¸€æ ·ã€‚</div><div class="line">ä¸‹é¢æ˜¯ä¸€ä¸ªéä¼ªé›†ç¾¤çš„ä¾‹å­ï¼š</div><div class="line"></div><div class="line">server.0=233.34.9.144:2008:6008  </div><div class="line">server.1=233.34.9.145:2008:6008  </div><div class="line">server.2=233.34.9.146:2008:6008  </div><div class="line">server.3=233.34.9.147:2008:6008  </div><div class="line"></div><div class="line">ä¸‹é¢æ˜¯ä¸€ä¸ªä¼ªé›†ç¾¤çš„ä¾‹å­ï¼š</div><div class="line"></div><div class="line">server.0=127.0.0.1:2008:6008  </div><div class="line">server.1=127.0.0.1:2007:6007  </div><div class="line">server.2=127.0.0.1:2006:6006  </div><div class="line">server.3=127.0.0.1:2005:6005</div></pre></td></tr></table></figure><h2 id="é«˜çº§é…ç½®-å®˜ç½‘ç¿»è¯‘"><a href="#é«˜çº§é…ç½®-å®˜ç½‘ç¿»è¯‘" class="headerlink" title="é«˜çº§é…ç½® (å®˜ç½‘ç¿»è¯‘)"></a>é«˜çº§é…ç½® (å®˜ç½‘ç¿»è¯‘)</h2><p>æœ¬èŠ‚çš„é…ç½®é€‰é¡¹æ˜¯å¯é€‰çš„ã€‚ä½ å¯ä»¥ä½¿ç”¨å®ƒä»¬è¿›ä¸€æ­¥çš„ä¼˜åŒ– ZooKeeper æœåŠ¡å™¨çš„è¡Œä¸ºã€‚æœ‰äº›å¯ä»¥ä½¿ç”¨ Java ç³»ç»Ÿå±æ€§æ¥è®¾ç½®, ä¸€èˆ¬çš„æ ¼å¼æ˜¯ â€œzookeeper.keywordâ€ã€‚å¦‚æœæœ‰å…·ä½“çš„ç³»ç»Ÿå±æ€§, ä¼šåœ¨é…ç½®é€‰é¡¹ä¸‹é¢æ ‡æ³¨å‡ºæ¥ã€‚</p><h4 id="dataLogDir"><a href="#dataLogDir" class="headerlink" title="dataLogDir"></a><code>dataLogDir</code></h4><p>æ²¡æœ‰å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§ã€‚</p><p>è¯¥å‚æ•°ç”¨äºé…ç½® ZooKeeper æœåŠ¡å™¨å­˜å‚¨äº‹åŠ¡æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„, ZooKeeper é»˜è®¤å°†äº‹åŠ¡æ—¥å¿—æ–‡ä»¶å’Œæ•°æ®å¿«ç…§å­˜å‚¨åœ¨åŒä¸€ä¸ªç›®å½•ä¸‹, åº”å°½é‡å°†å®ƒä»¬åˆ†å¼€å­˜å‚¨ã€‚</p><p>æ³¨æ„: å°†äº‹åŠ¡æ—¥å¿—æ–‡ä»¶å­˜å‚¨åˆ°ä¸€ä¸ªä¸“é—¨çš„æ—¥å¿—è®¾å¤‡ä¸Šå¯¹äºæœåŠ¡å™¨çš„ååé‡å’Œç¨³å®šçš„å»¶è¿Ÿæœ‰å¾ˆå¤§çš„å½±å“ã€‚äº‹åŠ¡æ—¥å¿—å¯¹ç£ç›˜æ€§èƒ½è¦æ±‚æ¯”è¾ƒé«˜, ä¸ºäº†ä¿è¯æ•°æ®ä¸€è‡´æ€§, ZooKeeper åœ¨å“åº”å®¢æˆ·ç«¯äº‹åŠ¡è¯·æ±‚ä¹‹å‰, éœ€è¦å°†è¯·æ±‚çš„äº‹åŠ¡æ—¥å¿—å†™åˆ°ç£ç›˜ä¸Š, æ‰€ä»¥äº‹åŠ¡æ—¥å¿—çš„å†™å…¥æ€§èƒ½ç›´æ¥å½±å“ ZooKeeper æœåŠ¡å™¨å¤„ç†è¯·æ±‚çš„ååã€‚æ‰€ä»¥å»ºè®®ç»™äº‹åŠ¡æ—¥å¿—çš„è¾“å‡ºé…ç½®ä¸€ä¸ªå•ç‹¬çš„ç£ç›˜æˆ–è€…æŒ‚è½½ç‚¹ã€‚</p><h3 id="globalOutstandingLimit"><a href="#globalOutstandingLimit" class="headerlink" title="globalOutstandingLimit"></a><code>globalOutstandingLimit</code></h3><p>å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: <code>zookeeper.globalOutstandingLimitã€‚</code></p><p>å®¢æˆ·ç«¯æäº¤è¯·æ±‚çš„é€Ÿåº¦å¯èƒ½æ¯” ZooKeeper å¤„ç†çš„é€Ÿåº¦å¿«å¾—å¤š, ç‰¹åˆ«æ˜¯å½“å®¢æˆ·ç«¯çš„æ•°é‡éå¸¸å¤šçš„æ—¶å€™ã€‚ä¸ºäº†é˜²æ­¢ ZooKeeper å› ä¸ºæ’é˜Ÿçš„è¯·æ±‚è€Œè€—å°½å†…å­˜, ZooKeeper å°†ä¼šå¯¹å®¢æˆ·ç«¯è¿›è¡Œé™æµ, å³é™åˆ¶ç³»ç»Ÿä¸­æœªå¤„ç†çš„è¯·æ±‚æ•°é‡ä¸è¶…è¿‡ globalOutstandingLimit è®¾ç½®çš„å€¼ã€‚é»˜è®¤çš„é™åˆ¶æ˜¯ 1,000ã€‚</p><h5 id="preAllocSize"><a href="#preAllocSize" class="headerlink" title="preAllocSize"></a><code>preAllocSize</code></h5><p>å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: <code>zookeeper.preAllocSizeã€‚</code></p><p>ç”¨äºé…ç½® ZooKeeper äº‹åŠ¡æ—¥å¿—æ–‡ä»¶é¢„åˆ†é…çš„ç£ç›˜ç©ºé—´å¤§å°ã€‚é»˜è®¤çš„å—å¤§å°æ˜¯ 64Mã€‚æ”¹å˜å—å¤§å°çš„å…¶ä¸­ä¸€ä¸ªåŸå› æ˜¯å½“æ•°æ®å¿«ç…§æ–‡ä»¶ç”Ÿæˆæ¯”è¾ƒé¢‘ç¹æ—¶å¯ä»¥é€‚å½“å‡å°‘å—å¤§å°ã€‚æ¯”å¦‚ 1000 æ¬¡äº‹åŠ¡ä¼šæ–°äº§ç”Ÿä¸€ä¸ªå¿«ç…§(å‚æ•°ä¸ºsnapCount), æ–°äº§ç”Ÿå¿«ç…§åä¼šç”¨æ–°çš„äº‹åŠ¡æ—¥å¿—æ–‡ä»¶, å‡è®¾ä¸€ä¸ªäº‹åŠ¡ä¿¡æ¯å¤§å°100b, é‚£ä¹ˆäº‹åŠ¡æ—¥å¿—é¢„åˆ†é…çš„ç£ç›˜ç©ºé—´å¤§å°ä¸º100kbä¼šæ¯”è¾ƒå¥½ã€‚</p><h4 id="snapCount"><a href="#snapCount" class="headerlink" title="snapCount"></a><code>snapCount</code></h4><p>å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: <code>zookeeper.snapCountã€‚</code></p><p>ZooKeeper å°†äº‹åŠ¡è®°å½•åˆ°äº‹åŠ¡æ—¥å¿—ä¸­ã€‚å½“ snapCount ä¸ªäº‹åŠ¡è¢«å†™åˆ°ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶å, å¯åŠ¨ä¸€ä¸ªå¿«ç…§å¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡æ—¥å¿—æ–‡ä»¶ã€‚snapCount çš„é»˜è®¤å€¼æ˜¯ 100,000ã€‚</p><h4 id="traceFile"><a href="#traceFile" class="headerlink" title="traceFile"></a><code>traceFile</code></h4><p>å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: <code>requestTraceFileã€‚</code></p><p>å¦‚æœå®šä¹‰äº†è¯¥é€‰é¡¹, é‚£ä¹ˆè¯·æ±‚å°†ä¼šè®°å½•åˆ°ä¸€ä¸ªåä¸º traceFile.year.month.day çš„è·Ÿè¸ªæ–‡ä»¶ä¸­ã€‚ä½¿ç”¨è¯¥é€‰é¡¹å¯ä»¥æä¾›å¾ˆæœ‰ç”¨çš„è°ƒè¯•ä¿¡æ¯, ä½†æ˜¯ä¼šå½±å“æ€§èƒ½ã€‚</p><p>æ³¨æ„: requestTraceFile è¿™ä¸ªç³»ç»Ÿå±æ€§æ²¡æœ‰ zookeeper å‰ç¼€, å¹¶ä¸”é…ç½®çš„å˜é‡åç§°å’Œç³»ç»Ÿå±æ€§ä¸ä¸€æ ·ã€‚</p><h4 id="maxClientCnxns"><a href="#maxClientCnxns" class="headerlink" title="maxClientCnxns"></a><code>maxClientCnxns</code></h4><p>æ²¡æœ‰å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§</p><p>åœ¨ socket çº§åˆ«é™åˆ¶å•ä¸ªå®¢æˆ·ç«¯åˆ° ZooKeeper é›†ç¾¤ä¸­å•å°æœåŠ¡å™¨çš„å¹¶å‘è¿æ¥æ•°é‡, å¯ä»¥é€šè¿‡ IP åœ°å€æ¥åŒºåˆ†ä¸åŒçš„å®¢æˆ·ç«¯ã€‚å®ƒç”¨æ¥é˜»æ­¢æŸç§ç±»å‹çš„ DoS æ”»å‡», åŒ…æ‹¬æ–‡ä»¶æè¿°ç¬¦èµ„æºè€—å°½ã€‚é»˜è®¤å€¼æ˜¯ 60ã€‚å°†å€¼è®¾ç½®ä¸º 0 å°†å®Œå…¨ç§»é™¤å¹¶å‘è¿æ¥çš„é™åˆ¶ã€‚</p><h4 id="clientPortAddress"><a href="#clientPortAddress" class="headerlink" title="clientPortAddress"></a><code>clientPortAddress</code></h4><p>æœåŠ¡å™¨ç›‘å¬å®¢æˆ·ç«¯è¿æ¥çš„åœ°å€ (ipv4, ipv6 æˆ– ä¸»æœºå) , äº¦å³å®¢æˆ·ç«¯å°è¯•è¿æ¥åˆ°æœåŠ¡å™¨ä¸Šçš„åœ°å€ã€‚è¯¥å‚æ•°æ˜¯å¯é€‰çš„, é»˜è®¤æˆ‘ä»¬ä»¥è¿™æ ·ä¸€ç§æ–¹å¼ç»‘å®š, å³å¯¹äºæœåŠ¡å™¨ä¸Šä»»æ„ address/interface/nic, ä»»ä½•è¿æ¥åˆ° clientPort çš„è¯·æ±‚å°†ä¼šè¢«æ¥å—ã€‚</p><h4 id="minSessionTimeout"><a href="#minSessionTimeout" class="headerlink" title="minSessionTimeout"></a><code>minSessionTimeout</code></h4><p>æ²¡æœ‰å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§</p><p>æœåŠ¡å™¨å…è®¸å®¢æˆ·ç«¯ä¼šè¯çš„æœ€å°è¶…æ—¶æ—¶é—´, ä»¥æ¯«ç§’ä¸ºå•ä½ã€‚é»˜è®¤å€¼æ˜¯ 2 å€çš„ tickTimeã€‚</p><h4 id="maxSessionTimeout"><a href="#maxSessionTimeout" class="headerlink" title="maxSessionTimeout"></a><code>maxSessionTimeout</code></h4><p>æ²¡æœ‰å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§</p><p>æœåŠ¡å™¨å…è®¸å®¢æˆ·ç«¯ä¼šè¯çš„æœ€å¤§è¶…æ—¶æ—¶é—´, ä»¥æ¯«ç§’ä¸ºå•ä½ã€‚é»˜è®¤å€¼æ˜¯ 20 å€çš„ tickTimeã€‚</p><h4 id="fsync-warningthresholdms"><a href="#fsync-warningthresholdms" class="headerlink" title="fsync.warningthresholdms"></a><code>fsync.warningthresholdms</code></h4><p>å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: <code>fsync.warningthresholdmsã€‚</code></p><p>ç”¨äºé…ç½® ZooKeeper è¿›è¡Œäº‹åŠ¡æ—¥å¿— (WAL) fsync æ“ä½œæ¶ˆè€—æ—¶é—´çš„æŠ¥è­¦é˜ˆå€¼, ä¸€æ—¦è¶…è¿‡è¿™ä¸ªé˜ˆå€¼å°†ä¼šæ‰“å°è¾“å‡ºæŠ¥è­¦æ—¥å¿—ã€‚è¯¥å‚æ•°çš„é»˜è®¤å€¼æ˜¯ 1000, ä»¥æ¯«ç§’ä¸ºå•ä½ã€‚å‚æ•°å€¼åªèƒ½ä½œä¸ºç³»ç»Ÿå±æ€§æ¥è®¾ç½®ã€‚</p><h4 id="autopurge-snapRetainCount"><a href="#autopurge-snapRetainCount" class="headerlink" title="autopurge.snapRetainCount"></a><code>autopurge.snapRetainCount</code></h4><p>æ²¡æœ‰å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§ã€‚</p><p>å½“å¯ç”¨è‡ªåŠ¨æ¸…ç†åŠŸèƒ½å, ZooKeeper å°†åªä¿ç•™ autopurge.snapRetainCount ä¸ªæœ€è¿‘çš„æ•°æ®å¿«ç…§(dataDir)å’Œå¯¹åº”çš„äº‹åŠ¡æ—¥å¿—æ–‡ä»¶(dataLogDir), å…¶ä½™çš„å°†ä¼šåˆ é™¤æ‰ã€‚é»˜è®¤å€¼æ˜¯ 3ã€‚æœ€å°å€¼ä¹Ÿæ˜¯ 3ã€‚</p><h4 id="autopurge-purgeInterval"><a href="#autopurge-purgeInterval" class="headerlink" title="autopurge.purgeInterval"></a><code>autopurge.purgeInterval</code></h4><p>æ²¡æœ‰å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§ã€‚</p><p>ç”¨äºé…ç½®è§¦å‘æ¸…ç†ä»»åŠ¡çš„æ—¶é—´é—´éš”, ä»¥å°æ—¶ä¸ºå•ä½ã€‚è¦å¯ç”¨è‡ªåŠ¨æ¸…ç†, å¯ä»¥å°†å…¶å€¼è®¾ç½®ä¸ºä¸€ä¸ªæ­£æ•´æ•° (å¤§äº 1) ã€‚é»˜è®¤å€¼æ˜¯ 0ã€‚</p><h4 id="syncEnabled"><a href="#syncEnabled" class="headerlink" title="syncEnabled"></a><code>syncEnabled</code></h4><p>å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: <code>zookeeper.observer.syncEnabledã€‚</code></p><p>å’Œå‚ä¸è€…ä¸€æ ·, è§‚å¯Ÿè€…ç°åœ¨é»˜è®¤å°†äº‹åŠ¡æ—¥å¿—ä»¥åŠæ•°æ®å¿«ç…§å†™åˆ°ç£ç›˜ä¸Š, è¿™å°†å‡å°‘è§‚å¯Ÿè€…åœ¨æœåŠ¡å™¨é‡å¯æ—¶çš„æ¢å¤æ—¶é—´ã€‚å°†å…¶å€¼è®¾ç½®ä¸º â€œfalseâ€ å¯ä»¥ç¦ç”¨è¯¥ç‰¹æ€§ã€‚é»˜è®¤å€¼æ˜¯ â€œtrueâ€ã€‚</p><p>é›†ç¾¤é…ç½®é€‰é¡¹</p><p>æœ¬èŠ‚ä¸­çš„é€‰é¡¹ä¸»è¦ç”¨äºZooKeeperé›†ç¾¤ã€‚</p><h4 id="electionAlg"><a href="#electionAlg" class="headerlink" title="electionAlg"></a><code>electionAlg</code></h4><p>æ²¡æœ‰å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§ã€‚</p><p>ç”¨äºé€‰æ‹©ä½¿ç”¨çš„ leader é€‰ä¸¾ç®—æ³•ã€‚â€0â€ å¯¹åº”äºåŸå§‹çš„åŸºäº UDP çš„ç‰ˆæœ¬, â€œ1â€ å¯¹åº”äºå¿«é€Ÿ leader é€‰ä¸¾åŸºäºUDPçš„æ— èº«ä»½éªŒè¯çš„ç‰ˆæœ¬, â€œ2â€ å¯¹åº”äºå¿«é€Ÿ leader é€‰ä¸¾æœ‰åŸºäºUDPçš„èº«ä»½éªŒè¯çš„ç‰ˆæœ¬, è€Œ â€œ3â€ å¯¹åº”äºå¿«é€Ÿ leader é€‰ä¸¾åŸºäºTCPçš„ç‰ˆæœ¬ã€‚ç›®å‰é»˜è®¤å€¼æ˜¯ç®—æ³• 3ã€‚</p><p>æ³¨æ„: leader é€‰ä¸¾ 0, 1, 2 è¿™ä¸‰ç§å®ç°å·²ç»åºŸå¼ƒ, åœ¨æ¥ä¸‹æ¥çš„ç‰ˆæœ¬ä¸­å°†ä¼šç§»é™¤å®ƒä»¬, è¿™æ ·å°±åªå‰©ä¸‹ FastLeaderElection ç®—æ³•ã€‚</p><h4 id="initLimit"><a href="#initLimit" class="headerlink" title="initLimit"></a><code>initLimit</code></h4><p>æ²¡æœ‰å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§ã€‚</p><p>é»˜è®¤å€¼æ˜¯ 10, å³ tickTime å±æ€§å€¼çš„ 10 å€ã€‚å®ƒç”¨äºé…ç½®å…è®¸ followers è¿æ¥å¹¶åŒæ­¥åˆ° leader çš„æœ€å¤§æ—¶é—´ã€‚å¦‚æœ ZooKeeper ç®¡ç†çš„æ•°æ®é‡å¾ˆå¤§çš„è¯å¯ä»¥å¢åŠ è¿™ä¸ªå€¼ã€‚</p><h4 id="leaderServes"><a href="#leaderServes" class="headerlink" title="leaderServes"></a><code>leaderServes</code></h4><p>å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: <code>zookeeper.leaderServesã€‚</code></p><p>ç”¨äºé…ç½® Leader æ˜¯å¦æ¥å—å®¢æˆ·ç«¯è¿æ¥, é»˜è®¤å€¼æ˜¯ â€œyesâ€, å³ leader å°†ä¼šæ¥å—å®¢æˆ·ç«¯è¿æ¥ã€‚åœ¨ ZooKeeper ä¸­, leader æœåŠ¡å™¨ä¸»è¦åè°ƒäº‹åŠ¡æ›´æ–°è¯·æ±‚ã€‚å¯¹äºäº‹åŠ¡æ›´æ–°è¯·æ±‚ååå¾ˆé«˜è€Œè¯»å–è¯·æ±‚ååå¾ˆä½çš„æƒ…å†µå¯ä»¥é…ç½® leader ä¸æ¥å—å®¢æˆ·ç«¯è¿æ¥, è¿™æ ·å°±å¯ä»¥ä¸“æ³¨äºåè°ƒå·¥ä½œã€‚</p><p>æ³¨æ„: å½“ ZooKeeper é›†ç¾¤ä¸­æœåŠ¡å™¨çš„æ•°é‡è¶…è¿‡ 3 ä¸ªæ—¶, å»ºè®®å¼€å¯ leader é€‰ä¸¾ã€‚</p><h4 id="server-x-hostname-nnnnn-nnnnn"><a href="#server-x-hostname-nnnnn-nnnnn" class="headerlink" title="server.x=[hostname]:nnnnn:nnnnn"></a><code>server.x=[hostname]:nnnnn:nnnnn</code></h4><p>æ²¡æœ‰å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§ã€‚</p><p>ç»„æˆ ZooKeeper é›†ç¾¤çš„æœåŠ¡å™¨ã€‚å½“æœåŠ¡å™¨å¯åŠ¨æ—¶, å¯ä»¥é€šè¿‡æŸ¥æ‰¾æ•°æ®ç›®å½•ä¸­çš„ myid æ–‡ä»¶æ¥å†³å®šå®ƒæ˜¯å“ªä¸€å°æœåŠ¡å™¨ã€‚myid æ–‡ä»¶åŒ…å«æœåŠ¡å™¨ç¼–å·, å¹¶ä¸”å®ƒè¦åŒ¹é… â€œserver.xâ€ ä¸­çš„ xã€‚</p><p>å®¢æˆ·ç«¯ç”¨æ¥ç»„æˆ ZooKeeper é›†ç¾¤çš„æœåŠ¡å™¨åˆ—è¡¨å¿…é¡»å’Œæ¯ä¸ª ZooKeeper æœåŠ¡å™¨ä¸­é…ç½®çš„ ZooKeeper æœåŠ¡å™¨åˆ—è¡¨ç›¸åŒ¹é…ã€‚</p><p>æœ‰ä¸¤ä¸ªç«¯å£å· nnnnn, ç¬¬ä¸€ä¸ªæ˜¯ followers ç”¨æ¥è¿æ¥åˆ° leader, ç¬¬äºŒä¸ªæ˜¯ç”¨äº leader é€‰ä¸¾ã€‚å¦‚æœæƒ³åœ¨å•å°æœºå™¨ä¸Šæµ‹è¯•å¤šä¸ªæœåŠ¡, åˆ™å¯ä»¥ä¸ºæ¯ä¸ªæœåŠ¡é…ç½®ä¸åŒçš„ç«¯å£ã€‚</p><h4 id="syncLimit"><a href="#syncLimit" class="headerlink" title="syncLimit"></a><code>syncLimit</code></h4><p>æ²¡æœ‰å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§ã€‚</p><p>é»˜è®¤å€¼æ˜¯ 5, å³ tickTime å±æ€§å€¼çš„ 5 å€ã€‚å®ƒç”¨äºé…ç½®leader å’Œ followers é—´è¿›è¡Œå¿ƒè·³æ£€æµ‹çš„æœ€å¤§å»¶è¿Ÿæ—¶é—´ã€‚å¦‚æœåœ¨è®¾ç½®çš„æ—¶é—´å†… followers æ— æ³•ä¸ leader è¿›è¡Œé€šä¿¡, é‚£ä¹ˆ followers å°†ä¼šè¢«ä¸¢å¼ƒã€‚</p><h4 id="group-x-nnnnn-nnnnn"><a href="#group-x-nnnnn-nnnnn" class="headerlink" title="group.x=nnnnn[:nnnnn]"></a><code>group.x=nnnnn[:nnnnn]</code></h4><p>æ²¡æœ‰å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§ã€‚</p><p>Enables a hierarchical quorum construction.â€xâ€ æ˜¯ä¸€ä¸ªç»„çš„æ ‡è¯†, ç­‰å·å³è¾¹çš„æ•°å­—å¯¹åº”äºæœåŠ¡å™¨çš„æ ‡è¯†. èµ‹å€¼æ“ä½œå³è¾¹æ˜¯å†’å·åˆ†éš”çš„æœåŠ¡å™¨æ ‡è¯†ã€‚æ³¨æ„: ç»„å¿…é¡»æ˜¯ä¸ç›¸äº¤çš„, å¹¶ä¸”æ‰€æœ‰ç»„è”åˆåå¿…é¡»æ˜¯ ZooKeeper é›†ç¾¤ã€‚</p><h4 id="weight-x-nnnnn"><a href="#weight-x-nnnnn" class="headerlink" title="weight.x=nnnnn"></a><code>weight.x=nnnnn</code></h4><p>æ²¡æœ‰å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§ã€‚</p><p>å’Œ â€œgroupâ€ ä¸€èµ·ä½¿ç”¨, å½“å½¢æˆé›†ç¾¤æ—¶å®ƒç»™æ¯ä¸ªæœåŠ¡å™¨èµ‹æƒé‡å€¼ã€‚è¿™ä¸ªå€¼å¯¹åº”äºæŠ•ç¥¨æ—¶æœåŠ¡å™¨çš„æƒé‡ã€‚ZooKeeper ä¸­åªæœ‰å°‘æ•°éƒ¨åˆ†éœ€è¦æŠ•ç¥¨, æ¯”å¦‚ leader é€‰ä¸¾ä»¥åŠåŸå­çš„å¹¿æ’­åè®®ã€‚æœåŠ¡å™¨æƒé‡çš„é»˜è®¤å€¼æ˜¯ 1ã€‚å¦‚æœé…ç½®æ–‡ä»¶ä¸­å®šä¹‰äº†ç»„, ä½†æ˜¯æ²¡æœ‰æƒé‡, é‚£ä¹ˆæ‰€æœ‰æœåŠ¡å™¨çš„æƒé‡å°†ä¼šèµ‹å€¼ä¸º 1ã€‚</p><h5 id="cnxTimeout"><a href="#cnxTimeout" class="headerlink" title="cnxTimeout"></a><code>cnxTimeout</code></h5><p>å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: <code>zookeeper.cnxTimeoutã€‚</code></p><p>ç”¨äºé…ç½® leaderé€‰ä¸¾è¿‡ç¨‹ä¸­ï¼Œæ‰“å¼€ä¸€æ¬¡è¿æ¥ï¼ˆé€‰ä¸¾çš„ server äº’ç›¸é€šä¿¡å»ºç«‹è¿æ¥ï¼‰çš„è¶…æ—¶æ—¶é—´ã€‚é»˜è®¤å€¼æ˜¯ 5sã€‚</p><h2 id="èº«ä»½è®¤è¯å’Œæˆæƒé€‰é¡¹"><a href="#èº«ä»½è®¤è¯å’Œæˆæƒé€‰é¡¹" class="headerlink" title="èº«ä»½è®¤è¯å’Œæˆæƒé€‰é¡¹"></a>èº«ä»½è®¤è¯å’Œæˆæƒé€‰é¡¹</h2><p>æœ¬èŠ‚çš„é€‰é¡¹å…è®¸é€šè¿‡èº«ä»½è®¤è¯å’Œæˆæƒæ¥æ§åˆ¶æœåŠ¡æ‰§è¡Œã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line">zookeeper.DigestAuthenticationProvider.superDigest</div><div class="line"></div><div class="line">å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: zookeeper.DigestAuthenticationProvider.superDigest</div><div class="line"></div><div class="line">è¯¥åŠŸèƒ½é»˜è®¤æ˜¯ç¦ç”¨çš„ã€‚</div><div class="line"></div><div class="line">èƒ½å¤Ÿä½¿ ZooKeeper é›†ç¾¤ç®¡ç†å‘˜å¯ä»¥ä½œä¸ºä¸€ä¸ª <span class="string">"super"</span> ç”¨æˆ·æ¥è®¿é—® znode å±‚çº§ç»“æ„ã€‚ç‰¹åˆ«æ˜¯å¯¹äºä¸€ä¸ªå·²ç»è®¤è¯ä¸ºè¶…çº§ç®¡ç†å‘˜çš„ç”¨æˆ·ä¸éœ€è¦ ACL æ£€æŸ¥ã€‚</div><div class="line"></div><div class="line">org.apache.zookeeper.server.auth.DigestAuthenticationProvider å¯ä»¥ç”¨æ¥ç”Ÿæˆ superDigest, è°ƒç”¨å®ƒå¸¦æœ‰ <span class="string">"super:&lt;password&gt;"</span> å‚æ•°çš„æ–¹æ³•ã€‚å½“å¯åŠ¨é›†ç¾¤ä¸­çš„æ¯å°æœåŠ¡å™¨æ—¶, å°†ç”Ÿæˆçš„ <span class="string">"super:&lt;data&gt;"</span> ä½œä¸ºç³»ç»Ÿå±æ€§æä¾›ã€‚</div><div class="line"></div><div class="line">å½“ ZooKeeper å®¢æˆ·ç«¯å‘ ZooKeeper æœåŠ¡å™¨è¿›è¡Œèº«ä»½è®¤è¯æ—¶, ä¼šä¼ é€’ä¸€ä¸ª <span class="string">"digest"</span> å’Œ <span class="string">"super:&lt;password&gt;"</span> çš„è®¤è¯æ•°æ®. æ³¨æ„æ‘˜è¦å¼èº«ä»½éªŒè¯å°†è®¤è¯æ•°æ®ä»¥æ™®é€šæ–‡æœ¬çš„å½¢å¼ä¼ é€’ç»™æœåŠ¡å™¨, åœ¨ç½‘ç»œä¸­éœ€è¦è°¨æ…ä½¿ç”¨è¯¥è®¤è¯æ–¹æ³•, è¦ä¹ˆåªåœ¨æœ¬æœºä¸Šæˆ–é€šè¿‡ä¸€ä¸ªåŠ å¯†çš„è¿æ¥ã€‚</div><div class="line"></div><div class="line"><span class="comment">### å®éªŒæ€§é€‰é¡¹/ç‰¹æ€§</span></div><div class="line"></div><div class="line">æœ¬èŠ‚åˆ—ä¸¾äº†ä¸€äº›ç›®å‰è¿˜å¤„äºå®éªŒé˜¶æ®µçš„æ–°ç‰¹æ€§ã€‚</div><div class="line"></div><div class="line"><span class="comment">### æœåŠ¡å™¨åªè¯»æ¨¡å¼</span></div><div class="line"></div><div class="line">å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: readonlymode.enabledã€‚</div><div class="line"></div><div class="line">å°†å…¶è®¾ç½®ä¸º <span class="literal">true</span> å°†ä¼šå¯ç”¨æœåŠ¡å™¨åªè¯»æ¨¡å¼æ”¯æŒ, é»˜è®¤æ˜¯ç¦ç”¨çš„ã€‚ROM å…è®¸è¯·æ±‚äº† ROM æ”¯æŒçš„å®¢æˆ·ç«¯ä¼šè¯è¿æ¥åˆ°æœåŠ¡å™¨, å³ä½¿å½“æœåŠ¡å™¨å¯èƒ½å·²ç»ä»é›†ç¾¤ä¸­åˆ†éš”å‡ºå»ã€‚åœ¨è¯¥æ¨¡å¼ä¸­, ROM å®¢æˆ·ç«¯ä»ç„¶å¯ä»¥ä» ZK æœåŠ¡ä¸­è¯»å–å€¼, ä½†æ˜¯ä¸èƒ½è¿›è¡Œå†™æ“ä½œä»¥åŠçœ‹è§å…¶å®ƒå®¢æˆ·ç«¯æ‰€åšçš„ä¸€äº›å˜æ›´ã€‚æ›´å¤šè¯¦ç»†ä¿¡æ¯å¯ä»¥å‚è§ ZOOKEEPER-784 è·å–æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚</div><div class="line"></div><div class="line"><span class="comment">### ä¸å®‰å…¨çš„é€‰é¡¹</span></div><div class="line"></div><div class="line">ä¸‹é¢çš„é€‰é¡¹ä¼šå¾ˆæœ‰ç”¨, ä½†æ˜¯ä½¿ç”¨çš„æ—¶å€™éœ€è¦ç‰¹åˆ«å°å¿ƒã€‚</div><div class="line"></div><div class="line"><span class="comment">### forceSync</span></div><div class="line"></div><div class="line">å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: zookeeper.forceSyncã€‚</div><div class="line"></div><div class="line">ç”¨äºé…ç½®æ˜¯å¦éœ€è¦åœ¨äº‹åŠ¡æ—¥å¿—æäº¤çš„æ—¶å€™è°ƒç”¨ FileChannel.force æ¥ä¿è¯æ•°æ®å®Œå…¨åŒæ­¥åˆ°ç£ç›˜ã€‚é»˜è®¤å€¼æ˜¯ <span class="string">"yes"</span>ã€‚å¦‚æœè¯¥é€‰é¡¹è®¾ç½®ä¸º <span class="string">"no"</span>, ZooKeeper å°†ä¸ä¼šå¼ºåˆ¶åŒæ­¥äº‹åŠ¡æ›´æ–°æ—¥å¿—åˆ°ç£ç›˜ã€‚</div><div class="line"></div><div class="line"><span class="comment">### jute.maxbuffer:</span></div><div class="line"></div><div class="line">å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: jute.maxbufferã€‚æ²¡æœ‰ zookeeper å‰ç¼€ã€‚</div><div class="line"></div><div class="line">ç”¨äºæŒ‡å®šä¸€ä¸ª znode ä¸­å¯ä»¥å­˜å‚¨æ•°æ®é‡çš„æœ€å¤§å€¼, é»˜è®¤å€¼æ˜¯ 0xfffff, æˆ– 1M å†…ã€‚å¦‚æœè¿™ä¸ªé€‰é¡¹æ”¹å˜äº†, é‚£ä¹ˆè¯¥ç³»ç»Ÿå±æ€§å¿…é¡»åœ¨æ‰€æœ‰çš„æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯è¿›è¡Œè®¾ç½®, å¦åˆ™ä¼šå‡ºç°é—®é¢˜ã€‚ZooKeeperæ—¨åœ¨å­˜å‚¨å¤§å°ä¸ºåƒå­—èŠ‚æ•°é‡çš„æ•°æ®ã€‚</div><div class="line"></div><div class="line"><span class="comment">### skipACL</span></div><div class="line"></div><div class="line">å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: zookeeper.skipACLã€‚</div><div class="line"></div><div class="line">ç”¨äºé…ç½® ZooKeeper æœåŠ¡å™¨è·³è¿‡ ACL æƒé™æ£€æŸ¥ã€‚è¿™å°†ä¸€å®šç¨‹åº¦çš„æé«˜æœåŠ¡å™¨ååé‡, ä½†æ˜¯ä¹Ÿå‘æ‰€æœ‰å®¢æˆ·ç«¯å®Œå…¨å¼€æ”¾æ•°æ®è®¿é—®ã€‚</div><div class="line"></div><div class="line"><span class="comment">### quorumListenOnAllIPs</span></div><div class="line"></div><div class="line">å½“è®¾ç½®ä¸º <span class="literal">true</span> æ—¶, ZooKeeper æœåŠ¡å™¨å°†ä¼šåœ¨æ‰€æœ‰å¯ç”¨çš„ IP åœ°å€ä¸Šç›‘å¬æ¥è‡ªå…¶å¯¹ç­‰ç‚¹çš„è¿æ¥è¯·æ±‚, è€Œä¸ä»…æ˜¯é…ç½®æ–‡ä»¶çš„æœåŠ¡å™¨åˆ—è¡¨ä¸­é…ç½®çš„åœ°å€ã€‚å®ƒä¼šå½±å“å¤„ç† ZAB åè®®å’Œ Fast Leader Election åè®®çš„è¿æ¥ã€‚é»˜è®¤å€¼æ˜¯ <span class="literal">false</span>ã€‚</div></pre></td></tr></table></figure><h3 id="äº¤æµå­¦ä¹ ï¼š"><a href="#äº¤æµå­¦ä¹ ï¼š" class="headerlink" title="äº¤æµå­¦ä¹ ï¼š"></a>äº¤æµå­¦ä¹ ï¼š</h3><p>ğŸ§  Linux shell_é«˜çº§è¿ç»´æ´¾: <code>459096184</code>    åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)<br>ğŸ§  BigData-Exchange School : <code>521621407</code>  åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥</p><p>ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h3&gt;&lt;p&gt;&lt;code&gt;ZooKeeper&lt;/code&gt;çš„åŠŸèƒ½ç‰¹æ€§é€šè¿‡ &lt;code&gt;ZooKeeper&lt;/code&gt; é…ç½®æ–‡ä»¶æ¥è¿›è¡Œæ§åˆ¶ç®¡ç†ï¼ˆ &lt;code&gt;zoo.cfg&lt;/code&gt; é…ç½®æ–‡ä»¶ï¼‰ã€‚ ZooKeeper è¿™æ ·çš„è®¾è®¡å…¶å®æ˜¯æœ‰å®ƒè‡ªèº«çš„åŸå› çš„ã€‚é€šè¿‡å‰é¢å¯¹ &lt;code&gt;ZooKeeper&lt;/code&gt; çš„é…ç½®å¯ä»¥çœ‹å‡ºï¼Œå¯¹ &lt;code&gt;ZooKeeper&lt;/code&gt;é›†ç¾¤è¿›è¡Œé…ç½®çš„æ—¶å€™ï¼Œå®ƒçš„é…ç½®æ–‡æ¡£æ˜¯å®Œå…¨ç›¸åŒçš„ï¼ˆå¯¹äºé›†ç¾¤ä¼ªåˆ†å¸ƒæ¨¡å¼æ¥è¯´ï¼Œåªæœ‰å¾ˆå°‘çš„éƒ¨åˆ†æ˜¯ä¸åŒçš„ï¼‰ã€‚è¿™æ ·çš„é…ç½®æ–¹ä½¿å¾—åœ¨éƒ¨ç½² &lt;code&gt;ZooKeeper&lt;/code&gt; æœåŠ¡çš„æ—¶å€™éå¸¸åœ°æ–¹ä¾¿ã€‚å¦å¤–ï¼Œå¦‚æœæœåŠ¡å™¨ä½¿ç”¨ä¸åŒçš„é…ç½®æ–‡ä»¶ï¼Œå¿…é¡»è¦ç¡®ä¿ä¸åŒé…ç½®æ–‡ä»¶ä¸­çš„æœåŠ¡å™¨åˆ—è¡¨ç›¸åŒ¹é…ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è®¾ç½® &lt;code&gt;ZooKeeper&lt;/code&gt; é…ç½®æ–‡æ¡£çš„æ—¶å€™ï¼ŒæŸäº›å‚æ•°æ˜¯å¯é€‰çš„ï¼Œä½†æ˜¯æŸäº›å‚æ•°æ˜¯å¿…é¡»çš„ã€‚è¿™äº›å¿…é¡»çš„å‚æ•°å°±æ„æˆäº†&lt;code&gt;ZooKeeper&lt;/code&gt; é…ç½®æ–‡æ¡£çš„æœ€ä½é…ç½®è¦æ±‚ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Bigdata" scheme="http://blog.yancy.cc/categories/Bigdata/"/>
    
    
      <category term="ZooKeeper" scheme="http://blog.yancy.cc/tags/ZooKeeper/"/>
    
  </entry>
  
</feed>
