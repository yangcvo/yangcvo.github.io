<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="theme-color" content="#33474d">
	<title>è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·--Saltstackå®‰è£…éƒ¨ç½²é…ç½®ä½¿ç”¨ | Yancy&#39;s blog</title>
	<link rel="stylesheet" href="/css/style.css" />
	
      <link rel="alternate" href="/atom.xml" title="Yancy&#39;s blog" type="application/atom+xml">
    
</head>

<body>

	<header class="header">
		<nav class="header__nav">
			
				<a href="/" class="header__link">Home</a>
			
				<a href="/tags" class="header__link">Tags</a>
			
				<a href="/archives" class="header__link">ARCHIVES</a>
			
				<a href="/about/About" class="header__link">ABOUT</a>
			
				<a href="http://weibo.com/yangcvo" class="header__link">Weibo</a>
			
				<a href="/atom.xml" class="header__link">RSS</a>
			
		</nav>
		<h1 class="header__title"><a href="/">Yancy&#39;s blog</a></h1>
		<h2 class="header__subtitle">SIMPLICITY IS PREREQUISITE FOR  RELIABILITY</h2>
	</header>

	<main>
		<article>
	
		<h1>è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·--Saltstackå®‰è£…éƒ¨ç½²é…ç½®ä½¿ç”¨</h1>
	
	<div class="article__infos">
		<span class="article__date">2015-10-10</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/Automation/">Automation</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Saltstack/">Saltstack</a>
			</span>
		
	</div>

	

	
		<h1 id="è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·â€“Saltstackå®‰è£…éƒ¨ç½²é…ç½®ä½¿ç”¨"><a href="#è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·â€“Saltstackå®‰è£…éƒ¨ç½²é…ç½®ä½¿ç”¨" class="headerlink" title="è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·â€“Saltstackå®‰è£…éƒ¨ç½²é…ç½®ä½¿ç”¨"></a>è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·â€“Saltstackå®‰è£…éƒ¨ç½²é…ç½®ä½¿ç”¨</h1><p>å‰è¨€ï¼š</p>
<p>å¼€å§‹å­¦saltstackçš„æ—¶å€™æ˜¯åœ¨ç°åœ¨ä¸€å®¶åšCDNäº‘åŠ é€Ÿçš„é‚£æ˜¯åœ¨2014å¹´ï¼Œsaltåˆšåˆšå‡ºæ¥æ‰€ä»¥æˆ‘è§‰å¾—æˆ‘æ¥è§¦åº”è¯¥ä¹Ÿç®—æ—©çš„ã€‚ ä½¿ç”¨æœ€å¤šçš„åŒæ­¥ä¸‹å‘çš„ç”¨åˆ°è¿™ä¸ªå·¥å…·ï¼Œä¸‹é¢æˆ‘ç®€å•ä»‹ç»å’Œæ“ä½œç»™å¤§å®¶çœ‹ä¸‹ã€‚<br>Salt å’Œ Puppet Chef ä¸€æ ·å¯ä»¥è®©ä½ åŒæ—¶åœ¨å¤šå°æœåŠ¡å™¨ä¸Šæ‰§è¡Œå‘½ä»¤ä¹ŸåŒ…æ‹¬å®‰è£…å’Œé…ç½®è½¯ä»¶ã€‚</p>
<p>Salt æœ‰ä¸¤ä¸ªä¸»è¦çš„åŠŸèƒ½ï¼š<code>é…ç½®ç®¡ç†å’Œè¿œç¨‹æ‰§è¡Œ</code>ã€‚ Saltstackæ˜¯ä¸€ä¸ªå¤§å‹åˆ†å¸ƒå¼çš„é…ç½®ç®¡ç†ç³»ç»Ÿï¼ˆå®‰è£…å‡çº§å¸è½½è½¯ä»¶ï¼Œæ£€æµ‹ç¯å¢ƒï¼‰ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªè¿œç¨‹å‘½ä»¤æ‰§è¡Œç³»ç»Ÿã€‚é€šè¿‡c/sçš„æ¨¡å‹å®ç°ã€‚æœåŠ¡å™¨ç«¯å¯¹è¿œç¨‹å®¢æˆ·æœºçš„æ“ä½œï¼š</p>
<p>###ï¼ˆä¸€ï¼‰éƒ¨ç½²è™šæ‹ŸåŒ–ç¯å¢ƒ</p>
<p>ï¼ˆ1ï¼‰ä¸¤ç»„æœåŠ¡å™¨è¿›è¡Œï¼Œæ“ä½œç³»ç»Ÿç‰ˆæœ¬ä¸ºCentos release 6.4 RHEL ä¹Ÿå¯ä»¥ã€‚ ï¼ˆ2ï¼‰å®‰è£…è¿™ä¸ªå…ˆå®‰è£…ä¸‹epel ç”±äºç°åœ¨ç½‘ç»œRHELå®˜ç½‘yumæºè¿˜æ²¡æœ‰ saltstackçš„å®‰è£…åŒ…æ”¯æŒã€‚å› æ­¤å…ˆå®‰è£…epelä½œä¸ºéƒ¨ç½²saltstackçš„é»˜è®¤yumæºã€‚</p>
<ul>
<li>CenOs 5 ç‰ˆæœ¬: rpm -Uvh ä¸‹è½½åœ°å€ï¼š<a href="http://ftp.linux.ncsu.edu/pud/epel/6/i386/epel-release-5-4.noarch.rpm" target="_blank" rel="external">http://ftp.linux.ncsu.edu/pud/epel/6/i386/epel-release-5-4.noarch.rpm</a></li>
<li>CenOs 6 ç‰ˆæœ¬: rpm -Uvh ä¸‹è½½åœ°å€ï¼š<a href="http://ftp.linux.ncsu.edu/pud/epel/6/i386/epel-release-6-8.noarch.rpm" target="_blank" rel="external">http://ftp.linux.ncsu.edu/pud/epel/6/i386/epel-release-6-8.noarch.rpm</a></li>
<li>ç™¾åº¦äº‘ä¹Ÿå¯ä»¥å»ä¸‹è½½ï¼Œæˆ‘çš„æ˜¯centos 64ä½çš„ <a href="http://pan.baidu.com/s/1eQGWboI" target="_blank" rel="external">http://pan.baidu.com/s/1eQGWboI</a></li>
</ul>
<p><code>(1) ä¸»æœåŠ¡å™¨ ï¼ˆä¸»æ§ç«¯ï¼‰ IPï¼š192.168.23.21</code></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="selector-id">#rpm</span> -ivh http:<span class="comment">//mirrors.sohu.com/fedora-epel/6/x86_64/epel-release-6-8.noarch.rpm</span></div><div class="line"><span class="selector-id">#yum</span> install salt-master -y    ï¼ˆå®‰è£…salt-masterï¼‰</div><div class="line"><span class="selector-id">#chkconfig</span> salt-master on</div><div class="line"><span class="selector-id">#service</span> salt-master start</div></pre></td></tr></table></figure>
<p><code>(2)ä»æœåŠ¡å™¨å®‰è£… ï¼ˆè¢«æ§ç«¯ï¼‰IPï¼š192.168.23.24</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash">yum install salt-minion -y ï¼ˆå®‰è£…salt-minionï¼‰</span></div><div class="line"><span class="meta">#</span><span class="bash">chkconfig salt-master on</span></div><div class="line"><span class="meta">#</span><span class="bash">service salt-master start</span></div></pre></td></tr></table></figure>
<p>åˆ°è¿™é‡Œå·²ç»å®‰è£…å®Œæˆã€‚</p>
<p><code>Saltstack é˜²ç«å¢™é…ç½®</code></p>
<p>åœ¨ä¸»æ§ç«¯æ·»åŠ TCP 4505,TCP 4506 çš„è§„åˆ™ï¼Œè€Œåœ¨è¢«æ§ç«¯æ— é¡»é…ç½®é˜²ç«å¢™ï¼ŒåŸç†æ˜¯è¢«æ§ç«¯ç›´æ¥ä¸ä¸»æ§ç«¯çš„zerompå»ºç«‹é“¾æ¥ã€‚ æ¥æ”¶ å¹¿æ’­é“ä»»åŠ¡ä¿¡æ¯å¹¶æ‰§è¡Œï¼Œå…·ä½“æ“ä½œæ˜¯æ·»åŠ ä¸¤æ¡iptablesè§„åˆ™ï¼š</p>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">-A INPUT -m <span class="keyword">state</span> --state new -m tcp -p tcp --dport <span class="number">4505</span> -j ACCEPT</div><div class="line">-A INPUT -m <span class="keyword">state</span> --state new -m tcp -p tcp --dport <span class="number">4506</span> -j ACCEPT</div></pre></td></tr></table></figure>
<p>é»˜è®¤é…ç½®æ–‡ä»¶ä½äº/etc/salt/master ï¼Œé»˜è®¤ä¸éœ€è¦æ›´æ”¹è¯¥é…ç½®æ–‡ä»¶ã€‚masterç«¯æœ‰ä¸¤ä¸ªç«¯å£éœ€è¦åœ¨iptablesä¸Šæ”¾è¡Œ.</p>
<p><strong>éƒ¨ç½²è¦æ±‚ï¼šä¸¤å°æœºå™¨ç½‘ç»œäº’é€šï¼Œæœ€å¥½å…³é—­é˜²ç«å¢™ã€‚å…³é—­selinux. åœ¨å¯åŠ¨ä¸‹æœåŠ¡ã€‚</strong></p>
<p>æ›´æ–°Saltstack é…ç½®åŠå®‰è£…æ•ˆéªŒã€‚</p>
<p>Saltsatack åˆ†ä¸¤ç§ï¼Œä¸€ç§ä¸ºmaster (ä¸»æ§åˆ¶)ï¼Œå¦ä¸€ç«¯ä¸ºminion (è¢«æ§ç«¯)ï¼Œå®‰è£…å®Œæ¯•åéœ€è¦å¯¹ä¸¤ç§è§’è‰²çš„é…ç½®æ–‡ä»¶è¿›è¡Œä¿®æ”¹ã€‚ å…·ä½“è¯´æ˜å¦‚ä¸‹ï¼š</p>
<p>ï¼ˆ1ï¼‰ master ä¸»æ§ç«¯é…ç½®</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">  vim /etc/salt/master</div><div class="line">  # ç»‘å®šMaster é€šä¿¡<span class="built_in">IP</span>ï¼›</div><div class="line">  interface :<span class="number">192.168</span><span class="meta">.23</span><span class="meta">.21</span></div><div class="line">  #è‡ªåŠ¨è®¤è¯ï¼Œé¿å…æ‰‹åŠ¨è¿è¡Œsalt-key æ¥ç¡®è®¤è¯ä¹¦ä¿¡ä»»ï¼›</div><div class="line">  auto-accept:True</div><div class="line"></div><div class="line">  ä¿®æ”¹/etc/hosts</div><div class="line">ä¸»æœºè¦æ·»åŠ è¢«æ§æœºå™¨çš„<span class="built_in">IP</span> å’Œä¸»æœºå</div><div class="line"><span class="number">192.168</span><span class="meta">.23</span><span class="meta">.24</span>  xx.rix.com</div></pre></td></tr></table></figure>
<p><strong>æœåŠ¡ç«¯é…ç½®</strong></p>
<p>ä¸»æ§ç«¯åŸºæœ¬è®¾ç½® ç¼–è¾‘é…ç½®æ–‡ä»¶ /etc/salt/master,ä¿®æ”¹å¦‚ä¸‹æ‰€ç¤ºé…ç½®é¡¹ï¼Œå»æ‰å‰é¢çš„æ³¨é‡Šç¬¦</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">interface:</span> <span class="number">192.168</span><span class="number">.23</span><span class="number">.21</span></div><div class="line"><span class="symbol">log_file:</span> <span class="meta-keyword">/var/</span>log<span class="meta-keyword">/salt/</span>master      <span class="meta"># è®°å½•ä¸»æ§ç«¯è¿è¡Œæ—¥å¿—</span></div><div class="line"><span class="symbol">key_logfile:</span> <span class="meta-keyword">/var/</span>log<span class="meta-keyword">/salt/</span>key      <span class="meta"># è®°å½•è®¤è¯è¯ä¹¦æ—¥å¿—</span></div></pre></td></tr></table></figure>
<p> <strong>å®¢æˆ·ç«¯é…ç½®</strong> </p>
<p>ä¿®æ”¹/etc/hosts</p>
<p>ä¸»æœºè¦æ·»åŠ æœåŠ¡ç«¯æœºå™¨çš„IP å’Œä¸»æœºå</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">192<span class="selector-class">.168</span><span class="selector-class">.23</span><span class="selector-class">.21</span>  <span class="selector-tag">salt</span></div></pre></td></tr></table></figure>
<p> å—æ§ç«¯åŸºæœ¬è®¾ç½® ç¼–è¾‘é…ç½®æ–‡ä»¶ /etc/salt/minion,ä¿®æ”¹å¦‚ä¸‹æ‰€ç¤ºé…ç½®é¡¹ï¼Œå»æ‰å‰é¢çš„æ³¨é‡Šç¬¦#</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="literal">master</span>: <span class="number">192.168</span>.<span class="number">23.21</span>        <span class="comment"># è®¾ç½®ä¸»æ§ç«¯</span></div><div class="line">è¿™é‡Œ<span class="literal">master</span>è®¾ç½®ä¸»æ§ç«¯å¯ä»¥hostsåç§°ï¼š</div><div class="line"><span class="comment">#master: salt</span></div><div class="line">å‰ææ˜¯è¦è®¾ç½®hosts.</div></pre></td></tr></table></figure>
<p>æˆ‘è¿™é‡Œç›´æ¥é…ç½®çš„æ˜¯ä¸»æœºåï¼Œä¹Ÿå¯ä»¥é…ç½®æˆIPåœ°å€ï¼Œå¦‚æœé…ç½®æˆä¸»æœºåçš„è¯ï¼Œå°±éœ€è¦åœ¨/etc/hostsæ–‡ä»¶ä¸­masterä¸»æœºå¯¹åº”çš„IP ï¼Œå¦‚æœä½¿ç”¨å†…éƒ¨DNSçš„ä¾‹å¤–ï¼Œå¯ä»¥åœ¨å†…éƒ¨DNSä¸Šçš„ç»Ÿä¸€é…ç½®ã€‚</p>
<p>åœ¨å…¶ä¸‹å¢åŠ ä¸€è¡Œå†…å®¹ä¸ºï¼š</p>
<figure class="highlight qml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- <span class="attribute">id:</span><span class="string"> tomcatA1</span></div></pre></td></tr></table></figure>
<p>è¿™é‡Œæ˜¯æŒ‡å®šå½“å‰ä¸»æœºçš„idå·ï¼Œè¿™åœ¨åé¢masterè®¤è¯å’Œmasterè°ƒç”¨å‘½ä»¤æ‰§è¡Œæ—¶æ˜¾ç¤ºçš„åç§°ï¼Œå¯ä»¥æ ¹æ®å®é™…è¯†åˆ«éœ€è¦å¡«å†™ã€‚å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>ä»¥ä¸Šä¸¤å¤„é…ç½®å†’å·åé¢éƒ½éœ€è¦æœ‰ä¸€ä¸ªç©ºæ ¼ï¼Œä¸ç„¶ä¼šæŠ¥å¦‚ä¸‹é”™è¯¯ï¼š</code></p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">log_file:</span> <span class="meta-keyword">/var/</span>log<span class="meta-keyword">/salt/</span>minion  <span class="meta"># è®°å½•å—æ§ç«¯è¿è¡Œæ—¥å¿—</span></div><div class="line"><span class="symbol">key_logfile:</span> <span class="meta-keyword">/var/</span>log<span class="meta-keyword">/salt/</span>key  <span class="meta"># è®°å½•è®¤è¯è¯ä¹¦æ—¥å¿—</span></div></pre></td></tr></table></figure>
<p><strong>ä¸»æ§ç«¯å’Œå—æ§ç«¯</strong></p>
<p> å¯åŠ¨å„è‡ªçš„æœåŠ¡ï¼Œç¡®ä¿æœåŠ¡å¯åŠ¨åæ²¡æœ‰ä»»ä½•æŠ¥é”™ä¿¡æ¯,å¦‚æœå¼‚å¸¸è¯·æ£€æŸ¥ç›¸åº”æ—¥å¿—æ–‡ä»¶å¤„ç†</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ä¸»æ§ç«¯: service salt-<span class="keyword">master</span> <span class="title">restart</span></div><div class="line">å—æ§ç«¯: service salt-minion restart</div></pre></td></tr></table></figure>
<p>saltstack ä¸»æ§ç«¯æ˜¯ä¾é opensslè¯ä¹¦æ¥ä¸å—æ§ç«¯ä¸»æœºè®¤è¯é€šè®¯çš„ï¼Œå—æ§ç«¯å¯åŠ¨åä¼šå‘é€ç»™ä¸»æ§ç«¯ä¸€ä¸ªå…¬é’¥è¯ä¹¦æ–‡ä»¶ï¼Œåœ¨ä¸»æ§ç«¯ç”¨ salt-key å‘½ä»¤æ¥ç®¡ç†è¯ä¹¦ã€‚</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">salt-<span class="built_in">key</span> -L                  <span class="meta"># ç”¨æ¥æŸ¥çœ‹è¯ä¹¦æƒ…å†µ</span></div><div class="line">salt-<span class="built_in">key</span> -a æœåŠ¡ç«¯åç§°æˆ–IP    <span class="meta"># ç”¨æ¥ç®¡ç†æ¥å—è¯ä¹¦</span></div><div class="line">salt-<span class="built_in">key</span> -A                <span class="meta"># ç”¨æ¥ç®¡ç†æ¥å—æ‰€æœ‰è®¤è¯ä¸»æœºçš„è®¤è¯</span></div></pre></td></tr></table></figure>
<p>ä¸»æ§ç«¯å’Œè¢«æ§ç«¯çš„è¯ä¹¦é»˜è®¤éƒ½å­˜æ”¾åœ¨<code>/etc/salt/pki/</code> ä¸­ï¼Œå¦‚æœé‡åˆ°è¯ä¹¦ä¸ç”Ÿæ•ˆçš„æƒ…å†µä¸‹ï¼Œå¯åœ¨ä¸»æ§ç«¯è¯ä¹¦å­˜æ”¾ç›®å½•åˆ é™¤å—æ§ç«¯è¯ä¹¦ï¼Œé‡æ–°è®¤è¯ä¸€ä¸‹ã€‚</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="selector-attr">[root@ny-cloud-pagespeed00 ~]</span># <span class="selector-tag">salt-key</span> <span class="selector-tag">-a</span>  192<span class="selector-class">.168</span><span class="selector-class">.23</span><span class="selector-class">.24</span></div><div class="line"><span class="selector-tag">The</span> <span class="selector-tag">following</span> <span class="selector-tag">keys</span> <span class="selector-tag">are</span> <span class="selector-tag">going</span> <span class="selector-tag">to</span> <span class="selector-tag">be</span> <span class="selector-tag">accepted</span>:</div><div class="line"><span class="selector-tag">Unaccepted</span> <span class="selector-tag">Keys</span>:</div><div class="line">192<span class="selector-class">.168</span><span class="selector-class">.23</span><span class="selector-class">.24</span></div><div class="line"><span class="selector-tag">Proceed</span>? <span class="selector-attr">[n/Y]</span> <span class="selector-tag">y</span>   #è¿™é‡Œè¾“å…¥<span class="selector-tag">y</span> ä»£è¡¨åŒæ„åŠ å…¥è¯ä¹¦ã€‚</div><div class="line"></div><div class="line"><span class="selector-attr">[root@ny-cloud-pagespeed00 minions]</span># <span class="selector-tag">salt</span> <span class="selector-tag">-v</span> "<span class="selector-tag">xx</span><span class="selector-class">.rix</span><span class="selector-class">.com</span>" <span class="selector-tag">test</span><span class="selector-class">.ping</span>  #è¿™é‡Œçš„<span class="selector-class">.com</span>æ˜¯å—æ§æœºçš„<span class="selector-tag">hostname</span> è®¤è¯åç§°ã€‚</div><div class="line"></div><div class="line"><span class="selector-tag">Executing</span> <span class="selector-tag">job</span> <span class="selector-tag">with</span> <span class="selector-tag">jid</span> 20151004162442004183</div><div class="line"> <span class="selector-tag">-------------------------------------------</span></div><div class="line"></div><div class="line"><span class="selector-tag">xx</span><span class="selector-class">.rix</span><span class="selector-class">.com</span>:</div><div class="line"><span class="selector-tag">True</span></div></pre></td></tr></table></figure>
<p>è¿™é‡Œå¯ä»¥è·å–åˆ°è®¤è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬æŠŠè®¤è¯åŠ è¿›å»ã€‚</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">[root@salt ~]<span class="comment"># salt-key -L</span></div><div class="line">Accepted Keys:</div><div class="line">Gateway1</div><div class="line">Gateway2</div><div class="line">ihaozhuo1</div><div class="line">ihaozhuo2</div><div class="line"><span class="keyword">node</span></div><div class="line"><span class="title">openapi</span></div><div class="line">report1</div><div class="line">report2</div><div class="line">tomcat_A1</div><div class="line">tomcat_A2</div><div class="line">tomcat_B1</div><div class="line">tomcat_B2</div><div class="line">tomcat_bmw</div><div class="line">tomcat_C1</div><div class="line">tomcat_C2</div><div class="line">weixin</div><div class="line">Denied Keys:</div><div class="line">Unaccepted Keys:</div><div class="line">Rejected Keys:</div></pre></td></tr></table></figure>
<p>æˆ‘ä¸Šé¢ç”¨çš„-Aå‚æ•°ï¼Œè¯¥å‚æ•°æ„æ€æ˜¯æ¥å—æ‰€æœ‰è®¤è¯ä¸»æœºçš„è®¤è¯ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ -a idå åªè®¤è¯å•ç‹¬çš„ä¸»æœºã€‚é»˜è®¤è®¤è¯å®Œæˆåä¼šåœ¨/etc/salt/pki/master/minionsç›®å½•æ‰¾åˆ°ä»¥IDåå‘½ä»¤çš„æ–‡ä»¶ï¼Œé‡Œé¢å­˜æ”¾çš„æ˜¯å¯†é’¥æ–‡ä»¶ã€‚</p>
<p>å¦‚æœå¯¹å®¢æˆ·ç«¯ä¿¡ä»»ï¼Œå¯ä»¥è®©masterè‡ªåŠ¨æ¥å—è¯·æ±‚ï¼Œåœ¨masterç«¯/etc/salt/masteré…ç½®ã€‚</p>
<h3 id="ï¼ˆäºŒï¼‰å‘½ä»¤æ‰§è¡Œ"><a href="#ï¼ˆäºŒï¼‰å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="ï¼ˆäºŒï¼‰å‘½ä»¤æ‰§è¡Œ"></a>ï¼ˆäºŒï¼‰å‘½ä»¤æ‰§è¡Œ</h3><p><code>True</code>ä»£è¡¨æ­£å¸¸ï¼Œ<code>*</code>ä»£è¡¨æ‰€æœ‰ä¸»æœºï¼Œä¹Ÿå¯ä»¥é€‰æ‹©å•å°æˆ–è€…æŒ‰ç»„åŠæ­£åˆ™è¿›è¡ŒåŒ¹é…ç­‰ï¼Œè¿™ä¸ªå¯ä»¥å‚çœ‹ä¸‹å®˜æ–¹ç›¸å…³æ–‡æ¡£ ã€‚å…¶é»˜è®¤æ‰§è¡Œçš„æ­£åˆ™æ˜¯shellæ­£åˆ™ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–æ­£åˆ™æˆ–ç»„ç­‰ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="string">[root@salt</span> <span class="string">~]#</span> <span class="string">salt</span> <span class="string">'*'</span> <span class="string">test.ping</span></div><div class="line"><span class="string">[root@salt</span> <span class="string">~]#</span> <span class="string">salt</span> <span class="string">'*'</span> <span class="string">test.ping</span></div><div class="line"><span class="attr">tomcat_C2:</span></div><div class="line">    <span class="literal">True</span></div><div class="line"><span class="attr">tomcat_B2:</span></div><div class="line">    <span class="literal">True</span></div><div class="line"><span class="attr">ihaozhuo1:</span></div><div class="line">    <span class="literal">True</span></div><div class="line"><span class="attr">ihaozhuo2:</span></div><div class="line">    <span class="literal">True</span></div><div class="line"><span class="attr">openapi:</span></div><div class="line">    <span class="literal">True</span></div><div class="line"><span class="attr">tomcat_B1:</span></div><div class="line">    <span class="literal">True</span></div><div class="line"><span class="attr">tomcat_C1:</span></div><div class="line">    <span class="literal">True</span></div><div class="line"><span class="attr">weixin:</span></div><div class="line">    <span class="literal">True</span></div><div class="line"><span class="attr">tomcat_A1:</span></div><div class="line">    <span class="literal">True</span></div><div class="line"><span class="attr">tomcat_A2:</span></div><div class="line">    <span class="literal">True</span></div><div class="line"><span class="attr">node:</span></div><div class="line">    <span class="literal">True</span></div><div class="line"><span class="attr">Gateway2:</span></div><div class="line">    <span class="literal">True</span></div><div class="line"><span class="attr">report1:</span></div><div class="line">    <span class="literal">True</span></div><div class="line"><span class="attr">report2:</span></div><div class="line">    <span class="literal">True</span></div><div class="line"><span class="attr">tomcat_bmw:</span></div><div class="line">    <span class="literal">True</span></div><div class="line"><span class="attr">Gateway1:</span></div><div class="line">    <span class="string">Minion</span> <span class="string">did</span> <span class="string">not</span> <span class="string">return.</span> <span class="string">[Not</span> <span class="string">connected]</span></div></pre></td></tr></table></figure>
<p>è¿™é‡Œå¯ä»¥çœ‹åˆ°æœ‰ä¸€å°pingä¸é€šï¼Œå°±åº”è¯¥ä¸Šå»æŸ¥çœ‹ä¸‹ã€‚</p>
<figure class="highlight tap"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@Gateway1 ~]<span class="comment"># ps -ef | grep minion</span></div><div class="line">root    <span class="number"> 15343 </span>15168 <span class="number"> 0 </span>11:22 pts/0    00:00:00 grep --color=auto minion</div><div class="line">[root@Gateway1 ~]<span class="comment"># service salt-minion start</span></div><div class="line">Redirecting to /bin/systemctl start  salt-minion.service</div><div class="line">[root@Gateway1 ~]<span class="comment"># ps -ef | grep minion</span></div><div class="line">root    <span class="number"> 15422 </span>   <span class="number"> 1 </span><span class="number"> 7 </span>11:22 ?        00:00:00 /usr/bin/python /usr/bin/salt-minion</div><div class="line">root    <span class="number"> 15431 </span>15422<span class="number"> 46 </span>11:22 ?        00:00:00 /usr/bin/python /usr/bin/salt-minion</div><div class="line">root    <span class="number"> 15494 </span>15168 <span class="number"> 0 </span>11:22 pts/0    00:00:00 grep --color=auto minion</div></pre></td></tr></table></figure>
<p>åŸæ¥æ˜¯è¿›ç¨‹æŒ‚äº†ï¼Œæ‰€æœ‰è¿™ä¹Ÿæ˜¯saltä»€ä¹ˆéƒ½å¥½å”¯ä¸€ä¸€ç‚¹ç¼ºç‚¹å°±æ˜¯éœ€è¦é…ç½®å®¢æˆ·ç«¯å¯åŠ¨æœåŠ¡ï¼Œè¿™æ ·å¯¹ç½‘ç»œä¼ è¾“ç­‰ç­‰éƒ½æœ‰è¦æ±‚æ¯”è¾ƒé«˜ã€‚ä¸€æ—¦è¿›ç¨‹æ­»äº†ï¼Œå‡ ç™¾å°ä»¥ä¸Šå¯èƒ½å°±æ¯”è¾ƒè´¹åŠ›ã€‚</p>
<figure class="highlight haml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">-<span class="ruby"> salt <span class="string">'shellæ­£åˆ™'</span> å‘½ä»¤</span></div><div class="line">-<span class="ruby"> salt -E <span class="string">'prel æ­£åˆ™'</span></span></div><div class="line">-<span class="ruby"> salt -N $group å‘½ä»¤</span></div><div class="line">-<span class="ruby"> salt -L <span class="string">'server_id1,server_id2,server_id3'</span> å‘½ä»¤</span></div></pre></td></tr></table></figure>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">å¸¸ç”¨çš„æ“ä½œç±»ä¼¼å¦‚ä¸‹</div><div class="line">- salt <span class="string">'*'</span> cmd<span class="selector-class">.run</span> <span class="string">"ab -n 10 -c 2 http://www.google.com/"</span></div><div class="line">- salt <span class="string">'*'</span> grains<span class="selector-class">.ls</span> æŸ¥çœ‹grainsåˆ†ç±»</div><div class="line">- salt <span class="string">'*'</span> grains<span class="selector-class">.items</span> æŸ¥çœ‹grainsæ‰€æœ‰ä¿¡æ¯</div><div class="line">- salt <span class="string">'*'</span> grains<span class="selector-class">.item</span> osrelease æŸ¥çœ‹grainsæŸä¸ªä¿¡æ¯</div><div class="line">- salt <span class="string">'*'</span> cmd<span class="selector-class">.run</span> <span class="string">"/App/nginx/sbin/nginx -v"</span></div></pre></td></tr></table></figure>

	

	
		<span class="different-posts"><a href="/2015/10/10/è‡ªåŠ¨åŒ–+Jenkins/saltstack/è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·--Saltstackå®‰è£…éƒ¨ç½²é…ç½®ä½¿ç”¨/" onclick="window.history.go(-1); return false;">â¬…ï¸ Go back </a></span>

	

</article>

	</main>

	<footer class="footer">
	<div class="footer-content">
		
	      <div class="footer__element">
	<h5>Hi there,</h5>
	<p style="text-align:justify;">my name is Yancy, they know me as RadiantğŸ‘ğŸ‘. This blog is about Bi-data and my live.<br> I like ğŸŒ³ğŸŒ³ğŸŒ³</p>
</div>


	    
	      <div class="footer__element">
	<h5>Check out</h5>
	<ul class="footer-links">
		<li class="footer-links__link"><a href="/archives">Archive</a></li>
		
		  <li class="footer-links__link"><a href="/atom.xml">RSS</a></li>
	    
		<li class="footer-links__link"><a href="/about">about page</a></li>
		<li class="footer-links__link"><a href="/tags">Tags</a></li>
		<li class="footer-links__link"><a href="/categories">Categories</a></li>
	</ul>
</div>

	    

		<div class="footer-credit">
			<span>Â© 2017 Yancy | Powered by <a href="http://blog.yancy.cc/">Yancy</a> | Theme <a href="https://github.com/yangcvo">Yancy_GitHub</a></span>
		</div>

	</div>


</footer>



</body>

</html>
