<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="theme-color" content="#33474d">
	<title>è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·-Saltstackçš„è¯¦ç»†ä»‹ç»å®‰è£…ä¸ä½¿ç”¨ä»¥åŠè¯­æ³•å¼€å‘æ“ä½œ | Yancy&#39;s blog</title>
	<link rel="stylesheet" href="/css/style.css" />
	
      <link rel="alternate" href="/atom.xml" title="Yancy&#39;s blog" type="application/atom+xml">
    
</head>

<body>

	<header class="header">
		<nav class="header__nav">
			
				<a href="/" class="header__link">Home</a>
			
				<a href="/tags" class="header__link">Tags</a>
			
				<a href="/archives" class="header__link">ARCHIVES</a>
			
				<a href="/about/About" class="header__link">ABOUT</a>
			
				<a href="http://weibo.com/yangcvo" class="header__link">Weibo</a>
			
				<a href="/atom.xml" class="header__link">RSS</a>
			
		</nav>
		<h1 class="header__title"><a href="/">Yancy&#39;s blog</a></h1>
		<h2 class="header__subtitle">SIMPLICITY IS PREREQUISITE FOR  RELIABILITY</h2>
	</header>

	<main>
		<article>
	
		<h1>è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·-Saltstackçš„è¯¦ç»†ä»‹ç»å®‰è£…ä¸ä½¿ç”¨ä»¥åŠè¯­æ³•å¼€å‘æ“ä½œ</h1>
	
	<div class="article__infos">
		<span class="article__date">2015-09-10</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/Automation/">Automation</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Saltstack/">Saltstack</a>
			</span>
		
	</div>

	

	
		<h2 id="å¼•è¨€-è‡ªåŠ¨åŒ–è¿ç»´"><a href="#å¼•è¨€-è‡ªåŠ¨åŒ–è¿ç»´" class="headerlink" title="å¼•è¨€:è‡ªåŠ¨åŒ–è¿ç»´"></a>å¼•è¨€:è‡ªåŠ¨åŒ–è¿ç»´</h2><h3 id="1-saltstack-çš„åŸºæœ¬ä»‹ç»"><a href="#1-saltstack-çš„åŸºæœ¬ä»‹ç»" class="headerlink" title="1:saltstack çš„åŸºæœ¬ä»‹ç»"></a>1:saltstack çš„åŸºæœ¬ä»‹ç»</h3><h4 id="2-salt-çš„å®‰è£…"><a href="#2-salt-çš„å®‰è£…" class="headerlink" title="2:salt çš„å®‰è£…"></a>2:salt çš„å®‰è£…</h4><ul>
<li>æœåŠ¡ç«¯ <ul>
<li>å®‰è£…</li>
<li>é…ç½®æ–‡ä»¶ </li>
<li>è¿è¡Œ </li>
<li>æ³¨æ„äº‹é¡¹</li>
</ul>
</li>
<li>å®¢æˆ·ç«¯ <ul>
<li>å®‰è£…</li>
<li>é…ç½®æ–‡ä»¶</li>
<li>è¿è¡Œ</li>
<li>æ³¨æ„äº‹é¡¹</li>
</ul>
</li>
</ul>
<h4 id="3-salt-çš„ä½¿ç”¨"><a href="#3-salt-çš„ä½¿ç”¨" class="headerlink" title="3:salt çš„ä½¿ç”¨:"></a>3:salt çš„ä½¿ç”¨:</h4><ul>
<li>åŸºç¡€çŸ¥è¯†<ul>
<li>targeting </li>
<li>nodegroup </li>
<li>grains </li>
<li>pillar</li>
</ul>
</li>
<li>çŠ¶æ€ç®¡ç† <ul>
<li>state</li>
<li>state è¯­æ³•</li>
<li>state çš„é€»è¾‘å…³ç³» </li>
<li>highstate</li>
<li>salt schedule </li>
</ul>
</li>
<li>å®æ—¶ç®¡ç† <ul>
<li>cmd.run</li>
<li>module </li>
</ul>
</li>
<li>æ—  master<h4 id="4-salt-å¼€å‘"><a href="#4-salt-å¼€å‘" class="headerlink" title="4:salt å¼€å‘"></a>4:salt å¼€å‘</h4></li>
<li>saltclient ç®¡ç† salt<ul>
<li>salt api</li>
</ul>
</li>
</ul>
<h3 id="å¼•è¨€-è‡ªåŠ¨åŒ–è¿ç»´-è¿ç»´çš„å·¥ä½œä¸»è¦åœ¨2æ–¹é¢"><a href="#å¼•è¨€-è‡ªåŠ¨åŒ–è¿ç»´-è¿ç»´çš„å·¥ä½œä¸»è¦åœ¨2æ–¹é¢" class="headerlink" title="å¼•è¨€:è‡ªåŠ¨åŒ–è¿ç»´ è¿ç»´çš„å·¥ä½œä¸»è¦åœ¨2æ–¹é¢:"></a>å¼•è¨€:è‡ªåŠ¨åŒ–è¿ç»´ è¿ç»´çš„å·¥ä½œä¸»è¦åœ¨2æ–¹é¢:</h3><ol>
<li>çŠ¶æ€çš„ç®¡ç†</li>
<li>ç³»ç»Ÿæ€§èƒ½è°ƒä¼˜ è¿™é‡Œä¸»è¦ç®€ä»‹ä¸‹è¿ç»´çŠ¶æ€çš„ç®¡ç†:<br>å¯¹äºè¿ç»´æ¥è¯´,åŸºäºçŠ¶æ€çš„é…ç½®ç®¡ç†å·²ç»å‘è‡ªåŠ¨åŒ–è¿ˆè¿›äº†ä¸€å¤§æ­¥,ä»¥çŠ¶æ€ä¸ºæ ¸å¿ƒçš„è¿ç»´,<br>è®©çŠ¶æ€æœ¬èº«æœ‰äº†å¯ç®¡ç†æ€§;åœ¨è¿ç»´è¿‡ç¨‹ä¸­æˆ‘ä»¬ä¼šå‘ç°,åŒæ ·çš„ä¸€ä¸ªé…ç½®,æˆ‘ä»¬ä¼šåœ¨ä¸åŒçš„æ—¶é—´, ä¸åŒçš„åœ°ç‚¹ä¸€æ¬¡åœ¨ä¸€æ¬¡çš„é…ç½®,è¿™ä¸ªæ—¶å€™,é…ç½®ç®¡ç†å°±æœ‰äº†é‡å¤æ€§;æœ‰çš„ç”šè‡³æ˜¯åŸå°ä¸åŠ¨çš„é‡ å¤,è€Œå¦å¤–ä¸€äº›åˆ™æ˜¯æŒ‰ç…§ä¸€å®šçš„è§„å¾‹åœ¨å‘å±•,è¿™äº›æŒ‰ç…§ä¸€å®šè§„å¾‹å‘å±•çš„é…ç½®,å°±æ˜¯å¯é¢„æµ‹çš„.ç»¼ ä¸Šæˆ‘è®¤è¯†çš„,æˆ‘ä»¬è¿ç»´å·¥ä½œçš„æœ¬èº«æ˜¯å¯ç®¡ç†,å¯é‡å¤,å¯é¢„æµ‹çš„.åŸºäºè¿™æ ·çš„ç†å¿µ,æˆ‘ä»¬å°±å¯ä»¥æ›´ é«˜ä¸€æ­¥çš„æ¨è¿›æˆ‘ä»¬çš„è¿ç»´è‡ªåŠ¨åŒ–,ç”šè‡³åˆ°æ™ºèƒ½åŒ–.</li>
</ol>
<p>çœ‹åˆ°è¿™é‡Œ,æˆ‘ç†æƒ³ä¸­çš„è¿ç»´è‡ªåŠ¨åŒ–çš„é…ç½®ç®¡ç†å¹³å°åº”è¯¥æœ‰å¦‚ä¸‹åŠŸèƒ½: </p>
<ol>
<li>å¯¹çŠ¶æ€çš„é…ç½®åŠç®¡ç†(æœ€åŸºæœ¬çš„) </li>
<li>å¯ä»¥åŠæ—¶çš„å¯¹ç³»ç»ŸçŠ¶æ€è¿›è¡Œè°ƒæ•´å¹¶èƒ½çœ‹åˆ°ç»“æœ(å¯ä»¥æ–¹ä¾¿çš„å®æ—¶å‡çº§ç³»ç»ŸçŠ¶æ€)</li>
<li>å¯ä»¥å¯¹å…¶æœ¬èº«åšæ–¹ä¾¿çš„ç¬¬ä¸‰æ–¹ç®¡ç†(å€ŸåŠ©å…¶ API,ç›´æ¥ç»™çŠ¶æ€åˆ¶å®šå¥½å…¶å‘å±•æ–¹å‘)</li>
</ol>
<h5 id="åŠ åˆ†é¡¹"><a href="#åŠ åˆ†é¡¹" class="headerlink" title="åŠ åˆ†é¡¹:"></a>åŠ åˆ†é¡¹:</h5><ol>
<li>å¼€å‘è¯­è¨€å•ä¸€</li>
<li>æ¶æ„ç®€å•,çµæ´» </li>
<li>æœ‰ä¸å·®çš„å®‰å…¨æ€§ </li>
<li>æ²¡æœ‰å•†ä¸šç‰ˆ<br>ä¸‹é¢æ˜¯ç°æœ‰æ¯”è¾ƒæœ‰ä»£è¡¨æ€§çš„è‡ªåŠ¨åŒ–é…ç½®ç®¡ç†å·¥å…·: é™„:ä»¥ä¸‹ä»…åŸºäºå¼€æºç‰ˆæœ¬è¿›è¡Œä»‹ç»</li>
</ol>
<h4 id="ç†å¿µ-ä¼˜ç¼ºç‚¹"><a href="#ç†å¿µ-ä¼˜ç¼ºç‚¹" class="headerlink" title="ç†å¿µ ä¼˜ç¼ºç‚¹"></a>ç†å¿µ ä¼˜ç¼ºç‚¹</h4><p>puppet ä»è¿ç»´çš„è§’åº¦å»åšé…ç½®ç®¡ç†(è¿ç»´äººå‘˜åšç»™è¿ç»´ç”¨çš„) æ¶æ„ç®€å•,ç³»ç»Ÿæ¯”è¾ƒæˆ<br>ç†Ÿ/ä¸ä¾¿äºç¬¬ä¸‰æ–¹ç®¡ç†</p>
<p>chef ä»ç ”å‘çš„è§’åº¦å»åšé…ç½®ç®¡ç†(ç ”å‘äººå‘˜åšç»™è¿ç»´ç”¨çš„) è¾ƒä¾¿äºç¬¬ä¸‰æ–¹ç®¡ç†,å¯¹<br>è‡ªèº«(èŠ‚ç‚¹,å˜é‡,cookbook)çš„ç®¡ç†è¾ƒæ–¹ä¾¿,æœ‰è‡ªå·±çš„ dashboard,cookbook æ”¯æŒç‰ˆæœ¬ç®¡ç†,è‡ªä» cookbook çš„ç‰ˆæœ¬ç®¡ç†/æ¶æ„å¤æ‚,å¼€å‘è¯­è¨€è¾ƒå¤š,(å®‰å…¨é—®é¢˜)</p>
<ul>
<li>ä»¥ä¸Š 2 è€…éƒ½æ¯”è¾ƒä¾§é‡äºçŠ¶æ€çš„ç®¡ç†,å¯¹å•ä¸ªæˆ–è€…å¤šä¸ªçŠ¶æ€çš„ä¸´æ—¶è°ƒæ•´æˆ–è€…ç®¡ç†è¾ƒå·® 2 ä¸ªéƒ½æœ‰å•†ä¸šç‰ˆ,è®©æˆ‘è¿™ä¸ªç”¨å¼€æºç‰ˆçš„å¾ˆè‡ªå‘</li>
</ul>
<p>è¿™é‡Œæˆ‘ä»¬ä¹Ÿèƒ½çœ‹åˆ°,2 ä¸ªé…ç½®åŠŸèƒ½éƒ½æ²¡èƒ½è¾¾åˆ°æˆ‘ç†æƒ³ä¸­çš„çŠ¶æ€,é‚£å°±æš‚ç”¨ chef å§,ç›´åˆ°æœ‰ ä¸€å¤©,äº†è§£åˆ°äº† saltstack çœ‹åˆ°äº†è¿™å¥è¯:â€œ ç³»ç»Ÿé…ç½®çš„è‡ªåŠ¨åŒ–ä¸ä»…å¯é¢„æµ‹,å¯é‡å¤, è¿˜å…·æœ‰å¯ ç®¡ç†æ€§â€(<a href="http://wiki.saltstack.cn/reproduction/dive-into-saltstack),è¿™å°¼ç›æ‰æ˜¯è¿ç»´è‡ªåŠ¨åŒ–çš„æœª" target="_blank" rel="external">http://wiki.saltstack.cn/reproduction/dive-into-saltstack),è¿™å°¼ç›æ‰æ˜¯è¿ç»´è‡ªåŠ¨åŒ–çš„æœª</a> æ¥å•Š,äºæ˜¯æ¯«æ— èŠ‚æ“çš„å¼€å§‹å­¦ä¹  salt,è€Œä¸”å‘ç°è¶Šå­¦è¶Šå–œæ¬¢;åœ¨æˆ‘ä½¿ç”¨ puppet åŠ chef çš„æ—¶ å€™éƒ½æ²¡æœ‰ä½¿ç”¨ salt çš„æ„Ÿè§‰,å¤ªçˆ½äº†ã€‚æ‰€ä»¥æˆ‘è¿™é‡Œä»…ä»…ä»‹ç»å‡ æœ¬çš„è¯­æ³•ä¸æ¶‰åŠå®é™…ç”¨ä¾‹,salt çš„å®‰è£…éå¸¸æ–¹ä¾¿,æ‰€ä»¥ä½ åœ¨çœ‹æœ¬æ–‡æ¡£çš„æ—¶å€™å¸Œæœ›ä½ èƒ½çœŸæ­£çš„åŠ¨æ‰‹å»åšä¸€ä¸‹,ç„¶åä½ å°±ä¼šçˆ±ä¸Š salt äº†</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">é™„:å¦‚æœä½ ä¼š python,salt åŸºæœ¬æ˜¯ä¸éœ€è¦æ€ä¹ˆå­¦çš„,è€Œæˆ‘æ­£å¥½äº†è§£ä¸€ç‚¹ py,ä¸è¿‡è¿™æœ€å¤šå æˆ‘é€‰æ‹© salt çš„ 20%ã€‚</div></pre></td></tr></table></figure>
<h3 id="1-saltstack-çš„åŸºæœ¬ä»‹ç»-1"><a href="#1-saltstack-çš„åŸºæœ¬ä»‹ç»-1" class="headerlink" title="1:saltstack çš„åŸºæœ¬ä»‹ç»"></a>1:saltstack çš„åŸºæœ¬ä»‹ç»</h3><p>salt æ˜¯ä¸€ä¸ªæ–°çš„åŸºç¡€å¹³å°ç®¡ç†å·¥å…·ã€‚å¾ˆçŸ­çš„æ—¶é—´å³å¯è¿è¡Œå¹¶ä½¿ç”¨èµ·æ¥, æ‰©å±•æ€§è¶³ä»¥æ”¯æ’‘<br>ç®¡ç†ä¸Šä¸‡å°æœåŠ¡å™¨,æ•°ç§’é’Ÿå³å¯å®Œæˆæ•°æ®ä¼ é€’. ç»å¸¸è¢«æè¿°ä¸º Func åŠ å¼ºç‰ˆ+Puppet ç²¾ç®€ç‰ˆã€‚</p>
<p>salt çš„æ•´ä¸ªæ¶æ„éƒ½æ˜¯åŸºäºæ¶ˆæ¯æ¥å®ç°.æ‰€ä»¥èƒ½å¤Ÿæä¾›æ¨ªå¼ºçš„æ‹“å±•æ€§,çµæ´»æ€§,å®æ—¶æ€§;ä¸å¤¸ äº†,çœ‹å®é™…çš„ slat æ˜¯ä»€ä¹ˆæ ·çš„ä¸è¿‡ salt è¿˜æ˜¯ä¸€ä¸ªå¾ˆå¹´è½»çš„ä¸œè¥¿,è¿˜æœ‰å¾ˆå¤šåœ°æ–¹ä¸å¤Ÿå®Œå–„,åšçš„ä¸å¤Ÿå¥½,ä¸è¿‡æˆ‘ç›¸ä¿¡è¿™ äº›éƒ½åªæ˜¯æ—¶é—´é—®é¢˜ã€‚</p>
<ul>
<li>æ³¨:ä»¥ä¸‹æ–‡æ¡£ä»…ä»…ä¸ºåŸºæœ¬å†…å®¹,ç›¸å…³çŸ¥è¯†ç‚¹çš„æ·±å…¥å­¦ä¹ ,è¯·çœ‹ç›¸åº”æ–‡æ¡£è¿æ¥ ##2:salt çš„å®‰è£…</li>
</ul>
<p>å®‰è£…æœ‰å¾ˆå¤šé€”å¾„,ä½œä¸ºä¸€ä¸ª centos çš„ç”¨æˆ·,æˆ‘é€‰æ‹© rpm é¦–å…ˆæ·»åŠ  RPM æº:<br>rpm -ivh <a href="http://mirrors.sohu.com/fedora-epel/6/x86_64/epel-release-6-8.noarch.rpm" target="_blank" rel="external">http://mirrors.sohu.com/fedora-epel/6/x86_64/epel-release-6-8.noarch.rpm</a></p>
<h5 id="é™„-å®é™…ç”Ÿäº§ä¸­æˆ‘æ˜¯è‡ªå»ºæº"><a href="#é™„-å®é™…ç”Ÿäº§ä¸­æˆ‘æ˜¯è‡ªå»ºæº" class="headerlink" title="é™„:å®é™…ç”Ÿäº§ä¸­æˆ‘æ˜¯è‡ªå»ºæº"></a>é™„:å®é™…ç”Ÿäº§ä¸­æˆ‘æ˜¯è‡ªå»ºæº</h5><p>epel ä¸­å…³äº salt çš„åŒ…:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">salt-api.noarch : A web api <span class="keyword">for</span> to access salt the parallel remote execution system salt-master.noarch : Management component <span class="keyword">for</span> salt, a parallel remote execution</div><div class="line">system</div><div class="line">salt-minion.noarch : Client component <span class="keyword">for</span> salt, a parallel remote execution system salt.noarch : A parallel remote execution system</div><div class="line">salt-cloud.noarch : Generic cloud provisioning tool</div></pre></td></tr></table></figure>
<h4 id="1-æœåŠ¡ç«¯-1-å®‰è£…"><a href="#1-æœåŠ¡ç«¯-1-å®‰è£…" class="headerlink" title="1:æœåŠ¡ç«¯ 1:å®‰è£…"></a>1:æœåŠ¡ç«¯ 1:å®‰è£…</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">yum install salt-master 2:é…ç½®æ–‡ä»¶</div><div class="line">/etc/salt/master</div><div class="line">é…ç½®æ–‡ä»¶é€‰é¡¹ä»‹ç»: http://docs.saltstack.com/ref/configuration/master.html</div><div class="line">æœ€åŸºæœ¬å­—æ®µ:</div><div class="line">interface: æœåŠ¡ç«¯ç›‘å¬ IP</div><div class="line">3:è¿è¡Œ è°ƒè¯•æ¨¡å¼:</div><div class="line">salt-master <span class="_">-l</span> debug åå°è¿è¡Œ:</div><div class="line">salt-master <span class="_">-d</span></div><div class="line">ä½œä¸º centos ç®¡ç†å‘˜,æˆ‘é€‰æ‹©:</div><div class="line">/etc/init.d/salt-master start </div><div class="line"></div><div class="line">4:æ³¨æ„äº‹é¡¹:</div><div class="line">1:ç›‘å¬ç«¯å£</div><div class="line">4505(publish_port):salt çš„æ¶ˆæ¯å‘å¸ƒç³»ç»Ÿ 4506(ret_port):salt å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯é€šä¿¡çš„ç«¯å£</div><div class="line">æ‰€ä»¥ç¡®ä¿å®¢æˆ·ç«¯èƒ½è·ŸæœåŠ¡ç«¯çš„è¿™2ä¸ªç«¯å£é€šä¿¡</div></pre></td></tr></table></figure>
<h4 id="å®‰è£…å®¢æˆ·ç«¯"><a href="#å®‰è£…å®¢æˆ·ç«¯" class="headerlink" title="å®‰è£…å®¢æˆ·ç«¯"></a>å®‰è£…å®¢æˆ·ç«¯</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">yum install salt-minion 2:é…ç½®æ–‡ä»¶</div><div class="line">/etc/salt/minion</div><div class="line">é…ç½®æ–‡ä»¶é€‰é¡¹ä»‹ç»: http://docs.saltstack.com/ref/configuration/minion.html æœ€åŸºæœ¬å­—æ®µ:</div><div class="line">master: æœåŠ¡ç«¯ä¸»æœºå</div><div class="line">id: å®¢æˆ·ç«¯ä¸»æœºå(åœ¨æœåŠ¡ç«¯çœ‹åˆ°çš„å®¢æˆ·ç«¯çš„åå­—)</div><div class="line">3:è¿è¡Œ è°ƒè¯•æ¨¡å¼:</div><div class="line">salt-minion <span class="_">-l</span> debug åå°è¿è¡Œ:</div><div class="line">salt-minion <span class="_">-d</span></div><div class="line">ä½œä¸º centos ç®¡ç†å‘˜,æˆ‘é€‰æ‹©:</div><div class="line">/etc/init.d/salt-minion start </div><div class="line"></div><div class="line">4:æ³¨æ„äº‹é¡¹:</div><div class="line">1:minion é»˜è®¤å’Œä¸»æœºå salt çš„ä¸»æœºé€šä¿¡ </div><div class="line"></div><div class="line">2:å…³äºé…ç½®æ–‡ä»¶</div><div class="line">salt çš„é…ç½®æ–‡ä»¶å‡ä¸º yaml é£æ ¼</div><div class="line"><span class="variable">$key</span>: <span class="variable">$value</span> <span class="comment">#æ³¨æ„å†’å·åæœ‰ä¸€ä¸ªç©ºæ ¼ 3:åŸºç¡€çŸ¥è¯†</span></div><div class="line">1:salt minion å’Œ master çš„è®¤è¯è¿‡ç¨‹:</div><div class="line">(1) minion åœ¨ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶,ä¼šåœ¨/etc/salt/pki/minion/ä¸‹è‡ªåŠ¨ç”Ÿæˆ</div><div class="line">minion.pem(private key), minion.pub(public key),ç„¶åå°† minion.pub å‘é€ç»™ master</div><div class="line">(2) master åœ¨æ¥æ”¶åˆ° minion çš„ public key å,é€šè¿‡ salt-key å‘½ä»¤ accept minion public key,è¿™æ ·åœ¨ master çš„/etc/salt/pki/master/minions ä¸‹çš„å°†ä¼šå­˜æ”¾ä»¥ minion id å‘½åçš„</div><div class="line">public key, ç„¶å master å°±èƒ½å¯¹ minion å‘é€æŒ‡ä»¤äº†</div><div class="line">å¦‚ä¸‹: </div><div class="line">å¯åŠ¨æœåŠ¡ç«¯:</div><div class="line">/etc/init.d/salt-minion restart</div><div class="line">å¯åŠ¨å®¢æˆ·ç«¯:</div><div class="line">/etc/init.d/salt-minion restart </div><div class="line"></div><div class="line">æœåŠ¡ç«¯æŸ¥çœ‹key:</div><div class="line">salt-key</div><div class="line">Accepted Keys:</div><div class="line">Unaccepted Keys: minion1</div><div class="line">Rejected Keys:</div><div class="line">æœåŠ¡ç«¯æ¥å— key salt-key <span class="_">-a</span> minion1</div><div class="line"></div><div class="line">æµ‹è¯•:</div><div class="line">salt <span class="string">'minion1'</span> test.ping minion1:</div><div class="line">True</div><div class="line">é™„:salt æ›´å¤šå‘½ä»¤åŠæ‰‹å†Œ salt <span class="string">'*'</span> sys.doc</div></pre></td></tr></table></figure>
<h3 id="3-salt-çš„ä½¿ç”¨-1-åŸºç¡€çŸ¥è¯†"><a href="#3-salt-çš„ä½¿ç”¨-1-åŸºç¡€çŸ¥è¯†" class="headerlink" title="3:salt çš„ä½¿ç”¨: 1:åŸºç¡€çŸ¥è¯†"></a>3:salt çš„ä½¿ç”¨: 1:åŸºç¡€çŸ¥è¯†</h3><p>1:targeting</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">salt <span class="string">'*'</span> test.ping</div><div class="line">å¼•å·ä¸­ä»¥å®ç°å¾ˆå¼ºå¤§çš„ minion çš„è¿‡æ»¤ä¸åŒ¹é…æŠ€æœ¯ æ–‡æ¡£:http://docs.saltstack.com/topics/targeting /compound.html</div><div class="line">å¸¸ç”¨å‘½ä»¤:</div><div class="line">salt <span class="string">'shell æ­£åˆ™'</span> å‘½ä»¤</div><div class="line">salt -E <span class="string">'prel æ­£åˆ™'</span></div><div class="line">salt -N <span class="variable">$group</span> å‘½ä»¤</div><div class="line">salt -L <span class="string">'server_id1,server_id2,server_id3'</span> å‘½ä»¤</div><div class="line">ç¤ºä¾‹:</div><div class="line">salt -C <span class="string">'webserv* and G@os:Debian or E@web-dc1-srv.*'</span> test.ping</div></pre></td></tr></table></figure>
<p>2:nodegroup<br>å¯¹ minion è¿›è¡Œåˆ†ç»„</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">æ–‡æ¡£: http://docs.saltstack.com/topics/targeting/nodegroups.html åœ¨ master çš„é…ç½®æ–‡ä»¶ä¸­æŒ‰å¦‚ä¸‹æ ¼å¼å®šä¹‰:</div><div class="line">nodegroups:</div><div class="line">group1: <span class="string">'L@foo.domain.com,bar.domain.com,baz.domain.com or</span></div><div class="line">bl*.domain.com'</div><div class="line">group2: <span class="string">'G@os:Debian and foo.domain.com'</span> åœ¨ state æˆ–è€… pillar ä¸­å¼•ç”¨çš„æ—¶å€™å¦‚ä¸‹:</div><div class="line">base: group1:</div><div class="line">- match: nodegroup - webserver</div></pre></td></tr></table></figure>
<p>3:grains<br>minion åŸºæœ¬ä¿¡æ¯çš„ç®¡ç† æ–‡æ¡£:<a href="http://docs.saltstack.com/topics/targeting" target="_blank" rel="external">http://docs.saltstack.com/topics/targeting</a> /grains.html åŸºæœ¬ä½¿ç”¨:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">salt <span class="string">'*'</span> grains.ls æŸ¥çœ‹ grains åˆ†ç±»</div><div class="line">salt <span class="string">'*'</span> grains.items æŸ¥çœ‹ grains æ‰€æœ‰ä¿¡æ¯</div><div class="line">salt <span class="string">'*'</span> grains.item osrelease æŸ¥çœ‹ grains æŸä¸ªä¿¡æ¯</div><div class="line">ç¤ºä¾‹:</div><div class="line">salt <span class="string">'*'</span> grains.item osrelease minoin1:</div><div class="line">osrelease: 6.2</div></pre></td></tr></table></figure>
<h3 id="minion-çš„å˜é‡"><a href="#minion-çš„å˜é‡" class="headerlink" title="minion çš„å˜é‡"></a>minion çš„å˜é‡</h3><p>åœ¨ç”¨ salt è¿›è¡Œç®¡ç†å®¢æˆ·ç«¯çš„æ—¶å€™æˆ–è€…å†™ state çš„æ—¶å€™éƒ½å¯ä»¥å¼•ç”¨ grains çš„å˜é‡ 4:pillar</p>
<p>salt æ•æ„Ÿä¿¡æ¯çš„ç®¡ç†,åªæœ‰åŒ¹é…åˆ°çš„èŠ‚ç‚¹æ‰èƒ½çœ‹åˆ°å’Œä½¿ç”¨ æ–‡æ¡£:<a href="http://docs.saltstack.com/topics/tutorials/pillar.html" target="_blank" rel="external">http://docs.saltstack.com/topics/tutorials/pillar.html</a> é»˜è®¤:pillar æ•°æ®å®šä¹‰æ–‡ä»¶å­˜å‚¨è·¯å¾„:/srv/pillar å…¥å£æ–‡ä»¶:/srv/pillar/top.sls</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">æ ¼å¼: base:</div><div class="line"><span class="string">"targeting"</span>:</div><div class="line">- <span class="variable">$pillar</span></div><div class="line"><span class="variable">$pillar</span>.sls åŸºæœ¬:</div><div class="line"><span class="variable">$key</span>: <span class="variable">$value</span> state å¼•ç”¨æ–¹å¼:</div><div class="line">&#123;&#123; pillar[<span class="string">'$key'</span>] &#125;&#125;</div><div class="line">å¤æ‚:</div><div class="line">users:</div><div class="line">thatch: 1000 shouse: 1001 utahdave: 1002 redbeard: 1003</div><div class="line">state å¼•ç”¨æ–¹å¼:</div><div class="line">&#123;% <span class="keyword">for</span> user, uid <span class="keyword">in</span> pillar.get(<span class="string">'users'</span>, &#123;&#125;).items() %&#125;</div><div class="line">&#123;&#123;user&#125;&#125;: user.present:</div><div class="line">- uid: &#123;&#123;uid&#125;&#125; &#123;% endfor %&#125;</div><div class="line">æŸ¥çœ‹èŠ‚ç‚¹çš„ pillar æ•°æ®: salt <span class="string">'client2'</span> pillar.data</div><div class="line">åŒæ­¥ pillar:</div><div class="line">salt <span class="string">'*'</span> saltutil.refresh_pillar</div><div class="line">é™„:è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°,pallar ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨ jinja(åé¢ä¼šæåˆ°)åšä¸€äº›å¤„ç† 5:minion</div><div class="line">å³ä¸º salt çš„å®¢æˆ·ç«¯</div><div class="line">2:çŠ¶æ€ç®¡ç† 1:state</div><div class="line">salt åŸºäº minion è¿›è¡ŒçŠ¶æ€çš„ç®¡ç† 1:state è¯­æ³•</div><div class="line">æ–‡æ¡£:http://docs.saltstack.com/ref/states/all/index.html</div><div class="line"><span class="comment">#åå­—ä¸ºpillar.slsçš„æ–‡ä»¶æ¥å­˜æ”¾å¯¹åŒ¹é…åˆ°çš„</span></div><div class="line">&#123;% <span class="keyword">if</span> grains[<span class="string">'os_family'</span>] == <span class="string">'RedHat'</span> %&#125; - name: vim-enhanced</div><div class="line">&#123;% <span class="keyword">elif</span> grains[<span class="string">'os'</span>] == <span class="string">'Debian'</span> %&#125;</div><div class="line">- name: vim-nox</div><div class="line">&#123;% <span class="keyword">elif</span> grains[<span class="string">'os'</span>] == <span class="string">'Ubuntu'</span> %&#125; - name: vim-nox</div><div class="line">&#123;% endif %&#125;</div><div class="line">- installed</div><div class="line">å¦‚æœæ˜¯ redhard ç³»åˆ—çš„å°±å®‰è£… vim-enhanced,å¦‚æœç³»ç»Ÿæ˜¯ Debian æˆ– è€… Ubuntu å°±å®‰è£… vim-nox</div><div class="line">ä»¥æœ‰å¤šä¸ª</div><div class="line">é™„:state é»˜è®¤ä½¿ç”¨ jinja(http://jinja.pocoo.org/)çš„æ¨¡æ¿è¯­æ³•, æ–‡æ¡£åœ°å€: http://jinja.pocoo.org /docs/templates/</div></pre></td></tr></table></figure>
<p>2:state çš„é€»è¾‘å…³ç³»: æ–‡æ¡£:<a href="http://docs.saltstack.com/ref/states/ordering.html" target="_blank" rel="external">http://docs.saltstack.com/ref/states/ordering.html</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">require:ä¾èµ–æŸä¸ª state,åœ¨è¿è¡Œæ­¤ state å‰,å…ˆè¿è¡Œä¾èµ–çš„ state,ä¾èµ–å¯</div><div class="line">httpd: pkg:</div><div class="line">- installed file.managed:</div><div class="line">- name: /etc/httpd/conf/httpd.conf </div><div class="line">- <span class="built_in">source</span>: salt://httpd/httpd.conf</div><div class="line">- require:</div><div class="line">- pkg: httpd</div></pre></td></tr></table></figure>
<p>watch:åœ¨æŸä¸ª state å˜åŒ–æ—¶è¿è¡Œæ­¤æ¨¡å— redis:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">pkg:</div><div class="line">- latest</div><div class="line">file.managed:</div><div class="line">- <span class="built_in">source</span>: salt://redis/redis.conf</div><div class="line">- name: /etc/redis.conf</div><div class="line">- require:</div><div class="line">- pkg: redis service.running: </div><div class="line">- <span class="built_in">enable</span>: True</div><div class="line"><span class="comment">#state çš„åå­—</span></div></pre></td></tr></table></figure>
<p>$state: #è¦ç®¡ç†çš„æ¨¡å—ç±»å‹ - $State states #è¯¥æ¨¡å—çš„çŠ¶æ€</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">- watch:</div><div class="line">- file: /etc/redis.conf </div><div class="line">- pkg: redis</div></pre></td></tr></table></figure>
<p>é™„:watch é™¤å…·å¤‡ require åŠŸèƒ½å¤–,è¿˜å¢äº†å…³æ³¨çŠ¶æ€çš„åŠŸèƒ½</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line">order:</div><div class="line">ä¼˜å…ˆçº§æ¯” require å’Œ watch ä½</div><div class="line">æœ‰ order æŒ‡å®šçš„ state æ¯”æ²¡æœ‰ order æŒ‡å®šçš„ä¼˜å…ˆçº§é«˜ vim:</div><div class="line">pkg.installed: - order: 1</div><div class="line">æƒ³è®©æŸä¸ª state æœ€åä¸€ä¸ªè¿è¡Œ,å¯ä»¥ç”¨ last 3:state ä¸ minion</div><div class="line"></div><div class="line">å°†ä¸´æ—¶ç»™ minoin åŠ ä¸ª state</div><div class="line">salt <span class="string">'minion1'</span> state.sls <span class="string">'vim'</span> <span class="comment">#ç»™ minion1 åŠ ä¸€ä¸ª vim çš„ state æ‰§è¡Œè¯¥å‘½ä»¤åå¯ä»¥ç«‹å³çœ‹åˆ°è¾“å‡ºç»“æœ</span></div><div class="line"></div><div class="line">2:highstate</div><div class="line">ç»™ minion æ°¸ä¹…ä¸‹æ·»åŠ çŠ¶æ€</div><div class="line">æ–‡æ¡£: http://docs.saltstack.com/ref/states/highstate.html é»˜è®¤é…ç½®æ–‡ä»¶:/srv/salt/top.sls</div><div class="line">è¯­æ³•:</div><div class="line"><span class="string">'*'</span>:</div><div class="line">- core</div><div class="line">- wsproxy </div><div class="line">- /srv/salt/ç›®å½•ç»“æ„:</div><div class="line">.</div><div class="line">â”œâ”€â”€ core.sls â”œâ”€â”€ top.sls â””â”€â”€ wsproxy</div><div class="line">â”œâ”€â”€ init.sls â”œâ”€â”€ websocket.py â””â”€â”€ websockify</div><div class="line">åº”ç”¨:</div><div class="line">salt <span class="string">"minion1"</span> state.highstate</div><div class="line"></div><div class="line">æµ‹è¯•æ¨¡å¼:</div><div class="line">salt <span class="string">"minion1"</span> state.highstate -v <span class="built_in">test</span>=True 3:salt schedule</div><div class="line">é»˜è®¤çš„ state åªæœ‰åœ¨æœåŠ¡ç«¯è°ƒç”¨çš„æ—¶å€™æ‰æ‰§è¡Œ,å¾ˆå¤šæ—¶å€™æˆ‘ä»¬å¸Œæœ› minon è‡ªè§‰ çš„å»ä¿æŒåœ¨æŸä¸ªçŠ¶æ€</div><div class="line"></div><div class="line">æ–‡æ¡£:http://docs.saltstack.com/topics/<span class="built_in">jobs</span>/schedule.html</div><div class="line">cat /srv/pillar/top.sls base:</div><div class="line"><span class="string">"*"</span>:</div><div class="line">- schedule</div><div class="line">cat /srv/pillar/schedule.sls schedule:</div><div class="line">highstate:</div><div class="line"><span class="keyword">function</span>: state.highstate minutes: 30</div><div class="line"></div><div class="line">å¦‚ä¸Šé…ç½®:</div><div class="line">minion ä¼šæ²¡ 30 åˆ†é’Ÿä» master æ‹‰å»ä¸€æ¬¡é…ç½®,è¿›è¡Œè‡ªæˆ‘é…ç½®</div><div class="line"></div><div class="line">3:å®æ—¶ç®¡ç† æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦ä¸´æ—¶çš„æŸ¥çœ‹ä¸€å°æˆ–å¤šå°æœºå™¨ä¸Šçš„æŸä¸ªæ–‡ä»¶,æˆ–è€…æ‰§è¡ŒæŸä¸ªå‘½ä»¤</div><div class="line">1:cmd.run</div><div class="line">ç”¨æ³• salt <span class="string">'$targeting'</span> cmd.run <span class="string">'$cmd'</span></div><div class="line">ç¤ºä¾‹:salt <span class="string">'*'</span> cmd.run <span class="string">'hostname'</span> æ‰§è¡Œä¸‹è¿™æ ·çš„å‘½ä»¤,é©¬ä¸Šå°±æ„Ÿå—åˆ°æ•ˆæœäº†,é€Ÿåº¦è¿˜è´¼å¿«</div><div class="line">2:module</div><div class="line">åŒæ—¶,salt ä¹Ÿå°†ä¸€äº›å¸¸ç”¨çš„å‘½ä»¤åšäº†é›†æˆ æ–‡æ¡£:http://docs.saltstack.com/ref/modules/all/index.html è¿™é‡Œå‡ ä¹æ¶µç›–äº†æˆ‘ä»¬æ‰€æœ‰çš„å¸¸ç”¨å‘½ä»¤</div><div class="line">æ¯”å¦‚:</div><div class="line">æŸ¥çœ‹æ‰€æœ‰èŠ‚ç‚¹ç£ç›˜ä½¿ç”¨æƒ…å†µ</div><div class="line">salt <span class="string">'*'</span> disk.usage æ–‡æ¡£:http://docs.saltstack.com/topics/tutorials/quickstart.html</div><div class="line">4:æ—  master</div><div class="line">ä¸»è¦åº”è¯¥åœ¨æµ‹è¯•å’Œ salt å•æœºç®¡ç†çš„æ—¶å€™</div></pre></td></tr></table></figure>
<h3 id="4-salt-å¼€å‘-1"><a href="#4-salt-å¼€å‘-1" class="headerlink" title="4:salt å¼€å‘"></a>4:salt å¼€å‘</h3><p>1:saltclient ç®¡ç† salt<br>åªæœ‰æ‰ master æ‰å¯ä»¥salt å…¨éƒ¨ç”¨ python,è¿™é‡Œä¹Ÿç”¨ python<br>æ–‡æ¡£:<a href="http://docs.saltstack.com/ref/python-api.html" target="_blank" rel="external">http://docs.saltstack.com/ref/python-api.html</a> </p>
<p>ç¤ºä¾‹:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">import salt.client</div><div class="line">client = salt.client.LocalClient()</div><div class="line">ret = client.cmd(<span class="string">'*'</span>, <span class="string">'cmd.run'</span>, [<span class="string">'ls -l'</span>])</div><div class="line"><span class="built_in">print</span> ret</div></pre></td></tr></table></figure>
<p>2:salt api<br>salt api æˆ‘ç°åœ¨è¿˜æ²¡ç”¨,ä¸è¿‡æˆ‘ä¹Ÿæ²¡æå®š,å¦‚æœä½ æå®šäº†,æˆ‘ä¼šéå¸¸æ„Ÿè°¢ä½ èƒ½åˆ†äº«<br>ä¸‹çš„ã€‚</p>
<p>####å‚è€ƒæ–‡æ¡£:</p>
<p>1:salt ä¸­æ–‡ wiki:<a href="http://wiki.saltstack.cn/" target="_blank" rel="external">http://wiki.saltstack.cn/</a> å¾ˆä¸é”™çš„æ–‡ç« :<a href="http://wiki.saltstack.cn/reproduction/dive-into-saltstack" target="_blank" rel="external">http://wiki.saltstack.cn/reproduction/dive-into-saltstack</a><br>2:salt å®˜ç½‘ <a href="http://saltstack.com/" target="_blank" rel="external">http://saltstack.com/</a> å®˜ç½‘æ–‡æ¡£:<a href="http://docs.saltstack.com/" target="_blank" rel="external">http://docs.saltstack.com/</a></p>

	

	
		<span class="different-posts"><a href="/2015/09/10/è‡ªåŠ¨åŒ–+Jenkins/saltstack/è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·-Saltstackçš„è¯¦ç»†ä»‹ç»å®‰è£…ä¸ä½¿ç”¨ä»¥åŠè¯­æ³•å¼€å‘æ“ä½œ/" onclick="window.history.go(-1); return false;">â¬…ï¸ Go back </a></span>

	

</article>

	</main>

	<footer class="footer">
	<div class="footer-content">
		
	      <div class="footer__element">
	<h5>Hi there,</h5>
	<p style="text-align:justify;">my name is Yancy, they know me as RadiantğŸ‘ğŸ‘. This blog is about Bi-data and my live.<br> I like ğŸŒ³ğŸŒ³ğŸŒ³</p>
</div>


	    
	      <div class="footer__element">
	<h5>Check out</h5>
	<ul class="footer-links">
		<li class="footer-links__link"><a href="/archives">Archive</a></li>
		
		  <li class="footer-links__link"><a href="/atom.xml">RSS</a></li>
	    
		<li class="footer-links__link"><a href="/about">about page</a></li>
		<li class="footer-links__link"><a href="/tags">Tags</a></li>
		<li class="footer-links__link"><a href="/categories">Categories</a></li>
	</ul>
</div>

	    

		<div class="footer-credit">
			<span>Â© 2019 Yancy | Powered by <a href="http://blog.yancy.cc/">Yancy</a> | Theme <a href="https://github.com/yangcvo">Yancy_GitHub</a></span>
		</div>

	</div>


</footer>



</body>

</html>
