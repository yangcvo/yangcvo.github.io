<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>自动化运维工具--Saltstack写sls语法批量部署zabbix_agent | Yancy&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Saltstack批量部署zabbix_agent服务12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576epel_install:  file.managed:">
<meta name="keywords" content="Saltstack">
<meta property="og:type" content="article">
<meta property="og:title" content="自动化运维工具--Saltstack写sls语法批量部署zabbix_agent">
<meta property="og:url" content="http://blog.yancy.cc/2015/11/01/自动化+Jenkins/saltstack/自动化运维工具--Saltstack写sls语法批量部署zabbix_agent/index.html">
<meta property="og:site_name" content="Yancy&#39;s blog">
<meta property="og:description" content="Saltstack批量部署zabbix_agent服务12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576epel_install:  file.managed:">
<meta property="og:updated_time" content="2017-10-24T14:21:07.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="自动化运维工具--Saltstack写sls语法批量部署zabbix_agent">
<meta name="twitter:description" content="Saltstack批量部署zabbix_agent服务12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576epel_install:  file.managed:">
  
  <link rel="stylesheet" href="/css/index.css">
</head>

<body style="


  background-color: #eff0f6

">
  <div id="container">
    <nav id="nav">
  <header class="header">
    <a href="/" class="title">Clover Tuan</a>
  </header>
  <div class="ctnWrap">
    <div class="icons">
      
        
          
            <a href="https://dribbble.com/clovertuan" target="_blank" class="nav-icn iconfont icon-dribbble"></a>
          
        
          
            <a href="https://www.behance.net/clovertuan" target="_blank" class="nav-icn iconfont icon-behance"></a>
          
        
          
            <a href="http://clovertuan.lofter.com/" target="_blank" class="nav-icn iconfont icon-lofter"></a>
          
        
          
            <a href="https://www.instagram.com/clovertuan/" target="_blank" class="nav-icn iconfont icon-instagram"></a>
          
        
          
            <a href="https://github.com/cloverTuan" target="_blank" class="nav-icn iconfont icon-github"></a>
          
        
      
    </div>
    <div class="menu">
      
        
            <a href="/" class="nav-menu ">HOME</a>
          
        
            <a href="/archives" class="nav-menu ">ARCHIVE</a>
          
        
            <a href="/about" class="nav-menu ">ABOUT</a>
          
        
      
    </div>
  </div>
</nav>
    <div id="main"><section class="article">
  <h2 class="title">自动化运维工具--Saltstack写sls语法批量部署zabbix_agent</h2>
  <p class="sub">Nov 1, 2015</p>
  <article class="content">
    <h1 id="Saltstack批量部署zabbix-agent服务"><a href="#Saltstack批量部署zabbix-agent服务" class="headerlink" title="Saltstack批量部署zabbix_agent服务"></a>Saltstack批量部署zabbix_agent服务</h1><figure class="highlight haml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div></pre></td><td class="code"><pre><div class="line">epel_install:</div><div class="line">  file.managed:</div><div class="line">    -<span class="ruby"> <span class="symbol">name:</span> /root/zabbix-release-<span class="number">2.4</span>-<span class="number">1</span>.el6.noarch.rpm             <span class="comment">## 指定节点的epel安装包的存放路径</span></span></div><div class="line">    -<span class="ruby"> <span class="symbol">source:</span> <span class="symbol">salt:</span>/<span class="regexp">/epel/zabbix</span>-release-<span class="number">2.4</span>-<span class="number">1</span>.el6.noarch.rpm     <span class="comment">## 指定从master的哪个位置拷贝epel的rpm包</span></span></div><div class="line">    -<span class="ruby"> <span class="symbol">user:</span> root                                                  <span class="comment">## 文件的拥有者</span></span></div><div class="line">    -<span class="ruby"> <span class="symbol">group:</span> root                                                 <span class="comment">## 文件的所属组</span></span></div><div class="line">    -<span class="ruby"> <span class="symbol">mode:</span> <span class="number">777</span></span></div><div class="line">    -<span class="ruby"> <span class="symbol">backup:</span> minion</span></div><div class="line"></div><div class="line">  cmd.run:</div><div class="line">    -<span class="ruby"> <span class="symbol">name:</span> rpm -ivh /root/zabbix-release-<span class="number">2.4</span>-<span class="number">1</span>.el6.noarch.rpm    <span class="comment">## 执行rpm包的安装</span></span></div><div class="line">    -<span class="ruby"> <span class="symbol">unless:</span> test -f /etc/yum.repos.d/epel.repo                  <span class="comment">## 如果存在这个文件就不再执行安装程序</span></span></div><div class="line">    -<span class="ruby"> <span class="symbol">require:</span></span></div><div class="line">      -<span class="ruby"> <span class="symbol">file:</span> epel_install</span></div><div class="line"></div><div class="line">SELINUX:</div><div class="line">  cmd.run:</div><div class="line">    -<span class="ruby"> <span class="symbol">name:</span> service iptables stop &amp;&amp; chkconfig iptables off &amp;&amp; setenforce <span class="number">0</span>      </span></div><div class="line"></div><div class="line">   #sed -i 's/SELINUX=enforcing/SELINUX=disabled/g' /etc/selinux/config</div><div class="line">   </div><div class="line">    -<span class="ruby"> <span class="symbol">require:</span></span></div><div class="line">      -<span class="ruby"> <span class="symbol">file:</span> epel_install</span></div><div class="line"></div><div class="line">cache_yum:</div><div class="line">  cmd.run:</div><div class="line">    -<span class="ruby"> <span class="symbol">name:</span> yum makecache                                 <span class="comment">## 生成yum的缓存</span></span></div><div class="line">    -<span class="ruby"> <span class="symbol">require:</span> </span></div><div class="line">      -<span class="ruby"> <span class="symbol">file:</span> epel_install                              <span class="comment">## 生成缓存要在epel安装之后</span></span></div><div class="line"></div><div class="line">zabbix-agentd:</div><div class="line">  pkg.installed: []</div><div class="line">  service.running:</div><div class="line">#    - name: zabbix-agent</div><div class="line">#    - running</div><div class="line">    -<span class="ruby"> <span class="symbol">enable:</span> True</span></div><div class="line">    -<span class="ruby"> <span class="symbol">reload:</span> True</span></div><div class="line">    -<span class="ruby"> <span class="symbol">watch:</span></span></div><div class="line">      -<span class="ruby"> <span class="symbol">file:</span> /etc/zabbix/zabbix_agentd.conf</span></div><div class="line">    -<span class="ruby"> <span class="symbol">require:</span></span></div><div class="line">      -<span class="ruby"> <span class="symbol">file:</span> epel_install</span></div><div class="line"><span class="comment"></span></div><div class="line"></div><div class="line">/etc/zabbix/zabbix_agentd.conf:</div><div class="line">   file.managed:</div><div class="line">    -<span class="ruby"> <span class="symbol">source:</span> <span class="symbol">salt:</span>/<span class="regexp">/zabbix/zabbix</span>_agentd.conf</span></div><div class="line">    -<span class="ruby"> <span class="symbol">user:</span> zabbix                                          <span class="comment">## 文件的拥有者</span></span></div><div class="line">    -<span class="ruby"> <span class="symbol">group:</span> zabbix                                         <span class="comment">## 文件的所属组</span></span></div><div class="line">    -<span class="ruby"> <span class="symbol">mode:</span> <span class="number">644</span></span></div><div class="line">    -<span class="ruby"> <span class="symbol">backup:</span> minion</span></div><div class="line">    -<span class="ruby"> <span class="symbol">template:</span> jinja</span></div><div class="line">    -<span class="ruby"> <span class="symbol">require:</span></span></div><div class="line">      -<span class="ruby"> <span class="symbol">file:</span> epel_install</span></div><div class="line"></div><div class="line">ntp:</div><div class="line">  pkg.installed: []                                        ## 安装ntp </div><div class="line">#     name: ntp</div><div class="line">  service.running:</div><div class="line">#     name: ntpd</div><div class="line">#     running</div><div class="line">     enable: True</div><div class="line">    reload: True</div><div class="line">    watch:</div><div class="line">    file: /etc/ntp.conf</div><div class="line">    require:                                            ## 安装ntp要在epel安装之后</div><div class="line">    file: epel_install</div><div class="line"><span class="comment"></span></div><div class="line">/etc/ntp.conf:</div><div class="line">  file.managed:</div><div class="line">    -<span class="ruby"> <span class="symbol">source:</span> <span class="symbol">salt:</span>/<span class="regexp">/ntp/ntp</span>.conf</span></div><div class="line">    -<span class="ruby"> <span class="symbol">user:</span> root                                          <span class="comment">## 文件的拥有者</span></span></div><div class="line">    -<span class="ruby"> <span class="symbol">group:</span> root                                         <span class="comment">## 文件的所属组</span></span></div><div class="line">    -<span class="ruby"> <span class="symbol">mode:</span> <span class="number">644</span></span></div><div class="line">    -<span class="ruby"> <span class="symbol">backup:</span> minion</span></div><div class="line">    -<span class="ruby"> <span class="symbol">require:</span></span></div><div class="line">      -<span class="ruby"> <span class="symbol">file:</span> epel_install</span></div></pre></td></tr></table></figure>

  </article>
  <footer class="f-cf">
    
      <a href="/2015/11/20/自动化+Jenkins/saltstack/自动化运维工具--saltstack远程启动tomcat日志乱码 /" class="link f-fl">⟵自动化运维工具--saltstack远程启动tomcat日志乱码</a>
    
    
      <a href="/2015/11/01/自动化+Jenkins/saltstack/自动化运维工具--SaltStack-分组（使用记录,groups） /" class="link f-fr">自动化运维工具--SaltStack-分组（使用记录,groups）⟶</a>
    
  </footer>
</section></div>
    <footer id="footer" class="f-cf">
  d.guangying@foxmail.com
  
    
      
        · <a href="https://dribbble.com/clovertuan" target="_blank" class="nav-icn">Dribbble</a>
      
    
      
        · <a href="https://www.behance.net/clovertuan" target="_blank" class="nav-icn">Behance</a>
      
    
      
        · <a href="http://clovertuan.lofter.com/" target="_blank" class="nav-icn">Lofter</a>
      
    
      
        · <a href="https://www.instagram.com/clovertuan/" target="_blank" class="nav-icn">Instagram</a>
      
    
      
        · <a href="https://github.com/cloverTuan" target="_blank" class="nav-icn">GitHub</a>
      
    
  
  <span class="copyright">All rights reserved @Clover Tuan</span>
</footer>
  </div>
</body>
</html>