<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> cacti安装与配置 · Cheng yang's Blog</title><meta name="description" content="cacti安装与配置 - yangc"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://blog.yangcvo.me/atom.xml" title="Cheng yang's Blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/yangcvo" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/yangcvo" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="http://blog.yangcvo.me/2014/05/04/%E4%B8%AA%E4%BA%BA%E8%AE%B0%E5%BD%95/About-me/" target="_blank" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">cacti安装与配置</h1><div class="post-info">2014年10月21日</div><div class="post-content"><p>cacti是基于nginx，rrdtool，mysql，php，snmp来运行的</p>
<blockquote>
<p>1.安装操作系统centos6.0以上版本</p>
<p>2.配置好网络IP和DNS</p>
<p>3.修改系统时区和时间，使用上海时区</p>
</blockquote>
<p>备份原有的时区文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cp /etc/localtime /etc/localtime.bak</span><br></pre></td></tr></table></figure>
<p>用上海时区文件替换系统时区文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span><br></pre></td></tr></table></figure>
<p>修改/etc/sysconfig/clock文件，修改为：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ZONE=&quot;Asia/Shanghai&quot;</span><br><span class="line">UTC=false</span><br><span class="line">ARC=false</span><br></pre></td></tr></table></figure>
<p>同步时间</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ntpdate time.nist.gov</span><br></pre></td></tr></table></figure>
<p>4.安装epel源</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rpm -Uvh http://mirrors.sohu.com/fedora-epel/6/x86_64/epel-release-6-8.noarch.rpm</span><br></pre></td></tr></table></figure>
<p>5.安装基础支持软件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install -y openssh-clients telnet wget nginx php-cgi php-cli spawn-fcgi mysql-servermysql rrdtoolnet-snmp net-snmp-utils net-snmp-devel php-mysql php-snmp</span><br></pre></td></tr></table></figure>
<p>6.配置PHP管理器</p>
<p>（1）cd /etc/sysconfig 进入sysconfig文件夹</p>
<p>（2）vi spawn-fcgi 在文件改位置添加如下命令</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#SOCKET=/var/run/php-fcgi.sock</span></span><br><span class="line"><span class="comment">#OPTIONS="-u apache -g apache -s $SOCKET -S -M 0600 -C 32 -F 1 -P /var/run/spawn-fcgi.pid -- /usr/bin/php-cgi"</span></span><br><span class="line"> SOCKET=/var/run/php-fcgi.sock</span><br><span class="line"> OPTIONS=<span class="string">"-u nginx -g nginx -s <span class="variable">$SOCKET</span> -S -M 0600 -C 32 -F 1 -P /var/run/spawn-fcgi.pid -- /usr/bin/php-cgi"</span></span><br></pre></td></tr></table></figure>
<p>（3）/etc/init.d/spawn-fcgi restart 重启php管理器</p>
<p>（4）chkconfig spawn-fcgi on 设置开机启动服务</p>
<p>7.补充创建/var/lib/php下 session 目录</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mkdir -p /var/lib/php/session</span><br><span class="line">chown -R nginx.nginx /var/lib/php/session</span><br><span class="line">chmod 777 /var/lib/php/session</span><br></pre></td></tr></table></figure>
<p>8.修改PHP文件配置</p>
<p>vi /etc/php.ini</p>
<p>（1）修改PHP时区为Asia/ShangHai，在文件如下位置添加该句命令</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">;;;;;;;;;;;;;;;;;;;</span><br><span class="line">; Module Settings ;</span><br><span class="line">;;;;;;;;;;;;;;;;;;;</span><br><span class="line">[Date]</span><br><span class="line">; Defines the default timezone used by the date <span class="built_in">functions</span></span><br><span class="line">; http://www.php.net/manual/en/datetime.configuration.php<span class="comment">#ini.date.timezone</span></span><br><span class="line">;date.timezone =</span><br><span class="line">date.timezone = Asia/Shanghai</span><br></pre></td></tr></table></figure>
<p>（2）修改PHP调用内存限制，在文件如下位置修改如下添加：</p>
<p><code>date.timezone = Asia/Shanghai   memory_limit = 512M</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">;;;;;;;;;;;;;;;;;;;</span><br><span class="line">; Resource Limits ;</span><br><span class="line">;;;;;;;;;;;;;;;;;;;</span><br><span class="line">; Maximum execution time of each script, <span class="keyword">in</span> seconds</span><br><span class="line">; http://www.php.net/manual/en/info.configuration.php<span class="comment">#ini.max-execution-time</span></span><br><span class="line">max_execution_time = 30</span><br><span class="line">; Maximum amount of time each script may spend parsing request data. It<span class="string">'s a good</span><br><span class="line">; idea to limit this time on productions servers in order to eliminate unexpectedly</span><br><span class="line">; long running scripts.</span><br><span class="line">; Default Value: -1 (Unlimited)</span><br><span class="line">; Development Value: 60 (60 seconds)</span><br><span class="line">; Production Value: 60 (60 seconds)</span><br><span class="line">; http://www.php.net/manual/en/info.configuration.php#ini.max-input-time</span><br><span class="line">max_input_time = 60</span><br><span class="line">; Maximum input variable nesting level</span><br><span class="line">; http://www.php.net/manual/en/info.configuration.php#ini.max-input-nesting-level</span><br><span class="line">;max_input_nesting_level = 64</span><br><span class="line">; Maximum amount of memory a script may consume (128MB)</span><br><span class="line">; http://www.php.net/manual/en/ini.core.php#ini.memory-limit</span><br><span class="line">#memory_limit = 128M</span><br><span class="line">memory_limit = 512M</span></span><br></pre></td></tr></table></figure>
<p>10.修改nginx配置文件增加对cacti的支持（对应自己的nginx安装目录）<br>vi /usr/local/nginx/conf.d/nginx.conf在文件末尾大括号内添加如下配置<br>          server {<br>          listen 8080;<br>          server_name 127.0.0.1;<br>          root html;<br>          index index.html index.php;</p>
<pre><code>   location ~ \.php$ {
   root html;
   fastcgi_buffer_size 128k;
   fastcgi_buffers 8 128k;
   fastcgi_pass unix:/var/run/php-fcgi.sock;
   fastcgi_index index.php;
   fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
  #fastcgi_param SCRIPT_FILENAME /usr/local/nginx/html/$fastcgi_script_name;
  include fastcgi_params;
  }
       }
chkconfig nginx on 设置nginx开机启动
service nginx restart重启nginx服务
</code></pre><p>11.安装catic</p>
<p>catic是无需编译安装的，直接下载其源包解压即可使用<br>（1）下载cacti</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /tmp</span><br><span class="line">wget http://www.cacti.net/downloads/cacti-0.8.8b.tar.gz</span><br></pre></td></tr></table></figure>
<p>（2）解压cacti</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tar zxvf cacti-0.8.8b.tar.gz</span><br><span class="line">mv cacti-0.8.8b /usr/<span class="built_in">local</span>/nginx/html <span class="comment">#将解压出的cacti文件夹移动到nginx的</span></span><br></pre></td></tr></table></figure>
<p>web目录下（对应自己安装的nginx）</p>
<p>（3）修改cacti的使用者和组权限为nginx用户和nginx组</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/nginx/html</span><br><span class="line">chown -R nginx:nginx cacti/</span><br></pre></td></tr></table></figure>
<p>12.创建数据库，存储cacti数据</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">启动mysql</span><br><span class="line">/etc/init.d/mysqld start</span><br><span class="line">chkconfig mysqld on</span><br></pre></td></tr></table></figure>
<p>（1）使用root账户登录mysql</p>
<pre><code>mysql -uroot
</code></pre><p>（2）创建cacti数据库表</p>
<pre><code>create database cacti;
</code></pre><p>（3）建立用户cacti，密码cacti123(可自行定义)</p>
<pre><code>mysql&gt; insert into mysql.user(host,user,password) values (&apos;localhost&apos;,&apos;cacti&apos;,password(&apos;cacti123&apos;));
</code></pre><p>（4）重载mysql授权表</p>
<pre><code>mysql&gt; flush privileges;
</code></pre><p>（5） 把数据库cacti授权于用户cacti</p>
<pre><code>mysql&gt; grant all on cacti.* to cacti@&apos;localhost&apos; identified by &apos;cacti123&apos;;
mysql&gt; quit
</code></pre><p>（6）将cacti数据库与mysql中的数据对应起来</p>
<pre><code>cd /usr/local/nginx/html/cacti
mysql -ucacti -pcacti123 cacti&lt;cacti.sql
</code></pre><h3 id="13-修改CACTI配置文件"><a href="#13-修改CACTI配置文件" class="headerlink" title="13.修改CACTI配置文件"></a>13.修改CACTI配置文件</h3><p> (1) 切换至cacti下的include目录（对应自己安装的nginx）</p>
<pre><code>cd /usr/local/nginx/html/cacti/include/
</code></pre><p> (2)编辑config.php文件，修改如下位置的配置</p>
<pre><code>vi config.php
</code></pre><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/* make sure these values refect your actual database/host/user/password */</span><br><span class="line"><span class="variable">$database_type</span> = <span class="string">"mysql"</span>;</span><br><span class="line"><span class="variable">$database_default</span> = <span class="string">"cacti"</span>;<span class="comment">#mysql数据库里所创建的表名</span></span><br><span class="line"><span class="variable">$database_hostname</span> = <span class="string">"127.0.0.1"</span>;</span><br><span class="line"><span class="variable">$database_username</span> = <span class="string">"cacti"</span>;<span class="comment">#mysql数据库里为cacti数据表所创建的用户名</span></span><br><span class="line"><span class="variable">$database_password</span> = <span class="string">"cacti123"</span>;<span class="comment">#mysql数据库里为cacti数据表所创建的密码</span></span><br><span class="line"><span class="variable">$database_port</span> = <span class="string">"3306"</span>;</span><br><span class="line"><span class="variable">$database_ssl</span> = <span class="literal">false</span>;</span><br></pre></td></tr></table></figure>
<p>14.配置cacti的循环任务</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">crontab <span class="_">-e</span></span><br><span class="line">*/5 * * * * php /usr/<span class="built_in">local</span>/nginx/html/cacti/poller.php &gt; /dev/null 2&gt;&amp;1<span class="comment">#请对应自己的nginx安装目录</span></span><br></pre></td></tr></table></figure>
<p>:wq 保存退出</p>
<p>可直接先运行一遍php /usr/local/nginx/html/cacti/poller.php 好让cacti产生图片</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">php /usr/share/nginx/html/cacti/poller.php</span><br></pre></td></tr></table></figure>
<p>15.安装完成</p>
<pre><code>使用浏览器打开如下地址http://本机IP/cacti/install
</code></pre><p>会显示安装向导，点击NEXT即可，到下面如下界面是，注意查看所有的文件路径是否都为绿色，不是绿色请找到自己安装的目录，一一对应点击Finsh即可到达cacti的登陆界面</p>
<p>输入用户名密码,<code>cacti</code>默认的用户名和密码都为<code>admin</code>，输入一次后会提示在一次输入，这个时候是让你设置新的admin密码.然后就能进入cacti的图形界面了.</p>
<p>点击左上角graphs，就能查看本机所监控的所有设备默认存在一个localhost，监控本机的内存使用，活动用户等信息.</p>
<p><img src="http://7xrthw.com1.z0.glb.clouddn.com/cacti.png" alt=""></p>
</div></article></div></section><footer><div class="paginator"><a href="/2014/11/20/Ghost/Ghost增加Disqus评论组件/" class="prev">PREV</a><a href="/2014/10/06/Zabbix/zabbix监控80端口状态/" class="next">NEXT</a></div><div data-thread-key="2014/10/21/cacti安装与配置/" data-title="cacti安装与配置" data-url="http://blog.yangcvo.me/2014/10/21/cacti安装与配置/" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"true"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();

</script><div class="copyright"><p>© 2014 - 2016 <a href="http://blog.yangcvo.me">yangc</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yangcvo" target="_blank">Github-yangcvo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>